{"config":{"lang":["en"],"separator":"[\\s\\-\uff0c\u3002]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u6280\u672f\u6742\u8bb0 &amp; \u597d\u6587\u6458\u5f55","text":"<p>\u91ca\u68b5\u601d \u300a\u9882\u53e4\u4e5d\u9996\u300b</p> <p>\u6625\u6709\u767e\u82b1\u79cb\u6709\u6708\uff0c\u590f\u6709\u51c9\u98ce\u51ac\u6709\u96ea\u3002</p> <p>\u82e5\u65e0\u95f2\u4e8b\u5728\u5fc3\u5934\uff0c\u4fbf\u662f\u4eba\u95f4\u597d\u65f6\u8282\u3002</p> <p>\u82cf\u8f7c \u300a\u5b9a\u98ce\u6ce2\u300b</p> <p>\u83ab\u542c\u7a7f\u6797\u6253\u53f6\u58f0\uff0c\u4f55\u59a8\u541f\u5578\u4e14\u5f90\u884c\u3002</p> <p>\u7af9\u6756\u8292\u978b\u8f7b\u80dc\u9a6c\uff0c</p> <p>\u8c01\u6015\uff1f\u4e00\u84d1\u70df\u96e8\u4efb\u5e73\u751f\u3002</p> <p>\u6599\u5ced\u6625\u98ce\u5439\u9152\u9192\uff0c</p> <p>\u5fae\u51b7\uff0c\u5c71\u5934\u659c\u7167\u5374\u76f8\u8fce\u3002</p> <p>\u56de\u9996\u5411\u6765\u8427\u745f\u5904\uff0c</p> <p>\u5f52\u53bb\uff0c\u4e5f\u65e0\u98ce\u96e8\u4e5f\u65e0\u6674\u3002</p>"},{"location":"back-end/","title":"\u540e\u7aef&amp;\u8fd0\u7ef4","text":""},{"location":"back-end/python/PyCharm_root_debug/","title":"\u4ee5 Root\u6743\u9650\u8fd0\u884c/\u8c03\u8bd5 PyCharm","text":"<p>\u6709\u65f6\uff0cpython\u6709\u53ef\u80fd\u9700\u8981su\u6743\u9650\uff0c\u5982\u914d\u7f6e ssl\uff0c\u5f53\u7136\u4f60\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u6267\u884c <code>sudo</code>,\u4f46\u5728Pycharm \u8fd9\u6837\u7684\u96c6\u6210\u5f0f\u5f00\u53d1\u73af\u5883\u4e2d\uff0c\u4f60\u8981\u662f\u5e0c\u671b\u4f7f\u7528\u5b83\u7684\u4e00\u4e9b\u7279\u6027\uff0c\u5982\u725b\u53c9\u95ea\u95ea\u7684\u65ad\u70b9\u8c03\u8bd5\uff0c\u53ef\u80fd\u9700\u8981\u628a\u6574\u4e2a\u9879\u76ee\u4ee5 root \u6743\u9650\u8fd0\u884c\uff0c\u5373<code>sudo /Applications/PyCharm.app/Contents/MacOS/pycharm</code>\uff0c\u4f46\u8fd9\u6837\u4f1a\u5bfc\u81f4\u7528\u6237\u76ee\u5f55\u53d1\u751f\u4e86\u53d8\u5316\uff08\u7528\u6237\u76ee\u5f55\u53d8\u6210\u4e86/root\uff09\uff0c\u4ece\u800c\u5bfc\u81f4\u8fd0\u884c\u73af\u5883\u53d8\u5316\uff0c\u6240\u4ee5\u66f4\u7406\u60f3\u7684\u60c5\u51b5\u5e94\u8be5\u662f\u4ee5\u666e\u901a\u7528\u6237\u542f\u52a8pycharm\uff0c\u8fd0\u884c/\u8c03\u8bd5\u65f6 \u4f7f\u7528root\u6743\u9650\uff0c\u4e0b\u9762\u8bf4\u4e0b\u600e\u4e48\u5b9e\u73b0\uff1a</p>"},{"location":"back-end/python/PyCharm_root_debug/#1pythonsudo","title":"1.\u8bbe\u7f6epython\u89e3\u91ca\u5668\u9ed8\u8ba4\u4ee5sudo\u65b9\u5f0f\u542f\u52a8\uff0c\u4e14\u514d\u5bc6\u7801\u8f93\u5165\uff1a","text":"<pre><code>sudo visudo -f /etc/sudoers.d/python\n</code></pre> <p>\u5728\u6587\u4ef6\u4e2d\u8f93\u5165\u5982\u4e0b\u6587\u5b57</p> <pre><code>&lt;user&gt; &lt;host&gt; = (root) NOPASSWD: &lt;full path to python&gt;\n</code></pre> <p>\u8fd9\u91cc\u56e0\u4e3a\u6211\u4f7f\u7528\u7684\u865a\u62df\u73af\u5883\uff0c\u6240\u4ee5\u6211 python \u8def\u5f84\u662f\u865a\u62df\u73af\u5883\u7684\u8def\u5f84\uff0c\u8fd9\u4e2a\u6839\u636e\u81ea\u5df1\u5b9e\u9645\u60c5\u51b5\u800c\u5b9a\u5c31\u597d</p> <pre><code>adison ALL = (root) NOPASSWD: xxx/venv/bin/python\n</code></pre> <p>\u6ce8\uff1a\u7f16\u8f91sudoers.d\u4e2d\u7684\u6587\u4ef6\u4e00\u5b9a\u8981\u7528visodu\uff0c\u5b83\u5e26\u5b89\u5168\u68c0\u67e5\u529f\u80fd\uff0e\u5176\u5b83\u7f16\u8f91\u5de5\u5177\u53ef\u80fd\u5bfc\u81f4\u6587\u4ef6\u89e3\u6790\u5931\u8d25\uff0c\u4ece\u800c\u65e0\u6cd5\u4f7f\u7528sudo\u547d\u4ee4\uff0e\u51fa\u73b0sudo\u89e3\u6790\u5931\u8d25,\u65e0\u6cd5\u521d\u59cb\u5316\u7b56\u7565\u63d2\u4ef6\u9519\u8bef(\u53ef\u901a\u8fc7\u7cfb\u7edf\u6062\u590d\u6a21\u5f0f\u8fdb\u884c\u4fee\u590d\uff0c\u65b9\u6cd5\u5728\u8fd9\u91cc)</p>"},{"location":"back-end/python/PyCharm_root_debug/#2python27_sudoshsudopython","title":"2.\u521b\u5efa\u4e00\u4e2a\u811a\u672c\u6587\u4ef6\uff08\u5982python2.7_sudo.sh\uff09\uff0c\u4ee5sudo\u65b9\u5f0f\u542f\u52a8python\u89e3\u91ca\u5668,\u6587\u4ef6\u5185\u5bb9\u53c2\u8003\u5982\u4e0b\uff1a","text":"<pre><code>#!/bin/bash\nsudo xxx/venv/bin/python \"$@\"\n</code></pre> <p>\u4fee\u6539\u6587\u4ef6\u6743\u9650\u4e3a\u53ef\u6267\u884c</p> <pre><code>chmod +x python2.7_sudon.sh\n</code></pre>"},{"location":"back-end/python/PyCharm_root_debug/#3python27_sudonshpycharm","title":"3.\u4f7f\u7528python2.7_sudon.sh\u4f5c\u4e3apycharm\u7684\u89e3\u91ca\u5668\uff0e","text":"<p>\u542f\u52a8pycharm\uff0c\u6253\u5f00\u5de5\u7a0b\uff0c\u9009\u62e9\u83dc\u5355\u547d\u4ee4Preferences \u2014 Project Interpreter,\u9009\u62e9Project Interpreter\u53f3\u8fb9\u7684\u9f7f\u8f6e\u56fe\u6807\uff0c\u5728\u5f39\u51fa\u83dc\u5355\u4e2d\u9009\u62e9Add Local\uff0c\u7136\u540e\u5728\u6587\u4ef6\u9009\u62e9\u5bf9\u8bdd\u6846\u4e2d\u9009\u4e2d\u521a\u521a\u521b\u5efa\u7684python2.7_sudon.sh\uff0c\u786e\u5b9a\u540e\u5373\u53ef</p> <p></p> <p>\u7ecf\u8fc7\u4e0a\u9762\u7684\u8bbe\u7f6e\u540e\uff0c\u8be5\u9879\u76ee\u5c06\u4ee5su\u6743\u9650\u542f\u52a8python\u89e3\u91ca\u5668\u8fd0\u884c\u548c\u8c03\u8bd5\u4ee3\u7801\u6587\u4ef6\uff0e</p>"},{"location":"back-end/python/PyCharm_root_debug/#_1","title":"\u53c2\u8003\u6587\u7ae0","text":"<p>rundebug-as-root-in-pycharm</p>"},{"location":"back-end/python/centos_flask/","title":"CentOS \u90e8\u7f72 flask\u9879\u76ee","text":"<p>\u6700\u8fd1\u5728\u5b66\u4e60 python\uff0c\u4f7f\u7528 flask \u5b9e\u73b0\u4e86\u4e2a\u4e2a\u4eba\u535a\u5ba2\u7a0b\u5e8f\uff0c\u5b8c\u4e86\u60f3\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\u3002\u56e0\u4e3a\u662f\u65b0\u624b\uff0c\u4e00\u8def\u78d5\u78d5\u7eca\u7eca\u6700\u7ec8\u628a\u5b83\u57fa\u672c\u641e\u5b9a\u3002\u7f51\u4e0a\u8d44\u6599\u5bf9\u65b0\u624b\u611f\u89c9\u90fd\u4e0d\u592a\u53cb\u597d\uff0c\u90fd\u662f\u96f6\u96f6\u788e\u788e\u7684\uff0c\u6240\u4ee5\u6211\u6574\u7406\u4e86\u4e00\u4e0b\uff0c\u4e00\u65b9\u9762\u4f5c\u4e3a\u6211\u81ea\u5df1\u7684\u8bb0\u5f55\uff0c\u65b9\u4fbf\u4ee5\u540e\u67e5\u9605\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u5e0c\u671b\u80fd\u5e2e\u52a9\u5230\u8ddf\u6211\u4e00\u6837\u7684\u65b0\u624b\u3002</p>"},{"location":"back-end/python/centos_flask/#_1","title":"\u524d\u63d0","text":"<ol> <li> <p>\u6709\u4e00\u4e2a\u670d\u52a1\u5668\uff08\u4e0d\u7136\u641e\u6bdb\uff09\uff0c\u8d2d\u4e70\u53ef\u4ee5\u53c2\u8003\u4f18\u8d28\u56fd\u5916vps\u63a8\u8350</p> </li> <li> <p>\u6709\u4e2a\u4eba\u57df\u540d\uff08\u5f53\u7136\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 IP\u8bbf\u95ee\uff0c\u4f46\u6709\u70b9\u5947\u602a\u4e0d\u662f\uff1f\u8d2d\u4e70\u57df\u540d\u53ef\u4ee5\u53bbGoDaddy)</p> </li> </ol>"},{"location":"back-end/python/centos_flask/#1git","title":"1.\u5b89\u88c5git","text":"<p>\u53ef\u4ee5\u9009\u62e9 github \u6216\u8005Bitbucket\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u642d\u5efa git\u670d\u52a1\u5668\uff0c\u4f46\u6211\u89c9\u5f97\u6ca1\u5565\u5fc5\u8981\uff0c\u6211\u9009\u62e9Bitbucket\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5b83\u79c1\u6709\u5e93\u514d\u8d39</p> <pre><code>sudo yum install git\n</code></pre> <p>\u540e\u7eed\u5c31\u8ddf\u6211\u4eec\u672c\u5730\u5f00\u53d1\u6ca1\u4ec0\u4e48\u533a\u522b\u4e86\uff0c\u914d\u7f6e ssh key\uff0cclone\u4ee3\u7801\uff0c\u5c31\u4e0d\u5c55\u5f00\u4e86\uff0c\u9879\u76ee\u76ee\u5f55\u5efa\u8bae\u653e\u5728 <code>/home/www/</code> \u4e0b</p>"},{"location":"back-end/python/centos_flask/#2-mysql","title":"2. \u5b89\u88c5 Mysql","text":""},{"location":"back-end/python/centos_flask/#mysql-yum","title":"\u6dfb\u52a0 MySQL YUM \u6e90","text":"<pre><code>$wget 'https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm'\n$sudo rpm -Uvh mysql57-community-release-el7-11.noarch.rpm\n$yum repolist all | grep mysql\nmysql-connectors-community/x86_64 MySQL Connectors Community                  36\nmysql-tools-community/x86_64      MySQL Tools Community                       47\nmysql57-community/x86_64          MySQL 5.7 Community Server                 187\n</code></pre>"},{"location":"back-end/python/centos_flask/#_2","title":"\u5b89\u88c5\u6700\u65b0\u7248\u672c","text":"<pre><code>$sudo yum install mysql-community-server\n</code></pre>"},{"location":"back-end/python/centos_flask/#mysql","title":"\u542f\u52a8 MySQL \u670d\u52a1","text":"<pre><code>$sudo service mysqld start $sudo systemctl start mysqld #CentOS 7\n$sudo systemctl status mysqld\n\u25cf mysqld.service - MySQL Community Server\nLoaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)\nActive: active (running) since Sat 2017-05-27 12:56:26 CST; 15s ago\nProcess: 2482 ExecStartPost=/usr/bin/mysql-systemd-start post (code=exited, status=0/SUCCESS)\nProcess: 2421 ExecStartPre=/usr/bin/mysql-systemd-start pre (code=exited, status=0/SUCCESS)\nMain PID: 2481 (mysqld_safe)\nCGroup: /system.slice/mysqld.service\n\u251c\u25002481 /bin/sh /usr/bin/mysqld_safe --basedir=/usr\n\u2514\u25002647 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/...\n</code></pre> <p>\u8bf4\u660e\u5df2\u7ecf\u6b63\u5728\u8fd0\u884c\u4e2d\u4e86</p>"},{"location":"back-end/python/centos_flask/#_3","title":"\u4fee\u6539\u5bc6\u7801","text":"<pre><code>$ mysql -uroot -p </code></pre> <p>\u8fd9\u91cc\u6709\u8981\u6c42\u4f60\u8f93\u5165\u5bc6\u7801\uff0cMysql\u5b89\u88c5\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u9ed8\u8ba4\u5bc6\u7801\uff0c\u4f7f\u7528 <code>grep \"temporary password\" /var/log/mysqld.log</code>\u547d\u4ee4\uff0c\u8fd4\u56de\u7ed3\u679c\u6700\u540e\u5f15\u53f7\u540e\u9762\u7684\u5b57\u7b26\u4e32\u5c31\u662froot\u7684\u9ed8\u8ba4\u5bc6\u7801</p> <pre><code>mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'NewPassword';\n</code></pre>"},{"location":"back-end/python/centos_flask/#_4","title":"\u4fee\u6539\u7f16\u7801","text":"<p>\u5728 /etc/my.cnf \u4e2d\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u7f16\u7801</p> <pre><code>[client]\n\ndefault-character-set = utf8\n\n[mysqld]\n\ndefault-storage-engine = INNODB\n\ncharacter-set-server = utf8\n\ncollation-server = utf8_general_ci #\u4e0d\u533a\u5206\u5927\u5c0f\u5199\n\ncollation-server = utf8_bin #\u533a\u5206\u5927\u5c0f\u5199\n\ncollation-server = utf8_unicode_ci #\u6bd4 utf8_general_ci \u66f4\u51c6\u786e\n</code></pre>"},{"location":"back-end/python/centos_flask/#_5","title":"\u521b\u5efa\u6570\u636e\u5e93","text":"<pre><code>mysql&gt; CREATE DATABASE &lt;datebasename&gt; CHARACTER SET utf8;\n</code></pre>"},{"location":"back-end/python/centos_flask/#3-python3-pip3","title":"3. \u5b89\u88c5python3 pip3","text":"<p>CentOS 7 \u9ed8\u8ba4\u5b89\u88c5\u4e86 Python 2\uff0c\u5f53\u9700\u8981\u4f7f\u7528 Python 3 \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u624b\u52a8\u4e0b\u8f7d Python \u6e90\u7801\u540e\u7f16\u8bd1\u5b89\u88c5\u3002</p>"},{"location":"back-end/python/centos_flask/#python-3","title":"\u5b89\u88c5 Python 3","text":"<pre><code>sudo mkdir /usr/local/python3 # \u521b\u5efa\u5b89\u88c5\u76ee\u5f55\n$ wget --no-check-certificate https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz # \u4e0b\u8f7d Python \u6e90\u6587\u4ef6 \n# \u6ce8\u610f\uff1awget\u83b7\u53d6https\u7684\u65f6\u5019\u8981\u52a0\u4e0a\uff1a--no-check-certifica\n$ tar -xzvf Python-3.6.2.tgz # \u89e3\u538b\u7f29\u5305\n$ cd Python-3.6.2 # \u8fdb\u5165\u89e3\u538b\u76ee\u5f55\nsudo ./configure --prefix=/usr/local/python3 # \u6307\u5b9a\u521b\u5efa\u7684\u76ee\u5f55\nsudo make\nsudo make install # \u7f16\u8bd1\u5b89\u88c5\n</code></pre> <p>\u6267\u884c./configure\u65f6\u53ef\u80fd\u4f1a\u62a5\u9519\uff0cconfigure: error: no acceptable C compiler found in $PATH\uff0c\u8fd9\u662f\u56e0\u4e3a\u672a\u5b89\u88c5\u5408\u9002\u7684\u7f16\u8bd1\u5668\uff0c\u5b89\u88c5\u4e0b\u5c31\u597d\u4e86\uff0c</p> <p><code>sudo yum install gcc-c++</code> (\u4f7f\u7528sudo yum install gcc-c++\u65f6\u4f1a\u81ea\u52a8\u5b89\u88c5/\u5347\u7ea7gcc\u53ca\u5176\u4ed6\u4f9d\u8d56\u7684\u5305\u3002)</p>"},{"location":"back-end/python/centos_flask/#_6","title":"\u914d\u7f6e\u4e24\u4e2a\u7248\u672c\u5171\u5b58","text":"<p>\u521b\u5efa python3 \u7684\u8f6f\u94fe\u63a5\uff1a</p> <pre><code>$ sudo ln -s /usr/local/python3/bin/python3 /usr/bin/python3\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7 <code>python</code> \u547d\u4ee4\u4f7f\u7528 Python 2\uff0c<code>python3</code> \u6765\u4f7f\u7528 Python 3\u3002</p>"},{"location":"back-end/python/centos_flask/#pip","title":"\u5b89\u88c5 pip","text":"<pre><code>$ sudo yum -y install epel-release # \u9996\u5148\u5b89\u88c5 epel \u6269\u5c55\u6e90\n$ sudo yum -y install python-pip # \u5b89\u88c5 python-pip\n$ sudo yum clean all # \u6e05\u9664 cache\n</code></pre> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u8c8c\u4f3c\u53ea\u80fd\u5b89\u88c5 pip2\uff0c\u60f3\u8981\u5b89\u88c5 Python 3 \u7684 pip\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u7684\u6e90\u4ee3\u7801\u5b89\u88c5\u65b9\u5f0f\u3002</p> <pre><code># \u4e0b\u8f7d\u6e90\u4ee3\u7801\n$ wget --no-check-certificate https://github.com/pypa/pip/archive/9.0.1.tar.gz\n$ tar -zvxf 9.0.1.tar.gz    # \u89e3\u538b\u6587\u4ef6\n$ cd pip-9.0.1\n$ python3 setup.py install # \u4f7f\u7528 Python 3 \u5b89\u88c5\n</code></pre> <p>\u521b\u5efa\u94fe\u63a5\uff1a</p> <p><pre><code>$ sudo ln -s /usr/local/python3/bin/pip /usr/bin/pip3\n</code></pre> \u5347\u7ea7 pip</p> <pre><code>$ pip install --upgrade pip\n</code></pre>"},{"location":"back-end/python/centos_flask/#4-gunicorn","title":"4. \u5b89\u88c5 gunicorn","text":"<p>Gunicorn (\u72ec\u89d2\u517d)\u662f\u4e00\u4e2a\u9ad8\u6548\u7684Python WSGI Server,\u901a\u5e38\u7528\u5b83\u6765\u8fd0\u884c wsgi application(\u7531\u6211\u4eec\u81ea\u5df1\u7f16\u5199\u9075\u5faaWSGI application\u7684\u7f16\u5199\u89c4\u8303) \u6216\u8005 wsgi framework(\u5982Django,Paster),\u5730\u4f4d\u76f8\u5f53\u4e8eJava\u4e2d\u7684Tomcat\u3002 WSGI\u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u534f\u8bae\uff1a\u5b83\u662f\u4e00\u4e2aPython\u7a0b\u5e8f\u548c\u7528\u6237\u8bf7\u6c42\u4e4b\u95f4\u7684\u63a5\u53e3\u3002WSGI\u670d\u52a1\u5668\u7684\u4f5c\u7528\u5c31\u662f\u63a5\u53d7\u5e76\u5206\u6790\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u8c03\u7528\u76f8\u5e94\u7684python\u5bf9\u8c61\u5b8c\u6210\u5bf9\u8bf7\u6c42\u7684\u5904\u7406\uff0c\u7136\u540e\u8fd4\u56de\u76f8\u5e94\u7684\u7ed3\u679c\u3002 \u7b80\u5355\u6765\u8bf4gunicorn\u5c01\u88c5\u4e86HTTP\u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u6211\u4eec\u901a\u8fc7gunicorn\u542f\u52a8\u670d\u52a1\uff0c\u7528\u6237\u8bf7\u6c42\u4e0e\u670d\u52a1\u76f8\u5e94\u90fd\u7ecf\u8fc7gunicorn\u4f20\u8f93</p>"},{"location":"back-end/python/centos_flask/#_7","title":"\u521b\u5efa\u865a\u62df\u73af\u5883","text":"<pre><code>cd /home/www/blog\nmkdir venv\npython3 -m venv venv\n</code></pre>"},{"location":"back-end/python/centos_flask/#_8","title":"\u6fc0\u6d3b\u865a\u62df\u73af\u5883\uff1a","text":"<pre><code>source venv/bin/activate\n</code></pre> <p>\u7136\u540e\u6839\u636e<code>requirements.txt</code>\u6587\u4ef6\u5b89\u88c5\u4f9d\u8d56\u5305\uff1a</p> <pre><code>pip3 install -r requirements.txt\n</code></pre>"},{"location":"back-end/python/centos_flask/#gunicorn","title":"\u5b89\u88c5gunicorn","text":"<pre><code>pip3 install gunicorn\n</code></pre> <p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u521b\u5efa\u4e00\u4e2awsgi.py\u6587\u4ef6</p> <pre><code>from app import create_app\napplication = create_app('production')\nif __name__ == '__main__':\napplication.run()\n</code></pre> <p>\u4e0d\u518d\u901a\u8fc7manage.py\u542f\u52a8\u670d\u52a1\uff0c\u90a3\u53ea\u5728\u5f00\u53d1\u7684\u65f6\u5019\u4f7f\u7528</p> <p>\u542f\u52a8\u670d\u52a1\uff1a</p> <pre><code>gunicorn -w 4 -b 127.0.0.1:8000 wsgi:application\n</code></pre>"},{"location":"back-end/python/centos_flask/#5-nginx","title":"5. \u5b89\u88c5 Nginx","text":"<p>nginx \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684web\u670d\u52a1\u5668\u3002\u901a\u5e38\u7528\u6765\u5728\u524d\u7aef\u505a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002\u6240\u8c13\u6b63\u5411\u4e0e\u53cd\u5411\uff08reverse\uff09\uff0c\u53ea\u662f\u82f1\u6587\u8bf4\u6cd5\u7ffb\u8bd1\u3002\u4ee3\u7406\u670d\u52a1\uff0c\u7b80\u800c\u8a00\u4e4b\uff0c\u4e00\u4e2a\u8bf7\u6c42\u7ecf\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\u4ece\u5c40\u57df\u7f51\u53d1\u51fa\uff0c\u7136\u540e\u5230\u8fbe\u4e92\u8054\u7f51\u4e0a\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u4ee3\u7406\u4e3a\u6b63\u5411\u4ee3\u7406\u3002\u5982\u679c\u4e00\u4e2a\u8bf7\u6c42\uff0c\u4ece\u4e92\u8054\u7f51\u8fc7\u6765\uff0c\u5148\u8fdb\u5165\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u518d\u7531\u4ee3\u7406\u670d\u52a1\u5668\u8f6c\u53d1\u7ed9\u5c40\u57df\u7f51\u7684\u76ee\u6807\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u4e3a\u53cd\u5411\u4ee3\u7406\uff08\u76f8\u5bf9\u6b63\u5411\u800c\u8a00\uff09\u3002</p> <p>\u6b63\u5411\u4ee3\u7406\uff1a{ \u5ba2\u6237\u7aef ---\u300b \u4ee3\u7406\u670d\u52a1\u5668 } ---\u300b \u670d\u52a1\u5668</p> <p>\u53cd\u5411\u4ee3\u7406\uff1a\u5ba2\u6237\u7aef ---\u300b { \u4ee3\u7406\u670d\u52a1\u5668 ---\u300b \u670d\u52a1\u5668 }</p> <p>{} \u8868\u793a\u5c40\u57df\u7f51</p> <p>nginx\u65e2\u53ef\u4ee5\u505a\u6b63\u5411\uff0c\u4e5f\u53ef\u4ee5\u505a\u53cd\u5411\u3002</p> <pre><code>$ yum -y install nginx\n</code></pre>"},{"location":"back-end/python/centos_flask/#nginx","title":"\u542f\u52a8 nginx \u670d\u52a1","text":"<pre><code>$ service nginx start\n</code></pre>"},{"location":"back-end/python/centos_flask/#nginx_1","title":"\u505c\u6b62 nginx \u670d\u52a1","text":"<pre><code>$ service nginx stop\n</code></pre>"},{"location":"back-end/python/centos_flask/#nginx_2","title":"\u91cd\u542f nginx \u670d\u52a1","text":"<pre><code>$ service nginx restart\n</code></pre>"},{"location":"back-end/python/centos_flask/#_9","title":"\u5e73\u6ed1\u91cd\u542f","text":"<p>nginx\u914d\u7f6e\u6539\u52a8\u4e86\uff0c\u53ef\u4ee5\u91cd\u65b0\u52a0\u8f7d\u800c\u4e0d\u7528\u5148\u5173\u95ed\u518d\u6253\u5f00</p> <pre><code>$ nginx -s reload\n</code></pre> <p>\u542f\u52a8\u540e \uff0c\u5728\u6d4f\u89c8\u5668\u4e2d \u8f93\u5165\u670d\u52a1\u5668\u7684 ip \u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u770b\u5230</p> <p></p> <p>\u5230\u8fd9\u91cc <code>yum</code> \u5b89\u88c5 <code>nginx</code> \u5c31\u5b8c\u6210\u4e86</p>"},{"location":"back-end/python/centos_flask/#_10","title":"\u6dfb\u52a0\u914d\u7f6e","text":"<p>nginx\u7684\u914d\u7f6e\u6587\u4ef6\u4e3a\uff1a<code>/etc/nginx/nginx.conf</code></p> <pre><code>server {\nlisten 80;\nserver_name adisonhyh.com;\nlocation / {\nproxy_pass http://127.0.0.1:8000;\nproxy_set_header Host $host;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n}\n}\n</code></pre> <ul> <li>\u76d1\u542chttp\u9ed8\u8ba4\u7684\u7aef\u53e3\u53f780</li> <li>server_name\uff1a\u4e2a\u4eba\u7f51\u7ad9\u57df\u540d</li> <li>\u628a\u8bf7\u6c42\u4ee3\u7406\u5230\u672c\u673a\u76848000\u7aef\u53e3\uff08gunicorn\u542f\u52a8\u670d\u52a1\u6307\u5b9a\u7684\u7aef\u53e3\uff09   \u5269\u4e0bproxy_set_header\u7167\u6284</li> </ul> <p>gunicorn\u548cnginx\u5173\u7cfb\uff1a</p> <p>gunicorn \u53ef\u4ee5\u5355\u72ec\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u751f\u4ea7\u73af\u5883\u4e00\u822c\u4e0d\u8fd9\u6837\u505a\u3002\u9996\u5148\u9759\u6001\u8d44\u6e90\uff08jscssimg\uff09\u4f1a\u5360\u7528\u4e0d\u5c11\u7684\u8bf7\u6c42\u8d44\u6e90\uff0c\u800c\u5bf9\u4e8e gunicorn \u6765\u8bb2\u5b83\u672c\u8eab\u66f4\u5e94\u8be5\u5173\u6ce8\u5b9e\u9645\u4e1a\u52a1\u7684\u8bf7\u6c42\u4e0e\u5904\u7406\u800c\u4e0d\u5e94\u8be5\u628a\u8d44\u6e90\u6d6a\u8d39\u5728\u9759\u6001\u8d44\u6e90\u8bf7\u6c42\u4e0a\uff1b\u6b64\u5916\uff0c\u5355\u72ec\u8fd0\u884c gunicorn \u662f\u6ca1\u6709\u529e\u6cd5\u8d77\u591a\u4e2a\u8fdb\u7a0b\u591a\u4e2a\u7aef\u53e3\u6765\u8d1f\u8f7d\u5747\u8861\u7684\u3002</p> <p>nginx \u7684\u4f5c\u7528\u5c31\u662f\u5f25\u8865\u4ee5\u4e0a\u95ee\u9898\uff0c\u9996\u5148\u4f5c\u4e3a\u524d\u7aef\u670d\u52a1\u5668\u5b83\u53ef\u4ee5\u5904\u7406\u4e00\u5207\u9759\u6001\u6587\u4ef6\u8bf7\u6c42\uff0c\u6b64\u65f6 gunicorn \u4f5c\u4e3a\u540e\u7aef\u670d\u52a1\u5668\uff0cnginx \u5c06\u4f1a\u628a\u52a8\u6001\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u540e\u7aef\u670d\u52a1\u5668\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8d77\u591a\u4e2a gunicorn \u8fdb\u7a0b\uff0c\u7136\u540e\u8ba9 nginx \u4f5c\u5747\u8861\u8d1f\u8f7d\u8f6c\u53d1\u8bf7\u6c42\u7ed9\u591a\u4e2a gunicorn \u8fdb\u7a0b\u4ece\u800c\u63d0\u5347\u670d\u52a1\u5668\u5904\u7406\u6548\u7387\u4e0e\u5904\u7406\u80fd\u529b\u3002\u6700\u540e\uff0cnginx \u8fd8\u53ef\u4ee5\u914d\u7f6e\u5f88\u591a\u5b89\u5168\u76f8\u5173\u3001\u8ba4\u8bc1\u76f8\u5173\u7b49\u5f88\u591a\u5904\u7406\uff0c\u53ef\u4ee5\u8ba9\u4f60\u7684\u7f51\u7ad9\u66f4\u4e13\u6ce8\u4e1a\u52a1\u7684\u7f16\u5199\uff0c\u628a\u4e00\u4e9b\u8f6c\u53d1\u89c4\u5219\u7b49\u5176\u5b83\u4e1a\u52a1\u65e0\u5173\u7684\u4e8b\u60c5\u4ea4\u7ed9 nginx \u505a\u3002</p> <p>\u914d\u7f6e\u597d\u540e\u6253\u5f00\u672c\u5730\u6d4f\u89c8\u5668\uff0c\u8f93\u5165\u57df\u540d\uff0c\u5e94\u8be5\u5c31\u80fd\u8bbf\u95ee\u4e86\u3002</p>"},{"location":"back-end/python/centos_flask/#6supervisor","title":"6.supervisor","text":"<p>\u5982\u679c\u4f60\u9700\u8981\u8fdb\u7a0b\u4e00\u76f4\u6267\u884c\uff0c\u82e5\u8be5\u8fdb\u7a0b\u56e0\u5404\u79cd\u539f\u56e0\u4e2d\u65ad\uff0c\u4e5f\u4f1a\u81ea\u52a8\u91cd\u542f\u7684\u8bdd\uff0csupervisor\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002 supervisor\u7ba1\u7406\u8fdb\u7a0b\uff0c\u662f\u901a\u8fc7fork/exec\u7684\u65b9\u5f0f\u5c06\u8fd9\u4e9b\u88ab\u7ba1\u7406\u7684\u8fdb\u7a0b\u5f53\u4f5csupervisor\u7684\u5b50\u8fdb\u7a0b\u6765\u542f\u52a8\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5c06\u8981\u7ba1\u7406\u8fdb\u7a0b\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8def\u5f84\u6dfb\u52a0\u5230supervisor\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u5c31\u597d\u4e86\u3002\u6b64\u65f6\u88ab\u7ba1\u7406\u8fdb\u7a0b\u88ab\u89c6\u4e3asupervisor\u7684\u5b50\u8fdb\u7a0b\uff0c\u82e5\u8be5\u5b50\u8fdb\u7a0b\u5f02\u5e38\u7ec8\u7aef\uff0c\u5219\u7236\u8fdb\u7a0b\u53ef\u4ee5\u51c6\u786e\u7684\u83b7\u53d6\u5b50\u8fdb\u7a0b\u5f02\u5e38\u7ec8\u7aef\u7684\u4fe1\u606f\uff0c\u901a\u8fc7\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6eautostart=true\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u5f02\u5e38\u4e2d\u65ad\u7684\u5b50\u8fdb\u7a0b\u7684\u81ea\u52a8\u91cd\u542f\u3002</p>"},{"location":"back-end/python/centos_flask/#supervisor","title":"\u5b89\u88c5 supervisor","text":"<pre><code>$ pip install supervisor\n$ echo_supervisord_conf &gt; supervisor.conf   # \u751f\u6210 supervisor \u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\n$ vim supervisor.conf                       # \u4fee\u6539 supervisor \u914d\u7f6e\u6587\u4ef6\uff0c\u6dfb\u52a0 gunicorn \u8fdb\u7a0b\u7ba1\u7406\n</code></pre> <p>\u5728blog supervisor.conf \u914d\u7f6e\u6587\u4ef6\u5e95\u90e8\u6dfb\u52a0 (\u6ce8\u610f\u6211\u7684\u5de5\u4f5c\u8def\u5f84\u662f<code>www/home/blog/</code>)</p> <pre><code>[program:blog]\ncommand=/home/www/blog/venv/bin/gunicorn -w4 -b0.0.0.0:8000 wsgi:application    ;supervisor\u542f\u52a8\u547d\u4ee4\ndirectory=/home/www/blog                                                 ; \u9879\u76ee\u7684\u6587\u4ef6\u5939\u8def\u5f84\nstartsecs=0                                                               ; \u542f\u52a8\u65f6\u95f4\nstopwaitsecs=0                                                            ; \u7ec8\u6b62\u7b49\u5f85\u65f6\u95f4\nautostart=false                                                           ; \u662f\u5426\u81ea\u52a8\u542f\u52a8\nautorestart=false                                                         ; \u662f\u5426\u81ea\u52a8\u91cd\u542f\nstdout_logfile=/home/www/blog/logs/gunicorn.log                            ; log \u65e5\u5fd7\nstderr_logfile=/home/www/blog/logs/gunicorn.err                            ; \u9519\u8bef\u65e5\u5fd7\n</code></pre> <p>\u4f7f\u7528 supervsior \u542f\u52a8 gunicorn</p> <pre><code>$ sudo supervisord -c supervisor.conf  $ sudo supervisorctl start blog\n</code></pre> <p>\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u8f93\u5165\u914d\u7f6e\u7684\u5730\u5740\u5373\u53ef\u8bbf\u95ee\u7f51\u7ad9\u3002</p>"},{"location":"back-end/python/centos_flask/#7-fabric","title":"7. fabric","text":"<p>\u6700\u540e\u4e00\u6b65\uff0c\u6211\u4eec\u4f7f\u7528fabric\u5b9e\u73b0\u8fdc\u7a0b\u64cd\u4f5c\u548c\u90e8\u7f72\u3002Fabric \u662f\u4e00\u4e2a Python \u4e0b\u7c7b\u4f3c\u4e8e Makefiles \u7684\u5de5\u5177\uff0c\u4f46\u662f\u80fd\u591f\u5728\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u6267\u884c\u547d\u4ee4\u3002</p>"},{"location":"back-end/python/centos_flask/#fabric","title":"\u5b89\u88c5 fabric","text":"<pre><code>pip install fabric\n</code></pre> <p>\u5728 blog \u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2afabfile.py\u6587\u4ef6</p> <pre><code>import os\nfrom fabric.api import local, env, run, cd, sudo, prefix, settings, execute, task, put\nfrom fabric.contrib.files import exists\nfrom contextlib import contextmanager\nenv.hosts = ['204.152.201.69']\nenv.user = 'root'\nenv.password = '****'#\u5bc6\u7801\nenv.group = \"root\"\nDEPLOY_DIR = '/home/www/blog'\nVENV_DIR = os.path.join(DEPLOY_DIR, 'venv')\nVENV_PATH = os.path.join(VENV_DIR, 'bin/activate')\n@contextmanager\ndef source_virtualenv():\nwith prefix(\"source {}\".format(VENV_PATH)):\nyield\ndef update():\nwith cd('/home/www/blog/'):\nsudo('git pull')\ndef restart():\nwith cd(DEPLOY_DIR):\nif not exists(VENV_DIR):\nrun(\"virtualenv {}\".format(VENV_DIR))\nwith settings(warn_only=True):\nwith source_virtualenv():\nrun(\"pip install -r {}/requirements.txt\".format(DEPLOY_DIR))\nwith settings(warn_only=True):\nstop_result = sudo(\"supervisorctl -c {}/supervisor.conf stop all\".format(DEPLOY_DIR))\nif not stop_result.failed:\nkill_result = sudo(\"pkill supervisor\")\nif not kill_result:\nsudo(\"supervisord -c {}/supervisor.conf\".format(DEPLOY_DIR))\nsudo(\"supervisorctl -c {}/supervisor.conf reload\".format(DEPLOY_DIR))\nsudo(\"supervisorctl -c {}/supervisor.conf status\".format(DEPLOY_DIR))\nsudo(\"supervisorctl -c {}/supervisor.conf start all\".format(DEPLOY_DIR))\n@task\ndef deploy():\nexecute(update)\nexecute(restart)\n</code></pre> <p>\u73b0\u5728\u4ee3\u7801\u5982\u679c\u66f4\u65b0\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u672c\u5730\u6267\u884c\u8fdc\u7a0b\u90e8\u7f72\u4e86</p> <pre><code>fab deploy\n</code></pre>"},{"location":"back-end/python/pycharm_remote_debug/","title":"Pycharm\u8fdc\u7a0b\u8c03\u8bd5","text":""},{"location":"back-end/python/pycharm_remote_debug/#_1","title":"\u52a8\u673a","text":"<ol> <li>\u4e00\u4e9bbug\u7531\u4e8e\u672c\u5730\u73af\u5883\u548c\u7ebf\u4e0a\u73af\u5883\u7684\u4e0d\u4e00\u81f4\u53ef\u80fd\u5bfc\u81f4\u672c\u5730\u65e0\u6cd5\u590d\u73b0</li> <li>\u672c\u5730\u4f9d\u8d56\u548c\u7ebf\u4e0a\u4f9d\u8d56\u7248\u672c\u4e0d\u4e00\u81f4\u4e5f\u53ef\u4ee5\u5bfc\u81f4\u4e00\u4e9b\u95ee\u9898</li> <li>\u6709\u65f6\u4e00\u4e9bbug\u8ddf\u6570\u636e\u76f8\u5173\uff0c\u672c\u5730\u6570\u636e\u65e0\u6cd5\u548c\u7ebf\u4e0a\u6570\u636e\u4e00\u81f4</li> <li>\u6709\u4e9b\u4e09\u65b9\u5e73\u53f0\u4f1a\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u5408\u6cd5\u6027\u6216\u8005\u5f02\u6b65\u56de\u8c03\u7ed3\u679c\uff0c\u5982\u5fae\u4fe1\u652f\u4ed8\uff0c\u8fd9\u65f6\u5019\u672c\u5730\u65e0\u6cd5\u6d4b\u8bd5</li> </ol> <p>\u5982\u4e0a\u6240\u8bc9\uff0c\u8981\u662f\u6709\u4e00\u4e2a\u5f88\u65b9\u4fbf\u8c03\u8bd5\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u65b9\u6cd5\uff0c\u5c82\u4e0d\u7f8e\u54c9\u3002\u901a\u8fc7PyCharm\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b9e\u73b0\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u4e0b\u9762\u8be6\u7ec6\u4ecb\u7ecd\u4e0bPyCharm\u8fd9\u4e2a\u725b\u53c9\u7684\u529f\u80fd\u3002</p>"},{"location":"back-end/python/pycharm_remote_debug/#_2","title":"\u6dfb\u52a0\u8fdc\u7a0b\u90e8\u7f72","text":"<ol> <li> <p>\u6253\u5f00pycharm\uff0ctools\u2192Deployment\u2192Configuration </p> </li> <li> <p>\u70b9\u51fb\u5de6\u8fb9\u201c+\u201d\u6dfb\u52a0\u8fdc\u7a0b\u670d\u52a1\u5668\uff0c\u968f\u4fbf\u8d77\u4e2a\u540d\u5b57\uff0c\u9009\u62e9SFTP </p> </li> <li> <p>\u914d\u7f6econnection </p> </li> <li> <p>\u914d\u7f6eMappings </p> </li> <li> <p>\u914d\u7f6eExcluded Paths\uff08\u53ef\u9009\uff09 </p> </li> </ol> <p>\u6700\u540e\u70b9\u51fbOK\u5373\u53ef</p> <p>\u518d\u6b21\u6253\u5f00\u90e8\u7f72\u9009\u9879\uff0c\u53ef\u4ee5\u53d1\u73b0\u73b0\u5728\u53ef\u4ee5\u76f4\u63a5\u90e8\u7f72\u4ee3\u7801\u5230\u670d\u52a1\u5668\u4e86\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d\u5e26\u4ee3\u7801\u5230\u672c\u5730\uff0c\u540c\u65f6\u81ea\u52a8\u4e0a\u4f20\uff08Automatic Upload\uff09\u662f\u9ed8\u8ba4\u52fe\u9009\u7684\uff0c\u6211\u4e00\u822c\u4f1a\u628a\u5b83\u53bb\u6389\uff0c\u9632\u6b62\u4e00\u4e9b\u672c\u5730\u6d4b\u8bd5\u4ee3\u7801\u4e0a\u4f20\u4e0a\u53bb</p> <p></p> <p>\u65b0\u589e\u4e00\u4e2a\u6587\u4ef6\uff0c\u67e5\u770bdeployment \u9009\u9879\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u4e0a\u4f20\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\u4e86</p> <p></p>"},{"location":"back-end/python/pycharm_remote_debug/#_3","title":"\u6dfb\u52a0\u8fdc\u7a0b\u89e3\u91ca\u5668","text":"<p>\u8fdc\u7a0b\u90e8\u7f72\u4ec5\u4ec5\u53ea\u662f\u540c\u6b65\u548c\u62f7\u8d1d\u6587\u4ef6\uff0c\u8981\u771f\u6b63\u5b9e\u73b0\u8fdc\u7a0b\u8c03\u8bd5\u8fd8\u9700\u8981\u914d\u7f6e\u8fdc\u7a0b\u89e3\u91ca\u5668</p> <ol> <li> <p>\u8bbe\u7f6e\u9875\u9762\u627e\u5230\u201cProject Interpreter\u201d \u2192 \u8bbe\u7f6e\u2192Add </p> </li> <li> <p>\u9009\u62e9\u201cSSH Interpreter\u201d \u2192 \"Existing server configuration\" \u2192 \u9009\u62e9\u521a\u624d\u521b\u5efa\u7684\u90e8\u7f72\u914d\u7f6e\uff0c\u4f7f\u7528\u2018\u2019Create\u201c\u6216\u8005\u201dMove\u201c \u90fdOK </p> </li> <li> <p>\u70b9\u51fb\u4e0b\u4e00\u6b65\uff0c\u8fd9\u65f6\u4f1a\u8fdb\u884c\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\uff0c\u7a0d\u7b49\u4e00\u4f1a\uff0c\u4f1a\u51fa\u73b0\u4ee5\u4e0b\u754c\u9762\uff0c\u7a0d\u5fae\u914d\u7f6e\u4e0b\uff0c\u70b9\u51fb\u201cFinish\u201d\u5373\u53ef </p> </li> </ol> <p>\u6700\u540e\u4f7f\u7528\u8fdc\u7a0b\u89e3\u91ca\u5668,\u70b9\u51fb\u201cOK\u201d\uff0c\u8fd4\u56de\u5230\u9879\u76ee\u754c\u9762\uff0c\u7b49\u5f85\u540c\u6b65\u5b8c\u6210\u5373\u53ef </p>"},{"location":"back-end/python/pycharm_remote_debug/#_4","title":"\u8fdc\u7a0b\u8c03\u8bd5","text":"<p>\u8fd9\u91cc\u6839\u636e\u81ea\u5df1\u7684\u5177\u4f53\u9879\u76ee\u60c5\u51b5\u800c\u5b9a\uff0c\u6211\u8fd9\u91cc\u662f Flask+\u963f\u91cc\u4e91+nginx+\u8fd0\u884c\u811a\u672c \u7684\u4e00\u4e2a\u4f8b\u5b50</p> <ol> <li>\u65b0\u589e\u4e00\u4e2a run configuration  </li> <li> <p>\u8fd0\u884c\u811a\u672c\u4ee3\u7801\u5982\u4e0b\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e868000\u7684\u7aef\u53e3 </p> <p>Host\u8981\u914d\u7f6e\u4e3a0.0.0.0</p> </li> <li> <p>nginx \u914d\u7f6e8000 \u7aef\u53e3 <pre><code>    server {\nlisten       8000 ;\nlisten       [::]:8000 ;\nserver_name  _;\nroot         /usr/share/nginx/html;\naccess_log  /var/log/nginx/access_8000.log  main;\nerror_log  /var/log/nginx/error_8000.log;\n# Load configuration files for the default server block.\ninclude /etc/nginx/default.d/*.conf;\nlocation / {\nproxy_pass http://127.0.0.1:8000;\nproxy_set_header Host $host;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n}\nerror_page 404 /404.html;\nlocation = /40x.html {\n}\nerror_page 500 502 503 504 /50x.html;\nlocation = /50x.html {\n}\n}\n</code></pre></p> </li> <li> <p>\u8981\u662f\u4f7f\u7528\u963f\u91cc\u4e91\uff0c\u8fd8\u9700\u8981\u5b89\u5168\u7ec4\u5f00\u653e8000 \u7aef\u53e3</p> </li> <li>\u65ad\u70b9\u8fd0\u884c</li> </ol> <p></p> <p> 6. \u51fa\u73b0\u4e0a\u56fe\u6240\u793a\u7684\u65f6\u5019\uff0c\u606d\u559c\u4f60\uff0c\u4f60\u5df2\u7ecf\u53ef\u4ee5\u65ad\u70b9\u8c03\u8bd5\u8fdc\u7a0b\u670d\u52a1\u5668\u4e86</p> <p>\u6211\u4eec\u6253\u4e00\u4e2a\u65ad\u70b9\uff0c\u7136\u540e\u8bd5\u7740\u8bbf\u95ee\u4e00\u4e2aAPI\u670d\u52a1\uff1ahttp://xx.xx.xx.xx:8000/api/pages/bookstore</p> <p>\u5b8c\u7f8e\u65ad\u4e0a</p> <p></p>"},{"location":"back-end/python/pycharm_remote_debug/#_5","title":"\u8865\u5145\u8bf4\u660e","text":"<p>\u4e0d\u5efa\u8bae\u5728\u6b63\u5f0f\u670d\u52a1\u5668\u4f7f\u7528\u8fd9\u4e2a\u529f\u80fd\uff0c\u53ef\u4ee5\u5728\u6d4b\u8bd5\u670d\u52a1\u5668\u4f7f\u7528</p>"},{"location":"back-end/python/python_func_time/","title":"python\u6027\u80fd\u4f18\u5316\u4e4b\u51fd\u6570\u6267\u884c\u65f6\u95f4\u5206\u6790","text":"<p>\u6700\u8fd1\u53d1\u73b0\u9879\u76eeAPI\u8bf7\u6c42\u6bd4\u8f83\u6162\uff0c\u901a\u8fc7\u6293\u5305\u53d1\u73b0\u4e3b\u8981\u662fresponse\u65f6\u95f4\u592a\u957f\uff0c\u4e8e\u662f\u5c31\u5f00\u59cb\u8fdb\u884c\u4f18\u5316\u5de5\u4f5c\u3002\u4f18\u5316\u5de5\u4f5c\u7684\u5173\u952e\u4e00\u6b65\u662f \u5b9a\u4f4d\u51fa\u95ee\u9898\u7684\u74f6\u9888 \uff0c\u5bf9\u4e8e\u4f18\u5316\u901f\u5ea6\u6765\u8bf4\uff0c\u4ece\u4f18\u5316\u51fd\u6570\u6267\u884c\u65f6\u95f4\u8fd9\u4e2a\u7ef4\u5ea6\u53bb\u5207\u5165\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002</p> <p>\u672c\u6587\u4fa7\u91cd\u5206\u6790\uff0c\u4e0d\u5c55\u5f00\u5982\u4f55\u4f18\u5316</p>"},{"location":"back-end/python/python_func_time/#_1","title":"\u5229\u5668","text":"<p>\u5de5\u6b32\u5584\u5176\u4e8b\uff0c\u5fc5\u5148\u5229\u5176\u5668\uff0c\u6211\u4eec\u9700\u8981\u4e00\u5957\u65b9\u4fbf\u9ad8\u6548\u7684\u5de5\u5177\u8bb0\u5f55\u51fd\u6570\u8fd0\u884c\u65f6\u95f4\u3002\u8bf4\u662f\u4e00\u5957\u5de5\u5177\uff0c\u4f46\u5bf9\u4e8e\u4e00\u4e2a\u7b80\u5355\u9879\u76ee\u6216\u8005\u65e5\u5e38\u5f00\u53d1\u6765\u8bf4\uff0c\u5b9e\u73b0\u4e00\u4e2a\u5de5\u5177\u7c7b\u8db3\u77e3\uff0c\u7531\u4e8e\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u4e0a\u4ee3\u7801\uff1a</p> <pre><code>from functools import wraps\nimport cProfile\nfrom line_profiler import LineProfiler\nimport time\ndef func_time(f):\n\"\"\"\n    \u7b80\u5355\u8bb0\u5f55\u6267\u884c\u65f6\u95f4\n    :param f:\n    :return:\n    \"\"\"\n@wraps(f)\ndef wrapper(*args, **kwargs):\nstart = time.time()\nresult = f(*args, **kwargs)\nend = time.time()\nprint f.__name__, 'took', end - start, 'seconds'\nreturn result\nreturn wrapper\ndef func_cprofile(f):\n\"\"\"\n    \u5185\u5efa\u5206\u6790\u5668\n    \"\"\"\n@wraps(f)\ndef wrapper(*args, **kwargs):\nprofile = cProfile.Profile()\ntry:\nprofile.enable()\nresult = f(*args, **kwargs)\nprofile.disable()\nreturn result\nfinally:\nprofile.print_stats(sort='time')\nreturn wrapper\ntry:\nfrom line_profiler import LineProfiler\ndef func_line_time(follow=[]):\n\"\"\"\n        \u6bcf\u884c\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u8be6\u7ec6\u62a5\u544a\n        :param follow: \u5185\u90e8\u8c03\u7528\u65b9\u6cd5\n        :return:\n        \"\"\"\ndef decorate(func):\n@wraps(func)\ndef profiled_func(*args, **kwargs):\ntry:\nprofiler = LineProfiler()\nprofiler.add_function(func)\nfor f in follow:\nprofiler.add_function(f)\nprofiler.enable_by_count()\nreturn func(*args, **kwargs)\nfinally:\nprofiler.print_stats()\nreturn profiled_func\nreturn decorate\nexcept ImportError:\ndef func_line_time(follow=[]):\n\"Helpful if you accidentally leave in production!\"\ndef decorate(func):\n@wraps(func)\ndef nothing(*args, **kwargs):\nreturn func(*args, **kwargs)\nreturn nothing\nreturn decorate\n</code></pre> <p>\u539f\u59cb\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003gist</p> <p>\u5982\u4e0b\uff0c\u5b9e\u73b0\u4e863\u4e2a\u88c5\u9970\u5668\u51fd\u6570<code>func_time</code>,<code>func_cprofile</code>,<code>func_line_time</code>,\u5206\u522b\u5bf9\u5e94</p> <ol> <li>\u7b80\u5355\u8f93\u51fa\u51fd\u6570\u7684\u6267\u884c\u65f6\u95f4</li> <li>\u5229\u7528python\u81ea\u5e26\u7684\u5185\u7f6e\u5206\u6790\u5305<code>cProfile</code> \u5206\u6790\uff0c\u5b83\u4e3b\u8981\u7edf\u8ba1\u51fd\u6570\u8c03\u7528\u4ee5\u53ca\u6bcf\u4e2a\u51fd\u6570\u6240\u5360\u7684cpu\u65f6\u95f4</li> <li>\u5229\u7528<code>line_profiler</code>\u5f00\u6e90\u9879\u76ee,\u5b83\u53ef\u4ee5\u7edf\u8ba1\u6bcf\u884c\u4ee3\u7801\u7684\u6267\u884c\u6b21\u6570\u548c\u6267\u884c\u65f6\u95f4\u3002</li> </ol>"},{"location":"back-end/python/python_func_time/#_2","title":"\u4f7f\u7528\u8bf4\u660e","text":"<p>\u6211\u4eec\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684\u5faa\u73af\u4f8b\u5b50\u6765\u8bf4\u660e\u4e00\u4e0b,</p> <pre><code>def test():\nfor x in range(10000000):\nprint x\n</code></pre> <ul> <li><code>func_time</code></li> </ul> <p>\u5173\u4e8e<code>func_time</code>\u6211\u89c9\u5f97\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u5c31\u662f\u7b80\u5355\u8f93\u51fa\u4e0b\u51fd\u6570\u8c03\u7528\u65f6\u95f4\uff0c\u8fd9\u4e2a\u5728\u6211\u4eec\u7c97\u7565\u7edf\u8ba1\u51fd\u6570\u6267\u884c\u65f6\u95f4\u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528</p> <p>\u5982\u4e0b\uff1a</p> <pre><code>@func_time\ndef test():\nfor x in range(10000000):\nprint x\n# \u8f93\u51fa\ntest took 6.10190296173 seconds\n</code></pre> <ul> <li><code>func_cprofile</code></li> </ul> <p><code>cProfile</code>\u662fpython\u5185\u7f6e\u5305\uff0c\u57fa\u4e8elsprof\u7684\u7528C\u8bed\u8a00\u5b9e\u73b0\u7684\u6269\u5c55\u5e94\u7528\uff0c\u8fd0\u884c\u5f00\u9500\u6bd4\u8f83\u5408\u7406\uff0c\u6ca1\u6709\u5916\u90e8\u4f9d\u8d56\uff0c\u9002\u5408\u505a\u5feb\u901f\u7684\u6982\u8981\u6d4b\u8bd5</p> <p><pre><code>@func_cprofile\ndef test():\nfor x in range(10000000):\nprint x\n# \u8f93\u51fa\n3 function calls in 6.249 seconds\nOrdered by: internal time\nncalls  tottime  percall  cumtime  percall filename:lineno(function)\n1    6.022    6.022    6.249    6.249 test.py:41(test)\n1    0.227    0.227    0.227    0.227 {range}\n1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}\n</code></pre> \u8f93\u51fa\u8bf4\u660e\uff1a</p> <p>\u5355\u4f4d\u4e3a\u79d2</p> <ol> <li>\u7b2c\u4e00\u884c\u544a\u8bc9\u6211\u4eec\u4e00\u5171\u67093\u4e2a\u51fd\u6570\u88ab\u8c03\u7528\u3002</li> </ol> <p>\u6b63\u5e38\u5f00\u53d1\u8fc7\u7a0b\uff0c\u7b2c\u4e00\u884c\u66f4\u591a\u662f\u8f93\u51fa\u7c7b\u4f3c<code>194 function calls (189 primiive calls) in 0.249 seconds</code>\uff0c(189 primiive calls)\u8868\u793a189\u4e2a\u662f\u539f\u751f\uff08primitive\uff09\u8c03\u7528\uff0c\u8868\u660e\u8fd9\u4e9b\u8c03\u7528\u4e0d\u6d89\u53ca\u9012\u5f52</p> <ol> <li> <p>ncalls\u8868\u793a\u51fd\u6570\u7684\u8c03\u7528\u6b21\u6570\uff0c\u5982\u679c\u8fd9\u4e00\u5217\u6709\u4e24\u4e2a\u6570\u503c\uff0c\u8868\u793a\u6709\u9012\u5f52\u8c03\u7528\uff0c\u7b2c\u4e00\u4e2a\u662f\u603b\u8c03\u7528\u6b21\u6570\uff0c\u7b2c\u4e8c\u4e2a\u662f\u539f\u751f\u8c03\u7528\u6b21\u6570\u3002</p> </li> <li> <p>tottime\u662f\u51fd\u6570\u5185\u90e8\u6d88\u8017\u7684\u603b\u65f6\u95f4\uff08\u4e0d\u5305\u62ec\u8c03\u7528\u5176\u4ed6\u51fd\u6570\u7684\u65f6\u95f4\uff09\u3002</p> </li> <li> <p>percall\u662ftottime\u9664\u4ee5ncalls\uff0c\u8868\u793a\u6bcf\u6b21\u8c03\u7528\u5e73\u5747\u6d88\u8017\u65f6\u95f4\u3002</p> </li> <li> <p>cumtime\u662f\u4e4b\u524d\u6240\u6709\u5b50\u51fd\u6570\u6d88\u8017\u65f6\u95f4\u7684\u7d2f\u79ef\u548c\u3002</p> </li> <li> <p>percall\u662fcumtime\u9664\u4ee5\u539f\u751f\u8c03\u7528\u7684\u6570\u91cf\uff0c\u8868\u793a\u8be5\u51fd\u6570\u8c03\u7528\u65f6\uff0c\u6bcf\u4e2a\u539f\u751f\u8c03\u7528\u7684\u5e73\u5747\u6d88\u8017\u65f6\u95f4\u3002</p> </li> <li> <p>filename:lineno(function)\u4e3a\u88ab\u5206\u6790\u51fd\u6570\u6240\u5728\u6587\u4ef6\u540d\u3001\u884c\u53f7\u3001\u51fd\u6570\u540d\u3002</p> </li> <li> <p><code>func_line_time</code></p> </li> </ol> <p><code>line_profiler</code>\u53ef\u4ee5\u751f\u6210\u975e\u5e38\u76f4\u63a5\u548c\u8be6\u7ec6\u7684\u62a5\u544a\uff0c\u4f46\u5b83\u7cfb\u7edf\u5f00\u9500\u5f88\u5927\uff0c\u4f1a\u6bd4\u5b9e\u9645\u6267\u884c\u65f6\u95f4\u6162\u4e00\u4e2a\u6570\u91cf\u7ea7</p> <pre><code>@func_line_time()\ndef test():\nfor x in range(10000000):\nprint x\n# \u8f93\u51fa\nTimer unit: 1e-06 s\nTotal time: 14.4183 s\nFile: /xx/test.py\nFunction: test at line 41\nLine #      Hits         Time  Per Hit   % Time  Line Contents\n==============================================================\n41                                           @func_line_time()\n42                                           def test():\n43  10000001    4031936.0      0.4     28.0      for x in range(10000000):\n44  10000000   10386347.0      1.0     72.0          print x\n</code></pre> <p>\u8f93\u51fa\u8bf4\u660e\uff1a</p> <p>\u5355\u4f4d\u4e3a\u5fae\u79d2</p> <ol> <li> <p>Total Time\uff1a\u6d4b\u8bd5\u4ee3\u7801\u7684\u603b\u8fd0\u884c\u65f6\u95f4</p> </li> <li> <p>Line:\u4ee3\u7801\u884c\u53f7</p> </li> <li>Hits\uff1a\u8868\u793a\u6bcf\u884c\u4ee3\u7801\u8fd0\u884c\u7684\u6b21\u6570</li> <li>Time\uff1a\u6bcf\u884c\u4ee3\u7801\u8fd0\u884c\u7684\u603b\u65f6\u95f4</li> <li>Per Hits\uff1a\u6bcf\u884c\u4ee3\u7801\u8fd0\u884c\u4e00\u6b21\u7684\u65f6\u95f4</li> <li>% Time\uff1a\u6bcf\u884c\u4ee3\u7801\u8fd0\u884c\u65f6\u95f4\u7684\u767e\u5206\u6bd4</li> </ol>"},{"location":"back-end/python/python_func_time/#_3","title":"\u603b\u7ed3","text":"<p>\u65e5\u5e38\u5f00\u53d1\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>func_time</code>,<code>func_cprofile</code>\u505a\u57fa\u672c\u68c0\u67e5\uff0c\u5b9a\u4f4d\u5927\u81f4\u95ee\u9898\uff0c\u4f7f\u7528<code>func_line_time</code>\u8fdb\u884c\u66f4\u7ec6\u81f4\u7684\u6df1\u5165\u68c0\u67e5\u3002</p> <p>\u6ce8\uff1a<code>func_line_time</code> \u8fd8\u53ef\u4ee5\u68c0\u67e5\u51fd\u6570\u5185\u90e8\u8c03\u7528\u7684\u51fd\u6570\u6267\u884c\u65f6\u95f4\uff0c\u901a\u8fc7<code>follow</code>\u53c2\u6570\u6307\u5b9a\u5bf9\u5e94\u7684\u5185\u90e8\u8c03\u7528\u7684\u51fd\u6570\u58f0\u660e\u5373\u53ef\uff0c\u8be5\u53c2\u6570\u662f\u4e2a\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u68c0\u67e5\u591a\u4e2a\u5185\u90e8\u8c03\u7528\u7684\u51fd\u6570</p>"},{"location":"basic/","title":"\u8ba1\u7b97\u673a\u57fa\u7840","text":""},{"location":"basic/algo/array_algo_1/","title":"\u5b9e\u73b0\u4e00\u4e2a\u652f\u6301\u52a8\u6001\u6269\u5bb9\u7684\u6570\u7ec4","text":""},{"location":"basic/algo/array_algo_1/#_1","title":"\u5b9e\u73b0\u4e00\u4e2a\u652f\u6301\u52a8\u6001\u6269\u5bb9\u7684\u6570\u7ec4","text":"javaKotlin <pre><code>public class ArrayList&lt;T&gt;{\nprivate int size;\nprivate int capacity;\nprivate T[] data;\npublic ArrayList(int capacity){\nthis.capacity = capacity;\nthis.size = 0;\nthis.data = (T[])new Object[capacity];\n}\npublic ArrayList(){\nthis(10);\n}\npublic int size(){\nreturn size;\n}\npublic boolean isEmpty(){\nreturn size == 0;\n}\npublic void add(int index, T e){\nif(index &lt; 0 || index &gt; size){\nthrow new IllegalArgumentException(\"Add failed. Require index &gt;= 0 and index &lt;= size.\");\n}\nif(size == capacity){\nresize(2 * capacity);\n}\nfor(int i = size - 1; i &gt;= index; i--){\ndata[i + 1] = data[i];\n}\ndata[index] = e;\nsize++;\n}\npublic void add(T e){\nadd(size, e);\n}\npublic T get(int index){\nif(index &lt; 0 || index &gt;= size){\nthrow new IllegalArgumentException(\"Get failed. Index is illegal.\");\n}\nreturn data[index];\n}\npublic void set(int index, T e){\nif(index &lt; 0 || index &gt;= size){\nthrow new IllegalArgumentException(\"Set failed. Index is illegal.\");\n}\ndata[index] = e;\n}\npublic boolean contains(T e){\nfor(int i = 0; i &lt; size; i++){\nif(data[i].equals(e)){\nreturn true;\n}\n}\nreturn false;\n}\npublic int index(T e){\nfor(int i = 0; i &lt; size; i++){\nif(data[i].equals(e)){\nreturn i;\n}\n}\nreturn -1;\n}\npublic T remove(int index){\nif(index &lt; 0 || index &gt;= size){\nthrow new IllegalArgumentException(\"Remove failed. Index is illegal.\");\n}\nT ret = data[index];\nfor(int i = index + 1; i &lt; size; i++){\ndata[i - 1] = data[i];\n}\nsize--;\ndata[size] = null;\nif(size == capacity / 4 &amp;&amp; capacity / 2 != 0){\nresize(capacity / 2);\n}\nreturn ret;\n}\npublic void resize(int newCapacity){\nT[] newData = (T[])new Object[newCapacity];\nfor(int i = 0; i &lt; size; i++){\nnewData[i] = data[i];\n}\ndata = newData;\ncapacity = newCapacity;\n}\n}\n</code></pre> <pre><code>/**\n * \u52a8\u6001\u6269\u5bb9\u7684\u6570\u7ec4\n */\nclass DynamicArray {\ncompanion object {\n// \u9ed8\u8ba4\u5bb9\u91cf\nconst val DEFAULT_CAPACITY = 10\n// \u6700\u5927\u5bb9\u91cf\nconst val MAX_CAPACITY = Int.MAX_VALUE\n}\n// \u5f53\u524d\u5df2\u4f7f\u7528\u5927\u5c0f\nprivate var usedSize = 0\n// \u5f53\u524d\u5bb9\u91cf\u5927\u5c0f\nprivate var capacity = 0\n// \u6570\u7ec4\u5bb9\u5668\nprivate var data: Array&lt;Int&gt;\ninit {\nthis.capacity = DEFAULT_CAPACITY\nthis.data = Array(this.capacity) { 0 }\n}\n/**\n     * \u589e\u52a0\u5143\u7d20\n     */\nfun add(value: Int) {\nif (this.usedSize == this.capacity - 1) {\nthis.doubleCapacity()\n}\nthis.data[this.usedSize] = value\n++this.usedSize\n}\n/**\n     * \u79fb\u9664\u5143\u7d20\n     */\nfun remove(value: Int) {\nif (this.usedSize &gt;= 0) {\nvar target = -1\n// \u67e5\u627e\u76ee\u6807\u6240\u5728\u4f4d\u7f6e\nfor (i in 0 until this.usedSize) {\nif (this.data[i] == value) {\ntarget = i\nbreak\n}\n}\n// \u627e\u5230\u4e86\nif (target &gt;= 0) {\nval size = this.usedSize - 1\n// \u628a\u540e\u7eed\u5143\u7d20\u5f80\u524d\u642c\nfor (i in target until size) {\nthis.data[i] = this.data[i + 1]\n}\n// \u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4f4d\u7f6e\u7f6e\u4e3a\u7a7a\nthis.data[size] = 0\n// \u66f4\u65b0\u5df2\u4f7f\u7528\u5927\u5c0f\nthis.usedSize = size\n}\n}\n}\n/**\n     * \u901a\u8fc7\u7d22\u5f15\u8bbe\u7f6e\u5143\u7d20\u7684\u503c\n     */\nfun set(index: Int, value: Int) {\nif (this.checkIndex(index)) {\nthis.data[index] = value\nreturn\n}\nthrow IllegalArgumentException(\"index must be in rang of 0..${this.usedSize}\")\n}\n/**\n     * \u83b7\u53d6\u5143\u7d20\n     */\nfun get(index: Int): Int? {\nif (this.checkIndex(index)) {\nreturn this.data[index]\n}\nthrow IllegalArgumentException(\"index must be in rang of 0..${this.usedSize}\")\n}\n/**\n     * \u83b7\u53d6\u5f53\u524d\u6570\u7ec4\u7684\u5927\u5c0f\n     */\nfun getSize(): Int = this.usedSize\nprivate fun checkIndex(index: Int): Boolean {\nreturn index &gt;= 0 &amp;&amp; index &lt; this.usedSize\n}\n/**\n     * \u6309\u539f\u5bb9\u91cf\u7684\u4e24\u500d\u8fdb\u884c\u6269\u5bb9\n     */\nprivate fun doubleCapacity() {\nif (this.capacity &lt; MAX_CAPACITY) {\nthis.capacity = Math.min(this.capacity * 2, MAX_CAPACITY)\nval newArray = Array(this.capacity) { 0 }\nfor (i in 0 until this.usedSize) {\nnewArray[i] = this.data[i]\n}\nthis.data = newArray\n}\n}\n}\n</code></pre>"},{"location":"basic/algo/array_algo_2/","title":"\u5b9e\u73b0\u4e00\u4e2a\u5927\u5c0f\u56fa\u5b9a\u7684\u6709\u5e8f\u6570\u7ec4\uff0c\u652f\u6301\u52a8\u6001\u589e\u5220\u6539\u64cd\u4f5c","text":""},{"location":"basic/algo/array_algo_2/#_1","title":"\u5b9e\u73b0\u4e00\u4e2a\u5927\u5c0f\u56fa\u5b9a\u7684\u6709\u5e8f\u6570\u7ec4\uff0c\u652f\u6301\u52a8\u6001\u589e\u5220\u6539\u64cd\u4f5c","text":"javakotlin <pre><code>package array;\n/**\n * 1) \u6570\u7ec4\u7684\u63d2\u5165\u3001\u5220\u9664\u3001\u6309\u7167\u4e0b\u6807\u968f\u673a\u8bbf\u95ee\u64cd\u4f5c\uff1b\n * 2\uff09\u6570\u7ec4\u4e2d\u7684\u6570\u636e\u662fint\u7c7b\u578b\u7684\uff1b\n *\n * Author: Zheng\n * modify: xing, Gsealy\n */\npublic class Array {\n//\u5b9a\u4e49\u6574\u578b\u6570\u636edata\u4fdd\u5b58\u6570\u636e\npublic int data[];\n//\u5b9a\u4e49\u6570\u7ec4\u957f\u5ea6\nprivate int n;\n//\u5b9a\u4e49\u4e2d\u5b9e\u9645\u4e2a\u6570\nprivate int count;\n//\u6784\u9020\u65b9\u6cd5\uff0c\u5b9a\u4e49\u6570\u7ec4\u5927\u5c0f\npublic Array(int capacity){\nthis.data = new int[capacity];\nthis.n = capacity;\nthis.count=0;//\u4e00\u5f00\u59cb\u4e00\u4e2a\u6570\u90fd\u6ca1\u6709\u5b58\u6240\u4ee5\u4e3a0\n}\n//\u6839\u636e\u7d22\u5f15\uff0c\u627e\u5230\u6570\u636e\u4e2d\u7684\u5143\u7d20\u5e76\u8fd4\u56de\npublic int find(int index){\nif (index&lt;0 || index&gt;=count) return -1;\nreturn data[index];\n}\n//\u63d2\u5165\u5143\u7d20:\u5934\u90e8\u63d2\u5165\uff0c\u5c3e\u90e8\u63d2\u5165\npublic boolean insert(int index, int value){\n//\u6570\u7ec4\u4e2d\u65e0\u5143\u7d20 \n//if (index == count &amp;&amp; count == 0) {\n//    data[index] = value;\n//    ++count;\n//    return true;\n//}\n// \u6570\u7ec4\u7a7a\u95f4\u5df2\u6ee1\nif (count == n) {\nSystem.out.println(\"\u6ca1\u6709\u53ef\u63d2\u5165\u7684\u4f4d\u7f6e\");\nreturn false;\n}\n// \u5982\u679ccount\u8fd8\u6ca1\u6ee1\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u63d2\u5165\u6570\u636e\u5230\u6570\u7ec4\u4e2d\n// \u4f4d\u7f6e\u4e0d\u5408\u6cd5\nif (index &lt; 0||index &gt; count ) {\nSystem.out.println(\"\u4f4d\u7f6e\u4e0d\u5408\u6cd5\");\nreturn false;\n}\n// \u4f4d\u7f6e\u5408\u6cd5\nfor( int i = count; i &gt; index; --i){\ndata[i] = data[i - 1];\n}\ndata[index] = value;\n++count;\nreturn true;\n}\n//\u6839\u636e\u7d22\u5f15\uff0c\u5220\u9664\u6570\u7ec4\u4e2d\u5143\u7d20\npublic boolean delete(int index){\nif (index&lt;0 || index &gt;=count) return false;\n//\u4ece\u5220\u9664\u4f4d\u7f6e\u5f00\u59cb\uff0c\u5c06\u540e\u9762\u7684\u5143\u7d20\u5411\u524d\u79fb\u52a8\u4e00\u4f4d\nfor (int i=index+1; i&lt;count; ++i){\ndata[i-1] = data[i];\n}\n//\u5220\u9664\u6570\u7ec4\u672b\u5c3e\u5143\u7d20  \u8fd9\u6bb5\u4ee3\u7801\u4e0d\u9700\u8981\u4e5f\u53ef\u4ee5\n/*int[] arr = new int[count-1];\n        for (int i=0; i&lt;count-1;i++){\n            arr[i] = data[i];\n        }\n        this.data = arr;*/\n--count;\nreturn true;\n}\npublic void printAll() {\nfor (int i = 0; i &lt; count; ++i) {\nSystem.out.print(data[i] + \" \");\n}\nSystem.out.println();\n}\npublic static void main(String[] args) {\nArray array = new Array(5);\narray.printAll();\narray.insert(0, 3);\narray.insert(0, 4);\narray.insert(1, 5);\narray.insert(3, 9);\narray.insert(3, 10);\n//array.insert(3, 11);\narray.printAll();\n}\n}\n</code></pre> <pre><code>import kotlin.Array\n/**\n * 1) \u6570\u7ec4\u7684\u63d2\u5165\u3001\u5220\u9664\u3001\u6309\u7167\u4e0b\u6807\u968f\u673a\u8bbf\u95ee\u64cd\u4f5c\uff1b\n * 2\uff09\u6570\u7ec4\u4e2d\u7684\u6570\u636e\u662fint\u7c7b\u578b\u7684\uff1b\n *\n * Author: Zackratos\n */\nclass ArrayKt constructor(private val capacity: Int) {\n// \u5b9a\u4e49\u6574\u578b\u6570\u636edata\u4fdd\u5b58\u6570\u636e\nprivate val data: IntArray = IntArray(capacity)\n// \u5b9a\u4e49\u6570\u7ec4\u4e2d\u5b9e\u9645\u4e2a\u6570\nprivate var count: Int = 0\ncompanion object {\n@JvmStatic\nfun main(args: Array&lt;String&gt;) {\nval array = ArrayKt(5)\narray.printAll()\narray.insert(0, 3)\narray.insert(0, 4)\narray.insert(1, 5)\narray.insert(3, 9)\narray.insert(3, 10)\narray.printAll()\n}\n}\n// \u6839\u636e\u7d22\u5f15\uff0c\u627e\u5230\u6570\u636e\u4e2d\u7684\u5143\u7d20\u5e76\u8fd4\u56de\nfun find(index: Int): Int {\nif (index !in 0..(count - 1)) return -1\nreturn data[index]\n}\n// \u63d2\u5165\u5143\u7d20\uff1a\u5934\u90e8\u63d2\u5165\uff0c\u5c3e\u90e8\u63d2\u5165\nfun insert(index: Int, value: Int): Boolean {\n// \u6570\u7ec4\u7a7a\u95f4\u5df2\u6ee1\nif (count == capacity) {\nSystem.out.println(\"\u6ca1\u6709\u53ef\u63d2\u5165\u7684\u4f4d\u7f6e\")\nreturn false\n}\n// \u5982\u679ccount\u8fd8\u6ca1\u6ee1\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u63d2\u5165\u6570\u636e\u5230\u6570\u7ec4\u4e2d\n// \u4f4d\u7f6e\u4e0d\u5408\u6cd5\nif (index !in 0..count) {\nSystem.out.println(\"\u4f4d\u7f6e\u4e0d\u5408\u6cd5\")\nreturn false\n}\n// \u4f4d\u7f6e\u5408\u6cd5\n(count downTo index + 1).forEach {\ndata[it] = data[it - 1]\n}\ndata[index] = value\n++count\nreturn true\n}\n// \u6839\u636e\u7d22\u5f15\uff0c\u5220\u9664\u6570\u7ec4\u4e2d\u5143\u7d20\nfun delete(index: Int): Boolean {\nif (index !in 0..(count - 1)) return false\n(index + 1 until count).forEach {\ndata[it - 1] = data[it]\n}\n--count\nreturn true\n}\nfun printAll() {\n(0 until count).forEach {\nSystem.out.println(\"${data[it]} \")\n}\n}\n}\n</code></pre>"},{"location":"basic/algo/array_algo_3/","title":"\u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u6570\u7ec4","text":""},{"location":"basic/algo/array_algo_3/#1","title":"1. \u9898\u76ee","text":"<p>leetcode\u94fe\u63a5</p> <p>\u7ed9\u4f60\u4e24\u4e2a\u6309 \u975e\u9012\u51cf\u987a\u5e8f \u6392\u5217\u7684\u6574\u6570\u6570\u7ec4\u00a0<code>nums1</code> \u548c<code>nums2</code>\uff0c\u53e6\u6709\u4e24\u4e2a\u6574\u6570 <code>m</code> \u548c <code>n</code> \uff0c\u5206\u522b\u8868\u793a <code>nums1</code> \u548c <code>nums2</code>\u4e2d\u7684\u5143\u7d20\u6570\u76ee\u3002</p> <p>\u8bf7\u4f60 \u5408\u5e76 <code>nums2</code> \u5230 <code>nums1</code> \u4e2d\uff0c\u4f7f\u5408\u5e76\u540e\u7684\u6570\u7ec4\u540c\u6837\u6309 \u975e\u9012\u51cf\u987a\u5e8f \u6392\u5217\u3002</p> <p>\u6ce8\u610f\uff1a\u6700\u7ec8\uff0c\u5408\u5e76\u540e\u6570\u7ec4\u4e0d\u5e94\u7531\u51fd\u6570\u8fd4\u56de\uff0c\u800c\u662f\u5b58\u50a8\u5728\u6570\u7ec4 <code>nums1</code> \u4e2d\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c<code>nums1</code> \u7684\u521d\u59cb\u957f\u5ea6\u4e3a <code>m + n</code>\uff0c\u5176\u4e2d\u524d <code>m</code> \u4e2a\u5143\u7d20\u8868\u793a\u5e94\u5408\u5e76\u7684\u5143\u7d20\uff0c\u540e <code>n</code> \u4e2a\u5143\u7d20\u4e3a <code>0</code> \uff0c\u5e94\u5ffd\u7565\u3002<code>nums2</code> \u7684\u957f\u5ea6\u4e3a <code>n</code> \u3002</p> \u793a\u4f8b 1\uff1a\u793a\u4f8b 2\uff1a\u793a\u4f8b 3\uff1a <pre><code>\u8f93\u5165\uff1anums1 = [1,2,3,0,0,0], m = 3, nums2 = [2,5,6], n = 3\n\u8f93\u51fa\uff1a[1,2,2,3,5,6]\n\u89e3\u91ca\uff1a\u9700\u8981\u5408\u5e76 [1,2,3] \u548c [2,5,6] \u3002\n\u5408\u5e76\u7ed3\u679c\u662f [1,2,2,3,5,6] \n</code></pre> <pre><code>\u8f93\u5165\uff1anums1 = [1], m = 1, nums2 = [], n = 0\n\u8f93\u51fa\uff1a[1]\n\u89e3\u91ca\uff1a\u9700\u8981\u5408\u5e76 [1] \u548c [] \u3002\n\u5408\u5e76\u7ed3\u679c\u662f [1] \u3002\n</code></pre> <pre><code>\u8f93\u5165\uff1anums1 = [0], m = 0, nums2 = [1], n = 1\n\u8f93\u51fa\uff1a[1]\n\u89e3\u91ca\uff1a\u9700\u8981\u5408\u5e76\u7684\u6570\u7ec4\u662f [] \u548c [1] \u3002\n\u5408\u5e76\u7ed3\u679c\u662f [1] \u3002\n\u6ce8\u610f\uff0c\u56e0\u4e3a m = 0 \uff0c\u6240\u4ee5 nums1 \u4e2d\u6ca1\u6709\u5143\u7d20\u3002nums1 \u4e2d\u4ec5\u5b58\u7684 0 \u4ec5\u4ec5\u662f\u4e3a\u4e86\u786e\u4fdd\u5408\u5e76\u7ed3\u679c\u53ef\u4ee5\u987a\u5229\u5b58\u653e\u5230 nums1 \u4e2d\u3002\n</code></pre> <p>\u63d0\u793a\uff1a</p> <ul> <li>nums1.length == m + n</li> <li>nums2.length == n</li> <li>0 &lt;= m, n &lt;= 200</li> <li>1 &lt;= m + n &lt;= 200</li> <li>-109 &lt;= nums1[i], nums2[j] &lt;= 109</li> </ul> <p>\u8fdb\u9636\uff1a\u4f60\u53ef\u4ee5\u8bbe\u8ba1\u5b9e\u73b0\u4e00\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(m + n) \u7684\u7b97\u6cd5\u89e3\u51b3\u6b64\u95ee\u9898\u5417\uff1f</p>"},{"location":"basic/algo/array_algo_3/#2","title":"2. \u9898\u89e3","text":""},{"location":"basic/algo/array_algo_3/#21","title":"2.1 \u65b9\u6cd5\u4e00\uff1a\u76f4\u63a5\u5408\u5e76\u540e\u6392\u5e8f","text":"<p>\u7b97\u6cd5</p> <p>\u6700\u76f4\u89c2\u7684\u65b9\u6cd5\u662f\u5148\u5c06\u6570\u7ec4<code>nums2</code> \u653e\u8fdb\u6570\u7ec4<code>nums1</code> \u7684\u5c3e\u90e8\uff0c\u7136\u540e\u76f4\u63a5\u5bf9\u6574\u4e2a\u6570\u7ec4\u8fdb\u884c\u6392\u5e8f\u3002</p> javac++ <pre><code>class Solution {\npublic void merge(int[] nums1, int m, int[] nums2, int n) {\nfor (int i = 0; i != n; ++i) {\nnums1[m + i] = nums2[i];\n}\nArrays.sort(nums1);\n}\n}\n</code></pre> <pre><code>class Solution {\npublic:\nvoid merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) {\nfor (int i = 0; i != n; ++i) {\nnums1[m + i] = nums2[i];\n}\nsort(nums1.begin(), nums1.end());\n}\n};\n</code></pre> <p>\u590d\u6742\u5ea6\u5206\u6790</p> <ul> <li> <p>\u65f6\u95f4\u590d\u6742\u5ea6\uff1a<code>O((m+n)log(m+n))</code>\u3002   \u6392\u5e8f\u5e8f\u5217\u957f\u5ea6\u4e3a <code>m+n</code>\uff0c\u5957\u7528\u5feb\u901f\u6392\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5373\u53ef\uff0c\u5e73\u5747\u60c5\u51b5\u4e3a <code>O((m+n)log(m+n))</code>\u3002</p> </li> <li> <p>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a<code>O(log(m+n))</code>\u3002   \u6392\u5e8f\u5e8f\u5217\u957f\u5ea6\u4e3a<code>m+n</code>\uff0c\u5957\u7528\u5feb\u901f\u6392\u5e8f\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u5373\u53ef\uff0c\u5e73\u5747\u60c5\u51b5\u4e3a <code>O(log(m+n))</code>\u3002</p> </li> </ul>"},{"location":"basic/algo/array_algo_3/#22","title":"2.2.\u53cc\u6307\u9488","text":"<p>\u7b97\u6cd5</p> <p>\u65b9\u6cd5\u4e00\u6ca1\u6709\u5229\u7528\u6570\u7ec4<code>nums1</code>\u4e0e<code>nums2</code>\u5df2\u7ecf\u88ab\u6392\u5e8f\u7684\u6027\u8d28\u3002\u4e3a\u4e86\u5229\u7528\u8fd9\u4e00\u6027\u8d28\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u53cc\u6307\u9488\u65b9\u6cd5\u3002\u8fd9\u4e00\u65b9\u6cd5\u5c06\u4e24\u4e2a\u6570\u7ec4\u770b\u4f5c\u961f\u5217\uff0c\u6bcf\u6b21\u4ece\u4e24\u4e2a\u6570\u7ec4\u5934\u90e8\u53d6\u51fa\u6bd4\u8f83\u5c0f\u7684\u6570\u5b57\u653e\u5230\u7ed3\u679c\u4e2d\u3002\u5982\u4e0b\u9762\u7684\u52a8\u753b\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u4eec\u4e3a\u4e24\u4e2a\u6570\u7ec4\u5206\u522b\u8bbe\u7f6e\u4e00\u4e2a\u6307\u9488 p1 \u4e0e p2 \u6765\u4f5c\u4e3a\u961f\u5217\u7684\u5934\u90e8\u6307\u9488\u3002\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> javac++ <pre><code>class Solution {\npublic void merge(int[] nums1, int m, int[] nums2, int n) {\nint p1 = 0, p2 = 0;\nint[] sorted = new int[m + n];\nint cur;\nwhile (p1 &lt; m || p2 &lt; n) {\n//\u5176\u4e2d\u4e00\u4e2a\u6570\u7ec4\u904d\u5386\u5b8c\uff0c\u540e\u7eed\u7684\u53ef\u4ee5\u76f4\u63a5\u62f7\u8d1d\u53e6\u5916\u4e00\u4e2a\u6570\u7ec4\nif (p1 == m) {\ncur = nums2[p2++];\n} else if (p2 == n) {\ncur = nums1[p1++];\n//\u6bd4\u8f83num1\u6570\u7ec4\u4e0enums2\u6570\u7ec4\uff0c\u54ea\u4e2a\u5c0f\uff0c\u5c31\u5b58\u5165sorted\u4e2d    \n} else if (nums1[p1] &lt; nums2[p2]) {\ncur = nums1[p1++];\n} else {\ncur = nums2[p2++];\n}\nsorted[p1 + p2 - 1] = cur;\n}\nfor (int i = 0; i != m + n; ++i) {\nnums1[i] = sorted[i];\n}\n}\n}\n</code></pre> <pre><code>class Solution {\npublic:\nvoid merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) {\nint p1 = 0, p2 = 0;\nint sorted[m + n];\nint cur;\nwhile (p1 &lt; m || p2 &lt; n) {\nif (p1 == m) {\ncur = nums2[p2++];\n} else if (p2 == n) {\ncur = nums1[p1++];\n} else if (nums1[p1] &lt; nums2[p2]) {\ncur = nums1[p1++];\n} else {\ncur = nums2[p2++];\n}\nsorted[p1 + p2 - 1] = cur;\n}\nfor (int i = 0; i != m + n; ++i) {\nnums1[i] = sorted[i];\n}\n}\n};\n</code></pre> <p>\u590d\u6742\u5ea6\u5206\u6790</p> <ul> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(m+n)\u3002</li> </ul> <p>\u6307\u9488\u79fb\u52a8\u5355\u8c03\u9012\u589e\uff0c\u6700\u591a\u79fb\u52a8 m+n \u6b21\uff0c\u56e0\u6b64\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(m+n)\u3002</p> <ul> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(m+n)\u3002</li> </ul> <p>\u9700\u8981\u5efa\u7acb\u957f\u5ea6\u4e3a m+n  \u7684\u4e2d\u95f4\u6570\u7ec4 sorted</p>"},{"location":"basic/algo/array_algo_3/#23","title":"2.3 \u65b9\u6cd5\u4e09\uff1a\u9006\u5411\u53cc\u6307\u9488","text":"<p>\u65b9\u6cd5\u4e8c\u4e2d\uff0c\u4e4b\u6240\u4ee5\u8981\u4f7f\u7528\u4e34\u65f6\u53d8\u91cf\uff0c\u662f\u56e0\u4e3a\u5982\u679c\u76f4\u63a5\u5408\u5e76\u5230\u6570\u7ec4  nums1 \u4e2d\uff0c nums1 \u4e2d\u7684\u5143\u7d20\u53ef\u80fd\u4f1a\u5728\u53d6\u51fa\u4e4b\u524d\u88ab\u8986\u76d6\u3002\u90a3\u4e48\u5982\u4f55\u76f4\u63a5\u907f\u514d\u8986\u76d6  nums1 \u4e2d\u7684\u5143\u7d20\u5462\uff1f\u89c2\u5bdf\u53ef\u77e5\uff0cnums1 \u7684\u540e\u534a\u90e8\u5206\u662f\u7a7a\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u8986\u76d6\u800c\u4e0d\u4f1a\u5f71\u54cd\u7ed3\u679c\u3002\u56e0\u6b64\u53ef\u4ee5\u6307\u9488\u8bbe\u7f6e\u4e3a\u4ece\u540e\u5411\u524d\u904d\u5386\uff0c\u6bcf\u6b21\u53d6\u4e24\u8005\u4e4b\u4e2d\u7684\u8f83\u5927\u8005\u653e\u8fdb  nums1  \u7684\u6700\u540e\u9762\u3002</p> <p>\u4e25\u683c\u6765\u8bf4\uff0c\u5728\u6b64\u904d\u5386\u8fc7\u7a0b\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u65f6\u523b\uff0cnums1 \u6570\u7ec4\u4e2d\u6709 m\u2212p1\u22121 \u4e2a\u5143\u7d20\u88ab\u653e\u5165 nums  1 \u7684\u540e\u534a\u90e8\uff0cnums2  \u6570\u7ec4\u4e2d\u6709 n\u2212p2\u22121 \u4e2a\u5143\u7d20\u88ab\u653e\u5165 nums1 \u7684\u540e\u534a\u90e8\uff0c\u800c\u5728\u6307\u9488 p1 \u7684\u540e\u9762\uff0cnums1 \u6570\u7ec4\u6709 m+n\u2212p1\u22121 \u4e2a\u4f4d\u7f6e\u3002\u7531\u4e8e m+n\u2212p1\u22121\u2265m\u2212p1\u22121+n\u2212p2\u22121 \u7b49\u4ef7\u4e8e p2&gt;=-1 \u6c38\u8fdc\u6210\u7acb\uff0c\u56e0\u6b64  p1 \u540e\u9762\u7684\u4f4d\u7f6e\u6c38\u8fdc\u8db3\u591f\u5bb9\u7eb3\u88ab\u63d2\u5165\u7684\u5143\u7d20\uff0c\u4e0d\u4f1a\u4ea7\u751f p1 \u7684\u5143\u7d20\u88ab\u8986\u76d6\u7684\u60c5\u51b5\u3002</p> <p>\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> javac++ <pre><code>class Solution {\npublic void merge(int[] nums1, int m, int[] nums2, int n) {\nint p1 = m - 1, p2 = n - 1;\nint tail = m + n - 1;\nint cur;\nwhile (p1 &gt;= 0 || p2 &gt;= 0) {\n//-1\u8868\u793a\u5176\u4e2d\u4e00\u4e2a\u6570\u7ec4\u904d\u5386\u5b8c\uff0c\u540e\u7eed\u7684\u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5c\u53e6\u4e00\u4e2a\u6570\u7ec4\nif (p1 == -1) {\ncur = nums2[p2--];\n} else if (p2 == -1) {\ncur = nums1[p1--];\n} else if (nums1[p1] &gt; nums2[p2]) {\ncur = nums1[p1--];\n} else {\ncur = nums2[p2--];\n}\nnums1[tail--] = cur;\n}\n}\n}\n</code></pre> <pre><code>class Solution {\npublic:\nvoid merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) {\nint p1 = m - 1, p2 = n - 1;\nint tail = m + n - 1;\nint cur;\nwhile (p1 &gt;= 0 || p2 &gt;= 0) {\nif (p1 == -1) {\ncur = nums2[p2--];\n} else if (p2 == -1) {\ncur = nums1[p1--];\n} else if (nums1[p1] &gt; nums2[p2]) {\ncur = nums1[p1--];\n} else {\ncur = nums2[p2--];\n}\nnums1[tail--] = cur;\n}\n}\n};\n</code></pre> <p>\u590d\u6742\u5ea6\u5206\u6790</p> <ul> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(m+n)\u3002</li> </ul> <p>\u6307\u9488\u79fb\u52a8\u5355\u8c03\u9012\u51cf\uff0c\u6700\u591a\u79fb\u52a8 m+n \u6b21\uff0c\u56e0\u6b64\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(m+n)\u3002</p> <ul> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(1)\u3002</li> </ul> <p>\u76f4\u63a5\u5bf9\u6570\u7ec4  nums1 \u539f\u5730\u4fee\u6539\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7a7a\u95f4\u3002</p>"},{"location":"basic/algo/bsearch/","title":"\u4e8c\u5206\u67e5\u627e\u7b97\u6cd5","text":""},{"location":"basic/algo/bsearch/#_1","title":"\u6709\u5e8f\u6570\u7ec4\u7684\u4e8c\u5206\u67e5\u627e\u7b97\u6cd5","text":"javapython <pre><code>public static int bsearch(int[] a, int value) {\nint low = 0;\nint high = a.length - 1;\nwhile (low &lt;= high) {\nint mid = low + ((high - low) &gt;&gt; 1);\nif (a[mid] == value) {\nreturn mid;\n} else if (a[mid] &lt; value) {\nlow = mid + 1;\n} else {\nhigh = mid - 1;\n}\n}\nreturn -1;\n}\n// \u4e8c\u5206\u67e5\u627e\u7684\u9012\u5f52\u5b9e\u73b0\npublic static int bsearchInternallyTest(int[] a, int val) {\nreturn bsearchInternally(a, 0, a.length - 1, val);\n}\npublic static int bsearchInternally(int[] a, int low, int high, int value) {\nif (low &gt; high)\nreturn -1;\nint mid = low + ((high - low) &gt;&gt; 1);\nif (a[mid] == value) {\nreturn mid;\n} else if (a[mid] &lt; value) {\nreturn bsearchInternally(a, mid + 1, high, value);\n} else {\nreturn bsearchInternally(a, low, mid - 1, value);\n}\n}\n</code></pre> <pre><code>def bsearch(self, arr, target):\nlow = 0\nhigh = len(arr) - 1\nwhile low &lt;= high:\nmid = low + (high - low) // 2\nif arr[mid] == target:\nreturn mid\nelif arr[mid] &lt; target:\nlow = mid + 1\nelse:\nhigh = mid - 1\nreturn -1\n</code></pre>"},{"location":"basic/algo/bsearch/#_2","title":"\u67e5\u627e\u6709\u5e8f\u6570\u7ec4\u7b2c\u4e00\u4e2a\u503c\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"javapython <pre><code>public static int bsearchFirst(int[] a, int value) {\nint low = 0;\nint high = a.length - 1;\nwhile (low &lt;= high) {\nint mid = low + ((high - low) &gt;&gt; 1);\nif (a[mid] &gt; value) {\nhigh = mid - 1;\n} else if (a[mid] &lt; value) {\nlow = mid + 1;\n} else {\nif ((mid == 0) || (a[mid - 1] != value))\nreturn mid;\nelse\nhigh = mid - 1;\n}\n}\nreturn -1;\n}\n</code></pre> <pre><code>def bsearch_first(self, arr, target):\nlow = 0\nhigh = len(arr) - 1\nwhile low &lt;= high:\nmid = low + (high - low) // 2\nif arr[mid] &gt; target:\nhigh = mid - 1\nelif arr[mid] &lt; target:\nlow = mid + 1\nelse:\nif mid == 0 or arr[mid - 1] != target:\nreturn mid\nhigh = mid - 1\nreturn -1\n</code></pre>"},{"location":"basic/algo/bsearch/#_3","title":"\u67e5\u627e\u6700\u540e\u4e00\u4e2a\u503c\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"javapython <pre><code>public static int bsearchLast(int[] a, int value) {\nint low = 0;\nint high = a.length - 1;\nwhile (low &lt;= high) {\nint mid = low + ((high - low) &gt;&gt; 1);\nif (a[mid] &gt; value) {\nhigh = mid - 1;\n} else if (a[mid] &lt; value) {\nlow = mid + 1;\n} else {\nif ((mid == a.length - 1) || (a[mid + 1] != value))\nreturn mid;\nelse\nlow = mid + 1;\n}\n}\nreturn -1;\n}\n</code></pre> <pre><code>def bsearch_last(self, arr, target):\nlow = 0\nhigh = len(arr) - 1\nwhile low &lt;= high:\nmid = low + (high - low) // 2\nif arr[mid] &gt; target:\nhigh = mid - 1\nelif arr[mid] &lt; target:\nlow = mid + 1\nelse:\nif mid == len(arr) - 1 or arr[mid + 1] != target:\nreturn mid\nlow = mid + 1\nreturn -1\n</code></pre>"},{"location":"basic/algo/bsearch/#_4","title":"\u67e5\u627e\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"javapython <pre><code>public static int bsearchBigger(int[] a, int value) {\nint low = 0;\nint high = a.length - 1;\nwhile (low &lt;= high) {\nint mid = low + ((high - low) &gt;&gt; 1);\nif (a[mid] &gt;= value) {\nif ((mid == 0) || (a[mid - 1] &lt; value))\nreturn mid;\nelse\nhigh = mid - 1;\n} else {\nlow = mid + 1;\n}\n}\nreturn -1;\n}\n</code></pre> <pre><code>def bsearch_first_ge(self, arr, target):\nlow = 0\nhigh = len(arr) - 1\nwhile low &lt;= high:\nmid = low + (high - low) // 2\nif arr[mid] &gt;= target:\nif mid == 0 or arr[mid - 1] &lt; target:\nreturn mid\nhigh = mid - 1\nelse:\nlow = mid + 1\nreturn -1\n</code></pre>"},{"location":"basic/algo/bsearch/#_5","title":"\u67e5\u627e\u6700\u540e\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"javapython <pre><code>private int[] quickSort(int[] arr, int left, int right) {\nif (left &lt; right) {\nint partitionIndex = partition(arr, left, right);\nquickSort(arr, left, partitionIndex - 1);\nquickSort(arr, partitionIndex + 1, right);\n}\nreturn arr;\n}\nprivate int partition(int[] arr, int left, int right) {\n// \u8bbe\u5b9a\u57fa\u51c6\u503c\uff08pivot\uff09\nint pivot = left;\nint index = pivot + 1;\nfor (int i = index; i &lt;= right; i++) {\nif (arr[i] &lt; arr[pivot]) {\nswap(arr, i, index);\nindex++;\n}\n}\nswap(arr, pivot, index - 1);\nreturn index - 1;\n}\nprivate void swap(int[] arr, int i, int j) {\nint temp = arr[i];\narr[i] = arr[j];\narr[j] = temp;\n}\n</code></pre> <pre><code>public static int bsearchLitter(int[] a, int value) {\nint low = 0;\nint high = a.length - 1;\nwhile (low &lt;= high) {\nint mid = low + ((high - low) &gt;&gt; 1);\nif (a[mid] &lt;= value) {\nif ((mid == a.length - 1) || (a[mid + 1] &gt; value))\nreturn mid;\nelse\nlow = mid + 1;\n} else {\nhigh = mid - 1;\n}\n}\nreturn -1;\n}       \n</code></pre>"},{"location":"basic/algo/bsearch/#sqrtx-x","title":"Sqrt(x) \uff08x \u7684\u5e73\u65b9\u6839\uff09","text":"javapython <pre><code>public static int mySqrt(int x) {\n// \u7279\u6b8a\u503c\u5224\u65ad\nif (x == 0) {\nreturn 0;\n}\nif (x == 1) {\nreturn 1;\n}\nint left = 1;\nint right = x / 2;\n// \u5728\u533a\u95f4 [left..right] \u67e5\u627e\u76ee\u6807\u5143\u7d20\nwhile (left &lt; right) {\nint mid = left + (right - left + 1) / 2;\n// \u6ce8\u610f\uff1a\u8fd9\u91cc\u4e3a\u4e86\u907f\u514d\u4e58\u6cd5\u6ea2\u51fa\uff0c\u6539\u7528\u9664\u6cd5\nif (mid &gt; x / mid) {\n// \u4e0b\u4e00\u8f6e\u641c\u7d22\u533a\u95f4\u662f [left..mid - 1]\nright = mid - 1;\n} else {\n// \u4e0b\u4e00\u8f6e\u641c\u7d22\u533a\u95f4\u662f [mid..right]\nleft = mid;\n}\n}\nreturn left;\n}\n</code></pre> <pre><code>def mySqrt(self, x: int) -&gt; int:\nif x == 0 or x == 1:\nreturn x\nlow = 0\nhigh = x\nwhile low &lt;= high:\nmid = low + (high - low) // 2\nif mid * mid &gt; x:\nhigh = mid - 1\nelse:\nlow = mid + 1\nreturn high       \n</code></pre>"},{"location":"basic/algo/bsearch/#_6","title":"\u641c\u7d22\u65cb\u8f6c\u6392\u5e8f\u6570\u7ec4","text":"<p>\u5982\u679c\u6709\u5e8f\u6570\u7ec4\u662f\u4e00\u4e2a\u5faa\u73af\u6709\u5e8f\u6570\u7ec4\uff0c\u6bd4\u5982 4\uff0c5\uff0c6\uff0c1\uff0c2\uff0c3\u3002\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u5982\u4f55\u5b9e\u73b0\u4e00\u4e2a\u6c42\u201c\u503c\u7b49\u4e8e\u7ed9\u5b9a\u503c\u201d\u7684\u4e8c\u5206\u67e5\u627e\u7b97\u6cd5\u5462\uff1f</p> javapython <pre><code>public int search(int[] nums, int target) {\nint n = nums.length;\nif (n == 0) {\nreturn -1;\n}\nif (n == 1) {\nreturn nums[0] == target ? 0 : -1;\n}\nint l = 0, r = n - 1;\nwhile (l &lt;= r) {\nint mid = (l + r) / 2;\nif (nums[mid] == target) {\nreturn mid;\n}\nif (nums[0] &lt;= nums[mid]) {\nif (nums[0] &lt;= target &amp;&amp; target &lt; nums[mid]) {\nr = mid - 1;\n} else {\nl = mid + 1;\n}\n} else {\nif (nums[mid] &lt; target &amp;&amp; target &lt;= nums[n - 1]) {\nl = mid + 1;\n} else {\nr = mid - 1;\n}\n}\n}\nreturn -1;\n}\n</code></pre> <pre><code>def search(self, nums: List[int], target: int) -&gt; int:\nif not nums:\nreturn -1\nif len(nums) == 1:\nreturn 0 if nums[0] == target else -1\nlow = 0\nhigh = len(nums) - 1\nwhile low &lt;= high:\nmid = low + (high - low) // 2\nif nums[mid] == target:\nreturn mid\nif nums[low] &lt;= nums[mid]:\nif nums[low] &lt;= target &lt; nums[mid]:\nhigh = mid - 1\nelse:\nlow = mid + 1\nelse:\nif nums[mid] &lt; target &lt;= nums[high]:\nlow = mid + 1\nelse:\nhigh = mid - 1\nreturn -1    \n</code></pre>"},{"location":"basic/algo/hashTable/","title":"\u5e38\u89c1\u6563\u5217\u8868\u5b9e\u73b0","text":""},{"location":"basic/algo/hashTable/#_1","title":"\u5b9e\u73b0\u4e00\u4e2a\u57fa\u4e8e\u94fe\u8868\u6cd5\u89e3\u51b3\u51b2\u7a81\u95ee\u9898\u7684\u6563\u5217\u8868","text":"java <pre><code>public class HashTable&lt;K, V&gt; {\n/**\n     * \u6563\u5217\u8868\u9ed8\u8ba4\u957f\u5ea6\n     */\nprivate static final int DEFAULT_INITAL_CAPACITY = 8;\n/**\n     * \u88c5\u8f7d\u56e0\u5b50\n     */\nprivate static final float LOAD_FACTOR = 0.75f;\n/**\n     * \u521d\u59cb\u5316\u6563\u5217\u8868\u6570\u7ec4\n     */\nprivate Entry&lt;K, V&gt;[] table;\n/**\n     * \u5b9e\u9645\u5143\u7d20\u6570\u91cf\n     */\nprivate int size = 0;\n/**\n     * \u6563\u5217\u8868\u7d22\u5f15\u6570\u91cf\n     */\nprivate int use = 0;\npublic HashTable() {\ntable = (Entry&lt;K, V&gt;[]) new Entry[DEFAULT_INITAL_CAPACITY];\n}\nstatic class Entry&lt;K, V&gt; {\nK key;\nV value;\nEntry&lt;K, V&gt; next;\npublic Entry(K key, V value, HashTable.Entry&lt;K, V&gt; next) {\nthis.key = key;\nthis.value = value;\nthis.next = next;\n}\n}\n/**\n     * \u65b0\u589e\n     *\n     * @param key\n     * @param value\n     */\npublic void put(K key, V value) {\nint index = hash(key);\nif (table[index] == null) {\ntable[index] = new Entry(null, null, null);\n}\nEntry&lt;K, V&gt; tmp = table[index];\n// \u65b0\u589e\u8282\u70b9\nif (tmp.next == null) {\ntmp.next = new Entry&lt;&gt;(key, value, null);\nsize++;\nuse++;\nif (use &gt;= table.length * LOAD_FACTOR) {\nresize();\n}\n} else {\n// \u89e3\u51b3\u6563\u5217\u51b2\u7a81\uff0c\u4f7f\u7528\u94fe\u8868\u6cd5\ndo {\ntmp = tmp.next;\nif (tmp.key == key) {\ntmp.value = value;\nreturn;\n}\n} while (tmp.next != null);\nEntry&lt;K, V&gt; temp = table[index].next;\ntable[index].next = new Entry&lt;&gt;(key, value, temp);\nsize++;\n}\n}\n/**\n     * \u6563\u5217\u51fd\u6570\n     * &lt;p&gt;\n     * \u53c2\u8003hashmap\u6563\u5217\u51fd\u6570\n     *\n     * @param key\n     * @return\n     */\nprivate int hash(Object key) {\nint h;\nreturn (key == null) ? 0 : ((h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)) % table.length;\n}\n/**\n     * \u6269\u5bb9\n     */\nprivate void resize() {\nEntry&lt;K, V&gt; oldTable = table;\ntable = (Entry&lt;K, V&gt;[]) new Entry[table.length * 2];\nuse = 0;\nfor (int i = 0; i &lt; oldTable.length; i++) {\nif (oldTable[i] == null || oldTable[i].next == null) {\ncontinue;\n}\nEntry&lt;K, V&gt; e = oldTable[i];\nwhile (e.next != null) {\ne = e.next;\nint index = hash(e.key);\nif (table[index] == null) {\nuse++;\n// \u521b\u5efa\u54e8\u5175\u8282\u70b9\ntable[index] = new Entry&lt;&gt;(null, null, null);\n}\ntable[index].next = new Entry&lt;&gt;(e.key, e.value, table[index].next);\n}\n}\n}\n/**\n     * \u5220\u9664\n     *\n     * @param key\n     */\npublic void remove(K key) {\nint index = hash(key);\nEntry e = table[index];\nif (e == null || e.next == null) {\nreturn;\n}\nEntry pre;\nEntry&lt;K, V&gt; headNode = table[index];\ndo {\npre = e;\ne = e.next;\nif (key == e.key) {\npre.next = e.next;\nsize--;\nif (headNode.next == null)\nuse--;\nreturn;\n}\n} while (e.next != null);\n}\n/**\n     * \u83b7\u53d6\n     *\n     * @param key\n     * @return\n     */\npublic V get(K key) {\nint index = hash(key);\nEntry&lt;K, V&gt; e = table[index];\nif (e == null || e.next == null) {\nreturn null;\n}\nwhile (e.next != null) {\ne = e.next;\nif (key == e.key) {\nreturn e.value;\n}\n}\nreturn null;\n}\n}\n</code></pre>"},{"location":"basic/algo/hashTable/#lru","title":"\u5b9e\u73b0\u4e00\u4e2a LRU \u7f13\u5b58\u6dd8\u6c70\u7b97\u6cd5","text":"java <pre><code>public class LRUBaseHashTable&lt;K, V&gt; {\n/**\n     * \u9ed8\u8ba4\u94fe\u8868\u5bb9\u91cf\n     */\nprivate final static Integer DEFAULT_CAPACITY = 10;\n/**\n     * \u5934\u7ed3\u70b9\n     */\nprivate DNode&lt;K, V&gt; headNode;\n/**\n     * \u5c3e\u8282\u70b9\n     */\nprivate DNode&lt;K, V&gt; tailNode;\n/**\n     * \u94fe\u8868\u957f\u5ea6\n     */\nprivate Integer length;\n/**\n     * \u94fe\u8868\u5bb9\u91cf\n     */\nprivate Integer capacity;\n/**\n     * \u6563\u5217\u8868\u5b58\u50a8key\n     */\nprivate HashMap&lt;K, DNode&lt;K, V&gt;&gt; table;\n/**\n     * \u53cc\u5411\u94fe\u8868\n     */\nstatic class DNode&lt;K, V&gt; {\nprivate K key;\n/**\n         * \u6570\u636e\n         */\nprivate V value;\n/**\n         * \u524d\u9a71\u6307\u9488\n         */\nprivate DNode&lt;K, V&gt; prev;\n/**\n         * \u540e\u7ee7\u6307\u9488\n         */\nprivate DNode&lt;K, V&gt; next;\nDNode() {\n}\nDNode(K key, V value) {\nthis.key = key;\nthis.value = value;\n}\n}\npublic LRUBaseHashTable(int capacity) {\nthis.length = 0;\nthis.capacity = capacity;\nheadNode = new DNode&lt;&gt;();\ntailNode = new DNode&lt;&gt;();\nheadNode.next = tailNode;\ntailNode.prev = headNode;\ntable = new HashMap&lt;&gt;();\n}\npublic LRUBaseHashTable() {\nthis(DEFAULT_CAPACITY);\n}\n/**\n     * \u65b0\u589e\n     *\n     * @param key\n     * @param value\n     */\npublic void add(K key, V value) {\nDNode&lt;K, V&gt; node = table.get(key);\nif (node == null) {\nDNode&lt;K, V&gt; newNode = new DNode&lt;&gt;(key, value);\ntable.put(key, newNode);\naddNode(newNode);\nif (++length &gt; capacity) {\nDNode&lt;K, V&gt; tail = popTail();\ntable.remove(tail.key);\nlength--;\n}\n} else {\nnode.value = value;\nmoveToHead(node);\n}\n}\n/**\n     * \u5c06\u65b0\u8282\u70b9\u52a0\u5230\u5934\u90e8\n     *\n     * @param newNode\n     */\nprivate void addNode(DNode&lt;K, V&gt; newNode) {\nnewNode.next = headNode.next;\nnewNode.prev = headNode;\nheadNode.next.prev = newNode;\nheadNode.next = newNode;\n}\n/**\n     * \u5f39\u51fa\u5c3e\u90e8\u6570\u636e\u8282\u70b9\n     */\nprivate DNode&lt;K, V&gt; popTail() {\nDNode&lt;K, V&gt; node = tailNode.prev;\nremoveNode(node);\nreturn node;\n}\n/**\n     * \u79fb\u9664\u8282\u70b9\n     *\n     * @param node\n     */\nprivate void removeNode(DNode&lt;K, V&gt; node) {\nnode.prev.next = node.next;\nnode.next.prev = node.prev;\n}\n/**\n     * \u5c06\u8282\u70b9\u79fb\u52a8\u5230\u5934\u90e8\n     *\n     * @param node\n     */\nprivate void moveToHead(DNode&lt;K, V&gt; node) {\nremoveNode(node);\naddNode(node);\n}\n/**\n     * \u83b7\u53d6\u8282\u70b9\u6570\u636e\n     *\n     * @param key\n     * @return\n     */\npublic V get(K key) {\nDNode&lt;K, V&gt; node = table.get(key);\nif (node == null) {\nreturn null;\n}\nmoveToHead(node);\nreturn node.value;\n}\n/**\n     * \u79fb\u9664\u8282\u70b9\u6570\u636e\n     *\n     * @param key\n     */\npublic void remove(K key) {\nDNode&lt;K, V&gt; node = table.get(key);\nif (node == null) {\nreturn;\n}\nremoveNode(node);\nlength--;\ntable.remove(node.key);\n}\nprivate void printAll() {\nDNode&lt;K, V&gt; node = headNode.next;\nwhile (node.next != null) {\nSystem.out.print(node.value + \",\");\nnode = node.next;\n}\nSystem.out.println();\n}\n}\n</code></pre>"},{"location":"basic/algo/heap/","title":"\u5c0f\u9876\u5806\u3001\u5927\u9876\u5806\u3001\u4f18\u5148\u7ea7\u961f\u5217","text":""},{"location":"basic/algo/heap/#_1","title":"\u5b9e\u73b0\u4e00\u4e2a\u5c0f\u9876\u5806","text":"java <pre><code>public class MinHeap {\nprivate int[] a; // \u6570\u7ec4\uff0c\u4ece\u4e0b\u68071\u5f00\u59cb\u5b58\u50a8\u6570\u636e\nprivate int n; // \u5806\u53ef\u4ee5\u5b58\u50a8\u7684\u6700\u5927\u6570\u636e\u4e2a\u6570\nprivate int count; // \u5806\u4e2d\u5df2\u7ecf\u5b58\u50a8\u7684\u6570\u636e\u4e2a\u6570\npublic MinHeap(int capacity) {\na = new int[capacity + 1];\nn = capacity;\ncount = 0;\n}\n// \u63d2\u5165\u5143\u7d20\npublic void insert(int data) {\nif (count &gt;= n) return; // \u5806\u6ee1\u4e86\n++count;\na[count] = data;\nint i = count;\nwhile (i / 2 &gt; 0 &amp;&amp; a[i] &lt; a[i / 2]) { // \u81ea\u4e0b\u5f80\u4e0a\u5806\u5316\nswap(a, i, i / 2); // swap()\u51fd\u6570\u4f5c\u7528\uff1a\u4ea4\u6362\u4e0b\u6807\u4e3ai\u548ci/2\u7684\u4e24\u4e2a\u5143\u7d20\ni = i / 2;\n}\n}\n// \u5220\u9664\u5806\u9876\u5143\u7d20\npublic void removeMin() {\nif (count == 0) return; // \u5806\u4e2d\u6ca1\u6709\u6570\u636e\na[1] = a[count];\n--count;\nheapify(a, count, 1);\n}\n// \u5806\u5316\nprivate void heapify(int[] a, int n, int i) { // \u81ea\u4e0a\u5f80\u4e0b\u5806\u5316\nwhile (true) {\nint minPos = i;\nif (i * 2 &lt;= n &amp;&amp; a[i] &gt; a[i * 2]) minPos = i * 2;\nif (i * 2 + 1 &lt;= n &amp;&amp; a[i] &gt; a[i * 2 + 1]) minPos = i * 2 + 1;\nif (minPos == i) break;\nswap(a, i, minPos);\ni = minPos;\n}\n}\n// \u4ea4\u6362\u5143\u7d20\u4f4d\u7f6e\nprivate void swap(int[] a, int i, int j) {\nint tmp = a[i];\na[i] = a[j];\na[j] = tmp;\n}\npublic static void main(String[] args) {\nMinHeap minHeap = new MinHeap(10);\nminHeap.insert(3);\n}\n</code></pre>"},{"location":"basic/algo/heap/#_2","title":"\u5b9e\u73b0\u4e00\u4e2a\u5927\u9876\u5806","text":"java <pre><code>public class MaxHeap {\nprivate int[] a; // \u6570\u7ec4\uff0c\u4ece\u4e0b\u68071\u5f00\u59cb\u5b58\u50a8\u6570\u636e\nprivate int n; // \u5806\u53ef\u4ee5\u5b58\u50a8\u7684\u6700\u5927\u6570\u636e\u4e2a\u6570\nprivate int count; // \u5806\u4e2d\u5df2\u7ecf\u5b58\u50a8\u7684\u6570\u636e\u4e2a\u6570\npublic MaxHeap(int capacity) {\n//\u8fd9\u91cc\u52a01\u662f\u6307\u539f\u6765\u80fd\u88c5\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u90a3\u53bb\u63890\u4f4d\uff0c\u53ea\u80fd\u88c5capacity\u4e2a\u5143\u7d20\na = new int[capacity + 1];\nn = capacity;\ncount = 0;\n}\n// \u63d2\u5165\u5143\u7d20\npublic void insert(int data) {\nif (count &gt;= n) return; // \u5806\u6ee1\u4e86\n++count;\na[count] = data;\nshiftUp(count);\n}\nprivate void shiftUp(int k){\nwhile (k / 2 &gt; 0 &amp;&amp; a[k] &gt; a[k / 2]) { // \u81ea\u4e0b\u5f80\u4e0a\u5806\u5316\nswap(a, k, k / 2); // swap()\u51fd\u6570\u4f5c\u7528\uff1a\u4ea4\u6362\u4e0b\u6807\u4e3ai\u548ci/2\u7684\u4e24\u4e2a\u5143\u7d20\nk = k / 2;\n}\n}\n// \u5220\u9664\u5806\u9876\u5143\u7d20\npublic void removeMax() {\nif (count == 0) return; // \u5806\u4e2d\u6ca1\u6709\u6570\u636e\na[1] = a[count];\n--count;\nheapify(a, count, 1);\n}\n// \u5806\u5316\nprivate void heapify(int[] a, int n, int i) { // \u81ea\u4e0a\u5f80\u4e0b\u5806\u5316\nwhile (true) {\nint maxPos = i;\nif (i * 2 &lt;= n &amp;&amp; a[i] &lt; a[i * 2]) maxPos = i * 2;\nif (i * 2 + 1 &lt;= n &amp;&amp; a[i] &lt; a[i * 2 + 1]) maxPos = i * 2 + 1;\nif (maxPos == i) break;\nswap(a, i, maxPos);\ni = maxPos;\n}\n}\n// \u4ea4\u6362\u5143\u7d20\u4f4d\u7f6e\nprivate void swap(int[] a, int i, int j) {\nint tmp = a[i];\na[i] = a[j];\na[j] = tmp;\n}\npublic static void main(String[] args) {\n// MaxHeap&lt;Integer&gt; hMaxHeap = new MaxHeap&lt;&gt;(100);\n// int N = 50; // \u5806\u4e2d\u5143\u7d20\u4e2a\u6570\n// int M = 100; // \u5806\u4e2d\u5143\u7d20\u53d6\u503c\u8303\u56f4[0, M)\n// for( int i = 0 ; i &lt; N ; i ++ )\n//     hMaxHeap.insert( new Integer((int)(Math.random() * M)) );\n// System.out.println(hMaxHeap.size());\nMaxHeap&lt;Integer&gt; heapShiftDown = new MaxHeap&lt;Integer&gt;(100);\n// \u5806\u4e2d\u5143\u7d20\u4e2a\u6570\nint N = 100;\n// \u5806\u4e2d\u5143\u7d20\u53d6\u503c\u8303\u56f4[0, M)\nint M = 100;\nfor( int i = 0 ; i &lt; N ; i ++ )\nheapShiftDown.insert( new Integer((int)(Math.random() * M)) );\nInteger[] arr = new Integer[N];\n// \u5c06\u6700\u5927\u5806\u4e2d\u7684\u6570\u636e\u9010\u6e10\u4f7f\u7528extractMax\u53d6\u51fa\u6765\n// \u53d6\u51fa\u6765\u7684\u987a\u5e8f\u5e94\u8be5\u662f\u6309\u7167\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\u53d6\u51fa\u6765\u7684\nfor( int i = 0 ; i &lt; N ; i ++ ){\narr[i] = heapShiftDown.extractMax();\nSystem.out.print(arr[i] + \" \");\n}\n// \u786e\u4fddarr\u6570\u7ec4\u662f\u4ece\u5927\u5230\u5c0f\u6392\u5217\u7684\nfor( int i = 1 ; i &lt; N ; i ++ )\nassert arr[i-1] &gt;= arr[i];\n}\n}\n</code></pre>"},{"location":"basic/algo/heap/#_3","title":"\u5b9e\u73b0\u4e00\u4e2a\u4f18\u5148\u7ea7\u961f\u5217","text":"java <pre><code>public class PrioritQueue {\nprivate int[] arr;\nprivate int size;\npublic PrioritQueue(int initSize) {\nif (initSize &lt; 0) {\nthrow new IllegalArgumentException(\"The init size is less than 0\");\n}\nthis.arr = new int[initSize];\nthis.size = 0;\n}\n// ------------------------------ Public methods\npublic int max() {\nreturn this.arr[0];\n}\npublic int maxAndRemove() {\nint t = max();\nthis.arr[0] = this.arr[--size];\nsink(0, this.arr[0]);\nreturn t;\n}\npublic void add(int data) {\nresize(1);\nthis.arr[size++] = data;\npop(size - 1, data);\n}\n// ------------------------------ Private methods\n/**\n     * key\u4e0b\u6c89\u65b9\u6cd5\n     */\nprivate void sink(int i, int key) {\nwhile (2 * i &lt;= this.size - 1) {\nint child = 2 * i;\nif (child &lt; this.size - 1 &amp;&amp; this.arr[child] &lt; this.arr[child + 1]) {\nchild++;\n}\nif (this.arr[i] &gt;= this.arr[child]) {\nbreak;\n}\nswap(i, child);\ni = child;\n}\n}\n/**\n     * key\u4e0a\u6d6e\u65b9\u6cd5\n     */\nprivate void pop(int i, int key) {\nwhile (i &gt; 0) {\nint parent = i / 2;\nif (this.arr[i] &lt;= this.arr[parent]) {\nbreak;\n}\nswap(i, parent);\ni = parent;\n}\n}\npublic int peek() {\nreturn this.arr[0];\n}\npublic int poll() {\nint t = peek();\nthis.arr[0] = this.arr[--size];\nsink(0, this.arr[0]);\nreturn t;\n}\n/**\n     * \u91cd\u65b0\u8c03\u6574\u6570\u7ec4\u5927\u5c0f\n     */\nprivate void resize(int size) {\nint[] newArr = new int[this.arr.length + size];\nfor (int i = 0; i &lt; this.arr.length; i++) {\nnewArr[i] = this.arr[i];\n}\nthis.arr = newArr;\n}\n/**\n     * \u4ea4\u6362\u6570\u7ec4\u4e2d\u4e24\u4e2a\u5143\u7d20\u7684\u4f4d\u7f6e\n     */\nprivate void swap(int i, int j) {\nint tmp = this.arr[i];\nthis.arr[i] = this.arr[j];\nthis.arr[j] = tmp;\n}\n}\n</code></pre>"},{"location":"basic/algo/heap_1/","title":"\u5e38\u89c1\u5806\u7b97\u6cd5","text":""},{"location":"basic/algo/heap_1/#_1","title":"\u5b9e\u73b0\u5806\u6392\u5e8f","text":"<p>=== \"java\"</p> <pre><code>``` java\npublic class HeapSort {\n\n    public static void main(String[] args) {\n        int[] arr = { 1, 3, 2, 6, 5, 7, 8, 9, 10, 0 };\n        heapSort(arr);\n        for (int i : arr) {\n            System.out.print(i + \" \");\n        }\n    }\n\n    public static void heapSort(int[] arr) {\n        if (arr == null || arr.length &lt; 2) {\n            return;\n        }\n        buildHeap(arr, arr.length);\n        sort(arr, arr.length);\n    }\n\n    private static void buildHeap(int[] a, int n) {\n        for (int i = n / 2; i &gt;= 0; --i) {\n            heapify(a, n, i);\n        }\n    }\n\n    private static void heapify(int[] a, int n, int i) {\n        while (true) {\n            int maxPos = i;\n            if (i * 2 +1 &lt; n &amp;&amp; a[i] &lt; a[i * 2 + 1])\n                maxPos = i * 2+1;\n            if (i * 2 + 2 &lt; n &amp;&amp; a[maxPos] &lt; a[i * 2 + 2 ])\n                maxPos = i * 2 + 2;\n            if (maxPos == i)\n                break;\n            swap(a, i, maxPos);\n            i = maxPos;\n        }\n    }\n\n    // n\u8868\u793a\u6570\u636e\u7684\u4e2a\u6570\uff0c\u6570\u7ec4a\u4e2d\u7684\u6570\u636e\u4ece\u4e0b\u68071\u5230n\u7684\u4f4d\u7f6e\u3002\n    public static void sort(int[] a, int n) {\n        buildHeap(a, n);\n        int k = n-1;\n        while (k &gt; 0) {\n            swap(a, 0, k);\n            --k;\n            heapify(a, k, 0);\n        }\n    }\n\n    public static void swap(int[] arr, int i, int j) {\n        int tmp = arr[i];\n        arr[i] = arr[j];\n        arr[j] = tmp;\n    }\n\n}\n\n```\n</code></pre>"},{"location":"basic/algo/heap_1/#k","title":"\u5229\u7528\u4f18\u5148\u7ea7\u961f\u5217\u5408\u5e76 K \u4e2a\u6709\u5e8f\u6570\u7ec4","text":"<p>=== \"java\"</p> <pre><code>``` java\npublic static int[] mergeKSortedArrays(int[][] arr) {\n    int k = arr.length;\n    int n = arr[0].length;\n    int[] result = new int[k * n];\n    PriorityQueue&lt;Integer&gt; queue = new PriorityQueue&lt;Integer&gt;();\n    for (int i = 0; i &lt; k; i++) {\n        for (int j = 0; j &lt; n; j++) {\n            queue.add(arr[i][j]);\n        }\n    }\n    for (int i = 0; i &lt; k * n; i++) {\n        result[i] = queue.poll();\n    }\n    return result;\n}\n\n```\n</code></pre> <p>## \u6c42\u4e00\u7ec4\u52a8\u6001\u6570\u636e\u96c6\u5408\u7684\u6700\u5927 Top K</p> <p>=== \"java\"</p> <pre><code>``` java\npublic static int[] topK(int[] arr, int k) {\n    int[] result = new int[k];\n    PriorityQueue&lt;Integer&gt; queue = new PriorityQueue&lt;Integer&gt;();\n    for (int i = 0; i &lt; arr.length; i++) {\n        if (queue.size() &lt; k) {\n            queue.add(arr[i]);\n        } else {\n            if (queue.peek() &lt; arr[i]) {\n                queue.poll();\n                queue.add(arr[i]);\n            }\n        }\n    }\n    for (int i = 0; i &lt; k; i++) {\n        result[i] = queue.poll();\n    }\n    return result;\n}\n```\n</code></pre>"},{"location":"basic/algo/linklist_1/","title":"\u5b9e\u73b0\u5355\u94fe\u8868\u3001\u5faa\u73af\u94fe\u8868\u3001\u53cc\u5411\u94fe\u8868\uff0c\u652f\u6301\u589e\u5220\u64cd\u4f5c","text":""},{"location":"basic/algo/linklist_1/#_1","title":"\u5b9e\u73b0\u5355\u94fe\u8868","text":"javakotlinjspython <pre><code>/**\n * 1\uff09\u5355\u94fe\u8868\u7684\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u627e\u64cd\u4f5c\uff1b\n * 2\uff09\u94fe\u8868\u4e2d\u5b58\u50a8\u7684\u662fint\u7c7b\u578b\u7684\u6570\u636e\uff1b\n */\npublic class SinglyLinkedList {\npublic static class Node{\nprivate int data;\nprivate Node next;\npublic Node(int data, Node next){\nthis.data = data;\nthis.next = next;\n}\npublic int getData() {\nreturn data;\n}\n}\nprivate Node head =null;\npublic Node findByValue(int value){\nNode p = head;\nwhile(p!=null &amp;&amp; p.data!=value){\np = p.next;\n}\nreturn p;\n}\npublic Node findByIndex(int index){\nNode p = head;\nint pos = 0;\nwhile(p!=null &amp;&amp; pos!=index){\npos++;\np = p.next;\n}\nreturn p;\n}\n//\u65e0\u5934\u7ed3\u70b9\n//\u8868\u5934\u90e8\u63d2\u5165\n//\u8fd9\u79cd\u64cd\u4f5c\u5c06\u4e8e\u8f93\u5165\u7684\u987a\u5e8f\u76f8\u53cd\uff0c\u9006\u5e8f\npublic void insertToHead(int value){\nNode newNode = new Node(value,null);\ninsertToHead(newNode);\n}\npublic void insertToHead(Node newNode){\nif(head == null){\nhead = newNode;\n}else{\nnewNode.next = head;\nhead = newNode;\n}\n}\n//\u987a\u5e8f\u63d2\u5165\n//\u94fe\u8868\u5c3e\u90e8\u63d2\u5165\npublic void insertTail(int value){\nNode newNode = new Node(value,null);\n//\u7a7a\u94fe\u8868\uff0c\u53ef\u4ee5\u63d2\u5165\u65b0\u8282\u70b9\u4f5c\u4e3ahead\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u64cd\u4f5c\nif(head == null){\nhead = newNode;\n} else {\nNode q = head;\nwhile(q.next!=null){\nq = q.next;\n}\nnewNode.next = q.next;\nq.next = newNode;\n}\n}\npublic void insertAfter(Node p, int value){\nNode newNode = new Node(value,null);\ninsertAfter(p,newNode);\n}\npublic void insertAfter(Node p, Node newNode){\nif(p == null)return;\nnewNode.next = p.next;\np.next = newNode;\n}\npublic void insertBefore(Node p , int value){\nNode newNode = new Node(value, null);\ninsertBefore(p,newNode);\n}\npublic void insertBefore(Node p , Node newNode){\nif(p == null) return;\nif(head == p){\ninsertToHead(newNode);\nreturn;\n}\nNode q = head;\nwhile(q.next !=p &amp;&amp; q != null){ q= q.next;\n}\nif (q == null) {\nreturn;\n}\nq.next = newNode;\nnewNode.next = p;\n}\npublic void deleteByNode(Node p){\nif(p == null || head == null) return;\nif(p == head){\nhead = head.next;\nreturn;\n}\nNode q = head;\nwhile(q.next !=p &amp;&amp; q != null){ q= q.next;\n}\nif(q == null){\nreturn;\n}\nq.next =q.next.next;\n}\npublic void deleteByValue(int value){\nif(head == null) return;\nif(head.data == value){\nhead = head.next;\nreturn;\n}\nNode q = head;\nif(q.data != value &amp;&amp; q!=null){\nq = q.next;\n}\nif(q == null){\nreturn;\n}\nq.next =q.next.next;\n}\npublic void printAll() {\nNode p = head;\nwhile(p!=null ){\nSystem.out.print(p.data+\" \");\np= p.next;\n}\nSystem.out.println();\n}\n}\n</code></pre> <pre><code>class SinglyLikedList {\nclass Node (var data:Int,var next:Node?)\nprivate var head: Node? = null;\ncompanion object{\n@JvmStatic\nfun main(args: Array&lt;String&gt;) {\nval link = SinglyLinkedList()\nprintln(\"hello\")\nval data = intArrayOf(1, 2, 5, 3, 1)\nfor (i in data.indices) {\n//link.insertToHead(data[i]);\nlink.insertTail(data[i])\n}\nprintln(\"\u6253\u5370\u539f\u59cb:\")\nlink.printAll()\n// if (link.palindrome()) {\n//     println(\"\u56de\u6587\")\n// } else {\n//     println(\"\u4e0d\u662f\u56de\u6587\")\n// }\n}\n}\nfun findByValue(value:Int):Node?{\nvar p = head\nwhile (p != null &amp;&amp; p.data != value){\np = p.next\n}\nreturn p\n}\nfun findByIndex(index:Int):Node?{\nvar p = head\nvar pos = 0\nwhile (p != null &amp;&amp; pos != index){\np = p.next\n++pos\n}\nreturn p\n}\nfun insertToHead(value:Int){\nvar newNode = Node(value,null)\ninsertToHead(newNode)\n}\nfun insertToHead(newNode:Node){\nif(head == null){\nhead = newNode\n} else {\nnewNode.next = head\nhead = newNode\n}\n}\nfun insertTail(value:Int){\nval newNode = Node(value,null)\nif(head == null){\nhead = newNode\n} else {\nvar q = head\nwhile(q?.next !=null){\nq =q.next\n}\nnewNode.next = q?.next\nq?.next = newNode\n}\n}\nfun insertAfter(p:Node?,value:Int){\nval newNode = Node(value,null)\ninsertAfter(p,newNode)\n}\nfun insertAfter(p:Node?,newNode:Node){\nif(p == null) return\nnewNode.next = p.next\np.next = newNode\n}\nfun insertBerfore(p:Node?,value:Int){\nval newNode = Node(value,null)\ninsertBerfore(p,newNode)\n}\nfun insertBerfore(p:Node?,newNode:Node){\nif(p == null) return\nif(head == p){\ninsertToHead(newNode)\nreturn\n}\nvar q = head\nwhile(q!=null &amp;&amp; q.next !=p){\nq = q.next\n}\nif(q == null) return\nnewNode.next = q.next\nq.next = newNode\n}\nfun deleteByNode(p:Node?){\nif(p == null || head == null) return\nif(p == head){\nhead = head?.next\nreturn\n}\nvar q = head\nwhile(q!=null &amp;&amp; q.next !=p){\nq = q.next\n}\nif(q == null) return\nq.next = q.next?.next\n}\nfun deleteByValue(value:Int){\nif(head == null) return\nvar p = head\nvar q:Node? = null\nwhile(p!=null &amp;&amp; p.data != value){\nq = p\np = p.next\n}\nif(p == null) return\nif(q == null){\nhead = head?.next\n} else {\nq.next = q.next?.next\n}\n}\nfun printAll() {\nvar p = head\nwhile (p != null) {\nprint(\"${p.data} \")\np = p.next\n}\nprintln()\n}\n}\n</code></pre> <pre><code>class Node{\nconstructor(data){\nthis.data = data;\nthis.next = null;\n}\n}\nclass LinkedList {\nconstructor(){\nthis.head =  new Node(\"head\");\n}\nfindByValue(item){\nlet currentNode = this.head;\nwhile(currentNode !== null &amp;&amp; currentNode.data !== item){\ncurrentNode = currentNode.next;\n}\nreturn currentNode === null ? -1 : currentNode;\n}\nfindByIndex(index){\nlet currentNode = this.head.next;\nlet pos = 0;\nwhile(currentNode !== null &amp;&amp; pos !== index){\ncurrentNode = currentNode.next;\npos++;\n}\nconsole.log(currentNode);\nreturn currentNode === null ? -1 : currentNode;\n}\nappend(newElement){\nconst newNode = new Node(newElement);\nlet currentNode = this.head;\nwhile(currentNode.next){\ncurrentNode = currentNode.next;\n}\ncurrentNode.next = newNode;\n}\ninsert(newElement, element){\nconst currentNode = this.findByValue(element);\nif(currentNode === -1){\nconsole.log(\"\u672a\u627e\u5230\u63d2\u5165\u4f4d\u7f6e\");\nreturn;\n}\nconst newNode = new Node(newElement);\nnewNode.next = currentNode.next;\ncurrentNode.next = newNode;\n}\nfindPrev(item){\nlet currentNode = this.head;\nwhile(currentNode.next !== null &amp;&amp; currentNode.next.data !== item){\ncurrentNode = currentNode.next;\n}\nif(currentNode.next === null){\nreturn -1;\n}\nreturn currentNode;\n}\nremove(item){\nconst prevNode = this.findPrev(item);\nif(prevNode === -1){\nconsole.log(\"\u672a\u627e\u5230\u5143\u7d20\");\nreturn;\n}\nprevNode.next = prevNode.next.next;\n}\ndisplay(){\nlet currentNode = this.head.next;\nwhile(currentNode !== null){\nconsole.log(currentNode.data);\ncurrentNode = currentNode.next;\n}\n}\n}\n</code></pre> <pre><code>class Node:\ndef __init__(self, data, next=None):\nself.data = data\nself.next = next\nclass SinglyLinkedList:\ndef __init__(self):\nself.head = None\ndef find_by_value(self, value):\np = self.head\nwhile p and p.data != value:\np = p.next\nreturn p\ndef find_by_index(self, index):\np = self.head\npos = 0\nwhile p and pos != index:\np = p.next\npos += 1\nreturn p\ndef insert_value_to_head(self,value):\nnew_node = Node(value)\nself.insert_node_to_head(new_node)\ndef insert_node_to_head(self, new_node):\nif self.head is None:\nself.head = new_node\nelse:\nnew_node.next = self.head\nself.head = new_node     \ndef insert_value_after(self,node,value):\nif node is None:\nreturn\nnew_node = Node(value)\nself.insert_node_after(node,new_node)\ndef insert_node_after(self, node, new_node):\nif not node or not new_node:\nreturn\nnew_node.next = node.next     \nnode.next = new_node\ndef insert_value_before(self, node, value):\nnew_node = Node(value)\nself.insert_node_before(node, new_node)\ndef insert_node_before(self, node, new_node):\nif not self.head or not node or not new_node:\nreturn\nif self.head == node:\nself.insert_node_to_head(new_node)\nreturn\ncurrent = self.head\nwhile current and current.next != node:\ncurrent = current.next\nif not current:\nreturn\nnew_node.next = current.next\ncurrent.next = new_node    \ndef delete_by_node(self, node):\nif not self.head or not node:\nreturn\nif node == self.head:\nself.head = node.next\nreturn\ncurrent = self.head\nwhile current and current.next != node:\ncurrent = current.next\nif not current:\nreturn\ncurrent.next = current.next.next\ndef delete_by_value(self, value):\nif not self.head:\nreturn\ncurrent = self.head\nwhile current and current.data != value:\ncurrent = current.next\nif not current:\nreturn\nself.delete_by_node(current)\ndef __repr__(self):\nnums = []\ncurrent = self.head\nwhile current:\nnums.append(current.data)\ncurrent = current.next\nreturn \"-&gt;\".join(str(num) for num in nums)\ndef __iter__(self):\np = self.head\nwhile p:\nyield p.data\np = p.next \n</code></pre>"},{"location":"basic/algo/linklist_1/#_2","title":"\u5b9e\u73b0\u5faa\u73af\u94fe\u8868","text":"java <pre><code>public class LoopLinkedList&lt;T&gt; {\npublic static class Node&lt;T&gt; {\n// \u6570\u636e\npublic T data;\n// \u4e0b\u4e00\u4e2a\u8282\u70b9\npublic Node next;\npublic Node(T data) {\nthis.data = data;\n}\n}\npublic int size;\npublic Node head;\n/**\n     * \u6dfb\u52a0\u5143\u7d20\n     * \n     * @param obj\n     * @return\n     */\npublic Node add(T obj) {\nNode newNode = new Node(obj);\nif (size == 0) {\nhead = newNode;\nhead.next = head;\n} else {\nNode target = head;\nwhile (target.next != head) {\ntarget = target.next;\n}\ntarget.next = newNode;\nnewNode.next = head;\n}\nsize++;\nreturn newNode;\n}\n/**\n     * \u5728\u6307\u5b9a\u4f4d\u7f6e\u63d2\u5165\u5143\u7d20\n     * \n     * @return\n     */\npublic Node insert(int index, T obj) {\nif (index &gt;= size) {\nreturn null;\n}\nNode newNode = new Node(obj);\nif (index == 0) {\nnewNode.next = head;\nhead = newNode;\n} else {\nNode target = head;\nNode previous = head;\nint pos = 0;\nwhile (pos != index) {\nprevious = target;\ntarget = target.next;\npos++;\n}\nprevious.next = newNode;\nnewNode.next = target;\n}\nsize++;\nreturn newNode;\n}\n/**\n     * \u5220\u9664\u94fe\u8868\u5934\u90e8\u5143\u7d20\n     * \n     * @return\n     */\npublic Node removeHead() {\nif (size &gt; 0) {\nNode node = head;\nNode target = head;\nwhile (target.next != head) {\ntarget = target.next;\n}\nhead = head.next;\ntarget.next = head;\nsize--;\nreturn node;\n} else {\nreturn null;\n}\n}\n/**\n     * \u5220\u9664\u6307\u5b9a\u4f4d\u7f6e\u5143\u7d20\n     * \n     * @return\n     */\npublic Node remove(int index) {\nif (index &gt;= size) {\nreturn null;\n}\nNode result = head;\nif (index == 0) {\nhead = head.next;\n} else {\nNode target = head;\nNode previous = head;\nint pos = 0;\nwhile (pos != index) {\nprevious = target;\ntarget = target.next;\npos++;\n}\nprevious.next = target.next;\nresult = target;\n}\nsize--;\nreturn result;\n}\n/**\n     * \u5220\u9664\u6307\u5b9a\u5143\u7d20\n     * \n     * @return\n     */\npublic Node removeNode(T obj) {\nNode target = head;\nNode previoust = head;\nif (obj.equals(target.data)) {\nhead = head.next;\nsize--;\n} else {\nwhile (target.next != null) {\nif (obj.equals(target.next.data)) {\nprevioust = target;\ntarget = target.next;\nsize--;\nbreak;\n} else {\ntarget = target.next;\nprevioust = previoust.next;\n}\n}\nprevioust.next = target.next;\n}\nreturn target;\n}\n/**\n     * \u8fd4\u56de\u6307\u5b9a\u5143\u7d20\n     * \n     * @return\n     */\npublic Node findNode(T obj) {\nNode target = head;\nwhile (target.next != null) {\nif (obj.equals(target.data)) {\nreturn target;\n} else {\ntarget = target.next;\n}\n}\nreturn null;\n}\n/**\n     * \u8f93\u51fa\u94fe\u8868\u5143\u7d20\n     */\npublic void show() {\nif (size &gt; 0) {\nNode node = head;\nint length = size;\nSystem.out.print(\"[\");\nwhile (length &gt; 0) {\nif (length == 1) {\nSystem.out.print(node.data);\n} else {\nSystem.out.print(node.data + \",\");\n}\nnode = node.next;\nlength--;\n}\nSystem.out.println(\"]\");\n} else {\nSystem.out.println(\"[]\");\n}\n}\n}\n</code></pre>"},{"location":"basic/algo/linklist_1/#_3","title":"\u5b9e\u73b0\u53cc\u5411\u94fe\u8868","text":"java <pre><code>public class DoubleLinkedList&lt;T&gt; {\npublic static class SNode&lt;T&gt; {\npublic T data;\npublic SNode&lt;T&gt; pre;\npublic SNode&lt;T&gt; next;\npublic SNode() {\n}\npublic SNode(T data) {\nthis.data = data;\n}\n}\n/**\n     * \u53cc\u5411\u94fe\u8868\u7684\u5934\u7ed3\u70b9\uff0c\u5b58\u50a8\u7b2c\u4e00\u4e2a\u6709\u6548\u7ed3\u70b9\u7684\u57fa\u5730\u5740\n     */\nprivate SNode&lt;T&gt; head;\nprivate int size;\npublic DoubleLinkedList() {\nhead = null;\nsize = 0;\n}\npublic int getSize() {\nreturn size;\n}\npublic boolean isEmpty() {\nreturn size == 0;\n}\n/**\n     * \u63d2\u5165\u7ed3\u70b9\u5230\u53cc\u5411\u94fe\u8868\u672b\u5c3e\n     * @param newNode\n     */\npublic void addLast(SNode&lt;T&gt; newNode) {\nif (isEmpty()) {\nhead = newNode;\nhead.next = null;\nhead.pre = null;\nsize++;\n} else {\nSNode&lt;T&gt; temp = head;\nwhile (temp.next != null) {\ntemp = temp.next;\n}\n// \u5c06\u65b0\u7ed3\u70b9\u52a0\u5165\u53cc\u5411\u94fe\u8868\nadd(temp, newNode);\n}\n}\n/**\n     * \u5c06\u65b0\u7684\u8282\u70b9\u63d2\u5165\u5230\u6307\u5b9a\u8282\u70b9\u540e\n     *\n     * @param preNode \u6307\u5b9a\u8282\u70b9\n     * @param newNode \u65b0\u7684\u8282\u70b9\n     */\npublic void add(SNode&lt;T&gt; preNode, SNode&lt;T&gt; newNode) {\n// \u8981\u63d2\u5165\u5230\u94fe\u8868\u672b\u5c3e\u65f6\uff0c\u4e0d\u9700\u8981\u7ef4\u62a4\u4e0b\u4e00\u4e2a\u7ed3\u70b9\u7684\u524d\u9a71\u6307\u9488\nif (preNode.next != null) {\npreNode.next.pre = newNode;\n}\nnewNode.next = preNode.next;\nnewNode.pre = preNode;\npreNode.next = newNode;\nsize++;\n}\n/**\n     * \u5220\u9664\u6570\u636e\u57df\u4e3a\u6307\u5b9a\u503c\u7684\u5143\u7d20\n     *\n     * @param e\n     */\npublic void del(T e) {\nSNode&lt;T&gt; temp = head;\nwhile (temp != null) {\nif (temp.data.equals(e)) {\n// \u7ef4\u62a4 head\uff0chead \u6c38\u8fdc\u6307\u5411\u53cc\u5411\u94fe\u8868\u7b2c\u4e00\u4e2a\u6709\u6548\u7ed3\u70b9\ntemp.next.pre = temp.pre;\nif (temp == head) {\nhead = head.next;\nhead.pre = null;\n} else {\ntemp.pre.next = temp.next;\n}\nreturn;\n}\n// temp \u5411\u540e\u79fb\ntemp = temp.next;\n}\n}\n/**\n     * \u5220\u9664\u6307\u5b9a\u4f4d\u7f6e\u7684\u7ed3\u70b9\n     *\n     * @param k\n     */\npublic void del(int k) {\nSNode&lt;T&gt; delNode = find(k);\ndelNode.next.pre = delNode.pre;\nif (delNode == head) {\nhead = head.next;\nhead.pre = null;\n} else {\ndelNode.pre.next = delNode.next.next;\n}\n}\n/**\n     * \u627e\u5230\u53cc\u5411\u94fe\u8868\u7b2c k \u4e2a\u7ed3\u70b9\n     *\n     * @param k k \u4ece 0 \u5f00\u59cb\n     * @return\n     */\npublic SNode&lt;T&gt; find(int k) {\nif (k &gt; size || k &lt; 0) {\nthrow new RuntimeException(\"\u4f20\u5165\u7684\u53c2\u6570 k \u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e\u96f6\u5e76\u4e14\u5c0f\u4e8e\u7b49\u4e8e\u94fe\u8868\u7684\u957f\u5ea6 size\");\n}\nint cnt = 0;\nSNode&lt;T&gt; t = head;\nwhile (cnt != k) {\ncnt++;\nt = t.next;\n}\nreturn t;\n}\n/**\n     * \u6253\u5370\u5355\u94fe\u8868\u6240\u6709\u6709\u6548\u8282\u70b9\n     *\n     * @return\n     */\npublic String printAll() {\nStringBuilder sb = new StringBuilder();\nSNode&lt;T&gt; temp = head;\nwhile (temp != null) {\nsb.append(temp.data);\nsb.append(\" \");\ntemp = temp.next;\n}\nreturn sb.toString();\n}\n}\n</code></pre>"},{"location":"basic/algo/linklist_2/","title":"\u5e38\u89c1\u94fe\u8868\u64cd\u4f5c","text":""},{"location":"basic/algo/linklist_2/#_1","title":"\u5e38\u89c1\u94fe\u8868\u64cd\u4f5c","text":"<ul> <li> <p>\u5b9e\u73b0\u5355\u94fe\u8868\u53cd\u8f6c</p> </li> <li> <p>\u5b9e\u73b0\u4e24\u4e2a\u6709\u5e8f\u7684\u94fe\u8868\u5408\u5e76\u4e3a\u4e00\u4e2a\u6709\u5e8f\u94fe\u8868   \u8f93\u5165\uff1a1-&gt;2-&gt;4, 1-&gt;3-&gt;4   \u8f93\u51fa\uff1a1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</p> </li> <li> <p>\u5b9e\u73b0\u6c42\u94fe\u8868\u7684\u4e2d\u95f4\u7ed3\u70b9</p> </li> <li> <p>\u94fe\u8868\u4e2d\u73af\u7684\u68c0\u6d4b : \u5982\u679c\u94fe\u8868\u4e2d\u6709\u67d0\u4e2a\u8282\u70b9\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fde\u7eed\u8ddf\u8e2anext \u6307\u9488\u518d\u6b21\u5230\u8fbe\uff0c\u5219\u94fe\u8868\u4e2d\u5b58\u5728\u73af</p> </li> <li> <p>\u5220\u9664\u94fe\u8868\u5012\u6570\u7b2cn\u4e2a\u7ed3\u70b9</p> </li> <li> <p>\u5224\u65ad\u4e00\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u56de\u6587</p> </li> </ul> javapython <pre><code>public class LinkedListAlgo {\n// \u5355\u94fe\u8868\u53cd\u8f6c\npublic static Node reverse(Node list) {\nNode curr = list, pre = null;\nwhile (curr != null) {\nNode next = curr.next;\ncurr.next = pre;\npre = curr;\ncurr = next;\n}\nreturn pre;\n}\n// \u68c0\u6d4b\u73af\npublic static boolean checkCircle(Node list) {\nif (list == null) return false;\nNode fast = list.next;\nNode slow = list;\nwhile (fast != null &amp;&amp; fast.next != null) {\nfast = fast.next.next;\nslow = slow.next;\nif (slow == fast) return true;\n}\nreturn false;\n}\n// \u6709\u5e8f\u94fe\u8868\u5408\u5e76\npublic ListNode mergeTwoLists(ListNode l1, ListNode l2) {\nListNode soldier = new ListNode(0); //\u5229\u7528\u54e8\u5175\u7ed3\u70b9\u7b80\u5316\u5b9e\u73b0\u96be\u5ea6\nListNode p = soldier;\nwhile ( l1 != null &amp;&amp; l2 != null ){\nif ( l1.val &lt; l2.val ){\np.next = l1;\nl1 = l1.next;\n}\nelse{\np.next = l2;\nl2 = l2.next;\n}\np = p.next;\n}\nif (l1 != null) { p.next = l1; }\nif (l2 != null) { p.next = l2; }\nreturn soldier.next;   }\n// \u5220\u9664\u5012\u6570\u7b2cK\u4e2a\u7ed3\u70b9\npublic static Node deleteLastKth(Node list, int k) {\nNode fast = list;\nint i = 1;\nwhile (fast != null &amp;&amp; i &lt; k) {\nfast = fast.next;\n++i;\n}\nif (fast == null) return list;\nNode slow = list;\nNode prev = null;\nwhile (fast.next != null) {\nfast = fast.next;\nprev = slow;\nslow = slow.next;\n}\nif (prev == null) {\nlist = list.next;\n} else {\nprev.next = prev.next.next;\n}\nreturn list;\n}\n// \u6c42\u4e2d\u95f4\u7ed3\u70b9\npublic static Node findMiddleNode(Node list) {\nif (list == null) return null;\nNode fast = list;\nNode slow = list;\nwhile (fast != null &amp;&amp; fast.next != null) {\nfast = fast.next.next;\nslow = slow.next;\n}\nreturn slow;\n}\n// \u662f\u5426\u662f\u56de\u6587\u7ed3\u6784\npublic static boolean palindrome(Node head){\nif(head == null || head.next == null) return true;\nNode fast = head;\nNode slow = head;\nwhile(fast.next != null &amp;&amp; fast.next.next != null){\nfast = fast.next.next;\nslow = slow.next;\n}\nNode right = slow.next;\nNode pre = null;\nwhile(right != null){\nNode next = right.next;\nright.next = pre;\npre = right;\nright = next;\n}\nNode left = head;\nwhile(pre != null){\nif(pre.data != left.data) return false;\npre = pre.next;\nleft = left.next;\n}\nreturn true;\n}\npublic static void printAll(Node list) {\nNode p = list;\nwhile (p != null) {\nSystem.out.print(p.data + \" \");\np = p.next;\n}\nSystem.out.println();\n}\npublic static Node createNode(int value) {\nreturn new Node(value, null);\n}\npublic static class Node {\nprivate int data;\nprivate Node next;\npublic Node(int data, Node next) {\nthis.data = data;\nthis.next = next;\n}\npublic int getData() {\nreturn data;\n}\n}\n}\n</code></pre> <pre><code>from math import fabs\nfrom typing import Optional\nimport sys\nsys.path.append('singly_linked_list')\nfrom singly_linked_list import SinglyLinkedList,Node\n# class Node:\n#     def __init__(self, data: int, next=None):\n#         self.data = data\n#         self.next = next\ndef reverse_linked_list(head: Node) -&gt; Optional[Node]:\n\"\"\"Reverse a linked list.\n    Args:\n        head (Node): The head of the linked list.\n    Returns:\n        Node: The head of the reversed linked list.\n    \"\"\"\nif not head or not head.next:\nreturn head\nprev = None\ncurrent = head\nwhile current:\nnext = current.next\ncurrent.next = prev\nprev = current\ncurrent = next\nreturn prev\ndef is_palindrome(head: Node) -&gt; bool:\n\"\"\"Check if a linked list is a palindrome.\n    Args:\n        head (Node): The head of the linked list.\n    Returns:\n        bool: True if the linked list is a palindrome, False otherwise.\n    \"\"\"\nif not head or not head.next:\nreturn True\nprint(head)    \nslow = head\nfast = head.next\nwhile fast and fast.next:\nslow = slow.next\nfast = fast.next.next\n# reverse the second half of the linked list\nprev = None\ncurrent = slow.next\nwhile current:\nnext = current.next\ncurrent.next = prev\nprev = current\ncurrent = next\n# compare the first half and the reversed second half\nwhile prev:\nif prev.data != head.data:\nreturn False\nprev = prev.next\nhead = head.next\nreturn True\ndef has_cycle(head: Node) -&gt; bool:\n\"\"\"Check if a linked list has a cycle.\n    \u8bbe\u7f6e\u5feb\u3001\u6162\u4e24\u79cd\u6307\u9488\uff0c\u5feb\u6307\u9488\u6bcf\u6b21\u8de8\u4e24\u6b65\uff0c\u6162\u6307\u9488\u6bcf\u6b21\u8de8\u4e00\u6b65\uff0c\u5982\u679c\u5feb\u6307\u9488\u6ca1\u6709\u4e0e\u6162\u6307\u9488\u76f8\u9047\u800c\u662f\u987a\u5229\u5230\u8fbe\u94fe\u8868\u5c3e\u90e8\n            \u8bf4\u660e\u6ca1\u6709\u73af\uff1b\u5426\u5219\uff0c\u5b58\u5728\u73af\n    Args:\n        head (Node): The head of the linked list.\n    Returns:\n        bool: True if the linked list has a cycle, False otherwise.\n    \"\"\"\nif not head or not head.next:\nreturn False\nslow = head\nfast = head.next\nwhile slow != fast:\nif not fast or not fast.next:\nreturn False\nslow = slow.next\nfast = fast.next.next\nreturn True\ndef find_middle_node(head: Node) -&gt; Optional[Node]:\n\"\"\"Find the middle node of a linked list.\n           \u4e3b\u4f53\u601d\u60f3:\n            \u8bbe\u7f6e\u5feb\u3001\u6162\u4e24\u79cd\u6307\u9488\uff0c\u5feb\u6307\u9488\u6bcf\u6b21\u8de8\u4e24\u6b65\uff0c\u6162\u6307\u9488\u6bcf\u6b21\u8de8\u4e00\u6b65\uff0c\u5219\u5f53\u5feb\u6307\u9488\u5230\u8fbe\u94fe\u8868\u5c3e\u90e8\u7684\u65f6\u5019\uff0c\u6162\u6307\u9488\u6307\u5411\u94fe\u8868\u7684\u4e2d\u95f4\u8282\u70b9\n    Args:\n        head (Node): The head of the linked list.\n    Returns:\n        Node: The middle node of the linked list.\n    \"\"\"\nif not head or not head.next:\nreturn head\nslow = head\nfast = head.next\nwhile fast and fast.next:\nslow = slow.next\nfast = fast.next.next\ndef merge_sorted_list(l1: Node, l2: Node) -&gt; Optional[Node]:\n\"\"\"Merge two sorted linked list.\n    Args:\n        l1 (Node): The head of the first linked list.\n        l2 (Node): The head of the second linked list.\n    Returns:\n        Node: The head of the merged linked list.\n    \"\"\"\nif not l1:\nreturn l2\nif not l2:\nreturn l1\nif l1.data &lt; l2.data:\nl1.next = merge_sorted_list(l1.next, l2)\nreturn l1\nelse:\nl2.next = merge_sorted_list(l1, l2.next)\nreturn l2\ndef merge_sorted_list2(l1:Node,l2:Node) -&gt; Optional[Node]:\n\"\"\"Merge two sorted linked list.\n    Args:\n        l1 (Node): The head of the first linked list.\n        l2 (Node): The head of the second linked list.\n    Returns:\n        Node: The head of the merged linked list.\n    \"\"\"\nif not l1:\nreturn l2\nif not l2:\nreturn l1\ndummy = Node(0)\ncurrent = dummy\nwhile l1 and l2:\nif l1.data &lt; l2.data:\ncurrent.next = l1\nl1 = l1.next\nelse:\ncurrent.next = l2\nl2 = l2.next\ncurrent = current.next\nif l1:\ncurrent.next = l1\nif l2:\ncurrent.next = l2\nreturn dummy.next\ndef remove_nth_from_end(head:Node,n:int) -&gt; Optional[Node]:\n\"\"\"Remove the nth node from the end of a linked list.\n            \u4e3b\u4f53\u601d\u8def\uff1a\n            \u8bbe\u7f6e\u5feb\u3001\u6162\u4e24\u4e2a\u6307\u9488\uff0c\u5feb\u6307\u9488\u5148\u884c\uff0c\u6162\u6307\u9488\u4e0d\u52a8\uff1b\u5f53\u5feb\u6307\u9488\u8de8\u4e86N\u6b65\u4ee5\u540e\uff0c\u5feb\u3001\u6162\u6307\u9488\u540c\u65f6\u5f80\u94fe\u8868\u5c3e\u90e8\u79fb\u52a8\uff0c\n            \u5f53\u5feb\u6307\u9488\u5230\u8fbe\u94fe\u8868\u5c3e\u90e8\u7684\u65f6\u5019\uff0c\u6162\u6307\u9488\u6240\u6307\u5411\u7684\u5c31\u662f\u94fe\u8868\u7684\u5012\u6570\u7b2cN\u4e2a\u8282\u70b9\n    Args:\n        head (Node): The head of the linked list.\n        n (int): The nth node from the end.\n    Returns:\n        Node: The head of the linked list.\n    \"\"\"\nif not head or not head.next:\nreturn None\ndummy = Node(0)\ndummy.next = head\nfirst = dummy\nsecond = dummy\nfor i in range(n):\nfirst = first.next\nwhile first.next:\nfirst = first.next\nsecond = second.next\nsecond.next = second.next.next\nreturn dummy.next           \n</code></pre>"},{"location":"basic/algo/linklist_lru/","title":"\u5b9e\u73b0LRU\u7f13\u5b58","text":""},{"location":"basic/algo/linklist_lru/#lru","title":"\u57fa\u4e8e\u6570\u7ec4\u5b9e\u73b0\u7684LRU\u7f13\u5b58","text":"java <pre><code>import java.util.HashMap;\nimport java.util.Map;\n/**\n *\n * \u57fa\u4e8e\u6570\u7ec4\u5b9e\u73b0\u7684LRU\u7f13\u5b58\n * 1. \u7a7a\u95f4\u590d\u6742\u5ea6\u4e3aO(n)\n * 2. \u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(n)\n * 3. \u4e0d\u652f\u6301null\u7684\u7f13\u5b58\n */\npublic class LRUBasedArray&lt;T&gt; {\nprivate static final int DEFAULT_CAPACITY = (1 &lt;&lt; 3);\nprivate int capacity;\nprivate int count;\nprivate T[] value;\nprivate Map&lt;T, Integer&gt; holder;\npublic LRUBasedArray() {\nthis(DEFAULT_CAPACITY);\n}\npublic LRUBasedArray(int capacity) {\nthis.capacity = capacity;\nvalue = (T[]) new Object[capacity];\ncount = 0;\nholder = new HashMap&lt;T, Integer&gt;(capacity);\n}\n/**\n     * \u6a21\u62df\u8bbf\u95ee\u67d0\u4e2a\u503c\n     * @param object\n     */\npublic void offer(T object) {\nif (object == null) {\nthrow new IllegalArgumentException(\"\u8be5\u7f13\u5b58\u5bb9\u5668\u4e0d\u652f\u6301null!\");\n}\nInteger index = holder.get(object);\nif (index == null) {\nif (isFull()) {\nremoveAndCache(object);\n} else {\ncache(object, count);\n}\n} else {\nupdate(index);\n}\n}\n/**\n     * \u82e5\u7f13\u5b58\u4e2d\u6709\u6307\u5b9a\u7684\u503c\uff0c\u5219\u66f4\u65b0\u4f4d\u7f6e\n     * @param end\n     */\npublic void update(int end) {\nT target = value[end];\nrightShift(end);\nvalue[0] = target;\nholder.put(target, 0);\n}\n/**\n     * \u7f13\u5b58\u6570\u636e\u5230\u5934\u90e8\uff0c\u4f46\u8981\u5148\u53f3\u79fb\n     * @param object\n     * @param end \u6570\u7ec4\u53f3\u79fb\u7684\u8fb9\u754c\n     */\npublic void cache(T object, int end) {\nrightShift(end);\nvalue[0] = object;\nholder.put(object, 0);\ncount++;\n}\n/**\n     * \u7f13\u5b58\u6ee1\u7684\u60c5\u51b5\uff0c\u8e22\u51fa\u540e\uff0c\u518d\u7f13\u5b58\u5230\u6570\u7ec4\u5934\u90e8\n     * @param object\n     */\npublic void removeAndCache(T object) {\nT key = value[--count];\nholder.remove(key);\ncache(object, count);\n}\n/**\n     * end\u5de6\u8fb9\u7684\u6570\u636e\u7edf\u4e00\u53f3\u79fb\u4e00\u4f4d\n     * @param end\n     */\nprivate void rightShift(int end) {\nfor (int i = end - 1; i &gt;= 0; i--) {\nvalue[i + 1] = value[i];\nholder.put(value[i], i + 1);\n}\n}\npublic boolean isContain(T object) {\nreturn holder.containsKey(object);\n}\npublic boolean isEmpty() {\nreturn count == 0;\n}\npublic boolean isFull() {\nreturn count == capacity;\n}\n@Override\npublic String toString() {\nStringBuilder sb = new StringBuilder();\nfor (int i = 0; i &lt; count; i++) {\nsb.append(value[i]);\nsb.append(\" \");\n}\nreturn sb.toString();\n}\n}\n</code></pre>"},{"location":"basic/algo/linklist_lru/#lru_1","title":"\u57fa\u4e8e\u5355\u94fe\u8868LRU\u7b97\u6cd5","text":"java <pre><code>/**\n *  \u57fa\u4e8e\u5355\u94fe\u8868LRU\u7b97\u6cd5\uff08java\uff09\n */\npublic class LRUBaseLinkedList {\n/**\n     * \u9ed8\u8ba4\u94fe\u8868\u5bb9\u91cf\n     */\nprivate final static Integer DEFAULT_CAPACITY = 10;\n/**\n     * \u5934\u7ed3\u70b9\n     */\nprivate SNode&lt;T&gt; headNode;\n/**\n     * \u94fe\u8868\u957f\u5ea6\n     */\nprivate Integer length;\n/**\n     * \u94fe\u8868\u5bb9\u91cf\n     */\nprivate Integer capacity;\npublic LRUBaseLinkedList() {\nthis.headNode = new SNode&lt;&gt;();\nthis.capacity = DEFAULT_CAPACITY;\nthis.length = 0;\n}\npublic LRUBaseLinkedList(Integer capacity) {\nthis.headNode = new SNode&lt;&gt;();\nthis.capacity = capacity;\nthis.length = 0;\n}\npublic void add(T data) {\nSNode preNode = findPreNode(data);\n// \u94fe\u8868\u4e2d\u5b58\u5728\uff0c\u5220\u9664\u539f\u6570\u636e\uff0c\u518d\u63d2\u5165\u5230\u94fe\u8868\u7684\u5934\u90e8\nif (preNode != null) {\ndeleteElemOptim(preNode);\nintsertElemAtBegin(data);\n} else {\nif (length &gt;= this.capacity) {\n//\u5220\u9664\u5c3e\u7ed3\u70b9\ndeleteElemAtEnd();\n}\nintsertElemAtBegin(data);\n}\n}\n/**\n     * \u5220\u9664preNode\u7ed3\u70b9\u4e0b\u4e00\u4e2a\u5143\u7d20\n     *\n     * @param preNode\n     */\nprivate void deleteElemOptim(SNode preNode) {\nSNode temp = preNode.getNext();\npreNode.setNext(temp.getNext());\ntemp = null;\nlength--;\n}\n/**\n     * \u94fe\u8868\u5934\u90e8\u63d2\u5165\u8282\u70b9\n     *\n     * @param data\n     */\nprivate void intsertElemAtBegin(T data) {\nSNode next = headNode.getNext();\nheadNode.setNext(new SNode(data, next));\nlength++;\n}\n/**\n     * \u83b7\u53d6\u67e5\u627e\u5230\u5143\u7d20\u7684\u524d\u4e00\u4e2a\u7ed3\u70b9\n     *\n     * @param data\n     * @return\n     */\nprivate SNode findPreNode(T data) {\nSNode node = headNode;\nwhile(node.getNext() !=null){\nif (data.equals(node.getNext().getElement())) {\nreturn node;\n}\nnode = node.getNext();\n}\nreturn null;\n}\n/**\n     * \u5220\u9664\u5c3e\u7ed3\u70b9\n     */\nprivate void deleteElemAtEnd() {\nSNode ptr = headNode;\n// \u7a7a\u94fe\u8868\u76f4\u63a5\u8fd4\u56de\nif(ptr.getNext() == null){\nreturn;\n}\n// \u5012\u6570\u7b2c\u4e8c\u4e2a\u7ed3\u70b9\nwhile(ptr.getNext().getNext()!=null){\nptr = ptr.getNext();\n}\nSNode tmp = ptr.getNext();\nptr.setNext(null);\ntmp = null;\nlength --;\n}\nprivate void printAll() {\nSNode node = headNode.getNext();\nwhile (node != null) {\nSystem.out.print(node.getElement() + \",\");\nnode = node.getNext();\n}\nSystem.out.println();\n}\npublic class SNode&lt;T&gt;{\nprivate T element ; private SNode next;\npublic SNode(T element) {\nthis.element = element;\n}\npublic SNode(T element, SNode next) {\nthis.element = element;\nthis.next = next;\n}\npublic SNode() {\nthis.next = null;\n}\npublic T getElement() {\nreturn element;\n}\npublic void setElement(T element) {\nthis.element = element;\n}\npublic SNode getNext() {\nreturn next;\n}\npublic void setNext(SNode next) {\nthis.next = next;\n}\n}\n}\n</code></pre>"},{"location":"basic/algo/linklist_lru/#lru_2","title":"\u54c8\u5e0c\u8868+\u53cc\u5411\u94fe\u8868\u5b9e\u73b0LRU","text":"<p>https://leetcode.cn/problems/lru-cache/?favorite=2cktkvj</p> python <pre><code>class DbListNode(object):\ndef __init__(self, key, val):\nself.key = key\nself.val = val\nself.next = None\nself.prev = None\nclass LRUCache:\n'''\n        leet code: 146\n        \u8fd0\u7528\u4f60\u6240\u638c\u63e1\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8bbe\u8ba1\u548c\u5b9e\u73b0\u4e00\u4e2a  LRU (\u6700\u8fd1\u6700\u5c11\u4f7f\u7528) \u7f13\u5b58\u673a\u5236\u3002\n        \u5b83\u5e94\u8be5\u652f\u6301\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u83b7\u53d6\u6570\u636e get \u548c \u5199\u5165\u6570\u636e put \u3002\n        \u83b7\u53d6\u6570\u636e get(key) - \u5982\u679c\u5bc6\u94a5 (key) \u5b58\u5728\u4e8e\u7f13\u5b58\u4e2d\uff0c\u5219\u83b7\u53d6\u5bc6\u94a5\u7684\u503c\uff08\u603b\u662f\u6b63\u6570\uff09\uff0c\u5426\u5219\u8fd4\u56de -1\u3002\n        \u5199\u5165\u6570\u636e put(key, value) - \u5982\u679c\u5bc6\u94a5\u4e0d\u5b58\u5728\uff0c\u5219\u5199\u5165\u5176\u6570\u636e\u503c\u3002\n            \u5f53\u7f13\u5b58\u5bb9\u91cf\u8fbe\u5230\u4e0a\u9650\u65f6\uff0c\u5b83\u5e94\u8be5\u5728\u5199\u5165\u65b0\u6570\u636e\u4e4b\u524d\u5220\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u503c\uff0c\u4ece\u800c\u4e3a\u65b0\u7684\u6570\u636e\u503c\u7559\u51fa\u7a7a\u95f4\n    \u54c8\u5e0c\u8868+\u53cc\u5411\u94fe\u8868\n    \u54c8\u5e0c\u8868: \u67e5\u8be2 O(1)\n    \u53cc\u5411\u94fe\u8868: \u6709\u5e8f, \u589e\u5220\u64cd\u4f5c O(1)\n    '''\ndef __init__(self, capacity: int):\nself.capacity = capacity\nself.size = 0\nself.hash = {}\n# self.head\u548cself.tail\u4f5c\u4e3a\u54e8\u5175\u8282\u70b9, \u907f\u514d\u8d8a\u754c\nself.head = DbListNode(-1, -1)\nself.tail = DbListNode(-1, -1)\nself.head.next = self.tail\nself.tail.prev = self.head\ndef get(self,key: int) -&gt; int:\nif key not in self.hash:\nreturn -1\nnode = self.hash[key]\nself._move_to_head(node)\nreturn node.val\ndef put(self, key: int, value: int) -&gt; None:\nif key in self.hash:\nnode = self.hash[key]\nnode.val = value\nself._move_to_head(node)\nelse:\nnode = DbListNode(key, value)\nself.hash[key] = node\nself._add_to_head(node)\nself.size += 1\nif self.size &gt; self.capacity:\nremoved = self._remove_tail()\nself.hash.pop(removed.key)\nself.size -= 1\ndef _move_to_head(self, node):\nself._remove_node(node)\nself._add_to_head(node)\ndef _remove_node(self, node):\nnode.prev.next = node.next\nnode.next.prev = node.prev\ndef _add_to_head(self, node):\nnode.next = self.head.next\nnode.prev = self.head\nself.head.next.prev = node\nself.head.next = node\ndef _remove_tail(self):\nnode = self.tail.prev\nself._remove_node(node)\nreturn node\ndef __repr__(self):\nres = []\nnode = self.head.next\nwhile node != self.tail:\nres.append(f'{node.key}:{node.val}')\nnode = node.next\nreturn '-&gt;'.join(res)\ndef __str__(self):\nreturn self.__repr__()\ndef __len__(self):\nreturn self.size\ndef __iter__(self):\nnode = self.head.next\nwhile node != self.tail:\nyield node\nnode = node.next\ndef __getitem__(self, key):\nreturn self.get(key)\ndef __setitem__(self, key, value):\nself.put(key, value)\ndef __contains__(self, key):\nreturn key in self.hash                                                       \n</code></pre>"},{"location":"basic/algo/queue/","title":"\u5e38\u89c1\u961f\u5217\u5b9e\u73b0","text":""},{"location":"basic/algo/queue/#_1","title":"\u7528\u6570\u7ec4\u5b9e\u73b0\u4e00\u4e2a\u987a\u5e8f\u961f\u5217","text":"javapythonjs <pre><code>public class ArrayQueue {\nprivate int[] items; // \u6570\u7ec4\nprivate int count; // \u961f\u5217\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\nprivate  int capacity; // \u961f\u5217\u7684\u5bb9\u91cf\npublic ArrayQueue(int capacity) {\nthis.items = new int[capacity];\nthis.capacity = capacity;\nthis.count = 0;\n}\npublic boolean enqueue(int item){\nif(count == capacity){\nreturn false;\n}\nitems[count] = item;\ncount++;\nreturn true;\n}\npublic int dequeue(){\nif(count == 0){\nreturn -1;\n}\nint temp = items[0];\nfor(int i = 0; i &lt; count - 1; i++){\nitems[i] = items[i+1];\n}\ncount--;\nreturn temp;\n}\npublic void printAll(){\nfor(int i = 0; i &lt; count; i++){\nSystem.out.print(items[i] + \" \");\n}\nSystem.out.println();\n}\n}\n</code></pre> <pre><code>class ArrayQueue:\ndef __init__(self, capacity):\nself._items = []\nself._capacity = capacity\nself._head = 0\nself._tail = 0\ndef enqueue(self, item:str) -&gt; bool:\nif self._tail == self._capacity:\nif self._head == 0:\nreturn False\nfor i in range(self._head, self._tail):\nself._items[i - self._head] = self._items[i]\nself._tail -= self._head\nself._head = 0\nself._items.insert(self._tail, item)\nself._tail += 1\nreturn True\ndef dequeue(self) -&gt; str:\nif self._head == self._tail:\nreturn None\nret = self._items[self._head]\nself._head += 1\nreturn ret\ndef __repr__(self) -&gt; str:\nreturn \" \".join(item for item in self._items[self._head:self._tail]) \n</code></pre> <pre><code>class ArrayQueue{\nconstructor(){\nthis.items = [];\n}\nenqueue(item){\nthis.items.push(item);\n}\ndequeue(){\nreturn this.items.shift();\n}\nfront(){\nreturn this.items[0];\n}\nisEmpty(){\nreturn this.items.length === 0;\n}\nsize(){\nreturn this.items.length;\n}\nclear(){\nthis.items = [];\n}\nprint(){\nconsole.log(this.items.toString());\n}\n}\n</code></pre>"},{"location":"basic/algo/queue/#_2","title":"\u7528\u6570\u7ec4\u5b9e\u73b0\u4e00\u4e2a\u987a\u5e8f\u961f\u5217(\u52a8\u6001)","text":"java <pre><code>public class DynamicArrayQueue {\n// \u6570\u7ec4\uff1aitems\uff0c\u6570\u7ec4\u5927\u5c0f\uff1an\nprivate String[] items;\nprivate int n = 0;\n// head\u8868\u793a\u961f\u5934\u4e0b\u6807\uff0ctail\u8868\u793a\u961f\u5c3e\u4e0b\u6807\nprivate int head = 0;\nprivate int tail = 0;\n// \u7533\u8bf7\u4e00\u4e2a\u5927\u5c0f\u4e3acapacity\u7684\u6570\u7ec4\npublic DynamicArrayQueue(int capacity) {\nitems = new String[capacity];\nn = capacity;\n}\n// \u5165\u961f\u64cd\u4f5c\uff0c\u5c06item\u653e\u5165\u961f\u5c3e\npublic boolean enqueue(String item) {\n// tail == n\u8868\u793a\u961f\u5217\u672b\u5c3e\u6ca1\u6709\u7a7a\u95f4\u4e86\nif (tail == n) {\n// tail ==n &amp;&amp; head==0\uff0c\u8868\u793a\u6574\u4e2a\u961f\u5217\u90fd\u5360\u6ee1\u4e86\nif (head == 0)\nreturn false;\n// \u6570\u636e\u642c\u79fb\nfor (int i = head; i &lt; tail; ++i) {\nitems[i - head] = items[i];\n}\n// \u642c\u79fb\u5b8c\u4e4b\u540e\u91cd\u65b0\u66f4\u65b0head\u548ctail\ntail -= head;\nhead = 0;\n}\nitems[tail] = item;\ntail++;\nreturn true;\n}\n// \u51fa\u961f\npublic String dequeue() {\n// \u5982\u679chead == tail \u8868\u793a\u961f\u5217\u4e3a\u7a7a\nif (head == tail)\nreturn null;\nString ret = items[head];\n++head;\nreturn ret;\n}\npublic void printAll() {\nfor (int i = head; i &lt; tail; ++i) {\nSystem.out.print(items[i] + \" \");\n}\nSystem.out.println();\n}\n}\n</code></pre>"},{"location":"basic/algo/queue/#_3","title":"\u7528\u94fe\u8868\u5b9e\u73b0\u4e00\u4e2a\u94fe\u5f0f\u961f\u5217","text":"javapythonjs <pre><code>public class QueueBasedOnLinkedList {\nprivate static class Node {\nprivate int data;\nprivate Node next;\npublic Node(int data, Node next) {\nthis.data = data;\nthis.next = next;\n}\n}\nprivate Node head = null;\nprivate Node tail = null;\npublic void enqueue(int value) {\nif (tail == null) {\nNode newNode = new Node(value, null);\nhead = newNode;\ntail = newNode;\n} else {\ntail.next = new Node(value, null);\ntail = tail.next;\n}\n}\npublic int dequeue() {\nif (head == null) {\nreturn -1;\n}\nint value = head.data;\nhead = head.next;\nif (head == null) {\ntail = null;\n}\nreturn value;\n}\n}\n</code></pre> <pre><code>class Node:\ndef __init__(self, data):\nself.data = data\nself.next = None\nclass LinkedQueue:\ndef __init__(self) -&gt; None:\nself._head = None\nself._tail = None\ndef enqueue(self, value:str) -&gt; bool:\nnode = Node(value)\nif self._tail is None:\nself._head = node\nelse:\nself._tail.next = node\nself._tail = node\nreturn True\ndef dequeue(self) -&gt; str:\nif self._head is Node:\nreturn None\nret = self._head.data\nself._head = self._head.next\nreturn ret     \ndef __repr__(self) -&gt; str:\nif self._head is None:\nreturn \"Empty queue\"\ns = \"\"\nnode = self._head\nwhile node is not None:\ns += str(node.data) + \" \"\nnode = node.next\nreturn s \n</code></pre> <pre><code>class Node {\nconstructor(data){\nthis.data = data;\nthis.next = null;\n}\n}\nclass LinkedQueue{\nconstructor(){\nthis.head = null;\nthis.tail = null;\n}\nenqueue(item){\nif(this.tail == null){\nthis.tail = new Node(item);\nthis.head = this.tail;\n}else{\nthis.tail.next = new Node(item);\nthis.tail = this.tail.next;\n}\n}\ndequeue(){\nif(this.head !=null){\nconst value = this.head.data\nthis.head = this.head.next\nreturn value\n} else {\nreturn -1\n}\n}\nfront(){\nif(this.head !=null){\nreturn this.head.data\n} else {\nreturn -1\n}\n}\nisEmpty(){\nreturn this.head == null;\n}\nsize(){\nlet p = this.head\nlet count = 0\nwhile(p){\ncount++\np = p.next\n}\nreturn count\n}\nclear(){\nthis.head = null\nthis.tail = null\n}\nprint(){\nlet p = this.head\nwhile(p){\nconsole.log(p.data)\np = p.next\n}\n}\n}\n</code></pre>"},{"location":"basic/algo/queue/#_4","title":"\u5b9e\u73b0\u4e00\u4e2a\u5faa\u73af\u961f\u5217","text":"javapythonjs <pre><code>public class CircularQueue {\nprivate int[] items;\nprivate int n = 0;\nprivate int head = 0;\nprivate int tail = 0;\npublic CircularQueue(int capacity) {\nitems = new int[capacity];\nn = capacity;\n}\npublic boolean enqueue(int item){\nif((tail+1) % n == head) return false;\nitems[tail] = item;\ntail = (tail+1)%n;\nreturn true;\n}\npublic int dequeue(){\n// \u5982\u679chead == tail \u8868\u793a\u961f\u5217\u4e3a\u7a7a\nif (head == tail) return -1;\nint ret = items[head];\nhead = (head +1)%n;\nreturn ret;\n}\npublic void printAll(){\nif (head == tail) return;\nfor (int i = head; i != tail; i = (i+1)%n) {\nSystem.out.print(items[i] + \" \");\n}\nSystem.out.println();\n}\n}\n</code></pre> <pre><code>class CircularQueue:\ndef __init__(self, capacity):\nself._items = []\nself._capacity = capacity + 1\nself._head = 0\nself._tail = 0\ndef enqueue(self,item:str) -&gt; bool:\nif (self._tail + 1) % self._capacity == self._head:\nreturn False\nself._items.insert(self._tail, item)\nself._tail = (self._tail +1) % self._capacity\nreturn True\ndef dequeue(self) -&gt; str:\nif self._head == self._tail:\nreturn None\nret = self._items[self._head]\nself._head = (self._head + 1) % self._capacity\nreturn ret  \ndef __repr__(self) -&gt; str:\nif self._head &lt; self._tail:\nreturn \" \".join(item for item in self._items[self._head:self._tail])\nelse:\nreturn \" \".join(item for item in self._items[self._head:] + self._items[:self._tail]) \n</code></pre> <pre><code>class CicularQueue {\nconstructor(size) {\nthis.queue = new Array(size);\nthis.head = 0;\nthis.tail = 0;\nthis.size = size;\n}\nenqueue(item) {\nif (this.isFull()) {\nreturn false;\n}\nthis.queue[this.tail] = item;\nthis.tail = (this.tail + 1) % this.size;\nreturn true;\n}\ndequeue() {\nif (this.isEmpty()) {\nreturn null;\n}\nconst item = this.queue[this.head];\nthis.head = (this.head + 1) % this.size;\nreturn item;\n}\nisFull() {\nreturn (this.tail + 1) % this.size === this.head;\n}\nisEmpty() {\nreturn this.head === this.tail;\n}\n}\n</code></pre>"},{"location":"basic/algo/queue/#_5","title":"\u8bbe\u8ba1\u5b9e\u73b0\u53cc\u7aef\u961f\u5217","text":"python <pre><code>class CircularDeque:\ndef __init__(self, k: int):\nself.size = k\nself.deque = []\ndef insertFront(self, value: int) -&gt; bool:\nif len(self.deque) == self.size:\nreturn False\nself.deque.insert(0, value)\nreturn True\ndef insertLast(self, value: int) -&gt; bool:\nif len(self.deque) == self.size:\nreturn False\nself.deque.append(value)\nreturn True\ndef deleteFront(self) -&gt; bool:\nif len(self.deque) == 0:\nreturn False\nself.deque.pop(0)\nreturn True\ndef deleteLast(self) -&gt; bool:\nif len(self.deque) == 0:\nreturn False\nself.deque.pop()\nreturn True\ndef getFront(self) -&gt; int:\nif len(self.deque) == 0:\nreturn -1\nreturn self.deque[0]\ndef getRear(self) -&gt; int:\nif len(self.deque) == 0:\nreturn -1\nreturn self.deque[-1]\ndef isEmpty(self) -&gt; bool:\nreturn len(self.deque) == 0\ndef isFull(self) -&gt; bool:\nreturn len(self.deque) == self.size   \n</code></pre>"},{"location":"basic/algo/recursive/","title":"\u5e38\u89c1\u9012\u5f52\u7b97\u6cd5","text":""},{"location":"basic/algo/recursive/#fnfn-1fn-2","title":"\u7f16\u7a0b\u5b9e\u73b0\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6c42\u503c f(n)=f(n-1)+f(n-2)","text":"javapython <pre><code>//\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6c42\u503c 1,1,2,3,5,8,13...\npublic int fib(int n){\nif(n ==1 || n==2)return 1;\nreturn fib(n-1)+fib(n-2);\n}\n</code></pre> <pre><code>\"\"\"\n\u6590\u6ce2\u90a3\u5951\u6570\u5217\u6c42\u503c 1,1,2,3,5,8,13...\n\"\"\"\ndef fib(n):\nif n == 1 or n == 2:\nreturn 1\nreturn fib(n-1) + fib(n-2)\n</code></pre>"},{"location":"basic/algo/recursive/#n","title":"\u7f16\u7a0b\u5b9e\u73b0\u6c42\u9636\u4e58 n!","text":"javapython <pre><code>//\u6c42\u9636\u4e58 n!\npublic int factorial(int n){\nif(n==1)return 1;\nreturn n* factorial(n-1);\n}\n</code></pre> <pre><code>\"\"\"\n\u6c42\u9636\u4e58 n!\n\"\"\"\ndef factorial(n):\nif n == 1:\nreturn 1\nreturn n * factorial(n-1)\n</code></pre>"},{"location":"basic/algo/recursive/#_1","title":"\u7f16\u7a0b\u5b9e\u73b0\u4e00\u7ec4\u6570\u636e\u96c6\u5408\u7684\u5168\u6392\u5217","text":"javapython <pre><code>//\u5168\u6392\u5217\npublic void permute(char[] chars, int start, int end){\nif(start == end){\nSystem.out.println(chars);\n}else{\nfor(int i=start;i&lt;=end;i++){\nswap(chars, start,i);\npermute(chars,start+1,end);\nswap(chars, start,i);\n}\n}\n}\npublic void swap(char[] chars, int i, int j){\nchar temp = chars[i];\nchars[i] = chars[j];\nchars[j] = temp;\n}\n</code></pre> <pre><code>\"\"\"\n\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u96c6\u5408A{a1,a2,...,an},\u5176\u4e2d\u7684n\u4e2a\u5143\u7d20\u4e92\u4e0d\u76f8\u540c\uff0c\u5982\u4f55\u8f93\u51fa\u8fd9n\u4e2a\u5143\u7d20\u7684\u6240\u6709\u6392\u5217\n\"\"\"\ndef permute(A, start, end):\nif start == end:\nprint(A)\nelse:\nfor i in range(start, end):\n# \u4ea4\u6362A[start]\u548cA[i]\nA[start], A[i] = A[i], A[start]\npermute(A, start+1, end)\nA[start], A[i] = A[i], A[start]         \n</code></pre>"},{"location":"basic/algo/recursive/#_2","title":"\u722c\u697c\u68af","text":"javapython <pre><code>//\u722c\u697c\u68af\npublic int climbStairs(int n){\nif(n==1)return 1;\nif(n==2)return 2;\nreturn climbStairs(n-1)+climbStairs(n-2);\n}\n</code></pre> <pre><code>\"\"\"\n\u722c\u697c\u68af\n\"\"\"\ndef climbStairs(n):\nif n == 1:\nreturn 1\nif n == 2:\nreturn 2\nreturn climbStairs(n-1) + climbStairs(n-2)\n</code></pre>"},{"location":"basic/algo/sort/","title":"\u5e38\u89c1\u6392\u5e8f\u7b97\u6cd5","text":""},{"location":"basic/algo/sort/#_1","title":"\u5192\u6ce1\u6392\u5e8f","text":"javapython <pre><code>public static void bubbleSort(int[] a, int n) {\nif (n &lt;= 1)\nreturn;\nfor (int i = 0; i &lt; n; ++i) {\nboolean flag = false;\nfor (int j = 0; j &lt; n - i - 1; ++j) {\nif (a[j] &gt; a[j + 1]) {\n// swap\nint tmp = a[j];\na[j] = a[j + 1];\na[j + 1] = tmp;\nflag = true;\n}\n}\nif (!flag)\nbreak; // \u6ca1\u6709\u6570\u636e\u4ea4\u6362\uff0c\u63d0\u524d\u9000\u51fa\n}\n}\n</code></pre> <pre><code>def bubbleSort(self, arr):\nfor i in range(1, len(arr)):\nfor j in range(0, len(arr)-i):\nif arr[j] &gt; arr[j+1]:\narr[j], arr[j+1] = arr[j+1], arr[j]\nreturn arr\n</code></pre>"},{"location":"basic/algo/sort/#_2","title":"\u9009\u62e9\u6392\u5e8f","text":"javapython <pre><code>public static void selectionSort(int[] a, int n) {\nif (n &lt;= 1)\nreturn;\nfor (int i = 0; i &lt; n - 1; ++i) {\n// \u67e5\u627e\u6700\u5c0f\u503c\nint minIndex = i;\nfor (int j = i + 1; j &lt; n; ++j) {\nif (a[j] &lt; a[minIndex]) {\nminIndex = j;\n}\n}\n//swap\nint tmp = a[i];\na[i] = a[minIndex];\na[minIndex] = tmp;\n}\n}\n</code></pre> <pre><code>def selectionSort(self, arr):\nfor i in range(0, len(arr)):\n# \u8bb0\u5f55\u6700\u5c0f\u6570\u7684\u7d22\u5f15\nminIndex = i\nfor j in range(i+1, len(arr)):\nif arr[j] &lt; arr[minIndex]:\nminIndex = j\n# i \u4e0d\u662f\u6700\u5c0f\u6570\u65f6\uff0c\u5c06 i \u548c\u6700\u5c0f\u6570\u8fdb\u884c\u4ea4\u6362\nif i != minIndex:\narr[i], arr[minIndex] = arr[minIndex], arr[i]\nreturn arr\n</code></pre>"},{"location":"basic/algo/sort/#_3","title":"\u63d2\u5165\u6392\u5e8f","text":"javapython <pre><code>public static void insertionSort(int[] a, int n) {\nif (n &lt;= 1)\nreturn;\nfor (int i = 1; i &lt; n; ++i) {\nint value = a[i];\nint j = i - 1;\n// \u67e5\u627e\u8981\u63d2\u5165\u7684\u4f4d\u7f6e\u5e76\u79fb\u52a8\u6570\u636e\nfor (; j &gt;= 0; --j) {\nif (a[j] &gt; value) {\na[j + 1] = a[j];\n} else {\nbreak;\n}\n}\na[j + 1] = value;\n}\n}\n</code></pre> <pre><code>def insertionSort(self, arr):\nfor i in range(len(arr)):\npreIndex = i - 1\ncurrent = arr[i]\nwhile preIndex &gt;= 0 and arr[preIndex] &gt; current:\narr[preIndex+1] = arr[preIndex]\npreIndex -= 1\narr[preIndex + 1] = current\nreturn arr\n</code></pre>"},{"location":"basic/algo/sort/#_4","title":"\u5f52\u5e76\u6392\u5e8f","text":"javapython <pre><code>public static int[] mergeSort(int[] sourceArray){\n// \u5bf9 arr \u8fdb\u884c\u62f7\u8d1d\uff0c\u4e0d\u6539\u53d8\u53c2\u6570\u5185\u5bb9\nint[] arr = Arrays.copyOf(sourceArray, sourceArray.length);\nif (arr.length &lt; 2) {\nreturn arr;\n}\nint middle = (int) Math.floor(arr.length / 2);\nint[] left = Arrays.copyOfRange(arr, 0, middle);\nint[] right = Arrays.copyOfRange(arr, middle, arr.length);\nreturn merge(mergeSort(left), mergeSort(right));\n}\nprivate static int[] merge(int[] left, int[] right) {\nint[] result = new int[left.length + right.length];\nint i = 0;\nwhile (left.length &gt; 0 &amp;&amp; right.length &gt; 0) {\nif (left[0] &lt;= right[0]) {\nresult[i++] = left[0];\nleft = Arrays.copyOfRange(left, 1, left.length);\n} else {\nresult[i++] = right[0];\nright = Arrays.copyOfRange(right, 1, right.length);\n}\n}\nwhile (left.length &gt; 0) {\nresult[i++] = left[0];\nleft = Arrays.copyOfRange(left, 1, left.length);\n}\nwhile (right.length &gt; 0) {\nresult[i++] = right[0];\nright = Arrays.copyOfRange(right, 1, right.length);\n}\nreturn result;\n}\n</code></pre> <pre><code>def mergeSort(arr):\nimport math\nif(len(arr)&lt;2):\nreturn arr\nmiddle = math.floor(len(arr)/2)\nleft, right = arr[0:middle], arr[middle:]\nreturn merge(mergeSort(left), mergeSort(right))\ndef merge(self, left, right):\nresult = []\nwhile left and right:\nif left[0] &lt;= right[0]:\nresult.append(left.pop(0))\nelse:\nresult.append(right.pop(0))\nwhile left:\nresult.append(left.pop(0))\nwhile right:\nresult.append(right.pop(0))\nreturn result\n</code></pre>"},{"location":"basic/algo/sort/#_5","title":"\u5feb\u901f\u6392\u5e8f","text":"javapython <pre><code>private int[] quickSort(int[] arr, int left, int right) {\nif (left &lt; right) {\nint partitionIndex = partition(arr, left, right);\nquickSort(arr, left, partitionIndex - 1);\nquickSort(arr, partitionIndex + 1, right);\n}\nreturn arr;\n}\nprivate int partition(int[] arr, int left, int right) {\n// \u8bbe\u5b9a\u57fa\u51c6\u503c\uff08pivot\uff09\nint pivot = left;\nint index = pivot + 1;\nfor (int i = index; i &lt;= right; i++) {\nif (arr[i] &lt; arr[pivot]) {\nswap(arr, i, index);\nindex++;\n}\n}\nswap(arr, pivot, index - 1);\nreturn index - 1;\n}\nprivate void swap(int[] arr, int i, int j) {\nint temp = arr[i];\narr[i] = arr[j];\narr[j] = temp;\n}\n</code></pre> <pre><code>def quickSort(self, arr, left=None, right=None):\nleft = 0 if not isinstance(left, (int, float)) else left\nright = len(arr)-1 if not isinstance(right, (int, float)) else right\nif left &lt; right:\npartitionIndex = self.partition(arr, left, right)\nself.quickSort(arr, left, partitionIndex-1)\nself.quickSort(arr, partitionIndex+1, right)\nreturn arr\ndef partition(self, arr, left, right):\npivot = left\nindex = pivot + 1\ni = index\nwhile i &lt;= right:\nif arr[i] &lt; arr[pivot]:\nself.swap(arr, i, index)\nindex += 1\ni += 1\nself.swap(arr, pivot, index - 1)\nreturn index - 1\ndef swap(arr, i, j):\narr[i], arr[j] = arr[j], arr[i]           \n</code></pre>"},{"location":"basic/algo/stack_1/","title":"\u987a\u5e8f\u6808\u3001\u94fe\u5f0f\u6808","text":""},{"location":"basic/algo/stack_1/#_1","title":"\u7528\u6570\u7ec4\u5b9e\u73b0\u4e00\u4e2a\u987a\u5e8f\u6808","text":"javapython <pre><code>public class ArrayStack {\nprivate String[] items; // \u6570\u7ec4\nprivate int count; // \u6808\u4e2d\u5143\u7d20\u4e2a\u6570\nprivate int n; // \u6808\u7684\u5927\u5c0f\n/**\n     * \u521d\u59cb\u5316\u6570\u7ec4\uff0c\u7533\u8bf7\u4e00\u4e2a\u5927\u5c0f\u4e3an\u7684\u6570\u7ec4\u7a7a\u95f4\n     * \n     * @param n\n     */\npublic ArrayStack(int n) {\nthis.items = new String[n];\nthis.n = n;\nthis.count = 0;\n}\npublic boolean push(String item) {\n// \u6570\u7ec4\u7a7a\u95f4\u4e0d\u591f\u4e86\uff0c\u76f4\u63a5\u8fd4\u56defalse\uff0c\u5165\u6808\u5931\u8d25\u3002\nif (count == n)\nreturn false;\n// \u5c06item\u653e\u5230\u4e0b\u6807\u4e3acount\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e14count\u52a0\u4e00\nitems[count] = item;\n++count;\nreturn true;\n}\n/**\n     * \u51fa\u6808\u64cd\u4f5c\n     * \n     * @return\n     */\npublic String pop() {\n// \u6808\u4e3a\u7a7a\uff0c\u5219\u76f4\u63a5\u8fd4\u56denull\nif (count == 0)\nreturn null;\n// \u8fd4\u56de\u4e0b\u6807\u4e3acount-1\u7684\u6570\u7ec4\u5143\u7d20\uff0c\u5e76\u4e14\u6808\u4e2d\u5143\u7d20\u4e2a\u6570count\u51cf\u4e00\nString tmp = items[count - 1];\n--count;\nreturn tmp;\n}\n}\n</code></pre> <pre><code>class ArrayStack:\ndef __init__(self):\nself._data = []\ndef __len__(self):\nreturn len(self._data)\ndef is_empty(self):\nreturn len(self._data) == 0\ndef push(self, e):\nself._data.append(e)\ndef top(self):\nif self.is_empty():\nraise Empty('Stack is empty')\nreturn self._data[-1]\ndef pop(self):\nif self.is_empty():\nraise Empty('Stack is empty')\nreturn self._data.pop()\nclass Empty(Exception):\npass    \n</code></pre>"},{"location":"basic/algo/stack_1/#_2","title":"\u7528\u94fe\u8868\u5b9e\u73b0\u4e00\u4e2a\u94fe\u5f0f\u6808","text":"javapythonjavascript <pre><code>public class StackBasedOnLinkedList {\npublic static class Node {\nprivate int data;\nprivate Node next;\npublic Node(int data, Node next) {\nthis.data = data;\nthis.next = next;\n}\npublic int getData() {\nreturn data;\n}\n}\nprivate Node top = null;\npublic void push(int value) {\nNode newNode = new Node(value, null);\nif (top == null) {\ntop = newNode;\n} else {\nnewNode.next = top;\ntop = newNode;\n}\n}\npublic int pop() {\nif (top == null)\nreturn -1;\nint value = top.data;\ntop = top.next;\nreturn value;\n}\npublic void printAll() {\nNode p = top;\nwhile (p != null) {\nSystem.out.print(p.data + \" \");\np = p.next;\n}\nSystem.out.println();\n}\n}\n</code></pre> <pre><code>class Node:\ndef __init__(self, data):\nself.data = data\nself.next = None\nclass LinkedStack:\ndef __init__(self):\nself.head = None\ndef push(self, data):\nnode = Node(data)\nnode.next = self.head\nself.head = node\ndef pop(self):\nif self.head is None:\nreturn None\ndata = self.head.data\nself.head = self.head.next\nreturn data\ndef peek(self):\nif self.head is None:\nreturn None\nreturn self.head.data\ndef is_empty(self):\nreturn self.head is None\ndef __str__(self):\nif self.head is None:\nreturn \"Empty stack\"\ns = \"\"\nnode = self.head\nwhile node is not None:\ns += str(node.data) + \" \"\nnode = node.next\nreturn s\n</code></pre> <pre><code>class Node {\nconstructor(data, next) {\nthis.data = data;\nthis.next = next;\n}\n}\nclass StackBasedLinkedList{\nconstructor() {\nthis.top = null;\n}\npush(value){\nconst node = new Node(value, null)\nif(this.top === null){\nthis.top = node\n} else {\nnode.next = this.top\nthis.top = node\n}\n}\npop(){\nif(this.top === null) return -1\nconst value = this.top.data\nthis.top = this.top.next\nreturn value\n}\nclear(){\nthis.top = null\n}\nprintAll(){\nlet p = this.top\nwhile(p){\nconsole.log(p.data)\np = p.next\n}\n}\n}\n</code></pre>"},{"location":"basic/algo/stack_2/","title":"\u5e38\u89c1\u6808\u64cd\u4f5c","text":""},{"location":"basic/algo/stack_2/#_1","title":"\u7f16\u7a0b\u6a21\u62df\u5b9e\u73b0\u4e00\u4e2a\u6d4f\u89c8\u5668\u7684\u524d\u8fdb\u3001\u540e\u9000\u529f\u80fd","text":"javapython <pre><code>public class SampleBrowser {\nprivate String currentPage;\nprivate LinkedListBasedStack backStack;\nprivate LinkedListBasedStack forwardStack;\npublic static void main(String[] args) {\nSampleBrowser browser = new SampleBrowser();\nbrowser.open(\"http://www.baidu.com\");\nbrowser.open(\"http://news.baidu.com/\");\nbrowser.open(\"http://news.baidu.com/ent\");\nbrowser.goBack();\nbrowser.goBack();\nbrowser.goForward();\nbrowser.open(\"http://www.qq.com\");\nbrowser.goForward();\nbrowser.goBack();\nbrowser.goForward();\nbrowser.goBack();\nbrowser.goBack();\nbrowser.goBack();\nbrowser.goBack();\nbrowser.checkCurrentPage();\n}\npublic SampleBrowser() {\nthis.backStack = new LinkedListBasedStack();\nthis.forwardStack = new LinkedListBasedStack();\n}\npublic void open(String url) {\nif (this.currentPage != null) {\nthis.backStack.push(this.currentPage);\nthis.forwardStack.clear();\n}\nshowUrl(url, \"Open\");\n}\npublic boolean canGoBack() {\nreturn this.backStack.size() &gt; 0;\n}\npublic boolean canGoForward() {\nreturn this.forwardStack.size() &gt; 0;\n}\npublic String goBack() {\nif (this.canGoBack()) {\nthis.forwardStack.push(this.currentPage);\nString backUrl = this.backStack.pop();\nshowUrl(backUrl, \"Back\");\nreturn backUrl;\n}\nSystem.out.println(\"* Cannot go back, no pages behind.\");\nreturn null;\n}\npublic String goForward() {\nif (this.canGoForward()) {\nthis.backStack.push(this.currentPage);\nString forwardUrl = this.forwardStack.pop();\nshowUrl(forwardUrl, \"Foward\");\nreturn forwardUrl;\n}\nSystem.out.println(\"** Cannot go forward, no pages ahead.\");\nreturn null;\n}\npublic void showUrl(String url, String prefix) {\nthis.currentPage = url;\nSystem.out.println(prefix + \" page == \" + url);\n}\npublic void checkCurrentPage() {\nSystem.out.println(\"Current page is: \" + this.currentPage);\n}\npublic static class LinkedListBasedStack {\nprivate int size;\nprivate Node top;\nstatic Node createNode(String data, Node next) {\nreturn new Node(data, next);\n}\npublic void clear() {\nthis.top = null;\nthis.size = 0;\n}\npublic void push(String data) {\nNode node = createNode(data, this.top);\nthis.top = node;\nthis.size++;\n}\npublic String pop() {\nNode popNode = this.top;\nif (popNode == null) {\nSystem.out.println(\"Stack is empty.\");\nreturn null;\n}\nthis.top = popNode.next;\nif (this.size &gt; 0) {\nthis.size--;\n}\nreturn popNode.data;\n}\npublic String getTopData() {\nif (this.top == null) {\nreturn null;\n}\nreturn this.top.data;\n}\npublic int size() {\nreturn this.size;\n}\npublic void print() {\nSystem.out.println(\"Print stack:\");\nNode currentNode = this.top;\nwhile (currentNode != null) {\nString data = currentNode.getData();\nSystem.out.print(data + \"\\t\");\ncurrentNode = currentNode.next;\n}\nSystem.out.println();\n}\npublic static class Node {\nprivate String data;\nprivate Node next;\npublic Node(String data) {\nthis(data, null);\n}\npublic Node(String data, Node next) {\nthis.data = data;\nthis.next = next;\n}\npublic void setData(String data) {\nthis.data = data;\n}\npublic String getData() {\nreturn this.data;\n}\npublic void setNext(Node next) {\nthis.next = next;\n}\npublic Node getNext() {\nreturn this.next;\n}\n}\n}\n}\n</code></pre> <pre><code>from linked_stack import LinkedStack\nclass Browser:\ndef __init__(self):\nself.back_stack = LinkedStack()\nself.forward_stack = LinkedStack()\ndef can_forward(self):\nreturn not self.forward_stack.is_empty()\ndef can_back(self):\nreturn not self.back_stack.is_empty()\ndef open(self, url):\nself.back_stack.push(url)\ndef back(self):\nif self.can_back():\nself.forward_stack.push(self.back_stack.pop())\nreturn self.back_stack.peek()\nelse:\nreturn None    \ndef forward(self):\nif self.can_forward():\nself.back_stack.push(self.forward_stack.pop())\nreturn self.back_stack.peek()\nelse:\nreturn None\ndef __repr__(self) -&gt; str:\nreturn f\"Browser: {self.back_stack} {self.forward_stack}\" \nif __name__ == \"__main__\":\nbrowser = Browser()\nbrowser.open(\"google.com\")\nbrowser.open(\"facebook.com\")\nbrowser.open(\"youtube.com\")\nprint(browser)\nprint(browser.back())\nprint(browser.back())\nprint(browser.back())\nprint(browser.back())\nprint(browser.forward())\nprint(browser.forward())\nprint(browser.forward())\nprint(browser.forward())\nprint(browser.forward())\nprint(browser)  \n</code></pre>"},{"location":"basic/algo/stack_2/#s","title":"\u7ed9\u5b9a\u4e00\u4e2a\u53ea\u5305\u62ec '('\uff0c')'\uff0c'{'\uff0c'}'\uff0c'['\uff0c']' \u7684\u5b57\u7b26\u4e32 s \uff0c\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u6709\u6548","text":"<p>\u6709\u6548\u5b57\u7b26\u4e32\u9700\u6ee1\u8db3\uff1a</p> <ul> <li> <p>\u5de6\u62ec\u53f7\u5fc5\u987b\u7528\u76f8\u540c\u7c7b\u578b\u7684\u53f3\u62ec\u53f7\u95ed\u5408\u3002</p> </li> <li> <p>\u5de6\u62ec\u53f7\u5fc5\u987b\u4ee5\u6b63\u786e\u7684\u987a\u5e8f\u95ed\u5408\u3002</p> </li> <li> <p>\u6bcf\u4e2a\u53f3\u62ec\u53f7\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684\u76f8\u540c\u7c7b\u578b\u7684\u5de6\u62ec\u53f7\u3002</p> </li> </ul> python <pre><code>def isValid(s):\nstack = []\nfor c in s:\nif c == '(' or c == '[' or c == '{':\nstack.append(c)\nelse:\nif len(stack) == 0:\nreturn False\ntop = stack.pop()\nif c == ')' and top != '(':\nreturn False\nif c == ']' and top != '[':\nreturn False\nif c == '}' and top != '{':\nreturn False\nreturn len(stack) == 0\n</code></pre>"},{"location":"basic/algo/tree/","title":"\u4e8c\u53c9\u67e5\u627e\u6811","text":""},{"location":"basic/algo/tree/#_1","title":"\u5b9e\u73b0\u4e00\u4e2a\u4e8c\u53c9\u67e5\u627e\u6811","text":"java <pre><code>// \u5b9e\u73b0\u4e00\u4e2a\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u5e76\u4e14\u652f\u6301\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u627e\u64cd\u4f5c\npublic class BinarySearchTree {\nprivate Node tree;\npublic Node find(int data) {\nNode p = tree;\nwhile (p != null) {\nif (data &lt; p.data)\np = p.left;\nelse if (data &gt; p.data)\np = p.right;\nelse\nreturn p;\n}\nreturn null;\n}\npublic void insert(int data) {\nif (tree == null) {\ntree = new Node(data);\nreturn;\n}\nNode p = tree;\nwhile (p != null) {\nif (data &gt; p.data) {\nif (p.right == null) {\np.right = new Node(data);\nreturn;\n}\np = p.right;\n} else {\nif (p.left == null) {\np.left = new Node(data);\nreturn;\n}\np = p.left;\n}\n}\n}\npublic void delete(int data) {\nNode p = tree; // p\u6307\u5411\u8981\u5220\u9664\u7684\u8282\u70b9\uff0c\u521d\u59cb\u5316\u6307\u5411\u6839\u8282\u70b9\nNode pp = null; // pp\u8bb0\u5f55\u7684\u662fp\u7684\u7236\u8282\u70b9\nwhile (p != null &amp;&amp; p.data != data) {\npp = p;\nif (data &gt; p.data)\np = p.right;\nelse\np = p.left;\n}\nif (p == null)\nreturn;\n// \u8981\u5220\u9664\u7684\u8282\u70b9\u6709\u4e24\u4e2a\u5b50\u8282\u70b9\nif (p.left != null &amp;&amp; p.right != null) { // \u67e5\u627e\u53f3\u5b50\u6811\u4e2d\u6700\u5c0f\u8282\u70b9\nNode minP = p.right;\nNode minPP = p; // minPP\u8868\u793aminP\u7684\u7236\u8282\u70b9\nwhile (minP.left != null) {\nminPP = minP;\nminP = minP.left;\n}\np.data = minP.data; // \u5c06minP\u7684\u6570\u636e\u66ff\u6362\u5230p\u4e2d\np = minP; // \u4e0b\u9762\u5c31\u53d8\u6210\u4e86\u5220\u9664minP\u4e86\npp = minPP;\n}\n// \u5220\u9664\u8282\u70b9\u662f\u53f6\u5b50\u8282\u70b9\u6216\u8005\u4ec5\u6709\u4e00\u4e2a\u5b50\u8282\u70b9\nNode child; // p\u7684\u5b50\u8282\u70b9\nif (p.left != null)\nchild = p.left;\nelse if (p.right != null)\nchild = p.right;\nelse\nchild = null;\nif (pp == null)\ntree = child; // \u5220\u9664\u7684\u662f\u6839\u8282\u70b9\nelse if (pp.left == p)\npp.left = child;\nelse\npp.right = child;\n}\npublic Node findMin() {\nif (tree == null)\nreturn null;\nNode p = tree;\nwhile (p.left != null) {\np = p.left;\n}\nreturn p;\n}\npublic Node findMax() {\nif (tree == null)\nreturn null;\nNode p = tree;\nwhile (p.right != null) {\np = p.right;\n}\nreturn p;\n}\n//\u67e5\u627e\u67d0\u4e2a\u8282\u70b9\u7684\u540e\u7ee7\u8282\u70b9\npublic Node successor(Node x){\nif(x.right!=null){\nreturn min(x.right);\n}\nNode y = x.parent;\nwhile(y!=null &amp;&amp; x==y.right){\nx = y;\ny = y.parent;\n}\nreturn y;\n}\n//\u67e5\u627e\u67d0\u4e2a\u8282\u70b9\u7684\u524d\u9a71\u8282\u70b9\npublic Node predecessor(Node x){\nif(x.left!=null){\nreturn max(x.left);\n}\nNode y = x.parent;\nwhile(y!=null &amp;&amp; x==y.left){\nx = y;\ny = y.parent;\n}\nreturn y;\n}\n// \u4e8c\u5206\u641c\u7d22\u6811\u7684\u524d\u5e8f\u904d\u5386\npublic void preOrder() {\npreOrder(tree);\n}\n// \u4e8c\u5206\u641c\u7d22\u6811\u7684\u4e2d\u5e8f\u904d\u5386\npublic void inOrder() {\ninOrder(tree);\n}\n// \u4e8c\u5206\u641c\u7d22\u6811\u7684\u540e\u5e8f\u904d\u5386\npublic void postOrder() {\npostOrder(tree);\n}\n// \u524d\u5e8f\u904d\u5386:\u5148\u6253\u5370\u8fd9\u4e2a\u8282\u70b9\uff0c\u7136\u540e\u518d\u6253\u5370\u5b83\u7684\u5de6\u5b50\u6811\uff0c\u6700\u540e\u6253\u5370\u5b83\u7684\u53f3\u5b50\u6811\u3002\npublic preOrder(Node node){\nif(node == null) return;\nSystem.out.println(node.data);\npreOrder(node.left);\npreOrder(node.right);\n}\n// \u4e2d\u5e8f\u904d\u5386:\u5148\u6253\u5370\u5b83\u7684\u5de6\u5b50\u6811\uff0c\u7136\u540e\u518d\u6253\u5370\u5b83\u672c\u8eab\uff0c\u6700\u540e\u6253\u5370\u5b83\u7684\u53f3\u5b50\u6811\u3002\npublic inOrder(Node node){\nif(node == null) return;\ninOrder(node.left);\nSystem.out.println(node.data);\ninOrder(node.right);\n}\n// \u540e\u5e8f\u904d\u5386:\u5148\u6253\u5370\u5b83\u7684\u5de6\u5b50\u6811\uff0c\u7136\u540e\u518d\u6253\u5370\u5b83\u7684\u53f3\u5b50\u6811\uff0c\u6700\u540e\u6253\u5370\u8fd9\u4e2a\u8282\u70b9\u672c\u8eab\u3002\npublic postOrder(Node node){\nif(node == null) return;\npostOrder(node.left);\npostOrder(node.right);\nSystem.out.println(node.data);\n}\n// \u4e8c\u5206\u641c\u7d22\u6811\u7684\u5c42\u5e8f\u904d\u5386\npublic levelOrder(){\nLinkedList&lt;Node&gt; q = new LinkedList&lt;&gt;();\nq.add(tree);\nwhile(!q.isEmpty()){\nNode node = q.remove();\nSystem.out.println(node.data);\nif(node.left!=null){\nq.add(node.left);\n}\nif(node.right!=null){\nq.add(node.right);\n}\n}\n}\n//[\u7ffb\u8f6c\u4e8c\u53c9\u6811](https://leetcode.cn/problems/invert-binary-tree/)\npublic Node invertTree(Node root) {\nif (root == null)\nreturn null;\nNode left = invertTree(root.left);\nNode right = invertTree(root.right);\nroot.left = right;\nroot.right = left;\nreturn root;\n}\n//[\u4e8c\u53c9\u6811\u7684\u6700\u5927\u6df1\u5ea6](https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/)\npublic Node maxDepth(Node root) {\nif (root == null)\nreturn 0;\nint left = maxDepth(root.left);\nint right = maxDepth(root.right);\nreturn Math.max(left, right) + 1;\n}\n//[\u9a8c\u8bc1\u4e8c\u53c9\u67e5\u627e\u6811](https://leetcode-cn.com/problems/validate-binary-search-tree/)\npublic boolean isValidBST(TreeNode root) {\nreturn isValidBST(root, Long.MIN_VALUE, Long.MAX_VALUE);\n}\npublic boolean isValidBST(TreeNode node, long lower, long upper) {\nif (node == null) {\nreturn true;\n}\nif (node.val &lt;= lower || node.val &gt;= upper) {\nreturn false;\n}\nreturn isValidBST(node.left, lower, node.val) &amp;&amp; isValidBST(node.right, node.val, upper);\n}\npublic static class Node {\nprivate int data;\npublic Node left;\npublic Node right;\npublic Node(int data) {\nthis.data = data;\n}\n}\n}\n</code></pre>"},{"location":"basic/net/5g/","title":"\u8bb2\u6e05\u695a5G\uff0c\u8fd9\u53ef\u80fd\u662f\u6700\u63a5\u5730\u6c14\u7684\u4e00\u7bc7\u4e86","text":""},{"location":"basic/net/5g/#_1","title":"\u4e00\u4e2a\u7b80\u5355\u4e14\u795e\u5947\u7684\u516c\u5f0f","text":"<p>\u4eca\u5929\u7684\u6545\u4e8b\uff0c\u4ece\u4e00\u4e2a\u516c\u5f0f\u5f00\u59cb\u8bb2\u8d77\u3002</p> <p>\u8fd9\u662f\u4e00\u4e2a\u65e2\u7b80\u5355\u53c8\u795e\u5947\u7684\u516c\u5f0f\u3002\u8bf4\u5b83\u7b80\u5355\uff0c\u662f\u56e0\u4e3a\u5b83\u4e00\u5171\u53ea\u67093\u4e2a\u5b57\u6bcd\u3002\u800c\u8bf4\u5b83\u795e\u5947\uff0c\u662f\u56e0\u4e3a\u8fd9\u4e2a\u516c\u5f0f\u8574\u542b\u4e86\u535a\u5927\u7cbe\u6df1\u7684\u901a\u4fe1\u6280\u672f\u5965\u79d8\uff0c\u8fd9\u4e2a\u661f\u7403\u4e0a\u6709\u65e0\u6570\u7684\u4eba\u90fd\u5728\u4e3a\u4e4b\u9b42\u7275\u68a6\u7ed5\u3002</p> <p>\u8fd9\u4e2a\u516c\u5f0f\uff0c\u5c31\u662f\u5b83\u2014\u2014</p> <p></p> <p>\u6211\u76f8\u4fe1\u5f88\u591a\u540c\u5b66\u90fd\u8ba4\u51fa\u8fd9\u4e2a\u516c\u5f0f\u4e86\uff0c\u5982\u679c\u6ca1\u8ba4\u51fa\u6765\uff0c\u800c\u4e14\u4f60\u53c8\u662f\u4e00\u4e2a\u7406\u79d1\u751f\u7684\u8bdd\uff0c\u8bf7\u8bb0\u5f97\u6709\u7a7a\u591a\u7ed9\u4f60\u7684\u4e2d\u5b66\u7269\u7406\u8001\u5e08\u6253\u6253\u7535\u8bdd\uff01</p> <p></p> <p>\u89e3\u91ca\u4e00\u4e0b\uff0c\u4e0a\u9762\u8fd9\u4e2a\u516c\u5f0f\uff0c\u8fd9\u662f\u7269\u7406\u5b66\u7684\u57fa\u672c\u516c\u5f0f\uff0c\u5149\u901f=\u6ce2\u957f\u00d7\u9891\u7387\u3002</p> <p></p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u516c\u5f0f\uff0c\u53ef\u4ee5\u8fd9\u4e48\u8bf4\uff1a\u65e0\u8bba\u662f1G\u30012G\u30013G\uff0c\u8fd8\u662f4G\u30015G\uff0c\u4e07\u53d8\u4e0d\u79bb\u5176\u5b97\uff0c\u5168\u90e8\u90fd\u662f\u5728\u5b83\u8eab\u4e0a\u505a\u6587\u7ae0\uff0c\u6ca1\u6709\u8df3\u51fa\u5b83\u7684\u201c\u4e94\u6307\u5c71\u201d\u3002</p> <p>\u4e14\u542c\u6211\u6162\u6162\u9053\u6765\u3002\u3002\u3002</p>"},{"location":"basic/net/5g/#_2","title":"\u6709\u7ebf\uff1f\u65e0\u7ebf\uff1f","text":"<p>\u901a\u4fe1\u6280\u672f\uff0c\u65e0\u8bba\u4ec0\u4e48\u9ed1\u79d1\u6280\u767d\u79d1\u6280\uff0c\u5f52\u6839\u5230\u5e95\uff0c\u5c31\u5206\u4e3a\u4e24\u79cd\u2014\u2014\u6709\u7ebf\u901a\u4fe1\u548c\u65e0\u7ebf\u901a\u4fe1\u3002</p> <p>\u6211\u548c\u4f60\u6253\u7535\u8bdd\uff0c\u4fe1\u606f\u6570\u636e\u8981\u4e48\u5728\u7a7a\u4e2d\u4f20\u64ad\uff08\u770b\u4e0d\u89c1\u3001\u6478\u4e0d\u7740\uff09\uff0c\u8981\u4e48\u5728\u5b9e\u7269\u4e0a\u4f20\u64ad\uff08\u770b\u5f97\u89c1\u3001\u6478\u5f97\u7740\uff09\u3002</p> <p></p> <p>\u5982\u679c\u662f\u5728\u5b9e\u4f53\u7269\u8d28\u4e0a\u4f20\u64ad\uff0c\u5c31\u662f\u6709\u7ebf\u901a\u4fe1\uff0c\u57fa\u672c\u4e0a\u5c31\u662f\u7528\u7684\u94dc\u7ebf\u3001\u5149\u7ea4\u8fd9\u4e9b\u7ebf\u7f06\uff0c\u7edf\u79f0\u4e3a\u6709\u7ebf\u4ecb\u8d28\u3002</p> <p>\u5728\u6709\u7ebf\u4ecb\u8d28\u4e0a\u4f20\u64ad\u6570\u636e\uff0c\u901f\u7387\u53ef\u4ee5\u8fbe\u5230\u5f88\u9ad8\u7684\u6570\u503c\u3002 </p> <p>\u4ee5\u5149\u7ea4\u4e3a\u4f8b\uff0c\u5728\u5b9e\u9a8c\u5ba4\u4e2d\uff0c\u5355\u6761\u5149\u7ea4\u6700\u5927\u901f\u5ea6\u5df2\u8fbe\u5230\u4e8626Tbps\u3002\u3002\u3002\u662f\u4f20\u7edf\u7f51\u7ebf\u7684\u4e24\u4e07\u516d\u5343\u500d\u3002\u3002\u3002</p> <p></p> <p>\u800c \u7a7a\u4e2d\u4f20\u64ad \u8fd9\u90e8\u5206\uff0c\u624d\u662f\u79fb\u52a8\u901a\u4fe1\u7684\u74f6\u9888\u6240\u5728\u3002</p> <p>\u76ee\u524d\u4e3b\u6d41\u7684\u79fb\u52a8\u901a\u4fe1\u6807\u51c6\uff0c\u662f4G LTE\uff0c\u7406\u8bba\u901f\u7387\u53ea\u6709150Mbps\uff08\u4e0d\u5305\u62ec\u8f7d\u6ce2\u805a\u5408\uff09\u3002\u8fd9\u4e2a\u548c\u6709\u7ebf\u662f\u5b8c\u5168\u6ca1\u529e\u6cd5\u76f8\u6bd4\u7684\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c5G\u5982\u679c\u8981\u5b9e\u73b0\u7aef\u5230\u7aef\u7684\u9ad8\u901f\u7387\uff0c\u91cd\u70b9\u662f\u7a81\u7834\u65e0\u7ebf\u8fd9\u90e8\u5206\u7684\u74f6\u9888\u3002</p>"},{"location":"basic/net/5g/#_3","title":"\u597d\u5927\u4e00\u4e2a\u6ce2","text":"<p>\u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u65e0\u7ebf\u901a\u4fe1\u5c31\u662f\u5229\u7528\u7535\u78c1\u6ce2\u8fdb\u884c\u901a\u4fe1\u3002\u7535\u6ce2\u548c\u5149\u6ce2\uff0c\u90fd\u5c5e\u4e8e\u7535\u78c1\u6ce2\u3002</p> <p>\u7535\u78c1\u6ce2\u7684\u529f\u80fd\u7279\u6027\uff0c\u662f\u7531\u5b83\u7684\u9891\u7387\u51b3\u5b9a\u7684\u3002\u4e0d\u540c\u9891\u7387\u7684\u7535\u78c1\u6ce2\uff0c\u6709\u4e0d\u540c\u7684\u5c5e\u6027\u7279\u70b9\uff0c\u4ece\u800c\u6709\u4e0d\u540c\u7684\u7528\u9014\u3002</p> <p>\u4f8b\u5982\uff0c\u9ad8\u9891\u7684\u03b3\u5c04\u7ebf\uff0c\u5177\u6709\u5f88\u5927\u7684\u6740\u4f24\u529b\uff0c\u53ef\u4ee5\u7528\u6765\u6cbb\u7597\u80bf\u7624\u3002</p> <p></p> <p>\u6211\u4eec\u76ee\u524d\u4e3b\u8981\u4f7f\u7528 \u7535\u6ce2 \u8fdb\u884c\u901a\u4fe1\u3002\u5f53\u7136\uff0c\u5149\u6ce2\u901a\u4fe1\u4e5f\u5728\u5d1b\u8d77\uff0c\u4f8b\u5982LiFi\uff08Light Fidelity\uff09\uff0c\u53ef\u89c1\u5149\u901a\u4fe1\u3002</p> <p></p> <p>\u4e0d\u504f\u9898\uff0c\u56de\u5230\u7535\u6ce2\u5148\u3002</p> <p>\u7535\u6ce2\u5c5e\u4e8e\u7535\u78c1\u6ce2\u7684\u4e00\u79cd\uff0c\u5b83\u7684\u9891\u7387\u8d44\u6e90\u662f\u6709\u9650\u7684\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u5e72\u6270\u548c\u51b2\u7a81\uff0c\u6211\u4eec\u5728\u7535\u6ce2\u8fd9\u6761**\u516c\u8def**\u4e0a\u8fdb\u4e00\u6b65\u5212\u5206**\u8f66\u9053**\uff0c\u5206\u914d\u7ed9\u4e0d\u540c\u7684\u5bf9\u8c61\u548c\u7528\u9014\u3002</p> <p></p> <p>\u8bf7\u5927\u5bb6\u6ce8\u610f\u4e0a\u9762\u56fe\u4e2d\u7684\u7ea2\u8272\u5b57\u4f53\u3002\u4e00\u76f4\u4ee5\u6765\uff0c\u6211\u4eec\u4e3b\u8981\u662f\u7528**\u4e2d\u9891~\u8d85\u9ad8\u9891**\u8fdb\u884c\u624b\u673a\u901a\u4fe1\u7684\u3002</p> <p>\u4f8b\u5982\u7ecf\u5e38\u8bf4\u7684\u201cGSM900\u201d\u3001\u201cCDMA800\u201d\uff0c\u5176\u5b9e\u610f\u601d\u5c31\u662f\u6307\uff0c\u5de5\u4f5c\u9891\u6bb5\u5728900MHz\u7684GSM\uff0c\u548c\u5de5\u4f5c\u9891\u6bb5\u5728800MHz\u7684CDMA\u3002</p> <p>\u76ee\u524d\u5168\u7403\u4e3b\u6d41\u76844G LTE\u6280\u672f\u6807\u51c6\uff0c\u5c5e\u4e8e\u7279\u9ad8\u9891\u548c\u8d85\u9ad8\u9891\u3002</p> <p>\u6211\u4eec\u56fd\u5bb6\u4e3b\u8981\u4f7f\u7528\u8d85\u9ad8\u9891\uff1a</p> <p></p> <p>\u5927\u5bb6\u80fd\u770b\u51fa\u6765\uff0c\u968f\u77401G\u30012G\u30013G\u30014G\u7684\u53d1\u5c55\uff0c\u4f7f\u7528\u7684\u7535\u6ce2\u9891\u7387\u662f\u8d8a\u6765\u8d8a\u9ad8\u7684\u3002</p> <p>\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a\uff0c\u9891\u7387\u8d8a\u9ad8\uff0c\u80fd\u4f7f\u7528\u7684\u9891\u7387\u8d44\u6e90\u8d8a\u4e30\u5bcc\u3002\u9891\u7387\u8d44\u6e90\u8d8a\u4e30\u5bcc\uff0c\u80fd\u5b9e\u73b0\u7684\u4f20\u8f93\u901f\u7387\u5c31\u8d8a\u9ad8\u3002</p> <p></p> <p>**\u66f4\u9ad8**\u7684\u9891\u7387\u2192**\u66f4\u591a**\u7684\u8d44\u6e90\u2192**\u66f4\u5feb**\u7684\u901f\u5ea6</p> <p>\u5e94\u8be5\u4e0d\u96be\u7406\u89e3\u5427\uff1f\u9891\u7387\u8d44\u6e90\u5c31\u50cf\u8f66\u53a2\uff0c\u8d8a\u9ad8\u7684\u9891\u7387\uff0c\u8f66\u53a2\u8d8a\u591a\uff0c\u76f8\u540c\u65f6\u95f4\u5185\u80fd\u88c5\u8f7d\u7684\u4fe1\u606f\u5c31\u8d8a\u591a\u3002</p> <p>\u90a3\u4e48\uff0c5G\u4f7f\u7528\u7684\u9891\u7387\u5177\u4f53\u662f\u591a\u5c11\u5462\uff1f</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>5G\u7684\u9891\u7387\u8303\u56f4\uff0c\u5206\u4e3a\u4e24\u79cd\uff1a\u4e00\u79cd\u662f6GHz\u4ee5\u4e0b\uff0c\u8fd9\u4e2a\u548c\u76ee\u524d\u6211\u4eec\u7684\u2154/4G\u5dee\u522b\u4e0d\u7b97\u592a\u5927\u3002\u8fd8\u6709\u4e00\u79cd\uff0c\u5c31\u5f88\u9ad8\u4e86\uff0c\u572824GHz\u4ee5\u4e0a\u3002</p> <p>\u76ee\u524d\uff0c\u56fd\u9645\u4e0a\u4e3b\u8981\u4f7f\u752828GHz\u8fdb\u884c\u8bd5\u9a8c\uff08\u8fd9\u4e2a\u9891\u6bb5\u4e5f\u6709\u53ef\u80fd\u6210\u4e3a5G\u6700\u5148\u5546\u7528\u7684\u9891\u6bb5\uff09\u3002</p> <p>\u5982\u679c\u630928GHz\u6765\u7b97\uff0c\u6839\u636e\u524d\u6587\u6211\u4eec\u63d0\u5230\u7684\u516c\u5f0f\uff1a</p> <p></p> <p>\u597d\u5566\uff0c\u8fd9\u4e2a\u5c31\u662f5G\u7684\u7b2c\u4e00\u4e2a\u6280\u672f\u7279\u70b9\u2014\u2014 </p> <p>\u6beb \u7c73 \u6ce2</p> <p>\u8bf7\u5141\u8bb8\u6211\u518d\u53d1\u4e00\u904d\u521a\u624d\u90a3\u4e2a\u9891\u7387\u5bf9\u7167\u8868\uff1a</p> <p></p> <p>\u8bf7\u6ce8\u610f\u770b\u6700\u4e0b\u9762\u4e00\u884c\uff0c\u662f\u4e0d\u662f\u5c31\u662f**\u201c\u6beb\u7c73\u6ce2\u201d**\uff1f</p> <p>\u7ee7\u7eed\uff0c\u7ee7\u7eed\uff01</p> <p>\u597d\u4e86\uff0c\u65e2\u7136\uff0c\u9891\u7387\u9ad8\u8fd9\u4e48\u597d\uff0c\u4f60\u4e00\u5b9a\u4f1a\u95ee\uff1a\u201c\u4e3a\u4ec0\u4e48\u4ee5\u524d\u6211\u4eec\u4e0d\u7528\u9ad8\u9891\u7387\u5462\uff1f\u201d</p> <p>\u539f\u56e0\u5f88\u7b80\u5355\u2014\u2014\u4e0d\u662f\u4e0d\u60f3\u7528\uff0c\u662f\u7528\u4e0d\u8d77\u3002</p> <p>\u7535\u78c1\u6ce2\u7684\u663e\u8457\u7279\u70b9\uff1a\u9891\u7387\u8d8a\u9ad8\uff0c\u6ce2\u957f\u8d8a\u77ed\uff0c\u8d8a\u8d8b\u8fd1\u4e8e\u76f4\u7ebf\u4f20\u64ad\uff08\u7ed5\u5c04\u80fd\u529b\u8d8a\u5dee\uff09\u3002\u9891\u7387\u8d8a\u9ad8\uff0c\u5728\u4f20\u64ad\u4ecb\u8d28\u4e2d\u7684\u8870\u51cf\u4e5f\u8d8a\u5927\u3002</p> <p>\u4f60\u770b\u6fc0\u5149\u7b14\uff08\u6ce2\u957f635nm\u5de6\u53f3\uff09\uff0c\u5c04\u51fa\u7684\u5149\u662f\u76f4\u7684\u5427\uff0c\u6321\u4f4f\u4e86\u5c31\u8fc7\u4e0d\u53bb\u4e86\u3002</p> <p>\u518d\u770b\u536b\u661f\u901a\u4fe1\u548cGPS\u5bfc\u822a\uff08\u6ce2\u957f1cm\u5de6\u53f3\uff09\uff0c\u5982\u679c\u6709\u906e\u6321\u7269\uff0c\u5c31\u6ca1\u4fe1\u53f7\u4e86\u5427\u3002</p> <p></p> <p>\u536b\u661f\u90a3\u53e3\u5927\u9505\uff0c\u5fc5\u987b\u6821\u51c6\u7784\u7740\u536b\u661f\u7684\u65b9\u5411\uff0c\u5426\u5219\u54ea\u6015\u7a0d\u5fae\u6b6a\u4e00\u70b9\uff0c\u90fd\u4f1a\u5f71\u54cd\u4fe1\u53f7\u8d28\u91cf\u3002</p> <p>\u79fb\u52a8\u901a\u4fe1\u5982\u679c\u7528\u4e86\u9ad8\u9891\u6bb5\uff0c\u90a3\u4e48\u5b83\u6700\u5927\u7684\u95ee\u9898\uff0c\u5c31\u662f**\u4f20\u8f93\u8ddd\u79bb\u5927\u5e45\u7f29\u77ed\uff0c\u8986\u76d6\u80fd\u529b\u5927\u5e45\u51cf\u5f31**\u3002</p> <p>\u8986\u76d6\u540c\u4e00\u4e2a\u533a\u57df\uff0c\u9700\u8981\u76845G\u57fa\u7ad9\u6570\u91cf\uff0c\u5c06\u5927\u5927\u8d85\u8fc74G\u3002</p> <p></p> <p>\u57fa\u7ad9\u6570\u91cf\u610f\u5473\u7740\u4ec0\u4e48\uff1f\u94b1\u554a\uff01\u6295\u8d44\u554a\uff01\u6210\u672c\u554a\uff01</p> <p>\u9891\u7387\u8d8a\u4f4e\uff0c\u7f51\u7edc\u5efa\u8bbe\u5c31\u8d8a\u7701\u94b1\uff0c\u7ade\u4e89\u8d77\u6765\u5c31\u8d8a\u6709\u5229\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\uff0c\u8fd9\u4e9b\u5e74\uff0c\u7535\u4fe1\u3001\u79fb\u52a8\u3001\u8054\u901a\u4e3a\u4e86\u4f4e\u9891\u6bb5\u800c\u4e89\u5f97\u5934\u7834\u8840\u6d41\u3002</p> <p>\u6709\u7684\u9891\u6bb5\u751a\u81f3\u88ab\u79f0\u4e3a\u2014\u2014\u9ec4\u91d1\u9891\u6bb5\u3002</p> <p></p> <p>\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\uff0c5G\u65f6\u4ee3\uff0c\u8fd0\u8425\u5546\u62fc\u547d\u603c\u8bbe\u5907\u5546\uff0c\u5e0c\u671b\u57fa\u7ad9\u964d\u4ef7\u3002\uff08\u5982\u679c\u771f\u7684\u4e0a5G\uff0c\u6309\u4ee5\u5f80\u7684\u6a21\u5f0f\uff0c\u8bbe\u5907\u5546\u5c31\u53d1\u5927\u8d22\u4e86\u3002\uff09</p> <p></p> <p></p> <p>\u6240\u4ee5\uff0c\u57fa\u4e8e\u4ee5\u4e0a\u539f\u56e0\uff0c\u5728\u9ad8\u9891\u7387\u7684\u524d\u63d0\u4e0b\uff0c\u4e3a\u4e86\u51cf\u8f7b\u7f51\u7edc\u5efa\u8bbe\u65b9\u9762\u7684\u6210\u672c\u538b\u529b\uff0c5G\u5fc5\u987b\u5bfb\u627e\u65b0\u7684\u51fa\u8def\u3002</p> <p>\u51fa\u8def\u6709\u54ea\u4e9b\u5462\uff1f</p> <p>\u9996\u5148\uff0c\u5c31\u662f\u5fae\u57fa\u7ad9\u3002 </p> <p>\u5fae \u57fa \u7ad9</p> <p>\u57fa\u7ad9\u6709\u4e24\u79cd\uff0c\u5fae\u57fa\u7ad9\u548c\u5b8f\u57fa\u7ad9\u3002\u770b\u540d\u5b57\u5c31\u77e5\u9053\uff0c\u5fae\u57fa\u7ad9\u5f88\u5c0f\uff0c\u5b8f\u57fa\u7ad9\u5f88\u5927\uff01</p> <p>\u5b8f\u57fa\u7ad9\uff1a \u5ba4\u5916\u5e38\u89c1\uff0c\u5efa\u4e00\u4e2a\u8986\u76d6\u4e00\u5927\u7247</p> <p></p> <p>\u5fae\u57fa\u7ad9\uff1a</p> <p></p> <p>\u770b\u4e0a\u53bb\u662f\u4e0d\u662f\u5f88\u9177\u70ab\uff1f</p> <p></p> <p>\u8fd8\u6709\u66f4\u5c0f\u7684\uff0c\u5df4\u638c\u90a3\u4e48\u5927</p> <p>\u5176\u5b9e\uff0c\u5fae\u57fa\u7ad9\u73b0\u5728\u5c31\u6709\u4e0d\u5c11\uff0c\u5c24\u5176\u662f\u57ce\u533a\u548c\u5ba4\u5185\uff0c\u7ecf\u5e38\u80fd\u770b\u5230\u3002</p> <p>\u4ee5\u540e\uff0c\u5230\u4e865G\u65f6\u4ee3\uff0c\u5fae\u57fa\u7ad9\u4f1a\u66f4\u591a\uff0c\u5230\u5904\u90fd\u4f1a\u88c5\u4e0a\uff0c\u51e0\u4e4e\u968f\u5904\u53ef\u89c1\u3002</p> <p>\u4f60\u80af\u5b9a\u4f1a\u95ee\uff0c\u90a3\u4e48\u591a\u57fa\u7ad9\u5728\u8eab\u8fb9\uff0c\u4f1a\u4e0d\u4f1a\u5bf9\u4eba\u4f53\u9020\u6210\u5f71\u54cd\uff1f</p> <p>\u6211\u7684\u56de\u7b54\u662f\u2014\u2014\u4e0d\u4f1a\u3002</p> <p>\u5176\u5b9e\uff0c\u548c\u4f20\u7edf\u8ba4\u77e5\u6070\u597d\u76f8\u53cd\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u57fa\u7ad9\u6570\u91cf\u8d8a\u591a\uff0c\u8f90\u5c04\u53cd\u800c\u8d8a\u5c0f\uff01 </p> <p>\u4f60\u60f3\u4e00\u4e0b\uff0c\u51ac\u5929\uff0c\u4e00\u7fa4\u4eba\u7684\u623f\u5b50\u91cc\uff0c\u4e00\u4e2a\u5927\u529f\u7387\u53d6\u6696\u5668\u597d\uff0c\u8fd8\u662f\u51e0\u4e2a\u5c0f\u529f\u7387\u53d6\u6696\u5668\u597d\uff1f</p> <p>\u5927\u529f\u7387\u65b9\u6848</p> <p>\u25bc</p> <p></p> <p>\u5c0f\u529f\u7387\u65b9\u6848</p> <p>\u25bc</p> <p></p> <p>\u4e0a\u9762\u7684\u56fe\uff0c\u4e00\u76ee\u4e86\u7136\u4e86\u3002\u57fa\u7ad9\u5c0f\uff0c\u529f\u7387\u4f4e\uff0c\u5bf9\u5927\u5bb6\u90fd\u597d\u3002\u5982\u679c\u53ea\u91c7\u7528\u4e00\u4e2a\u5927\u57fa\u7ad9\uff0c\u79bb\u5f97\u8fd1\uff0c\u8f90\u5c04\u5927\uff0c\u79bb\u5f97\u8fdc\uff0c\u6ca1\u4fe1\u53f7\uff0c\u53cd\u800c\u4e0d\u597d\u3002</p>"},{"location":"basic/net/5g/#_4","title":"\u5929\u7ebf\u53bb\u54ea\u4e86\uff1f","text":"<p>\u5927\u5bb6\u6709\u6ca1\u6709\u53d1\u73b0\uff0c\u4ee5\u524d\u5927\u54e5\u5927\u90fd\u6709\u5f88\u957f\u7684\u5929\u7ebf\uff0c\u65e9\u671f\u7684\u624b\u673a\u4e5f\u6709\u7a81\u51fa\u6765\u7684\u5c0f\u5929\u7ebf\uff0c\u4e3a\u4ec0\u4e48\u73b0\u5728\u6211\u4eec\u7684\u624b\u673a\u90fd\u6ca1\u6709\u5929\u7ebf\u4e86\uff1f</p> <p></p> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u5e76\u4e0d\u662f\u4e0d\u9700\u8981\u5929\u7ebf\uff0c\u800c\u662f\u6211\u4eec\u7684\u5929\u7ebf\u53d8\u5c0f\u4e86\u3002</p> <p>\u6839\u636e\u5929\u7ebf\u7279\u6027\uff0c\u5929\u7ebf\u957f\u5ea6\u5e94\u4e0e\u6ce2\u957f\u6210\u6b63\u6bd4\uff0c\u5927\u7ea6\u57281/10~\u00bc\u4e4b\u95f4\u3002</p> <p></p> <p>\u968f\u7740\u65f6\u95f4\u53d8\u5316\uff0c\u6211\u4eec\u624b\u673a\u7684\u901a\u4fe1\u9891\u7387\u8d8a\u6765\u8d8a\u9ad8\uff0c\u6ce2\u957f\u8d8a\u6765\u8d8a\u77ed\uff0c\u5929\u7ebf\u4e5f\u5c31\u8ddf\u7740\u53d8\u77ed\u5566\uff01 </p> <p>\u6beb\u7c73\u6ce2\u901a\u4fe1\uff0c\u5929\u7ebf\u4e5f\u53d8\u6210\u6beb\u7c73\u7ea7\u3002\u3002\u3002</p> <p>\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u5929\u7ebf\u5b8c\u5168\u53ef\u4ee5\u585e\u8fdb\u624b\u673a\u7684\u91cc\u9762\uff0c\u751a\u81f3\u53ef\u4ee5\u585e\u5f88\u591a\u6839\u3002\u3002\u3002</p> <p>\u8fd9\u5c31\u662f5G\u7684\u7b2c\u4e09\u5927\u6740\u624b\u950f\u2014\u2014 </p> <p>\uff2dassive MIMO\uff08\u591a\u5929\u7ebf\u6280\u672f\uff09</p> <p>MIMO\u5c31\u662f\u201c\u591a\u8fdb\u591a\u51fa\u201d\uff08Multiple-Input Multiple-Output\uff09\uff0c\u591a\u6839\u5929\u7ebf\u53d1\u9001\uff0c\u591a\u6839\u5929\u7ebf\u63a5\u6536\u3002</p> <p>\u5728LTE\u65f6\u4ee3\uff0c\u6211\u4eec\u5c31\u5df2\u7ecf\u6709MIMO\u4e86\uff0c\u4f46\u662f\u5929\u7ebf\u6570\u91cf\u5e76\u4e0d\u7b97\u591a\uff0c\u53ea\u80fd\u8bf4\u662f\u521d\u7ea7\u7248\u7684MIMO\u3002</p> <p>\u5230\u4e865G\u65f6\u4ee3\uff0c\u7ee7\u7eed\u628aMIMO\u6280\u672f\u53d1\u626c\u5149\u5927\uff0c\u73b0\u5728\u53d8\u6210\u4e86\u52a0\u5f3a\u7248\u7684**Massive\u3000MIMO**\uff08Massive\uff1a\u5927\u89c4\u6a21\u7684\uff0c\u5927\u91cf\u7684\uff09\u3002</p> <p></p> <p>\u624b\u673a\u91cc\u9762\u90fd\u80fd\u585e\u597d\u591a\u6839\u5929\u7ebf\uff0c\u57fa\u7ad9\u5c31\u66f4\u4e0d\u7528\u8bf4\u4e86\u3002</p> <p>\u4ee5\u524d\u7684\u57fa\u7ad9\uff0c\u5929\u7ebf\u5c31\u90a3\u4e48\u51e0\u6839\uff1a</p> <p></p> <p>5G\u65f6\u4ee3\uff0c\u5929\u7ebf\u6570\u91cf\u4e0d\u662f\u6309\u6839\u6765\u7b97\u4e86\uff0c\u662f\u6309\u201c\u9635\u201d\u3002\u3002\u3002\u201c\u5929\u7ebf\u9635\u5217\u201d\u3002\u3002\u3002\u4e00\u773c\u770b\u53bb\uff0c\u8981\u5f97\u5bc6\u96c6\u6050\u60e7\u75c7\u7684\u8282\u594f\u3002\u3002\u3002</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u5929\u7ebf\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e5f\u4e0d\u80fd\u592a\u8fd1\u3002</p> <p>\u56e0\u4e3a\u5929\u7ebf\u7279\u6027\u8981\u6c42\uff0c\u591a\u5929\u7ebf\u9635\u5217\u8981\u6c42\u5929\u7ebf\u4e4b\u95f4\u7684\u8ddd\u79bb\u4fdd\u6301\u5728\u534a\u4e2a\u6ce2\u957f\u4ee5\u4e0a\u3002\u5982\u679c\u8ddd\u79bb\u8fd1\u4e86\uff0c\u5c31\u4f1a\u4e92\u76f8\u5e72\u6270\uff0c\u5f71\u54cd\u4fe1\u53f7\u7684\u6536\u53d1\u3002</p>"},{"location":"basic/net/5g/#_5","title":"\u4f60\u662f\u76f4\u7684\uff1f\u8fd8\u662f\u5f2f\u7684\uff1f","text":"<p>\u5927\u5bb6\u90fd\u89c1\u8fc7\u706f\u6ce1\u53d1\u5149\u5427\uff1f\u3000</p> <p></p> <p>\u5176\u5b9e\uff0c\u57fa\u7ad9\u53d1\u5c04\u4fe1\u53f7\u7684\u65f6\u5019\uff0c\u5c31\u6709\u70b9\u50cf\u706f\u6ce1\u53d1\u5149\u3002</p> <p>\u4fe1\u53f7\u662f\u5411\u56db\u5468\u53d1\u5c04\u7684\uff0c\u5bf9\u4e8e\u5149\uff0c\u5f53\u7136\u662f\u7167\u4eae\u6574\u4e2a\u623f\u95f4\uff0c\u5982\u679c\u53ea\u662f\u60f3\u7167\u4eae\u67d0\u4e2a\u533a\u57df\u6216\u7269\u4f53\uff0c\u90a3\u4e48\uff0c\u5927\u90e8\u5206\u7684\u5149\u90fd\u6d6a\u8d39\u4e86\u3002\u3002\u3002</p> <p></p> <p>\u57fa\u7ad9\u4e5f\u662f\u4e00\u6837\uff0c\u5927\u91cf\u7684\u80fd\u91cf\u548c\u8d44\u6e90\u90fd\u6d6a\u8d39\u4e86\u3002 </p> <p>\u6211\u4eec\u80fd\u4e0d\u80fd\u627e\u5230\u4e00\u53ea\u65e0\u5f62\u7684\u624b\uff0c\u628a\u6563\u5f00\u7684\u5149\u675f\u7f1a\u8d77\u6765\u5462\uff1f </p> <p>\u8fd9\u6837\u65e2\u8282\u7ea6\u4e86\u80fd\u91cf\uff0c\u4e5f\u4fdd\u8bc1\u4e86\u8981\u7167\u4eae\u7684\u533a\u57df\u6709\u8db3\u591f\u7684\u5149\u3002</p> <p>\u7b54\u6848\u662f\uff1a\u53ef\u4ee5\u3002</p> <p>\u8fd9\u5c31\u662f\u2014\u2014</p> <p>\u6ce2 \u675f \u8d4b \u5f62</p> <p>\u6ce2\u675f\u8d4b\u5f62</p> <p>\u5728\u57fa\u7ad9\u4e0a\u5e03\u8bbe\u5929\u7ebf\u9635\u5217\uff0c\u901a\u8fc7**\u5bf9\u5c04\u9891\u4fe1\u53f7\u76f8\u4f4d\u7684\u63a7\u5236**\uff0c\u4f7f\u5f97\u76f8\u4e92\u4f5c\u7528\u540e\u7684\u7535\u78c1\u6ce2\u7684\u6ce2\u74e3\u53d8\u5f97\u975e\u5e38\u72ed\u7a84\uff0c\u5e76\u6307\u5411\u5b83\u6240\u63d0\u4f9b\u670d\u52a1\u7684\u624b\u673a\uff0c\u800c\u4e14\u80fd\u8ddf\u636e\u624b\u673a\u7684\u79fb\u52a8\u800c\u8f6c\u53d8\u65b9\u5411\u3002</p> <p>\u8fd9\u79cd\u7a7a\u95f4\u590d\u7528\u6280\u672f\uff0c\u7531\u5168\u5411\u7684\u4fe1\u53f7\u8986\u76d6\u53d8\u4e3a\u4e86\u7cbe\u51c6\u6307\u5411\u6027\u670d\u52a1\uff0c\u6ce2\u675f\u4e4b\u95f4\u4e0d\u4f1a\u5e72\u6270\uff0c\u5728\u76f8\u540c\u7684\u7a7a\u95f4\u4e2d\u63d0\u4f9b\u66f4\u591a\u7684\u901a\u4fe1\u94fe\u8def\uff0c\u6781\u5927\u5730\u63d0\u9ad8\u57fa\u7ad9\u7684\u670d\u52a1\u5bb9\u91cf\u3002</p> <p></p> <p>\u76f4\u7684\u90fd\u80fd\u63b0\u6210\u5f2f\u7684\u3002\u3002\u3002\u8fd8\u6709\u4ec0\u4e48\u662f\u901a\u4fe1\u7816\u5bb6\u5e72\u4e0d\u51fa\u6765\u7684\uff1f</p> <p></p>"},{"location":"basic/net/5g/#_6","title":"\u522b\u6536\u6211\u94b1\uff0c\u884c\u4e0d\u884c\uff1f","text":"<p>\u5728\u76ee\u524d\u7684\u79fb\u52a8\u901a\u4fe1\u7f51\u7edc\u4e2d\uff0c\u5373\u4f7f\u662f\u4e24\u4e2a\u4eba\u9762\u5bf9\u9762\u62e8\u6253\u5bf9\u65b9\u7684\u624b\u673a\uff08\u6216\u624b\u673a\u5bf9\u4f20\u7167\u7247\uff09\uff0c\u4fe1\u53f7\u90fd\u662f\u901a\u8fc7\u57fa\u7ad9\u8fdb\u884c\u4e2d\u8f6c\u7684\uff0c\u5305\u62ec\u63a7\u5236\u4fe1\u4ee4\u548c\u6570\u636e\u5305\u3002\u3002\u3002\u3000</p> <p>\u800c\u57285G\u65f6\u4ee3\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u4e0d\u4e00\u5b9a\u4e86\u3002</p> <p>5G\u7684\u7b2c\u4e94\u5927\u7279\u70b9\u2014\u2014D2D\uff0c\u4e5f\u5c31\u662fDevice to Device\uff08\u8bbe\u5907\u5230\u8bbe\u5907\uff09\u3002</p> <p>\uff24\uff12\uff24</p> <p>5G\u65f6\u4ee3\uff0c\u540c\u4e00\u57fa\u7ad9\u4e0b\u7684\u4e24\u4e2a\u7528\u6237\uff0c\u5982\u679c\u4e92\u76f8\u8fdb\u884c\u901a\u4fe1\uff0c\u4ed6\u4eec\u7684\u6570\u636e\u5c06\u4e0d\u518d\u901a\u8fc7\u57fa\u7ad9\u8f6c\u53d1\uff0c\u800c\u662f\u76f4\u63a5\u624b\u673a\u5230\u624b\u673a\u3002\u3002\u3002</p> <p></p> <p>\u8fd9\u6837\uff0c\u5c31\u8282\u7ea6\u4e86\u5927\u91cf\u7684\u7a7a\u4e2d\u8d44\u6e90\uff0c\u4e5f\u51cf\u8f7b\u4e86\u57fa\u7ad9\u7684\u538b\u529b\u3002 </p> <p>\u4e0d\u8fc7\uff0c\u5982\u679c\u4f60\u89c9\u5f97\u8fd9\u6837\u5c31\u4e0d\u7528\u4ed8\u94b1\uff0c\u90a3\u4f60\u5c31\u56fe\u6837\u56fe\u68ee\u7834\u4e86\u3002</p> <p></p> <p>\u63a7\u5236\u6d88\u606f\u8fd8\u662f\u8981\u4ece\u57fa\u7ad9\u8d70\u7684\uff0c\u4f60\u7528\u7740\u9891\u8c31\u8d44\u6e90\uff0c\u8fd0\u8425\u5546\u7238\u7238\u600e\u4e48\u53ef\u80fd\u653e\u8fc7\u4f60\u3002\u3002\u3002</p>"},{"location":"basic/net/5g/#_7","title":"\u540e\u8bb0","text":"<p>\u6d0b\u6d0b\u6d12\u6d12\u5199\u7684\u6709\u70b9\u591a\u3002\u3002\u3002</p> <p>\u80fd\u770b\u5230\u8fd9\u7684\uff0c\u90fd\u662f\u771f\u7231\u554a\u3002\u3002\u3002</p> <p></p> <p>\u76f8\u4fe1\u5927\u5bb6\u901a\u8fc7\u672c\u6587\uff0c\u5bf95G\u548c\u5979\u80cc\u540e\u7684\u901a\u4fe1\u77e5\u8bc6\u5df2\u7ecf\u6709\u4e86\u6df1\u523b\u7684\u7406\u89e3\u3002\u800c\u8fd9\u4e00\u5207\uff0c\u90fd\u53ea\u662f\u6e90\u4e8e\u4e00\u4e2a\u5c0f\u5b66\u751f\u90fd\u80fd\u770b\u61c2\u7684\u6570\u5b66\u516c\u5f0f\u3002\u4e0d\u662f\u4e48\uff1f</p> <p>\u901a\u4fe1\u6280\u672f\u5e76\u4e0d\u795e\u79d8\uff0c5G\u4f5c\u4e3a\u901a\u4fe1\u6280\u672f\u7687\u51a0\u4e0a\u6700\u8000\u773c\u7684\u5b9d\u77f3\uff0c\u4e5f\u4e0d\u662f\u4ec0\u4e48\u9065\u4e0d\u53ef\u53ca\u7684\u521b\u65b0\u9769\u547d\u6280\u672f\uff0c\u5b83\u66f4\u591a\u662f\u5bf9\u73b0\u6709\u901a\u4fe1\u6280\u672f\u7684\u6f14\u8fdb\u3002</p> <p>\u6b63\u5982\u4e00\u4f4d\u9ad8\u4eba\u6240\u8bf4\u2014\u2014</p> <p>\u901a\u4fe1\u6280\u672f\u7684\u6781\u9650\uff0c\u5e76\u4e0d\u662f\u6280\u672f\u5de5\u827a\u65b9\u9762\u7684\u9650\u5236\uff0c\u800c\u662f\u5efa\u7acb\u5728\u4e25\u8c28\u6570\u5b66\u57fa\u7840\u4e0a\u7684\u63a8\u8bba\uff0c\u5728\u53ef\u4ee5\u9047\u89c1\u7684\u672a\u6765\u662f\u57fa\u672c\u4e0d\u53ef\u80fd\u7a81\u7834\u7684\u3002</p> <p>\u5982\u4f55\u5728\u79d1\u5b66\u539f\u7406\u7684\u8303\u7574\u5185\uff0c\u8fdb\u4e00\u6b65\u53d1\u6398\u901a\u4fe1\u7684\u6f5c\u529b\uff0c\u662f\u901a\u4fe1\u884c\u4e1a\u4f17\u591a\u594b\u6597\u8005\u4eec\u5b5c\u5b5c\u4e0d\u5026\u7684\u8ffd\u6c42\u3002</p>"},{"location":"basic/net/5g/#_8","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://mp.weixin.qq.com/s/bPNuEbwZZS9uS5bKmHskTw</p>"},{"location":"basic/net/Okhttp/","title":"Okhttp\u6838\u5fc3\u539f\u7406","text":"<p>\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u5f88\u5c11\u4f1a\u50cf\u300aUNIX \u7f51\u7edc\u7f16\u7a0b\u300b\u90a3\u6837\u76f4\u63a5\u53bb\u64cd\u4f5c\u5e95\u5c42\u7684\u7f51\u7edc\u63a5\u53e3\uff0c\u4e00\u822c\u90fd\u4f1a\u4f7f\u7528\u7f51\u7edc\u5e93\u3002Square \u51fa\u54c1\u7684OkHttp\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684 Android \u7f51\u7edc\u5e93\uff0c\u5b83\u8fd8\u88ab Google \u52a0\u5165\u5230 Android \u7cfb\u7edf\u5185\u90e8\uff0c\u4e3a\u5e7f\u5927\u5f00\u53d1\u8005\u63d0\u4f9b\u7f51\u7edc\u670d\u52a1\u3002\u90a3\u7f51\u7edc\u5e93\u7a76\u7adf\u627f\u62c5\u7740\u4e00\u4e2a\u4ec0\u4e48\u6837\u7684\u89d2\u8272\u5462\uff1f\u5728\u6211\u770b\u6765\uff0c\u5b83\u5c4f\u853d\u4e86\u4e0b\u5c42\u590d\u6742\u7684\u7f51\u7edc\u63a5\u53e3\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u4f7f\u7528\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e00\u4e2a\u7f51\u7edc\u5e93\u7684\u6838\u5fc3\u4f5c\u7528\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u70b9\uff1a</p> <ul> <li>\u7edf\u4e00\u7f16\u7a0b\u63a5\u53e3\u3002\u65e0\u8bba\u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65\u8bf7\u6c42\uff0c\u63a5\u53e3\u90fd\u975e\u5e38\u7b80\u5355\u6613\u7528\u3002\u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u7edf\u4e00\u505a\u7b56\u7565\u7ba1\u7406\uff0c</li> <li>\u7edf\u4e00\u8fdb\u884c\u6d41\u89e3\u6790\uff08JSON\u3001XML\u3001Protocol Buffers\uff09\u7b49\u3002\u5168\u5c40\u7f51\u7edc\u63a7\u5236\u3002\u5728\u7f51\u7edc\u5e93\u5185\u90e8\u6211\u4eec\u53ef\u4ee5\u505a\u7edf\u4e00\u7684\u7f51\u7edc\u8c03\u5ea6\u3001\u6d41\u91cf\u76d1\u63a7\u4ee5\u53ca\u5bb9\u707e\u7ba1\u7406\u7b49\u5de5\u4f5c\u3002</li> <li>\u9ad8\u6027\u80fd\u3002\u65e2\u7136\u6211\u4eec\u628a\u6240\u6709\u7684\u7f51\u7edc\u8bf7\u6c42\u90fd\u4ea4\u7ed9\u4e86\u7f51\u7edc\u5e93\uff0c\u90a3\u7f51\u7edc\u5e93\u662f\u5426\u5b9e\u73b0\u9ad8\u6027\u80fd\u5c31\u81f3\u5173\u91cd\u8981\u3002\u65e2\u7136\u8981\u5b9e\u73b0\u9ad8\u6027\u80fd\uff0c\u90a3\u6211\u4f1a\u975e\u5e38\u5173\u6ce8\u901f\u5ea6\uff0cCPU\u3001\u5185\u5b58\u3001I/O \u7684\u4f7f\u7528\uff0c\u4ee5\u53ca\u5931\u8d25\u7387\u3001\u5d29\u6e83\u7387\u3001\u534f\u8bae\u7684\u517c\u5bb9\u6027\u7b49\u65b9\u9762\u3002</li> </ul> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a\u597d\u7684\u7f51\u7edc\u5e93\u4f1a\u6709\u4ee5\u4e0b\u6a21\u5757\uff1a * DNS \u7ba1\u7406 * \u8fde\u63a5\u7ba1\u7406 * \u534f\u8bae\u5904\u7406 * \u5e76\u53d1\u6a21\u578b * IO\u6a21\u578b * \u9884\u8fde\u63a5 * \u9519\u8bef\u517c\u5bb9\u5904\u7406 * \u6570\u636e\u89e3\u6790 * \u7f51\u7edc\u8d28\u91cf\u76d1\u63a7</p> <p>\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u4e00\u4e00\u4ecb\u7ecd\u8fd9\u4e9b\u6a21\u5757\u3002</p>"},{"location":"basic/net/Okhttp/#_1","title":"\u7edf\u4e00\u7f16\u7a0b\u63a5\u53e3","text":""},{"location":"basic/net/Okhttp/#_2","title":"\u8bf7\u6c42\u6574\u4f53\u6d41\u7a0b\u4ecb\u7ecd","text":"<p>OkHttp \u7684\u6838\u5fc3\u7c7b\u662f <code>OkHttpClient</code>\uff0c\u5b83\u662f\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u6765\u521b\u5efa\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>new OkHttpClient()</code> \u6765\u521b\u5efa\u4e00\u4e2a <code>OkHttpClient</code> \u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>OkHttpClient.Builder</code> \u6765\u521b\u5efa\u4e00\u4e2a <code>OkHttpClient</code> \u5bf9\u8c61\u3002<code>OkHttpClient.Builder</code> \u662f\u4e00\u4e2a\u5efa\u9020\u8005\u6a21\u5f0f\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5feb\u901f\u521b\u5efa\u4e00\u4e2a <code>OkHttpClient</code> \u5bf9\u8c61\u3002</p> <pre><code>OkHttpClient client = new OkHttpClient.Builder()\n.connectTimeout(10, TimeUnit.SECONDS)\n.writeTimeout(10, TimeUnit.SECONDS)\n.readTimeout(30, TimeUnit.SECONDS)\n.build();\n</code></pre> <p><code>OkHttpClient</code> \u63d0\u4f9b\u4e86 <code>newCall</code> \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a <code>Call</code> \u5bf9\u8c61\uff0c<code>Call</code> \u5bf9\u8c61\u662f\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u7684\u62bd\u8c61\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7 <code>execute</code> \u65b9\u6cd5\u6765\u540c\u6b65\u6267\u884c\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>enqueue</code> \u65b9\u6cd5\u6765\u5f02\u6b65\u6267\u884c\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u3002</p> <pre><code>Request request = new Request.Builder()\n.url(\"https://api.github.com/repos/square/okhttp/issues\")\n.header(\"User-Agent\", \"OkHttp Headers.java\")\n.addHeader(\"Accept\", \"application/json; q=0.5\")\n.addHeader(\"Accept\", \"application/vnd.github.v3+json\")\n.build();\nCall call = client.newCall(request);\nResponse response = call.execute();\n// or\ncall.enqueue(new Callback() {\n@Override public void onFailure(Call call, IOException e) {\ne.printStackTrace();\n}\n@Override public void onResponse(Call call, Response response) throws IOException {\nif (!response.isSuccessful()) throw new IOException(\"Unexpected code \" + response);\nHeaders responseHeaders = response.headers();\nfor (int i = 0, size = responseHeaders.size(); i &lt; size; i++) {\nSystem.out.println(responseHeaders.name(i) + \": \" + responseHeaders.value(i));\n}\nSystem.out.println(response.body().string());\n}\n});\n</code></pre>"},{"location":"basic/net/Okhttp/#_3","title":"\u5206\u53d1\u5668","text":"<p><code>OkHttpClient</code> \u901a\u8fc7 <code>Dispatcher</code> \u6765\u7ba1\u7406 <code>Call</code> \u5bf9\u8c61\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u63a7\u5236\u5e76\u53d1\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u4ee5\u53ca\u8bf7\u6c42\u7684\u6267\u884c\u987a\u5e8f\u3002</p> <pre><code>Dispatcher dispatcher = new Dispatcher();\ndispatcher.setMaxRequests(20);\ndispatcher.setMaxRequestsPerHost(5);\nOkHttpClient client = new OkHttpClient.Builder()\n.dispatcher(dispatcher)\n.build();\n</code></pre>"},{"location":"basic/net/Okhttp/#dns","title":"DNS \u7ba1\u7406","text":"<p>\u652f\u6301 DNS \u7f13\u5b58\uff0c\u652f\u6301\u81ea\u5b9a\u4e49 DNS \u89e3\u6790\u3002 DNS\uff08Domain Name System\uff09\u662f\u57df\u540d\u7cfb\u7edf\uff0c\u5b83\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u6570\u636e\u5e93\uff0c\u5b83\u5b58\u50a8\u7740\u57df\u540d\u548c IP \u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u3002\u5f53\u6211\u4eec\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165\u4e00\u4e2a\u57df\u540d\u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u5148\u53bb\u672c\u5730\u7684 DNS \u7f13\u5b58\u4e2d\u67e5\u627e\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\uff0c\u90a3\u4e48\u5b83\u4f1a\u53bb DNS \u670d\u52a1\u5668\u4e2d\u67e5\u627e\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u6709\u627e\u5230\uff0c\u90a3\u4e48\u5b83\u4f1a\u53bb\u6839\u57df\u540d\u670d\u52a1\u5668\u4e2d\u67e5\u627e\uff0c\u6700\u540e\u627e\u5230\u5bf9\u5e94\u7684 IP \u5730\u5740\u3002</p> <p></p> <p>\u5728 OkHttp \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>Dns</code> \u63a5\u53e3\u6765\u81ea\u5b9a\u4e49 DNS \u89e3\u6790\u7684\u5b9e\u73b0\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cOkHttp \u4f1a\u4f7f\u7528\u7cfb\u7edf\u7684 DNS \u89e3\u6790\uff0c\u4f46\u662f\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49 DNS \u89e3\u6790\u7684\u5b9e\u73b0\uff0c\u6bd4\u5982\u4f7f\u7528 Google \u7684 DNS \u670d\u52a1\u5668\u3002</p> <pre><code>public interface Dns {\nList&lt;InetAddress&gt; lookup(String hostname) throws UnknownHostException;\n}\n</code></pre>"},{"location":"basic/net/Okhttp/#_4","title":"\u8fde\u63a5\u7ba1\u7406","text":"<p>\u5bf9\u4e8eHttp\u8fde\u63a5\uff0c \u6bcf\u4e2a\u57df\u540d\u6700\u591a\u7f13\u5b585\u4e2a\u8fde\u63a5\uff0c\u6bcf\u4e2a\u8fde\u63a5\u9ed8\u8ba4keep-alive 5\u5206\u949f\uff0c\u5982\u679c5\u5206\u949f\u5185\u6ca1\u6709\u8bf7\u6c42\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fde\u63a5\u5c31\u4f1a\u88ab\u5173\u95ed\u3002 \u5bf9\u4e8eHttp/2\u8fde\u63a5\uff0c \u6bcf\u4e2a\u57df\u540d\u90fd\u5171\u7528\u4e00\u4e2aH2\u8fde\u63a5</p>"},{"location":"basic/net/Okhttp/#_5","title":"\u534f\u8bae\u5904\u7406","text":"<p>OkHttp \u652f\u6301 HTTP/1.1 \u548c HTTP/2 , TLS 1.2 \u548c TLS 1.3</p>"},{"location":"basic/net/Okhttp/#_6","title":"\u5e76\u53d1\u6a21\u578b","text":"<p>\u4f7f\u7528\u591a\u7ebf\u7a0b\u6765\u5b9e\u73b0\u5e76\u53d1\uff0c\u5b9e\u9645\u6267\u884c\u7ebf\u7a0b\u6570\u53d7\u961f\u5217 \u673a\u5236\u63a7\u5236\uff0c\u6700\u592764\uff0c\u5355\u4e2aHost\u9650\u52365\u4e2a\u3002</p>"},{"location":"basic/net/Okhttp/#io","title":"IO\u6a21\u578b","text":"<p>\u963b\u585eSocket IO\uff0c\u4f7f\u7528Okio\u5e93\u5b9e\u73b0</p>"},{"location":"basic/net/binary/","title":"\u7f51\u7edc\u4f20\u8f93-\u6587\u672c\u6587\u4ef6\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u533a\u522b","text":""},{"location":"basic/net/binary/#_1","title":"\u6587\u672c\u6587\u4ef6\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u5b9a\u4e49","text":""},{"location":"basic/net/binary/#asciiunicode","title":"\u8ba1\u7b97\u673a\u5728\u7269\u7406\u5185\u5b58\u4e0a\u9762\u5b58\u653e\u7684\u90fd\u662f\u4e8c\u8fdb\u5236\uff0c\u6240\u4ee5\u6587\u672c\u6587\u4ef6\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u4e3b\u8981\u533a\u522b\u662f\u5728\u903b\u8f91\u4e0a\u7684\u800c\u4e0d\u662f\u7269\u7406\u4e0a\u7684\u3002\u800c\u4ece\u6587\u4ef6\u7684\u7f16\u7801\u65b9\u5f0f\u6765\u770b\uff0c\u6587\u4ef6\u53ef\u4ee5\u5206\u4e3a\u6587\u672c\u6587\u4ef6\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u6587\u672c\u6587\u4ef6\u662f\u57fa\u4e8e\u5b57\u7b26\u7f16\u7801\u7684\u6587\u4ef6\uff0c\u5e38\u89c1\u7684\u6709ASCII\u3001Unicode\u7b49\uff0c\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u57fa\u4e8e\u503c\u7f16\u7801\u7684\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u6210\u662f\u53d8\u957f\u7f16\u7801\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\uff0c\u51b3\u5b9a\u591a\u5c11\u4e2a\u6bd4\u7279\u4ee3\u8868\u4e00\u4e2a\u503c\u3002","text":""},{"location":"basic/net/binary/#ascii","title":"\u4ece\u6587\u4ef6\u7f16\u7801\u7684\u65b9\u5f0f\u6765\u770b\uff0c\u6587\u4ef6\u53ef\u5206\u4e3aASCII\u7801\u6587\u4ef6\u548c\u4e8c\u8fdb\u5236\u7801\u6587\u4ef6\u4e24\u79cd\u3002","text":"<ul> <li>ASCII\u6587\u4ef6\u4e5f\u79f0\u4e3a\u6587\u672c\u6587\u4ef6\uff0c\u8fd9\u79cd\u6587\u4ef6\u5728\u78c1\u76d8\u4e2d\u5b58\u653e\u65f6\u6bcf\u4e2a\u5b57\u7b26\u5bf9\u5e94\u4e00\u4e2a\u5b57\u8282\uff0c\u7528\u4e8e\u5b58\u653e\u5bf9\u5e94\u7684ASCII\u7801\u3002\u4f8b\u5982\uff0c\u65705678\u7684\u5b58\u50a8\u5f62\u5f0f\u4e3a\uff1a</li> </ul> <p>ASCII\u7801\uff1a 00110101 00110110 00110111 00111000 \u3000\u3000\u3000\u3000\u3000              \u2193 \u3000\u3000\u3000\u3000 \u2193\u3000\u3000\u3000\u3000 \u2193 \u3000\u3000\u3000 \u2193     \u3000\u3000\u3000\u3000\u5341\u8fdb\u5236\u7801\uff1a  5\u3000\u3000\u3000\u3000\u3000 6\u3000\u3000\u3000\u3000 7\u3000\u3000\u3000\u3000 8 </p> <p>\u5171\u5360\u75284\u4e2a\u5b57\u8282\u3002ASCII\u7801\u6587\u4ef6\u53ef\u5728\u5c4f\u5e55\u4e0a\u6309\u5b57\u7b26\u663e\u793a\uff0c \u4f8b\u5982\u6e90\u7a0b\u5e8f\u6587\u4ef6\u5c31\u662fASCII\u6587\u4ef6\uff0c\u7528DOS\u547d\u4ee4TYPE\u53ef\u663e\u793a\u6587\u4ef6\u7684\u5185\u5bb9\u3002 \u7531\u4e8e\u662f\u6309\u5b57\u7b26\u663e\u793a\uff0c\u56e0\u6b64\u80fd\u8bfb\u61c2\u6587\u4ef6\u5185\u5bb9\u3002</p> <ul> <li>\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u6309\u4e8c\u8fdb\u5236\u7684\u7f16\u7801\u65b9\u5f0f\u6765\u5b58\u653e\u6587\u4ef6\u7684\u3002 \u4f8b\u5982\uff0c \u65705678\u7684\u5b58\u50a8\u5f62\u5f0f\u4e3a\uff1a 00010110 00101110\u53ea\u5360\u4e8c\u4e2a\u5b57\u8282\u3002\u4e8c\u8fdb\u5236\u6587\u4ef6\u867d\u7136\u4e5f\u53ef\u5728\u5c4f\u5e55\u4e0a\u663e\u793a\uff0c \u4f46\u5176\u5185\u5bb9\u65e0\u6cd5\u8bfb\u61c2\u3002C\u7cfb\u7edf\u5728\u5904\u7406\u8fd9\u4e9b\u6587\u4ef6\u65f6\uff0c\u5e76\u4e0d\u533a\u5206\u7c7b\u578b\uff0c\u90fd\u770b\u6210\u662f\u5b57\u7b26\u6d41\uff0c\u6309\u5b57\u8282\u8fdb\u884c\u5904\u7406\u3002 \u8f93\u5165\u8f93\u51fa\u5b57\u7b26\u6d41\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u53ea\u7531\u7a0b\u5e8f\u63a7\u5236\u800c\u4e0d\u53d7\u7269\u7406\u7b26\u53f7(\u5982\u56de\u8f66\u7b26)\u7684\u63a7\u5236\u3002 \u56e0\u6b64\u4e5f\u628a\u8fd9\u79cd\u6587\u4ef6\u79f0\u4f5c\u201c\u6d41\u5f0f\u6587\u4ef6\u201d\u3002</li> </ul>"},{"location":"basic/net/binary/#_2","title":"\u6587\u672c\u6587\u4ef6\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u5b58\u50a8","text":""},{"location":"basic/net/binary/#_3","title":"\u5b58\u50a8\u7684\u65b9\u5f0f\u4e0d\u540c","text":"<ul> <li>\u4e8c\u8fdb\u5236\u6587\u4ef6\u5c31\u662f\u628a\u5185\u5b58\u4e2d\u7684\u6570\u636e\u6309\u5176\u5728\u5185\u5b58\u4e2d\u5b58\u50a8\u7684\u5f62\u5f0f\u539f\u6837\u8f93\u51fa\u5230\u78c1\u76d8\u4e2d\u5b58\u653e\uff0c\u5373\u5b58\u653e\u7684\u662f\u6570\u636e\u7684\u539f\u5f62\u5f0f\u3002</li> <li>\u6587\u672c\u6587\u4ef6\u662f\u628a\u6570\u636e\u7684\u7ec8\u7aef\u5f62\u5f0f\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u8f93\u51fa\u5230\u78c1\u76d8\u4e0a\u5b58\u653e\uff0c\u5373\u5b58\u653e\u7684\u662f\u6570\u636e\u7684\u7ec8\u7aef\u5f62\u5f0f</li> </ul>"},{"location":"basic/net/binary/#_4","title":"\u5728\u5b9e\u9645\u5b58\u50a8\u4e2d\u6700\u597d\u662f\u5c06\u6570\u636e\u5206\u6210\u5b57\u7b26\u6570\u636e\u548c\u975e\u5b57\u7b26\u6570\u636e\u4e24\u7c7b:","text":"<ul> <li>\u5982\u679c\u5b58\u50a8\u7684\u662f\u5b57\u7b26\u6570\u636e\uff0c\u65e0\u8bba\u91c7\u7528\u6587\u672c\u6587\u4ef6\u8fd8\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6\u90fd\u662f\u6ca1\u6709\u4efb\u4f55\u533a\u522b\u7684\uff0c\u6240\u4ee5\u8ba8\u8bba\u4f7f\u7528\u6587\u672c\u6587\u4ef6\u8fd8\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u6ca1\u6709\u610f\u4e49\u7684\u3002</li> <li> <p>\u5982\u679c\u5b58\u50a8\u7684\u662f\u975e\u5b57\u7b26\u6570\u636e\uff0c\u53c8\u8981\u770b\u6211\u4eec\u4f7f\u7528\u7684\u60c5\u51b5\u6765\u51b3\u5b9a:</p> </li> <li> <p>\u5982\u679c\u662f\u9700\u8981\u9891\u7e41\u7684\u4fdd\u5b58\u548c\u8bbf\u95ee\u6570\u636e\uff0c\u90a3\u4e48\u5e94\u8be5\u91c7\u53d6\u4e8c\u8fdb\u5236\u6587\u4ef6\u8fdb\u884c\u5b58\u653e\uff0c\u8fd9\u6837\u53ef\u4ee5\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u548c\u8f6c\u6362\u65f6\u95f4\u3002</p> </li> <li> <p>\u5982\u679c\u9700\u8981\u9891\u7e41\u7684\u5411\u7ec8\u7aef\u663e\u793a\u6570\u636e\u6216\u4ece\u7ec8\u7aef\u8bfb\u5165\u6570\u636e\uff0c\u90a3\u4e48\u5e94\u8be5\u91c7\u7528\u6587\u672c\u6587\u4ef6\u8fdb\u884c\u5b58\u653e\uff0c\u8fd9\u6837\u53ef\u4ee5\u8282\u7701\u8f6c\u6362\u65f6\u95f4\u3002</p> </li> </ul>"},{"location":"basic/net/binary/#_5","title":"\u6587\u672c\u6587\u4ef6\u7684\u6253\u5f00\u65b9\u5f0f\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u6253\u5f00\u65b9\u5f0f\u7684\u533a\u522b","text":"<ul> <li>\u6587\u672c\u6a21\u5f0f\u4e2d\u56de\u8f66\u88ab\u5f53\u6210\u4e00\u4e2a\u5b57\u7b26'\\n'\uff0c\u5728\u6587\u4ef6\u4e2d\u5982\u679c\u8bfb\u52300x1B,\u6587\u672c\u6a21\u5f0f\u4f1a\u8ba4\u4e3a\u8fd9\u662f\u6587\u4ef6\u7ed3\u675f\u7b26\uff0c\u4f1a\u6309\u7167\u4e00\u5b9a\u65b9\u5f0f\u5bf9\u6570\u636e\u505a\u76f8\u5e94\u7684\u8f6c\u6362\u3002</li> <li>\u4e8c\u8fdb\u5236\u6a21\u5f0f\u4e2d'\\n'\u4f1a\u88ab\u8ba4\u4e3a\u662f\u4e24\u4e2a\u5b57\u7b260x0D\uff0c0x0A;\u5728\u8bfb\u52300x1B\u65f6\uff0c\u4e8c\u8fdb\u5236\u6a21\u5f0f\u4e0d\u4f1a\u5bf9\u6587\u4ef6\u8fdb\u884c\u5904\u7406\u3002</li> <li> <p>\u53ea\u8bfb/\u5199\u6a21\u5f0f\u7684r/w\u548crb/wb</p> </li> <li> <p><code>r</code>:\u8bfb\u53d6\u5230\u7684\u662f\u6587\u672c\u6570\u636e(\u5b57\u7b26\u7684\u7f16\u7801),\u4f7f\u7528 open() \u6253\u5f00\u6587\u4ef6\u65f6\uff0c\u9ed8\u8ba4\u91c7\u7528 GBK \u7f16\u7801\u3002\u4f46\u5f53\u8981\u6253\u5f00\u7684\u6587\u4ef6\u4e0d\u662f GBK \u7f16\u7801\u683c\u5f0f\u65f6\uff0c\u53ef\u4ee5\u5728\u4f7f\u7528 open() \u51fd\u6570\u65f6\uff0c\u624b\u52a8\u6307\u5b9a\u6253\u5f00\u6587\u4ef6\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u4f8b\u5982\uff1afile = open(\"a.txt\",encoding=\"utf-8\")</p> </li> <li> <p><code>rb</code>: \u8bfb\u53d6\u5230\u7684\u662f\u4e8c\u8fdb\u5236\u6570\u636e(\u5b57\u7b26\u5728\u786c\u76d8\u4e2d\u5b58\u50a8\u7684\u4e8c\u8fdb\u5236),\u4e0d\u9700\u8981\u6307\u5b9a\u7f16\u7801.</p> </li> </ul>"},{"location":"basic/net/net/","title":"\u7f51\u7edc\u57fa\u7840\u77e5\u8bc6","text":""},{"location":"basic/net/net/#1-osi","title":"1. OSI \u4e03\u5c42\u6a21\u578b","text":""},{"location":"basic/net/net/#11","title":"1.1. \u662f\u4ec0\u4e48","text":"<p>OSI \u4e03\u5c42\u6a21\u578b \u662f\u56fd\u9645\u6807\u51c6\u5316\u7ec4\u7ec7\u63d0\u51fa\u4e00\u4e2a\u7f51\u7edc\u5206\u5c42\u6a21\u578b\uff0c\u5176\u5927\u4f53\u7ed3\u6784\u4ee5\u53ca\u6bcf\u4e00\u5c42\u63d0\u4f9b\u7684\u529f\u80fd\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> OSI \u529f\u80fd \u5e94\u7528\u5c42 \u4e3a\u8ba1\u7b97\u673a\u7528\u6237\u63d0\u4f9b\u63a5\u53e3\u548c\u670d\u52a1\u3002 \u8868\u793a\u5c42 \u6570\u636e\u5904\u7406\uff1a\u7f16\u89e3\u7801\u3001\u52a0\u89e3\u5bc6\u7b49\u7b49\u3002 \u4f1a\u8bdd\u5c42 \u7ba1\u7406\uff08\u5efa\u7acb\u3001\u7ef4\u62a4\u3001\u91cd\u8fde\uff09\u901a\u4fe1\u4f1a\u8bdd\u3002 \u4f20\u8f93\u5c42 \u7ba1\u7406\u7aef\u5230\u7aef\u7684\u901a\u4fe1\u8fde\u63a5\u3002 \u7f51\u7edc\u5c42 \u6570\u636e\u8def\u7531\uff1a\u51b3\u5b9a\u6570\u636e\u5728\u7f51\u7edc\u4e2d\u7684\u8def\u5f84\u3002 \u6570\u636e\u94fe\u8def\u5c42 \u7ba1\u7406\u76f8\u90bb\u8282\u70b9\u4e4b\u95f4\u7684\u6570\u636e\u901a\u4fe1\u3002 \u7269\u7406\u5c42 \u6570\u636e\u901a\u4fe1\u7684\u5149\u7535\u7269\u7406\u7279\u6027\u3002 <p></p> <p>\u6bcf\u4e00\u5c42\u90fd\u4e13\u6ce8\u505a\u4e00\u4ef6\u4e8b\u60c5\uff0c\u5e76\u4e14\u6bcf\u4e00\u5c42\u90fd\u9700\u8981\u4f7f\u7528\u4e0b\u4e00\u5c42\u63d0\u4f9b\u7684\u529f\u80fd\u6bd4\u5982\u4f20\u8f93\u5c42\u9700\u8981\u4f7f\u7528\u7f51\u7edc\u5c42\u63d0\u4f9b\u7684\u8def\u7531\u548c\u5bfb\u5740\u529f\u80fd\uff0c\u8fd9\u6837\u4f20\u8f93\u5c42\u624d\u77e5\u9053\u628a\u6570\u636e\u4f20\u8f93\u5230\u54ea\u91cc\u53bb\u3002</p>"},{"location":"basic/net/net/#12-tcpip","title":"1.2. TCP/IP \u56db\u5c42\u6a21\u578b","text":"<p>TCP/IP \u56db\u5c42\u6a21\u578b \u662f\u76ee\u524d\u88ab\u5e7f\u6cdb\u91c7\u7528\u7684\u4e00\u79cd\u6a21\u578b,\u6211\u4eec\u53ef\u4ee5\u5c06 TCP / IP \u6a21\u578b\u770b\u4f5c\u662f OSI \u4e03\u5c42\u6a21\u578b\u7684\u7cbe\u7b80\u7248\u672c\uff0c\u7531\u4ee5\u4e0b 4 \u5c42\u7ec4\u6210\uff1a</p> <ol> <li>\u5e94\u7528\u5c42</li> <li>\u4f20\u8f93\u5c42</li> <li>\u7f51\u7edc\u5c42</li> <li>\u7f51\u7edc\u63a5\u53e3\u5c42</li> </ol> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u5c06 TCP/IP \u56db\u5c42\u6a21\u578b \u548c OSI \u4e03\u5c42\u6a21\u578b\u5b8c\u5168\u7cbe\u786e\u5730\u5339\u914d\u8d77\u6765\uff0c\u4e0d\u8fc7\u53ef\u4ee5\u7b80\u5355\u5c06\u4e24\u8005\u5bf9\u5e94\u8d77\u6765\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u65e2\u7136 OSI \u4e03\u5c42\u6a21\u578b\u8fd9\u4e48\u5389\u5bb3\uff0c\u4e3a\u4ec0\u4e48\u5e72\u4e0d\u8fc7 TCP/IP \u56db \u5c42\u6a21\u578b\u5462\uff1f</p> <p>\u7684\u786e\uff0cOSI \u4e03\u5c42\u6a21\u578b\u5f53\u65f6\u4e00\u76f4\u88ab\u4e00\u4e9b\u5927\u516c\u53f8\u751a\u81f3\u4e00\u4e9b\u56fd\u5bb6\u653f\u5e9c\u652f\u6301\u3002\u8fd9\u6837\u7684\u80cc\u666f\u4e0b\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u5931\u8d25\u5462\uff1f\u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u65b9\u9762\u539f\u56e0\uff1a</p> <ol> <li>OSI \u7684\u4e13\u5bb6\u7f3a\u4e4f\u5b9e\u9645\u7ecf\u9a8c\uff0c\u4ed6\u4eec\u5728\u5b8c\u6210 OSI \u6807\u51c6\u65f6\u7f3a\u4e4f\u5546\u4e1a\u9a71\u52a8\u529b</li> <li>OSI \u7684\u534f\u8bae\u5b9e\u73b0\u8d77\u6765\u8fc7\u5206\u590d\u6742\uff0c\u800c\u4e14\u8fd0\u884c\u6548\u7387\u5f88\u4f4e</li> <li>OSI \u5236\u5b9a\u6807\u51c6\u7684\u5468\u671f\u592a\u957f\uff0c\u56e0\u800c\u4f7f\u5f97\u6309 OSI \u6807\u51c6\u751f\u4ea7\u7684\u8bbe\u5907\u65e0\u6cd5\u53ca\u65f6\u8fdb\u5165\u5e02\u573a\uff0820 \u4e16\u7eaa 90 \u5e74\u4ee3\u521d\u671f\uff0c\u867d\u7136\u6574\u5957\u7684 OSI \u56fd\u9645\u6807\u51c6\u90fd\u5df2\u7ecf\u5236\u5b9a\u51fa\u6765\uff0c\u4f46\u57fa\u4e8e TCP/IP \u7684\u4e92\u8054\u7f51\u5df2\u7ecf\u62a2\u5148\u5728\u5168\u7403\u76f8\u5f53\u5927\u7684\u8303\u56f4\u6210\u529f\u8fd0\u884c\u4e86\uff09</li> <li>OSI \u7684\u5c42\u6b21\u5212\u5206\u4e0d\u592a\u5408\u7406\uff0c\u6709\u4e9b\u529f\u80fd\u5728\u591a\u4e2a\u5c42\u6b21\u4e2d\u91cd\u590d\u51fa\u73b0</li> </ol>"},{"location":"basic/net/net/#122application-layer","title":"1.2.2.\u5e94\u7528\u5c42\uff08Application layer\uff09","text":"<p>\u5e94\u7528\u5c42\u4f4d\u4e8e\u4f20\u8f93\u5c42\u4e4b\u4e0a\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e24\u4e2a\u7ec8\u7aef\u8bbe\u5907\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u4fe1\u606f\u4ea4\u6362\u7684\u670d\u52a1\uff0c\u5b83\u5b9a\u4e49\u4e86\u4fe1\u606f\u4ea4\u6362\u7684\u683c\u5f0f\uff0c\u6d88\u606f\u4f1a\u4ea4\u7ed9\u4e0b\u4e00\u5c42\u4f20\u8f93\u5c42\u6765\u4f20\u8f93\u3002 \u6211\u4eec\u628a\u5e94\u7528\u5c42\u4ea4\u4e92\u7684\u6570\u636e\u5355\u5143\u79f0\u4e3a\u62a5\u6587\u3002</p>"},{"location":"basic/net/net/#123transport-layer","title":"1.2.3.\u4f20\u8f93\u5c42\uff08Transport layer\uff09","text":"<p>\u4f20\u8f93\u5c42\u7684\u4e3b\u8981\u4efb\u52a1\u5c31\u662f\u8d1f\u8d23\u5411\u4e24\u53f0\u7ec8\u7aef\u8bbe\u5907\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u63d0\u4f9b\u901a\u7528\u7684\u6570\u636e\u4f20\u8f93\u670d\u52a1\u3002 \u5e94\u7528\u8fdb\u7a0b\u5229\u7528\u8be5\u670d\u52a1\u4f20\u9001\u5e94\u7528\u5c42\u62a5\u6587\u3002\u201c\u901a\u7528\u7684\u201d\u662f\u6307\u5e76\u4e0d\u9488\u5bf9\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u7f51\u7edc\u5e94\u7528\uff0c\u800c\u662f\u591a\u79cd\u5e94\u7528\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u8fd0\u8f93\u5c42\u670d\u52a1\u3002</p> <p>\u8fd0\u8f93\u5c42\u4e3b\u8981\u4f7f\u7528\u4ee5\u4e0b\u4e24\u79cd\u534f\u8bae\uff1a</p> <ol> <li>\u4f20\u8f93\u63a7\u5236\u534f\u8bae TCP\uff08Transmisson Control Protocol\uff09--\u63d0\u4f9b \u9762\u5411\u8fde\u63a5 \u7684\uff0c\u53ef\u9760\u7684 \u6570\u636e\u4f20\u8f93\u670d\u52a1\u3002</li> <li>\u7528\u6237\u6570\u636e\u534f\u8bae UDP\uff08User Datagram Protocol\uff09--\u63d0\u4f9b \u65e0\u8fde\u63a5 \u7684\uff0c\u5c3d\u6700\u5927\u52aa\u529b\u7684\u6570\u636e\u4f20\u8f93\u670d\u52a1\uff08\u4e0d\u4fdd\u8bc1\u6570\u636e\u4f20\u8f93\u7684\u53ef\u9760\u6027\uff09\u3002</li> </ol>"},{"location":"basic/net/net/#124network-layer","title":"1.2.4.\u7f51\u7edc\u5c42\uff08Network layer\uff09","text":"<p>\u7f51\u7edc\u5c42\u8d1f\u8d23\u4e3a\u5206\u7ec4\u4ea4\u6362\u7f51\u4e0a\u7684\u4e0d\u540c\u4e3b\u673a\u63d0\u4f9b\u901a\u4fe1\u670d\u52a1\u3002 \u5728\u53d1\u9001\u6570\u636e\u65f6\uff0c\u7f51\u7edc\u5c42\u628a\u8fd0\u8f93\u5c42\u4ea7\u751f\u7684\u62a5\u6587\u6bb5\u6216\u7528\u6237\u6570\u636e\u62a5\u5c01\u88c5\u6210\u5206\u7ec4\u548c\u5305\u8fdb\u884c\u4f20\u9001\u3002\u5728 TCP/IP \u4f53\u7cfb\u7ed3\u6784\u4e2d\uff0c\u7531\u4e8e\u7f51\u7edc\u5c42\u4f7f\u7528 IP \u534f\u8bae\uff0c\u56e0\u6b64\u5206\u7ec4\u4e5f\u53eb IP \u6570\u636e\u62a5\uff0c\u7b80\u79f0\u6570\u636e\u62a5\u3002</p> <p>\u6ce8\u610f \uff1a\u4e0d\u8981\u628a\u8fd0\u8f93\u5c42\u7684\u201c\u7528\u6237\u6570\u636e\u62a5 UDP\u201d\u548c\u7f51\u7edc\u5c42\u7684\u201cIP \u6570\u636e\u62a5\u201d\u5f04\u6df7\u3002</p> <p>\u7f51\u7edc\u5c42\u7684\u8fd8\u6709\u4e00\u4e2a\u4efb\u52a1\u5c31\u662f\u9009\u62e9\u5408\u9002\u7684\u8def\u7531\uff0c\u4f7f\u6e90\u4e3b\u673a\u8fd0\u8f93\u5c42\u6240\u4f20\u4e0b\u6765\u7684\u5206\u7ec4\uff0c\u80fd\u901a\u8fc7\u7f51\u7edc\u5c42\u4e2d\u7684\u8def\u7531\u5668\u627e\u5230\u76ee\u7684\u4e3b\u673a\u3002</p> <p>\u8fd9\u91cc\u5f3a\u8c03\u6307\u51fa\uff0c\u7f51\u7edc\u5c42\u4e2d\u7684\u201c\u7f51\u7edc\u201d\u4e8c\u5b57\u5df2\u7ecf\u4e0d\u662f\u6211\u4eec\u901a\u5e38\u8c08\u5230\u7684\u5177\u4f53\u7f51\u7edc\uff0c\u800c\u662f\u6307\u8ba1\u7b97\u673a\u7f51\u7edc\u4f53\u7cfb\u7ed3\u6784\u6a21\u578b\u4e2d\u7b2c\u4e09\u5c42\u7684\u540d\u79f0\u3002</p> <p>\u4e92\u8054\u7f51\u662f\u7531\u5927\u91cf\u7684\u5f02\u6784\uff08heterogeneous\uff09\u7f51\u7edc\u901a\u8fc7\u8def\u7531\u5668\uff08router\uff09\u76f8\u4e92\u8fde\u63a5\u8d77\u6765\u7684\u3002\u4e92\u8054\u7f51\u4f7f\u7528\u7684\u7f51\u7edc\u5c42\u534f\u8bae\u662f\u65e0\u8fde\u63a5\u7684\u7f51\u9645\u534f\u8bae\uff08Internet Prococol\uff09\u548c\u8bb8\u591a\u8def\u7531\u9009\u62e9\u534f\u8bae\uff0c\u56e0\u6b64\u4e92\u8054\u7f51\u7684\u7f51\u7edc\u5c42\u4e5f\u53eb\u505a \u7f51\u9645\u5c42 \u6216 IP \u5c42\u3002</p> <p>\u7f51\u7edc\u5c42\u5e38\u89c1\u534f\u8bae \uff1a</p> <ul> <li>IP:\u7f51\u9645\u534f\u8bae \uff1a\u7f51\u9645\u534f\u8bae IP \u662fTCP/IP\u534f\u8bae\u4e2d\u6700\u91cd\u8981\u7684\u534f\u8bae\u4e4b\u4e00\uff0c\u4e5f\u662f\u7f51\u7edc\u5c42\u6700\u91cd\u8981\u7684\u534f\u8bae\u4e4b\u4e00\uff0cIP\u534f\u8bae\u7684\u4f5c\u7528\u5305\u62ec\u5bfb\u5740\u89c4\u7ea6\u3001\u5b9a\u4e49\u6570\u636e\u5305\u7684\u683c\u5f0f\u7b49\u7b49\uff0c\u662f\u7f51\u7edc\u5c42\u4fe1\u606f\u4f20\u8f93\u7684\u4e3b\u529b\u534f\u8bae\u3002\u76ee\u524dIP\u534f\u8bae\u4e3b\u8981\u5206\u4e3a\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u8fc7\u53bb\u7684IPv4\uff0c\u53e6\u4e00\u79cd\u662f\u8f83\u65b0\u7684IPv6\uff0c\u76ee\u524d\u8fd9\u4e24\u79cd\u534f\u8bae\u90fd\u5728\u4f7f\u7528\uff0c\u4f46\u540e\u8005\u5df2\u7ecf\u88ab\u63d0\u8bae\u6765\u53d6\u4ee3\u524d\u8005\u3002</li> <li>ARP \u534f\u8bae \uff1aARP\u534f\u8bae\uff0c\u5168\u79f0\u5730\u5740\u89e3\u6790\u534f\u8bae\uff08Address Resolution Protocol\uff09\uff0c\u5b83\u89e3\u51b3\u7684\u662f\u7f51\u7edc\u5c42\u5730\u5740\u548c\u94fe\u8def\u5c42\u5730\u5740\u4e4b\u95f4\u7684\u8f6c\u6362\u95ee\u9898\u3002\u56e0\u4e3a\u4e00\u4e2aIP\u6570\u636e\u62a5\u5728\u7269\u7406\u4e0a\u4f20\u8f93\u7684\u8fc7\u7a0b\u4e2d\uff0c\u603b\u662f\u9700\u8981\u77e5\u9053\u4e0b\u4e00\u8df3\uff08\u7269\u7406\u4e0a\u7684\u4e0b\u4e00\u4e2a\u76ee\u7684\u5730\uff09\u8be5\u53bb\u5f80\u4f55\u5904\uff0c\u4f46IP\u5730\u5740\u5c5e\u4e8e\u903b\u8f91\u5730\u5740\uff0c\u800cMAC\u5730\u5740\u624d\u662f\u7269\u7406\u5730\u5740\uff0cARP\u534f\u8bae\u89e3\u51b3\u4e86IP\u5730\u5740\u8f6cMAC\u5730\u5740\u7684\u4e00\u4e9b\u95ee\u9898\u3002</li> <li>NAT:\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u534f\u8bae \uff1aNAT\u534f\u8bae\uff08Network Address Translation\uff09\u7684\u5e94\u7528\u573a\u666f\u5982\u540c\u5b83\u7684\u540d\u79f0\u2014\u2014\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff0c\u5e94\u7528\u4e8e\u5185\u90e8\u7f51\u5230\u5916\u90e8\u7f51\u7684\u5730\u5740\u8f6c\u6362\u8fc7\u7a0b\u4e2d\u3002\u5177\u4f53\u5730\u8bf4\uff0c\u5728\u4e00\u4e2a\u5c0f\u7684\u5b50\u7f51\uff08\u5c40\u57df\u7f51\uff0cLAN\uff09\u5185\uff0c\u5404\u4e3b\u673a\u4f7f\u7528\u7684\u662f\u540c\u4e00\u4e2aLAN\u4e0b\u7684IP\u5730\u5740\uff0c\u4f46\u5728\u8be5LAN\u4ee5\u5916\uff0c\u5728\u5e7f\u57df\u7f51\uff08WAN\uff09\u4e2d\uff0c\u9700\u8981\u4e00\u4e2a\u7edf\u4e00\u7684IP\u5730\u5740\u6765\u6807\u8bc6\u8be5LAN\u5728\u6574\u4e2aInternet\u4e0a\u7684\u4f4d\u7f6e\u3002</li> </ul>"},{"location":"basic/net/net/#125network-interface-layer","title":"1.2.5.\u7f51\u7edc\u63a5\u53e3\u5c42\uff08Network interface layer\uff09","text":"<p>\u6211\u4eec\u53ef\u4ee5\u628a\u7f51\u7edc\u63a5\u53e3\u5c42\u770b\u4f5c\u662f\u6570\u636e\u94fe\u8def\u5c42\u548c\u7269\u7406\u5c42\u7684\u5408\u4f53\u3002</p> <ol> <li>\u6570\u636e\u94fe\u8def\u5c42(data link layer)\u901a\u5e38\u7b80\u79f0\u4e3a\u94fe\u8def\u5c42\uff08 \u4e24\u53f0\u4e3b\u673a\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\uff0c\u603b\u662f\u5728\u4e00\u6bb5\u4e00\u6bb5\u7684\u94fe\u8def\u4e0a\u4f20\u9001\u7684\uff09\u3002\u6570\u636e\u94fe\u8def\u5c42\u7684\u4f5c\u7528\u662f\u5c06\u7f51\u7edc\u5c42\u4ea4\u4e0b\u6765\u7684 IP \u6570\u636e\u62a5\u7ec4\u88c5\u6210\u5e27\uff0c\u5728\u4e24\u4e2a\u76f8\u90bb\u8282\u70b9\u95f4\u7684\u94fe\u8def\u4e0a\u4f20\u9001\u5e27\u3002\u6bcf\u4e00\u5e27\u5305\u62ec\u6570\u636e\u548c\u5fc5\u8981\u7684\u63a7\u5236\u4fe1\u606f\uff08\u5982\u540c\u6b65\u4fe1\u606f\uff0c\u5730\u5740\u4fe1\u606f\uff0c\u5dee\u9519\u63a7\u5236\u7b49\uff09\u3002</li> <li>\u7269\u7406\u5c42\u7684\u4f5c\u7528\u662f\u5b9e\u73b0\u76f8\u90bb\u8ba1\u7b97\u673a\u8282\u70b9\u4e4b\u95f4\u6bd4\u7279\u6d41\u7684\u900f\u660e\u4f20\u9001\uff0c\u5c3d\u53ef\u80fd\u5c4f\u853d\u6389\u5177\u4f53\u4f20\u8f93\u4ecb\u8d28\u548c\u7269\u7406\u8bbe\u5907\u7684\u5dee\u5f02</li> </ol> <p>\u4e3a\u4ec0\u4e48\u7f51\u7edc\u8981\u5206\u5c42</p> <p>\u590d\u6742\u7684\u7cfb\u7edf\u9700\u8981\u5206\u5c42\uff0c\u56e0\u4e3a\u6bcf\u4e00\u5c42\u90fd\u9700\u8981\u4e13\u6ce8\u4e8e\u4e00\u7c7b\u4e8b\u60c5\u3002\u7f51\u7edc\u5206\u5c42\u7684\u539f\u56e0\u4e5f\u662f\u4e00\u6837\uff0c\u6bcf\u4e00\u5c42\u53ea\u4e13\u6ce8\u4e8e\u505a\u4e00\u7c7b\u4e8b\u60c5\u3002</p> <p>\u7f51\u7edc\u4e4b\u6240\u4ee5\u5206\u5c42\u4e3b\u8981\u6709 3 \u65b9\u9762\u7684\u539f\u56e0\uff1a</p> <ol> <li>\u5404\u5c42\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb\uff1a\u5404\u5c42\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb\uff0c\u5404\u5c42\u4e4b\u95f4\u4e0d\u9700\u8981\u5173\u5fc3\u5176\u4ed6\u5c42\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u53ea\u9700\u8981\u77e5\u9053\u81ea\u5df1\u5982\u4f55\u8c03\u7528\u4e0b\u5c42\u63d0\u4f9b\u597d\u7684\u529f\u80fd\u5c31\u53ef\u4ee5\u4e86\uff08\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u63a5\u53e3\u8c03\u7528\uff09\u3002\u8fd9\u4e2a\u548c\u6211\u4eec\u5bf9\u5f00\u53d1\u65f6\u7cfb\u7edf\u8fdb\u884c\u5206\u5c42\u662f\u4e00\u4e2a\u9053\u7406\u3002</li> <li>\u63d0\u9ad8\u4e86\u6574\u4f53\u7075\u6d3b\u6027 \uff1a\u6bcf\u4e00\u5c42\u90fd\u53ef\u4ee5\u4f7f\u7528\u6700\u9002\u5408\u7684\u6280\u672f\u6765\u5b9e\u73b0\uff0c\u4f60\u53ea\u9700\u8981\u4fdd\u8bc1\u4f60\u63d0\u4f9b\u7684\u529f\u80fd\u4ee5\u53ca\u66b4\u9732\u7684\u63a5\u53e3\u7684\u89c4\u5219\u6ca1\u6709\u6539\u53d8\u5c31\u884c\u4e86\u3002\u8fd9\u4e2a\u548c\u6211\u4eec\u5e73\u65f6\u5f00\u53d1\u7cfb\u7edf\u7684\u65f6\u5019\u8981\u6c42\u7684\u9ad8\u5185\u805a\u3001\u4f4e\u8026\u5408\u7684\u539f\u5219\u4e5f\u662f\u53ef\u4ee5\u5bf9\u5e94\u4e0a\u7684\u3002</li> <li>\u5927\u95ee\u9898\u5316\u5c0f \uff1a \u5206\u5c42\u53ef\u4ee5\u5c06\u590d\u6742\u7684\u7f51\u7edc\u95f4\u9898\u5206\u89e3\u4e3a\u8bb8\u591a\u6bd4\u8f83\u5c0f\u7684\u3001\u754c\u7ebf\u6bd4\u8f83\u6e05\u6670\u7b80\u5355\u7684\u5c0f\u95ee\u9898\u6765\u5904\u7406\u548c\u89e3\u51b3\u3002\u8fd9\u6837\u4f7f\u5f97\u590d\u6742\u7684\u8ba1\u7b97\u673a\u7f51\u7edc\u7cfb\u7edf\u53d8\u5f97\u6613\u4e8e\u8bbe\u8ba1\uff0c\u5b9e\u73b0\u548c\u6807\u51c6\u5316\u3002 \u8fd9\u4e2a\u548c\u6211\u4eec\u5e73\u65f6\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u4e00\u822c\u4f1a\u5c06\u7cfb\u7edf\u529f\u80fd\u5206\u89e3\uff0c\u7136\u540e\u5c06\u590d\u6742\u7684\u95ee\u9898\u5206\u89e3\u4e3a\u5bb9\u6613\u7406\u89e3\u7684\u66f4\u5c0f\u7684\u95ee\u9898\u662f\u76f8\u5bf9\u5e94\u7684\uff0c\u8fd9\u4e9b\u8f83\u5c0f\u7684\u95ee\u9898\u5177\u6709\u66f4\u597d\u7684\u8fb9\u754c\uff08\u76ee\u6807\u548c\u63a5\u53e3\uff09\u5b9a\u4e49\u3002</li> </ol>"},{"location":"basic/net/net/#2-http","title":"2. HTTP","text":""},{"location":"basic/net/net/#21","title":"2.1 \u662f\u4ec0\u4e48\uff1f","text":"<ul> <li>HyperText \u5373\u8d85\u6587\u672c\u3001\u8d85\u94fe\u63a5\uff0cHttp \u662f\u6307\u5728\u7535\u8111\u4e2d\u663e\u793a\u7684\u3001\u542b\u6709\u53ef\u4ee5\u6307\u5411\u5176\u4ed6\u6587\u672c\u7684\u94fe\u63a5\u6587\u672c\u3002</li> <li>\u5bf9\u4e8e\u8fd9\u4e9b\u5185\u5bb9\u90fd\u6709\u4e00\u4e2a\u7edf\u4e00\u7684\u8def\u5f84\uff0c\u4f8b\u5982\uff1a <code>http(s)://&lt;\u4e3b\u673a&gt;:&lt;\u7aef\u53e3&gt;/&lt;\u8def\u5f84&gt;</code>\u3002</li> <li>HTTP \u534f\u8bae\u5e95\u5c42\u662f TCP \u534f\u8bae\uff0c\u56e0\u6b64\u5b83\u662f\u53ef\u9760\u7684\u6570\u636e\u4f20\u8f93\u534f\u8bae\u3002</li> </ul>"},{"location":"basic/net/net/#22-url","title":"2.2. \u4ece\u8f93\u5165URL \u5230\u9875\u9762\u5c55\u793a\u5230\u5e95\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f","text":"<p>\u603b\u4f53\u6765\u8bf4\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u8fc7\u7a0b:</p> <ol> <li>DNS \u89e3\u6790</li> <li>TCP \u8fde\u63a5</li> <li>\u53d1\u9001 HTTP \u8bf7\u6c42</li> <li>\u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u5e76\u8fd4\u56de HTTP \u62a5\u6587</li> <li>\u6d4f\u89c8\u5668\u89e3\u6790\u6e32\u67d3\u9875\u9762</li> <li>\u8fde\u63a5\u7ed3\u675f</li> </ol> <p></p>"},{"location":"basic/net/net/#23-get-post","title":"2.3 GET \u548c POST \u7684\u533a\u522b","text":"<p>\u9996\u5148\u6700\u76f4\u89c2\u7684\u662f\u8bed\u4e49\u4e0a\u7684\u533a\u522b\u3002</p> <p>\u800c\u540e\u53c8\u6709\u8fd9\u6837\u4e00\u4e9b\u5177\u4f53\u7684\u5dee\u522b:</p> <ul> <li>\u4ece \u7f13\u5b58 \u7684\u89d2\u5ea6\uff0cGET \u8bf7\u6c42\u4f1a\u88ab\u6d4f\u89c8\u5668\u4e3b\u52a8\u7f13\u5b58\u4e0b\u6765\uff0c\u7559\u4e0b\u5386\u53f2\u8bb0\u5f55\uff0c\u800c POST \u9ed8\u8ba4\u4e0d\u4f1a\u3002</li> <li>\u4ece \u7f16\u7801 \u7684\u89d2\u5ea6\uff0cGET \u53ea\u80fd\u8fdb\u884c URL \u7f16\u7801\uff0c\u53ea\u80fd\u63a5\u6536 ASCII \u5b57\u7b26\uff0c\u800c POST \u6ca1\u6709\u9650\u5236\u3002</li> <li>\u4ece \u53c2\u6570 \u7684\u89d2\u5ea6\uff0cGET \u4e00\u822c\u653e\u5728 URL \u4e2d\uff0c\u56e0\u6b64\u4e0d\u5b89\u5168\uff0cPOST \u653e\u5728\u8bf7\u6c42\u4f53\u4e2d\uff0c\u66f4\u9002\u5408\u4f20\u8f93\u654f\u611f\u4fe1\u606f\u3002</li> <li>\u4ece \u5e42\u7b49\u6027 \u7684\u89d2\u5ea6\uff0c<code>GET</code>\u662f \u5e42\u7b49 \u7684\uff0c\u800c<code>POST</code>\u4e0d\u662f\u3002(<code>\u5e42\u7b49</code>\u8868\u793a\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\uff0c\u7ed3\u679c\u4e5f\u662f\u76f8\u540c\u7684)</li> </ul>"},{"location":"basic/net/net/#24-http","title":"2.4 HTTP \u5e38\u89c1\u72b6\u6001\u7801","text":"\u7c7b\u522b \u539f\u56e0\u77ed\u8bed 100~199 \u4fe1\u606f\u6027\u72b6\u6001\u7801 \u63a5\u53d7\u7684\u8bf7\u6c42\u6b63\u5728\u5904\u7406 200~299 \u6210\u529f\u72b6\u6001\u7801 \u8bf7\u6c42\u6b63\u5e38\u5904\u7406\u5b8c\u6bd5 300~399 \u91cd\u5b9a\u5411\u72b6\u6001\u7801 \u9700\u8981\u8fdb\u884c\u9644\u52a0\u64cd\u4f5c\u4ee5\u5b8c\u6210\u8bf7\u6c42 400~499 \u5ba2\u6237\u7aef\u9519\u8bef\u72b6\u6001\u7801 \u670d\u52a1\u5668\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42 500~599 \u670d\u52a1\u7aef\u9519\u8bef\u72b6\u6001\u7801 \u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u51fa\u9519 <ul> <li> <p>101\uff1aSwitching Protocols\uff0c\u670d\u52a1\u5668\u540c\u610f\u5c06 HTTP \u5347\u7ea7\u4e3a WebSocket \u65f6\u53d1\u9001\u3002</p> </li> <li> <p>200 OK \uff1a\u8bf7\u6c42\u88ab\u6210\u529f\u5904\u7406\u3002\u6bd4\u5982\u6211\u4eec\u53d1\u9001\u4e00\u4e2a\u67e5\u8be2\u7528\u6237\u6570\u636e\u7684HTTP \u8bf7\u6c42\u5230\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u6b63\u786e\u8fd4\u56de\u4e86\u7528\u6237\u6570\u636e\u3002\u8fd9\u4e2a\u662f\u6211\u4eec\u5e73\u65f6\u6700\u5e38\u89c1\u7684\u4e00\u4e2a HTTP \u72b6\u6001\u7801\u3002</p> </li> <li>201 Created \uff1a\u8bf7\u6c42\u88ab\u6210\u529f\u5904\u7406\u5e76\u4e14\u5728\u670d\u52a1\u7aef\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u8d44\u6e90\u3002\u6bd4\u5982\u6211\u4eec\u901a\u8fc7 POST \u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\u3002</li> <li>202 Accepted \uff1a\u670d\u52a1\u7aef\u5df2\u7ecf\u63a5\u6536\u5230\u4e86\u8bf7\u6c42\uff0c\u4f46\u662f\u8fd8\u672a\u5904\u7406\u3002</li> <li>204 No Content \uff1a \u670d\u52a1\u7aef\u5df2\u7ecf\u6210\u529f\u5904\u7406\u4e86\u8bf7\u6c42\uff0c\u4f46\u662f\u6ca1\u6709\u8fd4\u56de\u4efb\u4f55\u5185\u5bb9\u3002</li> <li>301 Moved Permanently \uff1a \u8d44\u6e90\u88ab\u6c38\u4e45\u91cd\u5b9a\u5411\u4e86\u3002\u6bd4\u5982\u4f60\u7684\u7f51\u7ad9\u7684\u7f51\u5740\u66f4\u6362\u4e86\u3002</li> <li>302 Found \uff1a\u8d44\u6e90\u88ab\u4e34\u65f6\u91cd\u5b9a\u5411\u4e86\u3002\u6bd4\u5982\u4f60\u7684\u7f51\u7ad9\u7684\u67d0\u4e9b\u8d44\u6e90\u88ab\u6682\u65f6\u8f6c\u79fb\u5230\u53e6\u5916\u4e00\u4e2a\u7f51\u5740\u3002</li> <li>400 Bad Request \uff1a \u53d1\u9001\u7684HTTP\u8bf7\u6c42\u5b58\u5728\u95ee\u9898\u3002\u6bd4\u5982\u8bf7\u6c42\u53c2\u6570\u4e0d\u5408\u6cd5\u3001\u8bf7\u6c42\u65b9\u6cd5\u9519\u8bef\u3002</li> <li>401 Unauthorized \uff1a \u672a\u8ba4\u8bc1\u5374\u8bf7\u6c42\u9700\u8981\u8ba4\u8bc1\u4e4b\u540e\u624d\u80fd\u8bbf\u95ee\u7684\u8d44\u6e90\u3002</li> <li>403 Forbidden \uff1a\u76f4\u63a5\u62d2\u7eddHTTP\u8bf7\u6c42\uff0c\u4e0d\u5904\u7406\u3002\u4e00\u822c\u7528\u6765\u9488\u5bf9\u975e\u6cd5\u8bf7\u6c42\u3002</li> <li>404 Not Found \uff1a \u4f60\u8bf7\u6c42\u7684\u8d44\u6e90\u672a\u5728\u670d\u52a1\u7aef\u627e\u5230\u3002\u6bd4\u5982\u4f60\u8bf7\u6c42\u67d0\u4e2a\u7528\u6237\u7684\u4fe1\u606f\uff0c\u670d\u52a1\u7aef\u5e76\u6ca1\u6709\u627e\u5230\u6307\u5b9a\u7684\u7528\u6237\u3002</li> <li>409 Conflict \uff1a \u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0e\u670d\u52a1\u7aef\u5f53\u524d\u7684\u72b6\u6001\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u6c42\u65e0\u6cd5\u88ab\u5904\u7406\u3002</li> <li>500 Internal Server Error \uff1a \u670d\u52a1\u7aef\u51fa\u95ee\u9898\u4e86\uff08\u901a\u5e38\u662f\u670d\u52a1\u7aef\u51faBug\u4e86\uff09\u3002\u6bd4\u5982\u4f60\u670d\u52a1\u7aef\u5904\u7406\u8bf7\u6c42\u7684\u65f6\u5019\u7a81\u7136\u629b\u51fa\u5f02\u5e38\uff0c\u4f46\u662f\u5f02\u5e38\u5e76\u672a\u5728\u670d\u52a1\u7aef\u88ab\u6b63\u786e\u5904\u7406\u3002</li> <li>502 Bad Gateway \uff1a\u670d\u52a1\u5668\u81ea\u8eab\u662f\u6b63\u5e38\u7684\uff0c\u53ea\u662f\u6570\u636e\u901a\u9053\u6709\u95ee\u9898\u3002</li> <li>503 Service Unavailable: \u670d\u52a1\u5668\u5f88\u5fd9\uff0c\u65e0\u6cd5\u54cd\u5e94\u670d\u52a1\u3002</li> </ul>"},{"location":"basic/net/net/#25-http","title":"2.5 HTTP\u7279\u70b9&amp;\u7f3a\u70b9","text":""},{"location":"basic/net/net/#251-http","title":"2.5.1 HTTP \u7279\u70b9","text":"<p>HTTP \u7684\u7279\u70b9\u6982\u62ec\u5982\u4e0b:</p> <ol> <li>\u7075\u6d3b\u53ef\u6269\u5c55\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u4e24\u4e2a\u65b9\u9762\u3002\u4e00\u4e2a\u662f\u8bed\u4e49\u4e0a\u7684\u81ea\u7531\uff0c\u53ea\u89c4\u5b9a\u4e86\u57fa\u672c\u683c\u5f0f\uff0c\u6bd4\u5982\u7a7a\u683c\u5206\u9694\u5355\u8bcd\uff0c\u6362\u884c\u5206\u9694\u5b57\u6bb5\uff0c\u5176\u4ed6\u7684\u5404\u4e2a\u90e8\u5206\u90fd\u6ca1\u6709\u4e25\u683c\u7684\u8bed\u6cd5\u9650\u5236\u3002\u53e6\u4e00\u4e2a\u662f\u4f20\u8f93\u5f62\u5f0f\u7684\u591a\u6837\u6027\uff0c\u4e0d\u4ec5\u4ec5\u53ef\u4ee5\u4f20\u8f93\u6587\u672c\uff0c\u8fd8\u80fd\u4f20\u8f93\u56fe\u7247\u3001\u89c6\u9891\u7b49\u4efb\u610f\u6570\u636e\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</li> <li>\u53ef\u9760\u4f20\u8f93\u3002HTTP \u57fa\u4e8e TCP/IP\uff0c\u56e0\u6b64\u628a\u8fd9\u4e00\u7279\u6027\u7ee7\u627f\u4e86\u4e0b\u6765\u3002\u8fd9\u5c5e\u4e8e TCP \u7684\u7279\u6027\uff0c\u4e0d\u5177\u4f53\u4ecb\u7ecd\u4e86\u3002</li> <li>\u8bf7\u6c42-\u5e94\u7b54\u3002\u4e5f\u5c31\u662f<code>\u4e00\u53d1\u4e00\u6536</code>\u3001<code>\u6709\u6765\u6709\u56de</code>\uff0c \u5f53\u7136\u8fd9\u4e2a\u8bf7\u6c42\u65b9\u548c\u5e94\u7b54\u65b9\u4e0d\u5355\u5355\u6307\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\uff0c\u5982\u679c\u67d0\u53f0\u670d\u52a1\u5668\u4f5c\u4e3a\u4ee3\u7406\u6765\u8fde\u63a5\u540e\u7aef\u7684\u670d\u52a1\u7aef\uff0c\u90a3\u4e48\u8fd9\u53f0\u670d\u52a1\u5668\u4e5f\u4f1a\u626e\u6f14 \u8bf7\u6c42\u65b9 \u7684\u89d2\u8272\u3002</li> <li>\u65e0\u72b6\u6001\u3002\u8fd9\u91cc\u7684\u72b6\u6001\u662f\u6307 \u901a\u4fe1\u8fc7\u7a0b\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f \uff0c\u800c\u6bcf\u6b21 http \u8bf7\u6c42\u90fd\u662f\u72ec\u7acb\u3001\u65e0\u5173\u7684\uff0c\u9ed8\u8ba4\u4e0d\u9700\u8981\u4fdd\u7559\u72b6\u6001\u4fe1\u606f\u3002</li> </ol>"},{"location":"basic/net/net/#252-http","title":"2.5.2 HTTP \u7f3a\u70b9","text":"<p>\u65e0\u72b6\u6001</p> <p>\u6240\u8c13\u7684\u4f18\u70b9\u548c\u7f3a\u70b9\u8fd8\u662f\u8981\u5206\u573a\u666f\u6765\u770b\u7684\uff0c\u5bf9\u4e8e HTTP \u800c\u8a00\uff0c\u6700\u5177\u4e89\u8bae\u7684\u5730\u65b9\u5728\u4e8e\u5b83\u7684 \u65e0\u72b6\u6001\u3002</p> <p>\u5728\u9700\u8981\u957f\u8fde\u63a5\u7684\u573a\u666f\u4e2d\uff0c\u9700\u8981\u4fdd\u5b58\u5927\u91cf\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u4ee5\u514d\u4f20\u8f93\u5927\u91cf\u91cd\u590d\u7684\u4fe1\u606f\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u65e0\u72b6\u6001\u5c31\u662f http \u7684\u7f3a\u70b9\u4e86\u3002</p> <p>\u4f46\u4e0e\u6b64\u540c\u65f6\uff0c\u53e6\u5916\u4e00\u4e9b\u5e94\u7528\u4ec5\u4ec5\u53ea\u662f\u4e3a\u4e86\u83b7\u53d6\u4e00\u4e9b\u6570\u636e\uff0c\u4e0d\u9700\u8981\u4fdd\u5b58\u8fde\u63a5\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u65e0\u72b6\u6001\u53cd\u800c\u51cf\u5c11\u4e86\u7f51\u7edc\u5f00\u9500\uff0c\u6210\u4e3a\u4e86 http \u7684\u4f18\u70b9\u3002</p> <p>\u660e\u6587\u4f20\u8f93</p> <p>\u5373\u534f\u8bae\u91cc\u7684\u62a5\u6587(\u4e3b\u8981\u6307\u7684\u662f\u5934\u90e8)\u4e0d\u4f7f\u7528\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u800c\u662f\u6587\u672c\u5f62\u5f0f\u3002</p> <p>\u8fd9\u5f53\u7136\u5bf9\u4e8e\u8c03\u8bd5\u63d0\u4f9b\u4e86\u4fbf\u5229\uff0c\u4f46\u540c\u65f6\u4e5f\u8ba9 HTTP \u7684\u62a5\u6587\u4fe1\u606f\u66b4\u9732\u7ed9\u4e86\u5916\u754c\uff0c\u7ed9\u653b\u51fb\u8005\u4e5f\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002<code>WIFI\u9677\u9631</code>\u5c31\u662f\u5229\u7528 HTTP \u660e\u6587\u4f20\u8f93\u7684\u7f3a\u70b9\uff0c\u8bf1\u5bfc\u4f60\u8fde\u4e0a\u70ed\u70b9\uff0c\u7136\u540e\u75af\u72c2\u6293\u4f60\u6240\u6709\u7684\u6d41\u91cf\uff0c\u4ece\u800c\u62ff\u5230\u4f60\u7684\u654f\u611f\u4fe1\u606f\u3002</p> <p>\u961f\u5934\u963b\u585e\u95ee\u9898</p> <p>\u5f53 http \u5f00\u542f\u957f\u8fde\u63a5\u65f6\uff0c\u5171\u7528\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u90a3\u4e48\u5f53\u524d\u8bf7\u6c42\u8017\u65f6\u8fc7\u957f\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u5b83\u7684\u8bf7\u6c42\u53ea\u80fd\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u8457\u540d\u7684 \u961f\u5934\u963b\u585e \u95ee\u9898\u3002</p>"},{"location":"basic/net/net/#26","title":"2.6 \u5e38\u7528\u5b57\u6bb5","text":""},{"location":"basic/net/net/#261","title":"2.6.1 \u6570\u636e\u683c\u5f0f","text":"<p>\u9996\u5148\u9700\u8981\u4ecb\u7ecd\u4e00\u4e2a\u6807\u51c6\u2014\u2014MIME(Multipurpose Internet Mail Extensions, \u591a\u7528\u9014\u4e92\u8054\u7f51\u90ae\u4ef6\u6269\u5c55)\u3002\u5b83\u9996\u5148\u7528\u5728\u7535\u5b50\u90ae\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u8ba9\u90ae\u4ef6\u53ef\u4ee5\u53d1\u4efb\u610f\u7c7b\u578b\u7684\u6570\u636e\uff0c\u8fd9\u5bf9\u4e8e HTTP \u6765\u8bf4\u4e5f\u662f\u901a\u7528\u7684\u3002HTTP \u4ece MIME type \u53d6\u4e86\u4e00\u90e8\u5206\u6765\u6807\u8bb0\u62a5\u6587 body \u90e8\u5206\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u4e9b\u7c7b\u578b\u4f53\u73b0\u5728 <code>Content-Type</code> \u8fd9\u4e2a\u5b57\u6bb5\uff0c\u5f53\u7136\u8fd9\u662f\u9488\u5bf9\u4e8e\u53d1\u9001\u7aef\u800c\u8a00\uff0c\u63a5\u6536\u7aef\u60f3\u8981\u6536\u5230\u7279\u5b9a\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>Accept</code> \u5b57\u6bb5\u3002</p> <p>\u5177\u4f53\u800c\u8a00\uff0c\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u7684\u53d6\u503c\u53ef\u4ee5\u5206\u4e3a\u4e0b\u9762\u51e0\u7c7b:</p> <ul> <li>text\uff1a text/html, text/plain, text/css \u7b49</li> <li>image: image/gif, image/jpeg, image/png \u7b49</li> <li>audio/video: audio/mpeg, video/mp4 \u7b49</li> <li>application: application/json, application/javascript, application/pdf, application/octet-stream</li> </ul>"},{"location":"basic/net/net/#262","title":"2.6.2 \u538b\u7f29\u65b9\u5f0f","text":"<p>\u91c7\u53d6\u4ec0\u4e48\u6837\u7684\u538b\u7f29\u65b9\u5f0f\u5c31\u4f53\u73b0\u5728\u4e86\u53d1\u9001\u65b9\u7684<code>Content-Encoding</code>\u5b57\u6bb5\u4e0a\uff0c \u540c\u6837\u7684\uff0c\u63a5\u6536\u4ec0\u4e48\u6837\u7684\u538b\u7f29\u65b9\u5f0f\u4f53\u73b0\u5728\u4e86\u63a5\u53d7\u65b9\u7684<code>Accept-Encoding</code>\u5b57\u6bb5\u4e0a\u3002\u8fd9\u4e2a\u5b57\u6bb5\u7684\u53d6\u503c\u6709\u4e0b\u9762\u51e0\u79cd\uff1a</p> <ul> <li>gzip: \u5f53\u4eca\u6700\u6d41\u884c\u7684\u538b\u7f29\u683c\u5f0f</li> <li>deflate: \u53e6\u5916\u4e00\u79cd\u8457\u540d\u7684\u538b\u7f29\u683c\u5f0f</li> <li>br: \u4e00\u79cd\u4e13\u95e8\u4e3a HTTP \u53d1\u660e\u7684\u538b\u7f29\u7b97\u6cd5</li> </ul>"},{"location":"basic/net/net/#263","title":"2.6.3 \u5b9a\u957f\u5305\u4f53","text":"<p>\u5bf9\u4e8e\u5b9a\u957f\u5305\u4f53\u800c\u8a00\uff0c\u53d1\u9001\u7aef\u5728\u4f20\u8f93\u7684\u65f6\u5019\u4e00\u822c\u4f1a\u5e26\u4e0a <code>Content-Length</code>, \u6765\u6307\u660e\u5305\u4f53\u7684\u957f\u5ea6\u3002<code>Content-Length</code>\u5bf9\u4e8e http \u4f20\u8f93\u8fc7\u7a0b\u8d77\u5230\u4e86\u5341\u5206\u5173\u952e\u7684\u4f5c\u7528\uff0c\u5982\u679c\u8bbe\u7f6e\u4e0d\u5f53\u53ef\u4ee5\u76f4\u63a5\u5bfc\u81f4\u4f20\u8f93\u5931\u8d25\u3002</p>"},{"location":"basic/net/net/#264","title":"2.6.4 \u4e0d\u5b9a\u957f\u5305\u4f53","text":"<p>\u5bf9\u4e8e\u4e0d\u5b9a\u957f\u5305\u4f53\u6211\u4eec\u4f7f\u7528 <code>Transfer-Encoding: chunked</code> \u8868\u793a\u5206\u5757\u4f20\u8f93\u6570\u636e\uff0c\u8bbe\u7f6e\u8fd9\u4e2a\u5b57\u6bb5\u540e\u4f1a\u81ea\u52a8\u4ea7\u751f\u4e24\u4e2a\u6548\u679c:</p> <ul> <li>Content-Length \u5b57\u6bb5\u4f1a\u88ab\u5ffd\u7565</li> <li>\u57fa\u4e8e\u957f\u8fde\u63a5\u6301\u7eed\u63a8\u9001\u52a8\u6001\u5185\u5bb9</li> </ul>"},{"location":"basic/net/net/#265","title":"2.6.5 \u5927\u6587\u4ef6\u4f20\u8f93","text":"<p>\u5bf9\u4e8e\u51e0\u767e M \u751a\u81f3\u4e0a G \u7684\u5927\u6587\u4ef6\u6765\u8bf4\uff0c\u5982\u679c\u8981\u4e00\u53e3\u6c14\u5168\u90e8\u4f20\u8f93\u8fc7\u6765\u663e\u7136\u662f\u4e0d\u73b0\u5b9e\u7684\uff0c\u4f1a\u6709\u5927\u91cf\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u4e25\u91cd\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u56e0\u6b64\uff0cHTTP \u9488\u5bf9\u8fd9\u4e00\u573a\u666f\uff0c\u91c7\u53d6\u4e86<code>\u8303\u56f4\u8bf7\u6c42</code>\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5141\u8bb8\u5ba2\u6237\u7aef\u4ec5\u4ec5\u8bf7\u6c42\u4e00\u4e2a\u8d44\u6e90\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u5f53\u7136\uff0c\u524d\u63d0\u662f\u670d\u52a1\u5668\u8981\u652f\u6301 \u8303\u56f4\u8bf7\u6c42\uff0c\u8981\u652f\u6301\u8fd9\u4e2a\u529f\u80fd\uff0c\u5c31\u5fc5\u987b\u52a0\u4e0a <code>Accept-Ranges: none</code> \u8fd9\u6837\u4e00\u4e2a\u54cd\u5e94\u5934\uff0c\u7528\u6765\u544a\u77e5\u5ba2\u6237\u7aef\u8fd9\u8fb9\u662f\u652f\u6301\u8303\u56f4\u8bf7\u6c42\u7684\u3002</p> <p>\u800c\u5bf9\u4e8e\u5ba2\u6237\u7aef\u800c\u8a00\uff0c\u5b83\u9700\u8981\u6307\u5b9a\u8bf7\u6c42\u54ea\u4e00\u90e8\u5206\uff0c\u901a\u8fc7<code>Range</code>\u8fd9\u4e2a\u8bf7\u6c42\u5934\u5b57\u6bb5\u786e\u5b9a\uff0c\u683c\u5f0f\u4e3a<code>bytes=x-y</code>\u3002</p> <ul> <li>0-499 \u8868\u793a\u4ece\u5f00\u59cb\u5230\u7b2c 499 \u4e2a\u5b57\u8282\u3002</li> <li>500- \u8868\u793a\u4ece\u7b2c 500 \u5b57\u8282\u5230\u6587\u4ef6\u7ec8\u70b9\u3002</li> <li>-100 \u8868\u793a\u6587\u4ef6\u7684\u6700\u540e100\u4e2a\u5b57\u8282\u3002</li> </ul> <p>\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u4e4b\u540e\uff0c\u9996\u5148\u9a8c\u8bc1\u8303\u56f4 \u662f\u5426\u5408\u6cd5\uff0c\u5982\u679c\u8d8a\u754c\u4e86\u90a3\u4e48\u8fd4\u56de<code>416</code>\u9519\u8bef\u7801\uff0c\u5426\u5219\u8bfb\u53d6\u76f8\u5e94\u7247\u6bb5\uff0c\u8fd4\u56de<code>206</code>\u72b6\u6001\u7801\u3002</p> <p>\u540c\u65f6\uff0c\u670d\u52a1\u5668\u9700\u8981\u6dfb\u52a0<code>Content-Range</code>\u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u6839\u636e\u8bf7\u6c42\u5934\u4e2d<code>Range</code>\u5b57\u6bb5\u7684\u4e0d\u540c\u800c\u6709\u6240\u5dee\u5f02\u3002</p>"},{"location":"basic/net/net/#266","title":"2.6.6 \u8868\u5355\u6570\u636e\u7684\u63d0\u4ea4","text":"<p>\u5728 http \u4e2d\uff0c\u6709\u4e24\u79cd\u4e3b\u8981\u7684\u8868\u5355\u63d0\u4ea4\u7684\u65b9\u5f0f\uff0c\u4f53\u73b0\u5728\u4e24\u79cd\u4e0d\u540c\u7684<code>Content-Type</code>\u53d6\u503c:</p> <ul> <li>application/x-www-form-urlencoded</li> <li>multipart/form-data</li> </ul> <p>\u5bf9\u4e8e<code>application/x-www-form-urlencoded</code>\u683c\u5f0f\u7684\u8868\u5355\u5185\u5bb9\uff0c\u6709\u4ee5\u4e0b\u7279\u70b9:</p> <ul> <li>\u5176\u4e2d\u7684\u6570\u636e\u4f1a\u88ab\u7f16\u7801\u6210\u4ee5<code>&amp;</code>\u5206\u9694\u7684\u952e\u503c\u5bf9</li> <li>\u5b57\u7b26\u4ee5 URL\u7f16\u7801\u65b9\u5f0f \u7f16\u7801\u3002</li> </ul> <pre><code>// \u8f6c\u6362\u8fc7\u7a0b: {a: 1, b: 2} -&gt; a=1&amp;b=2 -&gt; \u5982\u4e0b(\u6700\u7ec8\u5f62\u5f0f)\n\"a%3D1%26b%3D2\"\n</code></pre> <p>\u5bf9\u4e8e<code>multipart/form-data</code>\u800c\u8a00:</p> <ul> <li>\u8bf7\u6c42\u5934\u4e2d\u7684<code>Content-Type</code>\u5b57\u6bb5\u4f1a\u5305\u542b<code>boundary</code>\uff0c\u4e14<code>boundary</code>\u7684\u503c\u6709\u6d4f\u89c8\u5668\u9ed8\u8ba4\u6307\u5b9a\u3002\u4f8b: <code>Content-Type: multipart/form-data;boundary=----WebkitFormBoundaryRRJKeWfHPGrS4LKe</code>\u3002</li> <li>\u6570\u636e\u4f1a\u5206\u4e3a\u591a\u4e2a\u90e8\u5206\uff0c\u6bcf\u4e24\u4e2a\u90e8\u5206\u4e4b\u95f4\u901a\u8fc7\u5206\u9694\u7b26\u6765\u5206\u9694\uff0c\u6bcf\u90e8\u5206\u8868\u8ff0\u5747\u6709 HTTP \u5934\u90e8\u63cf\u8ff0\u5b50\u5305\u4f53\uff0c\u5982<code>Content-Type</code>\uff0c\u5728\u6700\u540e\u7684\u5206\u9694\u7b26\u4f1a\u52a0\u4e0a<code>--</code>\u8868\u793a\u7ed3\u675f\u3002</li> </ul> <pre><code>Content-Disposition: form-data;name=\"data1\";\nContent-Type: text/plain\ndata1\n----WebkitFormBoundaryRRJKeWfHPGrS4LKe\nContent-Disposition: form-data;name=\"data2\";\nContent-Type: text/plain\ndata2\n----WebkitFormBoundaryRRJKeWfHPGrS4LKe--\n</code></pre> <p>\u5728\u5b9e\u9645\u7684\u573a\u666f\u4e2d\uff0c\u5bf9\u4e8e\u56fe\u7247\u7b49\u6587\u4ef6\u7684\u4e0a\u4f20\uff0c\u57fa\u672c\u91c7\u7528<code>multipart/form-data</code>\u800c\u4e0d\u7528<code>application/x-www-form-urlencoded</code>\uff0c\u56e0\u4e3a\u6ca1\u6709\u5fc5\u8981\u505a URL \u7f16\u7801\uff0c\u5e26\u6765\u5de8\u5927\u8017\u65f6\u7684\u540c\u65f6\u4e5f\u5360\u7528\u4e86\u66f4\u591a\u7684\u7a7a\u95f4\u3002</p>"},{"location":"basic/net/net/#27-http10http11-http20http30","title":"2.7 Http1.0\u3001Http1.1\u3001 Http2.0\u3001Http3.0\u533a\u522b","text":""},{"location":"basic/net/net/#271-http10","title":"2.7.1 HTTP1.0","text":"<p>\u7279\u70b9</p> <ul> <li>\u65e0\u72b6\u6001\uff1a\u670d\u52a1\u5668\u4e0d\u7ef4\u62a4\u4efb\u4f55\u6709\u5173\u5ba2\u6237\u7aef\u8fc7\u53bb\u6240\u53d1\u8bf7\u6c42\u7684\u6d88\u606f</li> <li>\u65e0\u8fde\u63a5/\u77ed\u8fde\u63a5\uff1a\u4e00\u6b21\u8bf7\u6c42 \u4f1a\u5efa\u7acb\u4e00\u4e2aTCP\u8fde\u63a5\uff0c\u8bf7\u6c42\u5b8c\u6210\u540e\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\u3002</li> <li>\u65e0host\u5934\u57df\uff0c\u4e5f\u5c31\u662fhttp\u8bf7\u6c42\u5934\u91cc\u7684host</li> </ul> <p>\u95ee\u9898</p> <ul> <li>\u65e0\u6cd5\u590d\u7528\u8fde\u63a5: \u6bcf\u6b21\u53d1\u9001\u8bf7\u6c42\uff0c\u90fd\u9700\u8981\u8fdb\u884c\u4e00\u6b21TCP\u8fde\u63a5\uff0c\u800cTCP\u7684\u8fde\u63a5\u91ca\u653e\u8fc7\u7a0b\u53c8\u662f\u6bd4\u8f83\u8d39\u4e8b\u7684\u3002\u8fd9\u79cd\u65e0\u8fde\u63a5\u7684\u7279\u6027\u4f1a\u4f7f\u5f97\u7f51\u7edc\u7684\u5229\u7528\u7387\u53d8\u4f4e\u3002</li> <li>\u961f\u5934\u963b\u585e\uff08head of line blocking\uff09: \u7531\u4e8eHTTP1.0\u89c4\u5b9a\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u5fc5\u987b\u5728\u524d\u4e00\u4e2a\u8bf7\u6c42\u54cd\u5e94\u5230\u8fbe\u4e4b\u524d\u624d\u80fd\u53d1\u9001\uff0c\u5047\u8bbe\u524d\u4e00\u4e2a\u8bf7\u6c42\u54cd\u5e94\u4e00\u76f4\u4e0d\u5230\u8fbe\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u5c31\u4e0d\u53d1\u9001\uff0c\u540e\u9762\u7684\u8bf7\u6c42\u5c31\u963b\u585e\u4e86\u3002</li> <li>\u65e0\u6cd5\u65ad\u70b9\u7eed\u4f20\uff1a\u7531\u4e8e\u8bf7\u6c42\u662f\u65e0\u72b6\u6001\u7684\uff0c\u6240\u4ee5\u65e0\u6cd5\u65ad\u70b9\u7eed\u4f20\uff0c\u4e5f\u65e0\u6cd5\u4f20\u8f93\u5bf9\u8c61\u7684\u4e00\u90e8\u5206\uff0c\u5fc5\u987b\u4e00\u6b21\u6027\u4f20\u8f93\u6574\u4e2a\u5bf9\u8c61\u3002</li> </ul>"},{"location":"basic/net/net/#272-http11","title":"2.7.2 HTTP1.1","text":"<p>\u7279\u70b9</p> <ul> <li>\u652f\u6301\u957f\u8fde\u63a5\uff1a\u89e3\u51b3\u4e86HTTP1.0\u4e2d\u8fde\u63a5\u4e0d\u80fd\u590d\u7528\u7684\u95ee\u9898\uff0c\u652f\u6301\u6301\u4e45\u8fde\u63a5\u2014\u2014\u4f7f\u7528 keep-alive\u673a\u5236\uff1a\u4e00\u6b21HTTP\u8bf7\u6c42\u7ed3\u675f\u540e\u4e0d\u4f1a\u7acb\u5373\u65ad\u5f00TCP\u8fde\u63a5\uff0c\u5982\u679c\u6b64\u65f6\u6709\u65b0\u7684HTTP\u8bf7\u6c42\uff0c\u4e14\u5176\u8bf7\u6c42\u7684Host\u540c\u4e0a\u6b21\u8bf7\u6c42\u76f8\u540c\uff0c\u90a3\u4e48\u4f1a\u76f4\u63a5\u590d\u7528TCP\u8fde\u63a5\u3002\u8fd9\u6837\u5c31\u51cf\u5c11\u4e86\u5efa\u7acb\u548c\u5173\u95ed\u8fde\u63a5\u7684\u6d88\u8017\u548c\u5ef6\u8fdf\u3002keep-alive\u673a\u5236\u5728HTTP1.1\u4e2d\u662f\u9ed8\u8ba4\u6253\u5f00\u7684\u2014\u2014\u5373\u5728\u8bf7\u6c42\u5934\u6dfb\u52a0\uff1aconnection:keep-alive\u3002\uff08keep-alive\u4e0d\u4f1a\u6c38\u4e45\u4fdd\u6301\u8fde\u63a5\uff0c\u5b83\u6709\u4e00\u4e2a\u4fdd\u6301\u65f6\u95f4\uff0c\u53ef\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u8f6f\u4ef6\uff08\u5982Apache\uff09\u4e2d\u8bbe\u5b9a\u8fd9\u4e2a\u65f6\u95f4\uff09</li> <li>\u7f13\u5b58\u5904\u7406 \uff0c \u5728 HTTP1.0 \u4e2d\u4e3b\u8981\u4f7f\u7528 header \u91cc\u7684 If-Modified-Since,Expires \u6765\u505a\u4e3a\u7f13\u5b58\u5224\u65ad\u7684\u6807\u51c6\uff0cHTTP1.1 \u5219\u5f15\u5165\u4e86\u66f4\u591a\u7684\u7f13\u5b58\u63a7\u5236\u7b56\u7565\u4f8b\u5982 Entity tag\uff0cIf-Unmodified-Since, If-Match, If-None-Match \u7b49\u66f4\u591a\u53ef\u4f9b\u9009\u62e9\u7684\u7f13\u5b58\u5934\u6765\u63a7\u5236\u7f13\u5b58\u7b56\u7565\u3002</li> <li>\u652f\u6301\u65ad\u70b9\u4f20\u8f93\uff0cHTTP/1.1\u5f15\u5165\u4e86\u8303\u56f4\u8bf7\u6c42\uff08range request\uff09\u673a\u5236\uff0c\u4ee5\u907f\u514d\u5e26\u5bbd\u7684\u6d6a\u8d39\u3002\u5f53\u5ba2\u6237\u7aef\u60f3\u8bf7\u6c42\u4e00\u4e2a\u6587\u4ef6\u7684\u4e00\u90e8\u5206\uff0c\u6216\u8005\u9700\u8981\u7ee7\u7eed\u4e0b\u8f7d\u4e00\u4e2a\u5df2\u7ecf\u4e0b\u8f7d\u4e86\u90e8\u5206\u4f46\u88ab\u7ec8\u6b62\u7684\u6587\u4ef6\uff0cHTTP/1.1\u53ef\u4ee5\u5728\u8bf7\u6c42\u4e2d\u52a0\u5165<code>Range</code>\u5934\u90e8\uff0c\u4ee5\u8bf7\u6c42\uff08\u5e76\u53ea\u80fd\u8bf7\u6c42\u5b57\u8282\u578b\u6570\u636e\uff09\u6570\u636e\u7684\u4e00\u90e8\u5206</li> <li>\u589e\u52a0\u4e86<code>Host</code>\u5b57\u6bb5\uff0c\u4f7f\u5f97\u4e00\u4e2a\u670d\u52a1\u5668\u80fd\u591f\u7528\u6765\u521b\u5efa\u591a\u4e2aWeb\u7ad9\u70b9\u3002</li> </ul> <p>\u95ee\u9898</p> <ul> <li>\u4f9d\u7136\u6709\u961f\u5934\u963b\u585e\u95ee\u9898:\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b,\u6d4f\u89c8\u5668\u83b7\u53d6\u8d44\u6e90\u90fd\u662f\u591a\u4efd\u7684,HTTP/1.1\u5e76\u6ca1\u6709\u63d0\u4f9b\u673a\u5236\u6765\u540c\u65f6\u8bf7\u6c42\u6240\u6709\u7684\u8d44\u6e90,\u5728\u4ec5\u4ec5\u53ea\u6709\u4e00\u4e2a\u8fde\u63a5\u7684\u65f6\u5019(\u5b9e\u9645\u60c5\u51b5,\u73b0\u4ee3\u6d4f\u89c8\u5668\u53ef\u80fd\u9488\u5bf9\u5355\u4e2a\u57df\u540d\u5efa\u7acb\u591a\u4e2a\u8fde\u63a5,\u5b9e\u73b0\u67d0\u7a0b\u5ea6\u5e76\u884c),\u5b83\u9700\u8981\u53d1\u8d77\u8bf7\u6c42,\u5e76\u7b49\u5f85\u54cd\u5e94.\u5728\u8fd9\u4e4b\u540e\u518d\u53d1\u8d77\u4e0b\u4e00\u8bf7\u6c42,\u8bf7\u6c42\u54cd\u5e94.\u5373\u4f7fHTTP/1.1\u6709\u4e00\u4e2a\u7279\u6027\u4e3a \u7ba1\u9053\u5316,\u5141\u8bb8\u53d1\u9001\u4e00\u7ec4\u8bf7\u6c42,\u4f46\u662f\u53ea\u80fd\u6309\u7167\u53d1\u9001\u987a\u5e8f\u4f9d\u6b21\u63a5\u6536\u54cd\u5e94;\u5982\u679c\u5728\u8bf7\u6c42\u5e94\u7b54\u8fc7\u7a0b\u4e2d,\u51fa\u73b0\u4efb\u4f55\u7684\u72b6\u51b5,\u5269\u4e0b\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u88ab\u963b\u585e\u5728\u51fa\u73b0\u95ee\u9898\u7684\u8bf7\u6c42\u5e94\u7b54\u4e4b\u540e,\u8fd9\u5c31\u662f\"\u961f\u5934\u963b\u585e\";</li> <li>\u81c3\u80bf\u7684\u6d88\u606f\u9996\u90e8 :HTTP/1.1\u80fd\u538b\u7f29\u8bf7\u6c42\u5185\u5bb9,\u4f46\u662f\u6d88\u606f\u9996\u90e8\u4e0d\u80fd\u538b\u7f29;</li> </ul>"},{"location":"basic/net/net/#273-http20","title":"2.7.3 HTTP2.0","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>\u65b0\u7684\u4e8c\u8fdb\u5236\u683c\u5f0f\uff08Binary Format\uff09\uff1ahttp/1.x\u4f7f\u7528\u7684\u662f\u660e\u6587\u534f\u8bae\uff0c\u5176\u534f\u8bae\u683c\u5f0f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1arequest line\uff0cheader\uff0cbody\uff0c\u5176\u534f\u8bae\u89e3\u6790\u662f\u57fa\u4e8e\u6587\u672c\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u5929\u7136\u7f3a\u9677\uff0c\u6587\u672c\u7684\u8868\u73b0\u5f62\u5f0f\u6709\u591a\u6837\u6027\uff0c\u8981\u505a\u5230\u5065\u58ee\u6027\u8003\u8651\u7684\u573a\u666f\u5fc5\u7136\u5f88\u591a\uff0c\u4e8c\u8fdb\u5236\u5219\u4e0d\u540c\uff0c\u53ea\u8ba40\u548c1\u7684\u7ec4\u5408\uff1b\u57fa\u4e8e\u8fd9\u79cd\u8003\u8651\uff0chttp/2.0\u7684\u534f\u8bae\u89e3\u6790\u51b3\u5b9a\u91c7\u7528\u4e8c\u8fdb\u5236\u683c\u5f0f\uff0c\u5b9e\u73b0\u65b9\u4fbf\u4e14\u5065\u58ee</li> <li>\u591a\u8def\u590d\u7528\uff08MultiPlexing\uff09\uff1a\u5373\u8fde\u63a5\u5171\u4eab\uff0c\u4f7f\u7528streamId\u7528\u6765\u533a\u5206\u8bf7\u6c42\uff0c\u4e00\u4e2arequest\u5bf9\u5e94\u4e00\u4e2astream\u5e76\u5206\u914d\u4e00\u4e2aid\uff0c\u8fd9\u6837\u4e00\u4e2aTCP\u8fde\u63a5\u4e0a\u53ef\u4ee5\u6709\u591a\u4e2astream\uff0c\u6bcf\u4e2astream\u7684frame\u53ef\u4ee5\u968f\u673a\u7684\u6df7\u6742\u5728\u4e00\u8d77\uff0c\u63a5\u6536\u65b9\u53ef\u4ee5\u6839\u636estream id\u5c06frame\u518d\u5f52\u5c5e\u5230\u5404\u81ea\u4e0d\u540c\u7684request\u91cc\u9762</li> <li>\u4f18\u5148\u7ea7\u548c\u4f9d\u8d56\uff08Priority\u3001Dependency\uff09\uff1a\u6bcf\u4e2astream\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u4f18\u5148\u7ea7\u548c\u4f9d\u8d56\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684stream\u4f1a\u88abserver\u4f18\u5148\u5904\u7406\u548c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0cstream\u8fd8\u53ef\u4ee5\u4f9d\u8d56\u5176\u5b83\u7684sub streams\uff1b\u4f18\u5148\u7ea7\u548c\u4f9d\u8d56\u90fd\u662f\u53ef\u4ee5\u52a8\u6001\u8c03\u6574\u7684\uff0c\u6bd4\u5982\u5728APP\u4e0a\u6d4f\u89c8\u5546\u54c1\u5217\u8868\uff0c\u7528\u6237\u5feb\u901f\u6ed1\u52a8\u5230\u5e95\u90e8\uff0c\u4f46\u662f\u524d\u9762\u7684\u8bf7\u6c42\u5df2\u7ecf\u53d1\u51fa\uff0c\u5982\u679c\u4e0d\u628a\u540e\u9762\u7684\u4f18\u5148\u7ea7\u8bbe\u9ad8\uff0c\u90a3\u4e48\u5f53\u524d\u6d4f\u89c8\u7684\u56fe\u7247\u5c06\u4f1a\u5728\u6700\u540e\u5c55\u793a\u51fa\u6765\uff0c\u663e\u7136\u4e0d\u5229\u4e8e\u7528\u6237\u4f53\u9a8c</li> <li>header\u538b\u7f29\uff1ahttp2.0\u4f7f\u7528encoder\u6765\u51cf\u5c11\u9700\u8981\u4f20\u8f93\u7684header\u5927\u5c0f\uff0c\u901a\u8baf\u53cc\u65b9\u5404\u81eacache\u4e00\u4efdheader fields\u8868\uff0c\u65e2\u907f\u514d\u4e86\u91cd\u590dheader\u7684\u4f20\u8f93\uff0c\u53c8\u51cf\u5c0f\u4e86\u9700\u8981\u4f20\u8f93\u7684\u5927\u5c0f</li> <li>\u91cd\u7f6e\u8fde\u63a5\uff1a\u5f88\u591aAPP\u91cc\u90fd\u6709\u505c\u6b62\u4e0b\u8f7d\u56fe\u7247\u7684\u9700\u6c42\uff0c\u5bf9\u4e8ehttp1.x\u6765\u8bf4\uff0c\u662f\u76f4\u63a5\u65ad\u5f00\u8fde\u63a5\uff0c\u5bfc\u81f4\u4e0b\u6b21\u518d\u53d1\u8bf7\u6c42\u5fc5\u987b\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\uff1bhttp2.0\u5f15\u5165RST_STREAM\u7c7b\u578b\u7684frame\uff0c\u53ef\u4ee5\u5728\u4e0d\u65ad\u5f00\u8fde\u63a5\u7684\u524d\u63d0\u4e0b\u53d6\u6d88\u67d0\u4e2arequest\u7684stream</li> <li>\u670d\u52a1\u5668\u63a8\u9001\uff1a\u5728 http2.0\u5f53\u4e2d\uff0c\u670d\u52a1\u5668\u5df2\u7ecf\u4e0d\u518d\u662f\u5b8c\u5168\u88ab\u52a8\u5730\u63a5\u6536\u8bf7\u6c42\uff0c\u54cd\u5e94\u8bf7\u6c42\uff0c\u5b83\u4e5f\u80fd\u65b0\u5efa stream \u6765\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\uff0c\u5f53 TCP \u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u6bd4\u5982\u6d4f\u89c8\u5668\u8bf7\u6c42\u4e00\u4e2a HTML \u6587\u4ef6\uff0c\u670d\u52a1\u5668\u5c31\u53ef\u4ee5\u5728\u8fd4\u56de HTML \u7684\u57fa\u7840\u4e0a\uff0c\u5c06 HTML \u4e2d\u5f15\u7528\u5230\u7684\u5176\u4ed6\u8d44\u6e90\u6587\u4ef6\u4e00\u8d77\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u51cf\u5c11\u5ba2\u6237\u7aef\u7684\u7b49\u5f85\u3002</li> </ul> <p>\u5176\u4e2d\u6d89\u53ca\u4e86\u4e24\u4e2a\u65b0\u7684\u6982\u5ff5\uff1a</p> <ul> <li> <p>\u6570\u636e\u6d41-stream\uff1a\u57fa\u4e8eTCP\u8fde\u63a5\u4e4b\u4e0a\u7684\u903b\u8f91\u53cc\u5411\u5b57\u8282\u6d41\uff0c\u7528\u4e8e\u627f\u8f7d\u53cc\u5411\u6d88\u606f\uff0c\u5bf9\u5e94\u4e00\u4e2a\u8bf7\u6c42\u53ca\u5176\u54cd\u5e94\u3002\u5ba2\u6237\u7aef\u6bcf\u53d1\u8d77\u4e00\u4e2a\u8bf7\u6c42\u5c31\u5efa\u7acb\u4e00\u4e2a\u6570\u636e\u6d41\uff0c\u540e\u7eed\u8be5\u8bf7\u6c42\u53ca\u5176\u54cd\u5e94\u7684\u6240\u6709\u6570\u636e\u90fd\u901a\u8fc7\u8be5\u6570\u636e\u6d41\u4f20\u8f93\u3002\u6bcf\u4e2a\u6570\u636e\u6d41\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u548c\u53ef\u9009\u7684\u4f18\u5148\u7ea7\u4fe1\u606f\u3002</p> </li> <li> <p>\u5e27-frame HTTP/2\u7684\u6700\u5c0f\u6570\u636e\u5207\u7247\u5355\u4f4d\uff0c\u627f\u8f7d\u7740\u7279\u5b9a\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4f8b\u5982 HTTP \u6807\u5934\u3001\u6d88\u606f\u8d1f\u8f7d\uff0c\u7b49\u7b49\u3002 \u6765\u81ea\u4e0d\u540c\u6570\u636e\u6d41\u7684\u5e27\u53ef\u4ee5\u4ea4\u9519\u53d1\u9001\uff0c\u7136\u540e\u518d\u6839\u636e\u6bcf\u4e2a\u5e27\u5934\u7684\u6570\u636e\u6d41\u6807\u8bc6\u7b26\u91cd\u65b0\u7ec4\u88c5\uff0c\u4ece\u800c\u5728\u5b8f\u89c2\u4e0a\u5b9e\u73b0\u4e86\u591a\u4e2a\u8bf7\u6c42\u6216\u54cd\u5e94\u5e76\u884c\u4f20\u8f93\u7684\u6548\u679c\u3002</p> </li> </ul> <p></p> <p>\u8fd9\u91cc\u7684 \u591a\u8def\u590d\u7528\u673a\u5236 \u5c31\u5b9e\u73b0\u4e86 \u5728\u540c\u4e00\u4e2aTCP\u8fde\u63a5\u4e0a \u591a\u4e2a\u8bf7\u6c42 \u5e76\u884c\u6267\u884c\u3002</p> <p>\u95ee\u9898</p> <p>\u5c3d\u7ba1 HTTP2 \u76f8\u6bd4 HTTP \u5df2\u7ecf\u6709\u4e86\u6539\u8fdb\u7684\u5730\u65b9\uff0c\u4f46\u662f\u5982\u679c\u4f60\u6709 2% \u7684\u4e22\u5305\u7387\uff0c\u90a3 HTTP2 \u5728\u6027\u80fd\u4e0a\u5c31\u6ca1\u6709\u4f18\u52bf\u4e86\u3002\u56e0\u4e3aHTTP2 \u534f\u8bae\u662f\u57fa\u4e8e TCP \u7684\uff0c\u4f46\u662f TCP \u672c\u8eab\u662f\u65e0\u6cd5\u89e3\u51b3\u961f\u5934\u62e5\u585e\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a HTTP2 \u4f1a\u628a\u4e00\u6b21\u4f20\u8f93\u6240\u6709\u7684\u6587\u4ef6\u90fd\u653e\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\uff0c\u53ea\u8981\u8fd9\u4e2a TCP \u4e2d\u53d1\u751f\u4e00\u4e2a\u4e22\u5305\uff0c\u8fde\u63a5\u5c31\u5fc5\u987b\u91cd\u65b0\u5efa\u7acb\uff0c\u4e4b\u524d\u6240\u6709\u4f20\u8f93\u5185\u5bb9\u8fdb\u884c\u5fc5\u987b\u91cd\u4f20\uff0c\u4ece\u800c\u9020\u6210\u62e5\u585e\u3002</p>"},{"location":"basic/net/net/#274-http30","title":"2.7.4 HTTP3.0","text":"<p>HTTP3 \u672c\u8d28\u4e0d\u662f\u5bf9 HTTP \u534f\u8bae\u672c\u8eab\u7684\u6539\u8fdb\uff0c\u5b83\u4e3b\u8981\u662f\u96c6\u4e2d\u5728\u5982\u4f55\u63d0\u9ad8\u4f20\u8f93\u6548\u7387\u3002</p> <ul> <li>\u4f18\u5316\u4e86\u91cd\u4f20\u7b56\u7565\uff1aHTTP3 \u4f7f\u7528 stream \u8fdb\u4e00\u6b65\u6269\u5c55\u4e86 HTTP2 \u7684\u591a\u8def\u590d\u7528\u3002\u5728 HTTP3 \u6a21\u5f0f\u4e0b\uff0c\u4e00\u822c\u4f20\u8f93\u591a\u5c11\u4e2a\u6587\u4ef6\u5c31\u4f1a\u4ea7\u751f\u5bf9\u5e94\u6570\u91cf\u7684 stream\u3002\u5f53\u8fd9\u4e9b\u6587\u4ef6\u4e2d\u7684\u5176\u4e2d\u4e00\u4e2a\u53d1\u751f\u4e22\u5305\u65f6\uff0c\u4f60\u53ea\u9700\u8981\u91cd\u4f20\u4e22\u5305\u6587\u4ef6\u7684\u5bf9\u5e94 stream \u5373\u53ef\u3002</li> <li>0-RTT: \u4f7f\u7528\u4e86\u57fa\u4e8e Google \u7684 QUIC \u534f\u8bae\uff0c QUIC \u534f\u8bae\u76f8\u6bd4\u4e8e HTTP2.0 \u6700\u5927\u7684\u4f18\u52bf\u662f 0-RTT \u5efa\u8fde\uff0c\u5373\u4f20\u8f93\u5c42 0-RTT \u5c31\u80fd\u5efa\u7acb\u8fde\u63a5\uff0c\u800c\u52a0\u5bc6\u5c42 0-RTT \u5c31\u80fd\u5efa\u7acb\u52a0\u5bc6\u8fde\u63a5\uff0c\u5177\u4f53\u5b9e\u73b0\u4e3a\u7f13\u5b58\u4e86\u5f53\u524d\u4f1a\u8bdd\u7684\u4e0a\u4e0b\u6587\uff0c\u4e0b\u6b21\u6062\u590d\u4f1a\u8bdd\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5c06\u4e4b\u524d\u7684\u7f13\u5b58\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff0c\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u4f20\u8f93\u4e86\u3002QUIC \u534f\u8bae\u5b9e\u9645\u4e0a\u662f\u4f7f\u7528 UDP \u5b9e\u73b0\u7684\u3002</li> <li>\u66f4\u597d\u7684\u79fb\u52a8\u7aef\u8868\u73b0: \u901a\u8fc7\u5f15\u5165 Connection ID\uff0c\u4f7f\u5f97 HTTP3 \u652f\u6301\u8fde\u63a5\u8fc1\u79fb\u4ee5\u53ca NAT \u7684\u91cd\u7ed1\u5b9a\uff0c\u540c\u65f6QUIC\u5728\u79fb\u52a8\u7aef\u7684\u8868\u73b0\u6bd4TCP\u597d\uff0c\u56e0\u4e3a TCP \u662f\u57fa\u4e8e IP \u8bc6\u522b\u8fde\u63a5\uff0c\u800cQUIC \u662f\u901a\u8fc7 ID \u8bc6\u522b\u94fe\u63a5\u3002 \u65e0\u8bba\u7f51\u7edc\u73af\u5883\u5982\u4f55\u53d8\u5316\uff0c\u53ea\u8981 ID \u4e0d\u53d8\uff0c\u5c31\u80fd\u8fc5\u901f\u91cd\u65b0\u8fde\u4e0a\u3002</li> <li>\u52a0\u5bc6\u8ba4\u8bc1\u4f18\u5316\uff1aTCP\u534f\u8bae\u5934\u6ca1\u6709\u7ecf\u8fc7\u4efb\u4f55\u52a0\u5bc6\u548c\u8ba4\u8bc1\uff0c\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u5f88\u5bb9\u6613\u88ab\u4e2d\u95f4\u7f51\u7edc\u8bbe\u5907\u7be1\u6539\u3001\u6ce8\u5165\u548c\u7a83\u542c\u3002QUIC\u7684 packet \u53ef\u4ee5\u8bf4\u6b66\u88c5\u5230\u4e86\u7259\u9f7f\uff0c\u9664\u4e86\u4e2a\u522b\u62a5\u6587\uff0c\u6bd4\u5982PUBLIC_RESET \u548c CHLO\uff0c\u6240\u6709\u62a5\u6587\u5934\u90e8\u90fd\u662f\u7ecf\u8fc7\u8ba4\u8bc1\u7684\uff0c\u62a5\u6587 Body \u90fd\u662f\u7ecf\u8fc7\u52a0\u5bc6\u7684\u3002\u6240\u4ee5\u53ea\u8981\u5bf9 QUIC \u505a\u4efb\u4f55\u66f4\u6539\uff0c\u63a5\u6536\u7aef\u90fd\u80fd\u53ca\u65f6\u53d1\u73b0\uff0c\u6709\u6548\u5730\u964d\u4f4e\u4e86\u5b89\u5168\u98ce\u9669</li> <li>\u62e5\u585e\u63a7\u5236\uff1aTCP \u662f\u5728\u5185\u6838\u533a\u5b9e\u73b0\u7684\uff0c\u800c HTTP3 \u5c06\u62e5\u585e\u63a7\u5236\u79fb\u51fa\u4e86\u5185\u6838\uff0c\u901a\u8fc7\u7528\u6237\u7a7a\u95f4\u6765\u5b9e\u73b0\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\u4e0d\u518d\u9700\u8981\u7b49\u5f85\u5185\u6838\u66f4\u65b0\u53ef\u4ee5\u5b9e\u73b0\u5f88\u65b9\u4fbf\u7684\u8fdb\u884c\u5feb\u901f\u8fed\u4ee3\u3002</li> <li>\u5934\u90e8\u538b\u7f29 \uff1aHTTP2 \u4f7f\u7528\u7684 HPACK\uff0cHTTP3 \u66f4\u6362\u6210\u4e86\u517c\u5bb9 HPACK \u7684 QPACK \u538b\u7f29\u65b9\u6848\u3002QPACK \u4f18\u5316\u4e86\u5bf9\u4e71\u5e8f\u53d1\u9001\u7684\u652f\u6301\uff0c\u4e5f\u4f18\u5316\u4e86\u538b\u7f29\u7387\u3002</li> <li>\u5411\u524d\u7ea0\u9519\u673a\u5236\uff1aQUIC\u534f\u8bae\u6709\u4e00\u4e2a\u975e\u5e38\u72ec\u7279\u7684\u7279\u6027\uff0c\u79f0\u4e3a\u5411\u524d\u7ea0\u9519\uff08Foward Error Connec\uff0cFEC\uff09\uff0c\u6bcf\u4e2a\u6570\u636e\u5305\u9664\u4e86\u5b83\u672c\u8eab\u7684\u5185\u5bb9\u4e4b\u5916\u8fd8\u5305\u62ec\u4e86\u5176\u4ed6\u6570\u636e\u5305\u7684\u6570\u636e\uff0c\u56e0\u6b64\u5c11\u91cf\u7684\u4e22\u5305\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u5305\u7684\u5197\u4f59\u6570\u636e\u76f4\u63a5\u7ec4\u88c5\u800c\u65e0\u9700\u91cd\u4f20\u3002\u5411\u524d\u7ea0\u9519\u727a\u7272\u4e86\u6bcf\u4e2a\u6570\u636e\u5305\u53ef\u4ee5\u53d1\u9001\u6570\u636e\u7684\u4e0a\u9650\uff0c\u4f46\u662f\u5e26\u6765\u7684\u63d0\u5347\u5927\u4e8e\u4e22\u5305\u5bfc\u81f4\u7684\u6570\u636e\u91cd\u4f20\uff0c\u56e0\u4e3a\u6570\u636e\u91cd\u4f20\u5c06\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u65f6\u95f4\uff08\u5305\u62ec\u786e\u8ba4\u6570\u636e\u5305\u4e22\u5931\uff0c\u8bf7\u6c42\u91cd\u4f20\uff0c\u7b49\u5f85\u65b0\u6570\u636e\u5305\u7b49\u6b65\u9aa4\u7684\u65f6\u95f4\u6d88\u8017\uff09\u3002</li> </ul> <p>\u95ee\u9898</p> <ul> <li>NAT \u5c40\u57df\u7f51\u8def\u7531\u3001\u4ea4\u6362\u673a\u3001\u9632\u706b\u5899\u7b49\u4f1a\u7981\u6b62 UDP 443 \u901a\u884c\uff0c\u56e0\u6b64 QUIC \u521b\u5efa\u8fde\u63a5\u6210\u529f\u7387\u53ea\u670995%</li> <li>\u8fd0\u8425\u5546\u9488\u5bf9 UDP \u901a\u9053\u4e0d\u652f\u6301/\u652f\u6301\u4e0d\u8db3\u3002</li> <li>\u4f7f\u7528 UDP \u4e0d\u4e00\u5b9a\u4f1a\u6bd4 TCP \u66f4\u5feb\uff0c\u5ba2\u6237\u7aef\u53ef\u540c\u65f6\u4f7f\u7528 TCP \u548c QUIC \u7ade\u901f\uff0c\u4ece\u800c\u9009\u62e9\u66f4\u4f18\u94fe\u8def\u3002</li> </ul> <p>HTTP\u534f\u8bae\u662f\u65e0\u72b6\u6001\u534f\u8bae,\u8fd9\u53e5\u8bdd\u672c\u8eab\u5230\u5e95\u5bf9\u4e0d\u5bf9?</p> <p>\u5b9e\u9645\u4e0a,\u5e76\u4e0d\u5168\u5bf9\u3002HTTP/1.1\u4e2d\u6709\u4e00\u4e2a HTTP/1.1 Expect: 100-Continue\u7684\u529f\u80fd,\u5b83\u662f\u8fd9\u4e48\u5de5\u4f5c\u7684:</p> <ul> <li> <p>\u5728\u53d1\u9001\u5927\u91cf\u6570\u636e\u7684\u65f6\u5019,\u8003\u8651\u5230\u670d\u52a1\u7aef\u6709\u53ef\u80fd\u76f4\u63a5\u62d2\u6536\u6570\u636e,\u5ba2\u6237\u7aef\u53d1\u51fa\u8bf7\u6c42\u5934\u5e76\u9644\u5e26 Expect:100-continue HTTP\u7684HTTP\u5934,\u4e0d\u53d1\u9001\u8bf7\u6c42\u4f53,\u5148\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94</p> </li> <li> <p>\u670d\u52a1\u5668\u6536\u5230 Expect:100-Continue \u7684\u8bf7\u6c42,\u5982\u679c\u5141\u8bb8\u4e0a\u4f20,\u53d1\u9001100 continue \u7684HTTP\u54cd\u5e94(\u540c\u4e00\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u6709\u4efb\u610f\u4e2a1xx\u7684\u54cd\u5e94,\u5747\u4e0d\u662f\u6700\u540e\u7684 Response,\u53ea\u8d77\u5230\u63d0\u793a\u6027\u4f5c\u7528);\u5982\u679c\u4e0d\u5141\u8bb8,\u4f8b\u5982\u4e0d\u5141\u8bb8\u4e0a\u4f20\u6570\u636e,\u6216\u8005\u6570\u636e\u5927\u5c0f\u8d85\u51fa\u9650\u5236,\u76f4\u63a5\u8fd4\u56de4xx/5xx\u7684\u9519\u8bef</p> </li> <li> <p>\u5ba2\u6237\u7aef\u6536\u5230100 Continue\u7684\u54cd\u5e94\u4e4b\u540e,\u7ee7\u7eed\u4e0a\u4f20\u6570\u636e   \u53ef\u4ee5\u770b\u51fa,\u8fd9\u5b9e\u9645\u4e0a\u5f88\u660e\u663e\u662f\u4e00\u4e2a\u6709\u72b6\u6001\u534f\u8bae\u7684\u5957\u8def,\u5b83\u9700\u8981\u5148\u8fdb\u884c\u4e00\u6b21\u63e1\u624b,\u7136\u540e\u518d\u771f\u6b63\u53d1\u9001\u6570\u636e\u3002\u4e0d\u8fc7,HTTP\u534f\u8bae\u4e5f\u89c4\u5b9a,\u5982\u679c\u670d\u52a1\u7aef\u4e0d\u8fdb\u884c100 Continue\u7684\u54cd\u5e94,\u5efa\u8bae\u5ba2\u6237\u7aef\u5728\u7b49\u5f85\u8f83\u77ed\u7684\u65f6\u95f4\u4e4b\u540e\u4ecd\u7136\u4e0a\u4f20\u6570\u636e,\u4ee5\u8fbe\u6210\u4e0e\u4e0d\u652f\u6301 Expect:100- Continue\u529f\u80fd\u7684\u670d\u52a1\u5668\u7684\u517c\u5bb9,\u8fd9\u6837\u53ef\u4ee5\u7b97\u662f\u201c\u80fd\u6709\u72b6\u6001\u5219\u6709\u72b6\u6001,\u5426\u5219\u56de\u5230\u65e0\u72b6\u6001\u7684\u8def\u4e0a\u201d,\u8fd9\u6837\u8bf4HTTP1.x \u662f\u65e0\u72b6\u6001\u7684\u534f\u8bae\u4e5f\u662f\u6ca1\u9519\u7684\u3002</p> </li> </ul> <p>\u81f3\u4e8eHTTP/2,\u5b83\u5e94\u8be5\u7b97\u662f\u4e00\u4e2a\u6709\u72b6\u6001\u7684\u534f\u8bae\u4e86(\u6709\u63e1\u624b\u548c GOAWAY\u6d88\u606f,\u6709\u7c7b\u4f3c\u4e8eTCP\u7684\u6d41\u63a7),\u6240\u4ee5\u4ee5\u540e\u8bf4\u201cHTTP\u662f\u65e0\u72b6\u6001\u7684\u534f\u8bae\u201d\u5c31\u4e0d\u592a\u5bf9\u4e86,\u6700\u597d\u8bf4HTTP1.x \u662f\u65e0\u72b6\u6001\u7684\u534f\u8bae</p>"},{"location":"basic/net/net/#28-https","title":"2.8 Https","text":""},{"location":"basic/net/net/#281-https","title":"2.8.1 \u4ec0\u4e48\u662fHTTPS\uff1f","text":"<p><code>HTTPS</code>\u5176\u5b9e\u5e76\u4e0d\u662f\u4e00\u4e2a\u65b0\u7684\u534f\u8bae\uff0c\u800c\u662f\u5728 HTTP \u4e0b\u9762\u589e\u52a0\u4e86\u4e00\u5c42 SSL/TLS \u534f\u8bae\uff0cHTTPS\u662f\u8eab\u62abSSL\u5916\u58f3\u7684HTTP\uff0c \u7b80\u5355\u7684\u8bb2\uff0cHTTPS = HTTP + SSL/TLS\u3002</p>"},{"location":"basic/net/net/#282-https","title":"2.8.2 \u4e3a\u4ec0\u4e48\u8981\u6709HTTPS\uff1f","text":"<p>\u56e0\u4e3aHTTP\u662f\u4e0d\u5b89\u5168\u7684\u3002</p> <ol> <li>\u673a\u5bc6\u6027\uff0cHTTP\u5728\u901a\u4fe1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u660e\u6587\uff0c\u8fd9\u4f7f\u5f97\u901a\u4fe1\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u88ab\u7a83\u542c\u3002\u4e3a\u4e86\u9632\u6b62\u88ab\u7a83\u542c\uff0c\u6700\u5e38\u89c1\u7684\u5904\u7406\u65b9\u5f0f\u5c31\u662f\u52a0\u5bc6\u3002\u52a0\u5bc6\u65b9\u5f0f\u5982\u4e0b\uff1a<ul> <li>\u901a\u4fe1\u52a0\u5bc6\uff1aHTTP\u534f\u8bae\u4e2d\u6ca1\u6709\u52a0\u5bc6\u673a\u5236\uff0c\u53ef\u4ee5\u4f7f\u7528 SSL \u6216\u8005 TSL \u6765\u8fdb\u884c\u52a0\u5bc6\uff1b</li> <li>\u5185\u5bb9\u7684\u52a0\u5bc6\uff1a\u5bf9\u901a\u4fe1\u5185\u5bb9\u8fdb\u884c\u52a0\u5bc6\uff0c\u5c06\u62a5\u6587\u4e2d\u6240\u5305\u542b\u7684\u5185\u5bb9\u8fdb\u884c\u52a0\u5bc6\uff1b</li> </ul> </li> <li>\u5b8c\u6574\u6027\uff0c\u7531\u4e8eHTTP\u534f\u8bae\u65e0\u6cd5\u9a8c\u8bc1\u62a5\u6587\u7684\u5b8c\u6574\u6027\uff0c\u56e0\u6b64\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u5df2\u7ecf\u906d\u5230 \u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u5bfc\u81f4\u62a5\u6587\u88ab\u7be1\u6539\u3002</li> <li>\u8eab\u4efd\u8ba4\u8bc1\uff0cHTTP\u534f\u8bae\u4e2d\u4e0d\u4f1a\u5bf9\u8bf7\u6c42\u548c\u5e94\u7b54\u7684\u53cc\u65b9\u8fdb\u884c\u8eab\u4efd\u786e\u8ba4\uff0c\u6240\u4ee5\u8eab\u4efd\u6709\u53ef\u80fd\u906d\u9047\u4f2a\u88c5\u3002HTTPS\u7684SSL\u4e0d\u4ec5\u63d0\u4f9b\u52a0\u5bc6\u670d\u52a1\uff0c\u8fd8\u63d0\u4f9b \u8bc1\u4e66\uff0c\u7528\u6765\u786e\u5b9a\u901a\u4fe1\u65b9\u3002\u8bc1\u4e66\u662f\u7531\u503c\u5f97\u4fe1\u4efb\u7684\u7b2c\u4e09\u65b9\u673a\u6784\u9881\u53d1\uff0c\u4f2a\u9020\u8bc1\u4e66\u5f02\u5e38\u56f0\u96be\uff0c\u6240\u4ee5\u53ea\u8981\u80fd\u591f\u786e\u8ba4\u901a\u4fe1\u65b9\u6301\u6709\u7684\u8bc1\u4e66\uff0c\u5219\u53ef\u4ee5\u786e\u8ba4\u5bf9\u65b9\u8eab\u4efd</li> </ol>"},{"location":"basic/net/net/#283-ssltls","title":"2.8.3 \u4ec0\u4e48\u662fSSL/TLS","text":"<p>SSL\u5373 \u5b89\u5168\u5957\u63a5\u5c42\uff0c\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u5b89\u5168\u901a\u4fe1\u534f\u8bae\uff0c\u5176\u53d1\u5c55\u5230v3\u7248\u672c\u7684\u65f6\u5019\uff0c\u4e92\u8054\u7f51\u5de5\u7a0b\u7ec4\u5c06\u5176\u6539\u540d\u4e3aTLS \u4f20\u8f93\u5c42\u5b89\u5168\uff0c\u76ee\u524d\u5e94\u7528\u6700\u5e7f\u6cdb\u7684\u7248\u672c\u662f1.2\uff0c\u9664\u4e86HTTP\uff0cSSL/TLS\u8fd8\u627f\u63a5\u4e86\u5176\u4ed6\u5e94\u7528\u534f\u8bae\uff0c\u6bd4\u5982FTP=&gt;FTPS\u7b49\u3002</p> <p></p>"},{"location":"basic/net/net/#284-https","title":"2.8.4 HTTPS\u662f\u5982\u4f55\u89e3\u51b3\u4e0a\u9762\u7684\u4e09\u4e2a\u98ce\u9669\u7684\u5462\uff1f","text":"<p>1. \u901a\u8fc7\u6df7\u5408\u52a0\u5bc6\uff0c\u4fdd\u8bc1\u4e86\u4fe1\u606f\u7684\u673a\u5bc6\u6027</p> <p>\u6309\u7167\u5bc6\u94a5\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u5e38\u89c1\u52a0\u5bc6\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\u5bf9\u79f0\u52a0\u5bc6\u548c\u975e\u5bf9\u79f0\u52a0\u5bc6\u3002</p> <ul> <li>\u5bf9\u79f0\u52a0\u5bc6 \u4ee5\u5171\u4eab\u5bc6\u94a5\u7684\u65b9\u5f0f\u52a0\u5bc6\uff0c\u4e5f\u5c31\u662f\u8bf4\u5fc5\u987b\u8981\u5c06\u5bc6\u94a5\u53d1\u9001\u7ed9\u5bf9\u65b9\uff0c\u53ef\u662f\u5728\u4e92\u8054\u7f51\u73af\u5883\u4e2d\uff0c\u5982\u4f55\u8f6c\u53d1\u5bc6\u94a5\u5462\uff1f\u5982\u679c\u88ab\u7a83\u542c\u5bc6\u94a5\u843d\u5165\u653b\u51fb\u8005\u4e4b\u624b\uff0c\u52a0\u5bc6\u5c31\u5931\u53bb\u4e86\u610f\u4e49\u3002</li> <li>\u975e\u5bf9\u79f0\u52a0\u5bc6 \u4f7f\u7528\u4e00\u5bf9\u975e\u5bf9\u79f0\u7684\u5bc6\u94a5\uff0c\u4e00\u628a\u53eb\u505a \u79c1\u94a5\uff0c\u4e00\u628a\u53eb\u505a \u516c\u94a5\u3002\u987e\u540d\u601d\u4e49\uff0c\u79c1\u94a5\u4e0d\u80fd\u8ba9\u4efb\u4f55\u4eba\u77e5\u9053\uff0c\u516c\u94a5\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u83b7\u5f97\u3002\u4f7f\u7528\u65b9\u5f0f\u662f\uff1a\u53d1\u9001\u65b9\u5c06\u62a5\u6587\u7528 \u516c\u94a5 \u8fdb\u884c \u52a0\u5bc6 \u5904\u7406\uff0c\u5bf9\u65b9\u6536\u5230\u540e\u7528 \u79c1\u94a5 \u8fdb\u884c \u89e3\u5bc6 \uff0c\u4e5f\u4e0d\u7528\u62c5\u5fc3\u5bc6\u94a5\u88ab\u653b\u51fb\u8005\u7a83\u542c\u800c\u76d7\u8d70\u3002\u56e0\u4e3a\u975e\u5bf9\u79f0\u52a0\u5bc6\u662f\u57fa\u4e8e\u5927\u6570\u8fd0\u7b97\uff0c\u6240\u4ee5 \u901f\u5ea6\u5f88\u6162\uff0c\u8fd8\u6709\u4e00\u4e2a\u7f3a\u70b9\u662f\u76f8\u540c\u5f3a\u5ea6\u7684\u52a0\u5bc6\uff0c\u975e\u5bf9\u79f0\u52a0\u5bc6\u9700\u8981\u66f4\u591a\u7684\u4f4d\u6570\u3002 </li> </ul> <p>\u6240\u4ee5HTTPS\u5229\u7528\u4e86\u4e24\u8005\u7684\u4f18\u52bf\uff0c\u5c06\u4e24\u79cd\u65b9\u5f0f\u7ec4\u5408\u8d77\u6765\u7528\u4e8e\u901a\u4fe1\u3002\u5728\u4ea4\u6362\u5bc6\u94a5\u9636\u6bb5\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u65b9\u5f0f\uff0c\u4e4b\u540e\u5efa\u7acb\u901a\u4fe1\u4ea4\u6362\u62a5\u6587\u9636\u6bb5\u5219\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u65b9\u5f0f\u3002</p> <p>2. \u6458\u8981\u7b97\u6cd5\u7528\u6765\u5b9e\u73b0\u5b8c\u6574\u6027</p> <p>\u6458\u8981\u7b97\u6cd5\u662f\u5e38\u8bf4\u7684\u6563\u5217\u51fd\u6570\u548c\u54c8\u5e0c\u51fd\u6570\uff0c\u53ef\u4ee5\u4e3a\u6570\u636e\u751f\u6210\u72ec\u4e00\u65e0\u4e8c\u7684\u6307\u7eb9\uff0c\u7528\u4e8e\u6821\u9a8c\u6570\u636e\u7684\u5b8c\u6574\u6027\u3002\u5ba2\u6237\u7aef\u5728\u53d1\u9001\u6570\u636e\u4e4b\u524d\u901a\u8fc7\u6458\u8981\u7b97\u6cd5\u7b97\u51fa\u660e\u6587\u7684 \u6307\u7eb9\uff0c\u53d1\u9001\u7684\u65f6\u5019\u5c06 \u660e\u6587+\u6307\u7eb9 \u4e00\u540c\u52a0\u5bc6\uff0c\u53d1\u9001\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u63a5\u6536\u5230\u540e\u8fdb\u884c\u89e3\u5bc6\uff0c\u5728\u7528\u76f8\u540c\u7684\u6458\u8981\u7b97\u6cd5\u5f97\u5230\u63a5\u6536\u5230\u7684\u660e\u6587\u7684 \u6307\u7eb9\uff0c\u4e0e\u6d88\u606f\u4e2d\u643a\u5e26\u7684\u6307\u7eb9\u8fdb\u884c\u5bf9\u6bd4\uff0c\u82e5\u6307\u7eb9\u76f8\u540c\uff0c\u5219\u8bf4\u660e\u662f\u5b8c\u6574\u7684\u3002</p> <p>3.\u5c06\u670d\u52a1\u5668\u516c\u94a5\u653e\u5728\u6570\u5b57\u8bc1\u4e66\u4e2d\uff0c\u89e3\u51b3\u4e86\u5192\u5145\u7684\u98ce\u9669</p> <p>\u4e0a\u6587\u5199\u5230\u5229\u7528\u52a0\u5bc6\u53ef\u4ee5\u4fdd\u8bc1\u62a5\u6587\u7684\u673a\u5bc6\u6027\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u8fd8\u6709\u4e00\u4e2a \u516c\u94a5\u4fe1\u4efb \u7684\u95ee\u9898\uff0c\u5982\u4f55\u4fdd\u8bc1\u516c\u94a5\u6ca1\u6709\u88ab\u4fee\u6539\u5462\uff1f\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u53ef\u4ee5\u4f7f\u7528\u7531\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\u9881\u53d1\u7684\u516c\u5f00\u5bc6\u94a5\u8ba4\u8bc1\u8bc1\u4e66\uff0c\u5373CA\u8ba4\u8bc1\u3002\u53ea\u8981\u8bc1\u4e66\u662f\u53ef\u4fe1\u7684\uff0c\u90a3\u4e48\u516c\u94a5\u5c31\u662f\u53ef\u4fe1\u7684\u3002</p>"},{"location":"basic/net/net/#285-https","title":"2.8.5 HTTPS\u94fe\u63a5\u7684\u5efa\u7acb\u8fc7\u7a0b","text":"<p>\u5728HTTP\u534f\u8bae\u4e2d\uff0c\u5efa\u7acb\u8fde\u63a5\u540e\u4f1a\u7acb\u5373\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\uff0c\u4f46\u662fHTTPS\u8fd8\u9700\u8981\u53e6\u5916\u4e00\u4e2a\u201c\u63e1\u624b\u201d\u7684\u8fc7\u7a0b\uff0c\u5373 TLS\u63e1\u624b\u3002TLS\u7684\u63e1\u624b\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>TLS\u901a\u8fc7\u4e24\u6b21\u5f80\u8fd4\uff08\u56db\u4e2a\u6d88\u606f\uff09\uff0c\u5b8c\u6210\u4e86\u63e1\u624b\u7684\u8fc7\u7a0b\u3002\u7ed3\u5408\u4e0a\u56fe\u6211\u4eec\u5206\u6790\u4e00\u4e0b\u63e1\u624b\u8fc7\u7a0b\uff1a</p> <ol> <li>\u6d4f\u89c8\u5668\u53d1\u9001</li> </ol> <p>Client Hello</p> <p>\u6d88\u606f\uff0c\u4fe1\u606f\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u652f\u6301\u7684SSL/TLS\u7248\u672c\u53f7\uff0c\u5982TLS1.2\u7248\u672c</li> <li>\u652f\u6301\u7684\u5bc6\u7801\u5957\u4ef6\uff0c\u5982ECDHE</li> <li> <p>\u5ba2\u6237\u7aef\u4ea7\u751f\u7684 \u968f\u673a\u6570 C\uff0c\u7528\u4e8e\u751f\u6210\u540e\u7eed\u7684\u4f1a\u8bdd\u5bc6\u94a5</p> </li> <li> <p>\u670d\u52a1\u5668\u6536\u5230Client Hello\u6d88\u606f\u540e\uff0c\u4f1a\u53d1\u9001</p> </li> </ul> <p>Server Hello</p> <ul> <li>\u786e\u5b9eSSL/TLS\u534f\u8bae\u7248\u672c\uff0c\u5982\u679c\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\uff0c\u5219\u5173\u95ed\u52a0\u5bc6\u901a\u4fe1</li> <li>\u786e\u8ba4\u5bc6\u7801\u5957\u4ef6\u5217\u8868\uff0c\u9009\u62e9\u6700\u5408\u9002\u7684\u52a0\u5bc6\u7b97\u6cd5\uff0c\u5982ECDHE</li> <li>\u670d\u52a1\u5668\u4ea7\u751f\u7684 \u968f\u673a\u6570 S\uff0c\u7528\u4e8e\u751f\u6210\u540e\u7eed\u7684\u4f1a\u8bdd\u5bc6\u94a5</li> <li> <p>\u670d\u52a1\u7aef\u4e3a\u4e86\u8bc1\u660e\u8eab\u4efd\uff0c\u628a\u8bc1\u4e66\u4e5f\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef</p> </li> <li> <p>\u5ba2\u6237\u7aef\u56de\u5e94\uff0cClient Key Exchange\u3002\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u7684\u6d88\u606f\u540e\uff0c\u7528\u6d4f\u89c8\u5668\u6216\u8005\u7cfb\u7edf\u4e2d\u7684CA\u516c\u94a5\u9a8c\u8bc1\u6570\u5b57\u8bc1\u4e66\u7684\u771f\u5b9e\u6027\uff0c\u5982\u679c\u8bc1\u4e66\u6ca1\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u4ece\u6570\u5b57\u8bc1\u4e66\u4e2d\u53d6\u51fa\u670d\u52a1\u5668\u7684\u516c\u94a5\uff0c\u7528\u5176\u52a0\u5bc6\u62a5\u6587\u3002</p> </li> <li> <p>\u4e00\u4e2a \u968f\u673a\u6570\uff0c\u8be5\u968f\u673a\u6570\u4f1a\u88ab\u4e0a\u9762\u63d0\u5230\u7684\u670d\u52a1\u5668\u7684\u516c\u94a5\u52a0\u5bc6\uff0c\u4ee5\u9632\u88ab\u9ed1\u5ba2\u7834\u89e3\u3002\u8fd9\u4e2a\u968f\u673a\u6570\u52a0\u4e0a\u4e0a\u6587\u751f\u6210\u7684\u5176\u4ed6\u4e24\u4e2a\u968f\u673a\u6570\uff0c\u4f7f\u7528\u4f1a\u8bdd\u4e2d\u7ea6\u5b9a\u7684\u52a0\u5bc6\u7b97\u6cd5\uff0c\u4f1a \u5404\u81ea \u751f\u6210 \u52a0\u5bc6\u4f1a\u8bdd\u7684\u4e3b\u5bc6\u94a5\u3002</p> </li> <li>\u52a0\u5bc6\u901a\u4fe1\u7b97\u6cd5\u6539\u53d8\u901a\u77e5\uff0c\u968f\u540e\u7684\u4fe1\u606f\u90fd\u5c06\u7528\u4f1a\u8bdd\u5bc6\u94a5\u52a0\u5bc6\u901a\u4fe1</li> <li> <p>Finished\u6d88\u606f\uff0c\u7ed3\u675f\u901a\u77e5\u3002\u628a\u4e4b\u524d\u6240\u6709\u53d1\u9001\u7684\u6570\u636e\u505a\u4e00\u4e2a\u6458\u8981\u518d\u52a0\u5bc6\u4e00\u4e0b\uff0c\u8ba9\u670d\u52a1\u5668\u505a\u9a8c\u8bc1</p> </li> <li> <p>\u670d\u52a1\u5668\u7684\u6700\u540e\u56de\u5e94\u3002</p> </li> <li> <p>\u52a0\u5bc6\u901a\u4fe1\u7b97\u6cd5\u6539\u53d8\u901a\u77e5</p> </li> <li>Finished\u6d88\u606f\uff0c\u7ed3\u675f\u901a\u77e5\u3002\u628a\u4e4b\u524d\u6240\u6709\u53d1\u9001\u7684\u6570\u636e\u505a\u4e00\u4e2a\u6458\u8981\u518d\u52a0\u5bc6\u4e00\u4e0b\uff0c\u8ba9\u5ba2\u6237\u7aef\u505a\u9a8c\u8bc1</li> </ul> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u8bc1\u4e66\uff1f</p> <p>\u9632\u6b62\u201c\u4e2d\u95f4\u4eba\u201d\u653b\u51fb\uff0c\u786e\u5b9a\u4f1a\u8bdd\u53cc\u65b9\u7684\u8eab\u4efd</p> <p>\u4f7f\u7528 HTTPS\u8fd8\u4f1a\u88ab\u6293\u5305\u5417\uff1f</p> <p>\u53ef\u4ee5\u88ab\u6293\u5305\uff0c\u53ea\u4e0d\u8fc7\u6293\u5305\u540e\u770b\u4e0d\u5230\u660e\u6587\uff0c\u65e0\u6cd5\u7be1\u6539</p> <p>HTTPS\u7684\u52a0\u5bc6\u8fc7\u7a0b\u662f\u600e\u4e48\u6837\u7684\uff1f</p> <p>\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u7d22\u8981\u5e76\u9a8c\u8bc1\u5176\u516c\u94a5\uff0c\u7528\u516c\u94a5\u5bf9TLS\u63e1\u624b\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u968f\u673a\u6570\u8fdb\u884c\u52a0\u5bc6\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u53cc\u65b9\u91c7\u7528\u4f1a\u8bdd\u5bc6\u94a5\u8fdb\u884c\u52a0\u5bc6\u901a\u4fe1\u3002</p> <p>HTTPS \u63e1\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u5982\u4f55\u9a8c\u8bc1\u8bc1\u4e66\u7684\u5408\u6cd5\u6027</p> <p>\u6570\u5b57\u8bc1\u4e66\u5305\u62ec\u5e8f\u5217\u53f7\u3001\u7528\u9014\u3001\u9881\u53d1\u8005\u3001\u6709\u6548\u65f6\u95f4\u3001\u516c\u94a5\uff0c\u5982\u679c\u53ea\u662f\u7b80\u5355\u7684\u5c06\u8fd9\u4e9b\u4fe1\u606f\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\uff0c\u4e2d\u95f4\u4eba\u53ef\u4ee5\u5f88\u8f7b\u6613\u7684\u5c06\u516c\u94a5\u6539\u6210\u81ea\u5df1\u7684\u516c\u94a5\uff0c\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u4f7f\u7528\u6570\u5b57\u7b7e\u540d\u3002\u5c06\u8bc1\u4e66\u7684\u4fe1\u606f\u751f\u6210\u6458\u8981\uff0c\u5c06\u6458\u8981\u7528CA\u7684\u79c1\u94a5\u8fdb\u884c\u52a0\u5bc6\uff0c\u751f\u6210\u6570\u5b57\u7b7e\u540d\u3002\u670d\u52a1\u5668\u5c06\u6570\u5b57\u8bc1\u4e66\u548c\u6570\u5b57\u7b7e\u540d\u4e00\u540c\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\uff0c\u56e0\u4e3a\u6709\u6570\u5b57\u7b7e\u540d\uff0c\u6240\u4ee5\u6570\u5b57\u8bc1\u4e66\u65e0\u6cd5\u88ab\u4e2d\u95f4\u4eba\u4fee\u6539\uff08\u4fee\u6539\u540e\u7684\u8bdd\u4f1a\u5bfc\u81f4\u6458\u8981\u53d8\u4e86\uff0c\u6570\u5b57\u7b7e\u540d\u5b9e\u73b0\u4e86\u4e0d\u53ef\u5426\u8ba4\uff09\u3002\u6d4f\u89c8\u5668\u62ff\u5230\u6570\u5b57\u8bc1\u4e66\uff0c\u6839\u636e\u201c\u8bc1\u4e66\u94fe\u201d\u53bb\u9a8c\u8bc1\u5176\u53ef\u4fe1\u5ea6\u3002</p>"},{"location":"basic/net/net/#3-dns","title":"3. DNS","text":""},{"location":"basic/net/net/#31","title":"3.1 \u662f\u4ec0\u4e48","text":"<p>\u57df\u540d\u7cfb\u7edf\uff08\u82f1\u8bed\uff1aDomain Name System\uff0c\u7f29\u5199\uff1aDNS\uff09\u662f\u4e92\u8054\u7f51)\u7684\u4e00\u9879\u670d\u52a1\u3002\u5b83\u4f5c\u4e3a\u5c06\u57df\u540d\u76f8\u4e92\u6620\u5c04\u7684\u4e00\u4e2a\u5206\u5e03\u5f0f\u6570\u636e\u5e93\uff0c\u80fd\u591f\u4f7f\u4eba\u66f4\u65b9\u4fbf\u5730\u8bbf\u95ee\u4e92\u8054\u7f51</p> <p>DNS\u7531 <code>\u89e3\u6790\u5668</code> \u548c <code>\u57df\u540d\u670d\u52a1\u5668</code> \u7ec4\u6210\u7684\u3002\u57df\u540d\u670d\u52a1\u5668\u662f\u6307\u4fdd\u5b58\u6709\u8be5\u7f51\u7edc\u4e2d\u6240\u6709\u4e3b\u673a\u7684\u57df\u540d\u548c\u5bf9\u5e94IP\u5730\u5740\uff0c\u5e76\u5177\u6709\u5c06\u57df\u540d\u8f6c\u6362\u4e3aIP\u5730\u5740\u529f\u80fd\u7684\u670d\u52a1\u5668\u3002</p> <p>\u73b0\u4ee3\u7684\u7f51\u7edc\u901a\u4fe1\u901a\u5e38\u4f1a\u4f7f\u7528\u5230 <code>\u57df\u540d+IP\u5730\u5740+MAC\u5730\u5740</code>\u3002</p> <p>\u800c\u4e24\u53f0\u4e3b\u673a\u8981\u8fdb\u884c\u901a\u4fe1\u5c31\u5fc5\u987b\u8981\u77e5\u9053\u5bf9\u65b9\u7684IP\u5730\u5740\uff0c\u901a\u5e38\u6211\u4eec\u8bbf\u95ee\u4e00\u4e2a\u7f51\u7ad9\u5c31\u53ea\u662f\u8f93\u5165\u4e00\u4e2a\u57df\u540d\uff0c\u4f8b\u5982 <code>ww.baidu.com</code>\uff0c\u90a3\u4e48\u8ba1\u7b97\u673a\u662f\u5982\u4f55\u77e5\u9053\u8fd9\u4e2a\u57df\u540d\u5bf9\u5e94\u7684 <code>IP</code> \u5730\u5740\u5462\uff1f\u8fd9\u5c31\u662f <code>DNS</code> \u534f\u8bae\u8981\u5e72\u7684\u4e8b\u60c5\u3002</p> <p>\u901a\u8fc7 <code>IP</code> \u5730\u5740\u627e\u5230 <code>MAC</code> \u5730\u5740\u662f <code>ARP</code> \u534f\u8bae\u5e72\u7684\u4e8b</p>"},{"location":"basic/net/net/#32-dns","title":"3.2 DNS\u67e5\u8be2\u7684\u5b8c\u6574\u8fc7\u7a0b\u662f\u600e\u4e48\u6837\u7684\uff1f","text":"<ol> <li>\u6d4f\u89c8\u5668\u5c06\u4f1a\u68c0\u67e5\u7f13\u5b58\u4e2d\u6709\u6ca1\u6709\u8fd9\u4e2a\u57df\u540d\u5bf9\u5e94\u7684\u89e3\u6790\u8fc7\u7684 IP \u5730\u5740\uff0c\u5982\u679c\u6709\u8be5\u89e3\u6790\u8fc7\u7a0b\u5c06\u4f1a\u7ed3\u675f\u3002\u6d4f\u89c8\u5668\u7f13\u5b58\u57df\u540d\u4e5f\u662f\u6709\u9650\u5236\u7684\uff0c\u5305\u62ec\u7f13\u5b58\u7684\u65f6\u95f4\u3001\u5927\u5c0f\uff0c\u53ef\u4ee5\u901a\u8fc7 TTL \u5c5e\u6027\u6765\u8bbe\u7f6e\u3002</li> <li>\u5982\u679c\u7528\u6237\u7684\u6d4f\u89c8\u5668\u4e2d\u7f13\u5b58\u4e2d\u6ca1\u6709\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5148\u68c0\u67e5\u81ea\u5df1\u672c\u5730\u7684 DNS \u89e3\u6790\u5668\u7f13\u5b58\u548c hosts \u6587\u4ef6\u662f\u5426\u6709\u8fd9\u4e2a\u7f51\u5740\u6620\u5c04\u5173\u7cfb\uff0c\u5982\u679c\u6709\uff0c\u5c31\u5148\u8c03\u7528\u8fd9\u4e2a IP \u5730\u5740\u6620\u5c04\uff0c\u5b8c\u6210\u57df\u540d\u89e3\u6790\u3002</li> <li>\u5982\u679c\u90fd\u6ca1\u6709\uff0c\u4f1a\u627e TCP/IP \u53c2\u6570\u4e2d\u8bbe\u7f6e\u7684\u9996\u9009 DNS \u670d\u52a1\u5668\uff0c\u6211\u4eec\u53eb\u5b83\u672c\u5730 DNS \u670d\u52a1\u5668\u3002\u901a\u8fc7\u9012\u5f52\u67e5\u8be2\u7684\u65b9\u5f0f\u5411\u672c\u5730 DNS \u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0c\u5982\u679c\u672c\u5730 DNS \u670d\u52a1\u5668\u4e2d\u6709 A\u8bb0\u5f55 \u6216\u8005\u8be5\u57df\u540d\u7684\u6620\u5c04\u7f13\u5b58\uff0c\u5219\u8fd4\u56de</li> <li>\u5982\u679c\u90fd\u6ca1\u6709\uff0c\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u4f1a\u5f00\u59cb\u8fed\u4ee3\u67e5\u8be2\u7684\u8fc7\u7a0b\uff0c\u4f1a\u5148\u5411 13 \u53f0\u6839\u57df\u540d\u670d\u52a1\u5668\u67e5\u8be2\u8be5\u57df\u540d\uff0c\u6839\u57df\u540d\u670d\u52a1\u5668\u4f1a\u8fd4\u56de\u8be5\u57df\u540d\u7684\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u7684 IP \u5730\u5740\uff0c\u4e5f\u5c31\u662f NS \u8bb0\u5f55(NS\u8bb0\u5f55\u6307\u5411\u8be5\u7ea7\u57df\u540d\u7684\u57df\u540d\u670d\u52a1\u5668)\u3002\u7136\u540e\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u518d\u5411\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u53d1\u8d77\u67e5\u8be2\uff0c\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u8fd4\u56de\u4e8c\u7ea7\u57df\u540d\u670d\u52a1\u5668\u7684 NS \u8bb0\u5f55\uff0c\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u76f4\u5230\u8fd4\u56de A \u8bb0\u5f55\u4e3a\u6b62\uff0c\u6700\u540e\u628a A \u8bb0\u5f55\u4e2d\u7684 IP \u5730\u5740\u8fd4\u56de\u7ed9\u4e3b\u673a</li> </ol> <p>\u53ef\u4ee5\u901a\u8fc7 <code>dig</code> \u547d\u4ee4\u6765\u8fed\u4ee3\u8ddf\u8e2aDNS\u8fc7\u7a0b</p> <pre><code>dig +trace www.baidu.com\n</code></pre> <p>\u9012\u5f52\u67e5\u8be2\u548c\u8fed\u4ee3\u67e5\u8be2\u533a\u522b</p> <ul> <li> <p>\u9012\u5f52\uff1a    </p> </li> <li> <p>\u8fed\u4ee3    </p> </li> </ul>"},{"location":"basic/net/net/#33-dnsudptcp","title":"3.3 DNS\u4f7f\u7528UDP\u8fd8\u662fTCP","text":"<p><code>DNS</code> \u540c\u65f6\u4f7f\u7528 <code>TCP</code> \u548c <code>UDP</code> \u534f\u8bae\u7684 <code>53</code> \u53f7\u7aef\u53e3\u3002<code>DNS</code> \u5728 <code>\u533a\u57df\u4f20\u8f93</code> \uff08\u540c\u6b65\u89e3\u6790\u8bb0\u5f55\uff09\u548c <code>DNS</code> \u54cd\u5e94\u5927\u4e8e <code>UDP</code> \u62a5\u6587\u6700\u5927\u957f\u5ea6\u7684\u65f6\u5019\u4f7f\u7528 <code>TCP</code> \u534f\u8bae\uff0c\u5176\u4ed6\u65f6\u5019\u4f7f\u7528 <code>UDP</code> \u534f\u8bae\u3002</p>"},{"location":"basic/net/net/#udp","title":"\u4e3a\u4ec0\u4e48\u4f7f\u7528UDP","text":"<p>\u5feb\uff0c\u662fUDP\u7684\u6700\u5927\u4f18\u52bf</p> <p>\u5ba2\u6237\u7aef\u5411 <code>DNS</code> \u670d\u52a1\u5668\u67e5\u8be2\u57df\u540d\uff0c\u4e00\u822c\u8fd4\u56de\u7684\u5185\u5bb9\u90fd\u4e0d\u8d85\u8fc7 <code>512\u5b57\u8282</code> \uff0c\u7528 <code>UDP</code> \u4f20\u8f93\u5373\u53ef\u3002\u4e0d\u7528\u7ecf\u8fc7\u4e09\u6b21\u63e1\u624b\uff0c\u8fd9\u6837 <code>DNS</code> \u670d\u52a1\u5668\u8d1f\u8f7d\u66f4\u4f4e\uff0c\u54cd\u5e94\u66f4\u5feb\u3002</p> <p>\u7406\u8bba\u4e0a\u8bf4\uff0c\u5ba2\u6237\u7aef\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5411 <code>DNS</code> \u670d\u52a1\u5668\u67e5\u8be2\u65f6\u7528 <code>TCP</code>\uff0c\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u5f88\u591a <code>DNS</code> \u670d\u52a1\u5668\u8fdb\u884c\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u4ec5\u652f\u6301 <code>UDP</code> \u67e5\u8be2\u5305\u3002</p>"},{"location":"basic/net/net/#tcp","title":"\u4f55\u65f6\u4f7f\u7528TCP","text":"<p>\u4f20\u8f93\u6570\u636e\u5927\u4e8eUDP\u6700\u5927\u62a5\u6587\u957f\u5ea6\u7684\u65f6\u5019\u4f7f\u7528TCP\u534f\u8bae\uff1a</p> <p>\u9996\u5148\u4e86\u89e3\u4e00\u4e0b <code>TCP</code> \u4e0e <code>UDP</code> \u4f20\u9001\u5b57\u8282\u7684\u957f\u5ea6\u9650\u5236\uff1a</p> <p><code>UDP</code> \u62a5\u6587\u7684\u6700\u5927\u957f\u5ea6\u4e3a <code>512</code> \u5b57\u8282\uff0c\u800c <code>TCP</code> \u5219\u5141\u8bb8\u62a5\u6587\u957f\u5ea6\u8d85\u8fc7 <code>512</code> \u5b57\u8282\u3002\u5f53 <code>DNS</code> \u67e5\u8be2\u8d85\u8fc7 <code>512</code> \u5b57\u8282\u65f6\u4f1a\u5c06\u540e\u9762\u7684\u6570\u636e\u90e8\u5206\u4e22\u6389\uff0c\u6240\u4ee5\u8fd9\u65f6\u9700\u8981\u4f7f\u7528 <code>TCP</code> \u53d1\u9001\u3002\u4f46\u662f\u901a\u5e38\u4f20\u7edf\u7684 <code>UDP</code> \u62a5\u6587\u4e00\u822c\u4e0d\u4f1a\u5927\u4e8e <code>512</code> \u5b57\u8282\u3002\u5373\u4f7f <code>DNS</code> \u670d\u52a1\u5668\u4e2d\u7b26\u5408\u6761\u4ef6\u7684\u8bb0\u5f55\u5f88\u591a\uff0c <code>DNS</code> \u670d\u52a1\u5668\u4e5f\u4f1a\u9650\u5236\u6700\u591a\u8fd4\u56de <code>13\u6761</code> \u6765\u9632\u6b62\u62a5\u6587\u5927\u4e8e <code>512</code> \u5b57\u8282\u3002</p> <p>DNS\u533a\u57df\u4f20\u8f93\u7684\u65f6\u5019\u4f7f\u7528TCP\u534f\u8bae</p> <p>DNS\u7684\u89c4\u8303\u89c4\u5b9a\u4e86 2 \u79cd\u7c7b\u578b\u7684 DNS \u670d\u52a1\u5668\uff0c\u4e00\u4e2a\u53eb <code>\u4e3b DNS \u670d\u52a1\u5668</code>\uff0c\u4e00\u4e2a\u53eb <code>\u8f85\u52a9DNS\u670d\u52a1\u5668</code>\u3002 \u5728\u4e00\u4e2a <code>\u533a</code> \u4e2d <code>\u4e3b DNS \u670d\u52a1\u5668</code> \u4ece\u81ea\u5df1\u672c\u673a\u7684\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u8be5\u533a\u7684 <code>DNS</code> \u6570\u636e\u4fe1\u606f\uff0c\u800c <code>\u8f85\u52a9DNS\u670d\u52a1\u5668</code> \u5219\u4ece\u533a\u7684 <code>\u4e3b DNS \u670d\u52a1\u5668</code> \u4e2d\u8bfb\u53d6\u8be5\u533a\u7684 <code>DNS</code> \u6570\u636e\u4fe1\u606f\u3002\u5f53\u4e00\u4e2a <code>\u8f85\u52a9 DNS \u670d\u52a1\u5668</code> \u542f\u52a8\u65f6\uff0c\u5b83\u9700\u8981\u4e0e <code>\u4e3b DNS \u670d\u52a1\u5668</code> \u901a\u4fe1\uff0c\u5e76\u52a0\u8f7d\u6570\u636e\u4fe1\u606f\uff0c\u8fd9\u5c31\u53eb\u505a <code>\u533a\u4f20\u9001\uff08zone transfer\uff09</code>\u3002</p> <p>\u8f85\u57df\u540d\u670d\u52a1\u5668\u4f1a\u5b9a\u65f6\uff08\u4e00\u822c 3 \u5c0f\u65f6\uff09\u5411\u4e3b\u57df\u540d\u670d\u52a1\u5668\u8fdb\u884c\u67e5\u8be2\u4ee5\u4fbf\u4e86\u89e3\u6570\u636e\u662f\u5426\u6709\u53d8\u52a8\u3002\u5982\u6709\u53d8\u52a8\uff0c\u4f1a\u6267\u884c\u4e00\u6b21\u533a\u57df\u4f20\u8f93\uff0c\u8fdb\u884c\u6570\u636e\u540c\u6b65\u3002\u533a\u57df\u4f20\u8f93\u4f7f\u7528 TCP \u800c\u4e0d\u662f UDP\uff0c\u56e0\u4e3a\u6570\u636e\u540c\u6b65\u4f20\u9001\u7684\u6570\u636e\u91cf\u6bd4\u4e00\u4e2a\u8bf7\u6c42\u5e94\u7b54\u7684\u6570\u636e\u91cf\u8981\u591a\u5f97\u591a\uff0c\u4e14\u9700\u8981\u4fdd\u8bc1\u6570\u636e\u7684 <code>\u53ef\u9760\u6027</code> \u548c <code>\u5b8c\u6574\u6027</code></p>"},{"location":"basic/net/net/#34-cdn","title":"3.4 CDN","text":"<p>CDN \u7684\u5168\u79f0\u662f Content Delivery Network\uff0c\u5373\u5185\u5bb9\u5206\u53d1\u7f51\u7edc\u3002\u5176\u76ee\u7684\u662f\u901a\u8fc7\u5728\u73b0\u6709\u7684internet\u4e2d\u589e\u52a0\u4e00\u5c42\u65b0\u7684\u7f51\u7edc\u67b6\u6784\uff0c\u5c06\u7f51\u7ad9\u7684\u5185\u5bb9\u53d1\u5e03\u5230\u6700\u63a5\u8fd1\u7528\u6237\u7684\u7f51\u7edc\u8fb9\u7f18\uff0c\u4f7f\u7528\u6237\u53ef\u4ee5\u5c31\u8fd1\u53d6\u5f97\u6240\u9700\u7684\u5185\u5bb9\uff0c\u63d0\u9ad8\u7528\u6237\u8bbf\u95ee\u7f51\u7ad9\u7684\u54cd\u5e94\u901f\u5ea6\u3002</p>"},{"location":"basic/net/net/#cdn","title":"CDN \u7684\u539f\u7406","text":"<p>\u5f53\u7528\u6237\u8bbf\u95ee CDN \u7684\u8d44\u6e90\u65f6\uff0c\u9996\u5148\u4e5f\u662f\u9700\u8981\u7ecf\u8fc7 DNS \u89e3\u6790\u8fc7\u7a0b</p> <p>CDN \u5c31\u662f\u5728 DNS \u89e3\u6790\u65f6\uff0c\u5176\u5185\u90e8\u7684 DNS \u667a\u80fd\u8c03\u5ea6\u7cfb\u7edf\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u3001\u7f51\u8def\u7b49\u60c5\u51b5\u6765\u9009\u62e9\u51fa\u4e0e\u4e3b\u673a\u6700\u5408\u9002\u7684\u8d44\u6e90\u670d\u52a1\u5668\u7684 IP \u4f5c\u4e3a DNS \u89e3\u6790\u7ed3\u679c\u3002</p>"},{"location":"basic/net/net/#4-tcpudp","title":"4. TCP&amp;UDP","text":""},{"location":"basic/net/net/#41","title":"4.1 \u5b9a\u4e49","text":"<p>TCP \u662f\u4f20\u8f93\u63a7\u5236\u534f\u8bae\uff08Transmission Control Protocol\uff09\u7684\u7f29\u5199\uff0c\u662f\u4e00\u79cd\u9762\u5411\u8fde\u63a5\u7684\u3001\u53ef\u9760\u7684\u3001\u57fa\u4e8e\u5b57\u8282\u6d41\u7684\u4f20\u8f93\u5c42\u901a\u4fe1\u534f\u8bae\u3002TCP \u4e3a\u5e94\u7528\u5c42\u63d0\u4f9b\u53ef\u9760\u7684\u5b57\u8282\u6d41\u670d\u52a1\u3002\u5efa\u7acb\u5728 IP \u534f\u8bae\u4e4b\u4e0a\uff0c\u4e3a IP \u534f\u8bae\u4e2d\u65e0\u8fde\u63a5\u670d\u52a1\u7684\u7f3a\u9677\u63d0\u4f9b\u4e86\u89e3\u51b3\u65b9\u6848\u3002</p> <p>UDP \u662f\u7528\u6237\u6570\u636e\u62a5\u534f\u8bae\uff08User Datagram Protocol\uff09\u7684\u7f29\u5199\uff0c\u662f\u4e00\u79cd\u65e0\u8fde\u63a5\u7684\u3001\u4e0d\u53ef\u9760\u7684\u4f20\u8f93\u5c42\u901a\u4fe1\u534f\u8bae\u3002UDP \u4e3a\u5e94\u7528\u5c42\u63d0\u4f9b\u65e0\u8fde\u63a5\u7684\u670d\u52a1\u3002</p>"},{"location":"basic/net/net/#411-tcp","title":"4.1.1 TCP\u7684\u91cd\u8981\u6027","text":"<p>IP \u5c42\u662f\u300c\u4e0d\u53ef\u9760\u300d\u7684\uff0c\u5b83\u4e0d\u4fdd\u8bc1\u2f79\u7edc\u5305\u7684\u4ea4\u4ed8\u3001\u4e0d\u4fdd\u8bc1\u2f79\u7edc\u5305\u7684\u6309\u5e8f\u4ea4\u4ed8\u3001\u4e5f\u4e0d\u4fdd\u8bc1\u2f79\u7edc\u5305\u4e2d\u7684\u6570\u636e\u7684\u5b8c\u6574\u6027\u3002 \u5982\u679c\u9700\u8981\u4fdd\u969c\u2f79\u7edc\u6570\u636e\u5305\u7684\u53ef\u9760\u6027\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7531\u4e0a\u5c42\uff08\u4f20\u8f93\u5c42\uff09\u7684 TCP \u534f\u8bae\u6765\u8d1f\u8d23\u3002 \u56e0\u4e3a TCP \u662f\u2f00\u4e2a\u2f2f\u4f5c\u5728\u4f20\u8f93\u5c42\u7684\u53ef\u9760\u6570\u636e\u4f20\u8f93\u7684\u670d\u52a1\uff0c\u5b83\u80fd\u786e\u4fdd\u63a5\u6536\u7aef\u63a5\u6536\u7684\u2f79\u7edc\u5305\u662f\u2f46\u635f\u574f\u3001\u2f46\u95f4\u9694\u3001\u2fae\u5197\u4f59\u548c\u6309\u5e8f\u7684\u3002</p>"},{"location":"basic/net/net/#42-tcp-udp","title":"4.2 TCP \u4e0e UDP \u7684\u533a\u522b","text":"TCP UDP \u662f\u5426\u9762\u5411\u8fde\u63a5 \u662f \u5426 \u662f\u5426\u53ef\u9760 \u662f \u5426 \u662f\u5426\u6709\u72b6\u6001 \u662f \u5426 \u4f20\u8f93\u6548\u7387 \u8f83\u6162 \u8f83\u5feb \u4f20\u8f93\u5f62\u5f0f \u5b57\u8282\u6d41 \u6570\u636e\u62a5\u6587\u6bb5 \u9996\u90e8\u5f00\u9500 20 \uff5e 60 bytes 8 bytes \u662f\u5426\u63d0\u4f9b\u5e7f\u64ad\u6216\u591a\u64ad\u670d\u52a1 \u5426 \u662f <p>\u662f\u5426\u9762\u5411\u8fde\u63a5 \uff1aUDP \u5728\u4f20\u9001\u6570\u636e\u4e4b\u524d\u4e0d\u9700\u8981\u5148\u5efa\u7acb\u8fde\u63a5\u3002\u800c TCP \u63d0\u4f9b\u9762\u5411\u8fde\u63a5\u7684\u670d\u52a1\uff0c\u5728\u4f20\u9001\u6570\u636e\u4e4b\u524d\u5fc5\u987b\u5148\u5efa\u7acb\u8fde\u63a5\uff0c\u6570\u636e\u4f20\u9001\u7ed3\u675f\u540e\u8981\u91ca\u653e\u8fde\u63a5\u3002</p> <p>\u662f\u5426\u662f\u53ef\u9760\u4f20\u8f93\uff1a\u8fdc\u5730\u4e3b\u673a\u5728\u6536\u5230 UDP \u62a5\u6587\u540e\uff0c\u4e0d\u9700\u8981\u7ed9\u51fa\u4efb\u4f55\u786e\u8ba4\uff0c\u5e76\u4e14\u4e0d\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4e0d\u4fdd\u8bc1\u662f\u5426\u987a\u5e8f\u5230\u8fbe\u3002TCP \u63d0\u4f9b\u53ef\u9760\u7684\u4f20\u8f93\u670d\u52a1\uff0cTCP \u5728\u4f20\u9012\u6570\u636e\u4e4b\u524d\uff0c\u4f1a\u6709\u4e09\u6b21\u63e1\u624b\u6765\u5efa\u7acb\u8fde\u63a5\uff0c\u800c\u4e14\u5728\u6570\u636e\u4f20\u9012\u65f6\uff0c\u6709\u786e\u8ba4\u3001\u7a97\u53e3\u3001\u91cd\u4f20\u3001\u62e5\u585e\u63a7\u5236\u673a\u5236\u3002\u901a\u8fc7 TCP \u8fde\u63a5\u4f20\u8f93\u7684\u6570\u636e\uff0c\u65e0\u5dee\u9519\u3001\u4e0d\u4e22\u5931\u3001\u4e0d\u91cd\u590d\u3001\u5e76\u4e14\u6309\u5e8f\u5230\u8fbe\u3002</p> <p>\u662f\u5426\u6709\u72b6\u6001 \uff1a\u8fd9\u4e2a\u548c\u4e0a\u9762\u7684\u201c\u662f\u5426\u53ef\u9760\u4f20\u8f93\u201d\u76f8\u5bf9\u5e94\u3002TCP \u4f20\u8f93\u662f\u6709\u72b6\u6001\u7684\uff0c\u8fd9\u4e2a\u6709\u72b6\u6001\u8bf4\u7684\u662f TCP \u4f1a\u53bb\u8bb0\u5f55\u81ea\u5df1\u53d1\u9001\u6d88\u606f\u7684\u72b6\u6001\u6bd4\u5982\u6d88\u606f\u662f\u5426\u53d1\u9001\u4e86\u3001\u662f\u5426\u88ab\u63a5\u6536\u4e86\u7b49\u7b49\u3002\u4e3a\u6b64 \uff0cTCP \u9700\u8981\u7ef4\u6301\u590d\u6742\u7684\u8fde\u63a5\u72b6\u6001\u8868\u3002\u800c UDP \u662f\u65e0\u72b6\u6001\u670d\u52a1\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u4e0d\u7ba1\u53d1\u51fa\u53bb\u4e4b\u540e\u7684\u4e8b\u60c5\u4e86\u3002</p> <p>\u4f20\u8f93\u6548\u7387 \uff1a\u7531\u4e8e\u4f7f\u7528 TCP \u8fdb\u884c\u4f20\u8f93\u7684\u65f6\u5019\u591a\u4e86\u8fde\u63a5\u3001\u786e\u8ba4\u3001\u91cd\u4f20\u7b49\u673a\u5236\uff0c\u6240\u4ee5 TCP \u7684\u4f20\u8f93\u6548\u7387\u8981\u6bd4 UDP \u4f4e\u5f88\u591a\u3002</p> <p>\u4f20\u8f93\u5f62\u5f0f \uff1a TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\uff0cUDP \u662f\u9762\u5411\u62a5\u6587\u7684\u3002</p> <p>\u9996\u90e8\u5f00\u9500 \uff1aTCP \u9996\u90e8\u5f00\u9500\uff0820 \uff5e 60 \u5b57\u8282\uff09\u6bd4 UDP \u9996\u90e8\u5f00\u9500\uff088 \u5b57\u8282\uff09\u8981\u5927\u3002</p> <p>\u662f\u5426\u63d0\u4f9b\u5e7f\u64ad\u6216\u591a\u64ad\u670d\u52a1 \uff1aTCP \u53ea\u652f\u6301\u70b9\u5bf9\u70b9\u901a\u4fe1\uff0cUDP \u652f\u6301\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u3001\u591a\u5bf9\u4e00\u3001\u591a\u5bf9\u591a\uff1b</p>"},{"location":"basic/net/net/#43-tcp-udp","title":"4.3 TCP \u4e0e UDP \u7684\u5e94\u7528\u573a\u666f","text":""},{"location":"basic/net/net/#431-tcp-udp","title":"4.3.1 \u4ec0\u4e48\u65f6\u5019\u9009\u62e9 TCP,\u4ec0\u4e48\u65f6\u5019\u9009 UDP","text":"<ul> <li>UDP \u4e00\u822c\u7528\u4e8e\u5373\u65f6\u901a\u4fe1\uff0c\u6bd4\u5982\uff1a \u8bed\u97f3\u3001 \u89c6\u9891 \u3001\u76f4\u64ad\u7b49\u7b49\u3002\u8fd9\u4e9b\u573a\u666f\u5bf9\u4f20\u8f93\u6570\u636e\u7684\u51c6\u786e\u6027\u8981\u6c42\u4e0d\u662f\u7279\u522b\u9ad8\uff0c\u6bd4\u5982\u4f60\u770b\u89c6\u9891\u5373\u4f7f\u5c11\u4e2a\u4e00\u4e24\u5e27\uff0c\u5b9e\u9645\u7ed9\u4eba\u7684\u611f\u89c9\u533a\u522b\u4e5f\u4e0d\u5927\u3002</li> <li>TCP \u7528\u4e8e\u5bf9\u4f20\u8f93\u51c6\u786e\u6027\u8981\u6c42\u7279\u522b\u9ad8\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6587\u4ef6\u4f20\u8f93\u3001\u53d1\u9001\u548c\u63a5\u6536\u90ae\u4ef6\u3001\u8fdc\u7a0b\u767b\u5f55\u7b49\u7b49\u3002</li> </ul>"},{"location":"basic/net/net/#432-http-tcp-udp","title":"4.3.2 HTTP \u57fa\u4e8e TCP \u8fd8\u662f UDP\uff1f","text":"<p>HTTP \u534f\u8bae\u662f\u57fa\u4e8e TCP \u534f\u8bae\u7684\uff0c\u6240\u4ee5\u53d1\u9001 HTTP \u8bf7\u6c42\u4e4b\u524d\u9996\u5148\u8981\u5efa\u7acb TCP \u8fde\u63a5\u4e5f\u5c31\u662f\u8981\u7ecf\u5386 3 \u6b21\u63e1\u624b\u3002</p>"},{"location":"basic/net/net/#433-tcp-udp","title":"4.3.3 \u4f7f\u7528 TCP \u7684\u534f\u8bae\u6709\u54ea\u4e9b?\u4f7f\u7528 UDP \u7684\u534f\u8bae\u6709\u54ea\u4e9b?","text":"<p>\u8fd0\u884c\u4e8e TCP \u534f\u8bae\u4e4b\u4e0a\u7684\u534f\u8bae \uff1a</p> <ol> <li>HTTP \u534f\u8bae \uff1a\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\uff08HTTP\uff0cHyperText Transfer Protocol)\u4e3b\u8981\u662f\u4e3a Web \u6d4f\u89c8\u5668\u4e0e Web \u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u800c\u8bbe\u8ba1\u7684\u3002\u5f53\u6211\u4eec\u4f7f\u7528\u6d4f\u89c8\u5668\u6d4f\u89c8\u7f51\u9875\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7f51\u9875\u5c31\u662f\u901a\u8fc7 HTTP \u8bf7\u6c42\u8fdb\u884c\u52a0\u8f7d\u7684\u3002</li> <li>HTTPS \u534f\u8bae \uff1a\u66f4\u5b89\u5168\u7684\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae(HTTPS,Hypertext Transfer Protocol Secure)\uff0c\u8eab\u62ab SSL \u5916\u8863\u7684 HTTP \u534f\u8bae</li> <li>FTP \u534f\u8bae\uff1a\u6587\u4ef6\u4f20\u8f93\u534f\u8bae FTP\uff08File Transfer Protocol\uff09\uff0c\u63d0\u4f9b\u6587\u4ef6\u4f20\u8f93\u670d\u52a1\uff0c\u57fa\u4e8e TCP \u5b9e\u73b0\u53ef\u9760\u7684\u4f20\u8f93\u3002\u4f7f\u7528 FTP \u4f20\u8f93\u6587\u4ef6\u7684\u597d\u5904\u662f\u53ef\u4ee5\u5c4f\u853d\u64cd\u4f5c\u7cfb\u7edf\u548c\u6587\u4ef6\u5b58\u50a8\u65b9\u5f0f\u3002</li> <li>SMTP \u534f\u8bae\uff1a\u7b80\u5355\u90ae\u4ef6\u4f20\u8f93\u534f\u8bae\uff08SMTP\uff0cSimple Mail Transfer Protocol\uff09\u7684\u7f29\u5199\uff0c\u57fa\u4e8e TCP \u534f\u8bae\uff0c\u7528\u6765\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002\u6ce8\u610f \u26a0\ufe0f\uff1a\u63a5\u53d7\u90ae\u4ef6\u7684\u534f\u8bae\u4e0d\u662f SMTP \u800c\u662f POP3 \u534f\u8bae\u3002</li> <li>POP3/IMAP \u534f\u8bae\uff1a POP3 \u548c IMAP \u4e24\u8005\u90fd\u662f\u8d1f\u8d23\u90ae\u4ef6\u63a5\u6536\u7684\u534f\u8bae\u3002</li> <li>Telent \u534f\u8bae\uff1a\u8fdc\u7a0b\u767b\u9646\u534f\u8bae\uff0c\u901a\u8fc7\u4e00\u4e2a\u7ec8\u7aef\u767b\u9646\u5230\u5176\u4ed6\u670d\u52a1\u5668\u3002\u88ab\u4e00\u79cd\u79f0\u4e3a SSH \u7684\u975e\u5e38\u5b89\u5168\u7684\u534f\u8bae\u6240\u53d6\u4ee3\u3002</li> <li>SSH \u534f\u8bae : SSH\uff08 Secure Shell\uff09\u662f\u76ee\u524d\u8f83\u53ef\u9760\uff0c\u4e13\u4e3a\u8fdc\u7a0b\u767b\u5f55\u4f1a\u8bdd\u548c\u5176\u4ed6\u7f51\u7edc\u670d\u52a1\u63d0\u4f9b\u5b89\u5168\u6027\u7684\u534f\u8bae\u3002\u5229\u7528 SSH \u534f\u8bae\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u8fdc\u7a0b\u7ba1\u7406\u8fc7\u7a0b\u4e2d\u7684\u4fe1\u606f\u6cc4\u9732\u95ee\u9898\u3002SSH \u5efa\u7acb\u5728\u53ef\u9760\u7684\u4f20\u8f93\u534f\u8bae TCP \u4e4b\u4e0a\u3002</li> </ol> <p>\u8fd0\u884c\u4e8e UDP \u534f\u8bae\u4e4b\u4e0a\u7684\u534f\u8bae \uff1a</p> <ol> <li>DHCP \u534f\u8bae\uff1a\u52a8\u6001\u4e3b\u673a\u914d\u7f6e\u534f\u8bae\uff0c\u52a8\u6001\u914d\u7f6e IP \u5730\u5740</li> <li>DNS \uff1a \u57df\u540d\u7cfb\u7edf\uff08DNS\uff0cDomain Name System\uff09\u5c06\u4eba\u7c7b\u53ef\u8bfb\u7684\u57df\u540d (\u4f8b\u5982\uff0cwww.baidu.com) \u8f6c\u6362\u4e3a\u673a\u5668\u53ef\u8bfb\u7684 IP \u5730\u5740 (\u4f8b\u5982\uff0c220.181.38.148)\u3002 \u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u4e13\u4e3a\u4e92\u8054\u7f51\u8bbe\u8ba1\u7684\u7535\u8bdd\u8584\u3002\u5b9e\u9645\u4e0a DNS \u540c\u65f6\u652f\u6301 UDP \u548c TCP \u534f\u8bae\u3002</li> </ol>"},{"location":"basic/net/net/#44tcp","title":"4.4.TCP \u62a5\u6587\u5934\u90e8","text":"<ul> <li>\u5e8f\u5217\u53f7\uff0832\u4f4d\uff09\uff1aTCP\u7528\u5e8f\u5217\u53f7\u6765\u89e3\u51b3\u7f51\u7edc\u4f20\u8f93\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u7684\u4e71\u5e8f\u95ee\u9898\uff0c\u5728\u5efa\u2f74\u8fde\u63a5\u65f6\u7531\u8ba1\u7b97\u673a\u2f63\u6210\u7684\u968f\u673a\u6570\u4f5c\u4e3a\u5176\u521d\u59cb\u503c\uff0c\u901a\u8fc7 SYN \u5305\u4f20\u7ed9\u63a5\u6536\u7aef\u4e3b\u673a\uff0c\u6bcf\u53d1\u9001\u2f00\u6b21\u6570\u636e\uff0c\u5c31\u300c\u7d2f\u52a0\u300d\u2f00\u6b21\u8be5\u300c\u6570\u636e\u5b57\u8282\u6570\u300d\u7684\u2f24\u2f29\u3002\u2f64\u6765\u89e3\u51b3\u2f79\u7edc\u5305\u4e71\u5e8f\u95ee\u9898\u3002</li> <li>\u786e\u8ba4\u5e94\u7b54\u53f7\uff0832\u4f4d\uff09\uff1a\u6307\u4e0b\u2f00\u6b21\u300c\u671f\u671b\u300d\u6536\u5230\u7684\u6570\u636e\u7684\u5e8f\u5217\u53f7\uff0c\u53d1\u9001\u7aef\u6536\u5230\u8fd9\u4e2a\u786e\u8ba4\u5e94\u7b54\u4ee5\u540e\u53ef\u4ee5\u8ba4\u4e3a\u5728\u8fd9\u4e2a\u5e8f\u53f7\u4ee5\u524d\u7684\u6570\u636e\u90fd\u5df2\u7ecf\u88ab\u6b63\u5e38\u63a5\u6536\u3002\u2f64\u6765\u89e3\u51b3\u4e0d\u4e22\u5305\u7684\u95ee\u9898\u3002</li> <li>\u63a7\u5236\u4f4d\uff1a\u4e0d\u540c\u63a7\u5236\u4f4d\u53ea\u6709\u4e00\u4f4d\uff0c\u5176\u53ea\u80fd\u4e3a0\u30011</li> <li>ACK\uff1a\u5f53\u5176\u4e3a1\uff0c\u786e\u8ba4\u5e94\u7b54\u5b57\u6bb5\u53d8\u4e3a\u6709\u6548\u5b57\u6bb5\uff0c\u7531\u4e8eTCP\u9700\u8981\u786e\u8ba4\u5e94\u7b54\uff0c\u53ef\u4ee5\u60f3\u8c61\u9664\u4e86\u5efa\u7acb\u8fde\u63a5\u7684\u7b2c\u4e00\u4e2a\u5305\u4ee5\u5916\uff0c\u6240\u6709\u5305\u7684ACK\u90fd\u4e3a1</li> <li>SYN\uff1a \u5f53\u5176\u4e3a1\uff0c\u8868\u793a\u5176\u60f3\u5efa\u7acb\u8fde\u63a5\uff0c\u8bbe\u7f6e\u5e8f\u5217\u53f7\u521d\u59cb\u503c\u4ee5\u4fbf\u5f00\u59cb\u5efa\u7acb\u8fde\u63a5\u3002</li> <li>FIN\uff1a\u5f53\u5176\u4e3a1\uff0c\u8868\u793a\u53d1\u9001FIN\u7684\u4e00\u65b9\u6ca1\u6709\u6570\u636e\u53d1\u9001\u4e86\uff0c\u5e0c\u671b\u65ad\u5f00\u8fde\u63a5\u3002\u7531\u6b64\u53ef\u89c1TCP\u65ad\u5f00\u8fde\u63a5\u5fc5\u5b9a\u9700\u89814\u6b21\u6325\u624b\uff0c\u7531\u4e8eTCP\u662f\u5168\u53cc\u5de5\u7684\uff0c\u5176\u4e00\u6b21FIN\u4e00\u6b21ack\u53ea\u80fd\u65ad\u5f00\u4e00\u65b9\uff0c\u6240\u4ee5\u53cc\u65b9\u90fd\u65ad\u5f00\u5219\u9700\u89814\u6b21\u3002</li> <li>RST\uff1a\u5f53\u5176\u4e3a1\uff0c\u4ee3\u8868\u8fde\u63a5\u5f02\u5e38\uff0c\u5fc5\u987b\u5f3a\u5236\u65ad\u5f00\u8fde\u63a5\u3002</li> <li>\u7a97\u53e3\u5927\u5c0f\uff1a\u5360\u7528\u4e24\u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f 16 \u4f4d\uff0c\u4f46\u5b9e\u9645\u4e0a\u662f\u4e0d\u591f\u7528\u7684\u3002\u56e0\u6b64 TCP \u5f15\u5165\u4e86\u7a97\u53e3\u7f29\u653e\u7684\u9009\u9879\uff0c\u4f5c\u4e3a\u7a97\u53e3\u7f29\u653e\u7684\u6bd4\u4f8b\u56e0\u5b50\uff0c\u8fd9\u4e2a\u6bd4\u4f8b\u56e0\u5b50\u7684\u8303\u56f4\u5728 0 ~ 14\uff0c\u6bd4\u4f8b\u56e0\u5b50\u53ef\u4ee5\u5c06\u7a97\u53e3\u7684\u503c\u6269\u5927\u4e3a\u539f\u6765\u7684 2 ^ n \u6b21\u65b9\u3002</li> <li>\u6821\u9a8c\u548c\uff1a\u5360\u7528\u4e24\u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f 16 \u4f4d\uff0c\u7528\u4e8e\u6821\u9a8c TCP \u62a5\u6587\u5934\u90e8\u548c\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0c\u9632\u6b62\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u6570\u636e\u5305\u6709\u635f\u574f\uff0c\u5982\u679c\u9047\u5230\u6821\u9a8c\u548c\u6709\u5dee\u9519\u7684\u62a5\u6587\uff0cTCP \u76f4\u63a5\u4e22\u5f03\u4e4b\uff0c\u7b49\u5f85\u91cd\u4f20\u3002</li> <li>\u6e90\u7aef\u53e3\u3001\u76ee\u6807\u7aef\u53e3\uff1a\u5982\u4f55\u6807\u8bc6\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a\u8fde\u63a5\uff1f\u7b54\u6848\u662f TCP \u8fde\u63a5\u7684\u56db\u5143\u7ec4\u2014\u2014\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u6807 IP \u548c\u76ee\u6807\u7aef\u53e3\u3002\u90a3 TCP \u62a5\u6587\u600e\u4e48\u6ca1\u6709\u6e90 IP \u548c\u76ee\u6807 IP \u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\u5728 IP \u5c42\u5c31\u5df2\u7ecf\u5904\u7406\u4e86 IP \u3002TCP \u53ea\u9700\u8981\u8bb0\u5f55\u4e24\u8005\u7684\u7aef\u53e3\u5373\u53ef\u3002</li> </ul> <p>\u6e90\u5730\u5740\u548c\u2f6c\u7684\u5730\u5740\u7684\u5b57\u6bb5\uff0832\u4f4d\uff09\u662f\u5728 IP \u5934\u90e8\u4e2d\uff0c\u4f5c\u2f64\u662f\u901a\u8fc7 IP \u534f\u8bae\u53d1\u9001\u62a5\u2f42\u7ed9\u5bf9\u2f45\u4e3b\u673a\u3002 \u6e90\u7aef\u2f1d\u548c\u2f6c\u7684\u7aef\u2f1d\u7684\u5b57\u6bb5\uff0816\u4f4d\uff09\u662f\u5728 TCP \u5934\u90e8\u4e2d\uff0c\u4f5c\u2f64\u662f\u544a\u8bc9 TCP \u534f\u8bae\u5e94\u8be5\u628a\u62a5\u2f42\u53d1\u7ed9\u54ea\u4e2a\u8fdb\u7a0b\u3002</p>"},{"location":"basic/net/net/#44-tcp","title":"4.4 \u5efa\u7acb\u8fde\u63a5-TCP \u4e09\u6b21\u63e1\u624b","text":"<p>\u4e00\u5f00\u59cb\u4e24\u7aef\u90fdCLOSED\uff0c\u7136\u540e\u670d\u52a1\u5668\u7aef\u4e3b\u52a8\u76d1\u542c\u67d0\u4e2a\u7aef\u53e3\u4e4b\u540e\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u5904\u4e8eLISEN\u72b6\u6001\u3002</p> <ul> <li>\u4e00\u6b21\u63e1\u624b:\u5ba2\u6237\u7aef\u968f\u673a\u521d\u59cb\u5316\u4e00\u4e2a\u5e8f\u5217\u53f7\uff0c\u7f6e\u4e8e\u5b57\u6bb5\u4e2d\uff0c\u540c\u65f6\u628aSYN\u6807\u5fd7\u7f6e\u4f4d1\uff0c\u53d1\u9001SYN\u62a5\u6587\uff08\u4e0d\u5305\u542b\u5e94\u7528\u5c42\u6570\u636e\uff09\uff0c\u8868\u793a\u5176\u60f3\u5efa\u7acb\u8fde\u63a5\u3002\u4e4b\u540e\u5ba2\u6237\u7aef\u5904\u4e8eSYN_SENT\u72b6\u6001\u3002</li> </ul> <p>\u200b   </p> <ul> <li>\u4e8c\u6b21\u63e1\u624b\uff1a\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684SYN\u62a5\u6587\u4e4b\u540e\uff0c\u5176\u4e5f\u968f\u673a\u521d\u59cb\u5316\u4e00\u4e2a\u5e8f\u5217\u53f7\uff0cSYN\u7f6e1\uff0c\u7136\u540e\u5728\u786e\u8ba4\u5e94\u7b54\u53f7\u5b57\u6bb5\u586b\u5165\u521a\u624d\u542c\u5230\u7684\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u5e8f\u53f7+1\uff0cACK\u7f6e1\uff0c\u53d1\u9001\u62a5\u6587\uff08\u4e0d\u5305\u542b\u5e94\u7528\u5c42\u6570\u636e\uff09\u3002\u4e4b\u540e\u670d\u52a1\u5668\u7aef\u5c31\u5904\u4e8eSYN_RCVD\u72b6\u6001\u3002</li> </ul> <p></p> <ul> <li>\u4e09\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u6b64\u65f6\u6536\u5230\u670d\u52a1\u5668\u7aef\u53d1\u9001\u7684\u62a5\u6587\uff0c\u8fd8\u8981ACK\u4e00\u6b21\uff0c\u540c\u4e0aack\u7684\u5e8f\u5217\u53f7+1\u5e76\u4e14ACK\u7f6e\u4e3a1\u5373\u53ef\u3002   \u8fd9\u6b21\u53d1\u9001\u7684\u62a5\u6587\uff0c\u53ef\u4ee5\u643a\u5e26\u5e94\u7528\u5c42\u6570\u636e\u4e86\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u5904\u4e8eESTABLISHED\u72b6\u6001\u3002   \u5f53\u670d\u52a1\u5668\u7aef\u6536\u5230ACK\u4e4b\u540e\u4e5f\u8fdb\u5165ESTABLISHED\u72b6\u6001\u3002\u2f00\u65e6\u5b8c\u6210\u4e09\u6b21\u63e1\u2f3f\uff0c\u53cc\u2f45\u90fd\u5904\u4e8e ESTABLISHED \u72b6\u6001\uff0c\u6b64\u65f6\u8fde\u63a5\u5c31\u5df2\u5efa\u2f74\u5b8c\u6210\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5c31\u53ef\u4ee5\u76f8\u4e92\u53d1\u9001\u6570\u636e\u4e86</li> </ul> <p>\u5f53\u5efa\u7acb\u4e86 3 \u6b21\u63e1\u624b\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5c31\u53ef\u4ee5\u4f20\u8f93\u6570\u636e\u5566\uff01</p>"},{"location":"basic/net/net/#_2","title":"\u521d\u59cb\u5e8f\u5217\u53f7\u7684\u4ea7\u751f","text":"<p>\u8d77\u59cb\u5e8f\u5217\u53f7ISN\u7684\u4ea7\u751f\u662f\u57fa\u4e8e\u65f6\u949f\u7684\uff0c\u7136\u540e\u518d\u7ecf\u8fc7hash\u7b97\u6cd5\uff0c\u5f97\u5230\u4e00\u4e2a\u521d\u59cb\u5e8f\u5217\u53f7\u3002    \u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528\u76f8\u540c\u7684\u521d\u59cb\u5e8f\u5217\u53f7</p> <ol> <li>\u4e3a\u4e86\u907f\u514d\u548c\u5386\u53f2\u8fde\u63a5\u7684\u5e8f\u5217\u53f7\u91cd\u590d</li> <li>\u4e3a\u4e86\u5b89\u5168\u8003\u8651\uff0c\u9632\u6b62\u9ed1\u5ba2\u4f2a\u9020\u5e8f\u5217\u53f7</li> </ol> <p>\u4e3a\u4ec0\u4e48\u8981\u4e09\u6b21\u63e1\u624b?</p> <p>\u4e09\u6b21\u63e1\u624b\u7684\u76ee\u7684\u662f\u5efa\u7acb\u53ef\u9760\u7684\u901a\u4fe1\u4fe1\u9053\uff0c\u8bf4\u5230\u901a\u8baf\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u6570\u636e\u7684\u53d1\u9001\u4e0e\u63a5\u6536\uff0c\u800c\u4e09\u6b21\u63e1\u624b\u6700\u4e3b\u8981\u7684\u76ee\u7684\u5c31\u662f\u53cc\u65b9\u786e\u8ba4\u81ea\u5df1\u4e0e\u5bf9\u65b9\u7684\u53d1\u9001\u4e0e\u63a5\u6536\u662f\u6b63\u5e38\u7684\u3002</p> <ol> <li>\u7b2c\u4e00\u6b21\u63e1\u624b \uff1aClient \u4ec0\u4e48\u90fd\u4e0d\u80fd\u786e\u8ba4\uff1bServer \u786e\u8ba4\u4e86\u5bf9\u65b9\u53d1\u9001\u6b63\u5e38\uff0c\u81ea\u5df1\u63a5\u6536\u6b63\u5e38</li> <li>\u7b2c\u4e8c\u6b21\u63e1\u624b \uff1aClient \u786e\u8ba4\u4e86\uff1a\u81ea\u5df1\u53d1\u9001\u3001\u63a5\u6536\u6b63\u5e38\uff0c\u5bf9\u65b9\u53d1\u9001\u3001\u63a5\u6536\u6b63\u5e38\uff1bServer \u786e\u8ba4\u4e86\uff1a\u5bf9\u65b9\u53d1\u9001\u6b63\u5e38\uff0c\u81ea\u5df1\u63a5\u6536\u6b63\u5e38</li> <li>\u7b2c\u4e09\u6b21\u63e1\u624b \uff1aClient \u786e\u8ba4\u4e86\uff1a\u81ea\u5df1\u53d1\u9001\u3001\u63a5\u6536\u6b63\u5e38\uff0c\u5bf9\u65b9\u53d1\u9001\u3001\u63a5\u6536\u6b63\u5e38\uff1bServer \u786e\u8ba4\u4e86\uff1a\u81ea\u5df1\u53d1\u9001\u3001\u63a5\u6536\u6b63\u5e38\uff0c\u5bf9\u65b9\u53d1\u9001\u3001\u63a5\u6536\u6b63\u5e38</li> </ol> <p>\u4e09\u6b21\u63e1\u624b\u5c31\u80fd\u786e\u8ba4\u53cc\u65b9\u6536\u53d1\u529f\u80fd\u90fd\u6b63\u5e38\uff0c\u7f3a\u4e00\u4e0d\u53ef\u3002</p> <p>\u4e24\u6b21\u63e1\u624b\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898</p> <p>\u4f1a\u9020\u6210\u5386\u53f2\u8fde\u63a5\u7684\u521d\u59cb\u5316\uff0c\u548c\u591a\u4e2a\u5197\u4f59\u7684\u65e0\u6548\u8fde\u63a5\uff0c\u4e14\u65e0\u6cd5\u540c\u6b65\u53cc\u65b9\u521d\u59cb\u5e8f\u5217\u53f7</p> <p>\u6bd4\u5982\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u5728\u7f51\u7edc\u60c5\u51b5\u4e0d\u662f\u5f88\u597d\u4ea7\u751f\u4e86\u62e5\u585e\u7684\u60c5\u51b5\u4e0b\uff0c\u8fde\u7eed\u591a\u6b21\u53d1\u9001\u7684\u53d1\u9001\u4e86SYN\u5efa\u7acb\u8fde\u63a5\u7684\u62a5\u6587\u3002</p> <ul> <li>\u5ba2\u6237\u7aef\u53d1\u9001seq=90\uff0c\u7f51\u7edc\u62e5\u585e\uff0c\u670d\u52a1\u5668\u6ca1\u6536\u5230</li> <li>\u5ba2\u6237\u7aef\u63a5\u7740\u53d1\u9001seq=100\uff0c\u7f51\u7edc\u62e5\u585e\u670d\u52a1\u5668\u53c8\u6ca1\u6536\u5230\u3002</li> <li>\u8fc7\u4e86\u4e00\u4f1a\u513f\uff0c\u7f51\u7edc\u7545\u901a\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u5ba2\u6237\u7aef\u672c\u6765\u60f3\u7740\u7b49\u7b2c\u4e8c\u4e2a\u62a5\u6587\u7684ACK\uff0c\u6ca1\u60f3\u5230\u65e7\u7684SYN\uff08seq=90\uff09\u8fd9\u4e2a\u65f6\u5019\u5230\u4e86\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u81ea\u7136\u5c31\u56de\u590d\u4e00\u4e2aSYN\uff08\u968f\u673a\uff09+ACK(seq=91)\u3002\u6b64\u65f6\u5ba2\u6237\u7aef\u53d1\u73b0\u81ea\u5df1\u671f\u671b\u6536\u5230\u7684ACK\u662f101\u800c\u4e0d\u662f91\uff0c\u4fbf\u53ef\u4ee5\u53d1\u8d77RST\uff0c\u8868\u793a\u8fde\u63a5\u5f02\u5e38\uff0c\u5f3a\u884c\u7ec8\u6b62\u4e86\u8fd9\u6b21\u8fde\u63a5\u3002\uff08\u6240\u4ee5\u5ba2\u6237\u7aef\u5728\u7b2c\u4e8c\u6b21\u63e1\u624b\u7ed3\u675f\u7684\u65f6\u5019\u5224\u65ad\u51fa\u4e86\u8fd9\u662f\u4e00\u4e2a\u5386\u53f2\u8fde\u63a5\uff09</li> <li>\u7b49\u518d\u8fc7\u4e00\u4f1a\u513f\uff0c\u65b0\u7684SYN\u5230\u4e86\u670d\u52a1\u5668\u7aef\uff0c\u5176\u5f00\u59cb\u6309\u7167\u5ba2\u6237\u7aef\u9700\u8981\u6b63\u5e38\u8fdb\u884c\u63e1\u624b\u5efa\u7acbtcp\u8fde\u63a5\u3002</li> </ul> <p>\u5982\u679c\u662f\u4e24\u6b21\u63e1\u624b\uff1a</p> <p>\u5ba2\u6237\u7aef\u5728\u521a\u624d\u7684\u7b2c\u4e8c\u6b21\u63e1\u624b\u5c31\u4e0d\u4f1a\u53d1\u73b0\u5f02\u5e38\uff0c\u5176\u5c31\u5efa\u7acb\u4e86\u5386\u53f2\u8fde\u63a5\uff0c\u800c\u4e09\u6b21\u63e1\u624b\u5c31\u4e0d\u4f1a\u3002</p> <p>\u7b2c2\u6b21\u63e1\u624b\u4f20\u56de\u4e86ACK\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u4f20\u56deSYN\uff1f</p> <p>\u670d\u52a1\u7aef\u4f20\u56de\u53d1\u9001\u7aef\u6240\u53d1\u9001\u7684 ACK \u662f\u4e3a\u4e86\u544a\u8bc9\u5ba2\u6237\u7aef\uff1a\u201c\u6211\u63a5\u6536\u5230\u7684\u4fe1\u606f\u786e\u5b9e\u5c31\u662f\u4f60\u6240\u53d1\u9001\u7684\u4fe1\u53f7\u4e86\u201d\uff0c\u8fd9\u8868\u660e\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u901a\u4fe1\u662f\u6b63\u5e38\u7684\u3002\u56de\u4f20 SYN \u5219\u662f\u4e3a\u4e86\u5efa\u7acb\u5e76\u786e\u8ba4\u4ece\u670d\u52a1\u7aef\u5230\u5ba2\u6237\u7aef\u7684\u901a\u4fe1\u3002</p> <p>SYN \u540c\u6b65\u5e8f\u5217\u7f16\u53f7(Synchronize Sequence Numbers) \u662f TCP/IP \u5efa\u7acb\u8fde\u63a5\u65f6\u4f7f\u7528\u7684\u63e1\u624b\u4fe1\u53f7\u3002\u5728\u5ba2\u6237\u673a\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u5efa\u7acb\u6b63\u5e38\u7684 TCP \u7f51\u7edc\u8fde\u63a5\u65f6\uff0c\u5ba2\u6237\u673a\u9996\u5148\u53d1\u51fa\u4e00\u4e2a SYN \u6d88\u606f\uff0c\u670d\u52a1\u5668\u4f7f\u7528 SYN-ACK \u5e94\u7b54\u8868\u793a\u63a5\u6536\u5230\u4e86\u8fd9\u4e2a\u6d88\u606f\uff0c\u6700\u540e\u5ba2\u6237\u673a\u518d\u4ee5 ACK(Acknowledgement\uff09\u6d88\u606f\u54cd\u5e94\u3002\u8fd9\u6837\u5728\u5ba2\u6237\u673a\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u624d\u80fd\u5efa\u7acb\u8d77\u53ef\u9760\u7684 TCP \u8fde\u63a5\uff0c\u6570\u636e\u624d\u53ef\u4ee5\u5728\u5ba2\u6237\u673a\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u9012\u3002</p> <p>\u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u4e48\uff1f</p> <p>\u4ece\u4e0a\u2faf\u7684\u8fc7\u7a0b\u53ef\u4ee5\u53d1\u73b0\u7b2c\u4e09\u6b21\u63e1\u2f3f\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\uff0c\u524d\u4e24\u6b21\u63e1\u2f3f\u662f\u4e0d\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684</p> <p>\u5982\u679c\u524d\u4e24\u6b21\u63e1\u624b\u80fd\u591f\u643a\u5e26\u6570\u636e\uff0c\u90a3\u4e48\u4e00\u65e6\u6709\u4eba\u60f3\u653b\u51fb\u670d\u52a1\u5668\uff0c\u90a3\u4e48\u4ed6\u53ea\u9700\u8981\u5728\u7b2c\u4e00\u6b21\u63e1\u624b\u4e2d\u7684 SYN \u62a5\u6587\u4e2d\u653e\u5927\u91cf\u6570\u636e\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u52bf\u5fc5\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u65f6\u95f4\u548c\u5185\u5b58\u7a7a\u95f4\u53bb\u5904\u7406\u8fd9\u4e9b\u6570\u636e\uff0c\u589e\u5927\u4e86\u670d\u52a1\u5668\u88ab\u653b\u51fb\u7684\u98ce\u9669\u3002</p> <p>\u7b2c\u4e09\u6b21\u63e1\u624b\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u5df2\u7ecf\u5904\u4e8e<code>ESTABLISHED</code>\u72b6\u6001\uff0c\u5e76\u4e14\u5df2\u7ecf\u80fd\u591f\u786e\u8ba4\u670d\u52a1\u5668\u7684\u63a5\u6536\u3001\u53d1\u9001\u80fd\u529b\u6b63\u5e38\uff0c\u8fd9\u4e2a\u65f6\u5019\u76f8\u5bf9\u5b89\u5168\u4e86\uff0c\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u3002</p>"},{"location":"basic/net/net/#syn","title":"SYN\u653b\u51fb","text":"<p>TCP\u8fde\u63a5\u9700\u8981\u4e09\u6b21\u63e1\u624b\uff0c\u5047\u8bbe\u653b\u51fb\u8005\u77ed\u65f6\u95f4\u4f2a\u9020\u4e0d\u540cIP\u53d1\u9001\u5927\u91cf\u7684SYN\u62a5\u6587\uff0c\u4ee5\u5360\u7528\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u653b\u51fb\u8005\u5728\u670d\u52a1\u5668SYN_RCVD\u5e76\u53d1\u9001ACK\u4e4b\u540e\u5374\u4e0d\u56de\u590d\u7b2c\u4e09\u6b21\u63e1\u624b\u7684\u5e94\u7b54\uff0c\u4e45\u800c\u4e45\u4e4b \u670d\u52a1\u5668\u7684SYN\u63a5\u6536\u961f\u5217\u5c31\u4f1a\u5360\u6ee1\uff0c\u4ece\u800c\u65e0\u6cd5\u4e3a\u522b\u7684\u7528\u6237\u63d0\u4f9b\u670d\u52a1\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5</p> <p>\u51fa\u95ee\u9898\u4e4b\u540e\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <ol> <li>\u4fee\u6539Linux \u5185\u6838\u53c2\u6570\uff0c\u63a7\u5236\u7b49\u5f85\u6570\u636e\u5305\u961f\u5217\u5927\u5c0f\uff0cSYN_RCVD\u8fde\u63a5\u6570\u76ee\uff0c\u961f\u5217\u6ee1\u65f6\u76f4\u63a5\u4e22\u5f03\u3002</li> <li>\u7f51\u5361\u63a5\u6536\u6570\u636e\u5305\u901f\u5ea6\u5927\u4e8e\u5185\u6838\u5904\u7406\u901f\u5ea6\u65f6\uff0c\u4f1a\u5c06\u6570\u636e\u5305\u653e\u5165\u4e00\u4e2a\u961f\u5217\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u8be5\u961f\u5217\u7684\u6700\u5927\u503c\u3002</li> <li>\u53ef\u4ee5\u4fee\u6539SYN_RCVD\u8fde\u63a5\u7684\u6700\u5927\u4e2a\u6570\u3002</li> <li> <p>\u5f53\u8d85\u51fa\u5904\u7406\u80fd\u529b\u65f6\uff0c\u6240\u6709\u65b0\u7684SYN\u76f4\u63a5\u56de\u590dRST\u4e22\u5f03\u3002</p> </li> <li> <p>\u542f\u7528tcp_syncookies</p> </li> </ol> <p>\u6211\u4eec\u53d1\u73b0\u53d7\u5230SYN\u653b\u51fb\u65f6\u53ef\u80fd\u4f1a\u5bfc\u81f4\uff0cSYN\u961f\u5217\u6ee1\u4f46\u662fACCEPT\u961f\u5217\u53ef\u80fd\u4e3a\u7a7a\uff0c\u8fd9\u65f6\u6211\u4eec\u542f\u52a8syncookies\uff0c\u4f7f\u540e\u7eedSYN\u5305\u4e0d\u8fdb\u5165SYN\u961f\u5217\uff0c\u800c\u662f\u8ba1\u7b97cookies\uff0c\u8fd4\u56de\u5ba2\u6237\u7aef\u4e00\u4e2a\u5e8f\u5217\u53f7\u4e3a\uff08SYN+ACK\uff09\u7684\u5305\uff0c\u6b64\u65f6\u5982\u679c\u5ba2\u6237\u7aef\u56de\u590d\u7684ACK\u5408\u6cd5\uff0c\u8bc1\u660e\u5176\u662f\u5408\u6cd5\u5ba2\u6237\u7aef\uff0c\u76f4\u63a5\u5c06\u5176\u52a0\u5165Accept\u961f\u5217\u3002       \u4e4b\u540e\u5c31\u53ef\u4ee5\u987a\u5229\u8fdb\u884c\u3002</p>"},{"location":"basic/net/net/#45-tcp","title":"4.5 \u65ad\u5f00\u8fde\u63a5-TCP \u56db\u6b21\u6325\u624b","text":"<p>\u65ad\u5f00\u4e00\u4e2a TCP \u8fde\u63a5\u5219\u9700\u8981\u201c\u56db\u6b21\u6325\u624b\u201d\uff0c\u7f3a\u4e00\u4e0d\u53ef \uff1a</p> <ol> <li>\u7b2c\u4e00\u6b21\u6325\u624b \uff1a\u5ba2\u6237\u7aef\u6ca1\u6709\u6570\u636e\u9700\u8981\u53d1\u9001\u4e86\uff0c\u6253\u7b97\u5173\u95ed\u8fde\u63a5\uff0c\u6b64\u65f6\u53d1\u9001<code>FIN=1</code>\u7684\u62a5\u6587\uff0c\u968f\u540e\u5176\u8fdb\u5165<code>FIN_WAIT_1</code>\u72b6\u6001</li> <li>\u7b2c\u4e8c\u6b21\u6325\u624b \uff1a\u670d\u52a1\u5668\u7aef\u6536\u5230\u540e\uff0c\u5c31\u5e94\u7b54<code>ACK</code>\uff0c\u7136\u540e\u81ea\u5df1\u8fdb\u5165<code>CLOSED_WAIT</code>\u72b6\u6001\u3002\u5ba2\u6237\u7aef\u6536\u5230<code>`ACK</code>\u4e4b\u540e\uff0c\u8fdb\u5165\u7b2c\u4e8c\u9636\u6bb5\u7684\u7b49\u5f85<code>FIN_WAIT_2</code>\u72b6\u6001\u3002</li> <li>\u7b2c\u4e09\u6b21\u6325\u624b \uff1a\u670d\u52a1\u5668\u5904\u7406\u5b8c\u6570\u636e\u4e4b\u540e\uff0c\u81ea\u5df1\u4e5f\u6ca1\u6709\u6570\u636e\u9700\u8981\u53d1\u9001\u4e86\uff0c\u5411\u5ba2\u6237\u7aef\u53d1\u9001<code>FIN</code>\u62a5\u6587\uff0c\u968f\u540e\u81ea\u5df1\u8fdb\u5165<code>LAST_ACK</code>\u72b6\u6001\u3002</li> <li>\u7b2c\u56db\u6b21\u6325\u624b\uff1a\u5ba2\u6237\u7aef\u6536\u5230FIN\u62a5\u6587\u56de\u590d<code>ACK</code>\uff0c\u968f\u540e\u8fdb\u5165<code>TIME_WAIT</code>\uff0c\u7b49\u5f85<code>2MSL</code>\u5c31CLOSE. \u670d\u52a1\u5668\u7aef\u6536\u5230<code>ACK</code>\u5c31\u53ef\u4ee5CLOSE.</li> </ol> <p>\u81f3\u6b64\uff0c\u6bcf\u4e2a\u65b9\u5411\u7684\u5173\u95ed\u90fd\u9700\u8981\u4e00\u4e2aFIN\u548c\u4e00\u4e2aACK\uff0c\u6240\u4ee5\u603b\u51714\u6b21\u6325\u624b\u3002</p> <p>\u6ce8\u610f\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u7684\u4e00\u65b9\u624d\u6709TIME_WAIT\u72b6\u6001\uff08\u53ef\u4ee5\u7406\u89e3\u6210\u4e3b\u52a8\u63d0\u51fa\u5206\u624b\u7684\u4e00\u65b9\u4f1a\u7b49\u5bf9\u65b9\u633d\u56de\u4e00\u4f1a\u513f\uff09</p> <p>\u4e3a\u4ec0\u4e48\u8981\u56db\u6b21\u6325\u624b?</p> <ul> <li>\u5173\u95ed\u8fde\u63a5\u65f6\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u7aef\u53d1\u9001FIN\uff0c\u8868\u793a\u81ea\u5df1\u6ca1\u6570\u636e\u53d1\u4e86\uff0c\u4f46\u662f\u81ea\u5df1\u8fd8\u80fd\u6536\u3002</li> <li>\u670d\u52a1\u5668\u7aef\u6536\u5230FIN\u65f6\uff0c\u5148\u5e94\u7b54\u4e00\u4e0bACK\uff0c\u8868\u793a\u81ea\u5df1\u77e5\u9053\u4f60\u8981\u8d70\u4e86\uff0c\u4f46\u670d\u52a1\u5668\u7aef\u53ef\u80fd\u81ea\u5df1\u8fd8\u6709\u6570\u636e\u9700\u8981\u5904\u7406\u548c\u53d1\u9001\uff0c\u7b49\u81ea\u5df1\u5fd9\u5b8c\u4e86\uff0c\u624d\u53d1\u9001FIN\u7ed9\u5ba2\u6237\u7aef\u8868\u793a\u81ea\u5df1\u4e5f\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u4e86\u3002</li> </ul> <p>\u670d\u52a1\u7aef\u901a\u5e38\u9700\u8981\u7b49\u5f85\u5b8c\u6210\u6570\u636e\u7684\u53d1\u9001\u548c\u5904\u7406\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u7684 ACK \u548c FIN \u2f00\u822c\u90fd\u4f1a\u5206\u5f00\u53d1\u9001\uff0c\u4ece\u2f7d\u2f50\u4e09\u6b21\u63e1\u2f3f\u5bfc\u81f4\u591a\u4e86\u2f00\u6b21\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u628a\u670d\u52a1\u5668\u53d1\u9001\u7684 ACK \u548c FIN \u5408\u5e76\u8d77\u6765\uff0c\u53d8\u6210\u4e09\u6b21\u6325\u624b\uff1f</p> <p>\u56e0\u4e3a\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u7684\u8bf7\u6c42\u65f6\uff0c\u53ef\u80fd\u8fd8\u6709\u4e00\u4e9b\u6570\u636e\u6ca1\u6709\u53d1\u5b8c\uff0c\u8fd9\u65f6\u5148\u56de\u590d ACK\uff0c\u8868\u793a\u63a5\u6536\u5230\u4e86\u65ad\u5f00\u8fde\u63a5\u7684\u8bf7\u6c42\u3002\u7b49\u5230\u6570\u636e\u53d1\u5b8c\u4e4b\u540e\u518d\u53d1 FIN\uff0c\u65ad\u5f00\u670d\u52a1\u5668\u5230\u5ba2\u6237\u7aef\u7684\u6570\u636e\u4f20\u9001\u3002</p> <p>\u5982\u679c\u7b2c\u4e8c\u6b21\u6325\u624b\u65f6\u670d\u52a1\u5668\u7684 ACK \u6ca1\u6709\u9001\u8fbe\u5ba2\u6237\u7aef\uff0c\u4f1a\u600e\u6837\uff1f</p> <p>\u5ba2\u6237\u7aef\u6ca1\u6709\u6536\u5230 ACK \u786e\u8ba4\uff0c\u4f1a\u91cd\u65b0\u53d1\u9001 FIN \u8bf7\u6c42\u3002</p> <p>\u4e3a\u4ec0\u4e48\u7b2c\u56db\u6b21\u6325\u624b\u5ba2\u6237\u7aef\u9700\u8981\u7b49\u5f85 2*MSL\uff08\u62a5\u6587\u6bb5\u6700\u957f\u5bff\u547d\uff09\u65f6\u95f4\u540e\u624d\u8fdb\u5165 CLOSED \u72b6\u6001\uff1f</p> <p>\u7b2c\u56db\u6b21\u6325\u624b\u65f6\uff0c</p> <ol> <li> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7684 ACK \u6709\u53ef\u80fd\u4e22\u5931\uff0c\u5982\u679c\u670d\u52a1\u7aef\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u800c\u6ca1\u6709\u6536\u5230 ACK \u7684\u8bdd\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u91cd\u53d1 FIN; </p> </li> <li> <p>\u5982\u679c\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684ACK\uff0c\u4e5f\u4e0d\u4f1a\u518d\u53d1\u4efb\u4f55\u6d88\u606f\uff0c\u5305\u62ecACK</p> </li> </ol> <p>\u65e0\u8bba\u662f1\u8fd8\u662f2\uff0c\u5ba2\u6237\u7aef\u90fd\u9700\u8981\u7b49\u5f85\uff0c\u8981\u53d6\u8fd9\u4e24\u79cd\u60c5\u51b5\u7b49\u5f85\u65f6\u95f4\u7684\u6700\u5927\u503c\uff0c\u4ee5\u5e94\u5bf9\u6700\u574f\u7684\u60c5\u51b5\u53d1\u751f\uff0c\u8fd9\u4e2a\u6700\u574f\u60c5\u51b5\u662f\uff1a\u53bb\u5411ACK\u6d88\u606f\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff08MSL) + \u6765\u5411FIN\u6d88\u606f\u7684\u6700\u5927\u5b58\u6d3b\u65f6\u95f4(MSL)\u3002\u8fd9\u6070\u6070\u5c31\u662f<code>2MSL</code>( Maximum Segment Life)\u3002</p> <p>\u7b49\u5f852MSL\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u653e\u5fc3\u5730\u91ca\u653eTCP\u5360\u7528\u7684\u8d44\u6e90\u3001\u7aef\u53e3\u53f7\uff0c\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u8be5\u7aef\u53e3\u53f7\u8fde\u63a5\u4efb\u4f55\u670d\u52a1\u5668\u3002</p> <p>MSL(Maximum Segment Lifetime) : \u4e00\u4e2a\u7247\u6bb5\u5728\u7f51\u7edc\u4e2d\u6700\u5927\u7684\u5b58\u6d3b\u65f6\u95f4\uff0c2MSL \u5c31\u662f\u4e00\u4e2a\u53d1\u9001\u548c\u4e00\u4e2a\u56de\u590d\u6240\u9700\u7684\u6700\u5927\u65f6\u95f4\u3002\u5982\u679c\u76f4\u5230 2MSL\uff0cClient \u90fd\u6ca1\u6709\u518d\u6b21\u6536\u5230 FIN\uff0c\u90a3\u4e48 Client \u63a8\u65ad ACK \u5df2\u7ecf\u88ab\u6210\u529f\u63a5\u6536\uff0c\u5219\u7ed3\u675f TCP \u8fde\u63a5\u3002</p> <p>\u5982\u679c\u4e0d\u7b49\u5f85 2MSL\uff0c\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff1f</p> <p>\u5982\u679c\u4e0d\u7b49\u5f85 2MSL\uff0c\u5ba2\u6237\u7aef\u53ef\u80fd\u4f1a\u5728 2MSL \u65f6\u95f4\u5185\u91cd\u7528\u8be5\u7aef\u53e3\uff0c\u8fd9\u6837\u53ef\u80fd\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u7aef\u6536\u5230\u4e00\u4e2a\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u65b0\u7684 TCP \u8fde\u63a5\u8bf7\u6c42\uff0c\u8fd9\u65f6\u670d\u52a1\u5668\u7aef\u53ef\u80fd\u4f1a\u8bef\u8ba4\u4e3a\u8fd9\u662f\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u65ad\u5f00\u540e\u91cd\u65b0\u5efa\u7acb\u7684\u8fde\u63a5\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u7aef\u7684\u8d44\u6e90\u5206\u914d\u9519\u8bef\uff0c\u4ece\u800c\u5bfc\u81f4\u670d\u52a1\u5668\u7aef\u7684\u8d44\u6e90\u6d6a\u8d39\u3002</p>"},{"location":"basic/net/net/#46-tcp","title":"4.6 TCP \u5982\u4f55\u4fdd\u8bc1\u4f20\u8f93\u7684\u53ef\u9760\u6027","text":"<ul> <li>\u57fa\u4e8e\u6570\u636e\u5757\u4f20\u8f93 \uff1a\u5e94\u7528\u6570\u636e\u88ab\u5206\u5272\u6210 TCP \u8ba4\u4e3a\u6700\u9002\u5408\u53d1\u9001\u7684\u6570\u636e\u5757\uff0c\u518d\u4f20\u8f93\u7ed9\u7f51\u7edc\u5c42\uff0c\u6570\u636e\u5757\u88ab\u79f0\u4e3a\u62a5\u6587\u6bb5\u6216\u6bb5\u3002</li> <li>\u5bf9\u5931\u5e8f\u6570\u636e\u5305\u91cd\u65b0\u6392\u5e8f\u4ee5\u53ca\u53bb\u91cd\uff1aTCP \u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u53d1\u751f\u4e22\u5305\uff0c\u5c31\u7ed9\u6bcf\u4e2a\u5305\u4e00\u4e2a\u5e8f\u5217\u53f7\uff0c\u6709\u4e86\u5e8f\u5217\u53f7\u80fd\u591f\u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u6839\u636e\u5e8f\u5217\u53f7\u6392\u5e8f\uff0c\u5e76\u4e14\u53bb\u6389\u91cd\u590d\u5e8f\u5217\u53f7\u7684\u6570\u636e\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6570\u636e\u5305\u53bb\u91cd\u3002</li> <li>\u6821\u9a8c\u548c : TCP \u5c06\u4fdd\u6301\u5b83\u9996\u90e8\u548c\u6570\u636e\u7684\u68c0\u9a8c\u548c\u3002\u8fd9\u662f\u4e00\u4e2a\u7aef\u5230\u7aef\u7684\u68c0\u9a8c\u548c\uff0c\u76ee\u7684\u662f\u68c0\u6d4b\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u4efb\u4f55\u53d8\u5316\u3002\u5982\u679c\u6536\u5230\u6bb5\u7684\u68c0\u9a8c\u548c\u6709\u5dee\u9519\uff0cTCP \u5c06\u4e22\u5f03\u8fd9\u4e2a\u62a5\u6587\u6bb5\u548c\u4e0d\u786e\u8ba4\u6536\u5230\u6b64\u62a5\u6587\u6bb5\u3002</li> <li>\u8d85\u65f6\u91cd\u4f20 : \u5f53\u53d1\u9001\u65b9\u53d1\u9001\u6570\u636e\u4e4b\u540e\uff0c\u5b83\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u7b49\u5f85\u76ee\u7684\u7aef\u786e\u8ba4\u6536\u5230\u8fd9\u4e2a\u62a5\u6587\u6bb5\u3002\u63a5\u6536\u7aef\u5b9e\u4f53\u5bf9\u5df2\u6210\u529f\u6536\u5230\u7684\u5305\u53d1\u56de\u4e00\u4e2a\u76f8\u5e94\u7684\u786e\u8ba4\u4fe1\u606f\uff08ACK\uff09\u3002\u5982\u679c\u53d1\u9001\u7aef\u5b9e\u4f53\u5728\u5408\u7406\u7684\u5f80\u8fd4\u65f6\u5ef6\uff08RTT\uff09\u5185\u672a\u6536\u5230\u786e\u8ba4\u6d88\u606f\uff0c\u90a3\u4e48\u5bf9\u5e94\u7684\u6570\u636e\u5305\u5c31\u88ab\u5047\u8bbe\u4e3a\u5df2\u4e22\u5931open in new window\u5e76\u8fdb\u884c\u91cd\u4f20\u3002</li> <li>\u6d41\u91cf\u63a7\u5236 : TCP \u8fde\u63a5\u7684\u6bcf\u4e00\u65b9\u90fd\u6709\u56fa\u5b9a\u5927\u5c0f\u7684\u7f13\u51b2\u7a7a\u95f4\uff0cTCP \u7684\u63a5\u6536\u7aef\u53ea\u5141\u8bb8\u53d1\u9001\u7aef\u53d1\u9001\u63a5\u6536\u7aef\u7f13\u51b2\u533a\u80fd\u63a5\u7eb3\u7684\u6570\u636e\u3002\u5f53\u63a5\u6536\u65b9\u6765\u4e0d\u53ca\u5904\u7406\u53d1\u9001\u65b9\u7684\u6570\u636e\uff0c\u80fd\u63d0\u793a\u53d1\u9001\u65b9\u964d\u4f4e\u53d1\u9001\u7684\u901f\u7387\uff0c\u9632\u6b62\u5305\u4e22\u5931\u3002TCP \u4f7f\u7528\u7684\u6d41\u91cf\u63a7\u5236\u534f\u8bae\u662f\u53ef\u53d8\u5927\u5c0f\u7684\u6ed1\u52a8\u7a97\u53e3\u534f\u8bae\uff08TCP \u5229\u7528\u6ed1\u52a8\u7a97\u53e3\u5b9e\u73b0\u6d41\u91cf\u63a7\u5236\uff09\u3002</li> <li>\u62e5\u585e\u63a7\u5236 : \u5f53\u7f51\u7edc\u62e5\u585e\u65f6\uff0c\u51cf\u5c11\u6570\u636e\u7684\u53d1\u9001\u3002</li> </ul>"},{"location":"basic/net/net/#47","title":"4.7 \u91cd\u4f20\u673a\u5236\uff08\u5e8f\u5217\u53f7\u4e0e\u786e\u8ba4\u5e94\u7b54\uff09","text":""},{"location":"basic/net/net/#471","title":"4.7.1 \u8d85\u65f6\u91cd\u4f20","text":"<p>\u8bbe\u5b9a\u2f00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5f53\u8d85\u8fc7\u6307\u5b9a\u7684\u65f6\u95f4\u540e\uff0c\u6ca1\u6709\u6536\u5230\u5bf9\u2f45\u7684 ACK\u786e\u8ba4\u5e94\u7b54\u62a5\u2f42\uff0c\u5c31\u4f1a\u91cd\u53d1\u8be5\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u8d85\u65f6\u91cd\u4f20\u3002 \u6240\u4ee5\u8981\u4e48\u81ea\u5df1\u7684\u6570\u636e\u5305\u5bf9\u9762\u6ca1\u6709\u6536\u5230\uff0c\u8981\u4e48\u5bf9\u9762\u56de\u5e94\u7684\u6d88\u606f\u81ea\u5df1\u6ca1\u6709\u6536\u5230\u3002</p> <p>\u8d85\u65f6\u65f6\u95f4\u5982\u4f55\u8bbe\u7f6e</p> <p>RTT\uff08Round-Trip Time \u5f80\u8fd4\u65f6\u5ef6\uff09\uff1a\u662f\u6570\u636e\u5305\u7684\u5f80\u8fd4\u65f6\u95f4</p> <p>RTO\uff08Retransmission Timeout \u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\uff09</p> <ul> <li> <p>\u5982\u679cRTO\u592a\u5c0f\uff1a\u4f1a\u9020\u6210\u5f88\u591a\u4e0d\u5fc5\u8981\u7684\u91cd\u4f20\uff0c\u6bd4\u5982\u5bf9\u65b9\u5176\u5b9e\u5df2\u7ecf\u6536\u5230\u4e86\uff0c\u6b63\u5728\u5904\u7406\uff0c\u4f60\u5c31\u50ac\u50ac\u50ac\uff0c\u4e0d\u5fc5\u8981\u7684\u91cd\u4f20\u4f1a\u5bfc\u81f4\u7f51\u7edc\u8d1f\u8377\u589e\u5927\u3002</p> </li> <li> <p>\u5982\u679cRTO\u592a\u5927\uff1a\u4f1a\u4f7f\u7f51\u7edc\u7a7a\u9699\u65f6\u95f4\u589e\u5927\uff0c\u964d\u4f4e\u4e86\u7f51\u7edc\u4f20\u8f93\u7684\u6548\u7387\u3002</p> </li> <li> <p>RTO\u5e94\u8be5\u7565\u5927\u4e8e\u6570\u636e\u5305\u5f80\u8fd4\u65f6\u95f4RTT\u3002\u4f46\u7531\u4e8eRTT\u6839\u636e\u7f51\u7edc\u60c5\u51b5\u65f6\u5e38\u53d8\u5316\uff0c\u6240\u4ee5RTO\u4e5f\u968f\u4e4b\u52a8\u6001\u53d8\u5316\u3002</p> </li> </ul> <p>\u8d85\u65f6\u91cd\u4f20\u7684\u6570\u636e\u518d\u6b21\u8d85\u65f6\u600e\u4e48\u529e\uff1f</p> <p>\u6bcf\u6b21\u9047\u5230\u8d85\u65f6\u91cd\u4f20\uff0c\u4f1a\u5c06\u4e0b\u4e00\u6b21\u7684RTO\u52a0\u500d\uff0c\u5982\u679c\u4e24\u6b21\u8d85\u65f6\uff0c\u8bf4\u660e\u7f51\u7edc\u73af\u5883\u5dee</p>"},{"location":"basic/net/net/#472","title":"4.7.2 \u5feb\u901f\u91cd\u4f20","text":"<p>\u5feb\u901f\u91cd\u4f20\u4ee5\u6570\u636e\u9a71\u52a8\u91cd\u4f20\u3002 \u5982\u679c\u63a5\u6536\u65b9\u67d0\u4e00\u6b21\u6ca1\u6709\u6536\u5230\u9884\u5b9aSeq\u7684\u5305\u5374\u6536\u5230\u4e86\u5927\u4e8e\u5176\u7684\u5305\uff0c\u8fd9\u8bf4\u660e\u4e2d\u95f4\u6709\u4e2a\u5305\u4e22\u4e86\uff0c\u5b83\u4f1a\u4e00\u76f4\u56de\u590d\u4e22\u4e86\u7684\u90a3\u4e2a\u5305\u7684ACK\uff0c\u5f53\u53d1\u9001\u65b9\u6536\u5230\u4e09\u4e2a\u5e8f\u53f7\u540c\u6837\u7684ACK\u5c31\u76f4\u63a5\u89e6\u53d1\u91cd\u4f20\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6bd4\u8d85\u65f6\u91cd\u4f20\u5feb\u7684\u3002</p> <p></p>"},{"location":"basic/net/net/#48","title":"4.8 \u6ed1\u52a8\u7a97\u53e3","text":"<p>\u6ed1\u52a8\u7a97\u53e3\u4f5c\u7528\u662f \u907f\u514d\u53d1\u9001\u65b9\u6bcf\u4e2a\u5305\u90fd\u8981\u7b49\u7740\u88abACK\u4e00\u4e0b\u3002</p> <p>\u7a97\u53e3\u5927\u5c0f\u4ee3\u8868\u7740\uff1a\u65e0\u9700\u7b49\u5f85\u63a5\u6536\u65b9\u786e\u8ba4\uff0c\u53d1\u9001\u53d1\u53ef\u4ee5\u8fde\u7eed\u53d1\u9001\u6570\u636e\u7684\u6570\u76ee\u6700\u5927\u503c</p> <p>\u6240\u4ee5\u6ed1\u52a8\u7a97\u53e3\u4e0b\u7684ACK\uff0c\u4ee3\u8868\u7740\u8be5\u5e8f\u53f7\u4e4b\u524d\u7684\u6240\u6709\u6570\u636e\u5305\u63a5\u6536\u65b9\u90fd\u5df2\u7ecf\u6536\u5230\uff0c\u8fd9\u4e2a\u6a21\u5f0f\u79f0\u4e4b\u4e3a\u7d2f\u8ba1\u5e94\u7b54</p> <p>\u53cc\u65b9\u901a\u4fe1\u7684\u7a97\u53e3\u5927\u5c0f\u5982\u4f55\u786e\u5b9a\uff1f</p> <p>\u6309\u63a5\u6536\u65b9\u7a97\u53e3\u5927\u5c0f\u786e\u5b9a\u3002\u53d1\u9001\u65b9\u7684\u6570\u636e\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7\u63a5\u6536\u65b9\u7a97\u53e3\u5927\u5c0f\u3002</p>"},{"location":"basic/net/net/#481","title":"4.8.1 \u53d1\u9001\u65b9\u7a97\u53e3","text":"<p>\u53d1\u9001\u65b9\u4e00\u65e6\u6309\u7167\u5bf9\u65b9\u63a5\u6536\u7a97\u53e3\u786e\u8ba4\u7a97\u53e3\u5927\u5c0f\u540e\uff0c\u7a97\u53e3\u5185\u7684\u6240\u6709\u6570\u636e\u5305\u90fd\u53ef\u4ee5\u76f4\u63a5\u53d1\u9001\uff0c\u6bcf\u5f53\u6536\u5230ACK\uff0c\u5c31\u7528<code>ACK-\u5f53\u524d\u7a97\u53e3\u6700\u5c0f\u5e8f\u53f7=num</code>\uff0c\u4ee3\u8868\u73b0\u5728num\u4e2a\u6570\u88ab\u6536\u5230\u4e86\uff0c\u7a97\u53e3\u5c31\u53ef\u4ee5\u53f3\u79fbnum\u4e2a\u4f4d\u7f6e\u3002</p> <p>\u53d1\u9001\u65b9\u4e3b\u8981\u9760\u4e09\u4e2a\u6307\u9488\u6765\u786e\u8ba4\u5df1\u65b9\u7a97\u53e3\u7684\u56db\u79cd\u72b6\u6001</p> <ol> <li>\u5df2\u53d1\u9001\uff0c\u5df2ACK\uff1b</li> <li>\u5df2\u53d1\u9001\uff0c\u672aACK\uff1b</li> <li>\u672a\u53d1\u9001\uff0c\u4f46\u662f\u53ef\u53d1\u9001 \uff1b</li> <li>\u672a\u53d1\u9001\uff0c\u4f46\u8d85\u51fa\u7a97\u53e3\u5927\u5c0f\u7684</li> </ol> <p></p> <ul> <li>SND.WND\uff1a\u8868\u793a\u53d1\u9001\u7a97\u53e3\u5927\u5c0f\u3002</li> <li>SND.UNA:\u6307\u5411\u5df2\u53d1\u9001\u4f46\u672aACK\u7684\u7b2c\u4e00\u4e2a\u5e8f\u53f7</li> <li>SND.NXT:\u6307\u5411\u672a\u53d1\u9001\u4f46\u53ef\u53d1\u9001\u7684\u7b2c\u4e00\u4e2a\u5e8f\u53f7\u3002</li> </ul>"},{"location":"basic/net/net/#482","title":"4.8.2 \u63a5\u6536\u65b9\u7a97\u53e3\uff1a","text":"<p>\u72b6\u6001\uff1a</p> <ul> <li><code>#1 + #2</code> \u662f\u5df2\u6210\u529f\u63a5\u6536\u5e76\u786e\u8ba4\u7684\u6570\u636e\uff08\u7b49\u5f85\u5e94\u2f64\u8fdb\u7a0b\u8bfb\u53d6\uff09\uff1b</li> <li><code>#3</code> \u662f\u672a\u6536\u5230\u6570\u636e\u4f46\u53ef\u4ee5\u63a5\u6536\u7684\u6570\u636e\uff1b</li> <li><code>#4</code> \u672a\u6536\u5230\u6570\u636e\u5e76\u4e0d\u53ef\u4ee5\u63a5\u6536\u7684\u6570\u636e\uff1b</li> </ul> <p>\u63a5\u6536\u65b9\u53ea\u9700\u8981\u4e24\u4e2a\u6307\u9488\u5c31\u53ef\uff1a</p> <ul> <li>RCV.WND \uff1a\u8868\u793a\u63a5\u6536\u7a97\u2f1d\u7684\u2f24\u2f29\uff0c\u5b83\u4f1a\u901a\u544a\u7ed9\u53d1\u9001\u2f45\u3002</li> <li>RCV.NXT \uff1a\u662f\u2f00\u4e2a\u6307\u9488\uff0c\u5b83\u6307\u5411\u671f\u671b\u4ece\u53d1\u9001\u2f45\u53d1\u9001\u6765\u7684\u4e0b\u2f00\u4e2a\u6570\u636e\u5b57\u8282\u7684\u5e8f\u5217\u53f7\uff0c\u4e5f\u5c31\u662f #3 \u7684\u7b2c\u2f00\u4e2a\u5b57\u8282\u3002</li> <li>\u6307\u5411 #4 \u7684\u7b2c\u2f00\u4e2a\u5b57\u8282\u662f\u4e2a\u76f8\u5bf9\u6307\u9488\uff0c\u5b83\u9700\u8981 RCV.NXT \u6307\u9488\u52a0\u4e0a RCV.WND \u2f24\u2f29\u7684\u504f\u79fb\uff0c\u5c31\u53ef\u4ee5\u6307\u5411#4 \u7684\u7b2c\u2f00\u4e2a\u5b57\u8282\u4e86\u3002</li> </ul> <p>\u63a5\u6536\u7a97\u53e3\u548c\u53d1\u9001\u7a97\u53e3\u662f\u4e0d\u662f\u5b8c\u5168\u76f8\u7b49</p> <p>\u4e0d\u662f\u5b8c\u5168\u76f8\u7b49\uff0c\u662f\u7ea6\u7b49\u4e8e\uff0c\u56e0\u4e3a\u63a5\u6536\u65b9\u53ef\u4ee5\u6309\u81ea\u5df1\u7684\u63a5\u6536\u80fd\u529b\u6269\u5927\u6216\u7f29\u5c0f\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\uff0c\u901a\u8fc7TCP\u62a5\u6587\u7684Windows\u5b57\u6bb5\u544a\u8bc9\u53d1\u9001\u65b9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6709\u5ef6\u8fdf\u7684\u3002</p>"},{"location":"basic/net/net/#49","title":"4.9 \u6d41\u91cf\u63a7\u5236","text":"<p>\u6d41\u91cf\u63a7\u5236\u4e3b\u8981\u662f\u4e3a\u4e86\u53d1\u9001\u65b9\u6839\u636e\u63a5\u6536\u65b9\u7684\u5b9e\u9645\u63a5\u6536\u80fd\u529b\u63a7\u5236\u53d1\u9001\u7684\u6570\u636e\u91cf\u3002</p> <p>\u5728\u5b9e\u9645\u60c5\u51b5\u4e0b\uff0c\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u4e2d\u5b58\u653e\u7684\u6570\u636e\u90fd\u653e\u5728\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\uff0c\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u6574\u3002</p> <p>\u4e3b\u8981\u662f\u63a5\u6536\u65b9\u867d\u7136\u6536\u5230\u4e86\u6570\u636e\uff0c\u4f46\u662f\u5e94\u7528\u5c42\u6ca1\u6709\u628a\u6536\u5230\u7684\u6570\u636e\u8bfb\u8d70\u8fd9\u6837\u63a5\u6536\u65b9\u4e0d\u6562\u8d38\u7136\u7ee7\u7eed\u63a5\u6536\u63a5\u6536\u7a97\u53e3\u4ee5\u5916\u7684\u6570\u636e\uff0c\u53ea\u80fd\u4e0d\u65ad\u7f29\u5c0f\u63a5\u6536\u7a97\u53e3\uff0c\u5e76\u56de\u590d\u7684\u65f6\u5019\u544a\u8bc9\u53d1\u9001\u65b9\u81ea\u5df1\u7684\u63a5\u6536\u7a97\u53e3\u7f29\u5c0f\u4e86\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\u53ef\u80fd\u5bfc\u81f4\u63a5\u6536\u7a97\u53e3\u548c\u53d1\u9001\u7a97\u53e3\u90fd\u9010\u6e10\u7f29\u5c0f\u52300\uff1b</p> <p>\u66f4\u6781\u7aef\u7684\u60c5\u51b5\uff0c\u5982\u679c\u53d1\u9001\u65b9\u8fd8\u6ca1\u6709\u6536\u5230\u63a5\u6536\u65b9\u7f29\u5c0f\u63a5\u6536\u7a97\u53e3\uff08\u56e0\u4e3a\u63a5\u6536\u65b9\u5e94\u7528\u5c42\u7f29\u5c0f\u4e86\u7f13\u5b58\u7a7a\u95f4\uff09\u7684\u901a\u77e5\u5c31\u5df2\u7ecf\u628a\u8d85\u51fa\u73b0\u5728\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\u7684\u6570\u636e\u53d1\u51fa\u53bb\u4e86\uff0c\u63a5\u6536\u7684\u6570\u636e\u5305\u5927\u4e8e\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\uff0c\u6b64\u65f6\u63a5\u6536\u65b9\u76f4\u63a5\u4e22\u5305</p>"},{"location":"basic/net/net/#491","title":"4.9.1 \u7a97\u53e3\u5173\u95ed\u73b0\u8c61","text":"<p>\u5047\u8bbe\u63a5\u6536\u65b9\u5229\u7528\u6d41\u91cf\u63a7\u5236\uff0c\u4e0d\u65ad\u7f29\u5c0f\u81ea\u5df1\u7684\u63a5\u6536\u7a97\u53e3\uff0c\u76f4\u52300\uff0c\u8fd9\u4e2a\u65f6\u5019\u53d1\u9001\u65b9\u4e5f\u6536\u5230\u4e86\u7a97\u53e3\u5927\u5c0f\u3002\u6b64\u65f6\u53cc\u65b9\u7684\u7a97\u53e3\u90fd\u5173\u95ed\u4e86</p> <p>\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\uff0c\u63a5\u6536\u65b9\u5904\u7406\u80fd\u529b\u4e0a\u6765\u4e86\uff0c\u628a\u63a5\u6536\u7a97\u53e3\u589e\u5927\u4e86\uff0c\u53d1\u6d88\u606f\u544a\u8bc9\u53d1\u9001\u65b9\u5374\u4e22\u5305\u4e86\u3002\u90a3\u4e48\u53cc\u65b9\u8fdb\u5165\u4e86\u6301\u7eed\u7b49\u5f85\u72b6\u6001\uff0c\u5f62\u6210\u6b7b\u9501</p> <p>\u5982\u4f55\u89e3\u51b3\u6f5c\u5728\u6b7b\u9501\u73b0\u8c61</p> <p>TCP\u4e3a\u6bcf\u4e2a\u8fde\u63a5\u8bbe\u6709\u4e00\u4e2a\u6301\u7eed\u5b9a\u65f6\u5668\uff0c\u53ea\u8981TCP\u67d0\u4e00\u65b9\u6536\u5230\u5bf9\u65b9\u76840\u7a97\u53e3\u901a\u77e5\uff0c\u5c31\u542f\u52a8\u8ba1\u65f6\u5668\u3002\u8ba1\u65f6\u5668\u8d85\u65f6\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53d1\u9001\u7a97\u53e3\u63a2\u6d4b\u62a5\u6587 \u4ee5\u7528\u6765\u8be2\u95ee\u5bf9\u65b9\u73b0\u5728\u7684\u63a5\u6536\u7a97\u53e3\u5230\u5e95\u662f\u591a\u5c11\u3002\u5982\u679c\u4e09\u6b21\u4e4b\u540e\u63a5\u6536\u7a97\u53e3\u8fd8\u662f0\uff0c\u5c31RST\u4e2d\u65ad\u8fde\u63a5\u3002</p>"},{"location":"basic/net/net/#492-nagle","title":"4.9.2 \u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u5f81\uff08\u7c98\u5305\u95ee\u9898\u3001nagle\uff09","text":"<p>\u5047\u8bbe\u6709\u4e00\u4e2a\u5927\u5df4\u8f66\u961f\uff0c\u6bcf\u8f86\u8f66\u521a\u4e0a\u4e00\u4e24\u4e2a\u4eba\u5c31\u53d1\u8f66\u4e86\uff0c\u663e\u7136\u4e0d\u7ecf\u6d4e\u3002</p> <p>\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u5f81 \u5c31\u662f\uff1a\u5982\u679c\u63a5\u6536\u65b9\u6bcf\u6b21\u521a\u817e\u51fa\u4e00\u5c0f\u5757\u513f\u51e0\u4e2a\u5b57\u8282\u7684\u7a7a\u95f4\uff0c\u5c31\u544a\u8bc9\u53d1\u9001\u65b9\uff0c\u53d1\u9001\u65b9\u53c8\u53d1\u9001\u4e86\u51e0\u4e2a\u5b57\u8282\uff0c\u8fd9\u6837\u7684\u53d1\u9001\u4f53\u91cf\u76f8\u5bf9\u4e8eTCP+IP\u5934\u90e8\u603b\u517140\u5b57\u8282\u7684\u6210\u672c\u6765\u8bf4\uff0c\u663e\u7136\u5f00\u9500\u592a\u5927\u3002</p> <p>\u9020\u6210\u4e0a\u8ff0\u539f\u56e0\u6709\u4e24\u4e2a\uff1a</p> <ul> <li>\u63a5\u6536\u65b9\u53ef\u4ee5\u901a\u544a\u53d1\u9001\u65b9\u5c0f\u7a97\u53e3</li> <li>\u800c\u53d1\u9001\u65b9\u4e5f\u53ef\u4ee5\u53d1\u9001\u5c0f\u6570\u636e</li> </ul> <p>\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\uff1a</p> <ol> <li>\u4e0d\u8ba9\u63a5\u6536\u65b9\u901a\u544a\u5c0f\u7a97\u53e3\uff1a\u5982\u679c\u5f53\u524d\u7a97\u53e3\u5927\u5c0f&lt;min(MSS,\u7f13\u5b58\u7a7a\u95f4\u7684\u4e00\u534a)\u65f6\uff0c\u76f4\u63a5\u5173\u95ed\u7a97\u53e3\u901a\u77e5\u53d1\u9001\u65b9\u7a97\u53e3\u4e3a0\uff0c\u963b\u6b62\u6570\u636e\u518d\u53d1\u8fc7\u6765\u3002\u5f53\u5927\u4e8e\u8fd9\u4e2amin\u503c\u7684\u65f6\u5019\uff0c\u5c31\u628a\u7a97\u53e3\u6253\u5f00\u8ba9\u53d1\u9001\u65b9\u53d1</li> <li> <p>\u4e0d\u8ba9\u53d1\u9001\u65b9\u53d1\u9001\u5c0f\u6570\u636e\uff1a<code>Nagle</code>\u7b97\u6cd5\uff1a\u5ef6\u65f6\u5904\u7406\uff0c\u5fc5\u9700\u6ee1\u8db3\u4ee5\u4e0b\u67d0\u4e00\u79cd\u6761\u4ef6\u624d\u80fd\u53d1\u6570\u636e\uff1a</p> </li> <li> <p>\u7a97\u53e3\u6216\u6570\u636e\u5927\u5c0f&gt;=MSS</p> </li> <li>\u6536\u5230\u4e4b\u524d\u6570\u636e\u56de\u590d\u7684ACK\u5305\uff08\u56e0\u4e3a\u5982\u679c\u63a5\u6536\u65b9\u5df2\u7ecf\u4e0d\u4f1a\u901a\u544a\u5c0f\u7a97\u53e3\u4e86\uff0c\u6240\u4ee5ACK\u65f6\u63a5\u6536\u65b9\u5fc5\u5b9a\u51c6\u5907\u597d\u4e86\uff09</li> </ol> <p>\u53ea\u8981\u6ca1\u6709\u6ee1\u8db3\u4e0a\u8ff0\u4e24\u4e2a\u6761\u4ef6\u4e4b\u4e00\uff0c\u53d1\u9001\u65b9\u5c31\u4e00\u76f4\u56e4\u79ef\u6570\u636e\u3002</p>"},{"location":"basic/net/net/#410","title":"4.10. \u62e5\u585e\u63a7\u5236","text":""},{"location":"basic/net/net/#4101","title":"4.10.1 \u62e5\u585e\u63a7\u5236\u4e0e\u6d41\u91cf\u63a7\u5236\u7684\u5173\u7cfb","text":"<p>\u6d41\u91cf\u63a7\u5236\u662f \u63a5\u6536\u65b9\u5bf9\u53d1\u9001\u65b9\u53d1\u9001\u7a97\u53e3\u7684\u8c03\u6574\uff0c\u907f\u514d\u53d1\u9001\u65b9\u7684\u6570\u636e\u586b\u6ee1\u63a5\u6536\u65b9\u7684\u7f13\u5b58\u3002\u4f46\u5bf9\u4e8e\u53d1\u9001\u65b9\u6765\u8bf4\uff0c\u4ed6\u5e76\u4e0d\u6e05\u695a\u4e3a\u4ec0\u4e48\u63a5\u6536\u65b9\u8981\u505a\u8fd9\u6837\u7684\u8c03\u6574</p> <p>\u56e0\u4e3a\u8ba1\u7b97\u673a\u7f51\u7edc\u5904\u5728\u4e00\u4e2a\u5171\u4eab\u7684\u73af\u5883\u4e4b\u4e2d\uff0c\u6240\u4ee5\uff0c\u53d1\u9001\u65b9\u53d1\u9001\u7a97\u53e3\u4e0d\u4e00\u5b9a\u662f\u56e0\u4e3a\u63a5\u6536\u65b9\u7684\u8c03\u6574\uff0c\u8fd8\u6709\u53ef\u80fd\u662f\u5176\u4ed6\u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\u4f7f\u5f97\u7f51\u7edc\u53d1\u751f\u4e86\u62e5\u5835\uff0c\u8fd9\u4e2a\u65f6\u5019\u53d1\u9001\u65b9\u5982\u679c\u7ee7\u7eed\u53d1\u9001\u5927\u91cf\u6570\u636e\uff0c\u5219\u4f1a\u8fdb\u4e00\u6b65\u52a0\u91cd\u7f51\u7edc\u7684\u8d1f\u62c5\u3002\u5f62\u6210\u6076\u6027\u5faa\u73af\u3002</p> <p>\u6240\u4ee5\uff0c\u53d1\u9001\u65b9\u7684\u53d1\u9001\u901f\u7387\u4e0d\u4ec5\u4ec5\u8981\u770b\u63a5\u6536\u65b9\u7684\u63a5\u6536\u80fd\u529b\uff0c\u8fd8\u8981\u770b\u6574\u4e2a\u7f51\u7edc\u7684\u63a5\u6536\u80fd\u529b\u3002</p>"},{"location":"basic/net/net/#4102","title":"4.10.2 \u62e5\u585e\u7a97\u53e3\u4e0e\u53d1\u9001\u7a97\u53e3","text":"<p>\u62e5\u585e\u7a97\u53e3cwnd\u662f\u53d1\u9001\u65b9\u7ef4\u62a4\u7684\u4e00\u4e2a\u72b6\u6001\u53d8\u91cf\uff0c\u5b83\u4f1a\u6839\u636e\u7f51\u7edc\u7684\u62e5\u585e\u7a0b\u5ea6\u52a8\u6001\u53d8\u5316\u3002</p> <p>\u524d\u9762\u63d0\u8fc7\u7684\u53d1\u9001\u7a97\u53e3\u4e0e\u63a5\u6536\u7a97\u53e3\u662f\u4e00\u4e2a\u7ea6\u7b49\u4e8e\u7684\u5173\u7cfb\u3002\u800c\u52a0\u5165\u4e86\u62e5\u585e\u7a97\u53e3\u4e4b\u540e\uff0c\u53d1\u9001\u7a97\u53e3\u7684\u503c\u53d1\u9001\u4e86\u53d8\u5316</p> <p>\u53d1\u9001\u7a97\u53e3=min(\u62e5\u585e\u7a97\u53e3,\u63a5\u6536\u7a97\u53e3)</p> <p>\u5f53\u7f51\u7edc\u4e2d\u6ca1\u6709\u51fa\u73b0\u62e5\u5835\uff0c\u62e5\u585e\u7a97\u53e3\u5c31\u589e\u5927\uff0c\u53cd\u4e4b\u5219\u51cf\u5c0f\u3002</p> <p>\u90a3\u4e48\u5982\u4f55\u5224\u65ad\u7f51\u7edc\u662f\u5426\u51fa\u73b0\u4e86\u62e5\u585e\u5462\uff0c\u51fa\u73b0\u8d85\u65f6\u91cd\u4f20\u62a5\u6587\uff0c\u5c31\u8ba4\u4e3a\u7f51\u7edc\u51fa\u73b0\u4e86\u62e5\u585e</p>"},{"location":"basic/net/net/#4103","title":"4.10.3 \u62e5\u585e\u63a7\u5236\u56db\u5927\u7b97\u6cd5","text":"<p>1. \u6162\u542f\u52a8</p> <p>\u5f53TCP\u521a\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5b83\u5e76\u4e0d\u6e05\u695a\u53d1\u9001\u591a\u5c11\u6570\u636e\u6bd4\u8f83\u5408\u9002\uff0c\u6240\u4ee5\u6709\u4e2a\u6162\u542f\u52a8\u7684\u8fc7\u7a0b\uff0c\u4e00\u70b9\u70b9\u7684\u8bd5\u63a2\u81ea\u5df1\u80fd\u53d1\u591a\u5c11\u6bd4\u8f83\u5408\u9002\u3002\uff08\u5373 \u907f\u514d\u4e0a\u6765\u5c31\u53d1\u9001\u5927\u91cf\u7684\u6570\u636e\uff09</p> <p>\u53d1\u9001\u65b9\u6bcf\u6536\u5230\u4e00\u4e2aACK\uff0c\u62e5\u585e\u7a97\u53e3cwnd\u5c31\u589e\u52a0\u4e00\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2a RTT\uff0ccwnd \u7ffb\u500d\u3002\u5982\u679c\u8bf4\u521d\u59cb\u7a97\u53e3\u4e3a 10\uff0c\u90a3\u4e48\u7b2c\u4e00\u8f6e 10 \u4e2a\u62a5\u6587\u4f20\u5b8c\u4e14\u53d1\u9001\u7aef\u6536\u5230 ACK \u540e\uff0ccwnd \u53d8\u4e3a 20\uff0c\u7b2c\u4e8c\u8f6e\u53d8\u4e3a 40\uff0c\u7b2c\u4e09\u8f6e\u53d8\u4e3a 80\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002\u62e5\u585e\u7a97\u53e3\u7ebf\u6027\u589e\u957f\uff0c\u5b9e\u9645\u6bcf\u6b21\u53d1\u5305\u6570\u91cf\u662f\u4e00\u4e2a\u6307\u6570\u578b\u589e\u957f</p> <p></p> <p>\u56e0\u4e3a\u6307\u6570\u7206\u70b8\u6027\u589e\u957f\uff0c\u6211\u4eec\u5f97\u8bbe\u7f6e\u4e00\u4e2a\u4e0a\u9650\uff0c\u907f\u514d\u5176\u4e00\u76f4\u6162\u542f\u52a8\u6307\u6570\u578b\u589e\u957f\uff1a</p> <p>\u6162\u542f\u52a8\u95e8\u9650ssthresh\uff08slow start threshold\uff09:</p> <ul> <li>\u62e5\u585e\u7a97\u53e3cwnd&lt;\u6162\u542f\u52a8\u95e8\u9650ssthresh,\u4f7f\u7528\u6162\u542f\u52a8\u7b97\u6cd5\u3002</li> <li>cwnd&gt;=ssthresh,\u4f7f\u7528\u62e5\u585e\u907f\u514d\u7b97\u6cd5</li> </ul> <p>\u4e00\u822c\u6765\u8bf4ssthreash\u7684\u5927\u5c0f\u662f65535\u5b57\u8282\u3002</p> <p>2.\u62e5\u585e\u907f\u514d</p> <p>\u62e5\u585e\u907f\u514d\u7b97\u6cd5\uff1a\u6bcf\u6536\u5230\u4e00\u4e2aACK\uff0c\u62e5\u585e\u7a97\u53e3\u53ea\u589e\u52a01/cwnd</p> <p>\u7531\u4e8e\u53d1\u751f\u62e5\u585e\u907f\u514d\u7684\u65f6\u5019\uff0c\u62e5\u585e\u7a97\u53e3\u5927\u4e8e\u6162\u542f\u52a8\u95e8\u9650\uff0c\u5f53\u6536\u5230cwnd\u4e2aACK\u786e\u8ba4\u65f6\uff0ccwnd\u589e\u52a0\u4e00\u3002</p> <p>\u62e5\u585e\u907f\u514d\u7b97\u6cd5\u4f7f\u5f97\u6570\u636e\u53d8\u6210\u4e86\u7ebf\u6027\u589e\u957f</p> <p></p> <p>3.\u62e5\u585e\u53d1\u751f</p> <p>\u4e00\u65e6\u53d1\u751f\u4e86\u91cd\u4f20\uff0c\u5373\u62e5\u585e\u53d1\u751f</p> <p>\u91cd\u4f20\u5206\u4e3a\u4e24\u79cd\uff1a</p> <ul> <li>\u8d85\u65f6\u91cd\u4f20</li> </ul> <p>\u8d85\u65f6\u91cd\u4f20\u53d1\u751f\u65f6\uff0c\u95e8\u9650\u548c\u62e5\u585e\u7a97\u53e3\u90fd\u53d1\u751f\u53d8\u5316\uff1a</p> <ul> <li>\u95e8\u9650ssthresh\u53d8\u4e3a\u62e5\u585e\u7a97\u53e3cwnd\u7684\u4e00\u534a</li> <li>\u800c\u540e\u62e5\u585e\u7a97\u53e3\u91cd\u7f6e\u4e3a1</li> </ul> <p></p> <p>\u968f\u540e\u5c31\u662f\u6b63\u5e38\u7684\u6162\u542f\u52a8\u4e86\u3002</p> <ul> <li>\u5feb\u901f\u91cd\u4f20</li> </ul> <p>\u5f53\u8fde\u7eed\u6536\u5230\u4e09\u4e2a\u540c\u6837\u7684ACK\uff0c\u8fd9\u65f6\u4ee3\u8868\u63a5\u6536\u65b9\u53d1\u73b0\u4e22\u4e86\u4e2d\u95f4\u67d0\u4e00\u4e2a\u5305\uff0c\u53d1\u9001\u65b9\u5c31\u53ef\u4ee5\u5feb\u901f\u7684\u91cd\u4f20\u8fd9\u4e2a\u5305\u3002   \u6b64\u65f6\u6709\u4e09\u4e2a\u53cd\u5e94\uff1a</p> <ol> <li> <p>\u5c06\u62e5\u585e\u7a97\u53e3\u51cf\u534a\u3002cwnd/=2;</p> </li> <li> <p>\u5c06\u95e8\u9650\u548c\u62e5\u585e\u7a97\u53e3\u76f8\u7b49\u3002ssthresh=cwnd\u3002</p> </li> <li> <p>\u5f00\u59cb\u5feb\u901f\u6062\u590d\u7b97\u6cd5</p> <p>\u5f53\u53d1\u751f\u5feb\u901f\u91cd\u4f20\u7684\u65f6\u5019\uff0c\u4f60\u53d1\u9001\u65b9\u8fd8\u80fd\u6536\u5230\u4e09\u4e2a\u4e00\u6837\u7684ACK\uff0c\u8bf4\u660e\u7f51\u7edc\u60c5\u51b5\u6ca1\u6709\u8d85\u65f6\u91cd\u4f20\u90a3\u4e48\u7cdf\u7cd5\u3002  \u6309\u5feb\u901f\u91cd\u4f20\uff0c\u62e5\u585e\u7a97\u53e3\u51cf\u534a\u4e86\uff0c\u6162\u542f\u52a8\u95e8\u9650\u7b49\u540c\u4e8e\u62e5\u585e\u7a97\u53e3\u4e86\u3002</p> <p>\u6b64\u65f6\u5feb\u901f\u6062\u590d\uff1a</p> <ul> <li>\u62e5\u585e\u7a97\u53e3cwnd=ssthresh+3;\u62e5\u585e\u7a97\u53e3\u5728\u521a\u624d\u51cf\u534a\u4e4b\u540e\u5148\u52a03\uff0c\u4ee3\u8868\u5df2\u7ecf\u6536\u5230\u4e86\u4e09\u4e2aACK.\uff08\u5982\u8fd8\u6709\u91cd\u590dACK,cwnd\u518d\u52a0\u4e00\uff09\uff1b</li> <li>\u91cd\u4f20\u6570\u636e\u3002</li> <li>\u5982\u679c\u6536\u5230\u65b0\u6570\u636e\u7684ACK\u8bf4\u660e\u7f51\u7edc\u5df2\u7ecf\u6062\u590d\uff0c\u6b64\u65f6\u95e8\u9650\u503c\u6062\u590d\u91cd\u4f20\u4e4b\u524d\u7684\u503c\uff0c\u5e76\u5f00\u59cb\u62e5\u585e\u907f\u514d\u3002</li> </ul> <p></p> </li> </ol> <p>\u62e5\u585e\u7b97\u6cd5\u603b\u4f53\u5982\u4e0b\u56fe</p> <p></p> <ol> <li>\u6162\u542f\u52a8</li> <li>\u53d1\u751f\u8d85\u65f6\u91cd\u4f20\uff0c\u95e8\u9650\u53d8\u4e3a\u62e5\u585e\u7a97\u53e3\u7684\u4e00\u534a\uff0c\u62e5\u585e\u7a97\u53e3\u91cd\u7f6e\u4e3a1.</li> <li>\u6162\u542f\u52a8</li> <li>\u8fbe\u5230\u6162\u542f\u52a8\u95e8\u9650\uff0c\u5f00\u59cb\u62e5\u585e\u907f\u514d\uff0c\u7ebf\u6027\u589e\u957f\u3002</li> <li>\u53d1\u751f\u5feb\u901f\u91cd\u4f20\uff0c\u95e8\u9650\u51cf\u534a\uff0c\u62e5\u585e\u7a97\u53e3\u51cf\u534a\u4e4b\u540e\u52a03.\u5feb\u901f\u6062\u590d\uff0c\u95e8\u9650\u6062\u590d\u3002\u62e5\u585e\u907f\u514d\u3002</li> </ol>"},{"location":"basic/net/net/#411-socket","title":"4.11 Socket","text":""},{"location":"basic/net/net/#4111","title":"4.11.1 \u662f\u4ec0\u4e48","text":"<ul> <li>Socket \u662f \u5bf9 TCP/IP \u534f\u8bae\u65cf\u7684\u4e00\u79cd\u5c01\u88c5\uff0c\u662f\u5e94\u7528\u5c42\u4e0eTCP/IP\u534f\u8bae\u65cf\u901a\u4fe1\u7684\u4e2d\u95f4\u8f6f\u4ef6\u62bd\u8c61\u5c42\u3002\u4ece\u8bbe\u8ba1\u6a21\u5f0f\u7684\u89d2\u5ea6\u770b\u6765\uff0cSocket\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u95e8\u9762\u6a21\u5f0f\uff0c\u5b83\u628a\u590d\u6742\u7684TCP/IP\u534f\u8bae\u65cf\u9690\u85cf\u5728Socket\u63a5\u53e3\u540e\u9762\uff0c\u5bf9\u7528\u6237\u6765\u8bf4\uff0c\u4e00\u7ec4\u7b80\u5355\u7684\u63a5\u53e3\u5c31\u662f\u5168\u90e8\uff0c\u8ba9Socket\u53bb\u7ec4\u7ec7\u6570\u636e\uff0c\u4ee5\u7b26\u5408\u6307\u5b9a\u7684\u534f\u8bae\u3002</li> <li>Socket \u8fd8\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u79cd\u7f51\u7edc\u95f4\u4e0d\u540c\u8ba1\u7b97\u673a\u4e0a\u7684 \u8fdb\u7a0b\u901a\u4fe1\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c\u5229\u7528\u4e09\u5143\u7ec4\uff08ip\u5730\u5740\uff0c\u534f\u8bae\uff0c\u7aef\u53e3\uff09\u5c31\u53ef\u4ee5\u552f\u4e00\u6807\u8bc6\u7f51\u7edc\u4e2d\u7684\u8fdb\u7a0b\uff0c\u7f51\u7edc\u4e2d\u7684\u8fdb\u7a0b\u901a\u4fe1\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u6807\u5fd7\u4e0e\u5176\u5b83\u8fdb\u7a0b\u8fdb\u884c\u4ea4\u4e92\u3002</li> <li>Socket \u8d77\u6e90\u4e8e Unix \uff0cUnix/Linux \u57fa\u672c\u54f2\u5b66\u4e4b\u4e00\u5c31\u662f\u201c\u4e00\u5207\u7686\u6587\u4ef6\u201d\uff0c\u90fd\u53ef\u4ee5\u7528\u201c\u6253\u5f00(open) \u2013&gt; \u8bfb\u5199(write/read) \u2013&gt; \u5173\u95ed(close)\u201d\u6a21\u5f0f\u6765\u8fdb\u884c\u64cd\u4f5c\u3002\u56e0\u6b64 Socket \u4e5f\u88ab\u5904\u7406\u4e3a\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\u3002</li> </ul>"},{"location":"basic/net/net/#4112-socket","title":"4.11.2 Socket \u7f16\u7a0b","text":"<p>\u670d\u52a1\u7aef\u7f16\u7a0b</p> <ol> <li>\u521b\u5efa Socket\u3002</li> <li>\u7ed1\u5b9a Socket\u3002</li> <li>\u76d1\u542c Socket\u3002</li> <li>\u63a5\u6536 &amp; \u5904\u7406\u4fe1\u606f\u3002</li> </ol> <p>\u5176\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>import socket\ndef server():\n# 1\u3001\u521b\u5efa Socket\ns = socket.socket()\nhost = \"127.0.0.1\"\nport = 5678\n# 2\u3001\u7ed1\u5b9a Socket\ns.bind(host, port)\n# 3\u3001\u76d1\u542c\ns.listen()\n# 4\u3001\u53d1\u9001\u6570\u636e\nwhile True:\nc, addr = s.accept()\nprint(\"connect addr\", addr)\nc.send(b'Socket Study.')\nc.close()\n</code></pre> <p>\u5ba2\u6237\u7aef\u7f16\u7a0b</p> <ol> <li>\u521b\u5efa Socket\u3002</li> <li>\u8fde\u63a5 Socket\u3002</li> <li>\u53d1\u9001\u6d88\u606f\u3002</li> </ol> <p>\u5176\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>import socket\ndef client(i):\n# 1\u3001\u521b\u5efa Socket\ns = socket.socket()\n# 2\u3001\u8fde\u63a5 Socket\ns.connect(('127.0.0.1', 5678))\n# 3\u3001\u63a5\u6536\u6d88\u606f\nprint(\"Received message:%s, client Id:%d\" % (s.recv(1024), i))\ns.close()\nif __name__ == '__main__':\nfor i in range(10):\nclient(i)\n</code></pre>"},{"location":"basic/net/net/#5-websocket","title":"5. WebSocket","text":""},{"location":"basic/net/net/#51","title":"5.1  \u662f\u4ec0\u4e48","text":"<p>WebSocket\uff0c\u662f\u4e00\u79cd\u7f51\u7edc\u4f20\u8f93\u534f\u8bae\uff0c\u4f4d\u4e8e<code>OSI</code>\u6a21\u578b\u7684\u5e94\u7528\u5c42\u3002\u53ef\u5728\u5355\u4e2a<code>TCP</code>\u8fde\u63a5\u4e0a\u8fdb\u884c\u5168\u53cc\u5de5\u901a\u4fe1\uff0c\u80fd\u66f4\u597d\u7684\u8282\u7701\u670d\u52a1\u5668\u8d44\u6e90\u548c\u5e26\u5bbd\u5e76\u8fbe\u5230\u5b9e\u65f6\u901a\u8fc5</p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53ea\u9700\u8981\u5b8c\u6210\u4e00\u6b21\u63e1\u624b\uff0c\u4e24\u8005\u4e4b\u95f4\u5c31\u53ef\u4ee5\u521b\u5efa\u6301\u4e45\u6027\u7684\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u53cc\u5411\u6570\u636e\u4f20\u8f93</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u89c1\uff0c<code>websocket</code>\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u901a\u8fc7\u63e1\u624b\u8fde\u63a5\uff0c\u8fde\u63a5\u6210\u529f\u540e\uff0c\u4e24\u8005\u90fd\u80fd\u4e3b\u52a8\u7684\u5411\u5bf9\u65b9\u53d1\u9001\u6216\u63a5\u53d7\u6570\u636e</p> <p>\u800c\u5728<code>websocket</code>\u51fa\u73b0\u4e4b\u524d\uff0c\u5f00\u53d1\u5b9e\u65f6<code>web</code>\u5e94\u7528\u7684\u65b9\u5f0f\u4e3a\u8f6e\u8be2</p> <p>\u4e0d\u505c\u5730\u5411\u670d\u52a1\u5668\u53d1\u9001 HTTP \u8bf7\u6c42\uff0c\u95ee\u6709\u6ca1\u6709\u6570\u636e\uff0c\u6709\u6570\u636e\u7684\u8bdd\u670d\u52a1\u5668\u5c31\u7528\u54cd\u5e94\u62a5\u6587\u56de\u5e94\u3002\u5982\u679c\u8f6e\u8be2\u7684\u9891\u7387\u6bd4\u8f83\u9ad8\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8fd1\u4f3c\u5730\u5b9e\u73b0\u201c\u5b9e\u65f6\u901a\u4fe1\u201d\u7684\u6548\u679c</p> <p>\u8f6e\u8be2\u7684\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u53cd\u590d\u53d1\u9001\u65e0\u6548\u67e5\u8be2\u8bf7\u6c42\u8017\u8d39\u4e86\u5927\u91cf\u7684\u5e26\u5bbd\u548c <code>CPU</code>\u8d44\u6e90</p>"},{"location":"basic/net/net/#52","title":"5.2 \u7279\u70b9","text":""},{"location":"basic/net/net/#521","title":"5.2.1 \u5168\u53cc\u5de5","text":"<p>\u901a\u4fe1\u5141\u8bb8\u6570\u636e\u5728\u4e24\u4e2a\u65b9\u5411\u4e0a\u540c\u65f6\u4f20\u8f93\uff0c\u5b83\u5728\u80fd\u529b\u4e0a\u76f8\u5f53\u4e8e\u4e24\u4e2a\u5355\u5de5\u901a\u4fe1\u65b9\u5f0f\u7684\u7ed3\u5408</p> <p>\u4f8b\u5982\u6307 A\u2192B \u7684\u540c\u65f6 B\u2192A \uff0c\u662f\u77ac\u65f6\u540c\u6b65\u7684</p>"},{"location":"basic/net/net/#522","title":"5.2.2 \u4e8c\u8fdb\u5236\u5e27","text":"<p>\u91c7\u7528\u4e86\u4e8c\u8fdb\u5236\u5e27\u7ed3\u6784\uff0c\u8bed\u6cd5\u3001\u8bed\u4e49\u4e0e HTTP \u5b8c\u5168\u4e0d\u517c\u5bb9\uff0c\u76f8\u6bd4<code>http/2</code>\uff0c<code>WebSocket</code>\u66f4\u4fa7\u91cd\u4e8e\u201c\u5b9e\u65f6\u901a\u4fe1\u201d\uff0c\u800c<code>HTTP/2</code> \u66f4\u4fa7\u91cd\u4e8e\u63d0\u9ad8\u4f20\u8f93\u6548\u7387\uff0c\u6240\u4ee5\u4e24\u8005\u7684\u5e27\u7ed3\u6784\u4e5f\u6709\u5f88\u5927\u7684\u533a\u522b</p> <p>\u4e0d\u50cf <code>HTTP/2</code> \u90a3\u6837\u5b9a\u4e49\u6d41\uff0c\u4e5f\u5c31\u4e0d\u5b58\u5728\u591a\u8def\u590d\u7528\u3001\u4f18\u5148\u7ea7\u7b49\u7279\u6027</p> <p>\u81ea\u8eab\u5c31\u662f\u5168\u53cc\u5de5\uff0c\u4e5f\u4e0d\u9700\u8981\u670d\u52a1\u5668\u63a8\u9001</p>"},{"location":"basic/net/net/#523","title":"5.2.3 \u534f\u8bae\u540d","text":"<p>\u5f15\u5165<code>ws</code>\u548c<code>wss</code>\u5206\u522b\u4ee3\u8868\u660e\u6587\u548c\u5bc6\u6587\u7684<code>websocket</code>\u534f\u8bae\uff0c\u4e14\u9ed8\u8ba4\u7aef\u53e3\u4f7f\u752880\u6216443\uff0c\u51e0\u4e4e\u4e0e<code>http</code>\u4e00\u81f4</p> <pre><code>ws://www.chrono.com\nws://www.chrono.com:8080/srv\nwss://www.chrono.com:445/im?user_id=xxx\n</code></pre>"},{"location":"basic/net/net/#524","title":"5.2.4 \u63e1\u624b","text":"<p><code>WebSocket</code>\u4e5f\u8981\u6709\u4e00\u4e2a\u63e1\u624b\u8fc7\u7a0b\uff0c\u7136\u540e\u624d\u80fd\u6b63\u5f0f\u6536\u53d1\u6570\u636e</p> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>GET /chat HTTP/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==\nOrigin: http://example.com\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\n</code></pre> <ul> <li>Connection\uff1a\u5fc5\u987b\u8bbe\u7f6eUpgrade\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u5e0c\u671b\u8fde\u63a5\u5347\u7ea7</li> <li>Upgrade\uff1a\u5fc5\u987b\u8bbe\u7f6eWebsocket\uff0c\u8868\u793a\u5e0c\u671b\u5347\u7ea7\u5230Websocket\u534f\u8bae</li> <li>Sec-WebSocket-Key\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u4e00\u4e2a base64 \u7f16\u7801\u7684\u5bc6\u6587\uff0c\u7528\u4e8e\u7b80\u5355\u7684\u8ba4\u8bc1\u79d8\u94a5\u3002\u8981\u6c42\u670d\u52a1\u7aef\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u5bf9\u5e94\u52a0\u5bc6\u7684\u201cSec-WebSocket-Accept\u5e94\u7b54\uff0c\u5426\u5219\u5ba2\u6237\u7aef\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u5e76\u5173\u95ed\u8fde\u63a5</li> <li>Sec-WebSocket-Version \uff1a\u8868\u793a\u652f\u6301\u7684Websocket\u7248\u672c</li> </ul> <p>\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u6570\u636e\u683c\u5f0f\uff1a</p> <pre><code>HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=Sec-WebSocket-Protocol: chat\n</code></pre> <ul> <li>HTTP/1.1 101 Switching Protocols\uff1a\u8868\u793a\u670d\u52a1\u7aef\u63a5\u53d7 WebSocket \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u8fde\u63a5</li> <li>Sec-WebSocket-Accep\uff1a\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bf7\u6c42\u62a5\u6587\uff0c\u540c\u6837\u4e5f\u662f\u4e3a\u4e86\u9632\u6b62\u8bef\u8fde\u63a5\u3002\u5177\u4f53\u505a\u6cd5\u662f\u628a\u8bf7\u6c42\u5934\u91cc\u201cSec-WebSocket-Key\u201d\u7684\u503c\uff0c\u52a0\u4e0a\u4e00\u4e2a\u4e13\u7528\u7684 UUID\uff0c\u518d\u8ba1\u7b97\u6458\u8981</li> </ul>"},{"location":"basic/net/net/#525","title":"5.2.5 \u4f18\u70b9","text":"<ul> <li>\u8f83\u5c11\u7684\u63a7\u5236\u5f00\u9500\uff1a\u6570\u636e\u5305\u5934\u90e8\u534f\u8bae\u8f83\u5c0f\uff0c\u4e0d\u540c\u4e8ehttp\u6bcf\u6b21\u8bf7\u6c42\u9700\u8981\u643a\u5e26\u5b8c\u6574\u7684\u5934\u90e8</li> <li>\u66f4\u5f3a\u7684\u5b9e\u65f6\u6027\uff1a\u76f8\u5bf9\u4e8eHTTP\u8bf7\u6c42\u9700\u8981\u7b49\u5f85\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u670d\u52a1\u7aef\u624d\u80fd\u54cd\u5e94\uff0c\u5ef6\u8fdf\u660e\u663e\u66f4\u5c11</li> <li>\u4fdd\u6301\u521b\u8fde\u63a5\u72b6\u6001\uff1a\u521b\u5efa\u901a\u4fe1\u540e\uff0c\u53ef\u7701\u7565\u72b6\u6001\u4fe1\u606f\uff0c\u4e0d\u540c\u4e8eHTTP\u6bcf\u6b21\u8bf7\u6c42\u9700\u8981\u643a\u5e26\u8eab\u4efd\u9a8c\u8bc1</li> <li>\u66f4\u597d\u7684\u4e8c\u8fdb\u5236\u652f\u6301\uff1a\u5b9a\u4e49\u4e86\u4e8c\u8fdb\u5236\u5e27\uff0c\u66f4\u597d\u5904\u7406\u4e8c\u8fdb\u5236\u5185\u5bb9</li> <li>\u652f\u6301\u6269\u5c55\uff1a\u7528\u6237\u53ef\u4ee5\u6269\u5c55websocket\u534f\u8bae\u3001\u5b9e\u73b0\u90e8\u5206\u81ea\u5b9a\u4e49\u7684\u5b50\u534f\u8bae</li> <li>\u66f4\u597d\u7684\u538b\u7f29\u6548\u679c\uff1aWebsocket\u5728\u9002\u5f53\u7684\u6269\u5c55\u652f\u6301\u4e0b\uff0c\u53ef\u4ee5\u6cbf\u7528\u4e4b\u524d\u5185\u5bb9\u7684\u4e0a\u4e0b\u6587\uff0c\u5728\u4f20\u9012\u7c7b\u4f3c\u7684\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u663e\u8457\u5730\u63d0\u9ad8\u538b\u7f29\u7387</li> </ul>"},{"location":"basic/net/net/#53","title":"5.3 \u5e94\u7528\u573a\u666f","text":"<p>\u57fa\u4e8e<code>websocket</code>\u7684\u4e8b\u5b9e\u901a\u4fe1\u7684\u7279\u70b9\uff0c\u5176\u5b58\u5728\u7684\u5e94\u7528\u573a\u666f\u5927\u6982\u6709\uff1a</p> <ul> <li>\u5f39\u5e55</li> <li>\u5a92\u4f53\u804a\u5929</li> <li>\u534f\u540c\u7f16\u8f91</li> <li>\u57fa\u4e8e\u4f4d\u7f6e\u7684\u5e94\u7528</li> <li>\u4f53\u80b2\u5b9e\u51b5\u66f4\u65b0</li> <li>\u80a1\u7968\u57fa\u91d1\u62a5\u4ef7\u5b9e\u65f6\u66f4\u65b0</li> </ul>"},{"location":"basic/net/net/#_3","title":"\u53c2\u8003","text":"<p>(\u5efa\u8bae\u6536\u85cf)TCP\u534f\u8bae\u7075\u9b42\u4e4b\u95ee\uff0c\u5de9\u56fa\u4f60\u7684\u7f51\u8def\u5e95\u5c42\u57fa\u7840</p> <p>\uff08\u5efa\u8bae\u7cbe\u8bfb\uff09HTTP\u7075\u9b42\u4e4b\u95ee\uff0c\u5de9\u56fa\u4f60\u7684 HTTP \u77e5\u8bc6\u4f53\u7cfb HTTP\u8be6\u89e3\u4e4bHTTPS</p> <p>TCP\u8be6\u89e3</p> <p>\u8bf4\u8bf4\u5bf9WebSocket\u7684\u7406\u89e3</p>"},{"location":"basic/net/net_opt/","title":"\u7f51\u7edc\u4f18\u5316","text":""},{"location":"basic/system/shell/","title":"shell\u8bed\u6cd5\u6838\u5fc3","text":""},{"location":"basic/system/shell/#1-shell","title":"1. \u4ec0\u4e48\u662fShell","text":"<p>shell\u662f\u5916\u58f3\u7684\u610f\u601d\uff0c\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u5916\u58f3\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7shell\u547d\u4ee4\u6765\u64cd\u4f5c\u548c\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6bd4\u5982Linux\u4e2d\u7684Shell\u547d\u4ee4\u5c31\u5305\u62ecls\u3001cd\u3001pwd\u7b49\u7b49\u3002\u603b\u7ed3\u6765\u8bf4\uff0cShell\u662f\u4e00\u4e2a\u547d\u4ee4\u89e3\u91ca\u5668\uff0c\u5b83\u901a\u8fc7\u63a5\u53d7\u7528\u6237\u8f93\u5165\u7684Shell\u547d\u4ee4\u6765\u542f\u52a8\u3001\u6682\u505c\u3001\u505c\u6b62\u7a0b\u5e8f\u7684\u8fd0\u884c\u6216\u5bf9\u8ba1\u7b97\u673a\u8fdb\u884c\u63a7\u5236\u3002</p> <p>shell \u662f\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u5b83\u8fde\u63a5\u4e86\u7528\u6237\u548c Linux \u5185\u6838\uff0c\u8ba9\u7528\u6237\u80fd\u591f\u66f4\u52a0\u9ad8\u6548\u3001\u5b89\u5168\u3001\u4f4e\u6210\u672c\u5730\u4f7f\u7528 Linux \u5185\u6838\uff0c\u8fd9\u5c31\u662f Shell \u7684\u672c\u8d28\u3002</p> <p>shell \u672c\u8eab\u5e76\u4e0d\u662f\u5185\u6838\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u53ea\u662f\u7ad9\u5728\u5185\u6838\u7684\u57fa\u7840\u4e0a\u7f16\u5199\u7684\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"basic/system/shell/#2-shell","title":"2. shell\u811a\u672c","text":"<p>shell\u811a\u672c\u5c31\u662f\u7531Shell\u547d\u4ee4\u7ec4\u6210\u7684\u6267\u884c\u6587\u4ef6\uff0c\u5c06\u4e00\u4e9b\u547d\u4ee4\u6574\u5408\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u8fdb\u884c\u5904\u7406\u4e1a\u52a1\u903b\u8f91\uff0c\u811a\u672c\u4e0d\u7528\u7f16\u8bd1\u5373\u53ef\u8fd0\u884c\u3002\u5b83\u901a\u8fc7\u89e3\u91ca\u5668\u89e3\u91ca\u8fd0\u884c\uff0c\u6240\u4ee5\u901f\u5ea6\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u6162\u3002</p> <p>shell\u811a\u672c\u4e2d\u6700\u91cd\u8981\u7684\u5c31\u662f\u5bf9shell\u547d\u4ee4\u7684\u4f7f\u7528\u4e0e\u7ec4\u5408\uff0c\u518d\u4f7f\u7528shell\u811a\u672c\u652f\u6301\u7684\u4e00\u4e9b\u8bed\u8a00\u7279\u6027\uff0c\u5b8c\u6210\u60f3\u8981\u7684\u529f\u80fd\u3002</p>"},{"location":"basic/system/shell/#3-shell","title":"3. Shell \u53d8\u91cf","text":""},{"location":"basic/system/shell/#31","title":"3.1 \u53d8\u91cf\u7c7b\u578b","text":"<p>\u8fd0\u884cshell\u65f6\uff0c\u4f1a\u540c\u65f6\u5b58\u5728\u4e09\u79cd\u53d8\u91cf\uff1a</p> <ul> <li>\u5c40\u90e8\u53d8\u91cf \u5c40\u90e8\u53d8\u91cf\u5728\u811a\u672c\u6216\u547d\u4ee4\u4e2d\u5b9a\u4e49\uff0c\u4ec5\u5728\u5f53\u524dshell\u5b9e\u4f8b\u4e2d\u6709\u6548\uff0c\u5176\u4ed6shell\u542f\u52a8\u7684\u7a0b\u5e8f\u4e0d\u80fd\u8bbf\u95ee\u5c40\u90e8\u53d8\u91cf\u3002</li> <li>\u73af\u5883\u53d8\u91cf \u6240\u6709\u7684\u7a0b\u5e8f\uff0c\u5305\u62ecshell\u542f\u52a8\u7684\u7a0b\u5e8f\uff0c\u90fd\u80fd\u8bbf\u95ee\u73af\u5883\u53d8\u91cf\uff0c\u6709\u4e9b\u7a0b\u5e8f\u9700\u8981\u73af\u5883\u53d8\u91cf\u6765\u4fdd\u8bc1\u5176\u6b63\u5e38\u8fd0\u884c\u3002\u5fc5\u8981\u7684\u65f6\u5019shell\u811a\u672c\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\u3002</li> <li>shell\u53d8\u91cf shell\u53d8\u91cf\u662f\u7531shell\u7a0b\u5e8f\u8bbe\u7f6e\u7684\u7279\u6b8a\u53d8\u91cf\u3002shell\u53d8\u91cf\u4e2d\u6709\u4e00\u90e8\u5206\u662f\u73af\u5883\u53d8\u91cf\uff0c\u6709\u4e00\u90e8\u5206\u662f\u5c40\u90e8\u53d8\u91cf\uff0c\u8fd9\u4e9b\u53d8\u91cf\u4fdd\u8bc1\u4e86shell\u7684\u6b63\u5e38\u8fd0\u884c</li> </ul>"},{"location":"basic/system/shell/#32","title":"3.2 \u53d8\u91cf\u64cd\u4f5c","text":"<pre><code># \u5b9a\u4e49\u53d8\u91cf\nname=\"adison\"\n# \u4f7f\u7528\u53d8\u91cf\necho $name\necho ${name}\n# \u53d8\u91cf\u91cd\u65b0\u8d4b\u503c\nname=\"new_test\" # \u5220\u9664\u53d8\u91cf\nunset name\n</code></pre>"},{"location":"basic/system/shell/#33","title":"3.3 \u5b57\u7b26\u4e32\u53d8\u91cf","text":"<pre><code>your_name=\"runoob\"\nstr=\"Hello, I know you are \\\"$your_name\\\"! \\n\"\n# \u5b57\u7b26\u4e32\u62fc\u63a5\ngreeting=\"hello, \"$your_name\" !\"\ngreeting_1=\"hello, ${your_name} !\"\n# \u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\necho ${#your_name} # \u4ece\u5b57\u7b26\u4e32\u7b2c 2 \u4e2a\u5b57\u7b26\u5f00\u59cb\u622a\u53d6 4 \u4e2a\u5b57\u7b26\uff1a\necho ${your_name:1:4} # \u67e5\u627e\u5b57\u7b26 r \u6216 o \u7684\u4f4d\u7f6e(\u54ea\u4e2a\u5b57\u6bcd\u5148\u51fa\u73b0\u5c31\u8ba1\u7b97\u54ea\u4e2a)\uff1a\necho `expr index \"$your_name\" ro` </code></pre>"},{"location":"basic/system/shell/#4-shell","title":"4. Shell \u6570\u7ec4","text":"<p>\u6570\u7ec4\u4e2d\u53ef\u4ee5\u5b58\u653e\u591a\u4e2a\u503c\uff0cBash Shell \u53ea\u652f\u6301\u4e00\u7ef4\u6570\u7ec4\uff08\u4e0d\u652f\u6301\u591a\u7ef4\u6570\u7ec4\uff09</p> <pre><code>my_array=(A B \"C\" D)\n# \u8bfb\u53d6\u6570\u7ec4\necho \"\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e3a: ${my_array[0]}\"\necho \"\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4e3a: ${my_array[1]}\"\necho \"\u7b2c\u4e09\u4e2a\u5143\u7d20\u4e3a: ${my_array[2]}\"\necho \"\u7b2c\u56db\u4e2a\u5143\u7d20\u4e3a: ${my_array[3]}\"\n# \u4f7f\u7528@ \u6216 * \u53ef\u4ee5\u83b7\u53d6\u6570\u7ec4\u4e2d\u7684\u6240\u6709\u5143\u7d20\necho \"\u6570\u7ec4\u7684\u5143\u7d20\u4e3a: ${my_array[*]}\"\necho \"\u6570\u7ec4\u7684\u5143\u7d20\u4e3a: ${my_array[@]}\"\n# \u83b7\u53d6\u6570\u7ec4\u7684\u957f\u5ea6\necho \"\u6570\u7ec4\u5143\u7d20\u4e2a\u6570\u4e3a: ${#my_array[*]}\"\necho \"\u6570\u7ec4\u5143\u7d20\u4e2a\u6570\u4e3a: ${#my_array[@]}\"\n</code></pre>"},{"location":"basic/system/shell/#5-shell","title":"5. Shell \u4f20\u9012\u53c2\u6570","text":"\u53c2\u6570\u5904\u7406 \u8bf4\u660e $n n \u4ee3\u8868\u4e00\u4e2a\u6570\u5b57\uff0c1 \u4e3a\u6267\u884c\u811a\u672c\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c2 \u4e3a\u6267\u884c\u811a\u672c\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u4ee5\u6b64\u7c7b\u63a8\u2026\u2026 $# \u4f20\u9012\u5230\u811a\u672c\u7684\u53c2\u6570\u4e2a\u6570 $* \u4ee5\u4e00\u4e2a\u5355\u5b57\u7b26\u4e32\u663e\u793a\u6240\u6709\u5411\u811a\u672c\u4f20\u9012\u7684\u53c2\u6570\u3002 \u5982\" $* \"\u7528\u300c\"\u300d\u62ec\u8d77\u6765\u7684\u60c5\u51b5\u3001\u4ee5\"$1 $2 \u2026 $n\"\u7684\u5f62\u5f0f\u8f93\u51fa\u6240\u6709\u53c2\u6570\u3002 $$ \u811a\u672c\u8fd0\u884c\u7684\u5f53\u524d\u8fdb\u7a0bID\u53f7 $! \u540e\u53f0\u8fd0\u884c\u7684\u6700\u540e\u4e00\u4e2a\u8fdb\u7a0b\u7684ID\u53f7 $@ \u4e0e$*\u76f8\u540c\uff0c\u4f46\u662f\u4f7f\u7528\u65f6\u52a0\u5f15\u53f7\uff0c\u5e76\u5728\u5f15\u53f7\u4e2d\u8fd4\u56de\u6bcf\u4e2a\u53c2\u6570\u3002 \u5982\"$@\"\u7528\u300c\"\u300d\u62ec\u8d77\u6765\u7684\u60c5\u51b5\u3001\u4ee5\"$1\" \"$2\" \u2026 \"$n\" \u7684\u5f62\u5f0f\u8f93\u51fa\u6240\u6709\u53c2\u6570\u3002 $- \u663e\u793aShell\u4f7f\u7528\u7684\u5f53\u524d\u9009\u9879\u3002 $? \u663e\u793a\u6700\u540e\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u30020\u8868\u793a\u6ca1\u6709\u9519\u8bef\uff0c\u5176\u4ed6\u4efb\u4f55\u503c\u8868\u660e\u6709\u9519\u8bef\u3002 <pre><code>#!/bin/bash\necho \"Shell \u4f20\u9012\u53c2\u6570\u5b9e\u4f8b\uff01\";\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\uff1a$1\";\necho \"\u53c2\u6570\u4e2a\u6570\u4e3a\uff1a$#\";\necho \"\u4f20\u9012\u7684\u53c2\u6570\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u663e\u793a\uff1a$*\";\n</code></pre> <p>\u6267\u884c\u811a\u672c\uff0c\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>$ chmod +x test.sh $ ./test.sh 1 2 3\nShell \u4f20\u9012\u53c2\u6570\u5b9e\u4f8b\uff01\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\uff1a1\n\u53c2\u6570\u4e2a\u6570\u4e3a\uff1a3\n\u4f20\u9012\u7684\u53c2\u6570\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u663e\u793a\uff1a1 2 3\n</code></pre>"},{"location":"basic/system/shell/#6-shell","title":"6. Shell \u57fa\u672c\u8fd0\u7b97\u7b26","text":"<p>\u539f\u751fbash\u4e0d\u652f\u6301\u7b80\u5355\u7684\u6570\u5b66\u8fd0\u7b97\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u4f8b\u5982 awk \u548c expr\uff0cexpr \u6700\u5e38\u7528\u3002</p> <p>expr \u662f\u4e00\u6b3e\u8868\u8fbe\u5f0f\u8ba1\u7b97\u5de5\u5177\uff0c\u4f7f\u7528\u5b83\u80fd\u5b8c\u6210\u8868\u8fbe\u5f0f\u7684\u6c42\u503c\u64cd\u4f5c\u3002</p>"},{"location":"basic/system/shell/#61","title":"6.1 \u901a\u7528\u8fd0\u7b97\u7b26","text":"<p>\u4e0b\u8868\u5217\u51fa\u4e86\u5e38\u7528\u7684\u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26, \u5047\u5b9a\u53d8\u91cf a \u4e3a 10\uff0c\u53d8\u91cf b \u4e3a 20\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b + \u52a0\u6cd5 <code>expr $a + $b</code> \u7ed3\u679c\u4e3a 30\u3002 - \u51cf\u6cd5 <code>expr $a - $b</code> \u7ed3\u679c\u4e3a -10\u3002 * \u4e58\u6cd5 <code>expr $a \\* $b</code> \u7ed3\u679c\u4e3a  200\u3002 / \u9664\u6cd5 <code>expr $b / $a</code> \u7ed3\u679c\u4e3a 2\u3002 % \u53d6\u4f59 <code>expr $b % $a</code> \u7ed3\u679c\u4e3a 0\u3002 = \u8d4b\u503c a=$b \u5c06\u628a\u53d8\u91cf b \u7684\u503c\u8d4b\u7ed9 a\u3002 == \u76f8\u7b49\u3002\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u6570\u5b57\uff0c\u76f8\u540c\u5219\u8fd4\u56de true\u3002 [ $a == $b ] \u8fd4\u56de false\u3002 != \u4e0d\u76f8\u7b49\u3002\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u6570\u5b57\uff0c\u4e0d\u76f8\u540c\u5219\u8fd4\u56de true\u3002 [ $a != $b ] \u8fd4\u56de true\u3002 -eq \u68c0\u6d4b\u4e24\u4e2a\u6570\u662f\u5426\u76f8\u7b49\uff0c\u76f8\u7b49\u8fd4\u56de true\u3002 [ $a -eq $b ] \u8fd4\u56de false\u3002 -ne \u68c0\u6d4b\u4e24\u4e2a\u6570\u662f\u5426\u4e0d\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u8fd4\u56de true\u3002 [$a -ne $b ] \u8fd4\u56de true\u3002 -gt \u68c0\u6d4b\u5de6\u8fb9\u7684\u6570\u662f\u5426\u5927\u4e8e\u53f3\u8fb9\u7684\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ $a -gt $b ] \u8fd4\u56de false\u3002 -lt \u68c0\u6d4b\u5de6\u8fb9\u7684\u6570\u662f\u5426\u5c0f\u4e8e\u53f3\u8fb9\u7684\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ $a -lt $b ] \u8fd4\u56de true\u3002 -ge \u68c0\u6d4b\u5de6\u8fb9\u7684\u6570\u662f\u5426\u5927\u4e8e\u7b49\u4e8e\u53f3\u8fb9\u7684\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ $a -ge $b ] \u8fd4\u56de false\u3002 -le \u68c0\u6d4b\u5de6\u8fb9\u7684\u6570\u662f\u5426\u5c0f\u4e8e\u7b49\u4e8e\u53f3\u8fb9\u7684\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ $a -le $b ] \u8fd4\u56de true\u3002 ! \u975e\u8fd0\u7b97\uff0c\u8868\u8fbe\u5f0f\u4e3a true \u5219\u8fd4\u56de false\uff0c\u5426\u5219\u8fd4\u56de true\u3002 [ ! false ] \u8fd4\u56de true\u3002 -o \u6216\u8fd0\u7b97\uff0c\u6709\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e3a true \u5219\u8fd4\u56de true\u3002 [ $a -lt 20 -o $b -gt 100 ] \u8fd4\u56de true\u3002 -a \u4e0e\u8fd0\u7b97\uff0c\u4e24\u4e2a\u8868\u8fbe\u5f0f\u90fd\u4e3a true \u624d\u8fd4\u56de true\u3002 [ $a -lt 20 -a $b -gt 100 ] \u8fd4\u56de false\u3002 &amp;&amp; \u903b\u8f91\u7684 AND [[ $a -lt 100 &amp;&amp; $b -gt 100 ]] \u8fd4\u56de false || \u903b\u8f91\u7684 OR [[ $a -lt 100 || $b -gt 100 ]] \u8fd4\u56de true <p>\u6ce8\u610f\uff1a\u6761\u4ef6\u8868\u8fbe\u5f0f\u8981\u653e\u5728\u65b9\u62ec\u53f7\u4e4b\u95f4\uff0c\u5e76\u4e14\u8981\u6709\u7a7a\u683c\uff0c\u4f8b\u5982: [$a==$b] \u662f\u9519\u8bef\u7684\uff0c\u5fc5\u987b\u5199\u6210 [ $a == $b ]\u3002</p>"},{"location":"basic/system/shell/#62","title":"6.2 \u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26","text":"<p>\u4e0b\u8868\u5217\u51fa\u4e86\u5e38\u7528\u7684\u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26\uff0c\u5047\u5b9a\u53d8\u91cf a \u4e3a \"abc\"\uff0c\u53d8\u91cf b \u4e3a \"efg\"\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b = \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u76f8\u7b49\u8fd4\u56de true\u3002 [ $a = $b ] \u8fd4\u56de false\u3002 != \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u4e0d\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u8fd4\u56de true\u3002 [ $a != $b ] \u8fd4\u56de true\u3002 -z \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a0\uff0c\u4e3a0\u8fd4\u56de true\u3002 [ -z $a ] \u8fd4\u56de false\u3002 -n \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e0d\u4e3a 0\uff0c\u4e0d\u4e3a 0 \u8fd4\u56de true\u3002 [ -n \"$a\" ] \u8fd4\u56de true\u3002 $ \u68c0\u6d4b\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u7a7a\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [ $a ] \u8fd4\u56de true\u3002"},{"location":"basic/system/shell/#63","title":"6.3 \u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26","text":"<p>\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26\u7528\u4e8e\u68c0\u6d4b Unix \u6587\u4ef6\u7684\u5404\u79cd\u5c5e\u6027\u3002</p> \u64cd\u4f5c\u7b26 \u8bf4\u660e \u4e3e\u4f8b -b file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5757\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -b $file ] \u8fd4\u56de false\u3002 -c file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5b57\u7b26\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -c $file ] \u8fd4\u56de false\u3002 -d file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u76ee\u5f55\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -d $file ] \u8fd4\u56de false\u3002 -f file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u666e\u901a\u6587\u4ef6\uff08\u65e2\u4e0d\u662f\u76ee\u5f55\uff0c\u4e5f\u4e0d\u662f\u8bbe\u5907\u6587\u4ef6\uff09\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -f $file ] \u8fd4\u56de true\u3002 -g file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SGID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -g $file ] \u8fd4\u56de false\u3002 -k file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86\u7c98\u7740\u4f4d(Sticky Bit)\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -k $file ] \u8fd4\u56de false\u3002 -p file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u6709\u540d\u7ba1\u9053\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -p $file ] \u8fd4\u56de false\u3002 -u file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SUID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -u $file ] \u8fd4\u56de false\u3002 -r file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u8bfb\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -r $file ] \u8fd4\u56de true\u3002 -w file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u5199\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -w $file ] \u8fd4\u56de true\u3002 -x file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u6267\u884c\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -x $file ] \u8fd4\u56de true\u3002 -s file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u4e3a\u7a7a\uff08\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e0\uff09\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [ -s $file ] \u8fd4\u56de true\u3002 -e file \u68c0\u6d4b\u6587\u4ef6\uff08\u5305\u62ec\u76ee\u5f55\uff09\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [ -e $file ] \u8fd4\u56de true\u3002"},{"location":"basic/system/shell/#7-shell-echo","title":"7. Shell echo\u547d\u4ee4","text":"<pre><code>echo \"It is a test\"\n# \u663e\u793a\u8f6c\u4e49\u5b57\u7b26\necho \"\\\"It is a test\\\"\"\necho -e \"OK! \\n\" # -e \u5f00\u542f\u8f6c\u4e49\n# \u663e\u793a\u7ed3\u679c\u5b9a\u5411\u81f3\u6587\u4ef6\necho \"It is a test\" &gt; myfile\n\n# \u539f\u6837\u8f93\u51fa\u5b57\u7b26\u4e32\uff0c\u4e0d\u8fdb\u884c\u8f6c\u4e49\u6216\u53d6\u53d8\u91cf(\u7528\u5355\u5f15\u53f7)\necho '$name\\\"'\n# \u663e\u793a\u547d\u4ee4\u6267\u884c\u7ed3\u679c\necho `date`\n</code></pre>"},{"location":"basic/system/shell/#8-shell","title":"8. Shell \u6d41\u7a0b\u63a7\u5236","text":""},{"location":"basic/system/shell/#81-if-else","title":"8.1 if else","text":"<pre><code>a=10\nb=20\nif [ $a == $b ]\nthen\necho \"a \u7b49\u4e8e b\"\nelif [ $a -gt $b ]\nthen\necho \"a \u5927\u4e8e b\"\nelif [ $a -lt $b ]\nthen\necho \"a \u5c0f\u4e8e b\"\nelse\necho \"\u6ca1\u6709\u7b26\u5408\u7684\u6761\u4ef6\"\nfi\n# \u8f93\u51fa\na \u5c0f\u4e8e b\n</code></pre>"},{"location":"basic/system/shell/#82-for","title":"8.2 for \u5faa\u73af","text":"<pre><code>for loop in 1 2 3 4 5\ndo\necho \"The value is: $loop\"\ndone\n#\u8f93\u51fa\nThe value is: 1\nThe value is: 2\nThe value is: 3\nThe value is: 4\nThe value is: 5\n</code></pre>"},{"location":"basic/system/shell/#83-while","title":"8.3 while \u8bed\u53e5","text":"<pre><code>#!/bin/bash\n# \u8fd4\u56de\u6570\u5b57 1 \u5230 5\uff0c\u7136\u540e\u7ec8\u6b62\nint=1\nwhile(( $int&lt;=5 ))\ndo\necho $int\nlet \"int++\"\ndone\n</code></pre> <p>\u4ee5\u4e0a\u5b9e\u4f8b\u4f7f\u7528\u4e86 Bash let \u547d\u4ee4\uff0c\u5b83\u7528\u4e8e\u6267\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u8868\u8fbe\u5f0f\uff0c\u53d8\u91cf\u8ba1\u7b97\u4e2d\u4e0d\u9700\u8981\u52a0\u4e0a $ \u6765\u8868\u793a\u53d8\u91cf</p>"},{"location":"basic/system/shell/#84-until","title":"8.4 until \u5faa\u73af","text":"<pre><code>#!/bin/bash\n#\u8f93\u51fa 0 ~ 9 \u7684\u6570\u5b57\uff1a\na=0\nuntil [ ! $a -lt 10 ]\ndo\necho $a\na=`expr $a + 1`\ndone\n</code></pre>"},{"location":"basic/system/shell/#9-shell","title":"9. Shell \u51fd\u6570","text":"<pre><code>funWithParam(){\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a $1 !\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a $2 !\"\necho \"\u7b2c\u5341\u4e2a\u53c2\u6570\u4e3a $10 !\"\necho \"\u7b2c\u5341\u4e2a\u53c2\u6570\u4e3a ${10} !\"\necho \"\u7b2c\u5341\u4e00\u4e2a\u53c2\u6570\u4e3a ${11} !\"\necho \"\u53c2\u6570\u603b\u6570\u6709 $# \u4e2a!\"\necho \"\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u8f93\u51fa\u6240\u6709\u53c2\u6570 $* !\"\nreturn 255\n}\nfunWithParam 1 2 3 4 5 6 7 8 9 34 73\n# \u8f93\u51fa\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a 1 !\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a 2 !\n\u7b2c\u5341\u4e2a\u53c2\u6570\u4e3a 10 !\n\u7b2c\u5341\u4e2a\u53c2\u6570\u4e3a 34 !\n\u7b2c\u5341\u4e00\u4e2a\u53c2\u6570\u4e3a 73 !\n\u53c2\u6570\u603b\u6570\u6709 11 \u4e2a!\n\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u8f93\u51fa\u6240\u6709\u53c2\u6570 1 2 3 4 5 6 7 8 9 34 73 !\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <ol> <li> <p>return \u8fd4\u56de\uff0c\u5982\u679c\u4e0d\u52a0\uff0c\u5c06\u4ee5\u6700\u540e\u4e00\u6761\u547d\u4ee4\u8fd0\u884c\u7ed3\u679c\uff0c\u4f5c\u4e3a\u8fd4\u56de\u503c\u3002 return\u540e\u8ddf\u6570\u503cn(0-255</p> </li> <li> <p>\u5728\u51fd\u6570\u4f53\u5185\u90e8\uff0c\u901a\u8fc7 $n \u7684\u5f62\u5f0f\u6765\u83b7\u53d6\u53c2\u6570\u7684\u503c\uff0c\u4f8b\u5982\uff0c$1\u8868\u793a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c$2\u8868\u793a\u7b2c\u4e8c\u4e2a\u53c2\u6570...</p> </li> <li> <p>$10 \u4e0d\u80fd\u83b7\u53d6\u7b2c\u5341\u4e2a\u53c2\u6570\uff0c\u83b7\u53d6\u7b2c\u5341\u4e2a\u53c2\u6570\u9700\u8981${10}\u3002\u5f53n&gt;=10\u65f6\uff0c\u9700\u8981\u4f7f\u7528${n}\u6765\u83b7\u53d6\u53c2\u6570\u3002</p> </li> </ol> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u51e0\u4e2a\u7279\u6b8a\u5b57\u7b26\u7528\u6765\u5904\u7406\u53c2\u6570\uff1a</p> \u53c2\u6570\u5904\u7406 \u8bf4\u660e $# \u4f20\u9012\u5230\u811a\u672c\u6216\u51fd\u6570\u7684\u53c2\u6570\u4e2a\u6570 $* \u4ee5\u4e00\u4e2a\u5355\u5b57\u7b26\u4e32\u663e\u793a\u6240\u6709\u5411\u811a\u672c\u4f20\u9012\u7684\u53c2\u6570 $$ \u811a\u672c\u8fd0\u884c\u7684\u5f53\u524d\u8fdb\u7a0bID\u53f7 $! \u540e\u53f0\u8fd0\u884c\u7684\u6700\u540e\u4e00\u4e2a\u8fdb\u7a0b\u7684ID\u53f7 $@ \u4e0e$*\u76f8\u540c\uff0c\u4f46\u662f\u4f7f\u7528\u65f6\u52a0\u5f15\u53f7\uff0c\u5e76\u5728\u5f15\u53f7\u4e2d\u8fd4\u56de\u6bcf\u4e2a\u53c2\u6570\u3002 $- \u663e\u793aShell\u4f7f\u7528\u7684\u5f53\u524d\u9009\u9879\uff0c\u4e0eset\u547d\u4ee4\u529f\u80fd\u76f8\u540c\u3002 $? \u663e\u793a\u6700\u540e\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u30020\u8868\u793a\u6ca1\u6709\u9519\u8bef\uff0c\u5176\u4ed6\u4efb\u4f55\u503c\u8868\u660e\u6709\u9519\u8bef\u3002"},{"location":"basic/system/shell/#10-shell-test","title":"10. Shell test \u547d\u4ee4","text":"<p>Shell\u4e2d\u7684 test \u547d\u4ee4\u7528\u4e8e\u68c0\u67e5\u67d0\u4e2a\u6761\u4ef6\u662f\u5426\u6210\u7acb\uff0c\u5b83\u53ef\u4ee5\u8fdb\u884c\u6570\u503c\u3001\u5b57\u7b26\u548c\u6587\u4ef6\u4e09\u4e2a\u65b9\u9762\u7684\u6d4b\u8bd5\u3002</p> <pre><code>num1=100\nnum2=100\nif test $[num1] -eq $[num2]\nthen\necho '\u4e24\u4e2a\u6570\u76f8\u7b49\uff01'\nelse\necho '\u4e24\u4e2a\u6570\u4e0d\u76f8\u7b49\uff01'\nfi\n</code></pre>"},{"location":"basic/system/shell/#11-shell","title":"11 .Shell \u8f93\u5165/\u8f93\u51fa\u91cd\u5b9a\u5411","text":""},{"location":"basic/system/shell/#111","title":"11.1  \u91cd\u5b9a\u5411\u547d\u4ee4","text":"\u547d\u4ee4 \u8bf4\u660e command &gt; file \u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230 file\u3002 command &lt; file \u5c06\u8f93\u5165\u91cd\u5b9a\u5411\u5230 file\u3002 command &gt;&gt; file \u5c06\u8f93\u51fa\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u91cd\u5b9a\u5411\u5230 file\u3002 n &gt; file \u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a n \u7684\u6587\u4ef6\u91cd\u5b9a\u5411\u5230 file\u3002 n &gt;&gt; file \u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a n \u7684\u6587\u4ef6\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u91cd\u5b9a\u5411\u5230 file\u3002 n &gt;&amp; m \u5c06\u8f93\u51fa\u6587\u4ef6 m \u548c n \u5408\u5e76\u3002 n &lt;&amp; m \u5c06\u8f93\u5165\u6587\u4ef6 m \u548c n \u5408\u5e76\u3002 &lt;&lt; tag \u5c06\u5f00\u59cb\u6807\u8bb0 tag \u548c\u7ed3\u675f\u6807\u8bb0 tag \u4e4b\u95f4\u7684\u5185\u5bb9\u4f5c\u4e3a\u8f93\u5165\u3002 <p>\u6ce8\u610f</p> <p>\u6587\u4ef6\u63cf\u8ff0\u7b26 0 \u901a\u5e38\u662f\u6807\u51c6\u8f93\u5165\uff08STDIN\uff09\uff0c1 \u662f\u6807\u51c6\u8f93\u51fa\uff08STDOUT\uff09\uff0c2 \u662f\u6807\u51c6\u9519\u8bef\u8f93\u51fa\uff08STDERR\uff09\u3002</p> <pre><code># \u5c06 stdout \u548c stderr \u5408\u5e76\u540e\u91cd\u5b9a\u5411\u5230 file\n$ command &gt; file 2&gt;&amp;1\n\u6216\u8005\n\n$ command &gt;&gt; file 2&gt;&amp;1\n</code></pre>"},{"location":"basic/system/shell/#112-devnull","title":"11.2  /dev/null \u6587\u4ef6","text":"<p>\u5982\u679c\u5e0c\u671b\u6267\u884c\u67d0\u4e2a\u547d\u4ee4\uff0c\u4f46\u53c8\u4e0d\u5e0c\u671b\u5728\u5c4f\u5e55\u4e0a\u663e\u793a\u8f93\u51fa\u7ed3\u679c\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230 /dev/null\uff1a</p> <pre><code>$ command &gt; /dev/null\n</code></pre> <p>/dev/null \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u5199\u5165\u5230\u5b83\u7684\u5185\u5bb9\u90fd\u4f1a\u88ab\u4e22\u5f03\uff1b\u5982\u679c\u5c1d\u8bd5\u4ece\u8be5\u6587\u4ef6\u8bfb\u53d6\u5185\u5bb9\uff0c\u90a3\u4e48\u4ec0\u4e48\u4e5f\u8bfb\u4e0d\u5230\u3002\u4f46\u662f /dev/null \u6587\u4ef6\u975e\u5e38\u6709\u7528\uff0c\u5c06\u547d\u4ee4\u7684\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u5b83\uff0c\u4f1a\u8d77\u5230**\"\u7981\u6b62\u8f93\u51fa\"**\u7684\u6548\u679c\u3002</p> <p>\u5982\u679c\u5e0c\u671b\u5c4f\u853d stdout \u548c stderr\uff0c\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a</p> <pre><code>$ command &gt; /dev/null 2&gt;&amp;1\n</code></pre>"},{"location":"basic/system/shell/#12-shell","title":"12 Shell \u6587\u4ef6\u5305\u542b","text":"<p>\u521b\u5efa\u4e24\u4e2a shell \u811a\u672c\u6587\u4ef6\u3002</p> <p>test1.sh \u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#!/bin/bash\nurl=\"http://www.baidu.com\"\n</code></pre> <p>test2.sh \u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#!/bin/bash\n#\u4f7f\u7528 . \u53f7\u6216\u8005source\u6765\u5f15\u7528test1.sh \u6587\u4ef6\n. ./test1.sh\n\n# \u6216\u8005\u4f7f\u7528\u4ee5\u4e0b\u5305\u542b\u6587\u4ef6\u4ee3\u7801\n# source ./test1.sh\necho \"\u767e\u5ea6\u5730\u5740\uff1a$url\"\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4e3a test2.sh \u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\u5e76\u6267\u884c\uff1a</p> <pre><code>$ chmod +x test2.sh $ ./test2.sh #\u8f93\u51fa\n\u767e\u5ea6\u5730\u5740\uff1ahttp://www.baidu.com\n</code></pre>"},{"location":"design/","title":"\u8bbe\u8ba1 &amp; \u67b6\u6784","text":""},{"location":"design/design-patterns/Design%20Principles/","title":"\u516d\u5927\u8bbe\u8ba1\u539f\u5219","text":""},{"location":"design/design-patterns/Design%20Principles/#1","title":"1 . \u5355\u4e00\u804c\u8d23\u539f\u5219","text":"<p>\u5355\u4e00\u804c\u8d23\u539f\u5219\uff08Single Responsibility Principle\uff0cSRP\uff09\u53c8\u79f0\u5355\u4e00\u529f\u80fd\u539f\u5219\u3002\u8fd9\u91cc\u7684\u804c\u8d23\u662f\u6307\u7c7b\u53d8\u5316\u7684\u539f\u56e0\uff0c\u5355\u4e00\u804c\u8d23\u539f\u5219\u89c4\u5b9a\u4e00\u4e2a\u7c7b\u5e94\u8be5\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u5f15\u8d77\u5b83\u53d8\u5316\u7684\u539f\u56e0\uff0c\u5426\u5219\u7c7b\u5e94\u8be5\u88ab\u62c6\u5206\uff08There should never be more than one reason for a class to change\uff09\u3002</p> <p>\u8be5\u539f\u5219\u63d0\u51fa\u5bf9\u8c61\u4e0d\u5e94\u8be5\u627f\u62c5\u592a\u591a\u804c\u8d23\uff0c\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u627f\u62c5\u4e86\u592a\u591a\u7684\u804c\u8d23\uff0c\u81f3\u5c11\u5b58\u5728\u4ee5\u4e0b\u4e24\u4e2a\u7f3a\u70b9\uff1a</p> <ol> <li>\u4e00\u4e2a\u804c\u8d23\u7684\u53d8\u5316\u53ef\u80fd\u4f1a\u524a\u5f31\u6216\u8005\u6291\u5236\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u5176\u4ed6\u804c\u8d23\u7684\u80fd\u529b\uff1b</li> <li>\u5f53\u5ba2\u6237\u7aef\u9700\u8981\u8be5\u5bf9\u8c61\u7684\u67d0\u4e00\u4e2a\u804c\u8d23\u65f6\uff0c\u4e0d\u5f97\u4e0d\u5c06\u5176\u4ed6\u4e0d\u9700\u8981\u7684\u804c\u8d23\u5168\u90fd\u5305\u542b\u8fdb\u6765\uff0c\u4ece\u800c\u9020\u6210\u5197\u4f59\u4ee3\u7801\u6216\u4ee3\u7801\u7684\u6d6a\u8d39\u3002</li> </ol>"},{"location":"design/design-patterns/Design%20Principles/#11","title":"1.1.\u4f18\u70b9","text":"<p>\u5355\u4e00\u804c\u8d23\u539f\u5219\u7684\u6838\u5fc3\u5c31\u662f\u63a7\u5236\u7c7b\u7684\u7c92\u5ea6\u5927\u5c0f\u3001\u5c06\u5bf9\u8c61\u89e3\u8026\u3001\u63d0\u9ad8\u5176\u5185\u805a\u6027\u3002\u5982\u679c\u9075\u5faa\u5355\u4e00\u804c\u8d23\u539f\u5219\u5c06\u6709\u4ee5\u4e0b\u4f18\u70b9\u3002</p> <ul> <li>\u964d\u4f4e\u7c7b\u7684\u590d\u6742\u5ea6\u3002\u4e00\u4e2a\u7c7b\u53ea\u8d1f\u8d23\u4e00\u9879\u804c\u8d23\uff0c\u5176\u903b\u8f91\u80af\u5b9a\u8981\u6bd4\u8d1f\u8d23\u591a\u9879\u804c\u8d23\u7b80\u5355\u5f97\u591a\u3002</li> <li>\u63d0\u9ad8\u7c7b\u7684\u53ef\u8bfb\u6027\u3002\u590d\u6742\u6027\u964d\u4f4e\uff0c\u81ea\u7136\u5176\u53ef\u8bfb\u6027\u4f1a\u63d0\u9ad8\u3002</li> <li>\u63d0\u9ad8\u7cfb\u7edf\u7684\u53ef\u7ef4\u62a4\u6027\u3002\u53ef\u8bfb\u6027\u63d0\u9ad8\uff0c\u90a3\u81ea\u7136\u66f4\u5bb9\u6613\u7ef4\u62a4\u4e86\u3002</li> <li>\u53d8\u66f4\u5f15\u8d77\u7684\u98ce\u9669\u964d\u4f4e\u3002\u53d8\u66f4\u662f\u5fc5\u7136\u7684\uff0c\u5982\u679c\u5355\u4e00\u804c\u8d23\u539f\u5219\u9075\u5b88\u5f97\u597d\uff0c\u5f53\u4fee\u6539\u4e00\u4e2a\u529f\u80fd\u65f6\uff0c\u53ef\u4ee5\u663e\u8457\u964d\u4f4e\u5bf9\u5176\u4ed6\u529f\u80fd\u7684\u5f71\u54cd\u3002</li> </ul>"},{"location":"design/design-patterns/Design%20Principles/#2","title":"2. \u5f00\u95ed\u539f\u5219","text":"<p>\u8f6f\u4ef6\u4e2d\u7684\u5bf9\u8c61(\u7c7b\u3001\u6a21\u5757\u3001\u51fd\u6570\u7b49)\u5bf9\u6269\u5c55\u662f\u5f00\u653e\u7684\uff0c\u5bf9\u4fee\u6539\u662f\u5c01\u95ed\u7684\u3002 \u5f53\u7136\uff0c\u8fd9\u53ea\u662f\u7406\u60f3\u5316\u7684\u613f\u666f\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4fee\u6539\u539f\u6709\u4ee3\u7801\u3001\u6269\u5c55\u4ee3\u7801\u5f80\u5f80\u662f\u540c\u65f6\u5b58\u5728\u7684\u3002</p>"},{"location":"design/design-patterns/Design%20Principles/#21","title":"2.1.\u5b9e\u73b0\u65b9\u6cd5","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u201c\u62bd\u8c61\u7ea6\u675f\u3001\u5c01\u88c5\u53d8\u5316\u201d\u6765\u5b9e\u73b0\u5f00\u95ed\u539f\u5219\uff0c\u5373\u901a\u8fc7\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\u4e3a\u8f6f\u4ef6\u5b9e\u4f53\u5b9a\u4e49\u4e00\u4e2a\u76f8\u5bf9\u7a33\u5b9a\u7684\u62bd\u8c61\u5c42\uff0c\u800c\u5c06\u76f8\u540c\u7684\u53ef\u53d8\u56e0\u7d20\u5c01\u88c5\u5728\u76f8\u540c\u7684\u5177\u4f53\u5b9e\u73b0\u7c7b\u4e2d\u3002</p> <p>\u56e0\u4e3a\u62bd\u8c61\u7075\u6d3b\u6027\u597d\uff0c\u9002\u5e94\u6027\u5e7f\uff0c\u53ea\u8981\u62bd\u8c61\u7684\u5408\u7406\uff0c\u53ef\u4ee5\u57fa\u672c\u4fdd\u6301\u8f6f\u4ef6\u67b6\u6784\u7684\u7a33\u5b9a\u3002\u800c\u8f6f\u4ef6\u4e2d\u6613\u53d8\u7684\u7ec6\u8282\u53ef\u4ee5\u4ece\u62bd\u8c61\u6d3e\u751f\u6765\u7684\u5b9e\u73b0\u7c7b\u6765\u8fdb\u884c\u6269\u5c55\uff0c\u5f53\u8f6f\u4ef6\u9700\u8981\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u53ea\u9700\u8981\u6839\u636e\u9700\u6c42\u91cd\u65b0\u6d3e\u751f\u4e00\u4e2a\u5b9e\u73b0\u7c7b\u6765\u6269\u5c55\u5c31\u53ef\u4ee5\u4e86\u3002</p>"},{"location":"design/design-patterns/Design%20Principles/#3","title":"3. \u91cc\u6c0f\u66ff\u6362\u539f\u5219","text":"<p>\u6240\u6709\u4f7f\u7528\u57fa\u7c7b\u7684\u5730\u65b9\u5fc5\u987b\u80fd\u900f\u660e\u5730\u4f7f\u7528\u5176\u5b50\u7c7b\u7684\u5bf9\u8c61\u3002\u901a\u4fd7\u6765\u8bb2\u5c31\u662f\uff1a\u5b50\u7c7b\u53ef\u4ee5\u6269\u5c55\u7236\u7c7b\u7684\u529f\u80fd\uff0c\u4f46\u4e0d\u80fd\u6539\u53d8\u7236\u7c7b\u539f\u6709\u7684\u529f\u80fd\u3002\u4e5f\u5c31\u662f\u8bf4\uff1a\u5b50\u7c7b\u7ee7\u627f\u7236\u7c7b\u65f6\uff0c\u9664\u6dfb\u52a0\u65b0\u7684\u65b9\u6cd5\u5b8c\u6210\u65b0\u589e\u529f\u80fd\u5916\uff0c\u5c3d\u91cf\u4e0d\u8981\u91cd\u5199\u7236\u7c7b\u7684\u65b9\u6cd5\u3002\u91cc\u6c0f\u66ff\u6362\u539f\u662f\u7ee7\u627f\u590d\u7528\u7684\u57fa\u7840\uff0c\u5b83\u53cd\u6620\u4e86\u57fa\u7c7b\u4e0e\u5b50\u7c7b\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u662f\u5bf9\u5f00\u95ed\u539f\u5219\u7684\u8865\u5145\uff0c\u662f\u5bf9\u5b9e\u73b0\u62bd\u8c61\u5316\u7684\u5177\u4f53\u6b65\u9aa4\u7684\u89c4\u8303\u3002</p> <p>\u6839\u636e\u4e0a\u8ff0\u7406\u89e3\uff0c\u5bf9\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u7684\u5b9a\u4e49\u53ef\u4ee5\u603b\u7ed3\u5982\u4e0b\uff1a</p> <ul> <li>\u5b50\u7c7b\u53ef\u4ee5\u5b9e\u73b0\u7236\u7c7b\u7684\u62bd\u8c61\u65b9\u6cd5\uff0c\u4f46\u4e0d\u80fd\u8986\u76d6\u7236\u7c7b\u7684\u975e\u62bd\u8c61\u65b9\u6cd5</li> <li>\u5b50\u7c7b\u4e2d\u53ef\u4ee5\u589e\u52a0\u81ea\u5df1\u7279\u6709\u7684\u65b9\u6cd5</li> <li>\u5f53\u5b50\u7c7b\u7684\u65b9\u6cd5\u91cd\u8f7d\u7236\u7c7b\u7684\u65b9\u6cd5\u65f6\uff0c\u65b9\u6cd5\u7684\u524d\u7f6e\u6761\u4ef6\uff08\u5373\u65b9\u6cd5\u7684\u8f93\u5165\u53c2\u6570\uff09\u8981\u6bd4\u7236\u7c7b\u7684\u65b9\u6cd5\u66f4\u5bbd\u677e</li> <li>\u5f53\u5b50\u7c7b\u7684\u65b9\u6cd5\u5b9e\u73b0\u7236\u7c7b\u7684\u65b9\u6cd5\u65f6\uff08\u91cd\u5199/\u91cd\u8f7d\u6216\u5b9e\u73b0\u62bd\u8c61\u65b9\u6cd5\uff09\uff0c\u65b9\u6cd5\u7684\u540e\u7f6e\u6761\u4ef6\uff08\u5373\u65b9\u6cd5\u7684\u7684\u8f93\u51fa/\u8fd4\u56de\u503c\uff09\u8981\u6bd4\u7236\u7c7b\u7684\u65b9\u6cd5\u66f4\u4e25\u683c\u6216\u76f8\u7b49</li> </ul> <p>\u901a\u8fc7\u91cd\u5199\u7236\u7c7b\u7684\u65b9\u6cd5\u6765\u5b8c\u6210\u65b0\u7684\u529f\u80fd\u5199\u8d77\u6765\u867d\u7136\u7b80\u5355\uff0c\u4f46\u662f\u6574\u4e2a\u7ee7\u627f\u4f53\u7cfb\u7684\u53ef\u590d\u7528\u6027\u4f1a\u6bd4\u8f83\u5dee\uff0c\u7279\u522b\u662f\u8fd0\u7528\u591a\u6001\u6bd4\u8f83\u9891\u7e41\u65f6\uff0c\u7a0b\u5e8f\u8fd0\u884c\u51fa\u9519\u7684\u6982\u7387\u4f1a\u975e\u5e38\u5927\u3002</p> <p>\u5982\u679c\u7a0b\u5e8f\u8fdd\u80cc\u4e86\u91cc\u6c0f\u66ff\u6362\u539f\u5219\uff0c\u5219\u7ee7\u627f\u7c7b\u7684\u5bf9\u8c61\u5728\u57fa\u7c7b\u51fa\u73b0\u7684\u5730\u65b9\u4f1a\u51fa\u73b0\u8fd0\u884c\u9519\u8bef\u3002</p> <p>\u8fd9\u65f6\u5176\u4fee\u6b63\u65b9\u6cd5\u662f\uff1a\u53d6\u6d88\u539f\u6765\u7684\u7ee7\u627f\u5173\u7cfb\uff0c\u91cd\u65b0\u8bbe\u8ba1\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p> <p>\u5173\u4e8e\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u7684\u4f8b\u5b50\uff0c\u6700\u6709\u540d\u7684\u662f\u201c\u6b63\u65b9\u5f62\u4e0d\u662f\u957f\u65b9\u5f62\u201d\u3002\u5f53\u7136\uff0c\u751f\u6d3b\u4e2d\u4e5f\u6709\u5f88\u591a\u7c7b\u4f3c\u7684\u4f8b\u5b50\uff0c\u4f8b\u5982\uff0c\u4f01\u9e45\u3001\u9e35\u9e1f\u548c\u51e0\u7ef4\u9e1f\u4ece\u751f\u7269\u5b66\u7684\u89d2\u5ea6\u6765\u5212\u5206\uff0c\u5b83\u4eec\u5c5e\u4e8e\u9e1f\u7c7b\uff1b\u4f46\u4ece\u7c7b\u7684\u7ee7\u627f\u5173\u7cfb\u6765\u770b\uff0c\u7531\u4e8e\u5b83\u4eec\u4e0d\u80fd\u7ee7\u627f\u201c\u9e1f\u201d\u4f1a\u98de\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u5b83\u4eec\u4e0d\u80fd\u5b9a\u4e49\u6210\u201c\u9e1f\u201d\u7684\u5b50\u7c7b\u3002\u540c\u6837\uff0c\u7531\u4e8e\u201c\u6c14\u7403\u9c7c\u201d\u4e0d\u4f1a\u6e38\u6cf3\uff0c\u6240\u4ee5\u4e0d\u80fd\u5b9a\u4e49\u6210\u201c\u9c7c\u201d\u7684\u5b50\u7c7b\uff1b\u201c\u73a9\u5177\u70ae\u201d\u70b8\u4e0d\u4e86\u654c\u4eba\uff0c\u6240\u4ee5\u4e0d\u80fd\u5b9a\u4e49\u6210\u201c\u70ae\u201d\u7684\u5b50\u7c7b\u7b49\u3002</p> <p>\u5bf9\u4e8e\u6b63\u65b9\u5f62\u548c\u957f\u65b9\u5f62\u6700\u597d\u7684\u505a\u6cd5\u662f\u518d\u6dfb\u52a0\u4e00\u4e2a\u7236\u7c7b\uff0c\u4ed6\u4eec\u540c\u65f6\u7ee7\u627f\u81ea\u8fd9\u4e2a\u7236\u7c7b\u3002</p>"},{"location":"design/design-patterns/Design%20Principles/#31","title":"3.1.\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u7684\u4f5c\u7528","text":"<p>\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u7684\u4e3b\u8981\u4f5c\u7528\u5982\u4e0b\u3002</p> <ol> <li>\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u662f\u5b9e\u73b0\u5f00\u95ed\u539f\u5219\u7684\u91cd\u8981\u65b9\u5f0f\u4e4b\u4e00\u3002</li> <li>\u5b83\u514b\u670d\u4e86\u7ee7\u627f\u4e2d\u91cd\u5199\u7236\u7c7b\u9020\u6210\u7684\u53ef\u590d\u7528\u6027\u53d8\u5dee\u7684\u7f3a\u70b9\u3002</li> <li>\u5b83\u662f\u52a8\u4f5c\u6b63\u786e\u6027\u7684\u4fdd\u8bc1\u3002\u5373\u7c7b\u7684\u6269\u5c55\u4e0d\u4f1a\u7ed9\u5df2\u6709\u7684\u7cfb\u7edf\u5f15\u5165\u65b0\u7684\u9519\u8bef\uff0c\u964d\u4f4e\u4e86\u4ee3\u7801\u51fa\u9519\u7684\u53ef\u80fd\u6027\u3002</li> <li>\u52a0\u5f3a\u7a0b\u5e8f\u7684\u5065\u58ee\u6027\uff0c\u540c\u65f6\u53d8\u66f4\u65f6\u53ef\u4ee5\u505a\u5230\u975e\u5e38\u597d\u7684\u517c\u5bb9\u6027\uff0c\u63d0\u9ad8\u7a0b\u5e8f\u7684\u7ef4\u62a4\u6027\u3001\u53ef\u6269\u5c55\u6027\uff0c\u964d\u4f4e\u9700\u6c42\u53d8\u66f4\u65f6\u5f15\u5165\u7684\u98ce\u9669\u3002</li> </ol>"},{"location":"design/design-patterns/Design%20Principles/#4","title":"4. \u4f9d\u8d56\u5012\u8f6c\u539f\u5219","text":"<p>\u4f9d\u8d56\u5012\u8f6c\u539f\u5219(Dependence Inversion Principle, DIP)\uff1a\u662f\u6307\u4e00\u79cd\u7279\u5b9a\u7684\u89e3\u8026\uff08\u4f20\u7edf\u7684\u4f9d\u8d56\u5173\u7cfb\u5efa\u7acb\u5728\u9ad8\u5c42\u6b21\u4e0a\uff0c\u800c\u5177\u4f53\u7684\u7b56\u7565\u8bbe\u7f6e\u5219\u5e94\u7528\u5728\u4f4e\u5c42\u6b21\u7684\u6a21\u5757\u4e0a\uff09\u5f62\u5f0f\uff0c\u4f7f\u5f97\u9ad8\u5c42\u6b21\u7684\u6a21\u5757\u4e0d\u4f9d\u8d56\u4e8e\u4f4e\u5c42\u6b21\u7684\u6a21\u5757\u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u4f9d\u8d56\u5173\u7cfb\u88ab\u98a0\u5012\uff08\u53cd\u8f6c\uff09\uff0c\u4ece\u800c\u4f7f\u5f97\u4f4e\u5c42\u6b21\u6a21\u5757\u4f9d\u8d56\u4e8e\u9ad8\u5c42\u6b21\u6a21\u5757\u7684\u9700\u6c42\u62bd\u8c61\u3002</p> <ol> <li>\u9ad8\u5c42\u6b21\u7684\u6a21\u5757\u4e0d\u5e94\u8be5\u4f9d\u8d56\u4e8e\u4f4e\u5c42\u6b21\u7684\u6a21\u5757\uff0c\u4e24\u8005\u90fd\u5e94\u8be5\u4f9d\u8d56\u4e8e\u62bd\u8c61\u63a5\u53e3\u3002</li> <li>\u62bd\u8c61\u63a5\u53e3\u4e0d\u5e94\u8be5\u4f9d\u8d56\u4e8e\u5177\u4f53\u5b9e\u73b0\u3002\u800c\u5177\u4f53\u5b9e\u73b0\u5219\u5e94\u8be5\u4f9d\u8d56\u4e8e\u62bd\u8c61\u63a5\u53e3\u3002</li> </ol> <p>\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\u662f\u5b9e\u73b0\u5f00\u95ed\u539f\u5219\u7684\u91cd\u8981\u9014\u5f84\u4e4b\u4e00\uff0c\u5b83\u964d\u4f4e\u4e86\u5ba2\u6237\u4e0e\u5b9e\u73b0\u6a21\u5757\u4e4b\u95f4\u7684\u8026\u5408\u3002</p> <p>\u7531\u4e8e\u5728\u8f6f\u4ef6\u8bbe\u8ba1\u4e2d\uff0c\u7ec6\u8282\u5177\u6709\u591a\u53d8\u6027\uff0c\u800c\u62bd\u8c61\u5c42\u5219\u76f8\u5bf9\u7a33\u5b9a\uff0c\u56e0\u6b64\u4ee5\u62bd\u8c61\u4e3a\u57fa\u7840\u642d\u5efa\u8d77\u6765\u7684\u67b6\u6784\u8981\u6bd4\u4ee5\u7ec6\u8282\u4e3a\u57fa\u7840\u642d\u5efa\u8d77\u6765\u7684\u67b6\u6784\u8981\u7a33\u5b9a\u5f97\u591a\u3002\u8fd9\u91cc\u7684\u62bd\u8c61\u6307\u7684\u662f\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\uff0c\u800c\u7ec6\u8282\u662f\u6307\u5177\u4f53\u7684\u5b9e\u73b0\u7c7b\u3002</p> <p>\u4f7f\u7528\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\u7684\u76ee\u7684\u662f\u5236\u5b9a\u597d\u89c4\u8303\u548c\u5951\u7ea6\uff0c\u800c\u4e0d\u53bb\u6d89\u53ca\u4efb\u4f55\u5177\u4f53\u7684\u64cd\u4f5c\uff0c\u628a\u5c55\u73b0\u7ec6\u8282\u7684\u4efb\u52a1\u4ea4\u7ed9\u5b83\u4eec\u7684\u5b9e\u73b0\u7c7b\u53bb\u5b8c\u6210\u3002</p>"},{"location":"design/design-patterns/Design%20Principles/#41","title":"4.1.\u5b9e\u73b0\u65b9\u6cd5","text":"<p>\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\u7684\u76ee\u7684\u662f\u901a\u8fc7\u8981\u9762\u5411\u63a5\u53e3\u7684\u7f16\u7a0b\u6765\u964d\u4f4e\u7c7b\u95f4\u7684\u8026\u5408\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u5b9e\u9645\u7f16\u7a0b\u4e2d\u53ea\u8981\u9075\u5faa\u4ee5\u4e0b4\u70b9\uff0c\u5c31\u80fd\u5728\u9879\u76ee\u4e2d\u6ee1\u8db3\u8fd9\u4e2a\u89c4\u5219\u3002</p> <ol> <li>\u6bcf\u4e2a\u7c7b\u5c3d\u91cf\u63d0\u4f9b\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\uff0c\u6216\u8005\u4e24\u8005\u90fd\u5177\u5907\u3002</li> <li>\u53d8\u91cf\u7684\u58f0\u660e\u7c7b\u578b\u5c3d\u91cf\u662f\u63a5\u53e3\u6216\u8005\u662f\u62bd\u8c61\u7c7b\u3002</li> <li>\u4efb\u4f55\u7c7b\u90fd\u4e0d\u5e94\u8be5\u4ece\u5177\u4f53\u7c7b\u6d3e\u751f\u3002</li> <li>\u4f7f\u7528\u7ee7\u627f\u65f6\u5c3d\u91cf\u9075\u5faa\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u3002</li> </ol>"},{"location":"design/design-patterns/Design%20Principles/#5","title":"5. \u63a5\u53e3\u9694\u79bb\u539f\u5219","text":"<p>\u63a5\u53e3\u9694\u79bb\u539f\u5219(Interface Segregation Principle, ISP)\uff1a\u5ba2\u6237\u7aef\u4e0d\u5e94\u8be5\u4f9d\u8d56\u5b83\u4e0d\u9700\u8981\u7684\u63a5\u53e3\u3002\u4e5f\u5c31\u662f\u5c3d\u91cf\u5c06\u81c3\u80bf\u5e9e\u5927\u7684\u63a5\u53e3\u62c6\u5206\u6210\u66f4\u5c0f\u7684\u548c\u66f4\u5177\u4f53\u7684\u63a5\u53e3\uff0c\u8ba9\u63a5\u53e3\u4e2d\u53ea\u5305\u542b\u5ba2\u6237\u611f\u5174\u8da3\u7684\u65b9\u6cd5\u3002</p> <p>\u63a5\u53e3\u9694\u79bb\u539f\u5219\u548c\u5355\u4e00\u804c\u8d23\u90fd\u662f\u4e3a\u4e86\u63d0\u9ad8\u7c7b\u7684\u5185\u805a\u6027\u3001\u964d\u4f4e\u5b83\u4eec\u4e4b\u95f4\u7684\u8026\u5408\u6027\uff0c\u4f53\u73b0\u4e86\u5c01\u88c5\u7684\u601d\u60f3\uff0c\u4f46\u4e24\u8005\u662f\u4e0d\u540c\u7684\uff1a</p> <ul> <li>\u5355\u4e00\u804c\u8d23\u539f\u5219\u6ce8\u91cd\u7684\u662f\u804c\u8d23\uff0c\u800c\u63a5\u53e3\u9694\u79bb\u539f\u5219\u6ce8\u91cd\u7684\u662f\u5bf9\u63a5\u53e3\u4f9d\u8d56\u7684\u9694\u79bb\u3002</li> <li>\u5355\u4e00\u804c\u8d23\u539f\u5219\u4e3b\u8981\u662f\u7ea6\u675f\u7c7b\uff0c\u5b83\u9488\u5bf9\u7684\u662f\u7a0b\u5e8f\u4e2d\u7684\u5b9e\u73b0\u548c\u7ec6\u8282\uff1b\u63a5\u53e3\u9694\u79bb\u539f\u5219\u4e3b\u8981\u7ea6\u675f\u63a5\u53e3\uff0c\u4e3b\u8981\u9488\u5bf9\u62bd\u8c61\u548c\u7a0b\u5e8f\u6574\u4f53\u6846\u67b6\u7684\u6784\u5efa\u3002</li> </ul>"},{"location":"design/design-patterns/Design%20Principles/#51","title":"5.1.\u4f18\u70b9","text":"<p>\u63a5\u53e3\u9694\u79bb\u539f\u5219\u662f\u4e3a\u4e86\u7ea6\u675f\u63a5\u53e3\u3001\u964d\u4f4e\u7c7b\u5bf9\u63a5\u53e3\u7684\u4f9d\u8d56\u6027\uff0c\u9075\u5faa\u63a5\u53e3\u9694\u79bb\u539f\u5219\u6709\u4ee5\u4e0b 5 \u4e2a\u4f18\u70b9\u3002</p> <ol> <li>\u5c06\u81c3\u80bf\u5e9e\u5927\u7684\u63a5\u53e3\u5206\u89e3\u4e3a\u591a\u4e2a\u7c92\u5ea6\u5c0f\u7684\u63a5\u53e3\uff0c\u53ef\u4ee5\u9884\u9632\u5916\u6765\u53d8\u66f4\u7684\u6269\u6563\uff0c\u63d0\u9ad8\u7cfb\u7edf\u7684\u7075\u6d3b\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002</li> <li>\u63a5\u53e3\u9694\u79bb\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u5185\u805a\u6027\uff0c\u51cf\u5c11\u4e86\u5bf9\u5916\u4ea4\u4e92\uff0c\u964d\u4f4e\u4e86\u7cfb\u7edf\u7684\u8026\u5408\u6027\u3002</li> <li>\u5982\u679c\u63a5\u53e3\u7684\u7c92\u5ea6\u5927\u5c0f\u5b9a\u4e49\u5408\u7406\uff0c\u80fd\u591f\u4fdd\u8bc1\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\uff1b\u4f46\u662f\uff0c\u5982\u679c\u5b9a\u4e49\u8fc7\u5c0f\uff0c\u5219\u4f1a\u9020\u6210\u63a5\u53e3\u6570\u91cf\u8fc7\u591a\uff0c\u4f7f\u8bbe\u8ba1\u590d\u6742\u5316\uff1b\u5982\u679c\u5b9a\u4e49\u592a\u5927\uff0c\u7075\u6d3b\u6027\u964d\u4f4e\uff0c\u65e0\u6cd5\u63d0\u4f9b\u5b9a\u5236\u670d\u52a1\uff0c\u7ed9\u6574\u4f53\u9879\u76ee\u5e26\u6765\u65e0\u6cd5\u9884\u6599\u7684\u98ce\u9669\u3002</li> <li>\u4f7f\u7528\u591a\u4e2a\u4e13\u95e8\u7684\u63a5\u53e3\u8fd8\u80fd\u591f\u4f53\u73b0\u5bf9\u8c61\u7684\u5c42\u6b21\uff0c\u56e0\u4e3a\u53ef\u4ee5\u901a\u8fc7\u63a5\u53e3\u7684\u7ee7\u627f\uff0c\u5b9e\u73b0\u5bf9\u603b\u63a5\u53e3\u7684\u5b9a\u4e49\u3002</li> <li>\u80fd\u51cf\u5c11\u9879\u76ee\u5de5\u7a0b\u4e2d\u7684\u4ee3\u7801\u5197\u4f59\u3002\u8fc7\u5927\u7684\u5927\u63a5\u53e3\u91cc\u9762\u901a\u5e38\u653e\u7f6e\u8bb8\u591a\u4e0d\u7528\u7684\u65b9\u6cd5\uff0c\u5f53\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\u7684\u65f6\u5019\uff0c\u88ab\u8feb\u8bbe\u8ba1\u5197\u4f59\u7684\u4ee3\u7801</li> </ol>"},{"location":"design/design-patterns/Design%20Principles/#6","title":"6. \u8fea\u7c73\u7279\u6cd5\u5219","text":"<p>\u6700\u5c11\u77e5\u8bc6\u539f\u5219(Principle of Least Knowledge)\uff1a\u53ea\u4e0e\u4f60\u7684\u76f4\u63a5\u670b\u53cb\u4ea4\u8c08\uff0c\u4e0d\u8ddf\u201c\u964c\u751f\u4eba\u201d\u8bf4\u8bdd\uff08Talk only to your immediate friends and not to strangers\uff09\u3002</p> <p>\u5176\u542b\u4e49\u662f\uff1a\u5982\u679c\u4e24\u4e2a\u8f6f\u4ef6\u5b9e\u4f53\u65e0\u987b\u76f4\u63a5\u901a\u4fe1\uff0c\u90a3\u4e48\u5c31\u4e0d\u5e94\u5f53\u53d1\u751f\u76f4\u63a5\u7684\u76f8\u4e92\u8c03\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b2c\u4e09\u65b9\u8f6c\u53d1\u8be5\u8c03\u7528\u3002\u5176\u76ee\u7684\u662f\u964d\u4f4e\u7c7b\u4e4b\u95f4\u7684\u8026\u5408\u5ea6\uff0c\u63d0\u9ad8\u6a21\u5757\u7684\u76f8\u5bf9\u72ec\u7acb\u6027\u3002</p> <p>\u8fea\u7c73\u7279\u6cd5\u5219\u4e2d\u7684\u201c\u670b\u53cb\u201d\u662f\u6307\uff1a\u5f53\u524d\u5bf9\u8c61\u672c\u8eab\u3001\u5f53\u524d\u5bf9\u8c61\u7684\u6210\u5458\u5bf9\u8c61\u3001\u5f53\u524d\u5bf9\u8c61\u6240\u521b\u5efa\u7684\u5bf9\u8c61\u3001\u5f53\u524d\u5bf9\u8c61\u7684\u65b9\u6cd5\u53c2\u6570\u7b49\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u540c\u5f53\u524d\u5bf9\u8c61\u5b58\u5728\u5173\u8054\u3001\u805a\u5408\u6216\u7ec4\u5408\u5173\u7cfb\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u5bf9\u8c61\u7684\u65b9\u6cd5\u3002</p>"},{"location":"design/design-patterns/Design%20Principles/#61","title":"6.1.\u4f18\u70b9","text":"<p>\u8fea\u7c73\u7279\u6cd5\u5219\u8981\u6c42\u9650\u5236\u8f6f\u4ef6\u5b9e\u4f53\u4e4b\u95f4\u901a\u4fe1\u7684\u5bbd\u5ea6\u548c\u6df1\u5ea6\uff0c\u6b63\u786e\u4f7f\u7528\u8fea\u7c73\u7279\u6cd5\u5219\u5c06\u6709\u4ee5\u4e0b\u4e24\u4e2a\u4f18\u70b9\u3002</p> <ol> <li>\u964d\u4f4e\u4e86\u7c7b\u4e4b\u95f4\u7684\u8026\u5408\u5ea6\uff0c\u63d0\u9ad8\u4e86\u6a21\u5757\u7684\u76f8\u5bf9\u72ec\u7acb\u6027\u3002</li> <li>\u7531\u4e8e\u4eb2\u5408\u5ea6\u964d\u4f4e\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u7c7b\u7684\u53ef\u590d\u7528\u7387\u548c\u7cfb\u7edf\u7684\u6269\u5c55\u6027\u3002</li> </ol> <p>\u4f46\u662f\uff0c\u8fc7\u5ea6\u4f7f\u7528\u8fea\u7c73\u7279\u6cd5\u5219\u4f1a\u4f7f\u7cfb\u7edf\u4ea7\u751f\u5927\u91cf\u7684\u4e2d\u4ecb\u7c7b\uff0c\u4ece\u800c\u589e\u52a0\u7cfb\u7edf\u7684\u590d\u6742\u6027\uff0c\u4f7f\u6a21\u5757\u4e4b\u95f4\u7684\u901a\u4fe1\u6548\u7387\u964d\u4f4e\u3002\u6240\u4ee5\uff0c\u5728\u91c6\u7528\u8fea\u7c73\u7279\u6cd5\u5219\u65f6\u9700\u8981\u53cd\u590d\u6743\u8861\uff0c\u786e\u4fdd\u9ad8\u5185\u805a\u548c\u4f4e\u8026\u5408\u7684\u540c\u65f6\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u7684\u7ed3\u6784\u6e05\u6670\u3002</p>"},{"location":"design/design-patterns/Design%20Principles/#62","title":"6.2.\u5b9e\u73b0\u65b9\u6cd5","text":"<p>\u4ece\u8fea\u7c73\u7279\u6cd5\u5219\u7684\u5b9a\u4e49\u548c\u7279\u70b9\u53ef\u77e5\uff0c\u5b83\u5f3a\u8c03\u4ee5\u4e0b\u4e24\u70b9\uff1a</p> <ol> <li>\u4ece\u4f9d\u8d56\u8005\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u53ea\u4f9d\u8d56\u5e94\u8be5\u4f9d\u8d56\u7684\u5bf9\u8c61\u3002</li> <li>\u4ece\u88ab\u4f9d\u8d56\u8005\u7684\u89d2\u5ea6\u8bf4\uff0c\u53ea\u66b4\u9732\u5e94\u8be5\u66b4\u9732\u7684\u65b9\u6cd5\u3002</li> </ol> <p>\u6240\u4ee5\uff0c\u5728\u8fd0\u7528\u8fea\u7c73\u7279\u6cd5\u5219\u65f6\u8981\u6ce8\u610f\u4ee5\u4e0b 6 \u70b9\u3002</p> <ol> <li>\u5728\u7c7b\u7684\u5212\u5206\u4e0a\uff0c\u5e94\u8be5\u521b\u5efa\u5f31\u8026\u5408\u7684\u7c7b\u3002\u7c7b\u4e0e\u7c7b\u4e4b\u95f4\u7684\u8026\u5408\u8d8a\u5f31\uff0c\u5c31\u8d8a\u6709\u5229\u4e8e\u5b9e\u73b0\u53ef\u590d\u7528\u7684\u76ee\u6807\u3002</li> <li>\u5728\u7c7b\u7684\u7ed3\u6784\u8bbe\u8ba1\u4e0a\uff0c\u5c3d\u91cf\u964d\u4f4e\u7c7b\u6210\u5458\u7684\u8bbf\u95ee\u6743\u9650\u3002</li> <li>\u5728\u7c7b\u7684\u8bbe\u8ba1\u4e0a\uff0c\u4f18\u5148\u8003\u8651\u5c06\u4e00\u4e2a\u7c7b\u8bbe\u7f6e\u6210\u4e0d\u53d8\u7c7b\u3002</li> <li>\u5728\u5bf9\u5176\u4ed6\u7c7b\u7684\u5f15\u7528\u4e0a\uff0c\u5c06\u5f15\u7528\u5176\u4ed6\u5bf9\u8c61\u7684\u6b21\u6570\u964d\u5230\u6700\u4f4e\u3002</li> <li>\u4e0d\u66b4\u9732\u7c7b\u7684\u5c5e\u6027\u6210\u5458\uff0c\u800c\u5e94\u8be5\u63d0\u4f9b\u76f8\u5e94\u7684\u8bbf\u95ee\u5668\uff08set \u548c get \u65b9\u6cd5\uff09\u3002</li> <li>\u8c28\u614e\u4f7f\u7528\u5e8f\u5217\u5316\uff08Serializable\uff09\u529f\u80fd</li> </ol> <p>\u4f8b\u5b50\uff1a\u660e\u661f\u7531\u4e8e\u5168\u8eab\u5fc3\u6295\u5165\u827a\u672f\uff0c\u6240\u4ee5\u8bb8\u591a\u65e5\u5e38\u4e8b\u52a1\u7531\u7ecf\u7eaa\u4eba\u8d1f\u8d23\u5904\u7406\uff0c\u5982\u4e0e\u7c89\u4e1d\u7684\u89c1\u9762\u4f1a\uff0c\u4e0e\u5a92\u4f53\u516c\u53f8\u7684\u4e1a\u52a1\u6d3d\u6de1\u7b49\u3002\u8fd9\u91cc\u7684\u7ecf\u7eaa\u4eba\u662f\u660e\u661f\u7684\u670b\u53cb\uff0c\u800c\u7c89\u4e1d\u548c\u5a92\u4f53\u516c\u53f8\u662f\u964c\u751f\u4eba\uff0c\u6240\u4ee5\u9002\u5408\u4f7f\u7528\u8fea\u7c73\u7279\u6cd5\u5219</p>"},{"location":"design/design-patterns/adapter/","title":"\u9002\u914d\u5668\u6a21\u5f0f","text":""},{"location":"design/design-patterns/adapter/#1","title":"1. \u52a8\u673a","text":"<p>\u6709\u65f6\uff0c\u5b58\u5728\u7531\u4e8e\u63a5\u53e3\u4e0d\u517c\u5bb9\u800c\u4e0d\u80fd\u4e00\u8d77\u5de5\u4f5c\u7684\u7c7b\uff0c\u8fd9\u65f6\u5019\u9700\u8981\u4e00\u4e2a\u201c\u6865\u6881\u201d\u53bb\u5305\u88c5\u5176\u4e2d\u4e00\u4e2a\u63a5\u53e3\uff0c\u4f7f\u5176\u8f6c\u6362\u6210\u80fd\u517c\u5bb9\u53e6\u5916\u4e00\u4e2a\u63a5\u53e3\uff0c\u4ece\u800c\u4e24\u4e2a\u7c7b\u80fd\u4e00\u8d77\u5de5\u4f5c\u3002</p>"},{"location":"design/design-patterns/adapter/#2","title":"2. \u5b9a\u4e49","text":"<p>\u5c06\u4e00\u4e2a\u7c7b\u7684\u63a5\u53e3\u8f6c\u63a5\u6210\u7528\u6237\u6240\u671f\u5f85\u7684\uff0c\u4f7f\u5f97\u56e0\u63a5\u53e3\u4e0d\u517c\u5bb9\u800c\u4e0d\u80fd\u5728\u4e00\u8d77\u5de5\u4f5c\u7684\u7c7b\u80fd\u5728\u4e00\u8d77\u5de5\u4f5c\u3002</p>"},{"location":"design/design-patterns/adapter/#3","title":"3. \u89d2\u8272","text":"<ul> <li>Target\uff1a \u76ee\u6807\u62bd\u8c61\u7c7b</li> </ul> <p>\u5ba2\u6237\u6240\u671f\u5f85\u7684\u63a5\u53e3</p> <ul> <li>Adapter\uff1a \u9002\u914d\u5668\u7c7b</li> </ul> <p>\u6838\u5fc3\u6210\u5458\uff0c\u4f7f\u7528Adaptee\u7684\u65b9\u6cd5\u6765\u6ee1\u8db3Target\u7684\u9700\u6c42</p> <ul> <li>Adaptee\uff1a\u88ab\u9002\u914d\u8005</li> </ul> <p>\u9700\u8981\u88ab\u9002\u914d\u7684\u89d2\u8272</p> <ul> <li>Client\uff1a \u5ba2\u6237\u7c7b</li> </ul>"},{"location":"design/design-patterns/adapter/#31","title":"3.1. \u5bf9\u8c61\u9002\u914d\u6a21\u5f0f","text":"<p>\u9002\u914d\u5668\u5bb9\u7eb3\u4e00\u4e2a\u5b83\u5305\u88f9\u7684\u7c7b\u7684\u5b9e\u4f8b\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c31\u5f62\u6210\u4e00\u79cd\u9002\u914d\u5668\u8c03\u7528\u88ab\u5305\u88f9\u5bf9\u8c61\u7684\u5b9e\u4f8b\u3002</p> <p></p> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b</p> <pre><code>public abstract class Target {\npublic abstract void showStrongA();\npublic abstract void showStrongB();\n}\npublic class Adaptee {\npublic void showA(){\nSystem.out.println(\"A\");\n}\npublic void showB(){\nSystem.out.println(\"B\");\n}\n}\npublic class Adapter extends Target{\nprivate Adaptee adaptee;\npublic Adapter(Adaptee adaptee) {\nthis.adaptee = adaptee;\n}\n@Override\npublic void showStrongA() {\nadaptee.showA();\n}\n@Override\npublic void showStrongB() {\nadaptee.showB();\n}\n}\n/** \"Client\" */\npublic static void main(String[] args){\nAdapter adapter = new Adapter(new Adaptee());\nadapter.showStrongA();\nadapter.showStrongB();\n}\n</code></pre>"},{"location":"design/design-patterns/adapter/#32","title":"3.2. \u7c7b\u9002\u914d\u5668\u6a21\u5f0f","text":"<p>\u8fd9\u79cd\u9002\u914d\u5668\u6a21\u5f0f\u4e0b\uff0c\u9002\u914d\u5668\u7c7b\u5b9e\u73b0\u4e86\u76ee\u6807\u62bd\u8c61\u7c7b\u63a5\u53e3\u5e76\u7ee7\u627f\u4e86\u9002\u914d\u8005\u7c7b\uff0c\u5e76\u5728\u76ee\u6807\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0\u65b9\u6cd5\u4e2d\u8c03\u7528\u6240\u7ee7\u627f\u7684\u9002\u914d\u8005\u7c7b\u7684\u65b9\u6cd5\u3002</p> <p></p> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>public interface Target {\nvoid showStrongA();\nvoid showStrongB();\n}\npublic class Adaptee {\npublic void showA(){\nSystem.out.println(\"A\");\n}\npublic void showB(){\nSystem.out.println(\"B\");\n}\n}\npublic class Adapter extends Adaptee implements Target {\n@Override\npublic void showStrongA() {\nshowA();\n}\n@Override\npublic void showStrongB() {\nshowB();\n}\n}\npublic class Main {\npublic static void main(String[] args){\nAdapter adapter = new Adapter();\nadapter.showStrongA();\nadapter.showStrongB();\n}\n}\n</code></pre>"},{"location":"design/design-patterns/adapter/#4","title":"4.\u4f18\u70b9","text":"<ul> <li>\u89e3\u8026</li> </ul> <p>\u5c06\u76ee\u6807\u7c7b\u548c\u9002\u914d\u8005\u7c7b\u89e3\u8026\uff0c\u901a\u8fc7\u5f15\u5165\u4e00\u4e2a\u9002\u914d\u5668\u7c7b\u6765\u91cd\u7528\u73b0\u6709\u7684\u9002\u914d\u8005\u7c7b\uff0c\u800c\u65e0\u987b\u4fee\u6539\u539f\u6709\u4ee3\u7801\u3002</p> <ul> <li>\u589e\u52a0\u4e86\u7c7b\u7684\u900f\u660e\u6027\u548c\u590d\u7528\u6027</li> </ul> <p>\u5c06\u5177\u4f53\u7684\u5b9e\u73b0\u5c01\u88c5\u5728\u9002\u914d\u8005\u7c7b\u4e2d\uff0c\u5bf9\u4e8e\u5ba2\u6237\u7aef\u7c7b\u6765\u8bf4\u662f\u900f\u660e\u7684\uff0c\u800c\u4e14\u63d0\u9ad8\u4e86\u9002\u914d\u8005\u7684\u590d\u7528\u6027\u3002</p> <ul> <li>\u589e\u52a0\u7075\u6d3b\u6027\u548c\u6269\u5c55\u6027</li> </ul> <p>\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u539f\u6709\u4ee3\u7801\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u65b0\u7684\u9002\u914d\u5668\u7c7b\uff0c\u5b8c\u5168\u7b26\u5408\u201c\u5f00\u95ed\u539f\u5219\u201d</p> <p>\u7c7b\u9002\u914d\u5668\u6a21\u5f0f</p> <ul> <li>\u4ee3\u7801\u7b80\u6d01</li> <li>\u9002\u914d\u5668\u7c7b\u662f\u9002\u914d\u8005\u7684\u5b50\u7c7b\uff0c\u9002\u914d\u5668\u53ef\u4ee5\u66f4\u6362\u9002\u914d\u8005\u7684\u65b9\u6cd5\u5b9e\u73b0</li> </ul> <p>\u5bf9\u8c61\u9002\u914d\u5668\u6a21\u5f0f</p> <ul> <li>\u6839\u636e \u201c\u91cc\u6c0f\u4ee3\u6362\u539f\u5219\u201d \uff0c\u540c\u4e00\u4e2a\u9002\u914d\u5668\u53ef\u4ee5\u628a\u9002\u914d\u8005\u7c7b\u548c\u5b83\u7684\u5b50\u7c7b\u90fd\u9002\u914d\u5230\u76ee\u6807\u63a5\u53e3\u3002</li> </ul>"},{"location":"design/design-patterns/adapter/#5","title":"5.\u7f3a\u70b9","text":"<p>\u7c7b\u9002\u914d\u5668\u6a21\u5f0f</p> <ul> <li>\u5bf9\u4e8eJava\u3001C#\u7b49\u4e0d\u652f\u6301\u591a\u91cd\u7ee7\u627f\u7684\u8bed\u8a00\uff0c\u4e00\u6b21\u6700\u591a\u53ea\u80fd\u9002\u914d\u4e00\u4e2a\u9002\u914d\u8005\u7c7b\uff0c\u800c\u4e14\u76ee\u6807\u62bd\u8c61\u7c7b\u5fc5\u987b\u662f\u63a5\u53e3\uff0c\u6709\u4e00\u5b9a\u5c40\u9650\u6027</li> </ul> <p>\u5bf9\u8c61\u9002\u914d\u5668\u6a21\u5f0f</p> <ul> <li>\u4e0e\u7c7b\u9002\u914d\u5668\u76f8\u6bd4\uff0c\u5982\u679c\u9700\u8981\u66f4\u6362\u9002\u914d\u8005\u7684\u65b9\u6cd5\u5b9e\u73b0\uff0c\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a\u9002\u914d\u8005\u7684\u5b50\u7c7b\uff0c\u7136\u540e\u628a\u9002\u914d\u8005\u7684\u5b50\u7c7b\u5f53\u505a\u771f\u6b63\u7684\u9002\u914d\u8005\u8fdb\u884c\u9002\u914d\uff0c\u5b9e\u73b0\u8fc7\u7a0b\u8f83\u4e3a\u590d\u6742\u3002</li> </ul>"},{"location":"design/design-patterns/adapter/#6","title":"6.\u9002\u7528\u573a\u666f","text":"<ul> <li>\u60f3\u8981\u5efa\u7acb\u4e00\u4e2a\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u7684\u7c7b\uff0c\u7528\u4e8e\u4e0e\u4e00\u4e9b\u5f7c\u6b64\u4e4b\u95f4\u6ca1\u6709\u592a\u5927\u5173\u8054\u7684\u4e00\u4e9b\u7c7b\u4e00\u8d77\u5de5\u4f5c\u3002</li> </ul> <p>\u8b6c\u5982 \uff0cAndroid \u7684Adapter\u53ef\u4ee5\u8fde\u63a5\u540e\u7aef\u6570\u636e\u548c\u524d\u7aef\u663e\u793a\uff0c\u4ece\u800c\u5c06\u5404\u79cd\u6570\u636e\u4ee5\u5408\u9002\u7684\u5f62\u5f0f\u663e\u793a\u5230view\u4e0a\u3002</p> <ul> <li>\u9700\u8981\u4f7f\u7528\u7cfb\u7edf\u73b0\u6709\u6b63\u5e38\u8fd0\u884c\u7684\u7c7b\uff0c\u4f46\u8fd9\u4e9b\u7c7b\u7684\u63a5\u53e3\u4e0d\u7b26\u5408\u7cfb\u7edf\u7684\u9700\u8981</li> </ul>"},{"location":"design/design-patterns/bridge/","title":"\u6865\u63a5\u6a21\u5f0f","text":""},{"location":"design/design-patterns/bridge/#1","title":"1.\u5b9a\u4e49","text":"<p>**\u6865\u63a5\u6a21\u5f0f**\u662f\u4e00\u79cd\u7ed3\u6784\u578b\u8bbe\u8ba1\u6a21\u5f0f\uff0c \u53ef\u5c06\u4e00\u4e2a\u5927\u7c7b\u6216\u4e00\u7cfb\u5217\u7d27\u5bc6\u76f8\u5173\u7684\u7c7b\u62c6\u5206\u4e3a\u62bd\u8c61\u548c\u5b9e\u73b0\u4e24\u4e2a\u72ec\u7acb\u7684\u5c42\u6b21\u7ed3\u6784\uff0c \u4ece\u800c\u80fd\u5728\u5f00\u53d1\u65f6\u5206\u522b\u4f7f\u7528\u3002</p>"},{"location":"design/design-patterns/bridge/#2","title":"2. \u89d2\u8272","text":"<ol> <li> <p>\u62bd\u8c61\u90e8\u5206 \uff08Abstrac\u00adtion\uff09 \u63d0\u4f9b\u9ad8\u5c42\u63a7\u5236\u903b\u8f91\uff0c \u4f9d\u8d56\u4e8e\u5b8c\u6210\u5e95\u5c42\u5b9e\u9645\u5de5\u4f5c\u7684\u5b9e\u73b0\u5bf9\u8c61\u3002</p> </li> <li> <p>\u5b9e\u73b0\u90e8\u5206 \uff08Imple\u00admen\u00adta\u00adtion\uff09 \u4e3a\u6240\u6709\u5177\u4f53\u5b9e\u73b0\u58f0\u660e\u901a\u7528\u63a5\u53e3\u3002 \u62bd\u8c61\u90e8\u5206\u4ec5\u80fd\u901a\u8fc7\u5728\u8fd9\u91cc\u58f0\u660e\u7684\u65b9\u6cd5\u4e0e\u5b9e\u73b0\u5bf9\u8c61\u4ea4\u4e92\u3002</p> </li> </ol> <p>\u62bd\u8c61\u90e8\u5206\u53ef\u4ee5\u5217\u51fa\u548c\u5b9e\u73b0\u90e8\u5206\u4e00\u6837\u7684\u65b9\u6cd5\uff0c \u4f46\u662f\u62bd\u8c61\u90e8\u5206\u901a\u5e38\u58f0\u660e\u4e00\u4e9b\u590d\u6742\u884c\u4e3a\uff0c \u8fd9\u4e9b\u884c\u4e3a\u4f9d\u8d56\u4e8e\u591a\u79cd\u7531\u5b9e\u73b0\u90e8\u5206\u58f0\u660e\u7684\u539f\u8bed\u64cd\u4f5c\u3002</p> <ol> <li> <p>\u5177\u4f53\u5b9e\u73b0 \uff08Con\u00adcrete Imple\u00admen\u00adta\u00adtions\uff09 \u4e2d\u5305\u62ec\u7279\u5b9a\u4e8e\u5e73\u53f0\u7684\u4ee3\u7801\u3002</p> </li> <li> <p>\u7cbe\u786e\u62bd\u8c61 \uff08Refined Abstrac\u00adtion\uff09 \u63d0\u4f9b\u63a7\u5236\u903b\u8f91\u7684\u53d8\u4f53\u3002 \u4e0e\u5176\u7236\u7c7b\u4e00\u6837\uff0c \u5b83\u4eec\u901a\u8fc7\u901a\u7528\u5b9e\u73b0\u63a5\u53e3\u4e0e\u4e0d\u540c\u7684\u5b9e\u73b0\u8fdb\u884c\u4ea4\u4e92\u3002</p> </li> <li> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c \u5ba2\u6237\u7aef \uff08Client\uff09 \u4ec5\u5173\u5fc3\u5982\u4f55\u4e0e\u62bd\u8c61\u90e8\u5206\u5408\u4f5c\u3002 \u4f46\u662f\uff0c \u5ba2\u6237\u7aef\u9700\u8981\u5c06\u62bd\u8c61\u5bf9\u8c61\u4e0e\u4e00\u4e2a\u5b9e\u73b0\u5bf9\u8c61\u8fde\u63a5\u8d77\u6765\u3002</p> </li> </ol>"},{"location":"design/design-patterns/bridge/#3","title":"3. \u793a\u4f8b","text":""},{"location":"design/design-patterns/bridge/#4","title":"4. \u9002\u7528\u573a\u666f","text":""},{"location":"design/design-patterns/bridge/#5","title":"5.  \u6865\u63a5\u6a21\u5f0f\u4f18\u7f3a\u70b9","text":""},{"location":"design/design-patterns/builder/","title":"\u5efa\u9020\u8005\u6a21\u5f0f","text":""},{"location":"design/design-patterns/builder/#1","title":"1.\u5b9a\u4e49","text":"<p>\u5c06\u590d\u6742\u5bf9\u8c61\u7684\u5efa\u9020\u8fc7\u7a0b\u62bd\u8c61\u51fa\u6765\uff0c\u4f7f\u8fd9\u4e2a\u62bd\u8c61\u8fc7\u7a0b\u7684\u4e0d\u540c\u5b9e\u73b0\u65b9\u6cd5\u53ef\u4ee5\u6784\u9020\u51fa\u4e0d\u540c\u8868\u73b0\uff08\u5c5e\u6027\uff09\u7684\u5bf9\u8c61\u3002</p>"},{"location":"design/design-patterns/builder/#2","title":"2.\u89d2\u8272","text":"<ul> <li> <p>Builder\uff1a\u62bd\u8c61\u5efa\u9020\u8005\uff0c\u4e3a\u521b\u5efa\u4e00\u4e2aProduct\u5bf9\u8c61\u7684\u5404\u4e2a\u90e8\u4ef6\u6307\u5b9a\u62bd\u8c61\u63a5\u53e3\u3002</p> </li> <li> <p>ConcreteBuilder\uff1a\u5177\u4f53\u5efa\u9020\u8005\uff0c\u5b9e\u73b0Builder\u7684\u63a5\u53e3\u4ee5\u6784\u9020\u548c\u88c5\u914d\u8be5\u4ea7\u54c1\u7684\u5404\u4e2a\u90e8\u4ef6\u3002\u5b9a\u4e49\u5e76\u660e\u786e\u5b83\u6240\u521b\u5efa\u7684\u8868\u793a\u3002</p> </li> <li> <p>Director\uff1a\u6307\u6325\u8005/\u5bfc\u6f14\uff0c\u6784\u9020\u4e00\u4e2a\u4f7f\u7528Builder\u63a5\u53e3\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>Product\uff1a\u4ea7\u54c1\uff0c\u8868\u793a\u88ab\u6784\u9020\u7684\u590d\u6742\u5bf9\u8c61\u3002</p> </li> </ul> <p></p>"},{"location":"design/design-patterns/builder/#3","title":"3.\u65f6\u5e8f\u56fe","text":""},{"location":"design/design-patterns/builder/#4","title":"4.\u8303\u4f8b","text":"<p>\u80af\u5fb7\u57fa\u5957\u9910</p> <p>\u5728\u80af\u5fb7\u57fa\uff0c\u6709\u4e3b\u98df(\u6c49\u5821\u3001\u9e21\u8089\u5377)\u3001\u996e\u6599(\u53ef\u4e50\u3001\u679c\u6c41)\uff0c\u5b83\u4eec\u7ecf\u5e38\u7ec4\u5408\u6210\u4e00\u4e2a\u4e2a\u201c\u5957\u9910\u201d\uff0c\u4e0d\u540c\u7684\u5957\u9910\u6709\u4e0d\u540c\u7684\u7ec4\u6210\uff0c\u670d\u52a1\u5458\u4f1a\u6839\u636e\u987e\u5ba2\u7684\u8981\u6c42\uff0c\u642d\u914d\u8fd9\u4e9b\u4e3b\u98df\u548c\u996e\u6599\uff0c\u7ec4\u5408\u6210\u4e00\u4efd\u5b8c\u6574\u7684\u5957\u9910\uff0c\u8fd9\u4e2a\u573a\u666f\u53ef\u4ee5\u901a\u8fc7\u5efa\u9020\u8005\u6a21\u5f0f\u6765\u63cf\u8ff0</p> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>/** \"Product\" */\npublic class Meal {\nprivate String food;\nprivate String drink;\npublic String getFood() { return food; }\npublic void setFood(String food) { this.food = food; }\npublic String getDrink() { return drink; }\npublic void setDrink(String drink) { this.drink = drink; }\n}\n/** \"Abstract Builder\" */\npublic abstract class MealBuilder {\nprotected Meal mMeal;\npublic MealBuilder() { mMeal = new Meal(); }\npublic Meal getMeal() { return mMeal; }\npublic abstract void buildFood();\npublic abstract void buildDrink();\n}\n/** \"ConcreteBuilder\" */\npublic class HamburgerBuilder extends MealBuilder{\n@Override\npublic void buildFood() { mMeal.setDrink(\"hamburger\"); }\n@Override\npublic void buildDrink() { mMeal.setDrink(\"cola\"); }\n}\n/** \"ConcreteBuilder\" */\npublic class ChickenRollBuilder extends MealBuilder {\n@Override\npublic void buildFood() { mMeal.setFood(\"Chicken Roll\"); }\n@Override\npublic void buildDrink() { mMeal.setDrink(\"fruit juice\");}\n}\n/** \"Director\" */\npublic class Waiter {\nprivate MealBuilder mMealBuilder;\npublic void setMealBuilder (MealBuilder mealBuilder) { mMealBuilder = mealBuilder; }\npublic Meal constructMeal() {\nmMealBuilder.buildFood();\nmMealBuilder.buildDrink();\nreturn mMealBuilder.getMeal();\n}\n}\n/** \u4e00\u4e2a\u5957\u9910\u4f8b\u5b50**/\npublic static void main(String[] args) {\nWaiter waiter = new Waiter();\nMealBuilder hamburgerBuilder = new HamburgerBuilder();\nwaiter.setMealBuilder(hamburgerBuilder);\nMeal meal = waiter.constructMeal();\n}\n</code></pre>"},{"location":"design/design-patterns/builder/#5","title":"5.\u6ce8\u610f\u70b9","text":"<ol> <li>\u62bd\u8c61\u5efa\u9020\u8005\u8981\u8db3\u591f\u666e\u904d\uff0c\u4ee5\u4fbf\u4e3a\u5404\u79cd\u7c7b\u578b\u7684\u5177\u4f53\u5efa\u9020\u8005\u6784\u9020\u4ea7\u54c1\u3002</li> <li>\u4e00\u822c\u6765\u8bf4\uff0c\u5efa\u9020\u8005\u65b9\u6cd5\u9ed8\u8ba4\u4e3a\u7a7a\uff0c\u56e0\u4e3a\u5b9a\u4e49\u4e3a\u7a7a\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u5ba2\u6237\u7aef\u53ea\u5b9a\u4e49\u4ed6\u4eec\u6240\u611f\u5174\u8da3\u7684\u64cd\u4f5c\u3002</li> </ol>"},{"location":"design/design-patterns/builder/#6","title":"6.\u4f18\u70b9","text":"<ol> <li>\u5ba2\u6237\u7aef\u4e0d\u5fc5\u77e5\u9053\u4ea7\u54c1\u5185\u90e8\u7ec4\u6210\u7684\u7ec6\u8282\uff0c\u5c06\u4ea7\u54c1\u672c\u8eab\u4e0e\u4ea7\u54c1\u7684\u521b\u5efa\u8fc7\u7a0b\u89e3\u8026\uff0c\u4f7f\u5f97\u76f8\u540c\u7684\u521b\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u4ea7\u54c1\u5bf9\u8c61\u3002</li> <li>\u53ef\u4ee5\u66f4\u52a0\u7cbe\u7ec6\u5730\u63a7\u5236\u4ea7\u54c1\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u4fbf\u4e8e\u63a7\u5236\u7ec6\u8282\u98ce\u9669</li> <li>\u5efa\u9020\u8005\u72ec\u7acb\uff0c\u6613\u6269\u5c55\uff0c\u7528\u4e0d\u540c\u7684\u5177\u4f53\u5efa\u9020\u8005\u5373\u53ef\u5f97\u5230\u4e0d\u540c\u7684\u4ea7\u54c1\u5bf9\u8c61\u3002</li> </ol>"},{"location":"design/design-patterns/builder/#7","title":"7.\u7f3a\u70b9","text":"<ol> <li>\u8981\u6c42\u7531\u5177\u4f53\u5efa\u9020\u8005\u751f\u6210\u7684\u4ea7\u54c1\u6709\u8f83\u591a\u7684\u5171\u540c\u70b9\uff0c\u4f7f\u7528\u8303\u56f4\u6709\u4e00\u5b9a\u9650\u5236</li> <li>\u5982\u679c\u4ea7\u54c1\u5185\u90e8\u53d8\u5316\u590d\u6742\uff0c\u4f1a\u751f\u6210\u5f88\u591a\u5177\u4f53\u7684\u5efa\u9020\u8005\uff0c\u5bfc\u81f4\u7cfb\u7edf\u81c3\u80bf</li> </ol>"},{"location":"design/design-patterns/builder/#8","title":"8.\u9002\u7528\u573a\u666f","text":"<ol> <li>\u751f\u6210\u7684\u4ea7\u54c1\u5bf9\u8c61\u6709\u590d\u6742\u7684\u5185\u90e8\u7ed3\u6784\uff0c\u8fd9\u4e9b\u4ea7\u54c1\u5bf9\u8c61\u901a\u5e38\u5305\u542b\u591a\u4e2a\u6210\u5458\u5c5e\u6027</li> <li>\u751f\u6210\u7684\u4ea7\u54c1\u5bf9\u8c61\u5141\u8bb8\u6839\u636e\u4e0d\u540c\u7684\u6784\u9020\u8fc7\u7a0b\u6709\u4e0d\u540c\u7684\u8868\u793a</li> </ol> <p>\u4e3e\u4f8b\uff1a</p> <p>\u6e38\u620f\u4eba\u7269\u89d2\u8272\uff1a\u7531\u4eba\u4f53\u3001\u670d\u88c5\u3001\u88c5\u5907\u7b49\u7ec4\u6210\uff0c\u53ef\u4ee5\u66ff\u6362\u7ec4\u5408\uff0c</p> <p>\u524d\u7aef\u6216\u79fb\u52a8\u7aef\u7684\u5f39\u7a97\uff1a\u7531\u6807\u9898\uff0c\u5185\u5bb9\uff0c\u6309\u94ae\u7ec4\u6210\uff0c\u53ef\u4ee5\u5404\u79cd\u5b9a\u4e49\u4e0d\u540c\u6837\u5f0f\u3002Android\u4e2d\u7684Dialog\u5c31\u662f\u4f7f\u7528\u5efa\u9020\u8005\u6a21\u5f0f\u5b9e\u73b0</p>"},{"location":"design/design-patterns/design-patterns/","title":"\u8bbe\u8ba1\u6a21\u5f0f\u6982\u8ff0","text":""},{"location":"design/design-patterns/design-patterns/#1","title":"1. \u8bbe\u8ba1\u6a21\u5f0f\u662f\u4ec0\u4e48\uff1f","text":"<p>\u8bbe\u8ba1\u6a21\u5f0f \u662f\u8f6f\u4ef6\u8bbe\u8ba1\u4e2d\u5e38\u89c1\u95ee\u9898\u7684\u5178\u578b\u89e3\u51b3\u65b9\u6848\u3002 \u5b83\u4eec\u5c31\u50cf\u80fd\u6839\u636e\u9700\u6c42\u8fdb\u884c\u8c03\u6574\u7684\u9884\u5236\u84dd\u56fe\uff0c \u53ef\u7528\u4e8e\u89e3\u51b3\u4ee3\u7801\u4e2d\u53cd\u590d\u51fa\u73b0\u7684\u8bbe\u8ba1\u95ee\u9898\u3002</p> <p>\u8bbe\u8ba1\u6a21\u5f0f\u4e0e\u65b9\u6cd5\u6216\u5e93\u7684\u4f7f\u7528\u65b9\u5f0f\u4e0d\u540c\uff0c \u4f60\u5f88\u96be\u76f4\u63a5\u5728\u81ea\u5df1\u7684\u7a0b\u5e8f\u4e2d\u5957\u7528\u67d0\u4e2a\u8bbe\u8ba1\u6a21\u5f0f\u3002 \u6a21\u5f0f\u5e76\u4e0d\u662f\u4e00\u6bb5\u7279\u5b9a\u7684\u4ee3\u7801\uff0c \u800c\u662f\u89e3\u51b3\u7279\u5b9a\u95ee\u9898\u7684\u4e00\u822c\u6027\u6982\u5ff5\u3002 \u4f60\u53ef\u4ee5\u6839\u636e\u6a21\u5f0f\u6765\u5b9e\u73b0\u7b26\u5408\u81ea\u5df1\u7a0b\u5e8f\u5b9e\u9645\u6240\u9700\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u4eba\u4eec\u5e38\u5e38\u4f1a\u6df7\u6dc6\u6a21\u5f0f\u548c\u7b97\u6cd5\uff0c \u56e0\u4e3a\u4e24\u8005\u5728\u6982\u5ff5\u4e0a\u90fd\u662f\u5df2\u77e5\u7279\u5b9a\u95ee\u9898\u7684\u5178\u578b\u89e3\u51b3\u65b9\u6848\u3002 \u4f46\u7b97\u6cd5\u603b\u662f\u660e\u786e\u5b9a\u4e49\u8fbe\u6210\u7279\u5b9a\u76ee\u6807\u6240\u9700\u7684\u4e00\u7cfb\u5217\u6b65\u9aa4\uff0c \u800c\u6a21\u5f0f\u5219\u662f\u5bf9\u89e3\u51b3\u65b9\u6848\u7684\u66f4\u9ad8\u5c42\u6b21\u63cf\u8ff0\u3002 \u540c\u4e00\u6a21\u5f0f\u5728\u4e24\u4e2a\u4e0d\u540c\u7a0b\u5e8f\u4e2d\u7684\u5b9e\u73b0\u4ee3\u7801\u53ef\u80fd\u4f1a\u4e0d\u4e00\u6837\u3002</p> <p>\u7b97\u6cd5\u66f4\u50cf\u662f\u83dc\u8c31\uff1a \u63d0\u4f9b\u8fbe\u6210\u76ee\u6807\u7684\u660e\u786e\u6b65\u9aa4\u3002 \u800c\u6a21\u5f0f\u66f4\u50cf\u662f\u84dd\u56fe\uff1a \u4f60\u53ef\u4ee5\u770b\u5230\u6700\u7ec8\u7684\u7ed3\u679c\u548c\u6a21\u5f0f\u7684\u529f\u80fd\uff0c \u4f46\u9700\u8981\u81ea\u5df1\u786e\u5b9a\u5b9e\u73b0\u6b65\u9aa4\u3002</p>"},{"location":"design/design-patterns/design-patterns/#2","title":"2. \u4e3a\u4ec0\u4e48\u5b66\u4e60\u8bbe\u8ba1\u6a21\u5f0f\uff1f","text":"<p>\u6216\u8bb8\u4f60\u5df2\u4ece\u4e8b\u7a0b\u5e8f\u5f00\u53d1\u5de5\u4f5c\u591a\u5e74\uff0c \u5374\u5b8c\u5168\u4e0d\u77e5\u9053\u5355\u4f8b\u6a21\u5f0f\u662f\u4ec0\u4e48\u3002 \u5f88\u591a\u4eba\u90fd\u662f\u8fd9\u6837\u3002 \u5373\u4fbf\u5982\u6b64\uff0c \u4f60\u53ef\u80fd\u4e5f\u5728\u4e0d\u81ea\u77e5\u7684\u60c5\u51b5\u4e0b\u5df2\u7ecf\u4f7f\u7528\u8fc7\u4e00\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\u4e86\u3002 \u6240\u4ee5\u4e3a\u4ec0\u4e48\u4e0d\u82b1\u4e9b\u65f6\u95f4\u6765\u66f4\u8fdb\u4e00\u6b65\u5b66\u4e60\u5b83\u4eec\u5462\uff1f</p> <ul> <li>\u8bbe\u8ba1\u6a21\u5f0f\u662f\u9488\u5bf9\u8f6f\u4ef6\u8bbe\u8ba1\u4e2d\u5e38\u89c1\u95ee\u9898\u7684\u5de5\u5177\u7bb1\uff0c \u5176\u4e2d\u7684\u5de5\u5177\u5c31\u662f\u5404\u79cd \u7ecf\u8fc7\u5b9e\u8df5\u9a8c\u8bc1\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u5373\u4f7f\u4f60\u4ece\u672a\u9047\u5230\u8fc7\u8fd9\u4e9b\u95ee\u9898\uff0c \u4e86\u89e3\u6a21\u5f0f\u4ecd\u7136\u975e\u5e38\u6709\u7528\uff0c \u56e0\u4e3a\u5b83\u80fd\u6307\u5bfc\u4f60\u5982\u4f55\u4f7f\u7528\u9762\u5411\u5bf9\u8c61\u7684\u8bbe\u8ba1\u539f\u5219\u6765\u89e3\u51b3\u5404\u79cd\u95ee\u9898\u3002</li> <li>\u8bbe\u8ba1\u6a21\u5f0f\u5b9a\u4e49\u4e86\u4e00\u79cd\u8ba9\u4f60\u548c\u56e2\u961f\u6210\u5458\u80fd\u591f\u66f4\u9ad8\u6548\u6c9f\u901a\u7684\u901a\u7528\u8bed\u8a00\u3002 \u4f60\u53ea\u9700\u8bf4 \u201c\u54e6\uff0c \u8fd9\u91cc\u7528\u5355\u4f8b\u5c31\u53ef\u4ee5\u4e86\u201d\uff0c \u6240\u6709\u4eba\u90fd\u4f1a\u7406\u89e3\u8fd9\u6761\u5efa\u8bae\u80cc\u540e\u7684\u60f3\u6cd5\u3002 \u53ea\u8981\u77e5\u6653\u6a21\u5f0f\u53ca\u5176\u540d\u79f0\uff0c \u4f60\u5c31\u65e0\u9700\u89e3\u91ca\u4ec0\u4e48\u662f\u5355\u4f8b\u3002</li> </ul>"},{"location":"design/design-patterns/design-patterns/#3","title":"3. \u5c01\u88c5\u548c\u8bbe\u8ba1\u6a21\u5f0f\u533a\u522b","text":"<p>\u5c01\u88c5\u53ef\u4ee5\u7406\u89e3\u4e3a\u7531\u7a0b\u5e8f\u7ec4\u5408\u800c\u6210\u7684\u53ef\u590d\u7528\u7684\u5177\u6709\u7279\u5b9a\u529f\u80fd\u7684\u7ec4\u4ef6\u3002\u800c\u8bbe\u8ba1\u6a21\u5f0f\u5219\u8868\u793a\u7ec4\u4ef6\u5185\u90e8\u6216\u8005\u7ec4\u4ef6\u4e4b\u95f4\u662f\u5982\u4f55\u7ec4\u88c5\u7684\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6c7d\u8f66\u662f\u7531\u53d1\u52a8\u673a\u3001\u5e95\u76d8\u3001\u8f66\u8eab\u3001\u7535\u6c14\u8bbe\u5907\u7ec4\u6210\uff0c\u5b83\u4eec\u90fd\u6709\u5404\u81ea\u7684\u4f5c\u7528\uff0c\u4f46\u6211\u4eec\u5728\u8ba8\u8bba\u6c7d\u8f66\u662f\u4ec0\u4e48\u7684\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u5173\u5fc3\u7528\u7684\u662f\u54ea\u4e2a\u54c1\u724c\u7684\u53d1\u52a8\u673a\uff0c\u4ec0\u4e48\u989c\u8272\u7684\u8f66\u8eab\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5b83\u4eec\u7684\u201c\u5173\u7cfb\u201d\uff0c\u5b83\u4eec\u4e4b\u95f4\u76f8\u4e92\u5173\u8054\u4e92\u76f8\u4f5c\u7528\uff0c\u6784\u6210\u4e86\u771f\u6b63\u7684\u6c7d\u8f66\uff0c\u8fd9\u662f\u4e2a\u5de5\u7a0b\u5316\u7684\u8fc7\u7a0b\u3002</p> <p>\u8bbe\u8ba1\u6a21\u5f0f\u5c31\u662f\u8868\u793a\u8fd9\u79cd\u7ec4\u4ef6\u76f8\u4e92\u5173\u7cfb\u7684\u5de5\u7a0b\u5316\u62bd\u8c61\u3002</p>"},{"location":"design/design-patterns/design-patterns/#3_1","title":"3. \u5173\u4e8e\u6a21\u5f0f\u7684\u4e89\u8bae","text":"<p>\u8bbe\u8ba1\u6a21\u5f0f\u81ea\u5176\u8bde\u751f\u4e4b\u521d\u4f3c\u4e4e\u5c31\u9971\u53d7\u4e89\u8bae\uff0c \u6240\u4ee5\u8ba9\u6211\u4eec\u6765\u770b\u770b\u9488\u5bf9\u6a21\u5f0f\u7684\u6700\u5e38\u89c1\u6279\u8bc4\u5427\u3002</p> <ul> <li>\u4e00\u79cd\u9488\u5bf9\u4e0d\u5b8c\u5584\u7f16\u7a0b\u8bed\u8a00\u7684\u8e69\u811a\u89e3\u51b3\u65b9\u6848</li> </ul> <p>\u901a\u5e38\u5f53\u6240\u9009\u7f16\u7a0b\u8bed\u8a00\u6216\u6280\u672f\u7f3a\u5c11\u5fc5\u8981\u7684\u62bd\u8c61\u529f\u80fd\u65f6\uff0c \u4eba\u4eec\u624d\u9700\u8981\u8bbe\u8ba1\u6a21\u5f0f\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c \u6a21\u5f0f\u662f\u4e00\u79cd\u53ef\u4e3a\u8bed\u8a00\u63d0\u4f9b\u66f4\u4f18\u529f\u80fd\u7684\u8e69\u811a\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u4f8b\u5982\uff0c \u7b56\u7565\u6a21\u5f0f\u5728\u7edd\u5927\u90e8\u5206\u73b0\u4ee3\u7f16\u7a0b\u8bed\u8a00\u4e2d\u53ef\u4ee5\u7b80\u5355\u5730\u4f7f\u7528\u533f\u540d \uff08lambda\uff09 \u51fd\u6570\u6765\u5b9e\u73b0\u3002</p> <ul> <li>\u4f4e\u6548\u7684\u89e3\u51b3\u65b9\u6848</li> </ul> <p>\u6a21\u5f0f\u8bd5\u56fe\u5c06\u5df2\u7ecf\u5e7f\u6cdb\u4f7f\u7528\u7684\u65b9\u5f0f\u7cfb\u7edf\u5316\u3002 \u8bb8\u591a\u4eba\u4f1a\u5c06\u8fd9\u6837\u7684\u7edf\u4e00\u5316\u8ba4\u4e3a\u662f\u67d0\u79cd\u6559\u6761\uff0c \u4ed6\u4eec\u4f1a \u201c\u5168\u5fc3\u5168\u610f\u201d \u5730\u5b9e\u65bd\u8fd9\u6837\u7684\u6a21\u5f0f\uff0c \u800c\u4e0d\u4f1a\u6839\u636e\u9879\u76ee\u7684\u5b9e\u9645\u60c5\u51b5\u5bf9\u5176\u8fdb\u884c\u8c03\u6574\u3002</p> <ul> <li>\u4e0d\u5f53\u4f7f\u7528</li> </ul> <p>\u5982\u679c\u4f60\u53ea\u6709\u4e00\u628a\u94c1\u9524\uff0c \u90a3\u4e48\u4efb\u4f55\u4e1c\u897f\u770b\u4e0a\u53bb\u90fd\u50cf\u662f\u9489\u5b50\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5e38\u5e38\u4f1a\u7ed9\u521d\u5b66\u6a21\u5f0f\u7684\u4eba\u4eec\u5e26\u6765\u56f0\u6270\uff1a \u5728\u5b66\u4e60\u4e86\u67d0\u4e2a\u6a21\u5f0f\u540e\uff0c \u4ed6\u4eec\u4f1a\u5728\u6240\u6709\u5730\u65b9\u4f7f\u7528\u8be5\u6a21\u5f0f\uff0c \u5373\u4fbf\u662f\u5728\u8f83\u4e3a\u7b80\u5355\u7684\u4ee3\u7801\u4e5f\u80fd\u80dc\u4efb\u7684\u5730\u65b9\u4e5f\u662f\u5982\u6b64\u3002</p>"},{"location":"design/design-patterns/design-patterns/#4","title":"4. \u8bbe\u8ba1\u6a21\u5f0f\u5206\u7c7b","text":"<p>\u4e0d\u540c\u8bbe\u8ba1\u6a21\u5f0f\u7684\u590d\u6742\u7a0b\u5ea6\u3001 \u7ec6\u8282\u5c42\u6b21\u4ee5\u53ca\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u5e94\u7528\u8303\u56f4\u7b49\u65b9\u9762\u5404\u4e0d\u76f8\u540c\u3002 \u6211\u559c\u6b22\u5c06\u5176\u7c7b\u6bd4\u4e8e\u9053\u8def\u7684\u5efa\u9020\uff1a \u5982\u679c\u4f60\u5e0c\u671b\u8ba9\u5341\u5b57\u8def\u53e3\u66f4\u52a0\u5b89\u5168\uff0c \u90a3\u4e48\u53ef\u4ee5\u5b89\u88c5\u4e00\u4e9b\u4ea4\u901a\u4fe1\u53f7\u706f\uff0c \u6216\u8005\u4fee\u5efa\u5305\u542b\u884c\u4eba\u5730\u4e0b\u901a\u9053\u5728\u5185\u7684\u591a\u5c42\u4e92\u901a\u5f0f\u7acb\u4ea4\u6865\u3002</p> <p>\u6700\u57fa\u7840\u7684\u3001 \u5e95\u5c42\u7684\u6a21\u5f0f\u901a\u5e38\u88ab\u79f0\u4e3a \u60ef\u7528\u6280\u5de7\u3002 \u8fd9\u7c7b\u6a21\u5f0f\u4e00\u822c\u53ea\u80fd\u5728\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\u4e2d\u4f7f\u7528\u3002</p> <p>\u6700\u901a\u7528\u7684\u3001 \u9ad8\u5c42\u7684\u6a21\u5f0f\u662f \u6784\u67b6\u6a21\u5f0f\u3002 \u5f00\u53d1\u8005\u53ef\u4ee5\u5728\u4efb\u4f55\u7f16\u7a0b\u8bed\u8a00\u4e2d\u4f7f\u7528\u8fd9\u7c7b\u6a21\u5f0f\u3002 \u4e0e\u5176\u4ed6\u6a21\u5f0f\u4e0d\u540c\uff0c \u5b83\u4eec\u53ef\u7528\u4e8e\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u67b6\u6784\u8bbe\u8ba1\u3002</p> <p>\u6b64\u5916\uff0c \u6240\u6709\u6a21\u5f0f\u53ef\u4ee5\u6839\u636e\u5176*\u610f\u56fe*\u6216\u76ee\u7684\u6765\u5206\u7c7b\u3002 \u4e3b\u8981\u6709\u4e09\u79cd\u6a21\u5f0f\u7c7b\u522b\uff1a</p> <ul> <li>\u521b\u5efa\u578b\u6a21\u5f0f  \u63d0\u4f9b\u521b\u5efa\u5bf9\u8c61\u7684\u673a\u5236\uff0c \u589e\u52a0\u5df2\u6709\u4ee3\u7801\u7684\u7075\u6d3b\u6027\u548c\u53ef\u590d\u7528\u6027\u3002</li> <li>\u7ed3\u6784\u578b\u6a21\u5f0f  \u4ecb\u7ecd\u5982\u4f55\u5c06\u5bf9\u8c61\u548c\u7c7b\u7ec4\u88c5\u6210\u8f83\u5927\u7684\u7ed3\u6784\uff0c \u5e76\u540c\u65f6\u4fdd\u6301\u7ed3\u6784\u7684\u7075\u6d3b\u548c\u9ad8\u6548\u3002</li> <li>\u884c\u4e3a\u6a21\u5f0f  \u8d1f\u8d23\u5bf9\u8c61\u95f4\u7684\u9ad8\u6548\u6c9f\u901a\u548c\u804c\u8d23\u59d4\u6d3e\u3002</li> </ul>"},{"location":"design/design-patterns/facade/","title":"\u5916\u89c2\u6a21\u5f0f","text":""},{"location":"design/design-patterns/facade/#_1","title":"\u5b9a\u4e49","text":"<p>\u4e3a\u76f8\u4e92\u5173\u8054\u5728\u4e00\u8d77\u7684\u5b50\u7cfb\u7edf\u4e2d\u7684\u4e00\u7ec4\u63a5\u53e3\u63d0\u4f9b\u4e00\u4e2a\u7edf\u4e00\u7684\u9ad8\u5c42\u63a5\u53e3\uff0c\u4f7f\u5f97\u5b50\u7cfb\u7edf\u66f4\u5bb9\u6613\u4f7f\u7528</p>"},{"location":"design/design-patterns/facade/#_2","title":"\u89d2\u8272","text":"<ul> <li>Facade\uff1a \u5916\u89c2\u7c7b</li> </ul> <p>\u4e3a\u5b50\u7cfb\u7edf\u63d0\u4f9b\u4e00\u4e2a\u5171\u540c\u7684\u5bf9\u5916\u63a5\u53e3</p> <ul> <li>SubSystem\uff1a\u5b50\u7cfb\u7edf</li> </ul> <p>\u5ba2\u6237\u53ef\u4ee5\u901a\u8fc7\u5916\u89c2\u63a5\u53e3\u8bfb\u53d6\u7684\u5185\u90e8\u6570\u636e\u8d44\u6e90,\u5b50\u7cfb\u7edf\u5404\u81ea\u5b8c\u6210\u81ea\u5df1\u7684\u5de5\u4f5c</p> <ul> <li>Client\uff1a\u5ba2\u6237</li> </ul> <p>\u8c03\u7528<code>Facade</code>\u63a5\u53e3</p> <p></p>"},{"location":"design/design-patterns/facade/#_3","title":"\u4ee3\u7801\u793a\u4f8b","text":"<p>\u6211\u4eec\u53bb\u533b\u9662\u770b\u75c5\uff0c\u8981\u53bb\u6302\u53f7\u3001\u95e8\u8bca\u3001\u4ed8\u6b3e\u3001\u53d6\u836f\uff0c\u6bcf\u4e2a\u6d41\u7a0b\u90fd\u5f88\u590d\u6742\uff0c\u5047\u8bbe\u672a\u6765AI\u6280\u672f\u53d1\u5c55\u8fc5\u731b\uff0c\u770b\u4e00\u4e9b\u5c0f\u75c5\u53ea\u9700\u8981\u5728\u4e00\u53f0\u667a\u80fd\u533b\u7597\u673a\u524d\u626b\u63cf\u5168\u8eab\u5c31\u53ef\u4ee5\u5b8c\u6210\u6240\u6709\u6d41\u7a0b\uff0c\u8fd9\u6837\u662f\u4e0d\u662f\u5f88\u65b9\u4fbf\u3002\u4ee3\u7801\u6a21\u62df\u5982\u4e0b\uff1a</p> <pre><code>/* \"Subsystem1\" */\npublic class RegisterSystem {\npublic UserRecord register(String id_card){\n....\n....\nreturn UserRecord;\n}\n}\n/* \"Subsystem2\" */\npublic class DiagnosisSystem {\npublic DiagnosticResult diagnose(UserRecord userRecord){\n....\n....\nreturn DiagnosticResult;\n}\n}\n/* \"Subsystem3\" */\npublic class PaySystem {\npublic PayResult pay(User user,DiagnosticResult diagnosticResult){\n....\n....\nreturn PayResult;\n}\n}\n/* \"Subsystem3\" */\npublic class MedicineSystem {\npublic Medicine take(DiagnosticResult diagnosticResult) {\n....\n....\nreturn Medicine;\n}\n}\n/* \"Facade\" */\npublic class AIDoctor {\npublic Result startCure(String id_card){\nRegisterSystem registerSystem = new RegisterSystem();\nDiagnosisSystem diagnosisSystem = new DiagnosisSystem();\nPaySystem paySystem = new PaySystem();\nMedicineSystem medicineSystem = new MedicineSystem();\n//\u6302\u53f7\uff0c\u751f\u6210\u7528\u6237\u8bb0\u5f55\nUserRecord userRecord=registerSystem.register(id_card);\n//\u8bca\u65ad\uff0c\u751f\u6210\u8bca\u65ad\u8bb0\u5f55\nDiagnosticResult diagnosticResult= diagnosisSystem.diagnose(userRecord);\n//\u6839\u636e\u7528\u6237\u548c\u8bca\u65ad\u7ed3\u679c\uff0c\u81ea\u52a8\u8ba1\u7b97\u4ef7\u94b1\u5e76\u652f\u4ed8\nPayresult payResult=paySystem.pay(userRecord.user,diagnosticResult);\nMedicine medicine =null;\nif (payResult.success){\n// \u652f\u4ed8\u6210\u529f\uff0c\u53d6\u836f\nmedicine= medicineSystem.take(diagnosticResult);\n}\n//\u751f\u6210\u8f93\u51fa\u7ed9\u7528\u6237\u7684\u7ed3\u679c\nResult showResult= new Result(diagnosticResult,payResult,medicine);\nreturn showResult;\n}\n}\n/* \"Client\" */\npublic static void main(String[] args) {\nAIDoctor facade = new AIDoctor();\n//\u5ba2\u6237\u8f93\u5165\u8eab\u4efd\u8bc1\u53f7\uff0c\u7136\u540e\u5c31\u5f00\u59cb\u81ea\u52a8\u6cbb\u7597\u5c31\u53ef\u4ee5\u4e86\nResult result=facade.startCure(\"xxxxxxxx\");\n}\n</code></pre> <p>\u6302\u53f7\u3001\u8bca\u65ad\u3001\u4ed8\u6b3e\u3001\u53d6\u836f\u662f**\u76f8\u4e92\u5173\u8054**\u5728\u4e00\u8d77\u7684**\u9519\u7efc\u590d\u6742**\u7684\u5b50\u7cfb\u7edf\uff0c<code>AIDoctor</code>\u5904\u7406\u5b83\u4eec\u4e4b\u95f4\u7684\u4f9d\u8d56\u548c\u5206\u914d\u8d23\u4efb\uff0c\u6309\u7167\u6b63\u786e\u7684\u987a\u5e8f\u53bb\u8c03\u7528\u5b83\u4eec\uff0c\u8fd9\u4e9b\u5bf9\u4e8e\u5ba2\u6237\u90fd\u662f\u900f\u660e\u7684\uff0c\u5ba2\u6237\u53ea\u9700\u8981\u7b80\u5355\u6267\u884c\u4e0b<code>AIDoctor</code>\u7684\u81ea\u52a8\u6cbb\u7597\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5f97\u5230\u8bca\u65ad\u7ed3\u679c\u3001\u6263\u6b3e\u60c5\u51b5\u548c\u836f\u3002<code>AIDoctor</code>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u5145\u5f53\u7684\u5c31\u662f<code>Facade</code>\u89d2\u8272\u3002</p>"},{"location":"design/design-patterns/facade/#_4","title":"\u4f18\u70b9","text":"<ul> <li>\u8ba9\u590d\u6742\u7684\u4e1c\u897f\u770b\u8d77\u6765\u7b80\u5355</li> </ul> <p>\u5bf9\u5ba2\u6237\u5c4f\u853d\u5b50\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u63a5\u53e3\uff08API\uff09\u53d8\u5c11\u4e86\uff0c\u4f7f\u5f97\u5b50\u7cfb\u7edf\u66f4\u52a0\u5bb9\u6613\u4f7f\u7528</p> <ul> <li>\u63d0\u9ad8\u5b50\u7cfb\u7edf\u7684\u72ec\u7acb\u6027\u548c\u53ef\u79fb\u690d\u6027</li> </ul> <p>\u5c06\u5b50\u7cfb\u7edf\u548c\u5ba2\u6237\u89e3\u8026\uff0c\u964d\u4f4e\u7cfb\u7edf\u4f9d\u8d56\u6027</p>"},{"location":"design/design-patterns/facade/#_5","title":"\u7f3a\u70b9","text":"<p>\u589e\u52a0\u65b0\u7684\u5b50\u7cfb\u7edf\u53ef\u80fd\u9700\u8981\u4fee\u6539\u5916\u89c2\u7c7b\u6216\u5ba2\u6237\u7aef\u7684\u6e90\u4ee3\u7801\uff0c\u8fdd\u80cc\u4e86\u201c\u5f00\u95ed\u539f\u5219\u201d\u3002</p>"},{"location":"design/design-patterns/facade/#_6","title":"\u9002\u7528\u573a\u666f","text":"<ul> <li>\u4e3a\u76f8\u4e92\u5173\u7cfb\u6bd4\u8f83\u591a\u3001\u590d\u6742\u7684\u5b50\u7cfb\u7edf\u63d0\u4f9b\u7edf\u4e00\u7684\u7b80\u5355\u63a5\u53e3</li> <li>\u5ba2\u6237\u7a0b\u5e8f\u4e0e\u591a\u4e2a\u5b50\u7cfb\u7edf\u4e4b\u95f4\u5b58\u5728\u5f88\u5927\u7684\u4f9d\u8d56\u6027\u3002\u5f15\u5165\u5916\u89c2\u7c7b\u5c06\u5b50\u7cfb\u7edf\u4e0e\u5ba2\u6237\u4ee5\u53ca\u5176\u4ed6\u5b50\u7cfb\u7edf\u89e3\u8026\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5b50\u7cfb\u7edf\u7684\u72ec\u7acb\u6027\u548c\u53ef\u79fb\u690d\u6027\u3002</li> <li>\u5728\u5c42\u6b21\u5316\u7ed3\u6784\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u5916\u89c2\u6a21\u5f0f\u5b9a\u4e49\u7cfb\u7edf\u4e2d\u6bcf\u4e00\u5c42\u7684\u5165\u53e3\uff0c\u5c42\u4e0e\u5c42\u4e4b\u95f4\u4e0d\u76f4\u63a5\u4ea7\u751f\u8054\u7cfb\uff0c\u800c\u901a\u8fc7\u5916\u89c2\u7c7b\u5efa\u7acb\u8054\u7cfb\uff0c\u964d\u4f4e\u5c42\u4e4b\u95f4\u7684\u8026\u5408\u5ea6\u3002</li> </ul>"},{"location":"design/design-patterns/factory/","title":"\u5de5\u5382\u6a21\u5f0f","text":""},{"location":"design/design-patterns/factory/#1","title":"1. \u9759\u6001\u5de5\u5382/\u7b80\u5355\u5de5\u5382\u6a21\u5f0f","text":""},{"location":"design/design-patterns/factory/#11","title":"1.1.\u52a8\u673a","text":"<p>\u5047\u8bbe\u6709\u4e00\u5bb6\u624b\u673a\u5382\u5546\u521b\u7acb\u4e86\u201c\u9999\u8549\u624b\u673a\u201d\u8fd9\u4e2a\u54c1\u724c\uff0c\u8fd9\u4e2a\u54c1\u724c\u624b\u673a\u6709TS\u3001TS Max\u3001TR\u4e09\u79cd\u578b\u53f7\u3002\u8fd9\u4e9b\u624b\u673a\u6838\u5fc3\u6a21\u5757\u76f8\u540c\uff0c\u4f46\u5916\u89c2\u3001\u505a\u5de5\u3001\u914d\u7f6e\u4e0d\u4e00\u6837\uff0c\u5b83\u4eec\u90fd\u662f\u7531\u540c\u4e00\u5bb6\u5de5\u5382\u201c\u9999\u8549\u4e00\u5382\u201d\u751f\u4ea7\u3002\u624b\u673a\u9500\u552e\u5546\u6bcf\u6b21\u90fd\u76f4\u63a5\u4ece\u201c\u9999\u8549\u4e00\u5382\u201d\u53d6\u8d27\uff0c\u624b\u673a\u9500\u552e\u5546\u4e0d\u77e5\u9053\u624b\u673a\u662f\u600e\u4e48\u505a\u51fa\u6765\u7684\uff0c\u4ed6\u4eec\u53ea\u9700\u8981\u544a\u8bc9\u5de5\u5382\u4ed6\u4eec\u9700\u8981\u4e09\u79cd\u578b\u53f7\u4e2d\u54ea\u4e00\u79cd\uff0c\u5de5\u5382\u5c31\u4f1a\u628a\u624b\u673a\u9001\u5230\u624b\u673a\u9500\u552e\u5546\u90a3\u3002\u8fd9\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u3002</p>"},{"location":"design/design-patterns/factory/#12","title":"1.2.\u5b9a\u4e49","text":"<p>\u6839\u636e\u4e0d\u540c\u53c2\u6570\u8fd4\u56de\u4e0d\u540c\u7c7b\u7684\u5b9e\u4f8b</p> <p>\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u4e0d\u5c5e\u4e8e\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5e94\u8be5\u8bf4\u662f\u4e00\u79cd\u7f16\u7a0b\u4e60\u60ef\uff0c\u5f53\u521b\u5efa\u7684\u5b9e\u4f8b\u90fd\u5177\u6709\u5171\u540c\u7684\u7236\u7c7b\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u6765\u5c01\u88c5</p>"},{"location":"design/design-patterns/factory/#13","title":"1.3.\u89d2\u8272","text":"<ul> <li> <p>Factory\uff1a\u5de5\u5382\u89d2\u8272</p> <p>\u5de5\u5382\u89d2\u8272\u8d1f\u8d23\u5b9e\u73b0\u521b\u5efa\u6240\u6709\u5b9e\u4f8b\u7684\u5185\u90e8\u903b\u8f91</p> </li> <li> <p>Product\uff1a\u62bd\u8c61\u4ea7\u54c1\u89d2\u8272</p> <p>\u62bd\u8c61\u4ea7\u54c1\u89d2\u8272\u662f\u6240\u521b\u5efa\u7684\u6240\u6709\u5bf9\u8c61\u7684\u7236\u7c7b\uff0c\u8d1f\u8d23\u63cf\u8ff0\u6240\u6709\u5b9e\u4f8b\u6240\u5171\u6709\u7684\u516c\u5171\u63a5\u53e3</p> </li> <li> <p>ConcreteProduct\uff1a\u5177\u4f53\u4ea7\u54c1\u89d2\u8272</p> <p>\u5177\u4f53\u4ea7\u54c1\u89d2\u8272\u662f\u521b\u5efa\u76ee\u6807\uff0c\u6240\u6709\u521b\u5efa\u7684\u5bf9\u8c61\u90fd\u5145\u5f53\u8fd9\u4e2a\u89d2\u8272\u7684\u67d0\u4e2a\u5177\u4f53\u7c7b\u7684\u5b9e\u4f8b\u3002</p> </li> </ul> <p></p>"},{"location":"design/design-patterns/factory/#14","title":"1.4.\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u6839\u636e\u4e4b\u524d\u63d0\u5230\u7684\u9999\u8549\u624b\u673a\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u4ee5\u4e0b\u4ee3\u7801</p> <pre><code>/** \"Product\"**/\npublic abstract class Mobile {\npublic abstract void type();\n}\n/** \"ConcreteProduct\"**/\npublic class TRMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"TR MODEL\");\n}\n}\n/** \"ConcreteProduct\"**/\npublic class TSMAXMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"TS MAX MODEL\");\n}\n}\n/** \"ConcreteProduct\"**/\npublic class TSMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"TS MODEL\");\n}\n}\n/** \"Factory\"**/\npublic class MobileFactory {\npublic Mobile createMobile(String type){\nif (type == \"TS\"){\nreturn new TSMobile();\n}else if(type==\"TS MAX\"){\nreturn new TSMAXMobile();\n}else if(type==\"TR\"){\nreturn new TRMobile();\n}else {\nthrow new IllegalArgumentException();\n}\n}\n}\n</code></pre> <p>\u5f53\u6211\u4eec\u9700\u8981\u4e00\u53f0TR \u578b\u53f7\u7684\u624b\u673a\uff0c\u53ea\u9700\u8981\u5982\u4e0b\u8c03\u7528\u5373\u53ef</p> <pre><code>MobileFactory.createMobile(\"TR\")\n</code></pre>"},{"location":"design/design-patterns/factory/#15","title":"1.5.\u4f18\u70b9","text":"<ol> <li>\u5ba2\u6237\u7aef\u53ef\u4ee5\u514d\u9664\u76f4\u63a5\u521b\u5efa\u4ea7\u54c1\u5bf9\u8c61\u7684\u8d23\u4efb\uff0c\u800c\u4ec5\u4ec5\u201c\u6d88\u8d39\u201d\u4ea7\u54c1\u3002\u660e\u786e\u4e86\u5404\u81ea\u7684\u804c\u8d23\u548c\u6743\u5229\uff0c\u6709\u5229\u4e8e\u6574\u4e2a\u8f6f\u4ef6\u4f53\u7cfb\u7ed3\u6784\u7684\u4f18\u5316\u3002</li> <li>\u901a\u8fc7\u5f15\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u4efb\u4f55\u5ba2\u6237\u7aef\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u66f4\u6362\u548c\u589e\u52a0\u65b0\u7684\u5177\u4f53\u4ea7\u54c1\u7c7b\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u7075\u6d3b\u6027\u3002</li> </ol>"},{"location":"design/design-patterns/factory/#16","title":"1.6.\u7f3a\u70b9","text":"<ol> <li>\u5de5\u5382\u7c7b\u4e0d\u591f\u7075\u6d3b\uff0c\u589e\u52a0\u65b0\u7684\u5177\u4f53\u4ea7\u54c1\u9700\u8981\u4fee\u6539\u5de5\u5382\u7c7b\u7684\u5224\u65ad\u903b\u8f91\u4ee3\u7801\uff0c\u8fdd\u80cc\u4e86\u201c\u5f00\u95ed\u539f\u5219\u201d\uff0c\u800c\u4e14\u4ea7\u54c1\u8f83\u591a\u65f6\uff0c\u5de5\u5382\u65b9\u6cd5\u4ee3\u7801\u5c06\u4f1a\u975e\u5e38\u590d\u6742</li> <li>\u589e\u52a0\u7cfb\u7edf\u4e2d\u7c7b\u7684\u4e2a\u6570\uff0c\u5728\u4e00\u5b9a\u7a0b\u5e8f\u4e0a\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u590d\u6742\u5ea6\u548c\u7406\u89e3\u96be\u5ea6\u3002</li> </ol>"},{"location":"design/design-patterns/factory/#17","title":"1.7.\u9002\u7528\u573a\u666f","text":"<p>\u5de5\u5382\u7c7b\u8d1f\u8d23\u521b\u5efa\u7684\u5bf9\u8c61\u6bd4\u8f83\u5c11\uff1a\u7531\u4e8e\u521b\u5efa\u7684\u5bf9\u8c61\u8f83\u5c11\uff0c\u4e0d\u4f1a\u9020\u6210\u5de5\u5382\u65b9\u6cd5\u4e2d\u7684\u4e1a\u52a1\u903b\u8f91\u592a\u8fc7\u590d\u6742\u3002</p>"},{"location":"design/design-patterns/factory/#2","title":"2.\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f","text":""},{"location":"design/design-patterns/factory/#21","title":"2.1.\u52a8\u673a","text":"<p>\u7531\u4e8e\u9999\u8549\u624b\u673a\u7684\u7814\u53d1\u4eba\u5458\u725b\u903c\uff0c\u5f88\u5feb\u4ed6\u4eec\u5c31\u7814\u53d1\u51fa\u4e86\u8de8\u65f6\u4ee3\u624b\u673a ---- \u80f6\u56ca\u624b\u673a\uff08\u4f7f\u7528\u65f6\u8ddf\u6b63\u5e38\u624b\u673a\u4e00\u6837\uff0c\u4e0d\u4f7f\u7528\u7684\u65f6\u5019\u53ef\u4ee5\u7f29\u5c0f\u6210\u80f6\u56ca\u5927\u5c0f\uff09\uff0c\u5f15\u53d1\u4e86\u4e00\u6ce2\u8d2d\u673a\u70ed\u6f6e\u3002\u8fd9\u65f6\u5019\u4e4b\u524d\u7684\u5de5\u5382\u201c\u9999\u8549\u4e00\u5382\u201d\u6709\u70b9\u529b\u4e0d\u4ece\u5fc3\u4e86,\u9996\u5148\uff0c\u7531\u4e8e\u4e1a\u7ee9\u8d8a\u6765\u8d8a\u597d\uff0c\u6bcf\u4e2a\u578b\u53f7\u7684\u624b\u673a\u90fd\u6709\u5927\u6279\u91cf\u7684\u8ba2\u5355\uff0c\u7136\u540e\u65e2\u8981\u751f\u4ea7\u65e7\u578b\u53f7\u7684\u624b\u673a\uff0c\u8fd8\u8981\u751f\u4ea7\u65b0\u7684\u624b\u673a\u3002\u6240\u4ee5\u516c\u53f8\u51b3\u5b9a\u5f00\u5206\u5382\uff0c\u6bcf\u4e2a\u5206\u5382\u4f7f\u7528\u540c\u6837\u7684\u6838\u5fc3\u6280\u672f\uff0c\u4f46\u5404\u81ea\u8d1f\u8d23\u67d0\u4e00\u4e2a\u578b\u53f7\u7684\u624b\u673a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4ee5\u540e\u8981\u662f\u6709\u65b0\u624b\u673a\u7814\u53d1\u6210\u529f\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u5efa\u5382\u6269\u5f20\u4e1a\u52a1\u3002\u8fd9\u5c31\u662f\u4e00\u4e2a\u2018\u2019\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u201c\u3002</p>"},{"location":"design/design-patterns/factory/#22","title":"2.2.\u5b9a\u4e49","text":"<p>\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u53c8\u79f0\u4e3a\u5de5\u5382\u6a21\u5f0f\u6216\u8005\u591a\u6001\u5de5\u5382\u6a21\u5f0f\u3002\u5de5\u5382\u662f\u6784\u9020\u65b9\u6cd5\u7684\u62bd\u8c61\uff0c\u7528\u6765\u5b9e\u73b0\u4e0d\u540c\u7684\u5206\u914d\u65b9\u6848\u3002\u8ba9\u5176\u5b50\u7c7b\u81ea\u5df1\u51b3\u5b9a\u5b9e\u4f8b\u5316\u54ea\u4e00\u4e2a\u5de5\u5382\u7c7b\uff0c\u5de5\u5382\u6a21\u5f0f\u4f7f\u5176\u521b\u5efa\u8fc7\u7a0b\u5ef6\u8fdf\u5230\u5b50\u7c7b\u8fdb\u884c\u3002</p>"},{"location":"design/design-patterns/factory/#23","title":"2.3.\u89d2\u8272","text":"<ul> <li>Product\uff1a\u62bd\u8c61\u4ea7\u54c1</li> </ul> <p>\u540c\u7b80\u5355\u5de5\u5382</p> <ul> <li>ConcreteProduct\uff1a\u5177\u4f53\u4ea7\u54c1</li> </ul> <p>\u540c\u7b80\u5355\u5de5\u5382</p> <ul> <li>Factory\uff1a\u62bd\u8c61\u5de5\u5382</li> </ul> <p>\u5b9a\u4e49\u5177\u4f53\u5de5\u5382\u5fc5\u987b\u5b9e\u73b0\u7684\u63a5\u53e3</p> <ul> <li>ConcreteFactory\uff1a\u5177\u4f53\u5de5\u5382</li> </ul> <p>\u5177\u4f53\u5de5\u5382\u8d1f\u8d23\u5b9e\u73b0\u521b\u5efa\u7279\u5b9a\u7c7b\u578b\u5b9e\u4f8b\u7684\u5185\u90e8\u903b\u8f91</p> <p></p>"},{"location":"design/design-patterns/factory/#24","title":"2.4.\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u8fd8\u662f\u6839\u636e\u4e4b\u524d\u63d0\u5230\u7684\u9999\u8549\u624b\u673a\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u4ee5\u4e0b\u4ee3\u7801</p> <pre><code>/** \"Product\"**/\npublic abstract class Mobile {\npublic abstract void type();\n}\n/** \"ConcreteProduct\"**/\npublic class TRMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"TR MODEL\");\n}\n}\n/** \"ConcreteProduct\"**/\npublic class TSMAXMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"TS MAX MODEL\");\n}\n}\n/** \"ConcreteProduct\"**/\npublic class TSMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"TS MODEL\");\n}\n}\n/** \u65b0\u589e \"ConcreteProduct\"**/\npublic class CapsuleMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"Capsule MOBILE\");\n}\n}\n/** \"Abstract Factory\"**/\npublic abstract class Factory {\npublic abstract Mobile createMobile();\n}\n/** \"ConcreteFactory\"**/\npublic class TRMobileFactory extends Factory {\n@Override\npublic Mobile createMobile() {\nreturn new TRMobile();\n}\n}\n/** \"ConcreteFactory\"**/\npublic class TSMAXMobileFactory extends Factory {\n@Override\npublic Mobile createMobile() {\nreturn new TSMAXMobile();\n}\n}\n/** \"ConcreteFactory\"**/\npublic class TSMobileFactory extends Factory {\n@Override\npublic Mobile createMobile() {\nreturn new TSMobile();\n}\n}\n/** \"ConcreteFactory\"**/\npublic class CapsuleMobileFactory extends Factory {\n@Override\npublic Mobile createMobile() {\nreturn new CapsuleMobile();\n}\n}\n</code></pre> <p>\u8fd9\u65f6\u5019\u5f53\u6211\u4eec\u9700\u8981\u4e00\u53f0TR \u578b\u53f7\u7684\u624b\u673a\uff0c\u53d8\u6210\u4ee5\u4e0b\u8c03\u7528</p> <pre><code>TRMobileFactory.createMobile()\n</code></pre> <p>\u770b\u5230\u8fd9\u91cc\uff0c\u6709\u6ca1\u6709\u611f\u89c9\u60f3\u5410\u69fd\uff1a\u201c\u5c31\u4e3a\u4e86\u628anew\u5305\u88c5\u4e0b\uff0c\u7c7b\u4e2a\u6570\u9661\u7136\u4e0a\u6da8\u5440\uff0c\u65e0\u975e\u5c31\u662f\u628anew\u5bf9\u8c61\u65f6\u7684\u6784\u9020\u51fd\u6570\u548c\u53c2\u6570\u5c4f\u853d\u4e0b\uff0c\u6709\u5fc5\u8981\u975e\u8981\u641e\u4e2a\u542c\u8d77\u6765\u9ad8\u5927\u4e0a\u7684\u6a21\u5f0f\u4e48\uff0c\u4e0d\u5c31\u662f\u751f\u6210\u4e2a\u591a\u6001\u5bf9\u8c61\u4e48\uff0c\u7b80\u5355\u5c01\u88c5\u4e00\u4e2a\u65b9\u6cd5\u5c31\u597d\u4e86\u5440\u6216\u8005\u76f4\u63a5new\u611f\u89c9\u4e5f\u6ca1\u591a\u9ebb\u70e6\u5440\u201c</p> <p>OK\uff0c\u6211\u80fd\u7406\u89e3\u5927\u5bb6\u7684\u5410\u69fd\uff0c\u4f46\u7a0d\u5b89\u52ff\u8e81\uff0c\u8ba9\u6211\u8bb2\u5b8c\u518d\u56de\u7b54\u8fd9\u4e9b\u95ee\u9898</p>"},{"location":"design/design-patterns/factory/#25","title":"2.5.\u4f18\u70b9","text":"<p>\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u53ef\u4ee5\u8bf4\u662f\u7b80\u5355\u5de5\u5382\u7684\u6539\u8fdb\u7248\uff0c\u6709\u7b80\u5355\u5de5\u5382\u7684\u6240\u6709\u4f18\u70b9\uff0c\u540c\u65f6\u907f\u514d\u4e86\u7b80\u5355\u5de5\u5382\u7684\u7f3a\u70b9\uff1a\u5728\u7cfb\u7edf\u4e2d\u52a0\u5165\u65b0\u4ea7\u54c1\u65f6\uff0c\u53ea\u8981\u6dfb\u52a0\u4e00\u4e2a\u5177\u4f53\u5de5\u5382\u548c\u5177\u4f53\u4ea7\u54c1\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u6837\uff0c\u7cfb\u7edf\u7684\u53ef\u6269\u5c55\u6027\u4e5f\u5c31\u53d8\u5f97\u975e\u5e38\u597d\uff0c\u5b8c\u5168\u7b26\u5408\u201c\u5f00\u95ed\u539f\u5219\u201d\u3002</p>"},{"location":"design/design-patterns/factory/#26","title":"2.6.\u7f3a\u70b9","text":"<p>\u6bcf\u6b21\u589e\u52a0\u4e00\u4e2a\u4ea7\u54c1\u65f6\uff0c\u90fd\u9700\u8981\u589e\u52a0\u4e00\u4e2a\u5177\u4f53\u7c7b\u548c\u5bf9\u8c61\u5b9e\u73b0\u5de5\u5382\uff0c\u4f7f\u5f97\u7cfb\u7edf\u4e2d\u7c7b\u7684\u4e2a\u6570\u6210\u500d\u589e\u52a0\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u590d\u6742\u5ea6\uff0c\u540c\u65f6\u4e5f\u589e\u52a0\u4e86\u7cfb\u7edf\u5177\u4f53\u7c7b\u7684\u4f9d\u8d56\u3002</p>"},{"location":"design/design-patterns/factory/#27","title":"2.7.\u9002\u7528\u573a\u666f","text":"<p>\u5ba2\u6237\u7aef\u5728\u4f7f\u7528\u65f6\u53ef\u4ee5\u65e0\u987b\u5173\u5fc3\u662f\u54ea\u4e00\u4e2a\u5de5\u5382\u5b50\u7c7b\u521b\u5efa\u4ea7\u54c1\u5b50\u7c7b\uff0c\u9700\u8981\u65f6\u518d\u52a8\u6001\u6307\u5b9a</p> <p>\u5982 \u65e5\u5fd7\u8bb0\u5f55\u5668\uff1a\u8bb0\u5f55\u53ef\u80fd\u8bb0\u5f55\u5230\u672c\u5730\u786c\u76d8\u3001\u7cfb\u7edf\u4e8b\u4ef6\u3001\u8fdc\u7a0b\u670d\u52a1\u5668\u7b49\uff0c\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u8bb0\u5f55\u65e5\u5fd7\u5230\u4ec0\u4e48\u5730\u65b9\u3002</p>"},{"location":"design/design-patterns/factory/#3","title":"3. \u00a0\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f","text":""},{"location":"design/design-patterns/factory/#31","title":"3.1.\u52a8\u673a","text":"<p>\u201c\u9999\u8549\u201d\u516c\u53f8\u4e1a\u52a1\u84b8\u84b8\u65e5\u4e0a\uff0c\u80f6\u56ca\u624b\u673a\u4e5f\u5f02\u5e38\u706b\u7206\u3002\u516c\u53f8\u51b3\u5b9a\u505a\u4e24\u4ef6\u4e8b\u60c5\uff1a1.\u53d1\u5c55\u5b50\u4e1a\u52a1\uff1a\u505a\u7535\u89c6\u673a\u30022.\u628a\u201c\u80f6\u56ca\u201d\u5206\u62c6\u51fa\u53bb\uff0c\u505a\u6210\u72ec\u7acb\u54c1\u724c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u201c\u9999\u8549\u201d\u516c\u53f8\u65d7\u4e0b\u4ea7\u54c1\u6709\u624b\u673a\u548c\u7535\u89c6\u673a\uff0c\u54c1\u724c\u6709\u201c\u9999\u8549\u201d\u548c\u201c\u80f6\u56ca\u201d\u3002\u4e3a\u4e86\u5efa\u7acb\u54c1\u724c\u8ba4\u77e5\u548c\u8fa8\u522b\u5ea6\uff0c\u540c\u65f6\u4e5f\u4e3a\u4e86\u54c1\u724c\u80fd\u72ec\u7acb\u53d1\u5c55\uff0c\u54c1\u724c\u4e4b\u95f4\u7684\u5de5\u5382\u662f\u72ec\u7acb\u7684\uff1b\u968f\u7740\u5de5\u5382\u7684\u5de5\u7a0b\u5316\u548c\u96c6\u6210\u5ea6\u8d8a\u6765\u8d8a\u9ad8\uff0c\u540c\u65f6\u4e3a\u4e86\u8282\u7ea6\u6210\u672c\uff0c\u4e00\u95f4\u5de5\u5382\u73b0\u5728\u65e2\u53ef\u4ee5\u751f\u4ea7\u624b\u673a\uff0c\u4e5f\u53ef\u4ee5\u751f\u4ea7\u7535\u89c6\u673a\u4e86\u3002\u8fd9\u65f6\u5019\u5c31\u5f62\u6210\u4e86\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u3002</p>"},{"location":"design/design-patterns/factory/#32","title":"3.2.\u5b9a\u4e49","text":"<p>\u4e3a\u4e86\u66f4\u6e05\u6670\u5730\u7406\u89e3\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\uff0c\u9700\u8981\u5148\u5f15\u5165\u4e24\u4e2a\u6982\u5ff5\uff1a</p> <ul> <li>\u4ea7\u54c1\u7b49\u7ea7\u7ed3\u6784 \uff1a\u4ea7\u54c1\u7b49\u7ea7\u7ed3\u6784\u5373\u4ea7\u54c1\u7684\u7ee7\u627f\u7ed3\u6784\uff0c\u5982\u4e0a\u9762\u63cf\u8ff0\uff0c\u4e00\u4e2a\u62bd\u8c61\u7c7b\u662f\u7535\u89c6\u673a\uff0c\u5176\u5b50\u7c7b\u6709\u9999\u8549\u7535\u89c6\u673a\u548c\u80f6\u56ca\u7535\u89c6\u673a\uff0c\u5219\u62bd\u8c61\u7535\u89c6\u673a\u4e0e\u5177\u4f53\u54c1\u724c\u7684\u7535\u89c6\u673a\u4e4b\u95f4\u6784\u6210\u4e86\u4e00\u4e2a\u4ea7\u54c1\u7b49\u7ea7\u7ed3\u6784\uff0c\u62bd\u8c61\u7535\u89c6\u673a\u662f\u7236\u7c7b\uff0c\u800c\u5177\u4f53\u54c1\u724c\u7684\u7535\u89c6\u673a\u662f\u5176\u5b50\u7c7b\u3002</li> <li>\u4ea7\u54c1\u65cf \uff1a\u5728\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u4e2d\uff0c\u4ea7\u54c1\u65cf\u662f\u6307\u7531\u540c\u4e00\u4e2a\u5de5\u5382\u751f\u4ea7\u7684\uff0c\u4f4d\u4e8e\u4e0d\u540c\u4ea7\u54c1\u7b49\u7ea7\u7ed3\u6784\u4e2d\u7684\u4e00\u7ec4\u4ea7\u54c1\uff0c\u5982\u9999\u8549\u7535\u5668\u5de5\u5382\u751f\u4ea7\u7684\u9999\u8549\u7535\u89c6\u673a\u3001\u9999\u8549\u624b\u673a\uff0c\u9999\u8549\u7535\u89c6\u673a\u4f4d\u4e8e\u7535\u89c6\u673a\u4ea7\u54c1\u7b49\u7ea7\u7ed3\u6784\u4e2d\uff0c\u9999\u8549\u624b\u673a\u4f4d\u4e8e\u624b\u673a\u4ea7\u54c1\u7b49\u7ea7\u7ed3\u6784\u4e2d\u3002</li> </ul> <p>\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u63d0\u4f9b\u4e00\u4e2a\u521b\u5efa\u4e00\u7cfb\u5217\u76f8\u5173\u6216\u76f8\u4e92\u4f9d\u8d56\u5bf9\u8c61\u7684\u63a5\u53e3\uff0c\u800c\u65e0\u9700\u6307\u5b9a\u5b83\u4eec\u5177\u4f53\u7684\u7c7b\u3002</p>"},{"location":"design/design-patterns/factory/#33","title":"3.3.\u89d2\u8272","text":""},{"location":"design/design-patterns/factory/#34","title":"3.4.\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u6839\u636e\u9999\u8549\u516c\u53f8\u7684\u65b0\u6539\u52a8\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>/** \"Abstract Factory\"**/\npublic abstract class Factory {\npublic abstract Mobile createMobile();\npublic abstract TV createTV();\n}\n/** \"Abstract ProductA\"**/\npublic abstract class Mobile {\npublic abstract void type();\n}\n/** \"Abstract ProductB\"**/\npublic abstract class TV {\npublic abstract void type();\n}\n/** \"ProductA1\"**/\npublic class BananaMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"Banana MOBILE\");\n}\n}\n/** \"ProductA2\"**/\npublic class CapsuleMobile extends Mobile {\n@Override\npublic void type() {\nSystem.out.print(\"Capsule MOBILE\");\n}\n}\n/** \"ProductB1\"**/\npublic class BananaTV extends TV {\n@Override\npublic void type() {\nSystem.out.print(\"Banana TV\");\n}\n}\n/** \"ProductB2\"**/\npublic class CapsuleTV extends TV {\n@Override\npublic void type() {\nSystem.out.print(\"Capsule TV\");\n}\n}\n/** \"Factory1\"**/\npublic class BananaFactory extends Factory {\n@Override\npublic Mobile createMobile() {\nreturn new BananaMobile();\n}\n@Override\npublic TV createTV() {\nreturn new BananaTV();\n}\n}\n/** \"Factory2\"**/\npublic class CapsuleFactory extends Factory {\n@Override\npublic Mobile createMobile() {\nreturn new CapsuleMobile();\n}\n@Override\npublic TV createTV() {\nreturn new CapsuleTV();\n}\n}\n</code></pre> <p>\u8fd9\u65f6\u5019\u5f53\u6211\u4eec\u9700\u8981\u80f6\u56ca\u624b\u673a\u548c\u80f6\u56ca\u7535\u89c6\uff0c\u53d8\u6210\u4ee5\u4e0b\u8c03\u7528</p> <pre><code>Mobile mobile=CapsuleFactory.createMobile()\nTV tv=CapsuleFactory.createTV()  </code></pre>"},{"location":"design/design-patterns/factory/#35","title":"3.5.\u4f18\u70b9","text":"<ol> <li>\u5177\u4f53\u4ea7\u54c1\u4ece\u5ba2\u6237\u4ee3\u7801\u4e2d\u88ab\u5206\u79bb\u51fa\u6765</li> <li>\u589e\u52a0\u65b0\u7684\u5177\u4f53\u5de5\u5382\u548c\u4ea7\u54c1\u65cf\u5f88\u65b9\u4fbf\uff0c\u65e0\u987b\u4fee\u6539\u5df2\u6709\u7cfb\u7edf\uff0c\u7b26\u5408\u201c\u5f00\u95ed\u539f\u5219\u201d\u3002</li> <li>\u5c06\u4e00\u4e2a\u7cfb\u5217\u7684\u4ea7\u54c1\u65cf\u7edf\u4e00\u5230\u4e00\u8d77\u521b\u5efa\uff0c\u4fdd\u8bc1\u5ba2\u6237\u7aef\u59cb\u7ec8\u53ea\u4f7f\u7528\u540c\u4e00\u4e2a\u4ea7\u54c1\u65cf\u4e2d\u7684\u5bf9\u8c61\u3002</li> </ol>"},{"location":"design/design-patterns/factory/#36","title":"3.6.\u7f3a\u70b9","text":"<p>\u5728\u4ea7\u54c1\u65cf\u4e2d\u6269\u5c55\u65b0\u7684\u4ea7\u54c1\u662f\u5f88\u56f0\u96be\u7684\uff0c\u9700\u8981\u4fee\u6539\u62bd\u8c61\u5de5\u5382\u7684\u63a5\u53e3</p>"},{"location":"design/design-patterns/factory/#37","title":"3.7.\u9002\u7528\u573a\u666f","text":"<p>\u7cfb\u7edf\u4e2d\u6709\u591a\u4e8e\u4e00\u4e2a\u7684\u4ea7\u54c1\u65cf\uff0c\u800c\u6bcf\u6b21\u53ea\u4f7f\u7528\u5176\u4e2d\u67d0\u4e00\u4ea7\u54c1\u65cf\u3002</p> <p>\u5982 QQ\u79c0\u6362\u76ae\u80a4\uff0c\u4e00\u6574\u5957\u4e00\u8d77\u6362</p>"},{"location":"design/design-patterns/factory/#38","title":"3.8.\u4e3a\u4ec0\u4e48\u8981\u7528\u5de5\u5382\u6a21\u5f0f","text":"<p>\u56de\u5e94\u4e0a\u9762\u7684\u5410\u69fd\u95ee\u9898</p> <p>\u8bbe\u8ba1\u6a21\u5f0f\u662f\u4e00\u7fa4\u6280\u672f\u5927\u62ff\u7ecf\u8fc7\u65e0\u6570\u5b9e\u8df5\u7ecf\u9a8c\u603b\u7ed3\u51fa\u6765\u7684\uff0c\u6211\u7b49\u5c0f\u83dc\uff0c\u5c3d\u7ba1\u7528\u5373\u53ef\uff0c\u4e0d\u8981\u95ee\u4e3a\u4ec0\u4e48\uff0c\u54c8\u54c8[\u767d\u773c]\u3002</p> <p>\u4f46\u4f5c\u4e3a\u4e00\u540d\u6709\u8ffd\u6c42\u6709\u7406\u60f3\u7684\u7a0b\u5e8f\u5458\uff0c\u8fd8\u662f\u5e0c\u671b\u5228\u6839\u95ee\u5e95\u4e0b\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e9b\u6211\u7684\u7406\u89e3\uff1a</p> <ol> <li>\u5de5\u5382\u6a21\u5f0f\u662f\u7b26\u5408\u201c\u5f00\u95ed\u539f\u5219\u201d\u7684\uff0c\u8fd9\u5728\u4ee3\u7801\u8bbe\u8ba1\u91cc\u9762\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u539f\u5219</li> <li>\u6709\u65f6\uff0c\u521b\u5efa\u4e0d\u4ec5\u4ec5\u662f\u521b\u5efa\uff0c\u63a7\u5236\u8fc7\u7a0b\u6bd4\u7b80\u5355\u5730\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u66f4\u590d\u6742\u3002\u5de5\u5382\u5bf9\u8c61\u53ef\u80fd\u4f1a\u52a8\u6001\u5730\u521b\u5efa\u4ea7\u54c1\u5bf9\u8c61\u7684\u7c7b\uff0c\u6216\u8005\u4ece\u5bf9\u8c61\u6c60\u4e2d\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6216\u8005\u5bf9\u6240\u521b\u5efa\u7684\u5bf9\u8c61\u8fdb\u884c\u590d\u6742\u7684\u914d\u7f6e\uff0c\u6216\u8005\u5e94\u7528\u5176\u4ed6\u7684\u64cd\u4f5c\u3002\u8fd9\u5176\u5b9e\u662f\u4e2a\u590d\u6742\u7684\u8fc7\u7a0b\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5de5\u5382\u5bf9\u8c61\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\uff0c\u5b83\u628a\u8fd9\u4e9b\u8fc7\u7a0b\u62bd\u8c61\u4e86\u5e76\u5bf9\u5ba2\u6237\u7aef\u5c4f\u853d\u4e86\uff0c\u4f7f\u5f97\u5ba2\u6237\u7aef\u4f7f\u7528\u8d77\u6765\u66f4\u7b80\u5355\u3002</li> <li>\u964d\u4f4e\u7ef4\u62a4\u6210\u672c\uff0c\u7531\u4e8e\u521b\u5efa\u8fc7\u7a0b\u90fd\u7531\u5de5\u5382\u7edf\u4e00\u7ba1\u7406\uff0c\u6240\u4ee5\u8981\u662f\u7c7b\u540d\u6216\u8005\u6784\u9020\u8fc7\u7a0b\u53d1\u751f\u53d8\u5316\uff0c\u53ef\u4ee5\u7edf\u4e00\u901a\u8fc7\u5de5\u5382\u53bb\u4fee\u6539\uff0c\u800c\u4e0d\u7528\u5728\u6bcf\u4e2a\u521b\u5efa\u7684\u5730\u65b9\u9010\u4e2a\u4fee\u6539</li> <li>\u201c\u7529\u9505\u201d\u3002\u5f53\u4e00\u4e2a\u9879\u76ee\u8db3\u591f\u5927\u7684\u65f6\u5019\uff0c\u4eba\u5458\u4f1a\u5f88\u591a\uff0c\u6bcf\u4e2a\u4eba\u90fd\u8d1f\u8d23\u4e0d\u540c\u7684\u4e1c\u897f\uff0c\u5404\u81ea\u90fd\u6709\u81ea\u5df1\u7684\u5229\u76ca\uff0c\u8c01\u90fd\u4e0d\u60f3\u56e0\u4e3a\u81ea\u5df1\u7684\u6539\u52a8\u5bfc\u81f4\u9879\u76ee\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\uff0c\u201c\u6211\u4e0d\u5e0c\u671b\u53bbnew \u4f60\u7684\u5bf9\u8c61\uff0c\u4f60\u76f4\u63a5\u7ed9\u6211\u5c31\u597d\u4e86\u201d\u5176\u5b9e\u662f\u4e2a\u5f3a\u9700\u6c42\uff0c\u54c8\u54c8\u3002</li> </ol> <p>\u6240\u4ee5\uff0c\u5f53\u4f60\u89c9\u5f97\u4e0d\u9700\u8981\u6216\u8005\u6ca1\u5fc5\u8981\u7528\u5de5\u5382\u6a21\u5f0f\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4ec5\u4ec5\u662f\u56e0\u4e3a\u4f60\u7684\u9879\u76ee\u8fd8\u4e0d\u591f\u5927\u800c\u5df2\u3002</p>"},{"location":"design/design-patterns/factory/#_1","title":"\u53c2\u8003","text":"<p>https://design-patterns.readthedocs.io</p>"},{"location":"design/design-patterns/framework%20design/","title":"\u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"design/design-patterns/framework%20design/#1","title":"1.\u7cfb\u7edf\u3001\u6a21\u5757\u3001\u7ec4\u4ef6\u3001\u6846\u67b6","text":"<p>\u7cfb\u7edf\u662f\u7531\u4e00\u7ec4\u5b9e\u4f53\u548c\u8fd9\u4e9b\u5b9e\u4f53\u7684\u5173\u7cfb\u6240\u6784\u6210\u7684\u96c6\u5408\uff0c\u5176\u529f\u80fd\u8981\u5927\u4e8e\u8fd9\u4e9b\u5b9e\u4f53\u5404\u81ea\u7684\u529f\u80fd\u4e4b\u548c\u3002</p> <p>\u4e3e\u4f8b\u8bf4\uff0c\u4e00\u5806\u7816\u74e6\u6728\u5934\u4e0d\u80fd\u906e\u98ce\u6321\u96e8\uff0c\u4f46\u5b83\u4eec\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a\u6e29\u6696\u7684\u623f\u5b50\uff0c\u623f\u5b50\u7684\u529f\u80fd\u5927\u4e8e\u8fd9\u4e00\u5806\u6750\u6599\u7684\u529f\u80fd\u4e4b\u548c\uff0c\u6240\u4ee5\u623f\u5b50\u662f\u4e00\u4e2a\u7cfb\u7edf\u3002</p> <p>\u6a21\u5757\u4e0e\u7ec4\u4ef6\u90fd\u662f\u7cfb\u7edf\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u4ece\u4e0d\u540c\u89d2\u5ea6\u62c6\u5206\u7cfb\u7edf\u800c\u5df2\u3002\u6a21\u5757\u662f\u903b\u8f91\u5355\u5143\uff0c\u4ece\u4e1a\u52a1\u7ef4\u5ea6\u4e0a\u804c\u8d23\u7684\u5212\u5206\uff1b\u7ec4\u4ef6\u662f\u7269\u7406\u5355\u5143\uff0c\u4ece\u6280\u672f\u7ef4\u5ea6\u4e0a\u7684\u590d\u7528\u3002</p> <p>\u6846\u67b6\u662f\u4e3a\u4e86\u5b9e\u73b0\u67d0\u4e2a\u4e1a\u754c\u6807\u51c6\u6216\u5b8c\u6210\u7279\u5b9a\u57fa\u672c\u4efb\u52a1\u7684 \u8f6f\u4ef6\u7ec4\u4ef6\u89c4\u8303\uff0c\u4e5f\u6307\u4e3a\u4e86\u5b9e\u73b0\u67d0\u4e2a\u8f6f\u4ef6\u7ec4\u4ef6\u89c4\u8303\u65f6\uff0c\u63d0\u4f9b\u89c4\u8303\u6240\u8981\u6c42\u4e4b \u57fa\u7840\u529f\u80fd\u7684\u8f6f\u4ef6\u4ea7\u54c1\uff0c\u5982<code>flask</code>\u3001<code>Django</code>\u3001<code>Spring</code></p>"},{"location":"design/design-patterns/framework%20design/#2","title":"2. \u4ec0\u4e48\u662f\u67b6\u6784","text":"<p>\u67b6\u6784\u662f\u6709\u5173\u8f6f\u4ef6 \u6574\u4f53\u7ed3\u6784\u4e0e\u7ec4\u4ef6\u7684\u62bd\u8c61\u63cf\u8ff0\uff0c\u7528\u4e8e\u6307\u5bfc\u5927\u578b\u8f6f\u4ef6\u7cfb\u7edf\u5404\u4e2a\u65b9\u9762\u7684\u8bbe\u8ba1\u3002\u67b6\u6784\u53ea\u662f\u8bbe\u8ba1\u7684\u62bd\u8c61\uff0c\u5bf9\u4e8e\u5177\u4f53\u7684\u5b9e\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u79f0\u4e4b\u4e3a\u6846\u67b6\u3002\u597d\u7684\u6846\u67b6\u53ef\u4ee5\u9690\u85cf\u5927\u5bb6\u4e0d\u9700\u8981\u5173\u5fc3\u7684\u90e8\u5206\uff0c\u63d0\u5347\u6211\u4eec\u7684\u6548\u7387\u3002\u53ef\u4ee5\u770b\u51fa\u6846\u67b6\u548c\u67b6\u6784\u90fd\u548c\u7ec4\u4ef6\u6709\u5173\u7cfb\uff0c\u4f46\u67b6\u6784\u5173\u6ce8\u7684\u662f\u201c\u7ed3\u6784\u201d\uff0c\u6846\u67b6\u5173\u6ce8\u7684\u662f\u201c\u89c4\u8303\u201d\u3002</p> <p>\u9762\u5bf9\u4e1a\u52a1\u9700\u6c42\u573a\u666f\u7ed9\u51fa\u5408\u9002\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f7f\u4e1a\u52a1\u80fd\u591f\u5feb\u901f\u8fed\u4ee3\uff0c\u4ece\u800c\u8fbe\u5230\u201c\u63d0\u8d28\u589e\u6548\u201d\u7684\u76ee\u6807\u3002\u67b6\u6784\u662f\u4e00\u4e2a\u4ecb\u4e8e\u9700\u6c42\u4e0e\u5b9e\u73b0\u4e2d\u95f4\u7684\u6b65\u9aa4\uff0c\u65e2\u8981\u5206\u6790\u9700\u6c42\uff0c\u53c8\u8981\u53ef\u4ee5\u63d0\u51fa\u53ef\u884c\u7684\u5b9e\u73b0\u65b9\u6848\uff0c\u662f\u8f6f\u4ef6\u7cfb\u7edf\u7684\u9876\u5c42\u7ed3\u6784\u3002</p>"},{"location":"design/design-patterns/framework%20design/#3","title":"3. \u67b6\u6784\u9009\u578b","text":"<ul> <li>\u6846\u67b6\u7684\u6210\u719f\u5ea6</li> </ul> <p>\u6846\u67b6\u662f\u5426\u5df2\u7ecf\u88ab\u5927\u91cf\u5e94\u7528\u6240\u5b9e\u8df5\uff0c\u7279\u522b\u662f\u4ebf\u7ea7\u4ee5\u4e0a\u7684\u5e94\u7528\u3002\u8fd8\u6709\u5c31\u662f\u6846\u67b6\u76ee\u524d\u662f\u5426\u8fd8\u5728\u7ef4\u62a4\u3001\u6846\u67b6\u7684\u6027\u80fd\u5982\u4f55\u7b49</p> <ul> <li>\u5de5\u5177\u94fe\u7684\u6210\u719f\u5ea6</li> </ul> <p>\u914d\u5957\u7684\u5de5\u5177\u94fe\u662f\u5426\u6210\u719f\u3001\u5b8c\u5584\u3002\u4f8b\u5982 Flutter \u4f5c\u4e3a\u4e00\u95e8\u65b0\u7684\u6280\u672f\uff0c\u4ece\u5f00\u53d1\u3001\u7f16\u8bd1\u3001\u6d4b\u8bd5\u5230\u53d1\u5e03\uff0c\u662f\u5426\u6709\u5b8c\u5584\u7684\u5de5\u5177\u94fe\u652f\u6301</p> <ul> <li>\u4eba\u5458\u7684\u5b66\u4e60\u6210\u672c\u3001\u6587\u6863\u662f\u5426\u5b8c\u5907</li> </ul> <p>\u7ed3\u5408\u56e2\u961f\u7684\u73b0\u72b6\uff0c\u9700\u8981\u8003\u8651\u6846\u67b6\u7684\u5b66\u4e60\u6210\u672c\u662f\u5426\u53ef\u4ee5\u63a5\u53d7\u3001\u5b66\u4e60\u8def\u5f84\u662f\u5426\u5e73\u6ed1\u3001\u6709\u6ca1\u6709\u8db3\u591f\u7684\u6587\u6863\u548c\u793e\u533a\u652f\u6301</p> <p>\u7ec4\u7ec7\u67b6\u6784\u3001\u4ee3\u7801\u67b6\u6784\u4ee5\u53ca\u6d41\u7a0b\u90fd\u5e94\u8be5\u8ddf\u6211\u4eec\u56e2\u961f\u7684\u89c4\u6a21\u76f8\u5339\u914d\u3002</p> <p>\u67b6\u6784\u8bbe\u8ba1\u6216\u8005\u67b6\u6784\u9009\u578b\u4e0d\u80fd\u597d\u9ad8\u9a9b\u8fdc\uff0c\u6211\u4eec\u6709\u591a\u5927\u7684\u89c4\u6a21\uff0c\u5c31\u505a\u591a\u5c11\u7684\u652f\u6491\u3002\u8b66\u60d5\u957f\u671f\u7684\u4e8b\u60c5\u77ed\u671f\u505a\uff0c\u6216\u8005\u77ed\u671f\u7684\u4e8b\u60c5\u957f\u671f\u505a\u3002</p> <p>\"\u5eb7\u5a01\u5b9a\u5f8b\"</p>"},{"location":"design/design-patterns/framework%20design/#4-3","title":"4. \u67b6\u6784\u8bbe\u8ba13\u4e2a\u9636\u6bb5","text":"<ul> <li>\u9884\u5907\u9636\u6bb5</li> </ul> <p>\u9700\u6c42\u5206\u6790\uff0c\u5efa\u7acb\u9700\u6c42\u5927\u5c40\u89c2\u3001\u786e\u5b9a\u67b6\u6784\u8bbe\u8ba1\u65b9\u5411</p> <ul> <li>\u6982\u5ff5\u9636\u6bb5</li> </ul> <p>\u5212\u5206\u5b50\u7cfb\u7edf\u548c\u6a21\u5757\uff0c\u5b8c\u6210\u5b9e\u4f53\u62bd\u8c61\uff0c\u5b9a\u4e49\u7cfb\u7edf\u8fb9\u754c\u548c\u7cfb\u7edf\u6240\u5904\u7684\u73af\u5883\u3002</p> <ul> <li>\u7ec6\u5316\u9636\u6bb5</li> </ul> <p>\u5b9a\u4e49\u4ea4\u4e92\u673a\u5236\uff0c\u4e5f\u5c31\u662f\u8981\u5b9a\u4e49\u5185\u3001\u5916\u90e8\u63a5\u53e3\u3002</p> <p>\u6301\u7eed\u5173\u6ce8\u975e\u529f\u80fd\u9700\u6c42</p> <p>\u9884\u6d4b\u6700\u7ec8\u529f\u80fd\u5b9e\u73b0\u3001\u9a8c\u8bc1\u67b6\u6784\u5e76\u4f5c\u51fa\u8c03\u6574</p>"},{"location":"design/design-patterns/framework%20design/#41","title":"4.1  \u9884\u5907\u9636\u6bb5","text":"<p>\u67b6\u6784\u8bbe\u8ba1\u6beb\u65e0\u7591\u95ee\u662f\u9700\u6c42\u9a71\u52a8\u7684\u3002\u5168\u9762\u7406\u89e3\u9700\u6c42\uff0c\u4ece\u800c\u628a\u63e1\u9700\u6c42\u7279\u70b9\uff0c\u5bf9\u67b6\u6784\u8bbe\u8ba1\u81f3\u5173\u91cd\u8981\u3002</p>"},{"location":"design/design-patterns/framework%20design/#411","title":"4.1.1 \u9700\u6c42\u7c7b\u578b\uff1a","text":"<p>\u4ece\u7eb5\u5411(\u9700\u6c42\u5c42\u6b21)\u6765\u533a\u5206\u9700\u6c42\u53ef\u4ee5\u5212\u5206\u4e3a\u4e09\u79cd\u7c7b\u522b</p> <p>\u4e0d\u540c\u5c42\u6b21\u7684\u6d89\u4f17\u63d0\u51fa\u9700\u6c42\u6240\u7ad9\u7acb\u573a\u4e0d\u540c</p> <ul> <li>\u4e1a\u52a1\u7ea7\u9700\u6c42</li> </ul> <p>\u6211\u4eec\u8981\u5e72\u4ec0\u4e48\uff1a\u613f\u666f/\u4ea7\u54c1\u6545\u4e8b\uff0c\u5236\u5b9a\u4e1a\u52a1\u76ee\u6807\u3001\u5de5\u671f\u8981\u6c42\uff0c\u4ee5\u53ca\u8981\u7b26\u5408\u54ea\u4e9b\u6807\u51c6</p> <ul> <li>\u7528\u6237\u7ea7\u9700\u6c42</li> </ul> <p>\u7528\u6237\u8981\u5e72\u4ec0\u4e48/\u80fd\u5b8c\u6210\u4ec0\u4e48\uff1a\u56f4\u7ed5\u4e1a\u52a1\u7ea7\u7684\u613f\u666f\uff0c\u62c6\u5206\u7528\u6237\u5728\u4e0d\u540c\u573a\u666f\u7684\u4e0d\u540c\u9700\u6c42\uff0c\u7740\u91cd\u573a\u666f\u7684\u68b3\u7406</p> <ul> <li>\u5f00\u53d1\u7ea7</li> </ul> <p>\u5f00\u53d1\u4eba\u5458\u8981\u5e72\u4ec0\u4e48\uff1a\u57fa\u4e8e\u7528\u6237\u7ea7\u9700\u6c42\u8fdb\u4e00\u6b65\u62c6\u5206\uff0c\u8f93\u51fa\u529f\u80fd\u5217\u8868\uff0c\u8bc4\u4f30\u5f00\u53d1\u8d28\u91cf</p> <p>\u4ece\u6a2a\u5411(\u9700\u6c42\u65b9\u9762)\u6765\u533a\u5206\u9700\u6c42\u53ef\u4ee5\u4e5f\u5212\u5206\u4e3a\u4e09\u79cd\u7c7b\u522b</p> <p>\u9700\u6c42\u5b9a\u4e49\u4e86\u76f4\u63a5\u76ee\u6807\u8fd8\u662f\u95f4\u63a5\u76ee\u6807</p> <ul> <li>\u529f\u80fd\u9700\u6c42</li> </ul> <p>\u66f4\u591a\u4f53\u73b0\u4e86\u4e0a\u9762\u5404\u7ea7\u76f4\u63a5\u76ee\u6807\u8981\u6c42</p> <ul> <li>\u8d28\u91cf\u5c5e\u6027</li> </ul> <p>\u8fd0\u884c\u671f\u8d28\u91cf+\u5f00\u53d1\u671f\u8d28\u91cf</p> <ul> <li>\u7ea6\u675f\u9700\u6c42\uff1a </li> </ul> <p>\u4e1a\u52a1\u73af\u5883+\u4f7f\u7528\u73af\u5883+\u6784\u5efa\u73af\u5883+\u6280\u672f\u73af\u5883</p> <p>\u4efb\u4f55\u9700\u6c42\u90fd\u53ef\u5b9a\u4f4d\u4e8e\u4e1a\u52a1\u7ea7\u9700\u6c42\u3001\u7528\u6237\u7ea7\u9700\u6c42\u3001\u5f00\u53d1\u7ea7\u9700\u6c42\u8fd93\u4e2a\u9700\u6c42\u5c42\u6b21\u7684\u67d0\u4e00\u5c42\uff0c\u540c\u65f6\u4e5f\u5fc5\u5c5e\u4e8e\u529f\u80fd\u3001\u8d28\u91cf\u3001\u7ea6\u675f\u8fd93\u7c7b\u9700\u6c42\u7684\u67d0\u4e00\u7c7b\u3002  </p> <p>\u9700\u6c42\u5c42\u6b21\u548c\u9700\u6c42\u65b9\u9762\u5173\u7cfb\u53ef\u4ee5\u7528\u4ee5\u4e0b\u8868\u683c\u6765\u8868\u793a</p> \u529f\u80fd \u8d28\u91cf \u7ea6\u675f \u4e1a\u52a1\u7ea7\u9700\u6c42 \u4e1a\u52a1\u76ee\u6807 \u5feb\u3001\u597d\u3001\u7701 \u6280\u672f\u6027\u7ea6\u675f\u3001\u6cd5\u89c4\u6027\u7ea6\u675f\u3001\u7ade\u4e89\u56e0\u7d20\u4e0e\u7ade\u4e89\u5bf9\u624b \u7528\u6237\u7ea7\u9700\u6c42 \u7528\u6237\u9700\u6c42 \u8fd0\u884c\u671f\u8d28\u91cf \u7528\u6237\u7fa4\u7279\u70b9\u3001\u7528\u6237\u6c34\u5e73 \u5f00\u53d1\u7ea7\u9700\u6c42 \u884c\u4e3a\u9700\u6c42 \u5f00\u53d1\u671f\u8d28\u91cf \u5f00\u53d1\u56e2\u961f\u6280\u672f\u6c34\u5e73\u3001\u5f00\u53d1\u56e2\u961f\u78e8\u5408\u7a0b\u5ea6\u3001\u5f00\u53d1\u56e2\u961f\u4e1a\u52a1\u77e5\u8bc6 <p>\u4e0d\u540c\u9700\u6c42\uff0c\u5f71\u54cd\u67b6\u6784\u7684\u539f\u7406\u4e0d\u540c</p> \u9700\u6c42 \u57fa\u672c\u539f\u7406 \u5bf9\u67b6\u6784\u8bbe\u8ba1\u7684\u5f71\u54cd \u529f\u80fd \u529f\u80fd\u662f\u53d1\u73b0\u804c\u8d23\u7684\u4f9d\u636e \u6bcf\u4e2a\u529f\u80fd\u90fd\u662f\u7531\u4e00\u6761\u201c\u804c\u8d23\u534f\u4f5c\u94fe\u201d\u5b8c\u6210\u7684 \u2014 \u5c06\u804c\u8d23\u5206\u914d\u5230\u5b50\u7cfb\u7edf\uff0c\u4e3a\u5b50\u7cfb\u7edf\u754c\u5b9a\u63a5\u53e3\u3001\u786e\u5b9a\u57fa\u4e8e\u63a5\u53e3\u7684\u4ea4\u4e92\u673a\u5236 \u8d28\u91cf \u8d28\u91cf\u662f\u5b8c\u5584\u67b6\u6784\u8bbe\u8ba1\u7684\u52a8\u529b \u57fa\u4e8e\u5f53\u524d\u7684\u67b6\u6784\u8bbe\u8ba1\u4e2d\u95f4\u6210\u679c\uff0c\u8fdb\u4e00\u6b65\u8003\u8651\u5177\u4f53\u8d28\u91cf\u8981\u6c42\uff0c\u5bf9\u67b6\u6784\u8bbe\u8ba1\u4e2d\u95f4\u6210\u679c\u8fdb\u884c\u7ec6\u5316\u3001\u8c03\u6574\u3001\u751a\u81f3\u63a8\u5012\u91cd\u6765\uff0c\u4e00\u6b65\u6b65\u5730\u4f7f\u67b6\u6784\u8bbe\u8ba1\u5b8c\u5584\u8d77\u6765 \u7ea6\u675f \u7ea6\u675f\u5bf9\u67b6\u6784\u8bbe\u8ba1\u7684\u5f71\u54cd\u5206\u4e3a\u51e0\u7c7b 1. \u76f4\u63a5\u5236\u7ea6\u8bbe\u8ba1\u51b3\u7b56\u7684\u7ea6\u675f\uff08\u4f8b\u5982\uff1a\u201c\u7cfb\u7edf\u8fd0\u884c\u5728Unix\u5e73\u53f0\u4e4b\u4e0a\u201d\uff092.\u8f6c\u5316\u4e3a\u529f\u80fd\u9700\u6c42\u7684\u7ea6\u675f\uff08\u4f8b\u5982\uff1a\u201d\u672c\u94f6\u884c\u7cfb\u7edf\u6267\u884c\u73b0\u6709\u5229\u7387\u201c\u5f15\u51fa\u201c\u5229\u7387\u8c03\u6574\u201d\u529f\u80fd\uff093. \u8f6c\u5316\u4e3a\u8d28\u91cf\u5c5e\u6027\u9700\u6c42\u7684\u7ea6\u675f\uff08\u4f8b\u5982\uff1a\u201c\u67dc\u5458\u673a\u8ba1\u7b97\u673a\u6c34\u5e73\u4e0d\u9ad8\u201d \u5f15\u51fa\u6613\u7528\u6027\u9700\u6c42\uff09 <p>\u5bf9\u9700\u6c42\u7406\u89e3\u4e0d\u900f\u3001\u9057\u6f0f\u9700\u6c42\u5f80\u5f80\u662f\u67b6\u6784\u8bbe\u8ba1\u5931\u8d25\u7684\u91cd\u8981\u539f\u56e0</p>"},{"location":"design/design-patterns/framework%20design/#412","title":"4.1.2  \u5173\u952e\u9700\u6c42\u51b3\u5b9a\u67b6\u6784\uff0c\u5176\u4f59\u9700\u6c42\u9a8c\u8bc1\u67b6\u6784","text":"<ul> <li>\u529f\u80fd\u9700\u6c42\u505a\u51cf\u6cd5\u3002\u5728\u6240\u6709\u529f\u80fd\u4e2d\u6311\u9009\u4e00\u4e2a\u201c \u5173\u952e\u529f\u80fd\u5b50\u96c6\u201d<ul> <li>\u6838\u5fc3\u529f\u80fd</li> <li>\u5fc5\u505a\u529f\u80fd</li> <li>\u9ad8\u98ce\u9669\u529f\u80fd</li> </ul> </li> <li>\u8d28\u91cf\u5c5e\u6027\u9700\u6c42\u505a\u51cf\u6cd5\u3002\u6839\u636e\u7cfb\u7edf\u6240\u5728\u9886\u57df\u7684\u7279\u70b9\u53ca\u7cfb\u7edf\u89c4\u6a21\u7b49\u56e0\u7d20\uff0c\u786e\u5b9a\u67b6\u6784\u8bbe\u8ba1\u91cd\u70b9\u652f\u6301\u90a3\u4e9b\u8d28\u91cf\u5c5e\u6027</li> <li>\u7ea6\u675f\u6027\u9700\u6c42\u505a\u52a0\u6cd5\u3002\u5145\u5206\u8003\u8651\u9700\u6c42\u65b9\u53ca\u4e1a\u52a1\u73af\u5883\u56e0\u7d20\u3001\u7528\u6237\u7fa4\u53ca\u4f7f\u7528\u73af\u5883\u56e0\u7d20\u3001\u5f00\u53d1\u65b9\u53ca\u6784\u5efa\u73af\u5883\u56e0\u7d20\u3001\u4e1a\u754c\u5f53\u524d\u6280\u672f\u73af\u5883\u7b49\u201c4\u7c7b\u7ea6\u675f\u201d\uff0c\u4ee5\u201c\u505a\u52a0\u6cd5\u201d\u7684\u601d\u7ef4\u5206\u6790\u7ea6\u675f\u5f71\u54cd\u3001\u8bc6\u522b\u7ea6\u675f\u80cc\u540e\u7684\u884d\u751f\u9700\u6c42\u3002</li> </ul>"},{"location":"design/design-patterns/framework%20design/#413-b2c","title":"4.1.3  B2C \u6848\u4f8b","text":""},{"location":"design/design-patterns/framework%20design/#42","title":"4.2 \u6982\u5ff5\u9636\u6bb5","text":""},{"location":"design/design-patterns/framework%20design/#421","title":"4.2.1 \u5b50\u7cfb\u7edf\u5212\u5206\u539f\u5219","text":"<ul> <li>\u804c\u8d23\u5206\u79bb\u539f\u5219</li> </ul> <p>\u804c\u8d23\u4e4b\u95f4\u5e38\u5e38\u662f\u4e0a\u5c42\u4f7f\u7528\u4e0b\u5c42\u7684\u5173\u7cfb---\u4f46\u662f\u6839\u672c\u4e0d\u5173\u5fc3\u4e0a\u5c42\u548c\u4e0b\u5c42\u662f\u5426\u201c\u80fd\u5206\u5e03\u201d\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u3002</p> <ul> <li>\u901a\u7528\u4e13\u7528\u5206\u79bb\u539f\u5219</li> </ul> <p>\u5c06\u901a\u7528\u6027\u4e0d\u540c\u7684\u90e8\u5206\u5212\u5f52\u4e0d\u540c\u7684\u5c42\uff0c\u4e00\u822c\u800c\u8a00\uff0c\u901a\u7528\u7a0b\u5ea6\u8d8a\u5927\uff0c\u6240\u5904\u7684\u5c42\u6b21\u5c31\u8d8a\u9760\u4e0b\u3002</p> <ul> <li>\u6280\u80fd\u5206\u79bb\u539f\u5219</li> </ul> <p>\u9700\u8981\u4e0d\u540c\u5f00\u53d1\u6280\u80fd\u7684\u5355\u5143\u5212\u5f52\u4e0d\u540c\u5b50\u7cfb\u7edf</p> <ul> <li>\u5de5\u4f5c\u91cf\u5747\u8861\u539f\u5219</li> </ul> <p>\u517c\u987e\u5de5\u4f5c\u91cf\u7684\u76f8\u5bf9\u5747\u8861\uff0c\u8fdb\u4e00\u6b65\u5207\u5206\u592a\u5927\u7684\u5b50\u7cfb\u7edf</p> <p></p> <p>\u6982\u5ff5\u9636\u6bb5\u6ee1\u8db3\u201c\u67b6\u6784=\u7ec4\u4ef6+\u4ea4\u4e92\u201d\u7684\u57fa\u672c\u5b9a\u4e49\uff0c\u53ea\u4e0d\u8fc7\u6982\u5ff5\u67b6\u6784\u4ec5\u5173\u6ce8\u9ad8\u5c42\u7ec4\u4ef6</p> <p>\u6982\u5ff5\u9636\u6bb5\u5bf9\u9ad8\u5c42\u7ec4\u4ef6\u7684\u201c\u804c\u8d23\u201d\u8fdb\u884c\u7b3c\u7edf\u7684\u754c\u5b9a\uff0c\u5e76\u7ed9\u51fa\u4e86\u9ad8\u5c42\u7ec4\u4ef6\u4e4b\u95f4\u7684\u76f8\u4e92\u5173\u7cfb</p> <p>\u6982\u5ff5\u67b6\u6784\u4e0d\u5e94\u8be5\u6d89\u53ca\u63a5\u53e3\u7ec6\u8282</p>"},{"location":"design/design-patterns/framework%20design/#43","title":"4.3 \u7ec6\u8282\u9636\u6bb5","text":"<ul> <li>\u5b9a\u4e49\u4ea4\u4e92\u673a\u5236</li> </ul> <p>\u57fa\u4e8e\u63a5\u53e3\u7f16\u7a0b\uff1f\u6d88\u606f\u673a\u5236\uff1f\u8fdc\u7a0b\u65b9\u6cd5\u8c03\u7528\uff1f</p> <ul> <li>\u6301\u7eed\u5173\u6ce8\u975e\u529f\u80fd\u9700\u6c42</li> </ul> <p>\u901f\u5ea6\uff1f\u541e\u5410\u91cf\uff1fCPU\u4f7f\u7528\u7387\uff1f\u7f51\u7edcIO\uff1f</p> <ul> <li>\u9884\u6d4b\u6700\u7ec8\u529f\u80fd\u5b9e\u73b0\u3001\u9a8c\u8bc1\u67b6\u6784\u5e76\u4f5c\u51fa\u8c03\u6574</li> </ul> <p>\u8d28\u7591\u2014&gt; \u9a8c\u8bc1 \u2014&gt; \u6539\u8fdb</p>"},{"location":"design/design-patterns/framework%20design/#5","title":"5. \u67b6\u6784\u6f14\u8fdb","text":""},{"location":"design/design-patterns/framework%20design/#51","title":"5.1 \u4e3a\u4ec0\u4e48","text":"<p>\u67b6\u6784\u662f\u4e3a\u4e86\u4e1a\u52a1\u9700\u6c42\u573a\u666f\u670d\u52a1\uff0c\u90a3\u5b83\u4e5f\u8981\u987a\u5e94\u4e1a\u52a1\u7684\u53d8\u5316\u800c\u9002\u65f6\u8c03\u6574\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u67b6\u6784\u9700\u8981\u8ddf\u968f\u4e1a\u52a1\u7684\u53d1\u5c55\u800c\u6f14\u8fdb\u3002</p>"},{"location":"design/design-patterns/framework%20design/#52","title":"5.2 \u597d\u5904","text":"<ul> <li>\u6253\u7834\u4e0d\u6ee1</li> </ul> <p>\u9700\u8981\u6253\u7834\u4fdd\u5b88\u7684\u505a\u6cd5\uff0c\u8981\u79ef\u6781\u9762\u5bf9\u4e0d\u5408\u7406\u7684\u5730\u65b9\u3002\u56e2\u961f\u5b9a\u671f\u9700\u8981\u7740\u624b\u5f00\u542f\u91cd\u6784\uff0c\u5c06\u5927\u5bb6\u5e73\u65e5\u5bf9\u4ee3\u7801\u7684\u4e0d\u6ee1\u91ca\u653e\u51fa\u6765\u3002\u5c06\u67b6\u6784\u7684\u8150\u5316\uff08\u6548\u7387\u964d\u4f4e\u3001\u62b1\u6028\u4e0a\u5347\uff09\u8f6c\u5316\u4e3a\u67b6\u6784\u4f18\u5316\u7684\u52a8\u529b\u3002</p> <ul> <li>\u91cd\u6784\u4fe1\u4efb</li> </ul> <p>\u91cd\u6784\u5f00\u53d1\u8005\u4e4b\u95f4\u7684\u5fc3\u6001\uff0c\u4e0d\u5b9a\u671f\u7684\u63a8\u52a8\u6a21\u5757\u91cd\u6784\u3002\u4e00\u4e9b\u95ee\u9898\u7684\u89e3\u51b3\uff0c\u5f80\u5f80\u53ef\u4ee5\u63a8\u52a8\u66f4\u591a\u4eba\u53bb\u5c1d\u8bd5\u3002</p> <ul> <li>\u56e2\u961f\u57f9\u517b</li> </ul> <p>\u91cd\u6784\u4e5f\u662f\u56e2\u961f\u8fdb\u6b65\u7684\u673a\u4f1a\uff0c\u8ba9\u66f4\u591a\u7684\u6210\u5458\u638c\u63e1\u67b6\u6784\u80fd\u529b\uff0c\u57f9\u517b\u5168\u5458\u67b6\u6784\u610f\u8bc6\uff0c\u5b9e\u73b0\u201c\u4eba\u4eba\u90fd\u662f\u67b6\u6784\u5e08\u201d</p>"},{"location":"design/design-patterns/framework%20design/#53","title":"5.3 \u6280\u672f\u89c6\u91ce\uff08\u8fa8\u522b\u80fd\u529b\uff09","text":"<p>\u7ed3\u5408\u4e1a\u52a1\u548c\u56e2\u961f\u5f53\u524d\u7684\u60c5\u51b5\uff0c\u505a\u51fa\u5408\u7406\u7684\u5224\u65ad\uff0c\u8981\u6e05\u695a\u7684\u77e5\u9053\u505a\u4ec0\u4e48\u4e8b\u60c5\u6536\u76ca\u6700\u5927\u3002</p> <ul> <li>\u6280\u672f\u6808\u7684\u9009\u62e9\u548c\u6bd4\u8f83</li> <li>\u67b6\u6784\u8bbe\u8ba1\u7684\u8003\u8651</li> </ul>"},{"location":"design/design-patterns/framework%20design/#54","title":"5.4 \u600e\u4e48\u505a","text":"<ul> <li>\u6f14\u8fdb\u5f0f\u7684\uff0c\u7b26\u5408\u56e2\u961f\u73b0\u72b6\u7684</li> </ul> <p>\u9700\u8981\u6743\u8861\u6027\u80fd\u3001\u6210\u672c\u3001\u65f6\u95f4\u4e09\u8005\u7684\u5173\u7cfb</p> <ul> <li>\u53ef\u5ea6\u91cf\u7684\uff0c\u6bcf\u4e2a\u9636\u6bb5\u90fd\u8981\u6709\u6210\u679c</li> </ul> <p>\u200b       \u5206\u9636\u6bb5\u5b9e\u65bd\uff0c\u5e76\u4e14\u6bcf\u4e2a\u9636\u6bb5\u90fd\u8981\u6709\u6210\u679c</p>"},{"location":"design/design-patterns/framework%20design/#6","title":"6.  \u67b6\u6784\u98ce\u683c\u3001\u67b6\u6784\u6a21\u5f0f\u3001\u8bbe\u8ba1\u6a21\u5f0f\u3001\u4ee3\u7801\u6a21\u5f0f","text":""},{"location":"design/design-patterns/framework%20design/#61","title":"6.1  \u67b6\u6784\u98ce\u683c","text":"<p>\u67b6\u6784\u98ce\u683c\u975e\u5e38\u7c97\u7565\u5730\u544a\u8bc9\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u7ec4\u7ec7\u4ee3\u7801\u3002\u5b83\u7684\u7c92\u5ea6\u6bd4\u8f83\u5927\uff0c\u8bf4\u660e\u4e86\u5e94\u7528\u7684\u5206\u5c42\u548c\u9ad8\u5c42\u7ea7\u7684\u6a21\u5757\uff0c\u8fd9\u4e9b\u6a21\u5757\u548c\u5c42\u6b21\u4e4b\u95f4\u5982\u4f55\u4ea4\u4e92\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u5173\u7cfb\u3002\u67b6\u6784\u98ce\u683c\u7684\u4f8b\u5b50\u6709\uff1a</p> <ul> <li>\u57fa\u4e8e\u7ec4\u4ef6</li> <li>\u5355\u4f53\u5e94\u7528</li> <li>\u5206\u5c42</li> <li>\u7ba1\u9053\u548c\u8fc7\u6ee4\u5668</li> <li>\u4e8b\u4ef6\u9a71\u52a8</li> <li>\u53d1\u5e03\u8ba2\u9605</li> <li>\u63d2\u4ef6</li> <li>\u5ba2\u6237\u7aef\u670d\u52a1\u5668</li> <li>\u9762\u5411\u670d\u52a1</li> </ul>"},{"location":"design/design-patterns/framework%20design/#62","title":"6.2 \u67b6\u6784\u6a21\u5f0f","text":"<p>\u6a21\u5f0f \u2014 \u5728\u67d0\u79cd\u573a\u666f\u4e0b\u91cd\u590d\u53d1\u751f\u7684\u95ee\u9898\u7684\u89e3\u51b3\u529e\u6cd5</p> <p>\u67b6\u6784\u6a21\u5f0f\u89e3\u51b3\u7684\u5c31\u662f\u548c\u67b6\u6784\u98ce\u683c\u76f8\u5173\u7684\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u201c \u8981\u5b9e\u73b0\u4e00\u4e2a\u7279\u5b9a\u5c42\u6b21\u7ec4\u5408\u7684\u7cfb\u7edf\uff0c\u6211\u4eec\u9700\u8981\u54ea\u4e9b\u7c7b\uff0c\u5b83\u4eec\u53c8\u5982\u4f55\u4ea4\u4e92\u201d\uff0c\u6216\u8005\u201c \u6211\u4eec\u7684\u9762\u5411\u670d\u52a1\u67b6\u6784\u4e2d\u9700\u8981\u591a\u5c11\u9ad8\u5c42\u7ea7\u7684\u6a21\u5757\uff0c\u800c\u5b83\u4eec\u5e94\u8be5\u5982\u4f55\u901a\u4fe1\u201d\uff0c\u53c8\u6216\u8005\u201c \u6211\u4eec\u7684\u5ba2\u6237\u7aef\u670d\u52a1\u5668\u67b6\u6784\u8981\u5206\u6210\u591a\u5c11\u4e2a\u7269\u7406\u5c42\u201d\u3002\u67b6\u6784\u6a21\u5f0f\u662f\u4e00\u4e2a\u7cfb\u7edf\u7684\u9ad8\u5c42\u6b21\u7b56\u7565\uff0c\u6d89\u53ca\u5230\u5927\u5c3a\u5ea6\u7684\u7ec4\u4ef6\u4ee5\u53ca\u6574\u4f53\u6027\u8d28\u548c\u529b\u5b66\u3002\u67b6\u6784\u6a21\u5f0f\u7684\u597d\u574f\u53ef\u4ee5\u5f71\u54cd\u5230\u603b\u4f53\u5e03\u5c40\u548c\u6846\u67b6\u6027\u7ed3\u6784\u3002</p> <ul> <li>MVC</li> <li>MVP</li> <li>MVVM</li> <li>\u5fae\u5185\u6838</li> </ul>"},{"location":"design/design-patterns/framework%20design/#63","title":"6.3 \u8bbe\u8ba1\u6a21\u5f0f","text":"<p>\u8bbe\u8ba1\u6a21\u5f0f\u662f\u9002\u7528\u4e8e\u8f6f\u4ef6\u8bbe\u8ba1\u548c\u5f00\u53d1\u9886\u57df\u7684\u4e00\u79cd\u6a21\u5f0f\uff0c\u662f\u5bf9\u8f6f\u4ef6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u91cd\u590d\u53d1\u751f\u7684\u95ee\u9898\u7684\u89e3\u51b3\u529e\u6cd5\u3002\u8bbe\u8ba1\u6a21\u5f0f\u662f\u4e2d\u7b49\u5c3a\u5ea6\u7684\u7ed3\u6784\u7b56\u7565\u3002\u8fd9\u4e9b\u4e2d\u7b49\u5c3a\u5ea6\u7684\u7ed3\u6784\u5b9e\u73b0\u4e86\u4e00\u4e9b\u5927\u5c3a\u5ea6\u7ec4\u4ef6\u7684\u884c\u4e3a\u548c\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\u6a21\u5f0f\u7684\u597d\u574f\u4e0d\u4f1a\u5f71\u54cd\u5230\u7cfb\u7edf\u7684\u603b\u4f53\u5e03\u5c40\u548c\u603b\u4f53\u6846\u67b6\u3002\u8bbe\u8ba1\u6a21\u5f0f\u5b9a\u4e49\u51fa\u5b50\u7cfb\u7edf\u6216\u7ec4\u4ef6\u7684\u5fae\u89c2\u7ed3\u6784\u3002</p>"},{"location":"design/design-patterns/framework%20design/#64","title":"6.4 \u4ee3\u7801\u6a21\u5f0f\uff08\u6216\u6210\u4f8b\uff09","text":"<p>\u4ee3\u7801\u6a21\u5f0f\uff08\u6216\u6210\u4f8b\uff09\u662f\u7279\u5b9a\u7684\u8303\u4f8b\u548c\u4e0e\u7279\u5b9a\u8bed\u8a00\u6709\u5173\u7684\u7f16\u7a0b\u6280\u5de7\u3002\u4ee3\u7801\u6a21\u5f0f\u7684\u597d\u574f\u4f1a\u5f71\u54cd\u5230\u4e00\u4e2a\u4e2d\u7b49\u5c3a\u5ea6\u7ec4\u4ef6\u7684\u5185\u90e8\u3001\u5916\u90e8\u7684\u7ed3\u6784\u6216\u884c\u4e3a\u7684\u5e95\u5c42\u7ec6\u8282\uff0c\u4f46\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e00\u4e2a\u90e8\u4ef6\u6216\u5b50\u7cfb\u7edf\u7684\u4e2d\u7b49\u5c3a\u5ea6\u7684\u7ed3\u6784\uff0c\u66f4\u4e0d\u4f1a\u5f71\u54cd\u5230\u7cfb\u7edf\u7684\u603b\u4f53\u5e03\u5c40\u548c\u5927\u5c3a\u5ea6\u6846\u67b6\u3002</p>"},{"location":"design/design-patterns/framework%20design/#7","title":"7. \u5e38\u89c1\u67b6\u6784\u6a21\u5f0f","text":""},{"location":"design/design-patterns/framework%20design/#71","title":"7.1 \u5206\u5c42","text":"<p>\u5206\u5c42\u67b6\u6784\u6a21\u5f0f\u91cc\u7684\u7ec4\u4ef6\u88ab\u5206\u6210\u2f0f\u4e2a\u5e73\u884c\u7684\u5c42\u6b21\uff0c\u6bcf\u4e00\u5c42\u90fd\u4ee3\u8868\u4e86\u5e94\u7528\u7684\u4e00\u4e2a\u529f\u80fd(\u5c55\u2f70\u793a\u903b\u8f91\u6216\u8005\u4e1a\u52a1\u903b\u8f91)\u3002 \u5c3d\u7ba1\u5206\u5c42\u67b6\u6784\u6ca1\u6709\u89c4\u5b9a\u2f83\u81ea\u2f9d\u8eab\u8981\u5206\u6210\u51e0\u5c42\u51e0\u79cd\uff0c\u5927\u591a\u6570\u7684\u7ed3\u6784\u90fd\u5206\u6210\u56db\u4e2a\u5c42\u6b21:\u5c55\u2f70\u5c42\uff0c\u4e1a\u52a1\u5c42\uff0c\u6301\u4e45\u5c42\uff0c\u548c\u6570 \u636e\u5e93\u5c42\u3002</p> <p>\u5206\u5c42\u67b6\u6784\u7684\u4e00\u4e2a\u7a81\u51fa\u7279\u6027\u662f\u7ec4\u4ef6\u95f4\u5173\u6ce8\u70b9\u5206\u79bb\u3002\u4e00\u4e2a\u5c42\u4e2d\u7684\u7ec4\u4ef6\u53ea\u4f1a\u5904\u7406\u672c\u5c42\u7684\u903b\u8f91\u3002\u6bd4\u5982\u8bf4\uff0c\u5c55\u2f70\u5c42\u7684\u7ec4\u4ef6\u53ea\u4f1a\u5904\u7406\u5c55\u793a\u903b\u8f91\uff0c\u4e1a\u52a1\u5c42\u4e2d\u7684\u7ec4\u4ef6\u53ea\u4f1a\u53bb\u5904\u7406\u4e1a\u52a1\u903b\u8f91</p> <p>\u5206\u5c42\u67b6\u6784\u7684\u53e6\u5916\u4e00\u4e2a\u7279\u6027\u662f\u5c42\u9694\u79bb\uff0c\u5c31\u662f\u8bf4\u67b6\u6784\u4e2d\u7684\u67d0\u4e00\u5c42\u7684\u6539\u53d8\u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u5c42:\u8fd9\u4e9b\u53d8\u5316\u7684\u5f71\u54cd\u8303\u56f4\u9650\u4e8e\u5f53\u524d\u5c42\u6b21\u3002\u5982\u679c\u5c55\u793a\u5c42\u80fd\u591f\u76f4\u63a5\u8bbf\u95ee\u6301\u4e45\u5c42\u4e86\uff0c\u5047\u5982\u6301\u4e45\u5c42\u4e2d\u7684SQL\u53d8\u5316\u4e86\uff0c\u8fd9\u5bf9\u4e1a\u52a1\u5c42\u548c\u5c55\u2f70\u793a\u5c42\u90fd\u6709\u4e00\u5b9a\u7684\u5f71\u54cd\u3002</p>"},{"location":"design/design-patterns/framework%20design/#72","title":"7.2 \u4e8b\u4ef6\u9a71\u52a8\u67b6\u6784","text":"<p>\u4e8b\u4ef6\u9a71\u52a8\u67b6\u6784\u6a21\u5f0f\u662f\u4e00\u79cd\u4e3b\u6d41\u7684\u5f02\u6b65\u5206\u53d1\u4e8b\u4ef6\u67b6\u6784\u6a21\u5f0f\uff0c\u5e38\u7528\u4e8e\u8bbe\u8ba1\u9ad8\u5ea6\u53ef\u62d3\u5c55\u7684\u5e94\u2f64\u3002\u5f53\u7136\u4e86\uff0c\u5b83\u6709\u5f88\u9ad8 \u7684\u9002\u5e94\u6027\uff0c\u4f7f\u5f97\u5b83\u5728\u5c0f\u578b\u5e94\u7528\u3001\u5927\u578b\u5e94\u7528\u3001\u590d\u6742\u5e94\u7528\u4e2d\u90fd\u80fd\u8868\u73b0\u5f97\u5f88\u597d\u3002\u4e8b\u4ef6\u9a71\u52a8\u67b6\u6784\u6a21\u5f0f\u7531\u9ad8\u5ea6\u89e3\u8026\u3001\u5355 \u2f00\u76ee\u7684\u7684\u4e8b\u4ef6\u5904\u7406\u7ec4\u4ef6\u6784\u6210\uff0c\u8fd9\u4e9b\u7ec4\u4ef6\u8d1f\u8d23\u5f02\u6b65\u63a5\u6536\u548c\u5904\u7406\u4e8b\u4ef6\u3002</p>"},{"location":"design/design-patterns/framework%20design/#73","title":"7.3 \u5fae\u5185\u6838\u67b6\u6784","text":"<p>\u5fae\u5185\u6838\u67b6\u6784\u6a21\u5f0f\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u7684\u5f62\u5f0f\u6dfb\u52a0\u989d\u5916\u7684\u7279\u6027\u5230\u6838\u2f3c\u5fc3\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u63d0\u4f9b\u4e86\u5f88\u597d\u7684\u6269\u5c55\u6027\uff0c\u4e5f\u4f7f\u5f97\u65b0\u7279\u6027\u4e0e\u6838\u2f3c\u7cfb\u7edf\u9694\u79bb\u5f00\u6765\u3002( \u6bd4\u5982\uff0c\u8457\u540d\u7684Eclipse IDE\u5c31\u662f\u57fa\u4e8e\u63d2\u4ef6\u5316\u5f00\u53d1\u7684\uff0ceclipse\u6838\u5fc3\u66f4\u50cf\u662f\u4e00\u4e2a\u5fae\u5185\u6838\uff0c \u6216\u8005\u6211\u4eec\u53ef\u628a\u5b83\u53eb\u505a\u5f00\u653e\u5e73\u53f0\uff0c\u5176\u4ed6\u7684\u529f\u80fd\u901a\u8fc7\u5b89\u88c5\u63d2\u4ef6\u7684\u5f62\u5f0f\u6dfb\u52a0\u5230eclipse\u4e2d\u3002 )</p>"},{"location":"design/design-patterns/framework%20design/#74","title":"7.4 \u5fae\u670d\u52a1\u67b6\u6784","text":"<p>\u670d\u52a1\u7ec4\u4ef6</p> <p>\u4e0d\u8981\u8003\u8651\u5fae\u670d\u52a1\u67b6\u6784\u5185\u90e8\u7684\u670d\u52a1\uff0c\u2f7d\u6700\u597d\u662f\u8003\u8651\u670d\u52a1\u7ec4\u4ef6\uff0c\u4ece\u7c92\u5ea6\u4e0a\u8bb2\u5b83\u53ef\u4ee5\u5c0f\u5230\u5355\u2f00\u7684\u6a21\u5757\uff0c\u6216\u8005\u2f24\u81f3\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3002\u670d\u52a1\u7ec4\u4ef6\u5305\u542b\u2f00\u4e2a\u6216\u591a\u4e2a\u6a21\u5757(\u5982Java\u7c7b)\uff0c\u8fd9\u4e9b\u6a21\u5757\u53ef\u4ee5\u63d0\u4f9b\u2f00\u4e2a\u5355\u4e00\u529f\u80fd(\u5982\uff0c\u4e3a\u7279\u5b9a\u7684\u57ce\u5e02\u6216\u57ce\u9547\u63d0\u4f9b\u5929\u2f53\u6c14\u60c5\u51b5)\uff0c\u6216\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5927\u578b\u5546\u4e1a\u5e94\u7528\u7684\u2f00\u4e2a\u72ec\u2f74\u90e8\u5206(\u5982\uff0c\u80a1\u7968\u4ea4\u6613\u5e03\u5c40\u6216\u6d4b\u5b9a\u6c7d\u2ecb\u8f66\u4fdd\u9669\u7684\u8d39\u7387)\u3002\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u6b63\u786e\u8bbe\u8ba1\u670d\u52a1\u7ec4\u4ef6\u7684\u7c92\u5ea6\u662f\u2f00\u4e2a\u5f88\u5927\u7684\u6311\u6218\u3002</p> <p>\u5206\u5e03\u5f0f</p> <p>\u5fae\u670d\u52a1\u67b6\u6784\u6a21\u5f0f\u7684\u53e6\u2f00\u4e2a\u5173\u952e\u6982\u5ff5\u662f\u5b83\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u67b6\u6784\uff0c\u8fd9\u610f\u5473\u7740\u67b6\u6784\u5185\u90e8\u7684\u6240\u6709\u7ec4\u4ef6\u4e4b\u95f4\u662f\u5b8c\u5168\u89e3\u8026 \u7684\uff0c\u5e76\u901a\u8fc7\u67d0\u79cd\u8fdc\u7a0b\u8bbf\u95ee\u534f\u8bae(\u5982\uff0c JMS, AMQP, REST, SOAP, RMI\u7b49)\u8fdb\u2f8f\u884c\u8bbf\u95ee\u3002\u8fd9\u79cd\u67b6\u6784\u7684\u5206\u5e03\u5f0f\u7279\u6027 \u662f\u5b83\u5b9e\u73b0\u2f00\u4e9b\u4f18\u8d8a\u7684\u53ef\u6269\u5c55\u6027\u548c\u90e8\u7f72\u7279\u6027\u7684\u5173\u952e\u6240\u5728\u3002</p> <p>\u5fae\u670d\u52a1\u67b6\u6784\u6a21\u5f0f\u7684\u4e3b\u8981\u6311\u6218\u4e4b\u4e00\u5c31\u662f\u51b3\u5b9a\u670d\u52a1\u7ec4\u4ef6\u7684\u7c92\u5ea6\u7ea7\u522b\u3002\u5982\u679c\u670d\u52a1\u7ec4\u4ef6\u7c92\u5ea6\u8fc7\u7c97\uff0c\u90a3\u4f60\u53ef\u80fd\u4e0d\u4f1a\u610f\u8bc6 \u5230\u8fd9\u4e2a\u67b6\u6784\u6a21\u5f0f\u5e26\u6765\u7684\u597d\u5904(\u90e8\u7f72\u3001\u53ef\u6269\u5c55\u6027\u3001\u53ef\u6d4b\u8bd5\u6027\u548c\u677e\u8026\u5408)\uff0c\u7136\u800c,\u670d\u52a1\u7ec4\u4ef6\u7c92\u5ea6\u8fc7\u7ec6\u5c06\u5bfc\u81f4\u5f88\u5feb\u5c06\u5fae\u670d\u52a1\u67b6\u6784\u6a21\u5f0f\u53d8\u6210\u2f00\u4e2a\u590d\u6742\u3001\u5bb9\u6613\u6df7\u6dc6\u3001\u4ee3\u4ef7\u6602\u8d35\u5e76\u6613\u4e8e\u51fa\u9519\u7684\u91cd\u91cf\u7ea7\u9762\u5411\u670d\u52a1\u67b6\u6784\u3002 </p>"},{"location":"design/design-patterns/framework%20design/#_1","title":"\u53c2\u8003","text":"<p>\u300a\u4e00\u7ebf\u67b6\u6784\u5e08\u5b9e\u8df5\u6307\u5357\u300b</p>"},{"location":"design/design-patterns/index_behavioral/","title":"\u6982\u8ff0","text":""},{"location":"design/design-patterns/index_behavioral/#_1","title":"\u884c\u4e3a\u578b\u6a21\u5f0f","text":"<p>\u8fd9\u7c7b\u6a21\u5f0f\u8d1f\u8d23\u5bf9\u8c61\u95f4\u7684\u9ad8\u6548\u6c9f\u901a\u548c\u804c\u8d23\u59d4\u6d3e\u3002</p>"},{"location":"design/design-patterns/index_creational/","title":"\u6982\u8ff0","text":""},{"location":"design/design-patterns/index_creational/#_1","title":"\u521b\u5efa\u578b\u6a21\u5f0f","text":"<p>\u521b\u5efa\u578b\u6a21\u5f0f\u63d0\u4f9b\u4e86\u521b\u5efa\u5bf9\u8c61\u7684\u673a\u5236\uff0c \u80fd\u591f\u63d0\u5347\u5df2\u6709\u4ee3\u7801\u7684\u7075\u6d3b\u6027\u548c\u53ef\u590d\u7528\u6027\u3002</p>"},{"location":"design/design-patterns/index_structural/","title":"\u6982\u8ff0","text":""},{"location":"design/design-patterns/index_structural/#_1","title":"\u7ed3\u6784\u578b\u6a21\u5f0f","text":"<p>\u7ed3\u6784\u578b\u6a21\u5f0f\u4ecb\u7ecd\u5982\u4f55\u5c06\u5bf9\u8c61\u548c\u7c7b\u7ec4\u88c5\u6210\u8f83\u5927\u7684\u7ed3\u6784\uff0c \u5e76\u540c\u65f6\u4fdd\u6301\u7ed3\u6784\u7684\u7075\u6d3b\u548c\u9ad8\u6548\u3002</p>"},{"location":"design/design-patterns/prototype/","title":"\u539f\u578b\u6a21\u5f0f","text":""},{"location":"design/design-patterns/prototype/#1","title":"1. \u5b9a\u4e49","text":"<p>\u901a\u8fc7\u201c\u590d\u5236\u201d\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u5b9e\u4f8b\u6765\u8fd4\u56de\u65b0\u7684\u5b9e\u4f8b\uff0c\u88ab\u590d\u5236\u7684\u5b9e\u4f8b\u5c31\u662f\u6211\u4eec\u6240\u79f0\u7684\u201c\u539f\u578b\u201d\u3002</p>"},{"location":"design/design-patterns/prototype/#2","title":"2. \u89d2\u8272","text":"<ul> <li>Prototype: \u539f\u578b</li> </ul> <p>\u5b9a\u4e49\u7528\u4e8e\u590d\u5236\u73b0\u6709\u5b9e\u4f8b\u6765\u751f\u6210\u65b0\u5b9e\u4f8b\u7684\u65b9\u6cd5</p> <ul> <li>ConcretePrototype:\u5177\u4f53\u539f\u578b</li> </ul> <p>\u5177\u4f53\u8d1f\u8d23\u590d\u5236\u4efb\u52a1\u7684\u7c7b</p> <ul> <li>Client\uff1a\u4f7f\u7528\u8005</li> </ul> <p>\u8ba9\u4e00\u4e2a\u539f\u578b\u5bf9\u8c61\u514b\u9686\u81ea\u8eab\u4ece\u800c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61</p> <p></p>"},{"location":"design/design-patterns/prototype/#3","title":"3. \u793a\u4f8b","text":"<p>java\u4e2d\u63d0\u4f9b\u4e86\u5bf9\u8c61\u590d\u5236\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u5b9e\u73b0<code>clonable</code>\u63a5\u53e3\u548c\u8c03\u7528\u5bf9\u8c61\u7684<code>clone</code>\u65b9\u6cd5\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u8c61\u590d\u5236\uff0c\u4e0b\u9762\u5c31\u4ee5\u8fd9\u4e2a\u4e3a\u57fa\u7840\u7b80\u5355\u5b9e\u73b0\u4e00\u4e0b\u539f\u578b\u6a21\u5f0f</p> <pre><code>/** \u201cPrototype\u201c **/\npublic class Prototype implements Cloneable {\n@Override\nprotected Object clone() throws CloneNotSupportedException {\nreturn (Prototype) super.clone();\n}\n}\n/** \u201dConcrete Prototypes\u201c **/\npublic class ConcretePrototype extends Prototype {}\n/** \u201dClient\u201c**/\npublic class PrototypeManager {\nprivate Prototype prototype;\npublic PrototypeManager(Prototype prototype) {\nthis.prototype = prototype;\n}\npublic Prototype create() {\ntry {\nreturn (Prototype) prototype.clone();\n} catch (CloneNotSupportedException e) {\ne.printStackTrace();\n}\nreturn null;\n}\n}\n/** \u8c03\u7528**/ public static void main(String[] args) {\nPrototype prototype = new ConcretePrototype();\nPrototypeManager pm = new PrototypeManager(prototype); //\u8bbe\u7f6e\u539f\u578b\nPrototype tempProt = pm.create(); //\u901a\u8fc7\u590d\u5236\u539f\u578b\u8fd4\u56de\u5bf9\u8c61\n}\n</code></pre> <p>\u6ce8\u610f\uff1ajava \u5bf9\u8c61clone\u65b9\u6cd5\u8fdb\u884c\u7684\u662f\u6d45\u590d\u5236\uff0c\u6240\u8c13\u7684\u6d45\u62f7\u8d1d\u5c31\u662f\u62f7\u8d1d\u6307\u5411\u5bf9\u8c61\u7684\u5f15\u7528\u3002\u5047\u8bbe\u5bf9\u8c61\u4e2d\u6709\u4e00\u4e2a\u6570\u7ec4\u5b57\u6bb5\uff0c\u90a3\u4e48\u62f7\u8d1d\u51fa\u6765\u7684\u5bf9\u8c61\u548c\u539f\u6765\u7684\u5bf9\u8c61\u7684\u786e\u4e0d\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\uff08\u5f15\u7528\u4e0d\u540c\uff09\uff0c\u4f46\u4e24\u4e2a\u5bf9\u8c61\u91cc\u9762\u7684\u6570\u7ec4\u5b57\u6bb5\u90fd\u6307\u5411\u540c\u4e00\u4e2a\u5f15\u7528\u3002\u8981\u5b9e\u73b0\u771f\u6b63\u7684\u6df1\u62f7\u8d1d\uff0c\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199<code>clone</code>\u65b9\u6cd5\u5b9e\u73b0\u81ea\u5df1\u7684\u590d\u5236\u65b9\u6cd5\u5b9e\u73b0\u3002</p>"},{"location":"design/design-patterns/prototype/#4","title":"4. \u4f18\u70b9","text":"<ul> <li>\u63d0\u9ad8\u6027\u80fd\u548c\u6548\u7387</li> </ul> <p>\u5f53\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\u5b9e\u4f8b\u8f83\u4e3a\u590d\u6742\u65f6\uff08\u9700\u8981\u975e\u5e38\u7e41\u7410\u7684\u6570\u636e\u51c6\u5907\uff09\uff0c\u901a\u8fc7\u590d\u5236\u4e00\u4e2a\u5df2\u6709\u5b9e\u4f8b\u53ef\u4ee5\u63d0\u9ad8\u65b0\u5b9e\u4f8b\u7684\u521b\u5efa\u6548\u7387\u3002</p> <ul> <li>\u53ef\u4ee5\u4fdd\u5b58\u5bf9\u8c61\u7684\u72b6\u6001</li> </ul> <p>\u4f7f\u7528\u539f\u578b\u6a21\u5f0f\u5c06\u5bf9\u8c61\u590d\u5236\u4e00\u4efd\u5e76\u5c06\u5176\u72b6\u6001\u4fdd\u5b58\u8d77\u6765\uff0c\u4ee5\u4fbf\u5728\u9700\u8981\u7684\u65f6\u5019\u4f7f\u7528\uff08\u5982\u6062\u590d\u5230\u67d0\u4e00\u5386\u53f2\u72b6\u6001\uff09\uff0c\u53ef\u8f85\u52a9\u5b9e\u73b0\u64a4\u9500\u64cd\u4f5c\u3002</p> <p>\u6211\u4eec\u65e5\u5e38\u7528\u5230\u7684\u590d\u5236(Ctrl + C)\u548c\u7c98\u8d34(Ctrl + V)\u64cd\u4f5c\u3001\u5f00\u53d1\u7528\u5230\u7684IDE\u63d0\u4f9b\u7684\u64a4\u9500\u548c\u6062\u590d\u5386\u53f2\u64cd\u4f5c\u5c31\u662f\u539f\u578b\u6a21\u5f0f\u7684\u5178\u578b\u5e94\u7528</p>"},{"location":"design/design-patterns/prototype/#5","title":"5. \u7f3a\u70b9","text":"<ul> <li>\u5b9e\u73b0\u9ebb\u70e6</li> </ul> <p>\u8981\u662f\u60f3\u5b9e\u73b0\u6df1\u590d\u5236\uff0c\u5f53\u5bf9\u8c61\u5b58\u5728\u591a\u5c42\u5d4c\u5957\u5f15\u7528\u65f6\uff0c\u6bcf\u4e00\u5c42\u5bf9\u8c61\u5bf9\u5e94\u7684\u7c7b\u90fd\u5fc5\u987b\u652f\u6301\u6df1\u590d\u5236\uff0c\u5b9e\u73b0\u6bd4\u8f83\u9ebb\u70e6</p>"},{"location":"design/design-patterns/prototype/#6","title":"6. \u9002\u7528\u573a\u666f","text":"<ul> <li>\u521b\u5efa\u590d\u6742\u7684\u6216\u8005\u8017\u65f6\u7684\u5b9e\u4f8b</li> </ul> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7\u590d\u5236\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u5b9e\u4f8b\u66f4\u9ad8\u6548</p>"},{"location":"design/design-patterns/proxy/","title":"\u4ee3\u7406\u6a21\u5f0f","text":""},{"location":"design/design-patterns/proxy/#_1","title":"\u5b9a\u4e49","text":"<p>\u7ed9\u67d0\u4e00\u4e2a\u5bf9\u8c61\u63d0\u4f9b\u4e00\u4e2a\u4ee3\u7406\uff0c\u5e76\u7531\u4ee3\u7406\u5bf9\u8c61\u63a7\u5236\u5bf9\u539f\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u4ee3\u7406\u5bf9\u8c61\u4f5c\u4e3a\u539f\u5bf9\u8c61\u7684\u63a5\u53e3\uff0c\u4ee3\u8868\u539f\u5bf9\u8c61\u7684\u529f\u80fd\u3002</p>"},{"location":"design/design-patterns/proxy/#_2","title":"\u89d2\u8272","text":"<ul> <li>Subject: \u62bd\u8c61\u4e3b\u4f53</li> </ul> <p>\u5b9a\u4e49\u4f7fProxy\u89d2\u8272\u548cRealSubject\u89d2\u8272\u4e4b\u95f4\u5177\u6709\u4e00\u81f4\u6027\u7684\u63a5\u53e3</p> <ul> <li>Proxy: \u4ee3\u7406</li> </ul> <p>\u4ee3\u7406\u4f1a\u5c3d\u91cf\u5904\u7406\u5ba2\u6237\u8bf7\u6c42\uff0c\u5f53\u5176\u4e0d\u80fd\u5904\u7406\u65f6\uff0c\u4ea4\u7531RealSubject\u5904\u7406</p> <ul> <li>RealSubject: \u771f\u5b9e\u4e3b\u4f53</li> </ul> <p>Proxy\u7684\u771f\u5b9e\u5f15\u7528\uff0c\u5728Proxy\u4e0d\u80fd\u5b8c\u6210\u4efb\u52a1\u65f6\u51fa\u573a</p> <ul> <li>Client\uff1a\u8bf7\u6c42\u8005</li> </ul> <p></p>"},{"location":"design/design-patterns/proxy/#_3","title":"\u793a\u4f8b","text":"<p>\u7ecf\u7eaa\u4eba\u8d1f\u8d23\u5b89\u6392\u660e\u661f\u5de5\u4f5c\uff0c\u5bf9\u660e\u661f\u8fdb\u884c\u5305\u88c5\u7092\u4f5c\uff0c\u54c1\u724c\u5546\u3001\u5e7f\u544a\u5546\u4e5f\u662f\u901a\u8fc7\u7ecf\u7eaa\u4eba\u8054\u7cfb\u4e0a\u660e\u661f\uff0c\u800c\u660e\u661f\u53ea\u9700\u8981\u4e13\u6ce8\u4e8e\u6f14\u51fa\u3002\u7ecf\u7eaa\u4eba\u548c\u660e\u661f\u7684\u5173\u7cfb\u5c31\u662f\u4ee3\u7406\u548c\u771f\u5b9e\u4e3b\u4f53\u7684\u5173\u7cfb\u3002\u6211\u4eec\u8bd5\u7740\u7528\u4ee3\u7801\u63cf\u8ff0\u4e00\u4e0b\uff1a</p> <pre><code>/**\"Subject\"**/\npublic interface Subject {\nvoid show();//\u6f14\u51fa\n}\n/**\"RealSubject\"**/\npublic class Star implements Subject {\n@Override\npublic void show() {\nSystem.out.println(\"\u660e\u661f\u6f14\u51fa\");\n}\n}\n/**\"Proxy\"**/\npublic class Agent implements Subject {\nprivate Subject star;\npublic void arrangeWork(){\nSystem.out.println(\"\u5b89\u6392\u5de5\u4f5c:\u63a5\u5e7f\u544a\");\n}\npublic void takeMoney(){\nSystem.out.println(\"\u6536\u6b3e\");\n}\n@Override\npublic void show() {\nif (star==null){\nstar =new Star();\n}\narrangeWork();\nstar.show();\ntakeMoney();\n}\n}\n/**\"Client\"**/\npublic static void main(String[] args) {\nSubject star = new Agent();\nstar.show();\n}\n//\u8f93\u51fa\n\u5b89\u6392\u5de5\u4f5c:\u63a5\u5e7f\u544a\n\u660e\u661f\u6f14\u51fa\n\u6536\u6b3e\n</code></pre> <p>\u7531\u4e0a\u9762\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\uff0c\u660e\u661f\u53ea\u9700\u8981\u5173\u6ce8\u6f14\u51fa\uff0c\u800c\u7ecf\u7eaa\u4eba\u5b8c\u6210\u6f14\u51fa\u524d\u540e\u8981\u505a\u7684\u534f\u8c03\u6c9f\u901a\u3001\u6536\u5c3e\u5de5\u4f5c\uff0c\u804c\u8d23\u6e05\u6670\u3002</p>"},{"location":"design/design-patterns/proxy/#_4","title":"\u4f18\u70b9","text":"<ul> <li>\u534f\u8c03\u8c03\u7528\u8005\u548c\u88ab\u8c03\u7528\u8005\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u964d\u4f4e\u4e86\u7cfb\u7edf\u7684\u8026\u5408\u5ea6\u3002</li> <li>\u771f\u5b9e\u4e3b\u4f53\u5b8c\u6210\u6700\u6838\u5fc3\u7684\u5de5\u4f5c\uff0c\u4ee3\u7406\u5b8c\u6210\u63a7\u5236\u548c\u534f\u8c03\u5de5\u4f5c\uff0c\u804c\u8d23\u6e05\u6670\uff0c\u7b26\u5408\u201c\u5355\u4e00\u804c\u8d23\u201d\u539f\u5219\u3002</li> <li>\u4f5c\u4e3a\u5bf9\u8c61\u548c\u5ba2\u6237\u7684\u4e2d\u4ecb\uff0c\u4ee3\u7406\u53ef\u4ee5\u8d77\u5230\u4fdd\u62a4\u5bf9\u8c61\uff0c\u51cf\u5c11\u5bf9\u8c61\u8d44\u6e90\u7684\u6d88\u8017</li> </ul>"},{"location":"design/design-patterns/proxy/#_5","title":"\u7f3a\u70b9","text":"<ul> <li>\u5728\u5ba2\u6237\u548c\u771f\u5b9e\u4e3b\u4f53\u4e4b\u95f4\u589e\u52a0\u4e86\u4ee3\u7406\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8bf7\u6c42\u7684\u901f\u5ea6\u53d8\u6162</li> <li>\u5b9e\u73b0\u4ee3\u7406\u6a21\u5f0f\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\uff0c\u6709\u4e9b\u4ee3\u7406\u6a21\u5f0f\u7684\u5b9e\u73b0\u975e\u5e38\u590d\u6742\u3002</li> </ul>"},{"location":"design/design-patterns/proxy/#_6","title":"\u9002\u7528\u573a\u666f","text":"<ul> <li>\u8fdc\u7a0b(Remote)\u4ee3\u7406\uff1a\u4e3a\u4e00\u4e2a\u4f4d\u4e8e\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\u7684\u5bf9\u8c61\u63d0\u4f9b\u4e00\u4e2a\u672c\u5730 \u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\u53ef\u4ee5\u662f\u5728\u540c\u4e00\u53f0\u4e3b\u673a\u4e2d\uff0c\u4e5f\u53ef\u662f\u5728 \u53e6\u4e00\u53f0\u4e3b\u673a\u4e2d\uff0c\u8fdc\u7a0b\u4ee3\u7406\u53c8\u53eb\u505a\u5927\u4f7f(Ambassador)\u3002</li> </ul> <p>android Binder\u673a\u5236</p> <ul> <li>\u865a\u62df(Virtual)\u4ee3\u7406\uff1a\u5982\u679c\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u8d44\u6e90\u6d88\u8017\u8f83\u5927\u7684\u5bf9\u8c61\uff0c\u5148\u521b\u5efa\u4e00\u4e2a\u6d88\u8017\u76f8\u5bf9\u8f83\u5c0f\u7684\u5bf9\u8c61\u6765\u8868\u793a\uff0c\u771f\u5b9e\u5bf9\u8c61\u53ea\u5728\u9700\u8981\u65f6\u624d\u4f1a\u88ab\u771f\u6b63\u521b\u5efa\u3002</li> </ul> <p>\u7f51\u9875\u56fe\u7247\u5ef6\u8fdf\u52a0\u8f7d</p> <ul> <li>Copy-on-Write\u4ee3\u7406\uff1a\u5b83\u662f\u865a\u62df\u4ee3\u7406\u7684\u4e00\u79cd\uff0c\u628a\u590d\u5236\uff08\u514b\u9686\uff09\u64cd\u4f5c\u5ef6\u8fdf \u5230\u53ea\u6709\u5728\u5ba2\u6237\u7aef\u771f\u6b63\u9700\u8981\u65f6\u624d\u6267\u884c\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5bf9\u8c61\u7684\u6df1\u514b\u9686\u662f\u4e00\u4e2a \u5f00\u9500\u8f83\u5927\u7684\u64cd\u4f5c\uff0cCopy-on-Write\u4ee3\u7406\u53ef\u4ee5\u8ba9\u8fd9\u4e2a\u64cd\u4f5c\u5ef6\u8fdf\uff0c\u53ea\u6709\u5bf9\u8c61\u88ab\u7528\u5230\u7684\u65f6\u5019\u624d\u88ab\u514b\u9686\u3002</li> </ul> <p>StringBuilder</p> <ul> <li>\u4fdd\u62a4(Protect or Access)\u4ee3\u7406\uff1a\u63a7\u5236\u5bf9\u4e00\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\uff0c\u53ef\u4ee5\u7ed9\u4e0d\u540c\u7684\u7528\u6237\u63d0\u4f9b\u4e0d\u540c\u7ea7\u522b\u7684\u4f7f\u7528\u6743\u9650\u3002</li> </ul> <p>\u53cd\u5411\u4ee3\u7406\uff1anginx</p> <ul> <li>\u7f13\u51b2(Cache)\u4ee3\u7406\uff1a\u4e3a\u67d0\u4e00\u4e2a\u76ee\u6807\u64cd\u4f5c\u7684\u7ed3\u679c\u63d0\u4f9b\u4e34\u65f6\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u4ee5\u4fbf\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u5171\u4eab\u8fd9\u4e9b\u7ed3\u679c\u3002</li> </ul> <p>\u56fe\u7247\u7f13\u5b58\u3001Http\u7f13\u5b58</p> <ul> <li>\u667a\u80fd\u5f15\u7528(Smart Reference)\u4ee3\u7406\uff1a\u5f53\u4e00\u4e2a\u5bf9\u8c61\u88ab\u5f15\u7528\u65f6\uff0c\u63d0\u4f9b\u4e00\u4e9b\u989d\u5916\u7684\u64cd\u4f5c\uff0c\u5982\u5c06\u6b64\u5bf9\u8c61\u88ab\u8c03\u7528\u7684\u6b21\u6570\u8bb0\u5f55\u4e0b\u6765\u7b49\u3002</li> </ul> <p>\u5f15\u7528\u8ba1\u6570</p> <ul> <li> <p>\u9632\u706b\u5899(Firewall)\u4ee3\u7406\uff1a\u4fdd\u62a4\u76ee\u6807\u4e0d\u8ba9\u6076\u610f\u7528\u6237\u63a5\u8fd1\u3002</p> </li> <li> <p>\u540c\u6b65\u5316(Synchronization)\u4ee3\u7406\uff1a\u4f7f\u51e0\u4e2a\u7528\u6237\u80fd\u591f\u540c\u65f6\u4f7f\u7528\u4e00\u4e2a\u5bf9\u8c61\u800c\u6ca1\u6709\u51b2\u7a81\u3002</p> </li> </ul>"},{"location":"design/design-patterns/proxy/#_7","title":"\u76f8\u5173\u8bbe\u8ba1\u6a21\u5f0f\u5bf9\u6bd4","text":"<ul> <li>\u9002\u914d\u5668\u6a21\u5f0f</li> </ul> <p>\u9002\u914d\u5668\u6a21\u5f0f\u9002\u914d\u4e86\u4e24\u79cd\u5177\u6709**\u4e0d\u540c\u63a5\u53e3**\u7684\u5bf9\u8c61\uff0c\u4ee5\u4f7f\u5b83\u4eec\u53ef\u4ee5\u4e00\u8d77\u5de5\u4f5c\u3002\u800c\u5728\u4ee3\u7406\u6a21\u5f0f\u4e2d\uff0c\u4ee3\u7406\u5bf9\u8c61\u548c\u771f\u5b9e\u4e3b\u4f53\u7684\u63a5\u53e3\u662f\u76f8\u540c\u7684\u3002</p> <ul> <li>\u88c5\u9970\u5668\u6a21\u5f0f</li> </ul> <p>\u88c5\u9970\u5668\u6a21\u5f0f\u5728\u5b9e\u73b0\u4e0a\u5f88\u76f8\u4f3c\uff0c\u4e0d\u8fc7\u5b83\u4eec\u7684\u4f7f\u7528\u76ee\u7684\u4e0d\u4e00\u6837\u3002\u88c5\u9970\u5668\u6a21\u5f0f\u7684\u76ee\u7684\u5728\u4e8e\u4e3a\u672c\u4f53\u589e\u52a0\u65b0\u7684\u529f\u80fd\uff0c\u800c\u5728\u4ee3\u7406\u6a21\u5f0f\u4e2d\uff0c\u4e0e\u589e\u52a0\u65b0\u529f\u80fd\u76f8\u6bd4\uff0c\u5b83\u66f4\u6ce8\u91cd\u901a\u8fc7\u8bbe\u7f6e\u4ee3\u7406\u7684\u65b9\u5f0f\u51cf\u8f7b\u672c\u4f53\u7684\u5de5\u4f5c\u8d1f\u62c5\u3002</p>"},{"location":"design/design-patterns/singleton/","title":"\u5355\u4f8b","text":""},{"location":"design/design-patterns/singleton/#1","title":"1. \u5b9a\u4e49","text":"<p>\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u4e14\u81ea\u884c\u63d0\u4f9b\u4e00\u4e2a\u8bbf\u95ee\u8be5\u5b9e\u4f8b\u7684\u5168\u5c40\u8bbf\u95ee\u70b9</p>"},{"location":"design/design-patterns/singleton/#2","title":"2. \u7c7b\u56fe","text":""},{"location":"design/design-patterns/singleton/#3","title":"3. \u8303\u4f8b","text":""},{"location":"design/design-patterns/singleton/#31-java","title":"3.1  Java","text":"<pre><code>public class Singleton {\nprivate static Singleton instance;\nprivate Singleton() {\nSystem.out.println(\"Singleton class created\");\n}\npublic static Singleton getInstance() {\nif (instance == null) {\ninstance = new Singleton();\n}\nreturn instance;\n}\n}\n# test\nvoid test() {\nSingleton singleton1 = Singleton.getInstance();\nSingleton singleton2 = Singleton.getInstance();\nSystem.out.println(singleton1 instanceof Singleton);\nSystem.out.println(singleton2 instanceof Singleton);\nSystem.out.println(singleton1 == singleton2);\n}\n# \u8f93\u51fa\uff1a\nSingleton class created\ntrue\ntrue\ntrue\n</code></pre>"},{"location":"design/design-patterns/singleton/#32-js","title":"3.2 JS","text":"<pre><code>'use strict';\nlet _singlenton = null\nclass Singleton{\nconstructor(){\nif(! _singlenton){\n_singlenton=this\n}\nreturn _singlenton\nconsole.log(\"Singleton class created\");\n}\n}\n# test\nfunction test() {\nvar singleton1 = new Singleton()\nvar singleton2 = new Singleton()\nconsole.log(singleton1 instanceof Singleton)\nconsole.log(singleton2 instanceof Singleton)\nconsole.log(singleton1 === singleton2)\n}\n# \u8f93\u51fa\uff1a\nSingleton class created\ntrue\ntrue\ntrue\n</code></pre>"},{"location":"design/design-patterns/singleton/#4","title":"4.\u6ce8\u610f\u70b9","text":"<ol> <li>\u5355\u4f8b\u7c7b\u7684\u6784\u9020\u51fd\u6570\u4e3a\u79c1\u6709 </li> <li>\u63d0\u4f9b\u4e00\u4e2a\u81ea\u8eab\u7684\u9759\u6001\u79c1\u6709\u6210\u5458\u53d8\u91cf\uff1b</li> <li>\u63d0\u4f9b\u4e00\u4e2a\u516c\u6709\u7684\u9759\u6001\u5de5\u5382\u65b9\u6cd5\u3002</li> </ol>"},{"location":"design/design-patterns/singleton/#5","title":"5.\u4f18\u70b9","text":"<ol> <li>\u8282\u7ea6\u7cfb\u7edf\u8d44\u6e90\u3001\u63d0\u9ad8\u7cfb\u7edf\u7684\u6027\u80fd--\u4e0d\u9700\u8981\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7684\u5bf9\u8c61\u3002</li> <li>\u5171\u4eab\u5b9e\u4f8b\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684bug-- \u5f53\u5e94\u7528\u5b58\u5728\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5b9e\u4f8b\u95f4\u4e92\u76f8\u4f5c\u7528\uff0c\u53ef\u80fd\u4f1a\u6709\u610f\u60f3\u4e0d\u5230\u7684bug\u3002</li> </ol>"},{"location":"design/design-patterns/singleton/#6","title":"6.\u7f3a\u70b9","text":"<ol> <li> <p>\u6ca1\u6709\u62bd\u8c61\u5c42\uff0c\u6269\u5c55\u56f0\u96be</p> </li> <li> <p>\u8fdd\u80cc\u201c\u5355\u4e00\u804c\u8d23\u201d\u539f\u5219\uff0c\u65e2\u662f\u5de5\u5382---\u521b\u5efa\u5bf9\u8c61\uff0c\u53c8\u662f\u4e1a\u52a1\u7ba1\u7406\u5458--\u6d89\u53ca\u4ea7\u54c1\u4e1a\u52a1\u903b\u8f91</p> </li> <li> <p>\u5904\u7406\u4e0d\u5f53\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u9732\uff08Android\uff09</p> </li> </ol>"},{"location":"design/design-patterns/singleton/#7","title":"7.\u9002\u7528\u573a\u666f","text":"<ol> <li>\u8d44\u6e90\u5171\u4eab</li> <li>\u65e5\u5fd7\u670d\u52a1\uff0c\u65e5\u5fd7\u670d\u52a1\u4e00\u822c\u4ece\u5e94\u7528\u542f\u52a8\u540e\u5c31\u5904\u4e8e\u6253\u5f00\u72b6\u6001\uff0c\u53ef\u4ee5\u968f\u65f6\u8f93\u51fa\u548c\u8f93\u5165\u65e5\u5fd7\uff0c\u4e0d\u9700\u8981\u91cd\u590d\u521b\u5efa\u548c\u9500\u6bc1</li> <li>\u5e94\u7528\u914d\u7f6e\uff0c\u914d\u7f6e\u6587\u4ef6\u662f\u5171\u4eab\u7684\u8d44\u6e90\uff0c\u4e00\u822c\u5728\u5e94\u7528\u5185\u662f\u516c\u7528\u7684</li> <li>\u8d44\u6e90\u7ba1\u7406\uff0c\u72b6\u6001\u63a7\u5236</li> <li>\u8ba1\u6570\u5668\uff0c\u7ef4\u62a4\u540c\u6b65\u72b6\u6001</li> <li>\u7ebf\u7a0b\u6c60\uff0c\u63a7\u5236\u7ebf\u7a0b\u901a\u4fe1\u548c\u6570\u91cf</li> </ol>"},{"location":"design/design-patterns/strategy/","title":"\u7b56\u7565\u6a21\u5f0f","text":""},{"location":"design/design-patterns/strategy/#_1","title":"\u5b9a\u4e49","text":"<p>\u5bf9\u8c61\u6709\u67d0\u4e2a\u884c\u4e3a\uff0c\u4f46\u662f\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e2d\uff0c\u8be5\u884c\u4e3a\u6709\u4e0d\u540c\u7684\u5b9e\u73b0\u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u73af\u5883\u6216\u8005\u6761\u4ef6\u7684\u4e0d\u540c\u9009\u62e9\u4e0d\u540c\u7684\u7b56\u7565\u6765\u5b8c\u6210\u8be5\u884c\u4e3a\u3002</p>"},{"location":"design/design-patterns/strategy/#_2","title":"\u89d2\u8272","text":"<ul> <li>Context: \u73af\u5883\u7c7b</li> </ul> <p>\u4f7f\u7528\u7b56\u7565</p> <ul> <li>Strategy: \u62bd\u8c61\u7b56\u7565\u7c7b</li> </ul> <p>\u51b3\u5b9a\u5b9e\u73b0\u7b56\u7565\u6240\u5fc5\u9700\u7684\u63a5\u53e3</p> <ul> <li>ConcreteStrategy: \u5177\u4f53\u7b56\u7565\u7c7b</li> </ul> <p>\u5b9e\u73b0\u5b9e\u73b0\u5177\u4f53\u7b56\u7565/\u7b97\u6cd5</p> <p></p>"},{"location":"design/design-patterns/strategy/#_3","title":"\u4ee3\u7801\u793a\u4f8b","text":"<p>\u5047\u8bbe\u73b0\u5728\u8981\u8bbe\u8ba1\u4e00\u4e2a\u865a\u62df\u5e01\u5145\u503c\u7cfb\u7edf\uff0c\u5145\u503c\u6839\u636e\u4f1a\u5458\u7684\u7b49\u7ea7\u6253\u6298\u3002\u5982\u5bf9\u9ad8\u7ea7VIP\u4f1a\u5458\u63d0\u4f9b30%\u6298\u6263\uff0cVIP\u4f1a\u545810%\u6298\u6263\uff0c\u666e\u901a\u4f1a\u5458\u6ca1\u6709\u6298\u6263\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u91cc\u4f1a\u6709\u4e09\u4e2a\u7b97\u6cd5\uff1a</p> <ol> <li>\u9ad8\u7ea7VIP\u4f1a\u545830%\u6298\u6263</li> <li>VIP\u4f1a\u545810%\u6298\u6263</li> <li>\u666e\u901a\u4f1a\u5458\u6ca1\u6709\u6298\u6263</li> </ol> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>/**\"Strategy\"**/\npublic interface MemberStrategy {\npublic float calAmount(float originAmount);\n}\n/**\"ConcreteStrategy\"**/\npublic class AdvanceVipMemberStragy implements MemberStrategy {\n@Override\npublic float calAmount(float originAmount) {\nSystem.out.println(\"\u9ad8\u7ea7VIP\u4f1a\u545830%\u6298\u6263\");\nreturn originAmount * 0.7f;\n}\n}\n/**\"ConcreteStrategy\"**/\npublic class VipMemberStragy implements MemberStrategy {\n@Override\npublic float calAmount(float originAmount) {\nSystem.out.println(\"VIP\u4f1a\u545810%\u6298\u6263\");\nreturn originAmount * 0.9f;\n}\n}\n/**\"ConcreteStrategy\"**/\npublic class CommonMemberStragy implements MemberStrategy {\n@Override\npublic float calAmount(float originAmount) {\nSystem.out.println(\"\u666e\u901a\u4f1a\u5458\u6ca1\u6709\u6298\u6263\");\nreturn originAmount;\n}\n}\n/**\"Context\"**/\npublic class Recharge {\nprivate MemberStrategy memberStrategy;\npublic Recharge(MemberStrategy memberStrategy) {\nthis.memberStrategy = memberStrategy;\n}\npublic float calAmount(float originAmount){\nreturn memberStrategy.calAmount(originAmount);\n}\n}\n/**\"client\"**/\npublic static void main(String[] args) {\nMemberStrategy strategy = new AdvanceVipMemberStragy();\nRecharge recharge = new Recharge(strategy);\nfloat amount = recharge.calAmount(100);\nSystem.out.println(\"\u7528\u6237\u6700\u7ec8\u8981\u4ed8\u7684\u91d1\u989d\u4e3a\uff1a\" + amount);\n}\n//\u8f93\u51fa\n\u9ad8\u7ea7VIP\u4f1a\u545830%\u6298\u6263\n\u7528\u6237\u6700\u7ec8\u8981\u4ed8\u7684\u91d1\u989d\u4e3a\uff1a70\n</code></pre> <p>\u4ece\u4e0a\u9762\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u7b56\u7565\u7c7b\u4ec5\u4ec5\u5c01\u88c5\u7b97\u6cd5\uff0c\u5e76\u4e0d\u51b3\u5b9a\u5728\u4f55\u65f6\u4f7f\u7528\u4f55\u79cd\u7b97\u6cd5\uff0c\u4f55\u65f6\u4f7f\u7528\u4f55\u79cd\u7b97\u6cd5\u662f\u7531\u5ba2\u6237\u7aef\u786e\u5b9a\u7684\u3002</p> <p>\u7b56\u7565\u6a21\u5f0f\u7684\u91cd\u5fc3\u4e0d\u662f\u5982\u4f55\u5b9e\u73b0\u7b97\u6cd5\uff0c\u800c\u662f\u5982\u4f55\u7ec4\u7ec7\u3001\u8c03\u7528\u8fd9\u4e9b\u7b97\u6cd5\uff0c\u4ece\u800c\u8ba9\u7a0b\u5e8f\u7ed3\u6784\u66f4\u7075\u6d3b\uff0c\u5177\u6709\u66f4\u597d\u7684\u7ef4\u62a4\u6027\u548c\u6269\u5c55\u6027</p>"},{"location":"design/design-patterns/strategy/#_4","title":"\u4f18\u70b9","text":"<ul> <li>\u5bf9\u201c\u5f00\u95ed\u539f\u5219\u201d\u7684\u5b8c\u7f8e\u652f\u6301,\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u539f\u6709\u7cfb\u7edf\u7684\u57fa\u7840\u4e0a\u9009\u62e9\u7b97\u6cd5\u6216\u884c\u4e3a\uff0c\u4e5f\u53ef\u4ee5\u7075\u6d3b\u5730\u589e\u52a0\u65b0\u7684\u7b97\u6cd5\u6216\u884c\u4e3a\u3002</li> <li>\u63d0\u4f9b\u4e86\u7ba1\u7406\u76f8\u5173\u7684\u7b97\u6cd5\u65cf\uff08\u4e1a\u52a1\u89c4\u5219\uff09\u7684\u529e\u6cd5</li> <li>\u907f\u514d\u4f7f\u7528\u591a\u91cd\u6761\u4ef6(if-else)\u8bed\u53e5</li> </ul>"},{"location":"design/design-patterns/strategy/#_5","title":"\u7f3a\u70b9","text":"<ul> <li>\u5ba2\u6237\u7aef\u5fc5\u987b\u77e5\u9053\u6240\u6709\u7684\u7b56\u7565\u7c7b\uff0c\u5e76\u81ea\u884c\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e00\u4e2a\u7b56\u7565\u7c7b\u3002\u8fd9\u5c31\u610f\u5473\u7740\u5ba2\u6237\u7aef\u5fc5\u987b\u7406\u89e3\u8fd9\u4e9b\u7b97\u6cd5\u7684\u533a\u522b\uff0c\u4ee5\u4fbf\u9002\u65f6\u9009\u62e9\u6070\u5f53\u7684\u7b97\u6cd5\u7c7b\u3002\u6362\u8a00\u4e4b\uff0c\u7b56\u7565\u6a21\u5f0f\u53ea\u9002\u7528\u4e8e\u5ba2\u6237\u7aef\u77e5\u9053\u7b97\u6cd5\u6216\u884c\u4e3a\u7684\u60c5\u51b5\u3002</li> <li>\u7b56\u7565\u6a21\u5f0f\u5c06\u9020\u6210\u4ea7\u751f\u5f88\u591a\u7b56\u7565\u7c7b</li> </ul>"},{"location":"design/design-patterns/strategy/#_6","title":"\u9002\u7528\u573a\u666f","text":"<ul> <li>\u5982\u679c\u5728\u4e00\u4e2a\u7cfb\u7edf\u91cc\u9762\u6709\u8bb8\u591a\u7c7b\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\u4ec5\u5728\u4e8e\u5b83\u4eec\u7684\u884c\u4e3a\uff0c\u90a3\u4e48\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u53ef\u4ee5\u52a8\u6001\u5730\u8ba9\u4e00\u4e2a\u5bf9\u8c61\u5728\u8bb8\u591a\u884c\u4e3a\u4e2d\u9009\u62e9\u4e00\u79cd\u884c\u4e3a\u3002</li> <li>\u4e00\u4e2a\u7cfb\u7edf\u9700\u8981\u52a8\u6001\u5730\u5728\u51e0\u79cd\u7b97\u6cd5\u4e2d\u9009\u62e9\u4e00\u79cd\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u6709\u5f88\u591a\u7684\u884c\u4e3a\uff0c\u5982\u679c\u4e0d\u7528\u6070\u5f53\u7684\u6a21\u5f0f\uff0c\u8fd9\u4e9b\u884c\u4e3a\u5c31\u53ea\u597d\u4f7f\u7528\u591a\u91cd\u7684\u6761\u4ef6\u9009\u62e9\u8bed\u53e5\u6765\u5b9e\u73b0\u3002</li> <li>\u4e0d\u5e0c\u671b\u5ba2\u6237\u7aef\u77e5\u9053\u590d\u6742\u7684\u3001\u4e0e\u7b97\u6cd5\u76f8\u5173\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5177\u4f53\u7b56\u7565\u7c7b\u4e2d\u5c01\u88c5\u7b97\u6cd5\u548c\u76f8\u5173\u7684\u6570\u636e\u7ed3\u6784\uff0c\u63d0\u9ad8\u7b97\u6cd5\u7684\u4fdd\u5bc6\u6027\u4e0e\u5b89\u5168\u6027\u3002</li> </ul>"},{"location":"design/design-patterns/summary/","title":"\u603b\u7ed3","text":""},{"location":"design/design-patterns/summary/#_1","title":"\u5c0f\u7ed3","text":"<p>\u6ca1\u5fc5\u8981\u673a\u68b0\u5730\u80cc\u4e0b\u8fd9\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u8bbe\u8ba1\u6a21\u5f0f\u5728\u201c\u610f\u201d\u4e0d\u5728\u201c\u62db\u201d\uff0c\u91cd\u8981\u7684\u662f\u5728\u8111\u6d77\u4e2d\u7406\u89e3\u8bbe\u8ba1\u6a21\u5f0f\u662f\u600e\u6837\u89e3\u51b3\u95ee\u9898\u7684\u3002\u6bcf\u4e2a\u8bbe\u8ba1\u6a21\u5f0f\u90fd\u662f\u7528\u4e8e\u89e3\u51b3\u8f6f\u4ef6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898\u7684\uff0c\u4f46\u9996\u5148\u5fc5\u987b\u8981\u660e\u786e\u77e5\u9053\u5b58\u5728\u4ec0\u4e48\u95ee\u9898\uff0c\u5982\u679c\u95ee\u9898\u4e0d\u591f\u660e\u786e\uff0c\u662f\u65e0\u6cd5\u9009\u62e9\u51fa\u5408\u9002\u7684\u8bbe\u8ba1\u6a21\u5f0f\u7684\uff0c\u9009\u4e86\u8bbe\u8ba1\u6a21\u5f0f\u540e\uff0c\u8fd8\u9700\u8981\u6574\u4f53\u6743\u8861\u5b9e\u73b0\u6210\u672c\u3001\u53ef\u7ef4\u62a4\u6027\u3001\u56e2\u961f\u4eba\u5458\u6280\u672f\u5929\u82b1\u677f\u7b49\u95ee\u9898\uff0c\u6700\u540e\u624d\u80fd\u628a\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u786e\u5b9a\u4e0b\u6765\u3002</p>"},{"location":"design/design-patterns/summary/#_2","title":"\u76f8\u4f3c\u6a21\u5f0f\u5bf9\u6bd4","text":""},{"location":"design/design-patterns/summary/#vs","title":"\u9002\u914d\u5668\u6a21\u5f0f VS \u6865\u63a5\u6a21\u5f0f","text":"<p>\u9002\u914d\u5668\u6a21\u5f0f\u662f\u7528\u4e8e\u8fde\u63a5\u4e0d\u540c\u63a5\u53e3\u7684\u7c7b\uff0c\u800c\u6865\u63a5\u6a21\u5f0f\u5219\u7528\u4e8e\u8fde\u63a5\u7c7b\u7684\u62bd\u8c61\u5316\u548c\u5b9e\u73b0\u5316\uff0c\u6216\u8005\u8bf4\u8fde\u63a5\u7c7b\u7684\u529f\u80fd\u5c42\u6b21\u7ed3\u6784\u4e0e\u5b9e\u73b0\u5c42\u6b21\u7ed3\u6784\u3002</p>"},{"location":"design/design-patterns/summary/#vs_1","title":"\u9002\u914d\u5668\u6a21\u5f0f VS \u88c5\u9970\u6a21\u5f0f","text":"<p>\u9002\u914d\u5668\u6a21\u5f0f\u9002\u914d\u4e86\u4e24\u79cd\u5177\u6709\u4e0d\u540c\u63a5\u53e3\u7684\u5bf9\u8c61\uff0c\u4ee5\u4f7f\u5b83\u4eec\u53ef\u4ee5\u4e00\u8d77\u5de5\u4f5c\uff0c\u800c\u88c5\u9970\u6a21\u5f0f\u5219\u662f\u5728\u4e0d\u6539\u53d8\u63a5\u53e3\u7684\u524d\u63d0\u4e0b\u589e\u52a0\u529f\u80fd\u3002</p>"},{"location":"design/design-patterns/summary/#vs_2","title":"\u539f\u578b\u6a21\u5f0f VS \u4eab\u5143\u6a21\u5f0f","text":"<p>\u539f\u578b\u6a21\u5f0f\u53ef\u4ee5**\u751f\u6210**\u4e00\u4e2a\u4e0e\u5f53\u524d\u5b9e\u4f8b\u72b6\u6001\u5b8c\u5168\u76f8\u540c\u7684\u5b9e\u4f8b\uff0c\u4eab\u5143\u6a21\u5f0f\u53ef\u4ee5\u5728**\u4e0d\u7528\u5730\u65b9**\u4f7f\u7528\u540c\u4e00\u5b9e\u4f8b</p>"},{"location":"design/design-patterns/summary/#vs_3","title":"\u5efa\u9020\u8005\u6a21\u5f0f VS \u5916\u89c2\u6a21\u5f0f","text":"<p>\u5efa\u9020\u8005\u6a21\u5f0f\u4e2d\uff0cDirector\u89d2\u8272\u901a\u8fc7\u7ec4\u5408Builder\u89d2\u8272\u4e2d\u7684\u590d\u6742\u65b9\u6cd5\u5411\u5916\u90e8\u63d0\u4f9b\u53ef\u4ee5\u7b80\u5355\u751f\u6210\u5b9e\u4f8b\u7684\u63a5\u53e3</p> <p>\u5916\u89c2\u6a21\u5f0f\u4e2d\u7684Facade\u89d2\u8272\u5219\u662f\u901a\u8fc7\u7ec4\u5408\u5185\u90e8\u6a21\u5757\u5411\u5916\u63d0\u4f9b\u53ef\u4ee5\u7b80\u5355\u8c03\u7528\u7684\u63a5\u53e3\u3002</p>"},{"location":"design/design-patterns/wrapper/","title":"\u88c5\u9970\u6a21\u5f0f","text":""},{"location":"design/design-patterns/wrapper/#_1","title":"\u5b9a\u4e49","text":"<p>\u52a8\u6001\u5730\u5f80\u4e00\u4e2a\u7c7b\u4e2d\u6dfb\u52a0\u65b0\u7684\u884c\u4e3a\uff0c\u540c\u65f6\u53c8\u4e0d\u6539\u53d8\u5176\u7ed3\u6784\u3002</p>"},{"location":"design/design-patterns/wrapper/#_2","title":"\u89d2\u8272","text":"<ul> <li>Component: \u62bd\u8c61\u6784\u4ef6</li> </ul> <p>\u5b9a\u4e49\u88ab\u88c5\u9970\u7c7b\u7684\u63a5\u53e3</p> <ul> <li>ConcreteComponent: \u5177\u4f53\u6784\u4ef6</li> </ul> <p>\u8981\u88ab\u88c5\u9970\u5668\u88c5\u9970\u7684\u5177\u4f53\u5bf9\u8c61</p> <ul> <li>Decorator: \u62bd\u8c61\u88c5\u9970\u7c7b</li> </ul> <p>\u7ef4\u62a4\u88ab\u88c5\u9970\u7c7b\u7684\u5f15\u7528</p> <ul> <li>ConcreteDecorator: \u5177\u4f53\u88c5\u9970\u7c7b</li> </ul> <p>\u5411\u88ab\u88c5\u9970\u7c7b\u6dfb\u52a0\u65b0\u7684\u804c\u8d23</p> <p></p>"},{"location":"design/design-patterns/wrapper/#_3","title":"\u4e3e\u4f8b","text":"<p>\u86cb\u7cd5</p> <p>\u86cb\u7cd5\u7684\u62bd\u8c61\u6784\u4ef6\uff0c\u5b9a\u4e49\u4e86\u86cb\u7cd5\u7684\u63a5\u53e3</p> <pre><code>/** \"Component\" **/\npublic interface Cake {\nvoid taste();\n}\n</code></pre> <p>\u86cb\u7cd5\u7684\u5177\u4f53\u6784\u4ef6\uff1a\u539f\u5473\u86cb\u7cd5</p> <pre><code>/** \"ConcreteComponent\" **/\npublic class OriginalCake implements Cake {\n@Override\npublic void taste() {\nSystem.out.println(\"\u539f\u5473\");\n}\n}\n</code></pre> <p>\u5473\u9053\u62bd\u8c61\u88c5\u9970\u7c7b</p> <pre><code>/** \"Decorator\" **/\npublic abstract class TasteWrapper implements Cake {\nprotected Cake cake;\npublic TasteWrapper(Cake cake) {\nthis.cake = cake;\n}\n}\n</code></pre> <p>\u5177\u4f53\u5473\u9053\u88c5\u9970\uff1a\u5976\u6cb9\u5473\u9053\u86cb\u7cd5</p> <pre><code>/** \"ConcreteDecorator\" **/\npublic class CreamWrapper extends TasteWrapper {\npublic CreamWrapper(Cake cake) {\nsuper(cake);\n}\n@Override\npublic void taste() {\ncake.taste();\nSystem.out.println(\"\u5976\u6cb9\");\n}\n}\n</code></pre> <p>\u5177\u4f53\u5473\u9053\u88c5\u9970\uff1a\u8349\u8393\u5473\u9053\u86cb\u7cd5</p> <pre><code>/** \"ConcreteDecorator\" **/\npublic class StrawberryWrapper extends TasteWrapper {\npublic StrawberryWrapper(Cake cake) {\nsuper(cake);\n}\n@Override\npublic void taste() {\ncake.taste();\nSystem.out.println(\"\u8349\u8393\");\n}\n}\n</code></pre> <p>Client\uff1a</p> <pre><code>public static void main(String[] args){\nCake cake = new OriginalCake();\n//\u5976\u6cb9\u86cb\u7cd5\nCake creamCake = new CreamWrapper(cake);\ncreamCake.taste();\n//\u8349\u8393\u86cb\u7cd5\nCake strawberryCake = new StrawberryWrapper(cake);\nstrawberryCake.taste();\n//\u8349\u8393\u5976\u6cb9\u86cb\u7cd5\nCake strawberryCreamCake = new StrawberryWrapper(creamCake);\nstrawberryCreamCake.taste();\n}\n//\u8f93\u51fa\n\u539f\u5473\n\u5976\u6cb9\n-------\n\u539f\u5473\n\u8349\u8393\n-------\n\u539f\u5473\n\u5976\u6cb9\n\u8349\u8393\n-------\n</code></pre> <p>\u4e0a\u9762\u4f8b\u5b50\u4e2d\uff0c\u628a\u86cb\u7cd5\u4ece\u4e00\u5757\u666e\u901a\u7684\u86cb\u7cd5\uff08\u539f\u5473\uff09\u52a0\u4e0a\u8349\u8393\u5c31\u53d8\u6210\u4e86\u8349\u8393\u86cb\u7cd5\uff0c\u6d82\u4e0a\u5976\u6cb9\u5c31\u53d8\u6210\u4e86\u5976\u6cb9\u86cb\u7cd5\uff0c\u8981\u662f\u5728\u5976\u6cb9\u86cb\u7cd5\u4e0a\u9762\u52a0\u4e0a\u8349\u8393\u5c31\u53d8\u6210\u4e86\u8349\u8393\u5976\u6cb9\u86cb\u7cd5\u3002\u5b83\u4eec\u7684\u6838\u5fc3\u90fd\u662f\u86cb\u7cd5\uff0c\u4f46\u901a\u8fc7\u4e0d\u65ad\u7684\u88c5\u9970\uff0c\u86cb\u7cd5\u7684\u5473\u9053\u53d8\u5f97\u66f4\u52a0\u7684\u751c\u7f8e\uff0c\u76ee\u7684\u4e5f\u53d8\u5f97\u66f4\u52a0\u660e\u786e\u3002</p>"},{"location":"design/design-patterns/wrapper/#_4","title":"\u4f18\u70b9","text":"<ul> <li>\u63d0\u9ad8\u7075\u6d3b\u6027\u548c\u63a5\u53e3(API)\u900f\u660e\u5ea6</li> </ul> <p>\u88c5\u9970\u5668\u548c\u88ab\u88c5\u9970\u7269\u5177\u6709\u76f8\u540c\u7684\u63a5\u53e3(API)\uff0c\u8fd9\u6837\u5c31\u7b97\u88ab\u88c5\u9970\u7269\u88ab\u88c5\u9970\u5668\u88c5\u9970\u8d77\u6765\uff0c\u63a5\u53e3(API)\u4e5f\u4e0d\u4f1a\u53d8\u5316\uff0c\u4e0d\u4f1a\u7834\u574f\u7c7b\u7684\u5c01\u88c5\u6027</p> <ul> <li>\u52a8\u6001\u589e\u52a0\u529f\u80fd</li> </ul> <p>\u88c5\u9970\u6a21\u5f0f\u4f7f\u7528\u4e86\u59d4\u6258\uff0c\u4f7f\u5f97\u7c7b\u4e4b\u95f4\u5f62\u6210\u4e86\u5f31\u5173\u8054\u3002\u901a\u8fc7\u4f7f\u7528\u4e0d\u540c\u7684\u5177\u4f53\u88c5\u9970\u7c7b\u7684\u6392\u5217\u7ec4\u5408\uff0c\u53ef\u4ee5\u521b\u5efa\u5f88\u591a\u4e0d\u540c\u884c\u4e3a\u7684\u7ec4\u5408\uff0c\u4ece\u800c\u5f97\u5230\u529f\u80fd\u66f4\u52a0\u5f3a\u5927\u7684\u5bf9\u8c61</p> <ul> <li>\u88c5\u9970\u7c7b\u548c\u88ab\u88c5\u9970\u7c7b\u53ef\u4ee5\u72ec\u7acb\u53d1\u5c55\uff0c\u4e0d\u4f1a\u76f8\u4e92\u8026\u5408</li> </ul> <p>\u7528\u6237\u53ef\u4ee5\u6839\u636e\u9700\u8981\u589e\u52a0\u65b0\u7684\u5177\u4f53\u6784\u4ef6\u7c7b\u548c\u5177\u4f53\u88c5\u9970\u7c7b\uff0c\u5728\u4f7f\u7528\u65f6\u518d\u5bf9\u5176\u8fdb\u884c\u7ec4\u5408\uff0c\u539f\u6709\u4ee3\u7801\u65e0\u987b\u6539\u53d8\uff0c\u7b26\u5408\u201c\u5f00\u95ed\u539f\u5219\u201d</p>"},{"location":"design/design-patterns/wrapper/#_5","title":"\u7f3a\u70b9","text":"<ul> <li>\u589e\u52a0\u8bb8\u591a\u5f88\u5c0f\u7684\u7c7b</li> </ul> <p>\u8fd9\u4e9b\u5bf9\u8c61\u7684\u533a\u522b\u5728\u4e8e\u5b83\u4eec\u4e4b\u95f4\u76f8\u4e92\u8fde\u63a5\u7684\u65b9\u5f0f\u6709\u6240\u4e0d\u540c\uff0c\u800c\u4e0d\u662f\u5b83\u4eec\u7684\u7c7b\u6216\u8005\u5c5e\u6027\u503c\u6709\u6240\u4e0d\u540c\uff0c\u540c\u65f6\u8fd8\u5c06\u4ea7\u751f\u5f88\u591a\u5177\u4f53\u88c5\u9970\u7c7b\u3002\u8fd9\u4e9b\u88c5\u9970\u7c7b\u548c\u5c0f\u5bf9\u8c61\u7684\u4ea7\u751f\u5c06\u589e\u52a0\u7cfb\u7edf\u7684\u590d\u6742\u5ea6\uff0c\u52a0\u5927\u5b66\u4e60\u4e0e\u7406\u89e3\u7684\u96be\u5ea6\u3002</p> <ul> <li>\u591a\u5c42\u88c5\u9970\u6bd4\u8f83\u590d\u6742</li> </ul> <p>\u8c03\u8bd5\u65f6\u5bfb\u627e\u9519\u8bef\u53ef\u80fd\u9700\u8981\u9010\u7ea7\u6392\u67e5\uff0c\u8f83\u4e3a\u70e6\u7410\u3002</p>"},{"location":"design/design-patterns/wrapper/#_6","title":"\u9002\u7528\u573a\u666f","text":"<ul> <li> <p>\u5728\u4e0d\u5f71\u54cd\u5176\u4ed6\u5bf9\u8c61\u7684\u60c5\u51b5\u4e0b\uff0c\u4ee5\u52a8\u6001\u3001\u900f\u660e\u7684\u65b9\u5f0f\u7ed9\u5355\u4e2a\u5bf9\u8c61\u6dfb\u52a0\u804c\u8d23\u3002</p> </li> <li> <p>\u9700\u8981\u52a8\u6001\u7ed9\u4e00\u4e2a\u5bf9\u8c61\u589e\u52a0\u529f\u80fd\uff0c\u4e5f\u53ef\u4ee5\u52a8\u6001\u64a4\u9500</p> </li> <li> <p>\u5f53\u4f7f\u7528\u7ee7\u627f\u6269\u5c55\u4e0d\u5408\u9002\u6216\u8005\u65e0\u6cd5\u4f7f\u7528\u7ee7\u627f\u7684\u65f6\u5019</p> </li> </ul> <p>\u7ee7\u627f\u662f\u4e00\u79cd\u8026\u5408\u5ea6\u6bd4\u8f83\u5927\u7684\u9759\u6001\u5173\u7cfb\uff0c\u7ec4\u5408/\u805a\u5408\u53ef\u4ee5\u4f7f\u7cfb\u7edf\u66f4\u52a0\u7075\u6d3b\uff0c\u964d\u4f4e\u7c7b\u4e0e\u7c7b\u4e4b\u95f4\u7684\u8026\u5408\u5ea6\u3002</p>"},{"location":"design/design-patterns/wrapper/#_7","title":"\u6a21\u5f0f\u7b80\u5316","text":"<p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u88c5\u9970\u6a21\u5f0f\u7684\u5b9e\u73b0\u90fd\u6bd4\u4e0a\u9762\u4f8b\u5b50\u7b80\u5355 --- \u53ea\u6709\u4e00\u4e2a<code>ConcreteComponent</code>\u7c7b\u548c\u4e00\u4e2a<code>ConcreteDecorator</code>\u7c7b\u3002\u8fd9\u65f6\u5019\u53ef\u4ee5\u53bb\u6389\u8003\u8651\u53bb\u6389\u62bd\u8c61\u7684<code>Component</code>\u7c7b(\u63a5\u53e3)\uff0c\u7136\u540e\u628a<code>Decorator</code>\u548c<code>ConcreteDecorator</code>\u5408\u5e76\u6210\u4e00\u4e2a\u7c7b</p>"},{"location":"design/other/fail-fast%26fail-safe/","title":"fail-fast&fail-safe","text":""},{"location":"design/other/fail-fast%26fail-safe/#1-fail-fast","title":"1. fail-fast","text":"<p>\u7b80\u8a00\u4e4b\uff0c\u5feb\u901f\u5931\u8d25\u3002\u6211\u4eec\u5728\u8bbe\u8ba1\u4e00\u4e2a\u6a21\u5757\uff08\u53ef\u4ee5\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e00\u4e2a\u7c7b\u751a\u81f3\u662f\u4e00\u4e2a\u670d\u52a1\uff09\u65f6\uff0c\u5982\u679c\u6709\u67d0\u79cd\u6761\u4ef6\u4f1a\u5bfc\u81f4\u6a21\u5757\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c\u4e0b\u53bb\uff0c\u5c31\u5e94\u8be5\u8ba9\u6a21\u5757\u7acb\u523b\u7ec8\u6b62\uff08\u53ef\u4ee5\u662freturn\uff0c\u4e5f\u53ef\u4ee5\u629b\u4e00\u4e2aruntimeexception\uff09\u3002\u8fd9\u6837\u505a\u6709\u4e24\u79cd\u597d\u5904\uff1a</p> <ol> <li>\u53ca\u65e9\u7ec8\u6b62\uff0c\u9632\u6b62\u9519\u8bef\u4e00\u76f4\u88ab\u5e26\u5230\u4e0b\u6e38\uff0c\u5bfc\u81f4\u4e0b\u6e38\u670d\u52a1\u5d29\u6e83\u6216\u8005\u4ea7\u751f\u810f\u6570\u636e\uff1b</li> <li>\u4fbf\u4e8e\u6392\u67e5\uff0cfail-fast\u4e00\u822c\u90fd\u4f1a\u6709\u7c7b\u4f3c\u65ad\u8a00\u7684\u673a\u5236\u6765\u5224\u5b9a\u67d0\u79cd\u6761\u4ef6\uff0c\u5728\u65ad\u8a00\u5904\u7ec8\u6b62\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9a\u4f4d\u95ee\u9898\uff0c\u800c\u5982\u679c\u9519\u8bef\u88ab\u5e26\u5230\u4e0b\u6e38\uff0c\u5c31\u5f88\u96be\u5b9a\u4f4d\u95ee\u9898\u7684\u6839\u6e90\u4e86\uff1b</li> </ol> <p>\u7ecf\u5178\u4f8b\u5b50\uff1a\u96c6\u5408\u7684ConcurrentModificationException\uff1a\u5728\u5bf9 collection \u8fdb\u884c\u8fed\u4ee3\u65f6\uff0c\u67d0\u4e2a\u7ebf\u7a0b\u5bf9\u8be5 collection \u5728\u7ed3\u6784\u4e0a\u5bf9\u5176\u505a\u4e86\u4fee\u6539\uff0c\u8fd9\u65f6\u8fed\u4ee3\u5668\u5c31\u4f1a\u629b\u51fa ConcurrentModificationException \u5f02\u5e38\u4fe1\u606f\u3002</p>"},{"location":"design/other/fail-fast%26fail-safe/#2-fail-safe","title":"2. fail-safe","text":"<p>\u4e0efail-fast\u76f8\u53cd\uff0c\u5982\u679c\u6a21\u5757\u9047\u5230\u67d0\u79cd\u9519\u8bef\uff0c\u4e0d\u5e94\u8be5\u8ba9\u7a0b\u5e8f\u5931\u8d25\uff0c\u800c\u662f\u91c7\u53d6\u67d0\u79cd\u964d\u7ea7\u7b56\u7565\uff0c\u5c3d\u91cf\u5f80\u4e0b\u8d70\u3002\u8fd9\u4e2a\u539f\u5219\u4e3b\u8981\u9002\u7528\u4e8e\u4e3b\u6a21\u5757\u5185\u7684\u5206\u652f\u6d41\u7a0b\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u6709\u4e00\u4e2a\u63a5\u53e3\uff0c\u4e3b\u8981\u662f\u8fd4\u56defeed\u6d41\u7684\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u5206\u652f\u903b\u8f91\u662f\u8c03\u7528\u5e7f\u544a\u670d\u52a1\u63d2\u5165\u5e7f\u544a\u7c7b\u578b\u7684feed\u7684\uff0c\u5982\u679c\u5e7f\u544a\u670d\u52a1\u4e0d\u53ef\u7528\u4e86\uff0c\u6211\u7684\u6574\u4f53\u903b\u8f91\u662f\u4e0d\u80fd\u6302\u7684\uff0c\u56e0\u4e3a\u4e0d\u63d2\u5165\u5e7f\u544a\u4e5f\u6ca1\u5173\u7cfb\uff0c\u4f46\u662f\u6b63\u5e38\u7684feed\u6d41\u8fd8\u662f\u9700\u8981\u8fd4\u56de\u3002\u6240\u4ee5\u5bf9\u5e7f\u544a\u670d\u52a1\u7684\u8c03\u7528\u662f\u8981\u80fd\u964d\u7ea7\u7684\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u53ef\u4ee5try-catch\u4f4f\uff0c\u5982\u679c\u8c03\u7528\u6709\u5f02\u5e38\u4e86\u5c31\u4e0d\u63d2\u5165\u5e7f\u544a\u3002\u4e0d\u80fd\u56e0\u4e3a\u4e00\u4e2a\u5206\u652f\u903b\u8f91\u800c\u628a\u4e3b\u8981\u903b\u8f91\u6574\u6302\u4e86\u3002</p>"},{"location":"design/other/singleton_extra/","title":"\u5404\u79cd\u5355\u4f8b\u5199\u6cd5","text":""},{"location":"design/other/singleton_extra/#1","title":"1.\u61d2\u6c49\u5f0f\uff0c\u7ebf\u7a0b\u4e0d\u5b89\u5168","text":"<p>\u5f53\u88ab\u95ee\u5230\u8981\u5b9e\u73b0\u4e00\u4e2a\u5355\u4f8b\u6a21\u5f0f\u65f6\uff0c\u5f88\u591a\u4eba\u7684\u7b2c\u4e00\u53cd\u5e94\u662f\u5199\u51fa\u5982\u4e0b\u7684\u4ee3\u7801\uff0c\u5305\u62ec\u6559\u79d1\u4e66\u4e0a\u4e5f\u662f\u8fd9\u6837\u6559\u6211\u4eec\u7684\u3002</p> <pre><code>public class Singleton {\nprivate static Singleton instance;\nprivate Singleton (){}\npublic static Singleton getInstance() {\nif (instance == null) {\ninstance = new Singleton();\n}\nreturn instance;\n}\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u7b80\u5355\u660e\u4e86\uff0c\u800c\u4e14\u4f7f\u7528\u4e86\u61d2\u52a0\u8f7d\u6a21\u5f0f\uff0c\u4f46\u662f\u5374\u5b58\u5728\u81f4\u547d\u7684\u95ee\u9898\u3002\u5f53\u6709\u591a\u4e2a\u7ebf\u7a0b\u5e76\u884c\u8c03\u7528 getInstance() \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u521b\u5efa\u591a\u4e2a\u5b9e\u4f8b\u3002\u4e5f\u5c31\u662f\u8bf4\u5728\u591a\u7ebf\u7a0b\u4e0b\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p>"},{"location":"design/other/singleton_extra/#2","title":"2.\u61d2\u6c49\u5f0f\uff0c\u7ebf\u7a0b\u5b89\u5168","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u5c06\u6574\u4e2a getInstance() \u65b9\u6cd5\u8bbe\u4e3a\u540c\u6b65\uff08synchronized\uff09\u3002</p> <pre><code>public static synchronized Singleton getInstance() {\n    if (instance == null) {\n        instance = new Singleton();\n    }\n    return instance;\n}\n</code></pre> <p>\u867d\u7136\u505a\u5230\u4e86\u7ebf\u7a0b\u5b89\u5168\uff0c\u5e76\u4e14\u89e3\u51b3\u4e86\u591a\u5b9e\u4f8b\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u9ad8\u6548\u3002\u56e0\u4e3a\u5728\u4efb\u4f55\u65f6\u5019\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528 getInstance() \u65b9\u6cd5\u3002\u4f46\u662f\u540c\u6b65\u64cd\u4f5c\u53ea\u9700\u8981\u5728\u7b2c\u4e00\u6b21\u8c03\u7528\u65f6\u624d\u88ab\u9700\u8981\uff0c\u5373\u7b2c\u4e00\u6b21\u521b\u5efa\u5355\u4f8b\u5b9e\u4f8b\u5bf9\u8c61\u65f6\u3002\u8fd9\u5c31\u5f15\u51fa\u4e86\u53cc\u91cd\u68c0\u9a8c\u9501\u3002</p>"},{"location":"design/other/singleton_extra/#3","title":"3.\u53cc\u91cd\u68c0\u9a8c\u9501","text":"<p>\u53cc\u91cd\u68c0\u9a8c\u9501\u6a21\u5f0f\uff08double checked locking pattern\uff09\uff0c\u662f\u4e00\u79cd\u4f7f\u7528\u540c\u6b65\u5757\u52a0\u9501\u7684\u65b9\u6cd5\u3002\u7a0b\u5e8f\u5458\u79f0\u5176\u4e3a\u53cc\u91cd\u68c0\u67e5\u9501\uff0c\u56e0\u4e3a\u4f1a\u6709\u4e24\u6b21\u68c0\u67e5 <code>instance == null</code>\uff0c\u4e00\u6b21\u662f\u5728\u540c\u6b65\u5757\u5916\uff0c\u4e00\u6b21\u662f\u5728\u540c\u6b65\u5757\u5185\u3002\u4e3a\u4ec0\u4e48\u5728\u540c\u6b65\u5757\u5185\u8fd8\u8981\u518d\u68c0\u9a8c\u4e00\u6b21\uff1f\u56e0\u4e3a\u53ef\u80fd\u4f1a\u6709\u591a\u4e2a\u7ebf\u7a0b\u4e00\u8d77\u8fdb\u5165\u540c\u6b65\u5757\u5916\u7684 if\uff0c\u5982\u679c\u5728\u540c\u6b65\u5757\u5185\u4e0d\u8fdb\u884c\u4e8c\u6b21\u68c0\u9a8c\u7684\u8bdd\u5c31\u4f1a\u751f\u6210\u591a\u4e2a\u5b9e\u4f8b\u4e86\u3002</p> <pre><code>public static Singleton getSingleton() {\n    if (instance == null) {                         //Single Checked\n        synchronized (Singleton.class) {\n            if (instance == null) {                 //Double Checked\n                instance = new Singleton();\n            }\n        }\n    }\n    return instance ;\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u770b\u8d77\u6765\u5f88\u5b8c\u7f8e\uff0c\u5f88\u53ef\u60dc\uff0c\u5b83\u662f\u6709\u95ee\u9898\u3002\u4e3b\u8981\u5728\u4e8e<code>instance = new Singleton()</code>\u8fd9\u53e5\uff0c\u8fd9\u5e76\u975e\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff0c\u4e8b\u5b9e\u4e0a\u5728 JVM \u4e2d\u8fd9\u53e5\u8bdd\u5927\u6982\u505a\u4e86\u4e0b\u9762 3 \u4ef6\u4e8b\u60c5\u3002</p> <ol> <li>\u7ed9 instance \u5206\u914d\u5185\u5b58</li> <li>\u8c03\u7528 Singleton \u7684\u6784\u9020\u51fd\u6570\u6765\u521d\u59cb\u5316\u6210\u5458\u53d8\u91cf</li> <li>\u5c06instance\u5bf9\u8c61\u6307\u5411\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\uff08\u6267\u884c\u5b8c\u8fd9\u6b65 instance \u5c31\u4e3a\u975e null \u4e86\uff09</li> </ol> <p>\u4f46\u662f\u5728 JVM \u7684\u5373\u65f6\u7f16\u8bd1\u5668\u4e2d\u5b58\u5728\u6307\u4ee4\u91cd\u6392\u5e8f\u7684\u4f18\u5316\u3002\u4e5f\u5c31\u662f\u8bf4\u4e0a\u9762\u7684\u7b2c\u4e8c\u6b65\u548c\u7b2c\u4e09\u6b65\u7684\u987a\u5e8f\u662f\u4e0d\u80fd\u4fdd\u8bc1\u7684\uff0c\u6700\u7ec8\u7684\u6267\u884c\u987a\u5e8f\u53ef\u80fd\u662f 1-2-3 \u4e5f\u53ef\u80fd\u662f 1-3-2\u3002\u5982\u679c\u662f\u540e\u8005\uff0c\u5219\u5728 3 \u6267\u884c\u5b8c\u6bd5\u30012 \u672a\u6267\u884c\u4e4b\u524d\uff0c\u88ab\u7ebf\u7a0b\u4e8c\u62a2\u5360\u4e86\uff0c\u8fd9\u65f6 instance \u5df2\u7ecf\u662f\u975e null \u4e86\uff08\u4f46\u5374\u6ca1\u6709\u521d\u59cb\u5316\uff09\uff0c\u6240\u4ee5\u7ebf\u7a0b\u4e8c\u4f1a\u76f4\u63a5\u8fd4\u56de instance\uff0c\u7136\u540e\u4f7f\u7528\uff0c\u7136\u540e\u987a\u7406\u6210\u7ae0\u5730\u62a5\u9519\u3002</p> <p>\u6211\u4eec\u53ea\u9700\u8981\u5c06 instance \u53d8\u91cf\u58f0\u660e\u6210 volatile \u5c31\u53ef\u4ee5\u4e86\u3002</p> <pre><code>public class Singleton {\n    private volatile static Singleton instance; //\u58f0\u660e\u6210 volatile\n    private Singleton (){}\n\n    public static Singleton getSingleton() {\n        if (instance == null) {                         \n            synchronized (Singleton.class) {\n                if (instance == null) {       \n                    instance = new Singleton();\n                }\n            }\n        }\n        return instance;\n    }\n\n}\n</code></pre> <p>\u6709\u4e9b\u4eba\u8ba4\u4e3a\u4f7f\u7528 volatile \u7684\u539f\u56e0\u662f\u53ef\u89c1\u6027\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u4fdd\u8bc1\u7ebf\u7a0b\u5728\u672c\u5730\u4e0d\u4f1a\u5b58\u6709 instance \u7684\u526f\u672c\uff0c\u6bcf\u6b21\u90fd\u662f\u53bb\u4e3b\u5185\u5b58\u4e2d\u8bfb\u53d6\u3002\u4f46\u5176\u5b9e\u662f\u4e0d\u5bf9\u7684\u3002\u4f7f\u7528 volatile \u7684\u4e3b\u8981\u539f\u56e0\u662f\u5176\u53e6\u4e00\u4e2a\u7279\u6027\uff1a\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u4f18\u5316\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728 volatile \u53d8\u91cf\u7684\u8d4b\u503c\u64cd\u4f5c\u540e\u9762\u4f1a\u6709\u4e00\u4e2a\u5185\u5b58\u5c4f\u969c\uff08\u751f\u6210\u7684\u6c47\u7f16\u4ee3\u7801\u4e0a\uff09\uff0c\u8bfb\u64cd\u4f5c\u4e0d\u4f1a\u88ab\u91cd\u6392\u5e8f\u5230\u5185\u5b58\u5c4f\u969c\u4e4b\u524d\u3002\u6bd4\u5982\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u53d6\u64cd\u4f5c\u5fc5\u987b\u5728\u6267\u884c\u5b8c 1-2-3 \u4e4b\u540e\u6216\u8005 1-3-2 \u4e4b\u540e\uff0c\u4e0d\u5b58\u5728\u6267\u884c\u5230 1-3 \u7136\u540e\u53d6\u5230\u503c\u7684\u60c5\u51b5\u3002\u4ece\u300c\u5148\u884c\u53d1\u751f\u539f\u5219\u300d\u7684\u89d2\u5ea6\u7406\u89e3\u7684\u8bdd\uff0c\u5c31\u662f\u5bf9\u4e8e\u4e00\u4e2a volatile \u53d8\u91cf\u7684\u5199\u64cd\u4f5c\u90fd\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\u5bf9\u8fd9\u4e2a\u53d8\u91cf\u7684\u8bfb\u64cd\u4f5c\uff08\u8fd9\u91cc\u7684\u201c\u540e\u9762\u201d\u662f\u65f6\u95f4\u4e0a\u7684\u5148\u540e\u987a\u5e8f\uff09\u3002</p> <p>\u4f46\u662f\u7279\u522b\u6ce8\u610f\u5728 Java 5 \u4ee5\u524d\u7684\u7248\u672c\u4f7f\u7528\u4e86 volatile \u7684\u53cc\u68c0\u9501\u8fd8\u662f\u6709\u95ee\u9898\u7684\u3002\u5176\u539f\u56e0\u662f Java 5 \u4ee5\u524d\u7684 JMM \uff08Java \u5185\u5b58\u6a21\u578b\uff09\u662f\u5b58\u5728\u7f3a\u9677\u7684\uff0c\u5373\u65f6\u5c06\u53d8\u91cf\u58f0\u660e\u6210 volatile \u4e5f\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u91cd\u6392\u5e8f\uff0c\u4e3b\u8981\u662f volatile \u53d8\u91cf\u524d\u540e\u7684\u4ee3\u7801\u4ecd\u7136\u5b58\u5728\u91cd\u6392\u5e8f\u95ee\u9898\u3002\u8fd9\u4e2a volatile \u5c4f\u853d\u91cd\u6392\u5e8f\u7684\u95ee\u9898\u5728 Java 5 \u4e2d\u624d\u5f97\u4ee5\u4fee\u590d\uff0c\u6240\u4ee5\u5728\u8fd9\u4e4b\u540e\u624d\u53ef\u4ee5\u653e\u5fc3\u4f7f\u7528 volatile\u3002</p> <p>\u76f8\u4fe1\u4f60\u4e0d\u4f1a\u559c\u6b22\u8fd9\u79cd\u590d\u6742\u53c8\u9690\u542b\u95ee\u9898\u7684\u65b9\u5f0f\uff0c\u5f53\u7136\u6211\u4eec\u6709\u66f4\u597d\u7684\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684\u5355\u4f8b\u6a21\u5f0f\u7684\u529e\u6cd5\u3002</p>"},{"location":"design/other/singleton_extra/#4-static-final-field","title":"4.\u997f\u6c49\u5f0f static final field","text":"<p>\u8fd9\u79cd\u65b9\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u56e0\u4e3a\u5355\u4f8b\u7684\u5b9e\u4f8b\u88ab\u58f0\u660e\u6210 static \u548c final \u53d8\u91cf\u4e86\uff0c\u5728\u7b2c\u4e00\u6b21\u52a0\u8f7d\u7c7b\u5230\u5185\u5b58\u4e2d\u65f6\u5c31\u4f1a\u521d\u59cb\u5316\uff0c\u6240\u4ee5\u521b\u5efa\u5b9e\u4f8b\u672c\u8eab\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p> <pre><code>public class Singleton{\n    //\u7c7b\u52a0\u8f7d\u65f6\u5c31\u521d\u59cb\u5316\n    private static final Singleton instance = new Singleton();\n\n    private Singleton(){}\n\n    public static Singleton getInstance(){\n        return instance;\n    }\n}\n</code></pre> <p>\u8fd9\u79cd\u5199\u6cd5\u5982\u679c\u5b8c\u7f8e\u7684\u8bdd\uff0c\u5c31\u6ca1\u5fc5\u8981\u5728\u5570\u55e6\u90a3\u4e48\u591a\u53cc\u68c0\u9501\u7684\u95ee\u9898\u4e86\u3002\u7f3a\u70b9\u662f\u5b83\u4e0d\u662f\u4e00\u79cd\u61d2\u52a0\u8f7d\u6a21\u5f0f\uff08lazy initialization\uff09\uff0c\u5355\u4f8b\u4f1a\u5728\u52a0\u8f7d\u7c7b\u540e\u4e00\u5f00\u59cb\u5c31\u88ab\u521d\u59cb\u5316\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef\u6ca1\u6709\u8c03\u7528 getInstance()\u65b9\u6cd5\u3002\u997f\u6c49\u5f0f\u7684\u521b\u5efa\u65b9\u5f0f\u5728\u4e00\u4e9b\u573a\u666f\u4e2d\u5c06\u65e0\u6cd5\u4f7f\u7528\uff1a\u8b6c\u5982 Singleton \u5b9e\u4f8b\u7684\u521b\u5efa\u662f\u4f9d\u8d56\u53c2\u6570\u6216\u8005\u914d\u7f6e\u6587\u4ef6\u7684\uff0c\u5728 getInstance() \u4e4b\u524d\u5fc5\u987b\u8c03\u7528\u67d0\u4e2a\u65b9\u6cd5\u8bbe\u7f6e\u53c2\u6570\u7ed9\u5b83\uff0c\u90a3\u6837\u8fd9\u79cd\u5355\u4f8b\u5199\u6cd5\u5c31\u65e0\u6cd5\u4f7f\u7528\u4e86\u3002</p>"},{"location":"design/other/singleton_extra/#5-static-nested-class","title":"5.\u9759\u6001\u5185\u90e8\u7c7b static nested class","text":"<p>\u6211\u6bd4\u8f83\u503e\u5411\u4e8e\u4f7f\u7528\u9759\u6001\u5185\u90e8\u7c7b\u7684\u65b9\u6cd5\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u662f\u300aEffective Java\u300b\u4e0a\u6240\u63a8\u8350\u7684\u3002</p> <pre><code>public class Singleton {  \n    private static class SingletonHolder {  \n        private static final Singleton INSTANCE = new Singleton();  \n    }  \n    private Singleton (){}  \n    public static final Singleton getInstance() {  \n        return SingletonHolder.INSTANCE; \n    }  \n}\n</code></pre> <p>\u8fd9\u79cd\u5199\u6cd5\u4ecd\u7136\u4f7f\u7528JVM\u672c\u8eab\u673a\u5236\u4fdd\u8bc1\u4e86\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff1b\u7531\u4e8e SingletonHolder \u662f\u79c1\u6709\u7684\uff0c\u9664\u4e86 getInstance() \u4e4b\u5916\u6ca1\u6709\u529e\u6cd5\u8bbf\u95ee\u5b83\uff0c\u56e0\u6b64\u5b83\u662f\u61d2\u6c49\u5f0f\u7684\uff1b\u540c\u65f6\u8bfb\u53d6\u5b9e\u4f8b\u7684\u65f6\u5019\u4e0d\u4f1a\u8fdb\u884c\u540c\u6b65\uff0c\u6ca1\u6709\u6027\u80fd\u7f3a\u9677\uff1b\u4e5f\u4e0d\u4f9d\u8d56 JDK \u7248\u672c\u3002</p>"},{"location":"design/other/singleton_extra/#6-enum","title":"6.\u679a\u4e3e Enum","text":"<p>\u7528\u679a\u4e3e\u5199\u5355\u4f8b\u5b9e\u5728\u592a\u7b80\u5355\u4e86\uff01\u8fd9\u4e5f\u662f\u5b83\u6700\u5927\u7684\u4f18\u70b9\u3002\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u5c31\u662f\u58f0\u660e\u679a\u4e3e\u5b9e\u4f8b\u7684\u901a\u5e38\u505a\u6cd5\u3002</p> <pre><code>public enum EasySingleton{\n    INSTANCE;\n}\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7EasySingleton.INSTANCE\u6765\u8bbf\u95ee\u5b9e\u4f8b\uff0c\u8fd9\u6bd4\u8c03\u7528getInstance()\u65b9\u6cd5\u7b80\u5355\u591a\u4e86\u3002\u521b\u5efa\u679a\u4e3e\u9ed8\u8ba4\u5c31\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u62c5\u5fc3double checked locking\uff0c\u800c\u4e14\u8fd8\u80fd\u9632\u6b62\u53cd\u5e8f\u5217\u5316\u5bfc\u81f4\u91cd\u65b0\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\u3002</p>"},{"location":"design/other/singleton_extra/#7-kotlin-object","title":"7. Kotlin Object\u7c7b","text":"<p>\u5728 Kotlin \u4e2d\uff0c\u5b9e\u73b0\u5355\u4f8b\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5c06\u5173\u952e\u5b57 class \u66ff\u6362\u4e3a object \u5373\u53ef\u3002</p> <pre><code>object SomeSingleton{ fun sayHi(){} } </code></pre> <p>Kotlin \u7684 object \u5176\u5b9e\u5c31\u662f\u997f\u6c49\u5f0f\u5355\u4f8b\u3002\u901a\u8fc7\u5de5\u5177\u5c06Kotlin\u4ee3\u7801\u8fd8\u539f\u4e3a Java \u4ee3\u7801\uff0c\u5982\u4e0b:</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cINSTANCE \u4f7f\u7528 static final \u58f0\u660e\uff0c\u5e76\u4e14\u5728 static \u4ee3\u7801\u5757\u5185\u5bf9\u5176\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u6807\u51c6\u7684\u997f\u6c49\u5f0f\u5355\u4f8b\u3002</p>"},{"location":"design/other/singleton_extra/#8","title":"8. \u53cc\u91cd\u68c0\u6d4b\u5c31\u6bd4\u997f\u6c49\u5f0f\u9ad8\u7ea7\uff1f","text":""},{"location":"design/other/singleton_extra/#81kotlin-object","title":"8.1.\u997f\u6c49\u5f0f\u5982\u4f55\u4fdd\u8bc1\u552f\u4e00\u548c\u7ebf\u7a0b\u5b89\u5168?Kotlin \u7684 object \u4e3a\u4ec0\u4e48\u7528\u997f\u6c49\u5f0f\uff1f","text":"<p>\u997f\u6c49\u5f0f\u5355\u4f8b\u7684\u539f\u7406\uff0c\u5176\u5b9e\u662f\u57fa\u4e8e JVM \u7684\u7c7b\u52a0\u8f7d\u673a\u5236\u6765\u4fdd\u8bc1\u5176\u7b26\u5408\u5355\u4f8b\u7684\u89c4\u8303\u7684\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0cJVM \u5728\u52a0\u8f7d\u7c7b\u7684\u65f6\u5019\uff0c\u4f1a\u7ecf\u8fc7\u521d\u59cb\u5316\u9636\u6bb5(\u5373 Class \u88ab\u52a0\u8f7d\u540e\uff0c\u4e14\u88ab\u7ebf\u7a0b\u4f7f\u7528\u524d)\u3002\u5728\u521d\u59cb\u5316\u671f\u95f4\uff0cJVM \u4f1a\u83b7\u53d6\u4e00\u628a\u9501\uff0c\u8fd9\u4e2a\u9501\u53ef\u4ee5\u540c\u6b65\u591a\u4e2a\u7ebf\u7a0b\uff0c\u5bf9\u4e00\u4e2a\u7c7b\u7684\u521d\u59cb\u5316\uff0c\u786e\u4fdd\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u7c7b\u7684\u52a0\u8f7d\u8fc7\u7a0b\u3002\u8fd9\u4e2a\u6b65\u9aa4\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p> <p></p>"},{"location":"design/other/singleton_extra/#82","title":"8.2 \u61d2\u52a0\u8f7d","text":"<p>\u52a0\u8f7d\u7684\u76ee\u7684\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u4e3a\u4e86\u907f\u514d\uff0c\u65e0\u5fc5\u8981\u7684\u8d44\u6e90\u6d6a\u8d39\uff0c\u5728\u4e0d\u9700\u8981\u7684\u65f6\u5019\u4e0d\u52a0\u8f7d\uff0c\u7b49\u4ec0\u4e48\u65f6\u5019\u4e1a\u52a1\u771f\u7684\u9700\u8981\u4f7f\u7528\u5230\u5b83\u7684\u65f6\u5019\uff0c\u518d\u52a0\u8f7d\u8d44\u6e90\u3002</p> <p>\u867d\u7136\u997f\u6c49\u5f0f\u4f9d\u8d56\u865a\u62df\u673a\u52a0\u8f7d\u7c7b\u7684\u7b56\u7565\uff0c\u4f46\u865a\u62df\u673a\u672c\u8eab\u4e5f\u4f1a\u6709\u4f18\u5316\u9879\uff0c\u90a3\u5c31\u662f\u300c\u6309\u9700\u52a0\u8f7d\u300d\u7684\u7b56\u7565\u3002</p> <p>\u865a\u62df\u673a\u5728\u8fd0\u884c\u7a0b\u5e8f\u65f6\uff0c\u5e76\u4e0d\u65f6\u5728\u542f\u52a8\u65f6\uff0c\u5c31\u5c06\u6240\u6709\u7684\u7c7b\u90fd\u52a0\u8f7d\u5e76\u521d\u59cb\u5316\u5b8c\u6210\uff0c\u800c\u662f\u91c7\u7528\u300c\u6309\u9700\u52a0\u8f7d\u300d\u7684\u7b56\u7565\uff0c\u5728\u771f\u6b63\u4f7f\u7528\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u521d\u59cb\u5316\u3002</p> <p>\u4f8b\u5982 \u663e\u5f0f\u7684 new Class()\u3001\u8c03\u7528\u7c7b\u7684\u9759\u6001\u65b9\u6cd5\u3001\u53cd\u5c04\u3001Class.forName() \u7b49\uff0c\u8fd9\u4e9b\u4e8b\u4ef6\u9996\u6b21\u53d1\u751f\u65f6\uff0c\u90fd\u4f1a\u89e6\u53d1\u865a\u62df\u673a\u52a0\u8f7d\u7c7b\u3002</p> <p>\u4f8b\u5982\u524d\u6587\u4e2d\uff0c<code>Kotlin SomeSingleton</code> \u8fd9\u4e2a\u5355\u4f8b\u7c7b\uff0c\u6211\u4eec\u653e\u5230\u4e00\u4e2a App \u4e2d\u8fd0\u884c\u4e00\u4e0b\uff0cApp \u5148\u542f\u52a8\uff0c\u70b9\u51fb\u6309\u94ae\u6267\u884c <code>SomeSingleton.sayHi()</code>\u65b9\u6cd5\u3002</p> <pre><code>15:39:34.539 I/cxmyDev: App running 15:39:44.606 I/cxmyDev: SomeSingleton init 15:39:44.606 I/cxmyDev: SomeSingleton sayHi 1.2.3.\n</code></pre> <p>\u6ce8\u610f Log \u7684\u65f6\u95f4\uff0c\u53ea\u6709\u70b9\u51fb\u6309\u94ae\u6267\u884c SomeSingleton.sayHi() \u65f6\uff0c\u8be5\u5355\u4f8b\u7c7b\u624d\u88ab\u865a\u62df\u673a\u52a0\u8f7d\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u901a\u5e38\u53ea\u6709\u5728\u4f60\u771f\u5b9e\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u65f6\uff0c\u5b83\u624d\u4f1a\u771f\u7684\u88ab\u865a\u62df\u673a\u521d\u59cb\u5316\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u62c5\u5fc3\u4f1a\u88ab\u63d0\u524d\u52a0\u8f7d\u800c\u5bfc\u81f4\u8d44\u6e90\u6d6a\u8d39\u3002</p> <p>\u5f53\u7136\uff0c\u4e0d\u540c\u865a\u62df\u673a\u7684\u5b9e\u73b0\u65b9\u5f0f\u4e0d\u540c\uff0c\u8fd9\u5e76\u4e0d\u662f\u5f3a\u5236\u7684\uff0c\u4f46\u662f\u5927\u591a\u6570\u4e3a\u4e86\u6027\u80fd\u90fd\u4f1a\u51c6\u5b88\u6b64\u89c4\u5219\u3002</p> <p>\u65e2\u7136\u997f\u6c49\u5f0f\u7684\u5355\u4f8b\uff0c\u4e5f\u662f\u5728\u9996\u6b21\u4f7f\u7528\u65f6\u521d\u59cb\u5316\uff0c\u8fd9\u81ea\u7136\u5c31\u662f\u4e00\u79cd\u7c7b\u61d2\u52a0\u8f7d\u7684\u6548\u679c\u3002</p> <p>Kotlin \u7684 object \u9009\u62e9\u997f\u6c49\u5f0f\u5355\u4f8b\uff0c\u5728\u6027\u80fd\u548c\u5b9e\u73b0\u4e0a\u90fd\u4e0d\u5b58\u5728\u95ee\u9898\uff0c\u4f7f\u7528\u5b83\u65e0\u9700\u987e\u8651\u3002</p>"},{"location":"design/other/singleton_extra/#_1","title":"\u53c2\u8003","text":"<p>\u5982\u4f55\u6b63\u786e\u5730\u5199\u51fa\u5355\u4f8b\u6a21\u5f0f</p> <p>Kotlin \u7684 object \u4e3a\u4ec0\u4e48\u7528\u997f\u6c49\u5f0f\uff1f</p>"},{"location":"front-end/","title":"\u5927\u524d\u7aef","text":""},{"location":"front-end/android/concurrency/basic/","title":"\u5e76\u53d1\u57fa\u7840","text":""},{"location":"front-end/android/concurrency/basic/#1","title":"1. \u57fa\u7840\u6982\u5ff5","text":""},{"location":"front-end/android/concurrency/basic/#11","title":"1.1. \u8fdb\u7a0b","text":"<p>\u8fdb\u7a0b\u662f\u5177\u6709\u4e00\u5b9a\u72ec\u7acb\u529f\u80fd\u7684\u7a0b\u5e8f\u5173\u4e8e\u67d0\u4e2a\u6570\u636e\u96c6\u5408\u4e0a\u7684\u4e00\u6b21\u8fd0\u884c\u6d3b\u52a8\uff0c\u8fdb\u7a0b\u662f\u7cfb\u7edf\u8fdb\u884c\u8d44\u6e90\u5206\u914d\u548c\u8c03\u5ea6\u7684\u4e00\u4e2a\u72ec\u7acb\u5355\u4f4d\u3002\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u5185\u5b58\u7a7a\u95f4\uff0c\u4e0d\u540c\u8fdb\u7a0b\u901a\u8fc7\u8fdb\u7a0b\u95f4\u901a\u4fe1\u6765\u901a\u4fe1\u3002\u7531\u4e8e\u8fdb\u7a0b\u6bd4\u8f83\u91cd\u91cf\u7ea7\uff0c\u5f00\u9500\u5927\uff0c\u5360\u636e\u72ec\u7acb\u7684\u5185\u5b58\uff0c\u6240\u4ee5\u4e0a\u4e0b\u6587\u8fdb\u7a0b\u95f4\u7684\u5207\u6362\u5f00\u9500\uff08\u6808\u3001\u5bc4\u5b58\u5668\u3001\u865a\u62df\u5185\u5b58\u3001\u6587\u4ef6\u53e5\u67c4\u7b49\uff09\u6bd4\u8f83\u5927\uff0c\u4f46\u76f8\u5bf9\u6bd4\u8f83\u7a33\u5b9a\u5b89\u5168\u3002</p>"},{"location":"front-end/android/concurrency/basic/#12","title":"1.2 \u7ebf\u7a0b","text":"<p>\u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u76f8\u4f3c\uff0c\u4f46\u7ebf\u7a0b\u662f\u4e00\u4e2a\u6bd4\u8fdb\u7a0b\u66f4\u5c0f\u7684\u6267\u884c\u5355\u4f4d\u3002\u4e00\u4e2a\u8fdb\u7a0b\u5728\u5176\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4ea7\u751f\u591a\u4e2a\u7ebf\u7a0b\u3002\u4e0e\u8fdb\u7a0b\u4e0d\u540c\u7684\u662f\u540c\u7c7b\u7684\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7684\u5806\u548c\u65b9\u6cd5\u533a\u8d44\u6e90\uff0c\u4f46\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\u3001\u865a\u62df\u673a\u6808\u548c\u672c\u5730\u65b9\u6cd5\u6808\uff0c\u6240\u4ee5\u7cfb\u7edf\u5728\u4ea7\u751f\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6216\u662f\u5728\u5404\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u4f5c\u5207\u6362\u5de5\u4f5c\u65f6\uff0c\u8d1f\u62c5\u8981\u6bd4\u8fdb\u7a0b\u5c0f\u5f97\u591a\uff0c\u4e5f\u6b63\u56e0\u4e3a\u5982\u6b64\uff0c\u7ebf\u7a0b\u4e5f\u88ab\u79f0\u4e3a\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\u3002</p>"},{"location":"front-end/android/concurrency/basic/#13","title":"1.3 \u534f\u7a0b","text":"<p>\u534f\u7a0b\uff08coroutine\uff09\u662f\u4e00\u79cd\u7a0b\u5e8f\u8fd0\u884c\u7684\u65b9\u5f0f\uff0c\u5373\u5728\u5355\u7ebf\u7a0b\u91cc\u591a\u4e2a\u51fd\u6570\u5e76\u53d1\u5730\u6267\u884c. \u534f\u7a0b\u662f\u4e00\u79cd\u7528\u6237\u6001\u7684\u8f7b\u91cf\u7ea7\u7ebf\u7a0b\uff0c\u534f\u7a0b\u7684\u8c03\u5ea6\u5b8c\u5168\u7531\u7528\u6237\u63a7\u5236\u3002\u4ece\u6280\u672f\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u201c\u534f\u7a0b\u5c31\u662f\u4f60\u53ef\u4ee5\u6682\u505c\u6267\u884c\u7684\u51fd\u6570\u201d\u3002\u534f\u7a0b\u62e5\u6709\u81ea\u5df1\u7684\u5bc4\u5b58\u5668\u4e0a\u4e0b\u6587\u548c\u6808\u3002\u534f\u7a0b\u8c03\u5ea6\u5207\u6362\u65f6\uff0c\u5c06\u5bc4\u5b58\u5668\u4e0a\u4e0b\u6587\u548c\u6808\u4fdd\u5b58\u5230\u5176\u4ed6\u5730\u65b9\uff0c\u5728\u5207\u56de\u6765\u7684\u65f6\u5019\uff0c\u6062\u590d\u5148\u524d\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u4e0a\u4e0b\u6587\u548c\u6808\uff0c\u76f4\u63a5\u64cd\u4f5c\u6808\u5219\u57fa\u672c\u6ca1\u6709\u5185\u6838\u5207\u6362\u7684\u5f00\u9500\uff0c\u53ef\u4ee5\u4e0d\u52a0\u9501\u7684\u8bbf\u95ee\u5168\u5c40\u53d8\u91cf\uff0c\u6240\u4ee5\u4e0a\u4e0b\u6587\u7684\u5207\u6362\u975e\u5e38\u5feb\u3002</p>"},{"location":"front-end/android/concurrency/basic/#14","title":"1.4 \u8fdb\u7a0b\u3001\u7ebf\u7a0b\u3001\u534f\u7a0b\u7684\u5bf9\u6bd4","text":"<ul> <li>\u7ebf\u7a0b\u662f\u5904\u7406\u5668\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4f46\u8fdb\u7a0b\u4e0d\u662f</li> <li>\u534f\u7a0b\u65e2\u4e0d\u662f\u8fdb\u7a0b\u4e5f\u4e0d\u662f\u7ebf\u7a0b\uff0c\u534f\u7a0b\u4ec5\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u51fd\u6570\u3002\u534f\u7a0b\u3001\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u4e0d\u662f\u4e00\u4e2a\u7ef4\u5ea6\u7684\u3002</li> <li>\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u534f\u7a0b\u3002\u867d\u7136\u4e00\u4e2a\u7ebf\u7a0b\u5185\u7684\u591a\u4e2a\u534f\u7a0b\u53ef\u4ee5\u5207\u6362\u4f46\u662f\u8fd9\u591a\u4e2a\u534f\u7a0b\u662f\u4e32\u884c\u6267\u884c\u7684\uff0c\u67d0\u4e2a\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u8fd0\u884c\uff0c\u6ca1\u6cd5\u5229\u7528CPU\u7684\u591a\u6838\u80fd\u529b\u3002</li> <li>\u534f\u7a0b\u4e0e\u8fdb\u7a0b\u4e00\u6837\uff0c\u4e5f\u5b58\u5728\u4e0a\u4e0b\u6587\u5207\u6362\u95ee\u9898\u3002</li> <li>\u8fdb\u7a0b\u7684\u5207\u6362\u8005\u662f\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5207\u6362\u65f6\u673a\u662f\u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5df1\u7684\u5207\u6362\u7b56\u7565\u6765\u51b3\u5b9a\u7684\uff0c\u7528\u6237\u662f\u65e0\u611f\u7684\u3002\u8fdb\u7a0b\u7684\u5207\u6362\u5185\u5bb9\u5305\u62ec\u9875\u5168\u5c40\u76ee\u5f55\u3001\u5185\u6838\u6808\u548c\u786c\u4ef6\u4e0a\u4e0b\u6587\uff0c\u5207\u6362\u5185\u5bb9\u88ab\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002 \u8fdb\u7a0b\u5207\u6362\u8fc7\u7a0b\u91c7\u7528\u7684\u662f\u201c\u4ece\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u518d\u5230\u7528\u6237\u6001\u201d\u7684\u65b9\u5f0f\uff0c\u5207\u6362\u6548\u7387\u4f4e\u3002</li> <li>\u7ebf\u7a0b\u7684\u5207\u6362\u8005\u662f\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5207\u6362\u65f6\u673a\u662f\u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5df1\u7684\u5207\u6362\u7b56\u7565\u6765\u51b3\u5b9a\u7684\uff0c\u7528\u6237\u662f\u65e0\u611f\u7684\u3002\u7ebf\u7a0b\u7684\u5207\u6362\u5185\u5bb9\u5305\u62ec\u5185\u6838\u6808\u548c\u786c\u4ef6\u4e0a\u4e0b\u6587\u3002\u7ebf\u7a0b\u5207\u6362\u5185\u5bb9\u88ab\u4fdd\u5b58\u5728\u5185\u6838\u6808\u4e2d\u3002\u7ebf\u7a0b\u5207\u6362\u8fc7\u7a0b\u91c7\u7528\u7684\u662f\u201c\u4ece\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u518d\u5230\u7528\u6237\u6001\u201d\u7684\u65b9\u5f0f\uff0c\u5207\u6362\u6548\u7387\u4e2d\u7b49\u3002</li> <li>\u534f\u7a0b\u7684\u5207\u6362\u8005\u662f\u7528\u6237(\u7f16\u7a0b\u8005\u6216\u5e94\u7528\u7a0b\u5e8f),\u5207\u6362\u65f6\u673a\u662f\u7528\u6237\u81ea\u5df1\u7684\u7a0b\u5e8f\u6765\u51b3\u5b9a\u7684\u3002\u534f\u7a0b\u7684\u5207\u6362\u5185\u5bb9\u662f\u786c\u4ef6\u4e0a\u4e0b\u6587\uff0c\u5207\u6362\u5185\u5b58\u88ab\u4fdd\u5b58\u5728\u7528\u81ea\u5df1\u7684\u53d8\u91cf(\u7528\u6237\u6808\u6216\u5806)\u4e2d\u3002\u534f\u7a0b\u7684\u5207\u6362\u8fc7\u7a0b\u53ea\u6709\u7528\u6237\u6001(\u5373\u6ca1\u6709\u9677\u5165\u5185\u6838\u6001),\u56e0\u6b64\u5207\u6362\u6548\u7387\u9ad8\u3002</li> </ul>"},{"location":"front-end/android/concurrency/basic/#15","title":"1.5 \u7528\u6237\u6001\u548c\u5185\u6838\u6001","text":"<ul> <li>\u5185\u6838\u7a7a\u95f4\uff08Kernal Space\uff09\uff0c\u8fd9\u4e2a\u7a7a\u95f4\u53ea\u6709\u5185\u6838\u7a0b\u5e8f\u53ef\u4ee5\u8bbf\u95ee\uff1b</li> <li>\u7528\u6237\u7a7a\u95f4\uff08User Space\uff09\uff0c\u8fd9\u90e8\u5206\u5185\u5b58\u4e13\u95e8\u7ed9\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u3002</li> </ul> <p>\u7528\u6237\u7a7a\u95f4\u4e2d\u7684\u4ee3\u7801\u88ab\u9650\u5236\u4e86\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u5c40\u90e8\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u8bf4\u8fd9\u4e9b\u7a0b\u5e8f\u5728\u7528\u6237\u6001\uff08User Mode\uff09 \u6267\u884c\u3002\u5185\u6838\u7a7a\u95f4\u4e2d\u7684\u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u6240\u6709\u5185\u5b58\uff0c\u6211\u4eec\u79f0\u8fd9\u4e9b\u7a0b\u5e8f\u5728\u5185\u6838\u6001\uff08Kernal Mode\uff09 \u6267\u884c\u3002</p>"},{"location":"front-end/android/concurrency/basic/#151","title":"1.5.1 \u4e3a\u4ec0\u4e48\u8981\u533a\u5206\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001","text":"<p>\u5728CPU\u7684\u6240\u6709\u6307\u4ee4\u4e2d\uff0c\u6709\u4e00\u4e9b\u6307\u4ee4\u662f\u975e\u5e38\u5371\u9669\u7684\uff0c\u5982\u679c\u9519\u7528\uff0c\u5c06\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u5d29\u6e83\u3002\u6bd4\u5982\uff1a\u6e05\u5185\u5b58\u3001\u8bbe\u7f6e\u65f6\u949f\u7b49\u3002\u5982\u679c\u6240\u6709\u7684\u7a0b\u5e8f\u90fd\u80fd\u4f7f\u7528\u8fd9\u4e9b\u6307\u4ee4\uff0c\u90a3\u4e48\u4f60\u7684\u7cfb\u7edf\u4e00\u5929\u6b7b\u673aN\u56de\u5c31\u4e0d\u8db3\u4e3a\u5947\u4e86\u3002\u6240\u4ee5\uff0cCPU\u5c06\u6307\u4ee4\u5206\u4e3a\u7279\u6743\u6307\u4ee4\u548c\u975e\u7279\u6743\u6307\u4ee4\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u5371\u9669\u7684\u6307\u4ee4\uff0c\u53ea\u5141\u8bb8\u64cd\u4f5c\u7cfb\u7edf\u53ca\u5176\u76f8\u5173\u6a21\u5757\u4f7f\u7528\uff0c\u666e\u901a\u7684\u5e94\u7528\u7a0b\u5e8f\u53ea\u80fd\u4f7f\u7528\u90a3\u4e9b\u4e0d\u4f1a\u9020\u6210\u707e\u96be\u7684\u6307\u4ee4\u3002</p>"},{"location":"front-end/android/concurrency/basic/#152","title":"1.5.2 \u7528\u6237\u6001\u5230\u5185\u6838\u6001\u600e\u6837\u5207\u6362\uff1f","text":"<p>\u4ece\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u5207\u6362\u53ef\u4ee5\u901a\u8fc7\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u7cfb\u7edf\u8c03\u7528\uff1a \u8fd9\u662f\u7528\u6237\u6001\u8fdb\u7a0b\u4e3b\u52a8\u8981\u6c42\u5207\u6362\u5230\u5185\u6838\u6001\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u7528\u6237\u6001\u8fdb\u7a0b\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7533\u8bf7\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u7a0b\u5e8f\u5b8c\u6210\u5de5\u4f5c\uff0c\u6bd4\u5982<code>fork()</code>\u5b9e\u9645\u4e0a\u5c31\u662f\u6267\u884c\u4e86\u4e00\u4e2a\u521b\u5efa\u65b0\u8fdb\u7a0b\u7684\u7cfb\u7edf\u8c03\u7528\u3002\u800c\u7cfb\u7edf\u8c03\u7528\u7684\u673a\u5236\u5176\u6838\u5fc3\u8fd8\u662f\u4f7f\u7528\u4e86\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u7528\u6237\u7279\u522b\u5f00\u653e\u7684\u4e00\u4e2a\u4e2d\u65ad\u6765\u5b9e\u73b0\uff0c\u4f8b\u5982Linux\u7684<code>int 80h</code>\u4e2d\u65ad\u3002</p> </li> <li> <p>\u5f02\u5e38\uff1a \u5f53CPU\u5728\u6267\u884c\u8fd0\u884c\u5728\u7528\u6237\u6001\u4e0b\u7684\u7a0b\u5e8f\u65f6\uff0c\u53d1\u751f\u4e86\u67d0\u4e9b\u4e8b\u5148\u4e0d\u53ef\u77e5\u7684\u5f02\u5e38\uff0c\u8fd9\u65f6\u4f1a\u89e6\u53d1\u7531\u5f53\u524d\u8fd0\u884c\u8fdb\u7a0b\u5207\u6362\u5230\u5904\u7406\u6b64\u5f02\u5e38\u7684\u5185\u6838\u76f8\u5173\u7a0b\u5e8f\u4e2d\uff0c\u4e5f\u5c31\u8f6c\u5230\u4e86\u5185\u6838\u6001\uff0c\u6bd4\u5982\u7f3a\u9875\u5f02\u5e38\u3002</p> </li> <li> <p>\u5916\u8bbe\u4e2d\u65ad\uff1a \u5f53\u5916\u56f4\u8bbe\u5907\u5b8c\u6210\u7528\u6237\u8bf7\u6c42\u7684\u64cd\u4f5c\u540e\uff0c\u4f1a\u5411CPU\u53d1\u51fa\u76f8\u5e94\u7684\u4e2d\u65ad\u4fe1\u53f7\uff0c\u8fd9\u65f6CPU\u4f1a\u6682\u505c\u6267\u884c\u4e0b\u4e00\u6761\u5373\u5c06\u8981\u6267\u884c\u7684\u6307\u4ee4\u8f6c\u800c\u53bb\u6267\u884c\u4e0e\u4e2d\u65ad\u4fe1\u53f7\u5bf9\u5e94\u7684\u5904\u7406\u7a0b\u5e8f\uff0c\u5982\u679c\u5148\u524d\u6267\u884c\u7684\u6307\u4ee4\u662f\u7528\u6237\u6001\u4e0b\u7684\u7a0b\u5e8f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8f6c\u6362\u7684\u8fc7\u7a0b\u81ea\u7136\u4e5f\u5c31\u53d1\u751f\u4e86\u7531\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u3002\u6bd4\u5982\u786c\u76d8\u8bfb\u5199\u64cd\u4f5c\u5b8c\u6210\uff0c\u7cfb\u7edf\u4f1a\u5207\u6362\u5230\u786c\u76d8\u8bfb\u5199\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e2d\u6267\u884c\u540e\u7eed\u64cd\u4f5c\u7b49\u3002</p> </li> </ul> <p>\u8fd93\u79cd\u65b9\u5f0f\u662f\u7cfb\u7edf\u5728\u8fd0\u884c\u65f6\u7531\u7528\u6237\u6001\u8f6c\u5230\u5185\u6838\u6001\u7684\u6700\u4e3b\u8981\u65b9\u5f0f\uff0c\u5176\u4e2d\u7cfb\u7edf\u8c03\u7528\u53ef\u4ee5\u8ba4\u4e3a\u662f\u7528\u6237\u8fdb\u7a0b\u4e3b\u52a8\u53d1\u8d77\u7684\uff0c\u5f02\u5e38\u548c\u5916\u56f4\u8bbe\u5907\u4e2d\u65ad\u5219\u662f\u88ab\u52a8\u7684\u3002</p>"},{"location":"front-end/android/concurrency/basic/#16-vs","title":"1.6 \u540c\u6b65VS\u5f02\u6b65","text":"<p>\u540c\u6b65\u548c\u5f02\u6b65\u901a\u5e38\u7528\u6765\u5f62\u5bb9\u4e00\u6b21\u65b9\u6cd5\u8c03\u7528\u3002\u540c\u6b65\u65b9\u6cd5\u8c03\u7528\u4e00\u5f00\u59cb\uff0c\u8c03\u7528\u8005\u5fc5\u987b\u7b49\u5f85\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\u7ed3\u675f\u540e\uff0c\u8c03\u7528\u8005\u540e\u9762\u7684\u4ee3\u7801\u624d\u80fd\u6267\u884c\u3002\u800c\u5f02\u6b65\u8c03\u7528\uff0c\u6307\u7684\u662f\uff0c\u8c03\u7528\u8005\u4e0d\u7528\u7ba1\u88ab\u8c03\u7528\u65b9\u6cd5\u662f\u5426\u5b8c\u6210\uff0c\u90fd\u4f1a\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801\uff0c\u5f53\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\u5b8c\u6210\u540e\u4f1a\u901a\u77e5\u8c03\u7528\u8005\u3002\u6bd4\u5982\uff0c\u5728\u8d85\u65f6\u8d2d\u7269\uff0c\u5982\u679c\u4e00\u4ef6\u7269\u54c1\u6ca1\u4e86\uff0c\u4f60\u5f97\u7b49\u4ed3\u5e93\u4eba\u5458\u8ddf\u4f60\u8c03\u8d27\uff0c\u76f4\u5230\u4ed3\u5e93\u4eba\u5458\u8ddf\u4f60\u628a\u8d27\u7269\u9001\u8fc7\u6765\uff0c\u4f60\u624d\u80fd\u7ee7\u7eed\u53bb\u6536\u94f6\u53f0\u4ed8\u6b3e\uff0c\u8fd9\u5c31\u7c7b\u4f3c\u540c\u6b65\u8c03\u7528\u3002\u800c\u5f02\u6b65\u8c03\u7528\u4e86\uff0c\u5c31\u50cf\u7f51\u8d2d\uff0c\u4f60\u5728\u7f51\u4e0a\u4ed8\u6b3e\u4e0b\u5355\u540e\uff0c\u4ec0\u4e48\u4e8b\u5c31\u4e0d\u7528\u7ba1\u4e86\uff0c\u8be5\u5e72\u561b\u5c31\u5e72\u561b\u53bb\u4e86\uff0c\u5f53\u8d27\u7269\u5230\u8fbe\u540e\u4f60\u6536\u5230\u901a\u77e5\u53bb\u53d6\u5c31\u597d\u3002</p>"},{"location":"front-end/android/concurrency/basic/#17","title":"1.7 \u5e76\u53d1\u4e0e\u5e76\u884c","text":"<p>\u5e76\u53d1\u548c\u5e76\u884c\u662f\u5341\u5206\u5bb9\u6613\u6df7\u6dc6\u7684\u6982\u5ff5\u3002\u5e76\u53d1\u6307\u7684\u662f\u591a\u4e2a\u4efb\u52a1\u4ea4\u66ff\u8fdb\u884c\uff0c\u800c\u5e76\u884c\u5219\u662f\u6307\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u201c\u540c\u65f6\u8fdb\u884c\u201d\u3002\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u7cfb\u7edf\u5185\u53ea\u6709\u4e00\u4e2aCPU\uff0c\u800c\u4f7f\u7528\u591a\u7ebf\u7a0b\u65f6\uff0c\u90a3\u4e48\u771f\u5b9e\u7cfb\u7edf\u73af\u5883\u4e0b\u4e0d\u80fd\u5e76\u884c\uff0c\u53ea\u80fd\u901a\u8fc7\u5207\u6362\u65f6\u95f4\u7247\u7684\u65b9\u5f0f\u4ea4\u66ff\u8fdb\u884c\uff0c\u800c\u6210\u4e3a\u5e76\u53d1\u6267\u884c\u4efb\u52a1\u3002\u771f\u6b63\u7684\u5e76\u884c\u4e5f\u53ea\u80fd\u51fa\u73b0\u5728\u62e5\u6709\u591a\u4e2aCPU\u7684\u7cfb\u7edf\u4e2d\u3002</p>"},{"location":"front-end/android/concurrency/basic/#18","title":"1.8 \u963b\u585e\u548c\u975e\u963b\u585e","text":"<p>\u963b\u585e\u548c\u975e\u963b\u585e\u901a\u5e38\u7528\u6765\u5f62\u5bb9\u591a\u7ebf\u7a0b\u95f4\u7684\u76f8\u4e92\u5f71\u54cd\uff0c\u6bd4\u5982\u4e00\u4e2a\u7ebf\u7a0b\u5360\u6709\u4e86\u4e34\u754c\u533a\u8d44\u6e90\uff0c\u90a3\u4e48\u5176\u4ed6\u7ebf\u7a0b\u9700\u8981\u8fd9\u4e2a\u8d44\u6e90\u5c31\u5fc5\u987b\u8fdb\u884c\u7b49\u5f85\u8be5\u8d44\u6e90\u7684\u91ca\u653e\uff0c\u4f1a\u5bfc\u81f4\u7b49\u5f85\u7684\u7ebf\u7a0b\u6302\u8d77\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u662f\u963b\u585e\uff0c\u800c\u975e\u963b\u585e\u5c31\u6070\u597d\u76f8\u53cd\uff0c\u5b83\u5f3a\u8c03\u6ca1\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u963b\u585e\u5176\u4ed6\u7ebf\u7a0b\uff0c\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u4f1a\u5c1d\u8bd5\u5730\u5f80\u524d\u8fd0\u884c\u3002</p>"},{"location":"front-end/android/concurrency/basic/#19","title":"1.9 \u4e34\u754c\u533a","text":"<p>\u4e34\u754c\u533a\u7528\u6765\u8868\u793a\u4e00\u79cd\u516c\u5171\u8d44\u6e90\u6216\u8005\u8bf4\u662f\u5171\u4eab\u6570\u636e\uff0c\u53ef\u4ee5\u88ab\u591a\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u3002\u4f46\u662f\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u65f6\uff0c\u4e00\u65e6\u4e34\u754c\u533a\u8d44\u6e90\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u5360\u6709\uff0c\u90a3\u4e48\u5176\u4ed6\u7ebf\u7a0b\u5fc5\u987b\u7b49\u5f85\u3002</p>"},{"location":"front-end/android/concurrency/basic/#2","title":"2. \u7ebf\u7a0b\u57fa\u7840","text":""},{"location":"front-end/android/concurrency/basic/#21","title":"2.1 \u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u548c\u72b6\u6001","text":"<p>Java \u7ebf\u7a0b\u5728\u8fd0\u884c\u7684\u751f\u547d\u5468\u671f\u4e2d\u7684\u6307\u5b9a\u65f6\u523b\u53ea\u53ef\u80fd\u5904\u4e8e\u4e0b\u9762 6 \u79cd\u4e0d\u540c\u72b6\u6001\u7684\u5176\u4e2d\u4e00\u4e2a\u72b6\u6001\u3002</p> <p></p> <p>\u7ebf\u7a0b\u5728\u751f\u547d\u5468\u671f\u4e2d\u5e76\u4e0d\u662f\u56fa\u5b9a\u5904\u4e8e\u67d0\u4e00\u4e2a\u72b6\u6001\u800c\u662f\u968f\u7740\u4ee3\u7801\u7684\u6267\u884c\u5728\u4e0d\u540c\u72b6\u6001\u4e4b\u95f4\u5207\u6362\u3002Java \u7ebf\u7a0b\u72b6\u6001\u53d8\u8fc1\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7531\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff1a\u7ebf\u7a0b\u521b\u5efa\u4e4b\u540e\u5b83\u5c06\u5904\u4e8e NEW\uff08\u65b0\u5efa\uff09 \u72b6\u6001\uff0c\u8c03\u7528 <code>start()</code> \u65b9\u6cd5\u540e\u5f00\u59cb\u8fd0\u884c\uff0c\u7ebf\u7a0b\u8fd9\u65f6\u5019\u5904\u4e8e READY\uff08\u53ef\u8fd0\u884c\uff09 \u72b6\u6001\u3002\u53ef\u8fd0\u884c\u72b6\u6001\u7684\u7ebf\u7a0b\u83b7\u5f97\u4e86 CPU \u65f6\u95f4\u7247\uff08timeslice\uff09\u540e\u5c31\u5904\u4e8e RUNNING\uff08\u8fd0\u884c\uff09 \u72b6\u6001\u3002</p> <p>\u5f53\u7ebf\u7a0b\u6267\u884c <code>wait()</code>\u65b9\u6cd5\u4e4b\u540e\uff0c\u7ebf\u7a0b\u8fdb\u5165 WAITING\uff08\u7b49\u5f85\uff09 \u72b6\u6001\u3002\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u9700\u8981\u4f9d\u9760\u5176\u4ed6\u7ebf\u7a0b\u7684\u901a\u77e5\u624d\u80fd\u591f\u8fd4\u56de\u5230\u8fd0\u884c\u72b6\u6001\uff0c\u800c TIME_WAITING(\u8d85\u65f6\u7b49\u5f85) \u72b6\u6001\u76f8\u5f53\u4e8e\u5728\u7b49\u5f85\u72b6\u6001\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u8d85\u65f6\u9650\u5236\uff0c\u6bd4\u5982\u901a\u8fc7 <code>sleep\uff08long millis\uff09</code>\u65b9\u6cd5\u6216 <code>wait\uff08long millis\uff09</code>\u65b9\u6cd5\u53ef\u4ee5\u5c06 Java \u7ebf\u7a0b\u7f6e\u4e8e TIMED WAITING \u72b6\u6001\u3002\u5f53\u8d85\u65f6\u65f6\u95f4\u5230\u8fbe\u540e Java \u7ebf\u7a0b\u5c06\u4f1a\u8fd4\u56de\u5230 RUNNABLE \u72b6\u6001\u3002\u5f53\u7ebf\u7a0b\u8c03\u7528\u540c\u6b65\u65b9\u6cd5\u65f6\uff0c\u5728\u6ca1\u6709\u83b7\u53d6\u5230\u9501\u7684\u60c5\u51b5\u4e0b\uff0c\u7ebf\u7a0b\u5c06\u4f1a\u8fdb\u5165\u5230 BLOCKED\uff08\u963b\u585e\uff09 \u72b6\u6001\u3002\u7ebf\u7a0b\u5728\u6267\u884c Runnable \u7684<code>run()</code>\u65b9\u6cd5\u4e4b\u540e\u5c06\u4f1a\u8fdb\u5165\u5230 TERMINATED\uff08\u7ec8\u6b62\uff09 \u72b6\u6001\u3002</p>"},{"location":"front-end/android/concurrency/basic/#22","title":"2.2 \u4e0a\u4e0b\u6587\u5207\u6362","text":"<p>\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\u4e00\u822c\u7ebf\u7a0b\u7684\u4e2a\u6570\u90fd\u5927\u4e8e CPU \u6838\u5fc3\u7684\u4e2a\u6570\uff0c\u800c\u4e00\u4e2a CPU \u6838\u5fc3\u5728\u4efb\u610f\u65f6\u523b\u53ea\u80fd\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u4f7f\u7528\uff0c\u4e3a\u4e86\u8ba9\u8fd9\u4e9b\u7ebf\u7a0b\u90fd\u80fd\u5f97\u5230\u6709\u6548\u6267\u884c\uff0cCPU \u91c7\u53d6\u7684\u7b56\u7565\u662f\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d\u65f6\u95f4\u7247\u5e76\u8f6e\u8f6c\u7684\u5f62\u5f0f\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u7684\u65f6\u95f4\u7247\u7528\u5b8c\u7684\u65f6\u5019\u5c31\u4f1a\u91cd\u65b0\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u8ba9\u7ed9\u5176\u4ed6\u7ebf\u7a0b\u4f7f\u7528\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u5c5e\u4e8e\u4e00\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u6982\u62ec\u6765\u8bf4\u5c31\u662f\uff1a\u5f53\u524d\u4efb\u52a1\u5728\u6267\u884c\u5b8c CPU \u65f6\u95f4\u7247\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u4efb\u52a1\u4e4b\u524d\u4f1a\u5148\u4fdd\u5b58\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u4ee5\u4fbf\u4e0b\u6b21\u518d\u5207\u6362\u56de\u8fd9\u4e2a\u4efb\u52a1\u65f6\uff0c\u53ef\u4ee5\u518d\u52a0\u8f7d\u8fd9\u4e2a\u4efb\u52a1\u7684\u72b6\u6001\u3002\u4efb\u52a1\u4ece\u4fdd\u5b58\u5230\u518d\u52a0\u8f7d\u7684\u8fc7\u7a0b\u5c31\u662f\u4e00\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u4e0a\u4e0b\u6587\u5207\u6362\u901a\u5e38\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u9700\u8981\u76f8\u5f53\u53ef\u89c2\u7684\u5904\u7406\u5668\u65f6\u95f4\uff0c\u5728\u6bcf\u79d2\u51e0\u5341\u4e0a\u767e\u6b21\u7684\u5207\u6362\u4e2d\uff0c\u6bcf\u6b21\u5207\u6362\u90fd\u9700\u8981\u7eb3\u79d2\u91cf\u7ea7\u7684\u65f6\u95f4\u3002\u6240\u4ee5\uff0c\u4e0a\u4e0b\u6587\u5207\u6362\u5bf9\u7cfb\u7edf\u6765\u8bf4\u610f\u5473\u7740\u6d88\u8017\u5927\u91cf\u7684 CPU \u65f6\u95f4\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u53ef\u80fd\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u65f6\u95f4\u6d88\u8017\u6700\u5927\u7684\u64cd\u4f5c\u3002</p> <p>Linux \u76f8\u6bd4\u4e0e\u5176\u4ed6\u64cd\u4f5c\u7cfb\u7edf\uff08\u5305\u62ec\u5176\u4ed6\u7c7b Unix \u7cfb\u7edf\uff09\u6709\u5f88\u591a\u7684\u4f18\u70b9\uff0c\u5176\u4e2d\u6709\u4e00\u9879\u5c31\u662f\uff0c\u5176\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u6a21\u5f0f\u5207\u6362\u7684\u65f6\u95f4\u6d88\u8017\u975e\u5e38\u5c11\u3002</p>"},{"location":"front-end/android/concurrency/basic/#23-sleep-vs-wait","title":"2.3 sleep() VS wait()","text":"<ul> <li>sleep()\u65b9\u6cd5\u662fThread\u7684\u9759\u6001\u65b9\u6cd5\uff0c\u800cwait\u662fObject\u5b9e\u4f8b\u65b9\u6cd5</li> <li>wait()\u65b9\u6cd5\u5fc5\u987b\u8981\u5728\u540c\u6b65\u65b9\u6cd5\u6216\u8005\u540c\u6b65\u5757\u4e2d\u8c03\u7528\uff0c\u4e5f\u5c31\u662f\u5fc5\u987b\u5df2\u7ecf\u83b7\u5f97\u5bf9\u8c61\u9501\u3002\u800csleep()\u65b9\u6cd5\u6ca1\u6709\u8fd9\u4e2a\u9650\u5236\u53ef\u4ee5\u5728\u4efb\u4f55\u5730\u65b9\u79cd\u4f7f\u7528\u3002\u53e6\u5916\uff0cwait()\u65b9\u6cd5\u4f1a\u91ca\u653e\u5360\u6709\u7684\u5bf9\u8c61\u9501\uff0c\u4f7f\u5f97\u8be5\u7ebf\u7a0b\u8fdb\u5165\u7b49\u5f85\u6c60\u4e2d\uff0c\u7b49\u5f85\u4e0b\u4e00\u6b21\u83b7\u53d6\u8d44\u6e90\u3002\u800csleep()\u65b9\u6cd5\u53ea\u662f\u4f1a\u8ba9\u51faCPU\u5e76\u4e0d\u4f1a\u91ca\u653e\u6389\u5bf9\u8c61\u9501\uff1b</li> <li>sleep()\u65b9\u6cd5\u5728\u4f11\u7720\u65f6\u95f4\u8fbe\u5230\u540e\u5982\u679c\u518d\u6b21\u83b7\u5f97CPU\u65f6\u95f4\u7247\u5c31\u4f1a\u7ee7\u7eed\u6267\u884c\uff0c\u800cwait()\u65b9\u6cd5\u5fc5\u987b\u7b49\u5f85Object.notift/Object.notifyAll\u901a\u77e5\u540e\uff0c\u624d\u4f1a\u79bb\u5f00\u7b49\u5f85\u6c60\uff0c\u5e76\u4e14\u518d\u6b21\u83b7\u5f97CPU\u65f6\u95f4\u7247\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u3002</li> </ul>"},{"location":"front-end/android/concurrency/basic/#24-start-run-run","title":"2.4 \u4e3a\u4ec0\u4e48\u6211\u4eec\u8c03\u7528 start() \u65b9\u6cd5\u65f6\u4f1a\u6267\u884c run() \u65b9\u6cd5\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528 run() \u65b9\u6cd5\uff1f","text":"<p>new \u4e00\u4e2a Thread\uff0c\u7ebf\u7a0b\u8fdb\u5165\u4e86\u65b0\u5efa\u72b6\u6001\u3002\u8c03\u7528 <code>start()</code>\u65b9\u6cd5\uff0c\u4f1a\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u5e76\u4f7f\u7ebf\u7a0b\u8fdb\u5165\u4e86\u5c31\u7eea\u72b6\u6001\uff0c\u5f53\u5206\u914d\u5230\u65f6\u95f4\u7247\u540e\u5c31\u53ef\u4ee5\u5f00\u59cb\u8fd0\u884c\u4e86\u3002 <code>start()</code> \u4f1a\u6267\u884c\u7ebf\u7a0b\u7684\u76f8\u5e94\u51c6\u5907\u5de5\u4f5c\uff0c\u7136\u540e\u81ea\u52a8\u6267\u884c <code>run()</code> \u65b9\u6cd5\u7684\u5185\u5bb9\uff0c\u8fd9\u662f\u771f\u6b63\u7684\u591a\u7ebf\u7a0b\u5de5\u4f5c\u3002 \u4f46\u662f\uff0c\u76f4\u63a5\u6267\u884c <code>run()</code> \u65b9\u6cd5\uff0c\u4f1a\u628a <code>run()</code> \u65b9\u6cd5\u5f53\u6210\u4e00\u4e2a main \u7ebf\u7a0b\u4e0b\u7684\u666e\u901a\u65b9\u6cd5\u53bb\u6267\u884c\uff0c\u5e76\u4e0d\u4f1a\u5728\u67d0\u4e2a\u7ebf\u7a0b\u4e2d\u6267\u884c\u5b83\uff0c\u6240\u4ee5\u8fd9\u5e76\u4e0d\u662f\u591a\u7ebf\u7a0b\u5de5\u4f5c\u3002</p>"},{"location":"front-end/android/concurrency/basic/#25","title":"2.5 \u7ebf\u7a0b\u6b7b\u9501","text":"<p>\u7ebf\u7a0b\u6b7b\u9501\u63cf\u8ff0\u7684\u662f\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff1a\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u88ab\u963b\u585e\uff0c\u5b83\u4eec\u4e2d\u7684\u4e00\u4e2a\u6216\u8005\u5168\u90e8\u90fd\u5728\u7b49\u5f85\u67d0\u4e2a\u8d44\u6e90\u88ab\u91ca\u653e\u3002\u7531\u4e8e\u7ebf\u7a0b\u88ab\u65e0\u9650\u671f\u5730\u963b\u585e\uff0c\u56e0\u6b64\u7a0b\u5e8f\u4e0d\u53ef\u80fd\u6b63\u5e38\u7ec8\u6b62\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u7ebf\u7a0b A \u6301\u6709\u8d44\u6e90 2\uff0c\u7ebf\u7a0b B \u6301\u6709\u8d44\u6e90 1\uff0c\u4ed6\u4eec\u540c\u65f6\u90fd\u60f3\u7533\u8bf7\u5bf9\u65b9\u7684\u8d44\u6e90\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u5c31\u4f1a\u4e92\u76f8\u7b49\u5f85\u800c\u8fdb\u5165\u6b7b\u9501\u72b6\u6001\u3002</p> <p></p>"},{"location":"front-end/android/concurrency/basic/#251","title":"2.5.1 \u5982\u4f55\u907f\u514d\u7ebf\u7a0b\u6b7b\u9501?","text":"<ol> <li>\u7834\u574f\u4e92\u65a5\u6761\u4ef6 \uff1a\u8fd9\u4e2a\u6761\u4ef6\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u7834\u574f\uff0c\u56e0\u4e3a\u6211\u4eec\u7528\u9501\u672c\u6765\u5c31\u662f\u60f3\u8ba9\u4ed6\u4eec\u4e92\u65a5\u7684\uff08\u4e34\u754c\u8d44\u6e90\u9700\u8981\u4e92\u65a5\u8bbf\u95ee\uff09\u3002</li> <li>\u7834\u574f\u8bf7\u6c42\u4e0e\u4fdd\u6301\u6761\u4ef6 \uff1a\u4e00\u6b21\u6027\u7533\u8bf7\u6240\u6709\u7684\u8d44\u6e90\u3002</li> <li>\u7834\u574f\u4e0d\u5265\u593a\u6761\u4ef6 \uff1a\u5360\u7528\u90e8\u5206\u8d44\u6e90\u7684\u7ebf\u7a0b\u8fdb\u4e00\u6b65\u7533\u8bf7\u5176\u4ed6\u8d44\u6e90\u65f6\uff0c\u5982\u679c\u7533\u8bf7\u4e0d\u5230\uff0c\u53ef\u4ee5\u4e3b\u52a8\u91ca\u653e\u5b83\u5360\u6709\u7684\u8d44\u6e90\u3002</li> <li>\u7834\u574f\u5faa\u73af\u7b49\u5f85\u6761\u4ef6 \uff1a\u9760\u6309\u5e8f\u7533\u8bf7\u8d44\u6e90\u6765\u9884\u9632\u3002\u6309\u67d0\u4e00\u987a\u5e8f\u7533\u8bf7\u8d44\u6e90\uff0c\u91ca\u653e\u8d44\u6e90\u5219\u53cd\u5e8f\u91ca\u653e\u3002\u7834\u574f\u5faa\u73af\u7b49\u5f85\u6761\u4ef6\u3002</li> </ol>"},{"location":"front-end/android/concurrency/basic/#3-java-jmm","title":"3. Java \u5185\u5b58\u6a21\u578b(JMM)","text":""},{"location":"front-end/android/concurrency/basic/#31","title":"3.1 \u5185\u5b58\u6a21\u578b\u62bd\u8c61\u7ed3\u6784","text":"<p>\u5982\u56fe\u4e3aJMM\u62bd\u8c61\u793a\u610f\u56fe\uff0c\u7ebf\u7a0bA\u548c\u7ebf\u7a0bB\u4e4b\u95f4\u8981\u5b8c\u6210\u901a\u4fe1\u7684\u8bdd\uff0c\u8981\u7ecf\u5386\u5982\u4e0b\u4e24\u6b65\uff1a</p> <ol> <li>\u7ebf\u7a0bA\u4ece\u4e3b\u5185\u5b58\u4e2d\u5c06\u5171\u4eab\u53d8\u91cf\u8bfb\u5165\u7ebf\u7a0bA\u7684\u5de5\u4f5c\u5185\u5b58\u540e\u5e76\u8fdb\u884c\u64cd\u4f5c\uff0c\u4e4b\u540e\u5c06\u6570\u636e\u91cd\u65b0\u5199\u56de\u5230\u4e3b\u5185\u5b58\u4e2d\uff1b</li> <li>\u7ebf\u7a0bB\u4ece\u4e3b\u5b58\u4e2d\u8bfb\u53d6\u6700\u65b0\u7684\u5171\u4eab\u53d8\u91cf</li> </ol> <p>\u8fd9\u5c31\u53ef\u80fd\u9020\u6210\u4e00\u4e2a\u7ebf\u7a0b\u5728\u4e3b\u5b58\u4e2d\u4fee\u6539\u4e86\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u800c\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u8fd8\u7ee7\u7eed\u4f7f\u7528\u5b83\u5728\u5bc4\u5b58\u5668\u4e2d\u7684\u53d8\u91cf\u503c\u7684\u62f7\u8d1d\uff0c\u9020\u6210\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u3002\u8fd9\u5c31\u662f \u201c\u810f\u8bfb\u201d \u73b0\u8c61\u3002 \u53ef\u4ee5\u901a\u8fc7\u540c\u6b65\u673a\u5236\uff08\u63a7\u5236\u4e0d\u540c\u7ebf\u7a0b\u95f4\u64cd\u4f5c\u53d1\u751f\u7684\u76f8\u5bf9\u987a\u5e8f\uff09\u6765\u89e3\u51b3\u6216\u8005\u901a\u8fc7volatile\u5173\u952e\u5b57\u4f7f\u5f97\u6bcf\u6b21volatile\u53d8\u91cf\u90fd\u80fd\u591f\u5f3a\u5236\u5237\u65b0\u5230\u4e3b\u5b58\uff0c\u4ece\u800c\u5bf9\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u662f\u53ef\u89c1\u7684\u3002</p>"},{"location":"front-end/android/concurrency/basic/#32-happens-before","title":"3.2 happens-before\u89c4\u5219","text":"<p>\u5982\u679cA happens-before B\uff0c\u90a3\u4e48Java\u5185\u5b58\u6a21\u578b\u5c06\u5411\u7a0b\u5e8f\u5458\u4fdd\u8bc1\u2014\u2014A\u64cd\u4f5c\u7684\u7ed3\u679c\u5c06\u5bf9B\u53ef\u89c1\uff0c\u4e14A\u7684\u6267\u884c\u987a\u5e8f\u6392\u5728B\u4e4b\u524d\u3002</p> <p>\u5177\u4f53\u7684\u4e00\u5171\u6709\u516b\u9879\u89c4\u5219\uff1a</p> <ol> <li>\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219\uff1a\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u6bcf\u4e2a\u64cd\u4f5c\uff0chappens-before\u4e8e\u8be5\u7ebf\u7a0b\u4e2d\u7684\u4efb\u610f\u540e\u7eed\u64cd\u4f5c\u3002</li> <li>\u76d1\u89c6\u5668\u9501\u89c4\u5219\uff1a\u5bf9\u4e00\u4e2a\u9501\u7684\u89e3\u9501\uff0chappens-before\u4e8e\u968f\u540e\u5bf9\u8fd9\u4e2a\u9501\u7684\u52a0\u9501\u3002</li> <li>volatile\u53d8\u91cf\u89c4\u5219\uff1a\u5bf9\u4e00\u4e2avolatile\u57df\u7684\u5199\uff0chappens-before\u4e8e\u4efb\u610f\u540e\u7eed\u5bf9\u8fd9\u4e2avolatile\u57df\u7684\u8bfb\u3002</li> <li>\u4f20\u9012\u6027\uff1a\u5982\u679cA happens-before B\uff0c\u4e14B happens-before C\uff0c\u90a3\u4e48A happens-before C\u3002</li> <li>start()\u89c4\u5219\uff1a\u5982\u679c\u7ebf\u7a0bA\u6267\u884c\u64cd\u4f5cThreadB.start()\uff08\u542f\u52a8\u7ebf\u7a0bB\uff09\uff0c\u90a3\u4e48A\u7ebf\u7a0b\u7684ThreadB.start()\u64cd\u4f5chappens-before\u4e8e\u7ebf\u7a0bB\u4e2d\u7684\u4efb\u610f\u64cd\u4f5c\u3002</li> <li>join()\u89c4\u5219\uff1a\u5982\u679c\u7ebf\u7a0bA\u6267\u884c\u64cd\u4f5cThreadB.join()\u5e76\u6210\u529f\u8fd4\u56de\uff0c\u90a3\u4e48\u7ebf\u7a0bB\u4e2d\u7684\u4efb\u610f\u64cd\u4f5chappens-before\u4e8e\u7ebf\u7a0bA\u4eceThreadB.join()\u64cd\u4f5c\u6210\u529f\u8fd4\u56de\u3002</li> <li>\u7a0b\u5e8f\u4e2d\u65ad\u89c4\u5219\uff1a\u5bf9\u7ebf\u7a0binterrupted()\u65b9\u6cd5\u7684\u8c03\u7528\u5148\u884c\u4e8e\u88ab\u4e2d\u65ad\u7ebf\u7a0b\u7684\u4ee3\u7801\u68c0\u6d4b\u5230\u4e2d\u65ad\u65f6\u95f4\u7684\u53d1\u751f\u3002</li> <li>\u5bf9\u8c61finalize\u89c4\u5219\uff1a\u4e00\u4e2a\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u5b8c\u6210\uff08\u6784\u9020\u51fd\u6570\u6267\u884c\u7ed3\u675f\uff09\u5148\u884c\u4e8e\u53d1\u751f\u5b83\u7684finalize()\u65b9\u6cd5\u7684\u5f00\u59cb\u3002</li> </ol>"},{"location":"front-end/android/concurrency/basic/#33","title":"3.3 \u539f\u5b50\u6027\uff0c\u6709\u5e8f\u6027\u548c\u53ef\u89c1\u6027","text":""},{"location":"front-end/android/concurrency/basic/#331","title":"3.3.1  \u539f\u5b50\u6027","text":"<p>\u539f\u5b50\u6027\u662f\u6307 \u4e00\u4e2a\u64cd\u4f5c\u662f\u4e0d\u53ef\u4e2d\u65ad\u7684\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u6210\u529f\u8981\u4e48\u5168\u90e8\u6267\u884c\u5931\u8d25\uff0c\u6709\u7740\u201c\u540c\u751f\u5171\u6b7b\u201d\u7684\u611f\u89c9\u3002 java\u5185\u5b58\u6a21\u578b\u4e2d\u5b9a\u4e49\u4e868\u4e2d\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u7684\uff0c\u4e0d\u53ef\u518d\u5206\u7684\u3002</p> <ol> <li>lock(\u9501\u5b9a)\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u53d8\u91cf\u6807\u8bc6\u4e3a\u4e00\u4e2a\u7ebf\u7a0b\u72ec\u5360\u7684\u72b6\u6001\uff1b</li> <li>unlock(\u89e3\u9501):\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u5904\u4e8e\u9501\u5b9a\u72b6\u6001\u7684\u53d8\u91cf\u91ca\u653e\u51fa\u6765\uff0c\u91ca\u653e\u540e\u7684\u53d8\u91cf\u624d\u53ef\u4ee5\u88ab\u5176\u4ed6\u7ebf\u7a0b\u9501\u5b9a</li> <li>read\uff08\u8bfb\u53d6\uff09\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4ece\u4e3b\u5185\u5b58\u4f20\u8f93\u5230\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5185\u5b58\u4e2d\uff0c\u4ee5\u4fbf\u540e\u9762\u7684load\u52a8\u4f5c\u4f7f\u7528\uff1b</li> <li>load\uff08\u8f7d\u5165\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628aread\u64cd\u4f5c\u4ece\u4e3b\u5185\u5b58\u4e2d\u5f97\u5230\u7684\u53d8\u91cf\u503c\u653e\u5165\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\u526f\u672c</li> <li>use\uff08\u4f7f\u7528\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u5de5\u4f5c\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9012\u7ed9\u6267\u884c\u5f15\u64ce\uff0c\u6bcf\u5f53\u865a\u62df\u673a\u9047\u5230\u4e00\u4e2a\u9700\u8981\u4f7f\u7528\u5230\u53d8\u91cf\u7684\u503c\u7684\u5b57\u8282\u7801\u6307\u4ee4\u65f6\u5c06\u4f1a\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\uff1b</li> <li>assign\uff08\u8d4b\u503c\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u4ece\u6267\u884c\u5f15\u64ce\u63a5\u6536\u5230\u7684\u503c\u8d4b\u7ed9\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u6bcf\u5f53\u865a\u62df\u673a\u9047\u5230\u4e00\u4e2a\u7ed9\u53d8\u91cf\u8d4b\u503c\u7684\u5b57\u8282\u7801\u6307\u4ee4\u65f6\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\uff1b</li> <li>store\uff08\u5b58\u50a8\uff09\uff1a\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u5de5\u4f5c\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9001\u7ed9\u4e3b\u5185\u5b58\u4e2d\u4ee5\u4fbf\u968f\u540e\u7684write\u64cd\u4f5c\u4f7f\u7528\uff1b</li> <li>write\uff08\u64cd\u4f5c\uff09\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628astore\u64cd\u4f5c\u4ece\u5de5\u4f5c\u5185\u5b58\u4e2d\u5f97\u5230\u7684\u53d8\u91cf\u7684\u503c\u653e\u5165\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\u4e2d\u3002</li> </ol> <pre><code>int a = 10; //1\na++; //2\nint b=a; //3\na = a+1; //4\n</code></pre> <p>\u4e0a\u9762\u8fd9\u56db\u4e2a\u8bed\u53e5\u4e2d\u53ea \u6709\u7b2c1\u4e2a\u8bed\u53e5\u662f\u539f\u5b50\u64cd\u4f5c\uff0c\u5c0610\u8d4b\u503c\u7ed9\u7ebf\u7a0b\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cfa,\u800c\u8bed\u53e52\uff08a++\uff09\uff0c\u5b9e\u9645\u4e0a\u5305\u542b\u4e86\u4e09\u4e2a\u64cd\u4f5c\uff1a1. \u8bfb\u53d6\u53d8\u91cfa\u7684\u503c\uff1b2\uff1a\u5bf9a\u8fdb\u884c\u52a0\u4e00\u7684\u64cd\u4f5c\uff1b3.\u5c06\u8ba1\u7b97\u540e\u7684\u503c\u518d\u8d4b\u503c\u7ed9\u53d8\u91cfa\uff0c\u800c\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u65e0\u6cd5\u6784\u6210\u539f\u5b50\u64cd\u4f5c\u3002\u5bf9\u8bed\u53e53,4\u7684\u5206\u6790\u540c\u7406\u53ef\u5f97\u8fd9\u4e24\u6761\u8bed\u53e5\u4e0d\u5177\u5907\u539f\u5b50\u6027\u3002</p> <ol> <li>\u53ef\u4ee5\u5927\u81f4\u8ba4\u4e3a \u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u8bbf\u95ee\u8bfb\u5199\u5177\u5907\u539f\u5b50\u6027</li> <li>\u5982\u679c\u6211\u4eec\u9700\u8981\u66f4\u5927\u8303\u56f4\u7684\u539f\u5b50\u6027\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4f7f\u7528lock\u548cunlock\u539f\u5b50\u64cd\u4f5c\u3002\u5c3d\u7ba1jvm\u6ca1\u6709\u628alock\u548cunlock\u5f00\u653e\u7ed9\u6211\u4eec\u4f7f\u7528\uff0c\u4f46jvm\u4ee5\u66f4\u9ad8\u5c42\u6b21\u7684\u6307\u4ee4monitorenter\u548cmonitorexit\u6307\u4ee4\u5f00\u653e\u7ed9\u6211\u4eec\u4f7f\u7528\uff0c\u53cd\u5e94\u5230java\u4ee3\u7801\u4e2d\u5c31\u662f---synchronized\u5173\u952e\u5b57\uff0c\u4e5f\u5c31\u662f\u8bf4 synchronized\u6ee1\u8db3\u539f\u5b50\u6027\u3002</li> <li>volatile\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u539f\u5b50\u6027     \u5982\u679c\u8ba9volatile\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5fc5\u987b\u7b26\u5408\u4ee5\u4e0b\u4e24\u6761\u89c4\u5219\uff1a<ol> <li>\u8fd0\u7b97\u7ed3\u679c\u5e76\u4e0d\u4f9d\u8d56\u4e8e\u53d8\u91cf\u7684\u5f53\u524d\u503c\uff0c\u6216\u8005\u80fd\u591f\u786e\u4fdd\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u53d8\u91cf\u7684\u503c\uff1b</li> <li>\u53d8\u91cf\u4e0d\u9700\u8981\u4e0e\u5176\u4ed6\u7684\u72b6\u6001\u53d8\u91cf\u5171\u540c\u53c2\u4e0e\u4e0d\u53d8\u7ea6\u675f</li> </ol> </li> </ol>"},{"location":"front-end/android/concurrency/basic/#332","title":"3.3.2  \u6709\u5e8f\u6027","text":"<p>\u4e3a\u4e86\u6027\u80fd\u4f18\u5316\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4f1a\u8fdb\u884c\u6307\u4ee4\u91cd\u6392\u5e8f\uff1b\u4e5f\u5c31\u662f\u8bf4java\u7a0b\u5e8f\u5929\u7136\u7684\u6709\u5e8f\u6027\u53ef\u4ee5\u603b\u7ed3\u4e3a\uff1a\u5982\u679c\u5728\u672c\u7ebf\u7a0b\u5185\u89c2\u5bdf\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u6709\u5e8f\u7684\uff1b\u5982\u679c\u5728\u4e00\u4e2a\u7ebf\u7a0b\u89c2\u5bdf\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u65e0\u5e8f\u7684\u3002</p> <ul> <li>synchronized\u5177\u6709\u6709\u5e8f\u6027\u3002 synchronized\u8bed\u4e49\u8868\u793a\u9501\u5728\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u7531\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u83b7\u53d6\uff0c\u5f53\u9501\u88ab\u5360\u7528\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ea\u80fd\u7b49\u5f85\u3002\u56e0\u6b64\uff0csynchronized\u8bed\u4e49\u5c31\u8981\u6c42\u7ebf\u7a0b\u5728\u8bbf\u95ee\u8bfb\u5199\u5171\u4eab\u53d8\u91cf\u65f6\u53ea\u80fd\u201c\u4e32\u884c\u201d\u6267\u884c\uff0c\u56e0\u6b64synchronized\u5177\u6709\u6709\u5e8f\u6027\u3002</li> <li>volatile\u5305\u542b\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u7684\u8bed\u4e49\uff0c\u5176\u5177\u6709\u6709\u5e8f\u6027\u3002 (\u53cc\u91cd\u68c0\u9a8c\u9501)</li> </ul>"},{"location":"front-end/android/concurrency/basic/#333","title":"3.3.3 \u53ef\u89c1\u6027","text":"<p>\u53ef\u89c1\u6027\u662f\u6307\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u53d8\u91cf\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u80fd\u591f\u7acb\u5373\u5f97\u77e5\u8fd9\u4e2a\u4fee\u6539\u3002</p> <ul> <li>synchronized\u5177\u6709\u53ef\u89c1\u6027 \u5f53\u7ebf\u7a0b\u83b7\u53d6\u9501\u65f6\u4f1a\u4ece\u4e3b\u5185\u5b58\u4e2d\u83b7\u53d6\u5171\u4eab\u53d8\u91cf\u7684\u6700\u65b0\u503c\uff0c\u91ca\u653e\u9501\u7684\u65f6\u5019\u4f1a\u5c06\u5171\u4eab\u53d8\u91cf\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d</li> <li>volatile\u5177\u6709\u53ef\u89c1\u6027 \u901a\u8fc7\u5728\u6307\u4ee4\u4e2d\u6dfb\u52a0<code>lock</code>\u6307\u4ee4\uff0c\u4ee5\u5b9e\u73b0\u5185\u5b58\u53ef\u89c1\u6027</li> </ul>"},{"location":"front-end/android/concurrency/basic/#4","title":"4. \u5e76\u53d1\u5173\u952e\u5b57","text":""},{"location":"front-end/android/concurrency/basic/#41-synchronized","title":"4.1 synchronized","text":""},{"location":"front-end/android/concurrency/basic/#411","title":"4.1.1 \u5b9a\u4e49","text":"<p><code>synchronized</code> \u5173\u952e\u5b57\u89e3\u51b3\u7684\u662f\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u8bbf\u95ee\u8d44\u6e90\u7684\u540c\u6b65\u6027\uff0c<code>synchronized</code>\u5173\u952e\u5b57\u53ef\u4ee5\u4fdd\u8bc1\u88ab\u5b83\u4fee\u9970\u7684\u65b9\u6cd5\u6216\u8005\u4ee3\u7801\u5757\u5728\u4efb\u610f\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u3002</p> <p>\u53e6\u5916\uff0c\u5728 Java \u65e9\u671f\u7248\u672c\u4e2d\uff0c<code>synchronized</code> \u5c5e\u4e8e \u91cd\u91cf\u7ea7\u9501\uff0c\u6548\u7387\u4f4e\u4e0b\u3002</p> <p>\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u56e0\u4e3a\u76d1\u89c6\u5668\u9501\uff08monitor\uff09\u662f\u4f9d\u8d56\u4e8e\u5e95\u5c42\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684 <code>Mutex Lock</code> \u6765\u5b9e\u73b0\u7684\uff0cJava \u7684\u7ebf\u7a0b\u662f\u6620\u5c04\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u539f\u751f\u7ebf\u7a0b\u4e4b\u4e0a\u7684\u3002\u5982\u679c\u8981\u6302\u8d77\u6216\u8005\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u90fd\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5e2e\u5fd9\u5b8c\u6210\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5207\u6362\u65f6\u9700\u8981\u4ece\u7528\u6237\u6001\u8f6c\u6362\u5230\u5185\u6838\u6001\uff0c\u8fd9\u4e2a\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\u9700\u8981\u76f8\u5bf9\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\uff0c\u65f6\u95f4\u6210\u672c\u76f8\u5bf9\u8f83\u9ad8\u3002</p> <p>\u5e86\u5e78\u7684\u662f\u5728 Java 6 \u4e4b\u540e Java \u5b98\u65b9\u5bf9\u4ece JVM \u5c42\u9762\u5bf9 <code>synchronized</code> \u8f83\u5927\u4f18\u5316\uff0c\u6240\u4ee5\u73b0\u5728\u7684 <code>synchronized</code> \u9501\u6548\u7387\u4e5f\u4f18\u5316\u5f97\u5f88\u4e0d\u9519\u4e86\u3002JDK1.6 \u5bf9\u9501\u7684\u5b9e\u73b0\u5f15\u5165\u4e86\u5927\u91cf\u7684\u4f18\u5316\uff0c\u5982\u81ea\u65cb\u9501\u3001\u9002\u5e94\u6027\u81ea\u65cb\u9501\u3001\u9501\u6d88\u9664\u3001\u9501\u7c97\u5316\u3001\u504f\u5411\u9501\u3001\u8f7b\u91cf\u7ea7\u9501\u7b49\u6280\u672f\u6765\u51cf\u5c11\u9501\u64cd\u4f5c\u7684\u5f00\u9500\u3002</p> <p>\u6240\u4ee5\uff0c\u4f60\u4f1a\u53d1\u73b0\u76ee\u524d\u7684\u8bdd\uff0c\u4e0d\u8bba\u662f\u5404\u79cd\u5f00\u6e90\u6846\u67b6\u8fd8\u662f JDK \u6e90\u7801\u90fd\u5927\u91cf\u4f7f\u7528\u4e86 <code>synchronized</code> \u5173\u952e\u5b57\u3002</p>"},{"location":"front-end/android/concurrency/basic/#412","title":"4.1.2 \u5e95\u5c42\u539f\u7406","text":"<p><code>synchronized</code> \u540c\u6b65\u8bed\u53e5\u5757\u7684\u5b9e\u73b0\u4f7f\u7528\u7684\u662f <code>monitorenter</code> \u548c <code>monitorexit</code> \u6307\u4ee4\uff0c\u5176\u4e2d <code>monitorenter</code> \u6307\u4ee4\u6307\u5411\u540c\u6b65\u4ee3\u7801\u5757\u7684\u5f00\u59cb\u4f4d\u7f6e\uff0c<code>monitorexit</code> \u6307\u4ee4\u5219\u6307\u660e\u540c\u6b65\u4ee3\u7801\u5757\u7684\u7ed3\u675f\u4f4d\u7f6e\u3002</p> <p>\u5f53\u6267\u884c <code>monitorenter</code> \u6307\u4ee4\u65f6\uff0c\u7ebf\u7a0b\u8bd5\u56fe\u83b7\u53d6\u9501\u4e5f\u5c31\u662f\u83b7\u53d6 \u5bf9\u8c61\u76d1\u89c6\u5668 <code>monitor</code> \u7684\u6301\u6709\u6743\u3002</p> <p>\u5728 Java \u865a\u62df\u673a(HotSpot)\u4e2d\uff0cMonitor \u662f\u57fa\u4e8e C++\u5b9e\u73b0\u7684\uff0c\u7531ObjectMonitor\u5b9e\u73b0\u7684\u3002\u6bcf\u4e2a\u5bf9\u8c61\u4e2d\u90fd\u5185\u7f6e\u4e86\u4e00\u4e2a <code>ObjectMonitor</code>\u5bf9\u8c61\u3002</p> <p>\u53e6\u5916\uff0c<code>wait/notify</code>\u7b49\u65b9\u6cd5\u4e5f\u4f9d\u8d56\u4e8e<code>monitor</code>\u5bf9\u8c61\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u53ea\u6709\u5728\u540c\u6b65\u7684\u5757\u6216\u8005\u65b9\u6cd5\u4e2d\u624d\u80fd\u8c03\u7528<code>wait/notify</code>\u7b49\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u629b\u51fa<code>java.lang.IllegalMonitorStateException</code>\u7684\u5f02\u5e38\u7684\u539f\u56e0\u3002</p> <p>\u5728\u6267\u884c<code>monitorenter</code>\u65f6\uff0c\u4f1a\u5c1d\u8bd5\u83b7\u53d6\u5bf9\u8c61\u7684\u9501\uff0c\u5982\u679c\u9501\u7684\u8ba1\u6570\u5668\u4e3a 0 \u5219\u8868\u793a\u9501\u53ef\u4ee5\u88ab\u83b7\u53d6\uff0c\u83b7\u53d6\u540e\u5c06\u9501\u8ba1\u6570\u5668\u8bbe\u4e3a 1 \u4e5f\u5c31\u662f\u52a0 1\u3002</p> <p>\u5728\u6267\u884c <code>monitorexit</code> \u6307\u4ee4\u540e\uff0c\u5c06\u9501\u8ba1\u6570\u5668\u8bbe\u4e3a 0\uff0c\u8868\u660e\u9501\u88ab\u91ca\u653e\u3002\u5982\u679c\u83b7\u53d6\u5bf9\u8c61\u9501\u5931\u8d25\uff0c\u90a3\u5f53\u524d\u7ebf\u7a0b\u5c31\u8981\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230\u9501\u88ab\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u91ca\u653e\u4e3a\u6b62\u3002</p>"},{"location":"front-end/android/concurrency/basic/#413","title":"4.1.3 \u4f7f\u7528\u6ce8\u610f","text":"<ul> <li>\u80fd\u9501\u533a\u5757\uff0c\u5c31\u4e0d\u8981\u9501\u6574\u4e2a\u65b9\u6cd5\u4f53\uff1b</li> <li>\u80fd\u7528\u5bf9\u8c61\u9501\uff0c\u5c31\u4e0d\u8981\u7528\u7c7b\u9501\u3002</li> <li>\u6784\u9020\u65b9\u6cd5\u4e0d\u80fd\u4f7f\u7528 synchronized \u5173\u952e\u5b57\u4fee\u9970\u3002\uff08\u6784\u9020\u65b9\u6cd5\u672c\u8eab\u5c31\u5c5e\u4e8e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4e0d\u5b58\u5728\u540c\u6b65\u7684\u6784\u9020\u65b9\u6cd5\u4e00\u8bf4\u3002\uff09</li> </ul>"},{"location":"front-end/android/concurrency/basic/#42-volatile","title":"4.2 volatile","text":"<p>\u88abvolatile\u4fee\u9970\u7684\u53d8\u91cf\u80fd\u591f\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u80fd\u591f\u83b7\u53d6\u8be5\u53d8\u91cf\u7684\u6700\u65b0\u503c\uff0c\u4ece\u800c\u907f\u514d\u51fa\u73b0\u6570\u636e\u810f\u8bfb\u7684\u73b0\u8c61\u3002</p>"},{"location":"front-end/android/concurrency/basic/#43-synchronized-volatile","title":"4.3 synchronized \u5173\u952e\u5b57\u548c volatile \u5173\u952e\u5b57\u7684\u533a\u522b","text":"<p><code>synchronized</code> \u5173\u952e\u5b57\u548c <code>volatile</code> \u5173\u952e\u5b57\u662f\u4e24\u4e2a\u4e92\u8865\u7684\u5b58\u5728\uff0c\u800c\u4e0d\u662f\u5bf9\u7acb\u7684\u5b58\u5728\uff01</p> <ul> <li><code>volatile</code> \u5173\u952e\u5b57\u662f\u7ebf\u7a0b\u540c\u6b65\u7684 \u8f7b\u91cf\u7ea7\u5b9e\u73b0\uff0c\u6240\u4ee5<code>volatile</code>\u6027\u80fd\u80af\u5b9a\u6bd4<code>synchronized</code>\u5173\u952e\u5b57\u8981\u597d\u3002\u4f46\u662f<code>volatile</code> \u5173\u952e\u5b57\u53ea\u80fd\u7528\u4e8e\u53d8\u91cf\u800c <code>synchronized</code> \u5173\u952e\u5b57\u53ef\u4ee5\u4fee\u9970\u65b9\u6cd5\u4ee5\u53ca\u4ee3\u7801\u5757\u3002</li> <li><code>volatile</code> \u5173\u952e\u5b57\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u89c1\u6027\uff0c\u4f46\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u539f\u5b50\u6027\u3002<code>synchronized</code> \u5173\u952e\u5b57\u4e24\u8005\u90fd\u80fd\u4fdd\u8bc1\u3002</li> <li><code>volatile</code>\u5173\u952e\u5b57\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u53d8\u91cf\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u53ef\u89c1\u6027\uff0c\u800c <code>synchronized</code> \u5173\u952e\u5b57\u89e3\u51b3\u7684\u662f\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u8bbf\u95ee\u8d44\u6e90\u7684\u540c\u6b65\u6027\u3002</li> </ul>"},{"location":"front-end/android/concurrency/basic/#44-cas","title":"4.4 CAS","text":"<p>\u4f7f\u7528\u9501\u65f6\uff0c\u7ebf\u7a0b\u83b7\u53d6\u9501\u662f\u4e00\u79cd\u60b2\u89c2\u9501\u7b56\u7565\uff0c\u5373\u5047\u8bbe\u6bcf\u4e00\u6b21\u6267\u884c\u4e34\u754c\u533a\u4ee3\u7801\u90fd\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u6240\u4ee5\u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u7684\u65f6\u5019\u540c\u65f6\u4e5f\u4f1a\u963b\u585e\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\u8be5\u9501\u3002\u800cCAS\u64cd\u4f5c\uff08\u53c8\u79f0\u4e3a\u65e0\u9501\u64cd\u4f5c\uff09\u662f\u4e00\u79cd\u4e50\u89c2\u9501\u7b56\u7565\uff0c\u5b83\u5047\u8bbe\u6240\u6709\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u65f6\u5019\u4e0d\u4f1a\u51fa\u73b0\u51b2\u7a81\uff0c\u65e2\u7136\u4e0d\u4f1a\u51fa\u73b0\u51b2\u7a81\u81ea\u7136\u800c\u7136\u5c31\u4e0d\u4f1a\u963b\u585e\u5176\u4ed6\u7ebf\u7a0b\u7684\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u7ebf\u7a0b\u5c31\u4e0d\u4f1a\u51fa\u73b0\u963b\u585e\u505c\u987f\u7684\u72b6\u6001\u3002\u90a3\u4e48\uff0c\u5982\u679c\u51fa\u73b0\u51b2\u7a81\u4e86\u600e\u4e48\u529e\uff1f\u65e0\u9501\u64cd\u4f5c\u662f\u4f7f\u7528 CAS(compare and swap) \u53c8\u53eb\u505a\u6bd4\u8f83\u4ea4\u6362\u6765\u9274\u522b\u7ebf\u7a0b\u662f\u5426\u51fa\u73b0\u51b2\u7a81\uff0c\u51fa\u73b0\u51b2\u7a81\u5c31\u91cd\u8bd5\u5f53\u524d\u64cd\u4f5c\u76f4\u5230\u6ca1\u6709\u51b2\u7a81\u4e3a\u6b62\u3002</p>"},{"location":"front-end/android/concurrency/basic/#441-cas","title":"4.4.1  CAS \u64cd\u4f5c\u8fc7\u7a0b","text":"<p>CAS\u6bd4\u8f83\u4ea4\u6362\u7684\u8fc7\u7a0b\u53ef\u4ee5\u901a\u4fd7\u7684\u7406\u89e3\u4e3aCAS(V,O,N)\uff0c\u5305\u542b\u4e09\u4e2a\u503c\u5206\u522b\u4e3a\uff1aV \u5185\u5b58\u5730\u5740\u5b58\u653e\u7684\u5b9e\u9645\u503c\uff1bO \u9884\u671f\u7684\u503c\uff08\u65e7\u503c\uff09\uff1bN \u66f4\u65b0\u7684\u65b0\u503c\u3002\u5f53V\u548cO\u76f8\u540c\u65f6\uff0c\u4e5f\u5c31\u662f\u8bf4\u65e7\u503c\u548c\u5185\u5b58\u4e2d\u5b9e\u9645\u7684\u503c\u76f8\u540c\u8868\u660e\u8be5\u503c\u6ca1\u6709\u88ab\u5176\u4ed6\u7ebf\u7a0b\u66f4\u6539\u8fc7\uff0c\u5373\u8be5\u65e7\u503cO\u5c31\u662f\u76ee\u524d\u6765\u8bf4\u6700\u65b0\u7684\u503c\u4e86\uff0c\u81ea\u7136\u800c\u7136\u53ef\u4ee5\u5c06\u65b0\u503cN\u8d4b\u503c\u7ed9V\u3002\u53cd\u4e4b\uff0cV\u548cO\u4e0d\u76f8\u540c\uff0c\u8868\u660e\u8be5\u503c\u5df2\u7ecf\u88ab\u5176\u4ed6\u7ebf\u7a0b\u6539\u8fc7\u4e86\u5219\u8be5\u65e7\u503cO\u4e0d\u662f\u6700\u65b0\u7248\u672c\u7684\u503c\u4e86\uff0c\u6240\u4ee5\u4e0d\u80fd\u5c06\u65b0\u503cN\u8d4b\u7ed9V\uff0c\u8fd4\u56deV\u5373\u53ef\u3002\u5f53\u591a\u4e2a\u7ebf\u7a0b\u4f7f\u7528CAS\u64cd\u4f5c\u4e00\u4e2a\u53d8\u91cf\u662f\uff0c\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u4f1a\u6210\u529f\uff0c\u5e76\u6210\u529f\u66f4\u65b0\uff0c\u5176\u4f59\u4f1a\u5931\u8d25\u3002\u5931\u8d25\u7684\u7ebf\u7a0b\u4f1a\u91cd\u65b0\u5c1d\u8bd5\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u9009\u62e9\u6302\u8d77\u7ebf\u7a0b</p> <p>CAS\u7684\u5b9e\u73b0\u9700\u8981\u786c\u4ef6\u6307\u4ee4\u96c6\u7684\u652f\u6491\uff0c\u5728JDK1.5\u540e\u865a\u62df\u673a\u624d\u53ef\u4ee5\u4f7f\u7528\u5904\u7406\u5668\u63d0\u4f9b\u7684 CMPXCHG \u6307\u4ee4\u5b9e\u73b0\u3002</p>"},{"location":"front-end/android/concurrency/basic/#442-synchronized-vs-cas","title":"4.4.2 Synchronized VS CAS","text":"<ul> <li>\u5143\u8001\u7ea7\u7684Synchronized(\u672a\u4f18\u5316\u524d)\u6700\u4e3b\u8981\u7684\u95ee\u9898\u662f\uff1a\u5728\u5b58\u5728\u7ebf\u7a0b\u7ade\u4e89\u7684\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0\u7ebf\u7a0b\u963b\u585e\u548c\u5524\u9192\u9501\u5e26\u6765\u7684\u6027\u80fd\u95ee\u9898\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e00\u79cd\u4e92\u65a5\u540c\u6b65\uff08\u963b\u585e\u540c\u6b65\uff09\u3002</li> <li>\u800cCAS\u5e76\u4e0d\u662f\u6b66\u65ad\u7684\u95f4\u7ebf\u7a0b\u6302\u8d77\uff0c\u5f53CAS\u64cd\u4f5c\u5931\u8d25\u540e\u4f1a\u8fdb\u884c\u4e00\u5b9a\u7684\u5c1d\u8bd5\uff0c\u800c\u975e\u8fdb\u884c\u8017\u65f6\u7684\u6302\u8d77\u5524\u9192\u7684\u64cd\u4f5c\uff0c\u56e0\u6b64\u4e5f\u53eb\u505a\u975e\u963b\u585e\u540c\u6b65\u3002\u8fd9\u662f\u4e24\u8005\u4e3b\u8981\u7684\u533a\u522b\u3002</li> </ul>"},{"location":"front-end/android/concurrency/basic/#443-cas","title":"4.4.3 CAS\u7684\u95ee\u9898","text":"<ol> <li> <p>ABA\u95ee\u9898  \u56e0\u4e3aCAS\u4f1a\u68c0\u67e5\u65e7\u503c\u6709\u6ca1\u6709\u53d8\u5316\uff0c\u8fd9\u91cc\u5b58\u5728\u8fd9\u6837\u4e00\u4e2a\u6709\u610f\u601d\u7684\u95ee\u9898\u3002\u6bd4\u5982\u4e00\u4e2a\u65e7\u503cA\u53d8\u4e3a\u4e86\u6210B\uff0c\u7136\u540e\u518d\u53d8\u6210A\uff0c\u521a\u597d\u5728\u505aCAS\u65f6\u68c0\u67e5\u53d1\u73b0\u65e7\u503c\u5e76\u6ca1\u6709\u53d8\u5316\u4f9d\u7136\u4e3aA\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u7684\u786e\u53d1\u751f\u4e86\u53d8\u5316\u3002\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u6cbf\u88ad\u6570\u636e\u5e93\u4e2d\u5e38\u7528\u7684\u4e50\u89c2\u9501\u65b9\u5f0f\uff0c\u6dfb\u52a0\u4e00\u4e2a\u7248\u672c\u53f7\u53ef\u4ee5\u89e3\u51b3\u3002\u539f\u6765\u7684\u53d8\u5316\u8def\u5f84A-&gt;B-&gt;A\u5c31\u53d8\u6210\u4e861A-&gt;2B-&gt;3C\u3002java\u8fd9\u4e48\u4f18\u79c0\u7684\u8bed\u8a00\uff0c\u5f53\u7136\u5728java 1.5\u540e\u7684atomic\u5305\u4e2d\u63d0\u4f9b\u4e86<code>AtomicStampedReference</code>\u6765\u89e3\u51b3ABA\u95ee\u9898\u3002</p> </li> <li> <p>\u81ea\u65cb\u65f6\u95f4\u8fc7\u957f \u4f7f\u7528CAS\u65f6\u975e\u963b\u585e\u540c\u6b65\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u4f1a\u5c06\u7ebf\u7a0b\u6302\u8d77\uff0c\u4f1a\u81ea\u65cb\uff08\u65e0\u975e\u5c31\u662f\u4e00\u4e2a\u6b7b\u5faa\u73af\uff09\u8fdb\u884c\u4e0b\u4e00\u6b21\u5c1d\u8bd5\uff0c\u5982\u679c\u8fd9\u91cc\u81ea\u65cb\u65f6\u95f4\u8fc7\u957f\u5bf9\u6027\u80fd\u662f\u5f88\u5927\u7684\u6d88\u8017\u3002\u5982\u679cJVM\u80fd\u652f\u6301\u5904\u7406\u5668\u63d0\u4f9b\u7684<code>pause</code>\u6307\u4ee4\uff0c\u90a3\u4e48\u5728\u6548\u7387\u4e0a\u4f1a\u6709\u4e00\u5b9a\u7684\u63d0\u5347\u3002</p> </li> <li> <p>\u53ea\u80fd\u4fdd\u8bc1\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\u7684\u539f\u5b50\u64cd\u4f5c \u5f53\u5bf9\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\u6267\u884c\u64cd\u4f5c\u65f6CAS\u80fd\u4fdd\u8bc1\u5176\u539f\u5b50\u6027\uff0c\u5982\u679c\u5bf9\u591a\u4e2a\u5171\u4eab\u53d8\u91cf\u8fdb\u884c\u64cd\u4f5c,CAS\u5c31\u4e0d\u80fd\u4fdd\u8bc1\u5176\u539f\u5b50\u6027\u3002\u6709\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\u5229\u7528\u5bf9\u8c61\u6574\u5408\u591a\u4e2a\u5171\u4eab\u53d8\u91cf\uff0c\u5373\u4e00\u4e2a\u7c7b\u4e2d\u7684\u6210\u5458\u53d8\u91cf\u5c31\u662f\u8fd9\u51e0\u4e2a\u5171\u4eab\u53d8\u91cf\u3002\u7136\u540e\u5c06\u8fd9\u4e2a\u5bf9\u8c61\u505aCAS\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5176\u539f\u5b50\u6027\u3002atomic\u4e2d\u63d0\u4f9b\u4e86<code>AtomicReference</code>\u6765\u4fdd\u8bc1\u5f15\u7528\u5bf9\u8c61\u4e4b\u95f4\u7684\u539f\u5b50\u6027\u3002</p> </li> </ol>"},{"location":"front-end/android/concurrency/basic/#5-aqsabstractqueuedsynchronizer","title":"5. AQS(AbstractQueuedSynchronizer)","text":"<p>AQS \u662f\u4e00\u4e2a\u7528\u6765\u6784\u5efa\u9501\u548c\u540c\u6b65\u5668\u7684\u6846\u67b6\uff0c\u4f7f\u7528 AQS \u80fd\u7b80\u5355\u4e14\u9ad8\u6548\u5730\u6784\u9020\u51fa\u5e94\u7528\u5e7f\u6cdb\u7684\u5927\u91cf\u7684\u540c\u6b65\u5668\uff0c\u6bd4\u5982\u6211\u4eec\u63d0\u5230\u7684 <code>ReentrantLock</code>\uff0c<code>Semaphore</code>\uff0c\u5176\u4ed6\u7684\u8bf8\u5982 <code>ReentrantReadWriteLock</code>\uff0c<code>SynchronousQueue</code>\uff0c<code>FutureTask</code> \u7b49\u7b49\u7686\u662f\u57fa\u4e8e AQS \u7684\u3002\u5f53\u7136\uff0c\u6211\u4eec\u81ea\u5df1\u4e5f\u80fd\u5229\u7528 AQS \u975e\u5e38\u8f7b\u677e\u5bb9\u6613\u5730\u6784\u9020\u51fa\u7b26\u5408\u6211\u4eec\u81ea\u5df1\u9700\u6c42\u7684\u540c\u6b65\u5668\u3002</p>"},{"location":"front-end/android/concurrency/basic/#51-aqs","title":"5.1 AQS \u539f\u7406","text":"<p>AQS \u6838\u5fc3\u601d\u60f3\u662f\uff0c\u5982\u679c\u88ab\u8bf7\u6c42\u7684\u5171\u4eab\u8d44\u6e90\u7a7a\u95f2\uff0c\u5219\u5c06\u5f53\u524d\u8bf7\u6c42\u8d44\u6e90\u7684\u7ebf\u7a0b\u8bbe\u7f6e\u4e3a\u6709\u6548\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u5e76\u4e14\u5c06\u5171\u4eab\u8d44\u6e90\u8bbe\u7f6e\u4e3a\u9501\u5b9a\u72b6\u6001\u3002\u5982\u679c\u88ab\u8bf7\u6c42\u7684\u5171\u4eab\u8d44\u6e90\u88ab\u5360\u7528\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u5957\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85\u4ee5\u53ca\u88ab\u5524\u9192\u65f6\u9501\u5206\u914d\u7684\u673a\u5236\uff0c\u8fd9\u4e2a\u673a\u5236 AQS \u662f\u7528 CLH \u961f\u5217\u9501\u5b9e\u73b0\u7684\uff0c\u5373\u5c06\u6682\u65f6\u83b7\u53d6\u4e0d\u5230\u9501\u7684\u7ebf\u7a0b\u52a0\u5165\u5230\u961f\u5217\u4e2d\u3002</p> <p>CLH(Craig,Landin,and Hagersten)\u961f\u5217\u662f\u4e00\u4e2a\u865a\u62df\u7684\u53cc\u5411\u961f\u5217\uff08\u865a\u62df\u7684\u53cc\u5411\u961f\u5217\u5373\u4e0d\u5b58\u5728\u961f\u5217\u5b9e\u4f8b\uff0c\u4ec5\u5b58\u5728\u7ed3\u70b9\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\uff09\u3002AQS \u662f\u5c06\u6bcf\u6761\u8bf7\u6c42\u5171\u4eab\u8d44\u6e90\u7684\u7ebf\u7a0b\u5c01\u88c5\u6210\u4e00\u4e2a CLH \u9501\u961f\u5217\u7684\u4e00\u4e2a\u7ed3\u70b9\uff08Node\uff09\u6765\u5b9e\u73b0\u9501\u7684\u5206\u914d\u3002 </p> <p>AQS \u4f7f\u7528\u4e00\u4e2a int \u6210\u5458\u53d8\u91cf\u6765\u8868\u793a\u540c\u6b65\u72b6\u6001\uff0c\u901a\u8fc7\u5185\u7f6e\u7684 FIFO \u961f\u5217\u6765\u5b8c\u6210\u83b7\u53d6\u8d44\u6e90\u7ebf\u7a0b\u7684\u6392\u961f\u5de5\u4f5c\u3002AQS \u4f7f\u7528 CAS \u5bf9\u8be5\u540c\u6b65\u72b6\u6001\u8fdb\u884c\u539f\u5b50\u64cd\u4f5c\u5b9e\u73b0\u5bf9\u5176\u503c\u7684\u4fee\u6539\u3002</p> <pre><code>private volatile int state;//\u5171\u4eab\u53d8\u91cf\uff0c\u4f7f\u7528volatile\u4fee\u9970\u4fdd\u8bc1\u7ebf\u7a0b\u53ef\u89c1\u6027\n</code></pre> <p>\u72b6\u6001\u4fe1\u606f\u901a\u8fc7 protected \u7c7b\u578b\u7684 getState\uff0csetState\uff0ccompareAndSetState \u8fdb\u884c\u64cd\u4f5c</p> <pre><code>//\u8fd4\u56de\u540c\u6b65\u72b6\u6001\u7684\u5f53\u524d\u503c\nprotected final int getState() {\nreturn state;\n}\n// \u8bbe\u7f6e\u540c\u6b65\u72b6\u6001\u7684\u503c\nprotected final void setState(int newState) {\nstate = newState;\n}\n//\u539f\u5b50\u5730\uff08CAS\u64cd\u4f5c\uff09\u5c06\u540c\u6b65\u72b6\u6001\u503c\u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u503cupdate\u5982\u679c\u5f53\u524d\u540c\u6b65\u72b6\u6001\u7684\u503c\u7b49\u4e8eexpect\uff08\u671f\u671b\u503c\uff09\nprotected final boolean compareAndSetState(int expect, int update) {\nreturn unsafe.compareAndSwapInt(this, stateOffset, expect, update);\n}\n</code></pre>"},{"location":"front-end/android/concurrency/basic/#52-aqs","title":"5.2 AQS \u5bf9\u8d44\u6e90\u7684\u5171\u4eab\u65b9\u5f0f","text":"<p>AQS \u5b9a\u4e49\u4e24\u79cd\u8d44\u6e90\u5171\u4eab\u65b9\u5f0f</p> <ul> <li>Exclusive\uff08\u72ec\u5360\uff09\uff1a\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u6267\u884c\uff0c\u5982 <code>ReentrantLock</code>\u3002\u53c8\u53ef\u5206\u4e3a\u516c\u5e73\u9501\u548c\u975e\u516c\u5e73\u9501\uff1a</li> <li>\u516c\u5e73\u9501\uff1a\u6309\u7167\u7ebf\u7a0b\u5728\u961f\u5217\u4e2d\u7684\u6392\u961f\u987a\u5e8f\uff0c\u5148\u5230\u8005\u5148\u62ff\u5230\u9501</li> <li>\u975e\u516c\u5e73\u9501\uff1a\u5f53\u7ebf\u7a0b\u8981\u83b7\u53d6\u9501\u65f6\uff0c\u65e0\u89c6\u961f\u5217\u987a\u5e8f\u76f4\u63a5\u53bb\u62a2\u9501\uff0c\u8c01\u62a2\u5230\u5c31\u662f\u8c01\u7684</li> <li>Share\uff08\u5171\u4eab\uff09\uff1a\u591a\u4e2a\u7ebf\u7a0b\u53ef\u540c\u65f6\u6267\u884c\uff0c\u5982<code>CountDownLatch</code>\u3001<code>Semaphore</code>\u3001 <code>CyclicBarrier</code>\u3001<code>ReadWriteLock</code>\u3002</li> </ul> <p>\u4e0d\u540c\u7684\u81ea\u5b9a\u4e49\u540c\u6b65\u5668\u4e89\u7528\u5171\u4eab\u8d44\u6e90\u7684\u65b9\u5f0f\u4e5f\u4e0d\u540c\u3002\u81ea\u5b9a\u4e49\u540c\u6b65\u5668\u5728\u5b9e\u73b0\u65f6\u53ea\u9700\u8981\u5b9e\u73b0\u5171\u4eab\u8d44\u6e90 state \u7684\u83b7\u53d6\u4e0e\u91ca\u653e\u65b9\u5f0f\u5373\u53ef\uff0c\u81f3\u4e8e\u5177\u4f53\u7ebf\u7a0b\u7b49\u5f85\u961f\u5217\u7684\u7ef4\u62a4\uff08\u5982\u83b7\u53d6\u8d44\u6e90\u5931\u8d25\u5165\u961f/\u5524\u9192\u51fa\u961f\u7b49\uff09\uff0cAQS \u5df2\u7ecf\u5728\u9876\u5c42\u5b9e\u73b0\u597d\u4e86\u3002</p>"},{"location":"front-end/android/concurrency/basic/#53-countdownlatch","title":"5.3 CountDownLatch\u7684\u4f7f\u7528","text":"<p><code>CountDownLatch</code> \u7684\u4f5c\u7528\u5c31\u662f \u5141\u8bb8 count \u4e2a\u7ebf\u7a0b\u963b\u585e\u5728\u4e00\u4e2a\u5730\u65b9\uff0c\u76f4\u81f3\u6240\u6709\u7ebf\u7a0b\u7684\u4efb\u52a1\u90fd\u6267\u884c\u5b8c\u6bd5\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u8bfb\u53d6\u5904\u7406 6 \u4e2a\u6587\u4ef6\uff0c\u8fd9 6 \u4e2a\u4efb\u52a1\u90fd\u662f\u6ca1\u6709\u6267\u884c\u987a\u5e8f\u4f9d\u8d56\u7684\u4efb\u52a1\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u65f6\u5019\u5c06\u8fd9\u51e0\u4e2a\u6587\u4ef6\u7684\u5904\u7406\u7684\u7ed3\u679c\u8fdb\u884c\u7edf\u8ba1\u6574\u7406\u3002</p> <p>\u4e3a\u6b64\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u548c count \u4e3a 6 \u7684<code>CountDownLatch</code>\u5bf9\u8c61 \u3002\u4f7f\u7528\u7ebf\u7a0b\u6c60\u5904\u7406\u8bfb\u53d6\u4efb\u52a1\uff0c\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u5b8c\u4e4b\u540e\u5c31\u5c06 count-1\uff0c\u8c03\u7528<code>CountDownLatch</code>\u5bf9\u8c61\u7684 <code>await()</code>\u65b9\u6cd5\uff0c\u76f4\u5230\u6240\u6709\u6587\u4ef6\u8bfb\u53d6\u5b8c\u4e4b\u540e\uff0c\u624d\u4f1a\u63a5\u7740\u6267\u884c\u540e\u9762\u7684\u903b\u8f91\u3002</p> <p>\u4f2a\u4ee3\u7801\u662f\u4e0b\u9762\u8fd9\u6837\u7684\uff1a <pre><code>public class CountDownLatchExample1 {\n// \u5904\u7406\u6587\u4ef6\u7684\u6570\u91cf\nprivate static final int threadCount = 6;\npublic static void main(String[] args) throws InterruptedException {\n// \u521b\u5efa\u4e00\u4e2a\u5177\u6709\u56fa\u5b9a\u7ebf\u7a0b\u6570\u91cf\u7684\u7ebf\u7a0b\u6c60\u5bf9\u8c61\uff08\u63a8\u8350\u4f7f\u7528\u6784\u9020\u65b9\u6cd5\u521b\u5efa\uff09\nExecutorService threadPool = Executors.newFixedThreadPool(10);\nfinal CountDownLatch countDownLatch = new CountDownLatch(threadCount);\nfor (int i = 0; i &lt; threadCount; i++) {\nfinal int threadnum = i;\nthreadPool.execute(() -&gt; {\ntry {\n//\u5904\u7406\u6587\u4ef6\u7684\u4e1a\u52a1\u64cd\u4f5c\n......\n} catch (InterruptedException e) {\ne.printStackTrace();\n} finally {\n//\u8868\u793a\u4e00\u4e2a\u6587\u4ef6\u5df2\u7ecf\u88ab\u5b8c\u6210\ncountDownLatch.countDown();\n}\n});\n}\ncountDownLatch.await();\nthreadPool.shutdown();\nSystem.out.println(\"finish\");\n}\n}\n</code></pre></p> <p>\u6709\u6ca1\u6709\u53ef\u4ee5\u6539\u8fdb\u7684\u5730\u65b9\u5462\uff1f</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>CompletableFuture</code> \u7c7b\u6765\u6539\u8fdb\uff01Java8 \u7684 <code>CompletableFuture</code> \u63d0\u4f9b\u4e86\u5f88\u591a\u5bf9\u591a\u7ebf\u7a0b\u53cb\u597d\u7684\u65b9\u6cd5\uff0c\u4f7f\u7528\u5b83\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u4e3a\u6211\u4eec\u7f16\u5199\u591a\u7ebf\u7a0b\u7a0b\u5e8f\uff0c\u4ec0\u4e48\u5f02\u6b65\u3001\u4e32\u884c\u3001\u5e76\u884c\u6216\u8005\u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u6267\u884c\u5b8c\u4efb\u52a1\u4ec0\u4e48\u7684\u90fd\u975e\u5e38\u65b9\u4fbf\u3002</p>"},{"location":"front-end/android/concurrency/process%20and%20thread/","title":"\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u7684\u4e00\u4e2a\u7b80\u5355\u89e3\u91ca","text":"<p>\u8f6c\u81ea https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html</p> <p>\u8fdb\u7a0b\uff08process\uff09\u548c\u7ebf\u7a0b\uff08thread\uff09\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u4f46\u662f\u5b83\u4eec\u6bd4\u8f83\u62bd\u8c61\uff0c\u4e0d\u5bb9\u6613\u638c\u63e1\u3002</p> <p>\u6700\u8fd1\uff0c\u6211\u8bfb\u5230\u4e00\u7bc7\u6750\u6599\uff0c\u53d1\u73b0\u6709\u4e00\u4e2a\u5f88\u597d\u7684\u7c7b\u6bd4\uff0c\u53ef\u4ee5\u628a\u5b83\u4eec\u89e3\u91ca\u5730\u6e05\u6670\u6613\u61c2\u3002</p> <ol> <li> <p>\u8ba1\u7b97\u673a\u7684\u6838\u5fc3\u662fCPU\uff0c\u5b83\u627f\u62c5\u4e86\u6240\u6709\u7684\u8ba1\u7b97\u4efb\u52a1\u3002\u5b83\u5c31\u50cf\u4e00\u5ea7\u5de5\u5382\uff0c\u65f6\u523b\u5728\u8fd0\u884c\u3002 </p> </li> <li> <p>\u5047\u5b9a\u5de5\u5382\u7684\u7535\u529b\u6709\u9650\uff0c\u4e00\u6b21\u53ea\u80fd\u4f9b\u7ed9\u4e00\u4e2a\u8f66\u95f4\u4f7f\u7528\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u8f66\u95f4\u5f00\u5de5\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u8f66\u95f4\u90fd\u5fc5\u987b\u505c\u5de5\u3002\u80cc\u540e\u7684\u542b\u4e49\u5c31\u662f\uff0c\u5355\u4e2aCPU\u4e00\u6b21\u53ea\u80fd\u8fd0\u884c\u4e00\u4e2a\u4efb\u52a1\u3002 </p> </li> <li> <p>\u8fdb\u7a0b\u5c31\u597d\u6bd4\u5de5\u5382\u7684\u8f66\u95f4\uff0c\u5b83\u4ee3\u8868CPU\u6240\u80fd\u5904\u7406\u7684\u5355\u4e2a\u4efb\u52a1\u3002\u4efb\u4e00\u65f6\u523b\uff0cCPU\u603b\u662f\u8fd0\u884c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5176\u4ed6\u8fdb\u7a0b\u5904\u4e8e\u975e\u8fd0\u884c\u72b6\u6001\u3002 </p> </li> <li> <p>\u4e00\u4e2a\u8f66\u95f4\u91cc\uff0c\u53ef\u4ee5\u6709\u5f88\u591a\u5de5\u4eba\u3002\u4ed6\u4eec\u534f\u540c\u5b8c\u6210\u4e00\u4e2a\u4efb\u52a1\u3002 </p> </li> <li> <p>\u7ebf\u7a0b\u5c31\u597d\u6bd4\u8f66\u95f4\u91cc\u7684\u5de5\u4eba\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5305\u62ec\u591a\u4e2a\u7ebf\u7a0b\u3002              </p> </li> <li> <p>\u8f66\u95f4\u7684\u7a7a\u95f4\u662f\u5de5\u4eba\u4eec\u5171\u4eab\u7684\uff0c\u6bd4\u5982\u8bb8\u591a\u623f\u95f4\u662f\u6bcf\u4e2a\u5de5\u4eba\u90fd\u53ef\u4ee5\u8fdb\u51fa\u7684\u3002\u8fd9\u8c61\u5f81\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u662f\u5171\u4eab\u7684\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u5171\u4eab\u5185\u5b58\u3002 </p> </li> <li> <p>\u53ef\u662f\uff0c\u6bcf\u95f4\u623f\u95f4\u7684\u5927\u5c0f\u4e0d\u540c\uff0c\u6709\u4e9b\u623f\u95f4\u6700\u591a\u53ea\u80fd\u5bb9\u7eb3\u4e00\u4e2a\u4eba\uff0c\u6bd4\u5982\u5395\u6240\u3002\u91cc\u9762\u6709\u4eba\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u4eba\u5c31\u4e0d\u80fd\u8fdb\u53bb\u4e86\u3002\u8fd9\u4ee3\u8868\u4e00\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u67d0\u4e9b\u5171\u4eab\u5185\u5b58\u65f6\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5fc5\u987b\u7b49\u5b83\u7ed3\u675f\uff0c\u624d\u80fd\u4f7f\u7528\u8fd9\u4e00\u5757\u5185\u5b58\u3002        </p> </li> <li> <p>\u4e00\u4e2a\u9632\u6b62\u4ed6\u4eba\u8fdb\u5165\u7684\u7b80\u5355\u65b9\u6cd5\uff0c\u5c31\u662f\u95e8\u53e3\u52a0\u4e00\u628a\u9501\u3002\u5148\u5230\u7684\u4eba\u9501\u4e0a\u95e8\uff0c\u540e\u5230\u7684\u4eba\u770b\u5230\u4e0a\u9501\uff0c\u5c31\u5728\u95e8\u53e3\u6392\u961f\uff0c\u7b49\u9501\u6253\u5f00\u518d\u8fdb\u53bb\u3002\u8fd9\u5c31\u53eb\"\u4e92\u65a5\u9501\"\uff08Mutual exclusion\uff0c\u7f29\u5199 Mutex\uff09\uff0c\u9632\u6b62\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u5199\u67d0\u4e00\u5757\u5185\u5b58\u533a\u57df\u3002 </p> </li> <li> <p>\u8fd8\u6709\u4e9b\u623f\u95f4\uff0c\u53ef\u4ee5\u540c\u65f6\u5bb9\u7eb3n\u4e2a\u4eba\uff0c\u6bd4\u5982\u53a8\u623f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4eba\u6570\u5927\u4e8en\uff0c\u591a\u51fa\u6765\u7684\u4eba\u53ea\u80fd\u5728\u5916\u9762\u7b49\u7740\u3002\u8fd9\u597d\u6bd4\u67d0\u4e9b\u5185\u5b58\u533a\u57df\uff0c\u53ea\u80fd\u4f9b\u7ed9\u56fa\u5b9a\u6570\u76ee\u7684\u7ebf\u7a0b\u4f7f\u7528\u3002 </p> </li> <li> <p>\u8fd9\u65f6\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u5c31\u662f\u5728\u95e8\u53e3\u6302n\u628a\u94a5\u5319\u3002\u8fdb\u53bb\u7684\u4eba\u5c31\u53d6\u4e00\u628a\u94a5\u5319\uff0c\u51fa\u6765\u65f6\u518d\u628a\u94a5\u5319\u6302\u56de\u539f\u5904\u3002\u540e\u5230\u7684\u4eba\u53d1\u73b0\u94a5\u5319\u67b6\u7a7a\u4e86\uff0c\u5c31\u77e5\u9053\u5fc5\u987b\u5728\u95e8\u53e3\u6392\u961f\u7b49\u7740\u4e86\u3002\u8fd9\u79cd\u505a\u6cd5\u53eb\u505a\"\u4fe1\u53f7\u91cf\"\uff08Semaphore\uff09\uff0c\u7528\u6765\u4fdd\u8bc1\u591a\u4e2a\u7ebf\u7a0b\u4e0d\u4f1a\u4e92\u76f8\u51b2\u7a81\u3002\u4e0d\u96be\u770b\u51fa\uff0cmutex\u662fsemaphore\u7684\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff08n=1\u65f6\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b8c\u5168\u53ef\u4ee5\u7528\u540e\u8005\u66ff\u4ee3\u524d\u8005\u3002\u4f46\u662f\uff0c\u56e0\u4e3amutex\u8f83\u4e3a\u7b80\u5355\uff0c\u4e14\u6548\u7387\u9ad8\uff0c\u6240\u4ee5\u5728\u5fc5\u987b\u4fdd\u8bc1\u8d44\u6e90\u72ec\u5360\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd8\u662f\u91c7\u7528\u8fd9\u79cd\u8bbe\u8ba1\u3002 </p> </li> <li> <p>\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u8ba1\uff0c\u56e0\u6b64\u53ef\u4ee5\u5f52\u7ed3\u4e3a\u4e09\u70b9\uff1a</p> </li> </ol> <p>\uff081\uff09\u4ee5\u591a\u8fdb\u7a0b\u5f62\u5f0f\uff0c\u5141\u8bb8\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u8fd0\u884c\uff1b</p> <p>\uff082\uff09\u4ee5\u591a\u7ebf\u7a0b\u5f62\u5f0f\uff0c\u5141\u8bb8\u5355\u4e2a\u4efb\u52a1\u5206\u6210\u4e0d\u540c\u7684\u90e8\u5206\u8fd0\u884c\uff1b</p> <p>\uff083\uff09\u63d0\u4f9b\u534f\u8c03\u673a\u5236\uff0c\u4e00\u65b9\u9762\u9632\u6b62\u8fdb\u7a0b\u4e4b\u95f4\u548c\u7ebf\u7a0b\u4e4b\u95f4\u4ea7\u751f\u51b2\u7a81\uff0c\u53e6\u4e00\u65b9\u9762\u5141\u8bb8\u8fdb\u7a0b\u4e4b\u95f4\u548c\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u8d44\u6e90\u3002</p> <p></p>"},{"location":"front-end/android/concurrency/thread-lifecycle/","title":"\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\uff0c\u771f\u7684\u6ca1\u90a3\u4e48\u7b80\u5355","text":"<p>\u4eca\u5929\uff0c\u6211\u4eec\u5c31\u7ed3\u5408 \u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u548c\u7f16\u7a0b\u8bed\u8a00\u7ebf\u7a0b \u518d\u6b21\u6df1\u5165\u63a2\u8ba8\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u95ee\u9898\uff0c\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u5176\u5b9e\u6ca1\u6709\u6211\u4eec\u60f3\u8c61\u7684\u90a3\u4e48\u7b80\u5355\uff01\uff01</p> <p>\u7406\u89e3\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u672c\u8d28\u4e0a\u7406\u89e3\u4e86 \u751f\u547d\u5468\u671f\u4e2d\u5404\u4e2a\u8282\u70b9\u7684\u72b6\u6001\u8f6c\u6362\u673a\u5236 \u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5206\u522b\u5c31 \u901a\u7528\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u548cJava\u8bed\u8a00\u7684\u7ebf\u7a0b\u751f\u547d\u5468\u671f \u5206\u522b\u8fdb\u884c\u8be6\u7ec6\u8bf4\u660e\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#_2","title":"\u901a\u7528\u7684\u7ebf\u7a0b\u751f\u547d\u5468\u671f","text":"<p>\u901a\u7528\u7684\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u603b\u4f53\u4e0a\u53ef\u4ee5\u5206\u4e3a\u4e94\u4e2a\u72b6\u6001\uff1a\u521d\u59cb\u72b6\u6001\u3001\u53ef\u8fd0\u884c\u72b6\u6001\u3001\u8fd0\u884c\u72b6\u6001\u3001\u4f11\u7720\u72b6\u6001\u548c\u7ec8\u6b62\u72b6\u6001\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u4f7f\u7528\u4e0b\u56fe\u6765\u8868\u793a\u8fd9\u4e94\u79cd\u72b6\u6001\u3002</p> <p></p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#_3","title":"\u521d\u59cb\u72b6\u6001","text":"<p>\u7ebf\u7a0b\u5df2\u7ecf\u88ab\u521b\u5efa\uff0c\u4f46\u662f\u4e0d\u5141\u8bb8\u5206\u914dCPU\u6267\u884c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a\u8fd9\u4e2a\u72b6\u6001\u5c5e\u4e8e\u7f16\u7a0b\u8bed\u8a00\u7279\u6709\uff0c\u8fd9\u91cc\u6307\u7684\u7ebf\u7a0b\u5df2\u7ecf\u88ab\u521b\u5efa\uff0c\u4ec5\u4ec5\u6307\u5728\u7f16\u7a0b\u8bed\u8a00\u4e2d\u88ab\u521b\u5efa\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u5e76\u6ca1\u6709\u521b\u5efa\u771f\u6b63\u7684\u7ebf\u7a0b\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#_4","title":"\u53ef\u8fd0\u884c\u72b6\u6001","text":"<p>\u7ebf\u7a0b\u53ef\u4ee5\u5206\u914dCPU\u6267\u884c\u3002\u6b64\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u7ebf\u7a0b\u88ab\u6210\u529f\u521b\u5efa\uff0c\u53ef\u4ee5\u5206\u914dCPU\u6267\u884c\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#_5","title":"\u8fd0\u884c\u72b6\u6001","text":"<p>\u5f53\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b58\u5728\u7a7a\u95f2\u7684CPU\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c06\u8fd9\u4e2a\u7a7a\u95f2\u7684CPU\u5206\u914d\u7ed9\u4e00\u4e2a\u5904\u4e8e\u53ef\u8fd0\u884c\u72b6\u6001\u7684\u7ebf\u7a0b\uff0c\u88ab\u5206\u914d\u5230CPU\u7684\u7ebf\u7a0b\u7684\u72b6\u6001\u5c31\u8f6c\u6362\u6210\u4e86\u8fd0\u884c\u72b6\u6001</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#_6","title":"\u4f11\u7720\u72b6\u6001","text":"<p>\u8fd0\u884c\u72b6\u6001\u7684\u7ebf\u7a0b\u8c03\u7528\u4e00\u4e2a\u963b\u585e\u7684API\uff08\u4f8b\u5982\uff0c\u4ee5\u963b\u585e\u7684\u65b9\u5f0f\u8bfb\u6587\u4ef6\uff09\u6216\u8005\u7b49\u5f85\u67d0\u4e2a\u4e8b\u4ef6\uff08\u4f8b\u5982\uff0c\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u53d8\u91cf\u7b49\uff09\uff0c\u7ebf\u7a0b\u7684\u72b6\u6001\u5c31\u4f1a\u8f6c\u6362\u5230\u4f11\u7720\u72b6\u6001\u3002 \u6b64\u65f6\u7ebf\u7a0b\u4f1a\u91ca\u653eCPU\u8d44\u6e90\uff0c\u4f11\u7720\u72b6\u6001\u7684\u7ebf\u7a0b\u6ca1\u6709\u673a\u4f1a\u83b7\u5f97CPU\u7684\u4f7f\u7528\u6743\u3002 \u4e00\u65e6\u7b49\u5f85\u7684\u6761\u4ef6\u51fa\u73b0\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u4ece\u4f11\u7720\u72b6\u6001\u8f6c\u6362\u5230\u53ef\u8fd0\u884c\u72b6\u6001\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#_7","title":"\u7ec8\u6b62\u72b6\u6001","text":"<p>\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u6216\u8005\u51fa\u73b0\u5f02\u5e38\u5c31\u4f1a\u8fdb\u5165\u7ec8\u6b62\u72b6\u6001\uff0c\u7ec8\u6b62\u72b6\u6001\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u5207\u6362\u5230\u5176\u4ed6\u4efb\u4f55\u72b6\u6001\uff0c\u8fd9\u4e5f\u610f\u5473\u7740 \u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u7ed3\u675f\u4e86\u3002</p> <p>\u4ee5\u4e0a\u5c31\u662f\u901a\u7528\u7684\u7ebf\u7a0b\u751f\u547d\u5468\u671f\uff0c\u4e0b\u9762\uff0c\u6211\u4eec\u518d\u770b\u5bf9\u6bd4\u770b\u4e0bJava\u8bed\u8a00\u4e2d\u7684\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#java","title":"Java\u4e2d\u7684\u7ebf\u7a0b\u751f\u547d\u5468\u671f","text":"<p>Java\u4e2d\u7684\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u603b\u5171\u53ef\u4ee5\u5206\u4e3a\u516d\u79cd\u72b6\u6001\uff1a\u521d\u59cb\u5316\u72b6\u6001\uff08NEW\uff09\u3001\u53ef\u8fd0\u884c/\u8fd0\u884c\u72b6\u6001\uff08RUNNABLE\uff09\u3001\u963b\u585e\u72b6\u6001\uff08BLOCKED\uff09\u3001\u65e0\u65f6\u9650\u7b49\u5f85\u72b6\u6001\uff08WAITING\uff09\u3001\u6709\u65f6\u9650\u7b49\u5f85\u72b6\u6001\uff08TIMED_WAITING\uff09\u3001\u7ec8\u6b62\u72b6\u6001\uff08TERMINATED\uff09\u3002</p> <p>\u9700\u8981\u5927\u5bb6\u91cd\u70b9\u7406\u89e3\u7684\u662f\uff1a\u867d\u7136Java\u8bed\u8a00\u4e2d\u7ebf\u7a0b\u7684\u72b6\u6001\u6bd4\u8f83\u591a\uff0c\u4f46\u662f\uff0c\u5176\u5b9e\u5728\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\uff0cJava\u7ebf\u7a0b\u4e2d\u7684\u963b\u585e\u72b6\u6001\uff08BLOCKED\uff09\u3001\u65e0\u65f6\u9650\u7b49\u5f85\u72b6\u6001\uff08WAITING\uff09\u3001\u6709\u65f6\u9650\u7b49\u5f85\u72b6\u6001\uff08TIMED_WAITING\uff09\u90fd\u662f\u4e00\u79cd\u72b6\u6001\uff0c\u5373\u901a\u7528\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u4e2d\u7684\u4f11\u7720\u72b6\u6001\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u8981Java\u4e2d\u7684\u7ebf\u7a0b\u5904\u4e8e\u8fd9\u4e09\u79cd\u72b6\u6001\u65f6\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u5c31\u6ca1\u6709CPU\u7684\u4f7f\u7528\u6743\u3002</p> <p>\u7406\u89e3\u4e86\u8fd9\u4e9b\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u56fe\u6765\u7b80\u5355\u7684\u8868\u793aJava\u4e2d\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u3002</p> <p></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\u963b\u585e\u72b6\u6001\uff08BLOCKED\uff09\u3001\u65e0\u65f6\u9650\u7b49\u5f85\u72b6\u6001\uff08WAITING\uff09\u3001\u6709\u65f6\u9650\u7b49\u5f85\u72b6\u6001\uff08TIMED_WAITING\uff09\uff0c\u5b83\u4eec\u662f\u5bfc\u81f4\u7ebf\u7a0b\u4f11\u7720\u7684\u4e09\u79cd\u539f\u56e0\uff01</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u770b\u770bJava\u7ebf\u7a0b\u4e2d\u7684\u72b6\u6001\u662f\u5982\u4f55\u8f6c\u5316\u7684\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#runnableblocked","title":"RUNNABLE\u4e0eBLOCKED\u7684\u72b6\u6001\u8f6c\u6362/","text":"<p>\u53ea\u6709\u4e00\u79cd\u573a\u666f\u4f1a\u89e6\u53d1\u8fd9\u79cd\u8f6c\u6362\uff0c\u5c31\u662f\u7ebf\u7a0b\u7b49\u5f85synchronized\u9690\u5f0f\u9501\u3002synchronized\u4fee\u9970\u7684\u65b9\u6cd5\u3001\u4ee3\u7801\u5757\u540c\u4e00\u65f6\u523b\u53ea\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\uff0c\u5176\u4ed6\u7684\u7ebf\u7a0b\u5219\u9700\u8981\u7b49\u5f85\u3002\u6b64\u65f6\uff0c\u7b49\u5f85\u7684\u7ebf\u7a0b\u5c31\u4f1a\u4eceRUNNABLE\u72b6\u6001\u8f6c\u6362\u5230BLOCKED\u72b6\u6001\u3002\u5f53\u7b49\u5f85\u7684\u7ebf\u7a0b\u83b7\u5f97synchronized\u9690\u5f0f\u9501\u65f6\uff0c\u5c31\u53c8\u4f1a\u4eceBLOCKED\u72b6\u6001\u8f6c\u6362\u5230RUNNABLE\u72b6\u6001\u3002</p> <p>\u8fd9\u91cc\uff0c\u9700\u8981\u5927\u5bb6\u6ce8\u610f\uff1a\u7ebf\u7a0b\u8c03\u7528\u963b\u585eAPI\u65f6\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\uff0c\u7ebf\u7a0b\u4f1a\u8f6c\u6362\u5230\u4f11\u7720\u72b6\u6001\u3002\u4f46\u662f\u5728JVM\u4e2d\uff0cJava\u7ebf\u7a0b\u7684\u72b6\u6001\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cJava\u7ebf\u7a0b\u7684\u72b6\u6001\u4ecd\u7136\u662fRUNNABLE\u72b6\u6001\u3002JVM\u5e76\u4e0d\u5173\u5fc3\u64cd\u4f5c\u7cfb\u7edf\u8c03\u5ea6\u76f8\u5173\u7684\u72b6\u6001\uff0c\u5728JVM\u89d2\u5ea6\u6765\u770b\uff0c\u7b49\u5f85CPU\u4f7f\u7528\u6743\uff08\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u7ebf\u7a0b\u5904\u4e8e\u53ef\u6267\u884c\u72b6\u6001\uff09\u548c\u7b49\u5f85IO\u64cd\u4f5c\uff08\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u7ebf\u7a0b\u5904\u4e8e\u4f11\u7720\u72b6\u6001\uff09\u6ca1\u6709\u533a\u522b\uff0c\u90fd\u662f\u5728\u7b49\u5f85\u67d0\u4e2a\u8d44\u6e90\uff0c\u6240\u4ee5\uff0c\u5c06\u5176\u90fd\u5f52\u5165\u4e86RUNNABLE\u72b6\u6001\u3002</p> <p>\u6211\u4eec\u5e73\u65f6\u6240\u8bf4\u7684Java\u5728\u8c03\u7528\u963b\u585eAPI\u65f6\uff0c\u7ebf\u7a0b\u4f1a\u963b\u585e\uff0c\u6307\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u7684\u72b6\u6001\uff0c\u5e76\u4e0d\u662fJava\u7ebf\u7a0b\u7684\u72b6\u6001\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#runnablewaiting","title":"RUNNABLE\u4e0eWAITING\u72b6\u6001\u8f6c\u6362","text":"<p>\u7ebf\u7a0b\u4eceRUNNABLE\u72b6\u6001\u8f6c\u6362\u6210WAITING\u72b6\u6001\u603b\u4f53\u4e0a\u6709\u4e09\u79cd\u573a\u666f\u3002</p> <p>\u573a\u666f\u4e00</p> <p>\u83b7\u5f97synchronized\u9690\u5f0f\u9501\u7684\u7ebf\u7a0b\uff0c\u8c03\u7528\u65e0\u53c2\u7684Object.wait()\u65b9\u6cd5\u3002\u6b64\u65f6\u7684\u7ebf\u7a0b\u4f1a\u4eceRUNNABLE\u72b6\u6001\u8f6c\u6362\u6210WAITING\u72b6\u6001\u3002</p> <p>\u573a\u666f\u4e8c</p> <p>\u8c03\u7528\u65e0\u53c2\u6570\u7684Thread.join()\u65b9\u6cd5\u3002\u5176\u4e2djoin()\u65b9\u6cd5\u662f\u4e00\u79cd\u7ebf\u7a0b\u7684\u540c\u6b65\u65b9\u6cd5\u3002\u4f8b\u5982\uff0c\u5728threadA\u7ebf\u7a0b\u4e2d\u8c03\u7528threadB\u7ebf\u7a0b\u7684join()\u65b9\u6cd5\uff0c\u5219threadA\u7ebf\u7a0b\u4f1a\u7b49\u5f85threadB\u7ebf\u7a0b\u6267\u884c\u5b8c\u3002\u800cthreadA\u7ebf\u7a0b\u5728\u7b49\u5f85threadB\u7ebf\u7a0b\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5176\u72b6\u6001\u4f1a\u4eceRUNNABLE\u8f6c\u6362\u5230WAITING\u3002\u5f53threadB\u6267\u884c\u5b8c\u6bd5\uff0cthreadA\u7ebf\u7a0b\u7684\u72b6\u6001\u5219\u4f1a\u4eceWAITING\u72b6\u6001\u8f6c\u6362\u6210RUNNABLE\u72b6\u6001\u3002</p> <p>\u573a\u666f\u4e09</p> <p>\u8c03\u7528LockSupport.park()\u65b9\u6cd5\uff0c\u5f53\u524d\u7ebf\u7a0b\u4f1a\u963b\u585e\uff0c\u7ebf\u7a0b\u7684\u72b6\u6001\u4f1a\u4eceRUNNABLE\u8f6c\u6362\u6210WAITING\u3002\u8c03\u7528LockSupport.unpark(Thread thread)\u53ef\u5524\u9192\u76ee\u6807\u7ebf\u7a0b\uff0c\u76ee\u6807\u7ebf\u7a0b\u7684\u72b6\u6001\u53c8\u4f1a\u4eceWAITING\u72b6\u6001\u8f6c\u6362\u5230RUNNABLE\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#runnabletimed_waiting","title":"RUNNABLE\u4e0eTIMED_WAITING\u72b6\u6001\u8f6c\u6362","text":"<p>\u603b\u4f53\u4e0a\u53ef\u4ee5\u5206\u4e3a\u4e94\u79cd\u573a\u666f\u3002</p> <p>\u573a\u666f\u4e00</p> <p>\u8c03\u7528\u5e26\u8d85\u65f6\u53c2\u6570\u7684Thread.sleep(long millis)\u65b9\u6cd5\uff1b</p> <p>\u573a\u666f\u4e8c</p> <p>\u83b7\u5f97synchronized\u9690\u5f0f\u9501\u7684\u7ebf\u7a0b\uff0c\u8c03\u7528\u5e26\u8d85\u65f6\u53c2\u6570\u7684Object.wait(long timeout)\u53c2\u6570\uff1b</p> <p>\u573a\u666f\u4e09</p> <p>\u8c03\u7528\u5e26\u8d85\u65f6\u53c2\u6570\u7684Thread.join(long millis)\u65b9\u6cd5\uff1b</p> <p>\u573a\u666f\u56db</p> <p>\u8c03\u7528\u5e26\u8d85\u65f6\u53c2\u6570\u7684LockSupport.parkNanos(Object blocker, long deadline)\u65b9\u6cd5\uff1b</p> <p>\u573a\u666f\u4e94</p> <p>\u8c03\u7528\u5e26\u8d85\u65f6\u53c2\u6570\u7684LockSuppor.parkUntil(long deadline)\u65b9\u6cd5\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#newrunnable","title":"\u4eceNEW\u5230RUNNABLE\u72b6\u6001","text":"<p>Java\u521a\u521b\u5efa\u51fa\u6765\u7684Thread\u5bf9\u8c61\u5c31\u662fNEW\u72b6\u6001\uff0c\u521b\u5efaThread\u5bf9\u8c61\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u6cd5\uff0c\u4e00\u79cd\u662f\u7ee7\u627fThread\u5bf9\u8c61\uff0c\u91cd\u5199run()\u65b9\u6cd5\uff1b\u53e6\u4e00\u79cd\u662f\u5b9e\u73b0Runnable\u63a5\u53e3\uff0c\u91cd\u5199run()\u65b9\u6cd5\u3002</p> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u8bf4\u7684\u662f\u521b\u5efaThread\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u7ebf\u7a0b\u7684\u65b9\u6cd5\uff0c\u521b\u5efa\u7ebf\u7a0b\u7684\u65b9\u6cd5\u5305\u542b\u521b\u5efaThread\u5bf9\u8c61\u7684\u65b9\u6cd5\u3002</p> <p>\u7ee7\u627fThread\u5bf9\u8c61</p> <pre><code>public class ChildThread extends Thread{\n@Override\npublic void run(){\n//\u7ebf\u7a0b\u4e2d\u9700\u8981\u6267\u884c\u7684\u903b\u8f91\n}\n}\n//\u521b\u5efa\u7ebf\u7a0b\u5bf9\u8c61\nChildThread childThread = new ChildThread();\u590d\u5236\n</code></pre> <p>\u5b9e\u73b0Runnable\u63a5\u53e3</p> <pre><code>public class ChildRunnable implements Runnable{\n@Override\npublic void run(){\n//\u7ebf\u7a0b\u4e2d\u9700\u8981\u6267\u884c\u7684\u903b\u8f91\n}\n}\n//\u521b\u5efa\u7ebf\u7a0b\u5bf9\u8c61\nThread childThread = new Thread(new ChildRunnable());\u590d\u5236\n</code></pre> <p>\u5904\u4e8eNEW\u72b6\u6001\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u5ea6\uff0c\u56e0\u6b64\u4e5f\u5c31\u4e0d\u4f1a\u6267\u884c\u3002Java\u4e2d\u7684\u7ebf\u7a0b\u8981\u6267\u884c\uff0c\u5c31\u9700\u8981\u8f6c\u6362\u5230RUNNABLE\u72b6\u6001\u3002\u4eceNEW\u72b6\u6001\u8f6c\u6362\u5230RUNNABLE\u72b6\u6001\uff0c\u53ea\u9700\u8981\u8c03\u7528\u7ebf\u7a0b\u5bf9\u8c61\u7684start()\u65b9\u6cd5\u5373\u53ef\u3002</p> <pre><code>//\u521b\u5efa\u7ebf\u7a0b\u5bf9\u8c61\nThread childThread = new Thread(new ChildRunnable());\n//\u8c03\u7528start()\u65b9\u6cd5\u4f7f\u7ebf\u7a0b\u4eceNEW\u72b6\u6001\u8f6c\u6362\u5230RUNNABLE\u72b6\u6001\nchildThread.start();\u590d\u5236\n</code></pre>"},{"location":"front-end/android/concurrency/thread-lifecycle/#runnableterminated","title":"RUNNABLE\u5230TERMINATED\u72b6\u6001","text":"<p>\u7ebf\u7a0b\u6267\u884c\u5b8crun()\u65b9\u6cd5\u540e\uff0c\u6216\u8005\u6267\u884crun()\u65b9\u6cd5\u7684\u65f6\u5019\u629b\u51fa\u5f02\u5e38\uff0c\u90fd\u4f1a\u7ec8\u6b62\uff0c\u6b64\u65f6\u4e3aTERMINATED\u72b6\u6001\u3002\u5982\u679c\u6211\u4eec\u9700\u8981\u4e2d\u65adrun()\u65b9\u6cd5\uff0c\u53ef\u4ee5\u8c03\u7528interrupt()\u65b9\u6cd5\u3002</p>"},{"location":"front-end/android/concurrency/thread-lifecycle/#_8","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://developer.huawei.com/consumer/cn/forum/topic/0202779877806640557?fid=0101592429757310384</p>"},{"location":"front-end/android/concurrency/thread-pool/","title":"\u7ebf\u7a0b\u6c60\u603b\u7ed3","text":""},{"location":"front-end/android/concurrency/thread-pool/#1","title":"1. \u4e3a\u4ec0\u4e48\u4f7f\u7528\u7ebf\u7a0b\u6c60","text":"<p>\u7ebf\u7a0b\u6c60\u89e3\u51b3\u7684\u6838\u5fc3\u95ee\u9898\u5c31\u662f\u8d44\u6e90\u7ba1\u7406\u95ee\u9898\u3002\u5728\u5e76\u53d1\u73af\u5883\u4e0b\uff0c\u7cfb\u7edf\u4e0d\u80fd\u591f\u786e\u5b9a\u5728\u4efb\u610f\u65f6\u523b\u4e2d\uff0c\u6709\u591a\u5c11\u4efb\u52a1\u9700\u8981\u6267\u884c\uff0c\u6709\u591a\u5c11\u8d44\u6e90\u9700\u8981\u6295\u5165\u3002\u8fd9\u79cd\u4e0d\u786e\u5b9a\u6027\u5c06\u5e26\u6765\u4ee5\u4e0b\u82e5\u5e72\u95ee\u9898\uff1a</p> <ol> <li>\u9891\u7e41\u7533\u8bf7/\u9500\u6bc1\u8d44\u6e90\u548c\u8c03\u5ea6\u8d44\u6e90\uff0c\u5c06\u5e26\u6765\u989d\u5916\u7684\u6d88\u8017\uff0c\u53ef\u80fd\u4f1a\u975e\u5e38\u5de8\u5927\u3002</li> <li>\u5bf9\u8d44\u6e90\u65e0\u9650\u7533\u8bf7\u7f3a\u5c11\u6291\u5236\u624b\u6bb5\uff0c\u6613\u5f15\u53d1\u7cfb\u7edf\u8d44\u6e90\u8017\u5c3d\u7684\u98ce\u9669\u3002</li> <li>\u7cfb\u7edf\u65e0\u6cd5\u5408\u7406\u7ba1\u7406\u5185\u90e8\u7684\u8d44\u6e90\u5206\u5e03\uff0c\u4f1a\u964d\u4f4e\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u3002</li> </ol> <p>\u4e3a\u89e3\u51b3\u8d44\u6e90\u5206\u914d\u8fd9\u4e2a\u95ee\u9898\uff0c\u7ebf\u7a0b\u6c60\u91c7\u7528\u4e86 \u201c\u6c60\u5316\u201d\uff08Pooling\uff09 \u601d\u60f3\u3002\u6c60\u5316\uff0c\u987e\u540d\u601d\u4e49\uff0c\u662f\u4e3a\u4e86\u6700\u5927\u5316\u6536\u76ca\u5e76\u6700\u5c0f\u5316\u98ce\u9669\uff0c\u800c\u5c06\u8d44\u6e90\u7edf\u4e00\u5728\u4e00\u8d77\u7ba1\u7406\u7684\u4e00\u79cd\u601d\u60f3\u3002</p>"},{"location":"front-end/android/concurrency/thread-pool/#11","title":"1.1 \u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u597d\u5904\uff1a","text":"<ul> <li>\u964d\u4f4e\u8d44\u6e90\u6d88\u8017\uff1a\u901a\u8fc7\u6c60\u5316\u6280\u672f\u91cd\u590d\u5229\u7528\u5df2\u521b\u5efa\u7684\u7ebf\u7a0b\uff0c\u964d\u4f4e\u7ebf\u7a0b\u521b\u5efa\u548c\u9500\u6bc1\u9020\u6210\u7684\u635f\u8017\u3002</li> <li>\u63d0\u9ad8\u54cd\u5e94\u901f\u5ea6\uff1a\u4efb\u52a1\u5230\u8fbe\u65f6\uff0c\u65e0\u9700\u7b49\u5f85\u7ebf\u7a0b\u521b\u5efa\u5373\u53ef\u7acb\u5373\u6267\u884c\u3002</li> <li>\u63d0\u9ad8\u7ebf\u7a0b\u7684\u53ef\u7ba1\u7406\u6027\uff1a\u7ebf\u7a0b\u662f\u7a00\u7f3a\u8d44\u6e90\uff0c\u5982\u679c\u65e0\u9650\u5236\u521b\u5efa\uff0c\u4e0d\u4ec5\u4f1a\u6d88\u8017\u7cfb\u7edf\u8d44\u6e90\uff0c\u8fd8\u4f1a\u56e0\u4e3a\u7ebf\u7a0b\u7684\u4e0d\u5408\u7406\u5206\u5e03\u5bfc\u81f4\u8d44\u6e90\u8c03\u5ea6\u5931\u8861\uff0c\u964d\u4f4e\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u3002\u4f7f\u7528\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u8fdb\u884c\u7edf\u4e00\u7684\u5206\u914d\u3001\u8c03\u4f18\u548c\u76d1\u63a7\u3002</li> <li>\u63d0\u4f9b\u66f4\u591a\u66f4\u5f3a\u5927\u7684\u529f\u80fd\uff1a\u7ebf\u7a0b\u6c60\u5177\u5907\u53ef\u62d3\u5c55\u6027\uff0c\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u5411\u5176\u4e2d\u589e\u52a0\u66f4\u591a\u7684\u529f\u80fd\u3002\u6bd4\u5982\u5ef6\u65f6\u5b9a\u65f6\u7ebf\u7a0b\u6c60ScheduledThreadPoolExecutor\uff0c\u5c31\u5141\u8bb8\u4efb\u52a1\u5ef6\u671f\u6267\u884c\u6216\u5b9a\u671f\u6267\u884c\u3002</li> </ul> <p>\u201c\u6c60\u5316\u201d\u601d\u60f3\u4e0d\u4ec5\u4ec5\u80fd\u5e94\u7528\u5728\u8ba1\u7b97\u673a\u9886\u57df\uff0c\u5728\u91d1\u878d\u3001\u8bbe\u5907\u3001\u4eba\u5458\u7ba1\u7406\u3001\u5de5\u4f5c\u7ba1\u7406\u7b49\u9886\u57df\u4e5f\u6709\u76f8\u5173\u7684\u5e94\u7528\u3002 \u5728\u8ba1\u7b97\u673a\u9886\u57df\u4e2d\u7684\u8868\u73b0\u4e3a\uff1a\u7edf\u4e00\u7ba1\u7406IT\u8d44\u6e90\uff0c\u5305\u62ec\u670d\u52a1\u5668\u3001\u5b58\u50a8\u3001\u548c\u7f51\u7edc\u8d44\u6e90\u7b49\u7b49\u3002\u901a\u8fc7\u5171\u4eab\u8d44\u6e90\uff0c\u4f7f\u7528\u6237\u5728\u4f4e\u6295\u5165\u4e2d\u83b7\u76ca\u3002\u9664\u53bb\u7ebf\u7a0b\u6c60\uff0c\u8fd8\u6709\u5176\u4ed6\u6bd4\u8f83\u5178\u578b\u7684\u51e0\u79cd\u4f7f\u7528\u7b56\u7565\u5305\u62ec\uff1a</p> <ol> <li>\u5185\u5b58\u6c60(Memory Pooling)\uff1a\u9884\u5148\u7533\u8bf7\u5185\u5b58\uff0c\u63d0\u5347\u7533\u8bf7\u5185\u5b58\u901f\u5ea6\uff0c\u51cf\u5c11\u5185\u5b58\u788e\u7247\u3002</li> <li>\u8fde\u63a5\u6c60(Connection Pooling)\uff1a\u9884\u5148\u7533\u8bf7\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u63d0\u5347\u7533\u8bf7\u8fde\u63a5\u7684\u901f\u5ea6\uff0c\u964d\u4f4e\u7cfb\u7edf\u7684\u5f00\u9500\u3002</li> <li>\u5b9e\u4f8b\u6c60(Object Pooling)\uff1a\u5faa\u73af\u4f7f\u7528\u5bf9\u8c61\uff0c\u51cf\u5c11\u8d44\u6e90\u5728\u521d\u59cb\u5316\u548c\u91ca\u653e\u65f6\u7684\u6602\u8d35\u635f\u8017\u3002</li> </ol>"},{"location":"front-end/android/concurrency/thread-pool/#3","title":"3.\u7ebf\u7a0b\u6c60\u4f7f\u7528","text":""},{"location":"front-end/android/concurrency/thread-pool/#31","title":"3.1 \u521b\u5efa","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>ThreadPoolExecutor</code>\u6765\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u3002 <pre><code>new ThreadPoolExecutor(corePoolSize, maximumPoolSize,\nkeepAliveTime, milliseconds,runnableTaskQueue, threadFactory,handler);\n</code></pre></p>"},{"location":"front-end/android/concurrency/thread-pool/#_2","title":"\u53c2\u6570\u8bf4\u660e","text":"<ul> <li> <p>corePoolSize\uff08\u7ebf\u7a0b\u6c60\u7684\u57fa\u672c\u5927\u5c0f\uff09\uff1a\u5f53\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\u5230\u7ebf\u7a0b\u6c60\u65f6\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\uff0c\u5373\u4f7f\u5176\u4ed6\u7a7a\u95f2\u7684\u57fa\u672c\u7ebf\u7a0b\u80fd\u591f\u6267\u884c\u65b0\u4efb\u52a1\u4e5f\u4f1a\u521b\u5efa\u7ebf\u7a0b\uff0c\u7b49\u5230\u9700\u8981\u6267\u884c\u7684\u4efb\u52a1\u6570\u5927\u4e8e\u7ebf\u7a0b\u6c60\u57fa\u672c\u5927\u5c0f\u65f6\u5c31\u4e0d\u518d\u521b\u5efa\u3002\u5982\u679c\u8c03\u7528\u4e86\u7ebf\u7a0b\u6c60\u7684prestartAllCoreThreads\u65b9\u6cd5\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u63d0\u524d\u521b\u5efa\u5e76\u542f\u52a8\u6240\u6709\u57fa\u672c\u7ebf\u7a0b\u3002</p> </li> <li> <p>maximumPoolSize\uff08\u7ebf\u7a0b\u6c60\u6700\u5927\u5927\u5c0f\uff09\uff1a\u7ebf\u7a0b\u6c60\u5141\u8bb8\u521b\u5efa\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u3002\u5982\u679c\u961f\u5217\u6ee1\u4e86\uff0c\u5e76\u4e14\u5df2\u521b\u5efa\u7684\u7ebf\u7a0b\u6570\u5c0f\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5219\u7ebf\u7a0b\u6c60\u4f1a\u518d\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\u5982\u679c\u4f7f\u7528\u4e86\u65e0\u754c\u7684\u4efb\u52a1\u961f\u5217\u8fd9\u4e2a\u53c2\u6570\u5c31\u6ca1\u4ec0\u4e48\u6548\u679c\u3002</p> </li> <li> <p>keepAliveTime\uff08\u7ebf\u7a0b\u6d3b\u52a8\u4fdd\u6301\u65f6\u95f4\uff09\uff1a\u7ebf\u7a0b\u6c60\u7684\u5de5\u4f5c\u7ebf\u7a0b\u7a7a\u95f2\u540e\uff0c\u4fdd\u6301\u5b58\u6d3b\u7684\u65f6\u95f4\u3002\u6240\u4ee5\u5982\u679c\u4efb\u52a1\u5f88\u591a\uff0c\u5e76\u4e14\u6bcf\u4e2a\u4efb\u52a1\u6267\u884c\u7684\u65f6\u95f4\u6bd4\u8f83\u77ed\uff0c\u53ef\u4ee5\u8c03\u5927\u8fd9\u4e2a\u65f6\u95f4\uff0c\u63d0\u9ad8\u7ebf\u7a0b\u7684\u5229\u7528\u7387\u3002</p> </li> <li> <p>TimeUnit\uff08\u7ebf\u7a0b\u6d3b\u52a8\u4fdd\u6301\u65f6\u95f4\u7684\u5355\u4f4d\uff09\uff1a\u53ef\u9009\u7684\u5355\u4f4d\u6709\u5929\uff08DAYS\uff09\uff0c\u5c0f\u65f6\uff08HOURS\uff09\uff0c\u5206\u949f\uff08MINUTES\uff09\uff0c\u6beb\u79d2(MILLISECONDS)\uff0c\u5fae\u79d2(MICROSECONDS, \u5343\u5206\u4e4b\u4e00\u6beb\u79d2)\u548c\u6beb\u5fae\u79d2(NANOSECONDS, \u5343\u5206\u4e4b\u4e00\u5fae\u79d2)\u3002</p> </li> <li> <p>ThreadFactory\uff1a\u7528\u4e8e\u8bbe\u7f6e\u521b\u5efa\u7ebf\u7a0b\u7684\u5de5\u5382\uff0c\u53ef\u4ee5\u901a\u8fc7\u7ebf\u7a0b\u5de5\u5382\u7ed9\u6bcf\u4e2a\u521b\u5efa\u51fa\u6765\u7684\u7ebf\u7a0b\u8bbe\u7f6e\u66f4\u6709\u610f\u4e49\u7684\u540d\u5b57\uff0cDebug\u548c\u5b9a\u4f4d\u95ee\u9898\u65f6\u975e\u5e38\u53c8\u5e2e\u52a9\u3002</p> </li> <li> <p>runnableTaskQueue\uff08\u4efb\u52a1\u961f\u5217\uff09\uff1a\u7528\u4e8e\u4fdd\u5b58\u7b49\u5f85\u6267\u884c\u7684\u4efb\u52a1\u7684\u963b\u585e\u961f\u5217\u3002\u53ef\u4ee5\u9009\u62e9\u4ee5\u4e0b\u51e0\u4e2a\u963b\u585e\u961f\u5217\u3002</p> </li> </ul> \u540d\u79f0 \u63cf\u8ff0 ArrayBlockingQueue \u4e00\u4e2a\u7528\u6570\u7ec4\u5b9e\u73b0\u7684\u6709\u754c\u963b\u585e\u961f\u5217\uff0c\u6b64\u961f\u5217\u6309\u7167\u5148\u8fdb\u5148\u51fa\uff08 FIFO \uff09\u7684\u539f\u5219\u5bf9\u5143\u7d20\u8fdb\u884c\u6392\u5e8f\u3002\u652f\u6301\u516c\u5e73\u9501\u548c\u975e\u516c\u5e73\u9501\u3002 LinkedBlockingQueue \u4e00\u4e2a\u7531\u94fe\u8868\u7ed3\u6784\u7ec4\u6210\u7684\u6709\u754c\u961f\u5217\uff0c\u6b64\u961f\u5217\u6309\u7167\u5148\u8fdb\u5148\u51fa\uff08 FIFO \uff09\u7684\u539f\u5219\u5bf9\u5143\u7d20\u8fdb\u884c\u6392\u5e8f\u3002\u6b64\u961f\u5217\u7684\u9ed8\u8ba4\u957f\u5ea6\u4e3a Integer.MAX_VALUE \uff0c\u6240\u4ee5\u9ed8\u8ba4\u521b\u5efa\u7684\u8be5\u961f\u5217\u6709\u5bb9\u91cf\u5371\u9669\u3002\u9759\u6001\u5de5\u5382\u65b9\u6cd5Executors.newFixedThreadPool()\u4f7f\u7528\u4e86\u8fd9\u4e2a\u961f\u5217\u3002 SynchronousQueue \u4e00\u4e2a\u4e0d\u5b58\u50a8\u5143\u7d20\u7684\u963b\u585e\u961f\u5217\uff0c\u6bcf\u4e00\u4e2a put \u64cd\u4f5c\u5fc5\u987b\u7b49\u5f85 take \u64cd\u4f5c\uff0c\u5426\u5219\u4e0d\u80fd\u6dfb\u52a0\u5143\u7d20\u3002\u652f\u6301\u516c\u5e73\u9501\u548c\u975e\u516c\u5e73\u9501\u3002  Executors.newCachedThreadPool(\uff09\u5c31\u4f7f\u7528\u4e86 SynChronousoueue \uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u6c60\u6839\u636e\u9700\u8981\uff08\u65b0\u4efb\u52a1\u5230\u6765\u65f6\uff09\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\uff0c\u5982\u679c\u6709\u7a7a\u95f2\u7ebf\u7a0b\u5219\u4f1a\u91cd\u590d\u4f7f\u7528\uff0c\u7ebf\u7a0b\u7a7a\u95f2\u4e86 60 \u79d2\u540e\u4f1a\u88ab\u56de\u6536 PriorityBlockingQueue \u4e00\u4e2a\u652f\u6301\u7ebf\u7a0b\u4f18\u5148\u7ea7\u6392\u5e8f\u7684\u65e0\u754c\u961f\u5217\uff0c\u9ed8\u8ba4\u81ea\u7136\u5e8f\u8fdb\u884c\u6392\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5b9e\u73b0 compareTo(\uff09\u65b9\u6cd5\u6765\u6307\u5b9a\u5143\u7d20\u6392\u5e8f\u89c4\u5219\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u540c\u4f18\u5148\u7ea7\u5143\u7d20\u7684\u987a\u5e8f <ul> <li>RejectedExecutionHandler\uff08\u9971\u548c\u7b56\u7565\uff09\uff1a\u5f53\u961f\u5217\u548c\u7ebf\u7a0b\u6c60\u90fd\u6ee1\u4e86\uff0c\u8bf4\u660e\u7ebf\u7a0b\u6c60\u5904\u4e8e\u9971\u548c\u72b6\u6001\uff0c\u90a3\u4e48\u5fc5\u987b\u91c7\u53d6\u4e00\u79cd\u7b56\u7565\u5904\u7406\u63d0\u4ea4\u7684\u65b0\u4efb\u52a1\u3002\u8fd9\u4e2a\u7b56\u7565\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662fAbortPolicy\uff0c\u8868\u793a\u65e0\u6cd5\u5904\u7406\u65b0\u4efb\u52a1\u65f6\u629b\u51fa\u5f02\u5e38\u3002\u4ee5\u4e0b\u662fJDK\u63d0\u4f9b\u7684\u56db\u79cd\u7b56\u7565</li> </ul> \u540d\u79f0 \u63cf\u8ff0 AbortPolicy \u4e22\u5f03\u4efb\u52a1\u5e76\u629b\u51fa RejectedExecutionException \u5f02\u5e38\u3002\u8fd9\u662f\u7ebf\u7a0b\u6c60\u9ed8\u8ba4\u7684\u62d2\u7edd\u7b56\u7565\uff0e\u5728\u4efb\u52a1\u4e0d\u80fd\u518d\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u629b\u51fa\u5f02\u5e38\uff0c\u53ca\u65f6\u53cd\u9988\u7a0b\u5e8f\u8fd0\u884c\u72b6\u6001\u3002\u5982\u679c\u662f\u6bd4\u8f83\u5173\u952e\u7684\u4e1a\u52a1\uff0e\u63a8\u8350\u4f7f\u7528\u6b64\u62d2\u7edd\u7b56\u7565\uff0c\u8fd9\u6837\u5b50\u5728\u7cfb\u7edf\u4e0d\u80fd\u627f\u8f7d\u66f4\u5927\u7684\u5e76\u53d1\u91cf\u7684\u65f6\u5019\uff0c\u80fd\u591f\u53ca\u65f6\u7684\u901a\u8fc7\u5f02\u5e38\u53d1\u73b0 CallerRunsPolicy \u7531\u8c03\u7528\u7ebf\u7a0b\uff08\u63d0\u4ea4\u4efb\u52a1\u7684\u7ebf\u7a0b\uff09\u5904\u7406\u8be5\u4efb\u52a1\u3002\u8fd9\u79cd\u60c5\u51b5\u662f\u9700\u8981\u8ba9\u6240\u6709\u4efb\u52a1\u90fd\u6267\u884c\u5b8c\u6bd5\uff0c\u90a3\u4e48\u5c31\u9002\u5408\u5927\u91cf\u8ba1\u7b97\u7684\u4efb\u52a1\u7c7b\u578b\u53bb\u6267\u884c\uff0c\u591a\u7ebf\u7a0b\u4ec5\u4ec5\u662f\u589e\u5927\u541e\u5410\u89c5\u7684\u624b\u6bb5\uff0c\u6700\u7ec8\u5fc5\u987b\u8981\u8ba9\u6bcf\u4e2a\u4efb\u52a1\u90fd\u6267\u884c\u5b8c\u6bd5\u3002 DiscardOldestPolicy \u5f03\u961f\u5217\u6700\u524d\u9762\u7684\u4efb\u52a1\uff0c\u7136\u540e\u91cd\u65b0\u63d0\u4ea4\u88ab\u62d2\u7edd\u7684\u4efb\u52a1\u3002\u662f\u5426\u8981\u91c7\u7528\u6b64\u79cd\u62d2\u7edd\u7b56\u7565\uff0c\u8fd8\u5f97\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u662f\u5426\u5141\u8bb8\u4e22\u5f03\u8001\u4efb\u52a1\u6765\u8ba4\u771f\u8861\u91cf DiscardPolicy \u4e22\u5f03\u4efb\u52a1\uff0c\u4f46\u662f\u4e0d\u629b\u51fa\u5f02\u5e38\u3002\u4f7f\u7528\u6b64\u7b56\u7565\uff0c\u53ef\u80fd\u4f1a\u4f7f\u6211\u4eec\u65e0\u6cd5\u53d1\u73b0\u7cfb\u7edf\u7684\u5f02\u5e38\u72b6\u6001\u3002\u5efa\u8bae\u662f\u4e00\u4e9b\u65e0\u5173\u7d27\u8981\u7684\u4e1a\u52a1\u91c7\u7528\u6b64\u7b56\u7565 \u81ea\u5b9a\u4e49\u7b56\u7565 \u6839\u636e\u5e94\u7528\u573a\u666f\u9700\u8981\u6765\u5b9e\u73b0RejectedExecutionHandler\u63a5\u53e3\u81ea\u5b9a\u4e49\u7b56\u7565\u3002\u5982\u8bb0\u5f55\u65e5\u5fd7\u6216\u6301\u4e45\u5316\u4e0d\u80fd\u5904\u7406\u7684\u4efb\u52a1"},{"location":"front-end/android/concurrency/thread-pool/#31_1","title":"3.1 \u63d0\u4ea4\u4efb\u52a1","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528execute\u63d0\u4ea4\u7684\u4efb\u52a1\uff0c\u4f46\u662fexecute\u65b9\u6cd5\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u6240\u4ee5\u65e0\u6cd5\u5224\u65ad\u4efb\u52a1\u77e5\u5426\u88ab\u7ebf\u7a0b\u6c60\u6267\u884c\u6210\u529f\u3002\u901a\u8fc7\u4ee5\u4e0b\u4ee3\u7801\u53ef\u77e5execute\u65b9\u6cd5\u8f93\u5165\u7684\u4efb\u52a1\u662f\u4e00\u4e2aRunnable\u7c7b\u7684\u5b9e\u4f8b\u3002 <pre><code>threadsPool.execute(new Runnable() {\n@Override\npublic void run() {\n// TODO Auto-generated method stub\n}\n});\n</code></pre> \u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528submit \u65b9\u6cd5\u6765\u63d0\u4ea4\u4efb\u52a1\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2afuture,\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2afuture\u6765\u5224\u65ad\u4efb\u52a1\u662f\u5426\u6267\u884c\u6210\u529f\uff0c\u901a\u8fc7future\u7684get\u65b9\u6cd5\u6765\u83b7\u53d6\u8fd4\u56de\u503c\uff0cget\u65b9\u6cd5\u4f1a\u963b\u585e\u4f4f\u76f4\u5230\u4efb\u52a1\u5b8c\u6210\uff0c\u800c\u4f7f\u7528get(long timeout, TimeUnit unit)\u65b9\u6cd5\u5219\u4f1a\u963b\u585e\u4e00\u6bb5\u65f6\u95f4\u540e\u7acb\u5373\u8fd4\u56de\uff0c\u8fd9\u65f6\u6709\u53ef\u80fd\u4efb\u52a1\u6ca1\u6709\u6267\u884c\u5b8c\u3002 <pre><code>try {\nObject s = future.get();\n} catch (InterruptedException e) {\n// \u5904\u7406\u4e2d\u65ad\u5f02\u5e38\n} catch (ExecutionException e) {\n// \u5904\u7406\u65e0\u6cd5\u6267\u884c\u4efb\u52a1\u5f02\u5e38\n} finally {\n// \u5173\u95ed\u7ebf\u7a0b\u6c60\nexecutor.shutdown();\n}\n</code></pre></p>"},{"location":"front-end/android/concurrency/thread-pool/#33","title":"3.3 \u5173\u95ed\u7ebf\u7a0b\u6c60","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u7ebf\u7a0b\u6c60\u7684shutdown\u6216shutdownNow\u65b9\u6cd5\u6765\u5173\u95ed\u7ebf\u7a0b\u6c60\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u5b9e\u73b0\u539f\u7406\u4e0d\u540c\uff0cshutdown\u7684\u539f\u7406\u662f\u53ea\u662f\u5c06\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u8bbe\u7f6e\u6210SHUTDOWN\u72b6\u6001\uff0c\u7136\u540e\u4e2d\u65ad\u6240\u6709\u6ca1\u6709\u6b63\u5728\u6267\u884c\u4efb\u52a1\u7684\u7ebf\u7a0b\u3002shutdownNow\u7684\u539f\u7406\u662f\u904d\u5386\u7ebf\u7a0b\u6c60\u4e2d\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u7136\u540e\u9010\u4e2a\u8c03\u7528\u7ebf\u7a0b\u7684interrupt\u65b9\u6cd5\u6765\u4e2d\u65ad\u7ebf\u7a0b\uff0c\u6240\u4ee5\u65e0\u6cd5\u54cd\u5e94\u4e2d\u65ad\u7684\u4efb\u52a1\u53ef\u80fd\u6c38\u8fdc\u65e0\u6cd5\u7ec8\u6b62\u3002shutdownNow\u4f1a\u9996\u5148\u5c06\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u8bbe\u7f6e\u6210STOP\uff0c\u7136\u540e\u5c1d\u8bd5\u505c\u6b62\u6240\u6709\u7684\u6b63\u5728\u6267\u884c\u6216\u6682\u505c\u4efb\u52a1\u7684\u7ebf\u7a0b\uff0c\u5e76\u8fd4\u56de\u7b49\u5f85\u6267\u884c\u4efb\u52a1\u7684\u5217\u8868\u3002</p> <p>\u53ea\u8981\u8c03\u7528\u4e86\u8fd9\u4e24\u4e2a\u5173\u95ed\u65b9\u6cd5\u7684\u5176\u4e2d\u4e00\u4e2a\uff0cisShutdown\u65b9\u6cd5\u5c31\u4f1a\u8fd4\u56detrue\u3002\u5f53\u6240\u6709\u7684\u4efb\u52a1\u90fd\u5df2\u5173\u95ed\u540e,\u624d\u8868\u793a\u7ebf\u7a0b\u6c60\u5173\u95ed\u6210\u529f\uff0c\u8fd9\u65f6\u8c03\u7528isTerminaed\u65b9\u6cd5\u4f1a\u8fd4\u56detrue\u3002\u81f3\u4e8e\u6211\u4eec\u5e94\u8be5\u8c03\u7528\u54ea\u4e00\u79cd\u65b9\u6cd5\u6765\u5173\u95ed\u7ebf\u7a0b\u6c60\uff0c\u5e94\u8be5\u7531\u63d0\u4ea4\u5230\u7ebf\u7a0b\u6c60\u7684\u4efb\u52a1\u7279\u6027\u51b3\u5b9a\uff0c\u901a\u5e38\u8c03\u7528shutdown\u6765\u5173\u95ed\u7ebf\u7a0b\u6c60\uff0c\u5982\u679c\u4efb\u52a1\u4e0d\u4e00\u5b9a\u8981\u6267\u884c\u5b8c\uff0c\u5219\u53ef\u4ee5\u8c03\u7528shutdownNow\u3002</p>"},{"location":"front-end/android/concurrency/thread-pool/#3_1","title":"3. \u7ebf\u7a0b\u6c60\u6838\u5fc3\u8bbe\u8ba1\u4e0e\u5b9e\u73b0","text":""},{"location":"front-end/android/concurrency/thread-pool/#31_2","title":"3.1 \u603b\u4f53\u8bbe\u8ba1","text":"<p>\u7ebf\u7a0b\u6c60\u5728\u5185\u90e8\u5b9e\u9645\u4e0a\u6784\u5efa\u4e86\u4e00\u4e2a \u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u578b\uff0c\u5c06\u7ebf\u7a0b\u548c\u4efb\u52a1\u4e24\u8005\u89e3\u8026\uff0c\u5e76\u4e0d\u76f4\u63a5\u5173\u8054\uff0c\u4ece\u800c\u826f\u597d\u7684\u7f13\u51b2\u4efb\u52a1\uff0c\u590d\u7528\u7ebf\u7a0b\u3002 \u7ebf\u7a0b\u6c60\u7684\u8fd0\u884c\u4e3b\u8981\u5206\u6210\u4e24\u90e8\u5206\uff1a\u4efb\u52a1\u7ba1\u7406\u3001\u7ebf\u7a0b\u7ba1\u7406\u3002</p> <ul> <li>\u4efb\u52a1\u7ba1\u7406\u90e8\u5206\u5145\u5f53\u751f\u4ea7\u8005\u7684\u89d2\u8272\uff0c\u5f53\u4efb\u52a1\u63d0\u4ea4\u540e\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u5224\u65ad\u8be5\u4efb\u52a1\u540e\u7eed\u7684\u6d41\u8f6c\uff1a\uff081\uff09\u76f4\u63a5\u7533\u8bf7\u7ebf\u7a0b\u6267\u884c\u8be5\u4efb\u52a1\uff1b\uff082\uff09\u7f13\u51b2\u5230\u961f\u5217\u4e2d\u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\uff1b\uff083\uff09\u62d2\u7edd\u8be5\u4efb\u52a1\u3002</li> <li>\u7ebf\u7a0b\u7ba1\u7406\u90e8\u5206\u662f\u6d88\u8d39\u8005\uff0c\u5b83\u4eec\u88ab\u7edf\u4e00\u7ef4\u62a4\u5728\u7ebf\u7a0b\u6c60\u5185\uff0c\u6839\u636e\u4efb\u52a1\u8bf7\u6c42\u8fdb\u884c\u7ebf\u7a0b\u7684\u5206\u914d\uff0c\u5f53\u7ebf\u7a0b\u6267\u884c\u5b8c\u4efb\u52a1\u540e\u5219\u4f1a\u7ee7\u7eed\u83b7\u53d6\u65b0\u7684\u4efb\u52a1\u53bb\u6267\u884c\uff0c\u6700\u7ec8\u5f53\u7ebf\u7a0b\u83b7\u53d6\u4e0d\u5230\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u56de\u6536\u3002</li> </ul> <p>\u603b\u4f53\u8fd0\u884c\u673a\u5236\u5982\u4e0b </p>"},{"location":"front-end/android/concurrency/thread-pool/#32","title":"3.2 \u4efb\u52a1\u6267\u884c\u673a\u5236","text":"<p>\u6240\u6709\u4efb\u52a1\u7684\u8c03\u5ea6\u90fd\u662f\u7531execute\u65b9\u6cd5\u5b8c\u6210\u7684\uff0c\u8fd9\u90e8\u5206\u5b8c\u6210\u7684\u5de5\u4f5c\u662f\uff1a\u68c0\u67e5\u73b0\u5728\u7ebf\u7a0b\u6c60\u7684\u8fd0\u884c\u72b6\u6001\u3001\u8fd0\u884c\u7ebf\u7a0b\u6570\u3001\u8fd0\u884c\u7b56\u7565\uff0c\u51b3\u5b9a\u63a5\u4e0b\u6765\u6267\u884c\u7684\u6d41\u7a0b\uff0c\u662f\u76f4\u63a5\u7533\u8bf7\u7ebf\u7a0b\u6267\u884c\uff0c\u6216\u662f\u7f13\u51b2\u5230\u961f\u5217\u4e2d\u6267\u884c\uff0c\u4ea6\u6216\u662f\u76f4\u63a5\u62d2\u7edd\u8be5\u4efb\u52a1\u3002\u5176\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u9996\u5148\u68c0\u6d4b\u7ebf\u7a0b\u6c60\u8fd0\u884c\u72b6\u6001\uff0c\u5982\u679c\u4e0d\u662fRUNNING\uff0c\u5219\u76f4\u63a5\u62d2\u7edd\uff0c\u7ebf\u7a0b\u6c60\u8981\u4fdd\u8bc1\u5728RUNNING\u7684\u72b6\u6001\u4e0b\u6267\u884c\u4efb\u52a1\u3002</li> <li>\u5982\u679cworkerCount &lt; corePoolSize\uff0c\u5219\u521b\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u65b0\u63d0\u4ea4\u7684\u4efb\u52a1\u3002</li> <li>\u5982\u679cworkerCount &gt;= corePoolSize\uff0c\u4e14\u7ebf\u7a0b\u6c60\u5185\u7684\u963b\u585e\u961f\u5217\u672a\u6ee1\uff0c\u5219\u5c06\u4efb\u52a1\u6dfb\u52a0\u5230\u8be5\u963b\u585e\u961f\u5217\u4e2d\u3002</li> <li>\u5982\u679cworkerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSize\uff0c\u4e14\u7ebf\u7a0b\u6c60\u5185\u7684\u963b\u585e\u961f\u5217\u5df2\u6ee1\uff0c\u5219\u521b\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u65b0\u63d0\u4ea4\u7684\u4efb\u52a1\u3002</li> <li>\u5982\u679cworkerCount &gt;= maximumPoolSize\uff0c\u5e76\u4e14\u7ebf\u7a0b\u6c60\u5185\u7684\u963b\u585e\u961f\u5217\u5df2\u6ee1, \u5219\u6839\u636e\u62d2\u7edd\u7b56\u7565\u6765\u5904\u7406\u8be5\u4efb\u52a1, \u9ed8\u8ba4\u7684\u5904\u7406\u65b9\u5f0f\u662f\u76f4\u63a5\u629b\u5f02\u5e38\u3002</li> </ol> <p>\u5176\u6267\u884c\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u6e90\u4ee3\u7801\u6765\u770b\u770b\u662f\u5982\u4f55\u5b9e\u73b0\u7684 <pre><code>public void execute(Runnable command) {\nif (command == null)\nthrow new NullPointerException();\n//\u5982\u679c\u7ebf\u7a0b\u6570\u5c0f\u4e8e\u57fa\u672c\u7ebf\u7a0b\u6570\uff0c\u5219\u521b\u5efa\u7ebf\u7a0b\u5e76\u6267\u884c\u5f53\u524d\u4efb\u52a1\nif (poolSize &gt;= corePoolSize || !addIfUnderCorePoolSize(command)) {\n//\u5982\u7ebf\u7a0b\u6570\u5927\u4e8e\u7b49\u4e8e\u57fa\u672c\u7ebf\u7a0b\u6570\u6216\u7ebf\u7a0b\u521b\u5efa\u5931\u8d25\uff0c\u5219\u5c06\u5f53\u524d\u4efb\u52a1\u653e\u5230\u5de5\u4f5c\u961f\u5217\u4e2d\u3002\nif (runState == RUNNING &amp;&amp; workQueue.offer(command)) {\nif (runState != RUNNING || poolSize == 0)\nensureQueuedTaskHandled(command);\n}\n//\u5982\u679c\u7ebf\u7a0b\u6c60\u4e0d\u5904\u4e8e\u8fd0\u884c\u4e2d\u6216\u4efb\u52a1\u65e0\u6cd5\u653e\u5165\u961f\u5217\uff0c\u5e76\u4e14\u5f53\u524d\u7ebf\u7a0b\u6570\u91cf\u5c0f\u4e8e\u6700\u5927\u5141\u8bb8\u7684\u7ebf\u7a0b\u6570\u91cf\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u3002\nelse if (!addIfUnderMaximumPoolSize(command))\n//\u629b\u51faRejectedExecutionException\u5f02\u5e38\nreject(command); // is shutdown or saturated\n}\n}\n</code></pre></p>"},{"location":"front-end/android/concurrency/thread-pool/#33_1","title":"3.3 \u5de5\u4f5c\u7ebf\u7a0b","text":"<p>\u7ebf\u7a0b\u6c60\u521b\u5efa\u7ebf\u7a0b\u65f6\uff0c\u4f1a\u5c06\u7ebf\u7a0b\u5c01\u88c5\u6210\u5de5\u4f5c\u7ebf\u7a0bWorker\uff0cWorker\u5728\u6267\u884c\u5b8c\u4efb\u52a1\u540e\uff0c\u8fd8\u4f1a\u65e0\u9650\u5faa\u73af\u83b7\u53d6\u5de5\u4f5c\u961f\u5217\u91cc\u7684\u4efb\u52a1\u6765\u6267\u884c\u3002\u6211\u4eec\u53ef\u4ee5\u4eceWorker\u7684run\u65b9\u6cd5\u91cc\u770b\u5230\u8fd9\u70b9\uff1a <pre><code>public void run() {\ntry {\nRunnable task = firstTask;\nfirstTask = null;\nwhile (task != null || (task = getTask()) != null) {\nrunTask(task);\ntask = null;\n}\n} finally {\nworkerDone(this);\n}\n}\n</code></pre></p>"},{"location":"front-end/android/concurrency/thread-pool/#5","title":"5. \u4e1a\u52a1\u5b9e\u8df5","text":""},{"location":"front-end/android/concurrency/thread-pool/#53","title":"5.3 \u7ebf\u7a0b\u76d1\u63a7","text":"<p>\u901a\u8fc7\u7ebf\u7a0b\u6c60\u63d0\u4f9b\u7684\u53c2\u6570\u8fdb\u884c\u76d1\u63a7\u3002\u7ebf\u7a0b\u6c60\u91cc\u6709\u4e00\u4e9b\u5c5e\u6027\u5728\u76d1\u63a7\u7ebf\u7a0b\u6c60\u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528</p> <ul> <li>taskCount\uff1a\u7ebf\u7a0b\u6c60\u9700\u8981\u6267\u884c\u7684\u4efb\u52a1\u6570\u91cf\u3002</li> <li>completedTaskCount\uff1a\u7ebf\u7a0b\u6c60\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5df2\u5b8c\u6210\u7684\u4efb\u52a1\u6570\u91cf\u3002\u5c0f\u4e8e\u6216\u7b49\u4e8etaskCount\u3002</li> <li>largestPoolSize\uff1a\u7ebf\u7a0b\u6c60\u66fe\u7ecf\u521b\u5efa\u8fc7\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u91cf\u3002\u901a\u8fc7\u8fd9\u4e2a\u6570\u636e\u53ef\u4ee5\u77e5\u9053\u7ebf\u7a0b\u6c60\u662f\u5426\u6ee1\u8fc7\u3002\u5982\u7b49\u4e8e\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u5927\u5c0f\uff0c\u5219\u8868\u793a\u7ebf\u7a0b\u6c60\u66fe\u7ecf\u6ee1\u4e86\u3002</li> <li>getPoolSize:\u7ebf\u7a0b\u6c60\u7684\u7ebf\u7a0b\u6570\u91cf\u3002\u5982\u679c\u7ebf\u7a0b\u6c60\u4e0d\u9500\u6bc1\u7684\u8bdd\uff0c\u6c60\u91cc\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u81ea\u52a8\u9500\u6bc1\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5927\u5c0f\u53ea\u589e\u4e0d\u51cf\u3002</li> <li>getActiveCount\uff1a\u83b7\u53d6\u6d3b\u52a8\u7684\u7ebf\u7a0b\u6570\u3002</li> </ul> <p>\u901a\u8fc7\u6269\u5c55\u7ebf\u7a0b\u6c60\u8fdb\u884c\u76d1\u63a7\u3002\u901a\u8fc7\u7ee7\u627f\u7ebf\u7a0b\u6c60\u5e76\u91cd\u5199\u7ebf\u7a0b\u6c60\u7684beforeExecute\uff0cafterExecute\u548cterminated\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4efb\u52a1\u6267\u884c\u524d\uff0c\u6267\u884c\u540e\u548c\u7ebf\u7a0b\u6c60\u5173\u95ed\u524d\u5e72\u4e00\u4e9b\u4e8b\u60c5\u3002\u5982\u76d1\u63a7\u4efb\u52a1\u7684\u5e73\u5747\u6267\u884c\u65f6\u95f4\uff0c\u6700\u5927\u6267\u884c\u65f6\u95f4\u548c\u6700\u5c0f\u6267\u884c\u65f6\u95f4\u7b49\u3002</p>"},{"location":"front-end/android/concurrency/thread-pool/#52","title":"5.2 \u7ebf\u7a0b\u6536\u62e2","text":"<p>\u5bf9\u4e8e\u9879\u76ee\u672c\u8eab\u4e1a\u52a1\u6765\u8bf4\uff0c\u53ef\u4ee5\u8981\u6c42\u5f00\u53d1\u8005\u4f7f\u7528\u7edf\u4e00\u7684\u7ebf\u7a0b\u6c60\u6765\u7ba1\u7406\u7ebf\u7a0b\uff1b\u4f46\u5bf9\u4e8e\u7b2c\u4e09\u65b9 SDK \u4e2d\u7684\u7ebf\u7a0b\u8981\u600e\u4e48\u7ba1\u7406\u5462\uff1f\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5728\u7f16\u8bd1\u671f\u95f4 \u901a\u8fc7\u5b57\u8282\u7801\u4fee\u6539\u7684\u65b9\u5f0f\u5c06\u6240\u6709\u521b\u5efa\u7ebf\u7a0b\u7684\u6307\u4ee4\u5728\u7f16\u8bd1\u671f\u95f4\u66ff\u6362\u6210\u81ea\u5b9a\u4e49\u7684\u65b9\u6cd5\u8c03\u7528\uff0c\u4ece\u800c\u8fbe\u5230\u7edf\u4e00\u7ba1\u7406\u7684\u76ee\u7684\u3002Android \u521b\u5efa\u7ebf\u7a0b\u4e3b\u8981\u662f\u901a\u8fc7\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li><code>Thread</code> \u53ca\u5176\u5b50\u7c7b</li> <li><code>TheadPoolExecutor</code> \u53ca\u5176\u5b50\u7c7b\u3001<code>Executors</code>\u3001<code>ThreadFactory</code> \u5b9e\u73b0\u7c7b</li> <li><code>AsyncTask</code>\uff08\u5df2\u8fc7\u65f6\uff0c\u53ef\u4ee5\u4e0d\u8003\u8651\uff09</li> <li><code>Timer</code> \u53ca\u5176\u5b50\u7c7b</li> </ul> <p>\u5b57\u8282\u7801\u4fee\u6539\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528ASM\uff0c\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b</p> <p>\u5b57\u8282\u7801\u4fee\u6539 <pre><code>    private fun MethodInsnNode.transformInvokeSpecial(\nklass: ClassNode,\nmethod: MethodNode\n) {\nif (this.name != \"&lt;init&gt;\") {\nreturn\n}\nwhen (this.owner) {\n//java.lang.Thread\nTHREAD -&gt; transformThreadInvokeSpecial(klass, method)\n//android.os.HandlerThread\nHANDLER_THREAD -&gt; transformHandlerThreadInvokeSpecial(klass, method)\n//java.util.Timer\nTIMER -&gt; transformTimerInvokeSpecial(klass, method)\n//java.util.concurrent.ThreadPoolExecutor\nTHREAD_POOL_EXECUTOR -&gt; transformThreadPoolExecutorInvokeSpecial(klass, method)\n}\n}\n// transformHandlerThreadInvokeSpecial\nprivate fun MethodInsnNode.transformHandlerThreadInvokeSpecial(\nklass: ClassNode,\nmethod: MethodNode,\ninit: MethodInsnNode = this\n) {\nwhen (this.desc) {\n// HandlerThread(String)\n\"(Ljava/lang/String;)V\" -&gt; {\nmethod.instructions.apply {\ninsertBefore(init, LdcInsnNode(makeThreadName(klass.className)))\ninsertBefore(\ninit,\nMethodInsnNode(\nOpcodes.INVOKESTATIC,\nSHADOW_THREAD,\n\"makeThreadName\",\n\"(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\",\nfalse\n)\n)\n}\ncontext.logger.i(\" + $SHADOW_THREAD.makeThreadName(Ljava/lang/String;Ljava/lang/String;) =&gt; ${owner}.${name}${desc}: ${klass.name}.${method.name}${method.desc}\")\n}\n// HandlerThread(String, int)\n\"(Ljava/lang/String;I)V\" -&gt; {\nmethod.instructions.apply {\n// ..., name, priority =&gt; ..., priority, name\ninsertBefore(init, InsnNode(Opcodes.SWAP))\n// ..., priority, name =&gt; ..., priority, name, prefix\ninsertBefore(init, LdcInsnNode(makeThreadName(klass.className)))\n// ..., priority, name, prefix =&gt; ..., priority, name\ninsertBefore(\ninit,\nMethodInsnNode(\nOpcodes.INVOKESTATIC,\nSHADOW_THREAD,\n\"makeThreadName\",\n\"(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\",\nfalse\n)\n)\n// ..., priority, name =&gt; ..., name, priority\ninsertBefore(init, InsnNode(Opcodes.SWAP))\n}\ncontext.logger.i(\" + $SHADOW_THREAD.makeThreadName(Ljava/lang/String;Ljava/lang/String;) =&gt; ${owner}.${name}${desc}: ${klass.name}.${method.name}${method.desc}\")\n}\n}\n}\n</code></pre> hook \u5165\u53e3\u4ee3\u7801\u7247\u6bb5</p> <p>\u7ebf\u7a0b\u63a5\u7ba1\u4e4b\u540e\u53ef\u4ee5\u81ea\u884c\u505a\u4e00\u4e9b\u5b9a\u5236\u548c\u4f18\u5316\uff0c\u5f53\u7136\u8fd9\u91cc\u6700\u597d\u901a\u8fc7\u52a8\u6001\u914d\u7f6e\u6765\u63a7\u5236\uff0c\u907f\u514d\u4e00\u4e9b\u65e0\u6cd5\u9884\u89c1\u7684\u95ee\u9898\u3002 <pre><code>    public static ScheduledExecutorService newScheduledThreadPool(final int corePoolSize,\nfinal ThreadFactory factory,\nfinal String name, final String tag) {\n// 1. \u76f4\u63a5\u6362\u6210\u4e1a\u52a1\u7ebf\u7a0b\u6c60\nScheduledExecutorService hookExecutorService =\nThreadHookHelper.newScheduledThreadPool(corePoolSize, factory, tag);\nif (hookExecutorService != null) return hookExecutorService;\nif (ThreadHookHelper.allowCoreThreadTimeOut()) {\nfinal ScheduledThreadPoolExecutor executor =\nnew ScheduledThreadPoolExecutor(min(max(1, corePoolSize), MAX_POOL_SIZE),\nnew NamedThreadFactory(factory, name));\nexecutor.setKeepAliveTime(DEFAULT_KEEP_ALIVE, TimeUnit.MILLISECONDS);\n// 2. \u505a\u4e00\u4e9b\u4f18\u5316\uff1a\u5982\u5141\u8bb8\u6838\u5fc3\u7ebf\u7a0b\u9500\u6bc1\nexecutor.allowCoreThreadTimeOut(true);\nreturn executor;\n}\n// 3. \u91cd\u547d\u540d\u7ebf\u7a0b\uff0c\u65b9\u4fbf\u67e5\u627e\u95ee\u9898\uff1aname\u4e3a\u5bf9\u5e94\u4e09\u65b9\u5e93\u540d\u79f0\nreturn Executors.newScheduledThreadPool(corePoolSize, new NamedThreadFactory(factory, name));\n}\n</code></pre></p>"},{"location":"front-end/android/concurrency/thread-pool/#53_1","title":"5.3.  \u5982\u4f55\u5408\u7406\u914d\u7f6e\u7ebf\u7a0b\u6c60\u53c2\u6570\uff1f","text":"<p>\u8981\u60f3\u5408\u7406\u7684\u914d\u7f6e\u7ebf\u7a0b\u6c60\uff0c\u5c31\u5fc5\u987b\u9996\u5148\u5206\u6790\u4efb\u52a1\u7279\u6027\uff0c\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u89d2\u5ea6\u6765\u8fdb\u884c\u5206\u6790\uff1a</p> <ul> <li>\u4efb\u52a1\u7684\u6027\u8d28\uff1aCPU\u5bc6\u96c6\u578b\u4efb\u52a1\uff0cIO\u5bc6\u96c6\u578b\u4efb\u52a1\u548c\u6df7\u5408\u578b\u4efb\u52a1\u3002</li> </ul> <p>\u4efb\u52a1\u6027\u8d28\u4e0d\u540c\u7684\u4efb\u52a1\u53ef\u4ee5\u7528\u4e0d\u540c\u89c4\u6a21\u7684\u7ebf\u7a0b\u6c60\u5206\u5f00\u5904\u7406\u3002CPU\u5bc6\u96c6\u578b\u4efb\u52a1\u914d\u7f6e\u5c3d\u53ef\u80fd\u5c11\u7684\u7ebf\u7a0b\u6570\u91cf\uff0c\u5982\u914d\u7f6e<code>Ncpu+1</code>\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\u3002IO\u5bc6\u96c6\u578b\u4efb\u52a1\u5219\u7531\u4e8e\u9700\u8981\u7b49\u5f85IO\u64cd\u4f5c\uff0c\u7ebf\u7a0b\u5e76\u4e0d\u662f\u4e00\u76f4\u5728\u6267\u884c\u4efb\u52a1\uff0c\u5219\u914d\u7f6e\u5c3d\u53ef\u80fd\u591a\u7684\u7ebf\u7a0b\uff0c\u5982<code>2*Ncpu</code>\u3002\u6df7\u5408\u578b\u7684\u4efb\u52a1\uff0c\u5982\u679c\u53ef\u4ee5\u62c6\u5206\uff0c\u5219\u5c06\u5176\u62c6\u5206\u6210\u4e00\u4e2aCPU\u5bc6\u96c6\u578b\u4efb\u52a1\u548c\u4e00\u4e2aIO\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u53ea\u8981\u8fd9\u4e24\u4e2a\u4efb\u52a1\u6267\u884c\u7684\u65f6\u95f4\u76f8\u5dee\u4e0d\u662f\u592a\u5927\uff0c\u90a3\u4e48\u5206\u89e3\u540e\u6267\u884c\u7684\u541e\u5410\u7387\u8981\u9ad8\u4e8e\u4e32\u884c\u6267\u884c\u7684\u541e\u5410\u7387\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u4efb\u52a1\u6267\u884c\u65f6\u95f4\u76f8\u5dee\u592a\u5927\uff0c\u5219\u6ca1\u5fc5\u8981\u8fdb\u884c\u5206\u89e3\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>Runtime.getRuntime().availableProcessors()</code>\u65b9\u6cd5\u83b7\u5f97\u5f53\u524d\u8bbe\u5907\u7684CPU\u4e2a\u6570\u3002</p> <ul> <li>\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\uff1a\u9ad8\uff0c\u4e2d\u548c\u4f4e\u3002</li> </ul> <p>\u4f18\u5148\u7ea7\u4e0d\u540c\u7684\u4efb\u52a1\u53ef\u4ee5\u4f7f\u7528\u4f18\u5148\u7ea7\u961f\u5217PriorityBlockingQueue\u6765\u5904\u7406\u3002\u5b83\u53ef\u4ee5\u8ba9\u4f18\u5148\u7ea7\u9ad8\u7684\u4efb\u52a1\u5148\u5f97\u5230\u6267\u884c\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u5982\u679c\u4e00\u76f4\u6709\u4f18\u5148\u7ea7\u9ad8\u7684\u4efb\u52a1\u63d0\u4ea4\u5230\u961f\u5217\u91cc\uff0c\u90a3\u4e48\u4f18\u5148\u7ea7\u4f4e\u7684\u4efb\u52a1\u53ef\u80fd\u6c38\u8fdc\u4e0d\u80fd\u6267\u884c\u3002</p> <ul> <li>\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4\uff1a\u957f\uff0c\u4e2d\u548c\u77ed\u3002</li> </ul> <p>\u6267\u884c\u65f6\u95f4\u4e0d\u540c\u7684\u4efb\u52a1\u53ef\u4ee5\u4ea4\u7ed9\u4e0d\u540c\u89c4\u6a21\u7684\u7ebf\u7a0b\u6c60\u6765\u5904\u7406\uff0c\u6216\u8005\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u8ba9\u6267\u884c\u65f6\u95f4\u77ed\u7684\u4efb\u52a1\u5148\u6267\u884c\u3002</p> <ul> <li>\u4efb\u52a1\u7684\u4f9d\u8d56\u6027\uff1a\u662f\u5426\u4f9d\u8d56\u5176\u4ed6\u7cfb\u7edf\u8d44\u6e90\uff0c\u5982\u6570\u636e\u5e93\u8fde\u63a5\u3002</li> </ul> <p>\u4f9d\u8d56\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u7684\u4efb\u52a1\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u63d0\u4ea4SQL\u540e\u9700\u8981\u7b49\u5f85\u6570\u636e\u5e93\u8fd4\u56de\u7ed3\u679c\uff0c\u5982\u679c\u7b49\u5f85\u7684\u65f6\u95f4\u8d8a\u957fCPU\u7a7a\u95f2\u65f6\u95f4\u5c31\u8d8a\u957f\uff0c\u90a3\u4e48\u7ebf\u7a0b\u6570\u5e94\u8be5\u8bbe\u7f6e\u8d8a\u5927\uff0c\u8fd9\u6837\u624d\u80fd\u66f4\u597d\u7684\u5229\u7528CPU\u3002</p> <p>\u5efa\u8bae\u4f7f\u7528\u6709\u754c\u961f\u5217\uff0c\u6709\u754c\u961f\u5217\u80fd\u589e\u52a0\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u9884\u8b66\u80fd\u529b\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u8bbe\u5927\u4e00\u70b9\u3002\u5982\u679c\u6211\u4eec\u8bbe\u7f6e\u6210\u65e0\u754c\u961f\u5217\uff0c\u7ebf\u7a0b\u6c60\u7684\u961f\u5217\u5c31\u4f1a\u8d8a\u6765\u8d8a\u591a\uff0c\u6709\u53ef\u80fd\u4f1a\u6491\u6ee1\u5185\u5b58\uff0c\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u4e0d\u53ef\u7528\uff0c\u800c\u4f7f\u7528\u6709\u754c\u961f\u5217\u53ef\u4ee5\u5728\u961f\u5217\u548c\u7ebf\u7a0b\u6c60\u5168\u6ee1\u7684\u65f6\u5019\u53ef\u4ee5\u629b\u51fa\u629b\u5f03\u4efb\u52a1\u7684\u5f02\u5e38\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u76d1\u63a7\u53d1\u73b0\u95ee\u9898\u5e76\u89e3\u51b3\u3002</p>"},{"location":"front-end/android/concurrency/thread-pool/#531","title":"5.3.1 \u53c2\u6570\u52a8\u6001\u5316","text":"<p>\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u5373\u4f7f\u50cf\u4e0a\u9762\u90a3\u6837\u505a\u4e86\u4efb\u52a1\u7684\u533a\u5206\uff0c\u4ecd\u7136\u4e0d\u80fd\u591f\u4fdd\u8bc1\u4e00\u6b21\u8ba1\u7b97\u51fa\u6765\u5408\u9002\u7684\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u9488\u5bf9\u4e0d\u540c\u6027\u80fd\u7684\u624b\u673a\u548c\u4e0d\u540c\u7684\u4efb\u52a1\u7ebf\u7a0b\u6c60\u52a8\u6001\u4e0b\u53d1\u7ebf\u7a0b\u6c60\u914d\u7f6e\uff1b\u4ece\u800c\u63d0\u9ad8\u7ebf\u7a0b\u6c60\u7684\u7075\u6d3b\u6027;</p> <p>\u7ebf\u7a0b\u6c60\u6784\u9020\u53c2\u6570\u67098\u4e2a\uff0c\u4f46\u662f\u6700\u6838\u5fc3\u7684\u662f3\u4e2a\uff1a<code>corePoolSize</code>\u3001<code>maximumPoolSize</code>\uff0c<code>workQueue</code>\uff0c\u5b83\u4eec\u6700\u5927\u7a0b\u5ea6\u5730\u51b3\u5b9a\u4e86\u7ebf\u7a0b\u6c60\u7684\u4efb\u52a1\u5206\u914d\u548c\u7ebf\u7a0b\u5206\u914d\u7b56\u7565\u3002\u8003\u8651\u5230\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u6211\u4eec\u83b7\u53d6\u5e76\u53d1\u6027\u7684\u573a\u666f\u4e3b\u8981\u662f\u4e24\u79cd\uff1a\uff081\uff09\u5e76\u884c\u6267\u884c\u5b50\u4efb\u52a1\uff0c\u63d0\u9ad8\u54cd\u5e94\u901f\u5ea6\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u4f7f\u7528\u540c\u6b65\u961f\u5217\uff0c\u6ca1\u6709\u4ec0\u4e48\u4efb\u52a1\u5e94\u8be5\u88ab\u7f13\u5b58\u4e0b\u6765\uff0c\u800c\u662f\u5e94\u8be5\u7acb\u5373\u6267\u884c\u3002\uff082\uff09\u5e76\u884c\u6267\u884c\u5927\u6279\u6b21\u4efb\u52a1\uff0c\u63d0\u5347\u541e\u5410\u91cf\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u4f7f\u7528\u6709\u754c\u961f\u5217\uff0c\u4f7f\u7528\u961f\u5217\u53bb\u7f13\u51b2\u5927\u6279\u91cf\u7684\u4efb\u52a1\uff0c\u961f\u5217\u5bb9\u91cf\u5fc5\u987b\u58f0\u660e\uff0c\u9632\u6b62\u4efb\u52a1\u65e0\u9650\u5236\u5806\u79ef\u3002\u6240\u4ee5\u7ebf\u7a0b\u6c60\u53ea\u9700\u8981\u63d0\u4f9b\u8fd9\u4e09\u4e2a\u5173\u952e\u53c2\u6570\u7684\u914d\u7f6e\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e24\u79cd\u961f\u5217\u7684\u9009\u62e9\uff0c\u5c31\u53ef\u4ee5\u6ee1\u8db3\u7edd\u5927\u591a\u6570\u7684\u4e1a\u52a1\u9700\u6c42\uff0cLess is More\u3002</p>"},{"location":"front-end/android/concurrency/thread-pool/#_3","title":"\u53c2\u8003","text":"<p>Java\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u539f\u7406\u53ca\u5176\u5728\u7f8e\u56e2\u4e1a\u52a1\u4e2d\u7684\u5b9e\u8df5 Java\u7ebf\u7a0b\u6c60\u7684\u5206\u6790\u548c\u4f7f\u7528</p>"},{"location":"front-end/android/daily/Android_animation/","title":"Android \u52a8\u753b\u539f\u7406","text":""},{"location":"front-end/android/daily/Android_animation/#1-frame-animation","title":"1. \u9010\u5e27\u52a8\u753b (Frame Animation)","text":"<pre><code>AnimationDrawable animationDrawable = (AnimationDrawable) image.getDrawable();\nanimationDrawable.start();\n</code></pre>"},{"location":"front-end/android/daily/Android_animation/#11","title":"1.1. \u539f\u7406","text":""},{"location":"front-end/android/daily/Android_animation/#2-view","title":"2. View\u52a8\u753b","text":"<pre><code>val anim = TranslateAnimation(0f, 200f, 0f, 0f)\nanim.duration = 1000\nanim.fillAfter = true    // \u8bbe\u7f6e\u4fdd\u7559\u52a8\u753b\u540e\u7684\u72b6\u6001\nimageView.startAnimation(anim)\n</code></pre>"},{"location":"front-end/android/daily/Android_animation/#21","title":"2.1 \u539f\u7406","text":""},{"location":"front-end/android/daily/Android_animation/#3","title":"3. \u5c5e\u6027\u52a8\u753b","text":"<pre><code>ObjectAnimator.ofFloat(imageView, \"translationX\", 0f, 200f)\n.setDuration(1000)\n.start()\n</code></pre>"},{"location":"front-end/android/daily/Android_animation/#31","title":"3.1 \u539f\u7406","text":""},{"location":"front-end/android/daily/Android_animation/#4","title":"4. \u76f8\u5173\u7ec6\u8282\u95ee\u9898","text":"<ul> <li>\u5c5e\u6027\u52a8\u753b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</li> </ul> <p>ValueAnimator.AnimationHandler.doAnimationFrame \u6bcf\u6b21\u6267\u884c\u5b8c\u52a8\u753b\uff08\u5982\u679c\u52a8\u753b\u6ca1\u6709\u7ed3\u675f\uff09\uff0c\u90fd\u5728\u518d\u4e00\u6b21\u8bf7\u6c42Vsync\u540c\u6b65\u4fe1\u53f7\u56de\u8c03\u7ed9\u81ea\u5df1\u3002Choreographer \u7684\u56de\u8c03\u90fdpost\u8fdb\u5165\u4e86\u5f53\u524d\u7ebf\u7a0b\u7684looper\u961f\u5217\u4e2d\u3002mRepeatCount \u65e0\u7a77\u5927\uff0c\u4f1a\u5bfc\u81f4\u8be5\u5faa\u73af\u4f1a\u4e00\u76f4\u6267\u884c\u4e0b\u53bb\uff0c\u5373\u4f7f\u5173\u95ed\u5f53\u524d\u7684\u9875\u9762\u4e5f\u4e0d\u4f1a\u505c\u6b62\u3002\u5bfc\u81f4\u7531\u4e8e\u6301\u6709Activity\u5f15\u7528\u800c\u5bfc\u81f4\u6cc4\u6f0f</p> <ul> <li> <p>\u5e27\u52a8\u753b\u53ef\u80fd\u4f1a\u5bfc\u81f4OOM</p> </li> <li> <p>\u4f7f\u7528\u4e86 <code>TranslateAnimation</code> \u5bf9\u63a7\u4ef6\u505a\u4e86\u79fb\u52a8\u64cd\u4f5c\uff0c\u7136\u540e\u53d1\u73b0\u5728 View \u7684\u65b0\u4f4d\u7f6e\u70b9\u51fb\u5e76\u6ca1\u6709\u54cd\u5e94\u81ea\u5df1\u7684\u70b9\u51fb\u4e8b\u4ef6\uff0c\u53cd\u5012\u662f\u4e4b\u524d\u7684\u4f4d\u7f6e\u80fd\u591f\u54cd\u5e94</p> </li> </ul> <p>\u8865\u95f4\u52a8\u753b\u4ec5\u4ec5\u662f\u5bf9 View \u5728\u89c6\u89c9\u6548\u679c\u4e0a\u505a\u4e86\u79fb\u52a8\u3001\u7f29\u653e\u3001\u65cb\u8f6c\u548c\u6de1\u5165\u6de1\u51fa\u7684\u6548\u679c\uff0c\u5176\u5b9e\u5e76\u6ca1\u6709\u771f\u6b63\u6539\u53d8 View \u7684\u5c5e\u6027</p> <ul> <li>\u4e3a\u4ec0\u4e48\u5c5e\u6027\u52a8\u753b\u79fb\u52a8\u4e00\u4e2a View \u540e\uff0c\u76ee\u6807\u4f4d\u7f6e\u8fd8\u53ef\u4ee5\u54cd\u5e94\u89e6\u6478\u4e8b\u4ef6\u5462\uff1f</li> </ul> <p>\u201c\u65e2\u7136 <code>View</code> \u7684\u5c5e\u6027\u5f97\u5230\u4e86\u6539\u53d8\uff0c\u90a3\u4e48\u7ecf\u8fc7\u5c5e\u6027\u52a8\u753b\u540e\u7684\u63a7\u4ef6\u5e94\u8be5\u6240\u6709\u5c5e\u6027\u90fd\u7b49\u540c\u4e8e\u76f4\u63a5\u8bbe\u7f6e\u5728\u52a8\u753b\u540e\u7684\u4f4d\u7f6e\u7684\u63a7\u4ef6\u3002\u201d\u8fd9\u4e2a\u8bf4\u6cd5\u662f\u9519\u8bef\u7684\u3002</p> <p>\u867d\u7136 <code>View</code> \u505a\u4e86\u5c5e\u6027\u4e0a\u7684\u6539\u53d8\uff0c\u4f46\u5176\u5b9e\u5e76\u6ca1\u6709\u66f4\u6539 <code>View</code> \u7684 <code>left</code>\u3001<code>right</code>\u3001<code>top</code>\u3001<code>bottom</code> \u8fd9\u4e9b\u5c5e\u6027\uff0c\u800c\u8fd9\u4e9b\u5c5e\u6027\u6070\u6070\u51b3\u5b9a\u4e86 <code>ViewGroup</code> \u7684\u89e6\u6478\u533a\u57df\u5224\u65ad\u3002</p> <pre><code>tv1.animate().setDuration(1000).translationX(500f)\n</code></pre> <p>\u90a3\u4e48\uff0c\u5047\u5b9a\u6211\u4eec\u7684 <code>View</code> \u7ecf\u8fc7\u4e86\u4e0a\u9762\u7684\u5e73\u79fb\u64cd\u4f5c\u540e\uff0c\u4e3a\u4ec0\u4e48\u70b9\u51fb\u65b0\u7684\u4f4d\u7f6e\u80fd\u591f\u54cd\u5e94\u5230\u8fd9\u4e2a\u70b9\u51fb\u4e8b\u4ef6\u5462\uff1f</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u5728 <code>ViewGroup</code> \u6ca1\u6709\u91cd\u5199 <code>onInterceptTouchEvent()</code> \u65b9\u6cd5\u8fdb\u884c\u4e8b\u4ef6\u62e6\u622a\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e00\u5b9a\u4f1a\u901a\u8fc7\u5176 <code>dispatchTouchEvent()</code> \u65b9\u6cd5\u8fdb\u884c\u4e8b\u4ef6\u5206\u53d1\uff0c\u800c\u51b3\u5b9a\u6211\u4eec\u54ea\u4e00\u4e2a\u5b50 <code>View</code> \u54cd\u5e94\u6211\u4eec\u7684\u89e6\u6478\u4e8b\u4ef6\u7684\u6761\u4ef6\u53c8\u662f \u6211\u4eec\u624b\u6307\u7684\u4f4d\u7f6e\u5fc5\u987b\u5728\u8fd9\u4e2a\u5b50 <code>View</code> \u7684\u8fb9\u754c\u8303\u56f4\u5185\uff0c\u4e5f\u5c31\u662f <code>left</code>\u3001<code>right</code>\u3001<code>top</code>\u3001<code>bottom</code> \u8fd9\u56db\u4e2a\u5c5e\u6027\u5f62\u6210\u7684\u77e9\u5f62\u533a\u57df\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u679c\u6211\u4eec\u7684 <code>View</code> \u5df2\u7ecf\u8fdb\u884c\u4e86\u5c5e\u6027\u52a8\u753b\u540e\uff0c\u73b0\u5728\u624b\u6307\u54cd\u5e94\u7684\u89e6\u6478\u4f4d\u7f6e\u533a\u57df\u80af\u5b9a\u4e0d\u662f <code>View</code> \u81ea\u5df1\u7684<code>left</code>\u3001<code>right</code>\u3001<code>top</code>\u3001<code>bottom</code> \u8fd9\u56db\u4e2a\u5c5e\u6027\u5f62\u6210\u7684\u533a\u57df\u4e86\uff0c\u4f46\u8fd9\u4e2a <code>View</code> \u5374\u795e\u5947\u7684\u54cd\u5e94\u4e86\u6211\u4eec\u7684\u70b9\u51fb\u4e8b\u4ef6\u3002</p> <pre><code>/**\n * Returns a MotionEvent that's been transformed into the child's local coordinates.\n *\n * It's the responsibility of the caller to recycle it once they're finished with it.\n * @param event The event to transform.\n * @param child The view whose coordinate space is to be used.\n * @return A copy of the the given MotionEvent, transformed into the given View's coordinate\n *         space.\n */\nprivate MotionEvent getTransformedMotionEvent(MotionEvent event, View child) {\nfinal float offsetX = mScrollX - child.mLeft;\nfinal float offsetY = mScrollY - child.mTop;\nfinal MotionEvent transformedEvent = MotionEvent.obtain(event);\ntransformedEvent.offsetLocation(offsetX, offsetY);\nif (!child.hasIdentityMatrix()) {\ntransformedEvent.transform(child.getInverseMatrix());\n}\nreturn transformedEvent;\n}\n/**\n * Returns true if the transform matrix is the identity matrix.\n * Recomputes the matrix if necessary.\n *\n * @return True if the transform matrix is the identity matrix, false otherwise.\n */\nfinal boolean hasIdentityMatrix() {\nreturn mRenderNode.hasIdentityMatrix();\n}\n/**\n * Utility method to retrieve the inverse of the current mMatrix property.\n * We cache the matrix to avoid recalculating it when transform properties\n * have not changed.\n *\n * @return The inverse of the current matrix of this view.\n * @hide\n */\npublic final Matrix getInverseMatrix() {\nensureTransformationInfo();\nif (mTransformationInfo.mInverseMatrix == null) {\nmTransformationInfo.mInverseMatrix = new Matrix();\n}\nfinal Matrix matrix = mTransformationInfo.mInverseMatrix;\nmRenderNode.getInverseMatrix(matrix);\nreturn matrix;\n}   </code></pre> <p>\u539f\u6765\uff0c<code>ViewGroup</code> \u5728 <code>getTransformedMotionEvent()</code> \u65b9\u6cd5\u4e2d\u4f1a\u901a\u8fc7\u5b50 <code>View</code> \u7684 <code>hasIdentityMatrix()</code> \u65b9\u6cd5\u6765\u5224\u65ad\u5b50 <code>View</code> \u662f\u5426\u5e94\u7528\u8fc7\u4f4d\u79fb\u3001\u7f29\u653e\u3001\u65cb\u8f6c\u4e4b\u7c7b\u7684\u5c5e\u6027\u52a8\u753b\u3002\u5982\u679c\u5e94\u7528\u8fc7\u7684\u8bdd\uff0c\u90a3\u8fd8\u4f1a\u8c03\u7528\u5b50 <code>View</code> \u7684 <code>getInverseMatrix()</code> \u505a\u300c\u53cd\u5e73\u79fb\u300d\u64cd\u4f5c\uff0c\u7136\u540e\u518d\u53bb\u5224\u65ad\u5904\u7406\u540e\u7684\u89e6\u6478\u70b9\u662f\u5426\u5728\u5b50 <code>View</code> \u7684\u8fb9\u754c\u8303\u56f4\u5185\u3002</p> <ul> <li>\u8865\u95f4\u52a8\u753b\u548c\u5c5e\u6027\u52a8\u753b\u6539\u53d8\u7684\u662f\u540c\u4e00\u4e2a Matrix \u4e48</li> </ul> <p>\u80af\u5b9a\u4e0d\u662f\u3002</p> <p>\u5c5e\u6027\u52a8\u753b\u6240\u5f71\u54cd\u7684 <code>Matrix</code>\uff0c\u662f\u5728 <code>View</code> \u7684 <code>mRenderNode</code> \u4e2d\u7684 <code>stagingProperties</code> \u91cc\u9762\u7684\uff0c\u8fd9\u4e2a <code>Matrix</code> \u5728\u6bcf\u4e2a <code>View</code> \u4e4b\u95f4\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5404\u81ea\u4fdd\u5b58\u4e0d\u540c\u7684\u53d8\u6362\u72b6\u6001\u3002</p> <p>\u800c\u8865\u95f4\u52a8\u753b\u6240\u64cd\u4f5c\u7684 <code>Matrix</code>\uff0c\u5176\u5b9e\u662f\u501f\u7528\u4e86\u5b83\u7236\u5bb9\u5668\u7684\u4e00\u4e2a\u53eb <code>mChildTransformation</code> \u7684\u5c5e\u6027 ( \u91cc\u9762\u6709 <code>Matrix</code> )\uff0c\u901a\u8fc7 <code>getChildTransformation</code> \u83b7\u5f97\u3002    \u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a <code>ViewGroup</code> \u4e2d\uff0c\u65e0\u8bba\u5b83\u6709\u51e0\u4e2a\u5b50 <code>View</code> \u90fd\u597d\uff0c\u5728\u8fd9\u4e9b\u5b50 <code>View</code> \u64ad\u653e\u8865\u95f4\u52a8\u753b\u7684\u65f6\u5019\uff0c\u90fd\u662f\u5171\u7528\u540c\u4e00\u4e2a <code>Transformation</code> \u5bf9\u8c61\u7684(\u4e5f\u5c31\u662f\u5171\u7528\u4e00\u4e2a <code>Matrix</code> )\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u653e\u5728 <code>ViewGroup</code> \u91cc\u9762\u3002</p>"},{"location":"front-end/android/daily/Android_animation/#_1","title":"\u53c2\u8003","text":"<p>https://www.jianshu.com/p/5d0899dca46e</p> <p>https://www.jianshu.com/p/038472aff2d2</p>"},{"location":"front-end/android/daily/Android_classloader/","title":"Android ClassLoader\u673a\u5236","text":""},{"location":"front-end/android/daily/Android_classloader/#1-jvm","title":"1. \u4f20\u7edfJvm","text":"<p>java\u865a\u62df\u673a\u628a\u63cf\u8ff0\u7c7b\u7684\u6570\u636e\u4eceClass\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u5e76\u5bf9\u6570\u636e\u8fdb\u884c\u6821\u9a8c\u3001\u8f6c\u6362\u89e3\u6790\u548c\u521d\u59cb\u5316\uff0c\u6700\u7ec8\u5f62\u6210\u53ef\u4ee5\u88ab\u865a\u62df\u673a\u76f4\u63a5\u4f7f\u7528\u7684Java\u7c7b\u578b\uff0c\u8fd9\u5c31\u662f\u865a\u62df\u673a\u7684\u7c7b\u52a0\u8f7d\u673a\u5236\u3002 </p>"},{"location":"front-end/android/daily/Android_classloader/#11","title":"1.1 \u7c7b\u7684\u751f\u547d\u5468\u671f","text":"<p>\u7c7b\u4ece\u88ab\u52a0\u8f7d\u5230\u865a\u62df\u673a\u5185\u5b58\u4e2d\u5f00\u59cb\uff0c\u5230\u5378\u8f7d\u51fa\u5185\u5b58\u4e3a\u6b62\uff0c\u5b83\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u5305\u62ec\uff1a\u52a0\u8f7d\uff08Loading\uff09\u3001\u9a8c\u8bc1\uff08Verification\uff09\u3001\u51c6\u5907\uff08Preparation\uff09\u3001\u89e3\u6790\uff08Resolution\uff09\u3001\u521d\u59cb\u5316\uff08Initialization\uff09\u3001\u4f7f\u7528\uff08Using\uff09\u548c\u5378\u8f7d\uff08Unloading\uff097\u4e2a\u9636\u6bb5\u3002\u5176\u4e2d\u9a8c\u8bc1\u3001\u51c6\u5907\u3001\u89e3\u67903\u4e2a\u90e8\u5206\u7edf\u79f0\u4e3a\u8fde\u63a5\uff08Linking)\uff0c\u8fd97\u4e2a\u9636\u6bb5\u7684\u53d1\u751f\u987a\u5e8f\u5982\u56fe\u6240\u793a  </p>"},{"location":"front-end/android/daily/Android_classloader/#12","title":"1.2 \u7c7b\u52a0\u8f7d\u5668","text":"<p>\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u7c7b\uff0c\u90fd\u9700\u8981\u7531\u52a0\u8f7d\u5b83\u7684\u7c7b\u52a0\u8f7d\u5668\u548c\u8fd9\u4e2a\u7c7b\u672c\u8eab\u4e00\u540c\u786e\u7acb\u5176\u5728Java\u865a\u62df\u673a\u4e2d\u7684\u552f\u4e00\u6027\uff0c\u6bcf\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\uff0c\u90fd\u62e5\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u7c7b\u540d\u79f0\u7a7a\u95f4\u3002\u8fd9\u53e5\u8bdd\u53ef\u4ee5\u8868\u8fbe\u5f97\u66f4\u901a\u4fd7\u4e00\u4e9b\uff1a **\u6bd4\u8f83\u4e24\u4e2a\u7c7b\u662f\u5426\u201c\u76f8\u7b49\u201d\uff0c\u53ea\u6709\u5728\u8fd9\u4e24\u4e2a\u7c7b\u662f\u7531\u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u524d\u63d0\u4e0b\u624d\u6709\u610f\u4e49\uff0c\u5426\u5219\uff0c\u5373\u4f7f\u8fd9\u4e24\u4e2a\u7c7b\u6765\u6e90\u4e8e\u540c\u4e00\u4e2aClass\u6587\u4ef6\uff0c\u88ab\u540c\u4e00\u4e2a\u865a\u62df\u673a\u52a0\u8f7d\uff0c\u53ea\u8981\u52a0\u8f7d\u5b83\u4eec\u7684\u7c7b\u52a0\u8f7d\u5668\u4e0d\u540c\uff0c\u90a3\u8fd9\u4e24\u4e2a\u7c7b\u5c31\u5fc5\u5b9a\u4e0d\u76f8\u7b49\u3002 **</p>"},{"location":"front-end/android/daily/Android_classloader/#13","title":"1.3 \u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b","text":"<p>\u7edd\u5927\u90e8\u5206Java\u7a0b\u5e8f\u90fd\u4f1a\u4f7f\u7528\u5230\u4ee5\u4e0b3\u79cd\u7cfb\u7edf\u63d0\u4f9b\u7684\u7c7b\u52a0\u8f7d\u5668: </p> <ul> <li>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff08<code>Bootstrap ClassLoade</code>\uff09 </li> </ul> <p>\u8fd9\u4e2a\u7c7b\u5c06\u5668\u8d1f\u8d23\u5c06\u5b58\u653e\u5728<code>\uff1cJAVA_HOME\uff1e\\lib</code>\u76ee\u5f55\u4e2d\u7684\uff0c\u6216\u8005\u88ab<code>-Xbootclasspath</code>\u53c2\u6570\u6240\u6307\u5b9a\u7684\u8def\u5f84\u4e2d\u7684\uff0c\u5e76\u4e14\u662f\u865a\u62df\u673a\u8bc6\u522b\u7684\uff08\u4ec5\u6309\u7167\u6587\u4ef6\u540d\u8bc6\u522b\uff0c\u5982rt.jar\uff0c\u540d\u5b57\u4e0d\u7b26\u5408\u7684\u7c7b\u5e93\u5373\u4f7f\u653e\u5728lib\u76ee\u5f55\u4e2d\u4e5f\u4e0d\u4f1a\u88ab\u52a0\u8f7d\uff09\u7c7b\u5e93\u52a0\u8f7d\u5230\u865a\u62df\u673a\u5185\u5b58\u4e2d\u3002\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u88abJava\u7a0b\u5e8f\u76f4\u63a5\u5f15\u7528\uff0c\u7528\u6237\u5728\u7f16\u5199\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u65f6\uff0c\u5982\u679c\u9700\u8981\u628a\u52a0\u8f7d\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u5f15\u5bfc\u7c7b\u52a0\u8f7d\u5668\uff0c\u90a3\u76f4\u63a5\u4f7f\u7528null\u4ee3\u66ff\u5373\u53ef\u3002 </p> <ul> <li>\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\uff08<code>Extension ClassLoader</code>\uff09 </li> </ul> <p>\u8fd9\u4e2a\u52a0\u8f7d\u5668\u7531<code>sun.misc.Launcher $ExtClassLoade</code>r\u5b9e\u73b0\uff0c\u5b83\u8d1f\u8d23\u52a0\u8f7d<code>\uff1cJAVA_HOME\uff1e\\lib\\ext</code>\u76ee\u5f55\u4e2d\u7684\uff0c\u6216\u8005\u88ab<code>java.ext.dirs</code>\u7cfb\u7edf\u53d8\u91cf\u6240\u6307\u5b9a\u7684\u8def\u5f84\u4e2d\u7684\u6240\u6709\u7c7b\u5e93\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\u3002 </p> <ul> <li>**\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff08Application ClassLoader\uff09 **</li> </ul> <p>\u8fd9\u4e2a\u7c7b\u52a0\u8f7d\u5668\u7531<code>sun.misc.Launcher $App-ClassLoader</code>\u5b9e\u73b0\u3002\u7531\u4e8e\u8fd9\u4e2a\u7c7b\u52a0\u8f7d\u5668\u662f<code>ClassLoader</code>\u4e2d\u7684<code>getSystemClassLoader\uff08\uff09</code>\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff0c\u6240\u4ee5\u4e00\u822c\u4e5f\u79f0\u5b83\u4e3a\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668\u3002\u5b83\u8d1f\u8d23\u52a0\u8f7d\u7528\u6237\u7c7b\u8def\u5f84\uff08<code>ClassPath</code>\uff09\u4e0a\u6240\u6307\u5b9a\u7684\u7c7b\u5e93\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u52a0\u8f7d\u5668\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u6ca1\u6709\u81ea\u5b9a\u4e49\u8fc7\u81ea\u5df1\u7684\u7c7b\u52a0\u8f7d\u5668\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u8fd9\u4e2a\u5c31\u662f\u7a0b\u5e8f\u4e2d\u9ed8\u8ba4\u7684\u7c7b\u52a0\u8f7d\u5668\u3002 </p> <p>java\u5e94\u7528\u7a0b\u5e8f\u4e00\u822c\u90fd\u662f\u7531\u8fd93\u79cd\u7c7b\u52a0\u8f7d\u5668\u4e92\u76f8\u914d\u5408\u8fdb\u884c\u52a0\u8f7d\u7684\uff0c\u5982\u679c\u6709\u5fc5\u8981\uff0c\u8fd8\u53ef\u4ee5\u52a0\u5165\u81ea\u5df1\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668\u3002\u8fd9\u4e9b\u7c7b\u52a0\u8f7d\u5668\u4e4b\u95f4\u7684\u5173\u7cfb\u4e00\u822c\u5982\u56fe\u6240\u793a\u3002 </p> <p> </p> <p>\u4e0a\u56fe\u4e2d\u5c55\u793a\u7684\u7c7b\u52a0\u8f7d\u5668\u4e4b\u95f4\u7684\u8fd9\u79cd\u5c42\u6b21\u5173\u7cfb\uff0c\u79f0\u4e3a\u7c7b\u52a0\u8f7d\u5668\u7684 \u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\uff08Parents Delegation Model\uff09\u3002\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u8981\u6c42\u9664\u4e86\u9876\u5c42\u7684\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u5916\uff0c\u5176\u4f59\u7684\u7c7b\u52a0\u8f7d\u5668\u90fd\u5e94\u5f53\u6709\u81ea\u5df1\u7684\u7236\u7c7b\u52a0\u8f7d\u5668\u3002\u8fd9\u91cc\u7c7b\u52a0\u8f7d\u5668\u4e4b\u95f4\u7684\u7236\u5b50\u5173\u7cfb\u4e00\u822c\u4e0d\u4f1a\u4ee5\u7ee7\u627f\uff08Inheritance\uff09\u7684\u5173\u7cfb\u6765\u5b9e\u73b0\uff0c\u800c\u662f\u90fd\u4f7f\u7528\u7ec4\u5408\uff08Composition\uff09\u5173\u7cfb\u6765\u590d\u7528\u7236\u52a0\u8f7d\u5668\u7684\u4ee3\u7801\u3002 </p> <p>\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u7684 \u5de5\u4f5c\u8fc7\u7a0b \u662f\uff1a\u5982\u679c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u6536\u5230\u4e86\u7c7b\u52a0\u8f7d\u7684\u8bf7\u6c42\uff0c\u5b83\u9996\u5148\u4e0d\u4f1a\u81ea\u5df1\u53bb\u5c1d\u8bd5\u52a0\u8f7d\u8fd9\u4e2a\u7c7b\uff0c\u800c\u662f\u628a\u8fd9\u4e2a\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\u53bb\u5b8c\u6210\uff0c\u6bcf\u4e00\u4e2a\u5c42\u6b21\u7684\u7c7b\u52a0\u8f7d\u5668\u90fd\u662f\u5982\u6b64\uff0c\u56e0\u6b64\u6240\u6709\u7684\u52a0\u8f7d\u8bf7\u6c42\u6700\u7ec8\u90fd\u5e94\u8be5\u4f20\u9001\u5230\u9876\u5c42\u7684\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u4e2d\uff0c\u53ea\u6709\u5f53\u7236\u52a0\u8f7d\u5668\u53cd\u9988\u81ea\u5df1\u65e0\u6cd5\u5b8c\u6210\u8fd9\u4e2a\u52a0\u8f7d\u8bf7\u6c42\uff08\u5b83\u7684\u641c\u7d22\u8303\u56f4\u4e2d\u6ca1\u6709\u627e\u5230\u6240\u9700\u7684\u7c7b\uff09\u65f6\uff0c\u5b50\u52a0\u8f7d\u5668\u624d\u4f1a\u5c1d\u8bd5\u81ea\u5df1\u53bb\u52a0\u8f7d\u3002 </p>"},{"location":"front-end/android/daily/Android_classloader/#2-androidclassloader","title":"2. Android\u7684ClassLoader\u673a\u5236","text":"<p>\u672c\u8d28\u4e0a\uff0cAndroid\u548c\u4f20\u7edf\u7684JVM\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u9700\u8981\u901a\u8fc7ClassLoader \u5c06\u76ee\u6807\u7c7b\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u7c7b\u52a0\u8f7d\u5668\u4e4b\u95f4\u4e5f\u7b26\u5408\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\uff0c\u7c7b\u4e5f\u6709\u5bf9\u5e94\u7684\u751f\u547d\u5468\u671f\u3002\u4f46\u57fa\u4e8e\u79fb\u52a8\u8bbe\u5907\u7684\u7279\u70b9\uff0c\u5982\u5185\u5b58\u4ee5\u53ca\u7535\u91cf\u7b49\u8bf8\u591a\u65b9\u9762\u8ddf\u4e00\u822c\u7684 PC \u8bbe\u5907\u90fd\u6709\u672c\u8d28\u7684\u533a\u522b\uff0cGoogle\u5f00\u53d1\u4e86\u66f4\u7b26\u5408\u79fb\u52a8\u8bbe\u5907\u7684\u7528\u4e8e\u6267\u884c Java \u4ee3\u7801\u7684\u865a\u62df\u673a\uff0c\u4e5f\u5c31\u662fDalvik\u548c ART\uff0cAndroid\u4ece5.0\u5f00\u59cb\u5c31\u91c7\u7528AR\u865a\u62df\u673a\u66ff\u4ee3Dalvik\u3002</p> <p>\u4f20\u7edfJvm\u4e3b\u8981\u662f\u901a\u8fc7\u8bfb\u53d6class\u5b57\u8282\u7801\u6765\u52a0\u8f7d, \u800cART\u5219\u662f\u4ecedex\u5b57\u8282\u7801\u6765\u8bfb\u53d6. \u8fd9\u662f\u4e00\u79cd\u66f4\u4e3a\u4f18\u5316\u7684\u65b9\u6848, \u53ef\u4ee5\u5c06\u591a\u4e2a.class\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2aclasses.dex\u6587\u4ef6\u3002</p>"},{"location":"front-end/android/daily/Android_classloader/#21-android-classloader","title":"2.1 Android Classloader\u79cd\u7c7b","text":""},{"location":"front-end/android/daily/Android_classloader/#211-basedexclassloader","title":"2.1.1 BaseDexClassLoader","text":"<pre><code>public class BaseDexClassLoader extends ClassLoader {\nprivate final DexPathList pathList; //\u8bb0\u5f55dex\u6587\u4ef6\u8def\u5f84\u4fe1\u606f\npublic BaseDexClassLoader(String dexPath, File optimizedDirectory,\nString librarySearchPath, ClassLoader parent) {\nsuper(parent);\nthis.pathList = new DexPathList(this, dexPath, librarySearchPath, null);\n}\n@Override\nprotected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {\n...\n...\nClass c = pathList.findClass(name, suppressedExceptions);\n...\n...\nreturn c;\n}\n@Override\nprotected URL findResource(String name) {\nreturn pathList.findResource(name);\n}\n@Override\npublic String findLibrary(String name) {\nreturn pathList.findLibrary(name);\n}\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5728\u6784\u9020\u51fd\u6570\u91cc\u521d\u59cb\u5316\u4e86DexPathList\u5bf9\u8c61\uff0c\u800c\u5728BaseDexClassLoader\u4e2d\u7684\u64cd\u4f5c<code>findClass</code>\u3001<code>findResource</code>\u6267\u884c\u7684\u90fd\u662f\u8fd9\u4e2aDexPathList\u5bf9\u8c61\u7684\u64cd\u4f5c</p> <p>\u4eceDexPathList\u7684\u6784\u9020\u8fc7\u7a0b\u53ef\u4ee5\u770b\u5230\uff0c\u65e0\u8bbaoptimizedDirectory\u662f\u4f55\u503c\uff0c\u4f20\u9012\u7ed9DexPathList\u90fd\u662f\u7a7a\uff0c\u6240\u4ee5optimizedDirectory\u53c2\u6570\u662f\u65e0\u6548\u7684\uff08\u4eceAndroid8.0\u5f00\u59cb\uff09</p> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>dexPath: \u5305\u542b\u76ee\u6807\u7c7b\u6216\u8d44\u6e90\u7684apk/jar\u5217\u8868;\u5f53\u6709\u591a\u4e2a\u8def\u5f84\u5219\u91c7\u7528:\u5206\u5272;</li> <li>optimizedDirectory: \u4f18\u5316\u540edex\u6587\u4ef6\u5b58\u5728\u7684\u76ee\u5f55, \u53ef\u4ee5\u4e3anull;</li> <li>libraryPath: native\u5e93\u6240\u5728\u8def\u5f84\u5217\u8868;\u5f53\u6709\u591a\u4e2a\u8def\u5f84\u5219\u91c7\u7528:\u5206\u5272;</li> <li>ClassLoader:\u7236\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668.</li> </ul>"},{"location":"front-end/android/daily/Android_classloader/#212-pathclassloader","title":"2.1.2 PathClassLoader","text":"<pre><code>public class PathClassLoader extends BaseDexClassLoader {\npublic PathClassLoader(String dexPath, ClassLoader parent) {\nsuper(dexPath, null, null, parent);\n}\npublic PathClassLoader(String dexPath, String librarySearchPath, ClassLoader parent) {\nsuper(dexPath, null, librarySearchPath, parent);\n}\n}\n</code></pre> <p>PathClassLoader\u6bd4\u8f83\u7b80\u5355, \u7ee7\u627f\u4e8eBaseDexClassLoader. \u9ed8\u8ba4 optimizedDirectory=null.</p>"},{"location":"front-end/android/daily/Android_classloader/#213-dexclassloader","title":"2.1.3 DexClassLoader","text":"<pre><code>public class DexClassLoader extends BaseDexClassLoader {\npublic DexClassLoader(String dexPath, String optimizedDirectory,\nString librarySearchPath, ClassLoader parent) {\nsuper(dexPath, null, librarySearchPath, parent);\n}\n}\n</code></pre> <p>DexClassLoader\u4e5f\u6bd4\u8f83\u7b80\u5355, \u53ea\u662f\u7b80\u5355\u5c01\u88c5,\u548cPathClassLoader\u552f\u4e00\u533a\u522b\u5c31\u662f\u591a\u4e86optimizedDirectory\u53c2\u6570\uff0c\u4f46\u4ece\u4e0a\u9762<code>BaseDexClassLoader</code>\u5206\u6790\u53ef\u4ee5\u77e5\u9053\uff0c\u4ece8.0\u5f00\u59cboptimizedDirectory\u5df2\u7ecf\u5f03\u7528\u3002\u4ece\u7406\u8bba\u4e0a\u6765\u8bf4\uff0cPathClassLoader\u5e94\u8be5\u53ef\u4ee5\u5b8c\u5168\u66ff\u4ee3DexClassLoader\u3002\u4f46\u7f51\u4e0a\u6709\u8fd9\u6837\u7684\u7ed3\u8bba\uff1a</p> <p>DexClassLoader\uff1a\u80fd\u591f\u52a0\u8f7d\u672a\u5b89\u88c5\u7684apk PathClassLoader\uff1a\u53ea\u80fd\u52a0\u8f7d\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u5b89\u88c5\u8fc7\u7684apk</p> <p>\u90a3\u4e48\u57288.0\u4ee5\u4e0a\u8fd9\u4e2a\u7ed3\u8bba\u8fd8\u6210\u7acb\u5417\uff0c\u4e8b\u5b9e\u4e0aPathClassLoader\u4e5f\u53ef\u4ee5\u52a0\u8f7d\u672a\u5b89\u88c5\u7684apk\uff0c\u9a8c\u8bc1\u8fc7\u7a0b\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0d\u5728\u6b64\u7d2f\u8d58\u3002</p> <p>BootClassLoader\uff1aAndroid\u7cfb\u7edf\u542f\u52a8\u65f6\u4f1a\u4f7f\u7528BootClassLoader\u6765\u9884\u52a0\u8f7d\u5e38\u7528\u7c7b\uff0c\u4e0eJava\u4e2d\u7684Bootstrap ClassLoader\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u5e76\u4e0d\u662f\u7531C/C++\u4ee3\u7801\u5b9e\u73b0\uff0c\u800c\u662f\u7531Java\u5b9e\u73b0\u7684\u3002BootClassLoader\u662fClassLoader\u7684\u4e00\u4e2a\u5185\u90e8\u7c7b\u3002</p>"},{"location":"front-end/android/daily/Android_classloader/#22","title":"2.2 \u7c7b\u52a0\u8f7d\u8fc7\u7a0b","text":"<p>\u7c7b\u52a0\u8f7d\u7ecf\u8fc7\u4e00\u7cfb\u5217\u524d\u7f6e\u8c03\u7528\u4f1a\u8d70\u5230<code>ClassLoader#loadClass</code>:</p> <pre><code>public abstract class ClassLoader {\npublic Class&lt;?&gt; loadClass(String className) throws ClassNotFoundException {\nreturn loadClass(className, false);\n}\nprotected Class&lt;?&gt; loadClass(String className, boolean resolve) throws ClassNotFoundException {\n//\u5224\u65ad\u5f53\u524d\u7c7b\u52a0\u8f7d\u5668\u662f\u5426\u5df2\u7ecf\u52a0\u8f7d\u8fc7\u6307\u5b9a\u7c7b\uff0c\u82e5\u5df2\u52a0\u8f7d\u5219\u76f4\u63a5\u8fd4\u56de\nClass&lt;?&gt; clazz = findLoadedClass(className);\nif (clazz == null) { //\u5982\u679c\u6ca1\u6709\u52a0\u8f7d\u8fc7\uff0c\u5219\u8c03\u7528parent\u7684\u7c7b\u52a0\u8f7d\u9012\u5f52\u52a0\u8f7d\u8be5\u7c7b\uff0c\u82e5\u5df2\u52a0\u8f7d\u5219\u76f4\u63a5\u8fd4\u56de\nclazz = parent.loadClass(className, false);\nif (clazz == null) {\n//\u8fd8\u6ca1\u52a0\u8f7d\uff0c\u5219\u8c03\u7528\u5f53\u524d\u7c7b\u52a0\u8f7d\u5668\u6765\u52a0\u8f7d\nclazz = findClass(className);\n}\n}\nreturn clazz;\n}\n}\n</code></pre> <pre><code>public class BaseDexClassLoader extends ClassLoader {\nprotected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {\nClass c = pathList.findClass(name, suppressedExceptions);\n...\nreturn c;\n}\n}\n</code></pre> <p>\u6700\u540e\u4f1a\u8c03\u7528\u5230<code>DexPathList.findClass</code></p> <pre><code>public Class findClass(String name, List&lt;Throwable&gt; suppressed) {\nfor (Element element : dexElements) {\nDexFile dex = element.dexFile;\nif (dex != null) {\n//\u627e\u5230\u76ee\u6807\u7c7b\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\nClass clazz = dex.loadClassBinaryName(name, definingContext, suppressed);\nif (clazz != null) {\nreturn clazz;\n}\n}\n}\nreturn null;\n}\n</code></pre> <p>\u8fd9\u91cc\u662f \u6838\u5fc3\u903b\u8f91\uff0c\u4e00\u4e2aClassloader\u53ef\u4ee5\u5305\u542b\u591a\u4e2adex\u6587\u4ef6\uff0c\u6bcf\u4e2adex\u6587\u4ef6\u88ab\u5c01\u88c5\u5230\u4e00\u4e2aElement\u5bf9\u8c61\uff0c\u8fd9\u4e9bElement\u5bf9\u8c61\u6392\u5217\u6210\u6709\u5e8f\u7684\u6570\u7ec4 dexElements\u3002\u5f53\u67e5\u627e\u67d0\u4e2a\u7c7b\u65f6\uff0c\u4f1a\u904d\u5386\u6240\u6709\u7684dex\u6587\u4ef6\uff0c\u5982\u679c\u627e\u5230\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u4e0d\u518d\u7ee7\u7eed\u904d\u5386dexElements\u3002\u4e5f\u5c31\u662f\u8bf4\u5f53\u4e24\u4e2a\u7c7b\u4e0d\u540c\u7684dex\u4e2d\u51fa\u73b0\uff0c\u4f1a\u4f18\u5148\u5904\u7406\u6392\u5728\u524d\u9762\u7684dex\u6587\u4ef6\uff0c\u8fd9\u4fbf\u662f\u70ed\u4fee\u590d\u7684\u6838\u5fc3\u7cbe\u9ad3\uff0c\u5c06\u9700\u8981\u4fee\u590d\u7684\u7c7b\u6240\u6253\u5305\u7684dex\u6587\u4ef6\u63d2\u5165\u5230dexElements\u524d\u9762\u3002</p>"},{"location":"front-end/android/daily/Android_classloader/#_1","title":"\u53c2\u8003","text":"<p>Android\u7c7b\u52a0\u8f7d\u5668</p>"},{"location":"front-end/android/daily/apk_analyze/","title":"APK \u6587\u4ef6\u5206\u6790","text":""},{"location":"front-end/android/daily/apk_analyze/#_1","title":"\u6982\u8ff0","text":"<p>\u6211\u4eec\u901a\u8fc7 Android studio APK  Analyze \u53ef\u4ee5\u5c55\u5f00\u4e00\u4e2aAPK\u6587\u4ef6 </p> <ul> <li>META-INF</li> <li>res</li> <li>anim</li> <li>color</li> <li>drawable</li> <li>drawable-hdpi</li> <li>drawable-land</li> <li>drawable-land-hdpi</li> <li>drawable-mdpi</li> <li>drawable-port</li> <li>drawable-port-hdpi</li> <li>layout</li> <li>layout-land</li> <li>layout-port</li> <li>xml</li> <li>AndroidManifest.xml</li> <li>classes.dex</li> <li>resources.arsc</li> </ul>"},{"location":"front-end/android/daily/apk_analyze/#meta-inf","title":"META-INF","text":"<p>META-INF\u76ee\u5f55\u4e0b\u5b58\u653e\u7684\u662f\u7b7e\u540d\u4fe1\u606f\uff0c\u7528\u6765\u4fdd\u8bc1apk\u5305\u7684\u5b8c\u6574\u6027\u548c\u7cfb\u7edf\u7684\u5b89\u5168\u3002\u91cc\u9762\u5305\u542b\u4e86\u4e09\u4e2a\u6587\u4ef6\uff0cMANIFEST.MF\u3001CERT.SF\u3001CERT.RSA\u3002 </p> <ul> <li>MANIFEST.MF</li> </ul> <p>apk\u4e2d\u7684\u8fd9\u4e2aMANIFEST.MF\uff0c\u5217\u51fa\u4e86apk\u7684\u6240\u6709\u6587\u4ef6\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u6587\u4ef6\u5185\u5bb9\u6240\u5bf9\u5e94\u7684base64-encoded SHA1 \u54c8\u5e0c\u503c\uff0c</p> <pre><code>Name: classes.dex\nSHA1-Digest: l8Lc+gtdLvtxJ1K+kscUmWQGQ1E=\n</code></pre> <p>\u4e0a\u8ff0\u8868\u793aclasses.dex\u8fd9\u4e2a\u6587\u4ef6\u7684SHA1\u7684\u54c8\u5e0c\u503c\u4e3al8Lc+gtdLvtxJ1K+kscUmWQGQ1E=</p> <ul> <li>CERT.SF</li> </ul> <p>CERT.SF\u548cMANIFEST.MF\u5f88\u76f8\u4f3c\uff0c\u4f46\u662f\u5b83\u63cf\u8ff0\u7684\u4e0d\u662f\u6587\u4ef6\u5185\u5bb9\u7684hash\u503c\uff0c\u800c\u662f\u5217\u51fa\u4e86MANIFEST.MF\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u6bcf\u6761\u4fe1\u606f\u7684hash\u503c\uff0c\u4e3e\u4f8b\u4f1a\u660e\u767d\u4e9b\uff1a</p> <pre><code>Name: classes.dex\nSHA1-Digest: ubmMiUS24rU/6K5JloMVG4vHKIU=\n</code></pre> <p>\u4e0a\u9762\u8fd9\u6761hash\u503c<code>ubmMiUS24rU/6K5JloMVG4vHKIU=</code>\u5bf9\u5e94\u7684\u662fMANIFEST.MF\u4e2d\u4e0b\u9762\u8fd9\u51e0\u884c\u5b57\u7b26\u4e32\u7684hash\u503c</p> <pre><code>Name: classes.dex\nSHA1-Digest: l8Lc+gtdLvtxJ1K+kscUmWQGQ1E=\n</code></pre> <p>\u6ce8\uff1a\u8ba1\u7b97SHA1-Digest-Manifest\u65f6\uff0c\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u662f\u4e09\u884c\uff0c\u8fd8\u8981\u5305\u62ec\u4e00\u884c\u7a7a\u767d\u884c\uff0c\u5373\u2019\\r\\n\u2019\u3002\uff01</p> <ul> <li>CERT.RSA</li> </ul> <p>\u5305\u542b\u4e86\u516c\u94a5\u548c\u79c1\u94a5\u7b7e\u540d\u540e\u7684\u4e00\u4e9b\u4fe1\u606f  \u5b83\u7684\u57fa\u672c\u683c\u5f0f\u662f\u8fd9\u6837\u7684\uff1a  </p>"},{"location":"front-end/android/daily/apk_analyze/#res","title":"res\u76ee\u5f55","text":"<p>res\u76ee\u5f55\u5b58\u653e\u8d44\u6e90\u6587\u4ef6</p> \u76ee\u5f55 \u8d44\u6e90\u7c7b\u578b <code>animator/</code> \u7528\u4e8e\u5b9a\u4e49\u5c5e\u6027\u52a8\u753b\u7684 XML \u6587\u4ef6\u3002 <code>anim/</code> \u5b9a\u4e49\u6e10\u53d8\u52a8\u753b\u7684 XML \u6587\u4ef6\u3002\uff08\u5c5e\u6027\u52a8\u753b\u4e5f\u53ef\u4ee5\u4fdd\u5b58\u5728\u6b64\u76ee\u5f55\u4e2d\uff0c\u4f46\u662f\u4e3a\u4e86\u533a\u5206\u8fd9\u4e24\u79cd\u7c7b\u578b\uff0c\u5c5e\u6027\u52a8\u753b\u9996\u9009 <code>animator/</code> \u76ee\u5f55\u3002\uff09 <code>color/</code> \u7528\u4e8e\u5b9a\u4e49\u989c\u8272\u72b6\u6001\u5217\u8868\u7684 XML \u6587\u4ef6\u3002\u8bf7\u53c2\u9605\u989c\u8272\u72b6\u6001\u5217\u8868\u8d44\u6e90 <code>drawable/</code> \u4f4d\u56fe\u6587\u4ef6\uff08<code>.png</code>\u3001<code>.9.png</code>\u3001<code>.jpg</code>\u3001<code>.gif</code>\uff09\u6216\u7f16\u8bd1\u4e3a\u4ee5\u4e0b\u53ef\u7ed8\u5236\u5bf9\u8c61\u8d44\u6e90\u5b50\u7c7b\u578b\u7684 XML \u6587\u4ef6\uff1a\u4f4d\u56fe\u6587\u4ef6\u4e5d\u5bab\u683c\uff08\u53ef\u8c03\u6574\u5927\u5c0f\u7684\u4f4d\u56fe\uff09\u72b6\u6001\u5217\u8868\u5f62\u72b6\u52a8\u753b\u53ef\u7ed8\u5236\u5bf9\u8c61\u5176\u4ed6\u53ef\u7ed8\u5236\u5bf9\u8c61\u8bf7\u53c2\u9605 \u53ef\u7ed8\u5236\u5bf9\u8c61\u8d44\u6e90\u3002 <code>mipmap/</code> \u9002\u7528\u4e8e\u4e0d\u540c\u542f\u52a8\u5668\u56fe\u6807\u5bc6\u5ea6\u7684\u53ef\u7ed8\u5236\u5bf9\u8c61\u6587\u4ef6\u3002\u5982\u9700\u4e86\u89e3\u6709\u5173\u4f7f\u7528 <code>mipmap/</code> \u6587\u4ef6\u5939\u7ba1\u7406\u542f\u52a8\u5668\u56fe\u6807\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u7ba1\u7406\u9879\u76ee\u6982\u89c8\u3002 <code>layout/</code> \u7528\u4e8e\u5b9a\u4e49\u7528\u6237\u754c\u9762\u5e03\u5c40\u7684 XML \u6587\u4ef6\u3002 \u8bf7\u53c2\u9605\u5e03\u5c40\u8d44\u6e90\u3002 <code>menu/</code> \u7528\u4e8e\u5b9a\u4e49\u5e94\u7528\u83dc\u5355\uff08\u5982\u9009\u9879\u83dc\u5355\u3001\u4e0a\u4e0b\u6587\u83dc\u5355\u6216\u5b50\u83dc\u5355\uff09\u7684 XML \u6587\u4ef6\u3002\u8bf7\u53c2\u9605\u83dc\u5355\u8d44\u6e90\u3002 <code>raw/</code> \u8981\u4ee5\u539f\u59cb\u5f62\u5f0f\u4fdd\u5b58\u7684\u4efb\u610f\u6587\u4ef6\u3002\u8981\u4f7f\u7528\u539f\u59cb <code>InputStream</code> \u6253\u5f00\u8fd9\u4e9b\u8d44\u6e90\uff0c\u8bf7\u4f7f\u7528\u8d44\u6e90 ID\uff08\u5373 <code>R.raw.*filename*</code>\uff09\u8c03\u7528 <code>Resources.openRawResource()</code>\u3002\u4f46\u662f\uff0c\u5982\u9700\u8bbf\u95ee\u539f\u59cb\u6587\u4ef6\u540d\u548c\u6587\u4ef6\u5c42\u6b21\u7ed3\u6784\uff0c\u5219\u53ef\u4ee5\u8003\u8651\u5c06\u67d0\u4e9b\u8d44\u6e90\u4fdd\u5b58\u5728 <code>assets/</code> \u76ee\u5f55\u4e0b\uff08\u800c\u4e0d\u662f <code>res/raw/</code>\uff09\u3002<code>assets/</code> \u4e2d\u7684\u6587\u4ef6\u6ca1\u6709\u8d44\u6e90 ID\uff0c\u56e0\u6b64\u60a8\u53ea\u80fd\u4f7f\u7528 <code>AssetManager</code> \u8bfb\u53d6\u8fd9\u4e9b\u6587\u4ef6\u3002 <code>values/</code> \u5305\u542b\u5b57\u7b26\u4e32\u3001\u6574\u578b\u6570\u548c\u989c\u8272\u7b49\u7b80\u5355\u503c\u7684 XML \u6587\u4ef6\u3002\u5176\u4ed6 <code>res/</code> \u5b50\u76ee\u5f55\u4e2d\u7684 XML \u8d44\u6e90\u6587\u4ef6\u662f\u6839\u636e XML \u6587\u4ef6\u540d\u5b9a\u4e49\u5355\u4e2a\u8d44\u6e90\uff0c\u800c <code>values/</code> \u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u53ef\u63cf\u8ff0\u591a\u4e2a\u8d44\u6e90\u3002\u5bf9\u4e8e\u6b64\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff0c<code>&lt;resources&gt;</code> \u5143\u7d20\u7684\u6bcf\u4e2a\u5b50\u5143\u7d20\u5747\u5b9a\u4e49\u4e00\u4e2a\u8d44\u6e90\u3002\u4f8b\u5982\uff0c<code>&lt;string&gt;</code> \u5143\u7d20\u521b\u5efa <code>R.string</code> \u8d44\u6e90\uff0c<code>&lt;color&gt;</code> \u5143\u7d20\u521b\u5efa <code>R.color</code> \u8d44\u6e90\u3002\u7531\u4e8e\u6bcf\u4e2a\u8d44\u6e90\u5747\u7528\u5176\u81ea\u5df1\u7684 XML \u5143\u7d20\u5b9a\u4e49\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u547d\u540d\u6587\u4ef6\uff0c\u5e76\u5c06\u4e0d\u540c\u7684\u8d44\u6e90\u7c7b\u578b\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002\u4f46\u662f\uff0c\u4e3a\u4e86\u6e05\u6670\u8d77\u89c1\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5c06\u72ec\u7279\u7684\u8d44\u6e90\u7c7b\u578b\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e\u53ef\u5728\u6b64\u76ee\u5f55\u4e2d\u521b\u5efa\u7684\u8d44\u6e90\uff0c\u4e0b\u9762\u7ed9\u51fa\u4e86\u76f8\u5e94\u7684\u6587\u4ef6\u540d\u7ea6\u5b9a\uff1aarrays.xml\uff0c\u7528\u4e8e\u8d44\u6e90\u6570\u7ec4\uff08\u7c7b\u578b\u5316\u6570\u7ec4\uff09\u3002colors.xml\uff1a\u989c\u8272\u503c\u3002dimens.xml\uff1a\u5c3a\u5bf8\u503c\u3002strings.xml\uff1a\u5b57\u7b26\u4e32\u503c\u3002styles.xml\uff1a\u6837\u5f0f\u3002\u8bf7\u53c2\u9605\u5b57\u7b26\u4e32\u8d44\u6e90\u3001\u6837\u5f0f\u8d44\u6e90\u548c\u66f4\u591a\u8d44\u6e90\u7c7b\u578b\u3002 <code>xml/</code> \u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u901a\u8fc7\u8c03\u7528 <code>Resources.getXML()</code> \u8bfb\u53d6\u7684\u4efb\u610f XML \u6587\u4ef6\u3002\u5404\u79cd XML \u914d\u7f6e\u6587\u4ef6\uff08\u5982\u53ef\u641c\u7d22\u914d\u7f6e\uff09\u90fd\u5fc5\u987b\u4fdd\u5b58\u5728\u6b64\u5904\u3002"},{"location":"front-end/android/daily/apk_analyze/#resourcesarsc","title":"resources.arsc","text":"<p>\u7f16\u8bd1\u540e\u7684\u4e8c\u8fdb\u5236\u8d44\u6e90\u6587\u4ef6\uff0c\u4e3b\u8981\u4f5c\u7528\u662fApp\u7684\u8d44\u6e90\u7d22\u5f15\u8868\uff0c\u53ef\u4ee5\u4ece\u4e8c\u8fdb\u5236\u7684\u6587\u4ef6\u4e2d\u67e5\u627e\u5230\u8d44\u6e90\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u6216\u8005\u6839\u636e\u8d44\u6e90\u7684id\u53ef\u4ee5\u5b9a\u4f4d\u5230\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u7684\u4f4d\u7f6e</p>"},{"location":"front-end/android/daily/apk_analyze/#classesdex","title":"classes.dex\u6587\u4ef6","text":"<p>\u7b80\u5355\u6765\u8bf4\u5c31\u662fandroid\u7cfb\u7edf\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7c7b\u4f3c\u4e8ewindow\u7cfb\u7edf\u7684xx.exe,\u5b83\u5305\u542b\u5e94\u7528\u7a0b\u5e8f\u7684\u5168\u90e8\u64cd\u4f5c\u6307\u4ee4\u4ee5\u53ca\u8fd0\u884c\u65f6\u6570\u636e</p>"},{"location":"front-end/android/daily/apk_analyze/#art-dalvik","title":"\u9898\u5916\uff1aART \u548c Dalvik","text":"<p>\u6211\u4eec\u77e5\u9053Java\u7a0b\u5e8f\u90fd\u662f\u901a\u8fc7Java\u865a\u62df\u673a\u6267\u884c\u7684\uff0cAndroid\u5e94\u7528\u662f\u91c7\u7528Java\u5f00\u53d1\u7684\uff0c\u57fa\u4e8e\u79fb\u52a8\u8bbe\u5907\u7684\u7279\u70b9\uff0c\u5982\u5185\u5b58\u4ee5\u53ca\u7535\u91cf\u7b49\u8bf8\u591a\u65b9\u9762\u8ddf\u4e00\u822c\u7684 PC \u8bbe\u5907\u90fd\u6709\u672c\u8d28\u7684\u533a\u522b\uff0c\u6240\u4ee5\u9700\u8981\u5f00\u53d1\u66f4\u7b26\u5408\u79fb\u52a8\u8bbe\u5907\u7684\u7528\u4e8e\u6267\u884c Java \u4ee3\u7801\u7684\u865a\u62df\u673a\uff0c\u4e5f\u5c31\u662fDalvik\u548c ART\u3002 Dalvik\u548c ART \u5e76\u4e0d\u662f\u5b8c\u5168\u6309\u7167JVM\u7684\u89c4\u8303\u5f00\u53d1\u7684\uff0c\u4e00\u822cJVM\u865a\u62df\u673a\u8fd0\u884c\u7684\u662f .class \u6587\u4ef6\uff0c\u800c Dalvik\u548c ART \u8fd0\u884c\u7684\u662fDEX\u6587\u4ef6\u3002</p> <p>Java \u865a\u62df\u673a\u6267\u884c .class \u683c\u5f0f\u7684\u5b57\u8282\u7801\u3002\u6bcf\u4e00\u4e2a Java \u6587\u4ef6\u5bf9\u5e94\u4e00\u4e2a .class \u7684\u5b57\u8282\u7801\u6587\u4ef6\uff0cJVM \u5728\u8fd0\u884c\u65f6\u4e3a\u6bcf\u4e00\u4e2a\u6267\u884c\u5230\u7684\u7c7b\u88c5\u8f7d\u5b57\u8282\u7801\u3002\u800c Android \u8bbe\u5907\u4e0a\u4e3a\u4e86\u63d0\u9ad8\u6267\u884c\u6548\u7387\uff0c\u5728\u7f16\u8bd1 Android \u9879\u76ee\u65f6\uff0cAndroid \u901a\u8fc7 SDK \u63d0\u4f9b\u7684\u5de5\u5177 dex.jar \u4f1a\u628a\u6240\u6709\u7684 .class \u6587\u4ef6\u6700\u7ec8\u6253\u5305\u6210\u4e00\u4e2a\u6216\u8005\u591a\u4e2a .dex \u6587\u4ef6</p>"},{"location":"front-end/android/daily/apk_analyze/#art-dalvik_1","title":"ART \u548c Dalvik \u533a\u522b","text":"<p>Dalvik \u662f ART \u7684\u524d\u8eab \uff0c\u4ece Android L \u5f00\u59cb\uff0cAndroid \u5f00\u59cb\u542f\u7528\u4e86\u65b0\u8bbe\u8ba1\u7684\u865a\u62df\u673a ART \u3002 ART \u6bd4\u8d77 Dalvik \u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a</p> <ul> <li>\u9884\u5148 (AOT) \u7f16\u8bd1</li> </ul> <p>ART \u5f15\u5165\u4e86\u9884\u5148\u7f16\u8bd1\u673a\u5236\uff0c\u53ef\u63d0\u9ad8\u5e94\u7528\u7684\u6027\u80fd\u3002\u5728\u5b89\u88c5\u65f6\uff0cART \u4f7f\u7528\u8bbe\u5907\u81ea\u5e26\u7684 <code>dex2oat</code> \u5de5\u5177\u6765\u7f16\u8bd1\u5e94\u7528\uff0c\u5e76\u4e3a\u76ee\u6807\u8bbe\u5907\u751f\u6210\u7ecf\u8fc7\u7f16\u8bd1\u7684\u5e94\u7528\u53ef\u6267\u884c\u6587\u4ef6</p> <ul> <li>\u5783\u573e\u56de\u6536\u65b9\u9762\u7684\u4f18\u5316</li> </ul> <p>\u6211\u4eec\u77e5\u9053**\u6267\u884cGC\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4efb\u4f55\u7ebf\u7a0b\u7684\u4efb\u4f55\u64cd\u4f5c\u90fd\u4f1a\u9700\u8981\u6682\u505c\uff0c\u7b49\u5f85GC\u64cd\u4f5c\u5b8c\u6210\u4e4b\u540e\uff0c\u5176\u4ed6\u64cd\u4f5c\u624d\u80fd\u591f\u7ee7\u7eed\u8fd0\u884c**\uff0c\u6240\u4ee5GC\u5728 Dalvik \u65f6\u4ee3\u4e5f\u662f\u7ecf\u5e38\u88ab\u4eba\u8bdf\u75c5\u7684\uff0c\u5b83\u4f1a\u5bfc\u81f4\u754c\u9762\u5361\u987f\u3002\u800cART \u5728GC\u5bfc\u81f4\u663e\u793a\u4e0d\u7a33\u5b9a\u3001\u754c\u9762\u54cd\u5e94\u901f\u5ea6\u7f13\u6162\u4ee5\u53ca\u5176\u4ed6\u95ee\u9898\u90fd\u505a\u4e86\u4f18\u5316</p>"},{"location":"front-end/android/daily/apk_analyze/#_2","title":"\u53c2\u8003","text":"<p>android\u4e2d\u7b7e\u540d\u539f\u7406\u548c\u5b89\u5168\u6027\u5206\u6790\u4e4bmeta-inf\u6587\u4ef6\u8bb2\u89e3 https://source.android.com/devices/tech/dalvik</p>"},{"location":"front-end/android/daily/binder/","title":"\u89e3\u6790Binder\u6846\u67b6","text":""},{"location":"front-end/android/daily/binder/#_1","title":"\u7b2c\u4e00\u8282:\u4e86\u89e3\u4e00\u4e9b\u57fa\u7840","text":""},{"location":"front-end/android/daily/binder/#_2","title":"\u8fdb\u7a0b\u9694\u79bb","text":"<p>\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u8fdb\u7a0b\u4e0e\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5185\u5b58\u548c\u6570\u636e\u90fd\u662f\u4e0d\u5171\u4eab\u7684\uff0c\u79f0\u4e4b\u4e3a \u8fdb\u7a0b\u9694\u79bb \u673a\u5236\u3002</p> <p></p> <p>\u5173\u4e8e\u8fdb\u7a0b\u9694\u79bb\u77e5\u8bc6\u8bf7\u53c2\u8003\uff1aLinux\u9884\u5907\u77e5\u8bc6\uff08\u4e00\uff09\uff1a\u8fdb\u7a0b\u9694\u79bb - \u7b80\u4e66 (jianshu.com)</p> <p>\u5982\u679c\u8fdb\u7a0b\u4e4b\u95f4\u9700\u8981\u8fdb\u884c\u901a\u4fe1\uff0c\u90a3\u4e48\u9700\u8981\u4f7f\u7528IPC\u673a\u5236\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684IPC\u673a\u5236\u5f88\u591a\uff0c\u6bd4\u5982\u5171\u4eab\u5185\u5b58\uff0csocket\u7b49\uff0c\u5728\u5b89\u5353\u7cfb\u7edf\u4e2d\uff0c\u6700\u5e38\u89c1\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u5c31\u662fbinder\u4e86\u3002</p>"},{"location":"front-end/android/daily/binder/#_3","title":"\u865a\u62df\u5730\u5740\u7a7a\u95f4","text":"<p>\u8fdb\u7a0b\u9694\u79bb\u673a\u5236\u7684\u4e3b\u8981\u5b9e\u73b0\u65b9\u5f0f\u662f\u4f7f\u7528\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4ee532\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u603b\u5171\u67094G\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c06\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5212\u5206\u4e3a2\u90e8\u5206\uff0c\u6700\u9ad8\u76841G\u5b57\u8282\uff08<code>0xC0000000~0xFFFFFFFF</code>\uff09\u4e3a\u5185\u6838\u7a7a\u95f4\uff0c\u8f83\u4f4e\u76843G\u5b57\u8282\uff08<code>0x00000000~0xBFFFFFFF</code>\uff09\u7531\u5404\u4e2a\u8fdb\u7a0b\u4f7f\u7528\uff0c\u79f0\u4e3a\u7528\u6237\u7a7a\u95f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#_4","title":"\u4e3a\u4ec0\u4e48\u4f1a\u5212\u5206\u8fd9\u4e9b\u7a7a\u95f4","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u4e3b\u8981\u662f\u4e3a\u4e86\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u8003\u8651\uff0c\u89c4\u5b9a\u5185\u6838\u7a7a\u95f4\u53ef\u4ee5\u6267\u884cCPU\u7684\u4efb\u4f55\u6307\u4ee4\uff0c\u800c\u666e\u901a\u8fdb\u7a0b\u8fd0\u884c\u7684\u7528\u6237\u7a7a\u95f4\u5219\u53d7\u5230\u5f88\u591a\u9650\u5236\u3002</p> <p>\u5728CPU\u7684\u6307\u4ee4\u4e2d\uff0c\u6709\u4e9b\u6307\u4ee4\u662f\u975e\u5e38\u5371\u9669\u7684\uff0c\u5982\u679c\u8c03\u7528\u51fa\u9519\uff0c\u53ef\u80fd\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\u3002CPU\u6307\u4ee4\u5206\u4e3a\u7279\u6743\u6307\u4ee4\u548c\u975e\u7279\u6743\u6307\u4ee4\uff0c\u5bf9\u4e8e\u7279\u6743\u6307\u4ee4\uff0c\u53ea\u5141\u8bb8\u64cd\u4f5c\u7cfb\u7edf\u548c\u76f8\u5173\u6a21\u5757\u4f7f\u7528\uff0c\u5bf9\u4e8e\u666e\u901a\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ea\u80fd\u4f7f\u7528\u90a3\u4e9b\u4e0d\u4f1a\u9020\u6210\u707e\u96be\u7684\u6307\u4ee4\u3002CPU\u7279\u6743\u7b49\u7ea7\u5206\u4e3a4\u4e2a\u7ea7\u522b\uff1aRing0~Ring4\u3002Linux\u7cfb\u7edf\u4e2d\u53ea\u4f7f\u7528\u4e86Ring0\u548cRing3\u4e24\u4e2a\u7ea7\u522b\u3002</p> <p>\u5173\u4e8e\u865a\u62df\u5730\u5740\u77e5\u8bc6\u8bf7\u53c2\u8003\uff1aLinux\u5185\u6838\u865a\u62df\u5730\u5740\u7a7a\u95f4 - \u7b80\u4e66 (jianshu.com)</p>"},{"location":"front-end/android/daily/binder/#binder","title":"binder\u9a71\u52a8\u662f\u4ec0\u4e48","text":"<p>\u4f20\u7edf\u7684 Linux \u901a\u4fe1\u673a\u5236\uff0c\u6bd4\u5982 Socket\uff0c\u7ba1\u9053\u7b49\u90fd\u662f\u5185\u6838\u652f\u6301\u7684\uff1b\u4f46\u662f Binder \u5e76\u4e0d\u662f Linux \u5185\u6838\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u662f\u600e\u4e48\u505a\u5230\u8bbf\u95ee\u5185\u6838\u7a7a\u95f4\u7684\u5462\uff1f Linux \u7684\u52a8\u6001\u53ef\u52a0\u8f7d\u5185\u6838\u6a21\u5757\uff08Loadable Kernel Module\uff0cLKM\uff09\u673a\u5236\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff1b\u6a21\u5757\u662f\u5177\u6709\u72ec\u7acb\u529f\u80fd\u7684\u7a0b\u5e8f\uff0c\u5b83\u53ef\u4ee5\u88ab\u5355\u72ec\u7f16\u8bd1\uff0c\u4f46\u4e0d\u80fd\u72ec\u7acb\u8fd0\u884c\u3002\u5b83\u5728\u8fd0\u884c\u65f6\u88ab\u94fe\u63a5\u5230\u5185\u6838\u4f5c\u4e3a\u5185\u6838\u7684\u4e00\u90e8\u5206\u5728\u5185\u6838\u7a7a\u95f4\u8fd0\u884c\u3002\u8fd9\u6837\uff0cAndroid\u7cfb\u7edf\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u4e00\u4e2a\u5185\u6838\u6a21\u5757\u8fd0\u884c\u5728\u5185\u6838\u7a7a\u95f4\uff0c\u7528\u6237\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u8fc7\u8fd9\u4e2a\u6a21\u5757\u4f5c\u4e3a\u6865\u6881\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u901a\u4fe1\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u5728 Android \u7cfb\u7edf\u4e2d\uff0c\u8fd9\u4e2a\u8fd0\u884c\u5728\u5185\u6838\u7a7a\u95f4\u7684\uff0c\u8d1f\u8d23\u5404\u4e2a\u7528\u6237\u8fdb\u7a0b\u901a\u8fc7 Binder \u901a\u4fe1\u7684\u5185\u6838\u6a21\u5757\u53eb\u505a Binder \u9a71\u52a8;</p> <p>\u9a71\u52a8\u7a0b\u5e8f\u4e00\u822c\u6307\u7684\u662f\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\uff08Device Driver\uff09\uff0c\u662f\u4e00\u79cd\u53ef\u4ee5\u4f7f\u8ba1\u7b97\u673a\u548c\u8bbe\u5907\u901a\u4fe1\u7684\u7279\u6b8a\u7a0b\u5e8f\u3002\u76f8\u5f53\u4e8e\u786c\u4ef6\u7684\u63a5\u53e3\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ea\u6709\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\uff0c\u624d\u80fd\u63a7\u5236\u786c\u4ef6\u8bbe\u5907\u7684\u5de5\u4f5c\uff1b</p>"},{"location":"front-end/android/daily/binder/#binder_1","title":"binder\u5982\u4f55\u8fdb\u884c\u901a\u4fe1","text":"<p>\u5185\u6838\u4e2d\u63d0\u4f9b\u4e86binder\u9a71\u52a8\u6a21\u5757\uff0c\u4e3a\u8fdb\u7a0b\u95f4\u901a\u4fe1\u63d0\u4f9b\u57fa\u7840\u6846\u67b6\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#mmap","title":"\u7b2c\u4e8c\u8282:\u7cfb\u7edf\u8c03\u7528\u548cmmap","text":"<p>\u5728Linux\u7cfb\u7edf\u4e2d\uff0c\u7cfb\u7edf\u8c03\u7528(System Call)\u662f\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u5185\u6838\u7684\u552f\u4e00\u624b\u6bb5\uff0c\u4e5f\u662f\u60df\u4e00\u7684\u5408\u6cd5\u5165\u53e3\u3002\u7528\u6237\u8fdb\u7a0b\u4e0e\u5185\u6838\u4e4b\u95f4\u4f7f\u7528\u7cfb\u7edf\u8c03\u7528\u8fdb\u884c\u6c9f\u901a\u3002</p>"},{"location":"front-end/android/daily/binder/#_5","title":"\u5e38\u7528\u7684\u7cfb\u7edf\u8c03\u7528","text":"<p>binder\u673a\u5236\u4e2d\u5e38\u7528\u7684\u7cfb\u7edf\u8c03\u7528\u5982\u4e0b\u8868\u5982\u793a\uff1a</p> \u65b9\u6cd5 \u63cf\u8ff0 \u5b9a\u4e49\u4f4d\u7f6e open() \u6253\u5f00\u8bbe\u5907\u6587\u4ef6\u65b9\u6cd5 kernel/drivers/android/binder.c mmap() memory map\uff0c\u5185\u5b58\u6620\u5c04\u65b9\u6cd5\uff0c\u5b9e\u73b0\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u5185\u5b58\u5171\u4eab\u3002 kernel/drivers/android/binder.c ioctl() \u5bf9\u8bbe\u5907\u6587\u4ef6\u5b9e\u73b0\u8bfb\uff0c\u5199\u7b49\u4e00\u4e9b\u6269\u5c55\u529f\u80fd\u3002 kernel/drivers/android/binder.c"},{"location":"front-end/android/daily/binder/#mmap_1","title":"mmap\u548c\u4e00\u6b21\u62f7\u8d1d","text":"<p>binder\u4f5c\u4e3a\u5b89\u5353\u7cfb\u7edf\u4e2d\u6700\u5e38\u7528\u7684IPC\u6280\u672f\uff0c\u5176\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u4e00\u4e2a\u4f18\u52bf\u5728\u4e8e\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65f6\u6570\u636e\u7684\u4e00\u6b21\u62f7\u8d1d\u3002</p> <p>\u7531\u4e8e\u7cfb\u7edf\u4e2d\u8fdb\u7a0b\u9694\u79bb\u7684\u539f\u56e0\uff0c\u7528\u6237\u8fdb\u7a0b\u4e4b\u95f4\u4e0d\u80fd\u62f7\u8d1d\u6570\u636e\uff0c\u6240\u4ee5\u53ea\u80fd\u4f9d\u8d56\u5185\u6838\u7a7a\u95f4\u505a\u4e3a\u8f85\u52a9\uff0c\u95f4\u63a5\u4f20\u9012\u6570\u636e\uff0c\u5982\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u6570\u636e\u4ececlient\u7aef\u62f7\u8d1d\u5230\u5185\u6838\u3002</li> <li>\u6570\u636e\u4ece\u5185\u6838\u62f7\u8d1d\u5230server\u7aef\u3002</li> </ol> <p>\u5b8c\u6210\u4e0a\u9762\u76842\u6b21\u62f7\u8d1d\u4e4b\u540e\uff0c\u624d\u80fd\u8fbe\u5230client\u548cserver\u8fdb\u884c\u6570\u636e\u4f20\u9012\u7684\u76ee\u7684\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u800cbinder\u4f7f\u7528\u4e86\u5185\u5b58\u6620\u5c04(memory map)\u6280\u672f\uff0c\u53ea\u62f7\u8d1d\u4e00\u6b21\u5c31\u53ef\u4ee5\u8fbe\u5230\u7528\u6237\u8fdb\u7a0b\u4e4b\u95f4\u4f20\u9012\u6570\u636e\u7684\u76ee\u7684\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>mmap\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6210\u719f\u7684\u6280\u672f\uff0c\u53ea\u4e0d\u8fc7\u5b89\u5353\u628a\u5b83\u5de7\u5999\u7684\u7528\u5728\u4e86binder\u4e2d\u3002\u6620\u5c04\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <ol> <li>client\u8fdb\u7a0b\u901a\u8fc7copy_from_user()\u5c06\u6570\u636e\u4ece\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u5230\u4e86\u5185\u6838\u7a7a\u95f4\u3002</li> <li>server\u8fdb\u7a0b\u901a\u8fc7mmap\u5c06\u5185\u6838\u7a7a\u95f4\u7684\u5185\u5b58\u5730\u5740\u6620\u5c04\u5230\u4e86\u7528\u6237\u7a7a\u95f4\u3002</li> <li>\u53ea\u8981client\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u90a3\u4e48server\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u5230\u5185\u6838\u7a7a\u95f4\u7684\u6570\u636e\uff0c\u65e0\u9700\u518d\u6b21\u62f7\u8d1d\u3002</li> </ol> <p>\u7ed3\u6784\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#binder_2","title":"\u7b2c\u4e09\u8282:binder\u6574\u4f53\u6d41\u7a0b","text":""},{"location":"front-end/android/daily/binder/#_6","title":"\u57fa\u672c\u67b6\u6784","text":"<p>\u5728\u5b89\u5353\u7cfb\u7edf\u4e2d\uff0c\u5b9e\u73b0binder\u67b6\u6784\u91c7\u7528\u7684\u662fClient/Server\u67b6\u6784\u6a21\u578b\uff0c\u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u4e2a\u89d2\u8272\uff1aClient\uff0cServer\uff0cServiceManager\uff0cBinder\u9a71\u52a8\u3002</p> <ol> <li>client\uff0cserver\u548cServiceManager\u5b58\u5728\u4e8e\u7528\u6237\u7a7a\u95f4\u4e2d\uff0cbinder\u9a71\u52a8\u5728\u5185\u6838\u7a7a\u95f4\u4e2d\u3002</li> <li>binder\u9a71\u52a8\u63d0\u4f9b\u8bbe\u5907\u6587\u4ef6/dev/binder\u4e0e\u7528\u6237\u7a7a\u95f4\u8fdb\u884c\u4ea4\u4e92\u3002</li> <li>client\uff0cserver\u548cServiceManager\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528open()\u548cioctl()\u7b49\u64cd\u4f5c\u4e0ebinder\u9a71\u52a8\u8fdb\u884c\u901a\u4fe1\u3002</li> <li>ServiceManager\u662f\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u7528\u6765\u7ba1\u7406server\uff0c\u5e76\u5411client\u63d0\u4f9b\u67e5\u8be2server\u63a5\u53e3\u7684\u80fd\u529b\u3002</li> </ol> <p></p>"},{"location":"front-end/android/daily/binder/#_7","title":"\u6574\u4f53\u6d41\u7a0b","text":"<p>\u518d\u8fdb\u4e00\u6b65\uff0c\u5982\u679c\u8981\u4f7f\u7528binder\uff0c\u4e00\u6b21\u5b8c\u6574\u7684\u6d41\u7a0b\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>SM\u542f\u52a8\u5e76\u6ce8\u518c\u4e3acontext manager.</li> <li>server\u8fdb\u7a0b\u901a\u8fc7binder\u5411SM\u4e2d\u6ce8\u518c\u670d\u52a1</li> <li>client\u8fdb\u7a0b\u67e5\u8be2server\u8fdb\u7a0b\u7684\u5730\u5740</li> <li>client\u8fdb\u7a0b\u5f97\u5230SM\u8fd4\u56de\u7684server\u8fdb\u7a0b\u7684\u5730\u5740</li> <li>client\u8fdb\u7a0b\u901a\u8fc7binder\u4f7f\u7528\u670d\u52a1</li> <li>server\u8fdb\u7a0b\u5411client\u8fdb\u7a0b\u8fd4\u56de\u6570\u636e</li> </ol> <p></p> <p>\u8fc7\u7a0b\u770b\u8d77\u6765\u6ca1\u6709\u51e0\u6b65\uff0c\u4f46\u662f\u6574\u4e2a\u6d41\u7a0b\u6d89\u53ca\u590d\u6742\uff0c\u4eceJava , jni ,native\uff0c\u518d\u5230\u5185\u6838\uff0c\u5230binder\u9a71\u52a8\uff0c\u4f1a\u6d89\u53ca\u5f88\u591a\u4ee3\u7801\u6587\u4ef6\u3002  \u5982\u4e0b\u5217\u8868\u6240\u793a\uff1a  1.Framework Java\u5c42\uff1a\uff08/frameworks/base/core/java/android/os/\uff09\uff1a</p> \u76f8\u5173\u6587\u4ef6 Binder.java(\u5b9e\u73b0IBinder) BinderProxy.java IInterface.java IBinder.java Parcel.java ServiceManager.java ServiceManagerNative.java ServiceManagerNative.ServiceManagerProxy <p>2.Framework Jni\u5c42\uff08/frameworks/base/core/jni/\uff09\uff1a</p> \u76f8\u5173\u6587\u4ef6 android_os_Parcel.cpp android_util_Binder.cpp AndroidRuntime.cpp <p>3.Framework Native\u5c42\uff08/frameworks/native/libs/binder\uff09\uff1a</p> \u76f8\u5173\u6587\u4ef6 IServiceManager.cpp Binder.cpp(\u5b9e\u73b0Binder.h) BpBinder.cpp(\u5b9e\u73b0BpBinder.h) Binder.cpp(BBinder) IPCThreadState.cpp ProcessState.cpp Parcel.cpp /aidl/android/os/IServiceManager.aidl /include/binder/Binder.h (BBinder : IBinder; BpRefBase : RefBase) /include/binder/BpBinder.h(BpBinder : IBinder) /include/binder/IBinder.h(IBinder : RefBase) /include/binder/IInterface.h(BpInterface:BpRefBase; BnInterface:BBinder) /include/binder/IServiceManager.h(\u7ee7\u627fIInterface.h) <p>4.ServiceManager Native\u5c42\uff08frameworks/native/cmds/servicemanager\uff09\uff1a</p> \u76f8\u5173\u6587\u4ef6 ServiceManager.cpp ServiceManager.h main.cpp <p>5.\u5185\u6838\u5c42\uff08kernel/drivers/android/binder.c)\uff1a</p> \u76f8\u5173\u6587\u4ef6 binder.c"},{"location":"front-end/android/daily/binder/#_8","title":"\u7b2c\u56db\u8282:\u73af\u5883\u521d\u59cb\u5316","text":"<p>\u6b63\u5982\u6c7d\u8f66\u8981\u884c\u9a76\uff0c\u5fc5\u987b\u5148\u6709\u8def\uff0c\u540c\u6837\u7684\uff0cbinder\u8fd9\u5957\u673a\u5236\u8981\u8fd0\u884c\u8d77\u6765\uff0c\u4e5f\u8981\u6709\u57fa\u7840\u73af\u5883\u3002\u8fd9\u4e2a\u73af\u5883\u5c31\u662fbinder\u9a71\u52a8\u548cServiceManager\u670d\u52a1\uff0c\u8fd9\u4e24\u4e2a\u6a21\u5757\u5728\u624b\u673a\u5f00\u673a\u65f6\u5c31\u8fd0\u884c\u8d77\u6765\u4e86\u3002\u6211\u4eec\u5206\u522b\u6765\u770b\u4e00\u4e0b\u3002</p>"},{"location":"front-end/android/daily/binder/#41binder","title":"4.1.binder\u9a71\u52a8\u521d\u59cb\u5316","text":"<p>binder\u9a71\u52a8\u662f\u5728kernel\u7684binder.c\u4e2d\u521d\u59cb\u5316\u7684\u3002</p> <pre><code>//kernel/drivers/android/binder.c\ndevice_initcall(binder_init);\n</code></pre>"},{"location":"front-end/android/daily/binder/#411binder_init","title":"4.1.1.\u521d\u59cb\u5316\u5165\u53e3binder_init()","text":"<p>\u8be5\u51fd\u6570\u91cc\u9762\u8c03\u7528\u4e86binder_init\u51fd\u6570\u5982\u4e0b\uff1a</p> <pre><code>static int __init binder_init(void)\n{\nint ret;\nchar *device_name, *device_names, *device_tmp;\nstruct binder_device *device;\nstruct hlist_node *tmp;\nret = binder_alloc_shrinker_init();\nif (ret)\nreturn ret;\natomic_set(&amp;binder_transaction_log.cur, ~0U);\natomic_set(&amp;binder_transaction_log_failed.cur, ~0U);\nbinder_debugfs_dir_entry_root = debugfs_create_dir(\"binder\", NULL);\nif (binder_debugfs_dir_entry_root)\nbinder_debugfs_dir_entry_proc = debugfs_create_dir(\"proc\", binder_debugfs_dir_entry_root);\n......\n/*\n   * Copy the module_parameter string, because we don't want to\n   * tokenize it in-place.\n   */\ndevice_names = kstrdup(binder_devices_param, GFP_KERNEL);\nif (!device_names) {\nret = -ENOMEM;\ngoto err_alloc_device_names_failed;\n}\ndevice_tmp = device_names;\nwhile ((device_name = strsep(&amp;device_tmp, \",\"))) {\nret = init_binder_device(device_name);\nif (ret)\ngoto err_init_binder_device_failed;\n}\nreturn ret;\n......\n}\n</code></pre>"},{"location":"front-end/android/daily/binder/#412init_binder_devicename","title":"4.1.2.\u521d\u59cb\u8bbe\u5907init_binder_device(name)","text":"<p>binder_init()\u51fd\u6570\u4e2d\u6700\u91cd\u8981\u7684\u5c31\u662f\u8c03\u7528\u4e86init_binder_device()\u51fd\u6570\u6765\u521d\u59cb\u5316binder\u8bbe\u5907\uff1a</p> <pre><code>static int __init init_binder_device(const char *name)\n{\nint ret;\nstruct binder_device *binder_device;\nbinder_device = kzalloc(sizeof(*binder_device), GFP_KERNEL);\nif (!binder_device)\nreturn -ENOMEM;\nbinder_device-&gt;miscdev.fops = &amp;binder_fops;\nbinder_device-&gt;miscdev.minor = MISC_DYNAMIC_MINOR;\nbinder_device-&gt;miscdev.name = name;\nbinder_device-&gt;context.binder_context_mgr_uid = INVALID_UID;\nbinder_device-&gt;context.name = name;\nmutex_init(&amp;binder_device-&gt;context.context_mgr_node_lock);\nret = misc_register(&amp;binder_device-&gt;miscdev);\nif (ret &lt; 0) {\nkfree(binder_device);\nreturn ret;\n}\nhlist_add_head(&amp;binder_device-&gt;hlist, &amp;binder_devices);\nreturn ret;\n}\n</code></pre>"},{"location":"front-end/android/daily/binder/#413binder_fops","title":"4.1.3.\u914d\u7f6ebinder_fops","text":"<p>init_binder_device()\u51fd\u6570\u91cc\u9762\u751f\u6210\u4e86binder\u8bbe\u5907\u5bf9\u8c61binder_device\uff0c\u8bbe\u7f6e\u4e86binder\u8bbe\u5907\u7684\u64cd\u4f5c\u5217\u8868binder_fops\u5982\u4e0b\uff0c\u8fd9\u4e9b\u5c31\u662fbinder\u8bbe\u5907\u5e38\u7528\u7684\u4e00\u4e9b\u64cd\u4f5c\u3002</p> <pre><code>const struct file_operations binder_fops = {\n.owner = THIS_MODULE,\n.poll = binder_poll,\n.unlocked_ioctl = binder_ioctl,\n.compat_ioctl = binder_ioctl,\n.mmap = binder_mmap,\n.open = binder_open,\n.flush = binder_flush,\n.release = binder_release,\n};\n</code></pre> <p>\u540d\u79f0name\u4eceCONFIG_ANDROID_BINDER_DEVICES\u914d\u7f6e\u4e2d\u6765\uff0c\u914d\u7f6e\u6587\u4ef6\u5728/kernel/configs/android-base.config\u6587\u4ef6\u4e2d\uff0c\u5176\u914d\u7f6e\u4e3a\uff1a</p> <pre><code>CONFIG_ANDROID_BINDER_DEVICES=binder,hwbinder,vndbinder\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5728binder_init()\u51fd\u6570\u4e2d\u53ef\u4ee5\u770b\u5230CONFIG_ANDROID_BINDER_DEVICES\u88ab\u9017\u53f7\u5207\u5206\u540e\uff0c\u4f7f\u7528while\u5faa\u73af\u9010\u4e2a\u521d\u59cb\u5316\u3002</p>"},{"location":"front-end/android/daily/binder/#414misc_register","title":"4.1.4.\u6ce8\u518cmisc_register","text":"<p>init_binder_device()\u51fd\u6570\u6700\u540e\u8c03\u7528\u4e86misc_register(&amp;binder_device\u2192miscdev)\u6765\u6ce8\u518c\u751f\u6210\u7684binder\u8bbe\u5907\uff0cmisc_register\u5177\u4f53\u5b9a\u4e49\u5982\u4e0b\u3002</p> <pre><code>//kenel/driver/char/misc.c\n/**\n *  misc_register  -  register a miscellaneous device\n *  @misc: device structure\n *\n *  Register a miscellaneous device with the kernel. If the minor\n *  number is set to %MISC_DYNAMIC_MINOR a minor number is assigned\n *  and placed in the minor field of the structure. For other cases\n *  the minor number requested is used.\n *\n *  The structure passed is linked into the kernel and may not be\n *  destroyed until it has been unregistered. By default, an open()\n *  syscall to the device sets file-&gt;private_data to point to the\n *  structure. Drivers don't need open in fops for this.\n *\n *  A zero is returned on success and a negative errno code for\n *  failure.\n */\nint misc_register(struct miscdevice *misc)\n{\ndev_t dev;\nint err = 0;\nbool is_dynamic = (misc-&gt;minor == MISC_DYNAMIC_MINOR);\nINIT_LIST_HEAD(&amp;misc-&gt;list);\nmutex_lock(&amp;misc_mtx);\nif (is_dynamic) {\nint i = find_first_zero_bit(misc_minors, DYNAMIC_MINORS);\nif (i &gt;= DYNAMIC_MINORS) {\nerr = -EBUSY;\ngoto out;\n}\nmisc-&gt;minor = DYNAMIC_MINORS - i - 1;\nset_bit(i, misc_minors);\n} else {\nstruct miscdevice *c;\nlist_for_each_entry(c, &amp;misc_list, list) {\nif (c-&gt;minor == misc-&gt;minor) {\nerr = -EBUSY;\ngoto out;\n}\n}\n}\ndev = MKDEV(MISC_MAJOR, misc-&gt;minor);\nmisc-&gt;this_device =\ndevice_create_with_groups(misc_class, misc-&gt;parent, dev,\nmisc, misc-&gt;groups, \"%s\", misc-&gt;name);\nif (IS_ERR(misc-&gt;this_device)) {\nif (is_dynamic) {\nint i = DYNAMIC_MINORS - misc-&gt;minor - 1;\nif (i &lt; DYNAMIC_MINORS &amp;&amp; i &gt;= 0)\nclear_bit(i, misc_minors);\nmisc-&gt;minor = MISC_DYNAMIC_MINOR;\n}\nerr = PTR_ERR(misc-&gt;this_device);\ngoto out;\n}\n/*\n   * Add it to the front, so that later devices can \"override\"\n   * earlier defaults\n   */\nlist_add(&amp;misc-&gt;list, &amp;misc_list);\nout:\nmutex_unlock(&amp;misc_mtx);\nreturn err;\n}\n</code></pre>"},{"location":"front-end/android/daily/binder/#415","title":"4.1.5.\u603b\u7ed3\u6d41\u7a0b","text":"<p>\u7ecf\u8fc7\u4e0a\u9762\u7684\u6b65\u9aa4\u4e4b\u540e\uff0cclient\u548cserver\u624d\u80fd\u4f7f\u7528binder\u9a71\u52a8\u8fdb\u884c\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff0c\u76f8\u5f53\u4e8e\u662f\u94fa\u57ab\u597d\u4e86\u6c9f\u901a\u7684\u9053\u8def\u3002binder\u9a71\u52a8\u521d\u59cb\u5316\u4e3b\u8981\u6d41\u7a0b\u90fd\u5728kernel/drivers/android/binder.c\u6587\u4ef6\u4e2d\uff0c\u8c03\u7528\u7684\u4e3b\u8981\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#42servicemanager","title":"4.2.ServiceManager\u670d\u52a1\u521d\u59cb\u5316","text":"<p>ServiceManager\u670d\u52a1\u542f\u52a8\u76f8\u5173\u7684\u6d41\u7a0b\u90fd\u5728frameworks/native/cmds/servicemanager\u76ee\u5f55\u4e0b\u9762\u3002</p> <p>\u9996\u5148\u662f\u5f00\u673a\u7531init\u8fdb\u7a0b\u89e3\u6790init.rc\u6587\u4ef6\u542f\u52a8servicemanager.rc.</p> <pre><code>//frameworks/native/cmds/servicemanager/servicemanager.rc\nservice servicemanager /system/bin/servicemanager\nclass core animation\nuser system\ngroup system readproc\ncritical\nonrestart restart apexd\nonrestart restart audioserver\nonrestart restart gatekeeperd\nonrestart class_restart main\nonrestart class_restart hal\nonrestart class_restart early_hal\nwritepid /dev/cpuset/system-background/tasks\nshutdown critical\n</code></pre> <p>\u542f\u52a8\u4f1a\u8c03\u7528main.cpp\u7684main\u51fd\u6570\uff1a</p> <pre><code>//frameworks/native/cmds/servicemanager/main.cpp\nint main(int argc, char** argv) {\nif (argc &gt; 2) {\nLOG(FATAL) &lt;&lt; \"usage: \" &lt;&lt; argv[0] &lt;&lt; \" [binder driver]\";\n}\nconst char* driver = argc == 2 ? argv[1] : \"/dev/binder\";\n//\u6253\u5f00/dev/binder\u8bbe\u5907;\u5e76\u4e14\u901a\u8fc7mmap\u6620\u5c04\u8bbe\u5907\u7684\u5185\u5b58\u7a7a\u95f4\u5230SM\u8fdb\u7a0b\u4e2d\nsp&lt;ProcessState&gt; ps = ProcessState::initWithDriver(driver);\nps-&gt;setThreadPoolMaxThreadCount(0);\nps-&gt;setCallRestriction(ProcessState::CallRestriction::FATAL_IF_NOT_ONEWAY);\nsp&lt;ServiceManager&gt; manager = sp&lt;ServiceManager&gt;::make(std::make_unique&lt;Access&gt;());\nif (!manager-&gt;addService(\"manager\", manager, false /*allowIsolated*/, IServiceManager::DUMP_FLAG_PRIORITY_DEFAULT).isOk()) {\nLOG(ERROR) &lt;&lt; \"Could not self register servicemanager\";\n}\nIPCThreadState::self()-&gt;setTheContextObject(manager);\n//\u8bbe\u7f6eSM\u4e3acontext manager\u3002\nps-&gt;becomeContextManager();\nsp&lt;Looper&gt; looper = Looper::prepare(false /*allowNonCallbacks*/);\nBinderCallback::setupTo(looper);\nClientCallbackCallback::setupTo(looper, manager);\n//\u8fdb\u5165\u5faa\u73af\uff0c\u7b49\u5f85\u63a5\u6536\u6570\u636e\u6765\u8fdb\u884c\u5904\u7406\u3002\nwhile(true) {\nlooper-&gt;pollAll(-1);\n}\n// should not be reached\nreturn EXIT_FAILURE;\n}\n</code></pre> <p>\u8fd9\u4e2amain\u51fd\u6570\u91cc\u9762\u4e3b\u8981\u505a\u4e86\u4ee5\u4e0b\u51e0\u4ef6\u4e8b\u60c5 \uff1a</p> <ol> <li>\u6253\u5f00/dev/binder\u8bbe\u5907;</li> <li>\u901a\u8fc7mmap\u6620\u5c04\u8bbe\u5907\u7684\u5185\u5b58\u7a7a\u95f4\u5230ServiceManager\u8fdb\u7a0b\u4e2d\u3002</li> <li>\u8bbe\u7f6eServiceManager\u4e3acontext manager\u3002</li> <li>ServiceManager\u670d\u52a1\u8fdb\u5165\u5faa\u73af\uff0c\u7b49\u5f85\u63a5\u6536\u6570\u636e\u6765\u8fdb\u884c\u5904\u7406\u3002</li> </ol> <p>\u6211\u4eec\u5206\u522b\u6765\u770b\u4e00\u4e0b\uff1a</p>"},{"location":"front-end/android/daily/binder/#421devbinder","title":"4.2.1.\u6253\u5f00/dev/binder\u8bbe\u5907;","text":"<p>\u7b2c1\u6b65\u548c\u7b2c2\u6b65\u9aa4\u90fd\u662f\u901a\u8fc7ProcessState::initWithDriver(driver);\u8fd9\u4e00\u884c\u4ee3\u7801\u6765\u5b9e\u73b0\u7684\u3002\u8fd9\u4e00\u884c\u4f1a\u89e6\u53d1\u521b\u5efaProcessState\u5bf9\u8c61\u3002</p> <p>ProcessState \u5bf9\u8c61\u6784\u9020\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>//frameworks/native/libs/binder/ProcessState.cpp\nProcessState::ProcessState(const char *driver)\n: mDriverName(String8(driver))\n, mDriverFD(open_driver(driver))\n, mVMStart(MAP_FAILED)\n, mThreadCountLock(PTHREAD_MUTEX_INITIALIZER)\n, mThreadCountDecrement(PTHREAD_COND_INITIALIZER)\n, mExecutingThreadsCount(0)\n, mWaitingForThreads(0)\n, mMaxThreads(DEFAULT_MAX_BINDER_THREADS)\n, mStarvationStartTimeMs(0)\n, mThreadPoolStarted(false)\n, mThreadPoolSeq(1)\n, mCallRestriction(CallRestriction::NONE)\n{\nif (mDriverFD &gt;= 0) {\n// mmap the binder, providing a chunk of virtual address space to receive transactions.\nmVMStart = mmap(nullptr, BINDER_VM_SIZE, PROT_READ, MAP_PRIVATE | MAP_NORESERVE, mDriverFD, 0);\nif (mVMStart == MAP_FAILED) {\n// *sigh*\nALOGE(\"Using %s failed: unable to mmap transaction memory.\\n\", mDriverName.c_str());\nclose(mDriverFD);\nmDriverFD = -1;\nmDriverName.clear();\n}\n}\n}\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6784\u5efa\u65b9\u6cd5\u8c03\u7528\u4e86open_driver()\u548cmmap()\u8fd9\u4e24\u4e2a\u6b65\u9aa4\u3002</p> <p>\u6211\u4eec\u770b\u4e00\u4e0bopen_driver()\u51fd\u6570\u5b9a\u4e49\u5982\u4e0b:</p> <pre><code>//frameworks/native/libs/binder/ProcessState.cpp\nstatic int open_driver(const char *driver)\n{\nint fd = open(driver, O_RDWR | O_CLOEXEC);\nif (fd &gt;= 0) {\nint vers = 0;\nstatus_t result = ioctl(fd, BINDER_VERSION, &amp;vers);\nif (result == -1) {\nALOGE(\"Binder ioctl to obtain version failed: %s\", strerror(errno));\nclose(fd);\nfd = -1;\n}\nif (result != 0 || vers != BINDER_CURRENT_PROTOCOL_VERSION) {\nALOGE(\"Binder driver protocol(%d) does not match user space protocol(%d)! ioctl() return value: %d\",\nvers, BINDER_CURRENT_PROTOCOL_VERSION, result);\nclose(fd);\nfd = -1;\n}\nsize_t maxThreads = DEFAULT_MAX_BINDER_THREADS;\nresult = ioctl(fd, BINDER_SET_MAX_THREADS, &amp;maxThreads);\nif (result == -1) {\nALOGE(\"Binder ioctl to set max threads failed: %s\", strerror(errno));\n}\nuint32_t enable = DEFAULT_ENABLE_ONEWAY_SPAM_DETECTION;\nresult = ioctl(fd, BINDER_ENABLE_ONEWAY_SPAM_DETECTION, &amp;enable);\nif (result == -1) {\nALOGD(\"Binder ioctl to enable oneway spam detection failed: %s\", strerror(errno));\n}\n} else {\nALOGW(\"Opening '%s' failed: %s\\n\", driver, strerror(errno));\n}\nreturn fd;\n}\n</code></pre> <p>\u4e0a\u9762\u7684\u51fd\u6570\u8c03\u7528\u4e86open()\u6765\u6253\u5f00\u8bbe\u5907\u6587\u4ef6\uff0c\u901a\u8fc7ioctl()\u5411binder\u9a71\u52a8\u67e5\u8be2\u6216\u8005\u8bbe\u7f6e\u4e86\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982BINDER_VERSION\uff0cBINDER_SET_MAX_THREADS\u7b49\u64cd\u4f5c\u3002</p> <p>ioctl()\u63a5\u53e3\u662f\u7528\u6237\u7a7a\u95f4\u548cbinder\u5185\u6838\u7a7a\u95f4\u8fdb\u884c\u4ea4\u4e92\u7684\u4e3b\u8981\u63a5\u53e3\uff0c\u5176\u4e2d\u4e00\u4e9b\u91cd\u8981\u7684\u547d\u4ee4\u5982\u4e0b\u8868\uff1a</p> \u547d\u4ee4 \u63cf\u8ff0 BINDER_WRITE_READ \u8be5\u547d\u4ee4\u7531\u7528\u6237\u7a7a\u95f4\u5411binder\u9a71\u52a8\u5199\u5165\u6216\u8005\u8bfb\u53d6\u6570\u636e\u3002 \u91cc\u9762\u5305\u542b\u4e24\u90e8\u5206\uff1a\u5199\u548c\u8bfb\u3002 \u5f53write_size\u4e0d\u4e3a0\u65f6\uff0c\u8868\u793a\u8981\u5c06write_buffer\u91cc\u9762\u7684\u6570\u636e\u5199\u5165binder\u9a71\u52a8\u3002 \u5f53read_size\u4e0d\u4e3a0\u65f6\uff0c\u8868\u793a\u8981\u4ecebinder\u9a71\u52a8\u4e2d\u8bfb\u53d6\u6570\u636e\u5230read_buffer\u4e2d\u3002 BINDER_SET_MAX_THREADS \u8bbe\u7f6eServer\u7aef\u7ebf\u7a0b\u6c60\u4e2d\u652f\u6301\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u4fdd\u5b58\u5728binder\u9a71\u52a8\u4e2d\u7684binder_proc\u7ed3\u6784\u4f53\u4e2d\u3002 \u7531\u4e8eClient\u7aef\u662f\u5e76\u53d1\u5411Server\u53d1\u9001\u8bf7\u6c42\u7684\uff0c\u6240\u4ee5Server\u7aef\u5fc5\u987b\u6709\u7ebf\u7a0b\u6c60\u6765\u5904\u7406\u5e76\u53d1\u8bf7\u6c42\u3002binder\u9a71\u52a8\u4e2d\u4f1a\u8bb0\u5f55Client\u7aef\u8bf7\u6c42\u7684\u7ebf\u7a0b\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5219\u4e0d\u518d\u5904\u7406Client\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u3002 BINDER_SET_CONTEXT_MGR \u8be5\u547d\u4ee4\u5c06\u5f53\u524d\u8fdb\u7a0b\u8bbe\u7f6e\u4e3aContextManager\uff0c\u6700\u7ec8\u4fdd\u5b58\u5230binder\u9a71\u52a8\u4e2d\u7684binder_context\u7ed3\u6784\u4f53\u4e2d\u7684**binder_context_mgr_node**\u53d8\u91cf\u4e2d\u3002\u7cfb\u7edf\u4e2d\u6709\u4e14\u53ea\u80fd\u6709\u4e00\u4e2aContext Manager\u3002\u7531\u4e8eServiceManager\u670d\u52a1\u662f\u5728\u5f00\u673a\u65f6\u542f\u52a8\u5e76\u4e14\u901a\u8fc7\u6b64\u547d\u4ee4\u5c06\u81ea\u5df1\u8bbe\u7f6e\u4e3aContextManager\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1ServiceManager\u662f\u60df\u4e00\u4e14\u6b63\u786e\u7684ContextManager\u3002 BINDER_THREAD_EXIT Client\u901a\u77e5binder\u9a71\u52a8\u5f53\u524d\u7ebf\u7a0b\u9000\u51fa\u65f6\u53d1\u9001\u6b64\u547d\u4ee4\u3002 \u5982\u679cClient\u7aef\u7ebf\u7a0b\u6267\u884c\u7ed3\u675f\u4e86\uff0c\u90a3\u4e48\u4f1a\u7531\u7ebf\u7a0b**IPCThreadState**\u53d1\u9001\u6b64\u547d\u4ee4\uff0c\u901a\u77e5binder\u9a71\u52a8\u5c06\u5bf9\u5e94\u7684\u7ebf\u7a0b\u91ca\u653e\u6389. BINDER_VERSION \u83b7\u53d6binder\u9a71\u52a8\u7684\u7248\u672c\u53f7\u3002 \u4ece\u7528\u6237\u7a7a\u95f4\u6253\u5f00binder\u9a71\u52a8\u65f6\uff0c\u9996\u5148\u4f1a\u83b7\u53d6binder\u9a71\u52a8\u7684\u7248\u672c\u53f7\uff0c\u5982\u679c\u548c\u7528\u6237\u7a7a\u95f4\u7684\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u5219\u65e0\u6cd5\u6253\u5f00binder\u9a71\u52a8 \u3002"},{"location":"front-end/android/daily/binder/#422mmapsm","title":"4.2.2.\u901a\u8fc7mmap\u6620\u5c04\u8bbe\u5907\u7684\u5185\u5b58\u7a7a\u95f4\u5230SM\u8fdb\u7a0b\u4e2d\u3002","text":"<p>\u4e0a\u9762\u7684\u6784\u9020\u51fd\u6570\u5728\u51fd\u6570\u4f53\u4e2d\u8c03\u7528\u4e86mmap()\u6765\u6620\u5c04\u5185\u5b58\uff0c\u8fd4\u56de\u7684mVMStart \u4e3a\u865a\u62df\u5185\u5b58\u7684\u9996\u5730\u5740\u3002\u53c2\u6570BINDER_VM_SIZE\u5982\u4e0b\u5b9a\u4e49\uff1a</p> <pre><code>#define BINDER_VM_SIZE ((1 * 1024 * 1024) - sysconf(_SC_PAGE_SIZE) * 2)\n</code></pre> <p>binder\u9a71\u52a8\u4e2d\u5bf9\u5e94mmap\u51fd\u6570\uff1a</p> <pre><code>//kernel/drivers/android/binder.c\nstatic int binder_mmap(struct file *filp, struct vm_area_struct *vma){\nint ret;\nstruct binder_proc *proc = filp-&gt;private_data;\nif(proc-&gt;tsk != current-&gt;group_leader)\nreturn -EINVAL;\nif((vma-&gt;vm_end - vma-&gt;vm_start) &gt; SZ_4M)\nvma-&gt;vm_end = vma-&gt;vm_start +SZ_4M;\n...\nif(vma-&gt;vm_flags &amp; FORBIDDEN_MMAP_FLAGS){\nret = -EPERM;\nfailure_string = \"bad vm_flags\"\ngoto err_bad_arg;\n}\nvma-&gt;vm_flags |= VM_DONTCOPY | VM_MIXEDMAP;\nvma-&gt;vm_flags &amp;= ~VM_MAYWRITE;\nvma-&gt;vm_ops = &amp;binder_vm_ops;\nvma-&gt;vm_private_data = proc;\nret = binder_alloc_mmap_handler(&amp;proc-&gt;alloc, vma);\nif(ret)\nreturn ret;\nreturn 0;\n}\n</code></pre>"},{"location":"front-end/android/daily/binder/#423smcontext-manager","title":"4.2.3.\u8bbe\u7f6eSM\u4e3acontext manager","text":"<p>\u518d\u6765\u770b\u7b2c3\u6b65\u8bbe\u7f6eSM\u4e3acontext manager\uff0c\u9996\u5148\u521b\u5efa\u4e86\u4e00\u4e2aServiceManager\u5b9e\u4f8b\uff0c</p> <pre><code>sp&lt;ServiceManager&gt; manager = sp&lt;ServiceManager&gt;::make(std::make_unique&lt;Access&gt;());\n</code></pre> <p>\u7136\u540e\u5c06\u81ea\u5df1\u8bbe\u7f6e\u5230SM\u4e2d\uff1a</p> <pre><code>manager-&gt;addService(\"manager\", manager, false /*allowIsolated*/, IServiceManager::DUMP_FLAG_PRIORITY_DEFAULT)\n</code></pre> <p>\u770b\u4e00\u4e0bServiceManager\u7684addService()\uff0c\u7531\u4e8e\u670d\u52a1\u7aefServiceManager\u7ee7\u627f\u4e8eIBinder\u63a5\u53e3\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f20\u9012\u7684\u662fIBinder\u63a5\u53e3\uff0c\u7136\u540e\u5c06\u81ea\u5df1\u4ee5name\u4e3amanager\u5b57\u7b26\u4fdd\u5b58\u8d77\u6765\u7684:</p> <pre><code>//frameworks/native/cmds/servicemanager/ServiceManager.cpp\nStatus ServiceManager::addService(const std::string&amp; name, const sp&lt;IBinder&gt;&amp; binder, bool allowIsolated, int32_t dumpPriority){\n......\nmNameToService[name] = Service {\n.binder = binder,\n.allowIsolated = allowIsolated,\n.dumpPriority = dumpPriority,\n.debugPid = ctxt.debugPid,\n};\n......\nreturn Status::ok();\n}\n</code></pre> <p>\u7136\u540e\u8c03\u7528ProcessState\u7684becomeContextManager()\u51fd\u6570\uff1a</p> <pre><code>ps-&gt;becomeContextManager();\n</code></pre> <p>\u6211\u4eec\u770b\u4e00\u4e0b\u4e0a\u9762\u8fd9\u4e2abecomeContextManager()\u51fd\u6570\u7684\u5b9e\u73b0\uff0c\u51fd\u6570\u91cc\u9762\u8c03\u7528\u5230ioctl()\uff0c\u4f20\u9012BINDER_SET_CONTEXT_MGR\u547d\u4ee4\u5c06SM\u8bbe\u7f6e\u5230binder\u9a71\u52a8\u4e2d\uff0c</p> <pre><code>//frameworks/native/libs/binder/ProcessState.cpp\nbool ProcessState::becomeContextManager()\n{\nAutoMutex _l(mLock);\nflat_binder_object obj {\n.flags = FLAT_BINDER_FLAG_TXN_SECURITY_CTX,\n};\n......\nint unused = 0;\nresult = ioctl(mDriverFD, BINDER_SET_CONTEXT_MGR, &amp;unused);\nreturn result == 0;\n}\n</code></pre> <p>\u6211\u4eec\u7ee7\u7eed\u8ddf\u8fdb\u5230binder\u9a71\u52a8\u4e2d\u770b\u4e00\u4e0b\uff0c\u5728binder\u9a71\u52a8\u4e2d\u8c03\u7528\u5230binder_ioctl()\u51fd\u6570\uff0c</p> <pre><code>///drivers/android/binder.c\nstatic long binder_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)\n{\nint ret;\nstruct binder_proc *proc = filp-&gt;private_data;\n......\ncase BINDER_SET_CONTEXT_MGR:\nret = binder_ioctl_set_ctx_mgr(filp);\nif (ret)\ngoto err;\nbreak;\n......\n}\n</code></pre> <p>\u4e0a\u9762\u51fd\u6570\u91cc\u9762\u7684binder_ioctl_set_ctx_mgr()\u51fd\u6570\u5c31\u662f\u8bbe\u7f6eSM\u4e3acontext manager\uff0c\u5982\u4e0b:</p> <pre><code>///drivers/android/binder.c\nstatic int binder_ioctl_set_ctx_mgr(struct file *filp)\n{\nint ret = 0;\nstruct binder_proc *proc = filp-&gt;private_data;\nstruct binder_context *context = proc-&gt;context;\nstruct binder_node *new_node;\nkuid_t curr_euid = current_euid();\nmutex_lock(&amp;context-&gt;context_mgr_node_lock);\nif (context-&gt;binder_context_mgr_node) {\npr_err(\"BINDER_SET_CONTEXT_MGR already set\\n\");\nret = -EBUSY;\ngoto out;\n}\nret = security_binder_set_context_mgr(proc-&gt;tsk);\nif (ret &lt; 0)\ngoto out;\nif (uid_valid(context-&gt;binder_context_mgr_uid)) {\nif (!uid_eq(context-&gt;binder_context_mgr_uid, curr_euid)) {\npr_err(\"BINDER_SET_CONTEXT_MGR bad uid %d != %d\\n\",\nfrom_kuid(&amp;init_user_ns, curr_euid),\nfrom_kuid(&amp;init_user_ns,\ncontext-&gt;binder_context_mgr_uid));\nret = -EPERM;\ngoto out;\n}\n} else {\ncontext-&gt;binder_context_mgr_uid = curr_euid;\n}\nnew_node = binder_new_node(proc, NULL);\nif (!new_node) {\nret = -ENOMEM;\ngoto out;\n}\nbinder_node_lock(new_node);\nnew_node-&gt;local_weak_refs++;\nnew_node-&gt;local_strong_refs++;\nnew_node-&gt;has_strong_ref = 1;\nnew_node-&gt;has_weak_ref = 1;\ncontext-&gt;binder_context_mgr_node = new_node;\nbinder_node_unlock(new_node);\nbinder_put_node(new_node);\nout:\nmutex_unlock(&amp;context-&gt;context_mgr_node_lock);\nreturn ret;\n}\n</code></pre>"},{"location":"front-end/android/daily/binder/#424sm","title":"4.2.4.\u8bbe\u7f6eSM\u5faa\u73af","text":"<p>\u5728main.cpp\u7684main\u51fd\u6570\u4e2d\uff0c\u7ee7\u7eed\u8c03\u7528\u751f\u6210looper\uff0c\u8fdb\u5165\u5faa\u73af\uff1a</p> <pre><code>    //frameworks/native/cmds/servicemanager/main.cpp\nint main(int argc, char** argv) {\n......\nsp&lt;Looper&gt; looper = Looper::prepare(false /*allowNonCallbacks*/);\nBinderCallback::setupTo(looper);\nClientCallbackCallback::setupTo(looper, manager);\nwhile(true) {\nlooper-&gt;pollAll(-1);\n}\n// should not be reached\nreturn EXIT_FAILURE;\n}\n</code></pre> <p>\u770b\u4e00\u4e0bBinderCallback\u5b9a\u4e49\uff1a</p> <pre><code>//frameworks/native/cmds/servicemanager/main.cpp\nclass BinderCallback : public LooperCallback{\npublic:\nstatic sp&lt;BinderCallback&gt; setupTo(const sp&lt;Looper&gt;&amp; looper){\nsp&lt;BinderCallback&gt; cb = sp&lt;BinderCallback&gt;::make();\nint binder_fd = -1;\nIPCThreadState::self()-&gt;setupPolling(&amp;binder_fd);\nint ret = looper-&gt;addFd(binder_fd, Looper::POLL_CALLBACK, Looper::EVENT_INPUT, cb, nullptr);\nreturn cb;\n}\nint handleEvent(int/*fd*/, int/*events*/, void*/*data*/) override{\nIPCThreadState::self()-&gt;handlePolledCommands();\nreturn 1; // Continue receiving callbacks;\n}\n}\n</code></pre> <p>looper\u5c06binder\u7684fd\u6dfb\u52a0\u8fdb\u53bb\uff0c\u76d1\u542cfd\u7684\u6d88\u606f\uff0c\u5982\u679c\u6709\u6d88\u606f\uff0c\u5c31\u4f1a\u89e6\u53d1looper\u56de\u8c03handleEvent\u65b9\u6cd5\uff0c\u63a5\u7740\u8c03\u7528IPCThreadState\u91cc\u9762\u7684handlePolledCommands\u6765\u5904\u7406\u6d88\u606f\uff1a</p> <pre><code>//frameworks/native/libs/binder/IPCThreadState.cpp\nstatus_t IPCThreadState::handlePolledCommands(){\nstatus_t result;\ndo{\nresult = getAndExecuteCommand();\n}while(mIn.dataPosition() &lt; mIn.dataSize());\nprocessPendingDerefs();\nflushCommands();\nreturn result;\n}\n</code></pre>"},{"location":"front-end/android/daily/binder/#425","title":"4.2.5.\u603b\u7ed3\u6d41\u7a0b","text":"<p>\u7efc\u4e0a\uff0c\u6574\u4e2aSM\u521d\u59cb\u5316\u6d41\u7a0b\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#_9","title":"\u7b2c\u4e94\u8282\uff1a\u89e3\u6790\u6846\u67b6","text":"<p>\u7ecf\u8fc7\u4e0a\u9762\u4e00\u8282\u73af\u5883\u521d\u59cb\u5316\u5b8c\u6210\u540e\uff0cbinder\u9a71\u52a8\u5df2\u7ecf\u51c6\u5907\u5c31\u7eea\uff0cServiceManager\u670d\u52a1\u4e5f\u542f\u52a8\u8d77\u6765\uff0c\u7b49\u5f85client\u7684\u8bf7\u6c42\uff0c\u540c\u65f6\uff0cServiceManager\u5728binder\u9a71\u52a8\u4e2d\u4e5f\u5bf9\u5e94\u6709\u4e00\u4e2abinder_proc\u5bf9\u8c61\uff0c\u8fd8\u6709\u4e00\u4e2abinder_node\u7ed3\u6784\u4f53\uff0c\u540d\u5b57\u4e3abinder_context_mgr_node\u3002</p>"},{"location":"front-end/android/daily/binder/#51","title":"5.1\u6846\u67b6\u4e2d\u7684\u4e3b\u8981\u7ed3\u6784\u4f53","text":"<p>\u6709\u4e9b\u8bfb\u8005\u53ef\u80fd\u4f1a\u6709\u7591\u95ee\uff0c\u7528\u6237\u8fdb\u7a0b\u548cbinder\u9a71\u52a8\u5230\u5e95\u662f\u600e\u6837\u8fdb\u884c\u6c9f\u901a\u7684\uff1f\u5177\u4f53\u662f\u54ea\u4e9b\u7c7b\u6216\u8005\u5bf9\u8c61\u5728\u5176\u4e2d\u8d77\u4f5c\u7528\u5462\uff1f</p> <p>\u7528\u6237\u8fdb\u7a0b\u548cbinder\u9a71\u52a8\u79bb\u5f97\u6700\u8fd1\u7684\uff0c\u5176\u5b9e\u662f**ProcessState**\u548c**IPCThreadState**\uff0c\u5c5e\u4e8enative\u5c42\uff0cProcessState\u4ee3\u8868\u5728\u7528\u6237\u8fdb\u7a0b\u4e2d\u7684\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u7528\u6237\u8fdb\u7a0b\u6709\u4e14\u53ea\u6709\u4e00\u4e2aProcessState\u5bf9\u8c61\uff0c\u5c5e\u4e8e\u5355\u4f8b\u3002IPCThreadState\u4ee3\u8868\u5728\u7528\u6237\u8fdb\u7a0b\u4e2d\u64cd\u4f5cbinder\u7684\u7ebf\u7a0b\u5bf9\u8c61\u3002IPCThreadState\u5bf9\u8c61\u4e2d\u4e3b\u8981\u901a\u8fc7**transact()** \u51fd\u6570\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u4e0ebinder\u9a71\u52a8\u8fdb\u884c\u6c9f\u901a\u3002</p> <p>\u7cfb\u7edf\u8c03\u7528\u4e3b\u8981\u4f7f\u7528\u7684\u662f**ioctl()**\uff0c\u8fd9\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u5c31\u627f\u62c5\u4e86\u8bfb\u4efb\u52a1\u548c\u5199\u4efb\u52a1\uff0c\u4f7f\u7528\u8d77\u6765\u6bd4\u8f83\u65b9\u4fbf\u3002</p> <p>\u5f53ProcessState\u5bf9\u8c61\u521b\u5efa\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528open()\u6765\u6253\u5f00binder\u9a71\u52a8\uff0c\u5e76\u4e14\u5728binder\u9a71\u52a8\u4e2d\u521b\u5efa\u5bf9\u5e94\u7684**binder_proc**\u7ed3\u6784\u4f53\u5bf9\u8c61\u3002\u5982\u679c\u6709\u591a\u4e2a\u7528\u6237\u8fdb\u7a0b\uff0c\u90a3\u4e48\u5728binder\u9a71\u52a8\u4e2d\u5c31\u4f1a\u5b58\u5728\u591a\u4e2abinder_proc\u7ed3\u6784\u4f53\u5bf9\u8c61\uff0c\u8fd9\u4e9bbinder_proc\u5bf9\u8c61\u4fdd\u5b58\u5728**binder_procs**\u94fe\u8868\u4e2d\u3002</p> <p>\u7531\u4e8ebinder\u9a71\u52a8\u4e2d\u53ef\u4ee5\u5e76\u53d1\u7684\u5904\u7406\u7528\u6237\u8fdb\u7a0b\u7684\u8bf7\u6c42\uff0c\u6240\u4ee5binder\u9a71\u52a8\u4e2d\u6bcf\u4e00\u4e2abinder_proc\u5bf9\u8c61\u4e2d\u6709\u591a\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406\u8bf7\u6c42\u4e1a\u52a1\u3002\u8fd9\u4e9b\u7ebf\u7a0b\u7ed3\u6784\u4f53\u4e3a**binder_thread**\uff0c\u5b83\u4eec\u4fdd\u5b58\u5728\u7ea2\u9ed1\u6811\u7ed3\u6784\u7684threads\u5bf9\u8c61\u4e2d\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>\u6bcf\u4e00\u4e2abinder_proc\u4e2d\u7684todo\u5217\u8868\u8868\u793a\u5c06\u8981\u505a\u7684\u5de5\u4f5c\uff0c\u5176\u4e2d\u4fdd\u5b58\u7684\u662fbinder_work\u7ed3\u6784\u4f53\uff0c\u7c7b\u4f3c\u7684\uff0c\u6bcf\u4e00\u4e2abinder_thread\u7ed3\u6784\u4f53\u4e2d\u4e5f\u6709\u4e00\u4e2atodo\u5217\u8868\uff0c\u5217\u8868\u4e2d\u4e5f\u662f\u4fdd\u5b58\u7740\u4e00\u4e2a\u4e2abinder_work\u7ed3\u6784\u4f53\u3002</p> <p>\u4e0d\u8bba\u5bf9\u4e8eServiceManager\u670d\u52a1\uff0c\u8fd8\u662fClient\u8fdb\u7a0b\uff0c\u5b83\u4eec\u548cbinder\u9a71\u52a8\u4ea4\u4e92\u90fd\u662f\u4f7f\u7528\u7684\u8fd9\u4e9b\u5bf9\u8c61\u3002</p> <p>\u628a\u4ee5\u4e0a\u6982\u5ff5\u7684\u5173\u7cfb\u6574\u7406\u4e00\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u8fd9\u5f20\u56fe\u6765\u8868\u793a\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#52","title":"5.2\u6846\u67b6\u4e2d\u4f20\u8f93\u7684\u6570\u636e","text":"<p>\u524d\u6587\u8bf4\u4e86\uff0c\u7cfb\u7edf\u8c03\u7528ioctl()\u65e2\u627f\u62c5\u4e86\u5199\u4efb\u52a1\uff0c\u53c8\u517c\u6709\u8bfb\u7684\u529f\u80fd\uff0c\u90a3\u4e48\u5b83\u662f\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f\u8fd9\u5c31\u4f9d\u8d56\u4e8e\u5b83\u7684\u53c2\u6570\u2014\u2014binder_write_read\u3002\u5b83\u7684\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p></p> <p>\u5982\u679cclient\u8981\u5411binder\u9a71\u52a8\u53d1\u9001\u6570\u636e\uff0c\u90a3\u4e48client\u5c31\u4f1a\u586b\u5145write_size\u548cwrite_buffer\uff08\u53c2\u8003\u4ee3\u7801talkWithDriver\uff09\uff0c\u8fd9\u6837\u901a\u8fc7ioctl()\u8c03\u7528\u5230binder\u9a71\u52a8\u4e2d\u65f6\uff0cbinder\u9a71\u52a8\u901a\u8fc7copy_from_user()\u5c06client\u7684bwr\u6570\u636e\u62f7\u8d1d\u5230binder\u9a71\u52a8\u4e2d\u7684bwr\u4e2d\uff0c\u7136\u540e\u5224\u65ad\u5982\u679cbwr\u7684write_size\u5927\u4e8e0\u7684\u8bdd\uff0c\u8bf4\u660eclient\u8981\u5411binder\u9a71\u52a8\u53d1\u9001\u6570\u636e\uff0cbinder\u9a71\u52a8\u5c31\u4ecewrite_buffer\u4e2d\u5c06\u6570\u636e\u8bfb\u53d6\u51fa\u6765\u8fdb\u884c\u5904\u7406\uff0c\u5b8c\u6210\u4e00\u6b21\u6570\u636e\u4f20\u9012\uff08\u53c2\u8003\u4ee3\u7801binder_ioctl_write_read\uff09\u3002</p> <p>\u7531\u4e8ebinder\u6846\u67b6\u4e2d\u5404\u5bf9\u8c61\u5173\u7cfb\u590d\u6742\uff0c\u6211\u4eec\u7ee7\u7eed\u901a\u8fc7\u4e00\u5f20\u7ecf\u5178\u7f51\u56fe\u6765\u6574\u7406\u4e00\u4e0b\u5176\u4e2d\u7684\u76f8\u4e92\u5173\u7cfb\uff1a</p> <p></p> <p>\u524d\u9762\u7ae0\u8282\u6211\u4eec\u5df2\u7ecf\u5bf9\u67d0\u4e9b\u6982\u5ff5\u6709\u6240\u6d89\u53ca\uff0c\u6211\u4eec\u8fd9\u91cc\u518d\u8865\u5145\u4e00\u4e0b\u5176\u4e2d\u7684\u4e00\u4e9b\u91cd\u8981\u6982\u5ff5\uff1a</p>"},{"location":"front-end/android/daily/binder/#1binder","title":"1.binder\u5b9e\u4f53","text":"<p>binder\u5b9e\u4f53\u662f\u5404\u4e2aserver\u548cServiceManager\u5728\u5185\u6838\u4e2d\u7684\u8868\u73b0\u5f62\u5f0f\u3002binder\u5b9e\u4f53\u5728\u5185\u6838\u4e2d\u662fbinder_node\u7ed3\u6784\u4f53\u7684\u5bf9\u8c61\u3002\u5b83\u7684\u4f5c\u7528\u662f\u5728\u5185\u6838\u4e2d\u4fdd\u5b58server\u548cServiceManager\u7684\u4fe1\u606f\uff0c\u6bd4\u5982binder\u5b9e\u4f53\u4e2d\u4fdd\u5b58\u4e86server\u5bf9\u8c61\u5728\u7528\u6237\u7a7a\u95f4\u7684\u5730\u5740\u3002\u5185\u6838\u53ef\u4ee5\u901a\u8fc7binder\u5b9e\u4f53\u627e\u5230\u7528\u6237\u7a7a\u95f4\u7684server\u5bf9\u8c61\u3002</p> <p>binder_node\u7ed3\u6784\u4f53\u63cf\u8ff0\uff1a</p> <pre><code>//kernel/drivers/android/binder.c\n/**\n * struct binder_node - binder node bookkeeping\n * Bookkeeping structure for binder nodes.\n */\nstruct binder_node {\nint debug_id;                 //@debug_id:             unique ID for debugging.(invariant after initialized)\nspinlock_t lock;              //@lock:                 lock for node fields\nstruct binder_work work;      //@work:                 worklist element for node work.(protected by @proc-&gt;inner_lock)\nunion {\nstruct rb_node rb_node;     //@rb_node:              element for proc-&gt;nodes tree.(protected by @proc-&gt;inner_lock)\nstruct hlist_node dead_node;//@dead_node:            element for binder_dead_nodes list.(protected by binder_dead_nodes_lock)\n};\nstruct binder_proc *proc;     //@proc:                 binder_proc that owns this node.(invariant after initialized)\nstruct hlist_head refs;       //@refs:                 list of references on this node.(protected by @lock)\nint internal_strong_refs;     //@internal_strong_refs: used to take strong references when initiating a transaction.(protected by proc-&gt;inner_lock if proc and by lock)\nint local_weak_refs;          //@local_weak_refs:      weak user refs from local process.(protected by proc-&gt;inner_lock if proc and by lock)\nint local_strong_refs;        //@local_strong_refs:    strong user refs from local process.(protected by proc-&gt;inner_lock if proc and by lock)\nint tmp_refs;                 //@tmp_refs:             temporary kernel refs.(protected by @proc-&gt;inner_lock while @proc is valid, and by binder_dead_nodes_lock if @proc is NULL. During inc/dec and node release it is also protected by @lock to provide safety as the node dies and @proc becomes NULL)\nbinder_uintptr_t ptr;         //@ptr:                  userspace pointer for node.(invariant, no lock needed)\nbinder_uintptr_t cookie;      //@cookie:               userspace cookie for node.(invariant, no lock needed)\nstruct {\n/*\n     * bitfield elements protected by\n     * proc inner_lock\n     */\nu8 has_strong_ref:1;        //@has_strong_ref:       userspace notified of strong ref.(protected by @proc-&gt;inner_lock if @proc and by @lock)\nu8 pending_strong_ref:1;    //@pending_strong_ref:   userspace has acked notification of strong ref.(protected by @proc-&gt;inner_lock if @proc and by @lock)\nu8 has_weak_ref:1;          //@has_weak_ref:         userspace notified of weak ref.(protected by @proc-&gt;inner_lock if @proc and by @lock)\nu8 pending_weak_ref:1;      //@pending_weak_ref:     userspace has acked notification of weak ref.(protected by @proc-&gt;inner_lock if @proc and by @lock)\n};\nstruct {\n/*\n     * invariant after initialization\n     */\nu8 accept_fds:1;            //@accept_fds:           file descriptor operations supported for node.(invariant after initialized)\nu8 min_priority;            //@min_priority:         minimum scheduling priority.(invariant after initialized)\n};\nbool has_async_transaction;   //@has_async_transaction: async transaction to node in progress.(protected by @lock)\nstruct list_head async_todo;  //@async_todo:           list of async work items.(protected by @proc-&gt;inner_lock)\n};\n</code></pre>"},{"location":"front-end/android/daily/binder/#2binder","title":"2.binder\u5f15\u7528","text":"<p>binder\u5f15\u7528\uff0c\u662f\u5185\u6838\u4e2d\u7684binder_ref\u7ed3\u6784\u4f53\u5bf9\u8c61\uff0c\u8868\u793a\u662fbinder\u5b9e\u4f53\u7684\u5f15\u7528\uff0c\u6bcf\u4e00\u4e2abinder_ref\u90fd\u662f\u67d0\u4e00\u4e2abinder\u5b9e\u4f53\u7684\u5f15\u7528\uff0c\u901a\u8fc7binder_ref\u53ef\u4ee5\u5728\u5185\u6838\u4e2d\u627e\u5230\u5bf9\u5e94\u7684binder\u5b9e\u4f53\u3002binder_node\u548cbinder_ref\u90fd\u662f\u5185\u6838\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u3002\u6bcf\u4e00\u4e2aserver\u5728\u5185\u6838\u4e2d\u5c31\u8868\u73b0\u4e3a\u4e00\u4e2abinder\u5b9e\u4f53\uff0c\u800c\u6bcf\u4e00\u4e2aclient\u5219\u8868\u73b0\u4e3a\u4e00\u4e2abinder\u5f15\u7528\uff0c\u8fd9\u6837\uff0c\u6bcf\u4e2abinder\u5f15\u7528\u90fd\u5bf9\u5e94\u4e00\u4e2abinder\u5b9e\u4f53\uff0c\u800c\u6bcf\u4e2abinder\u5b9e\u4f53\u53ef\u4ee5\u5bf9\u5e94\u591a\u4e2abinder\u5f15\u7528\u3002</p> <p>binder_ref\u7ed3\u6784\u4f53\u63cf\u8ff0\uff1a</p> <pre><code>//kernel/drivers/android/binder.c\n/**\n * struct binder_ref - struct to track references on nodes\n * Structure to track references from procA to target node (on procB). This structure is unsafe to access without holding @proc-&gt;outer_lock.\n */\nstruct binder_ref {\n/* Lookups needed: */\n/*   node + proc =&gt; ref (transaction) */\n/*   desc + proc =&gt; ref (transaction, inc/dec ref) */\n/*   node =&gt; refs + procs (proc exit) */\nstruct binder_ref_data data;     //@data: binder_ref_data containing id, handle, and current refcounts\nstruct rb_node rb_node_desc;     //@rb_node_desc: node for lookup by @data.desc in proc's rb_tree\nstruct rb_node rb_node_node;     //@rb_node_node: node for lookup by @node in proc's rb_tree\nstruct hlist_node node_entry;    //@node_entry:  list entry for node-&gt;refs list in target node. (protected by @node-&gt;lock)\nstruct binder_proc *proc;        //@proc: binder_proc containing ref\nstruct binder_node *node;        //@node: binder_node of target node. When cleaning up a ref for deletion in binder_cleanup_ref, a non-NULL node indicates the node must be freed\nstruct binder_ref_death *death;  //@death:pointer to death notification (ref_death) if requested. (protected by @node-&gt;lock)\n};\n</code></pre>"},{"location":"front-end/android/daily/binder/#3","title":"3.\u8fdc\u7a0b\u670d\u52a1","text":"<p>server\u90fd\u662f\u4ee5\u670d\u52a1\u7684\u5f62\u5f0f\u6ce8\u518c\u5230ServiceManager\u4e2d\u8fdb\u884c\u7ba1\u7406\u7684\u3002\u5982\u679c\u5c06server\u770b\u4f5c\u662f\u672c\u5730\u670d\u52a1\u7684\u8bdd\uff0c\u90a3\u4e48client\u4e2d\u7684\u8fdc\u7a0b\u670d\u52a1\u5c31\u662f\u672c\u5730\u670d\u52a1\u7684\u4ee3\u7406\uff0c\u53ef\u4ee5\u56de\u5fc6\u4e00\u4e0b\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u7684\u4ee3\u7406\u6a21\u5f0f\u5c31\u597d\u7406\u89e3\u4e86\uff0c\u8fdc\u7a0b\u670d\u52a1\u5c31\u662f\u672c\u5730\u670d\u52a1\u7684\u4e00\u4e2a\u4ee3\u7406\uff0c\u901a\u8fc7\u8be5\u8fdc\u7a0b\u670d\u52a1client\u5c31\u80fd\u548cserver\u8fdb\u884c\u901a\u4fe1\u3002</p>"},{"location":"front-end/android/daily/binder/#53-server","title":"5.3 server\u5982\u4f55\u751f\u6210\u548c\u4fdd\u5b58","text":"<p>\u8fd9\u91cc\u8fd8\u8981\u89e3\u91ca\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662fserver\u662f\u600e\u4e48\u5728ServiceManager\u91cc\u9762\u5b58\u50a8\u7684\uff0cclient\u7aef\u53c8\u662f\u600e\u6837\u62ff\u5230server\u8fdb\u800c\u8fdb\u884c\u8c03\u7528\u7684\u5462\uff1f</p> <p>server\u901a\u8fc7SM\u7684addService()\u4fdd\u5b58\u5230SM\u7684\u5217\u8868\u4e2d\uff0c\u7531\u4e8eSM\u662f\u670d\u52a1\u7684\u7ba1\u5bb6\uff0c\u91cc\u9762\u5b58\u50a8\u4e86\u5f88\u591a\u670d\u52a1\uff0c\u8fd9\u4e9b\u670d\u52a1\u5c31\u4e00\u4e2a\u96c6\u5408\u5b58\u50a8\u8d77\u6765\u3002\u8fd9\u4e2a\u96c6\u5408\u53ebServiceMap\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>///frameworks/native/cmds/servicemanager/ServiceManager.cpp\nusing ServiceMap = std::map&lt;std::string, Service&gt;;\nstruct Service {\nsp&lt;IBinder&gt; binder; // not null\nbool allowIsolated;\nint32_t dumpPriority;\nbool hasClients = false; // notifications sent on true -&gt; false.\nbool guaranteeClient = false; // forces the client check to true\npid_t debugPid = 0; // the process in which this service runs\n// the number of clients of the service, including servicemanager itself\nssize_t getNodeStrongRefCount();\n};\n</code></pre> <p>addService()\u63a5\u53e3\u4e3b\u8981\u67092\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u662fstring\uff0c\u8868\u793a\u670d\u52a1\u7684\u540d\u5b57\uff0c\u4e00\u4e2a\u662f\u670d\u52a1\u672c\u8eab\uff0c\u8fd9\u6837\u5728map\u4e2d\u5c31\u4ee5\"\u540d\u5b57\"\u548c\"\u670d\u52a1\"\u6620\u5c04\u8d77\u6765\uff0cclient\u7aef\u5728\u83b7\u53d6\u670d\u52a1\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u53ef\u4ee5\u901a\u8fc7\"\u540d\u5b57\"\u5c31\u53ef\u4ee5\u65b9\u4fbf\u7684\u83b7\u53d6\u5230\u5bf9\u5e94\u7684\u670d\u52a1\u3002\u6211\u4eec\u89c2\u5bdfService\u7ed3\u6784\u4f53\uff0c\u53d1\u73b0\u6700\u5173\u952e\u7684\u5c5e\u6027\u5c31\u662fbinder\uff0c\u5b83\u662f\u4e00\u4e2aIBinder\u63a5\u53e3\u7c7b\u578b\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u201c\u670d\u52a1\u201d\u90fd\u662f\u4e00\u4e2aIBinder\u7684\u5b9e\u73b0\u5417\uff1f\u6211\u4eec\u4ee5\u719f\u6089\u7684ActivityManagerService\u4e3a\u4f8b\u770b\u4e00\u4e0b\u3002</p> <pre><code>//frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java\npublic class ActivityManagerService extends IActivityManager.Stub{\n......\n}\n</code></pre> <p>AMS\u7ee7\u627f\u4e8eIActivityManager.Stub\uff0cIActivityManager\u8fd9\u4e2ajava\u7c7b\u6211\u4eec\u627e\u4e0d\u5230\uff0c\u53ea\u627e\u5230IActivityManager.aidl\uff0caidl\u6587\u4ef6\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u7f16\u8bd1\u751f\u6210IActivityManager.java\u6587\u4ef6\uff0c\u6211\u4eec\u770b\u4e00\u4e0b\uff1a</p> <pre><code>//gen/android/app/IActivityManager.java\npublic interface IActivityManager extends android.os.IInterface{\n/** Local-side IPC implementation stub class. */\npublic static abstract class Stub extends android.os.Binder implements android.app.IActivityManager{\nprivate static final java.lang.String DESCRIPTOR = \"android.app.IActivityManager\";\nstatic final int TRANSACTION_startActivity = (android.os.IBinder.FIRST_CALL_TRANSACTION + 7);\n/** Construct the stub at attach it to the interface. */\npublic Stub(){\nthis.attachInterface(this, DESCRIPTOR);\n}\n/** Cast an IBinder object into an android.app.IActivityManager interface, generating a proxy if needed. */\npublic static android.app.IActivityManager asInterface(android.os.IBinder obj){\nif(obj==null){return null;}\nandroid.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);\nif(iin!=null &amp;&amp; (iin instanceof android.app.IActivityManager)){\nreturn (android.app.IActivityManager)iin;\n}\nreturn new android.app.IActivityManager.Stub.Proxy(obj);\n}\n@Override public android.os.IBinder asBinder(){\nreturn this;\n}\n@Override public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException{\njava.lang.String descriptor = DESCRIPTOR;\nswitch(code){\ncase TRANSACTION_startActivity:{\ndata.enforceInterface(descriptor);\nandroid.app.IApplicationThread _arg0;\n_arg0 = android.app.IApplicationThread.Stub.asInterface(data.readStrongBinder());\njava.lang.String _arg1;\n_arg1 = data.readString();\n......\nint _result = this.startActivity(_arg0, _arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7, _arg8, _arg9);\nreply.writeNoException();\nreply.writeInt(_result);\nreturn true;\n}\n}\n}\nprivate static class Proxy implements android.app.IActivityManager{\nprivate android.os.IBinder mRemote;\nProxy(android.os.IBinder remote){ mRemote = remote;\n}\n@Override public android.os.IBinder asBinder(){return mRemote;}\npublic java.lang.String getInterfaceDescriptor(){return DESCRIPTOR;}\npublic static android.app.IActivityManager sDefaultImpl;\n@Override public int startActivity(android.app.IApplicationThread caller, java.lang.String callingPackage, android.content.Intent intent, java.lang.String resolvedType, android.os.IBinder resultTo, java.lang.String resultWho, int requestCode, int flags, android.app.ProfilerInfo profilerInfo, android.os.Bundle options) throws android.os.RemoteException{\n......\nboolean _status = mRemote.transact(Stub.TRANSACTION_startActivity, _data, _reply, 0);\nif(!_status &amp;&amp; getDefaultImpl()!=null){\nreturn getDefaultImpl().startActivity(caller, callingPackage, intent, resolvedType, resultTo, resultWho, requestCode, flags, profiler, options);\n}\nreturn _result;\n}\n}\npublic static android.app.IActivityManager getDefaultImpl(){\nreturn Stub.Proxy.sDefaultImpl;\n}\n}\npublic int startActivity(android.app.IApplicationThread caller, java.lang.String callingPackage, android.content.Intent intent, java.lang.String resolvedType, android.os.IBinder resultTo, java.lang.String resultWho, int requestCode, int flags, android.app.ProfilerInfo profilerInfo, android.os.Bundle options) throws android.os.RemoteException;\n}\n</code></pre> <p>\u6211\u4eec\u770b\u5230Sub\u8fd9\u4e2a\u5185\u90e8\u7c7b\u662f\u7ee7\u627f\u4e8eandroid.os.Binder\u7684\u3002\u800candroid.os.Binder\u662f\u5b9e\u73b0\u4e86android.os.IBinder\u7684\u3002</p> <pre><code>//frameworks/base/core/java/android/os/Binder.java\npublic class Binder implements IBinder{\n......\n}\n</code></pre> <p>\u800candroid.os.IBinder\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\u3002</p> <pre><code>//frameworks/base/core/java/android/os/IBinder.java\npublic interface IBinder{\n}\n</code></pre> <p>\u7ee7\u627f\u5173\u7cfb\u5982\u4e0b\uff1a</p> <p></p> <p>\u5176\u5b9e\uff0c\u6574\u4e2abinder\u67b6\u6784\u5728java\u5c42\uff0cjni\u5c42\uff0cnative\u5c42\u90fd\u6709\u8bbe\u8ba1\uff0c\u4e3a\u4e86\u8ba9\u5f00\u53d1\u8005\u66f4\u65b9\u4fbf\u7684\u4f7f\u7528binder\uff0c\u4e3a\u4e86\u5bf9\u4e0a\u5c42\u66f4\u900f\u660e\uff0cgoogle\u4e0b\u4e86\u4e00\u76d8\u5927\u68cb\u3002</p> <p>\u5982\u679c\u628abinder\u6309\u7167java\u5c42\u548cnative\u5c42\u5212\u5206\uff0c\u90a3\u4e48\uff1a</p> <p>\u5728java\u5c42\u9762\uff0cbinder\u7ee7\u627f\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728native\u5c42\u9762\uff0cbinder\u7684\u7ee7\u627f\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6309\u7167client\u7aef\u548cserver\u7aef\u5212\u5206\uff1a</p> <ul> <li>\u5728java\u5c42\u9762\uff0cclient\u7aef\u8981\u8bbf\u95eeserver\u7aef\uff0c\u6301\u6709\u7684\u662f**BinderProxy**\u4ee3\u7406\uff0c\u5728server\u7aef\u662f**Binder**\u3002</li> <li>\u5728native\u5c42\u9762\uff0cclient\u7aef\u662f**BpBinder**\u4ee3\u7406\uff0c\u5728server\u7aef\u662f**BBinder**\u3002</li> <li>java\u5c42\u548cnative\u5c42\u4e4b\u95f4\u901a\u8fc7**Jni**\u5c42\u9762\u8fdb\u884c\u8854\u63a5\u3002</li> </ul> <p>\u4ece\u53e6\u4e00\u4e2a\u89d2\u5ea6\u770b\uff0c\u5982\u679c\u628abinder\u6309\u7167\u5ba2\u6237\u7aef\u8fdb\u7a0b\u548c\u670d\u52a1\u7aef\u8fdb\u7a0b\u5212\u5206\uff0c\u90a3\u4e48client\u7aef\u548cserver\u7aef\u6709\u4e0d\u540c\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u5176\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#54","title":"5.4 \u5bf9\u8c61\u5982\u4f55\u4f20\u9012","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c \u540c\u8fdb\u7a0b\u5185\u7684\u5bf9\u8c61\u4f20\u9012\u4e00\u822c\u662f\u4f20\u9012\u5f15\u7528\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a\u5185\u5b58\u5730\u5740\uff0c\u4f46\u662f\u5bf9\u4e8e\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff0c\u5f15\u7528\u4f20\u9012\u5c31\u4e0d\u80fd\u4f7f\u7528\u4e86\uff0c\u7531\u4e8e\u865a\u62df\u5185\u5b58\u5730\u5740\u7684\u5b58\u5728\uff0c\u4e0d\u540c\u7684\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6240\u4ee5\u8fdb\u7a0b\u95f4\u4f20\u9012\u5730\u5740\u503c\u662f\u65e0\u6548\u7684\u3002\u8fd9\u91cc\u5c31\u662f\u6d89\u53ca\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u4e86\u3002\u5728android\u4e2d\uff0c\u6700\u5e38\u7528\u7684\u5c31\u662fParcel\u4e86\u3002\u5728binder\u8fdb\u884c\u8de8\u8fdb\u7a0b\u901a\u4fe1\u65f6\uff0c\u901a\u5e38\u4f1a\u5c06\u6570\u636e\u6253\u5305\u5728Parcel\u5bf9\u8c61\u4e2d\uff0c\u7136\u540e\u901a\u8fc7binder\u9a71\u52a8\u8fdb\u884c\u4f20\u9012\u3002</p> <p>Parcel\u5b57\u9762\u610f\u601d\u5c31\u662f\u6253\u5305\u7684\u610f\u601d\uff0c\u5bf9\u4e8e\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982string,int\u7b49\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\u5230parcel\u4e2d\uff0c\u4f46\u5b9e\u9645\u4f20\u8f93\u8fc7\u7a0b\u4e0d\u662f\u771f\u6b63\u5c06\u8fd9\u4e9b\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4f20\u9012\u8fc7\u53bb\u4e86\uff0c\u8fd8\u662f\u503c\u4f20\u9012\u3002\u5bf9\u4e8e\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\uff0c\u9700\u8981\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u3002\u6211\u4eec\u6253\u4e2a\u6bd4\u65b9\uff0c\u6bd4\u5982\u6211\u4eec\u7528\u4e00\u4e2a\u4f20\u771f\u673a\u53d1\u9001\u4e00\u4e2a\u7eb8\u76d2\u5b50\u5230\u8fdc\u65b9\uff0c\u5148\u662f\u5c06\u4e09\u7ef4\u7eb8\u76d2\u5b50\u201c\u62cd\u6241\u201d\u6210\u4e8c\u7ef4\u5e73\u9762\u7eb8\u76d2\u5b50\uff0c\u518d\u901a\u8fc7\u4f20\u771f\u673a\u4f20\u771f\u5230\u8fdc\u7aef\uff0c\u8fdc\u7aef\u518d\u5c06\u4e8c\u7ef4\u5e73\u9762\u7684\u7eb8\u76d2\u5b50\u201c\u8fd8\u539f\u201d\u6210\u4e00\u4e2a\u4e09\u7ef4\u7684\u7eb8\u76d2\u5b50\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u5177\u4f53\u5b9e\u73b0\u7684\u8bdd\uff0cflatten\u8fc7\u7a0b\u4e3b\u8981\u5c31\u662fPacel\u7684writeStrongBinder()\u7684\u5b9e\u73b0\uff1a</p> <pre><code>//frameworks/native/libs/binder/Parcel.cpp\nstatus_t Parcel::writeStrongBinder(const sp&lt;IBinder&gt;&amp; val){\nreturn flattenBinder(val);\n}\n</code></pre> <p>\u4ecejava\u5c42\u5230native\u5c42\u7684\u8c03\u7528\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u76f8\u5bf9\u5e94\u7684\uff0c\u5728\u8fdc\u7aef\u9700\u8981\u6709unflatten\u7684\u8fc7\u7a0b\uff1a</p> <pre><code>//frameworks/native/libs/binder/Parcel.cpp\nstatus_t Parcel::readNullableStrongBinder(sp&lt;IBinder* val) const{\nreturn unflattenBinder(val);\n}\n</code></pre> <p>\u4ecejava\u5c42\u8c03\u7528\u5230native\u5c42\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u5bf9\u8c61\u6253\u5305\u597d\u4e4b\u540e\uff0c\u4ece\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u4e4b\u95f4\u4f20\u8f93\u4f7f\u7528\u5982\u4e0b\u4e24\u4e2a\u63a5\u53e3\uff1a</p> copy_from_user() Copy a block of data from user space to kernel space. kernel/lib/usercopy.c copy_to_user() User context only. Copy data from kernel space to user space. kernel/lib/usercopy.c"},{"location":"front-end/android/daily/binder/#55client-server","title":"5.5client-server\u4ea4\u4e92\u6a21\u578b\uff1a","text":"<p>\u4e0b\u9762\u8be6\u7ec6\u8bf4\u4e00\u4e0bclient\u8fdb\u7a0b\u548cserver\u8fdb\u7a0b\u662f\u5982\u4f55\u901a\u8fc7binder\u9a71\u52a8\u8fdb\u884c\u4ea4\u4e92\u7684\u3002</p> <ol> <li>server\u8fdb\u7a0b\u542f\u52a8\u4e4b\u540e\uff0c\u4f1a\u8fdb\u5165\u4e2d\u65ad\u7b49\u5f85\u72b6\u6001\uff0c\u7b49\u5f85client\u7684\u8bf7\u6c42\u3002</li> <li>\u5f53client\u9700\u8981\u548cserver\u901a\u4fe1\u65f6\uff0c\u4f1a\u5c06\u8bf7\u6c42\u53d1\u9001\u7ed9binder\u9a71\u52a8\u3002</li> <li>binder\u9a71\u52a8\u6536\u5230\u8bf7\u6c42\u4e4b\u540e\uff0c\u4f1a\u5524\u9192server\u8fdb\u7a0b\u3002</li> <li>\u540c\u65f6\uff0cbinder\u9a71\u52a8\u4f1a\u8fd4\u56de\u6d88\u606f\u7ed9client\uff0c\u544a\u8bc9client\uff1a\u5b83\u53d1\u9001\u7ed9binder\u9a71\u52a8\u7684\u8bf7\u6c42\uff0cbinder\u9a71\u52a8\u5df2\u7ecf\u63a5\u6536\u5230\u3002</li> <li>client\u5c06\u8bf7\u6c42\u53d1\u9001\u6210\u529f\u540e\uff0c\u5c31\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u7b49\u5f85server\u7684\u56de\u590d\u3002</li> <li>binder\u9a71\u52a8\u5524\u9192server\u540e\uff0c\u5c31\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9server\u8fdb\u7a0b\u3002</li> <li>server\u8fdb\u7a0b\u89e3\u6790\u51fa\u8bf7\u6c42\u7684\u5185\u5bb9\uff0c\u5e76\u5c06\u56de\u590d\u5185\u5bb9\u53d1\u9001\u7ed9binder\u9a71\u52a8\u3002</li> <li>binder\u9a71\u52a8\u6536\u5230\u56de\u590d\u4e4b\u540e\uff0c\u5524\u9192client\u8fdb\u7a0b\u3002</li> <li>\u540c\u65f6\uff0cbinder\u9a71\u52a8\u4f1a\u8fd4\u56de\u6d88\u606f\u7ed9server\uff0c\u544a\u8bc9server\uff1a\u5b83\u53d1\u9001\u7ed9binder\u9a71\u52a8\u7684\u56de\u590d\uff0cbinder\u9a71\u52a8\u5df2\u7ecf\u6536\u5230\u3002</li> <li>server\u5c06\u56de\u590d\u53d1\u9001\u6210\u529f\u540e\uff0c\u5c31\u518d\u6b21\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u7ee7\u7eed\u7b49\u5f85client\u7684\u8bf7\u6c42\u3002</li> <li>\u6700\u7ec8\uff0cbinder\u9a71\u52a8\u5c06\u56de\u590d\u8f6c\u53d1\u7ed9client\u3002</li> </ol> <p></p>"},{"location":"front-end/android/daily/binder/#amssm","title":"\u7b2c\u516d\u8282\uff1aAMS\u8bbe\u7f6e\u5230SM\u6d41\u7a0b","text":"<p>ServiceManager\u670d\u52a1\u542f\u52a8\u4e4b\u540e\uff0c\u901a\u8fc7BINDER_SET_CONTEXT_MGR\u547d\u4ee4\u5c06\u81ea\u5df1\u8bbe\u7f6e\u4e3aContextManager\uff0c\u5373\u201cService\u7684\u5927\u7ba1\u5bb6\u201d\uff0c\u8fd9\u6837\u540e\u9762\u542f\u52a8\u7684\u670d\u52a1\u5c31\u53ef\u4ee5\u901a\u8fc7ServiceManager\u6765\u7ba1\u7406\uff0c\u6bcf\u5f53Client\u9700\u8981\u4f7f\u7528Server\u7684\u529f\u80fd\u65f6\uff0c\u9996\u5148\u901a\u8fc7ServiceManager\u83b7\u53d6\u5230\u8fd9\u4e2aServer\u670d\u52a1\uff0c\u7136\u540e\u518d\u8c03\u7528Server\u7684\u76f8\u5173\u529f\u80fd\u3002</p> <p>\u6211\u4eec\u4ee5ActivityManagerService\u8fd9\u4e2a\u670d\u52a1\u4e3a\u4f8b\uff0c\u770b\u4e00\u4e0b\u5b83\u7684\u8bbe\u7f6e\u8fc7\u7a0b\u4ee5\u53caclient\u7aef\u8c03\u7528\u6d41\u7a0b\u3002</p> <p>\u6211\u4eec\u5148\u770b\u4e00\u4e0bAMS\u662f\u600e\u4e48\u8bbe\u7f6e\u5230ServiceManager\u670d\u52a1\u4e2d\u7684\u3002</p> <p>AMS\u662f\u5f00\u673a\u542f\u52a8\u7684\u7cfb\u7edf\u670d\u52a1\uff0c\u6240\u4ee5\u5728\u5f00\u673a\u8fd9\u4e00\u9636\u6bb5\u5c31\u5c06\u81ea\u5df1\u521b\u5efa\u597d\uff0c\u5e76\u8bbe\u7f6e\u5230\u4e86SM\u4e2d\u3002</p> <p>\u7cfb\u7edf\u4e3b\u8981\u670d\u52a1\u90fd\u5728framework/base/service\u6587\u4ef6\u5939\u4e0b\u9762\uff0c\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p>/frameworks/base/services</p> <p>/java/com/android/server/SystemServer.java</p> <p>/core/java/com/android/server/am/ActivityManagerService.java</p> <p>\u7cfb\u7edf\u542f\u52a8\u65f6\uff0cSystemServer.java\u4e2d\u7684run()\u65b9\u6cd5\u4f1a\u542f\u52a8\u7cfb\u7edf\u7684\u4e00\u4e9b\u670d\u52a1\uff0c\u4f1a\u4f9d\u6b21\u8c03\u7528\u4e0b\u9762\u4e09\u4e2a\u65b9\u6cd5\uff1a</p> <pre><code>//frameworks/base/services/java/com/android/server/SystemServer.java\nprivate void run() {\n......\n// Start services.\ntry {\nt.traceBegin(\"StartServices\");\nstartBootstrapServices(t);\nstartCoreServices(t);\nstartOtherServices(t);\n} catch (Throwable ex) {\nSlog.e(\"System\", \"******************************************\");\nSlog.e(\"System\", \"************ Failure starting system services\", ex);\nthrow ex;\n} finally {\nt.traceEnd(); // StartServices\n}\n......\n}\n</code></pre> <p>\u5728SystemServer.java\u7684<code>startBootstrapServices()</code>\u65b9\u6cd5\u4e2d\u9996\u5148\u521b\u5efa\u4e86AMS\u7684\u5b9e\u4f8b\uff0c\u521b\u5efa\u6700\u7ec8\u662f\u5728SystemServiceManager.java\u91cc\u9762\u901a\u8fc7newInstance\u65b9\u5f0f\u521b\u5efa\uff1a</p> <pre><code>//frameworks/base/services/core/java/com/android/server/SystemServiceManager.java\npublic final class SystemServiceManager implements Dumpable {\npublic &lt;T extends SystemService&gt; T startService(Class&lt;T&gt; serviceClass) {\nConstructor&lt;T&gt; constructor = serviceClass.getConstructor(Context.class);\nservice = constructor.newInstance(mContext);\nstartService(service);\nreturn service;\n}\n}\n</code></pre> <p>\u521b\u5efa\u4e86AMS\u5b9e\u4f8b\u4e4b\u540e \uff0c\u63a5\u7740\u8c03\u7528\u4e86AMS\u7684<code>setSystemProcess()</code>\u65b9\u6cd5\uff1a</p> <pre><code>//frameworks/base/services/java/com/android/server/SystemServer.java\nprivate void startBootstrapServices(@NonNull TimingsTraceAndSlog t) {\n......\nmActivityManagerService.setSystemProcess();\n.......\n}\n</code></pre> <p>AMS\u4e2d\u5904\u7406<code>setSystemProcess()</code>\u65b9\u6cd5\uff0c\u5c06AMS\u81ea\u8eab\u5b9e\u4f8b\u8bbe\u7f6e\u5230\u4e86ServiceManager\u4e2d\uff0c</p> <pre><code>//frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java\npublic class ActivityManagerService extends IActivityManager.Stub{\n......\npublic void setSystemProcess() {\n......\nServiceManager.addService(Context.ACTIVITY_SERVICE, this, /* allowIsolated= */ true, DUMP_FLAG_PRIORITY_CRITICAL | DUMP_FLAG_PRIORITY_NORMAL | DUMP_FLAG_PROTO);\n......\n}\n}\n</code></pre> <p>\u6211\u4eec\u6ce8\u610f\u5230ActivityManagerService\u662f\u7ee7\u627f\u4e8eIActivityManager.Stub\u8fd9\u4e2a\u7c7b\u7684\uff0c\u800cIActivityManager.Stub\u5176\u5b9e\u4e5f\u662f\u7ee7\u627f\u4e8eIBinder\u7684\uff0c\u56e0\u4e3aaddService()\u662f\u4e00\u4e2a\u901a\u7528\u63a5\u53e3\uff0c\u4efb\u4f55\u670d\u52a1\u90fd\u53ef\u4ee5\u8c03\u7528\uff0c\u6240\u4ee5\u57fa\u4e8e\u9762\u5411\u5bf9\u8c61\u539f\u7406\uff0c\u8fd9\u91cc\u8981\u7528\u7edf\u4e00\u7684IBinder\u63a5\u53e3\u6765\u4f20\u9012\uff0c\u540e\u9762\u6211\u4eec\u4f1a\u7ee7\u7eed\u4e86\u89e3\u8fd9\u70b9\u3002</p>"},{"location":"front-end/android/daily/binder/#61clientservicemanager","title":"6.1.client\u83b7\u53d6ServiceManager\u670d\u52a1","text":"<p>\u90a3\u4e48\u73b0\u5728\u95ee\u9898\u6765\u4e86\uff0cServiceManager\u662f\u4f5c\u4e3a\u4e00\u4e2a\u670d\u52a1\u5b58\u5728\u7684\uff0c\u800c\u6211\u4eec\u73b0\u5728\u662f\u5728AMS\u670d\u52a1\u4e2d\u8c03\u7528ServiceManager\u63d0\u4f9b\u7684addService()\u670d\u52a1\uff0c\u6240\u4ee5AMS\u5728\u8fd9\u91cc\u5176\u5b9e\u662f\u4f5c\u4e3aclient\u7aef\u7684\uff0c\u90a3\u5728client\u7aef\u600e\u4e48\u83b7\u53d6\u5230ServiceManager\u670d\u52a1\u5e76\u8c03\u7528\u5462\uff1f</p> <p>\u7b2c5\u8282\u8bf4\u7684BinderProxy\uff0cBpBinder\u8fd9\u4e9b\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u901a\u7528\u534f\u8bae\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u8bba\u54ea\u4e2aclient\uff0c\u54ea\u4e2aserver\u90fd\u4f1a\u7528\u5230\u8fd9\u4e9b\u5bf9\u8c61\uff0c\u4f46\u662f\u9488\u5bf9\u5177\u4f53\u7684\u670d\u52a1\uff0c\u5b83\u4eec\u6240\u5b9e\u73b0\u7684\u4e1a\u52a1\u548c\u529f\u80fd\u80af\u5b9a\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5fc5\u987b\u5728\u5176\u4e0a\u518d\u5c01\u88c5\u4e00\u5c42\uff0c\u5c06\u4e1a\u52a1\u63a5\u53e3\u548c\u4e1a\u52a1\u903b\u8f91\u5c01\u88c5\u5728\u91cc\u9762\uff0c\u6bd4\u5982client\u7aef\u7684ServerManager\uff0c\u5728java\u5c42\u6709ServiceManagerProxy\uff0c\u5728native\u5c42\u6709BpServiceManager\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5176\u4e2d\u7279\u522b\u8bf4\u660e\u4e00\u4e0b\uff0c0\u5728binder\u6846\u67b6\u4e2d\u662f\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684\u6807\u8bc6\uff0c\u5b83\u4ee3\u8868\u7684\u5c31\u662fServiceManager\u670d\u52a1\u3002</p> <p></p> <p>\u8fd9\u91cc\u4e0d\u8d34\u5177\u4f53\u4ee3\u7801\uff0c\u53ea\u901a\u8fc7\u65f6\u5e8f\u56fe\u68b3\u7406\u4e3b\u8981\u6d41\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u4ece\u6d41\u7a0b\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0cframework\u5c42\u7684ServiceManager\u7684\u5b9e\u73b0\u8c03\u7528\u5de5\u4f5c\u5176\u5b9e\u662f\u4ea4\u7ed9ServiceManagerProxy\u7684\u6210\u5458\u53d8\u91cfBinderProxy\u6765\u5904\u7406\uff0c\u800cBinderProxy\u5219\u901a\u8fc7jni\u7684\u65b9\u5f0f\uff0c\u6700\u7ec8\u4f1a\u8c03\u7528\u5230BpBinder\u5bf9\u8c61\u6765\u5904\u7406\u3002</p> <p>\u6211\u4eec\u770b\u5230\uff0cnative\u5411java\u5c42\u5bf9\u8c61\u7684\u8f6c\u6362\u662f\u901a\u8fc7Jni\u5c42\u6765\u8fdb\u884c\u6c9f\u901a\uff0cBpBinder\u8f6c\u6210BinderProxy\u53ef\u4ee5\u53c2\u8003\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#62clientaddservice","title":"6.2client\u8c03\u7528addService()","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u5206\u6790\u4e86\u4e00\u4e0b\u600e\u4e48\u5728java\u5c42\"\u83b7\u53d6\"\u5230ServiceManager\uff0c\u8fd9\u6837\u5728\u6211\u4eec\"\u62ff\u5230\"ServiceManager\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8c03\u7528\u5176addService()\u63a5\u53e3\u6765\u5b9e\u73b0\u6211\u4eec\u7684\u9700\u6c42\uff0c\u7531\u4e0a\u4e00\u8282\u6240\u77e5\uff0c\u6700\u7ec8\u6267\u884c\u4efb\u52a1\u7684\u662fnative\u5c42\u7684BpBinder\u5bf9\u8c61\u3002\u6211\u4eec\u770b\u4e00\u4e0baddService()\u7684\u6d41\u7a0b\uff1a</p> <p></p> <p>\u91cd\u70b9\u6d41\u7a0b\u8bf4\u660e\uff1a</p> <p>1.\u5728flattenBinder\u7684\u65f6\u5019\uff0clocalBinder\u4e0d\u4e3a\u7a7a\uff0c\u6240\u4ee5flat_binder_object.type\u7b49\u4e8eBINDER_TYPE_BINDER\u3002\u67e5\u770bflattenBinder\u6e90\u7801\u3002</p> <p>2.\u4ececlient\u7aef\u4f20\u9012\u5230binder\u9a71\u52a8\u7684\uff0c\u5176\u5b9e\u662f\u5728client\u7aef\u751f\u6210\u7684JavaBBinder\u5bf9\u8c61\uff0c\u800c\u4e14\u662f\u88ab\"\u62cd\u6241\u4e86\u7684\"(flatten)\u3002\u67e5\u770bJavaBBinder\u6e90\u7801\u3002</p>"},{"location":"front-end/android/daily/binder/#63binderaddservice","title":"6.3binder\u9a71\u52a8\u5904\u7406addService","text":"<p>\u4e0a\u9762\u53ea\u662f\u5728client\u7aef\u7684\u4e00\u90e8\u5206\u6d41\u7a0b\uff0c\u5728\u8c03\u7528BpBinder\u7684transaction()\u4e4b\u540e\uff0c\u5c31\u662f\u4ea4\u7ed9IPCThreadState\u53bb\u548cbinder\u9a71\u52a8\u63a5\u7740\u5904\u7406\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u89e3\u6790\u4e00\u4e0b\u5176\u4e2d\u7684\u91cd\u70b9\u6b65\u9aa4\uff1a</p> <p>1.\u901a\u8fc7copy_from_user()\u5c06client\u7aef\u7684buffer\u6570\u636e\u7b49\u62f7\u8d1d\u5230\u5185\u6838\u4e2d\u3002</p> <p>2.\u5728binder_init_node_ilocked()\u51fd\u6570\u4e2d\u521d\u59cb\u5316binder_node\u5bf9\u8c61\uff0c\u5e76\u5c06binder_node\u5bf9\u8c61\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\u8fdb\u884c\u7ba1\u7406\u3002\u67e5\u770bbinder_init_node_ilocked()\u6e90\u7801\u3002</p> <p>3.\u4e3abinder_node\u521b\u5efa\u4e00\u4e2abinder_ref\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u7684\u8bdd\u3002\u67e5\u770bbinder_get_ref_for_node_olocked()\u6e90\u7801\u3002</p> <p>4.\u901a\u8fc7binder_proc_transaction()\u51fd\u6570\u901a\u77e5ServiceManager\u670d\u52a1\u7ee7\u7eed\u5904\u7406\u3002\u67e5\u770bbinder_proc_transaction()\u6e90\u7801\u3002</p>"},{"location":"front-end/android/daily/binder/#64smaddservice","title":"6.4SM\u5904\u7406addService\u8bf7\u6c42","text":"<p>\u4e0a\u4e00\u6b65\u5524\u9192ServiceManager\u4e4b\u540e\uff0cServiceManager\u5219\u5c06binder\u4f20\u9012\u8fc7\u6765\u7684\"service\"\u8bfb\u53d6\u51fa\u6765\u4fdd\u5b58\u5230map\u4e2d\u3002</p> <p></p>"},{"location":"front-end/android/daily/binder/#clientams","title":"\u7b2c\u4e03\u8282\uff1aclient\u83b7\u53d6AMS","text":"<p>client\u83b7\u53d6AMS\u670d\u52a1\u4f7f\u7528\u7684\u662fSM\u63d0\u4f9b\u7684getService()\u63a5\u53e3\uff0c\u8fd9\u91cc\u53ef\u4ee5\u5206\u4e3a3\u4e2a\u6b65\u9aa4\uff0c</p> <p>\u7b2c1\u6b65client\u7aef\u5148\u53d1\u9001\u8bf7\u6c42\u5230binder\u9a71\u52a8\uff0c\u5524\u9192SM\uff0c\u7b49\u5f85SM\u5904\u7406\u5b8c\u6210\u3002</p> <p>\u7b2c2\u6b65\u662fSM\u5904\u7406getService()\u903b\u8f91\uff0c\u5e76\u5c06service\u8fd4\u56de\u7ed9binder\u9a71\u52a8\uff0c\u5e76\u5524\u9192client\u7ebf\u7a0b\u3002</p> <p>\u7b2c3\u6b65\uff0cbinder\u9a71\u52a8\u5c06service\u8fd4\u56de\u7ed9client\u7aef\uff0c\u6574\u4e2a\u6d41\u7a0b\u5b8c\u6bd5\u3002</p>"},{"location":"front-end/android/daily/binder/#71client","title":"7.1client\u7aef\u53d1\u9001\u8bf7\u6c42","text":"<p>\u91cd\u70b9\u6b65\u9aa4\u8bf4\u660e\uff1a</p> <p>1.ServiceManager\u9ed8\u8ba4\u662f\u5728binder\u9a71\u52a8\u4e2d\u5904\u4e8e\u4f11\u7720\u72b6\u6001\uff0c\u7b49\u5f85client\u53d1\u9001\u8bf7\u6c42\u8fc7\u6765\u5524\u9192\u5b83\u8fdb\u884c\u5904\u7406\u3002</p> <p>2.client\u7aef\u53d1\u8d77getService()\u6d41\u7a0b\u540e\uff0c\u7ecf\u8fc7ioctl()\u63a5\u53e3\u53d1\u9001write\u547d\u4ee4\uff0c\u5c06\u8bf7\u6c42\u547d\u4ee4\u7b49\u4f20\u9012\u5230binder\u9a71\u52a8\u4e2d\uff0c\u7136\u540ebinder\u9a71\u52a8\u5524\u9192ServiceManager\u7ebf\u7a0b\u8fdb\u884c\u5904\u7406\u3002</p> <p>3.\u5524\u9192SM\u540e\uff0cbinder\u9a71\u52a8\u5199\u5165BR_NOOP\u548cBR_TRANSACTION_COMPLETE\u547d\u4ee4\u901a\u8fc7copy_to_user()\u8fd4\u56de\u7ed9client\u7aef\uff0cclient\u7aef\u8bfb\u53d6\u5230\u547d\u4ee4\u540e\uff0c\u77e5\u9053SM\u5df2\u7ecf\u5728\u5904\u7406\u8bf7\u6c42\u4e86\u3002</p> <p>4.client\u7aef\u53c8\u901a\u8fc7ioctl()\u63a5\u53e3\u5411binder\u9a71\u52a8\u53d1\u9001read\u547d\u4ee4\uff0c\u5728binder_thread_read\u4e2d\u7b49\u5f85SM\u5904\u7406\u8fd4\u56de\u7684\u6570\u636e\u3002</p>"},{"location":"front-end/android/daily/binder/#72sm","title":"7.2SM\u5904\u7406\u8bf7\u6c42","text":"<p>SM\u8fdb\u7a0b\u5728\u968f\u7740\u5f00\u673a\u542f\u52a8\u540e\uff0c\u5728binder\u9a71\u52a8\u4e2d\u5904\u4e8eread\u4f11\u7720\u72b6\u6001\uff0c\u7b49\u5f85client\u7ebf\u7a0b\u6765\u5524\u9192\u5b83\u3002\u7ecf\u8fc77.1\u8282\u7684\u6b65\u9aa4\u540e\uff0cSM\u7684binder\u7ebf\u7a0b\u5c31\u88ab\u5524\u9192\u4e86\uff0c\u5904\u7406\u5b83\u7684checkService()\u5de5\u4f5c\u3002</p> <p></p> <p>\u91cd\u70b9\u6b65\u9aa4\u8bf4\u660e\uff1a</p> <p>1.SM\u7ebf\u7a0b\u88abbinder\u9a71\u52a8\u7684client\u7ebf\u7a0b\u5524\u9192\u4e4b\u540e\uff0c\u8bfb\u53d6\u5230\u4e86checkService\u7684\u547d\u4ee4\uff0c\u7136\u540eSM\u8fdb\u7a0b\u901a\u8fc7talkWithDriver()\u8bfb\u53d6\u5230\u547d\u4ee4\u8fdb\u884c\u5904\u7406\u3002\u67e5\u770bcheckService()\u6e90\u7801\u3002</p> <p>2.SM\u8fdb\u7a0b\u901a\u8fc7checkService()\u83b7\u53d6\u5230ams\u670d\u52a1\u5bf9\u8c61\uff0c\u901a\u8fc7BC_REPLY\u547d\u4ee4\u5199\u5165\u5230parcel\u4e2d\uff0c\u7136\u540e\u901a\u8fc7ioctl()\u547d\u4ee4\u901a\u77e5binder\u9a71\u52a8\u8fdb\u884c\u5904\u7406\u3002</p> <p>3.binder\u9a71\u52a8\u6536\u5230SM\u7684\u6d88\u606f\u540e\uff0c\u8bfb\u53d6\u51fa\u6570\u636e\uff0c\u7136\u540e\u5524\u9192client\u7684binder\u7ebf\u7a0b\u8fdb\u884c\u4e0b\u4e00\u6b65\u5904\u7406\uff0c\u540c\u65f6\u5c06BR_TRANSACTION_COMPLETE\u6d88\u606f\u56de\u590d\u7ed9SM\uff0c\u8868\u793aSM\u5904\u7406\u5b8c\u6210\u3002</p>"},{"location":"front-end/android/daily/binder/#73client","title":"7.3client\u6536\u5230\u8fd4\u56de\u7684\u670d\u52a1","text":"<p>\u4e0a\u4e00\u8282SM\u7aef\u5904\u7406\u5b8c\u6210\u540e\uff0cbinder\u9a71\u52a8\u4e2d\u7684SM\u7ebf\u7a0b\u5524\u9192\u4e86\u4e4b\u524d\u7b49\u5f85\u7684client\u7ebf\u7a0b\u8fdb\u884c\u4e0b\u4e00\u6b65\u5904\u7406\u3002</p> <p></p> <p>\u91cd\u70b9\u6b65\u9aa4\u8bf4\u660e\uff1a</p> <p>1.client\u7ebf\u7a0b\u7ec8\u4e8e\u4ecebinder_thread_read()\u4e2d\u88abSM\u5524\u9192\u4e86\uff0c\u7ebf\u7a0b\u901a\u8fc7copy_to_user()\u7cfb\u7edf\u8c03\u7528\u5c06\u6570\u636e\u62f7\u8d1d\u5230client\u7528\u6237\u8fdb\u7a0b\u5904\u7406\u3002</p> <p>2.client\u4ecereply\u4e2d\u8bfb\u53d6\u5230\u6570\u636e\u540e\uff0c\u901a\u8fc7ipcSetDataReference()\u5c06\u6570\u636e\u4fdd\u5b58\u5230parcel\u4e2d\uff0c\u518d\u8fd4\u56de\u7ed9\u6700\u521d\u8c03\u7528\u7684\u5730\u65b9\u5904\u7406\uff0c\u8fd9\u6837\u6574\u4e2agetService()\u6d41\u7a0b\u5c31\u7b97\u5904\u7406\u5b8c\u4e86\u3002\u67e5\u770bipcSetDataReference()\u6e90\u7801\u3002</p>"},{"location":"front-end/android/daily/binder/#74","title":"7.4\u603b\u7ed3","text":"<p>\u6211\u4eec\u56de\u5934\u770b\u770b\uff0c\u4ec5\u4ec5\u662fgetService()\u8fd9\u4e00\u4e2a\u63a5\u53e3\u7684\u8c03\u7528\uff0c\u4e2d\u95f4\u7684\u5904\u7406\u6d41\u7a0b\u5c31\u8fd9\u4e48\u5197\u957f\uff0c\u540e\u9762\u62ff\u5230\u670d\u52a1\u540e\u8fd8\u8981\u8c03\u7528\u76f8\u5173\u529f\u80fd\u63a5\u53e3\uff0c\u4e0d\u8fc7\u4e3b\u8981\u6d41\u7a0b\u90fd\u5927\u81f4\u662f\u7c7b\u4f3c\u7684\uff0c\u53ea\u662f\u4e00\u4e9b\u53c2\u6570\u548c\u547d\u4ee4\u4e0d\u4e00\u6837\uff0c\u540e\u9762\u5c31\u4e0d\u8be6\u7ec6\u8bf4\u4e86\uff0c\u901a\u8fc77.1\u8282client\u7aef\u53d1\u9001\u8bf7\u6c42\uff0c7.2\u8282\u5904\u7406\u8bf7\u6c42\uff0c7.3\u8282\u53cd\u9988\u7ed3\u679c\uff0c\u6211\u4eec\u518d\u5c06\u8fd93\u4e2a\u6b65\u9aa4\u7edf\u4e00\u6574\u5408\u4e00\u4e0b\uff0c\u5982\u4e0b\u56fe\u4ea4\u4e92\u6240\u793a\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#_10","title":"\u7b2c\u516b\u8282\uff1a\u89e3\u91ca\u4e00\u4e9b\u95ee\u9898","text":""},{"location":"front-end/android/daily/binder/#81binderipc","title":"8.1\u4e3a\u4ec0\u4e48\u4f7f\u7528binder\u673a\u5236\u4f5c\u4e3aIPC\u901a\u4fe1\u65b9\u5f0f","text":"<p>\u4f20\u7edf\u7684IPC\u65b9\u5f0f\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u7ba1\u9053\uff0csocket\uff0c\u5171\u4eab\u5185\u5b58\uff0c\u6d88\u606f\u961f\u5217\uff0c\u4fe1\u53f7\u91cf\u7b49\uff0c\u4f46\u4e3a\u4f55google\u5c31\u9009\u4e2d\u4e86binder\u4f5c\u4e3aIPC\u65b9\u5f0f\u5462\uff1f</p>"},{"location":"front-end/android/daily/binder/#1binderc-s","title":"1.binder\u53ef\u4ee5\u5f88\u597d\u7684\u5b9e\u73b0c-s\u67b6\u6784","text":"<p>android\u7cfb\u7edf\u63d0\u4f9b\u7684\u5404\u79cd\u670d\u52a1\u5b9e\u73b0\u90fd\u7531\u4e0d\u540c\u7684server\u63d0\u4f9b\uff0c\u5f53client\u9700\u8981\u83b7\u53d6\u67d0\u4e2aserver\u7684\u670d\u52a1\u65f6\uff0c\u53ea\u9700\u8981client\u5411server\u53d1\u9001\u76f8\u5e94\u7684\u8bf7\u6c42\uff0cserver\u6536\u5230\u8bf7\u6c42\u540e\u8fdb\u884c\u5904\u7406\uff0c\u518d\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9client.\u4f46\u662f\u4f20\u7edf\u7684IPC\u901a\u4fe1\u624b\u6bb5\u4e2d\uff0c\u53ea\u6709socket\u652f\u6301c-s\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u4f46\u662fsocket\u4e3b\u8981\u7528\u4e8e\u7f51\u7edc\u95f4\u901a\u4fe1\u548c\u672c\u673a\u8fdb\u7a0b\u95f4\u7684\u4f4e\u901f\u901a\u4fe1\uff0c\u4f20\u8f93\u6548\u7387\u592a\u4f4e\u3002</p>"},{"location":"front-end/android/daily/binder/#2binder_1","title":"2.binder\u7684\u4f20\u8f93\u6548\u7387\u548c\u53ef\u64cd\u4f5c\u6027\u597d","text":"<p>\u4f20\u7edf\u7684IPC\u901a\u4fe1\uff0c\u6bd4\u5982\u6d88\u606f\u961f\u5217\uff0c\u7ba1\u9053\u91c7\u7528\u7684\u5b58\u50a8-\u8f6c\u53d1\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528\u5b83\u4eec\u8fdb\u884cIPC\u901a\u4fe1\u65f6\uff0c\u9700\u8981\u7ecf\u8fc72\u6b21\u5185\u5b58\u62f7\u8d1d\uff0c\u6548\u7387\u592a\u4f4e\u3002\u800c\u91c7\u7528binder\u673a\u5236\u7684\u8bdd\uff0c\u53ea\u9700\u8981\u4e00\u6b21\u5185\u5b58\u62f7\u8d1d\u5373\u53ef\uff0c\u800c\u5171\u4eab\u5185\u5b58\u867d\u7136\u8fdb\u884c\u5185\u5b58\u62f7\u8d1d\u7684\u6b21\u6570\u4e3a0\uff0c\u4f46\u662f\u5171\u4eab\u5185\u5b58\u64cd\u4f5c\u590d\u6742\uff0c\u4e5f\u4e0d\u9002\u5408\u8fd9\u79cd\u573a\u666f\u3002\u5f53\u7136\uff0csocket\u4e5f\u8981\u5176\u9002\u7528\u7684\u573a\u666f\uff0c\u6bd4\u5982android\u7cfb\u7edf\u4e2d\u7684Input\u7cfb\u7edf\uff0c\u800c\u7ba1\u9053\u4e5f\u5728android looper\u4e2d\u53d1\u6325\u7740\u91cd\u8981\u4f5c\u7528\u3002</p>"},{"location":"front-end/android/daily/binder/#3binder","title":"3.binder\u7684\u5b89\u5168\u6027\u9ad8","text":"<p>\u4f20\u7edf\u7684IPC\u673a\u5236\u6ca1\u6709\u5b89\u5168\u63aa\u65bd\uff0c\u5b8c\u5168\u4f9d\u8d56\u4e0a\u5c42\u534f\u8bae\u6765\u4fdd\u8bc1\u3002\u63a5\u6536\u65b9\u65e0\u6cd5\u83b7\u5f97\u5bf9\u65b9\u8fdb\u7a0b\u53ef\u9760\u7684UID/PID\uff0c\u4ece\u800c\u65e0\u6cd5\u9274\u522b\u5bf9\u65b9\u8eab\u4efd\uff0c\u800cbinder\u673a\u5236\u5219\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u4e86UID/PID\u6765\u4f5c\u4e3a\u9274\u522b\u8eab\u4efd\u7684\u6807\u8bc6\uff0c\u5e76\u4e14\u5728binder\u901a\u4fe1\u65f6\u4f1a\u6839\u636eUID/PID\u8fdb\u884c\u6709\u6548\u6027\u68c0\u6d4b\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u901a\u4fe1\u7684\u5b89\u5168\u6027\uff0c\u662f\u5176\u5b83IPC\u901a\u4fe1\u65b9\u5f0f\u6240\u4e0d\u80fd\u53ca\u7684\u3002</p>"},{"location":"front-end/android/daily/binder/#82","title":"8.2\u4e00\u6b21\u62f7\u8d1d\u7684\u5177\u4f53\u542b\u4e49","text":"<p>\u6211\u4eec\u770b\u5230\u4ececlient\u5230binder\u9a71\u52a8\uff0c\u518d\u5230server \u7aef\uff0c\u6709\u5927\u91cf\u7684copy\u8fc7\u7a0b\uff0c\u4e0d\u8bba\u662fcopy_to_user()\uff0c\u8fd8\u662fcopy_from_user()\uff0c\u597d\u50cf\u62f7\u8d1d\u8fc7\u7a0b\u65e0\u5904\u4e0d\u5728\uff0c\u90a3\u4e48\u6211\u4eec\u5e38\u89c1\u7684\u8bf4binder\u7684\u4f18\u52bf\u5728\u4e8e\u4e00\u6b21\u62f7\u8d1d\uff0c\u5230\u5e95\u4f18\u5728\u4f55\u5904\u5462\uff1f\u5176\u5b9e\u8fd9\u4e2a\u62f7\u8d1d\u8bf4\u7684\u662f\u4e00\u6b21binder\u901a\u4fe1\u8fc7\u7a0b\uff0c\u5373client\u5230binder\u9a71\u52a8\uff0c\u518d\u5230server\u7aef\uff0c\u8fd9\u662f\u4e00\u6b21binder\u901a\u4fe1\u8fc7\u7a0b\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4ececlient\u628a\u6570\u636e\u62f7\u8d1d\u5230binder\u9a71\u52a8\uff0c\u662f\u4e00\u6b21\u62f7\u8d1d\u8fc7\u7a0b\uff0c\u4e0d\u8bba\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u8c03\u7528\u4e86\u591a\u5c11\u6b21copy_from_user()\uff0c\u800c\u4ecebinder\u9a71\u52a8\u5230server\uff0c\u662f\u4e00\u6b21\u6620\u5c04\u8fc7\u7a0b\uff0c\u4e0d\u7528\u62f7\u8d1d\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u4e00\u6b21\u62f7\u8d1d\u3002\u800c\u62f7\u8d1d\u7684\u6570\u636e\uff0c\u4e5f\u4ec5\u4ec5\u662f\u4e1a\u52a1\u6240\u9700\u8981\u7684parcel\u6570\u636e\uff0c\u800c\u7528\u4e8ebinder\u9a71\u52a8\u4ea4\u4e92\u7684\u4e00\u4e9b\u547d\u4ee4\u7b49\u6570\u636e\uff0c\u8fd8\u662f\u9700\u8981\u62f7\u8d1d\u7684\u3002\u5177\u4f53\u6d41\u7a0b\u53ef\u4ee5\u7528\u4e0b\u56fe\u8bf4\u660e\uff1a</p> <p></p>"},{"location":"front-end/android/daily/binder/#_11","title":"\u7ed3\u5c3e","text":"<p>binder\u67b6\u6784\u4ee3\u7801\u7e41\u591a\uff0c\u7ed3\u6784\u590d\u6742\uff0c\u8ffd\u6e90\u7801\u5f88\u5bb9\u6613\u9677\u5165\u4ee3\u7801\u7684\u91cd\u91cd\u5305\u56f4\uff0c\u65e0\u6cd5\u81ea\u62d4\uff0c\u770b\u7f51\u4e0a\u6587\u7ae0\u5197\u957f\u6ca1\u6709\u5934\u7eea\uff0c\u7ecf\u5e38\u4ece\u5165\u95e8\u5230\u653e\u5f03\uff0c\u672c\u6587\u5c06binder\u6d41\u7a0b\u5927\u81f4\u8fc7\u4e00\u904d\uff0c\u5e0c\u671b\u8bfb\u8005\u80fd\u591f\u5927\u81f4\u4e86\u89e3\u4e00\u4e0bbinder\u67b6\u6784\u3002</p>"},{"location":"front-end/android/daily/binder/#_12","title":"\u53c2\u8003\u6587\u7ae0\uff1a","text":"<p>\u5f53\u7136\uff0c\u4e00\u7bc7\u6587\u7ae0\u4e0d\u53ef\u80fd\u5c06binder\u7684\u65b9\u65b9\u9762\u9762\u90fd\u6d89\u53ca\u5230\uff0c\u672c\u7bc7\u53ea\u662f\u5e26\u9886\u5927\u5bb6\u6bd4\u8f83\u5bb9\u6613\u7684\u6478\u5230binder\u7684\u5927\u95e8\uff0c\u5982\u679c\u5927\u5bb6\u8981\u7ee7\u7eed\u6df1\u5165\u4e86\u89e3\uff0c\u4e0b\u9762\u6709\u4e00\u4e9b\u53c2\u8003\u6587\u7ae0\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5b66\u4e60\u4e00\u4e0b\uff0c\u672c\u7bc7\u6587\u7ae0\u7684\u5b8c\u6210\u4e5f\u662f\u53c2\u8003\u4e86\u4e0b\u9762\u6587\u7ae0\u7684\u4e00\u4e9b\u5185\u5bb9\uff0c\u7b97\u662f\u7ad9\u5728\u524d\u4eba\u7684\u57fa\u7840\u4e0a\u5b8c\u6210\u7684\u3002</p> <p>Binder\u4ece\u5165\u95e8\u5230\u653e\u5f03\uff08\u7ec6\u8282\u7bc7\uff09 - \u5185\u6838\u5de5\u5320 - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>Binder\u4ece\u5165\u95e8\u5230\u653e\u5f03\uff08\u6846\u67b6\u7bc7\uff09 - \u5185\u6838\u5de5\u5320 - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>Android Binder\u901a\u4fe1\u4e00\u6b21\u62f7\u8d1d\u4f60\u771f\u7684\u7406\u89e3\u4e86\u5417\uff1f_IT\u5148\u68ee-CSDN\u535a\u5ba2_binder\u901a\u4fe1\u6570\u636e\u4f1a\u62f7\u8d1d\u51e0\u6b21</p> <p>Android Binder\u6846\u67b6\u5b9e\u73b0\u4e4bBinder\u4e2d\u7684\u6570\u636e\u7ed3\u6784_IT\u5148\u68ee-CSDN\u535a\u5ba2_binder\u6570\u636e\u7ed3\u6784</p> <p>Android Bander\u8bbe\u8ba1\u4e0e\u5b9e\u73b0 - \u8bbe\u8ba1\u7bc7_universus\u7684\u4e13\u680f-CSDN\u535a\u5ba2_android binder</p> <p>Binder\u5b66\u4e60\u6307\u5357 | Weishu's Notes</p> <p>\u4e00\u7bc7\u6587\u7ae0\u4e86\u89e3\u76f8\u89c1\u6068\u665a\u7684 Android Binder \u8fdb\u7a0b\u95f4\u901a\u8baf\u673a\u5236_jeanboy-CSDN\u535a\u5ba2_android binder\u673a\u5236</p> <p>\u7ea2\u8336\u4e00\u676f\u8bddBinder\uff08\u4f20\u8f93\u673a\u5236\u7bc7_\u4e0a\uff09 - \u60a0\u7136\u7ea2\u8336\u7684\u4e2a\u4eba\u9875\u9762 - OSCHINA - \u4e2d\u6587\u5f00\u6e90\u6280\u672f\u4ea4\u6d41\u793e\u533a</p> <p>\u7ea2\u8336\u4e00\u676f\u8bddBinder\uff08\u521d\u59cb\u7bc7\uff09 - \u60a0\u7136\u7ea2\u8336\u7684\u4e2a\u4eba\u9875\u9762 - OSCHINA - \u4e2d\u6587\u5f00\u6e90\u6280\u672f\u4ea4\u6d41\u793e\u533a</p> <p>Binder\u7cfb\u5217\u2014\u5f00\u7bc7 - Gityuan\u535a\u5ba2 | \u8881\u8f89\u8f89\u7684\u6280\u672f\u535a\u5ba2</p> <p>Android\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u673a\u5236Binder\u7b80\u8981\u4ecb\u7ecd\u548c\u5b66\u4e60\u8ba1\u5212_\u8001\u7f57\u7684Android\u4e4b\u65c5-CSDN\u535a\u5ba2_android\u8fdb\u7a0b\u95f4\u901a\u4fe1</p> <p>Android\u6df1\u5165\u6d45\u51fa\u4e4bBinder\u673a\u5236 - innost - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>Android\u8de8\u8fdb\u7a0b\u901a\u4fe1IPC\u4e4b6\u2014\u2014Binder\u6846\u67b6 - \u7b80\u4e66 (jianshu.com)</p> <p>Android Binder\u539f\u7406\u4ece\u5f00\u59cb\u5230\u653e\u5f03_\u4e09\u6728\u4ed4-CSDN\u535a\u5ba2_android binder\u539f\u7406</p> <p>\u6df1\u5165Android\u7cfb\u7edf\uff08\u4e09\uff09Binder-2-\u4f7f\u7528_apigfly\u7684\u535a\u5ba2-CSDN\u535a\u5ba2</p> <p>\u4f7f\u7528 Binder IPC  |  Android \u5f00\u6e90\u9879\u76ee  |  Android Open Source Project (google.cn)</p> <p>01. Android Binder\u56fe\u89e3 \u5c0f\u7c73\u7cfb\u7edf\u4e13\u5bb6 \u89e3\u6790Service \u7684addService\u6ce8\u518c\u8fc7\u7a0b \uff08\u5b89\u535312\uff09 - \u7b80\u4e66 (jianshu.com)</p> <p>04. Android Binder\u56fe\u89e3 \u5c0f\u7c73\u7cfb\u7edf\u4e13\u5bb6 \u89e3\u6790binder\u673a\u5236 java\u5c42\uff08\u5b89\u535312\uff09 - \u7b80\u4e66 (jianshu.com)</p> <p>(11\u6761\u6d88\u606f) Android10.0 Binder\u901a\u4fe1\u539f\u7406(\u4e09)-ServiceManager\u7bc7_IngresGe\u7684\u535a\u5ba2-CSDN\u535a\u5ba2_servicemanager</p> <p>serviceManager\u4ecb\u7ecd - \u7b80\u4e66 (jianshu.com)</p> <p>\u56fe\u89e3Android\u4e2d\u7684Binder\u673a\u5236_HankingHu\u7684\u535a\u5ba2-CSDN\u535a\u5ba2_android binder</p> <p>\u6df1\u5ea6\u5256\u6790Android IPC\u539f\u7406 (qq.com)</p> <p>android\u5206\u6790\u4e4bBinder 01 - \u5f90\u5c0f\u9c7c - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u7406\u89e3Android Binder\u673a\u5236(\u2153)\uff1a\u9a71\u52a8\u7bc7 (paul.pub)</p>"},{"location":"front-end/android/daily/binder/#_13","title":"\u53c2\u8003","text":"<p>\u6458\u81eahttps://www.jianshu.com/p/a676a4378250</p>"},{"location":"front-end/android/daily/dialog_token/","title":"Dialog \u5bf9\u5e94\u7684 Context \u5fc5\u987b\u662f Activity\u5417\uff1f","text":""},{"location":"front-end/android/daily/dialog_token/#_1","title":"\u95ee\u9898","text":"<p>\u5728\u6211\u4eec\u7684\u5370\u8c61\u91cc\uff0c\u5982\u679c\u6784\u9020\u4e00\u4e2a Dialog \u4f20\u5165\u4e00\u4e2a\u975e Activiy \u7684 context\uff0c\u5219\u53ef\u80fd\u4f1a\u51fa\u73b0 bad token exception\u3002</p> <p>\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5f7b\u5e95\u641e\u6e05\u695a\u8fd9\u4e00\u5757\uff0c\u95ee\u9898\u6765\u4e86\uff1a</p> <p>1\u3001\u4e3a\u4ec0\u4e48\u4f20\u5165\u4e00\u4e2a\u975e Activity \u7684 context \u4f1a\u51fa\u73b0\u9519\u8bef\uff1f </p> <p>2\u3001\u4f20\u5165\u7684 context \u4e00\u5b9a\u8981\u662f Activity \u5417\uff1f</p>"},{"location":"front-end/android/daily/dialog_token/#_2","title":"\u89e3\u7b54","text":""},{"location":"front-end/android/daily/dialog_token/#1dialogcontextactivity","title":"1.\u5148\u6765\u770b\u7b2c\u4e8c\u95ee\uff1a\u521b\u5efaDialog\u5bf9\u8c61\u4f9d\u8d56\u7684Context\u5fc5\u987b\u662fActivity\u5417\uff1f","text":"<p>\u76f8\u4fe1\u5927\u5bb6\u66fe\u7ecf\u90fd\u6709\u9047\u5230\u8fc7\u9700\u8981\u5728Application\u6216\u8005Service\u91cc\u5f39\u51faDialog\u7684\u60c5\u666f\uff0c\u5c31\u7b97\u5e73\u65f6\u505a\u7684\u6b63\u5f0f\u9879\u76ee\u6ca1\u6709\u8fd9\u79cd\u9700\u6c42\uff0c\u90a3\u4e5f\u5e94\u8be5\u5728\u521a\u5f00\u59cb\u5b66\u4e60Android\u6216\u8005\u5199Demo\u7684\u65f6\u5019\u8bd5\u8fc7\u3002</p> <p>\u6240\u4ee5\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u56de\u7b54\u80af\u5b9a\u662f\uff1a\u4e0d\u662f\u7684\u3002</p> <p>\u5728\u521b\u5efaDialog\u5bf9\u8c61\u65f6\uff0ccontext\u53c2\u6570\u4f20Activity\u548c\u4f20Service\u6216Application\u4e4b\u7c7b\u7684\u975eActivity\u7684Context\u5bf9\u8c61\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f</p> <p>\u6709\u7ecf\u9a8c\u7684\u540c\u5b66\u4f1a\u8bf4\uff0c\u60f3\u8981\u901a\u8fc7\u975eActivity\u5bf9\u8c61\u521b\u5efa\u5e76\u6b63\u5e38\u663e\u793aDialog\uff0c\u9996\u5148\u5fc5\u987b\u62e5\u6709SYSTEM_ALERT_WINDOW\u6743\u9650\uff0c\u8fd8\u6709\uff0c\u5728\u8c03\u7528Dialog.show\u65b9\u6cd5\u4e4b\u524d\uff0c\u5fc5\u987b\u628aDialog\u7684Window\u7684type\u6307\u5b9a\u4e3aSYSTEM_WINDOW\u7c7b\u578b\uff0c\u6bd4\u5982TYPE_SYSTEM_ALERT\u6216TYPE_APPLICATION_OVERLAY\u3002</p> <p>\u6ca1\u6709\u6ee1\u8db3\u7b2c\u4e00\u4e2a\u6761\u4ef6\u7684\u8bdd\uff0c\u90a3\u80af\u5b9a\u4f1a\u62a5permission denied\u5566\u3002</p> <p>\u5982\u679c\u5728show\u4e4b\u524d\u6ca1\u6709\u6307\u5b9aWindow\u7684type\u4e3aSYSTEM_WINDOW\u7c7b\u578b\uff0c\u4e00\u6837\u4f1a\u53d1\u751fBadTokenException\u7684\uff0cmessage\u662ftoken null is not valid; is your activity running?\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\uff1f</p> <p>\u5e38\u89c4\u7684Dialog\u7684\u5bb9\u5668\u662fActivity\uff0c\u6240\u4ee5\u5b83\u7a97\u53e3\u5c5e\u6027\u7684token\u5f15\u7528\u7684\u5c31\u662fActivity\u7684Token\u3002\u5230\u4e86WMS\u90a3\u8fb9\u4f1a\u6839\u636e\u8fd9\u4e2aActivity\u7684Token\u6765\u627e\u5230\u5bf9\u5e94\u7684ActivityRecord\u5b9e\u4f8b\uff08\u5176\u5b9e\u662f\u6839\u636eToken\u6765\u67e5\u627e\u5bf9\u5e94\u7684\u5bb9\u5668\uff09\uff0c\u7136\u540e\u628aDialog\u5bf9\u5e94\u7684WindowState\u6dfb\u52a0\u5230ActivityRecord\u91cc\u9762\u3002\u6ce8\u610f\uff01 \u5982\u679c\u5728\u67e5\u627e\u5bb9\u5668\u8fd9\u4e00\u6b65\uff0c\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u5b9e\u4f8b\u7684\u8bdd\uff0c\u5c31\u4f1a\u629b\u51fa\u4e00\u4e2aBadTokenException(token null is not valid; is your activity running?)</p> <p>\u67e5\u627e\u5bb9\u5668\u8fd8\u8ddfContext\u5b9e\u4f8b\u6709\u5173\u7cfb\u5417\uff1f\u4f7f\u7528Service\u6216Application\u5c31\u627e\u4e0d\u5230\u5bb9\u5668\uff0c\u6362\u6210Activity\u5c31\u80fd\u627e\u5230\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u80af\u5b9a\u6709\u5173\u7cfb\u5566\uff0c\u522b\u5fd8\u4e86Dialog\u5728show\u65b9\u6cd5\u91cc\u662f\u901a\u8fc7WindowManager\u6765\u6dfb\u52a0View\u7684\uff0c\u800c\u8fd9\u4e2aWindowManager\u5bf9\u8c61\u5c31\u662f\u4eceContext\u7684getSystemService(WINDOW_SERVICE)\u65b9\u6cd5\u83b7\u5f97\u7684\u3002</p> <p>**\u91cd\u70b9\u6765\u4e86\uff1a**\u56e0\u4e3aActivity\u91cd\u5199\u4e86Context\u7684getSystemService\u65b9\u6cd5\uff0c\u5728\u83b7\u53d6\u7684WINDOW_SERVICE\u7684\u65f6\u5019\u8fd4\u56de\u4e86Activity\u4e3bWindow\u7684WindowManager\u5bf9\u8c61\u3002\u5f53\u7136\u4e86\uff0c\u8fd9\u4e2a\u4e3bWindow\u7684WindowManager\u5bf9\u8c61\u4e5f\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u4e4b\u5904\uff0c\u53ea\u662f\u5b83\u91cc\u9762\u7684mParentWindow\u6307\u5411\u7684\u662f\u4e3bWindow\uff08\u5176\u4ed6\u975eActivity\u7684Context\u7684WindowManager.mParentWindow\u9ed8\u8ba4\u90fd\u662fnull\uff09\u3002</p> <p>WindowManagerGlobal\u5728addView\u7684\u65f6\u5019\uff0c\u5982\u679c\u68c0\u67e5\u5230mParentWindow\u4e0d\u4e3anull\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bf9\u7a97\u53e3\u5c5e\u6027\uff08\u5373\u4e0a\u4e00\u4e2a\u56de\u7b54\u4e2d\u8bf4\u5230\u7684mWindowAttributes\uff09\u7684token\u8fdb\u884c\u8d4b\u503c\uff0c\u5b83\u7684\u903b\u8f91\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u5982\u679c\u7a97\u53e3\u7c7b\u578b\u4e3aSUB_WINDOW\uff08\u5373\u5b50\u7a97\u53e3\uff09\uff0c\u5c31\u4f1a\u628amParentWindow\u5bf9\u5e94\u7684ViewRootImpl\u7684mWindow\u8d4b\u503c\u7ed9token\uff08\u4e0a\u4e00\u4e2a\u56de\u7b54\u4e5f\u6709\u76f8\u5173\u4ecb\u7ecd\uff09\uff1b</li> <li>\u7a97\u53e3\u7c7b\u578b\u4e3aSYSTEM_WINDOW\uff08\u7cfb\u7edf\u7ea7\u522b\u7684\u7a97\u53e3\uff0c\u6bd4\u5982ANR Dialog\uff09\uff0c\u5219\u4e0d\u4f1a\u5bf9token\u8fdb\u884c\u8d4b\u503c\u3002\u56e0\u4e3a\u666e\u901a\u5e94\u7528\u7684Window\u7b49\u7ea7\u6bd4\u7cfb\u7edfWindow\u4f4e\uff0c\u6240\u8c13\u5c0f\u5e99\u5bb9\u4e0d\u4e0b\u5927\u4f5b\uff1b</li> <li>\u7a97\u53e3\u7c7b\u578b\u4e3aAPPLICATION_WINDOW\uff08Activity\u4e3bWindow\u548c\u666e\u901a\u7684Dialog\u5c31\u662f\u8fd9\u4e2a\u7c7b\u578b\uff09\uff0c\u4f1a\u628amParentWindow\u7684mAppToken\uff08\u4e5f\u5c31\u662f\u6240\u5c5eActivity\u7684mToken\uff09\u8d4b\u503c\u7ed9token\uff1b</li> </ul> <p>\u6839\u636e\u4e0a\u9762\u8fd9\u4e2a\u89c4\u5219\uff0c\u53ef\u4ee5\u8054\u60f3\u5230\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5\u5bfc\u81f4\u7a97\u53e3\u5c5e\u6027\u7684token\u4e3anull\uff08token\u4e3anull\u5c31\u80af\u5b9a\u627e\u4e0d\u5230\u5bb9\u5668\u5566\uff09\uff0c\u4e00\u79cd\u662f\u521b\u5efaDialog\u65f6\u4f20\u4e86\u975eActivity\u7684Context\uff0c\u53e6\u4e00\u79cd\u662fDialog\u7684Window.type\u6307\u5b9a\u4e3aSYSTEM_WINDOW\u3002</p> <p>\u4e3a\u4ec0\u4e48\u975e\u8981\u4e00\u4e2aToken\uff1f</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5728WMS\u90a3\u8fb9\u9700\u8981\u6839\u636e\u8fd9\u4e2aToken\u6765\u786e\u5b9aWindow\u7684\u4f4d\u7f6e\uff08\u4e0d\u662f\u8bf4\u5750\u6807\uff09\uff0c\u5982\u679c\u6ca1\u6709Token\u7684\u8bdd\uff0c\u5c31\u4e0d\u77e5\u9053\u8fd9\u4e2a\u7a97\u53e3\u5e94\u8be5\u653e\u5230\u54ea\u4e2a\u5bb9\u5668\u4e0a\u4e86\u3002</p> <p>\u90a3\u4e3a\u4ec0\u4e48\u628aWindow\u7684type\u6307\u5b9a\u4e3aSYSTEM_WINDOW\u7c7b\u578b\u5c31\u80fd\u627e\u5230\u5bb9\u5668\u4e86\u5462\uff1f</p> <p>\u5176\u5b9e\u4e00\u6837\u6ca1\u6709\u627e\u5230\uff0c\u53ea\u662f\u5728\u83b7\u5f97SYSTEM_ALERT_WINDOW\u6743\u9650\u4e4b\u540e\uff0c\u4f1a\u5373\u65f6\u521b\u5efa\u4e00\u4e2aWindowToken\u800c\u5df2\uff08ActivityRecord\u4e5f\u662f\u7ee7\u627f\u81eaWindowToken\uff09\uff0c\u7136\u540e\u4f1a\u628a\u8fd9\u4e2a\u65b0\u521b\u5efa\u7684WindowToken\u9644\u52a0\u5230\u7279\u5b9a\u7684\u5bb9\u5668\u4e0a\u3002</p> <p>\u6765\u770b\u56fe\uff1a</p> <p></p> <p>\u5e38\u89c4\u7684Dialog\u663e\u793a\uff0c\u662f\u8fd9\u6837\u7684\u3002</p> <p>\u6700\u5e95\u7684\u90a3\u4e2a\u7eff\u8272\u7684WindowState\uff0c\u5c31\u662fDialog\u7684\u7a97\u53e3\u3002</p> <p>\u628aDialog\u7684Window.type\u6307\u5b9a\u4e3aSYSTEM_WINDOW\u4e4b\u540e\uff0c\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u53f3\u8fb9\u6700\u5e95\u7684\u90a3\u4e2aWindowState\u5c31\u662fSYSTEM_WINDOW\u7c7b\u578b\u7684Dialog\u7a97\u53e3\uff0c\u5728\u5c42\u7ea7\u5173\u7cfb\u4e0a\uff0c\u8ddf\u9694\u58c1\u7684ActivityRecord\u662f\u76f8\u7b49\u7684\u3002</p> <p>Dialog\u7a97\u53e3\u6240\u5728\u5bb9\u5668\uff0c\u5c31\u662f\u521a\u521a\u8bf4\u5230\u7684\u90a3\u4e2a\u5373\u65f6\u521b\u5efa\u7684WindowToken\u3002</p> <p>\u5176\u5b9e\u5176\u4ed6\u7cfb\u7edf\u7ea7\u522b\u7684\u7a97\u53e3\u4e5f\u662f\u653e\u7f6e\u5728\u8fd9\u4e2aWindowToken\u7684\u7236\u7ea7\u5bb9\u5668DisplayArea.Tokens\u91cc\u9762\u7684\uff0c\u5c31\u50cf\u8fd9\u6837\uff1a</p> <p></p> <p>\u5662\u5bf9\u4e86\uff0c\u6765\u4e86\u89e3\u4e00\u4e0bWMS\u8fd9\u8fb9\u7684\u5404\u4e2a\u5bb9\u5668\u7684\u5173\u7cfb\u5427\uff08\u6df1\u8272\u7bad\u5934\u662fextends\u7684\u610f\u601d\uff09\uff1a</p> <p>(\u8bd5\u4e86\u597d\u591a\u529e\u6cd5\uff0c\u4e00\u5f20\u5b8c\u6574\u7684\u56fe\u90fd\u6ca1\u6cd5\u8ba9\u5927\u5bb6\u5728\u624b\u673a\u4e0a\u770b\u6e05\uff0c\u4e8e\u662f\u6211\u5e72\u4e86\u6210\u4e24\u534a)</p> <p></p> <p></p>"},{"location":"front-end/android/daily/dialog_token/#2activitydialogbadtokenexception","title":"2.\u73b0\u5728\u6765\u56de\u7b54\u7b2c\u4e00\u95ee\uff1a\u4e3a\u4ec0\u4e48\u4f7f\u7528\u975eActivity\u6765\u521b\u5efa\u5e76\u5f39\u51faDialog\uff0c\u6709\u65f6\u4f1a\u53d1\u751fBadTokenException\uff1f","text":"<p>\u4e3b\u8981\u662f\u56e0\u4e3a\u975eActivity\u7684Context\u5b83\u7684WindowManger\u6ca1\u6709ParentWindow\uff0c\u5bfc\u81f4\u5728WMS\u90a3\u8fb9\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u5bb9\u5668\uff0c\u4e5f\u5c31\u662f\u4e0d\u77e5\u9053\u8981\u628aDialog\u7684Window\u653e\u7f6e\u5728\u4f55\u5904\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a\u539f\u56e0\u662f\u6ca1\u6709SYSTEM_ALERT_WINDOW\u6743\u9650\uff08\u5f53\u7136\u8981\u52a0\u6743\u9650\u5566\uff0cDisplayArea.Tokens\u7684\u5b50\u5bb9\u5668\uff0c\u7ea7\u522b\u6bd4\u666e\u901a\u5e94\u7528\u7684Window\u9ad8\uff0c\u4e5f\u5c31\u662f\u4f1a\u663e\u793a\u5728\u666e\u901a\u5e94\u7528Window\u7684\u524d\u9762\uff0c\u5982\u679c\u4e0d\u52a0\u6743\u9650\u63a7\u5236\u7684\u8bdd\uff0c\u88ab\u6ee5\u7528\u8fd8\u5f97\u4e86\uff09\u3002</p> <p>\u5728\u83b7\u5f97SYSTEM_ALERT_WINDOW\u6743\u9650\u5e76\u5c06Dialog\u7684Window.type\u6307\u5b9a\u4e3aSYSTEM_WINDOW\u4e4b\u540e\u80fd\u6b63\u5e38\u663e\u793a\uff0c\u662f\u56e0\u4e3aWMS\u4f1a\u4e3aSYSTEM_WINDOW\u7c7b\u578b\u7684\u7a97\u53e3\u4e13\u95e8\u521b\u5efa\u4e00\u4e2aWindowToken\uff08\u8fd9\u4e0b\u5c31\u6709\u5bb9\u5668\u4e86\uff09\uff0c\u5e76\u653e\u7f6e\u5728DisplayArea.Tokens\u91cc\u9762\uff08\u8fd9\u4e0b\u77e5\u9053\u653e\u5728\u54ea\u91cc\u4e86\uff09\u3002</p>"},{"location":"front-end/android/daily/dialog_token/#_3","title":"\u603b\u7ed3","text":"<p>Show\u4e00\u4e2a\u666e\u901a\u7684Dialog\u9700\u8981\u7684\u5e76\u4e0d\u662fActivity\u672c\u8eab\uff0c\u800c\u662f\u4e00\u4e2a\u5bb9\u5668\u7684token\uff0c\u6211\u4eec\u5e73\u65f6\u4f1a\u4f20Activity\uff0c\u53ea\u4e0d\u8fc7\u662fActivity\u521a\u597d\u5bf9\u5e94WMS\u90a3\u8fb9\u7684\u4e00\u4e2aWindowState\u7684\u5bb9\u5668\u800c\u5df2\u3002</p>"},{"location":"front-end/android/daily/dialog_token/#_4","title":"\u53c2\u8003","text":"<p>\u6458\u81eahttps://cloud.tencent.com/developer/article/1839903</p>"},{"location":"front-end/android/daily/flask_android_8/","title":"Mac 10.14  \u7f16\u8bd1Android 8.1\u6e90\u7801\u53ca\u5237\u5165nexus 6p","text":""},{"location":"front-end/android/daily/flask_android_8/#1","title":"1. \u73af\u5883\u51c6\u5907","text":"<p>\u5b98\u7f51 \u63cf\u8ff0\u5f97\u5df2\u7ecf\u76f8\u5f53\u6e05\u695a\u4e86 \uff0c\u8fd9\u91cc\u7a0d\u5fae\u603b\u7ed3\u4e00\u4e0b\uff1a </p>"},{"location":"front-end/android/daily/flask_android_8/#11","title":"1.1 \u521b\u5efa\u533a\u5206\u5927\u5c0f\u5199\u7684\u78c1\u76d8\u6620\u50cf","text":"<p>mac\u7cfb\u7edf\u9ed8\u8ba4\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u533a\u5206\u5927\u5c0f\u5199\u7684\u6587\u4ef6\u7cfb\u7edf </p> <pre><code>hdiutil create -type SPARSE -fs 'Case-sensitive Journaled HFS+' -size 60g ~/android.dmg </code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a.dmg.sparseimage\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5728\u88c5\u8f7d\u540e\u53ef\u7528\u4f5c\u5177\u6709 Android \u5f00\u53d1\u6240\u9700\u683c\u5f0f\u7684\u9a71\u52a8\u76d8\u3002 </p> <p>\u6309\u5b98\u7f51\u6240\u8bf4\u5b8c\u6210\u7f16\u8bd1\u81f3\u5c11\u9700\u8981 25GB \u7a7a\u95f4\uff0c\u76f8\u4fe1\u6211\uff0c\u5176\u5b9e\u81f3\u5c11\u9700\u898160G\u3002\u5f53\u7136\uff0c\u7a7a\u95f4\u5927\u5c0f\u540e\u9762\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u4fee\u6539 </p> <pre><code>hdiutil resize -size &lt;new-size-you-want&gt;g ~/android.dmg.sparseimage\n</code></pre> <p>\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5f80\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u6587\u4ef6(<code>~/.bash_profile</code>--bash\uff0c<code>~/.zshrc</code>--zsh)\u6dfb\u52a0\u8f85\u52a9\u51fd\u6570</p> <ul> <li>\u88c5\u8f7d\u51fd\u6570</li> </ul> <pre><code># mount the android file image\nmountAndroid() { hdiutil attach ~/android.dmg.sparseimage -mountpoint /Volumes/android; </code></pre> <ul> <li>\u5378\u8f7d\u51fd\u6570</li> </ul> <pre><code># unmount the android file image\numountAndroid() { hdiutil detach /Volumes/android; }\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#12","title":"1.2 \u5b89\u88c5\u6240\u9700\u7684\u8f6f\u4ef6","text":"<ul> <li>JDK</li> </ul> <p>\u5404\u79cd Android \u7248\u672c\u4f7f\u7528\u7684 Java \u7248\u672c\u4e0d\u4e00\u6837\uff0c\u8bf7\u53c2\u9605\u76f8\u5173\u8981\u6c42</p> <p>\u6211\u8fd9\u91cc\u662f\u7f16\u8bd1Android8.1.0 \uff0c\u6240\u4ee5\u4f7f\u7528java1.8</p> <ul> <li>Xcode \u547d\u4ee4\u884c\u5de5\u5177</li> </ul> <pre><code>xcode-select --install\n</code></pre> <ul> <li>MacPorts</li> </ul> <p>\u4ecemacports.org \u4e0b\u8f7d\u5b89\u88c5,\u8bf7\u786e\u4fdd <code>/opt/local/bin</code> \u5728\u8def\u5f84\u4e2d\u663e\u793a\u5728 <code>/usr/bin</code> \u524d\u9762\u3002\u5426\u5219\uff0c\u8bf7\u5c06\u4ee5\u4e0b\u5185\u5bb9\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u6587\u4ef6(<code>~/.bash_profile</code>--bash\uff0c<code>~/.zshrc</code>--zsh)\u4e2d\uff1a</p> <pre><code>export PATH=/opt/local/bin:$PATH\n</code></pre> <p>\u901a\u8fc7 MacPorts \u83b7\u53d6 Make\u3001Git \u3001 GPG\u3001BISON \u8f6f\u4ef6\u5305</p> <pre><code>POSIXLY_CORRECT=1 sudo port install gmake libsdl git gnupg bison\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#_1","title":"\u8bbe\u7f6e\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u4e0a\u9650","text":"<p>\u5728 Mac OS \u4e2d\uff0c\u53ef\u540c\u65f6\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u9ed8\u8ba4\u6570\u91cf\u4e0a\u9650\u592a\u4f4e\uff0c\u5728\u9ad8\u5ea6\u5e76\u884c\u7684\u7f16\u8bd1\u6d41\u7a0b\u4e2d\uff0c\u53ef\u80fd\u4f1a\u8d85\u51fa\u6b64\u4e0a\u9650\u3002\u8981\u63d0\u9ad8\u6b64\u4e0a\u9650\uff0c\u8bf7\u5c06\u4e0b\u5217\u884c\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u6587\u4ef6(<code>~/.bash_profile</code>--bash\uff0c<code>~/.zshrc</code>--zsh)\u4e2d\uff1a</p> <pre><code># set the number of open files to be 1024\nulimit -S -n 1024\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#2","title":"2. \u4e0b\u8f7d\u6e90\u4ee3\u7801","text":"<p>Android \u6e90\u4ee3\u7801\u6811\u4f4d\u4e8e\u7531 Google \u6258\u7ba1\u7684 Git \u4ee3\u7801\u5e93\u4e2d\u3002\u4e3a\u4e86\u5728 Android \u73af\u5883\u4e2d\u66f4\u8f7b\u677e\u5730\u4f7f\u7528 Git\uff0cGoogle\u5f00\u53d1\u4e86Repo\u3002</p>"},{"location":"front-end/android/daily/flask_android_8/#21-repo","title":"2.1 \u5b89\u88c5 Repo","text":"<ol> <li>\u786e\u4fdd\u4e3b\u76ee\u5f55\u4e0b\u6709\u4e00\u4e2a <code>bin/</code> \u76ee\u5f55\uff0c\u5e76\u4e14\u8be5\u76ee\u5f55\u5305\u542b\u5728\u8def\u5f84\u4e2d\uff1a</li> </ol> <pre><code>mkdir ~/bin\nPATH=~/bin:$PATH\n</code></pre> <ol> <li>\u4e0b\u8f7d Repo \u5de5\u5177\uff0c\u5e76\u786e\u4fdd\u5b83\u53ef\u6267\u884c</li> </ol> <pre><code>curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo\nchmod a+x ~/bin/repo\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#22-repo","title":"2.2 repo \u521d\u59cb\u5316","text":""},{"location":"front-end/android/daily/flask_android_8/#_2","title":"\u8fdb\u5165\u6211\u4eec\u4e00\u5f00\u59cb\u521b\u5efa\u7684\u6587\u4ef6\u7cfb\u7edf,\u521b\u5efa\u4e00\u4e2a\u7a7a\u76ee\u5f55","text":"<pre><code>\u279c  ~ mountAndroid\n/dev/disk3              GUID_partition_scheme\n/dev/disk3s1            EFI\n/dev/disk3s2            Apple_HFS                       /Volumes/android\n\u279c  ~ cd /Volumes/android\n\u279c  ~ mkdir aosp\n\u279c  ~ cd aosp\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#checkout","title":"\u6307\u5b9a\u9700\u8981checkout\u5bf9\u5e94\u7684\u6e90\u4ee3\u7801\u6807\u8bb0\u548c\u7f16\u8bd1\u7248\u672c","text":"<pre><code>repo init -u https://android.googlesource.com/platform/manifest -b android-8.1.0_r50\n</code></pre> <p>\u521d\u59cb\u5316\u6210\u529f\u540e\uff0c\u76ee\u5f55\u4e2d\u5e94\u5305\u542b\u4e00\u4e2a <code>.repo</code> \u76ee\u5f55\u3002</p>"},{"location":"front-end/android/daily/flask_android_8/#23","title":"2.3 \u4e0b\u8f7d","text":"<p>\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u5f00\u59cb\u6f2b\u957f\u7684\u4e0b\u8f7d\u8fc7\u7a0b\u4e86</p> <pre><code>repo sync\n</code></pre> <p>\u540c\u6b65\u64cd\u4f5c\u987a\u5229\u7684\u8bdd\u5c06\u9700\u8981 1 \u4e2a\u5c0f\u65f6\u6216\u66f4\u957f\u65f6\u95f4\u5b8c\u6210,</p>"},{"location":"front-end/android/daily/flask_android_8/#24","title":"2.4 \u4e0b\u8f7d\u9a71\u52a8","text":"<p>\u4ece\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94\u673a\u578b\u9a71\u52a8\u5373\u53ef\uff0c\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u538b\uff0c\u4f9d\u6b21\u6267\u884c\u91cc\u9762\u7684sh\u6587\u4ef6\uff0c\u5982\uff1a</p> <pre><code>$ ./assets/extract-huawei-angler.sh\n\nThe license for this software will now be displayed.\nYou must agree to this license before using this software.\n\nPress Enter to view the licensels\n</code></pre> <p>\u6267\u884c\u5b8c\u6bd5\uff0c\u9a71\u52a8\u6587\u4ef6\u4f1a\u91ca\u653e\u5230vendor\u76ee\u5f55\u3002</p>"},{"location":"front-end/android/daily/flask_android_8/#3","title":"3. \u7f16\u8bd1","text":""},{"location":"front-end/android/daily/flask_android_8/#31","title":"3.1 \u6e05\u7406","text":"<pre><code>make clobber\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#32","title":"3.2 \u8bbe\u7f6e\u73af\u5883","text":"<pre><code>source build/envsetup.sh\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#33","title":"3.3 \u9009\u62e9\u76ee\u6807","text":"<pre><code>\u279c  ~ lunch\n\nYou're building on Darwin\n\nLunch menu... pick a combo:\n     1. aosp_arm-eng\n     2. aosp_arm64-eng\n     3. aosp_mips-eng\n     4. aosp_mips64-eng\n     5. aosp_x86-eng\n     6. aosp_x86_64-eng\n     7. aosp_deb-userdebug\n     8. aosp_flo-userdebug\n     9. full_fugu-userdebug\n     10. aosp_fugu-userdebug\n     11. mini_emulator_arm64-userdebug\n     12. m_e_arm-userdebug\n     13. mini_emulator_mips-userdebug\n     14. mini_emulator_x86-userdebug\n     15. mini_emulator_x86_64-userdebug\n     16. aosp_flounder-userdebug\n     17. aosp_angler-userdebug\n     18. aosp_bullhead-userdebug\n     19. aosp_hammerhead-userdebug\n     20. aosp_hammerhead_fp-userdebug\n     21. aosp_shamu-userdebug\n     22. aosp_bullhead-userdebug\n     23. aosp_angler-userdebug\n</code></pre> <p>\u56e0\u4e3a\u6211\u8981\u7f16\u8bd1nexus6p\uff0c\u8fd9\u91cc\u9009\u62e923\uff0c\u5176\u4ed6\u8bbe\u5907\u53ef\u4ee5\u53c2\u8003\u9009\u62e9\u8bbe\u5907\u7f16\u8bd1\u7cfb\u7edf</p>"},{"location":"front-end/android/daily/flask_android_8/#34","title":"3.4 \u7f16\u8bd1\u4ee3\u7801","text":"<pre><code>make -j8\n</code></pre> <p><code>-jN</code> \u8868\u793a\u7f16\u8bd1\u5e76\u884c\u4efb\u52a1\u6570\uff0c\u8fd9\u4e2a\u793a\u7535\u8111\u60c5\u51b5\u800c\u5b9a\uff0c\u4e00\u822c\u53d6cpu\u6570\u76841\uff5e2\u500d\u5c31\u53ef\u4ee5</p>"},{"location":"front-end/android/daily/flask_android_8/#35","title":"3.5 \u7f16\u8bd1\u9047\u5230\u95ee\u9898","text":""},{"location":"front-end/android/daily/flask_android_8/#macossdk","title":"\u627e\u4e0d\u5230\u5bf9\u5e94\u7684macOS.sdk","text":"<ul> <li>\u62a5\u9519\u65e5\u5fd7</li> </ul> <pre><code>[44/44] bootstrap out/soong/.minibootstrap/build.ninja.in [4/4] out/soong/.bootstrap/bin/minibp out/soong/.bootstrap/build.ninja [860/861] glob vendor///Android.bp [54/54] out/soong/.bootstrap/bin/soong_build out/soong/build.ninja FAILED: out/soong/build.ninja out/soong/.bootstrap/bin/soong_build -t -b out/soong -d out/soong/build.ninja.d -o out/soong/build.ninja Android.bp internal error: Could not find a supported mac sdk: [\"10.10\" \"10.11\" \"10.12\"] ninja: build stopped: subcommand failed. 17:53:06 soong failed with: exit status 1\n</code></pre> <ul> <li>\u89e3\u51b3\u65b9\u6cd5</li> </ul> <p>\u4fee\u6539/build/soong/cc/config/x86_darwin_host.go\u6587\u4ef6\uff0c\u6dfb\u52a010.14\u652f\u6301\uff0c\u5982\u4e0b</p> <pre><code>darwinSupportedSdkVersions = []string{\n\"10.10\",\n\"10.11\",\n\"10.12\",\n\"10.14\", // \u6dfb\u52a0mac sdk 10.14\n}\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#bison","title":"\u9047\u5230bison \u9519\u8bef","text":"<ul> <li>\u62a5\u9519\u65e5\u5fd7</li> </ul> <pre><code>FAILED: out/soong/.intermediates/external/selinux/checkpolicy/checkpolicy/darwin_x86_64/gen/yacc/external/selinux/checkpolicy/policy_parse.c out/soong/.intermediates/external/selinux/checkpolicy/checkpolicy/darwin_x86_64/gen/yacc/external/selinux/checkpolicy/policy_parse.h BISON_PKGDATADIR=external/bison/data prebuilts/misc/darwin-x86/bison/bison -d --defines=out/soong/.intermediates/external/selinux/checkpolicy/checkpolicy/darwin_x86_64/gen/yacc/external/selinux/checkpolicy/policy_parse.h -o out/soong/.intermediates/external/selinux/checkpolicy/checkpolicy/darwin_x86_64/gen/yacc/external/selinux/checkpolicy/policy_parse.c external/selinux/checkpolicy/policy_parse.y [ 0% 309/87784] //external/libcxx:libc++_static header-abi-dumper src/random.cpp [arm] ninja: build stopped: subcommand failed. 18:05:05 ninja failed with: exit status 1 </code></pre> <ul> <li>\u89e3\u51b3\u529e\u6cd5</li> </ul> <pre><code>cd /Volumes/AOSP/external/bison\ngit cherry-pick c0c852bd6fe462b148475476d9124fd740eba160\nmm # \u7528\u65b0\u751f\u6210\u7684bison\u66ff\u6362\u6389\u539fbison\u6587\u4ef6\ncp /Volumes/AOSP/out/host/darwin-x86/bin/bison /Volumes/AOSP/prebuilts/misc/darwin-x86/bison/ # \u91cd\u65b0\u7f16\u8bd1\nmake -j8\n</code></pre>"},{"location":"front-end/android/daily/flask_android_8/#4","title":"4. \u5237\u673a","text":"<p>\u7ecf\u8fc7\u6f2b\u957f\u7684\u7b49\u5f85\u548c\u53cd\u590d\u6298\u817e\u540e\uff0c\u7ec8\u4e8e\u5230\u4e86\u6700\u540e\u4e00\u6b65---\u5237\u673a\u3002</p> <pre><code># \u624b\u673a\u8fde\u63a5\u7535\u8111\u60c5\u51b5\u4e0b\nadb reboot bootloader # \u8fdb\u5165\u6e90\u7801\u7f16\u8bd1\u8f93\u51fa\u7684\u76ee\u5f55 \nfastboot flashing unlock fastboot flashall -w </code></pre> <p>Done</p>"},{"location":"front-end/android/daily/flask_android_8/#5","title":"5. \u53c2\u8003\u94fe\u63a5","text":"<p>https://source.android.com/setup/build/requirements https://www.jianshu.com/p/1c3d47b2031f</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/","title":"JVM \u5783\u573e\u56de\u6536\u8be6\u89e3","text":"<p>\u5982\u679c\u6ca1\u6709\u7279\u6b8a\u8bf4\u660e\uff0c\u90fd\u662f\u9488\u5bf9\u7684\u662f HotSpot \u865a\u62df\u673a\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_1","title":"\u524d\u8a00","text":"<p>\u5f53\u9700\u8981\u6392\u67e5\u5404\u79cd\u5185\u5b58\u6ea2\u51fa\u95ee\u9898\u3001\u5f53\u5783\u573e\u6536\u96c6\u6210\u4e3a\u7cfb\u7edf\u8fbe\u5230\u66f4\u9ad8\u5e76\u53d1\u7684\u74f6\u9888\u65f6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5bf9\u8fd9\u4e9b\u201c\u81ea\u52a8\u5316\u201d\u7684\u6280\u672f\u5b9e\u65bd\u5fc5\u8981\u7684\u76d1\u63a7\u548c\u8c03\u8282\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_2","title":"\u5806\u7a7a\u95f4\u7684\u57fa\u672c\u7ed3\u6784","text":"<p>Java \u7684\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u4e3b\u8981\u662f\u9488\u5bf9\u5bf9\u8c61\u5185\u5b58\u7684\u56de\u6536\u548c\u5bf9\u8c61\u5185\u5b58\u7684\u5206\u914d\u3002\u540c\u65f6\uff0cJava \u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u6700\u6838\u5fc3\u7684\u529f\u80fd\u662f \u5806 \u5185\u5b58\u4e2d\u5bf9\u8c61\u7684\u5206\u914d\u4e0e\u56de\u6536\u3002</p> <p>Java \u5806\u662f\u5783\u573e\u6536\u96c6\u5668\u7ba1\u7406\u7684\u4e3b\u8981\u533a\u57df\uff0c\u56e0\u6b64\u4e5f\u88ab\u79f0\u4f5c GC \u5806\uff08Garbage Collected Heap\uff09\u3002</p> <p>\u4ece\u5783\u573e\u56de\u6536\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u7531\u4e8e\u73b0\u5728\u6536\u96c6\u5668\u57fa\u672c\u90fd\u91c7\u7528\u5206\u4ee3\u5783\u573e\u6536\u96c6\u7b97\u6cd5\uff0c\u6240\u4ee5 Java \u5806\u88ab\u5212\u5206\u4e3a\u4e86\u51e0\u4e2a\u4e0d\u540c\u7684\u533a\u57df\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u5404\u4e2a\u533a\u57df\u7684\u7279\u70b9\u9009\u62e9\u5408\u9002\u7684\u5783\u573e\u6536\u96c6\u7b97\u6cd5\u3002</p> <p>\u5728 JDK 7 \u7248\u672c\u53ca JDK 7 \u7248\u672c\u4e4b\u524d\uff0c\u5806\u5185\u5b58\u88ab\u901a\u5e38\u5206\u4e3a\u4e0b\u9762\u4e09\u90e8\u5206\uff1a</p> <ol> <li>\u65b0\u751f\u4ee3\u5185\u5b58(Young Generation)</li> <li>\u8001\u751f\u4ee3(Old Generation)</li> <li>\u6c38\u4e45\u4ee3(Permanent Generation)</li> </ol> <p>\u4e0b\u56fe\u6240\u793a\u7684 Eden \u533a\u3001\u4e24\u4e2a Survivor \u533a S0 \u548c S1 \u90fd\u5c5e\u4e8e\u65b0\u751f\u4ee3\uff0c\u4e2d\u95f4\u4e00\u5c42\u5c5e\u4e8e\u8001\u5e74\u4ee3\uff0c\u6700\u4e0b\u9762\u4e00\u5c42\u5c5e\u4e8e\u6c38\u4e45\u4ee3\u3002</p> <p></p> <p>JDK 8 \u7248\u672c\u4e4b\u540e PermGen(\u6c38\u4e45) \u5df2\u88ab Metaspace(\u5143\u7a7a\u95f4) \u53d6\u4ee3\uff0c\u5143\u7a7a\u95f4\u4f7f\u7528\u7684\u662f\u76f4\u63a5\u5185\u5b58 \u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_3","title":"\u5185\u5b58\u5206\u914d\u548c\u56de\u6536\u539f\u5219","text":""},{"location":"front-end/android/jvm/jvm-garbage-collection/#eden","title":"\u5bf9\u8c61\u4f18\u5148\u5728 Eden \u533a\u5206\u914d","text":"<p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5bf9\u8c61\u5728\u65b0\u751f\u4ee3\u4e2d Eden \u533a\u5206\u914d\u3002\u5f53 Eden \u533a\u6ca1\u6709\u8db3\u591f\u7a7a\u95f4\u8fdb\u884c\u5206\u914d\u65f6\uff0c\u865a\u62df\u673a\u5c06\u53d1\u8d77\u4e00\u6b21 Minor GC\u3002\u4e0b\u9762\u6211\u4eec\u6765\u8fdb\u884c\u5b9e\u9645\u6d4b\u8bd5\u4ee5\u4e0b\u3002</p> <p>\u6d4b\u8bd5\u4ee3\u7801\uff1a</p> <pre><code>public class GCTest {\npublic static void main(String[] args) {\nbyte[] allocation1, allocation2;\nallocation1 = new byte[30900*1024];\n}\n}\n</code></pre> <p>\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8fd0\u884c\uff1a </p> <p>\u6dfb\u52a0\u7684\u53c2\u6570\uff1a<code>-XX:+PrintGCDetails</code> </p> <p>\u8fd0\u884c\u7ed3\u679c (\u7ea2\u8272\u5b57\u4f53\u63cf\u8ff0\u6709\u8bef\uff0c\u5e94\u8be5\u662f\u5bf9\u5e94\u4e8e JDK1.7 \u7684\u6c38\u4e45\u4ee3)\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u6211\u4eec\u53ef\u4ee5\u770b\u51fa Eden \u533a\u5185\u5b58\u51e0\u4e4e\u5df2\u7ecf\u88ab\u5206\u914d\u5b8c\u5168\uff08\u5373\u4f7f\u7a0b\u5e8f\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff0c\u65b0\u751f\u4ee3\u4e5f\u4f1a\u4f7f\u7528 2000 \u591a k \u5185\u5b58\uff09\u3002</p> <p>\u5047\u5982\u6211\u4eec\u518d\u4e3a <code>allocation2</code> \u5206\u914d\u5185\u5b58\u4f1a\u51fa\u73b0\u4ec0\u4e48\u60c5\u51b5\u5462\uff1f</p> <pre><code>allocation2 = new byte[900*1024];\n</code></pre> <p></p> <p>\u7ed9 <code>allocation2</code> \u5206\u914d\u5185\u5b58\u7684\u65f6\u5019 Eden \u533a\u5185\u5b58\u51e0\u4e4e\u5df2\u7ecf\u88ab\u5206\u914d\u5b8c\u4e86</p> <p>\u5f53 Eden \u533a\u6ca1\u6709\u8db3\u591f\u7a7a\u95f4\u8fdb\u884c\u5206\u914d\u65f6\uff0c\u865a\u62df\u673a\u5c06\u53d1\u8d77\u4e00\u6b21 Minor GC\u3002GC \u671f\u95f4\u865a\u62df\u673a\u53c8\u53d1\u73b0 <code>allocation1</code> \u65e0\u6cd5\u5b58\u5165 Survivor \u7a7a\u95f4\uff0c\u6240\u4ee5\u53ea\u597d\u901a\u8fc7 \u5206\u914d\u62c5\u4fdd\u673a\u5236 \u628a\u65b0\u751f\u4ee3\u7684\u5bf9\u8c61\u63d0\u524d\u8f6c\u79fb\u5230\u8001\u5e74\u4ee3\u4e2d\u53bb\uff0c\u8001\u5e74\u4ee3\u4e0a\u7684\u7a7a\u95f4\u8db3\u591f\u5b58\u653e <code>allocation1</code>\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0 Full GC\u3002\u6267\u884c Minor GC \u540e\uff0c\u540e\u9762\u5206\u914d\u7684\u5bf9\u8c61\u5982\u679c\u80fd\u591f\u5b58\u5728 Eden \u533a\u7684\u8bdd\uff0c\u8fd8\u662f\u4f1a\u5728 Eden \u533a\u5206\u914d\u5185\u5b58\u3002\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u4ee3\u7801\u9a8c\u8bc1\uff1a</p> <pre><code>public class GCTest {\npublic static void main(String[] args) {\nbyte[] allocation1, allocation2,allocation3,allocation4,allocation5;\nallocation1 = new byte[32000*1024];\nallocation2 = new byte[1000*1024];\nallocation3 = new byte[1000*1024];\nallocation4 = new byte[1000*1024];\nallocation5 = new byte[1000*1024];\n}\n}\n</code></pre>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_4","title":"\u5927\u5bf9\u8c61\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3","text":"<p>\u5927\u5bf9\u8c61\u5c31\u662f\u9700\u8981\u5927\u91cf\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7684\u5bf9\u8c61\uff08\u6bd4\u5982\uff1a\u5b57\u7b26\u4e32\u3001\u6570\u7ec4\uff09\u3002</p> <p>\u5927\u5bf9\u8c61\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3\u4e3b\u8981\u662f\u4e3a\u4e86\u907f\u514d\u4e3a\u5927\u5bf9\u8c61\u5206\u914d\u5185\u5b58\u65f6\u7531\u4e8e\u5206\u914d\u62c5\u4fdd\u673a\u5236\u5e26\u6765\u7684\u590d\u5236\u800c\u964d\u4f4e\u6548\u7387\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_5","title":"\u957f\u671f\u5b58\u6d3b\u7684\u5bf9\u8c61\u5c06\u8fdb\u5165\u8001\u5e74\u4ee3","text":"<p>\u65e2\u7136\u865a\u62df\u673a\u91c7\u7528\u4e86\u5206\u4ee3\u6536\u96c6\u7684\u601d\u60f3\u6765\u7ba1\u7406\u5185\u5b58\uff0c\u90a3\u4e48\u5185\u5b58\u56de\u6536\u65f6\u5c31\u5fc5\u987b\u80fd\u8bc6\u522b\u54ea\u4e9b\u5bf9\u8c61\u5e94\u653e\u5728\u65b0\u751f\u4ee3\uff0c\u54ea\u4e9b\u5bf9\u8c61\u5e94\u653e\u5728\u8001\u5e74\u4ee3\u4e2d\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u865a\u62df\u673a\u7ed9\u6bcf\u4e2a\u5bf9\u8c61\u4e00\u4e2a\u5bf9\u8c61\u5e74\u9f84\uff08Age\uff09\u8ba1\u6570\u5668\u3002</p> <p>\u5927\u90e8\u5206\u60c5\u51b5\uff0c\u5bf9\u8c61\u90fd\u4f1a\u9996\u5148\u5728 Eden \u533a\u57df\u5206\u914d\u3002\u5982\u679c\u5bf9\u8c61\u5728 Eden \u51fa\u751f\u5e76\u7ecf\u8fc7\u7b2c\u4e00\u6b21 Minor GC \u540e\u4ecd\u7136\u80fd\u591f\u5b58\u6d3b\uff0c\u5e76\u4e14\u80fd\u88ab Survivor \u5bb9\u7eb3\u7684\u8bdd\uff0c\u5c06\u88ab\u79fb\u52a8\u5230 Survivor \u7a7a\u95f4\uff08s0 \u6216\u8005 s1\uff09\u4e2d\uff0c\u5e76\u5c06\u5bf9\u8c61\u5e74\u9f84\u8bbe\u4e3a 1(Eden \u533a-&gt;Survivor \u533a\u540e\u5bf9\u8c61\u7684\u521d\u59cb\u5e74\u9f84\u53d8\u4e3a 1)\u3002</p> <p>\u5bf9\u8c61\u5728 Survivor \u4e2d\u6bcf\u71ac\u8fc7\u4e00\u6b21 MinorGC,\u5e74\u9f84\u5c31\u589e\u52a0 1 \u5c81\uff0c\u5f53\u5b83\u7684\u5e74\u9f84\u589e\u52a0\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff08\u9ed8\u8ba4\u4e3a 15 \u5c81\uff09\uff0c\u5c31\u4f1a\u88ab\u664b\u5347\u5230\u8001\u5e74\u4ee3\u4e2d\u3002\u5bf9\u8c61\u664b\u5347\u5230\u8001\u5e74\u4ee3\u7684\u5e74\u9f84\u9608\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570 <code>-XX:MaxTenuringThreshold</code> \u6765\u8bbe\u7f6e\u3002</p> <p>\u4fee\u6b63\uff08issue552\uff09\uff1a\u201cHotspot \u904d\u5386\u6240\u6709\u5bf9\u8c61\u65f6\uff0c\u6309\u7167\u5e74\u9f84\u4ece\u5c0f\u5230\u5927\u5bf9\u5176\u6240\u5360\u7528\u7684\u5927\u5c0f\u8fdb\u884c\u7d2f\u79ef\uff0c\u5f53\u7d2f\u79ef\u7684\u67d0\u4e2a\u5e74\u9f84\u5927\u5c0f\u8d85\u8fc7\u4e86 survivor \u533a\u7684 50% \u65f6\uff08\u9ed8\u8ba4\u503c\u662f 50%\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>-XX:TargetSurvivorRatio=percent</code> \u6765\u8bbe\u7f6e\uff0c\u53c2\u89c1 issue1199 \uff09\uff0c\u53d6\u8fd9\u4e2a\u5e74\u9f84\u548c MaxTenuringThreshold \u4e2d\u66f4\u5c0f\u7684\u4e00\u4e2a\u503c\uff0c\u4f5c\u4e3a\u65b0\u7684\u664b\u5347\u5e74\u9f84\u9608\u503c\u201d\u3002</p> <p>jdk8 \u5b98\u65b9\u6587\u6863\u5f15\u7528 \uff1ahttps://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html \u3002</p> <p></p> <p>\u52a8\u6001\u5e74\u9f84\u8ba1\u7b97\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>uint ageTable::compute_tenuring_threshold(size_t survivor_capacity) {\n//survivor_capacity\u662fsurvivor\u7a7a\u95f4\u7684\u5927\u5c0f\nsize_t desired_survivor_size = (size_t)((((double)survivor_capacity)*TargetSurvivorRatio)/100);\nsize_t total = 0;\nuint age = 1;\nwhile (age &lt; table_size) {\n//sizes\u6570\u7ec4\u662f\u6bcf\u4e2a\u5e74\u9f84\u6bb5\u5bf9\u8c61\u5927\u5c0f\ntotal += sizes[age];\nif (total &gt; desired_survivor_size) {\nbreak;\n}\nage++;\n}\nuint result = age &lt; MaxTenuringThreshold ? age : MaxTenuringThreshold;\n...\n}\n</code></pre> <p>\u989d\u5916\u8865\u5145\u8bf4\u660e(issue672)\uff1a\u5173\u4e8e\u9ed8\u8ba4\u7684\u664b\u5347\u5e74\u9f84\u662f 15\uff0c\u8fd9\u4e2a\u8bf4\u6cd5\u7684\u6765\u6e90\u5927\u90e8\u5206\u90fd\u662f\u300a\u6df1\u5165\u7406\u89e3 Java \u865a\u62df\u673a\u300b\u8fd9\u672c\u4e66\u3002 \u5982\u679c\u4f60\u53bb Oracle \u7684\u5b98\u7f51\u9605\u8bfb\u76f8\u5173\u7684\u865a\u62df\u673a\u53c2\u6570\uff0c\u4f60\u4f1a\u53d1\u73b0<code>-XX:MaxTenuringThreshold=threshold</code>\u8fd9\u91cc\u6709\u4e2a\u8bf4\u660e</p> <p>Sets the maximum tenuring threshold for use in adaptive GC sizing. The largest value is 15. The default value is 15 for the parallel (throughput) collector, and 6 for the CMS collector.\u9ed8\u8ba4\u664b\u5347\u5e74\u9f84\u5e76\u4e0d\u90fd\u662f 15\uff0c\u8fd9\u4e2a\u662f\u8981\u533a\u5206\u5783\u573e\u6536\u96c6\u5668\u7684\uff0cCMS \u5c31\u662f 6.</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#gc","title":"\u4e3b\u8981\u8fdb\u884c gc \u7684\u533a\u57df","text":"<p>\u5468\u5fd7\u660e\u5148\u751f\u5728\u300a\u6df1\u5165\u7406\u89e3 Java \u865a\u62df\u673a\u300b\u7b2c\u4e8c\u7248\u4e2d P92 \u5982\u662f\u5199\u9053\uff1a</p> <p>\u201c\u8001\u5e74\u4ee3 GC\uff08Major GC/Full GC\uff09\uff0c\u6307\u53d1\u751f\u5728\u8001\u5e74\u4ee3\u7684 GC\u2026\u2026\u201d</p> <p>\u4e0a\u9762\u7684\u8bf4\u6cd5\u5df2\u7ecf\u5728\u300a\u6df1\u5165\u7406\u89e3 Java \u865a\u62df\u673a\u300b\u7b2c\u4e09\u7248\u4e2d\u88ab\u6539\u6b63\u8fc7\u6765\u4e86\u3002\u611f\u8c22 R \u5927\u7684\u56de\u7b54\uff1a</p> <p></p> <p>\u603b\u7ed3\uff1a</p> <p>\u9488\u5bf9 HotSpot VM \u7684\u5b9e\u73b0\uff0c\u5b83\u91cc\u9762\u7684 GC \u5176\u5b9e\u51c6\u786e\u5206\u7c7b\u53ea\u6709\u4e24\u5927\u79cd\uff1a</p> <p>\u90e8\u5206\u6536\u96c6 (Partial GC)\uff1a</p> <ul> <li>\u65b0\u751f\u4ee3\u6536\u96c6\uff08Minor GC / Young GC\uff09\uff1a\u53ea\u5bf9\u65b0\u751f\u4ee3\u8fdb\u884c\u5783\u573e\u6536\u96c6\uff1b</li> <li>\u8001\u5e74\u4ee3\u6536\u96c6\uff08Major GC / Old GC\uff09\uff1a\u53ea\u5bf9\u8001\u5e74\u4ee3\u8fdb\u884c\u5783\u573e\u6536\u96c6\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f Major GC \u5728\u6709\u7684\u8bed\u5883\u4e2d\u4e5f\u7528\u4e8e\u6307\u4ee3\u6574\u5806\u6536\u96c6\uff1b</li> <li>\u6df7\u5408\u6536\u96c6\uff08Mixed GC\uff09\uff1a\u5bf9\u6574\u4e2a\u65b0\u751f\u4ee3\u548c\u90e8\u5206\u8001\u5e74\u4ee3\u8fdb\u884c\u5783\u573e\u6536\u96c6\u3002</li> </ul> <p>\u6574\u5806\u6536\u96c6 (Full GC)\uff1a\u6536\u96c6\u6574\u4e2a Java \u5806\u548c\u65b9\u6cd5\u533a\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_6","title":"\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd","text":"<p>\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\u662f\u4e3a\u4e86\u786e\u4fdd\u5728 Minor GC \u4e4b\u524d\u8001\u5e74\u4ee3\u672c\u8eab\u8fd8\u6709\u5bb9\u7eb3\u65b0\u751f\u4ee3\u6240\u6709\u5bf9\u8c61\u7684\u5269\u4f59\u7a7a\u95f4\u3002</p> <p>\u300a\u6df1\u5165\u7406\u89e3 Java \u865a\u62df\u673a\u300b\u7b2c\u4e09\u7ae0\u5bf9\u4e8e\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\u7684\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <p>JDK 6 Update 24 \u4e4b\u524d\uff0c\u5728\u53d1\u751f Minor GC \u4e4b\u524d\uff0c\u865a\u62df\u673a\u5fc5\u987b\u5148\u68c0\u67e5\u8001\u5e74\u4ee3\u6700\u5927\u53ef\u7528\u7684\u8fde\u7eed\u7a7a\u95f4\u662f\u5426\u5927\u4e8e\u65b0\u751f\u4ee3\u6240\u6709\u5bf9\u8c61\u603b\u7a7a\u95f4\uff0c\u5982\u679c\u8fd9\u4e2a\u6761\u4ef6\u6210\u7acb\uff0c\u90a3\u8fd9\u4e00\u6b21 Minor GC \u53ef\u4ee5\u786e\u4fdd\u662f\u5b89\u5168\u7684\u3002\u5982\u679c\u4e0d\u6210\u7acb\uff0c\u5219\u865a\u62df\u673a\u4f1a\u5148\u67e5\u770b <code>-XX:HandlePromotionFailure</code> \u53c2\u6570\u7684\u8bbe\u7f6e\u503c\u662f\u5426\u5141\u8bb8\u62c5\u4fdd\u5931\u8d25(Handle Promotion Failure);\u5982\u679c\u5141\u8bb8\uff0c\u90a3\u4f1a\u7ee7\u7eed\u68c0\u67e5\u8001\u5e74\u4ee3\u6700\u5927\u53ef\u7528\u7684\u8fde\u7eed\u7a7a\u95f4\u662f\u5426\u5927\u4e8e\u5386\u6b21\u664b\u5347\u5230\u8001\u5e74\u4ee3\u5bf9\u8c61\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5c06\u5c1d\u8bd5\u8fdb\u884c\u4e00\u6b21 Minor GC\uff0c\u5c3d\u7ba1\u8fd9\u6b21 Minor GC \u662f\u6709\u98ce\u9669\u7684;\u5982\u679c\u5c0f\u4e8e\uff0c\u6216\u8005 <code>-XX: HandlePromotionFailure</code> \u8bbe\u7f6e\u4e0d\u5141\u8bb8\u5192\u9669\uff0c\u90a3\u8fd9\u65f6\u5c31\u8981\u6539\u4e3a\u8fdb\u884c\u4e00\u6b21 Full GC\u3002</p> <p>JDK 6 Update 24 \u4e4b\u540e\u7684\u89c4\u5219\u53d8\u4e3a\u53ea\u8981\u8001\u5e74\u4ee3\u7684\u8fde\u7eed\u7a7a\u95f4\u5927\u4e8e\u65b0\u751f\u4ee3\u5bf9\u8c61\u603b\u5927\u5c0f\u6216\u8005\u5386\u6b21\u664b\u5347\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u5c31\u4f1a\u8fdb\u884c Minor GC\uff0c\u5426\u5219\u5c06\u8fdb\u884c Full GC\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_7","title":"\u6b7b\u4ea1\u5bf9\u8c61\u5224\u65ad\u65b9\u6cd5","text":"<p>\u5806\u4e2d\u51e0\u4e4e\u653e\u7740\u6240\u6709\u7684\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u5bf9\u5806\u5783\u573e\u56de\u6536\u524d\u7684\u7b2c\u4e00\u6b65\u5c31\u662f\u8981\u5224\u65ad\u54ea\u4e9b\u5bf9\u8c61\u5df2\u7ecf\u6b7b\u4ea1\uff08\u5373\u4e0d\u80fd\u518d\u88ab\u4efb\u4f55\u9014\u5f84\u4f7f\u7528\u7684\u5bf9\u8c61\uff09\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_8","title":"\u5f15\u7528\u8ba1\u6570\u6cd5","text":"<p>\u7ed9\u5bf9\u8c61\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5f15\u7528\u8ba1\u6570\u5668\uff1a</p> <ul> <li>\u6bcf\u5f53\u6709\u4e00\u4e2a\u5730\u65b9\u5f15\u7528\u5b83\uff0c\u8ba1\u6570\u5668\u5c31\u52a0 1\uff1b</li> <li>\u5f53\u5f15\u7528\u5931\u6548\uff0c\u8ba1\u6570\u5668\u5c31\u51cf 1\uff1b</li> <li>\u4efb\u4f55\u65f6\u5019\u8ba1\u6570\u5668\u4e3a 0 \u7684\u5bf9\u8c61\u5c31\u662f\u4e0d\u53ef\u80fd\u518d\u88ab\u4f7f\u7528\u7684\u3002</li> </ul> <p>\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u7b80\u5355\uff0c\u6548\u7387\u9ad8\uff0c\u4f46\u662f\u76ee\u524d\u4e3b\u6d41\u7684\u865a\u62df\u673a\u4e2d\u5e76\u6ca1\u6709\u9009\u62e9\u8fd9\u4e2a\u7b97\u6cd5\u6765\u7ba1\u7406\u5185\u5b58\uff0c\u5176\u6700\u4e3b\u8981\u7684\u539f\u56e0\u662f\u5b83\u5f88\u96be\u89e3\u51b3\u5bf9\u8c61\u4e4b\u95f4\u76f8\u4e92\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898\u3002</p> <p>\u6240\u8c13\u5bf9\u8c61\u4e4b\u95f4\u7684\u76f8\u4e92\u5f15\u7528\u95ee\u9898\uff0c\u5982\u4e0b\u9762\u4ee3\u7801\u6240\u793a\uff1a\u9664\u4e86\u5bf9\u8c61 <code>objA</code> \u548c <code>objB</code> \u76f8\u4e92\u5f15\u7528\u7740\u5bf9\u65b9\u4e4b\u5916\uff0c\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u4e4b\u95f4\u518d\u65e0\u4efb\u4f55\u5f15\u7528\u3002\u4f46\u662f\u4ed6\u4eec\u56e0\u4e3a\u4e92\u76f8\u5f15\u7528\u5bf9\u65b9\uff0c\u5bfc\u81f4\u5b83\u4eec\u7684\u5f15\u7528\u8ba1\u6570\u5668\u90fd\u4e0d\u4e3a 0\uff0c\u4e8e\u662f\u5f15\u7528\u8ba1\u6570\u7b97\u6cd5\u65e0\u6cd5\u901a\u77e5 GC \u56de\u6536\u5668\u56de\u6536\u4ed6\u4eec\u3002</p> <pre><code>public class ReferenceCountingGc {\nObject instance = null;\npublic static void main(String[] args) {\nReferenceCountingGc objA = new ReferenceCountingGc();\nReferenceCountingGc objB = new ReferenceCountingGc();\nobjA.instance = objB;\nobjB.instance = objA;\nobjA = null;\nobjB = null;\n}\n}\n</code></pre>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_9","title":"\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5","text":"<p>\u8fd9\u4e2a\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u60f3\u5c31\u662f\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u79f0\u4e3a \u201cGC Roots\u201d \u7684\u5bf9\u8c61\u4f5c\u4e3a\u8d77\u70b9\uff0c\u4ece\u8fd9\u4e9b\u8282\u70b9\u5f00\u59cb\u5411\u4e0b\u641c\u7d22\uff0c\u8282\u70b9\u6240\u8d70\u8fc7\u7684\u8def\u5f84\u79f0\u4e3a\u5f15\u7528\u94fe\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u5230 GC Roots \u6ca1\u6709\u4efb\u4f55\u5f15\u7528\u94fe\u76f8\u8fde\u7684\u8bdd\uff0c\u5219\u8bc1\u660e\u6b64\u5bf9\u8c61\u662f\u4e0d\u53ef\u7528\u7684\uff0c\u9700\u8981\u88ab\u56de\u6536\u3002</p> <p>\u4e0b\u56fe\u4e2d\u7684 <code>Object 6 ~ Object 10</code> \u4e4b\u95f4\u867d\u6709\u5f15\u7528\u5173\u7cfb\uff0c\u4f46\u5b83\u4eec\u5230 GC Roots \u4e0d\u53ef\u8fbe\uff0c\u56e0\u6b64\u4e3a\u9700\u8981\u88ab\u56de\u6536\u7684\u5bf9\u8c61\u3002</p> <p></p> <p>\u54ea\u4e9b\u5bf9\u8c61\u53ef\u4ee5\u4f5c\u4e3a GC Roots \u5462\uff1f</p> <ul> <li>\u865a\u62df\u673a\u6808(\u6808\u5e27\u4e2d\u7684\u672c\u5730\u53d8\u91cf\u8868)\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u672c\u5730\u65b9\u6cd5\u6808(Native \u65b9\u6cd5)\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u65b9\u6cd5\u533a\u4e2d\u7c7b\u9759\u6001\u5c5e\u6027\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u65b9\u6cd5\u533a\u4e2d\u5e38\u91cf\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u6240\u6709\u88ab\u540c\u6b65\u9501\u6301\u6709\u7684\u5bf9\u8c61</li> </ul> <p>\u5bf9\u8c61\u53ef\u4ee5\u88ab\u56de\u6536\uff0c\u5c31\u4ee3\u8868\u4e00\u5b9a\u4f1a\u88ab\u56de\u6536\u5417\uff1f</p> <p>\u5373\u4f7f\u5728\u53ef\u8fbe\u6027\u5206\u6790\u6cd5\u4e2d\u4e0d\u53ef\u8fbe\u7684\u5bf9\u8c61\uff0c\u4e5f\u5e76\u975e\u662f\u201c\u975e\u6b7b\u4e0d\u53ef\u201d\u7684\uff0c\u8fd9\u65f6\u5019\u5b83\u4eec\u6682\u65f6\u5904\u4e8e\u201c\u7f13\u5211\u9636\u6bb5\u201d\uff0c\u8981\u771f\u6b63\u5ba3\u544a\u4e00\u4e2a\u5bf9\u8c61\u6b7b\u4ea1\uff0c\u81f3\u5c11\u8981\u7ecf\u5386\u4e24\u6b21\u6807\u8bb0\u8fc7\u7a0b\uff1b\u53ef\u8fbe\u6027\u5206\u6790\u6cd5\u4e2d\u4e0d\u53ef\u8fbe\u7684\u5bf9\u8c61\u88ab\u7b2c\u4e00\u6b21\u6807\u8bb0\u5e76\u4e14\u8fdb\u884c\u4e00\u6b21\u7b5b\u9009\uff0c\u7b5b\u9009\u7684\u6761\u4ef6\u662f\u6b64\u5bf9\u8c61\u662f\u5426\u6709\u5fc5\u8981\u6267\u884c <code>finalize</code> \u65b9\u6cd5\u3002\u5f53\u5bf9\u8c61\u6ca1\u6709\u8986\u76d6 <code>finalize</code> \u65b9\u6cd5\uff0c\u6216 <code>finalize</code> \u65b9\u6cd5\u5df2\u7ecf\u88ab\u865a\u62df\u673a\u8c03\u7528\u8fc7\u65f6\uff0c\u865a\u62df\u673a\u5c06\u8fd9\u4e24\u79cd\u60c5\u51b5\u89c6\u4e3a\u6ca1\u6709\u5fc5\u8981\u6267\u884c\u3002</p> <p>\u88ab\u5224\u5b9a\u4e3a\u9700\u8981\u6267\u884c\u7684\u5bf9\u8c61\u5c06\u4f1a\u88ab\u653e\u5728\u4e00\u4e2a\u961f\u5217\u4e2d\u8fdb\u884c\u7b2c\u4e8c\u6b21\u6807\u8bb0\uff0c\u9664\u975e\u8fd9\u4e2a\u5bf9\u8c61\u4e0e\u5f15\u7528\u94fe\u4e0a\u7684\u4efb\u4f55\u4e00\u4e2a\u5bf9\u8c61\u5efa\u7acb\u5173\u8054\uff0c\u5426\u5219\u5c31\u4f1a\u88ab\u771f\u7684\u56de\u6536\u3002</p> <p><code>Object</code> \u7c7b\u4e2d\u7684 <code>finalize</code> \u65b9\u6cd5\u4e00\u76f4\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u7cdf\u7cd5\u7684\u8bbe\u8ba1\uff0c\u6210\u4e3a\u4e86 Java \u8bed\u8a00\u7684\u8d1f\u62c5\uff0c\u5f71\u54cd\u4e86 Java \u8bed\u8a00\u7684\u5b89\u5168\u548c GC \u7684\u6027\u80fd\u3002JDK9 \u7248\u672c\u53ca\u540e\u7eed\u7248\u672c\u4e2d\u5404\u4e2a\u7c7b\u4e2d\u7684 <code>finalize</code> \u65b9\u6cd5\u4f1a\u88ab\u9010\u6e10\u5f03\u7528\u79fb\u9664\u3002\u5fd8\u6389\u5b83\u7684\u5b58\u5728\u5427\uff01</p> <p>\u53c2\u8003\uff1a</p> <ul> <li>JEP 421: Deprecate Finalization for Removal</li> <li>\u662f\u65f6\u5019\u5fd8\u6389 finalize \u65b9\u6cd5\u4e86</li> </ul>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_10","title":"\u5f15\u7528\u7c7b\u578b\u603b\u7ed3","text":"<p>\u65e0\u8bba\u662f\u901a\u8fc7\u5f15\u7528\u8ba1\u6570\u6cd5\u5224\u65ad\u5bf9\u8c61\u5f15\u7528\u6570\u91cf\uff0c\u8fd8\u662f\u901a\u8fc7\u53ef\u8fbe\u6027\u5206\u6790\u6cd5\u5224\u65ad\u5bf9\u8c61\u7684\u5f15\u7528\u94fe\u662f\u5426\u53ef\u8fbe\uff0c\u5224\u5b9a\u5bf9\u8c61\u7684\u5b58\u6d3b\u90fd\u4e0e\u201c\u5f15\u7528\u201d\u6709\u5173\u3002</p> <p>JDK1.2 \u4e4b\u524d\uff0cJava \u4e2d\u5f15\u7528\u7684\u5b9a\u4e49\u5f88\u4f20\u7edf\uff1a\u5982\u679c reference \u7c7b\u578b\u7684\u6570\u636e\u5b58\u50a8\u7684\u6570\u503c\u4ee3\u8868\u7684\u662f\u53e6\u4e00\u5757\u5185\u5b58\u7684\u8d77\u59cb\u5730\u5740\uff0c\u5c31\u79f0\u8fd9\u5757\u5185\u5b58\u4ee3\u8868\u4e00\u4e2a\u5f15\u7528\u3002</p> <p>JDK1.2 \u4ee5\u540e\uff0cJava \u5bf9\u5f15\u7528\u7684\u6982\u5ff5\u8fdb\u884c\u4e86\u6269\u5145\uff0c\u5c06\u5f15\u7528\u5206\u4e3a\u5f3a\u5f15\u7528\u3001\u8f6f\u5f15\u7528\u3001\u5f31\u5f15\u7528\u3001\u865a\u5f15\u7528\u56db\u79cd\uff08\u5f15\u7528\u5f3a\u5ea6\u9010\u6e10\u51cf\u5f31\uff09</p> <p>1\uff0e\u5f3a\u5f15\u7528\uff08StrongReference\uff09</p> <p>\u4ee5\u524d\u6211\u4eec\u4f7f\u7528\u7684\u5927\u90e8\u5206\u5f15\u7528\u5b9e\u9645\u4e0a\u90fd\u662f\u5f3a\u5f15\u7528\uff0c\u8fd9\u662f\u4f7f\u7528\u6700\u666e\u904d\u7684\u5f15\u7528\u3002\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u5177\u6709\u5f3a\u5f15\u7528\uff0c\u90a3\u5c31\u7c7b\u4f3c\u4e8e \u5fc5\u4e0d\u53ef\u5c11\u7684\u751f\u6d3b\u7528\u54c1\uff0c\u5783\u573e\u56de\u6536\u5668\u7edd\u4e0d\u4f1a\u56de\u6536\u5b83\u3002\u5f53\u5185\u5b58\u7a7a\u95f4\u4e0d\u8db3\uff0cJava \u865a\u62df\u673a\u5b81\u613f\u629b\u51fa OutOfMemoryError \u9519\u8bef\uff0c\u4f7f\u7a0b\u5e8f\u5f02\u5e38\u7ec8\u6b62\uff0c\u4e5f\u4e0d\u4f1a\u9760\u968f\u610f\u56de\u6536\u5177\u6709\u5f3a\u5f15\u7528\u7684\u5bf9\u8c61\u6765\u89e3\u51b3\u5185\u5b58\u4e0d\u8db3\u95ee\u9898\u3002</p> <p>2\uff0e\u8f6f\u5f15\u7528\uff08SoftReference\uff09</p> <p>\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u53ea\u5177\u6709\u8f6f\u5f15\u7528\uff0c\u90a3\u5c31\u7c7b\u4f3c\u4e8e \u53ef\u6709\u53ef\u65e0\u7684\u751f\u6d3b\u7528\u54c1\u3002\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u8db3\u591f\uff0c\u5783\u573e\u56de\u6536\u5668\u5c31\u4e0d\u4f1a\u56de\u6536\u5b83\uff0c\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u8db3\u4e86\uff0c\u5c31\u4f1a\u56de\u6536\u8fd9\u4e9b\u5bf9\u8c61\u7684\u5185\u5b58\u3002\u53ea\u8981\u5783\u573e\u56de\u6536\u5668\u6ca1\u6709\u56de\u6536\u5b83\uff0c\u8be5\u5bf9\u8c61\u5c31\u53ef\u4ee5\u88ab\u7a0b\u5e8f\u4f7f\u7528\u3002\u8f6f\u5f15\u7528\u53ef\u7528\u6765\u5b9e\u73b0\u5185\u5b58\u654f\u611f\u7684\u9ad8\u901f\u7f13\u5b58\u3002</p> <p>\u8f6f\u5f15\u7528\u53ef\u4ee5\u548c\u4e00\u4e2a\u5f15\u7528\u961f\u5217\uff08ReferenceQueue\uff09\u8054\u5408\u4f7f\u7528\uff0c\u5982\u679c\u8f6f\u5f15\u7528\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\uff0cJAVA \u865a\u62df\u673a\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6f\u5f15\u7528\u52a0\u5165\u5230\u4e0e\u4e4b\u5173\u8054\u7684\u5f15\u7528\u961f\u5217\u4e2d\u3002</p> <p>3\uff0e\u5f31\u5f15\u7528\uff08WeakReference\uff09</p> <p>\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u53ea\u5177\u6709\u5f31\u5f15\u7528\uff0c\u90a3\u5c31\u7c7b\u4f3c\u4e8e \u53ef\u6709\u53ef\u65e0\u7684\u751f\u6d3b\u7528\u54c1\u3002\u5f31\u5f15\u7528\u4e0e\u8f6f\u5f15\u7528\u7684\u533a\u522b\u5728\u4e8e\uff1a\u53ea\u5177\u6709\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\u62e5\u6709\u66f4\u77ed\u6682\u7684\u751f\u547d\u5468\u671f\u3002\u5728\u5783\u573e\u56de\u6536\u5668\u7ebf\u7a0b\u626b\u63cf\u5b83\u6240\u7ba1\u8f96\u7684\u5185\u5b58\u533a\u57df\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u65e6\u53d1\u73b0\u4e86\u53ea\u5177\u6709\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u5f53\u524d\u5185\u5b58\u7a7a\u95f4\u8db3\u591f\u4e0e\u5426\uff0c\u90fd\u4f1a\u56de\u6536\u5b83\u7684\u5185\u5b58\u3002\u4e0d\u8fc7\uff0c\u7531\u4e8e\u5783\u573e\u56de\u6536\u5668\u662f\u4e00\u4e2a\u4f18\u5148\u7ea7\u5f88\u4f4e\u7684\u7ebf\u7a0b\uff0c \u56e0\u6b64\u4e0d\u4e00\u5b9a\u4f1a\u5f88\u5feb\u53d1\u73b0\u90a3\u4e9b\u53ea\u5177\u6709\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> <p>\u5f31\u5f15\u7528\u53ef\u4ee5\u548c\u4e00\u4e2a\u5f15\u7528\u961f\u5217\uff08ReferenceQueue\uff09\u8054\u5408\u4f7f\u7528\uff0c\u5982\u679c\u5f31\u5f15\u7528\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\uff0cJava \u865a\u62df\u673a\u5c31\u4f1a\u628a\u8fd9\u4e2a\u5f31\u5f15\u7528\u52a0\u5165\u5230\u4e0e\u4e4b\u5173\u8054\u7684\u5f15\u7528\u961f\u5217\u4e2d\u3002</p> <p>4\uff0e\u865a\u5f15\u7528\uff08PhantomReference\uff09</p> <p>\"\u865a\u5f15\u7528\"\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u5f62\u540c\u865a\u8bbe\uff0c\u4e0e\u5176\u4ed6\u51e0\u79cd\u5f15\u7528\u90fd\u4e0d\u540c\uff0c\u865a\u5f15\u7528\u5e76\u4e0d\u4f1a\u51b3\u5b9a\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u3002\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u4ec5\u6301\u6709\u865a\u5f15\u7528\uff0c\u90a3\u4e48\u5b83\u5c31\u548c\u6ca1\u6709\u4efb\u4f55\u5f15\u7528\u4e00\u6837\uff0c\u5728\u4efb\u4f55\u65f6\u5019\u90fd\u53ef\u80fd\u88ab\u5783\u573e\u56de\u6536\u3002</p> <p>\u865a\u5f15\u7528\u4e3b\u8981\u7528\u6765\u8ddf\u8e2a\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\u7684\u6d3b\u52a8\u3002</p> <p>\u865a\u5f15\u7528\u4e0e\u8f6f\u5f15\u7528\u548c\u5f31\u5f15\u7528\u7684\u4e00\u4e2a\u533a\u522b\u5728\u4e8e\uff1a \u865a\u5f15\u7528\u5fc5\u987b\u548c\u5f15\u7528\u961f\u5217\uff08ReferenceQueue\uff09\u8054\u5408\u4f7f\u7528\u3002\u5f53\u5783\u573e\u56de\u6536\u5668\u51c6\u5907\u56de\u6536\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u5982\u679c\u53d1\u73b0\u5b83\u8fd8\u6709\u865a\u5f15\u7528\uff0c\u5c31\u4f1a\u5728\u56de\u6536\u5bf9\u8c61\u7684\u5185\u5b58\u4e4b\u524d\uff0c\u628a\u8fd9\u4e2a\u865a\u5f15\u7528\u52a0\u5165\u5230\u4e0e\u4e4b\u5173\u8054\u7684\u5f15\u7528\u961f\u5217\u4e2d\u3002\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u5224\u65ad\u5f15\u7528\u961f\u5217\u4e2d\u662f\u5426\u5df2\u7ecf\u52a0\u5165\u4e86\u865a\u5f15\u7528\uff0c\u6765\u4e86\u89e3\u88ab\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u5426\u5c06\u8981\u88ab\u5783\u573e\u56de\u6536\u3002\u7a0b\u5e8f\u5982\u679c\u53d1\u73b0\u67d0\u4e2a\u865a\u5f15\u7528\u5df2\u7ecf\u88ab\u52a0\u5165\u5230\u5f15\u7528\u961f\u5217\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u7684\u5185\u5b58\u88ab\u56de\u6536\u4e4b\u524d\u91c7\u53d6\u5fc5\u8981\u7684\u884c\u52a8\u3002</p> <p>\u7279\u522b\u6ce8\u610f\uff0c\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\u4e00\u822c\u5f88\u5c11\u4f7f\u7528\u5f31\u5f15\u7528\u4e0e\u865a\u5f15\u7528\uff0c\u4f7f\u7528\u8f6f\u5f15\u7528\u7684\u60c5\u51b5\u8f83\u591a\uff0c\u8fd9\u662f\u56e0\u4e3a \u8f6f\u5f15\u7528\u53ef\u4ee5\u52a0\u901f JVM \u5bf9\u5783\u573e\u5185\u5b58\u7684\u56de\u6536\u901f\u5ea6\uff0c\u53ef\u4ee5\u7ef4\u62a4\u7cfb\u7edf\u7684\u8fd0\u884c\u5b89\u5168\uff0c\u9632\u6b62\u5185\u5b58\u6ea2\u51fa\uff08OutOfMemory\uff09\u7b49\u95ee\u9898\u7684\u4ea7\u751f\u3002</p> <p>Android \u653e\u5f03\u4e86 SoftReference </p> <p>Avoid Soft References for Caching</p> <p>\u79fb\u52a8\u8bbe\u5907\u5bf9\u5185\u5b58\u6bd4\u8f83\u654f\u611f\uff0c\u800cSoftReference \u65e0\u6cd5\u63d0\u4f9b\u8db3\u591f\u7684\u4fe1\u606f\u53ef\u4ee5\u8ba9 runtime \u5f88\u8f7b\u677e\u5730\u51b3\u5b9a clear \u5b83\u8fd8\u662f keep \u5b83\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u6709 10 \u4e2a SoftReference \u53d8\u91cf\uff0c\u5e76\u4e14\u4ed6\u4eec\u6240\u5f15\u7528\u7684\u53d8\u91cf\u90fd\u6ca1\u6709\u4e86 Strong Reference\uff0c\u90a3\u4e48 runtime \u5c31\u61f5\u903c\u4e86\uff0c\u56e0\u4e3a\u5b83\u4e0d\u77e5\u9053\u8be5clear \u54ea\u51e0\u4e2a\u6216\u8005 keep \u54ea\u51e0\u4e2a\u3002 \u66f4\u8981\u547d\u7684\u662f\uff0cruntime \u4e0d\u77e5\u9053\u5e94\u8be5\u662f clear \u6389 SoftReference \u8fd8\u662f\u589e\u5927 Heap\u3002\u6240\u4ee5Android\u8ba4\u4e3a \u8f6f\u5f15\u7528\u5bf9\u4e8e\u7f13\u5b58\u6765\u8bf4\u662f\u4f4e\u6548\u7684\u3002</p> <p>\u7f3a\u4e4f\u5173\u4e8e\u6bcf\u4e2a\u5f15\u7528\u5bf9\u5e94\u7528\u7a0b\u5e8f\u7684\u4ef7\u503c\u7684\u4fe1\u606f\u9650\u5236\u4e86\u8f6f\u5f15\u7528\u7684\u6709\u7528\u6027\u3002\u8fc7\u65e9\u6e05\u9664\u5f15\u7528\u4f1a\u5bfc\u81f4\u4e0d\u5fc5\u8981\u7684\u5de5\u4f5c\uff1b\u90a3\u4e9b\u592a\u665a\u6e05\u9664\u7684\u4f1a\u6d6a\u8d39\u5185\u5b58\u3002 \u6240\u4ee5Android\u63a8\u8350\u4f7f\u7528 android.util.LruCache \u505aCache \u7ba1\u7406\uff0c\u81f3\u5c11 LruCache \u53ef\u4ee5\u6839\u636e\u53d8\u91cf\u7684\u4f7f\u7528\u9891\u6b21\u6765\u51b3\u5b9a\u662f\u5426\u5e94\u8be5 clear \u6389\u5b83\uff0c\u8fd9\u6837\u5c31\u6bd4\u5355\u7eaf\u4f7f\u7528 SoftReference \u591a\u4e86\u4e00\u4e2a\u51b3\u7b56\u6761\u4ef6 - \u4f7f\u7528\u9891\u6b21\u3002 \u6216\u8005\u76f4\u63a5\u4f7f\u7528\u5f31\u5f15\u7528</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_11","title":"\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u5e38\u91cf\u662f\u5e9f\u5f03\u5e38\u91cf\uff1f","text":"<p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e3b\u8981\u56de\u6536\u7684\u662f\u5e9f\u5f03\u7684\u5e38\u91cf\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u5e38\u91cf\u662f\u5e9f\u5f03\u5e38\u91cf\u5462\uff1f</p> <p>JDK1.7 \u53ca\u4e4b\u540e\u7248\u672c\u7684 JVM \u5df2\u7ecf\u5c06\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4ece\u65b9\u6cd5\u533a\u4e2d\u79fb\u4e86\u51fa\u6765\uff0c\u5728 Java \u5806\uff08Heap\uff09\u4e2d\u5f00\u8f9f\u4e86\u4e00\u5757\u533a\u57df\u5b58\u653e\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u3002</p> <p>\ud83d\udc1b \u4fee\u6b63\uff08\u53c2\u89c1\uff1aissue747\uff0creference\uff09 \uff1a</p> <ol> <li>JDK1.7 \u4e4b\u524d\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u903b\u8f91\u5305\u542b\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5b58\u653e\u5728\u65b9\u6cd5\u533a, \u6b64\u65f6 hotspot \u865a\u62df\u673a\u5bf9\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0\u4e3a\u6c38\u4e45\u4ee3</li> <li>JDK1.7 \u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u88ab\u4ece\u65b9\u6cd5\u533a\u62ff\u5230\u4e86\u5806\u4e2d, \u8fd9\u91cc\u6ca1\u6709\u63d0\u5230\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60,\u4e5f\u5c31\u662f\u8bf4\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u88ab\u5355\u72ec\u62ff\u5230\u5806,\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u5269\u4e0b\u7684\u4e1c\u897f\u8fd8\u5728\u65b9\u6cd5\u533a, \u4e5f\u5c31\u662f hotspot \u4e2d\u7684\u6c38\u4e45\u4ee3 \u3002</li> <li>JDK1.8 hotspot \u79fb\u9664\u4e86\u6c38\u4e45\u4ee3\u7528\u5143\u7a7a\u95f4(Metaspace)\u53d6\u800c\u4ee3\u4e4b, \u8fd9\u65f6\u5019\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u8fd8\u5728\u5806, \u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u8fd8\u5728\u65b9\u6cd5\u533a, \u53ea\u4e0d\u8fc7\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0\u4ece\u6c38\u4e45\u4ee3\u53d8\u6210\u4e86\u5143\u7a7a\u95f4(Metaspace)</li> </ol> <p>\u5047\u5982\u5728\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u5b58\u5728\u5b57\u7b26\u4e32 \"abc\"\uff0c\u5982\u679c\u5f53\u524d\u6ca1\u6709\u4efb\u4f55 String \u5bf9\u8c61\u5f15\u7528\u8be5\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u8bdd\uff0c\u5c31\u8bf4\u660e\u5e38\u91cf \"abc\" \u5c31\u662f\u5e9f\u5f03\u5e38\u91cf\uff0c\u5982\u679c\u8fd9\u65f6\u53d1\u751f\u5185\u5b58\u56de\u6536\u7684\u8bdd\u800c\u4e14\u6709\u5fc5\u8981\u7684\u8bdd\uff0c\"abc\" \u5c31\u4f1a\u88ab\u7cfb\u7edf\u6e05\u7406\u51fa\u5e38\u91cf\u6c60\u4e86\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_12","title":"\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u7c7b\u662f\u65e0\u7528\u7684\u7c7b","text":"<p>\u65b9\u6cd5\u533a\u4e3b\u8981\u56de\u6536\u7684\u662f\u65e0\u7528\u7684\u7c7b\uff0c\u90a3\u4e48\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u7c7b\u662f\u65e0\u7528\u7684\u7c7b\u7684\u5462\uff1f</p> <p>\u5224\u5b9a\u4e00\u4e2a\u5e38\u91cf\u662f\u5426\u662f\u201c\u5e9f\u5f03\u5e38\u91cf\u201d\u6bd4\u8f83\u7b80\u5355\uff0c\u800c\u8981\u5224\u5b9a\u4e00\u4e2a\u7c7b\u662f\u5426\u662f\u201c\u65e0\u7528\u7684\u7c7b\u201d\u7684\u6761\u4ef6\u5219\u76f8\u5bf9\u82db\u523b\u8bb8\u591a\u3002\u7c7b\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e0b\u9762 3 \u4e2a\u6761\u4ef6\u624d\u80fd\u7b97\u662f \u201c\u65e0\u7528\u7684\u7c7b\u201d \uff1a</p> <ul> <li>\u8be5\u7c7b\u6240\u6709\u7684\u5b9e\u4f8b\u90fd\u5df2\u7ecf\u88ab\u56de\u6536\uff0c\u4e5f\u5c31\u662f Java \u5806\u4e2d\u4e0d\u5b58\u5728\u8be5\u7c7b\u7684\u4efb\u4f55\u5b9e\u4f8b\u3002</li> <li>\u52a0\u8f7d\u8be5\u7c7b\u7684 <code>ClassLoader</code> \u5df2\u7ecf\u88ab\u56de\u6536\u3002</li> <li>\u8be5\u7c7b\u5bf9\u5e94\u7684 <code>java.lang.Class</code> \u5bf9\u8c61\u6ca1\u6709\u5728\u4efb\u4f55\u5730\u65b9\u88ab\u5f15\u7528\uff0c\u65e0\u6cd5\u5728\u4efb\u4f55\u5730\u65b9\u901a\u8fc7\u53cd\u5c04\u8bbf\u95ee\u8be5\u7c7b\u7684\u65b9\u6cd5\u3002</li> </ul> <p>\u865a\u62df\u673a\u53ef\u4ee5\u5bf9\u6ee1\u8db3\u4e0a\u8ff0 3 \u4e2a\u6761\u4ef6\u7684\u65e0\u7528\u7c7b\u8fdb\u884c\u56de\u6536\uff0c\u8fd9\u91cc\u8bf4\u7684\u4ec5\u4ec5\u662f\u201c\u53ef\u4ee5\u201d\uff0c\u800c\u5e76\u4e0d\u662f\u548c\u5bf9\u8c61\u4e00\u6837\u4e0d\u4f7f\u7528\u4e86\u5c31\u4f1a\u5fc5\u7136\u88ab\u56de\u6536\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_13","title":"\u5783\u573e\u6536\u96c6\u7b97\u6cd5","text":""},{"location":"front-end/android/jvm/jvm-garbage-collection/#-","title":"\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5","text":"<p>\u8be5\u7b97\u6cd5\u5206\u4e3a\u201c\u6807\u8bb0\u201d\u548c\u201c\u6e05\u9664\u201d\u9636\u6bb5\uff1a\u9996\u5148\u6807\u8bb0\u51fa\u6240\u6709\u4e0d\u9700\u8981\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u5728\u6807\u8bb0\u5b8c\u6210\u540e\u7edf\u4e00\u56de\u6536\u6389\u6240\u6709\u6ca1\u6709\u88ab\u6807\u8bb0\u7684\u5bf9\u8c61\u3002\u5b83\u662f\u6700\u57fa\u7840\u7684\u6536\u96c6\u7b97\u6cd5\uff0c\u540e\u7eed\u7684\u7b97\u6cd5\u90fd\u662f\u5bf9\u5176\u4e0d\u8db3\u8fdb\u884c\u6539\u8fdb\u5f97\u5230\u3002\u8fd9\u79cd\u5783\u573e\u6536\u96c6\u7b97\u6cd5\u4f1a\u5e26\u6765\u4e24\u4e2a\u660e\u663e\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u6548\u7387\u95ee\u9898</li> <li>\u7a7a\u95f4\u95ee\u9898\uff08\u6807\u8bb0\u6e05\u9664\u540e\u4f1a\u4ea7\u751f\u5927\u91cf\u4e0d\u8fde\u7eed\u7684\u788e\u7247\uff09</li> </ol> <p></p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#-_1","title":"\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u6548\u7387\u95ee\u9898\uff0c\u201c\u6807\u8bb0-\u590d\u5236\u201d\u6536\u96c6\u7b97\u6cd5\u51fa\u73b0\u4e86\u3002\u5b83\u53ef\u4ee5\u5c06\u5185\u5b58\u5206\u4e3a\u5927\u5c0f\u76f8\u540c\u7684\u4e24\u5757\uff0c\u6bcf\u6b21\u4f7f\u7528\u5176\u4e2d\u7684\u4e00\u5757\u3002\u5f53\u8fd9\u4e00\u5757\u7684\u5185\u5b58\u4f7f\u7528\u5b8c\u540e\uff0c\u5c31\u5c06\u8fd8\u5b58\u6d3b\u7684\u5bf9\u8c61\u590d\u5236\u5230\u53e6\u4e00\u5757\u53bb\uff0c\u7136\u540e\u518d\u628a\u4f7f\u7528\u7684\u7a7a\u95f4\u4e00\u6b21\u6e05\u7406\u6389\u3002\u8fd9\u6837\u5c31\u4f7f\u6bcf\u6b21\u7684\u5185\u5b58\u56de\u6536\u90fd\u662f\u5bf9\u5185\u5b58\u533a\u95f4\u7684\u4e00\u534a\u8fdb\u884c\u56de\u6536\u3002</p> <p></p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#-_2","title":"\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5","text":"<p>\u6839\u636e\u8001\u5e74\u4ee3\u7684\u7279\u70b9\u63d0\u51fa\u7684\u4e00\u79cd\u6807\u8bb0\u7b97\u6cd5\uff0c\u6807\u8bb0\u8fc7\u7a0b\u4ecd\u7136\u4e0e\u201c\u6807\u8bb0-\u6e05\u9664\u201d\u7b97\u6cd5\u4e00\u6837\uff0c\u4f46\u540e\u7eed\u6b65\u9aa4\u4e0d\u662f\u76f4\u63a5\u5bf9\u53ef\u56de\u6536\u5bf9\u8c61\u56de\u6536\uff0c\u800c\u662f\u8ba9\u6240\u6709\u5b58\u6d3b\u7684\u5bf9\u8c61\u5411\u4e00\u7aef\u79fb\u52a8\uff0c\u7136\u540e\u76f4\u63a5\u6e05\u7406\u6389\u7aef\u8fb9\u754c\u4ee5\u5916\u7684\u5185\u5b58\u3002</p> <p></p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_14","title":"\u5206\u4ee3\u6536\u96c6\u7b97\u6cd5","text":"<p>\u5f53\u524d\u865a\u62df\u673a\u7684\u5783\u573e\u6536\u96c6\u90fd\u91c7\u7528\u5206\u4ee3\u6536\u96c6\u7b97\u6cd5\uff0c\u8fd9\u79cd\u7b97\u6cd5\u6ca1\u6709\u4ec0\u4e48\u65b0\u7684\u601d\u60f3\uff0c\u53ea\u662f\u6839\u636e\u5bf9\u8c61\u5b58\u6d3b\u5468\u671f\u7684\u4e0d\u540c\u5c06\u5185\u5b58\u5206\u4e3a\u51e0\u5757\u3002\u4e00\u822c\u5c06 java \u5806\u5206\u4e3a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u5404\u4e2a\u5e74\u4ee3\u7684\u7279\u70b9\u9009\u62e9\u5408\u9002\u7684\u5783\u573e\u6536\u96c6\u7b97\u6cd5\u3002</p> <p>\u6bd4\u5982\u5728\u65b0\u751f\u4ee3\u4e2d\uff0c\u6bcf\u6b21\u6536\u96c6\u90fd\u4f1a\u6709\u5927\u91cf\u5bf9\u8c61\u6b7b\u53bb\uff0c\u6240\u4ee5\u53ef\u4ee5\u9009\u62e9\u201d\u6807\u8bb0-\u590d\u5236\u201c\u7b97\u6cd5\uff0c\u53ea\u9700\u8981\u4ed8\u51fa\u5c11\u91cf\u5bf9\u8c61\u7684\u590d\u5236\u6210\u672c\u5c31\u53ef\u4ee5\u5b8c\u6210\u6bcf\u6b21\u5783\u573e\u6536\u96c6\u3002\u800c\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u5b58\u6d3b\u51e0\u7387\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u800c\u4e14\u6ca1\u6709\u989d\u5916\u7684\u7a7a\u95f4\u5bf9\u5b83\u8fdb\u884c\u5206\u914d\u62c5\u4fdd\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u9009\u62e9\u201c\u6807\u8bb0-\u6e05\u9664\u201d\u6216\u201c\u6807\u8bb0-\u6574\u7406\u201d\u7b97\u6cd5\u8fdb\u884c\u5783\u573e\u6536\u96c6\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_15","title":"\u5783\u573e\u6536\u96c6\u5668","text":"<p>\u5982\u679c\u8bf4\u6536\u96c6\u7b97\u6cd5\u662f\u5185\u5b58\u56de\u6536\u7684\u65b9\u6cd5\u8bba\uff0c\u90a3\u4e48\u5783\u573e\u6536\u96c6\u5668\u5c31\u662f\u5185\u5b58\u56de\u6536\u7684\u5177\u4f53\u5b9e\u73b0\u3002</p> <p>\u867d\u7136\u6211\u4eec\u5bf9\u5404\u4e2a\u6536\u96c6\u5668\u8fdb\u884c\u6bd4\u8f83\uff0c\u4f46\u5e76\u975e\u8981\u6311\u9009\u51fa\u4e00\u4e2a\u6700\u597d\u7684\u6536\u96c6\u5668\u3002\u56e0\u4e3a\u76f4\u5230\u73b0\u5728\u4e3a\u6b62\u8fd8\u6ca1\u6709\u6700\u597d\u7684\u5783\u573e\u6536\u96c6\u5668\u51fa\u73b0\uff0c\u66f4\u52a0\u6ca1\u6709\u4e07\u80fd\u7684\u5783\u573e\u6536\u96c6\u5668\uff0c\u6211\u4eec\u80fd\u505a\u7684\u5c31\u662f\u6839\u636e\u5177\u4f53\u5e94\u7528\u573a\u666f\u9009\u62e9\u9002\u5408\u81ea\u5df1\u7684\u5783\u573e\u6536\u96c6\u5668\u3002\u8bd5\u60f3\u4e00\u4e0b\uff1a\u5982\u679c\u6709\u4e00\u79cd\u56db\u6d77\u4e4b\u5185\u3001\u4efb\u4f55\u573a\u666f\u4e0b\u90fd\u9002\u7528\u7684\u5b8c\u7f8e\u6536\u96c6\u5668\u5b58\u5728\uff0c\u90a3\u4e48\u6211\u4eec\u7684 HotSpot \u865a\u62df\u673a\u5c31\u4e0d\u4f1a\u5b9e\u73b0\u90a3\u4e48\u591a\u4e0d\u540c\u7684\u5783\u573e\u6536\u96c6\u5668\u4e86\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#serial","title":"Serial \u6536\u96c6\u5668","text":"<p>Serial\uff08\u4e32\u884c\uff09\u6536\u96c6\u5668\u662f\u6700\u57fa\u672c\u3001\u5386\u53f2\u6700\u60a0\u4e45\u7684\u5783\u573e\u6536\u96c6\u5668\u4e86\u3002\u5927\u5bb6\u770b\u540d\u5b57\u5c31\u77e5\u9053\u8fd9\u4e2a\u6536\u96c6\u5668\u662f\u4e00\u4e2a\u5355\u7ebf\u7a0b\u6536\u96c6\u5668\u4e86\u3002\u5b83\u7684 \u201c\u5355\u7ebf\u7a0b\u201d \u7684\u610f\u4e49\u4e0d\u4ec5\u4ec5\u610f\u5473\u7740\u5b83\u53ea\u4f1a\u4f7f\u7528\u4e00\u6761\u5783\u573e\u6536\u96c6\u7ebf\u7a0b\u53bb\u5b8c\u6210\u5783\u573e\u6536\u96c6\u5de5\u4f5c\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5b83\u5728\u8fdb\u884c\u5783\u573e\u6536\u96c6\u5de5\u4f5c\u7684\u65f6\u5019\u5fc5\u987b\u6682\u505c\u5176\u4ed6\u6240\u6709\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff08 \"Stop The World\" \uff09\uff0c\u76f4\u5230\u5b83\u6536\u96c6\u7ed3\u675f\u3002</p> <p>\u65b0\u751f\u4ee3\u91c7\u7528\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff0c\u8001\u5e74\u4ee3\u91c7\u7528\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u3002</p> <p></p> <p>\u865a\u62df\u673a\u7684\u8bbe\u8ba1\u8005\u4eec\u5f53\u7136\u77e5\u9053 Stop The World \u5e26\u6765\u7684\u4e0d\u826f\u7528\u6237\u4f53\u9a8c\uff0c\u6240\u4ee5\u5728\u540e\u7eed\u7684\u5783\u573e\u6536\u96c6\u5668\u8bbe\u8ba1\u4e2d\u505c\u987f\u65f6\u95f4\u5728\u4e0d\u65ad\u7f29\u77ed\uff08\u4ecd\u7136\u8fd8\u6709\u505c\u987f\uff0c\u5bfb\u627e\u6700\u4f18\u79c0\u7684\u5783\u573e\u6536\u96c6\u5668\u7684\u8fc7\u7a0b\u4ecd\u7136\u5728\u7ee7\u7eed\uff09\u3002</p> <p>\u4f46\u662f Serial \u6536\u96c6\u5668\u6709\u6ca1\u6709\u4f18\u4e8e\u5176\u4ed6\u5783\u573e\u6536\u96c6\u5668\u7684\u5730\u65b9\u5462\uff1f\u5f53\u7136\u6709\uff0c\u5b83 \u7b80\u5355\u800c\u9ad8\u6548\uff08\u4e0e\u5176\u4ed6\u6536\u96c6\u5668\u7684\u5355\u7ebf\u7a0b\u76f8\u6bd4\uff09\u3002Serial \u6536\u96c6\u5668\u7531\u4e8e\u6ca1\u6709\u7ebf\u7a0b\u4ea4\u4e92\u7684\u5f00\u9500\uff0c\u81ea\u7136\u53ef\u4ee5\u83b7\u5f97\u5f88\u9ad8\u7684\u5355\u7ebf\u7a0b\u6536\u96c6\u6548\u7387\u3002Serial \u6536\u96c6\u5668\u5bf9\u4e8e\u8fd0\u884c\u5728 Client \u6a21\u5f0f\u4e0b\u7684\u865a\u62df\u673a\u6765\u8bf4\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#parnew","title":"ParNew \u6536\u96c6\u5668","text":"<p>ParNew \u6536\u96c6\u5668\u5176\u5b9e\u5c31\u662f Serial \u6536\u96c6\u5668\u7684\u591a\u7ebf\u7a0b\u7248\u672c\uff0c\u9664\u4e86\u4f7f\u7528\u591a\u7ebf\u7a0b\u8fdb\u884c\u5783\u573e\u6536\u96c6\u5916\uff0c\u5176\u4f59\u884c\u4e3a\uff08\u63a7\u5236\u53c2\u6570\u3001\u6536\u96c6\u7b97\u6cd5\u3001\u56de\u6536\u7b56\u7565\u7b49\u7b49\uff09\u548c Serial \u6536\u96c6\u5668\u5b8c\u5168\u4e00\u6837\u3002</p> <p>\u65b0\u751f\u4ee3\u91c7\u7528\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff0c\u8001\u5e74\u4ee3\u91c7\u7528\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u3002</p> <p></p> <p>\u5b83\u662f\u8bb8\u591a\u8fd0\u884c\u5728 Server \u6a21\u5f0f\u4e0b\u7684\u865a\u62df\u673a\u7684\u9996\u8981\u9009\u62e9\uff0c\u9664\u4e86 Serial \u6536\u96c6\u5668\u5916\uff0c\u53ea\u6709\u5b83\u80fd\u4e0e CMS \u6536\u96c6\u5668\uff08\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u5e76\u53d1\u6536\u96c6\u5668\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecd\u5230\uff09\u914d\u5408\u5de5\u4f5c\u3002</p> <p>\u5e76\u884c\u548c\u5e76\u53d1\u6982\u5ff5\u8865\u5145\uff1a</p> <ul> <li> <p>\u5e76\u884c\uff08Parallel\uff09 \uff1a\u6307\u591a\u6761\u5783\u573e\u6536\u96c6\u7ebf\u7a0b\u5e76\u884c\u5de5\u4f5c\uff0c\u4f46\u6b64\u65f6\u7528\u6237\u7ebf\u7a0b\u4ecd\u7136\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002</p> </li> <li> <p>\u5e76\u53d1\uff08Concurrent\uff09\uff1a\u6307\u7528\u6237\u7ebf\u7a0b\u4e0e\u5783\u573e\u6536\u96c6\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\uff08\u4f46\u4e0d\u4e00\u5b9a\u662f\u5e76\u884c\uff0c\u53ef\u80fd\u4f1a\u4ea4\u66ff\u6267\u884c\uff09\uff0c\u7528\u6237\u7a0b\u5e8f\u5728\u7ee7\u7eed\u8fd0\u884c\uff0c\u800c\u5783\u573e\u6536\u96c6\u5668\u8fd0\u884c\u5728\u53e6\u4e00\u4e2a CPU \u4e0a\u3002</p> </li> </ul>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#parallel-scavenge","title":"Parallel Scavenge \u6536\u96c6\u5668","text":"<p>Parallel Scavenge \u6536\u96c6\u5668\u4e5f\u662f\u4f7f\u7528\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\u7684\u591a\u7ebf\u7a0b\u6536\u96c6\u5668\uff0c\u5b83\u770b\u4e0a\u53bb\u51e0\u4e4e\u548c ParNew \u90fd\u4e00\u6837\u3002 \u90a3\u4e48\u5b83\u6709\u4ec0\u4e48\u7279\u522b\u4e4b\u5904\u5462\uff1f</p> <pre><code>-XX:+UseParallelGC\n\n    \u4f7f\u7528 Parallel \u6536\u96c6\u5668+ \u8001\u5e74\u4ee3\u4e32\u884c\n\n-XX:+UseParallelOldGC\n\n    \u4f7f\u7528 Parallel \u6536\u96c6\u5668+ \u8001\u5e74\u4ee3\u5e76\u884c\n</code></pre> <p>Parallel Scavenge \u6536\u96c6\u5668\u5173\u6ce8\u70b9\u662f\u541e\u5410\u91cf\uff08\u9ad8\u6548\u7387\u7684\u5229\u7528 CPU\uff09\u3002CMS \u7b49\u5783\u573e\u6536\u96c6\u5668\u7684\u5173\u6ce8\u70b9\u66f4\u591a\u7684\u662f\u7528\u6237\u7ebf\u7a0b\u7684\u505c\u987f\u65f6\u95f4\uff08\u63d0\u9ad8\u7528\u6237\u4f53\u9a8c\uff09\u3002\u6240\u8c13\u541e\u5410\u91cf\u5c31\u662f CPU \u4e2d\u7528\u4e8e\u8fd0\u884c\u7528\u6237\u4ee3\u7801\u7684\u65f6\u95f4\u4e0e CPU \u603b\u6d88\u8017\u65f6\u95f4\u7684\u6bd4\u503c\u3002 Parallel Scavenge \u6536\u96c6\u5668\u63d0\u4f9b\u4e86\u5f88\u591a\u53c2\u6570\u4f9b\u7528\u6237\u627e\u5230\u6700\u5408\u9002\u7684\u505c\u987f\u65f6\u95f4\u6216\u6700\u5927\u541e\u5410\u91cf\uff0c\u5982\u679c\u5bf9\u4e8e\u6536\u96c6\u5668\u8fd0\u4f5c\u4e0d\u592a\u4e86\u89e3\uff0c\u624b\u5de5\u4f18\u5316\u5b58\u5728\u56f0\u96be\u7684\u65f6\u5019\uff0c\u4f7f\u7528 Parallel Scavenge \u6536\u96c6\u5668\u914d\u5408\u81ea\u9002\u5e94\u8c03\u8282\u7b56\u7565\uff0c\u628a\u5185\u5b58\u7ba1\u7406\u4f18\u5316\u4ea4\u7ed9\u865a\u62df\u673a\u53bb\u5b8c\u6210\u4e5f\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002</p> <p>\u65b0\u751f\u4ee3\u91c7\u7528\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff0c\u8001\u5e74\u4ee3\u91c7\u7528\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u3002</p> <p></p> <p>\u8fd9\u662f JDK1.8 \u9ed8\u8ba4\u6536\u96c6\u5668</p> <p>\u4f7f\u7528 <code>java -XX:+PrintCommandLineFlags -version</code> \u547d\u4ee4\u67e5\u770b</p> <pre><code>-XX:InitialHeapSize=262921408 -XX:MaxHeapSize=4206742528 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC\njava version \"1.8.0_211\"\nJava(TM) SE Runtime Environment (build 1.8.0_211-b12)\nJava HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)\n</code></pre> <p>JDK1.8 \u9ed8\u8ba4\u4f7f\u7528\u7684\u662f Parallel Scavenge + Parallel Old\uff0c\u5982\u679c\u6307\u5b9a\u4e86-XX:+UseParallelGC \u53c2\u6570\uff0c\u5219\u9ed8\u8ba4\u6307\u5b9a\u4e86-XX:+UseParallelOldGC\uff0c\u53ef\u4ee5\u4f7f\u7528-XX:-UseParallelOldGC \u6765\u7981\u7528\u8be5\u529f\u80fd</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#serial-old","title":"Serial Old \u6536\u96c6\u5668","text":"<p>Serial \u6536\u96c6\u5668\u7684\u8001\u5e74\u4ee3\u7248\u672c\uff0c\u5b83\u540c\u6837\u662f\u4e00\u4e2a\u5355\u7ebf\u7a0b\u6536\u96c6\u5668\u3002\u5b83\u4e3b\u8981\u6709\u4e24\u5927\u7528\u9014\uff1a\u4e00\u79cd\u7528\u9014\u662f\u5728 JDK1.5 \u4ee5\u53ca\u4ee5\u524d\u7684\u7248\u672c\u4e2d\u4e0e Parallel Scavenge \u6536\u96c6\u5668\u642d\u914d\u4f7f\u7528\uff0c\u53e6\u4e00\u79cd\u7528\u9014\u662f\u4f5c\u4e3a CMS \u6536\u96c6\u5668\u7684\u540e\u5907\u65b9\u6848\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#parallel-old","title":"Parallel Old \u6536\u96c6\u5668","text":"<p>Parallel Scavenge \u6536\u96c6\u5668\u7684\u8001\u5e74\u4ee3\u7248\u672c\u3002\u4f7f\u7528\u591a\u7ebf\u7a0b\u548c\u201c\u6807\u8bb0-\u6574\u7406\u201d\u7b97\u6cd5\u3002\u5728\u6ce8\u91cd\u541e\u5410\u91cf\u4ee5\u53ca CPU \u8d44\u6e90\u7684\u573a\u5408\uff0c\u90fd\u53ef\u4ee5\u4f18\u5148\u8003\u8651 Parallel Scavenge \u6536\u96c6\u5668\u548c Parallel Old \u6536\u96c6\u5668\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#cms","title":"CMS \u6536\u96c6\u5668","text":"<p>CMS\uff08Concurrent Mark Sweep\uff09\u6536\u96c6\u5668\u662f\u4e00\u79cd\u4ee5\u83b7\u53d6\u6700\u77ed\u56de\u6536\u505c\u987f\u65f6\u95f4\u4e3a\u76ee\u6807\u7684\u6536\u96c6\u5668\u3002\u5b83\u975e\u5e38\u7b26\u5408\u5728\u6ce8\u91cd\u7528\u6237\u4f53\u9a8c\u7684\u5e94\u7528\u4e0a\u4f7f\u7528\u3002</p> <p>CMS\uff08Concurrent Mark Sweep\uff09\u6536\u96c6\u5668\u662f HotSpot \u865a\u62df\u673a\u7b2c\u4e00\u6b3e\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u5e76\u53d1\u6536\u96c6\u5668\uff0c\u5b83\u7b2c\u4e00\u6b21\u5b9e\u73b0\u4e86\u8ba9\u5783\u573e\u6536\u96c6\u7ebf\u7a0b\u4e0e\u7528\u6237\u7ebf\u7a0b\uff08\u57fa\u672c\u4e0a\uff09\u540c\u65f6\u5de5\u4f5c\u3002</p> <p>\u4ece\u540d\u5b57\u4e2d\u7684 Mark Sweep \u8fd9\u4e24\u4e2a\u8bcd\u53ef\u4ee5\u770b\u51fa\uff0cCMS \u6536\u96c6\u5668\u662f\u4e00\u79cd  \u201c\u6807\u8bb0-\u6e05\u9664\u201d\u7b97\u6cd5 \u5b9e\u73b0\u7684\uff0c\u5b83\u7684\u8fd0\u4f5c\u8fc7\u7a0b\u76f8\u6bd4\u4e8e\u524d\u9762\u51e0\u79cd\u5783\u573e\u6536\u96c6\u5668\u6765\u8bf4\u66f4\u52a0\u590d\u6742\u4e00\u4e9b\u3002\u6574\u4e2a\u8fc7\u7a0b\u5206\u4e3a\u56db\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u521d\u59cb\u6807\u8bb0\uff1a \u6682\u505c\u6240\u6709\u7684\u5176\u4ed6\u7ebf\u7a0b\uff0c\u5e76\u8bb0\u5f55\u4e0b\u76f4\u63a5\u4e0e root \u76f8\u8fde\u7684\u5bf9\u8c61\uff0c\u901f\u5ea6\u5f88\u5feb \uff1b</li> <li>\u5e76\u53d1\u6807\u8bb0\uff1a \u540c\u65f6\u5f00\u542f GC \u548c\u7528\u6237\u7ebf\u7a0b\uff0c\u7528\u4e00\u4e2a\u95ed\u5305\u7ed3\u6784\u53bb\u8bb0\u5f55\u53ef\u8fbe\u5bf9\u8c61\u3002\u4f46\u5728\u8fd9\u4e2a\u9636\u6bb5\u7ed3\u675f\uff0c\u8fd9\u4e2a\u95ed\u5305\u7ed3\u6784\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u5305\u542b\u5f53\u524d\u6240\u6709\u7684\u53ef\u8fbe\u5bf9\u8c61\u3002\u56e0\u4e3a\u7528\u6237\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u4e0d\u65ad\u7684\u66f4\u65b0\u5f15\u7528\u57df\uff0c\u6240\u4ee5 GC \u7ebf\u7a0b\u65e0\u6cd5\u4fdd\u8bc1\u53ef\u8fbe\u6027\u5206\u6790\u7684\u5b9e\u65f6\u6027\u3002\u6240\u4ee5\u8fd9\u4e2a\u7b97\u6cd5\u91cc\u4f1a\u8ddf\u8e2a\u8bb0\u5f55\u8fd9\u4e9b\u53d1\u751f\u5f15\u7528\u66f4\u65b0\u7684\u5730\u65b9\u3002</li> <li>\u91cd\u65b0\u6807\u8bb0\uff1a \u91cd\u65b0\u6807\u8bb0\u9636\u6bb5\u5c31\u662f\u4e3a\u4e86\u4fee\u6b63\u5e76\u53d1\u6807\u8bb0\u671f\u95f4\u56e0\u4e3a\u7528\u6237\u7a0b\u5e8f\u7ee7\u7eed\u8fd0\u884c\u800c\u5bfc\u81f4\u6807\u8bb0\u4ea7\u751f\u53d8\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u5bf9\u8c61\u7684\u6807\u8bb0\u8bb0\u5f55\uff0c\u8fd9\u4e2a\u9636\u6bb5\u7684\u505c\u987f\u65f6\u95f4\u4e00\u822c\u4f1a\u6bd4\u521d\u59cb\u6807\u8bb0\u9636\u6bb5\u7684\u65f6\u95f4\u7a0d\u957f\uff0c\u8fdc\u8fdc\u6bd4\u5e76\u53d1\u6807\u8bb0\u9636\u6bb5\u65f6\u95f4\u77ed</li> <li>\u5e76\u53d1\u6e05\u9664\uff1a \u5f00\u542f\u7528\u6237\u7ebf\u7a0b\uff0c\u540c\u65f6 GC \u7ebf\u7a0b\u5f00\u59cb\u5bf9\u672a\u6807\u8bb0\u7684\u533a\u57df\u505a\u6e05\u626b\u3002</li> </ul> <p></p> <p>\u4ece\u5b83\u7684\u540d\u5b57\u5c31\u53ef\u4ee5\u770b\u51fa\u5b83\u662f\u4e00\u6b3e\u4f18\u79c0\u7684\u5783\u573e\u6536\u96c6\u5668\uff0c\u4e3b\u8981\u4f18\u70b9\uff1a\u5e76\u53d1\u6536\u96c6\u3001\u4f4e\u505c\u987f\u3002\u4f46\u662f\u5b83\u6709\u4e0b\u9762\u4e09\u4e2a\u660e\u663e\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u5bf9 CPU \u8d44\u6e90\u654f\u611f\uff1b</li> <li>\u65e0\u6cd5\u5904\u7406\u6d6e\u52a8\u5783\u573e\uff1b</li> <li>\u5b83\u4f7f\u7528\u7684\u56de\u6536\u7b97\u6cd5-\u201c\u6807\u8bb0-\u6e05\u9664\u201d\u7b97\u6cd5\u4f1a\u5bfc\u81f4\u6536\u96c6\u7ed3\u675f\u65f6\u4f1a\u6709\u5927\u91cf\u7a7a\u95f4\u788e\u7247\u4ea7\u751f\u3002</li> </ul>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#g1","title":"G1 \u6536\u96c6\u5668","text":"<p>G1 (Garbage-First) \u662f\u4e00\u6b3e\u9762\u5411\u670d\u52a1\u5668\u7684\u5783\u573e\u6536\u96c6\u5668,\u4e3b\u8981\u9488\u5bf9\u914d\u5907\u591a\u9897\u5904\u7406\u5668\u53ca\u5927\u5bb9\u91cf\u5185\u5b58\u7684\u673a\u5668. \u4ee5\u6781\u9ad8\u6982\u7387\u6ee1\u8db3 GC \u505c\u987f\u65f6\u95f4\u8981\u6c42\u7684\u540c\u65f6,\u8fd8\u5177\u5907\u9ad8\u541e\u5410\u91cf\u6027\u80fd\u7279\u5f81.</p> <p>\u88ab\u89c6\u4e3a JDK1.7 \u4e2d HotSpot \u865a\u62df\u673a\u7684\u4e00\u4e2a\u91cd\u8981\u8fdb\u5316\u7279\u5f81\u3002\u5b83\u5177\u5907\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>\u5e76\u884c\u4e0e\u5e76\u53d1\uff1aG1 \u80fd\u5145\u5206\u5229\u7528 CPU\u3001\u591a\u6838\u73af\u5883\u4e0b\u7684\u786c\u4ef6\u4f18\u52bf\uff0c\u4f7f\u7528\u591a\u4e2a CPU\uff08CPU \u6216\u8005 CPU \u6838\u5fc3\uff09\u6765\u7f29\u77ed Stop-The-World \u505c\u987f\u65f6\u95f4\u3002\u90e8\u5206\u5176\u4ed6\u6536\u96c6\u5668\u539f\u672c\u9700\u8981\u505c\u987f Java \u7ebf\u7a0b\u6267\u884c\u7684 GC \u52a8\u4f5c\uff0cG1 \u6536\u96c6\u5668\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u5e76\u53d1\u7684\u65b9\u5f0f\u8ba9 java \u7a0b\u5e8f\u7ee7\u7eed\u6267\u884c\u3002</li> <li>\u5206\u4ee3\u6536\u96c6\uff1a\u867d\u7136 G1 \u53ef\u4ee5\u4e0d\u9700\u8981\u5176\u4ed6\u6536\u96c6\u5668\u914d\u5408\u5c31\u80fd\u72ec\u7acb\u7ba1\u7406\u6574\u4e2a GC \u5806\uff0c\u4f46\u662f\u8fd8\u662f\u4fdd\u7559\u4e86\u5206\u4ee3\u7684\u6982\u5ff5\u3002</li> <li>\u7a7a\u95f4\u6574\u5408\uff1a\u4e0e CMS \u7684\u201c\u6807\u8bb0-\u6e05\u7406\u201d\u7b97\u6cd5\u4e0d\u540c\uff0cG1 \u4ece\u6574\u4f53\u6765\u770b\u662f\u57fa\u4e8e\u201c\u6807\u8bb0-\u6574\u7406\u201d\u7b97\u6cd5\u5b9e\u73b0\u7684\u6536\u96c6\u5668\uff1b\u4ece\u5c40\u90e8\u4e0a\u6765\u770b\u662f\u57fa\u4e8e\u201c\u6807\u8bb0-\u590d\u5236\u201d\u7b97\u6cd5\u5b9e\u73b0\u7684\u3002</li> <li>\u53ef\u9884\u6d4b\u7684\u505c\u987f\uff1a\u8fd9\u662f G1 \u76f8\u5bf9\u4e8e CMS \u7684\u53e6\u4e00\u4e2a\u5927\u4f18\u52bf\uff0c\u964d\u4f4e\u505c\u987f\u65f6\u95f4\u662f G1 \u548c CMS \u5171\u540c\u7684\u5173\u6ce8\u70b9\uff0c\u4f46 G1 \u9664\u4e86\u8ffd\u6c42\u4f4e\u505c\u987f\u5916\uff0c\u8fd8\u80fd\u5efa\u7acb\u53ef\u9884\u6d4b\u7684\u505c\u987f\u65f6\u95f4\u6a21\u578b\uff0c\u80fd\u8ba9\u4f7f\u7528\u8005\u660e\u786e\u6307\u5b9a\u5728\u4e00\u4e2a\u957f\u5ea6\u4e3a M \u6beb\u79d2\u7684\u65f6\u95f4\u7247\u6bb5\u5185\u3002</li> </ul> <p>G1 \u6536\u96c6\u5668\u7684\u8fd0\u4f5c\u5927\u81f4\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u521d\u59cb\u6807\u8bb0</li> <li>\u5e76\u53d1\u6807\u8bb0</li> <li>\u6700\u7ec8\u6807\u8bb0</li> <li>\u7b5b\u9009\u56de\u6536</li> </ul> <p>G1 \u6536\u96c6\u5668\u5728\u540e\u53f0\u7ef4\u62a4\u4e86\u4e00\u4e2a\u4f18\u5148\u5217\u8868\uff0c\u6bcf\u6b21\u6839\u636e\u5141\u8bb8\u7684\u6536\u96c6\u65f6\u95f4\uff0c\u4f18\u5148\u9009\u62e9\u56de\u6536\u4ef7\u503c\u6700\u5927\u7684 Region(\u8fd9\u4e5f\u5c31\u662f\u5b83\u7684\u540d\u5b57 Garbage-First \u7684\u7531\u6765) \u3002\u8fd9\u79cd\u4f7f\u7528 Region \u5212\u5206\u5185\u5b58\u7a7a\u95f4\u4ee5\u53ca\u6709\u4f18\u5148\u7ea7\u7684\u533a\u57df\u56de\u6536\u65b9\u5f0f\uff0c\u4fdd\u8bc1\u4e86 G1 \u6536\u96c6\u5668\u5728\u6709\u9650\u65f6\u95f4\u5185\u53ef\u4ee5\u5c3d\u53ef\u80fd\u9ad8\u7684\u6536\u96c6\u6548\u7387\uff08\u628a\u5185\u5b58\u5316\u6574\u4e3a\u96f6\uff09\u3002</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#zgc","title":"ZGC \u6536\u96c6\u5668","text":"<p>\u4e0e CMS \u4e2d\u7684 ParNew \u548c G1 \u7c7b\u4f3c\uff0cZGC \u4e5f\u91c7\u7528\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff0c\u4e0d\u8fc7 ZGC \u5bf9\u8be5\u7b97\u6cd5\u505a\u4e86\u91cd\u5927\u6539\u8fdb\u3002</p> <p>\u5728 ZGC \u4e2d\u51fa\u73b0 Stop The World \u7684\u60c5\u51b5\u4f1a\u66f4\u5c11\uff01</p> <p>\u8be6\u60c5\u53ef\u4ee5\u770b \uff1a \u300a\u65b0\u4e00\u4ee3\u5783\u573e\u56de\u6536\u5668 ZGC \u7684\u63a2\u7d22\u4e0e\u5b9e\u8df5\u300b</p>"},{"location":"front-end/android/jvm/jvm-garbage-collection/#_16","title":"\u53c2\u8003","text":"<p>https://javaguide.cn/java/jvm/jvm-garbage-collection.html</p>"},{"location":"front-end/android/jvm/memory-area/","title":"Java \u5185\u5b58\u533a\u57df\u8be6\u89e3","text":""},{"location":"front-end/android/jvm/memory-area/#_1","title":"\u524d\u8a00","text":"<p>\u5bf9\u4e8e Java \u7a0b\u5e8f\u5458\u6765\u8bf4\uff0c\u5728\u865a\u62df\u673a\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u673a\u5236\u4e0b\uff0c\u4e0d\u518d\u9700\u8981\u50cf C/C++\u7a0b\u5e8f\u5f00\u53d1\u7a0b\u5e8f\u5458\u8fd9\u6837\u4e3a\u6bcf\u4e00\u4e2a new \u64cd\u4f5c\u53bb\u5199\u5bf9\u5e94\u7684 delete/free \u64cd\u4f5c\uff0c\u4e0d\u5bb9\u6613\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u548c\u5185\u5b58\u6ea2\u51fa\u95ee\u9898\u3002\u6b63\u662f\u56e0\u4e3a Java \u7a0b\u5e8f\u5458\u628a\u5185\u5b58\u63a7\u5236\u6743\u5229\u4ea4\u7ed9 Java \u865a\u62df\u673a\uff0c\u4e00\u65e6\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u548c\u6ea2\u51fa\u65b9\u9762\u7684\u95ee\u9898\uff0c\u5982\u679c\u4e0d\u4e86\u89e3\u865a\u62df\u673a\u662f\u600e\u6837\u4f7f\u7528\u5185\u5b58\u7684\uff0c\u90a3\u4e48\u6392\u67e5\u9519\u8bef\u5c06\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u8270\u5de8\u7684\u4efb\u52a1\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_2","title":"\u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df","text":"<p>Java \u865a\u62df\u673a\u5728\u6267\u884c Java \u7a0b\u5e8f\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u628a\u5b83\u7ba1\u7406\u7684\u5185\u5b58\u5212\u5206\u6210\u82e5\u5e72\u4e2a\u4e0d\u540c\u7684\u6570\u636e\u533a\u57df\u3002JDK 1.8 \u548c\u4e4b\u524d\u7684\u7248\u672c\u7565\u6709\u4e0d\u540c\uff0c\u4e0b\u9762\u4f1a\u4ecb\u7ecd\u5230\u3002</p> <p>JDK 1.8 \u4e4b\u524d \uff1a</p> <p></p> <p>JDK 1.8 \u4e4b\u540e \uff1a</p> <p></p> <p>\u7ebf\u7a0b\u79c1\u6709\u7684\uff1a</p> <ul> <li>\u7a0b\u5e8f\u8ba1\u6570\u5668</li> <li>\u865a\u62df\u673a\u6808</li> <li>\u672c\u5730\u65b9\u6cd5\u6808</li> </ul> <p>\u7ebf\u7a0b\u5171\u4eab\u7684\uff1a</p> <ul> <li>\u5806</li> <li>\u65b9\u6cd5\u533a</li> <li>\u76f4\u63a5\u5185\u5b58 (\u975e\u8fd0\u884c\u65f6\u6570\u636e\u533a\u7684\u4e00\u90e8\u5206)</li> </ul> <p>Java \u865a\u62df\u673a\u89c4\u8303\u5bf9\u4e8e\u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df\u7684\u89c4\u5b9a\u662f\u76f8\u5f53\u5bbd\u677e\u7684\u3002\u4ee5\u5806\u4e3a\u4f8b\uff1a\u5806\u53ef\u4ee5\u662f\u8fde\u7eed\u7a7a\u95f4\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u8fde\u7eed\u3002\u5806\u7684\u5927\u5c0f\u53ef\u4ee5\u56fa\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u6309\u9700\u6269\u5c55 \u3002\u865a\u62df\u673a\u5b9e\u73b0\u8005\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u5783\u573e\u56de\u6536\u7b97\u6cd5\u7ba1\u7406\u5806\uff0c\u751a\u81f3\u5b8c\u5168\u4e0d\u8fdb\u884c\u5783\u573e\u6536\u96c6\u4e5f\u662f\u53ef\u4ee5\u7684\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_3","title":"\u7a0b\u5e8f\u8ba1\u6570\u5668","text":"<p>\u7a0b\u5e8f\u8ba1\u6570\u5668\u662f\u4e00\u5757\u8f83\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u5f53\u524d\u7ebf\u7a0b\u6240\u6267\u884c\u7684\u5b57\u8282\u7801\u7684\u884c\u53f7\u6307\u793a\u5668\u3002\u5b57\u8282\u7801\u89e3\u91ca\u5668\u5de5\u4f5c\u65f6\u901a\u8fc7\u6539\u53d8\u8fd9\u4e2a\u8ba1\u6570\u5668\u7684\u503c\u6765\u9009\u53d6\u4e0b\u4e00\u6761\u9700\u8981\u6267\u884c\u7684\u5b57\u8282\u7801\u6307\u4ee4\uff0c\u5206\u652f\u3001\u5faa\u73af\u3001\u8df3\u8f6c\u3001\u5f02\u5e38\u5904\u7406\u3001\u7ebf\u7a0b\u6062\u590d\u7b49\u529f\u80fd\u90fd\u9700\u8981\u4f9d\u8d56\u8fd9\u4e2a\u8ba1\u6570\u5668\u6765\u5b8c\u6210\u3002</p> <p>\u53e6\u5916\uff0c\u4e3a\u4e86\u7ebf\u7a0b\u5207\u6362\u540e\u80fd\u6062\u590d\u5230\u6b63\u786e\u7684\u6267\u884c\u4f4d\u7f6e\uff0c\u6bcf\u6761\u7ebf\u7a0b\u90fd\u9700\u8981\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u5404\u7ebf\u7a0b\u4e4b\u95f4\u8ba1\u6570\u5668\u4e92\u4e0d\u5f71\u54cd\uff0c\u72ec\u7acb\u5b58\u50a8\uff0c\u6211\u4eec\u79f0\u8fd9\u7c7b\u5185\u5b58\u533a\u57df\u4e3a\u201c\u7ebf\u7a0b\u79c1\u6709\u201d\u7684\u5185\u5b58\u3002</p> <p>\u4ece\u4e0a\u9762\u7684\u4ecb\u7ecd\u4e2d\u6211\u4eec\u77e5\u9053\u4e86\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e3b\u8981\u6709\u4e24\u4e2a\u4f5c\u7528\uff1a</p> <ul> <li> <p>\u5b57\u8282\u7801\u89e3\u91ca\u5668\u901a\u8fc7\u6539\u53d8\u7a0b\u5e8f\u8ba1\u6570\u5668\u6765\u4f9d\u6b21\u8bfb\u53d6\u6307\u4ee4\uff0c\u4ece\u800c\u5b9e\u73b0\u4ee3\u7801\u7684\u6d41\u7a0b\u63a7\u5236\uff0c\u5982\uff1a\u987a\u5e8f\u6267\u884c\u3001\u9009\u62e9\u3001\u5faa\u73af\u3001\u5f02\u5e38\u5904\u7406\u3002</p> </li> <li> <p>\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u7528\u4e8e\u8bb0\u5f55\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u7684\u4f4d\u7f6e\uff0c\u4ece\u800c\u5f53\u7ebf\u7a0b\u88ab\u5207\u6362\u56de\u6765\u7684\u65f6\u5019\u80fd\u591f\u77e5\u9053\u8be5\u7ebf\u7a0b\u4e0a\u6b21\u8fd0\u884c\u5230\u54ea\u513f\u4e86\u3002</p> </li> </ul> <p>\u6ce8\u610f \uff1a\u7a0b\u5e8f\u8ba1\u6570\u5668\u662f\u552f\u4e00\u4e00\u4e2a\u4e0d\u4f1a\u51fa\u73b0 <code>OutOfMemoryError</code> \u7684\u5185\u5b58\u533a\u57df\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u968f  \u7740\u7ebf\u7a0b\u7684\u521b\u5efa\u800c\u521b\u5efa\uff0c\u968f\u7740\u7ebf\u7a0b\u7684\u7ed3\u675f\u800c\u6b7b\u4ea1\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#java","title":"Java \u865a\u62df\u673a\u6808","text":"<p>\u4e0e\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e00\u6837\uff0cJava \u865a\u62df\u673a\u6808\uff08\u540e\u6587\u7b80\u79f0\u6808\uff09\u4e5f\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u548c\u7ebf\u7a0b\u76f8\u540c\uff0c\u968f\u7740\u7ebf\u7a0b\u7684\u521b\u5efa\u800c\u521b\u5efa\uff0c\u968f\u7740\u7ebf\u7a0b\u7684\u6b7b\u4ea1\u800c\u6b7b\u4ea1\u3002</p> <p>\u6808\u7edd\u5bf9\u7b97\u7684\u4e0a\u662f JVM \u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df\u7684\u4e00\u4e2a\u6838\u5fc3\uff0c\u9664\u4e86\u4e00\u4e9b Native \u65b9\u6cd5\u8c03\u7528\u662f\u901a\u8fc7\u672c\u5730\u65b9\u6cd5\u6808\u5b9e\u73b0\u7684(\u540e\u9762\u4f1a\u63d0\u5230)\uff0c\u5176\u4ed6\u6240\u6709\u7684 Java \u65b9\u6cd5\u8c03\u7528\u90fd\u662f\u901a\u8fc7\u6808\u6765\u5b9e\u73b0\u7684\uff08\u4e5f\u9700\u8981\u548c\u5176\u4ed6\u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df\u6bd4\u5982\u7a0b\u5e8f\u8ba1\u6570\u5668\u914d\u5408\uff09\u3002</p> <p>\u65b9\u6cd5\u8c03\u7528\u7684\u6570\u636e\u9700\u8981\u901a\u8fc7\u6808\u8fdb\u884c\u4f20\u9012\uff0c\u6bcf\u4e00\u6b21\u65b9\u6cd5\u8c03\u7528\u90fd\u4f1a\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684\u6808\u5e27\u88ab\u538b\u5165\u6808\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\u7ed3\u675f\u540e\uff0c\u90fd\u4f1a\u6709\u4e00\u4e2a\u6808\u5e27\u88ab\u5f39\u51fa\u3002</p> <p>\u6808\u7531\u4e00\u4e2a\u4e2a\u6808\u5e27\u7ec4\u6210\uff0c\u800c\u6bcf\u4e2a\u6808\u5e27\u4e2d\u90fd\u62e5\u6709\uff1a\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u52a8\u6001\u94fe\u63a5\u3001\u65b9\u6cd5\u8fd4\u56de\u5730\u5740\u3002\u548c\u6570\u636e\u7ed3\u6784\u4e0a\u7684\u6808\u7c7b\u4f3c\uff0c\u4e24\u8005\u90fd\u662f\u5148\u8fdb\u540e\u51fa\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ea\u652f\u6301\u51fa\u6808\u548c\u5165\u6808\u4e24\u79cd\u64cd\u4f5c\u3002</p> <p></p> <p>\u5c40\u90e8\u53d8\u91cf\u8868 \u4e3b\u8981\u5b58\u653e\u4e86\u7f16\u8bd1\u671f\u53ef\u77e5\u7684\u5404\u79cd\u6570\u636e\u7c7b\u578b\uff08boolean\u3001byte\u3001char\u3001short\u3001int\u3001float\u3001long\u3001double\uff09\u3001\u5bf9\u8c61\u5f15\u7528\uff08reference \u7c7b\u578b\uff0c\u5b83\u4e0d\u540c\u4e8e\u5bf9\u8c61\u672c\u8eab\uff0c\u53ef\u80fd\u662f\u4e00\u4e2a\u6307\u5411\u5bf9\u8c61\u8d77\u59cb\u5730\u5740\u7684\u5f15\u7528\u6307\u9488\uff0c\u4e5f\u53ef\u80fd\u662f\u6307\u5411\u4e00\u4e2a\u4ee3\u8868\u5bf9\u8c61\u7684\u53e5\u67c4\u6216\u5176\u4ed6\u4e0e\u6b64\u5bf9\u8c61\u76f8\u5173\u7684\u4f4d\u7f6e\uff09\u3002</p> <p></p> <p>\u64cd\u4f5c\u6570\u6808 \u4e3b\u8981\u4f5c\u4e3a\u65b9\u6cd5\u8c03\u7528\u7684\u4e2d\u8f6c\u7ad9\u4f7f\u7528\uff0c\u7528\u4e8e\u5b58\u653e\u65b9\u6cd5\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\u3002\u53e6\u5916\uff0c\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u4e34\u65f6\u53d8\u91cf\u4e5f\u4f1a\u653e\u5728\u64cd\u4f5c\u6570\u6808\u4e2d\u3002</p> <p>\u52a8\u6001\u94fe\u63a5 \u4e3b\u8981\u670d\u52a1\u4e00\u4e2a\u65b9\u6cd5\u9700\u8981\u8c03\u7528\u5176\u4ed6\u65b9\u6cd5\u7684\u573a\u666f\u3002\u5728 Java \u6e90\u6587\u4ef6\u88ab\u7f16\u8bd1\u6210\u5b57\u8282\u7801\u6587\u4ef6\u65f6\uff0c\u6240\u6709\u7684\u53d8\u91cf\u548c\u65b9\u6cd5\u5f15\u7528\u90fd\u4f5c\u4e3a\u7b26\u53f7\u5f15\u7528\uff08Symbilic Reference\uff09\u4fdd\u5b58\u5728 Class \u6587\u4ef6\u7684\u5e38\u91cf\u6c60\u91cc\u3002\u5f53\u4e00\u4e2a\u65b9\u6cd5\u8981\u8c03\u7528\u5176\u4ed6\u65b9\u6cd5\uff0c\u9700\u8981\u5c06\u5e38\u91cf\u6c60\u4e2d\u6307\u5411\u65b9\u6cd5\u7684\u7b26\u53f7\u5f15\u7528\u8f6c\u5316\u4e3a\u5176\u5728\u5185\u5b58\u5730\u5740\u4e2d\u7684\u76f4\u63a5\u5f15\u7528\u3002\u52a8\u6001\u94fe\u63a5\u7684\u4f5c\u7528\u5c31\u662f\u4e3a\u4e86\u5c06\u7b26\u53f7\u5f15\u7528\u8f6c\u6362\u4e3a\u8c03\u7528\u65b9\u6cd5\u7684\u76f4\u63a5\u5f15\u7528\u3002</p> <p></p> <p>\u6808\u7a7a\u95f4\u867d\u7136\u4e0d\u662f\u65e0\u9650\u7684\uff0c\u4f46\u4e00\u822c\u6b63\u5e38\u8c03\u7528\u7684\u60c5\u51b5\u4e0b\u662f\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\u7684\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u51fd\u6570\u8c03\u7528\u9677\u5165\u65e0\u9650\u5faa\u73af\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6808\u4e2d\u88ab\u538b\u5165\u592a\u591a\u6808\u5e27\u800c\u5360\u7528\u592a\u591a\u7a7a\u95f4\uff0c\u5bfc\u81f4\u6808\u7a7a\u95f4\u8fc7\u6df1\u3002\u90a3\u4e48\u5f53\u7ebf\u7a0b\u8bf7\u6c42\u6808\u7684\u6df1\u5ea6\u8d85\u8fc7\u5f53\u524d Java \u865a\u62df\u673a\u6808\u7684\u6700\u5927\u6df1\u5ea6\u7684\u65f6\u5019\uff0c\u5c31\u629b\u51fa <code>StackOverFlowError</code> \u9519\u8bef\u3002</p> <p>Java \u65b9\u6cd5\u6709\u4e24\u79cd\u8fd4\u56de\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f return \u8bed\u53e5\u6b63\u5e38\u8fd4\u56de\uff0c\u4e00\u79cd\u662f\u629b\u51fa\u5f02\u5e38\u3002\u4e0d\u7ba1\u54ea\u79cd\u8fd4\u56de\u65b9\u5f0f\uff0c\u90fd\u4f1a\u5bfc\u81f4\u6808\u5e27\u88ab\u5f39\u51fa\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c \u6808\u5e27\u968f\u7740\u65b9\u6cd5\u8c03\u7528\u800c\u521b\u5efa\uff0c\u968f\u7740\u65b9\u6cd5\u7ed3\u675f\u800c\u9500\u6bc1\u3002\u65e0\u8bba\u65b9\u6cd5\u6b63\u5e38\u5b8c\u6210\u8fd8\u662f\u5f02\u5e38\u5b8c\u6210\u90fd\u7b97\u4f5c\u65b9\u6cd5\u7ed3\u675f\u3002</p> <p>\u9664\u4e86 <code>StackOverFlowError</code> \u9519\u8bef\u4e4b\u5916\uff0c\u6808\u8fd8\u53ef\u80fd\u4f1a\u51fa\u73b0<code>OutOfMemoryError</code>\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3a\u5982\u679c\u6808\u7684\u5185\u5b58\u5927\u5c0f\u53ef\u4ee5\u52a8\u6001\u6269\u5c55\uff0c \u5982\u679c\u865a\u62df\u673a\u5728\u52a8\u6001\u6269\u5c55\u6808\u65f6\u65e0\u6cd5\u7533\u8bf7\u5230\u8db3\u591f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5219\u629b\u51fa<code>OutOfMemoryError</code>\u5f02\u5e38\u3002</p> <p>\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\u7a0b\u5e8f\u8fd0\u884c\u4e2d\u6808\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e24\u79cd\u9519\u8bef\uff1a</p> <ul> <li><code>StackOverFlowError</code>\uff1a \u82e5\u6808\u7684\u5185\u5b58\u5927\u5c0f\u4e0d\u5141\u8bb8\u52a8\u6001\u6269\u5c55\uff0c\u90a3\u4e48\u5f53\u7ebf\u7a0b\u8bf7\u6c42\u6808\u7684\u6df1\u5ea6\u8d85\u8fc7\u5f53\u524d Java \u865a\u62df\u673a\u6808\u7684\u6700\u5927\u6df1\u5ea6\u7684\u65f6\u5019\uff0c\u5c31\u629b\u51fa <code>StackOverFlowError</code> \u9519\u8bef\u3002</li> <li><code>OutOfMemoryError</code>\uff1a \u5982\u679c\u6808\u7684\u5185\u5b58\u5927\u5c0f\u53ef\u4ee5\u52a8\u6001\u6269\u5c55\uff0c \u5982\u679c\u865a\u62df\u673a\u5728\u52a8\u6001\u6269\u5c55\u6808\u65f6\u65e0\u6cd5\u7533\u8bf7\u5230\u8db3\u591f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5219\u629b\u51fa<code>OutOfMemoryError</code>\u5f02\u5e38\u3002</li> </ul> <p></p>"},{"location":"front-end/android/jvm/memory-area/#_4","title":"\u672c\u5730\u65b9\u6cd5\u6808","text":"<p>\u548c\u865a\u62df\u673a\u6808\u6240\u53d1\u6325\u7684\u4f5c\u7528\u975e\u5e38\u76f8\u4f3c\uff0c\u533a\u522b\u662f\uff1a \u865a\u62df\u673a\u6808\u4e3a\u865a\u62df\u673a\u6267\u884c Java \u65b9\u6cd5 \uff08\u4e5f\u5c31\u662f\u5b57\u8282\u7801\uff09\u670d\u52a1\uff0c\u800c\u672c\u5730\u65b9\u6cd5\u6808\u5219\u4e3a\u865a\u62df\u673a\u4f7f\u7528\u5230\u7684 Native \u65b9\u6cd5\u670d\u52a1\u3002 \u5728 HotSpot \u865a\u62df\u673a\u4e2d\u548c Java \u865a\u62df\u673a\u6808\u5408\u4e8c\u4e3a\u4e00\u3002</p> <p>\u672c\u5730\u65b9\u6cd5\u88ab\u6267\u884c\u7684\u65f6\u5019\uff0c\u5728\u672c\u5730\u65b9\u6cd5\u6808\u4e5f\u4f1a\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\uff0c\u7528\u4e8e\u5b58\u653e\u8be5\u672c\u5730\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u52a8\u6001\u94fe\u63a5\u3001\u51fa\u53e3\u4fe1\u606f\u3002</p> <p>\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\u540e\u76f8\u5e94\u7684\u6808\u5e27\u4e5f\u4f1a\u51fa\u6808\u5e76\u91ca\u653e\u5185\u5b58\u7a7a\u95f4\uff0c\u4e5f\u4f1a\u51fa\u73b0 <code>StackOverFlowError</code> \u548c <code>OutOfMemoryError</code> \u4e24\u79cd\u9519\u8bef\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_5","title":"\u5806","text":"<p>Java \u865a\u62df\u673a\u6240\u7ba1\u7406\u7684\u5185\u5b58\u4e2d\u6700\u5927\u7684\u4e00\u5757\uff0cJava \u5806\u662f\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u5728\u865a\u62df\u673a\u542f\u52a8\u65f6\u521b\u5efa\u3002\u6b64\u5185\u5b58\u533a\u57df\u7684\u552f\u4e00\u76ee\u7684\u5c31\u662f\u5b58\u653e\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u5bf9\u8c61\u5b9e\u4f8b\u4ee5\u53ca\u6570\u7ec4\u90fd\u5728\u8fd9\u91cc\u5206\u914d\u5185\u5b58\u3002</p> <p>Java \u4e16\u754c\u4e2d\u201c\u51e0\u4e4e\u201d\u6240\u6709\u7684\u5bf9\u8c61\u90fd\u5728\u5806\u4e2d\u5206\u914d\uff0c\u4f46\u662f\uff0c\u968f\u7740 JIT \u7f16\u8bd1\u5668\u7684\u53d1\u5c55\u4e0e\u9003\u9038\u5206\u6790\u6280\u672f\u9010\u6e10\u6210\u719f\uff0c\u6808\u4e0a\u5206\u914d\u3001\u6807\u91cf\u66ff\u6362\u4f18\u5316\u6280\u672f\u5c06\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u5fae\u5999\u7684\u53d8\u5316\uff0c\u6240\u6709\u7684\u5bf9\u8c61\u90fd\u5206\u914d\u5230\u5806\u4e0a\u4e5f\u6e10\u6e10\u53d8\u5f97\u4e0d\u90a3\u4e48\u201c\u7edd\u5bf9\u201d\u4e86\u3002\u4ece JDK 1.7 \u5f00\u59cb\u5df2\u7ecf\u9ed8\u8ba4\u5f00\u542f\u9003\u9038\u5206\u6790\uff0c\u5982\u679c\u67d0\u4e9b\u65b9\u6cd5\u4e2d\u7684\u5bf9\u8c61\u5f15\u7528\u6ca1\u6709\u88ab\u8fd4\u56de\u6216\u8005\u672a\u88ab\u5916\u9762\u4f7f\u7528\uff08\u4e5f\u5c31\u662f\u672a\u9003\u9038\u51fa\u53bb\uff09\uff0c\u90a3\u4e48\u5bf9\u8c61\u53ef\u4ee5\u76f4\u63a5\u5728\u6808\u4e0a\u5206\u914d\u5185\u5b58\u3002</p> <p>Java \u5806\u662f\u5783\u573e\u6536\u96c6\u5668\u7ba1\u7406\u7684\u4e3b\u8981\u533a\u57df\uff0c\u56e0\u6b64\u4e5f\u88ab\u79f0\u4f5c GC \u5806\uff08Garbage Collected Heap\uff09\u3002\u4ece\u5783\u573e\u56de\u6536\u7684\u89d2\u5ea6\uff0c\u7531\u4e8e\u73b0\u5728\u6536\u96c6\u5668\u57fa\u672c\u90fd\u91c7\u7528 \u5206\u4ee3\u5783\u573e\u6536\u96c6\u7b97\u6cd5\uff0c\u6240\u4ee5 Java \u5806\u8fd8\u53ef\u4ee5\u7ec6\u5206\u4e3a\uff1a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff1b\u518d\u7ec6\u81f4\u4e00\u70b9\u6709\uff1aEden\u3001Survivor\u3001Old \u7b49\u7a7a\u95f4\u3002\u8fdb\u4e00\u6b65\u5212\u5206\u7684\u76ee\u7684\u662f\u66f4\u597d\u5730\u56de\u6536\u5185\u5b58\uff0c\u6216\u8005\u66f4\u5feb\u5730\u5206\u914d\u5185\u5b58\u3002</p> <p>\u5728 JDK 7 \u7248\u672c\u53ca JDK 7 \u7248\u672c\u4e4b\u524d\uff0c\u5806\u5185\u5b58\u88ab\u901a\u5e38\u5206\u4e3a\u4e0b\u9762\u4e09\u90e8\u5206\uff1a</p> <ol> <li>\u65b0\u751f\u4ee3\u5185\u5b58(Young Generation)</li> <li>\u8001\u751f\u4ee3(Old Generation)</li> <li>\u6c38\u4e45\u4ee3(Permanent Generation)</li> </ol> <p>\u4e0b\u56fe\u6240\u793a\u7684 Eden \u533a\u3001\u4e24\u4e2a Survivor \u533a S0 \u548c S1 \u90fd\u5c5e\u4e8e\u65b0\u751f\u4ee3\uff0c\u4e2d\u95f4\u4e00\u5c42\u5c5e\u4e8e\u8001\u5e74\u4ee3\uff0c\u6700\u4e0b\u9762\u4e00\u5c42\u5c5e\u4e8e\u6c38\u4e45\u4ee3\u3002</p> <p></p> <p>JDK 8 \u7248\u672c\u4e4b\u540e PermGen(\u6c38\u4e45) \u5df2\u88ab Metaspace(\u5143\u7a7a\u95f4) \u53d6\u4ee3\uff0c\u5143\u7a7a\u95f4\u4f7f\u7528\u7684\u662f\u76f4\u63a5\u5185\u5b58 \uff08\u6211\u4f1a\u5728\u65b9\u6cd5\u533a\u8fd9\u90e8\u5206\u5185\u5bb9\u8be6\u7ec6\u4ecb\u7ecd\u5230\uff09\u3002</p> <p>\u5927\u90e8\u5206\u60c5\u51b5\uff0c\u5bf9\u8c61\u90fd\u4f1a\u9996\u5148\u5728 Eden \u533a\u57df\u5206\u914d\uff0c\u5728\u4e00\u6b21\u65b0\u751f\u4ee3\u5783\u573e\u56de\u6536\u540e\uff0c\u5982\u679c\u5bf9\u8c61\u8fd8\u5b58\u6d3b\uff0c\u5219\u4f1a\u8fdb\u5165 S0 \u6216\u8005 S1\uff0c\u5f53\u5b83\u7684\u5e74\u9f84\u589e\u52a0\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff0c\u5c31\u4f1a\u88ab\u664b\u5347\u5230\u8001\u5e74\u4ee3\u4e2d\u3002\u5bf9\u8c61\u664b\u5347\u5230\u8001\u5e74\u4ee3\u7684\u5e74\u9f84\u9608\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570 <code>-XX:MaxTenuringThreshold</code> \u6765\u8bbe\u7f6e\u3002</p> <p>Hotspot \u904d\u5386\u6240\u6709\u5bf9\u8c61\u65f6\uff0c\u6309\u7167\u5e74\u9f84\u4ece\u5c0f\u5230\u5927\u5bf9\u5176\u6240\u5360\u7528\u7684\u5927\u5c0f\u8fdb\u884c\u7d2f\u79ef\uff0c\u5f53\u7d2f\u79ef\u7684\u67d0\u4e2a\u5e74\u9f84\u5927\u5c0f\u8d85\u8fc7\u4e86 survivor \u533a\u7684\u4e00\u534a\u65f6\uff0c\u53d6\u8fd9\u4e2a\u5e74\u9f84\u548c MaxTenuringThreshold \u4e2d\u66f4\u5c0f\u7684\u4e00\u4e2a\u503c\uff0c\u4f5c\u4e3a\u65b0\u7684\u664b\u5347\u5e74\u9f84\u9608\u503c\u3002</p> <p>\u52a8\u6001\u5e74\u9f84\u8ba1\u7b97\u7684\u4ee3\u7801\u5982\u4e0b</p> <pre><code>uint ageTable::compute_tenuring_threshold(size_t survivor_capacity) {\n//survivor_capacity\u662fsurvivor\u7a7a\u95f4\u7684\u5927\u5c0f\nsize_t desired_survivor_size = (size_t)((((double) survivor_capacity)*TargetSurvivorRatio)/100);\nsize_t total = 0;\nuint age = 1;\nwhile (age &lt; table_size) {\ntotal += sizes[age];//sizes\u6570\u7ec4\u662f\u6bcf\u4e2a\u5e74\u9f84\u6bb5\u5bf9\u8c61\u5927\u5c0f\nif (total &gt; desired_survivor_size) break;\nage++;\n}\nuint result = age &lt; MaxTenuringThreshold ? age : MaxTenuringThreshold;\n...\n}\n</code></pre> <p>\u5806\u8fd9\u91cc\u6700\u5bb9\u6613\u51fa\u73b0\u7684\u5c31\u662f <code>OutOfMemoryError</code> \u9519\u8bef\uff0c\u5e76\u4e14\u51fa\u73b0\u8fd9\u79cd\u9519\u8bef\u4e4b\u540e\u7684\u8868\u73b0\u5f62\u5f0f\u8fd8\u4f1a\u6709\u51e0\u79cd\uff0c\u6bd4\u5982\uff1a</p> <ol> <li><code>java.lang.OutOfMemoryError: GC Overhead Limit Exceeded</code> \uff1a \u5f53 JVM \u82b1\u592a\u591a\u65f6\u95f4\u6267\u884c\u5783\u573e\u56de\u6536\u5e76\u4e14\u53ea\u80fd\u56de\u6536\u5f88\u5c11\u7684\u5806\u7a7a\u95f4\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u6b64\u9519\u8bef\u3002</li> <li><code>java.lang.OutOfMemoryError: Java heap space</code> :\u5047\u5982\u5728\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\u65f6, \u5806\u5185\u5b58\u4e2d\u7684\u7a7a\u95f4\u4e0d\u8db3\u4ee5\u5b58\u653e\u65b0\u521b\u5efa\u7684\u5bf9\u8c61, \u5c31\u4f1a\u5f15\u53d1\u6b64\u9519\u8bef\u3002(\u548c\u914d\u7f6e\u7684\u6700\u5927\u5806\u5185\u5b58\u6709\u5173\uff0c\u4e14\u53d7\u5236\u4e8e\u7269\u7406\u5185\u5b58\u5927\u5c0f\u3002\u6700\u5927\u5806\u5185\u5b58\u53ef\u901a\u8fc7<code>-Xmx</code>\u53c2\u6570\u914d\u7f6e\uff0c\u82e5\u6ca1\u6709\u7279\u522b\u914d\u7f6e\uff0c\u5c06\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u503c\uff0c\u8be6\u89c1\uff1aDefault Java 8 max heap size)</li> <li>......</li> </ol>"},{"location":"front-end/android/jvm/memory-area/#_6","title":"\u65b9\u6cd5\u533a","text":"<p>\u65b9\u6cd5\u533a\u5c5e\u4e8e\u662f JVM \u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df\u7684\u4e00\u5757\u903b\u8f91\u533a\u57df\uff0c\u662f\u5404\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5185\u5b58\u533a\u57df\u3002</p> <p>\u300aJava \u865a\u62df\u673a\u89c4\u8303\u300b\u53ea\u662f\u89c4\u5b9a\u4e86\u6709\u65b9\u6cd5\u533a\u8fd9\u4e48\u4e2a\u6982\u5ff5\u548c\u5b83\u7684\u4f5c\u7528\uff0c\u65b9\u6cd5\u533a\u5230\u5e95\u8981\u5982\u4f55\u5b9e\u73b0\u90a3\u5c31\u662f\u865a\u62df\u673a\u81ea\u5df1\u8981\u8003\u8651\u7684\u4e8b\u60c5\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u4e0d\u540c\u7684\u865a\u62df\u673a\u5b9e\u73b0\u4e0a\uff0c\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u5f53\u865a\u62df\u673a\u8981\u4f7f\u7528\u4e00\u4e2a\u7c7b\u65f6\uff0c\u5b83\u9700\u8981\u8bfb\u53d6\u5e76\u89e3\u6790 Class \u6587\u4ef6\u83b7\u53d6\u76f8\u5173\u4fe1\u606f\uff0c\u518d\u5c06\u4fe1\u606f\u5b58\u5165\u5230\u65b9\u6cd5\u533a\u3002\u65b9\u6cd5\u533a\u4f1a\u5b58\u50a8\u5df2\u88ab\u865a\u62df\u673a\u52a0\u8f7d\u7684 \u7c7b\u4fe1\u606f\u3001\u5b57\u6bb5\u4fe1\u606f\u3001\u65b9\u6cd5\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u3001\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7f13\u5b58\u7b49\u6570\u636e\u3002</p> <p>\u65b9\u6cd5\u533a\u548c\u6c38\u4e45\u4ee3\u4ee5\u53ca\u5143\u7a7a\u95f4\u662f\u4ec0\u4e48\u5173\u7cfb\u5462\uff1f \u65b9\u6cd5\u533a\u548c\u6c38\u4e45\u4ee3\u4ee5\u53ca\u5143\u7a7a\u95f4\u7684\u5173\u7cfb\u5f88\u50cf Java \u4e2d\u63a5\u53e3\u548c\u7c7b\u7684\u5173\u7cfb\uff0c\u7c7b\u5b9e\u73b0\u4e86\u63a5\u53e3\uff0c\u8fd9\u91cc\u7684\u7c7b\u5c31\u53ef\u4ee5\u770b\u4f5c\u662f\u6c38\u4e45\u4ee3\u548c\u5143\u7a7a\u95f4\uff0c\u63a5\u53e3\u53ef\u4ee5\u770b\u4f5c\u662f\u65b9\u6cd5\u533a\uff0c\u4e5f\u5c31\u662f\u8bf4\u6c38\u4e45\u4ee3\u4ee5\u53ca\u5143\u7a7a\u95f4\u662f HotSpot \u865a\u62df\u673a\u5bf9\u865a\u62df\u673a\u89c4\u8303\u4e2d\u65b9\u6cd5\u533a\u7684\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002\u5e76\u4e14\uff0c\u6c38\u4e45\u4ee3\u662f JDK 1.8 \u4e4b\u524d\u7684\u65b9\u6cd5\u533a\u5b9e\u73b0\uff0cJDK 1.8 \u53ca\u4ee5\u540e\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0\u53d8\u6210\u4e86\u5143\u7a7a\u95f4\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8981\u5c06\u6c38\u4e45\u4ee3 (PermGen) \u66ff\u6362\u4e3a\u5143\u7a7a\u95f4 (MetaSpace) \u5462?</p> <p>\u4e0b\u56fe\u6765\u81ea\u300a\u6df1\u5165\u7406\u89e3 Java \u865a\u62df\u673a\u300b\u7b2c 3 \u7248 2.2.5</p> <p></p> <p>1\u3001\u6574\u4e2a\u6c38\u4e45\u4ee3\u6709\u4e00\u4e2a JVM \u672c\u8eab\u8bbe\u7f6e\u7684\u56fa\u5b9a\u5927\u5c0f\u4e0a\u9650\uff0c\u65e0\u6cd5\u8fdb\u884c\u8c03\u6574\uff0c\u800c\u5143\u7a7a\u95f4\u4f7f\u7528\u7684\u662f\u76f4\u63a5\u5185\u5b58\uff0c\u53d7\u672c\u673a\u53ef\u7528\u5185\u5b58\u7684\u9650\u5236\uff0c\u867d\u7136\u5143\u7a7a\u95f4\u4ecd\u65e7\u53ef\u80fd\u6ea2\u51fa\uff0c\u4f46\u662f\u6bd4\u539f\u6765\u51fa\u73b0\u7684\u51e0\u7387\u4f1a\u66f4\u5c0f\u3002</p> <p>\u5f53\u5143\u7a7a\u95f4\u6ea2\u51fa\u65f6\u4f1a\u5f97\u5230\u5982\u4e0b\u9519\u8bef\uff1a <code>java.lang.OutOfMemoryError: MetaSpace</code></p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>-XX\uff1aMaxMetaspaceSize</code> \u6807\u5fd7\u8bbe\u7f6e\u6700\u5927\u5143\u7a7a\u95f4\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c\u4e3a unlimited\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u53ea\u53d7\u7cfb\u7edf\u5185\u5b58\u7684\u9650\u5236\u3002<code>-XX\uff1aMetaspaceSize</code> \u8c03\u6574\u6807\u5fd7\u5b9a\u4e49\u5143\u7a7a\u95f4\u7684\u521d\u59cb\u5927\u5c0f\u5982\u679c\u672a\u6307\u5b9a\u6b64\u6807\u5fd7\uff0c\u5219 Metaspace \u5c06\u6839\u636e\u8fd0\u884c\u65f6\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u6c42\u52a8\u6001\u5730\u91cd\u65b0\u8c03\u6574\u5927\u5c0f\u3002</p> <p>2\u3001\u5143\u7a7a\u95f4\u91cc\u9762\u5b58\u653e\u7684\u662f\u7c7b\u7684\u5143\u6570\u636e\uff0c\u8fd9\u6837\u52a0\u8f7d\u591a\u5c11\u7c7b\u7684\u5143\u6570\u636e\u5c31\u4e0d\u7531 <code>MaxPermSize</code> \u63a7\u5236\u4e86, \u800c\u7531\u7cfb\u7edf\u7684\u5b9e\u9645\u53ef\u7528\u7a7a\u95f4\u6765\u63a7\u5236\uff0c\u8fd9\u6837\u80fd\u52a0\u8f7d\u7684\u7c7b\u5c31\u66f4\u591a\u4e86\u3002</p> <p>3\u3001\u5728 JDK8\uff0c\u5408\u5e76 HotSpot \u548c JRockit \u7684\u4ee3\u7801\u65f6, JRockit \u4ece\u6765\u6ca1\u6709\u4e00\u4e2a\u53eb\u6c38\u4e45\u4ee3\u7684\u4e1c\u897f, \u5408\u5e76\u4e4b\u540e\u5c31\u6ca1\u6709\u5fc5\u8981\u989d\u5916\u7684\u8bbe\u7f6e\u8fd9\u4e48\u4e00\u4e2a\u6c38\u4e45\u4ee3\u7684\u5730\u65b9\u4e86\u3002</p> <p>\u65b9\u6cd5\u533a\u5e38\u7528\u53c2\u6570\u6709\u54ea\u4e9b\uff1f</p> <p>JDK 1.8 \u4e4b\u524d\u6c38\u4e45\u4ee3\u8fd8\u6ca1\u88ab\u5f7b\u5e95\u79fb\u9664\u7684\u65f6\u5019\u901a\u5e38\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e9b\u53c2\u6570\u6765\u8c03\u8282\u65b9\u6cd5\u533a\u5927\u5c0f\u3002</p> <pre><code>-XX:PermSize=N //\u65b9\u6cd5\u533a (\u6c38\u4e45\u4ee3) \u521d\u59cb\u5927\u5c0f\n-XX:MaxPermSize=N //\u65b9\u6cd5\u533a (\u6c38\u4e45\u4ee3) \u6700\u5927\u5927\u5c0f,\u8d85\u8fc7\u8fd9\u4e2a\u503c\u5c06\u4f1a\u629b\u51fa OutOfMemoryError \u5f02\u5e38:java.lang.OutOfMemoryError: PermGen\n</code></pre> <p>\u76f8\u5bf9\u800c\u8a00\uff0c\u5783\u573e\u6536\u96c6\u884c\u4e3a\u5728\u8fd9\u4e2a\u533a\u57df\u662f\u6bd4\u8f83\u5c11\u51fa\u73b0\u7684\uff0c\u4f46\u5e76\u975e\u6570\u636e\u8fdb\u5165\u65b9\u6cd5\u533a\u540e\u5c31\u201c\u6c38\u4e45\u5b58\u5728\u201d\u4e86\u3002</p> <p>JDK 1.8 \u7684\u65f6\u5019\uff0c\u65b9\u6cd5\u533a\uff08HotSpot \u7684\u6c38\u4e45\u4ee3\uff09\u88ab\u5f7b\u5e95\u79fb\u9664\u4e86\uff08JDK1.7 \u5c31\u5df2\u7ecf\u5f00\u59cb\u4e86\uff09\uff0c\u53d6\u800c\u4ee3\u4e4b\u662f\u5143\u7a7a\u95f4\uff0c\u5143\u7a7a\u95f4\u4f7f\u7528\u7684\u662f\u76f4\u63a5\u5185\u5b58\u3002\u4e0b\u9762\u662f\u4e00\u4e9b\u5e38\u7528\u53c2\u6570\uff1a</p> <pre><code>-XX:MetaspaceSize=N //\u8bbe\u7f6e Metaspace \u7684\u521d\u59cb\uff08\u548c\u6700\u5c0f\u5927\u5c0f\uff09\n-XX:MaxMetaspaceSize=N //\u8bbe\u7f6e Metaspace \u7684\u6700\u5927\u5927\u5c0f\n</code></pre> <p>\u4e0e\u6c38\u4e45\u4ee3\u5f88\u5927\u7684\u4e0d\u540c\u5c31\u662f\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5927\u5c0f\u7684\u8bdd\uff0c\u968f\u7740\u66f4\u591a\u7c7b\u7684\u521b\u5efa\uff0c\u865a\u62df\u673a\u4f1a\u8017\u5c3d\u6240\u6709\u53ef\u7528\u7684\u7cfb\u7edf\u5185\u5b58\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_7","title":"\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60","text":"<p>Class \u6587\u4ef6\u4e2d\u9664\u4e86\u6709\u7c7b\u7684\u7248\u672c\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u63a5\u53e3\u7b49\u63cf\u8ff0\u4fe1\u606f\u5916\uff0c\u8fd8\u6709\u7528\u4e8e\u5b58\u653e\u7f16\u8bd1\u671f\u751f\u6210\u7684\u5404\u79cd\u5b57\u9762\u91cf\uff08Literal\uff09\u548c\u7b26\u53f7\u5f15\u7528\uff08Symbolic Reference\uff09\u7684 \u5e38\u91cf\u6c60\u8868(Constant Pool Table) \u3002</p> <p>\u5b57\u9762\u91cf\u662f\u6e90\u4ee3\u7801\u4e2d\u7684\u56fa\u5b9a\u503c\u7684\u8868\u793a\u6cd5\uff0c\u5373\u901a\u8fc7\u5b57\u9762\u6211\u4eec\u5c31\u80fd\u77e5\u9053\u5176\u503c\u7684\u542b\u4e49\u3002\u5b57\u9762\u91cf\u5305\u62ec\u6574\u6570\u3001\u6d6e\u70b9\u6570\u548c\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\uff0c\u7b26\u53f7\u5f15\u7528\u5305\u62ec\u7c7b\u7b26\u53f7\u5f15\u7528\u3001\u5b57\u6bb5\u7b26\u53f7\u5f15\u7528\u3001\u65b9\u6cd5\u7b26\u53f7\u5f15\u7528\u548c\u63a5\u53e3\u65b9\u6cd5\u7b26\u53f7\u5f15\u7528\u3002</p> <p>\u5e38\u91cf\u6c60\u8868\u4f1a\u5728\u7c7b\u52a0\u8f7d\u540e\u5b58\u653e\u5230\u65b9\u6cd5\u533a\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\u3002</p> <p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u7684\u529f\u80fd\u7c7b\u4f3c\u4e8e\u4f20\u7edf\u7f16\u7a0b\u8bed\u8a00\u7684\u7b26\u53f7\u8868\uff0c\u5c3d\u7ba1\u5b83\u5305\u542b\u4e86\u6bd4\u5178\u578b\u7b26\u53f7\u8868\u66f4\u5e7f\u6cdb\u7684\u6570\u636e\u3002</p> <p>\u65e2\u7136\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u662f\u65b9\u6cd5\u533a\u7684\u4e00\u90e8\u5206\uff0c\u81ea\u7136\u53d7\u5230\u65b9\u6cd5\u533a\u5185\u5b58\u7684\u9650\u5236\uff0c\u5f53\u5e38\u91cf\u6c60\u65e0\u6cd5\u518d\u7533\u8bf7\u5230\u5185\u5b58\u65f6\u4f1a\u629b\u51fa <code>OutOfMemoryError</code> \u9519\u8bef\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_8","title":"\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60","text":"<p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60 \u662f JVM \u4e3a\u4e86\u63d0\u5347\u6027\u80fd\u548c\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u9488\u5bf9\u5b57\u7b26\u4e32\uff08String \u7c7b\uff09\u4e13\u95e8\u5f00\u8f9f\u7684\u4e00\u5757\u533a\u57df\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u907f\u514d\u5b57\u7b26\u4e32\u7684\u91cd\u590d\u521b\u5efa\u3002</p> <pre><code>// \u5728\u5806\u4e2d\u521b\u5efa\u5b57\u7b26\u4e32\u5bf9\u8c61\u201dab\u201c\n// \u5c06\u5b57\u7b26\u4e32\u5bf9\u8c61\u201dab\u201c\u7684\u5f15\u7528\u4fdd\u5b58\u5728\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\nString aa = \"ab\";\n// \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u5b57\u7b26\u4e32\u5bf9\u8c61\u201dab\u201c\u7684\u5f15\u7528\nString bb = \"ab\";\nSystem.out.println(aa==bb);// true\n</code></pre> <p>HotSpot \u865a\u62df\u673a\u4e2d\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u7684\u5b9e\u73b0\u662f <code>src/hotspot/share/classfile/stringTable.cpp</code> ,<code>StringTable</code> \u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a<code>HashSet&lt;String&gt;</code> ,\u5bb9\u91cf\u4e3a <code>StringTableSize</code>\uff08\u53ef\u4ee5\u901a\u8fc7 <code>-XX:StringTableSize</code> \u53c2\u6570\u6765\u8bbe\u7f6e\uff09\u3002</p> <p><code>StringTable</code> \u4e2d\u4fdd\u5b58\u7684\u662f\u5b57\u7b26\u4e32\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u5b57\u7b26\u4e32\u5bf9\u8c61\u7684\u5f15\u7528\u6307\u5411\u5806\u4e2d\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u3002</p> <p>JDK1.7 \u4e4b\u524d\uff0c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u5b58\u653e\u5728\u6c38\u4e45\u4ee3\u3002JDK1.7 \u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u548c\u9759\u6001\u53d8\u91cf\u4ece\u6c38\u4e45\u4ee3\u79fb\u52a8\u4e86 Java \u5806\u4e2d\u3002</p> <p></p> <p></p> <p></p> <p>JDK 1.7 \u4e3a\u4ec0\u4e48\u8981\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u79fb\u52a8\u5230\u5806\u4e2d\uff1f</p> <p>\u4e3b\u8981\u662f\u56e0\u4e3a\u6c38\u4e45\u4ee3\uff08\u65b9\u6cd5\u533a\u5b9e\u73b0\uff09\u7684 GC \u56de\u6536\u6548\u7387\u592a\u4f4e\uff0c\u53ea\u6709\u5728\u6574\u5806\u6536\u96c6 (Full GC)\u7684\u65f6\u5019\u624d\u4f1a\u88ab\u6267\u884c GC\u3002Java \u7a0b\u5e8f\u4e2d\u901a\u5e38\u4f1a\u6709\u5927\u91cf\u7684\u88ab\u521b\u5efa\u7684\u5b57\u7b26\u4e32\u7b49\u5f85\u56de\u6536\uff0c\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u653e\u5230\u5806\u4e2d\uff0c\u80fd\u591f\u66f4\u9ad8\u6548\u53ca\u65f6\u5730\u56de\u6536\u5b57\u7b26\u4e32\u5185\u5b58\u3002</p> <p>\u76f8\u5173\u95ee\u9898\uff1aJVM \u5e38\u91cf\u6c60\u4e2d\u5b58\u50a8\u7684\u662f\u5bf9\u8c61\u8fd8\u662f\u5f15\u7528\u5462\uff1f - RednaxelaFX - \u77e5\u4e4e</p> <p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u3001\u65b9\u6cd5\u533a\u3001\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u8fd9\u4e9b\u90fd\u662f\u4e0d\u968f\u865a\u62df\u673a\u5b9e\u73b0\u800c\u6539\u53d8\u7684\u903b\u8f91\u6982\u5ff5\uff0c\u662f\u516c\u5171\u4e14\u62bd\u8c61\u7684\uff0cMetaspace\u3001Heap \u662f\u4e0e\u5177\u4f53\u67d0\u79cd\u865a\u62df\u673a\u5b9e\u73b0\u76f8\u5173\u7684\u7269\u7406\u6982\u5ff5\uff0c\u662f\u79c1\u6709\u4e14\u5177\u4f53\u7684\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_9","title":"\u76f4\u63a5\u5185\u5b58","text":"<p>\u76f4\u63a5\u5185\u5b58\u5e76\u4e0d\u662f\u865a\u62df\u673a\u8fd0\u884c\u65f6\u6570\u636e\u533a\u7684\u4e00\u90e8\u5206\uff0c\u4e5f\u4e0d\u662f\u865a\u62df\u673a\u89c4\u8303\u4e2d\u5b9a\u4e49\u7684\u5185\u5b58\u533a\u57df\uff0c\u4f46\u662f\u8fd9\u90e8\u5206\u5185\u5b58\u4e5f\u88ab\u9891\u7e41\u5730\u4f7f\u7528\u3002\u800c\u4e14\u4e5f\u53ef\u80fd\u5bfc\u81f4 OutOfMemoryError \u9519\u8bef\u51fa\u73b0\u3002</p> <p>JDK1.4 \u4e2d\u65b0\u52a0\u5165\u7684  NIO(New Input/Output) \u7c7b\uff0c\u5f15\u5165\u4e86\u4e00\u79cd\u57fa\u4e8e \u901a\u9053\uff08Channel\uff09 \u4e0e \u7f13\u5b58\u533a\uff08Buffer\uff09 \u7684 I/O \u65b9\u5f0f\uff0c\u5b83\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Native \u51fd\u6570\u5e93\u76f4\u63a5\u5206\u914d\u5806\u5916\u5185\u5b58\uff0c\u7136\u540e\u901a\u8fc7\u4e00\u4e2a\u5b58\u50a8\u5728 Java \u5806\u4e2d\u7684 DirectByteBuffer \u5bf9\u8c61\u4f5c\u4e3a\u8fd9\u5757\u5185\u5b58\u7684\u5f15\u7528\u8fdb\u884c\u64cd\u4f5c\u3002\u8fd9\u6837\u5c31\u80fd\u5728\u4e00\u4e9b\u573a\u666f\u4e2d\u663e\u8457\u63d0\u9ad8\u6027\u80fd\uff0c\u56e0\u4e3a \u907f\u514d\u4e86\u5728 Java \u5806\u548c Native \u5806\u4e4b\u95f4\u6765\u56de\u590d\u5236\u6570\u636e\u3002</p> <p>\u672c\u673a\u76f4\u63a5\u5185\u5b58\u7684\u5206\u914d\u4e0d\u4f1a\u53d7\u5230 Java \u5806\u7684\u9650\u5236\uff0c\u4f46\u662f\uff0c\u65e2\u7136\u662f\u5185\u5b58\u5c31\u4f1a\u53d7\u5230\u672c\u673a\u603b\u5185\u5b58\u5927\u5c0f\u4ee5\u53ca\u5904\u7406\u5668\u5bfb\u5740\u7a7a\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#hotspot","title":"HotSpot \u865a\u62df\u673a\u5bf9\u8c61\u63a2\u79d8","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u4ecb\u7ecd\u6211\u4eec\u5927\u6982\u77e5\u9053\u4e86\u865a\u62df\u673a\u7684\u5185\u5b58\u60c5\u51b5\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u8be6\u7ec6\u7684\u4e86\u89e3\u4e00\u4e0b HotSpot \u865a\u62df\u673a\u5728 Java \u5806\u4e2d\u5bf9\u8c61\u5206\u914d\u3001\u5e03\u5c40\u548c\u8bbf\u95ee\u7684\u5168\u8fc7\u7a0b\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_10","title":"\u5bf9\u8c61\u7684\u521b\u5efa","text":"<p>Java \u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\u5efa\u8bae\u6700\u597d\u662f\u80fd\u9ed8\u5199\u51fa\u6765\uff0c\u5e76\u4e14\u8981\u638c\u63e1\u6bcf\u4e00\u6b65\u5728\u505a\u4ec0\u4e48\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#step1","title":"Step1:\u7c7b\u52a0\u8f7d\u68c0\u67e5","text":"<p>\u865a\u62df\u673a\u9047\u5230\u4e00\u6761 new \u6307\u4ee4\u65f6\uff0c\u9996\u5148\u5c06\u53bb\u68c0\u67e5\u8fd9\u4e2a\u6307\u4ee4\u7684\u53c2\u6570\u662f\u5426\u80fd\u5728\u5e38\u91cf\u6c60\u4e2d\u5b9a\u4f4d\u5230\u8fd9\u4e2a\u7c7b\u7684\u7b26\u53f7\u5f15\u7528\uff0c\u5e76\u4e14\u68c0\u67e5\u8fd9\u4e2a\u7b26\u53f7\u5f15\u7528\u4ee3\u8868\u7684\u7c7b\u662f\u5426\u5df2\u88ab\u52a0\u8f7d\u8fc7\u3001\u89e3\u6790\u548c\u521d\u59cb\u5316\u8fc7\u3002\u5982\u679c\u6ca1\u6709\uff0c\u90a3\u5fc5\u987b\u5148\u6267\u884c\u76f8\u5e94\u7684\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#step2","title":"Step2:\u5206\u914d\u5185\u5b58","text":"<p>\u5728 \u7c7b\u52a0\u8f7d\u68c0\u67e5 \u901a\u8fc7\u540e\uff0c\u63a5\u4e0b\u6765\u865a\u62df\u673a\u5c06\u4e3a\u65b0\u751f\u5bf9\u8c61 \u5206\u914d\u5185\u5b58\u3002\u5bf9\u8c61\u6240\u9700\u7684\u5185\u5b58\u5927\u5c0f\u5728\u7c7b\u52a0\u8f7d\u5b8c\u6210\u540e\u4fbf\u53ef\u786e\u5b9a\uff0c\u4e3a\u5bf9\u8c61\u5206\u914d\u7a7a\u95f4\u7684\u4efb\u52a1\u7b49\u540c\u4e8e\u628a\u4e00\u5757\u786e\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u4ece Java \u5806\u4e2d\u5212\u5206\u51fa\u6765\u3002</p> <p>\u5206\u914d\u65b9\u5f0f \u6709  \u201c\u6307\u9488\u78b0\u649e\u201d \u548c \u201c\u7a7a\u95f2\u5217\u8868\u201d \u4e24\u79cd\uff0c\u9009\u62e9\u54ea\u79cd\u5206\u914d\u65b9\u5f0f\u7531 Java \u5806\u662f\u5426\u89c4\u6574\u51b3\u5b9a\uff0c\u800c Java \u5806\u662f\u5426\u89c4\u6574\u53c8\u7531\u6240\u91c7\u7528\u7684\u5783\u573e\u6536\u96c6\u5668\u662f\u5426\u5e26\u6709\u538b\u7f29\u6574\u7406\u529f\u80fd\u51b3\u5b9a\u3002</p> <p>\u5185\u5b58\u5206\u914d\u7684\u4e24\u79cd\u65b9\u5f0f \uff1a</p> <ul> <li> <p>\u6307\u9488\u78b0\u649e \uff1a</p> <ul> <li>\u9002\u7528\u573a\u5408 \uff1a\u5806\u5185\u5b58\u89c4\u6574\uff08\u5373\u6ca1\u6709\u5185\u5b58\u788e\u7247\uff09\u7684\u60c5\u51b5\u4e0b\u3002</li> <li>\u539f\u7406 \uff1a\u7528\u8fc7\u7684\u5185\u5b58\u5168\u90e8\u6574\u5408\u5230\u4e00\u8fb9\uff0c\u6ca1\u6709\u7528\u8fc7\u7684\u5185\u5b58\u653e\u5728\u53e6\u4e00\u8fb9\uff0c\u4e2d\u95f4\u6709\u4e00\u4e2a\u5206\u754c\u6307\u9488\uff0c\u53ea\u9700\u8981\u5411\u7740\u6ca1\u7528\u8fc7\u7684\u5185\u5b58\u65b9\u5411\u5c06\u8be5\u6307\u9488\u79fb\u52a8\u5bf9\u8c61\u5185\u5b58\u5927\u5c0f\u4f4d\u7f6e\u5373\u53ef\u3002</li> <li>\u4f7f\u7528\u8be5\u5206\u914d\u65b9\u5f0f\u7684 GC \u6536\u96c6\u5668\uff1aSerial, ParNew</li> </ul> </li> <li> <p>\u7a7a\u95f2\u5217\u8868 \uff1a</p> <ul> <li>\u9002\u7528\u573a\u5408 \uff1a \u5806\u5185\u5b58\u4e0d\u89c4\u6574\u7684\u60c5\u51b5\u4e0b\u3002</li> <li>\u539f\u7406 \uff1a\u865a\u62df\u673a\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u5217\u8868\uff0c\u8be5\u5217\u8868\u4e2d\u4f1a\u8bb0\u5f55\u54ea\u4e9b\u5185\u5b58\u5757\u662f\u53ef\u7528\u7684\uff0c\u5728\u5206\u914d\u7684\u65f6\u5019\uff0c\u627e\u4e00\u5757\u513f\u8db3\u591f\u5927\u7684\u5185\u5b58\u5757\u513f\u6765\u5212\u5206\u7ed9\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u6700\u540e\u66f4\u65b0\u5217\u8868\u8bb0\u5f55\u3002</li> <li>\u4f7f\u7528\u8be5\u5206\u914d\u65b9\u5f0f\u7684 GC \u6536\u96c6\u5668\uff1aCMS</li> </ul> </li> </ul> <p>\u9009\u62e9\u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u4e2d\u7684\u54ea\u4e00\u79cd\uff0c\u53d6\u51b3\u4e8e Java \u5806\u5185\u5b58\u662f\u5426\u89c4\u6574\u3002\u800c Java \u5806\u5185\u5b58\u662f\u5426\u89c4\u6574\uff0c\u53d6\u51b3\u4e8e GC \u6536\u96c6\u5668\u7684\u7b97\u6cd5\u662f\"\u6807\u8bb0-\u6e05\u9664\"\uff0c\u8fd8\u662f\"\u6807\u8bb0-\u6574\u7406\"\uff08\u4e5f\u79f0\u4f5c\"\u6807\u8bb0-\u538b\u7f29\"\uff09\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u590d\u5236\u7b97\u6cd5\u5185\u5b58\u4e5f\u662f\u89c4\u6574\u7684\u3002</p> <p>\u5185\u5b58\u5206\u914d\u5e76\u53d1\u95ee\u9898</p> <p>\u5728\u521b\u5efa\u5bf9\u8c61\u7684\u65f6\u5019\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u95ee\u9898\uff0c\u5c31\u662f\u7ebf\u7a0b\u5b89\u5168\uff0c\u56e0\u4e3a\u5728\u5b9e\u9645\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u521b\u5efa\u5bf9\u8c61\u662f\u5f88\u9891\u7e41\u7684\u4e8b\u60c5\uff0c\u4f5c\u4e3a\u865a\u62df\u673a\u6765\u8bf4\uff0c\u5fc5\u987b\u8981\u4fdd\u8bc1\u7ebf\u7a0b\u662f\u5b89\u5168\u7684\uff0c\u901a\u5e38\u6765\u8bb2\uff0c\u865a\u62df\u673a\u91c7\u7528\u4e24\u79cd\u65b9\u5f0f\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1a</p> <ul> <li>CAS+\u5931\u8d25\u91cd\u8bd5\uff1a CAS \u662f\u4e50\u89c2\u9501\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002\u6240\u8c13\u4e50\u89c2\u9501\u5c31\u662f\uff0c\u6bcf\u6b21\u4e0d\u52a0\u9501\u800c\u662f\u5047\u8bbe\u6ca1\u6709\u51b2\u7a81\u800c\u53bb\u5b8c\u6210\u67d0\u9879\u64cd\u4f5c\uff0c\u5982\u679c\u56e0\u4e3a\u51b2\u7a81\u5931\u8d25\u5c31\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\u3002\u865a\u62df\u673a\u91c7\u7528 CAS \u914d\u4e0a\u5931\u8d25\u91cd\u8bd5\u7684\u65b9\u5f0f\u4fdd\u8bc1\u66f4\u65b0\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002</li> <li>TLAB\uff1a \u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u9884\u5148\u5728 Eden \u533a\u5206\u914d\u4e00\u5757\u513f\u5185\u5b58\uff0cJVM \u5728\u7ed9\u7ebf\u7a0b\u4e2d\u7684\u5bf9\u8c61\u5206\u914d\u5185\u5b58\u65f6\uff0c\u9996\u5148\u5728 TLAB \u5206\u914d\uff0c\u5f53\u5bf9\u8c61\u5927\u4e8e TLAB \u4e2d\u7684\u5269\u4f59\u5185\u5b58\u6216 TLAB \u7684\u5185\u5b58\u5df2\u7528\u5c3d\u65f6\uff0c\u518d\u91c7\u7528\u4e0a\u8ff0\u7684 CAS \u8fdb\u884c\u5185\u5b58\u5206\u914d</li> </ul>"},{"location":"front-end/android/jvm/memory-area/#step3","title":"Step3:\u521d\u59cb\u5316\u96f6\u503c","text":"<p>\u5185\u5b58\u5206\u914d\u5b8c\u6210\u540e\uff0c\u865a\u62df\u673a\u9700\u8981\u5c06\u5206\u914d\u5230\u7684\u5185\u5b58\u7a7a\u95f4\u90fd\u521d\u59cb\u5316\u4e3a\u96f6\u503c\uff08\u4e0d\u5305\u62ec\u5bf9\u8c61\u5934\uff09\uff0c\u8fd9\u4e00\u6b65\u64cd\u4f5c\u4fdd\u8bc1\u4e86\u5bf9\u8c61\u7684\u5b9e\u4f8b\u5b57\u6bb5\u5728 Java \u4ee3\u7801\u4e2d\u53ef\u4ee5\u4e0d\u8d4b\u521d\u59cb\u503c\u5c31\u76f4\u63a5\u4f7f\u7528\uff0c\u7a0b\u5e8f\u80fd\u8bbf\u95ee\u5230\u8fd9\u4e9b\u5b57\u6bb5\u7684\u6570\u636e\u7c7b\u578b\u6240\u5bf9\u5e94\u7684\u96f6\u503c\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#step4","title":"Step4:\u8bbe\u7f6e\u5bf9\u8c61\u5934","text":"<p>\u521d\u59cb\u5316\u96f6\u503c\u5b8c\u6210\u4e4b\u540e\uff0c\u865a\u62df\u673a\u8981\u5bf9\u5bf9\u8c61\u8fdb\u884c\u5fc5\u8981\u7684\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8fd9\u4e2a\u5bf9\u8c61\u662f\u54ea\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u3001\u5982\u4f55\u624d\u80fd\u627e\u5230\u7c7b\u7684\u5143\u6570\u636e\u4fe1\u606f\u3001\u5bf9\u8c61\u7684\u54c8\u5e0c\u7801\u3001\u5bf9\u8c61\u7684 GC \u5206\u4ee3\u5e74\u9f84\u7b49\u4fe1\u606f\u3002 \u8fd9\u4e9b\u4fe1\u606f\u5b58\u653e\u5728\u5bf9\u8c61\u5934\u4e2d\u3002 \u53e6\u5916\uff0c\u6839\u636e\u865a\u62df\u673a\u5f53\u524d\u8fd0\u884c\u72b6\u6001\u7684\u4e0d\u540c\uff0c\u5982\u662f\u5426\u542f\u7528\u504f\u5411\u9501\u7b49\uff0c\u5bf9\u8c61\u5934\u4f1a\u6709\u4e0d\u540c\u7684\u8bbe\u7f6e\u65b9\u5f0f\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#step5-init","title":"Step5:\u6267\u884c init \u65b9\u6cd5","text":"<p>\u5728\u4e0a\u9762\u5de5\u4f5c\u90fd\u5b8c\u6210\u4e4b\u540e\uff0c\u4ece\u865a\u62df\u673a\u7684\u89c6\u89d2\u6765\u770b\uff0c\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u5df2\u7ecf\u4ea7\u751f\u4e86\uff0c\u4f46\u4ece Java \u7a0b\u5e8f\u7684\u89c6\u89d2\u6765\u770b\uff0c\u5bf9\u8c61\u521b\u5efa\u624d\u521a\u5f00\u59cb\uff0c<code>&lt;init&gt;</code> \u65b9\u6cd5\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u6240\u6709\u7684\u5b57\u6bb5\u90fd\u8fd8\u4e3a\u96f6\u3002\u6240\u4ee5\u4e00\u822c\u6765\u8bf4\uff0c\u6267\u884c new \u6307\u4ee4\u4e4b\u540e\u4f1a\u63a5\u7740\u6267\u884c <code>&lt;init&gt;</code> \u65b9\u6cd5\uff0c\u628a\u5bf9\u8c61\u6309\u7167\u7a0b\u5e8f\u5458\u7684\u610f\u613f\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u8fd9\u6837\u4e00\u4e2a\u771f\u6b63\u53ef\u7528\u7684\u5bf9\u8c61\u624d\u7b97\u5b8c\u5168\u4ea7\u751f\u51fa\u6765\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_11","title":"\u5bf9\u8c61\u7684\u5185\u5b58\u5e03\u5c40","text":"<p>\u5728 Hotspot \u865a\u62df\u673a\u4e2d\uff0c\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u7684\u5e03\u5c40\u53ef\u4ee5\u5206\u4e3a 3 \u5757\u533a\u57df\uff1a\u5bf9\u8c61\u5934\u3001\u5b9e\u4f8b\u6570\u636e \u548c \u5bf9\u9f50\u586b\u5145\u3002</p> <p>Hotspot \u865a\u62df\u673a\u7684\u5bf9\u8c61\u5934\u5305\u62ec\u4e24\u90e8\u5206\u4fe1\u606f\uff0c\u7b2c\u4e00\u90e8\u5206\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\u81ea\u8eab\u7684\u8fd0\u884c\u65f6\u6570\u636e\uff08\u54c8\u5e0c\u7801\u3001GC \u5206\u4ee3\u5e74\u9f84\u3001\u9501\u72b6\u6001\u6807\u5fd7\u7b49\u7b49\uff09\uff0c\u53e6\u4e00\u90e8\u5206\u662f\u7c7b\u578b\u6307\u9488\uff0c\u5373\u5bf9\u8c61\u6307\u5411\u5b83\u7684\u7c7b\u5143\u6570\u636e\u7684\u6307\u9488\uff0c\u865a\u62df\u673a\u901a\u8fc7\u8fd9\u4e2a\u6307\u9488\u6765\u786e\u5b9a\u8fd9\u4e2a\u5bf9\u8c61\u662f\u54ea\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u3002</p> <p>\u5b9e\u4f8b\u6570\u636e\u90e8\u5206\u662f\u5bf9\u8c61\u771f\u6b63\u5b58\u50a8\u7684\u6709\u6548\u4fe1\u606f\uff0c\u4e5f\u662f\u5728\u7a0b\u5e8f\u4e2d\u6240\u5b9a\u4e49\u7684\u5404\u79cd\u7c7b\u578b\u7684\u5b57\u6bb5\u5185\u5bb9\u3002</p> <p>\u5bf9\u9f50\u586b\u5145\u90e8\u5206\u4e0d\u662f\u5fc5\u7136\u5b58\u5728\u7684\uff0c\u4e5f\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u7684\u542b\u4e49\uff0c\u4ec5\u4ec5\u8d77\u5360\u4f4d\u4f5c\u7528\u3002 \u56e0\u4e3a Hotspot \u865a\u62df\u673a\u7684\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u7cfb\u7edf\u8981\u6c42\u5bf9\u8c61\u8d77\u59cb\u5730\u5740\u5fc5\u987b\u662f 8 \u5b57\u8282\u7684\u6574\u6570\u500d\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\u5bf9\u8c61\u7684\u5927\u5c0f\u5fc5\u987b\u662f 8 \u5b57\u8282\u7684\u6574\u6570\u500d\u3002\u800c\u5bf9\u8c61\u5934\u90e8\u5206\u6b63\u597d\u662f 8 \u5b57\u8282\u7684\u500d\u6570\uff081 \u500d\u6216 2 \u500d\uff09\uff0c\u56e0\u6b64\uff0c\u5f53\u5bf9\u8c61\u5b9e\u4f8b\u6570\u636e\u90e8\u5206\u6ca1\u6709\u5bf9\u9f50\u65f6\uff0c\u5c31\u9700\u8981\u901a\u8fc7\u5bf9\u9f50\u586b\u5145\u6765\u8865\u5168\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_12","title":"\u5bf9\u8c61\u7684\u8bbf\u95ee\u5b9a\u4f4d","text":"<p>\u5efa\u7acb\u5bf9\u8c61\u5c31\u662f\u4e3a\u4e86\u4f7f\u7528\u5bf9\u8c61\uff0c\u6211\u4eec\u7684 Java \u7a0b\u5e8f\u901a\u8fc7\u6808\u4e0a\u7684 reference \u6570\u636e\u6765\u64cd\u4f5c\u5806\u4e0a\u7684\u5177\u4f53\u5bf9\u8c61\u3002\u5bf9\u8c61\u7684\u8bbf\u95ee\u65b9\u5f0f\u7531\u865a\u62df\u673a\u5b9e\u73b0\u800c\u5b9a\uff0c\u76ee\u524d\u4e3b\u6d41\u7684\u8bbf\u95ee\u65b9\u5f0f\u6709\uff1a\u4f7f\u7528\u53e5\u67c4\u3001\u76f4\u63a5\u6307\u9488\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_13","title":"\u53e5\u67c4","text":"<p>\u5982\u679c\u4f7f\u7528\u53e5\u67c4\u7684\u8bdd\uff0c\u90a3\u4e48 Java \u5806\u4e2d\u5c06\u4f1a\u5212\u5206\u51fa\u4e00\u5757\u5185\u5b58\u6765\u4f5c\u4e3a\u53e5\u67c4\u6c60\uff0creference \u4e2d\u5b58\u50a8\u7684\u5c31\u662f\u5bf9\u8c61\u7684\u53e5\u67c4\u5730\u5740\uff0c\u800c\u53e5\u67c4\u4e2d\u5305\u542b\u4e86\u5bf9\u8c61\u5b9e\u4f8b\u6570\u636e\u4e0e\u5bf9\u8c61\u7c7b\u578b\u6570\u636e\u5404\u81ea\u7684\u5177\u4f53\u5730\u5740\u4fe1\u606f\u3002</p> <p></p>"},{"location":"front-end/android/jvm/memory-area/#_14","title":"\u76f4\u63a5\u6307\u9488","text":"<p>\u5982\u679c\u4f7f\u7528\u76f4\u63a5\u6307\u9488\u8bbf\u95ee\uff0creference \u4e2d\u5b58\u50a8\u7684\u76f4\u63a5\u5c31\u662f\u5bf9\u8c61\u7684\u5730\u5740\u3002</p> <p></p> <p>\u8fd9\u4e24\u79cd\u5bf9\u8c61\u8bbf\u95ee\u65b9\u5f0f\u5404\u6709\u4f18\u52bf\u3002\u4f7f\u7528\u53e5\u67c4\u6765\u8bbf\u95ee\u7684\u6700\u5927\u597d\u5904\u662f reference \u4e2d\u5b58\u50a8\u7684\u662f\u7a33\u5b9a\u7684\u53e5\u67c4\u5730\u5740\uff0c\u5728\u5bf9\u8c61\u88ab\u79fb\u52a8\u65f6\u53ea\u4f1a\u6539\u53d8\u53e5\u67c4\u4e2d\u7684\u5b9e\u4f8b\u6570\u636e\u6307\u9488\uff0c\u800c reference \u672c\u8eab\u4e0d\u9700\u8981\u4fee\u6539\u3002\u4f7f\u7528\u76f4\u63a5\u6307\u9488\u8bbf\u95ee\u65b9\u5f0f\u6700\u5927\u7684\u597d\u5904\u5c31\u662f\u901f\u5ea6\u5feb\uff0c\u5b83\u8282\u7701\u4e86\u4e00\u6b21\u6307\u9488\u5b9a\u4f4d\u7684\u65f6\u95f4\u5f00\u9500\u3002HotSpot \u865a\u62df\u673a\u4e3b\u8981\u4f7f\u7528\u7684\u5c31\u662f\u8fd9\u79cd\u65b9\u5f0f\u6765\u8fdb\u884c\u5bf9\u8c61\u8bbf\u95ee\u3002</p>"},{"location":"front-end/android/jvm/memory-area/#_15","title":"\u53c2\u8003","text":"<p>https://javaguide.cn/java/jvm/memory-area.html</p>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/","title":"\u4f7f\u7528Kotlin takeIf\uff08\u6216takeUnless\uff09","text":"<p>\u5728Kotlin\u7684\u6807\u51c6\u51fd\u6570\uff0c\u6709\u4e24\u5927\u51fd\u6570\uff0c\u5373<code>takeIf</code>\u548c<code>takeUnless</code>\uff0c\u4e4d\u4e00\u770b\uff0c\u6709\u4ec0\u4e48\u7279\u522b\u4e4b\u5904\u5462\uff1f\u8fd9\u51e0\u4e4e\u5c31\u662f<code>if</code>\uff1f</p> <p>\u6216\u8005\u6781\u7aef\u70b9\uff0c\u628a\u6bcf\u4e00\u4e2a<code>if</code>\u8bed\u53e5\u6539\u6210\u7c7b\u4f3c\u4e0b\u9762\uff08\u4e0d\u63a8\u8350\uff09\u3002</p> <pre><code>//\u539f\u59cb\u4ee3\u7801\nif\uff08status\uff09{doThis\uff08\uff09}\n//\u4fee\u6539\u540e\u7684\u4ee3\u7801\ntakeIf {status}\uff1fapply {doThis\uff08\uff09}\n</code></pre>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/#_1","title":"\u6df1\u5165\u63a2\u8ba8","text":"<p>\u50cf\u5176\u4ed6\u4efb\u4f55\u4e1c\u897f\u4e00\u6837\uff0c<code>takeIf</code>\uff08\u6216<code>takeUnless</code>\uff09\u786e\u5b9e\u6709\u5b83\u7684\u4f7f\u7528\u573a\u666f\u3002\u6211\u901a\u8fc7\u4e0d\u540c\u60c5\u51b5\u5206\u4eab\u6211\u5bf9\u4ed6\u4eec\u7684\u7406\u89e3\u3002\u5728\u6b64\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u770b\u770b\u5b83\u7684\u5b9e\u73b0\u3002</p>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/#_2","title":"\u51fd\u6570\u7b7e\u540d","text":"<pre><code>public inline fun &lt;T&gt; T.takeIf(predicate: (T) -&gt; Boolean): T? \n= if (predicate(this)) this else null\n</code></pre> <p>\u4ece\u51fd\u6570\u7b7e\u540d\uff0c\u6211\u4eec\u6ce8\u610f\u5230</p> <ol> <li>\u5b83\u662f\u4eceT\u5bf9\u8c61\u672c\u8eab\u8c03\u7528\u7684\u3002\u5373<code>T.takeIf</code>\uff0c</li> <li><code>predicate</code>\u51fd\u6570\u4ee5T\u5bf9\u8c61\u4e3a\u53c2\u6570</li> <li>\u7b49\u5f85<code>predicate</code>\u8bc4\u4f30\u540e\u5b83\u8fd4\u56de<code>this</code>\u6216<code>null</code>\u3002</li> </ol>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/#_3","title":"\u5408\u7406\u7684\u4f7f\u7528\u60c5\u51b5","text":"<p>\u57fa\u4e8e\u4ee5\u4e0a\u7279\u70b9\uff0c\u6211\u53ef\u4ee5\u63a8\u5bfc\u51fa\u5b83\u76f8\u5bf9\u4e8e<code>if</code>\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u4e0b\uff1a</p>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/#1tttakeif","title":"1.\u5b83\u662f\u4eceT\u5bf9\u8c61\u672c\u8eab\u8c03\u7528\u7684\u3002\u5373<code>T.takeIf</code>\uff0c","text":"<p>\u5b83\u53ef\u4ee5\u5f88\u597d\u5904\u7406\u53ef\u7a7a\u6027\u68c0\u67e5\u3002\u4e00\u4e2a\u4f8b\u5b50\u5982\u4e0b</p> <pre><code>//\u539f\u59cb\u4ee3\u7801\nif\uff08someObject\uff01= null &amp;&amp; status\uff09{ doThis\uff08\uff09\n}\n//\u6539\u8fdb\u7684\u4ee3\u7801\nsomeObject\uff1f.takeIf {status}\uff1fapply {doThis\uff08\uff09}\n</code></pre>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/#2predicatet","title":"2.<code>predicate</code>\u51fd\u6570\u4ee5T\u5bf9\u8c61\u4e3a\u53c2\u6570","text":"<p>\u7531\u4e8e\u5c06T\u4f5c\u4e3a<code>predicate</code>\u7684\u53c2\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7b80\u5316<code>takeIf</code>\u4ee3\u7801</p> <pre><code>//\u539f\u59cb\u4ee3\u7801\nif\uff08someObject\uff01= null &amp;&amp; someObject.status\uff09{ doThis\uff08\uff09\n} //\u66f4\u597d\u7684\u4ee3\u7801\nif\uff08someObject\uff1f.status == true\uff09{ doThis\uff08\uff09\n}\n//\u6539\u8fdb\u7684\u4ee3\u7801\nsomeObject\uff1f.takeIf {it.status} ?. apply {doThis\uff08\uff09}\n</code></pre> <p><code>\u66f4\u597d\u7684\u4ee3\u7801</code>\u7684\u786e\u8fd8\u53ef\u4ee5\uff0c\u4f46\u9700\u8981\u663e\u5f0f\u7684<code>true</code>\u5173\u952e\u8bcd\uff0c\u6240\u4ee5\u5e76\u4e0d\u7406\u60f3\u3002</p>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/#3predicatethisnull","title":"3.\u7b49\u5f85<code>predicate</code>\u8bc4\u4f30\u540e\u5b83\u8fd4\u56de<code>this</code>\u6216<code>null</code>","text":"<p>\u65e2\u7136\u5b83\u8fd4\u56de<code>this</code>\uff0c\u90a3\u5c31\u53ef\u4ee5\u7528\u6765\u8fdb\u884c\u94fe\u5f0f\u8c03\u7528\u3002\u56e0\u6b64\uff0c\u4e0b\u9762\u4ee3\u7801\u53ef\u4ee5\u4f18\u5316</p> <pre><code>//\u539f\u59cb\u4ee3\u7801\nif\uff08someObject\uff01= null &amp;&amp; someObject.status\uff09{ someObject.doThis\uff08\uff09\n}\n//\u6539\u8fdb\u7684\u4ee3\u7801\nsomeObject\uff1f.takeIf {status}\uff1fdoThis\uff08\uff09\n</code></pre> <p>\u6216\u8005\u5b9e\u73b0\u83b7\u53d6\u6570\u636e\u6216\u9000\u51fa\u7684\u66f4\u597d\u65b9\u5f0f\uff08\u4f8b\u5b50\u4eceKotlin Doc\u4e2d\u6458\u53d6\uff09</p> <pre><code>val index = input.indexOf\uff08keyword\uff09.takeIf {it&gt; = 0}\uff1f\uff1aerror\uff08\u201cError\u201d\uff09\nval outFile = File\uff08outputDir.path\uff09.takeIf {it.exists\uff08\uff09}\uff1f\uff1areturn  false\n</code></pre>"},{"location":"front-end/android/koltin/Kotlin-takeIf-or-takeUnless/#_4","title":"\u6ce8\u610f","text":"<p>\u770b\u770b\u4e0b\u9762\u7684\u4ee3\u7801\u3002</p> <pre><code>//\u8bed\u6cd5\u4e0a\u4ecd\u7136\u6b63\u786e\u3002\u4f46\u903b\u8f91\u9519\u8bef\uff01\nsomeObject\uff1f.takeIf {status} .apply {doThis\uff08\uff09}\n//\u6b63\u786e\u7684\uff08\u6ce8\u610f\u53ef\u7a7a\u6027\u68c0\u67e5\uff1f\uff09\nsomeObject\uff1f.takeIf {status} \uff1f.apply {doThis\uff08\uff09}\n</code></pre> <p><code>doThis()</code>\u5728\u7b2c\u4e00\u884c\u4e2d\u4e0d\u7ba1<code>status</code>true \u8fd8\u662f false \u90fd\u4f1a\u6267\u884c\u3002\u56e0\u4e3a \u5373\u4f7f<code>takeIf</code>\u8fd4\u56de<code>null</code>\uff0c\u5b83\u4ecd\u7136\u4f1a\u88ab\u8c03\u7528\u3002\uff08\u8fd9\u91cc\u5047\u8bbe<code>doThis()</code>\u4e0d\u662f<code>someObject</code>\u7684\u51fd\u6570\uff09</p> <p>\u6240\u4ee5\u5728\u8fd9\u91cc\uff0c\u7b2c\u4e8c\u884c\u7684<code>?</code>  \u662f\u975e\u5e38\u5fae\u5999\u4e14\u91cd\u8981\u7684\u3002</p>"},{"location":"front-end/android/koltin/Kotlin_nline%2C%20noinline%2C%20crossinline/","title":"Kotlin\u4e2dinline, noinline, crossinline\u7684\u533a\u522b","text":"<p>\u6211\u4eec\u5728Kotlin\u4e2d\u4f7f\u7528\u9ad8\u9636\u51fd\u6570\u4f1a\u5e26\u6765\u4e00\u4e9b\u8fd0\u884c\u65f6\u7684\u6548\u7387\u635f\u5931\uff1a\u6bcf\u4e00\u4e2a\u51fd\u6570\u90fd\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5e76\u4e14\u4f1a\u6355\u83b7\u4e00\u4e2a\u95ed\u5305\u3002 \u5373\u90a3\u4e9b\u5728\u51fd\u6570\u4f53\u5185\u4f1a\u8bbf\u95ee\u5230\u7684\u53d8\u91cf\u3002 \u5185\u5b58\u5206\u914d\uff08\u5bf9\u4e8e\u51fd\u6570\u5bf9\u8c61\u548c\u7c7b\uff09\u548c\u865a\u62df\u8c03\u7528\u4f1a\u5f15\u5165\u8fd0\u884c\u65f6\u95f4\u5f00\u9500\u3002</p> <p>\u8c03\u7528\u4e00\u4e2a\u65b9\u6cd5\u662f\u4e00\u4e2a\u538b\u6808\u548c\u51fa\u6808\u7684\u8fc7\u7a0b\uff0c\u8c03\u7528\u65b9\u6cd5\u65f6\u5c06\u6808\u9488\u538b\u5165\u65b9\u6cd5\u6808\uff0c\u7136\u540e\u6267\u884c\u65b9\u6cd5\u4f53\uff0c\u65b9\u6cd5\u7ed3\u675f\u65f6\u5c06\u6808\u9488\u51fa\u6808\uff0c\u8fd9\u4e2a\u538b\u6808\u548c\u51fa\u6808\u7684\u8fc7\u7a0b\u4f1a\u8017\u8d39\u8d44\u6e90\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u4f20\u9012\u5f62\u53c2\u4e5f\u4f1a\u8017\u8d39\u8d44\u6e90\u3002</p> <pre><code>fun &lt;T&gt; lock(l: Lock, body: () -&gt; T): T {\nl.lock()\ntry {\nreturn body()\n} finally {\nl.unlock()\n}\n}\n</code></pre> <p>\u8fd9\u4e2alock\u65b9\u6cd5\u7684\u65b9\u6cd5\u4f53\u4e2d\uff0c\u4e0d\u4f1a\u5c06\u5b83\u7684\u5f62\u53c2\u518d\u4f20\u9012\u7ed9\u5176\u4ed6\u65b9\u6cd5\u3002\u6211\u4eec\u8c03\u7528\u4e00\u4e0block\u65b9\u6cd5\uff1a</p> <pre><code>lock(l, {\"do something!\"})//l\u662f\u4e00\u4e2aLock\u5bf9\u8c61\n</code></pre> <p>\u5bf9\u4e8e\u7f16\u8bd1\u5668\u6765\u8bf4\uff0c\u8c03\u7528lock\u65b9\u6cd5\u5c31\u8981\u5c06\u53c2\u6570l\u548clambda\u8868\u8fbe\u5f0f{\u201cdo something!\u201d}\u8fdb\u884c\u4f20\u9012\uff0c\u8fd8\u8981\u5c06lock\u65b9\u6cd5\u8fdb\u884c\u538b\u6808\u51fa\u6808\u5904\u7406\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u4f1a\u8017\u8d39\u8d44\u6e90\u3002\u5982\u679c\u6211\u4eec\u628alock\u65b9\u6cd5\u5220\u9664\uff0c\u76f4\u63a5\u6267\u884clock\u65b9\u6cd5\u7684\u65b9\u6cd5\u4f53\uff1a</p> <pre><code>l.lock()\ntry {\nreturn \"do something!\"\n} finally {\nl.unlock()\n}\n</code></pre> <p>\u8fd9\u6837\u505a\u7684\u6548\u679c\u548c\u8c03\u7528lock\u65b9\u6cd5\u662f\u4e00\u6837\u7684\uff0c\u800c\u4e14\u4e0d\u9700\u8981\u538b\u6808\u51fa\u6808\u4e86\uff0c\u4f46\u662f\u5982\u679c\u4ee3\u7801\u4e2d\u9891\u7e41\u8c03\u7528lock\u65b9\u6cd5\uff0c\u5fc5\u7136\u8981\u590d\u5236\u7c98\u8d34\u5927\u91cf\u91cd\u590d\u4ee3\u7801\uff0c\u8fd8\u4e0d\u5982\u62bd\u53d6\u51fa\u6765\u4e00\u4e2alock\u65b9\u6cd5\uff0c\u4f46\u662f\u5982\u679clock\u65b9\u6cd5\u88ab\u9891\u7e41\u8c03\u7528\uff0c\u538b\u6808\u51fa\u6808\u5c06\u4f1a\u5e26\u6765\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u90a3\u6709\u4ec0\u4e48\u65b9\u6cd5\uff0c\u8ba9\u7a0b\u5e8f\u907f\u514d\u5199\u5197\u4f59\u4ee3\u7801\uff0c\u53c8\u80fd\u591f\u63d0\u9ad8\u6548\u7387\u5462\uff1f\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0ckotlin\u5f15\u5165\u4e86<code>inline</code>\u5173\u952e\u5b57\u3002</p>"},{"location":"front-end/android/koltin/Kotlin_nline%2C%20noinline%2C%20crossinline/#inline","title":"inline","text":"<p>\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\u901a\u8fc7\u5185\u8054\u5316 lambda \u8868\u8fbe\u5f0f\u53ef\u4ee5\u6d88\u9664\u538b\u6808\u51fa\u6808\u7684\u5f00\u9500\u3002 \u4e0b\u8ff0\u51fd\u6570\u662f\u8fd9\u79cd\u60c5\u51b5\u7684\u5f88\u597d\u7684\u4f8b\u5b50\u3002\u5373 lock() \u51fd\u6570\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5728\u8c03\u7528\u5904\u5185\u8054\u3002 \u8003\u8651\u4e0b\u9762\u7684\u60c5\u51b5\uff1a</p> <pre><code>lock(l) { foo() }\n</code></pre> <p>\u7f16\u8bd1\u5668\u6ca1\u6709\u4e3a\u53c2\u6570\u521b\u5efa\u4e00\u4e2a\u51fd\u6570\u5bf9\u8c61\u5e76\u751f\u6210\u4e00\u4e2a\u8c03\u7528\u3002\u53d6\u800c\u4ee3\u4e4b\uff0c\u7f16\u8bd1\u5668\u53ef\u4ee5\u751f\u6210\u4ee5\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>l.lock()\ntry {\nfoo()\n} finally {\nl.unlock()\n}\n</code></pre> <p>\u8fd9\u4e2a\u4e0d\u662f\u6211\u4eec\u4ece\u4e00\u5f00\u59cb\u5c31\u60f3\u8981\u7684\u5417\uff1f\u4e3a\u4e86\u8ba9\u7f16\u8bd1\u5668\u8fd9\u4e48\u505a\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528 inline \u4fee\u9970\u7b26\u6807\u8bb0 lock() \u51fd\u6570\uff1a</p> <pre><code>inline fun &lt;T&gt; lock(l: Lock, body: () -&gt; T): T { \u2026\u2026 }\n</code></pre> <p>inline \u4fee\u9970\u7b26\u5f71\u54cd\u51fd\u6570\u672c\u8eab\u548c\u4f20\u7ed9\u5b83\u7684 lambda \u8868\u8fbe\u5f0f\uff1a\u6240\u6709\u8fd9\u4e9b\u90fd\u5c06\u5185\u8054\u5230\u8c03\u7528\u5904\u3002\u4f46\u662f\u5185\u8054\u53ef\u80fd\u5bfc\u81f4\u751f\u6210\u7684\u4ee3\u7801\u589e\u52a0\uff0c\u4e0d\u8fc7\u5982\u679c\u6211\u4eec\u4f7f\u7528\u5f97\u5f53\uff08\u5373\u907f\u514d\u5185\u8054\u8fc7\u5927\u51fd\u6570\uff09\uff0c\u6027\u80fd\u4e0a\u4f1a\u6709\u6240\u63d0\u5347\u3002</p> <p>\u53e6\u5916<code>inline</code>\u4e5f\u6709\u4e2a\u7f3a\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 lambda \u8868\u8fbe\u5f0f \u4e2d\u8c03\u7528return\u8fd4\u56de\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4<code>inline</code>\u4e4b\u540e\u7684\u4ee3\u7801\u65e0\u6cd5\u6267\u884c \uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u4ee3\u7801 \uff1a</p> <pre><code>inline fun higherOrderFunction(aLambda: () -&gt; Unit) {\naLambda()\nprintln(\"after invoke lambda\") // 1\n}\nfun callingFunction() {\nhigherOrderFunction {\nprintln(\"invoke lambda...\") // 2\nreturn\n}\nprintln(\"after callingFunction...\") // 3\n}\n// \u6253\u5370\u7ed3\u679c \n// \"invoke lambda...\"\n</code></pre> <p>\u5f53\u6211\u4eec\u8c03\u7528 <code>callingFunction()</code> \uff0c\u53ea\u4f1a\u6253\u5370\u201dinvoke lambda\u2026\u201d\uff0c\u8bf4\u660e #1 \u3001#3 \u7684\u4ee3\u7801\u88ab\u8df3\u8fc7\u4e86\uff0c\u6240\u4ee5\u5728\u4f7f\u7528<code>inline</code>\u51fd\u6570\u4e2d\u5305\u542blambda\u9759\u6001\u5f0f\u7684\u65f6\u5019\uff0c\u8981\u907f\u514d\u5728lambda\u4e2d\u4f7f\u7528return \uff0c\u5e94\u8be5\u4f7f\u7528<code>return@higherOrderFunction</code>\u7684\u65b9\u5f0f:</p> <pre><code>inline fun higherOrderFunction(aLambda: () -&gt; Unit) {\naLambda()\nprintln(\"after invoke lambda\")\n}\nfun callingFunction() {\nhigherOrderFunction {\nprintln(\"invoke lambda...\")\nreturn@higherOrderFunction\n}\nprintln(\"after callingFunction...\")\n}\n// \u6253\u5370\u7ed3\u679c \n// invoke lambda...\n// after invoke lambda\n// after callingFunction...\n</code></pre> <p>\u4f7f\u7528<code>return@higherOrderFunction</code>\u7684\u65b9\u5f0f\u8fd4\u56de\u5f97\u5230\u7684\u7ed3\u679c\u6b63\u786e\u3002\u4e0d\u8fc7kotlin\u4e5f\u6709\u53e6\u4e00\u79cd\u65b9\u5f0f\u6765\u9650\u5236\u5728lambda\u4e2d\u76f4\u63a5return\uff0c\u90a3\u5c31\u662f\u4f7f\u7528 noinline \u6216 crossinline \u3002</p>"},{"location":"front-end/android/koltin/Kotlin_nline%2C%20noinline%2C%20crossinline/#noinline","title":"noinline","text":"<p>\u5982\u679c\u4f60\u53ea\u60f3\u88ab\uff08\u4f5c\u4e3a\u53c2\u6570\uff09\u4f20\u7ed9\u4e00\u4e2a\u5185\u8054\u51fd\u6570\u7684 lamda \u8868\u8fbe\u5f0f\u4e2d\u53ea\u6709\u4e00\u4e9b\u88ab\u5185\u8054\uff0c\u4f60\u53ef\u4ee5\u7528 <code>noinline</code> \u4fee\u9970\u7b26\u6807\u8bb0\u67d0\u4e9blambda\u8868\u8fbe\u5f0f\u7981\u6b62\u5185\u8054\uff1a</p> <pre><code>inline fun foo(inlined: () -&gt; Unit, noinline notInlined: () -&gt; Unit) { \u2026\u2026 }\n</code></pre> <p>\u53ef\u4ee5\u5185\u8054\u7684 lambda \u8868\u8fbe\u5f0f\u53ea\u80fd\u5728\u5185\u8054\u51fd\u6570\u5185\u90e8\u8c03\u7528\u6216\u8005\u4f5c\u4e3a\u53ef\u5185\u8054\u7684\u53c2\u6570\u4f20\u9012\uff0c \u4f46\u662f <code>noinline</code> \u7684\u53ef\u4ee5\u4ee5\u4efb\u4f55\u6211\u4eec\u559c\u6b22\u7684\u65b9\u5f0f\u64cd\u4f5c\uff1a\u5b58\u50a8\u5728\u5b57\u6bb5\u4e2d\u3001\u4f20\u9001\u5b83\u7b49\u7b49\u3002</p> <p>\u53e6\u5916\uff0c\u5b9a\u4e49\u4e86<code>noinline</code> \u7684lambda\u8868\u8fbe\u5f0f\u5c06\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528 return \uff0c\u5426\u5219\u4f1a\u62a5\u9519 \uff1a</p> <pre><code>inline fun higherOrderFunction(noinline aLambda: () -&gt; Unit) {\naLambda()\nprintln(\"after invoke lambda\")\n}\nfun callingFunction() {\nhigherOrderFunction {\nprintln(\"invoke lambda...\")\nreturn  // \u7f16\u8bd1\u4e0d\u901a\u8fc7\uff0c`noinline` \u7684lambda\u8868\u8fbe\u5f0f\u4e0d\u80fd\u76f4\u63a5 return\n}\nprintln(\"after callingFunction...\")\n}\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u4e00\u4e2a\u5185\u8054\u51fd\u6570\u6ca1\u6709\u53ef\u5185\u8054\u7684\u51fd\u6570\u53c2\u6570\u5e76\u4e14\u6ca1\u6709\u5177\u4f53\u5316\u7684\u7c7b\u578b\u53c2\u6570\uff0c\u7f16\u8bd1\u5668\u4f1a\u4ea7\u751f\u4e00\u4e2a\u8b66\u544a\uff0c\u56e0\u4e3a\u5185\u8054\u8fd9\u6837\u7684\u51fd\u6570\u5f88\u53ef\u80fd\u5e76\u65e0\u76ca\u5904\uff08\u5982\u679c\u4f60\u786e\u8ba4\u9700\u8981\u5185\u8054\uff0c\u5219\u53ef\u4ee5\u7528 <code>@Suppress(\"NOTHING_TO_INLINE\")</code> \u6ce8\u89e3\u5173\u6389\u8be5\u8b66\u544a\uff09\u3002</p>"},{"location":"front-end/android/koltin/Kotlin_nline%2C%20noinline%2C%20crossinline/#crossinline","title":"crossinline","text":"<p>\u4f7f\u7528<code>crossinline</code>\u4e5f\u53ef\u4ee5\u9650\u5236lambda\u8868\u8fbe\u5f0f\u5c06\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528 return \uff0c\u5b83\u4e0e <code>noinline</code> \u7684\u533a\u522b\u5728\u4e8e\u4f7f\u7528<code>crossinline</code>\u7684lambda\u4ecd\u7136\u662f<code>inline</code>\u7684\uff0c\u6bd4\u5982\u4e0b\u9762\u4f7f\u7528<code>noinline</code> \u7684\u4ee3\u7801\uff1a</p> <pre><code>inline fun higherOrderFunction(aLambda1: () -&gt; Unit, noinline aLambda2: () -&gt; Unit) {\naLambda1()\naLambda2()\nprintln(\"after invoke lambda\")\n}\nfun callingFunction() {\nhigherOrderFunction({\nprintln(\"invoke lambda1...\")\nreturn@higherOrderFunction\n}, {\nprintln(\"invoke lambda2...\")\nreturn@higherOrderFunction\n})\nprintln(\"after callingFunction...\")\n}\n</code></pre> <p>\u5176\u4e2daLambda1\u662f<code>inline</code>\u7684\uff0c\u800caLambda2\u662f<code>noinline</code>\u7684\uff0c\u67e5\u770b\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\uff1a</p> <pre><code>public static final void higherOrderFunction(@NotNull Function0 aLambda1, @NotNull Function0 aLambda2) {\nIntrinsics.checkParameterIsNotNull(aLambda1, \"aLambda1\");\nIntrinsics.checkParameterIsNotNull(aLambda2, \"aLambda2\");\naLambda1.invoke();\naLambda2.invoke();\nString var3 = \"after invoke lambda\";\nSystem.out.println(var3);\n}\npublic static final void callingFunction() {\nFunction0 aLambda2$iv = (Function0)null.INSTANCE;\nString var1 = \"invoke lambda1...\";\nSystem.out.println(var1);\naLambda2$iv.invoke();\nvar1 = \"after invoke lambda\";\nSystem.out.println(var1);\nString var4 = \"after callingFunction...\";\nSystem.out.println(var4);\n}\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0aLambda1\u88ab\u5185\u8054\u5230\u8c03\u7528\u51fd\u6570<code>callingFunction</code>\u4e2d\uff0c\u800caLambda2\u5e76\u6ca1\u6709\u88ab\u5185\u8054\u5230\u8c03\u7528\u51fd\u6570<code>callingFunction</code>\u4e2d\u3002\u5982\u679c\u6211\u4eec\u628a<code>noinline</code>\u4fee\u6539\u6210<code>crossinline</code>\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>inline fun higherOrderFunction(aLambda1: () -&gt; Unit, crossinline aLambda2: () -&gt; Unit) {\naLambda1()\naLambda2()\nprintln(\"after invoke lambda\")\n}\nfun callingFunction() {\nhigherOrderFunction({\nprintln(\"invoke lambda1...\")\nreturn@higherOrderFunction\n}, {\nprintln(\"invoke lambda2...\")\nreturn@higherOrderFunction\n})\nprintln(\"after callingFunction...\")\n}\n</code></pre> <p>\u540c\u6837aLambda1\u662f<code>inline</code>\u7684\uff0c\u800caLambda2\u662f<code>crossinline</code>\u7684\uff0c\u67e5\u770b\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\uff1a</p> <pre><code>public static final void higherOrderFunction(@NotNull Function0 aLambda1, @NotNull Function0 aLambda2) {\nIntrinsics.checkParameterIsNotNull(aLambda1, \"aLambda1\");\nIntrinsics.checkParameterIsNotNull(aLambda2, \"aLambda2\");\naLambda1.invoke();\naLambda2.invoke();\nString var3 = \"after invoke lambda\";\nSystem.out.println(var3);\n}\npublic static final void callingFunction() {\nString var0 = \"invoke lambda1...\";\nSystem.out.println(var0);\nvar0 = \"invoke lambda2...\";\nSystem.out.println(var0);\nvar0 = \"after invoke lambda\";\nSystem.out.println(var0);\nvar0 = \"after callingFunction...\";\nSystem.out.println(var0);\n}\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0aLambda1\u548c aLambda2\u90fd\u88ab\u5185\u8054\u5230\u8c03\u7528\u51fd\u6570<code>callingFunction</code>\u4e2d\u4e86\u3002</p>"},{"location":"front-end/android/koltin/Kotlin_nline%2C%20noinline%2C%20crossinline/#_1","title":"\u603b\u7ed3","text":"<p>\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd<code>inline</code>, <code>noinline</code>, <code>crossinline</code>\u7684\u533a\u522b\u3002\u4e3a\u4e86\u51cf\u5c11\u4f7f\u7528\u9ad8\u9636\u51fd\u6570\u5e26\u6765\u7684\u4e00\u4e9b\u8fd0\u884c\u65f6\u7684\u6548\u7387\u635f\u5931\uff0c\u53ef\u4ee5\u4f7f\u7528<code>inline</code>\u6765\u6807\u8bb0\u4e00\u4e2a\u51fd\u6570\u4e3a\u5185\u8054\u51fd\u6570\uff0c\u5185\u8054\u51fd\u6570\u5728\u7f16\u8bd1\u540e\u4f1a\u628a\u4ee3\u7801\u90fd\u63d2\u5165\u5230\u8c03\u7528\u51fd\u6570\u7684\u5730\u65b9\uff0c\u6240\u4ee5\u53ef\u80fd\u5bfc\u81f4\u6700\u7ec8\u7684\u4ee3\u7801\u589e\u52a0\uff0c\u6240\u4ee5\u5fc5\u987b\u907f\u514d\u5185\u8054\u8fc7\u5927\u51fd\u6570\u624d\u80fd\u4f7f\u5185\u8054\u51fd\u6570\u6027\u80fd\u63d0\u5347\u3002\u53e6\u5916\u6211\u4eec\u53ef\u4ee5\u7528<code>noinline</code>\u548c<code>crossinline</code>\u6765\u9650\u5236\u5185\u8054\u51fd\u6570\u4e2d\u7684lambda\u76f4\u63a5\u8c03\u7528return\u8fd4\u56de\uff0c\u907f\u514d\u51fa\u73b0\u9884\u6599\u4e4b\u5916\u7684\u7ed3\u679c\u3002</p> <p>\u539f\u6587\u94fe\u63a5</p>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/","title":"\u638c\u63e1Kotlin\u6807\u51c6\u51fd\u6570\uff1arun, with, let, also and apply","text":"<p>Kotlin\u7684\u4e00\u4e9b\u6807\u51c6\u51fd\u6570\u975e\u5e38\u76f8\u4f3c\uff0c\u6211\u4eec\u4e0d\u786e\u5b9a\u4f7f\u7528\u54ea\u4e2a\u51fd\u6570\u3002\u5728\u8fd9\u91cc\u6211\u5c06\u4ecb\u7ecd\u4e00\u4e2a\u7b80\u5355\u7684\u65b9\u6cd5\u6765\u6e05\u695a\u5730\u533a\u5206\u4ed6\u4eec\u7684\u5dee\u5f02\u548c\u5982\u4f55\u9009\u62e9\u4f7f\u7528\u3002</p>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/#_1","title":"\u8303\u56f4\u51fd\u6570","text":"<p>\u6211\u91cd\u70b9\u5173\u6ce8 run, with, T.run, T.let, T.also and T.apply \u51fd\u6570\u3002\u6211\u79f0\u4ed6\u4eec\u4e3a\u8303\u56f4\u51fd\u6570\uff0c\u56e0\u4e3a\u6211\u8ba4\u4e3a\u4ed6\u4eec\u7684\u4e3b\u8981\u529f\u80fd\u662f\u4e3a\u8c03\u7528\u51fd\u6570\u63d0\u4f9b\u4e00\u4e2a\u5185\u90e8\u8303\u56f4\u3002</p> <p>run \u51fd\u6570\u662f\u8bf4\u660e\u6700\u7b80\u5355\u7684\u8303\u56f4\u65b9\u6cd5</p> <p><pre><code>fun test() {\nvar mood = \"I am sad\"\nrun {\nval mood = \"I am happy\"\nprintln(mood) // I am happy\n}\nprintln(mood)  // I am sad\n}\n</code></pre> \u6709\u4e86\u8fd9\u4e2a\u51fd\u6570\uff0c\u5728<code>test</code>\u51fd\u6570\u5185\u90e8\uff0c\u4f60\u53ef\u4ee5\u6709\u4e00\u4e2a\u5355\u72ec\u7684\u8303\u56f4\uff0c<code>mood</code>\u5728\u91cd\u65b0\u5b9a\u4e49\u4e3a<code>I am happy</code>\u5e76\u6253\u5370\u4e4b\u524d\uff0c\u5b83\u88ab\u5b8c\u5168\u5c01\u95ed\u5728<code>run</code>\u8303\u56f4\u5185\u3002</p> <p>\u8fd9\u4e2a\u8303\u56f4\u51fd\u6570\u672c\u8eab\u4f3c\u4e4e\u4e0d\u662f\u5f88\u6709\u7528\u3002\u4f46\u662f\u76f8\u6bd4\u8303\u56f4\uff0c\u8fd8\u6709\u4e00\u70b9\u4e0d\u9519\u7684\u662f\uff0c\u5b83\u8fd4\u56de\u8303\u56f4\u5185\u6700\u540e\u4e00\u4e2a\u5bf9\u8c61\u3002</p> <p>\u56e0\u6b64\uff0c\u4e0b\u9762\u4ee3\u7801\u5c06\u662f\u5f88\u7eaf\u6d01\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u50cf\u4e0b\u9762\u4e00\u6837\uff0c\u5c06<code>show()</code>\u65b9\u6cd5\u5e94\u7528\u5230\u4e24\u4e2a view\uff0c\u800c\u4e0d\u662f \u8c03\u7528\u4e24\u6b21\u3002</p> <pre><code>run {\nif (firstTimeView) introView else normalView\n}.show()\n</code></pre>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/#3","title":"\u8303\u56f4\u51fd\u6570\u76843\u4e2a\u5c5e\u6027","text":"<p>\u4e3a\u4e86\u4f7f\u8303\u56f4\u51fd\u6570\u66f4\u6709\u8da3\uff0c\u8ba9\u6211\u75283\u4e2a\u5c5e\u6027\u5c06\u4ed6\u4eec\u7684\u884c\u4e3a\u5206\u7c7b\uff0c\u5e76\u4e14\u4f7f\u7528\u8fd9\u4e9b\u5c5e\u6027\u6765\u533a\u5206\u5b83\u4eec\u3002</p>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/#1vs","title":"1.\u6b63\u5e38vs.\u6269\u5c55\u51fd\u6570","text":"<p>\u5982\u679c\u6211\u4eec\u770b\u770b\u5b9a\u4e49\uff0c<code>with</code>\u5e76\u4e14<code>T.run</code>\u8fd9\u4e24\u4e2a\u51fd\u6570\u5b9e\u9645\u4e0a\u975e\u5e38\u76f8\u4f3c\u3002\u4e0b\u9762\u793a\u4f8b\u5b9e\u73b0\u529f\u80fd\u662f\u4e00\u6837\u7684\u3002</p> <pre><code>with(webview.settings) {\njavaScriptEnabled = true\ndatabaseEnabled = true\n}\n// \u76f8\u4f3c\nwebview.settings.run {\njavaScriptEnabled = true\ndatabaseEnabled = true\n}\n</code></pre> <p>\u7136\u800c\uff0c\u5b83\u4eec\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e<code>with</code>\u662f\u6b63\u5e38\u51fd\u6570\uff0c\u800c<code>T.run</code>\u662f\u6269\u5c55\u51fd\u6570\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u662f\uff0c\u6bcf\u4e2a\u7684\u4f18\u70b9\u662f\u4ec0\u4e48\uff1f</p> <p>\u60f3\u8c61\u4e00\u4e0b\uff0c\u5982\u679c<code>webview.settings</code>\u53ef\u80fd\u662f\u7a7a\u7684\uff0c\u90a3\u4e48\u770b\u8d77\u6765\u5c31\u50cf\u4e0b\u9762\u4e00\u6837\u4e86\u3002</p> <pre><code>with(webview.settings) {\nthis?.javaScriptEnabled = true\nthis?.databaseEnabled = true\n}\n}\nwebview.settings?.run {\njavaScriptEnabled = true\ndatabaseEnabled = true\n}\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u663e\u7136<code>T.run</code>\u6269\u5c55\u529f\u80fd\u6bd4\u8f83\u597d\uff0c\u56e0\u4e3a\u5728\u4f7f\u7528\u4e4b\u524d\u6211\u4eec\u53ef\u4ee5\u5224\u7a7a\u3002</p>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/#2this-vs-it","title":"2.This vs. it\u53c2\u6570","text":"<p>\u5982\u679c\u6211\u4eec\u770b\u770b\u5b9a\u4e49\uff0c\uff0c<code>T.run</code>\u5e76\u4e14<code>T.let</code>\u8fd9\u4e24\u4e2a\u51fd\u6570\u9664\u4e86\u63a5\u53d7\u53c2\u6570\u7684\u65b9\u5f0f\u4e0d\u4e00\u6837\u5916\u51e0\u4e4e\u662f\u4e00\u6837\u7684\u3002\u4ee5\u4e0b\u4e24\u4e2a\u51fd\u6570\u7684\u903b\u8f91\u662f\u76f8\u540c\u7684\u3002</p> <pre><code>stringVariable?.run {\nprintln(\"The length of this String is $length\")\n}\nstringVariable?.let {\nprintln(\"The length of this String is ${it.length}\")\n}\n</code></pre> <p>\u5982\u679c\u4f60\u68c0\u67e5<code>T.run</code>\u51fd\u6570\u7b7e\u540d\uff0c\u4f60\u4f1a\u6ce8\u610f\u5230<code>T.run</code>\u53ea\u662f\u4f5c\u4e3a\u6269\u5c55\u51fd\u6570\u8c03\u7528<code>block: T.()</code>\u3002\u56e0\u6b64\uff0c\u6240\u6709\u7684\u8303\u56f4\u5185\uff0c<code>T</code>\u53ef\u4ee5\u88ab\u79f0\u4e3a<code>this</code>\u3002\u5728\u7f16\u7a0b\u4e2d\uff0c<code>this</code>\u5927\u90e8\u5206\u65f6\u95f4\u53ef\u4ee5\u7701\u7565\u3002\u56e0\u6b64\uff0c\u5728\u6211\u4eec\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5728<code>println</code>\u58f0\u660e\u4e2d\u4f7f\u7528<code>$length</code>\uff0c\u800c\u4e0d\u662f<code>${this.length}</code>\u3002\u6211\u628a\u8fd9\u79f0\u4e3a\u4f20\u9012 this\u53c2\u6570\u3002</p> <p>\u7136\u800c\uff0c\u5bf9\u4e8e<code>T.let</code>\u51fd\u6570\u7b7e\u540d\uff0c\u4f60\u4f1a\u6ce8\u610f\u5230<code>T.let</code>\u628a\u81ea\u5df1\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c\u5373<code>block: (T)</code>\u3002\u56e0\u6b64\uff0c\u8fd9\u5c31\u50cf\u4f20\u9012\u4e00\u4e2alambda\u53c2\u6570\u3002\u5b83\u53ef\u4ee5\u5728\u4f5c\u7528\u57df\u8303\u56f4\u5185\u4f7f\u7528<code>it</code>\u4f5c\u4e3a\u5f15\u7528\u3002\u6240\u4ee5\u6211\u628a\u8fd9\u79f0\u4e3a\u4f20\u9012 it\u53c2\u6570\u3002</p> <p>\u4ece\u4e0a\u9762\u770b\uff0c\u5b83\u4f3c\u4e4e<code>T.run</code>\u662f\u66f4\u4f18\u8d8a\uff0c\u56e0\u4e3a<code>T.let</code>\u66f4\u9690\u542b\uff0c\u4f46\u662f\u8fd9\u662f<code>T.let</code>\u51fd\u6570\u6709\u4e00\u4e9b\u5fae\u5999\u7684\u4f18\u52bf\u5982\u4e0b\uff1a </p> <ul> <li><code>T.let</code>\u76f8\u6bd4\u5916\u90e8\u7c7b\u51fd\u6570/\u6210\u5458\uff0c\u4f7f\u7528\u7ed9\u5b9a\u7684\u53d8\u91cf\u51fd\u6570/\u6210\u5458\u63d0\u4f9b\u4e86\u66f4\u6e05\u6670\u7684\u533a\u5206</li> <li>\u5728<code>this</code>\u4e0d\u80fd\u88ab\u7701\u7565\u7684\u60c5\u51b5\u4e0b\uff0c\u4f8b\u5982\u5f53\u5b83\u4f5c\u4e3a\u51fd\u6570\u7684\u53c2\u6570\u88ab\u4f20\u9012\u65f6<code>it</code>\u6bd4<code>this</code>\u66f4\u77ed\uff0c\u66f4\u6e05\u6670\u3002</li> <li>\u5728<code>T.let</code>\u5141\u8bb8\u4f7f\u7528\u66f4\u597d\u7684\u53d8\u91cf\u547d\u540d\uff0c\u4f60\u53ef\u4ee5\u8f6c\u6362<code>it</code>\u4e3a\u5176\u4ed6\u540d\u79f0\u3002</li> </ul> <pre><code>stringVariable?.let {\nnonNullString -&gt;\nprintln(\"The non null string is $nonNullString\")\n}\n</code></pre>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/#3-vs","title":"3.\u8fd4\u56de\u5f53\u524d\u7c7b\u578b vs.\u5176\u4ed6\u7c7b\u578b","text":"<p>\u73b0\u5728\uff0c\u6211\u4eec\u6765\u770b\u770b<code>T.let</code>\u548c<code>T.also</code>\uff0c\u5982\u679c\u6211\u4eec\u770b\u5b83\u4eec\u7684\u5185\u90e8\u51fd\u6570\u8303\u56f4\uff0c\u4f7f\u7528\u8d77\u6765\u662f\u4e00\u6837\u7684</p> <pre><code>stringVariable?.let {\nprintln(\"The length of this String is ${it.length}\")\n}\nstringVariable?.also {\nprintln(\"The length of this String is ${it.length}\")\n}\n</code></pre> <p>\u7136\u800c\uff0c\u4ed6\u4eec\u5fae\u5999\u7684\u4e0d\u540c\u662f\u4ed6\u4eec\u7684\u8fd4\u56de\u503c\u3002<code>T.let</code>\u8fd4\u56de\u4e0d\u540c\u7c7b\u578b\u7684\u503c\uff0c\u800c<code>T.also</code>\u8fd4\u56de<code>T</code>\u672c\u8eab\u5373<code>this</code>\u3002</p> <p>\u4e24\u8005\u5bf9\u4e8e\u94fe\u63a5\u51fd\u6570\u90fd\u662f\u6709\u7528\u7684\uff0c\u901a\u8fc7<code>T.let</code>\u4f60\u53ef\u4ee5\u6f14\u53d8\u64cd\u4f5c\uff0c\u901a\u8fc7<code>T.also</code>\u4f60\u5728\u540c\u4e00\u4e2a\u53d8\u91cf<code>this</code>\u4e0a\u6267\u884c\u64cd\u4f5c\u3002</p> <p>\u7b80\u5355\u7684\u4f8b\u5b50\u5982\u4e0b</p> <pre><code>val original = \"abc\"\n// \u6539\u53d8\u503c\u5e76\u4e14\u4f20\u9012\u5230\u4e0b\u4e00\u94fe\u6761\noriginal.let {\nprintln(\"The original String is $it\") // \"abc\"\nit.reversed() // \u6539\u53d8\u53c2\u6570\u5e76\u4e14\u4f20\u9012\u5230\u4e0b\u4e00\u94fe\u6761\n}.let {\nprintln(\"The reverse String is $it\") // \"cba\"\nit.length   // \u6539\u53d8\u7c7b\u578b\n}.let {\nprintln(\"The length of the String is $it\") // 3\n}\n// \u9519\u8bef\n// \u5728\u94fe\u4e2d\u53d1\u9001\u76f8\u540c\u7684\u503c\uff08\u6253\u5370\u7684\u7b54\u6848\u662f\u9519\u8bef\u7684\uff09\noriginal.also {\nprintln(\"The original String is $it\") // \"abc\"\nit.reversed() // \u5373\u4f7f\u6211\u4eec\u6539\u53d8\u5b83\uff0c\u4e5f\u662f\u6ca1\u7528\u7684\n}.also {\nprintln(\"The reverse String is ${it}\") // \"abc\"\nit.length  // \u5373\u4f7f\u6211\u4eec\u6539\u53d8\u5b83\uff0c\u4e5f\u662f\u6ca1\u7528\u7684\n}.also {\nprintln(\"The length of the String is ${it}\") // \"abc\"\n}\n// also\u901a\u8fc7\u4fee\u6539\u539f\u59cb\u5b57\u7b26\u4e32\u4e5f\u53ef\u4ee5\u8fbe\u5230\u540c\u6837\u76ee\u7684\n// \u5728\u94fe\u4e2d\u53d1\u9001\u76f8\u540c\u7684\u503c\noriginal.also {\nprintln(\"The original String is $it\") // \"abc\"\n}.also {\nprintln(\"The reverse String is ${it.reversed()}\") // \"cba\"\n}.also {\nprintln(\"The length of the String is ${it.length}\") // 3\n}\n</code></pre> <p>\u5728\u4e0a\u9762\u770b\u6765<code>T.also</code>\u597d\u50cf\u6beb\u65e0\u610f\u4e49\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5c06\u5b83\u4eec\u7ec4\u5408\u6210\u4e00\u4e2a\u529f\u80fd\u5757\u3002\u4f46\u4ed4\u7ec6\u60f3\u60f3\uff0c\u5b83\u4e5f\u6709\u4e00\u4e9b\u4f18\u70b9\uff1a</p> <ol> <li>\u5b83\u53ef\u4ee5\u5728\u76f8\u540c\u7684\u5bf9\u8c61\u4e0a\u63d0\u4f9b\u4e00\u4e2a\u975e\u5e38\u6e05\u6670\u7684\u5206\u79bb\u8fc7\u7a0b\uff0c\u5373\u5236\u4f5c\u66f4\u5c0f\u7684\u529f\u80fd\u90e8\u5206\u3002</li> <li>\u5728\u4f7f\u7528\u4e4b\u524d\uff0c\u5b83\u53ef\u4ee5\u5b9e\u73b0\u975e\u5e38\u5f3a\u5927\u7684\u81ea\u6211\u64cd\u7eb5\uff0c\u5b9e\u73b0\u94fe\u6761\u5efa\u8bbe\u8005\u64cd\u4f5c(builder \u6a21\u5f0f)\u3002</li> </ol> <p>\u5f53\u4e24\u8005\u7ed3\u5408\u5728\u4e00\u8d77\u65f6\uff0c\u5373\u4e00\u4e2a\u81ea\u6211\u6f14\u53d8\uff0c\u4e00\u4e2a\u81ea\u6211\u4fdd\u7559\uff0c\u53ef\u4ee5\u53d8\u5f97\u975e\u5e38\u5f3a\u5927\uff0c\u4f8b\u5982\u4e0b\u9762</p> <pre><code>// \u6b63\u5e38\u65b9\u6cd5\nfun makeDir(path: String): File  {\nval result = File(path)\nresult.mkdirs()\nreturn result\n}\n// \u6539\u8fdb\u65b9\u6cd5\nfun makeDir(path: String) = path.let{ File(it) }.also{ it.mkdirs() }\n</code></pre>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/#_2","title":"\u6240\u6709\u7684\u5c5e\u6027","text":"<p>\u901a\u8fc7\u8bf4\u660e\u8fd93\u4e2a\u5c5e\u6027\uff0c\u6211\u4eec\u5e94\u8be5\u53ef\u4ee5\u4e86\u89e3\u8fd9\u4e9b\u51fd\u6570\u7684\u884c\u4e3a\u4e86\u3002\u8ba9\u6211\u4eec\u518d\u6765\u770b\u770b<code>T.apply</code>\u51fd\u6570\uff0c\u56e0\u4e3a\u4e0a\u9762\u6ca1\u6709\u63d0\u5230\u3002\u8fd93\u4e2a\u5c5e\u6027\u5728<code>T.apply</code>\u5b9a\u4e49\u5982\u4e0b...</p> <ol> <li>\u8fd9\u662f\u4e00\u4e2a\u6269\u5c55\u51fd\u6570</li> <li>\u628a<code>this</code>\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002</li> <li>\u5b83\u8fd4\u56de<code>this</code>\uff08\u5373\u5b83\u672c\u8eab\uff09</li> </ol> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u60f3\u8c61\uff0c\u5b83\u53ef\u4ee5\u50cf\u4e0b\u9762\u4e00\u6837\u88ab\u4f7f\u7528</p> <pre><code>// \u6b63\u5e38\u65b9\u6cd5\nfun createInstance(args: Bundle) : MyFragment {\nval fragment = MyFragment()\nfragment.arguments = args\nreturn fragment\n}\n// \u6539\u8fdb\u65b9\u6cd5\nfun createInstance(args: Bundle) = MyFragment().apply { arguments = args }\n</code></pre> <p>\u6216\u8005\u6211\u4eec\u4e5f\u53ef\u4ee5\u521b\u5efa\u94fe\u5f0f\u8c03\u7528\u3002</p> <pre><code>// \u6b63\u5e38\u65b9\u6cd5\nfun createIntent(intentData: String, intentAction: String): Intent {\nval intent = Intent()\nintent.action = intentAction\nintent.data=Uri.parse(intentData)\nreturn intent\n}\n//  \u6539\u8fdb\u5b9e\u73b0\nfun createIntent(intentData: String, intentAction: String) =\nIntent().apply { action = intentAction }\n.apply { data = Uri.parse(intentData) }\n</code></pre>"},{"location":"front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/#_3","title":"\u51fd\u6570\u9009\u62e9","text":"<p>\u56e0\u6b64\uff0c\u663e\u7136\uff0c\u6709\u4e86\u8fd9\u4e09\u4e2a\u5c5e\u6027\uff0c\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u5bf9\u4e0a\u8ff0\u51fd\u6570\u8fdb\u884c\u76f8\u5e94\u7684\u5206\u7c7b\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e0b\u9762\u5f62\u6210\u4e00\u4e2a\u51b3\u7b56\u6811\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e2a\u51fd\u6570\u3002</p> <p></p> <p>\u5e0c\u671b\u4e0a\u9762\u7684\u51b3\u7b56\u6811\u53ef\u4ee5\u6e05\u6670\u8bf4\u660e\u51fd\u6570\u533a\u522b\uff0c\u4e5f\u7b80\u5316\u60a8\u7684\u51b3\u7b56\uff0c\u4f7f\u60a8\u80fd\u591f\u6070\u5f53\u638c\u63e1\u8fd9\u4e9b\u51fd\u6570\u7684\u4f7f\u7528\u3002</p> <p>\u539f\u6587\u94fe\u63a5</p>"},{"location":"front-end/android/system/ASM-Core-Api/","title":"ASM Core Api \u8be6\u89e3","text":""},{"location":"front-end/android/system/ASM-Core-Api/#_1","title":"\u524d\u8a00","text":"<p>\u524d\u9762\u4e00\u7bc7\u6587\u7ae0 ASM \u7b80\u4ecb \u5bf9 ASM \u6846\u67b6\u505a\u4e86\u7b80\u5355\u7684\u4ecb\u7ecd\u3002</p> <p>\u672c\u7bc7\u6587\u7ae0\u4e3b\u8981\u5bf9\u8be5\u6846\u67b6\u7684 Core Api \u5176\u4e2d\u91cd\u8981\u7684\u4e00\u4e9b\u7c7b\u8fdb\u884c\u8be6\u7ec6\u7684\u4ecb\u7ecd\uff0c\u8ba9\u5927\u5bb6\u53ef\u4ee5\u66f4\u5f97\u5fc3\u5e94\u624b\u7684\u4f7f\u7528 ASM\u3002</p> <p>\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5148\u56de\u987e\u4e00\u4e0b ASM Core Api \u8c03\u7528\u6d41\u7a0b\uff1a</p> <ol> <li>ASM \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7c7b<code>ClassReader</code>\u53ef\u4ee5\u65b9\u4fbf\u5730\u8ba9\u6211\u4eec\u5bf9<code>class</code>\u6587\u4ef6\u8fdb\u884c\u8bfb\u53d6\u4e0e\u89e3\u6790\uff1b</li> <li>ASM \u5728<code>ClassReader</code>\u89e3\u6790<code>class</code>\u6587\u4ef6\u8fc7\u7a0b\u4e2d\uff0c\u89e3\u6790\u5230\u67d0\u4e00\u4e2a\u7ed3\u6784\u5c31\u4f1a\u901a\u77e5\u5230<code>ClassVisitor</code>\u7684\u76f8\u5e94\u65b9\u6cd5\uff08eg\uff1a\u89e3\u6790\u5230\u7c7b\u65b9\u6cd5\u65f6\uff0c\u5c31\u4f1a\u56de\u8c03<code>ClassVisitor.visitMethod</code>\u65b9\u6cd5\uff09\uff1b</li> <li>\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539<code>ClassVisitor</code>\u4e2d\u76f8\u5e94\u7ed3\u6784\u65b9\u6cd5\u8fd4\u56de\u503c\uff0c\u5b9e\u73b0\u5bf9\u7c7b\u7684\u4ee3\u7801\u5207\u5165\uff08eg\uff1a\u66f4\u6539<code>ClassVisitor.visitMethod()</code>\u65b9\u6cd5\u7684\u9ed8\u8ba4\u8fd4\u56de\u503c<code>MethodVisitor</code>\u5b9e\u4f8b\uff0c\u901a\u8fc7\u64cd\u4f5c\u8be5\u81ea\u5b9a\u4e49<code>MethodVisitor</code>\u4ece\u800c\u5b9e\u73b0\u5bf9\u539f\u65b9\u6cd5\u7684\u6539\u5199\uff09\uff1b</li> <li>\u5176\u5b83\u7684\u7ed3\u6784\u904d\u5386\u4e5f\u5982\u540c<code>ClassVisitor</code>\uff1b</li> <li>\u901a\u8fc7<code>ClassWriter</code>\u7684<code>toByteArray()</code>\u65b9\u6cd5\uff0c\u5f97\u5230<code>class</code>\u6587\u4ef6\u7684\u5b57\u8282\u7801\u5185\u5bb9\uff0c\u6700\u540e\u901a\u8fc7\u6587\u4ef6\u6d41\u5199\u5165\u65b9\u5f0f\u8986\u76d6\u6389\u539f\u5148\u7684\u5185\u5bb9\uff0c\u5b9e\u73b0<code>class</code>\u6587\u4ef6\u7684\u6539\u5199\u3002</li> </ol> <p>\u4ee5\u4e0a\uff0c\u5c31\u662f ASM Core Api \u7684\u6574\u4f53\u8fd0\u4f5c\u6d41\u7a0b\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u5c06\u5bf9\u5176\u4e2d\u6d89\u53ca\u5230\u7684\u91cd\u8981\u7684\u7c7b\u8fdb\u884c\u8be6\u7ec6\u89e3\u6790\u3002</p>"},{"location":"front-end/android/system/ASM-Core-Api/#classreader","title":"ClassReader","text":"<p>\u8fd9\u4e2a\u7c7b\u4f1a\u63d0\u4f9b\u4f60\u8981\u8f6c\u53d8\u7684\u7c7b\u7684\u5b57\u8282\u6570\u7ec4\uff0c\u5b83\u7684<code>accept</code>\u65b9\u6cd5\uff0c\u63a5\u53d7\u4e00\u4e2a\u5177\u4f53\u7684<code>ClassVisitor</code>\uff0c\u5e76\u8c03\u7528\u5b9e\u73b0\u4e2d\u5177\u4f53\u7684 visit,  visitSource, visitOuterClass, visitAnnotation, visitAttribute, visitInnerClass,visitField, visitMethod**\u548c **visitEnd \u65b9\u6cd5\u3002</p> <p><code>ClassReader.accept(ClassVisitor classVisitor, int parsingOptions)</code>\u4e2d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570<code>parsingOptions</code>\u7684\u53d6\u503c\u6709\u4ee5\u4e0b\u9009\u9879\uff1a</p> <ul> <li><code>ClassReader.SKIP_DEBUG</code>\uff1a\u8868\u793a\u4e0d\u904d\u5386\u8c03\u8bd5\u5185\u5bb9\uff0c\u5373\u8df3\u8fc7\u6e90\u6587\u4ef6\uff0c\u6e90\u7801\u8c03\u8bd5\u6269\u5c55\uff0c\u5c40\u90e8\u53d8\u91cf\u8868\uff0c\u5c40\u90e8\u53d8\u91cf\u7c7b\u578b\u8868\u548c\u884c\u53f7\u8868\u5c5e\u6027\uff0c\u5373\u4ee5\u4e0b\u65b9\u6cd5\u65e2\u4e0d\u4f1a\u88ab\u89e3\u6790\u4e5f\u4e0d\u4f1a\u88ab\u8bbf\u95ee\uff08<code>ClassVisitor.visitSource</code>\uff0c<code>MethodVisitor.visitLocalVariable</code>\uff0c<code>MethodVisitor.visitLineNumber</code>\uff09\u3002\u4f7f\u7528\u6b64\u6807\u8bc6\u540e\uff0c\u7c7b\u6587\u4ef6\u8c03\u8bd5\u4fe1\u606f\u4f1a\u88ab\u53bb\u9664\uff0c\u8bf7\u8b66\u8bb0\u3002</li> <li><code>ClassReader.SKIP_CODE</code>\uff1a\u8bbe\u7f6e\u8be5\u6807\u8bc6\uff0c\u5219\u4ee3\u7801\u5c5e\u6027\u5c06\u4e0d\u4f1a\u88ab\u8f6c\u6362\u548c\u8bbf\u95ee\uff0c\u4f8b\u5982\u65b9\u6cd5\u4f53\u4ee3\u7801\u4e0d\u4f1a\u8fdb\u884c\u89e3\u6790\u548c\u8bbf\u95ee\u3002</li> <li><code>ClassReader.SKIP_FRAMES</code>\uff1a\u8bbe\u7f6e\u8be5\u6807\u8bc6\uff0c\u8868\u793a\u8df3\u8fc7\u6808\u56fe\uff08StackMap\uff09\u548c\u6808\u56fe\u8868\uff08StackMapTable\uff09\u5c5e\u6027\uff0c\u5373<code>MethodVisitor.visitFrame</code>\u65b9\u6cd5\u4e0d\u4f1a\u88ab\u8f6c\u6362\u548c\u8bbf\u95ee\u3002\u5f53\u8bbe\u7f6e\u4e86<code>ClassWriter.COMPUTE_FRAMES</code>\u65f6\uff0c\u8bbe\u7f6e\u8be5\u6807\u8bc6\u4f1a\u5f88\u6709\u7528\uff0c\u56e0\u4e3a\u4ed6\u907f\u514d\u4e86\u8bbf\u95ee\u5e27\u5185\u5bb9\uff08\u8fd9\u4e9b\u5185\u5bb9\u4f1a\u88ab\u5ffd\u7565\u548c\u91cd\u65b0\u8ba1\u7b97\uff0c\u65e0\u9700\u8bbf\u95ee\uff09\u3002</li> <li><code>ClassReader.EXPAND_FRAMES</code>\uff1a\u8be5\u6807\u8bc6\u7528\u4e8e\u8bbe\u7f6e\u6269\u5c55\u6808\u5e27\u56fe\u3002\u9ed8\u8ba4\u6808\u56fe\u4ee5\u5b83\u4eec\u539f\u59cb\u683c\u5f0f\uff08V1_6\u4ee5\u4e0b\u4f7f\u7528\u6269\u5c55\u683c\u5f0f\uff0c\u5176\u4ed6\u4f7f\u7528\u538b\u7f29\u683c\u5f0f\uff09\u88ab\u8bbf\u95ee\u3002\u5982\u679c\u8bbe\u7f6e\u8be5\u6807\u8bc6\uff0c\u6808\u56fe\u5219\u59cb\u7ec8\u4ee5\u6269\u5c55\u683c\u5f0f\u8fdb\u884c\u8bbf\u95ee\uff08\u6b64\u6807\u8bc6\u5728<code>ClassReader</code>\u548c<code>ClassWriter</code>\u4e2d\u589e\u52a0\u4e86\u89e3\u538b/\u538b\u7f29\u6b65\u9aa4\uff0c\u4f1a\u5927\u5e45\u5ea6\u964d\u4f4e\u6027\u80fd\uff09\u3002</li> </ul>"},{"location":"front-end/android/system/ASM-Core-Api/#classwriter","title":"ClassWriter","text":"<p>\u8fd9\u4e2a\u7c7b\u662f<code>ClassVisitor</code>\u7684\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u4e2d\u7684<code>toByteArray</code>\u65b9\u6cd5\u4f1a\u5c06\u6700\u7ec8\u4fee\u6539\u7684\u5b57\u8282\u7801\u4ee5 byte \u6570\u7ec4\u5f62\u5f0f\u8fd4\u56de\u3002\u5b83\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u4f20\u9012\u7ed9\u4e00\u4e2a\u6216\u591a\u4e2a<code>ClassReader</code>\u6216<code>ClassVisitor</code>\u9002\u914d\u5668\u4fee\u6539\u4e00\u4e2a\u6216\u591a\u4e2a\u5df2\u5b58\u5728\u7684Java\u7c7b\u7684\u7c7b\u6587\u4ef6\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u7c7b\u6587\u4ef6\u6709\u7740\u81ea\u5df1\u4e25\u683c\u7684\u683c\u5f0f\uff0c\u5f53\u6211\u4eec\u60f3\u8981\u6ce8\u5165\u76f8\u5173\u4ee3\u7801\u65f6\uff0c\u4e0d\u662f\u76f4\u63a5\u6ce8\u5165\u76f8\u5173\u6307\u4ee4\u5c31\u53ef\u4ee5\u7684\uff0c\u6bd4\u5982\u5bf9\u4e8e\u65b9\u6cd5\u6ce8\u5165\uff0c\u6211\u4eec\u53ef\u80fd\u8fd8\u9700\u8981\u5bf9\u6808\u5e27\u56fe\uff08 stack map frames\uff09\u8fdb\u884c\u8ba1\u7b97\uff1a\u4f60\u9700\u8981\u8ba1\u7b97\u6240\u6709\u7684\u5e27\uff0c\u627e\u5230\u6709\u5bf9\u8c61\u8df3\u8f6c\u6216\u8005\u7edd\u5bf9\u8df3\u8f6c\u7684\u5e27\uff0c\u6700\u540e\u8fd8\u8981\u538b\u7f29\u5269\u4f59\u7684\u5e27\u3002\u540c\u6837\uff0c\u5bf9\u4e8e\u6808\u5e27\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808\u7684\u5927\u5c0f\u4e5f\u8981\u81ea\u5df1\u8fdb\u884c\u8ba1\u7b97\u3002\u8fd9\u4e9b\u8ba1\u7b97\u64cd\u4f5c\u5177\u5907\u4e00\u5b9a\u7684\u96be\u5ea6\uff0c\u5e78\u8fd0\u7684\u662f\uff0c\u5f53\u6211\u4eec\u521b\u5efa\u4e00\u4e2a<code>ClassWriter</code>\u65f6\uff0c\u53ef\u4ee5\u914d\u7f6e ASM \u81ea\u52a8\u5e2e\u6211\u4eec\u5bf9\u6307\u5b9a\u7684\u5185\u5bb9\u8fdb\u884c\u8ba1\u7b97\u3002\u5177\u4f53\u7684\u914d\u7f6e\u6807\u8bc6\u5982\u4e0b\uff1a</p> <p><code>ClassWriter</code>\u7684\u6784\u9020\u51fd\u6570\u9700\u8981\u4f20\u5165\u4e00\u4e2a flag\uff0c\u5176\u542b\u4e49\u4e3a\uff1a</p> <ul> <li><code>ClassWriter(0)</code>\uff1a\u8868\u793a ASM \u4e0d\u4f1a\u81ea\u52a8\u81ea\u52a8\u5e2e\u4f60\u8ba1\u7b97\u6808\u5e27\u548c\u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808\u5927\u5c0f\u3002</li> <li><code>ClassWriter(ClassWriter.COMPUTE_MAXS)</code>\uff1a\u8868\u793a ASM \u4f1a\u81ea\u52a8\u5e2e\u4f60\u8ba1\u7b97\u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808\u7684\u5927\u5c0f\uff0c\u4f46\u662f\u4f60\u8fd8\u662f\u9700\u8981\u8c03\u7528<code>visitMaxs</code>\u65b9\u6cd5\uff0c\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f\u53c2\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u88ab\u5ffd\u7565\u3002\u5e26\u6709\u8fd9\u4e2a\u6807\u8bc6\uff0c\u5bf9\u4e8e\u6808\u5e27\u5927\u5c0f\uff0c\u8fd8\u662f\u9700\u8981\u4f60\u624b\u52a8\u8ba1\u7b97\u3002</li> <li><code>ClassWriter(ClassWriter.COMPUTE_FRAMES)</code>\uff1a\u8868\u793a ASM \u4f1a\u81ea\u52a8\u5e2e\u4f60\u8ba1\u7b97\u6240\u6709\u7684\u5185\u5bb9\u3002\u4f60\u4e0d\u5fc5\u53bb\u8c03\u7528<code>visitFrame</code>\uff0c\u4f46\u662f\u4f60\u8fd8\u662f\u9700\u8981\u8c03\u7528<code>visitMaxs</code>\u65b9\u6cd5\uff08\u53c2\u6570\u53ef\u4efb\u610f\u8bbe\u7f6e\uff0c\u540c\u6837\u4f1a\u88ab\u5ffd\u7565\uff09\u3002</li> </ul> <p>\u4f7f\u7528\u8fd9\u4e9b\u6807\u8bc6\u5f88\u65b9\u4fbf\uff0c\u4f46\u662f\u4f1a\u5e26\u6765\u4e00\u4e9b\u6027\u80fd\u4e0a\u7684\u635f\u5931\uff1a<code>COMPUTE_MAXS</code>\u6807\u8bc6\u4f1a\u4f7f<code>ClassWriter</code>\u616210%\uff0c<code>COMPUTE_FRAMES</code>\u6807\u8bc6\u4f1a\u4f7f<code>ClassWriter</code>\u61622\u500d\uff0c</p>"},{"location":"front-end/android/system/ASM-Core-Api/#classvisitor","title":"ClassVisitor","text":"<p>\u4e00\u4e2a\u53ef\u4ee5\u8bbf\u95ee<code>Java</code>\u7c7b\u7684\u8bbf\u95ee\u8005\u3002\u5176\u65b9\u6cd5\u88ab\u8c03\u7528\u6b21\u5e8f\u5fc5\u987b\u6ee1\u8db3\uff1a</p> <p>visit visitSource? visitOuterClass? ( visitAnnotation | visitAttribute )* ( visitInnerClass | visitField | visitMethod )* visitEnd</p> <p>\u5373<code>visit</code>\u5fc5\u987b\u7b2c\u4e00\u4e2a\u88ab\u8c03\u7528\uff0c\u7136\u540e\u6700\u591a\u8c03\u7528\u4e00\u6b21<code>visitSource</code>\uff0c\u540c\u6837\u63a5\u7740\u6700\u591a\u8c03\u7528\u4e00\u6b21<code>visitOuterClass</code>\uff0c\u63a5\u4e0b\u6765\u6309\u4efb\u610f\u987a\u5e8f\u53ef\u591a\u6b21\u8c03\u7528<code>visitAnnotation</code>\u548c<code>visitAttribute</code>\uff1b\u63a5\u4e0b\u6765<code>visitInnerClass</code>\uff0c<code>visitField</code>\uff0c<code>visitMethod</code>\u540c\u6837\u6309\u4efb\u610f\u987a\u5e8f\u53ef\u591a\u6b21\u8c03\u7528\uff1b\u6700\u540e\u8c03\u7528\u4e00\u6b21<code>visitEnd</code>\uff0c\u8868\u793a\u7c7b\u8bbf\u95ee\u7ed3\u675f\u3002</p> <p>\u6ce8: ASM \u6587\u6863\u539f\u6587\u5185\u5bb9\u4e3a\uff1a</p> <p>This means that visit must be called \ufb01rst, followed by at most one call to visitSource, followed by at most one call to visitOuterClass, followed by any number of calls in any order to visitAnnotation and visitAttribute, followed by any number of calls ***in any order to visitInnerClass,visitField and visitMethod*** , and terminated by a single call to visitEnd.</p> <p>\u9ed1\u4f53\u52a0\u7c97\u53e5\u5b50\u6211\u7684\u7ffb\u8bd1\u662f\uff1a\u4ee5\u4efb\u610f\u987a\u5e8f\u8bbf\u95ee<code>visitInnerClass</code>,<code>visitField</code>\u548c<code>visitMethod</code>\uff0c\u4f46\u662f\u5728\u6211\u673a\u5668\u4e0a\u8bd5\u9a8c\u5f97\u5230\u7684\u7ed3\u679c\u662f\u8fd93\u8005\u7684\u8bbf\u95ee\u987a\u5e8f\u662f\u56fa\u5b9a\u7684\uff1a<code>visitInnerClass</code>-&gt;<code>visitField</code>-&gt;<code>visitMethod</code>\uff0c\u6240\u4ee5\uff0c\u6b64\u5904\u53ef\u80fd\u662f\u7ffb\u8bd1\u6709\u95ee\u9898\uff0c\u5e94\u8be5\u662f***\u4ee5\u4e00\u5b9a\u7684\u987a\u5e8f\u53ef\u591a\u6b21\u8c03\u7528 <code>visitInnerClass</code>,<code>visitField</code> \u548c<code>visitMethod</code>***\u3002\u5982\u6709\u5dee\u9519\uff0c\u70e6\u8bf7\u6307\u6b63\uff0c\u611f\u8c22\uff01 -</p>"},{"location":"front-end/android/system/ASM-Core-Api/#methodvisitor","title":"MethodVisitor","text":"<p>ASM \u751f\u6210\u548c\u8f6c\u6362<code>class</code>\u6587\u4ef6\u65b9\u6cd5\u4f7f\u7528\u7684\u662f\u62bd\u8c61\u7c7b<code>MethodVisitor</code>\uff0c<code>ClassVisitor.visitMethod</code>\u65b9\u6cd5\u8fd4\u56de\u7684\u5c31\u662f\u8be5\u5b9e\u4f8b\u3002</p> <p>\u5176\u65b9\u6cd5\u8c03\u7528\u65f6\u5e8f\u4e3a\uff1a</p> <p>visitAnnotationDefault?  ( visitAnnotation | visitParameterAnnotation | visitAttribute )*  ( visitCode  ( visitTryCatchBlock | visitLabel | visitFrame | visitXxxInsn |  visitLocalVariable | visitLineNumber )*  visitMaxs )?  visitEnd</p> <p>\u5373\u5982\u679c\u6709<code>annotations</code>\u6216\u8005<code>attributes</code>\uff0c\u5b83\u4eec\u5fc5\u987b\u88ab\u7b2c\u4e00\u4e2a\u8bbf\u95ee\uff0c\u63a5\u4e0b\u6765\u5bf9\u4e8e\u975e\u62bd\u8c61\u65b9\u6cd5\u8bbf\u95ee\u7684\u5c31\u662f\u65b9\u6cd5\u5185\u90e8\u5b57\u8282\u7801\uff08<code>visitCode</code>)\uff0c\u7136\u540e\u5728<code>visitCode</code>\u548c<code>visitMaxs</code>\u4e2d\u7684\u90a3\u4e9b\u6307\u4ee4\u4f1a\u6309\u4e0a\u9762\u6240\u793a\u65b9\u6cd5\u987a\u5e8f\u8bbf\u95ee\uff0c\u6700\u540e\u7c7b\u65b9\u6cd5\u8bbf\u95ee\u7ed3\u675f\u56de\u8c03<code>visitEnd</code>\u3002</p> <p>\u5728<code>class</code>\u6587\u4ef6\u4e2d\uff0c\u65b9\u6cd5\u4e2d\u7684\u4ee3\u7801\u662f\u4ee5\u4e00\u7cfb\u5217\u7684\u5b57\u8282\u7801\u6307\u4ee4\u7ec4\u6210\u7684\u3002\u5982\u679c\u8981\u751f\u6210\u6216\u8005\u6539\u53d8\u7c7b\u5185\u5bb9\uff0c\u5219\u9700\u8981\u5148\u4e86\u89e3\u4e0b\u8fd9\u4e9b\u6307\u4ee4\u7684\u5de5\u4f5c\u6a21\u578b\u3002</p> <p>\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u6307\u4ee4\u7684\u5de5\u4f5c\u6a21\u578b\uff0c\u4e86\u89e3\u8fd9\u4e9b\u5185\u5bb9\u5c31\u57fa\u672c\u80fd\u591f\u5b8c\u6210\u5bf9\u7c7b\u7684\u4e00\u4e9b\u7b80\u5355\u7684\u53d8\u6362\u64cd\u4f5c\u3002\u5982\u9700\u66f4\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u8bf7\u53c2\u8003 JVM \u89c4\u8303\u3002</p> <ul> <li>JVM \u6267\u884c\u6a21\u578b    \u5728\u4ecb\u7ecd\u5b57\u8282\u7801\u6307\u4ee4\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u5148\u4ecb\u7ecd\u4e0b JVM \u7684\u6267\u884c\u6a21\u578b\u3002\u6211\u4eec\u90fd\u77e5\u9053\uff0cJava \u4ee3\u7801\u662f\u8fd0\u884c\u5728\u7ebf\u7a0b\u4e2d\u7684\uff0c\u6bcf\u6761\u7ebf\u7a0b\u90fd\u62e5\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u8fd0\u884c\u6808\uff0c\u6808\u662f\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u5e27\u7ec4\u6210\u7684\uff0c\u4e5f\u53eb\u6808\u5e27\uff08StackFrame\uff09\u3002\u6bcf\u4e2a\u6808\u5e27\u4ee3\u8868\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\uff1a\u6bcf\u5f53\u7ebf\u7a0b\u8c03\u7528\u4e00\u4e2aJava\u65b9\u6cd5\u65f6\uff0cJVM\u5c31\u4f1a\u5728\u8be5\u7ebf\u7a0b\u5bf9\u5e94\u7684\u6808\u4e2d\u538b\u5165\u4e00\u4e2a\u5e27\uff1b\u5f53\u6267\u884c\u8fd9\u4e2a\u65b9\u6cd5\u65f6\uff0c\u5b83\u4f7f\u7528\u8fd9\u4e2a\u5e27\u6765\u5b58\u50a8\u53c2\u6570\u3001\u5c40\u90e8\u53d8\u91cf\u3001\u4e2d\u95f4\u8fd0\u7b97\u7ed3\u679c\u7b49\u7b49\uff1b\u5f53\u65b9\u6cd5\u6267\u884c\u7ed3\u675f\uff08\u65e0\u8bba\u662f\u6b63\u5e38\u8fd4\u56de\u8fd8\u662f\u629b\u5f02\u5e38\uff09\u65f6\uff0c\u8be5\u6808\u5e27\u5c31\u4f1a\u5f39\u51fa\uff0c\u7136\u540e\u7ee7\u7eed\u8fd0\u884c\u4e0b\u4e00\u4e2a\u6808\u5e27\uff08\u6808\u9876\u6808\u5e27\uff09\u7684\u65b9\u6cd5\u8c03\u7528\u3002</li> <li>\u6808\u5e27    \u6808\u5e27\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u5e27\u6570\u636e\u533a\u3002    \u5c40\u90e8\u53d8\u91cf\u8868 \u88ab\u7ec4\u7ec7\u4e3a\u4ee5\u4e00\u4e2a\u5b57\u957f\uff0832 bit\uff09\u4e3a\u5355\u4f4d\u3001\u4ece0\u5f00\u59cb\u8ba1\u6570\u7684\u6570\u7ec4\uff0c\u7c7b\u578b\u4e3a<code>short</code>\u3001<code>byte</code>\u548c<code>char</code>\u7684\u503c\u5728\u5b58\u5165\u6570\u7ec4\u524d\u8981\u88ab\u8f6c\u6362\u6210<code>int</code>\u503c\uff0c\u800c<code>long</code>\u548c <code>double</code>\u5728\u6570\u7ec4\u4e2d\u5360\u636e\u8fde\u7eed\u7684\u4e24\u9879\uff0c\u5728\u8bbf\u95ee\u5c40\u90e8\u53d8\u91cf\u4e2d\u7684<code>long</code>\u6216<code>double</code>\u65f6\uff0c\u53ea\u9700\u53d6\u51fa\u8fde\u7eed\u4e24\u9879\u7684\u7b2c\u4e00\u9879\u7684\u7d22\u5f15\u503c\u5373\u53ef,\u5982\u67d0\u4e2a<code>long</code>\u503c\u5728\u5c40\u90e8\u53d8\u91cf \u533a\u4e2d\u5360\u636e\u7684\u7d22\u5f15\u65f63\u30014\u9879\uff0c\u53d6\u503c\u65f6\uff0c\u6307\u4ee4\u53ea\u9700\u53d6\u7d22\u5f15\u4e3a3\u7684<code>long</code>\u503c\u5373\u53ef\u3002    \u64cd\u4f5c\u6570\u6808 \u548c\u5c40\u90e8\u53d8\u91cf\u8868\u4e00\u6837\uff0c\u64cd\u4f5c\u6570\u6808\u4e5f\u88ab\u7ec4\u7ec7\u6210\u4e00\u4e2a\u4ee5\u5b57\u957f\u4e3a\u5355\u4f4d\u7684\u6570\u7ec4\u3002\u4f46\u548c\u524d\u8005\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4e0d\u662f\u901a\u8fc7\u7d22\u5f15\u6765\u8bbf\u95ee\u7684\uff0c\u800c\u662f\u901a\u8fc7\u5165\u6808\u548c\u51fa\u6808\u6765\u8bbf\u95ee\u7684\u3002\u53ef\u628a\u64cd\u4f5c\u6570\u6808\u7406\u89e3\u4e3a\u5b58\u50a8\u8ba1\u7b97\u65f6\uff0c\u4e34\u65f6\u6570\u636e\u7684\u5b58\u50a8\u533a\u57df\u3002    \u5e27\u6570\u636e\u533a \u5e27\u6570\u636e\u533a\u9664\u4e86\u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808\u5916\uff0cJava\u6808\u5e27\u8fd8\u9700\u8981\u4e00\u4e9b\u6570\u636e\u6765\u652f\u6301\u5e38\u91cf\u6c60\u89e3\u6790\u3001\u6b63\u5e38\u65b9\u6cd5\u8fd4\u56de\u4ee5\u53ca\u5f02\u5e38\u6d3e\u53d1\u673a\u5236\u3002\u8fd9\u4e9b\u6570\u636e\u90fd\u4fdd\u5b58\u5728Java\u6808\u5e27\u7684\u5e27\u6570\u636e\u533a\u4e2d\u3002    \u5f53JVM\u6267\u884c\u5230\u9700\u8981\u5e38\u91cf\u6c60\u6570\u636e\u7684\u6307\u4ee4\u65f6\uff0c\u5b83\u90fd\u4f1a\u901a\u8fc7\u5e27\u6570\u636e\u533a\u4e2d\u6307\u5411\u5e38\u91cf\u6c60\u7684\u6307\u9488\u6765\u8bbf\u95ee\u5b83\u3002    \u9664\u4e86\u5904\u7406\u5e38\u91cf\u6c60\u89e3\u6790\u5916\uff0c\u5e27\u91cc\u7684\u6570\u636e\u8fd8\u8981\u5904\u7406Java\u65b9\u6cd5\u7684\u6b63\u5e38\u7ed3\u675f\u548c\u5f02\u5e38\u7ec8\u6b62\u3002\u5982\u679c\u662f\u901a\u8fc7return\u6b63\u5e38\u7ed3\u675f\uff0c\u5219\u5f53\u524d\u6808\u5e27\u4eceJava\u6808\u4e2d\u5f39\u51fa\uff0c\u6062\u590d\u53d1\u8d77\u8c03\u7528\u7684\u65b9\u6cd5\u7684\u6808\u3002\u5982\u679c\u65b9\u6cd5\u6709\u8fd4\u56de\u503c\uff0cJVM\u4f1a\u628a\u8fd4\u56de\u503c\u538b\u5165\u5230\u53d1\u8d77\u8c03\u7528\u65b9\u6cd5\u7684\u64cd\u4f5c\u6570\u6808\u3002    \u4e3a\u4e86\u5904\u7406Java\u65b9\u6cd5\u4e2d\u7684\u5f02\u5e38\u60c5\u51b5\uff0c\u5e27\u6570\u636e\u533a\u8fd8\u5fc5\u987b\u4fdd\u5b58\u4e00\u4e2a\u5bf9\u6b64\u65b9\u6cd5\u5f02\u5e38\u5f15\u7528\u8868\u7684\u5f15\u7528\u3002\u5f53\u5f02\u5e38\u629b\u51fa\u65f6\uff0cJVM\u7ed9catch\u5757\u4e2d\u7684\u4ee3\u7801\u3002\u5982\u679c\u6ca1\u53d1\u73b0\uff0c\u65b9\u6cd5\u7acb\u5373\u7ec8\u6b62\uff0c\u7136\u540eJVM\u7528\u5e27\u533a\u6570\u636e\u7684\u4fe1\u606f\u6062\u590d\u53d1\u8d77\u8c03\u7528\u7684\u65b9\u6cd5\u7684\u5e27\u3002\u7136\u540e\u518d\u53d1\u8d77\u8c03\u7528\u65b9\u6cd5\u7684\u4e0a\u4e0b\u6587\u91cd\u65b0\u629b\u51fa\u540c\u6837\u7684\u5f02\u5e38\u3002</li> </ul> <p>\u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808\u7684\u5927\u5c0f\u51b3\u4e8e\u65b9\u6cd5\u4ee3\u7801\uff0c\u5b83\u4eec\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u8ba1\u7b97\uff0c\u5e76\u4e0e\u7c7b\u4e2d\u7684\u5b57\u8282\u7801\u6307\u4ee4\u4e00\u8d77\u5b58\u50a8\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u540c\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\uff0c\u6240\u6709\u5e27\u7684\u5927\u5c0f\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e0d\u540c\u7684\u65b9\u6cd5\u8c03\u7528\uff0c\u5404\u4e2a\u6808\u5e27\u90fd\u62e5\u6709\u4e0d\u540c\u5927\u5c0f\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808\u3002</p> <p></p> <p>\u8868 3.1 \u5c55\u793a\u4e00\u4e2a\u5e26\u67093\u4e2a\u5e27\u7684\u8fd0\u884c\u6808\u6837\u4f8b\u3002\u7b2c\u4e00\u4e2a\u5e27\u5305\u542b3\u4e2a\u5c40\u90e8\u53d8\u91cf\uff0c\u5176\u64cd\u4f5c\u6570\u6808\u4e3a4\u4e2a\u5b57\u957f\u5927\u5c0f\uff0c\u5305\u542b2\u4e2a\u503c\u3002\u7b2c\u4e8c\u4e2a\u5e27\u5305\u542b2\u4e2a\u5c40\u90e8\u53d8\u91cf\u548c2\u4e2a\u64cd\u4f5c\u6570\u503c\u3002\u7b2c\u4e09\u4e2a\u5e27\u5904\u4e8e\u6808\u9876\uff08\u5f53\u524d\u5e27\uff09\uff0c\u5305\u542b4\u4e2a\u5c40\u90e8\u53d8\u91cf\u548c2\u4e2a\u64cd\u4f5c\u6570\u503c\u3002</p> <p>\u5f53\u7a7a\u6808\u538b\u5165\u4e00\u4e2a\u5e27\u65f6\uff0c\u5176\u5c40\u90e8\u53d8\u91cf\u8868\u4f1a\u88ab\u521d\u59cb\u5316\u538b\u5165\u76ee\u6807\u5bf9\u8c61\u5b9e\u4f8b<code>this</code>\uff08\u5bf9\u4e8e\u975e\u9759\u6001\u65b9\u6cd5\uff09\u548c\u65b9\u6cd5\u53c2\u6570\u53d8\u91cf\u3002\u6bd4\u5982\uff0c\u8c03\u7528<code>a.equals(b)</code>\u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u5e27\uff0c\u5176\u5c40\u90e8\u53d8\u91cf\u8868\u521d\u59cb\u5316\u67092\u4e2a\u5c40\u90e8\u53d8\u91cf<code>a</code>\u548c<code>b</code>\uff08\u5176\u4ed6\u53d8\u91cf\u4e3a\u88ab\u521d\u59cb\u5316\uff09\u3002</p> <ul> <li>\u5b57\u8282\u7801\u6307\u4ee4    \u53c2\u8003 Jvm\u7cfb\u52172\u2014\u5b57\u8282\u7801\u6307\u4ee4    \u5728\u57fa\u4e8e\u5806\u6808\u7684\u7684\u865a\u62df\u673a\u4e2d\uff0c\u6307\u4ee4\u7684\u4e3b\u6218\u573a\u4fbf\u662f\u64cd\u4f5c\u6570\u6808\uff0c\u9664\u4e86load\u662f\u4ece\u5c40\u90e8\u53d8\u91cf\u8868\u52a0\u8f7d\u6570\u636e\u5230\u64cd\u4f5c\u6570\u6808\u4ee5\u53castore\u50a8\u5b58\u6570\u636e\u5230\u5c40\u90e8\u53d8\u91cf\u8868\uff0c\u5176\u4f59\u6307\u4ee4\u57fa\u672c\u90fd\u662f\u7528\u4e8e\u64cd\u4f5c\u6570\u6808\u7684\u3002</li> <li>\u793a\u4f8b</li> </ul> <pre><code>package pkg;\npublic class Bean {\nprivate int f;\npublic int getF() {\nreturn this.f;\n}\npublic void setF(int f) {\nthis.f = f;\n}\n}\n</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u7684<code>getF</code>\u65b9\u6cd5\u7684\u5b57\u8282\u7801\u5982\u4e0b\uff1a</p> <pre><code>ALOAD 0\nGETFIELD pkg/Bean f I\nIRETURN\n</code></pre> <p>\u7b2c\u4e00\u6761\u6307\u4ee4\u8bfb\u53d6\u5c40\u90e8\u53d8\u91cf\u8868\u7d22\u5f150\u7684\u5c40\u90e8\u53d8\u91cf<code>this</code>\uff0c\u5e76\u5c06\u503c\u538b\u5165\u5230\u64cd\u4f5c\u6570\u6808\u4e2d\u3002\u7b2c\u4e8c\u6761\u6307\u4ee4\u5148\u83b7\u53d6\u64cd\u4f5c\u6570\u6808\u6808\u9876\u503c<code>this</code>(\u5f39\u51fa\u6808\uff09\uff0c\u83b7\u53d6\u8be5\u5b9e\u4f8b\u7c7b\u6210\u5458<code>f</code>\uff0c\u5e76\u5c06\u5176\u538b\u5165\u6808\u4e2d\u3002\u6700\u540e\u4e00\u6761\u6307\u4ee4\u5c06\u64cd\u4f5c\u6570\u6808\u5f39\u51fa\uff0c\u5c06\u503c\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\u56fe3.2 \u6240\u793a\uff1a</p> <p></p> <p>\u4e0a\u9762\u4ee3\u7801\u7684<code>setF(int f)</code>\u65b9\u6cd5\u7684\u5b57\u8282\u7801\u5982\u4e0b\uff1a</p> <pre><code>ALOAD 0\nILOAD 1\nPUTFIELD pkg/Bean f I\nRETURN\n</code></pre> <p>\u7b2c\u4e00\u6761\u6307\u4ee4\u5c06\u5c40\u90e8\u53d8\u91cf\u8868\u7d22\u5f150\u7684\u53d8\u91cf<code>this</code>\u538b\u5165\u5230\u64cd\u4f5c\u6570\u6808\uff1b\u7b2c\u4e8c\u6761\u6307\u4ee4\u5c06\u5c40\u90e8\u53d8\u91cf\u8868\u7d22\u5f151\u7684\u53d8\u91cf<code>f</code>\u538b\u5165\u5230\u64cd\u4f5c\u6570\u6808\uff1b\u7b2c\u4e09\u6761\u6307\u4ee4\u5f39\u51fa\u8fd9\u4e2a\u503c\uff0c\u5e76\u4e14\u5c06\u4e00\u4e2a<code>int</code>\u503c\u4ed8\u7ed9<code>this.f</code>\uff1b\u6700\u540e\u4e00\u6761\u6307\u4ee4\u5c06\u5f53\u524d\u6808\u5e27\u9500\u6bc1\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\u56fe3.3 \u6240\u793a\uff1a</p> <p></p>"},{"location":"front-end/android/system/ASM-Core-Api/#annotationvisitor","title":"AnnotationVisitor","text":"<p><code>AnnotationVisitor</code> api \u8bbf\u95ee\u65f6\u5e8f\u5982\u4e0b\uff1a</p> <p>( visit | visitEnum | visitAnnotation | visitArray )* visitEnd</p>"},{"location":"front-end/android/system/ASM-Core-Api/#type","title":"Type","text":"<p>Type</p> <p><code>Type</code>\u5bf9\u5e94\u7684\u662f Java \u7c7b\u578b\uff0c\u8be5\u7c7b\u63d0\u4f9b\u4e00\u4e9b\u65b9\u6cd5\u65b9\u4fbf\u6211\u4eec\u64cd\u63a7 Java \u7c7b\u578b\u548c\u63cf\u8ff0\u7b26\u8f6c\u6362\u3002  \u6bd4\u5982\uff1a</p> <ul> <li><code>Type.INT_TYPE</code>\u8868\u793a\u4e00\u4e2a<code>int</code>\u7c7b\u578b\u7684<code>Type</code>\u5b9e\u4f8b\u3002</li> <li>Class -&gt; Type\uff1a<code>Type.getType(String.class)</code>\u4f1a\u8fd4\u56de<code>String</code>\u5bf9\u5e94\u7684<code>Type</code>\u7c7b\u578b\u3002</li> <li>Descriptor -&gt; Type\uff1a<code>Type.getType(\"Ljava/lang/String;)</code>\u4f1a\u8fd4\u56de\u7c7b\u578b\u63cf\u8ff0\u7b26\u5bf9\u5e94\u7684<code>Type</code>\u7c7b\u578b\u3002</li> <li>InternalName -&gt; Type\uff1a<code>Type.getObjectType(\"java/lang/String\")</code>\u4f1a\u8fd4\u56de\u53c2\u6570 InternalName \u5bf9\u5e94\u7684<code>Type</code>\u7c7b\u578b\u3002</li> <li>Type -&gt; ClassName\uff1a<code>Type.getType(String.class).getClassName()</code>\u4f1a\u8fd4\u56de<code>java.lang.String</code>\u3002</li> <li>Type -&gt; InternalName\uff1a<code>Type.getType(String.class).getInternalName()</code>\u4f1a\u8fd4\u56de<code>String.class</code>\u7684 InternalName\uff0c\u5373<code>java/lang/String</code>\uff0c\u8be5\u65b9\u6cd5\u53ea\u9002\u7528\u4e8e<code>class</code>\u7c7b\u578b\u6216\u8005<code>interface</code>\u7c7b\u578b\u3002</li> <li>Type -&gt; Descriptor\uff1a<code>Type.getType(String.class).getDescriptor()</code>\u4f1a\u8fd4\u56de<code>String.class</code>\u7684 Descriptor\uff0c\u5373<code>Ljava/lang/String;</code></li> <li>MethodDescriptor -&gt; ArgumentType\uff1a<code>Type.getArgumentTypes(\"(I)V\")</code>\u4f1a\u8fd4\u56de\u65b9\u6cd5\u63cf\u8ff0\u7b26\u5bf9\u5e94\u7684\u53c2\u6570<code>Type[]</code>\u6570\u7ec4\uff0c\u6bd4\u5982\u6b64\u5904\u8fd4\u56de\u7684\u662f<code>{Type.INT_TYPE}</code>\u3002</li> <li>MethodDescriptor -&gt; ReturnType\uff1a<code>Type.getReturnType(\"(I)V\")</code>\u4f1a\u8fd4\u56de\u65b9\u6cd5\u63cf\u8ff0\u7b26\u5bf9\u5e94\u7684\u51fd\u6570\u8fd4\u56de\u503c<code>Type</code>\u7c7b\u578b\uff0c\u6bd4\u5982\u6b64\u5904\u8fd4\u56de\u7684\u662f<code>Type.VOID_TYPE</code>\u3002</li> </ul>"},{"location":"front-end/android/system/ASM-Core-Api/#notice","title":"Notice","text":"<ol> <li>\u901a\u5e38\u6211\u4eec\u7ed1\u5b9a<code>ClassVisitor</code>\u5230<code>ClassReader</code>\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</li> </ol> <pre><code>byte[] b1 = ...; ClassWriter cw = new ClassWriter(0); // cv forwards all events to cw \nClassVisitor cv = new ClassVisitor(ASM4, cw) { }; ClassReader cr = new ClassReader(b1); cr.accept(cv, 0);\nbyte[] b2 = cw.toByteArray(); // b2 represents the same class as b1 \n</code></pre> <p>\u5047\u8bbe\u6211\u4eec\u5e76\u4e0d\u60f3\u505a\u51fa\u6539\u52a8\u7c7b\u672c\u8eab\u884c\u4e3a\uff0c\u90a3\u4e48\u6309\u7167\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u6548\u7387\u4f1a\u6bd4\u8f83\u4f4e\uff0c\u56e0\u4e3a\u5fc5\u987b\u89e3\u6790\u5b57\u8282\u6570\u7ec4\u5e76\u4e14\u8981\u7ecf\u5386\u4e8b\u4ef6\u5faa\u73af\uff1b\u5982\u679c\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u539f\u672c\u7684\u5b57\u8282\u6570\u7ec4<code>b1</code>\u5230<code>b2</code>\uff0c\u90a3\u4e48\u6548\u7387\u5c06\u5927\u5927\u63d0\u5347\u3002\u5e78\u8fd0\u7684\u662f\uff0cASM \u5df2\u8003\u8651\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u5e76\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4f18\u5316\u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>byte[] b1 = ... ClassReader cr = new ClassReader(b1); ClassWriter cw = new ClassWriter(cr, 0); //pass cr to cw directly\nChangeVersionAdapter ca = new ChangeVersionAdapter(cw); cr.accept(ca, 0);\nbyte[] b2 = cw.toByteArray(); </code></pre> <p>\u539f\u7406\u5982\u4e0b\uff1a</p> <ul> <li>\u5982\u679c<code>ClassReader</code>\u7ec4\u4ef6\u68c0\u6d4b\u5230\u4f5c\u4e3a\u5176<code>accept</code>\u53c2\u6570\u7684<code>ClassVisitor</code>\u8fd4\u56de\u7684<code>MethodVisitor</code>\u662f\u6765\u81ea<code>ClassWriter</code>\u7684\uff0c\u8fd9\u8868\u660e\u8be5\u65b9\u6cd5\u6ca1\u6709\u88ab\u6539\u52a8\uff0c\u4e8b\u5b9e\u4e0a\u751a\u81f3\u4e0d\u4f1a\u88ab\u7a0b\u5e8f\u611f\u77e5\u3002</li> <li>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c<code>ClassReader</code>\u7ec4\u4ef6\u5c31\u4e0d\u53bb\u89e3\u6790\u8be5\u65b9\u6cd5\u5185\u5bb9\uff0c\u5e76\u4e14\u4e0d\u4f1a\u4ea7\u751f\u76f8\u5e94\u4e8b\u4ef6\uff0c\u53ea\u662f\u4ece<code>ClassWriter</code>\u590d\u5236\u8fd9\u90e8\u5206\u65b9\u6cd5\u7684\u5b57\u8282\u7801\u6570\u7ec4\u3002</li> </ul> <p>\u4f7f\u7528\u4f18\u5316\u65b9\u6cd5\uff0c\u6027\u80fd\u4e0a\u6bd4\u524d\u8005\u63d0\u5347\u67092\u500d\u591a\u901f\u5ea6\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u79cd\u4f18\u5316\u65b9\u6cd5\u9700\u8981\u590d\u5236\u7c7b\u4e2d\u6240\u6709\u5e38\u91cf\u5230\u65b0\u7684\u5b57\u8282\u6570\u7ec4\u4e2d\uff0c\u8fd9\u79cd\u4f18\u5316\u5bf9\u4e8e\u589e\u52a0\u6210\u5458\uff0c\u65b9\u6cd5\u548c\u6307\u4ee4\u6765\u8bf4\uff0c\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e\u5220\u9664\u6216\u8005\u66f4\u6539\u7c7b\u5143\u7d20\u540d\u79f0\u6765\u8bf4\uff0c\u4f1a\u5927\u5927\u589e\u52a0\u7c7b\u6587\u4ef6\u5927\u5c0f\uff0c\u56e0\u6b64\uff0c\u5efa\u8bae\u5bf9\u4e8e \u589e\u52a0 \u52a8\u4f5c\u7684\u8f6c\u6362\u4f7f\u7528\u4f18\u5316\u65b9\u6cd5\u3002</p>"},{"location":"front-end/android/system/ASM-Core-Api/#_2","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://www.jianshu.com/p/abd1b1b8d3f3</p>"},{"location":"front-end/android/system/android-transform/","title":"Android Transform","text":""},{"location":"front-end/android/system/android-transform/#11-transform","title":"1.1 \u4ec0\u4e48\u662f Transform\uff1f","text":"<p>Transform API \u662f Android Gradle Plugin 1.5 \u5c31\u5f15\u5165\u7684\u7279\u6027\uff0c\u4e3b\u8981\u7528\u4e8e\u5728 Android \u6784\u5efa\u8fc7\u7a0b\u4e2d\uff0c\u5728 Class\u2192Dex \u8fd9\u4e2a\u8282\u70b9\u4fee\u6539 Class \u5b57\u8282\u7801\u3002\u5229\u7528 Transform API\uff0c\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u6240\u6709\u53c2\u4e0e\u6784\u5efa\u7684 Class \u6587\u4ef6\uff0c\u501f\u52a9 Javassist \u6216 ASM \u7b49\u5b57\u8282\u7801\u7f16\u8f91\u5de5\u5177\u8fdb\u884c\u4fee\u6539\uff0c\u63d2\u5165\u81ea\u5b9a\u4e49\u903b\u8f91\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u903b\u8f91\u662f\u4e0e\u4e1a\u52a1\u903b\u8f91\u65e0\u5173\u7684\u3002</p> <p>\u4f7f\u7528 Transform \u7684\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\u6709\uff1a</p> <ul> <li>\u57cb\u70b9\u7edf\u8ba1\uff1a \u5728\u9875\u9762\u5c55\u73b0\u548c\u9000\u51fa\u7b49\u751f\u547d\u5468\u671f\u4e2d\u63d2\u5165\u57cb\u70b9\u7edf\u8ba1\u4ee3\u7801\uff0c\u4ee5\u7edf\u8ba1\u9875\u9762\u5c55\u73b0\u6570\u636e\uff1b</li> <li>\u8017\u65f6\u76d1\u63a7\uff1a \u5728\u6307\u5b9a\u65b9\u6cd5\u7684\u524d\u540e\u63d2\u5165\u8017\u65f6\u8ba1\u7b97\uff0c\u4ee5\u89c2\u5bdf\u65b9\u6cd5\u6267\u884c\u65f6\u95f4\uff1b</li> <li>\u65b9\u6cd5\u66ff\u6362\uff1a \u5c06\u65b9\u6cd5\u8c03\u7528\u66ff\u6362\u4e3a\u8c03\u7528\u53e6\u4e00\u4e2a\u65b9\u6cd5\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u81ea\u5b9a\u4e49\u63d2\u4ef6\u4e2d\u6ce8\u518c\u4e00\u4e2a\u81ea\u5b9a\u4e49Transform</p> <pre><code>public class CustomPlugin implements Plugin&lt;Project&gt; {\n(\"NullableProblems\")\npublic void apply(Project project) {\nAppExtension appExtension = (AppExtension)project.getProperties().get(\"android\");\nappExtension.registerTransform(new CustomTransform(), Collections.EMPTY_LIST);\n}\n}\n</code></pre>"},{"location":"front-end/android/system/android-transform/#12-transform","title":"1.2 Transform\u7684\u539f\u7406\u4e0e\u5e94\u7528","text":"<p>\u4ecb\u7ecd\u5982\u4f55\u5e94\u7528Transform\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u4ecb\u7ecdTransform\u7684\u539f\u7406\uff0c\u4e00\u56fe\u80dc\u5343\u8a00 </p> <p>\u6bcf\u4e2aTransform\u5176\u5b9e\u90fd\u662f\u4e00\u4e2agradle task\uff0cAndroid\u7f16\u8bd1\u5668\u4e2d\u7684TaskManager\u5c06\u6bcf\u4e2aTransform\u4e32\u8fde\u8d77\u6765\uff0c\u7b2c\u4e00\u4e2aTransform\u63a5\u6536\u6765\u81eajavac\u7f16\u8bd1\u7684\u7ed3\u679c\uff0c\u4ee5\u53ca\u5df2\u7ecf\u62c9\u53d6\u5230\u5728\u672c\u5730\u7684\u7b2c\u4e09\u65b9\u4f9d\u8d56\uff08jar. aar\uff09\uff0c\u8fd8\u6709resource\u8d44\u6e90\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684resource\u5e76\u975eandroid\u9879\u76ee\u4e2d\u7684res\u8d44\u6e90\uff0c\u800c\u662fasset\u76ee\u5f55\u4e0b\u7684\u8d44\u6e90\u3002\u8fd9\u4e9b\u7f16\u8bd1\u7684\u4e2d\u95f4\u4ea7\u7269\uff0c\u5728Transform\u7ec4\u6210\u7684\u94fe\u6761\u4e0a\u6d41\u52a8\uff0c\u6bcf\u4e2aTransform\u8282\u70b9\u53ef\u4ee5\u5bf9class\u8fdb\u884c\u5904\u7406\u518d\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2aTransform\u3002\u6211\u4eec\u5e38\u89c1\u7684\u6df7\u6dc6\uff0cDesugar\u7b49\u903b\u8f91\uff0c\u5b83\u4eec\u7684\u5b9e\u73b0\u5982\u4eca\u90fd\u662f\u5c01\u88c5\u5728\u4e00\u4e2a\u4e2aTransform\u4e2d\uff0c\u800c\u6211\u4eec\u81ea\u5b9a\u4e49\u7684Transform\uff0c\u4f1a\u63d2\u5165\u5230\u8fd9\u4e2aTransform\u94fe\u6761\u7684\u6700\u524d\u9762\u3002</p> <p>\u4f46\u5176\u5b9e\uff0c\u4e0a\u9762\u8fd9\u5e45\u56fe\uff0c\u53ea\u662f\u5c55\u793aTransform\u7684\u5176\u4e2d\u4e00\u79cd\u60c5\u51b5\u3002\u800cTransform\u5176\u5b9e\u53ef\u4ee5\u6709\u4e24\u79cd\u8f93\u5165\uff0c\u4e00\u79cd\u662f\u6d88\u8d39\u578b\u7684\uff0c\u5f53\u524dTransform\u9700\u8981\u5c06\u6d88\u8d39\u578b\u578b\u8f93\u51fa\u7ed9\u4e0b\u4e00\u4e2aTransform\uff0c\u53e6\u4e00\u79cd\u662f\u5f15\u7528\u578b\u7684\uff0c\u5f53\u524dTransform\u53ef\u4ee5\u8bfb\u53d6\u8fd9\u4e9b\u8f93\u5165\uff0c\u800c\u4e0d\u9700\u8981\u8f93\u51fa\u7ed9\u4e0b\u4e00\u4e2aTransform\uff0c\u6bd4\u5982Instant Run\u5c31\u662f\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u68c0\u67e5\u4e24\u6b21\u7f16\u8bd1\u4e4b\u95f4\u7684diff\u7684\u3002\u81f3\u4e8e\u600e\u4e48\u5728\u4e00\u4e2aTransform\u4e2d\u58f0\u660e\u4e24\u79cd\u8f93\u5165\uff0c\u4ee5\u53ca\u600e\u4e48\u5904\u7406\u4e24\u79cd\u8f93\u5165\uff0c\u540e\u9762\u5c06\u6709\u793a\u4f8b\u4ee3\u7801\u3002</p> <p>\u4e3a\u4e86\u5370\u8bc1Transform\u7684\u5de5\u4f5c\u539f\u7406\u548c\u5e94\u7528\u65b9\u5f0f\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4eceAndroid gradle plugin\u6e90\u7801\u5165\u624b\u627e\u51fa\u8bc1\u636e\uff0c\u5728TaskManager\u4e2d\uff0c\u6709\u4e00\u4e2a\u65b9\u6cd5<code>createPostCompilationTasks</code>.\u4e3a\u4e86\u907f\u514d\u8d34\u7bc7\u5e45\u592a\u957f\u7684\u6e90\u7801\uff0c\u8fd9\u91cc\u9644\u4e0a\u94fe\u63a5</p> <p>TaskManager#createPostCompilationTasks</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u7684\u8109\u7edc\u5f88\u6e05\u6670\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0cJacoco\uff0cDesugar\uff0cMergeJavaRes\uff0cAdvancedProfiling\uff0cShrinker\uff0cProguard, JarMergeTransform, MultiDex, Dex\u90fd\u662f\u901a\u8fc7Transform\u7684\u5f62\u5f0f\u4e00\u4e2a\u4e2a\u4e32\u8054\u8d77\u6765\u3002\u5176\u4e2d\u4e5f\u6709\u5c06\u6211\u4eec\u81ea\u5b9a\u4e49\u7684Transform\u63d2\u8fdb\u53bb\u3002</p> <p>\u8bb2\u5b8c\u4e86Transform\u7684\u6570\u636e\u6d41\u52a8\u7684\u539f\u7406\uff0c\u6211\u4eec\u518d\u6765\u4ecb\u7ecd\u4e00\u4e0bTransform\u7684\u8f93\u5165\u6570\u636e\u7684\u8fc7\u6ee4\u673a\u5236\uff0cTransform\u7684\u6570\u636e\u8f93\u5165\uff0c\u53ef\u4ee5\u901a\u8fc7Scope\u548cContentType\u4e24\u4e2a\u7ef4\u5ea6\u8fdb\u884c\u8fc7\u6ee4\u3002</p> <p></p> <p>ContentType\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u6570\u636e\u7c7b\u578b\uff0c\u5728\u63d2\u4ef6\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4e00\u822c\u53ea\u80fd\u4f7f\u7528CLASSES\u548cRESOURCES\u4e24\u79cd\u7c7b\u578b\uff0c\u6ce8\u610f\uff0c\u5176\u4e2d\u7684CLASSES\u5df2\u7ecf\u5305\u542b\u4e86class\u6587\u4ef6\u548cjar\u6587\u4ef6</p> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u9664\u4e86CLASSES\u548cRESOURCES\uff0c\u8fd8\u6709\u4e00\u4e9b\u6211\u4eec\u5f00\u53d1\u8fc7\u7a0b\u65e0\u6cd5\u4f7f\u7528\u7684\u7c7b\u578b\uff0c\u6bd4\u5982DEX\u6587\u4ef6\uff0c\u8fd9\u4e9b\u9690\u85cf\u7c7b\u578b\u5728\u4e00\u4e2a\u72ec\u7acb\u7684\u679a\u4e3e\u7c7bExtendedContentType\u4e2d\uff0c\u8fd9\u4e9b\u7c7b\u578b\u53ea\u80fd\u7ed9Android\u7f16\u8bd1\u5668\u4f7f\u7528\u3002\u53e6\u5916\uff0c\u6211\u4eec\u4e00\u822c\u4f7f\u7528TransformManager\u4e2d\u63d0\u4f9b\u7684\u51e0\u4e2a\u5e38\u7528\u7684ContentType\u96c6\u5408\u548cScope\u96c6\u5408\uff0c\u5982\u679c\u662f\u8981\u5904\u7406\u6240\u6709class\u548cjar\u7684\u5b57\u8282\u7801\uff0cContentType\u6211\u4eec\u4e00\u822c\u4f7f\u7528TransformManager.CONTENT_CLASS\u3002</p> <p>Scope\u76f8\u6bd4ContentType\u5219\u662f\u53e6\u4e00\u4e2a\u7ef4\u5ea6\u7684\u8fc7\u6ee4\u89c4\u5219\uff0c</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5de6\u8fb9\u51e0\u4e2a\u7c7b\u578b\u53ef\u4f9b\u6211\u4eec\u4f7f\u7528\uff0c\u800c\u6211\u4eec\u4e00\u822c\u90fd\u662f\u7ec4\u5408\u4f7f\u7528\u8fd9\u51e0\u4e2a\u7c7b\u578b\uff0cTransformManager\u6709\u51e0\u4e2a\u5e38\u7528\u7684Scope\u96c6\u5408\u65b9\u4fbf\u5f00\u53d1\u8005\u4f7f\u7528\u3002 \u5982\u679c\u662f\u8981\u5904\u7406\u6240\u6709class\u5b57\u8282\u7801\uff0cScope\u6211\u4eec\u4e00\u822c\u4f7f\u7528TransformManager.SCOPE_FULL_PROJECT\u3002</p> <p>\u597d\uff0c\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86Transform\u7684\u6570\u636e\u6d41\u52a8\u7684\u539f\u7406\uff0c\u8f93\u5165\u7684\u7c7b\u578b\u548c\u8fc7\u6ee4\u673a\u5236\uff0c\u6211\u4eec\u518d\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u81ea\u5b9a\u4e49Transform\uff0c\u8ba9\u6211\u4eec\u5bf9Transform\u53ef\u4ee5\u6709\u4e00\u4e2a\u66f4\u5177\u4f53\u7684\u8ba4\u8bc6</p> <pre><code>public class CustomTransform extends Transform {\npublic static final String TAG = \"CustomTransform\";\npublic CustomTransform() {\nsuper();\n}\n@Override\npublic String getName() {\nreturn \"CustomTransform\";\n}\n@Override\npublic void transform(TransformInvocation transformInvocation) throws TransformException, InterruptedException, IOException {\nsuper.transform(transformInvocation);\n//\u5f53\u524d\u662f\u5426\u662f\u589e\u91cf\u7f16\u8bd1\nboolean isIncremental = transformInvocation.isIncremental();\n//\u6d88\u8d39\u578b\u8f93\u5165\uff0c\u53ef\u4ee5\u4ece\u4e2d\u83b7\u53d6jar\u5305\u548cclass\u6587\u4ef6\u5939\u8def\u5f84\u3002\u9700\u8981\u8f93\u51fa\u7ed9\u4e0b\u4e00\u4e2a\u4efb\u52a1\nCollection&lt;TransformInput&gt; inputs = transformInvocation.getInputs();\n//\u5f15\u7528\u578b\u8f93\u5165\uff0c\u65e0\u9700\u8f93\u51fa\u3002\nCollection&lt;TransformInput&gt; referencedInputs = transformInvocation.getReferencedInputs();\n//OutputProvider\u7ba1\u7406\u8f93\u51fa\u8def\u5f84\uff0c\u5982\u679c\u6d88\u8d39\u578b\u8f93\u5165\u4e3a\u7a7a\uff0c\u4f60\u4f1a\u53d1\u73b0OutputProvider == null\nTransformOutputProvider outputProvider = transformInvocation.getOutputProvider();\nfor(TransformInput input : inputs) {\nfor(JarInput jarInput : input.getJarInputs()) {\nFile dest = outputProvider.getContentLocation(\njarInput.getFile().getAbsolutePath(),\njarInput.getContentTypes(),\njarInput.getScopes(),\nFormat.JAR);\n//\u5c06\u4fee\u6539\u8fc7\u7684\u5b57\u8282\u7801copy\u5230dest\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7f16\u8bd1\u671f\u95f4\u5e72\u9884\u5b57\u8282\u7801\u7684\u76ee\u7684\u4e86        \nFileUtils.copyFile(jarInput.getFile(), dest);\n}\nfor(DirectoryInput directoryInput : input.getDirectoryInputs()) {\nFile dest = outputProvider.getContentLocation(directoryInput.getName(),\ndirectoryInput.getContentTypes(), directoryInput.getScopes(),\nFormat.DIRECTORY);\n//\u5c06\u4fee\u6539\u8fc7\u7684\u5b57\u8282\u7801copy\u5230dest\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7f16\u8bd1\u671f\u95f4\u5e72\u9884\u5b57\u8282\u7801\u7684\u76ee\u7684\u4e86        \nFileUtils.copyDirectory(directoryInput.getFile(), dest);\n}\n}\n}\n@Override\npublic Set&lt;QualifiedContent.ContentType&gt; getInputTypes() {\nreturn TransformManager.CONTENT_CLASS;\n}\n@Override\npublic Set&lt;? super QualifiedContent.Scope&gt; getScopes() {\nreturn TransformManager.SCOPE_FULL_PROJECT;\n}\n@Override\npublic Set&lt;QualifiedContent.ContentType&gt; getOutputTypes() {\nreturn super.getOutputTypes();\n}\n@Override\npublic Set&lt;? super QualifiedContent.Scope&gt; getReferencedScopes() {\nreturn TransformManager.EMPTY_SCOPES;\n}\n@Override\npublic Map&lt;String, Object&gt; getParameterInputs() {\nreturn super.getParameterInputs();\n}\n@Override\npublic boolean isCacheable() {\nreturn true;\n}\n@Override\npublic boolean isIncremental() {\nreturn true; //\u662f\u5426\u5f00\u542f\u589e\u91cf\u7f16\u8bd1\n}\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728transform\u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u5c06\u6bcf\u4e2ajar\u5305\u548cclass\u6587\u4ef6\u590d\u5236\u5230dest\u8def\u5f84\uff0c\u8fd9\u4e2adest\u8def\u5f84\u5c31\u662f\u4e0b\u4e00\u4e2aTransform\u7684\u8f93\u5165\u6570\u636e\uff0c\u800c\u5728\u590d\u5236\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u4e00\u4e9b\u72f8\u732b\u6362\u592a\u5b50\uff0c\u5077\u5929\u6362\u65e5\u7684\u4e8b\u60c5\u4e86\uff0c\u5148\u5c06jar\u5305\u548cclass\u6587\u4ef6\u7684\u5b57\u8282\u7801\u505a\u4e00\u4e9b\u4fee\u6539\uff0c\u518d\u8fdb\u884c\u590d\u5236\u5373\u53ef\uff0c\u81f3\u4e8e\u600e\u4e48\u4fee\u6539\u5b57\u8282\u7801\uff0c\u5c31\u8981\u501f\u52a9\u6211\u4eec\u540e\u9762\u4ecb\u7ecd\u7684ASM\u4e86\u3002\u800c\u5982\u679c\u5f00\u53d1\u8fc7\u7a0b\u8981\u770b\u4f60\u5f53\u524dtransform\u5904\u7406\u4e4b\u540e\u7684class/jar\u5305\uff0c\u53ef\u4ee5\u5230 /build/intermediates/transforms/CustomTransform/\u4e0b\u67e5\u770b\uff0c\u4f60\u4f1a\u53d1\u73b0\u6240\u6709jar\u5305\u547d\u540d\u90fd\u662f123456\u9012\u589e\uff0c\u8fd9\u662f\u6b63\u5e38\u7684\uff0c\u8fd9\u91cc\u7684\u547d\u540d\u89c4\u5219\u53ef\u4ee5\u5728OutputProvider.getContentLocation\u7684\u5177\u4f53\u5b9e\u73b0\u4e2d\u627e\u5230</p> <pre><code>public synchronized File getContentLocation(\n@NonNull String name,\n@NonNull Set&lt;ContentType&gt; types,\n@NonNull Set&lt;? super Scope&gt; scopes,\n@NonNull Format format) {\n// runtime check these since it's (indirectly) called by 3rd party transforms.\ncheckNotNull(name);\ncheckNotNull(types);\ncheckNotNull(scopes);\ncheckNotNull(format);\ncheckState(!name.isEmpty());\ncheckState(!types.isEmpty());\ncheckState(!scopes.isEmpty());\n// search for an existing matching substream.\nfor (SubStream subStream : subStreams) {\n// look for an existing match. This means same name, types, scopes, and format.\nif (name.equals(subStream.getName())\n&amp;&amp; types.equals(subStream.getTypes())\n&amp;&amp; scopes.equals(subStream.getScopes())\n&amp;&amp; format == subStream.getFormat()) {\nreturn new File(rootFolder, subStream.getFilename());\n}\n}\n//\u6309\u4f4d\u7f6e\u9012\u589e\uff01\uff01   \n// didn't find a matching output. create the new output\nSubStream newSubStream = new SubStream(name, nextIndex++, scopes, types, format, true);\nsubStreams.add(newSubStream);\nreturn new File(rootFolder, newSubStream.getFilename());\n}\n</code></pre>"},{"location":"front-end/android/system/android-transform/#13-transform","title":"1.3 Transform\u7684\u4f18\u5316\uff1a\u589e\u91cf\u4e0e\u5e76\u53d1","text":"<p>\u5230\u6b64\u4e3a\u6b62\uff0c\u770b\u8d77\u6765Transform\u7528\u8d77\u6765\u4e5f\u4e0d\u96be\uff0c\u4f46\u662f\uff0c\u5982\u679c\u76f4\u63a5\u8fd9\u6837\u4f7f\u7528\uff0c\u4f1a\u5927\u5927\u62d6\u6162\u7f16\u8bd1\u65f6\u95f4\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6478\u7d22\u4e86\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u4e5f\u501f\u9274\u4e86Android\u7f16\u8bd1\u5668\u4e2dDesugar\u7b49\u51e0\u4e2aTransform\u7684\u5b9e\u73b0\uff0c\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u589e\u91cf\u7f16\u8bd1\uff0c\u5e76\u4e14\u4e0a\u9762transform\u65b9\u6cd5\u904d\u5386\u5904\u7406\u6bcf\u4e2ajar/class\u7684\u6d41\u7a0b\uff0c\u5176\u5b9e\u53ef\u4ee5\u5e76\u53d1\u5904\u7406\uff0c\u52a0\u4e0a\u4e00\u822c\u7f16\u8bd1\u6d41\u7a0b\u90fd\u662f\u5728PC\u4e0a\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c3d\u91cf\u6572\u8bc8\u673a\u5668\u7684\u8d44\u6e90\u3002</p> <p>\u60f3\u8981\u5f00\u542f\u589e\u91cf\u7f16\u8bd1\uff0c\u6211\u4eec\u9700\u8981\u91cd\u5199Transform\u7684\u8fd9\u4e2a\u63a5\u53e3\uff0c\u8fd4\u56detrue\u3002</p> <pre><code>@Override\npublic boolean isIncremental() {\nreturn true;\n}\n</code></pre> <p>\u867d\u7136\u5f00\u542f\u4e86\u589e\u91cf\u7f16\u8bd1\uff0c\u4f46\u4e5f\u5e76\u975e\u6bcf\u6b21\u7f16\u8bd1\u8fc7\u7a0b\u90fd\u662f\u652f\u6301\u589e\u91cf\u7684\uff0c\u6bd5\u7adf\u4e00\u6b21clean build\u5b8c\u5168\u6ca1\u6709\u589e\u91cf\u7684\u57fa\u7840\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u68c0\u67e5\u5f53\u524d\u7f16\u8bd1\u662f\u5426\u662f\u589e\u91cf\u7f16\u8bd1\u3002</p> <p>\u5982\u679c\u4e0d\u662f\u589e\u91cf\u7f16\u8bd1\uff0c\u5219\u6e05\u7a7aoutput\u76ee\u5f55\uff0c\u7136\u540e\u6309\u7167\u524d\u9762\u7684\u65b9\u5f0f\uff0c\u9010\u4e2aclass/jar\u5904\u7406 \u5982\u679c\u662f\u589e\u91cf\u7f16\u8bd1\uff0c\u5219\u8981\u68c0\u67e5\u6bcf\u4e2a\u6587\u4ef6\u7684Status\uff0cStatus\u5206\u56db\u79cd\uff0c\u5e76\u4e14\u5bf9\u8fd9\u56db\u79cd\u6587\u4ef6\u7684\u64cd\u4f5c\u4e5f\u4e0d\u5c3d\u76f8\u540c</p> <p></p> <ul> <li>NOTCHANGED: \u5f53\u524d\u6587\u4ef6\u4e0d\u9700\u5904\u7406\uff0c\u751a\u81f3\u590d\u5236\u64cd\u4f5c\u90fd\u4e0d\u7528\uff1b</li> <li>ADDED\u3001CHANGED: \u6b63\u5e38\u5904\u7406\uff0c\u8f93\u51fa\u7ed9\u4e0b\u4e00\u4e2a\u4efb\u52a1\uff1b</li> <li>REMOVED: \u79fb\u9664outputProvider\u83b7\u53d6\u8def\u5f84\u5bf9\u5e94\u7684\u6587\u4ef6\u3002</li> </ul> <p>\u5927\u6982\u5b9e\u73b0\u53ef\u4ee5\u4e00\u8d77\u770b\u770b\u4e0b\u9762\u7684\u4ee3\u7801</p> <pre><code>@Override\npublic void transform(TransformInvocation transformInvocation){\nCollection&lt;TransformInput&gt; inputs = transformInvocation.getInputs();\nTransformOutputProvider outputProvider = transformInvocation.getOutputProvider();\nboolean isIncremental = transformInvocation.isIncremental();\n//\u5982\u679c\u975e\u589e\u91cf\uff0c\u5219\u6e05\u7a7a\u65e7\u7684\u8f93\u51fa\u5185\u5bb9\nif(!isIncremental) {\noutputProvider.deleteAll();\n}   for(TransformInput input : inputs) {\nfor(JarInput jarInput : input.getJarInputs()) {\nStatus status = jarInput.getStatus();\nFile dest = outputProvider.getContentLocation(\njarInput.getName(),\njarInput.getContentTypes(),\njarInput.getScopes(),\nFormat.JAR);\nif(isIncremental &amp;&amp; !emptyRun) {\nswitch(status) {\ncase NOTCHANGED:\nbreak;\ncase ADDED:\ncase CHANGED:\ntransformJar(jarInput.getFile(), dest, status);\nbreak;\ncase REMOVED:\nif (dest.exists()) {\nFileUtils.forceDelete(dest);\n}\nbreak;\n}\n} else {\ntransformJar(jarInput.getFile(), dest, status);\n}\n}\nfor(DirectoryInput directoryInput : input.getDirectoryInputs()) {\nFile dest = outputProvider.getContentLocation(directoryInput.getName(),\ndirectoryInput.getContentTypes(), directoryInput.getScopes(),\nFormat.DIRECTORY);\nFileUtils.forceMkdir(dest);\nif(isIncremental &amp;&amp; !emptyRun) {\nString srcDirPath = directoryInput.getFile().getAbsolutePath();\nString destDirPath = dest.getAbsolutePath();\nMap&lt;File, Status&gt; fileStatusMap = directoryInput.getChangedFiles();\nfor (Map.Entry&lt;File, Status&gt; changedFile : fileStatusMap.entrySet()) {\nStatus status = changedFile.getValue();\nFile inputFile = changedFile.getKey();\nString destFilePath = inputFile.getAbsolutePath().replace(srcDirPath, destDirPath);\nFile destFile = new File(destFilePath);\nswitch (status) {\ncase NOTCHANGED:\nbreak;\ncase REMOVED:\nif(destFile.exists()) {\nFileUtils.forceDelete(destFile);\n}\nbreak;\ncase ADDED:\ncase CHANGED:\nFileUtils.touch(destFile);\ntransformSingleFile(inputFile, destFile, srcDirPath);\nbreak;\n}\n}\n} else {\ntransformDir(directoryInput.getFile(), dest);\n}\n}\n}\n}\n</code></pre> <p>\u8fd9\u5c31\u80fd\u4e3a\u6211\u4eec\u7684\u7f16\u8bd1\u63d2\u4ef6\u63d0\u4f9b\u589e\u91cf\u7684\u7279\u6027\u3002</p> <p>\u5b9e\u73b0\u4e86\u589e\u91cf\u7f16\u8bd1\u540e\uff0c\u6211\u4eec\u6700\u597d\u4e5f\u652f\u6301\u5e76\u53d1\u7f16\u8bd1\uff0c\u5e76\u53d1\u7f16\u8bd1\u7684\u5b9e\u73b0\u5e76\u4e0d\u590d\u6742\uff0c\u53ea\u9700\u8981\u5c06\u4e0a\u9762\u5904\u7406\u5355\u4e2ajar/class\u7684\u903b\u8f91\uff0c\u5e76\u53d1\u5904\u7406\uff0c\u6700\u540e\u963b\u585e\u7b49\u5f85\u6240\u6709\u4efb\u52a1\u7ed3\u675f\u5373\u53ef\u3002</p> <pre><code>private WaitableExecutor waitableExecutor = WaitableExecutor.useGlobalSharedThreadPool();\n//\u5f02\u6b65\u5e76\u53d1\u5904\u7406jar/class\nwaitableExecutor.execute(() -&gt; {\nbytecodeWeaver.weaveJar(srcJar, destJar);\nreturn null;\n});\nwaitableExecutor.execute(() -&gt; {\nbytecodeWeaver.weaveSingleClassToFile(file, outputFile, inputDirPath);\nreturn null;\n});  //\u7b49\u5f85\u6240\u6709\u4efb\u52a1\u7ed3\u675f\nwaitableExecutor.waitForTasksWithQuickFail(true);\n</code></pre>"},{"location":"front-end/android/system/android-transform/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea http://quinnchen.cn/2018/09/13/2018-09-13-asm-transform/</p>"},{"location":"front-end/android/system/asm-basic/","title":"ASM \u7b80\u4ecb","text":""},{"location":"front-end/android/system/asm-basic/#1-asm","title":"1. ASM \u7b80\u4ecb","text":"<p>ASM \u662f\u4e00\u4e2a Java \u5b57\u8282\u7801\u64cd\u63a7\u6846\u67b6\u3002\u5b83\u80fd\u88ab\u7528\u6765\u52a8\u6001\u751f\u6210\u7c7b\u6216\u8005\u589e\u5f3a\u65e2\u6709\u7c7b\u7684\u529f\u80fd\u3002ASM \u53ef\u4ee5\u76f4\u63a5\u4ea7\u751f\u4e8c\u8fdb\u5236 class \u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u5728\u7c7b\u88ab\u52a0\u8f7d\u5165 Java \u865a\u62df\u673a\u4e4b\u524d\u52a8\u6001\u6539\u53d8\u7c7b\u884c\u4e3a\u3002Java class \u88ab\u5b58\u50a8\u5728\u4e25\u683c\u683c\u5f0f\u5b9a\u4e49\u7684 .class \u6587\u4ef6\u91cc\uff0c\u8fd9\u4e9b\u7c7b\u6587\u4ef6\u62e5\u6709\u8db3\u591f\u7684\u5143\u6570\u636e\u6765\u89e3\u6790\u7c7b\u4e2d\u7684\u6240\u6709\u5143\u7d20\uff1a\u7c7b\u540d\u79f0\u3001\u65b9\u6cd5\u3001\u5c5e\u6027\u4ee5\u53ca Java \u5b57\u8282\u7801\uff08\u6307\u4ee4\uff09\u3002ASM \u4ece\u7c7b\u6587\u4ef6\u4e2d\u8bfb\u5165\u4fe1\u606f\u540e\uff0c\u80fd\u591f\u6539\u53d8\u7c7b\u884c\u4e3a\uff0c\u5206\u6790\u7c7b\u4fe1\u606f\uff0c\u751a\u81f3\u80fd\u591f\u6839\u636e\u7528\u6237\u8981\u6c42\u751f\u6210\u65b0\u7c7b\u3002</p> <p>\u7b80\u5355\u7684\u8bf4\uff0cASM \u53ef\u4ee5\u8bfb\u53d6\u89e3\u6790<code>class</code>\u6587\u4ef6\u5185\u5bb9\uff0c\u5e76\u63d0\u4f9b\u63a5\u53e3\u8ba9\u4f60\u53ef\u4ee5\u5bf9<code>class</code>\u6587\u4ef6\u5b57\u8282\u7801\u5185\u5bb9\u8fdb\u884cCRUD\u64cd\u4f5c\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7</p> <p>\u6ce8: <code>class</code>\u6587\u4ef6\u5b58\u50a8\u7684\u662f<code>java</code>\u5b57\u8282\u7801\uff0cASM \u662f\u5bf9<code>java</code>\u5b57\u8282\u7801\u64cd\u4f5c\u7684\u4e00\u5c42\u5c01\u88c5\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u4f60\u5f88\u4e86\u89e3 <code>class</code>\u6587\u4ef6\u683c\u5f0f\u7684\u8bdd\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u4f7f\u7528\u6587\u672c\u7f16\u8f91\u5668\uff08eg:Vim\uff09\u6765\u6539\u5199<code>class</code>\u6587\u4ef6\u3002</p> <p>\u77e5\u9053\u4e86 ASM \u7684\u4f5c\u7528\u540e\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u770b\u4e0b ASM \u7684\u6267\u884c\u6a21\u5f0f\uff0c\u4e86\u89e3\u5b83\u7684\u6267\u884c\u6a21\u5f0f\u540e\uff0c\u6211\u4eec\u624d\u80fd\u66f4\u597d\u5730\u4f7f\u7528\u3002</p>"},{"location":"front-end/android/system/asm-basic/#2-asm","title":"2. ASM \u6846\u67b6\u6267\u884c\u6d41\u7a0b","text":"<p>ASM \u63d0\u4f9b\u4e86\u4e24\u7ec4API\uff1aCore\u548cTree\uff1a</p> <ul> <li>Core\u662f\u57fa\u4e8e\u8bbf\u95ee\u8005\u6a21\u5f0f\u6765\u64cd\u4f5c\u7c7b\u7684</li> <li>Tree\u662f\u57fa\u4e8e\u6811\u8282\u70b9\u6765\u64cd\u4f5c\u7c7b\u7684</li> </ul> <p>\u672c\u6587\u6211\u4eec\u4e3b\u8981\u8ba8\u8bba\u7684\u662f ASM \u7684 CoreAPI\u3002</p> <p>ASM \u5185\u90e8\u91c7\u7528 \u8bbf\u95ee\u8005\u6a21\u5f0f \u5c06 <code>.class</code> \u7c7b\u6587\u4ef6\u7684\u5185\u5bb9\u4ece\u5934\u5230\u5c3e\u626b\u63cf\u4e00\u904d\uff0c\u6bcf\u6b21\u626b\u63cf\u5230\u7c7b\u6587\u4ef6\u76f8\u5e94\u7684\u5185\u5bb9\u65f6\uff0c\u90fd\u4f1a\u8c03\u7528<code>ClassVisitor</code>\u5185\u90e8\u76f8\u5e94\u7684\u65b9\u6cd5\u3002  \u6bd4\u5982\uff1a</p> <ul> <li>\u626b\u63cf\u5230\u7c7b\u6587\u4ef6\u65f6\uff0c\u4f1a\u56de\u8c03<code>ClassVisitor</code>\u7684<code>visit()</code>\u65b9\u6cd5\uff1b</li> <li>\u626b\u63cf\u5230\u7c7b\u6ce8\u89e3\u65f6\uff0c\u4f1a\u56de\u8c03<code>ClassVisitor</code>\u7684<code>visitAnnotation()</code>\u65b9\u6cd5\uff1b</li> <li>\u626b\u63cf\u5230\u7c7b\u6210\u5458\u65f6\uff0c\u4f1a\u56de\u8c03<code>ClassVisitor</code>\u7684<code>visitField()</code>\u65b9\u6cd5\uff1b</li> <li>\u626b\u63cf\u5230\u7c7b\u65b9\u6cd5\u65f6\uff0c\u4f1a\u56de\u8c03<code>ClassVisitor</code>\u7684<code>visitMethod()</code>\u65b9\u6cd5\uff1b    \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7    \u626b\u63cf\u5230\u76f8\u5e94\u7ed3\u6784\u5185\u5bb9\u65f6\uff0c\u4f1a\u56de\u8c03\u76f8\u5e94\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5bf9\u5e94\u7684\u5b57\u8282\u7801\u64cd\u4f5c\u5bf9\u8c61\uff08\u6bd4\u5982\uff0c<code>visitMethod()</code>\u8fd4\u56de<code>MethodVisitor</code>\u5b9e\u4f8b\uff09\uff0c\u901a\u8fc7\u4fee\u6539\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u5c31\u53ef\u4ee5\u4fee\u6539<code>class</code>\u6587\u4ef6\u76f8\u5e94\u7ed3\u6784\u90e8\u5206\u5185\u5bb9\uff0c\u6700\u540e\u5c06\u8fd9\u4e2a<code>ClassVisitor</code>\u5b57\u8282\u7801\u5185\u5bb9\u8986\u76d6\u539f\u6765<code>.class</code>\u6587\u4ef6\u5c31\u5b9e\u73b0\u4e86\u7c7b\u6587\u4ef6\u7684\u4ee3\u7801\u5207\u5165\u3002</li> </ul> <p>\u5177\u4f53\u5173\u7cfb\u5982\u4e0b\uff1a</p> \u6811\u5f62\u5173\u7cfb \u4f7f\u7528\u7684\u63a5\u53e3 Class ClassVisitor Field FieldVisitor Method MethodVisitor Annotation AnnotationVisitor <p>\u6574\u4e2a\u5177\u4f53\u7684\u6267\u884c\u65f6\u5e8f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u65f6\u5e8f\u56fe\u53ef\u4ee5\u770b\u51faASM\u5728\u5904\u7406<code>class</code>\u6587\u4ef6\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002ASM\u901a\u8fc7\u6811\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u6765\u8868\u793a\u590d\u6742\u7684\u5b57\u8282\u7801\u7ed3\u6784\uff0c\u5e76\u5229\u7528 Push\u6a21\u578b \u6765\u5bf9\u6811\u8fdb\u884c\u904d\u5386\u3002</p> <ul> <li>ASM \u4e2d\u63d0\u4f9b\u4e00\u4e2a<code>ClassReader</code>\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u76f4\u63a5\u7531\u5b57\u8282\u6570\u7ec4\u6216\u8005<code>class</code>\u6587\u4ef6\u95f4\u63a5\u7684\u83b7\u5f97\u5b57\u8282\u7801\u6570\u636e\u3002\u5b83\u4f1a\u8c03\u7528<code>accept()</code>\u65b9\u6cd5\uff0c\u63a5\u53d7\u4e00\u4e2a\u5b9e\u73b0\u4e86\u62bd\u8c61\u7c7b<code>ClassVisitor</code>\u7684\u5bf9\u8c61\u5b9e\u4f8b\u4f5c\u4e3a\u53c2\u6570\uff0c\u7136\u540e\u4f9d\u6b21\u8c03\u7528<code>ClassVisitor</code>\u7684\u5404\u4e2a\u65b9\u6cd5\u3002\u5b57\u8282\u7801\u7a7a\u95f4\u4e0a\u7684\u504f\u79fb\u88ab\u8f6c\u6210\u5404\u79cd<code>visitXXX</code>\u65b9\u6cd5\u3002\u4f7f\u7528\u8005\u53ea\u9700\u8981\u5728\u5bf9\u5e94\u7684\u7684\u65b9\u6cd5\u4e0a\u8fdb\u884c\u9700\u6c42\u64cd\u4f5c\u5373\u53ef\uff0c\u65e0\u9700\u8003\u8651\u5b57\u8282\u504f\u79fb\u3002</li> <li>\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d<code>ClassReader</code>\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u4e8b\u4ef6\u751f\u4ea7\u8005\uff0c<code>ClassWriter</code>\u7ee7\u627f\u81ea<code>ClassVisitor</code>\u62bd\u8c61\u7c7b\uff0c\u8d1f\u8d23\u5c06\u5bf9\u8c61\u5316\u7684class\u6587\u4ef6\u5185\u5bb9\u91cd\u6784\u6210\u4e00\u4e2a\u4e8c\u8fdb\u5236\u683c\u5f0f\u7684<code>class</code>\u5b57\u8282\u7801\u6587\u4ef6\uff0c<code>ClassWriter</code>\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u4e8b\u4ef6\u7684\u6d88\u8d39\u8005\u3002</li> </ul> <p>\u81f3\u6b64\uff0c\u76f8\u4fe1\u8bfb\u8005\u5df2\u7ecf\u5bf9 ASM \u6846\u67b6\u7684\u6267\u884c\u8fc7\u7a0b\u6709\u4e00\u5b9a\u4e86\u89e3\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8fd8\u5269\u7684\u4e00\u70b9\u5185\u5bb9\u5c31\u662f\u5982\u4f55\u5b9e\u73b0<code>class</code>\u6587\u4ef6\u5b57\u8282\u7801\u7684\u4fee\u6539\u3002</p>"},{"location":"front-end/android/system/asm-basic/#3-asm","title":"3. ASM \u5b57\u8282\u7801\u4fee\u6539","text":"<p>\u7531\u4e8e ASM \u662f\u76f4\u63a5\u5bf9<code>class</code>\u6587\u4ef6\u7684\u5b57\u8282\u7801\u8fdb\u884c\u64cd\u4f5c\uff0c\u56e0\u6b64\uff0c\u8981\u4fee\u6539<code>class</code>\u6587\u4ef6\u5185\u5bb9\u65f6\uff0c\u4e5f\u8981\u6ce8\u5165\u76f8\u5e94\u7684<code>java</code>\u5b57\u8282\u7801\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u6ce8\u5165\u5b57\u8282\u7801\u4e4b\u524d\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e86\u89e3\u4e0b<code>class</code>\u6587\u4ef6\u7684\u7ed3\u6784\uff0cJVM\u6307\u4ee4\u7b49\u77e5\u8bc6\u3002</p>"},{"location":"front-end/android/system/asm-basic/#31-class","title":"3.1 <code>class</code>\u6587\u4ef6\u7ed3\u6784","text":"<pre><code>`Java`\u6e90\u6587\u4ef6\u7ecf\u8fc7`javac`\u7f16\u8bd1\u5668\u7f16\u8bd1\u4e4b\u540e\uff0c\u5c06\u4f1a\u751f\u6210\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236`.class`\u6587\u4ef6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n</code></pre> <p>ASM \u2013 Javac \u6d41\u7a0b</p> <p><code>Java</code>\u7c7b\u6587\u4ef6\u662f 8 \u4f4d\u5b57\u8282\u7684\u4e8c\u8fdb\u5236\u6d41\u3002\u6570\u636e\u9879\u6309\u987a\u5e8f\u5b58\u50a8\u5728<code>class</code>\u6587\u4ef6\u4e2d\uff0c\u76f8\u90bb\u7684\u9879\u4e4b\u95f4\u6ca1\u6709\u95f4\u9694\uff0c\u8fd9\u4f7f\u5f97<code>class</code>\u6587\u4ef6\u53d8\u5f97\u7d27\u51d1\uff0c\u51cf\u5c11\u5b58\u50a8\u7a7a\u95f4\u3002\u5728<code>Java</code>\u7c7b\u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u8bb8\u591a\u5927\u5c0f\u4e0d\u540c\u7684\u9879\uff0c\u7531\u4e8e\u6bcf\u4e00\u9879\u7684\u7ed3\u6784\u90fd\u6709\u4e25\u683c\u89c4\u5b9a\uff0c\u8fd9\u4f7f\u5f97 class \u6587\u4ef6\u80fd\u591f\u4ece\u5934\u5230\u5c3e\u88ab\u987a\u5229\u5730\u89e3\u6790\u3002</p> <p>\u6bcf\u4e2a<code>class</code>\u6587\u4ef6\u90fd\u662f\u6709\u56fa\u5b9a\u7684\u7ed3\u6784\u4fe1\u606f\uff0c\u800c\u4e14\u4fdd\u7559\u4e86\u6e90\u7801\u6587\u4ef6\u4e2d\u7684\u7b26\u53f7\u3002\u4e0b\u56fe\u662f<code>class</code>\u6587\u4ef6\u7684\u683c\u5f0f\u56fe\u3002\u5176\u4e2d\u5e26 * \u53f7\u7684\u8868\u793a\u53ef\u91cd\u590d\u7684\u7ed3\u6784\u3002</p> <p></p> <p>class\u6587\u4ef6\u7ed3\u6784\u56fe</p> <ul> <li>\u7c7b\u7ed3\u6784\u4f53\u4e2d\u6240\u6709\u7684\u4fee\u9970\u7b26\u3001\u5b57\u7b26\u5e38\u91cf\u548c\u5176\u4ed6\u5e38\u91cf\u90fd\u88ab\u5b58\u50a8\u5728class\u6587\u4ef6\u5f00\u59cb\u7684\u4e00\u4e2a\u5e38\u91cf\u5806\u6808(Constant Stack)\u4e2d\uff0c\u5176\u4ed6\u7ed3\u6784\u4f53\u901a\u8fc7\u7d22\u5f15\u5f15\u7528\u3002</li> <li>\u6bcf\u4e2a\u7c7b\u5fc5\u987b\u5305\u542bheaders\uff08\u5305\u62ec\uff1aclass name, super class, interface, etc.\uff09\u548c\u5e38\u91cf\u5806\u6808\uff08Constant Stack\uff09\u5176\u4ed6\u5143\u7d20\uff0c\u4f8b\u5982\uff1a\u5b57\u6bb5\uff08fields\uff09\u3001\u65b9\u6cd5\uff08methods\uff09\u548c\u5168\u90e8\u5c5e\u6027\uff08attributes\uff09\u53ef\u4ee5\u9009\u62e9\u663e\u793a\u6216\u8005\u4e0d\u663e\u793a\u3002</li> <li>\u6bcf\u4e2a\u5b57\u6bb5\u5757\uff08Field section\uff09\u5305\u62ec\u540d\u79f0\u3001\u4fee\u9970\u7b26\uff08public, private, etc.\uff09\u3001\u63cf\u8ff0\u7b26\u53f7(descriptor)\u548c\u5b57\u6bb5\u5c5e\u6027\u3002</li> <li>\u6bcf\u4e2a\u65b9\u6cd5\u533a\u57df\uff08Method section\uff09\u91cc\u9762\u7684\u4fe1\u606f\u4e0eheader\u90e8\u5206\u7684\u4fe1\u606f\u7c7b\u4f3c\uff0c\u4fe1\u606f\u5173\u4e8e\u6700\u5927\u5806\u6808\uff08max stack\uff09\u548c\u6700\u5927\u672c\u5730\u53d8\u91cf\u6570\u91cf\uff08max local variable numbers\uff09\u88ab\u7528\u4e8e\u4fee\u6539\u5b57\u8282\u7801\u3002\u5bf9\u4e8e\u975eabstract\u548c\u975enative\u7684\u65b9\u6cd5\u6709\u4e00\u4e2a\u65b9\u6cd5\u6307\u4ee4\u8868\uff0cexceptions\u8868\u548c\u4ee3\u7801\u5c5e\u6027\u8868\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u6709\u5176\u4ed6\u65b9\u6cd5\u5c5e\u6027\u3002</li> <li>\u6bcf\u4e2a\u7c7b\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u548c\u65b9\u6cd5\u4ee3\u7801\u7684\u5c5e\u6027\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u540d\u79f0\u8bb0\u5f55\u5728\u7c7b\u6587\u4ef6\u683c\u5f0f\u7684JVM\u89c4\u8303\u7684\u90e8\u5206\uff0c\u8fd9\u4e9b\u5c5e\u6027\u5c55\u793a\u4e86\u5b57\u8282\u7801\u591a\u65b9\u9762\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u6e90\u6587\u4ef6\u540d\u3001\u5185\u90e8\u7c7b\u3001\u7b7e\u540d\u3001\u4ee3\u7801\u884c\u6570\u3001\u672c\u5730\u53d8\u91cf\u8868\u548c\u6ce8\u91ca\u3002JVM\u89c4\u8303\u5141\u8bb8\u5b9a\u4e49\u81ea\u5b9a\u4e49\u5c5e\u6027\uff0c\u8fd9\u4e9b\u5c5e\u6027\u4f1a\u88ab\u6807\u51c6\u7684VM\uff08\u865a\u62df\u673a\uff09\u5ffd\u7565\uff0c\u4f46\u662f\u53ef\u4ee5\u5305\u542b\u9644\u4ef6\u4fe1\u606f\u3002</li> <li>\u65b9\u6cd5\u4ee3\u7801\u8868\u5305\u542b\u4e00\u7cfb\u5217\u5bf9java\u865a\u62df\u673a\u7684\u6307\u4ee4\u3002\u6709\u4e9b\u6307\u4ee4\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u504f\u79fb\u91cf\uff0c\u5f53\u6307\u4ee4\u4ece\u65b9\u6cd5\u4ee3\u7801\u88ab\u63d2\u5165\u6216\u8005\u79fb\u9664\u65f6\uff0c\u5168\u90e8\u504f\u79fb\u91cf\u7684\u503c\u53ef\u80fd\u9700\u8981\u8c03\u6574\u3002</li> </ul>"},{"location":"front-end/android/system/asm-basic/#32-javaclass","title":"3.2 <code>Java</code>\u7c7b\u578b\u4e0e<code>class</code>\u6587\u4ef6\u5185\u90e8\u7c7b\u578b\u5bf9\u5e94\u5173\u7cfb","text":"<pre><code>`Java`\u7c7b\u578b\u5206\u4e3a\u57fa\u672c\u7c7b\u578b\u548c\u5f15\u7528\u7c7b\u578b\uff0c\u5728 JVM \u4e2d\u5bf9\u6bcf\u4e00\u79cd\u7c7b\u578b\u90fd\u6709\u4e0e\u4e4b\u76f8\u5bf9\u5e94\u7684\u7c7b\u578b\u63cf\u8ff0\uff0c\u5982\u4e0b\u8868\uff1a\n</code></pre> Java type JVM Type descriptor boolean Z char C byte B short S int I float F long J double D Object Ljava/lang/Object; int[] [I Object[][] [[Ljava/lang/Object; <p>\u5728 ASM \u4e2d\u8981\u83b7\u5f97\u4e00\u4e2a\u7c7b\u7684 JVM \u5185\u90e8\u63cf\u8ff0\uff0c\u53ef\u4ee5\u4f7f\u7528<code>org.objectweb.asm.Type</code>\u7c7b\u4e2d\u7684<code>getDescriptor(final Class c)</code>\u65b9\u6cd5\uff0c\u5982\u4e0b\uff1a</p> <pre><code>public class TypeDescriptors {    public static void main(String[] args) {    System.out.println(Type.getDescriptor(TypeDescriptors.class));    System.out.println(Type.getDescriptor(String.class));    }        }\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\uff1a</p> <pre><code>Lorg/victorzhzh/core/structure/TypeDescriptors;    Ljava/lang/String;    </code></pre>"},{"location":"front-end/android/system/asm-basic/#33-javaclass","title":"3.3 <code>Java</code>\u65b9\u6cd5\u58f0\u660e\u4e0e<code>class</code>\u6587\u4ef6\u5185\u90e8\u58f0\u660e\u7684\u5bf9\u5e94\u5173\u7cfb","text":"<pre><code>\u5728\u00b7Java\u00b7\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\uff0c\u65b9\u6cd5\u7684\u65b9\u6cd5\u540d\u548c\u65b9\u6cd5\u7684\u63cf\u8ff0\u90fd\u662f\u5b58\u50a8\u5728Constant pool \u4e2d\u7684\uff0c\u4e14\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u5355\u5143\u91cc\u3002\u56e0\u6b64\uff0c\u65b9\u6cd5\u63cf\u8ff0\u4e2d\u4e0d\u542b\u6709\u65b9\u6cd5\u540d\uff0c\u53ea\u542b\u6709\u53c2\u6570\u7c7b\u578b\u548c\u8fd4\u56de\u7c7b\u578b\u3002\n</code></pre> <p>\u683c\u5f0f\uff1a(\u53c2\u6570\u63cf\u8ff0\u7b26)\u8fd4\u56de\u503c\u63cf\u8ff0\u7b26</p> Method declaration in source file Method descriptor void m(int i, float f) (IF)V int m(Object o) (Ljava/lang/Object;)I int[] m(int i, String s) (ILjava/lang/String;)[I Object m(int[] i) ([I]Ljava/lang/Object; String m() ()Ljava/lang/String;"},{"location":"front-end/android/system/asm-basic/#34-jvm","title":"3.4 JVM \u6307\u4ee4","text":"<p>\u5047\u8bbe\u73b0\u5728\u6211\u4eec\u6709\u5982\u4e0b\u4e00\u4e2a\u7c7b\uff1a</p> <pre><code>package com.yn.test;\npublic class Test {\npublic static void main(String[] agrs){\nSystem.out.println(\"Hello World!\");\n}\n}\n</code></pre> <p>\u6211\u4eec\u5148\u7528<code>javac com/yn/test/Test.java</code>\u7f16\u8bd1\u5f97\u5230<code>Test.class</code>\u6587\u4ef6\uff0c\u7136\u540e\u518d\u4f7f\u7528<code>javap -c com/yn/test/Test</code>\u6765\u67e5\u770b\u4e0b\u8fd9\u4e2a<code>Test.class</code>\u6587\u4ef6\u7684\u5b57\u8282\u7801\uff0c\u7ed3\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ol> <li> <p>\u4e0a\u56fe\u4e2d\u7b2c3\u884c\u5230\u7b2c7\u884c\uff0c\u662f\u7c7b<code>Test</code>\u7684\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff08\u7531\u7f16\u8bd1\u5668\u9ed8\u8ba4\u751f\u6210\uff09\uff0c<code>Code</code>\u4ee5\u4e0b\u90e8\u5206\u662f\u6784\u9020\u51fd\u6570\u5185\u90e8\u4ee3\u7801\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>aload_0\uff1a  \u8fd9\u4e2a\u6307\u4ee4\u662fLOAD\u7cfb\u5217\u6307\u4ee4\u4e2d\u7684\u4e00\u4e2a\uff0c\u5b83\u7684\u610f\u601d\u8868\u793a\u88c5\u8f7d\u5f53\u524d\u7b2c 0 \u4e2a\u5143\u7d20\u5230\u5806\u6808\u4e2d\u3002\u4ee3\u7801\u4e0a\u76f8\u5f53\u4e8e\u201cthis\u201d\u3002\u800c\u8fd9\u4e2a\u6570\u636e\u5143\u7d20\u7684\u7c7b\u578b\u662f\u4e00\u4e2a\u5f15\u7528\u7c7b\u578b\u3002\u8fd9\u4e9b\u6307\u4ee4\u5305\u542b\u4e86\uff1aALOAD\uff0cILOAD\uff0cLLOAD\uff0cFLOAD\uff0cDLOAD\u3002\u533a\u5206\u5b83\u4eec\u7684\u4f5c\u7528\u5c31\u662f\u9488\u5bf9\u4e0d\u7528\u6570\u636e\u7c7b\u578b\u800c\u51c6\u5907\u7684LOAD\u6307\u4ee4\uff0c\u6b64\u5916\u8fd8\u6709\u4e13\u95e8\u8d1f\u8d23\u5904\u7406\u6570\u7ec4\u7684\u6307\u4ee4 SALOAD\u3002</li> <li>invokespecial\uff1a \u8fd9\u4e2a\u6307\u4ee4\u662f\u8c03\u7528\u7cfb\u5217\u6307\u4ee4\u4e2d\u7684\u4e00\u4e2a\u3002\u5176\u76ee\u7684\u662f\u8c03\u7528\u5bf9\u8c61\u7c7b\u7684\u65b9\u6cd5\u3002\u540e\u9762\u9700\u8981\u7ed9\u4e0a\u7236\u7c7b\u7684\u65b9\u6cd5\u5b8c\u6574\u7b7e\u540d\u3002\u201c#1\u201d\u7684\u610f\u601d\u662f .class \u6587\u4ef6\u5e38\u91cf\u8868\u4e2d\u7b2c1\u4e2a\u5143\u7d20\u3002\u503c\u4e3a\uff1a\u201cjava/lang/Object.\"\":()V\u201d\u3002\u7ed3\u5408ALOAD_0\u3002\u8fd9\u4e24\u4e2a\u6307\u4ee4\u53ef\u4ee5\u7ffb\u8bd1\u4e3a\uff1a\u201csuper()\u201d\u3002\u5176\u542b\u4e49\u662f\u8c03\u7528\u81ea\u5df1\u7684\u7236\u7c7b\u6784\u9020\u65b9\u6cd5\u3002 <li> <p>\u7b2c9\u523014\u884c\u662f<code>main</code>\u65b9\u6cd5\uff0c<code>Code</code>\u4ee5\u4e0b\u662f\u5176\u5b57\u8282\u7801\u8868\u793a\uff1a</p> <ul> <li>getstatic\uff1a   \u8fd9\u4e2a\u6307\u4ee4\u662fGET\u7cfb\u5217\u6307\u4ee4\u4e2d\u7684\u4e00\u4e2a\u5176\u4f5c\u7528\u662f\u83b7\u53d6\u9759\u6001\u5b57\u6bb5\u5185\u5bb9\u5230\u5806\u6808\u4e2d\u3002\u8fd9\u4e00\u7cfb\u5217\u6307\u4ee4\u5305\u62ec\u4e86\uff1aGETFIELD\u3001GETSTATIC\u3002\u5b83\u4eec\u5206\u522b\u7528\u4e8e\u83b7\u53d6\u52a8\u6001\u5b57\u6bb5\u548c\u9759\u6001\u5b57\u6bb5\u3002\u6b64\u5904\u8868\u793a\u7684\u610f\u601d\u83b7\u53d6\u9759\u6001\u6210\u5458<code>System.out</code>\u5230\u5806\u6808\u4e2d\u3002</li> <li>ldc\uff1a\u8fd9\u4e2a\u6307\u4ee4\u7684\u529f\u80fd\u662f\u4ece\u5e38\u91cf\u8868\u4e2d\u88c5\u8f7d\u4e00\u4e2a\u6570\u636e\u5230\u5806\u6808\u4e2d\u3002\u6b64\u5904\u8868\u793a\u4ece\u5e38\u91cf\u6c60\u4e2d\u83b7\u53d6\u5b57\u7b26\u4e32\"Hello World!\"\u3002</li> <li>invokevirtual\uff1a\u4e5f\u662f\u4e00\u79cd\u8c03\u7528\u6307\u4ee4\uff0c\u8fd9\u4e2a\u6307\u4ee4\u533a\u522b\u4e0e invokespecial \u7684\u662f\u5b83\u662f\u6839\u636e\u5f15\u7528\u8c03\u7528\u5bf9\u8c61\u7c7b\u7684\u65b9\u6cd5\u3002\u6b64\u5904\u8868\u793a\u8c03\u7528<code>java.io.PrintStream.println(String)</code>\u65b9\u6cd5\uff0c\u7ed3\u5408\u524d\u9762\u7684\u64cd\u4f5c\uff0c\u8fd9\u91cc\u8c03\u7528\u7684\u5c31\u662f<code>System.out.println(\"Hello World!\")</code>\u3002</li> <li>return\uff1a \u8fd9\u4e5f\u662f\u4e00\u7cfb\u5217\u6307\u4ee4\u4e2d\u7684\u4e00\u4e2a\uff0c\u5176\u76ee\u7684\u662f\u65b9\u6cd5\u8c03\u7528\u5b8c\u6bd5\u8fd4\u56de\uff1a\u53ef\u7528\u7684\u5176\u4ed6\u6307\u4ee4\u6709\uff1aIRETURN\uff0cDRETURN\uff0cARETURN\u7b49\uff0c\u7528\u4e8e\u8868\u793a\u4e0d\u540c\u7c7b\u578b\u53c2\u6570\u7684\u8fd4\u56de\u3002</li> </ul> </li> <p>\u66f4\u591a\u8be6\u7ec6\u5185\u5bb9\uff0c\u8bf7\u53c2\u8003\uff1aJVM\u5b57\u8282\u7801\u6307\u4ee4\u7406\u89e3\uff0cJVM\u6307\u4ee4\uff0c\u6df1\u5165\u5b57\u8282\u7801 -- \u4f7f\u7528 ASM \u5b9e\u73b0 AOP  \u66f4\u591a\u5b57\u8282\u7801\u6307\u4ee4\u8be6\u60c5\uff0c\u8bf7\u53c2\u8003\u5b98\u7f51\uff1aThe Java Virtual Machine Instruction Set</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u4e0a\u9762\u6240\u8bb2\u7684\u5185\u5bb9\uff0c\u5c06\u4ee3\u7801\u5b57\u8282\u7801\u6ce8\u5165\u5230<code>class</code>\u6587\u4ef6\u4e2d\u4e86\u3002</p> <p>\u73b0\u5728\u5047\u8bbe\u6211\u4eec\u60f3\u8981\u5728\u7c7b<code>Test</code>\u7684<code>main</code>\u65b9\u6cd5\u524d\u540e\u52a8\u6001\u63d2\u5165\u4ee3\u7801\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>package com.yn.test;\npublic class Test {\npublic static void main(String[] agrs){\nSystem.out.println(\"asm insert before\");\nSystem.out.println(\"Hello World!\");\nSystem.out.println(\"asm insert after\");\n}\n}\n</code></pre> <p>\u8981\u5b8c\u6210\u5728<code>main</code>\u65b9\u6cd5\u524d\u540e\u63d2\u5165\u8f93\u51fa\u4ee3\u7801\uff0c\u9700\u8981\u4ee5\u4e0b\u51e0\u6b65\u64cd\u4f5c\uff1a</p> <ol> <li> <p>\u8bfb\u53d6<code>Test.class</code>\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7 ASM \u63d0\u4f9b\u7684<code>ClassReader</code>\u7c7b\u8fdb\u884c<code>class</code>\u6587\u4ef6\u7684\u8bfb\u53d6\u4e0e\u904d\u5386\u3002 <pre><code>// \u4f7f\u7528\u5168\u9650\u5b9a\u540d\uff0c\u521b\u5efa\u4e00\u4e2aClassReader\u5bf9\u8c61\nClassReader classReader = new ClassReader(\"com.yn.test.Test\");\n// \u6784\u5efa\u4e00\u4e2aClassWriter\u5bf9\u8c61\uff0c\u5e76\u8bbe\u7f6e\u8ba9\u7cfb\u7edf\u81ea\u52a8\u8ba1\u7b97\u6808\u548c\u672c\u5730\u53d8\u91cf\u5927\u5c0f\nClassWriter classWriter = new ClassWriter(ClassWriter.COMPUTE_MAXS);\n//\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49ClassVisitor\uff0c\u65b9\u4fbf\u540e\u7eedClassReader\u7684\u904d\u5386\u901a\u77e5\nClassVisitor classVisitor = new TestClassVisitor(classWriter);\n//\u5f00\u59cb\u626b\u63cfclass\u6587\u4ef6\nclassReader.accept(classVisitor, ClassReader.SKIP_DEBUG);\n</code></pre></p> </li> <li> <p>\u6784\u9020<code>System.out.println(String)</code>\u7684 ASM \u4ee3\u7801\u3002</p> <p>\u4e0a\u9762\u6211\u4eec\u4ece<code>javap</code>\u53cd\u7f16\u8bd1\u5f97\u5230\u7684\u5b57\u8282\u7801\u53ef\u4ee5\u77e5\u9053\uff0c\u5b9e\u73b0<code>System.out.println(\"Hello World!\");</code>\u7684\u5b57\u8282\u7801\u603b\u5171\u9700\u89813\u6b65\u64cd\u4f5c\uff1a</p> <p>(1). \u83b7\u53d6<code>System</code>\u9759\u6001\u6210\u5458<code>out</code>\uff0c\u5176\u5bf9\u5e94\u7684\u6307\u4ee4\u4e3a<code>getstatic</code>\uff0c\u5bf9\u5e94\u7684 ASM \u4ee3\u7801\u4e3a\uff1a   <pre><code>mv.visitFieldInsn(Opcodes.GETSTATIC,\nType.getInternalName(System.class), //\"java/lang/System\"\n\"out\",\nType.getDescriptor(PrintStream.class) //\"Ljava/io/PrintStream;\"\n);\n</code></pre></p> <p>(2). \u83b7\u53d6\u5b57\u7b26\u4e32\u5e38\u91cf\"Hello World!\"\uff0c\u5176\u5bf9\u5e94\u7684\u6307\u4ee4\u4e3a<code>ldc</code>\uff0c\u5bf9\u5e94\u7684 ASM \u4ee3\u7801\u4e3a\uff1a   <pre><code>mv.visitLdcInsn(\"Hello World!\");\n</code></pre></p> <p>(3). \u83b7\u53d6<code>PrintStream.println(String)</code>\u65b9\u6cd5\uff0c\u5176\u5bf9\u5e94\u7684\u6307\u4ee4\u4e3a<code>invokervirtual</code>\uff0c\u5bf9\u5e94\u7684 ASM \u4ee3\u7801\u4e3a\uff1a   <pre><code>mv.visitMethodInsn(Opcodes.INVOKEVIRTUAL,\nType.getInternalName(PrintStream.class), //\"java/io/PrintStream\"\n\"println\",\n\"(Ljava/lang/String;)V\",//\u65b9\u6cd5\u63cf\u8ff0\u7b26\nfalse);\n</code></pre></p> </li> <li> <p>\u5728<code>main</code>\u65b9\u6cd5\u8fdb\u5165\u524d\uff0c\u8fdb\u884c\u4ee3\u7801\u63d2\u5165\uff0c\u53ef\u4ee5\u901a\u8fc7<code>MethodVisitor.visitCode()</code>\u65b9\u6cd5\u3002 <pre><code>// \u5728\u6e90\u65b9\u6cd5\u524d\u53bb\u4fee\u6539\u65b9\u6cd5\u5185\u5bb9,\u8fd9\u90e8\u5206\u7684\u4fee\u6539\u5c06\u52a0\u8f7d\u6e90\u65b9\u6cd5\u7684\u5b57\u8282\u7801\u4e4b\u524d\n@Override\npublic void visitCode() {\nmv.visitCode();\nSystem.out.println(\"method start to insert code\");\nsop(\"asm insert before\");//this is the insert code\n}\n</code></pre></p> </li> <li> <p>\u5728<code>main</code>\u65b9\u6cd5\u9000\u51fa\u524d\uff0c\u8fdb\u884c\u4ee3\u7801\u63d2\u5165\uff0c\u53ef\u4ee5\u901a\u5173\u8fc7<code>MethodVisitor.visitInsn()</code>\u65b9\u6cd5\uff0c\u901a\u8fc7\u5224\u65ad\u5f53\u524d\u7684\u6307\u4ee4\u4e3a<code>return</code>\u65f6\uff0c\u8868\u660e\u5373\u5c06\u6267\u884c<code>return</code>\u8bed\u53e5\uff0c\u6b64\u65f6\u63d2\u5165\u5b57\u8282\u7801\u5373\u53ef\u3002 <pre><code>@Override\npublic void visitInsn(int opcode) {\n//\u68c0\u6d4b\u5230return\u8bed\u53e5\nif (opcode == Opcodes.RETURN) {\nSystem.out.println(\"method end to insert code\");\nsop(\"asm insert after\");\n}\n//\u6267\u884c\u539f\u672c\u8bed\u53e5\nmv.visitInsn(opcode);\n}\n</code></pre></p> </li> <li> <p>\u5b57\u8282\u7801\u63d2\u5165<code>class</code>\u6587\u4ef6\u6210\u529f\u540e\uff0c\u5bfc\u51fa\u5b57\u8282\u7801\u5230\u539f\u6587\u4ef6\u4e2d\u3002 <pre><code>//\u83b7\u53d6\u6539\u5199\u540e\u7684class\u4e8c\u8fdb\u5236\u5b57\u8282\u7801\nbyte[] classFile = classWriter.toByteArray();\n// \u5c06\u8fd9\u4e2a\u7c7b\u8f93\u51fa\u5230\u539f\u5148\u7684\u7c7b\u6587\u4ef6\u76ee\u5f55\u4e0b\uff0c\u8fd9\u662f\u539f\u5148\u7684\u7c7b\u6587\u4ef6\u5df2\u7ecf\u88ab\u4fee\u6539\nFile file = new File(\"E:/code/Android/Projects/AsmButterknife/sample-java/build/classes/java/main/com/yn/test/Test.class\");\nFileOutputStream fos = new FileOutputStream(file);\nfos.write(classFile);\nfos.close();\n</code></pre></p> </li> </ol> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u5b8c\u6210\u4e86\u5bf9<code>Test.class</code>\u7684\u4ee3\u7801\u6ce8\u5165\u3002  \u8be6\u7ec6\u4ee3\u7801\u8bf7\u53c2\u89c1\uff1aAsmTest</p> <p>\u6ce8: asm-commons \u5305\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7c7b<code>AdviceAdapter</code>\uff0c\u4f7f\u7528\u8be5\u7c7b\u53ef\u4ee5\u66f4\u52a0\u65b9\u4fbf\u7684\u8ba9\u6211\u4eec\u5728\u65b9\u6cd5\u524d\u540e\u6ce8\u5165\u4ee3\u7801\uff0c\u56e0\u4e3a\u5176\u63d0\u4f9b\u4e86\u65b9\u6cd5<code>onMethodEnter()</code>\u548c<code>onMethodExit()</code>\u3002</p> <p>\u901a\u8fc7\u4e0a\u9762\u4ecb\u7ecd\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u4f7f\u7528 ASM \u52a8\u6001\u6ce8\u5165\u5b57\u8282\u7801\u5230<code>class</code>\u6587\u4ef6\u4e2d\u3002\u4f46\u662f\u5982\u679c\u76f4\u63a5\u91c7\u7528 ASM \u4ee3\u7801\u6ce8\u5165\u5b57\u8282\u7801\uff0c\u8fd8\u662f\u76f8\u5bf9\u56f0\u96be\u7684\uff0c\u5e78\u8fd0\u7684\u662f ASM \u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86 ASMifier \u5de5\u5177\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7<code>.class</code>\u6587\u4ef6\u53cd\u7f16\u8bd1\u4e3a ASM \u4ee3\u7801\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u8981\u4f7f\u7528 ASM \u6846\u67b6\u5f80<code>class</code>\u6587\u4ef6\u6ce8\u5165\u5b57\u8282\u7801\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u662f\u5c06\u8981\u6ce8\u5165\u7684<code>java</code>\u6e90\u7801\u5148\u5199\u51fa\u6765\uff0c\u7136\u540e\u901a\u8fc7<code>javac</code>\u7f16\u8bd1\u51fa\u76ee\u6807<code>.class</code>\u6587\u4ef6\uff0c\u7136\u540e\u518d\u901a\u8fc7 ASMifier \u5de5\u5177\u53cd\u7f16\u8bd1\u8be5<code>.class</code>\u6587\u4ef6\uff0c\u5f97\u5230\u6240\u9700\u7684 ASM \u6ce8\u5165\u4ee3\u7801\u3002</p> <p>ASMifier \u5b58\u5728\u4e8e<code>asm-util.jar</code>\u4e2d\uff0c\u540c\u65f6\u9700\u8981\u4f9d\u8d56<code>asm.jar</code>\uff0c\u5e78\u8fd0\u7684\u662f ASM \u63d0\u4f9b\u4e86\u4e00\u4e2a<code>asm-all.jar</code>\u5305\uff0c\u53ef\u4ee5\u65b9\u4fbf\u6211\u4eec\u76f4\u63a5\u8fd0\u884c ASMifier\u3002</p> <p><code>asm-all.jar</code>\u4e0b\u8f7d\u5730\u5740\uff1aasm-all</p> <p>\u8fd0\u884c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>java -classpath \"asm-all.jar\" org.objectweb.asm.util.ASMifier org/domain/package/YourClass.class\n</code></pre>"},{"location":"front-end/android/system/asm-basic/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://www.jianshu.com/p/a85e8f83fa14</p>"},{"location":"front-end/android/system/bootloader/","title":"Android \u5f00\u673a\u6d41\u7a0b","text":""},{"location":"front-end/android/system/bootloader/#android","title":"Android\u5f00\u673a\u6d41\u7a0b","text":"<ol> <li> <p>\u677f\u5b50\u4e0a\u7535\u540e\u8fd0\u884c\u56fa\u5316\u5728 ROM \u4e2d\u7684\u4ee3\u7801\uff0c\u52a0\u8f7d Bootloader \u5230 RAM\u3002</p> </li> <li> <p>Bootloader \u542f\u52a8\uff0c\u5f15\u5bfc\u8fdb\u5165 Linux \u5185\u6838\u3002</p> </li> <li> <p>Kernel \u542f\u52a8 swapper \u8fdb\u7a0b\u3002\u5373 idle \u8fdb\u7a0b\uff0cpid = 0\uff0c\u7cfb\u7edf\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7528\u4e8e\u521d\u59cb\u5316 \u8fdb\u7a0b\u7ba1\u7406\u3001\u5185\u5b58\u7ba1\u7406\u3001\u52a0\u8f7d Display\u3001Camera Driver\u3001Binder Driver \u7684\u5de5\u4f5c\u3002     Kernel \u542f\u52a8 init \u8fdb\u7a0b\uff08\u7528\u6237\u8fdb\u7a0b\u7684\u7956\u5b97\uff09\u3002pid = 1\uff0c\u7528\u6765\u5b75\u5316\u7528\u6237\u7a7a\u95f4\u7684\u5b88\u62a4\u8fdb\u7a0b\u3001HAL\u3001\u5f00\u673a\u52a8\u753b\u7b49\u3002     Kernel \u542f\u52a8 threadd \u8fdb\u7a0b\uff08\u5185\u6838\u8fdb\u7a0b\u7684\u7956\u5b97\uff09\u3002pid = 2\uff0c\u521b\u5efa\u5185\u6838\u5de5\u7a0b\u7ebf\u7a0b kworkder\uff0c\u8f6f\u4e2d\u65ad\u7ebf\u7a0b\u7b49\u3002</p> </li> <li> <p>init \u8fdb\u7a0b fork \u51fa Daemon \u8fdb\u7a0b\uff1a\u5b75\u5316\u51faueventd\u3001logd\u3001healthd\u3001installd\u3001adbd\u3001lmkd \u7b49\u7528\u6237\u5b88\u62a4\u8fdb\u7a0b\uff1b     init \u8fdb\u7a0b\u542f\u52a8servicemanager(binder\u670d\u52a1\u7ba1\u5bb6)\u3001bootanim(\u5f00\u673a\u52a8\u753b)\u7b49\u91cd\u8981\u670d\u52a1;     init \u8fdb\u7a0b\u5b75\u5316\u51faZygote\u8fdb\u7a0b\uff0cZygote\u8fdb\u7a0b\u662fAndroid\u7cfb\u7edf\u7684\u7b2c\u4e00\u4e2aJava\u8fdb\u7a0b\uff0cZygote\u662f\u6240\u6709Java\u8fdb\u7a0b\u7684\u7236\u8fdb\u7a0b\uff08Android \u5e94\u7528\u7a0b\u5e8f\u7684\u7956\u5b97\uff09\uff0cZygote\u8fdb\u7a0b\u672c\u8eab\u662f\u7531 init \u8fdb\u7a0b\u5b75\u5316\u800c\u6765\u7684\u3002</p> <p>\u6bcf\u5f53\u7cfb\u7edf\u8981\u6c42\u6267\u884c\u4e00\u4e2aAndroid\u5e94\u7528\u7a0b\u5e8f\uff0cZygote\u5c31\u4f1aFORK\u51fa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c\u8be5\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u663e\u800c\u6613\u89c1\uff1aZygote\u8fdb\u7a0b\u662f\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u4ea7\u751f\u7684\uff0c\u5b83\u4f1a\u5b8c\u6210\u865a\u62df\u673a\u7684\u521d\u59cb\u5316\uff0c\u5e93\u7684\u52a0\u8f7d\uff0c\u9884\u7f6e\u7c7b\u5e93\u7684\u52a0\u8f7d\u548c\u521d\u59cb\u5316\u7b49\u7b49\u64cd\u4f5c\uff0c\u800c\u5728\u7cfb\u7edf\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u865a\u62df\u673a\u5b9e\u4f8b\u65f6\uff0cZygote\u901a\u8fc7\u590d\u5236\u81ea\u8eab\uff0c\u6700\u5feb\u901f\u7684\u63d0\u4f9b\u4e2a\u7cfb\u7edf\u3002\u53e6\u5916\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u53ea\u8bfb\u7684\u7cfb\u7edf\u5e93\uff0c\u6240\u6709\u865a\u62df\u673a\u5b9e\u4f8b\u90fd\u548cZygote\u5171\u4eab\u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u5927\u5927\u8282\u7701\u4e86\u5185\u5b58\u5f00\u9500\u3002</p> </li> <li> <p>Zygote \u5b75\u5316\u51fa System Server \u548c App\u3002     System Server \u5b83\u662f Android \u7cfb\u7edf\u7684\u6838\u5fc3\u8fdb\u7a0b\uff0c\u63d0\u4f9b\u4e86\u5e94\u7528\u7a0b\u5e8f\u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u7b49\u5404\u79cd Service\uff08\u8fd9\u4e9b Service \u540c\u6837\u9700\u8981\u6ce8\u518c\u5230 Context Manager\uff09\u3002</p> </li> </ol>"},{"location":"front-end/android/system/handler/","title":"Android\u6d88\u606f\u673a\u5236--Handler","text":""},{"location":"front-end/android/system/handler/#1","title":"1\u3001\u6982\u8ff0","text":"<p>Android\u6709\u5927\u91cf\u7684\u6d88\u606f\u9a71\u52a8\u65b9\u5f0f\u6765\u8fdb\u884c\u4ea4\u4e92\uff0c\u6bd4\u5982Android\u7684\u56db\u5251\u5ba2<code>Activity</code>, <code>Service</code>, <code>Broadcast</code>, <code>ContentProvider</code>\u7684\u542f\u52a8\u8fc7\u7a0b\u7684\u4ea4\u4e92\uff0c\u90fd\u79bb\u4e0d\u5f00\u6d88\u606f\u673a\u5236\uff0cAndroid\u67d0\u79cd\u610f\u4e49\u4e0a\u4e5f\u53ef\u4ee5\u8bf4\u6210\u662f\u4e00\u4e2a\u4ee5\u6d88\u606f\u9a71\u52a8\u7684\u7cfb\u7edf\u3002\u6d88\u606f\u673a\u5236\u6d89\u53caMessageQueue/Message/Looper/Handler\u8fd94\u4e2a\u7c7b\u3002</p>"},{"location":"front-end/android/system/handler/#11","title":"1.1 \u6a21\u578b","text":"<p>\u6d88\u606f\u673a\u5236\u4e3b\u8981\u5305\u542b\uff1a</p> <ul> <li>Message\uff1a\u6d88\u606f\u5206\u4e3a\u786c\u4ef6\u4ea7\u751f\u7684\u6d88\u606f(\u5982\u6309\u94ae\u3001\u89e6\u6478)\u548c\u8f6f\u4ef6\u751f\u6210\u7684\u6d88\u606f\uff1b</li> <li>MessageQueue\uff1a\u6d88\u606f\u961f\u5217\u7684\u4e3b\u8981\u529f\u80fd\u5411\u6d88\u606f\u6c60\u6295\u9012\u6d88\u606f(<code>MessageQueue.enqueueMessage</code>)\u548c\u53d6\u8d70\u6d88\u606f\u6c60\u7684\u6d88\u606f(<code>MessageQueue.next</code>)\uff1b</li> <li>Handler\uff1a\u6d88\u606f\u8f85\u52a9\u7c7b\uff0c\u4e3b\u8981\u529f\u80fd\u5411\u6d88\u606f\u6c60\u53d1\u9001\u5404\u79cd\u6d88\u606f\u4e8b\u4ef6(<code>Handler.sendMessage</code>)\u548c\u5904\u7406\u76f8\u5e94\u6d88\u606f\u4e8b\u4ef6(<code>Handler.handleMessage</code>)\uff1b</li> <li>Looper\uff1a\u4e0d\u65ad\u5faa\u73af\u6267\u884c(<code>Looper.loop</code>)\uff0c\u6309\u5206\u53d1\u673a\u5236\u5c06\u6d88\u606f\u5206\u53d1\u7ed9\u76ee\u6807\u5904\u7406\u8005\u3002</li> </ul>"},{"location":"front-end/android/system/handler/#12","title":"1.2 \u67b6\u6784\u56fe","text":"<ul> <li>Looper \u6709\u4e00\u4e2aMessageQueue\u6d88\u606f\u961f\u5217\uff1b</li> <li>MessageQueue \u6709\u4e00\u7ec4\u5f85\u5904\u7406\u7684Message\uff1b</li> <li>Message \u4e2d\u6709\u4e00\u4e2a\u7528\u4e8e\u5904\u7406\u6d88\u606f\u7684Handler\uff1b</li> <li>Handler \u4e2d\u6709Looper\u548cMessageQueue\u3002</li> </ul>"},{"location":"front-end/android/system/handler/#2message","title":"2\u3001Message","text":"<p>\u6bcf\u4e2a\u6d88\u606f\u7528<code>Message</code>\u8868\u793a\uff0c<code>Message</code>\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> \u6570\u636e\u7c7b\u578b \u6210\u5458\u53d8\u91cf \u89e3\u91ca int what \u6d88\u606f\u7c7b\u522b long when \u6d88\u606f\u89e6\u53d1\u65f6\u95f4 int arg1 \u53c2\u65701 int arg2 \u53c2\u65702 Object obj \u6d88\u606f\u5185\u5bb9 Handler target \u6d88\u606f\u54cd\u5e94\u65b9 Runnable callback \u56de\u8c03\u65b9\u6cd5 <p>\u521b\u5efa\u6d88\u606f\u7684\u8fc7\u7a0b\uff0c\u5c31\u662f\u586b\u5145\u6d88\u606f\u7684\u4e0a\u8ff0\u5185\u5bb9\u7684\u4e00\u9879\u6216\u591a\u9879\u3002</p> <p><code>Message</code> \u662f\u4e2a\u5355\u94fe\u8868\u7ed3\u6784\uff0c\u9759\u6001\u53d8\u91cf<code>sPool</code>\uff0c\u901a\u8fc7next\u6210\u5458\u53d8\u91cf\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6d88\u606f\u6c60\uff0c\u9759\u6001\u53d8\u91cf<code>MAX_POOL_SIZE</code>\u4ee3\u8868\u6d88\u606f\u6c60\u7684\u53ef\u7528\u5927\u5c0f\uff1b\u6d88\u606f\u6c60\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a50\u3002\u901a\u8fc7<code>obtain()</code>\u65b9\u6cd5\u4ece\u6d88\u606f\u6c60\u4e2d\u83b7\u53d6\u6d88\u606f\uff0c<code>recycle</code>\u65b9\u6cd5\u628a\u4e0d\u518d\u4f7f\u7528\u7684\u6d88\u606f\u52a0\u5165\u6d88\u606f\u6c60\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f\uff0c\u5f53\u6d88\u606f\u6c60\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u6d88\u606f\u6c60\u4e2d\u83b7\u53d6Message\u5bf9\u8c61\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u521b\u5efa\uff0c\u63d0\u9ad8\u6548\u7387\u3002</p> <p>obtain</p> <pre><code>public static Message obtain() {\nsynchronized (sPoolSync) {\nif (sPool != null) {\nMessage m = sPool;\nsPool = m.next;\nm.next = null; //\u4ecesPool\u4e2d\u53d6\u51fa\u4e00\u4e2aMessage\u5bf9\u8c61\uff0c\u5e76\u6d88\u606f\u94fe\u8868\u65ad\u5f00\nm.flags = 0; // \u6e05\u9664in-use flag\nsPoolSize--; //\u6d88\u606f\u6c60\u7684\u53ef\u7528\u5927\u5c0f\u8fdb\u884c\u51cf1\u64cd\u4f5c\nreturn m;\n}\n}\nreturn new Message(); // \u5f53\u6d88\u606f\u6c60\u4e3a\u7a7a\u65f6\uff0c\u76f4\u63a5\u521b\u5efaMessage\u5bf9\u8c61\n}\n</code></pre> <p>recycle <pre><code>public void recycle() {\nif (isInUse()) { //\u5224\u65ad\u6d88\u606f\u662f\u5426\u6b63\u5728\u4f7f\u7528\nif (gCheckRecycle) { //Android 5.0\u4ee5\u540e\u7684\u7248\u672c\u9ed8\u8ba4\u4e3atrue,\u4e4b\u524d\u7684\u7248\u672c\u9ed8\u8ba4\u4e3afalse.\nthrow new IllegalStateException(\"This message cannot be recycled because it is still in use.\");\n}\nreturn;\n}\nrecycleUnchecked();\n}\n//\u5bf9\u4e8e\u4e0d\u518d\u4f7f\u7528\u7684\u6d88\u606f\uff0c\u52a0\u5165\u5230\u6d88\u606f\u6c60\nvoid recycleUnchecked() {\n//\u5c06\u6d88\u606f\u6807\u793a\u4f4d\u7f6e\u4e3aIN_USE\uff0c\u5e76\u6e05\u7a7a\u6d88\u606f\u6240\u6709\u7684\u53c2\u6570\u3002\nflags = FLAG_IN_USE;\nwhat = 0;\narg1 = 0;\narg2 = 0;\nobj = null;\nreplyTo = null;\nsendingUid = -1;\nwhen = 0;\ntarget = null;\ncallback = null;\ndata = null;\nsynchronized (sPoolSync) {\nif (sPoolSize &lt; MAX_POOL_SIZE) { //\u5f53\u6d88\u606f\u6c60\u6ca1\u6709\u6ee1\u65f6\uff0c\u5c06Message\u5bf9\u8c61\u52a0\u5165\u6d88\u606f\u6c60\nnext = sPool;\nsPool = this;\nsPoolSize++; //\u6d88\u606f\u6c60\u7684\u53ef\u7528\u5927\u5c0f\u8fdb\u884c\u52a01\u64cd\u4f5c\n}\n}\n}\n</code></pre></p>"},{"location":"front-end/android/system/handler/#3-messagequeue","title":"3. MessageQueue","text":""},{"location":"front-end/android/system/handler/#31-messagequeue","title":"3.1 \u521b\u5efaMessageQueue","text":"<pre><code>MessageQueue(boolean quitAllowed) {\nmQuitAllowed = quitAllowed;\n//\u901a\u8fc7native\u65b9\u6cd5\u521d\u59cb\u5316\u6d88\u606f\u961f\u5217\uff0c\u5176\u4e2dmPtr\u662f\u4f9bnative\u4ee3\u7801\u4f7f\u7528\nmPtr = nativeInit();\n}\n</code></pre> <p>\u5728\u6574\u4e2a\u6d88\u606f\u673a\u5236\u4e2d\uff0c\u800c<code>MessageQueue</code>\u662f\u8fde\u63a5Java\u5c42\u548cNative\u5c42\u7684\u7ebd\u5e26\uff0c\u6362\u8a00\u4e4b\uff0cJava\u5c42\u53ef\u4ee5\u5411MessageQueue\u6d88\u606f\u961f\u5217\u4e2d\u6dfb\u52a0\u6d88\u606f\uff0cNative\u5c42\u4e5f\u53ef\u4ee5\u5411MessageQueue\u6d88\u606f\u961f\u5217\u4e2d\u6dfb\u52a0\u6d88\u606f\uff0c<code>MessageQueue</code>\u5927\u90e8\u5206\u6838\u5fc3\u65b9\u6cd5\u90fd\u4ea4\u7ed9native\u5c42\u6765\u5904\u7406\uff0c\u5176\u4e2dMessageQueue\u7c7b\u4e2d\u6d89\u53ca\u7684native\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>private native static long nativeInit(); //\u521d\u59cb\u5316\nprivate native static void nativeDestroy(long ptr);//\u6e05\u7406\u56de\u6536\nprivate native void nativePollOnce(long ptr, int timeoutMillis);//\u63d0\u53d6\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\nprivate native static void nativeWake(long ptr); //\u5524\u9192\nprivate native static boolean nativeIsPolling(long ptr);\nprivate native static void nativeSetFileDescriptorEvents(long ptr, int fd, int events);\n</code></pre> <p>\u5177\u4f53\u53c2\u9605Android\u6d88\u606f\u673a\u5236</p>"},{"location":"front-end/android/system/handler/#32","title":"3.2 \u6dfb\u52a0\u4e00\u6761\u6d88\u606f\u5230\u6d88\u606f\u961f\u5217","text":"<p>enqueueMessage</p> <pre><code>boolean enqueueMessage(Message msg, long when) {\n// \u6bcf\u4e00\u4e2a\u666e\u901aMessage\u5fc5\u987b\u6709\u4e00\u4e2atarget\nif (msg.target == null) {\nthrow new IllegalArgumentException(\"Message must have a target.\");\n}\nif (msg.isInUse()) {\nthrow new IllegalStateException(msg + \" This message is already in use.\");\n}\nsynchronized (this) {\nif (mQuitting) {  //\u6b63\u5728\u9000\u51fa\u65f6\uff0c\u56de\u6536msg\uff0c\u52a0\u5165\u5230\u6d88\u606f\u6c60\nmsg.recycle();\nreturn false;\n}\nmsg.markInUse();\nmsg.when = when;\nMessage p = mMessages;\nboolean needWake;\nif (p == null || when == 0 || when &lt; p.when) {\n//p\u4e3anull(\u4ee3\u8868MessageQueue\u6ca1\u6709\u6d88\u606f\uff09 \u6216\u8005msg\u7684\u89e6\u53d1\u65f6\u95f4\u662f\u961f\u5217\u4e2d\u6700\u65e9\u7684\uff0c \u5219\u8fdb\u5165\u8be5\u8be5\u5206\u652f\nmsg.next = p;\nmMessages = msg;\nneedWake = mBlocked; //\u5f53\u963b\u585e\u65f6\u9700\u8981\u5524\u9192\n} else {\n//\u5c06\u6d88\u606f\u6309\u65f6\u95f4\u987a\u5e8f\u63d2\u5165\u5230MessageQueue\u3002\u4e00\u822c\u5730\uff0c\u4e0d\u9700\u8981\u5524\u9192\u4e8b\u4ef6\u961f\u5217\uff0c\u9664\u975e\n//\u6d88\u606f\u961f\u5934\u5b58\u5728barrier\uff0c\u5e76\u4e14\u540c\u65f6Message\u662f\u961f\u5217\u4e2d\u6700\u65e9\u7684\u5f02\u6b65\u6d88\u606f\u3002\nneedWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous();\nMessage prev;\nfor (;;) {\nprev = p;\np = p.next;\nif (p == null || when &lt; p.when) {\nbreak;\n}\nif (needWake &amp;&amp; p.isAsynchronous()) {\nneedWake = false;\n}\n}\nmsg.next = p;\nprev.next = msg;\n}\n//\u6d88\u606f\u6ca1\u6709\u9000\u51fa\uff0c\u6211\u4eec\u8ba4\u4e3a\u6b64\u65f6mPtr != 0\nif (needWake) {\nnativeWake(mPtr);\n}\n}\nreturn true;\n}\n</code></pre> <p><code>MessageQueue</code>\u662f\u6309\u7167Message\u89e6\u53d1\u65f6\u95f4\u7684\u5148\u540e\u987a\u5e8f\u6392\u5217\u7684\uff0c\u961f\u5934\u7684\u6d88\u606f\u662f\u5c06\u8981\u6700\u65e9\u89e6\u53d1\u7684\u6d88\u606f\u3002\u5f53\u6709\u6d88\u606f\u9700\u8981\u52a0\u5165\u6d88\u606f\u961f\u5217\u65f6\uff0c\u4f1a\u4ece\u961f\u5217\u5934\u5f00\u59cb\u904d\u5386\uff0c\u76f4\u5230\u627e\u5230\u6d88\u606f\u5e94\u8be5\u63d2\u5165\u7684\u5408\u9002\u4f4d\u7f6e\uff0c\u4ee5\u4fdd\u8bc1\u6240\u6709\u6d88\u606f\u7684\u65f6\u95f4\u987a\u5e8f\u3002</p>"},{"location":"front-end/android/system/handler/#33-message","title":"3.3 \u63d0\u53d6\u4e0b\u4e00\u6761message","text":"<p>next()</p> <pre><code>Message next() {\nfinal long ptr = mPtr;\nif (ptr == 0) { //\u5f53\u6d88\u606f\u5faa\u73af\u5df2\u7ecf\u9000\u51fa\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\nreturn null;\n}\nint pendingIdleHandlerCount = -1; // \u5faa\u73af\u8fed\u4ee3\u7684\u9996\u6b21\u4e3a-1\nint nextPollTimeoutMillis = 0;\nfor (;;) {\nif (nextPollTimeoutMillis != 0) {\nBinder.flushPendingCommands();\n}\n//\u963b\u585e\u64cd\u4f5c\uff0c\u5f53\u7b49\u5f85nextPollTimeoutMillis\u65f6\u957f\uff0c\u6216\u8005\u6d88\u606f\u961f\u5217\u88ab\u5524\u9192\uff0c\u90fd\u4f1a\u8fd4\u56de\nnativePollOnce(ptr, nextPollTimeoutMillis);\nsynchronized (this) {\nfinal long now = SystemClock.uptimeMillis();\nMessage prevMsg = null;\nMessage msg = mMessages;\n//\u5f53\u6d88\u606f\u7684Handler\u4e3a\u7a7a\u65f6\uff0c\u5219\u67e5\u8be2\u5f02\u6b65\u6d88\u606f\nif (msg != null &amp;&amp; msg.target == null) {\n//\u5f53\u67e5\u8be2\u5230\u5f02\u6b65\u6d88\u606f\uff0c\u5219\u7acb\u523b\u9000\u51fa\u5faa\u73af\ndo {\nprevMsg = msg;\nmsg = msg.next;\n} while (msg != null &amp;&amp; !msg.isAsynchronous());\n}\nif (msg != null) {\nif (now &lt; msg.when) {\n//\u5f53\u5f02\u6b65\u6d88\u606f\u89e6\u53d1\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c\u5219\u8bbe\u7f6e\u4e0b\u4e00\u6b21\u8f6e\u8be2\u7684\u8d85\u65f6\u65f6\u957f\nnextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE);\n} else {\n// \u83b7\u53d6\u4e00\u6761\u6d88\u606f\uff0c\u5e76\u8fd4\u56de\nmBlocked = false;\nif (prevMsg != null) {\nprevMsg.next = msg.next;\n} else {\nmMessages = msg.next;\n}\nmsg.next = null;\n//\u8bbe\u7f6e\u6d88\u606f\u7684\u4f7f\u7528\u72b6\u6001\uff0c\u5373flags |= FLAG_IN_USE\nmsg.markInUse();\nreturn msg;   //\u6210\u529f\u5730\u83b7\u53d6MessageQueue\u4e2d\u7684\u4e0b\u4e00\u6761\u5373\u5c06\u8981\u6267\u884c\u7684\u6d88\u606f\n}\n} else {\n//\u6ca1\u6709\u6d88\u606f\nnextPollTimeoutMillis = -1;\n}\n//\u6d88\u606f\u6b63\u5728\u9000\u51fa\uff0c\u8fd4\u56denull\nif (mQuitting) {\ndispose();\nreturn null;\n}\n//\u5f53\u6d88\u606f\u961f\u5217\u4e3a\u7a7a\uff0c\u6216\u8005\u662f\u6d88\u606f\u961f\u5217\u7684\u7b2c\u4e00\u4e2a\u6d88\u606f\u65f6\nif (pendingIdleHandlerCount &lt; 0 &amp;&amp; (mMessages == null || now &lt; mMessages.when)) {\npendingIdleHandlerCount = mIdleHandlers.size();\n}\nif (pendingIdleHandlerCount &lt;= 0) {\n//\u6ca1\u6709idle handlers \u9700\u8981\u8fd0\u884c\uff0c\u5219\u5faa\u73af\u5e76\u7b49\u5f85\u3002\nmBlocked = true;\ncontinue;\n}\nif (mPendingIdleHandlers == null) {\nmPendingIdleHandlers = new IdleHandler[Math.max(pendingIdleHandlerCount, 4)];\n}\nmPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers);\n}\n//\u53ea\u6709\u7b2c\u4e00\u6b21\u5faa\u73af\u65f6\uff0c\u4f1a\u8fd0\u884cidle handlers\uff0c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u91cd\u7f6ependingIdleHandlerCount\u4e3a0.\nfor (int i = 0; i &lt; pendingIdleHandlerCount; i++) {\nfinal IdleHandler idler = mPendingIdleHandlers[i];\nmPendingIdleHandlers[i] = null; //\u53bb\u6389handler\u7684\u5f15\u7528\nboolean keep = false;\ntry {\nkeep = idler.queueIdle();  //idle\u65f6\u6267\u884c\u7684\u65b9\u6cd5\n} catch (Throwable t) {\nLog.wtf(TAG, \"IdleHandler threw exception\", t);\n}\nif (!keep) {\nsynchronized (this) {\nmIdleHandlers.remove(idler);\n}\n}\n}\n//\u91cd\u7f6eidle handler\u4e2a\u6570\u4e3a0\uff0c\u4ee5\u4fdd\u8bc1\u4e0d\u4f1a\u518d\u6b21\u91cd\u590d\u8fd0\u884c\npendingIdleHandlerCount = 0;\n//\u5f53\u8c03\u7528\u4e00\u4e2a\u7a7a\u95f2handler\u65f6\uff0c\u4e00\u4e2a\u65b0message\u80fd\u591f\u88ab\u5206\u53d1\uff0c\u56e0\u6b64\u65e0\u9700\u7b49\u5f85\u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2pending message.\nnextPollTimeoutMillis = 0;\n}\n}\n</code></pre> <p><code>nativePollOnce</code>\u662f\u963b\u585e\u64cd\u4f5c\uff0c\u5176\u4e2d<code>nextPollTimeoutMillis</code>\u4ee3\u8868\u4e0b\u4e00\u4e2a\u6d88\u606f\u5230\u6765\u524d\uff0c\u8fd8\u9700\u8981\u7b49\u5f85\u7684\u65f6\u957f\uff1b\u5f53nextPollTimeoutMillis = -1\u65f6\uff0c\u8868\u793a\u6d88\u606f\u961f\u5217\u4e2d\u65e0\u6d88\u606f\uff0c\u4f1a\u4e00\u76f4\u7b49\u5f85\u4e0b\u53bb\u3002</p> <p>\u5f53\u5904\u4e8e\u7a7a\u95f2\u65f6\uff0c\u5f80\u5f80\u4f1a\u6267\u884c<code>IdleHandler</code>\u4e2d\u7684\u65b9\u6cd5\u3002\u5f53nativePollOnce()\u8fd4\u56de\u540e\uff0cnext()\u4ece<code>mMessages</code>\u4e2d\u63d0\u53d6\u4e00\u4e2a\u6d88\u606f\u3002</p>"},{"location":"front-end/android/system/handler/#4-looper","title":"4. Looper","text":""},{"location":"front-end/android/system/handler/#41-prepare","title":"4.1 prepare()","text":"<pre><code>private static void prepare(boolean quitAllowed) {\n//\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u5141\u8bb8\u6267\u884c\u4e00\u6b21\u8be5\u65b9\u6cd5\uff0c\u7b2c\u4e8c\u6b21\u6267\u884c\u65f6\u7ebf\u7a0b\u7684TLS\u5df2\u6709\u6570\u636e\uff0c\u5219\u4f1a\u629b\u51fa\u5f02\u5e38\u3002\nif (sThreadLocal.get() != null) {\nthrow new RuntimeException(\"Only one Looper may be created per thread\");\n}\n//\u521b\u5efaLooper\u5bf9\u8c61\uff0c\u5e76\u4fdd\u5b58\u5230\u5f53\u524d\u7ebf\u7a0b\u7684TLS\u533a\u57df\nsThreadLocal.set(new Looper(quitAllowed));\n}\n</code></pre> <p>Looper.prepare()\u5728\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u5141\u8bb8\u6267\u884c\u4e00\u6b21\uff0c\u8be5\u65b9\u6cd5\u4f1a\u521b\u5efaLooper\u5bf9\u8c61\uff0cLooper\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u4f1a\u521b\u5efa\u4e00\u4e2aMessageQueue\u5bf9\u8c61\uff0c\u518d\u5c06Looper\u5bf9\u8c61\u4fdd\u5b58\u5230\u5f53\u524d\u7ebf\u7a0bTLS\u3002</p>"},{"location":"front-end/android/system/handler/#42-loop","title":"4.2 loop()","text":"<pre><code>public static void loop() {\nfinal Looper me = myLooper();  //\u83b7\u53d6TLS\u5b58\u50a8\u7684Looper\u5bf9\u8c61 \nfinal MessageQueue queue = me.mQueue;  //\u83b7\u53d6Looper\u5bf9\u8c61\u4e2d\u7684\u6d88\u606f\u961f\u5217\nBinder.clearCallingIdentity();\n//\u786e\u4fdd\u5728\u6743\u9650\u68c0\u67e5\u65f6\u57fa\u4e8e\u672c\u5730\u8fdb\u7a0b\uff0c\u800c\u4e0d\u662f\u8c03\u7528\u8fdb\u7a0b\u3002\nfinal long ident = Binder.clearCallingIdentity();\nfor (;;) { //\u8fdb\u5165loop\u7684\u4e3b\u5faa\u73af\u65b9\u6cd5\nMessage msg = queue.next(); //\u53ef\u80fd\u4f1a\u963b\u585e \nif (msg == null) { //\u6ca1\u6709\u6d88\u606f\uff0c\u5219\u9000\u51fa\u5faa\u73af\nreturn;\n}\n//\u9ed8\u8ba4\u4e3anull\uff0c\u53ef\u901a\u8fc7setMessageLogging()\u65b9\u6cd5\u6765\u6307\u5b9a\u8f93\u51fa\uff0c\u7528\u4e8edebug\u529f\u80fd\nPrinter logging = me.mLogging;  if (logging != null) {\nlogging.println(\"&gt;&gt;&gt;&gt;&gt; Dispatching to \" + msg.target + \" \" +\nmsg.callback + \": \" + msg.what);\n}\nmsg.target.dispatchMessage(msg); //\u7528\u4e8e\u5206\u53d1Message \nif (logging != null) {\nlogging.println(\"&lt;&lt;&lt;&lt;&lt; Finished to \" + msg.target + \" \" + msg.callback);\n}\n//\u6062\u590d\u8c03\u7528\u8005\u4fe1\u606f\nfinal long newIdent = Binder.clearCallingIdentity();\nmsg.recycleUnchecked();  //\u5c06Message\u653e\u5165\u6d88\u606f\u6c60 \n}\n}\n</code></pre> <p>loop()\u8fdb\u5165\u5faa\u73af\u6a21\u5f0f\uff0c\u4e0d\u65ad\u91cd\u590d\u4e0b\u9762\u7684\u64cd\u4f5c\uff0c\u76f4\u5230\u6ca1\u6709\u6d88\u606f\u65f6\u9000\u51fa\u5faa\u73af</p> <ul> <li>\u8bfb\u53d6MessageQueue\u7684\u4e0b\u4e00\u6761Message\uff1b</li> <li>\u628aMessage\u5206\u53d1\u7ed9\u76f8\u5e94\u7684target\uff1b</li> <li>\u518d\u628a\u5206\u53d1\u540e\u7684Message\u56de\u6536\u5230\u6d88\u606f\u6c60\uff0c\u4ee5\u4fbf\u91cd\u590d\u5229\u7528\u3002</li> </ul>"},{"location":"front-end/android/system/handler/#5-handler","title":"5. Handler","text":""},{"location":"front-end/android/system/handler/#51","title":"5.1 \u6d88\u606f\u53d1\u9001","text":"<p>\u4ece\u4e0a\u56fe\uff0c\u53ef\u4ee5\u53d1\u73b0\u6240\u6709\u7684\u53d1\u6d88\u606f\u65b9\u5f0f\uff0c\u6700\u7ec8\u90fd\u662f\u8c03\u7528<code>MessageQueue.enqueueMessage()</code>;</p> <pre><code>private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {\nmsg.target = this;\nif (mAsynchronous) {\nmsg.setAsynchronous(true);\n}\nreturn queue.enqueueMessage(msg, uptimeMillis); }\n</code></pre>"},{"location":"front-end/android/system/handler/#52","title":"5.2 \u6d88\u606f\u5206\u53d1\u673a\u5236","text":"<pre><code> msg.target.dispatchMessage(msg); //msg.target\u4e3ahandler\n</code></pre> <p>\u5728Looper.loop()\u4e2d\uff0c\u5f53\u53d1\u73b0\u6709\u6d88\u606f\u65f6\uff0c\u8c03\u7528\u6d88\u606f\u7684\u76ee\u6807handler\uff0c\u6267\u884cdispatchMessage()\u65b9\u6cd5\u6765\u5206\u53d1\u6d88\u606f\u3002</p> <pre><code>public void dispatchMessage(Message msg) {\nif (msg.callback != null) {\n//\u5f53Message\u5b58\u5728\u56de\u8c03\u65b9\u6cd5\uff0c\u56de\u8c03msg.callback.run()\u65b9\u6cd5\uff1b\nhandleCallback(msg);\n} else {\nif (mCallback != null) {\n//\u5f53Handler\u5b58\u5728Callback\u6210\u5458\u53d8\u91cf\u65f6\uff0c\u56de\u8c03\u65b9\u6cd5handleMessage()\uff1b\nif (mCallback.handleMessage(msg)) {\nreturn;\n}\n}\n//Handler\u81ea\u8eab\u7684\u56de\u8c03\u65b9\u6cd5handleMessage()\nhandleMessage(msg);\n}\n}\n</code></pre> <p><code>Handler</code>\u662f\u6d88\u606f\u673a\u5236\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u8f85\u52a9\u7c7b\uff0c\u66f4\u591a\u7684\u5b9e\u73b0\u90fd\u662f<code>MessageQueue</code>, <code>Message</code>\u4e2d\u7684\u65b9\u6cd5\uff0cHandler\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u52a0\u65b9\u4fbf\u7684\u4f7f\u7528\u6d88\u606f\u673a\u5236\u3002</p>"},{"location":"front-end/android/system/handler/#6","title":"6 . \u603b\u7ed3","text":"<p>\u6700\u540e\u7528\u4e00\u5f20\u56fe\uff0c\u6765\u8868\u793a\u6574\u4e2a\u6d88\u606f\u673a\u5236</p> <p></p> <p>\u56fe\u89e3\uff1a</p> <ul> <li>Handler\u901a\u8fc7sendMessage()\u53d1\u9001Message\u5230MessageQueue\u961f\u5217\uff1b</li> <li>Looper\u901a\u8fc7loop()\uff0c\u4e0d\u65ad\u63d0\u53d6\u51fa\u8fbe\u5230\u89e6\u53d1\u6761\u4ef6\u7684Message\uff0c\u5e76\u5c06Message\u4ea4\u7ed9target\u6765\u5904\u7406\uff1b</li> <li>\u7ecf\u8fc7dispatchMessage()\u540e\uff0c\u4ea4\u56de\u7ed9Handler\u7684handleMessage()\u6765\u8fdb\u884c\u76f8\u5e94\u5730\u5904\u7406\u3002</li> <li>\u5c06Message\u52a0\u5165MessageQueue\u65f6\uff0c\u5f80\u7ba1\u9053\u5199\u5165\u5b57\u7b26\uff0c\u53ef\u4ee5\u4f1a\u5524\u9192loop\u7ebf\u7a0b\uff1b\u5982\u679cMessageQueue\u4e2d\u6ca1\u6709Message\uff0c\u5e76\u5904\u4e8eIdle\u72b6\u6001\uff0c\u5219\u4f1a\u6267\u884cIdelHandler\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff0c\u5f80\u5f80\u7528\u4e8e\u505a\u4e00\u4e9b\u6e05\u7406\u6027\u5730\u5de5\u4f5c\u3002</li> </ul> <p>\u6d88\u606f\u5206\u53d1\u7684\u4f18\u5148\u7ea7\uff1a</p> <ol> <li>Message\u7684\u56de\u8c03\u65b9\u6cd5\uff1a<code>message.callback.run()</code>\uff0c\u4f18\u5148\u7ea7\u6700\u9ad8\uff1b</li> <li>Handler\u7684\u56de\u8c03\u65b9\u6cd5\uff1a<code>Handler.mCallback.handleMessage(msg)</code>\uff0c\u4f18\u5148\u7ea7\u4ec5\u6b21\u4e8e1\uff1b</li> <li>Handler\u7684\u9ed8\u8ba4\u65b9\u6cd5\uff1a<code>Handler.handleMessage(msg)</code>\uff0c\u4f18\u5148\u7ea7\u6700\u4f4e\u3002</li> </ol> <p>\u6d88\u606f\u7f13\u5b58\uff1a</p> <p>\u4e3a\u4e86\u63d0\u4f9b\u6548\u7387\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5927\u5c0f\u4e3a50\u7684Message\u7f13\u5b58\u961f\u5217\uff0c\u51cf\u5c11\u5bf9\u8c61\u4e0d\u65ad\u521b\u5efa\u4e0e\u9500\u6bc1\u7684\u8fc7\u7a0b\u3002</p>"},{"location":"front-end/android/system/handler/#7-handler","title":"7. Handler \u5728\u7cfb\u7edf\u4e2d\u7684\u5e94\u7528","text":""},{"location":"front-end/android/system/handler/#71-handlerthread","title":"7.1 HandlerThread","text":"<p>HandlerThread \u8d77\u5230\u7684\u4f5c\u7528\u5c31\u662f \u65b9\u4fbf\u4e86\u4e3b\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u4e4b\u95f4\u7684\u4ea4\u4e92\uff0c\u4e3b\u7ebf\u7a0b\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 Handler \u6765\u58f0\u660e\u8017\u65f6\u4efb\u52a1\u5e76\u4ea4\u7531\u5b50\u7ebf\u7a0b\u6765\u6267\u884c \u3002\u4f7f\u7528 HandlerThread \u4e5f\u65b9\u4fbf\u5728\u591a\u4e2a\u7ebf\u7a0b\u95f4\u5171\u4eab\uff0c\u4e3b\u7ebf\u7a0b\u548c\u5176\u5b83\u5b50\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u5411 HandlerThread \u4e0b\u53d1\u4efb\u52a1\uff0c\u4e14 HandlerThread \u53ef\u4ee5\u4fdd\u8bc1\u591a\u4e2a\u4efb\u52a1\u6267\u884c\u65f6\u7684\u6709\u5e8f\u6027</p> <pre><code>class MainActivity : AppCompatActivity() {\nprivate val handlerThread = HandlerThread(\"I am HandlerThread\")\nprivate val handler by lazy {\nobject : Handler(handlerThread.looper) {\noverride fun handleMessage(msg: Message) {\nThread.sleep(2000)\nLog.e(\"MainActivity\", \"\u8fd9\u91cc\u662f\u5b50\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u7528\u6765\u6267\u884c\u8017\u65f6\u4efb\u52a1\uff1a\" + Thread.currentThread().name)\n}\n}\n}\noverride fun onCreate(savedInstanceState: Bundle?) {\nsuper.onCreate(savedInstanceState)\nsetContentView(R.layout.activity_main)\nbtn_test.setOnClickListener {\nhandler.sendEmptyMessage(1)\n}\nhandlerThread.start()\n}\n}\n</code></pre> <p>HandlerThread \u662f Thread \u7684\u5b50\u7c7b\uff0c\u5176\u4f5c\u7528\u5c31\u662f\u4e3a\u4e86\u7528\u6765\u6267\u884c\u8017\u65f6\u4efb\u52a1\uff0c\u5176 <code>run()</code>\u65b9\u6cd5\u4f1a\u81ea\u52a8\u4e3a\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a Looper \u5bf9\u8c61\u5e76\u4fdd\u5b58\u5230 <code>mLooper</code>\uff0c\u4e4b\u540e\u5c31\u4e3b\u52a8\u5f00\u542f\u6d88\u606f\u5faa\u73af\uff0c\u8fd9\u6837 HandlerThread \u5c31\u4f1a\u6765\u5faa\u73af\u5904\u7406 Message \u4e86\u3002</p> <pre><code>        public void run() {\nmTid = Process.myTid();\n//\u89e6\u53d1\u5f53\u524d\u7ebf\u7a0b\u521b\u5efa Looper \u5bf9\u8c61\nLooper.prepare();\nsynchronized (this) {\n//\u83b7\u53d6 Looper \u5bf9\u8c61\nmLooper = Looper.myLooper();\n//\u5524\u9192\u6240\u6709\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\nnotifyAll();\n}\n//\u8bbe\u7f6e\u7ebf\u7a0b\u4f18\u5148\u7ea7\nProcess.setThreadPriority(mPriority);\nonLooperPrepared();\n//\u5f00\u542f\u6d88\u606f\u5faa\u73af\nLooper.loop();\nmTid = -1;\n}\n</code></pre>"},{"location":"front-end/android/system/handler/#72-intentservice","title":"7.2 IntentService","text":"<p>IntentService \u662f\u7cfb\u7edf\u63d0\u4f9b\u7684 Service \u5b50\u7c7b\uff0c\u7528\u4e8e\u5728\u540e\u53f0\u4e32\u884c\u6267\u884c\u8017\u65f6\u4efb\u52a1\uff0c\u5728\u5904\u7406\u5b8c\u6240\u6709\u4efb\u52a1\u540e\u4f1a\u81ea\u52a8\u505c\u6b62\uff0c\u4e0d\u5fc5\u6765\u624b\u52a8\u8c03\u7528 <code>stopSelf()</code> \u65b9\u6cd5\u3002\u800c\u4e14\u7531\u4e8eIntentService \u662f\u56db\u5927\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u62e5\u6709\u8f83\u9ad8\u7684\u4f18\u5148\u7ea7\uff0c\u4e0d\u6613\u88ab\u7cfb\u7edf\u6740\u6b7b\uff0c\u56e0\u6b64\u9002\u5408\u7528\u4e8e\u6267\u884c\u4e00\u4e9b\u9ad8\u4f18\u5148\u7ea7\u7684\u5f02\u6b65\u4efb\u52a1</p> <p>Google \u5b98\u65b9\u4ee5\u524d\u4e5f\u63a8\u8350\u5f00\u53d1\u8005\u4f7f\u7528 IntentService\uff0c\u4f46\u662f\u5728 Android 11 \u4e2d\u5df2\u7ecf\u88ab\u6807\u8bb0\u4e3a\u5e9f\u5f03\u72b6\u6001\u4e86\uff0c\u65b0\u7248\u672c\u8ba9\u8003\u8651\u4f7f\u7528workmanager\u6216\u8005JobIntentService</p>"},{"location":"front-end/android/system/handler/#73","title":"7.3 \u540c\u6b65\u5c4f\u969c","text":"<p>\u540c\u6b65\u5c4f\u969c\u673a\u5236\u662f\u4e00\u5957\u4e3a\u4e86\u8ba9\u67d0\u4e9b\u7279\u6b8a\u7684\u6d88\u606f\u5f97\u4ee5\u66f4\u5feb\u88ab\u6267\u884c\u7684\u673a\u5236\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u5047\u8bbe\u4e00\u4e2a\u573a\u666f\uff1a\u6211\u4eec\u5411\u4e3b\u7ebf\u7a0b\u53d1\u9001\u4e86\u4e00\u4e2aUI\u7ed8\u5236\u64cd\u4f5cMessage\uff0c\u800c\u6b64\u65f6\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u975e\u5e38\u591a\uff0c\u90a3\u4e48\u8fd9\u4e2aMessage\u7684\u5904\u7406\u53ef\u80fd\u4f1a\u5f97\u5230\u5ef6\u8fdf\uff0c\u7ed8\u5236\u4e0d\u53ca\u65f6\u9020\u6210\u754c\u9762\u5361\u987f\u3002\u540c\u6b65\u5c4f\u969c\u673a\u5236\u7684\u4f5c\u7528\uff0c\u662f\u8ba9\u8fd9\u4e2a\u7ed8\u5236\u6d88\u606f\u5f97\u4ee5\u8d8a\u8fc7\u5176\u4ed6\u7684\u6d88\u606f\uff0c\u4f18\u5148\u88ab\u6267\u884c\u3002</p> <p>\u6b63\u5e38\u6765\u8bf4\uff0c\u6bcf\u4e00\u4e2aMessage\u5728\u88ab\u63d2\u5165\u5230MessageQueue\u4e2d\u7684\u65f6\u5019\uff0c\u4f1a\u5f3a\u5236\u5176<code>target</code>\u5c5e\u6027\u4e0d\u80fd\u4e3anull\u3002</p> <pre><code>boolean enqueueMessage(Message msg, long when) {\n// Hanlder\u4e0d\u5141\u8bb8\u4e3a\u7a7a\nif (msg.target == null) {\nthrow new IllegalArgumentException(\"Message must have a target.\");\n}\n...\n}\n</code></pre> <p>\u800c target==null\u7684\u7279\u6b8aMessage\u5c31\u662f\u540c\u6b65\u5c4f\u969c</p> <p>\u901a\u8fc7<code>MessageQueue</code>\u4e2d<code>postSyncBarrier</code>\u65b9\u6cd5\u53ef\u4ee5\u63d2\u5165\u540c\u6b65\u5c4f\u969c</p> <pre><code>private int postSyncBarrier(long when) {\nsynchronized (this) {\nfinal int token = mNextBarrierToken++;\nfinal Message msg = Message.obtain();\nmsg.markInUse();\nmsg.when = when;\nmsg.arg1 = token;\nMessage prev = null;\nMessage p = mMessages;\n// \u628a\u5f53\u524d\u9700\u8981\u6267\u884c\u7684Message\u5168\u90e8\u6267\u884c\nif (when != 0) {\nwhile (p != null &amp;&amp; p.when &lt;= when) {\nprev = p;\np = p.next;\n}\n}\n// \u63d2\u5165\u540c\u6b65\u5c4f\u969c\uff08\u6ca1\u6709\u7ed9Message\u8d4b\u503ctarget\u5c5e\u6027\uff0c\u4e14\u63d2\u5165\u5230Message\u961f\u5217\u5934\u90e8\uff09\nif (prev != null) { msg.next = p;\nprev.next = msg;\n} else {\nmsg.next = p;\nmMessages = msg;\n}\nreturn token;\n}\n}\n</code></pre> <p>MessageQueue\u5728\u83b7\u53d6\u4e0b\u4e00\u4e2aMessage\u7684\u65f6\u5019\uff0c\u5982\u679c\u78b0\u5230\u4e86\u540c\u6b65\u5c4f\u969c\uff0c\u90a3\u4e48\u4e0d\u4f1a\u53d6\u51fa\u8fd9\u4e2a\u540c\u6b65\u5c4f\u969c\uff0c\u800c\u662f\u4f1a\u904d\u5386\u540e\u7eed\u7684Message\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\u53d6\u51fa\u5e76\u8fd4\u56de\u3002\u8fd9\u91cc\u8df3\u8fc7\u4e86\u6240\u6709\u7684\u540c\u6b65\u6d88\u606f\uff0c\u76f4\u63a5\u6267\u884c\u5f02\u6b65\u6d88\u606f\u3002\u4e3a\u4ec0\u4e48\u53eb\u540c\u6b65\u5c4f\u969c\uff1f\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5c4f\u853d\u6389\u540c\u6b65\u6d88\u606f\uff0c\u4f18\u5148\u6267\u884c\u5f02\u6b65\u6d88\u606f\u3002</p> <pre><code>Message next() {\n\u00b7\u00b7\u00b7\nif (msg != null &amp;&amp; msg.target == null) {\n// \u540c\u6b65\u5c4f\u969c\uff0c\u627e\u5230\u4e0b\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\ndo {\nprevMsg = msg;\nmsg = msg.next;\n} while (msg != null &amp;&amp; !msg.isAsynchronous());\n}\n\u00b7\u00b7\u00b7\n}\n</code></pre> <p>\u6ce8\u610f\uff0c\u540c\u6b65\u5c4f\u969c\u4e0d\u4f1a\u81ea\u52a8\u79fb\u9664\uff0c\u4f7f\u7528\u5b8c\u6210\u4e4b\u540e\u9700\u8981\u624b\u52a8\u8fdb\u884c\u79fb\u9664\uff0c\u4e0d\u7136\u4f1a\u9020\u6210\u540c\u6b65\u6d88\u606f\u65e0\u6cd5\u88ab\u5904\u7406\u3002</p> <pre><code>Message next() {\n...\n// \u963b\u585e\u65f6\u95f4\nint nextPollTimeoutMillis = 0;\nfor (;;) {\n// \u963b\u585e\u5bf9\u5e94\u65f6\u95f4 \nnativePollOnce(ptr, nextPollTimeoutMillis);\nsynchronized (this) {\nfinal long now = SystemClock.uptimeMillis();\nMessage prevMsg = null;\nMessage msg = mMessages;\nif (msg != null &amp;&amp; msg.target == null) {\n// \u540c\u6b65\u5c4f\u969c\uff0c\u627e\u5230\u4e0b\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\ndo {\nprevMsg = msg;\nmsg = msg.next;\n} while (msg != null &amp;&amp; !msg.isAsynchronous());\n}\n// \u5982\u679c\u4e0a\u9762\u6709\u540c\u6b65\u5c4f\u969c\uff0c\u4f46\u5374\u6ca1\u627e\u5230\u5f02\u6b65\u6d88\u606f\uff0c\n// \u90a3\u4e48msg\u4f1a\u5faa\u73af\u5230\u94fe\u8868\u5c3e\uff0c\u4e5f\u5c31\u662fmsg==null\nif (msg != null) {\n\u00b7\u00b7\u00b7\n} else {\n// \u6ca1\u6709\u6d88\u606f\uff0c\u8fdb\u5165\u963b\u585e\u72b6\u6001\nnextPollTimeoutMillis = -1;\n}\n\u00b7\u00b7\u00b7\n}\n}\n}\n</code></pre> <p>\u901a\u8fc7<code>removeSyncBarrier</code>\u65b9\u6cd5\u79fb\u9664\u540c\u6b65\u5c4f\u969c</p> <pre><code>public void removeSyncBarrier(int token) {\nsynchronized (this) {\nMessage prev = null;\nMessage p = mMessages;\n//\u4ece\u6d88\u606f\u961f\u5217\u627e\u5230 target\u4e3a\u7a7a,\u5e76\u4e14token\u76f8\u7b49\u7684Message\nwhile (p != null &amp;&amp; (p.target != null || p.arg1 != token)) {\nprev = p;\np = p.next;\n}\nfinal boolean needWake;\nif (prev != null) {\nprev.next = p.next;\nneedWake = false;\n} else {\nmMessages = p.next;\nneedWake = mMessages == null || mMessages.target != null;\n}\np.recycleUnchecked();\nif (needWake &amp;&amp; !mQuitting) {\nnativeWake(mPtr);\n}\n}\n}\n</code></pre> <p>\u867d\u7136<code>postSyncBarrier()</code>\u548c <code>removeSyncBarrier</code>\u88ab\u6807\u8bb0\u4f4dhide\uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u662f\u53ef\u4ee5\u901a\u8fc7\u53cd\u5c04\u8c03\u7528\u7684\u3002\u800c\u4e14\u8fd8\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u6dfb\u52a0\u5c4f\u969c\uff08\u5728ViewRootImpl\u4e2drequestLayout\u65f6\u4f1a\u4f7f\u7528\u5230\uff09\u4e4b\u540e\uff0c\u6211\u4eec\u53d1\u9001\u5f02\u6b65\u6d88\u606f\uff0c\u6084\u6084\u4e0a\u8f66\u3002</p> <p>\u6dfb\u52a0\u5f02\u6b65\u6d88\u606f\u65f6\u6709\u4e24\u79cd\u529e\u6cd5\uff1a</p> <ul> <li>\u4f7f\u7528\u5f02\u6b65\u7c7b\u578b\u7684Handler\u53d1\u9001\u7684\u5168\u90e8Message\u90fd\u662f\u5f02\u6b65\u7684</li> <li>\u7ed9Message\u6807\u8bb0\u5f02\u6b65   \u7ed9Message\u6807\u8bb0\u5f02\u6b65\u53ef\u4ee5\u901a\u8fc7\u5b83\u7684setAsynchronous()\u8fdb\u884c\uff0c\u975e\u5e38\u7b80\u5355\u3002</li> </ul> <p>\u8c03\u7528requestLayout()\u65b9\u6cd5\u4e4b\u540e\uff0c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u5f00\u59cb\u8fdb\u884c\u7ed8\u5236\u4efb\u52a1\uff0c\u800c\u662f\u4f1a\u7ed9\u4e3b\u7ebf\u7a0b\u8bbe\u7f6e\u4e00\u4e2a\u540c\u6b65\u5c4f\u5e55\uff0c\u5e76\u8bbe\u7f6eVsync\u4fe1\u53f7\u76d1\u542c\u3002\u5f53Vsync\u4fe1\u53f7\u7684\u5230\u6765\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\u5230\u4e3b\u7ebf\u7a0bHandler\uff0c\u6267\u884c\u6211\u4eec\u4e0a\u4e00\u6b65\u8bbe\u7f6e\u7684\u7ed8\u5236\u76d1\u542c\u4efb\u52a1\uff0c\u5e76\u79fb\u9664\u540c\u6b65\u5c4f\u969c\u3002</p> <pre><code>//ViewRootImpl.java\n@Override\npublic void requestLayout() {\nif (!mHandlingLayoutInLayoutRequest) {\ncheckThread();\nmLayoutRequested = true;\nscheduleTraversals();\n}\n}\nvoid scheduleTraversals() {\nif (!mTraversalScheduled) {\nmTraversalScheduled = true;\n//\u63d2\u5165\u5c4f\u969c\nmTraversalBarrier = mHandler.getLooper().getQueue().postSyncBarrier();\n//\u76d1\u542cVsync\u4fe1\u53f7\uff0c\u7136\u540e\u53d1\u9001\u5f02\u6b65\u6d88\u606f -&gt; \u6267\u884c\u7ed8\u5236\u4efb\u52a1\nmChoreographer.postCallback(\nChoreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);\nif (!mUnbufferedInputDispatch) {\nscheduleConsumeBatchedInput();\n}\nnotifyRendererOfFramePending();\npokeDrawLockIfNeeded();\n}\n}\n</code></pre> <p>\u5728\u7b49\u5f85Vsync\u4fe1\u53f7\u7684\u65f6\u5019\u4e3b\u7ebf\u7a0b\u4ec0\u4e48\u4e8b\u90fd\u6ca1\u5e72\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u4fdd\u8bc1\u5728Vsync\u4fe1\u53f7\u5230\u6765\u65f6\uff0c\u7ed8\u5236\u4efb\u52a1\u53ef\u4ee5\u88ab\u53ca\u65f6\u6267\u884c\uff0c\u4e0d\u4f1a\u9020\u6210\u754c\u9762\u5361\u987f\u3002\u4f46\u8fd9\u6837\u4e5f\u5e26\u6765\u4e86\u76f8\u5bf9\u5e94\u7684\u4ee3\u4ef7\uff1a</p> <ul> <li>\u6211\u4eec\u7684\u540c\u6b65\u6d88\u606f\u6700\u591a\u53ef\u80fd\u88ab\u5ef6\u8fdf\u4e00\u5e27\u7684\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f16ms\uff0c\u624d\u4f1a\u88ab\u6267\u884c</li> <li>\u4e3b\u7ebf\u7a0bLooper\u9020\u6210\u8fc7\u5927\u7684\u538b\u529b\uff0c\u5728VSYNC\u4fe1\u53f7\u5230\u6765\u4e4b\u65f6\uff0c\u624d\u96c6\u4e2d\u5904\u7406\u6240\u6709\u6d88\u606f</li> </ul> <p>\u6539\u5584\u8fd9\u4e2a\u95ee\u9898\u7684\u529e\u6cd5\u662f\u4f7f\u7528\u5f02\u6b65\u6d88\u606f\uff0c\u53d1\u9001\u5f02\u6b65\u6d88\u606f\u4e4b\u540e\uff0c\u5373\u65f6\u662f\u5728\u7b49\u5f85Vsync\u671f\u95f4\u4e5f\u53ef\u4ee5\u6267\u884c\u6211\u4eec\u7684\u4efb\u52a1\uff0c\u8ba9\u6211\u4eec\u8bbe\u7f6e\u7684\u4efb\u52a1\u53ef\u4ee5\u66f4\u5feb\u5f97\u88ab\u6267\u884c\uff08\u5982\u6709\u5fc5\u8981\u624d\u8fd9\u6837\u641e\uff0cUI\u7ed8\u5236\u9ad8\u4e8e\u4e00\u5207\uff09\u4e14\u51cf\u5c11\u4e3b\u7ebf\u7a0b\u7684Looper\u538b\u529b\u3002</p> <p>MessageQueue\u4e4b\u6240\u6709\u5c06\u540c\u6b65\u5c4f\u969c\u7684\u63a5\u53e3\u90fd\u53d8\u6210\u9690\u85cf\u63a5\u53e3\u662f\u4e0d\u60f3\u666e\u901a\u7684\u5f00\u53d1\u8005\u5411\u4e3b\u7ebf\u7a0b\u961f\u5217\u6295\u9012\u540c\u6b65\u5c4f\u969c\u5f71\u54cdVSync\u6d88\u606f\u7684\u6b63\u5e38\u6267\u884c\uff0c\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528\u5f02\u6b65\u6d88\u606f\u548c\u540c\u6b65\u5c4f\u969c\u3002</p>"},{"location":"front-end/android/system/handler/#_1","title":"\u53c2\u8003","text":"<p>Android\u6d88\u606f\u673a\u5236</p> <p>\u5173\u4e8eHandler\u540c\u6b65\u5c4f\u969c\u4f60\u53ef\u80fd\u4e0d\u77e5\u9053\u7684\u95ee\u9898</p>"},{"location":"front-end/flutter/learn/Dart/","title":"Dart \u7b80\u4ecb","text":""},{"location":"front-end/flutter/learn/Dart/#dart_1","title":"Dart \u662f\u4ec0\u4e48\uff1f","text":"<p>Dart \u662f\u4e00\u79cd\u9762\u5411\u5bf9\u8c61\u7684\u3001\u7c7b\u5b9a\u4e49\u7684\u3001\u5355\u7ee7\u627f\u7684\u8bed\u8a00\uff0c\u5b83\u4f7f\u7528 C \u8bed\u8a00\u98ce\u683c\u7684\u8bed\u6cd5\u6765\u6e05\u6670\u5730\u8868\u8fbe\u4ee3\u7801\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u6cdb\u578b\u3001\u51fd\u6570\u5f0f\u7f16\u7a0b\u548c\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u3002Dart \u4ee3\u7801\u53ef\u4ee5\u7f16\u8bd1\u6210\u672c\u5730\u4ee3\u7801\uff08\u4f7f\u7528 dart2native \u547d\u4ee4\uff09\uff0c\u4e5f\u53ef\u4ee5\u7f16\u8bd1\u6210 JavaScript \u4ee3\u7801\uff08\u4f7f\u7528 dart2js \u547d\u4ee4\uff09\u3002</p> <p>Dart \u4ee3\u7801\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u7aef\u8fd0\u884c\uff0c\u4e5f\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u7aef\u8fd0\u884c\u3002Dart \u4ee3\u7801\u53ef\u4ee5\u4f7f\u7528 Flutter \u6846\u67b6\u7f16\u5199\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#dart_2","title":"Dart \u6838\u5fc3\u7279\u6027","text":""},{"location":"front-end/flutter/learn/Dart/#jit-aot","title":"JIT \u4e0e AOT","text":"<p>\u501f\u52a9\u4e8e\u5148\u8fdb\u7684\u5de5\u5177\u94fe\u548c\u7f16\u8bd1\u5668\uff0cDart \u662f\u5c11\u6570\u540c\u65f6\u652f\u6301 <code>JIT</code>\uff08Just In Tim\uff0c\u5373\u65f6\u7f16\u8bd1\uff09\u548c <code>AOT</code>\uff08Ahead of Time\uff0c\u8fd0\u884c\u524d\u7f16\u8bd1\uff09\u7684\u8bed\u8a00\u4e4b\u4e00\u3002</p> <p>\u8bed\u8a00\u5728\u8fd0\u884c\u4e4b\u524d\u901a\u5e38\u90fd\u9700\u8981\u7f16\u8bd1\uff0cJIT \u548c AOT \u5219\u662f\u6700\u5e38\u89c1\u7684\u4e24\u79cd\u7f16\u8bd1\u6a21\u5f0f\u3002</p> <ul> <li> <p>JIT \u5728\u8fd0\u884c\u65f6\u5373\u65f6\u7f16\u8bd1\uff0c\u5728\u5f00\u53d1\u5468\u671f\u4e2d\u4f7f\u7528\uff0c\u53ef\u4ee5\u52a8\u6001\u4e0b\u53d1\u548c\u6267\u884c\u4ee3\u7801\uff0c\u5f00\u53d1\u6d4b\u8bd5\u6548\u7387\u9ad8\uff0c\u4f46\u8fd0\u884c\u901f\u5ea6\u548c\u6267\u884c\u6027\u80fd\u5219\u4f1a\u56e0\u4e3a\u8fd0\u884c\u65f6\u5373\u65f6\u7f16\u8bd1\u53d7\u5230\u5f71\u54cd\u3002</p> </li> <li> <p>AOT \u5373\u63d0\u524d\u7f16\u8bd1\uff0c\u53ef\u4ee5\u751f\u6210\u88ab\u76f4\u63a5\u6267\u884c\u7684\u4e8c\u8fdb\u5236\u4ee3\u7801\uff0c\u8fd0\u884c\u901f\u5ea6\u5feb\u3001\u6267\u884c\u6027\u80fd\u8868\u73b0\u597d\uff0c\u4f46\u6bcf\u6b21\u6267\u884c\u524d\u90fd\u9700\u8981\u63d0\u524d\u7f16\u8bd1\uff0c\u5f00\u53d1\u6d4b\u8bd5\u6548\u7387\u4f4e\u3002</p> </li> </ul> <p>\u5728\u5f00\u53d1\u671f\u4f7f\u7528 JIT \u7f16\u8bd1\uff0c\u53ef\u4ee5\u7f29\u77ed\u4ea7\u54c1\u7684\u5f00\u53d1\u5468\u671f\u3002Flutter \u6700\u53d7\u6b22\u8fce\u7684\u529f\u80fd\u4e4b\u4e00\u70ed\u91cd\u8f7d\uff0c\u6b63\u662f\u57fa\u4e8e\u6b64\u7279\u6027\u3002\u800c\u5728\u53d1\u5e03\u671f\u4f7f\u7528 AOT\uff0c\u5c31\u4e0d\u9700\u8981\u50cf React Native \u90a3\u6837\u5728\u8de8\u5e73\u53f0 JavaScript \u4ee3\u7801\u548c\u539f\u751f Android\u3001iOS \u4ee3\u7801\u4e4b\u95f4\u5efa\u7acb\u4f4e\u6548\u7684\u65b9\u6cd5\u8c03\u7528\u6620\u5c04\u5173\u7cfb\u3002\u6240\u4ee5\u8bf4\uff0cDart \u5177\u6709\u8fd0\u884c\u901f\u5ea6\u5feb\u3001\u6267\u884c\u6027\u80fd\u597d\u7684\u7279\u70b9\u3002</p> <p>AOT \u7684\u5178\u578b\u4ee3\u8868\u662f C/C++\uff0c\u5b83\u4eec\u5fc5\u987b\u5728\u6267\u884c\u524d\u7f16\u8bd1\u6210\u673a\u5668\u7801\uff1b\u800c JIT \u7684\u4ee3\u8868\uff0c\u5219\u5305\u62ec\u4e86\u5982 JavaScript\u3001Python \u7b49\u51e0\u4e4e\u6240\u6709\u7684\u811a\u672c\u8bed\u8a00\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#_1","title":"\u5185\u5b58\u5206\u914d\u4e0e\u5783\u573e\u56de\u6536","text":"<p>Dart VM \u7684\u5185\u5b58\u5206\u914d\u7b56\u7565\u6bd4\u8f83\u7b80\u5355\uff0c\u521b\u5efa\u5bf9\u8c61\u65f6\u53ea\u9700\u8981\u5728\u5806\u4e0a\u79fb\u52a8\u6307\u9488\uff0c\u5185\u5b58\u589e\u957f\u59cb\u7ec8\u662f\u7ebf\u6027\u7684\uff0c\u7701\u53bb\u4e86\u67e5\u627e\u53ef\u7528\u5185\u5b58\u7684\u8fc7\u7a0b\u3002</p> <p>Dart \u7684\u5783\u573e\u56de\u6536\uff0c\u5219\u662f\u91c7\u7528\u4e86\u591a\u751f\u4ee3\u7b97\u6cd5\u3002\u65b0\u751f\u4ee3\u5728\u56de\u6536\u5185\u5b58\u65f6\u91c7\u7528\u201c\u534a\u7a7a\u95f4\u201d\u673a\u5236\uff0c\u89e6\u53d1\u5783\u573e\u56de\u6536\u65f6\uff0cDart \u4f1a\u5c06\u5f53\u524d\u534a\u7a7a\u95f4\u4e2d\u7684\u201c\u6d3b\u8dc3\u201d\u5bf9\u8c61\u62f7\u8d1d\u5230\u5907\u7528\u7a7a\u95f4\uff0c\u7136\u540e\u6574\u4f53\u91ca\u653e\u5f53\u524d\u7a7a\u95f4\u7684\u6240\u6709\u5185\u5b58\u3002\u56de\u6536\u8fc7\u7a0b\u4e2d\uff0cDart \u53ea\u9700\u8981\u64cd\u4f5c\u5c11\u91cf\u7684\u201c\u6d3b\u8dc3\u201d\u5bf9\u8c61\uff0c\u6ca1\u6709\u5f15\u7528\u7684\u5927\u91cf\u201c\u6b7b\u4ea1\u201d\u5bf9\u8c61\u5219\u88ab\u5ffd\u7565\uff0c\u8fd9\u6837\u7684\u56de\u6536\u673a\u5236\u5f88\u9002\u5408 Flutter \u6846\u67b6\u4e2d\u5927\u91cf Widget \u9500\u6bc1\u91cd\u5efa\u7684\u573a\u666f\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#_2","title":"\u5355\u7ebf\u7a0b\u6a21\u578b","text":"<p>Dart \u662f\u5355\u7ebf\u7a0b\u6a21\u578b\uff0c \u5929\u7136\u4e0d\u5b58\u5728\u8d44\u6e90\u7ade\u4e89\u548c\u72b6\u6001\u540c\u6b65\u7684\u95ee\u9898\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9 Dart \u8bed\u8a00\u7684\u5f00\u53d1\u8005\u66f4\u52a0\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\u7684\u5b9e\u73b0\uff0c\u800c\u4e0d\u9700\u8981\u8003\u8651\u591a\u7ebf\u7a0b\u7684\u95ee\u9898\u3002 </p> <p>\u5728 Dart \u4e2d\uff0c\u5e76\u53d1\u662f\u901a\u8fc7 Isolate \u5b9e\u73b0\u7684\u3002Isolate \u662f\u7c7b\u4f3c\u4e8e\u7ebf\u7a0b\u4f46\u4e0d\u5171\u4eab\u5185\u5b58\uff0c\u72ec\u7acb\u8fd0\u884c\u7684 worker\u3002\u8fd9\u6837\u7684\u673a\u5236\uff0c\u5c31\u53ef\u4ee5\u8ba9 Dart \u5b9e\u73b0\u65e0\u9501\u7684\u5feb\u901f\u5206\u914d\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#_3","title":"\u8bed\u8a00\u7279\u6027","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5728dartpad \u6216\u8005 replit \u4e0a\u4f53\u9a8c Dart \u8bed\u8a00\u7684\u7279\u6027\u3002</p> <p>Dart \u5728\u9759\u6001\u8bed\u6cd5\u65b9\u9762\u548c Java \u975e\u5e38\u76f8\u4f3c\uff0c\u5982\u7c7b\u578b\u5b9a\u4e49\u3001\u51fd\u6570\u58f0\u660e\u3001\u6cdb\u578b\u7b49\uff0c\u800c\u5728\u52a8\u6001\u7279\u6027\u65b9\u9762\u53c8\u548c JavaScript \u5f88\u50cf\uff0c\u5982\u51fd\u6570\u5f0f\u7279\u6027\u3001\u5f02\u6b65\u652f\u6301\u7b49\u3002\u9664\u4e86\u878d\u5408 Java \u548c JavaScript \u8bed\u8a00\u4e4b\u6240\u957f\u4e4b\u5916\uff0cDart \u4e5f\u5177\u6709\u4e00\u4e9b\u5176\u4ed6\u5f88\u6709\u8868\u73b0\u529b\u7684\u8bed\u6cd5\uff0c\u5982\u53ef\u9009\u547d\u540d\u53c2\u6570\u3001..\uff08\u7ea7\u8054\u8fd0\u7b97\u7b26\uff09\u548c?.\uff08\u6761\u4ef6\u6210\u5458\u8bbf\u95ee\u8fd0\u7b97\u7b26\uff09\u4ee5\u53ca??\uff08\u5224\u7a7a\u8d4b\u503c\u8fd0\u7b97\u7b26\uff09\u3002</p> <p>Dart \u662f\u4e00\u95e8\u5f3a\u7c7b\u578b\u8bed\u8a00\uff0c\u4f46\u662f\u5b83\u7684\u7c7b\u578b\u7cfb\u7edf\u6bd4\u8f83\u7075\u6d3b\uff0c\u652f\u6301\u7c7b\u578b\u63a8\u65ad\uff0c\u53ef\u4ee5\u8ba9\u5f00\u53d1\u8005\u4e0d\u7528\u663e\u5f0f\u5730\u58f0\u660e\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u800c\u662f\u7531 Dart VM \u81ea\u52a8\u63a8\u65ad\u3002</p> <p>\u5728 Dart \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 var \u6216\u8005\u5177\u4f53\u7684\u7c7b\u578b\u6765\u58f0\u660e\u4e00\u4e2a\u53d8\u91cf\u3002\u5f53\u4f7f\u7528 var \u5b9a\u4e49\u53d8\u91cf\u65f6\uff0c\u8868\u793a\u7c7b\u578b\u662f\u4ea4\u7531\u7f16\u8bd1\u5668\u63a8\u65ad\u51b3\u5b9a\u7684\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u7528\u9759\u6001\u7c7b\u578b\u53bb\u5b9a\u4e49\u53d8\u91cf\uff0c\u66f4\u6e05\u695a\u5730\u8ddf\u7f16\u8bd1\u5668\u8868\u8fbe\u4f60\u7684\u610f\u56fe\uff0c\u8fd9\u6837\u7f16\u8f91\u5668\u548c\u7f16\u8bd1\u5668\u5c31\u80fd\u4f7f\u7528\u8fd9\u4e9b\u9759\u6001\u7c7b\u578b\uff0c\u5411\u4f60\u63d0\u4f9b\u4ee3\u7801\u8865\u5168\u6216\u7f16\u8bd1\u8b66\u544a\u7684\u63d0\u793a\u4e86\u3002</p> <p>Dart \u662f\u7c7b\u578b\u5b89\u5168\u7684\u8bed\u8a00\uff0c\u5e76\u4e14\u6240\u6709\u7c7b\u578b\u90fd\u662f\u5bf9\u8c61\u7c7b\u578b\uff0c\u90fd\u7ee7\u627f\u81ea\u9876\u5c42\u7c7b\u578b Object\uff0c\u56e0\u6b64\u4e00\u5207\u53d8\u91cf\u7684\u503c\u90fd\u662f\u7c7b\u7684\u5b9e\u4f8b\uff08\u5373\u5bf9\u8c61\uff09\uff0c\u751a\u81f3\u6570\u5b57\u3001\u5e03\u5c14\u503c\u3001\u51fd\u6570\u548c null \u4e5f\u90fd\u662f\u7ee7\u627f\u81ea Object \u7684\u5bf9\u8c61\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#_4","title":"\u57fa\u672c\u8bed\u6cd5","text":""},{"location":"front-end/flutter/learn/Dart/#var","title":"<code>var</code>","text":"<p>var \u662f Dart \u4e2d\u7684\u5173\u952e\u5b57\uff0c\u7528\u4e8e\u58f0\u660e\u53d8\u91cf\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u8ba9\u7f16\u8bd1\u5668\u81ea\u52a8\u63a8\u65ad\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u56e0\u6b64 var \u5b9a\u4e49\u7684\u53d8\u91cf\u662f\u6ca1\u6709\u7c7b\u578b\u7684\uff0c\u5b83\u7684\u7c7b\u578b\u662f\u7531\u7f16\u8bd1\u5668\u63a8\u65ad\u51fa\u6765\u7684\u3002</p> <p>Dart \u4e2d var \u53d8\u91cf\u4e00\u65e6\u8d4b\u503c\uff0c\u7c7b\u578b\u4fbf\u4f1a\u786e\u5b9a\uff0c\u5219\u4e0d\u80fd\u518d\u6539\u53d8\u5176\u7c7b\u578b\uff0c\u5982\uff1a</p> <pre><code> var t = \"hi world\";\n// \u4e0b\u9762\u4ee3\u7801\u5728dart\u4e2d\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a\u53d8\u91cft\u7684\u7c7b\u578b\u5df2\u7ecf\u786e\u5b9a\u4e3aString\uff0c\n// \u7c7b\u578b\u4e00\u65e6\u786e\u5b9a\u540e\u5219\u4e0d\u80fd\u518d\u66f4\u6539\u5176\u7c7b\u578b\u3002\nt = 1000;\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#finalconst","title":"<code>final\u548cconst</code>","text":"<p>\u5728 Dart \u4e2d\uff0cfinal \u548c const \u90fd\u53ef\u4ee5\u7528\u6765\u5b9a\u4e49\u5e38\u91cf\uff0c\u4f46\u662f\u5b83\u4eec\u4e4b\u95f4\u6709\u4e00\u4e9b\u7ec6\u5fae\u7684\u533a\u522b\u3002 </p> <ul> <li> <p>const\uff0c\u8868\u793a\u53d8\u91cf\u5728\u7f16\u8bd1\u671f\u95f4\u5373\u80fd\u786e\u5b9a\u7684\u503c\uff1b</p> </li> <li> <p>final \u5219\u4e0d\u592a\u4e00\u6837\uff0c\u7528\u5b83\u5b9a\u4e49\u7684\u53d8\u91cf\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u786e\u5b9a\u503c\uff0c\u800c\u4e00\u65e6\u786e\u5b9a\u540e\u5c31\u4e0d\u53ef\u518d\u53d8\u3002</p> </li> </ul> <pre><code>//\u53ef\u4ee5\u7701\u7565String\u8fd9\u4e2a\u7c7b\u578b\u58f0\u660e\nfinal str = \"hi world\";\n//final String str = \"hi world\"; \nconst str1 = \"hi world\";\n//const String str1 = \"hi world\";\n</code></pre> <p>const \u9002\u7528\u4e8e\u5b9a\u4e49\u7f16\u8bd1\u5e38\u91cf\uff08\u5b57\u9762\u91cf\u56fa\u5b9a\u503c\uff09\u7684\u573a\u666f\uff0c\u800c final \u9002\u7528\u4e8e\u5b9a\u4e49\u8fd0\u884c\u65f6\u5e38\u91cf\u7684\u573a\u666f\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#null-safety","title":"<code>\u7a7a\u5b89\u5168\uff08null-safety\uff09</code>","text":"<p>Dart 2.12 \u7248\u672c\u5f15\u5165\u4e86\u7a7a\u5b89\u5168\uff08null-safety\uff09\u7279\u6027\uff0c\u5b83\u662f\u4e00\u79cd\u9759\u6001\u7c7b\u578b\u68c0\u67e5\uff0c\u53ef\u4ee5\u8ba9\u4f60\u5728\u7f16\u8bd1\u65f6\u5c31\u53d1\u73b0\u7a7a\u6307\u9488\u5f02\u5e38\uff0c\u800c\u4e0d\u662f\u5728\u8fd0\u884c\u65f6\u624d\u53d1\u73b0\u3002</p> <pre><code>int i = 8; //\u9ed8\u8ba4\u4e3a\u4e0d\u53ef\u7a7a\uff0c\u5fc5\u987b\u5728\u5b9a\u4e49\u65f6\u521d\u59cb\u5316\u3002\n// \u5982\u679c\u6211\u4eec\u9884\u671f\u53d8\u91cf\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u4f46\u5728\u5b9a\u4e49\u65f6\u4e0d\u80fd\u786e\u5b9a\u5176\u521d\u59cb\u503c\uff0c\u5219\u53ef\u4ee5\u52a0\u4e0alate\u5173\u952e\u5b57\uff0c\n// \u8868\u793a\u4f1a\u7a0d\u540e\u521d\u59cb\u5316\uff0c\u4f46\u662f\u5728\u6b63\u5f0f\u4f7f\u7528\u5b83\u4e4b\u524d\u5fc5\u987b\u5f97\u4fdd\u8bc1\u521d\u59cb\u5316\u8fc7\u4e86\uff0c\u5426\u5219\u4f1a\u62a5\u9519\nlate int k;\nk=9;\nString? str ;  // \u5b9a\u4e49\u4e3a\u53ef\u7a7a\u7c7b\u578b\uff0c\u5bf9\u4e8e\u53ef\u7a7a\u53d8\u91cf\uff0c\u6211\u4eec\u5728\u4f7f\u7528\u524d\u5fc5\u987b\u5224\u7a7a\u3002\nprint(str!.length); //\u5982\u679cstr\u4e3anull\uff0c\u8fd9\u91cc\u4f1a\u62a5\u9519\nif(str !=null){\nprint(str!.length); //\u56e0\u4e3a\u5df2\u7ecf\u5224\u8fc7\u7a7a\uff0c\u6240\u4ee5\u80fd\u8d70\u5230\u8fd9 i \u5fc5\u4e0d\u4e3anull\n}\nprint(str?.hashCode); // \u5982\u679c\u6211\u4eec\u9884\u671f\u53d8\u91cf\u53ef\u80fd\u4e3a\u7a7a\uff0c\u4f46\u662f\u5728\u4f7f\u7528\u524d\u6211\u4eec\u53c8\u4e0d\u60f3\u5224\u7a7a\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528?\u64cd\u4f5c\u7b26\uff0c\nstr = \"test\";\nprint(str!.length); // \u6b63\u786e\uff0cstr\u4e0d\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u4f7f\u7528\uff01\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#string","title":"<code>String</code>","text":"<p><code>Dart \u7684 String \u7531 UTF-16 \u7684\u5b57\u7b26\u4e32\u7ec4\u6210</code>\u3002\u548c JavaScript \u4e00\u6837\uff0c\u6784\u9020\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u65f6\u65e2\u80fd\u4f7f\u7528\u5355\u5f15\u53f7\u4e5f\u80fd\u4f7f\u7528\u53cc\u5f15\u53f7\uff0c\u8fd8\u80fd\u5728\u5b57\u7b26\u4e32\u4e2d\u5d4c\u5165\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\uff1a\u4f60\u53ef\u4ee5\u4f7f\u7528 ${express} \u628a\u4e00\u4e2a\u8868\u8fbe\u5f0f\u7684\u503c\u653e\u8fdb\u5b57\u7b26\u4e32\u3002\u800c\u5982\u679c\u662f\u4e00\u4e2a\u6807\u8bc6\u7b26\uff0c\u4f60\u53ef\u4ee5\u7701\u7565{}\u3002</p> <pre><code>var s = 'cat';\nvar s1 = 'this is a uppercased string: ${s.toUpperCase()}';\n// \u5b57\u7b26\u4e32\u62fc\u88c5\nvar s2 = 'Hello' + ' ' + 'World!' ;\n// \u5bf9\u4e8e\u591a\u884c\u5b57\u7b26\u4e32\u7684\u6784\u5efa\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e09\u4e2a\u5355\u5f15\u53f7\u6216\u4e09\u4e2a\u53cc\u5f15\u53f7\u7684\u65b9\u5f0f\u58f0\u660e\uff0c\u8fd9\u4e0e Python \u662f\u4e00\u81f4\u7684\uff1a\nvar s3 = \"\"\"This is a\nmulti-line string.\"\"\";\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#_5","title":"\u8fd0\u7b97\u7b26","text":"<p>\u8fd0\u7b97\u7b26Dart \u548c\u7edd\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u7684\u8fd0\u7b97\u7b26\u4e00\u6837\u3002</p> <p>\u4e0d\u8fc7\uff0cDart \u591a\u4e86\u4e00\u4e9b\u989d\u5916\u7684\u8fd0\u7b97\u7b26\uff0c\u6bd4\u5982 <code>?.</code>\u3001<code>??=</code>\u3001<code>??</code>\u3001<code>..</code>\u3001<code>...</code>\u3001<code>...?</code></p> <ul> <li> <p>?. \u8fd0\u7b97\u7b26\uff1a\u5982\u679c?.\u5de6\u4fa7\u7684\u64cd\u4f5c\u6570\u4e3a null\uff0c\u5219\u8fd4\u56de null\uff0c\u5426\u5219\u5c31\u5bf9?.\u53f3\u4fa7\u7684\u64cd\u4f5c\u6570\u6c42\u503c\u3002     <pre><code>var a;\nprint(a?.length); // null\n</code></pre></p> </li> <li> <p>??= \u8fd0\u7b97\u7b26\uff1a\u5982\u679c p \u4e3a null\uff0c\u90a3\u4e48 p = Point(1, 2) \u5c31\u4f1a\u62a5\u9519\u3002\u4f46\u662f\uff0cp ??= Point(1, 2) \u5c31\u4e0d\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a ??= \u8fd0\u7b97\u7b26\u7684\u4f5c\u7528\u662f\uff0c\u5982\u679c p \u4e3a null\uff0c\u90a3\u4e48\u5c31\u628a Point(1, 2) \u8d4b\u503c\u7ed9 p\u3002</p> </li> <li> <p>?? \u8fd0\u7b97\u7b26\uff1a\u5982\u679c p \u4e3a null\uff0c\u90a3\u4e48 p ?? Point(1, 2) \u5c31\u4f1a\u8fd4\u56de Point(1, 2)\u3002\u5982\u679c p \u4e0d\u4e3a null\uff0c\u90a3\u4e48 p ?? Point(1, 2) \u5c31\u4f1a\u8fd4\u56de p\u3002</p> </li> <li> <p>.. \u8fd0\u7b97\u7b26\uff1a.. \u8fd0\u7b97\u7b26\u53ef\u4ee5\u7528\u4e8e\u7ea7\u8054\u8c03\u7528\uff08<code>cascade notation</code>\uff09\uff0c\u5b83\u5141\u8bb8\u4f60\u5728\u540c\u4e00\u4e2a\u5bf9\u8c61\u4e0a\u6267\u884c\u591a\u4e2a\u64cd\u4f5c\u3002</p> <pre><code>var sb = StringBuffer()\n..write('foo')\n..write('bar');\nprint(sb); // foobar\n</code></pre> </li> <li> <p>.../ ...?  \u8fd0\u7b97\u7b26  \uff1a... \u8fd0\u7b97\u7b26\u53ef\u4ee5\u7528\u4e8e\u5c55\u5f00\u4e00\u4e2a\u96c6\u5408\u7684\u5143\u7d20\uff0c\u6bd4\u5982\uff1a</p> <pre><code>var list = [1, 2, 3];\nvar list2 = [0, ...list];\nprint(list2); // [0, 1, 2, 3]\n// ...? \u8fd0\u7b97\u7b26\u53ef\u4ee5\u7528\u4e8e\u5c55\u5f00\u4e00\u4e2a\u96c6\u5408\u7684\u5143\u7d20\uff0c\u4f46\u662f\u5982\u679c\u96c6\u5408\u4e3a null\uff0c\u90a3\u4e48\u5c31\u4e0d\u5c55\u5f00\nvar list3;\nvar list4 = [0, ...?list3];\nprint(list4); // [0]\n</code></pre> </li> </ul>"},{"location":"front-end/flutter/learn/Dart/#_6","title":"\u51fd\u6570","text":"<p>Dart \u8bed\u8a00\u4e2d\u7684\u51fd\u6570\u662f\u4e00\u7b49\u516c\u6c11\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u8fd4\u56de\u503c\u8fd4\u56de\u3002</p> <pre><code>// \u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\nint add(int a, int b) {\nreturn a + b;\n}\n// \u7bad\u5934\u51fd\u6570\nint add1(int a, int b) =&gt; a + b;\n// \u53ef\u9009\u53c2\u6570\nint add2(int a, int b, [int c]) {\nreturn a + b + (c ?? 0);\n}\n// \u53ef\u9009\u547d\u540d\u53c2\u6570\nint add3(int a, int b, {int c}) {\nreturn a + b + (c ?? 0);\n}\n// \u8c03\u7528\u51fd\u6570\nadd(1, 2);\n// \u53ef\u9009\u53c2\u6570\nadd2(1, 2, 3);\n// \u547d\u540d\u53c2\u6570\nadd3(1, 2, c: 3);\n//\u51fd\u6570\u4f5c\u4e3a\u53d8\u91cf\nvar say = (str){\nprint(str);\n};\nsay(\"hi world\");\n// \u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\nvoid execute(var callback) {\ncallback();\n}\nexecute(() =&gt; print(\"xxx\"))\n</code></pre> <p>Dart \u8ba4\u4e3a\u91cd\u8f7d\u4f1a\u5bfc\u81f4\u6df7\u4e71\uff0c\u56e0\u6b64\u4ece\u8bbe\u8ba1\u4e4b\u521d\u5c31\u4e0d\u652f\u6301\u91cd\u8f7d\uff0c\u800c\u662f\u63d0\u4f9b\u4e86\u53ef\u9009\u547d\u540d\u53c2\u6570\u548c\u53ef\u9009\u53c2\u6570\u3002</p> <p>\u5728\u58f0\u660e\u51fd\u6570\u65f6\uff1a</p> <ul> <li>\u7ed9\u53c2\u6570\u589e\u52a0{}\uff0c\u4ee5 paramName: value \u7684\u65b9\u5f0f\u6307\u5b9a\u8c03\u7528\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u53ef\u9009\u547d\u540d\u53c2\u6570\uff1b</li> <li>\u7ed9\u53c2\u6570\u589e\u52a0[]\uff0c\u5219\u610f\u5473\u7740\u8fd9\u4e9b\u53c2\u6570\u662f\u53ef\u4ee5\u5ffd\u7565\u7684\uff0c\u4e5f\u5c31\u662f\u53ef\u9009\u53c2\u6570\u3002</li> </ul> <p>\u53ef\u9009\u53c2\u6570\u548c\u547d\u540d\u53c2\u6570\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u9ed8\u8ba4\u503c\uff0c\u4f46\u662f\u53ef\u9009\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u53ea\u80fd\u901a\u8fc7\u4f4d\u7f6e\u6765\u786e\u5b9a\uff0c\u800c\u547d\u540d\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u53ea\u80fd\u901a\u8fc7\u540d\u79f0\u6765\u786e\u5b9a\u3002</p> <p>\u53ef\u9009\u547d\u540d\u53c2\u6570\u5728Flutter\u4e2d\u4f7f\u7528\u975e\u5e38\u591a\u3002\u6ce8\u610f\uff0c\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u53ef\u9009\u7684\u4f4d\u7f6e\u53c2\u6570\u548c\u53ef\u9009\u7684\u547d\u540d\u53c2\u6570</p>"},{"location":"front-end/flutter/learn/Dart/#_7","title":"\u7c7b","text":"<p>Dart \u4e2d\u5e76\u6ca1\u6709 public\u3001protected\u3001private \u8fd9\u4e9b\u5173\u952e\u5b57\uff0c\u6211\u4eec\u53ea\u8981\u5728\u58f0\u660e\u53d8\u91cf\u4e0e\u65b9\u6cd5\u65f6\uff0c\u5728\u524d\u9762\u52a0\u4e0a\u201c\u201d\u5373\u53ef\u4f5c\u4e3a private \u65b9\u6cd5\u4f7f\u7528\u3002\u5982\u679c\u4e0d\u52a0\u201c\u201d\uff0c\u5219\u9ed8\u8ba4\u4e3a public\u3002\u4e0d\u8fc7\uff0c\u201c_\u201d\u7684\u9650\u5236\u8303\u56f4\u5e76\u4e0d\u662f\u7c7b\u8bbf\u95ee\u7ea7\u522b\u7684\uff0c\u800c\u662f\u5e93\u8bbf\u95ee\u7ea7\u522b\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#_8","title":"\u7c7b\u7684\u6784\u9020","text":"<pre><code>class Person {\nString name;\nint age;\n// \u9ed8\u8ba4\u6784\u9020\u51fd\u6570\nPerson(this.name, this.age);\n// \u547d\u540d\u6784\u9020\u51fd\u6570\nPerson.withName(String name) : this(name, 10);\n// \u547d\u540d\u6784\u9020\u51fd\u6570\nPerson.withNameAndAge(this.name, this.age);\nvoid printInfo() {\nprint('name: $name, age: $age');\n}\n}\nvoid main() {\nvar p = Person.withName(\"test\");\nvar p1 = Person.withNameAndAge(\"dd\",100);\np.printInfo(); // \u8f93\u51fa(name: test, age: 10)\np1.printInfo(); // \u8f93\u51fa(name: dd, age: 100)\n}\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#mixin","title":"\u7c7b\u7684\u6df7\u5165(Mixin)","text":"<p>Dart \u662f\u4e0d\u652f\u6301\u591a\u7ee7\u627f\u7684\uff0c\u4f46\u662f\u5b83\u652f\u6301 mixin\uff0c\u7b80\u5355\u6765\u8bb2 mixin \u53ef\u4ee5 \u201c\u7ec4\u5408\u201d \u591a\u4e2a\u7c7b\u7684\u529f\u80fd\uff0c\u800c\u4e0d\u662f\u7ee7\u627f\u5b83\u4eec\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u89e3\u51b3 Dart \u7f3a\u5c11\u5bf9\u591a\u91cd\u7ee7\u627f\u7684\u652f\u6301\u95ee\u9898\uff0c\u8fd8\u80fd\u591f\u907f\u514d\u7531\u4e8e\u591a\u91cd\u7ee7\u627f\u53ef\u80fd\u5bfc\u81f4\u7684\u6b67\u4e49\uff08\u83f1\u5f62\u95ee\u9898\uff09\u3002</p> <p>\u7ee7\u627f\u6b67\u4e49\uff0c\u4e5f\u53eb\u83f1\u5f62\u95ee\u9898\uff0c\u662f\u652f\u6301\u591a\u7ee7\u627f\u7684\u7f16\u7a0b\u8bed\u8a00\u4e2d\u4e00\u4e2a\u76f8\u5f53\u68d8\u624b\u7684\u95ee\u9898\u3002\u5f53 B \u7c7b\u548c C \u7c7b\u7ee7\u627f\u81ea A \u7c7b\uff0c\u800c D \u7c7b\u7ee7\u627f\u81ea B \u7c7b\u548c C \u7c7b\u65f6\u4f1a\u4ea7\u751f\u6b67\u4e49\u3002\u5982\u679c A \u4e2d\u6709\u4e00\u4e2a\u65b9\u6cd5\u5728 B \u548c C \u4e2d\u5df2\u7ecf\u8986\u5199\uff0c\u800c D \u6ca1\u6709\u8986\u5199\u5b83\uff0c\u90a3\u4e48 D \u7ee7\u627f\u7684\u65b9\u6cd5\u7684\u7248\u672c\u662f B \u7c7b\uff0c\u8fd8\u662f C \u7c7b\u7684\u5462\uff1f</p> <p>\u8981\u4f7f\u7528\u6df7\u5165\uff0c\u53ea\u9700\u8981 <code>with</code> \u5173\u952e\u5b57\u5373\u53ef</p> <pre><code>abstract class Person {\nString name;\nint age;\nPerson(this.name, this.age);\nvoid printInfo();\n}\nabstract class Student {\nvoid study();\n}\nclass PersonStudent extends Person with Student {\nPersonStudent(String name, int age) : super(name, age);\n@override\nvoid printInfo() {\nprint('name: $name, age: $age, type: PersonStudent');\n}\n@override\nvoid study() {\nprint('name: $name, age: $age, type: PersonStudent, study');\n}\n}\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#_9","title":"\u5f02\u6b65","text":"<p>Dart \u8bed\u8a00\u4e2d\u7684\u5f02\u6b65\uff0c\u662f\u901a\u8fc7 <code>Future</code> \u548c <code>Stream</code> \u5b9e\u73b0\u7684\u3002<code>Isolate</code> \u4e5f\u662f\u4e00\u79cd\u5f02\u6b65\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002 </p> <p><code>async</code>\u548c<code>await</code>\u5173\u952e\u8bcd\u652f\u6301\u4e86\u5f02\u6b65\u7f16\u7a0b\uff0c\u5141\u8bb8\u60a8\u5199\u51fa\u548c\u540c\u6b65\u4ee3\u7801\u5f88\u50cf\u7684\u5f02\u6b65\u4ee3\u7801\u3002</p>"},{"location":"front-end/flutter/learn/Dart/#future","title":"Future","text":"<p><code>Future</code>\u4e0eJavaScript\u4e2d\u7684<code>Promise</code>\u975e\u5e38\u76f8\u4f3c \uff0c \u8868\u793a\u4e00\u4e2a\u5f02\u6b65\u64cd\u4f5c\u7684\u6700\u7ec8\u5b8c\u6210\uff08\u6216\u5931\u8d25\uff09\u53ca\u5176\u7ed3\u679c\u503c\u7684\u8868\u793a\u3002\u4e00\u4e2aFuture\u53ea\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u7ed3\u679c\uff0c\u8981\u4e48\u6210\u529f\uff0c\u8981\u4e48\u5931\u8d25\u3002</p> <p>Future \u7684\u6240\u6709API\u7684\u8fd4\u56de\u503c\u4ecd\u7136\u662f\u4e00\u4e2aFuture\u5bf9\u8c61\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u8fdb\u884c\u94fe\u5f0f\u8c03\u7528\u3002</p> <pre><code>Future&lt;String&gt; lookUpVersion() =&gt; Future.delayed(Duration(seconds: 2), () =&gt; '1.0.0');\nvoid main() {\nprint('start');\nlookUpVersion().then((value) =&gt; print(value));\nprint('end');\n}\n// \u8f93\u51fa\nstart\nend\n1.0.0\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#asyncawait","title":"<code>async</code>\u548c<code>await</code>","text":"<p><code>async</code>\u548c<code>await</code>\u5173\u952e\u8bcd\u652f\u6301\u4e86\u5f02\u6b65\u7f16\u7a0b\uff0c\u5141\u8bb8\u60a8\u5199\u51fa\u548c\u540c\u6b65\u4ee3\u7801\u5f88\u50cf\u7684\u5f02\u6b65\u4ee3\u7801\u3002</p> <p><code>async</code>\u5173\u952e\u5b57\u7528\u4e8e\u58f0\u660e\u4e00\u4e2a\u5f02\u6b65\u51fd\u6570\uff0c<code>await</code>\u5173\u952e\u5b57\u7528\u4e8e\u7b49\u5f85\u4e00\u4e2a\u5f02\u6b65\u51fd\u6570\u6267\u884c\u5b8c\u6210\u3002</p> <pre><code>import 'dart:async';\nvoid main() async {\nprint('start');\nawait printAsync();\nprint('end');\n}\nFuture printAsync() async {\nawait Future.delayed(Duration(seconds: 2));\nprint('printAsync');\n}\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#stream","title":"Stream","text":"<p><code>Stream</code>\u662f\u4e00\u4e2a\u5f02\u6b65\u4e8b\u4ef6\u5e8f\u5217\uff0c\u7b80\u5355\u7406\u89e3\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5f02\u6b65\u6570\u636e\u961f\u5217\uff0c \u5b83\u53ef\u4ee5\u662f\u5355\u8ba2\u9605\u6216\u8005\u5e7f\u64ad\u3002</p> <pre><code>import 'dart:async';\nvoid main() {\nvoid main(){\ntest();\n}\ntest() async{\n// \u4f7f\u7528 periodic \u521b\u5efa\u6d41\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u95f4\u9694\u65f6\u95f4\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u56de\u8c03\u51fd\u6570\nStream&lt;int&gt; stream = Stream&lt;int&gt;.periodic(Duration(seconds: 1), callback);\n// await for\u5faa\u73af\u4ece\u6d41\u4e2d\u8bfb\u53d6\n//   await for(var i in stream){\n//     print(i);\n//   }\n// \u4f7f\u7528listen\u76d1\u542c\u6d41\nstream.listen((value) =&gt; print(value));\n}\nint callback(int value){\nreturn value;\n}\n// \u8f93\u51fa\n1\n2\n3\n....\n</code></pre> <p>\u5355\u8ba2\u9605\u7684Stream\u53ea\u80fd\u88ab\u76d1\u542c\u4e00\u6b21\uff0c\u800c\u5e7f\u64ad\u7684Stream\u53ef\u4ee5\u88ab\u76d1\u542c\u591a\u6b21\u3002</p> <pre><code>import 'dart:async';\nvoid main() {\nStream&lt;int&gt; stream = Stream&lt;int&gt;.periodic(Duration(seconds: 1), callback);\nstream.listen((value) =&gt; print(value));\n// stream.listen((value) =&gt; print(value)); // \u62a5\u9519\uff0c\u56e0\u4e3a\u6d41\u53ea\u80fd\u88ab\u76d1\u542c\u4e00\u6b21 \"Unhandled exception:Bad state: Stream has already been listened to.\"\nStream&lt;int&gt; stream = Stream&lt;int&gt;.periodic(Duration(seconds: 1), callback).asBroadcastStream(); // \u8f6c\u6362\u6210\u5e7f\u64ad\u7684Stream\nstream.listen((value) =&gt; print(value));\nstream.listen((value) =&gt; print(value)); // \u6b63\u5e38\u8f93\u51fa \uff0c\u5e7f\u64ad\u7684Stream\u53ef\u4ee5\u88ab\u76d1\u542c\u591a\u6b21\n}\n</code></pre>"},{"location":"front-end/flutter/learn/Dart/#isolate","title":"Isolate","text":"<p><code>Isolate</code>\u662fDart\u4e2d\u7684\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u5e76\u53d1\u6267\u884c\u5355\u5143\uff0c\u4f46\u662f\u5b83\u4e0d\u662f\u4e00\u4e2a\u7ebf\u7a0b\u3002\u5b83\u662f\u4e00\u4e2a\u7ebf\u7a0b\u7684\u6a21\u62df\uff0c\u5b83\u53ef\u4ee5\u5728\u5355\u4e2a\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u591a\u4e2a<code>Isolate</code>\uff0c\u5e76\u4e14\u5b83\u4eec\u4e4b\u95f4\u4e0d\u4f1a\u5171\u4eab\u5185\u5b58\u3002</p> <pre><code>import 'dart:isolate';\nvoid main() {\nIsolate.spawn(foo, 'hello');\nIsolate.spawn(foo, 'world');\n}\nvoid foo(String message) {\nprint(message);\n}\n// \u8f93\u51fa\nhello\nworld\n</code></pre>"},{"location":"front-end/flutter/learn/flutter/","title":"flutter\u6838\u5fc3\u539f\u7406","text":""},{"location":"front-end/flutter/tools/fvm/","title":"\u4f7f\u7528fvm \u7ba1\u7406\u591a\u4e2a\u7248\u672cflutter","text":"<p>\u4ee5\u4e0b\u6240\u6709\u64cd\u4f5c\u5747\u5728Mac\u4e0a</p>"},{"location":"front-end/flutter/tools/fvm/#1","title":"1. \u5b89\u88c5","text":"<pre><code>brew tap leoafarias/fvm\nbrew install fvm\n</code></pre>"},{"location":"front-end/flutter/tools/fvm/#2-fvm_home","title":"2 . \u914d\u7f6e FVM_HOME\uff08\u975e\u5fc5\u9700\uff09","text":"<p>fvm \u9ed8\u8ba4\u7f13\u5b58\u76ee\u5f55\u5728<code>$HOME/fvm</code>, \u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf<code>FVM_HOME</code>\u81ea\u5b9a\u4e49\uff0c</p> <p>\u7f16\u8f91<code>~/.bash_profile</code>\u6216\u8005<code>~/.zshrc</code> \uff0c \u52a0\u5165\u4ee5\u4e0b\u547d\u4ee4</p> <pre><code>export FVM_HOME= xxx\n</code></pre>"},{"location":"front-end/flutter/tools/fvm/#3","title":"3. \u5b89\u88c5\u6240\u9700\u7248\u672c","text":"<p>\u8fdb\u5165\u5bf9\u5e94\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u6267\u884c</p> <pre><code>fvm install\n</code></pre> <p>\u4f1a\u81ea\u52a8\u5b89\u88c5\u9879\u76ee\u6240\u9700\u7248\u672c</p> <p>\u4e5f\u53ef\u4ee5\u6267\u884c<code>fvm install {version}</code> \u5b89\u88c5\u7279\u5b9a\u7248\u672c\u7684flutter</p>"},{"location":"front-end/flutter/tools/fvm/#4","title":"4. \u914d\u7f6e\u9879\u76ee","text":"<p>\u8fdb\u5165\u5bf9\u5e94\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u6267\u884c</p> <pre><code># version \u4e3a\u4e0a\u9762\u5b89\u88c5\u7684\u7248\u672c\nfvm use {version}\n</code></pre> <p>FVM \u5c06\u5728\u9879\u76ee\u4e2d\u521b\u5efa\u4e00\u4e2a\u76f8\u5bf9\u7b26\u53f7\u94fe\u63a5<code>.fvm/flutter_sdk</code>\u5230\u6240\u9009\u7248\u672c\u7684\u7f13\u5b58</p>"},{"location":"front-end/flutter/tools/fvm/#ide","title":"\u914d\u7f6eIDE","text":""},{"location":"front-end/flutter/tools/fvm/#vs-code","title":"VS Code","text":"<p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u521b\u5efa<code>.vscode/settings.json</code></p> <pre><code>{\n\"dart.flutterSdkPath\": \".fvm/flutter_sdk\",\n  // Remove .fvm files from search\n  \"search.exclude\": {\n\"**/.fvm\": true\n},\n  // Remove from file watching\n  \"files.watcherExclude\": {\n\"**/.fvm\": true\n}\n}\n</code></pre>"},{"location":"front-end/flutter/tools/fvm/#android-studio","title":"Android Studio","text":"<p>Preferences -&gt;Languages &amp; Frameworks &gt; Flutter, \u4fee\u6539sdk \u8def\u5f84 <code>/absolute-project-path/.fvm/flutter_sdk</code></p> <p></p>"},{"location":"front-end/flutter/tools/fvm/#5","title":"5. \u8fd0\u884c","text":"<ul> <li>IDE\uff1a\u901a\u8fc7\u6b63\u5e38\u5feb\u6377\u952e\u6216\u8fd0\u884c\u6309\u94ae\u8fd0\u884c\u5373\u53ef</li> <li>\u547d\u4ee4\u884c   <pre><code># \u4f7f\u7528\n&gt; fvm flutter {command}\n# \u4ee3\u66ff\n&gt; flutter {command}\n# \u4f7f\u7528\n&gt; fvm dart {command}\n# \u4ee3\u66ff\n&gt; dart {command}\n</code></pre></li> </ul>"},{"location":"front-end/flutter/tools/fvm/#6","title":"6. \u5176\u4ed6","text":"<ul> <li>\u67e5\u770b\u652f\u6301\u7684flutter\u7248\u672c</li> </ul> <p><pre><code>fvm releases\n</code></pre> \u4f1a\u8f93\u51fa\u5982\u4e0b\u7248\u672c\u4fe1\u606f <pre><code>Apr 13 22  \u2502 2.13.0-0.1.pre\nApr 18 22  \u2502 2.10.5\nApr 20 22  \u2502 2.13.0-0.2.pre\nApr 27 22  \u2502 2.13.0-0.3.pre\nMay 5 22   \u2502 2.13.0-0.4.pre\nMay 11 22  \u2502 3.0.0\nMay 20 22  \u2502 3.0.1\nMay 26 22  \u2502 3.1.0\nJun 10 22  \u2502 3.0.2\nJun 15 22  \u2502 3.1.0-9.0.pre\nJun 22 22  \u2502 3.0.3\nJul 1 22   \u2502 3.0.4\nJul 13 22  \u2502 3.0.5\nJul 20 22  \u2502 3.3.0-0.0.pre\nJul 27 22  \u2502 3.3.0-0.1.pre\nAug 3 22   \u2502 3.3.0-0.2.pre\nAug 10 22  \u2502 3.3.0-0.3.pre\nAug 20 22  \u2502 3.3.0-0.4.pre\n--------------------------------------\nAug 23 22  \u2502 3.3.0-0.5.pre     beta\n--------------------------------------\n--------------------------------------\nAug 30 22  \u2502 3.3.0             stable\n</code></pre></p> <ul> <li>\u67e5\u770b\u5df2\u7ecf\u5b89\u88c5\u7684\u7248\u672c</li> </ul> <pre><code>fvm list\n</code></pre> <ul> <li>\u5168\u5c40\u914d\u7f6e</li> </ul> <pre><code>fvm global {version}\n</code></pre> <p>\u8fd9\u65f6\u901a\u8fc7<code>flutter</code> \u547d\u4ee4\u6267\u884c\u7684\u5c31\u662f\u6307\u5b9a\u7684\u7248\u672c </p>"},{"location":"front-end/flutter/unsplash/network/","title":"Flutter \u73b0\u5b66\u73b0\u7528 \u4e4bunsplash\u5ba2\u6237\u7aef\u5b9e\u6218\uff08\u4e8c\uff09","text":""},{"location":"front-end/flutter/unsplash/network/#unsplash-api","title":"unsplash api\u6ce8\u518c","text":"<p>\u5728https://unsplash.com/developers\u6ce8\u518capp\uff0c\u83b7\u53d6Access Key\u548cSecret key</p> <p>https://unsplash.com/documentation api \u6587\u6863</p>"},{"location":"front-end/flutter/unsplash/network/#_1","title":"\u524d\u7f6e\u77e5\u8bc6","text":""},{"location":"front-end/flutter/unsplash/network/#_2","title":"\u7f51\u7edc\u8bf7\u6c42","text":"<p>\u5728 Flutter \u4e2d\uff0cHttp \u7f51\u7edc\u7f16\u7a0b\u7684\u5b9e\u73b0\u65b9\u5f0f\u4e3b\u8981\u5206\u4e3a\u4e09\u79cd\uff1a<code>dart:io \u91cc\u7684 HttpClient \u5b9e\u73b0</code>\u3001<code>Dart \u539f\u751f http \u8bf7\u6c42\u5e93\u5b9e\u73b0</code>\u3001<code>\u7b2c\u4e09\u65b9\u5e93 dio \u5b9e\u73b0</code>\u3002 HttpClient \u548c http \u4f7f\u7528\u65b9\u5f0f\u867d\u7136\u7b80\u5355\uff0c\u4f46\u5176\u66b4\u9732\u7684\u5b9a\u5236\u5316\u80fd\u529b\u90fd\u76f8\u5bf9\u8f83\u5f31\uff0c\u5f88\u591a\u5e38\u7528\u7684\u529f\u80fd\u90fd\u4e0d\u652f\u6301\uff08\u6216\u8005\u5b9e\u73b0\u5f02\u5e38\u7e41\u7410\uff09\uff0c\u6bd4\u5982\u53d6\u6d88\u8bf7\u6c42\u3001\u5b9a\u5236\u62e6\u622a\u5668\u3001Cookie \u7ba1\u7406\u7b49\u3002\u56e0\u6b64\u5bf9\u4e8e\u590d\u6742\u7684\u7f51\u7edc\u8bf7\u6c42\u884c\u4e3a\uff0c\u6211\u63a8\u8350\u4f7f\u7528\u76ee\u524d\u5728 Dart \u793e\u533a\u4eba\u6c14\u8f83\u9ad8\u7684\u7b2c\u4e09\u65b9 dio \u6765\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u3002 https://pub.dev/packages/dio</p>"},{"location":"front-end/flutter/unsplash/network/#_3","title":"\u4f9d\u8d56\u7ba1\u7406","text":"<p>Dart \u63d0\u4f9b\u4e86\u5305\u7ba1\u7406\u5de5\u5177 Pub\uff0c\u7528\u6765\u7ba1\u7406\u4ee3\u7801\u548c\u8d44\u6e90\u3002\u4ece\u672c\u8d28\u4e0a\u8bf4\uff0c\u5305\uff08package\uff09\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u5305\u542b\u4e86 pubspec.yaml \u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u5176\u5185\u90e8\u53ef\u4ee5\u5305\u542b\u4ee3\u7801\u3001\u8d44\u6e90\u3001\u811a\u672c\u3001\u6d4b\u8bd5\u548c\u6587\u6863\u7b49\u6587\u4ef6\u3002\u5305\u4e2d\u5305\u542b\u4e86\u9700\u8981\u88ab\u5916\u90e8\u4f9d\u8d56\u7684\u529f\u80fd\u62bd\u8c61\uff0c\u4e5f\u53ef\u4ee5\u4f9d\u8d56\u5176\u4ed6\u5305\u3002\u4e0e Android \u4e2d\u7684 JCenter/Maven\u3001iOS \u4e2d\u7684 CocoaPods\u3001\u524d\u7aef\u4e2d\u7684 npm \u5e93\u7c7b\u4f3c\uff0cDart \u63d0\u4f9b\u4e86\u5b98\u65b9\u7684\u5305\u4ed3\u5e93 Pub\u3002\u901a\u8fc7 Pub\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u67e5\u627e\u5230\u6709\u7528\u7684\u7b2c\u4e09\u65b9\u5305\u3002</p> <p>\u5728 Dart \u4e2d\uff0c\u5e93\u548c\u5e94\u7528\u90fd\u5c5e\u4e8e\u5305\u3002pubspec.yaml \u662f\u5305\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5305\u542b\u4e86\u5305\u7684\u5143\u6570\u636e\uff08\u6bd4\u5982\uff0c\u5305\u7684\u540d\u79f0\u548c\u7248\u672c\uff09\u3001\u8fd0\u884c\u73af\u5883\uff08\u4e5f\u5c31\u662f Dart SDK \u4e0e Fluter SDK \u7248\u672c\uff09\u3001\u5916\u90e8\u4f9d\u8d56\u3001\u5185\u90e8\u914d\u7f6e\uff08\u6bd4\u5982\uff0c\u8d44\u6e90\u7ba1\u7406\uff09\u3002  </p> <pre><code>name: funsplash #\u5e94\u7528\u540d\u79f0\ndescription: A unsplash client project. #\u5e94\u7528\u63cf\u8ff0\nhttps://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html\n#\u5e94\u7528\u7248\u672c\u53ca\u6784\u5efanumber\nversion: 1.0.0+1\n#Dart\u8fd0\u884c\u73af\u5883\u533a\u95f4\nenvironment:\nsdk: \"&gt;=2.17.6 &lt;3.0.0\"\n#Flutter\u4f9d\u8d56\u5e93    dependencies:\nflutter:\nsdk: flutter\ndio: ^4.0.6  </code></pre> <p>\u8fd0\u884c\u73af\u5883\u548c\u4f9d\u8d56\u5e93 cupertino_icons \u5192\u53f7\u540e\u9762\u7684\u90e8\u5206\u662f\u7248\u672c\u7ea6\u675f\u4fe1\u606f\uff0c\u7531\u4e00\u7ec4\u7a7a\u683c\u5206\u9694\u7684\u7248\u672c\u63cf\u8ff0\u7ec4\u6210\uff0c\u53ef\u4ee5\u652f\u6301\u6307\u5b9a\u7248\u672c\u3001\u7248\u672c\u53f7\u533a\u95f4\uff0c\u4ee5\u53ca\u4efb\u610f\u7248\u672c\u8fd9\u4e09\u79cd\u7248\u672c\u7ea6\u675f\u65b9\u5f0f\u3002\u6bd4\u5982\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0ccupertino_icons \u5f15\u7528\u4e86\u5927\u4e8e 0.1.1 \u7684\u7248\u672c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e\u5143\u6570\u636e\u4e0e\u540d\u79f0\u4f7f\u7528\u7a7a\u683c\u5206\u9694\uff0c\u56e0\u6b64\u7248\u672c\u53f7\u4e2d\u4e0d\u80fd\u51fa\u73b0\u7a7a\u683c\uff1b\u540c\u65f6\u53c8\u7531\u4e8e\u5927\u4e8e\u7b26\u53f7\u201c&gt;\u201d\u4e5f\u662f YAML \u8bed\u6cd5\u4e2d\u7684\u6298\u53e0\u6362\u884c\u7b26\u53f7\uff0c\u56e0\u6b64\u5728\u6307\u5b9a\u7248\u672c\u8303\u56f4\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u4f7f\u7528\u5f15\u53f7\uff0c \u6bd4\u5982\"&gt;=2.1.0 &lt; 3.0.0\"\u3002</p> <p>\u5bf9\u4e8e\u5305\uff0c\u6211\u4eec\u901a\u5e38\u662f\u6307\u5b9a\u7248\u672c\u533a\u95f4\uff0c\u800c\u5f88\u5c11\u76f4\u63a5\u6307\u5b9a\u7279\u5b9a\u7248\u672c\uff0c\u56e0\u4e3a\u5305\u5347\u7ea7\u53d8\u5316\u5f88\u9891\u7e41\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7684\u5305\u76f4\u63a5\u6216\u95f4\u63a5\u4f9d\u8d56\u8fd9\u4e2a\u5305\u7684\u5176\u4ed6\u7248\u672c\u65f6\uff0c\u5c31\u4f1a\u7ecf\u5e38\u53d1\u751f\u51b2\u7a81\u3002\u800c\u5bf9\u4e8e\u8fd0\u884c\u73af\u5883\uff0c\u5982\u679c\u662f\u56e2\u961f\u591a\u4eba\u534f\u4f5c\u7684\u5de5\u7a0b\uff0c\u5efa\u8bae\u5c06 Dart \u4e0e Flutter \u7684 SDK \u73af\u5883\u5199\u6b7b\uff0c\u7edf\u4e00\u56e2\u961f\u7684\u5f00\u53d1\u73af\u5883\uff0c\u907f\u514d\u56e0\u4e3a\u8de8 SDK \u7248\u672c\u51fa\u73b0\u7684 API \u5dee\u5f02\u8fdb\u800c\u5bfc\u81f4\u5de5\u7a0b\u95ee\u9898\u3002</p>"},{"location":"front-end/flutter/unsplash/network/#_4","title":"\u5f02\u6b65\u7f16\u7a0b","text":"<p>\u5f02\u6b65\u7f16\u7a0b\u5e38\u7528\u4e8e\u7f51\u7edc\u8bf7\u6c42\u3001\u7f13\u5b58\u6570\u636e\u52a0\u8f7d\u3001\u672c\u5730File\u56fe\u7247\u52a0\u8f7d\u3001\u5b9a\u65f6\u4e0e\u5ef6\u65f6\u4efb\u52a1\u7b49\uff0c\u5728Flutter\u5f00\u53d1\u4e2d \uff0c\u4f7f\u7528async\u5f00\u542f\u4e00\u4e2a\u5f02\u6b65\u5f00\u59cb\u5904\u7406\uff0c\u4f7f\u7528await\u6765\u7b49\u5f85\u5904\u7406\u7ed3\u679c\uff0c\u5982\u5904\u7406\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>  //\u4ee3\u7801\u6e05\u5355 1-1\n//HTTP\u7684get\u8bf7\u6c42\u8fd4\u56de\u503c\u4e3aFuture&lt;String&gt;\u7c7b\u578b\uff0c\u5373\u5176\u8fd4\u56de\u503c\u672a\u6765\u662f\u4e00\u4e2aString\u7c7b\u578b\u7684\u503c\n//async\u5173\u952e\u5b57\u58f0\u660e\u8be5\u51fd\u6570\u5185\u90e8\u6709\u4ee3\u7801\u9700\u8981\u5ef6\u8fdf\u6267\u884c\nFuture&lt;String&gt; getData() async {    //await\u5173\u952e\u5b57\u58f0\u660e\u8fd0\u7b97\u4e3a\u5ef6\u8fdf\u6267\u884c\uff0c\u7136\u540ereturn\u8fd0\u7b97\u7ed3\u679c\nreturn await http.get(Uri.encodeFull(url), headers: {\"Accept\": \"application/json\"});\n}\n</code></pre> <p>\u6216\u8005\u53ef\u4ee5\u8fd9\u6837\u6765\u5199\uff1a</p> <pre><code>  //\u4ee3\u7801\u6e05\u5355 1-2 \nFuture&lt;String&gt; getData() async {    //await\u5173\u952e\u5b57\u58f0\u660e\u8fd0\u7b97\u4e3a\u5ef6\u8fdf\u6267\u884c\uff0c\u7136\u540ereturn\u8fd0\u7b97\u7ed3\u679c\n//\u5f02\u6b65\u6267\u884c 1-2-1\nString  result = await http.get(Uri.encodeFull(url1), headers: {\"Accept\": \"application/json\"});\n//\u5f02\u6b65\u6267\u884c 1-2-2\nString result2 = await http.get(Uri.encodeFull(url2), headers: {\"Accept\": \"application/json\"});\nreturn }\n</code></pre> <p>\u5728\u4ee3\u7801\u6e05\u53551-2\u4e2d\u6267\u884c\u4e86\u4e24\u4e2a\u5f02\u6b65\u4efb\u52a1\uff0c\u8fd9\u4e24\u4e2a\u5f02\u6b65\u4efb\u52a1\u662f\u4e32\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u5f02\u6b65 1-2-1 \u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u83b7\u53d6\u5230\u7ed3\u679c result \uff0c\u7136\u540e\u518d\u5f00\u542f\u5f02\u6b65\u6267\u884c 1-2-2\uff0c\u5728\u5b9e\u9645\u9879\u76ee\u53ef\u5e94\u7528\u4e8e\u4f7f\u7528\u7b2c\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u7684\u7ed3\u679c\u6765\u52a8\u6001\u52a0\u8f7d\u7b2c\u4e8c\u4e2a\u7f51\u7edc\u8bf7\u6c42\u6216\u8005\u662f\u5176\u4ed6\u5206\u7c7b\u522b\u7684\u5f02\u6b65\u4efb\u52a1\uff0c\u4ee3\u7801\u6e05\u53551-2\u4e5f\u53ef\u4ee5\u62c6\u5206\u6210\u5982\u4e0b\u4ee3\u7801\u6e05\u53551-3\u4e2d\u7684\u5199\u6cd5</p> <pre><code>  //\u4ee3\u7801\u6e05\u5355 1-3\nFuture&lt;String&gt; getData() async {    //await\u5173\u952e\u5b57\u58f0\u660e\u8fd0\u7b97\u4e3a\u5ef6\u8fdf\u6267\u884c\uff0c\u7136\u540ereturn\u8fd0\u7b97\u7ed3\u679c\n//\u5f02\u6b65\u6267\u884c 1-2-1\nString  result = await getDataA();\nString result2 = await getDataB();\nreturn  Future.value(result2);\n}\nFuture&lt;String&gt; getDataA() async {    //await\u5173\u952e\u5b57\u58f0\u660e\u8fd0\u7b97\u4e3a\u5ef6\u8fdf\u6267\u884c\uff0c\u7136\u540ereturn\u8fd0\u7b97\u7ed3\u679c\nreturn await http.get(Uri.encodeFull(url1), headers: {\"Accept\": \"application/json\"});\n}\nFuture&lt;String&gt; getDataB() async {    //await\u5173\u952e\u5b57\u58f0\u660e\u8fd0\u7b97\u4e3a\u5ef6\u8fdf\u6267\u884c\uff0c\u7136\u540ereturn\u8fd0\u7b97\u7ed3\u679c\nreturn await http.get(Uri.encodeFull(url1), headers: {\"Accept\": \"application/json\"});\n}\n</code></pre> <p>\u7136\u540e\u5bf9\u4e8e\u4ee3\u7801\u6e05\u53551-3\u4e2d\u5f02\u6b65\u5904\u7406getDataA()\u4e0egetDataB()\u53ef\u4ee5\u5206\u522b\u52a0\u5165\u5f02\u5e38\u6355\u6349\u673a\u5236\uff08\u5982\u4e0b\u4ee3\u7801\u6e05\u53551-4\uff09\uff0c\u4ee5\u786e\u4fdd\u5728\u5f02\u6b65\u5904\u7406\u4e4b\u95f4\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\uff0c\u5982\u5728\u5728\u8fd9\u7684\u5f02\u6b65\u5904\u7406getDataA()\u4e0egetDataB(),\u5982\u679cgetDataA()\u65b9\u6cd5\u51fa\u73b0\u4e86\u5f02\u5e38\uff0c\u5728Flutter\u4e2d\u5c31\u4f1a\u76f4\u63a5\u62a5\u9519\uff0c\u800c\u4e0d\u518d\u6267\u884c\u5f02\u6b65\u5904\u7406getDataB()\u3002</p> <pre><code>//\u4ee3\u7801\u6e05\u5355 1-4\nFuture&lt;String&gt; getDataA() async {\nString result = \"\";\ntry {\nreturn  await http.get(Uri.encodeFull(url1), headers: {\"Accept\": \"application/json\"});\n} catch (e) {\nresult = \"\u51fa\u73b0\u5f02\u5e38\";\n} finally {\nreturn Future.value(result);\n}\n}\nFuture&lt;String&gt; getDataB() async {    String result = \"\";\ntry {\nreturn  await http.get(Uri.encodeFull(url2), headers: {\"Accept\": \"application/json\"});\n} catch (e) {\nresult = \"\u51fa\u73b0\u5f02\u5e38\";\n} finally {\nreturn Future.value(result);\n}\n}\n</code></pre> <p>\u4e32\u884c\u8c03\u7528 \u4e24\u4e2a\u5f02\u6b65\u4efb\u52a1\u7684\u4e00\u822c\u5199\u6cd5\u5982\u4e0b\u4ee3\u7801\u6e05\u53551-5\u4e2d\u6240\u793a</p> <pre><code>///\u4ee3\u7801\u6e05\u5355 1-5\nvoid test() async{\nawait getDataA();\nawait getDataB();\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u7528\u53e6\u4e00\u79cd\u65b9\u5f0f\u6765\u5199\u5982\u4e0b\u4ee3\u7801\u6e05\u53551-6</p> <pre><code>///\u4ee3\u7801\u6e05\u5355 1-6\nvoid test() async {\ngetDataA().then((value1) {\n///\u503cvalue1\u5c31\u662fgetDataA\u4e2d\u8fd4\u56de\u7684\u7ed3\u679c\ngetDataB().then((value2) {\n///\u503cvalue2\u5c31\u662fgetDataB\u4e2d\u8fd4\u56de\u7684\u7ed3\u679c\n});\n});\n}\n</code></pre>"},{"location":"front-end/flutter/unsplash/network/#_5","title":"\u5b9e\u8df5","text":"<p>\u6211\u4eec\u9996\u5148\u9700\u8981\u628a dio \u52a0\u5230 pubspec \u4e2d\u7684\u4f9d\u8d56\u91cc\uff1a</p> <pre><code>dependencies:\ndio: ^4.0.6 </code></pre> <p>\u6211\u4eec\u5bf9dio api\u7b80\u5355\u5c01\u88c5\u4e0b\uff1a</p> <pre><code>class Http {\nlate Dio _dio;\nfactory Http() =&gt; _instance;\nstatic final Http _instance = Http._internal();\nHttp._internal() {\nBaseOptions options = BaseOptions(\nbaseUrl: Constants.BASE_URL,\nconnectTimeout: 5000,\nreceiveTimeout: 3000,\ncontentType: Headers.jsonContentType,\nheaders: {\n\"Authorization\": \"Client-ID ${Constants.ACCESS_KEY}\",\n},\n);\n_dio = Dio(options);\n}\nFuture&lt;Response&gt; get(String url, {Map&lt;String, dynamic&gt;? queryParameters}) async {\nreturn await _dio.get(url, queryParameters: queryParameters);\n}\n}\n</code></pre> <p>\u83b7\u53d6\u56fe\u7247\u5217\u8868</p> <pre><code>class Repository {\nstatic Future&lt;List&lt;Photo&gt;&gt; getPhotos() async {\nResponse response = await Http().get(Constants.GET_PHOTO);\nif (response.statusCode == 200) {\nreturn Future.value(\nList.from(response.data).map((photo) =&gt; Photo.fromMap(photo)).toList(),\n);\n} else {\nthrow Exception('Failed to load post');\n}\n}\n}\n</code></pre> <p>\u8fd4\u56de\u6570\u636e\u8f6c\u6362\u6210\u6570\u636e\u5bf9\u8c61</p> <pre><code>factory Photo.fromMap(Map data) {\nreturn Photo(\nid: data['id'],\ncreatedAt: data['created_at'],\nupdatedAt: data['updated_at'],\npromotedAt: data['promoted_at'],\nwidth: data['width'],\nheight: data['height'],\ncolor: data['color'],\ndescription: data['description'],\nalternativeDescription: data['alternative_description'],\nurls: PhotoUrls.fromMap(data['urls']),\nlinks: PhotoLink.fromMap(data['links']),\ncategories: data['categories'],\nlikes: data['likes'],\nlikedByUser: data['liked_by_user'],\ncurrentUserCollections: data['current_user_collections'],\nuser: User.fromMap(data['user']),\nexif: PhotoExif.fromMap(data['exif']),\nlocation: PhotoLocation.fromMap(data['location']),\ntags: data['tags'].runtimeType == 'List'\n? List.from(data['tags']).map((tag) =&gt; PhotoTag.fromMap(tag)).toList()\n: null,\nsponsorship: data['sponsorship'],\nrelatedCollections: data['related_collections'],\nviews: data['views'],\ndownloads: data['downloads'],\n);\n}\n</code></pre> <p>\u6d4b\u8bd5</p> <p>http_test.dart</p> <pre><code>void main() {\ntest('Get Photos', () async {\nList&lt;Photo&gt; data = await Repository.getPhotos();\nexpect(data.length, greaterThan(0));\n});\n}\n</code></pre> <p>\u8fd0\u884c\u901a\u8fc7\uff0c\u6211\u4eec\u518d\u65ad\u70b9\u770b\u770b\u89e3\u6790\u7ed3\u679c\uff0c</p> <p></p> <p></p>"},{"location":"front-end/flutter/unsplash/startup/","title":"\u8d77\u6b65","text":""},{"location":"front-end/flutter/unsplash/startup/#flutter","title":"flutter\u7b80\u4ecb","text":"<p>Flutter \u662f Google \u5f00\u6e90\u7684\u5e94\u7528\u5f00\u53d1\u6846\u67b6\uff0c\u4ec5\u901a\u8fc7\u4e00\u5957\u4ee3\u7801\u5e93\uff0c\u5c31\u80fd\u6784\u5efa\u7cbe\u7f8e\u7684\u3001\u539f\u751f\u5e73\u53f0\u7f16\u8bd1\u7684\u591a\u5e73\u53f0\u5e94\u7528\u3002</p> <p>flutter\u63d0\u4f9b\u4e86\u4e00\u6574\u5957\u4ece\u5e95\u5c42\u6e32\u67d3\u903b\u8f91\u5230\u4e0a\u5c42\u5f00\u53d1\u8bed\u8a00\u7684\u5b8c\u6574\u89e3\u51b3\u65b9\u6848\uff1a\u89c6\u56fe\u6e32\u67d3\u5b8c\u5168\u95ed\u73af\u5728\u5176\u6846\u67b6\u5185\u90e8\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u5e95\u5c42\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u4efb\u4f55\u7ec4\u4ef6\uff0c\u4ece\u6839\u672c\u4e0a\u4fdd\u8bc1\u4e86\u89c6\u56fe\u6e32\u67d3\u5728 Android \u548c iOS \u4e0a\u7684\u9ad8\u5ea6\u4e00\u81f4\u6027\uff1bFlutter \u7684\u5f00\u53d1\u8bed\u8a00 Dart\uff0c\u662f Google \u4e13\u95e8\u4e3a\uff08\u5927\uff09\u524d\u7aef\u5f00\u53d1\u91cf\u8eab\u6253\u9020\u7684\u4e13\u5c5e\u8bed\u8a00\uff0c\u501f\u52a9\u4e8e\u5148\u8fdb\u7684\u5de5\u5177\u94fe\u548c\u7f16\u8bd1\u5668\uff0c\u6210\u4e3a\u4e86\u5c11\u6570\u540c\u65f6\u652f\u6301 JIT \u548c AOT \u7684\u8bed\u8a00\u4e4b\u4e00\uff0c\u5f00\u53d1\u671f\u8c03\u8bd5\u6548\u7387\u9ad8\uff0c\u53d1\u5e03\u671f\u8fd0\u884c\u901f\u5ea6\u5feb\u3001\u6267\u884c\u6027\u80fd\u597d\uff0c\u5728\u4ee3\u7801\u6267\u884c\u6548\u7387\u4e0a\u53ef\u4ee5\u5ab2\u7f8e\u539f\u751f App\u3002</p>"},{"location":"front-end/flutter/unsplash/startup/#fluttermacosvs-code","title":"\u642d\u5efaflutter\u5de5\u4f5c\u73af\u5883\uff08macOS\u3001VS code\uff09","text":""},{"location":"front-end/flutter/unsplash/startup/#flutter_1","title":"\u5b89\u88c5flutter","text":"<ol> <li>\u4e0b\u8f7dFlutter SDK</li> <li>\u5c06\u6587\u4ef6\u89e3\u538b\u5230\u76ee\u6807\u8def\u5f84, \u6bd4\u5982: <pre><code>cd ~/development\nunzip ~/Downloads/flutter_macos_3.0.5-stable.zip\n</code></pre></li> <li> <p>\u914d\u7f6e flutter \u7684 PATH \u73af\u5883\u53d8\u91cf\uff1a \u4fee\u6539<code>$HOME/.zshrc</code>\u6216<code>$HOME/.bashrc</code>\u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\uff1a <pre><code>export PATH=\"$HOME/development/flutter/bin:$PATH\"\n</code></pre></p> </li> <li> <p>\u8fd0\u884c flutter doctor \u547d\u4ee4\u68c0\u67e5\u5f53\u524d\u73af\u5883\u662f\u5426\u9700\u8981\u5b89\u88c5\u5176\u4ed6\u7684\u4f9d\u8d56\uff1a <pre><code>flutter doctor\n</code></pre> \u6839\u636e\u8f93\u51fa\u63d0\u793a\u5b89\u88c5\u76f8\u5e94\u7684\u4f9d\u8d56\u5373\u53ef\u3002</p> </li> </ol> <p>\u5347\u7ea7flutter \u5230\u6700\u65b0\u7248\u672c\uff1a <pre><code>flutter upgrade\n</code></pre></p>"},{"location":"front-end/flutter/unsplash/startup/#vs-code","title":"VS Code","text":"<ol> <li>\u5b89\u88c5VSCode</li> <li>\u5b89\u88c5flutter\u63d2\u4ef6\uff1a\u5728\u6269\u5c55\u641c\u7d22\u8f93\u5165\u6846\u4e2d\u8f93\u5165\u300cflutter\u300d\uff0c\u7136\u540e\u5728\u5217\u8868\u4e2d\u9009\u62e9 Flutter \u5e76\u5b89\u88c5\u3002\u6b64\u8fc7\u7a0b\u4e2d\u4f1a\u81ea\u52a8\u5b89\u88c5\u5fc5\u9700\u7684 Dart \u63d2\u4ef6   </li> </ol>"},{"location":"front-end/flutter/unsplash/startup/#flutter_2","title":"\u521b\u5efaflutter\u9879\u76ee","text":"<ol> <li>\u5728\u76ee\u6807\u8def\u5f84\u4e0b\u6267\u884c\uff1a <pre><code>//--org\u6307\u5b9a\u4f60\u7684\u5305\u540d\nflutter create --org com.adison.funsplash funsplash\n</code></pre></li> <li>\u6253\u5f00ios\u6a21\u62df\u5668\uff1a <pre><code>open -a Simulator\n</code></pre></li> <li>\u8fd0\u884cflutter\u9879\u76ee\uff1a \u547d\u4ee4\u884c\u6267\u884c\uff1a <pre><code>flutter run\n</code></pre> VS Code\u6267\u884c\uff1a <pre><code>\u901a\u8fc7F5\u5feb\u6377\u952e\u4ee5\u8c03\u8bd5\u6a21\u5f0f\u8fd0\u884c\n</code></pre> \u8fd0\u884c\u6548\u679c\u5982\u4e0b </li> </ol> <p>\u591a\u4e2a\u8bbe\u5907\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\uff1a <pre><code>flutter run -d devices_id/devices_name\n</code></pre> \u6307\u5b9a\u5bf9\u5e94\u8bbe\u5907\u8fd0\u884c\uff0cdevices_id\u4e3a\u8bbe\u5907\u7684id\uff0cdevices_name\u4e3a\u8bbe\u5907\u7684\u540d\u79f0\u3002 \u901a\u8fc7<code>flutter devices</code>\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u8bbe\u5907\u4fe1\u606f\u3002</p>"},{"location":"game/","title":"\u6e38\u620f\u5f00\u53d1","text":""},{"location":"game/daily/navmesh/","title":"\u81ea\u52a8\u5bfb\u8def\u548c\u5bfc\u822a","text":""},{"location":"game/daily/navmesh/#navmesh","title":"NavMesh \u7b80\u4ecb","text":"<p>NavMesh(\u5bfc\u822a\u7f51\u683c)\u662f3D\u6e38\u620f\u4e16\u754c\u4e2d\u7528\u4e8e\u5b9e\u73b0\u52a8\u6001\u7269\u4f53\u81ea\u52a8\u5bfb\u8def\u7684\u4e00\u79cd\u6280\u672f\uff0c\u5c06\u6e38\u620f\u4e2d\u590d\u6742\u7684\u7ed3\u6784\u7ec4\u7ec7\u5173\u7cfb\u7b80\u5316\u4e3a\u5e26\u6709\u4e00\u5b9a\u4fe1\u606f\u7684\u7f51\u683c\uff0c\u5728\u8fd9\u4e9b\u7f51\u683c\u7684\u57fa\u7840\u4e0a\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u8ba1\u7b97\u6765\u5b9e\u73b0\u81ea\u52a8\u5bfb\u3002\u3002\u5bfc\u822a\u65f6\uff0c\u53ea\u9700\u8981\u7ed9\u5bfc\u822a\u7269\u4f53\u6302\u8f7d\u5bfc\u822a\u7ec4\u4ef6\uff0c\u5bfc\u822a\u7269\u4f53\u4fbf\u4f1a\u81ea\u884c\u6839\u636e\u76ee\u6807\u70b9\u6765\u5bfb\u627e\u6700\u76f4\u63a5\u7684\u8def\u7ebf\uff0c\u5e76\u6cbf\u7740\u8be5\u7ebf\u8def\u5230\u8fbe\u76ee\u6807\u70b9\u3002</p>"},{"location":"game/daily/navmesh/#navigation","title":"Navigation\u9762\u677f","text":"<p>\u4f9d\u6b21\u9009\u62e9\u83dc\u5355\u680f\u4e2d\u7684Windows -AI- Navigation \uff0c\u6253\u5f00\u540e\u9762\u677f\u5982\u4e0b\u3002</p> <p></p>"},{"location":"game/daily/navmesh/#agents","title":"Agents","text":"<ul> <li> <p>Name\uff1a\u8bbe\u7f6e\u70d8\u57f9Agents\u7684\u540d\u5b57</p> </li> <li> <p>Radius\uff1a\u70d8\u57f9\u7684\u534a\u5f84\uff0c\u4e5f\u5c31\u662f\u7269\u4f53\u7684\u70d8\u57f9\u7684\u534a\u5f84\u3002\u8fd9\u4e2a\u503c\u5f71\u54cd\u7269\u4f53\u80fd\u901a\u8fc7\u7684\u8def\u5f84\u7684\u5927\u5c0f</p> </li> </ul> <p>\u8d8a\u5c0f\uff0c\u80fd\u884c\u8d70\u7684\u8def\u5f84\u8d8a\u5927\uff0c\u8fb9\u7f18\u533a\u57df\u8d8a\u5c0f</p> <ul> <li>Height\uff1a   \u5177\u6709\u4ee3\u8868\u6027\u7684\u7269\u4f53\u7684\u9ad8\u5ea6\uff0c\u53ef\u4ee5\u901a\u8fc7\u7684\u6700\u4f4e\u7684\u7a7a\u95f4\u9ad8\u5ea6\u3002\u8fd9\u4e2a\u503c\u8d8a\u5c0f\uff0c\u80fd\u901a\u8fc7\u7684\u6700\u5c0f\u9ad8\u5ea6\u8d8a\u5c0f\u3002\u6253\u4e2a\u6bd4\u65b9\u5c31\u662f\uff0c1m7\u7684\u4eba\u80fd\u901a\u8fc71m7\u7684\u6d1e\u662f\u6b63\u5e38\u7684\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6eheight\u4e3a1m\uff0c\u5c31\u80fd\u901a\u8fc71m\u7684\u9ad8\u5ea6</li> <li>Step Height \uff1a\u6b65\u884c\u8de8\u8d8a\u9ad8\u5ea6</li> <li>Max Slope\uff1a\u6700\u5927\u5761\u5ea6\uff0c\u8868\u793a\u80fd\u5728\u591a\u9ad8\u7684\u5761\u722c\u884c</li> </ul> <p>\u8be5\u7ec4\u4ef6\u5728\u65b0\u7248navmesh\u624d\u751f\u6548\uff0c\u65e7\u7248\u76f4\u63a5\u4f7f\u7528bake\u7ec4\u4ef6\u5904\u7406</p>"},{"location":"game/daily/navmesh/#bake","title":"Bake","text":"<p>\u524d\u9762\u7684\u53c2\u6570\u5728\u65e7\u7248\u5145\u5f53Agents\u4f5c\u7528</p> <ul> <li> <p>Drop Height\uff1a\u5141\u8bb8\u6700\u5927\u7684\u4e0b\u843d\u8ddd\u79bb\u3002</p> </li> <li> <p>Jump Distance\uff1a\u5141\u8bb8\u6700\u5927\u7684\u8df3\u8dc3\u8ddd\u79bb\u3002</p> </li> <li> <p>Min Region Area\uff1a\u7f51\u683c\u9762\u79ef\u5c0f\u4e8e\u8be5\u503c\u5219\u4e0d\u751f\u6210\u5bfc\u822a\u7f51\u683c\u3002</p> </li> <li> <p>Height Mesh\uff1a\u52fe\u9009\u540e\u4f1a\u4fdd\u5b58\u9ad8\u5ea6\u4fe1\u606f\uff0c\u540c\u65f6\u4f1a\u6d88\u8017\u4e00\u4e9b\u6027\u80fd\u548c\u5b58\u50a8\u7a7a\u95f4\u3002</p> </li> </ul>"},{"location":"game/daily/navmesh/#areas","title":"Areas","text":"<p>\u8fd9\u4e2a\u662f\u53ef\u4ee5\u8bbe\u7f6e\u81ea\u52a8\u5bfb\u8def\u70d8\u57f9\u7684\u5c42</p>"},{"location":"game/daily/navmesh/#object","title":"Object","text":"<p>\u8fd9\u4e2a\u662f\u8bbe\u7f6e\u53bb\u70d8\u57f9\u54ea\u4e2a\u5bf9\u8c61\uff0c\u6bd4\u5982\u5730\u5f62\u4e4b\u7c7b\u7684\uff0c\u5c31\u662f\u53ef\u4ee5\u884c\u8d70\u7684\u8303\u56f4\u8def\u5f84</p> <ul> <li> <p>Scene Filter: \u9009\u62e9\u573a\u666f\u4e2d\u90a3\u4e9b\u5bf9\u8c61\uff0c\u53ef\u4ee5\u9009\u62e9\u5168\u90e8(All)\uff0c\u5730\u5f62(Terrains),\u6709\u7f51\u683c\u5bf9\u8c61(Mesh Renderers)</p> </li> <li> <p>Navigation Static:\u53ef\u4ee5\u70d8\u57f9</p> </li> <li> <p>Generate OffMeshLinks\uff1a\u53ef\u4ee5\u8df3\u8dc3\u7684\u5730\u65b9</p> </li> <li>Navigation Area\uff1a\u8868\u793a\u662f\u54ea\u4e2aArea\uff0c\u8fd9\u4e2a\u9700\u8981\u5148\u8bbe\u7f6e\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u662fWalkble\u3001Jump\u3001NotWalkble\u4e09\u79cd</li> </ul>"},{"location":"game/daily/navmesh/#navmeshagent","title":"NavMeshAgent\u7ec4\u4ef6","text":"<ul> <li>Base Offset</li> </ul> <p>\u504f\u79fb\u503c</p> <ul> <li>Speed</li> </ul> <p>\u7269\u4f53\u81ea\u52a8\u5bfb\u8def\u7684\u901f\u5ea6</p> <ul> <li>Angular Speed</li> </ul> <p>\u8f6c\u89d2\u7684\u901f\u5ea6\uff0c\u5c31\u662f\u8f6c\u5f2f\u7684\u901f\u5ea6</p> <ul> <li>Acceleration</li> </ul> <p>\u52a0\u901f\u5ea6, \u8b6c\u5982\u4ece\u9759\u6b62\u5230\u8fd0\u52a8</p> <ul> <li>Stopping Distance</li> </ul> <p>\u7269\u4f53\u505c\u4e0b\u6765\u7684\u8ddd\u79bb\uff0c\u8bbe\u7f6e\u4e3a0\u5c31\u662f\u8ddf\u76ee\u6807\u70b9\u7684\u8ddd\u79bb\u4e3a0(\u4e5f\u5c31\u662f\u76ee\u6807\u70b9\u7684\u4e2d\u5fc3\u70b9)\u65f6\u505c\u4e0b\u6765</p> <ul> <li>Auto Braking</li> </ul> <p>\u7269\u4f53\u884c\u8d70\u8fc7\u7a0b\u4e2d\uff0c\u6539\u6362\u65b9\u5411\u65f6\u91cd\u65b0\u89c4\u5212\u8def\u5f84</p> <ul> <li>Radius</li> </ul> <p>\u200b       \u7269\u4f53\u7684\u534a\u5f84</p> <ul> <li>Height</li> </ul> <p>\u200b       \u7269\u4f53\u7684\u9ad8\u5ea6\uff0c\u5982\u679cAgentHeight\u7684\u503c\u5927\u4e8e\u8fd9\u4e2a\u503c\uff0c\u90a3\u4e48\u5c31\u4e0d\u80fd\u901a\u8fc7</p> <ul> <li>Quality</li> </ul> <p>\u5982\u679c\u8981\u9632\u6b62\u4e00\u7fa4\u5bfb\u8def\u7684\u7269\u4f53\u56f4\u4f4f\u76ee\u6807\u70b9</p> <p>\u53ef\u4ee5\u8bbe\u7f6eQuality\u4e3aNone\uff0c\u5373\u53ef\u4ee5\u8ba9\u5bfb\u8def\u7269\u4f53\u4e92\u76f8\u7a7f\u8fc7</p> <ul> <li>Priority</li> </ul> <p>\u4f18\u5148\u6743</p> <ul> <li>Auto Traverse Off Mesh Link</li> </ul> <p>\u81ea\u52a8\u8df3\u8dc3\u94fe\u63a5</p> <ul> <li>Auto Repath</li> </ul> <p>\u81ea\u52a8\u91cd\u65b0\u8def\u5f84</p> <ul> <li>Area Mask</li> </ul> <p>\u80fd\u901a\u8fc7\u7684Maks\u5c42\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u914d\u5408Navigation\u7ec4\u4ef6\u4e2dAreas\u4f7f\u7528</p>"},{"location":"game/perf/cpu/","title":"Unity3D\u6027\u80fd\u4f18\u5316\u2014\u2014CPU\u7bc7","text":""},{"location":"game/perf/cpu/#cpu","title":"CPU\u6027\u80fd\u4f18\u5316","text":"<p>CPU \u4f18\u5316\u4e3b\u8981\u4ee5\u6027\u80fd\u5206\u6790\u4e3a\u5f15\uff0c\u6839\u636e\u5206\u6790\u6240\u5f97\u7684\u6570\u636e\uff0c\u627e\u5230\u6027\u80fd\u95ee\u9898\uff0c\u4ee5\u4fbf\u5feb\u901f\u5e76\u5b9a\u5411\u7684\u4f18\u5316\u9879\u76ee\u3002\u5728\u6211\u4eec\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\u6709\u63d0\u5230\uff0cCPU usage profiler\u4f1a\u7edf\u8ba1\u6e32\u67d3\u3001 \u7269\u7406\u3001 \u811a\u672c\u3001 GC\u3001UI\u3001\u5782\u76f4\u540c\u6b65\u4ee5\u53ca\u5168\u5c40\u5149\u7167\u7b49\u6a21\u5757\u7684 CPU \u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u9996\u5148\u6211\u4eec\u518d\u4e86\u89e3\u4e00\u4e2a\u5de5\u5177\uff0c\u5728\u6211\u4eec\u7684\u9879\u76ee\u4e2d\uff0c\u53ef\u4ee5\u5728Game\u89c6\u56fe\u70b9\u51fbstats\u5f00\u542fStatistics\u7a97\u53e3\uff08\u6e32\u67d3\u7edf\u8ba1\u7a97\u53e3\uff09\uff0c\u8be5\u7a97\u53e3\u663e\u793a\u6e38\u620f\u8fd0\u884c\u65f6\uff0c\u6e32\u67d3\u3001\u58f0\u97f3\u3001\u7f51\u7edc\u72b6\u51b5\u7b49\u591a\u79cd\u7edf\u8ba1\u4fe1\u606f\uff0c\u5e2e\u52a9\u6211\u4eec\u5206\u6790\u6e38\u620f\u6027\u80fd\u3002</p> <p></p> <ul> <li> <p>\u9996\u5148\u6211\u4eec\u6765\u4e86\u89e3\u51e0\u4e2a\u6982\u5ff5\u6027\u7684\u95ee\u9898</p> </li> <li> <p>\u5782\u76f4\u540c\u6b65   \u5173\u4e8e\u5782\u76f4\u540c\u6b65\u7684\u95ee\u9898\uff0c\u6211\u4eec\u5728\u4e4b\u524d\u7684\u5de5\u5177\u7bc7\u4e2d\u5c31\u6709\u63d0\u5230\uff0c\u60f3\u8981\u4e86\u89e3\u7684\u8bfb\u8005\u53ef\u4ee5\u770b\u770b\u4e4b\u524d\u7684\u6587\u7ae0\uff0c\u5982\u679c\u8981\u6df1\u5165\u4e86\u89e3\uff0c\u53ef\u80fd\u9700\u8981\u53c2\u8003\u4e00\u4e9b\u6559\u7a0b\uff0c\u5728\u672c\u6587\u4e2d\u5c31\u4e0d\u505a\u8fc7\u591a\u7684\u9610\u8ff0\u3002     Unity3D\u6027\u80fd\u4f18\u5316\u2014\u2014\u5de5\u5177\u7bc7</p> </li> <li> <p>\u6e32\u67d3   \u5728unity\u4e2dGPU\u548cCPU\u6e32\u67d3\u4e5f\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u8bdd\u9898\uff0c\u5728\u4e4b\u540e\u7684\u6587\u7ae0\u4e2d\uff0c\u4f1a\u63d0\u5230\u6e32\u67d3\u95ee\u9898\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u53ea\u9700\u8981\u5927\u81f4\u7684\u4e86\u89e3\u4ec0\u4e48\u662fBatches\u548cDraw Call\u3002   \u5728\u6211\u4eec\u8fdb\u884c\u6e38\u620f\u4f18\u5316\u65f6\uff0c\u5e38\u4f1a\u542c\u5230\u8981\u51cf\u5c11Draw Call\u3002Draw Call\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u547d\u4ee4\uff0c\u5b83\u7684\u53d1\u8d77\u65b9\u662fCPU\uff0c\u63a5\u6536\u65b9\u662fGPU\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4ec5\u4ec5\u4f1a\u6307\u5411\u4e00\u4e2a\u9700\u8981\u88ab\u6e32\u67d3\u7684\u56fe\u5143\u5217\u8868\uff0c\u800c\u4e0d\u4f1a\u518d\u5305\u542b\u4efb\u4f55\u6750\u8d28\u4fe1\u606f\u3002 \u5f53\u7ed9\u5b9a\u4e00\u4e2aDraw Call\u65f6\uff0cGPU\u5c31\u4f1a\u6839\u636e\u6e32\u67d3\u72b6\u6001\u548c\u6240\u6709\u8f93\u5165\u7684\u9876\u70b9\u6570\u636e\u6765\u8fdb\u884c\u8ba1\u7b97\uff0c\u6700\u7ec8\u8f93\u51fa\u6210\u5c4f\u5e55\u4e0a\u663e\u793a\u7684\u50cf\u7d20\u3002   \u5f15\u64ce\u6bcf\u5bf9\u4e00\u4e2a\u7269\u4f53\u8fdb\u884c\u4e00\u6b21DrawCall\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u4e2aBatch\uff0c\u8fd9\u4e2aBatch\u91cc\u5305\u542b\u7740\u8be5\u7269\u4f53\u6240\u6709\u7684\u7f51\u683c\u548c\u9876\u70b9\u6570\u636e\uff0c\u5f53\u6e32\u67d3\u53e6\u4e00\u4e2a\u76f8\u540c\u7684\u7269\u4f53\u65f6\uff0c\u5f15\u64ce\u4f1a\u76f4\u63a5\u8c03\u7528Batch\u91cc\u7684\u4fe1\u606f\uff0c\u5c06\u76f8\u5173\u9876\u70b9\u6570\u636e\u76f4\u63a5\u9001\u5230GPU\uff0c\u4ece\u800c\u8ba9\u6e32\u67d3\u8fc7\u7a0b\u66f4\u52a0\u9ad8\u6548\uff0c\u5373Batching\u6280\u672f\u662f\u5c06\u6240\u6709\u6750\u8d28\u76f8\u8fd1\u7684\u7269\u4f53\u8fdb\u884c\u5408\u5e76\u6e32\u67d3\u3002   Batches\u5176\u5b9e\u5c31\u662fUnity\u5185\u7f6e\u7684Draw Call Batching</p> </li> <li> <p>GC(\u5783\u573e\u56de\u6536)</p> </li> </ul> <p>\u5728\u63d0\u8d77\u8fd9\u4e2a\u95ee\u9898\u65f6\uff0c\u6211\u4eec\u9996\u5148\u8981\u4e86\u89e3\u4e00\u4e0bGC\u3002 \u800c\u60f3\u8981\u4e86\u89e3\u4ec0\u4e48\u662fGC\u6211\u4eec\u5c31\u8981\u8003\u8651\u5230unity\u7684\u5185\u5b58\u7ba1\u7406\u673a\u5236\u3002</p> <p>Unity\u4e3b\u8981\u91c7\u7528\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u7684\u673a\u5236\uff0c\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u8be6\u7ec6\u5730\u544a\u8bc9unity\u5982\u4f55\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\uff0cunity\u5185\u90e8\u81ea\u8eab\u4f1a\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\u3002</p> <p>Unity\u5185\u90e8\u6709\u4e24\u4e2a\u5185\u5b58\u7ba1\u7406\u6c60\uff1a\u5806\u5185\u5b58\u548c\u6808\u5185\u5b58\u3002</p> <p>Unity\u4e2d\u7684\u53d8\u91cf\u53ea\u4f1a\u5728\u6808\u6216\u5806\u5185\u5b58\u4e0a\u8fdb\u884c\u5185\u5b58\u5206\u914d\u3002\u53ea\u8981\u53d8\u91cf\u5904\u4e8e\u6fc0\u6d3b\u72b6\u6001\uff0c\u5219\u5176\u5360\u7528\u7684\u5185\u5b58\u4f1a\u88ab\u6807\u8bb0\u4e3a\u4f7f\u7528\u72b6\u6001\uff0c\u5219\u8be5\u90e8\u5206\u7684\u5185\u5b58\u5904\u4e8e\u88ab\u5206\u914d\u7684\u72b6\u6001\u3002\u4e00\u65e6\u53d8\u91cf\u4e0d\u518d\u6fc0\u6d3b\uff0c\u5219\u5176\u6240\u5360\u7528\u7684\u5185\u5b58\u4e0d\u518d\u9700\u8981\uff0c\u8be5\u90e8\u5206\u5185\u5b58\u53ef\u4ee5\u88ab\u56de\u6536\u5230\u5185\u5b58\u6c60\u4e2d\u88ab\u518d\u6b21\u4f7f\u7528\uff0c\u8fd9\u6837\u7684\u64cd\u4f5c\u5c31\u662f\u5185\u5b58\u56de\u6536\u3002\u5904\u4e8e\u6808\u4e0a\u7684\u5185\u5b58\u56de\u6536\u53ca\u5176\u5feb\u901f\uff0c\u5904\u4e8e\u5806\u4e0a\u7684\u5185\u5b58\u5e76\u4e0d\u662f\u53ca\u65f6\u56de\u6536\u7684\uff0c\u6b64\u65f6\u5176\u5bf9\u5e94\u7684\u5185\u5b58\u4f9d\u7136\u4f1a\u88ab\u6807\u8bb0\u4e3a\u4f7f\u7528\u72b6\u6001\u3002\u5783\u573e\u56de\u6536\u4e3b\u8981\u662f\u6307\u5806\u4e0a\u7684\u5185\u5b58\u5206\u914d\u548c\u56de\u6536\uff0cunity\u4e2d\u4f1a\u5b9a\u65f6\u5bf9\u5806\u5185\u5b58\u8fdb\u884cGC\u64cd\u4f5c\u3002</p> <p>\u6bcf\u6b21\u8fd0\u884cGC\u7684\u65f6\u5019\uff0c\u4f1a\u68c0\u67e5\u5806\u5185\u5b58\u4e0a\u7684\u6bcf\u4e2a\u5b58\u50a8\u53d8\u91cf\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u53d8\u91cf\u4f1a\u68c0\u6d4b\u5176\u5f15\u7528\u662f\u5426\u5904\u4e8e\u6fc0\u6d3b\u72b6\u6001\uff0c\u5982\u679c\u53d8\u91cf\u7684\u5f15\u7528\u4e0d\u518d\u5904\u4e8e\u6fc0\u6d3b\u72b6\u6001\uff0c\u5219\u4f1a\u88ab\u6807\u8bb0\u4e3a\u53ef\u56de\u6536\uff0c\u88ab\u6807\u8bb0\u7684\u53d8\u91cf\u4f1a\u88ab\u79fb\u9664\uff0c\u5176\u6240\u5360\u6709\u7684\u5185\u5b58\u4f1a\u88ab\u56de\u6536\u5230\u5806\u5185\u5b58\u4e0a\u3002GC\u64cd\u4f5c\u662f\u4e00\u4e2a\u6781\u5176\u8017\u8d39\u7684\u64cd\u4f5c\uff0c\u5806\u5185\u5b58\u4e0a\u7684\u53d8\u91cf\u6216\u8005\u5f15\u7528\u8d8a\u591a\u5219\u5176\u8fd0\u884c\u7684\u64cd\u4f5c\u4f1a\u66f4\u591a\uff0c\u8017\u8d39\u7684\u65f6\u95f4\u8d8a\u957f\u3002 \u5728\u4e86\u89e3GC\u5728unity\u5185\u5b58\u7ba1\u7406\u4e2d\u7684\u4f5c\u7528\u540e\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u5176\u5e26\u6765\u7684\u95ee\u9898\u3002\u6700\u660e\u663e\u7684\u95ee\u9898\u662fGC\u64cd\u4f5c\u4f1a\u9700\u8981\u5927\u91cf\u7684\u65f6\u95f4\u6765\u8fd0\u884c\uff0c\u5982\u679c\u5806\u5185\u5b58\u4e0a\u6709\u5927\u91cf\u7684\u53d8\u91cf\u6216\u8005\u5f15\u7528\u9700\u8981\u68c0\u67e5\uff0c\u5219\u68c0\u67e5\u7684\u64cd\u4f5c\u4f1a\u5341\u5206\u7f13\u6162\uff0c\u8fd9\u5c31\u4f1a\u4f7f\u5f97\u6e38\u620f\u8fd0\u884c\u7f13\u6162\u3002\u5176\u6b21GC\u53ef\u80fd\u4f1a\u5728\u5173\u952e\u65f6\u5019\u8fd0\u884c\uff0c\u4f8b\u5982\u5728CPU\u5904\u4e8e\u6e38\u620f\u7684\u6027\u80fd\u8fd0\u884c\u5173\u952e\u65f6\u523b\uff0c\u6b64\u65f6\u4efb\u4f55\u4e00\u4e2a\u989d\u5916\u7684\u64cd\u4f5c\u90fd\u53ef\u80fd\u4f1a\u5e26\u6765\u6781\u5927\u7684\u5f71\u54cd\uff0c\u4f7f\u5f97\u6e38\u620f\u5e27\u7387\u4e0b\u964d\u3002</p> <p>\u53e6\u5916\u4e00\u4e2aGC\u5e26\u6765\u7684\u95ee\u9898\u662f\u5806\u5185\u5b58\u7684\u788e\u7247\u5316\u3002\u5f53\u4e00\u4e2a\u5185\u5b58\u5355\u5143\u4ece\u5806\u5185\u5b58\u4e0a\u5206\u914d\u51fa\u6765\uff0c\u5176\u5927\u5c0f\u53d6\u51b3\u4e8e\u5176\u5b58\u50a8\u7684\u53d8\u91cf\u7684\u5927\u5c0f\u3002\u5f53\u8be5\u5185\u5b58\u88ab\u56de\u6536\u5230\u5806\u5185\u5b58\u4e0a\u7684\u65f6\u5019\uff0c\u6709\u53ef\u80fd\u4f7f\u5f97\u5806\u5185\u5b58\u88ab\u5206\u5272\u6210\u788e\u7247\u5316\u7684\u5355\u5143\u3002\u4e5f\u5c31\u662f\u8bf4\u5806\u5185\u5b58\u603b\u4f53\u53ef\u4ee5\u4f7f\u7528\u7684\u5185\u5b58\u5355\u5143\u8f83\u5927\uff0c\u4f46\u662f\u5355\u72ec\u7684\u5185\u5b58\u5355\u5143\u8f83\u5c0f\uff0c\u5728\u4e0b\u6b21\u5185\u5b58\u5206\u914d\u7684\u65f6\u5019\u4e0d\u80fd\u627e\u5230\u5408\u9002\u5927\u5c0f\u7684\u5b58\u50a8\u5355\u5143\uff0c\u8fd9\u4e5f\u4f1a\u89e6\u53d1GC\u64cd\u4f5c\u6216\u8005\u5806\u5185\u5b58\u6269\u5c55\u64cd\u4f5c\u3002</p> <p>\u5806\u5185\u5b58\u788e\u7247\u4f1a\u9020\u6210\u4e24\u4e2a\u7ed3\u679c\uff0c\u4e00\u4e2a\u662f\u6e38\u620f\u5360\u7528\u7684\u5185\u5b58\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u4e00\u4e2a\u662fGC\u4f1a\u66f4\u52a0\u9891\u7e41\u5730\u88ab\u89e6\u53d1\u3002</p> <p>\u5728\u4e86\u89e3\u4e86\u4ee5\u4e0a\u7684\u51e0\u4e2a\u6982\u5ff5\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece\u5b9e\u9645\u8fd0\u7528\u4e2d\u6765\u63a2\u7d22\uff0c\u5982\u4f55\u5bf9unity\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u65f6\u5f15\u8d77\u7684\u6027\u80fd\u95ee\u9898\u8fdb\u884c\u4f18\u5316\u3002</p>"},{"location":"game/perf/cpu/#1","title":"1.\u7f13\u5b58","text":"<p>\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e9b\u5fc5\u8981\u7684\u5bf9\u8c61\u7f13\u5b58\u8d77\u6765\uff0c \u5728Unity\u4e2d\uff0c\u7c7b\u4f3c\u4e8eGameObject.Find \uff0c GetComponent\uff0ctransform\u8fd9\u7c7b\u7684\u51fd\u6570\uff0c\u4f1a\u4ea7\u751f\u8f83\u5927\u7684\u6d88\u8017\uff0c\u6bd4\u5982\u4e0b\u5217\u4ee3\u7801\uff1a</p> <pre><code>void Update(){\n    this.transform.Translate(0, 1, 0);\n    this.GetComponent&lt;Rigidbody&gt;().AddForce(Vector3.forward);\n}\n</code></pre> <p>\u5728update\u4e2d\uff0c\u6bcf\u5e27\u90fd\u53bb\u8bbf\u95ee\u8fd9\u4e9b\u51fd\u6570\u662f\u975e\u5e38\u8017\u65f6\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 Awake \u6216\u8005 Start \u51fd\u6570\u4e2d\uff0c\u83b7\u53d6\u4e00\u6b21\u7ec4\u4ef6\u5f15\u7528\uff0c\u628a\u5f15\u7528\u7f13\u5b58\u5728\u5f53\u524d class \u4e2d\uff0c\u4f9b Update \u7b49\u51fd\u6570\u4f7f\u7528 \u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u6bcf\u5e27\u83b7\u53d6\u7ec4\u4ef6\u5e26\u6765\u7684\u5f00\u9500\u3002</p> <pre><code>Rigidbody mRigi;\nprivate Transform mTransform;\n\nvoid Awake(){\n    myRigi = this.GetComponent&lt;Rigidbody&gt;();\n    myTransform = this.transform;\n}\n\nvoid Update(){\n    myRigidbody.AddForce(Vector3.forward);\n    myTransform.Translate(0, 1f, 0f);\n}\n</code></pre> <p>\u5728 Awake \u51fd\u6570\u4e2d\u83b7\u53d6\u521a\u4f53\u7ec4\u4ef6\u548c transform \u7ec4\u4ef6\u7684\u5f15\u7528\uff0c\u5b83\u4eec\u7f13\u5b58\u5728\u5f53\u524d\u7684 class \u7684\u5b57\u6bb5\u4e2d\uff0c\u7136\u540e\u5728 update \u51fd\u6570\u4e2d\u901a\u8fc7\u79c1\u6709\u5b57\u6bb5\uff0c\u6765\u4f7f\u7528\u521a\u4f53\u548c transform \u7ec4\u4ef6\u3002</p> <ul> <li>\u6ce8\u610f\uff0cGetComponent\u5982\u679c\u8fd4\u56de\u7a7a\u503c\u4f1a\u8c03\u7528GC\u5982\u4e0b\u6240\u793a\uff1a</li> </ul> <p></p> <p>\u5728\u8fd9\u91cc\uff0ccube\u4e2d\u5e76\u6ca1\u6709\u6dfb\u52a0\u521a\u4f53\uff0c\u6211\u4eec\u5728update\u4e2d\u8c03\u7528\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>this.GetComponent&lt;Rigidbody&gt;().AddForce(Vector3.forward);\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5728Profiler\u4e2d\uff0cBehaviourUpdate\u6709\u8fd116k\u7684GC</p> <p></p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u907f\u514d\u51fa\u73b0\u7a7a\u7684\u7ec4\u4ef6\u83b7\u53d6\u3002</p> <ul> <li>\u540c\u65f6\u6211\u4eec\u5728\u9879\u76ee\u4e2d\u53ef\u80fd\u4f1a\u7528\u5230\uff0c<code>unityEngine.Object == null</code>\u8fd9\u6837\u7684\u6bd4\u8f83\u65b9\u6cd5\uff0c\u5b83\u548cGetComponent()\u7684\u60c5\u51b5\u7c7b\u4f3c\uff0c\u4e5f\u4f1a\u51fa\u73b0cpu\u6d88\u8017\u4ee5\u53caGC\uff0c\u8fd9\u91cc\u90fd\u6d89\u53ca\u5230\u5f15\u64ce\u65b9\u9762\u7684\u8c03\u7528\u673a\u5236\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u7684\u6d4b\u8bd5\u529f\u80fd\uff0c\u6211\u4eec\u90fd\u5e94\u8be5\u5c11\u505anull\u6bd4\u8f83\uff0c\u800c\u662f\u4f7f\u7528**\u65ad\u8a00\uff08Assert\uff09**\u6765\u4ee3\u66ff\u3002</li> </ul>"},{"location":"game/perf/cpu/#2","title":"2. \u5bf9\u8c61\u6c60","text":"<ul> <li>\u5bf9\u8c61\u6c60\u662f\u6211\u4eec\u5728\u5b9e\u9645\u7684\u6e38\u620f\u5f00\u53d1\u4e2d\uff0c\u8fd0\u7528\u6bd4\u8f83\u5e7f\u6cdb\u7684\u91cd\u8981\u6280\u672f\u3002</li> </ul> <p>\u5728\u9879\u76ee\u4e2d\u9891\u7e41\u5730\u4f7f\u7528 Instantiate \u548c Destroy \u51fd\u6570\uff0c\u4f1a\u4e3a\u811a\u672c\u6267\u884c\u548c\u5783\u573e\u56de\u6536\u5e26\u6765\u5f88\u5927\u7684\u6027\u80fd\u5f00\u9500\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6211\u4eec\u4f7f\u7528Instantiate\u51fd\u6570\u5927\u91cf\u7684\u521b\u5efa\u7269\u4f53\uff0c\u5e76\u4f7f\u7528Destroy\u9500\u6bc1\uff0c\u8fd9\u4e9b\u4ee3\u7801\u5360\u7528\u4e86\u5927\u91cf\u7684cpu\u65f6\u95f4\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5bf9\u8c61\u6c60\u4f18\u5316\u6e38\u620f\u5bf9\u8c61\u7684\u521b\u5efa\u548c\u9500\u6bc1</p> <p>\u5bf9\u8c61\u6c60\u7684\u542b\u4e49\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u5c06\u5bf9\u8c61\u50a8\u5b58\u5728\u4e00\u4e2a\u201c\u6c60\u201d\u4e2d\uff0c\u5f53\u9700\u8981\u5b83\u65f6\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u5c3d\u53ef\u80fd\u7684\u590d\u7528\u5185\u5b58\u4e2d\u5df2\u7ecf\u9a7b\u7559\u7684\u8d44\u6e90\u6765\u51cf\u5c11\u9891\u7e41\u7684IO\u8017\u65f6\u64cd\u4f5c\u3002\u6709\u7ecf\u9a8c\u7684\u5f00\u53d1\u8005\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u65f6\u5c31\u4f1a\u505a\u4e00\u4e2a\u89c4\u8303\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u89d2\u8272\u6c60\uff0c\u602a\u7269\u6c60\uff0c\u7279\u6548\u6c60\uff0c\u7ecf\u9a8c\u6c60\u7b49\u3002</p> <ul> <li>\u6ce8\u610f\uff1a\u4f7f\u7528\u5bf9\u8c61\u6c60\u65f6\uff0c\u5e94\u5f53\u53ef\u4ee5\u652f\u6301\u628a\u7269\u4f53\u79fb\u51fa\u5c4f\u5e55\uff0c\u8fde\u7eed\u4f7f\u7528\u7684\u7269\u4f53\u53ef\u4ee5\u53ea\u662f\u79fb\u51fa\u5c4f\u5e55\uff0c\u53ea\u6709\u957f\u65f6\u95f4\u4e0d\u4f7f\u7528\u7684\u7269\u4f53\u624d\u9690\u85cf\uff1b\u56e0\u4e3a\u9891\u7e41\u7684Activate\u4f7f\u7528\uff0c\u4e5f\u4f1a\u5f15\u8d77\u4e0d\u5fc5\u8981\u7684\u6027\u80fd\u6d88\u8017\u3002</li> </ul>"},{"location":"game/perf/cpu/#3","title":"3.\u5197\u4f59\u4ee3\u7801","text":"<p>\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u51fd\u6570\u3001\u65e0\u7528\u7684\u4ee3\u7801\u6bb5\u53ca\u6d4b\u8bd5\u4ee3\u7801</p> <p>\u5728\u6211\u4eec\u7684\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u53ef\u80fd\u4f1a\u589e\u52a0\u5f88\u591a\u6d4b\u8bd5\u4ee3\u7801\uff0c\u6216\u8005\u6709\u4e00\u4e9b\u7a7a\u7684\u56de\u8c03\u51fd\u6570\u6216\u8bb8\u8fd8\u4f1a\u6709\u4e00\u4e9b\u4e0d\u9700\u8981\u7684\u7ee7\u627f\u3002 \u6bd4\u5982\u8bf4\u4e00\u4e9b\u63a7\u5236\u53f0\u8f93\u51fa\u7684\u7684\u6d4b\u8bd5\u6216\u8005\u7a7a\u7684start\u3001update\uff0c\u8fd9\u4e9b\u90fd\u4f1a\u6d88\u8017CPU\u6027\u80fd\u3002 \u6240\u4ee5\u5728\u9879\u76ee\u5f00\u59cb\u65f6\uff0c\u5e94\u8be5\u5728\u7f16\u8f91\u5668\u4e2d\u8bbe\u7f6e\u4e0d\u8981\u81ea\u52a8\u7ee7\u627fMonoBehaviour\uff0c\u5728\u9700\u8981\u4f7f\u7528\u65f6\u81ea\u884c\u6dfb\u52a0\u3002\u540c\u65f6\u6d4b\u8bd5\u4ee3\u7801\u8981\u505a\u597d\u6807\u8bb0\uff0c\u4e0d\u518d\u9700\u8981\u5176\u65f6\u4e00\u70b9\u8981\u5220\u9664\u3002</p>"},{"location":"game/perf/cpu/#4cpu","title":"4.CPU\u5cf0\u503c","text":"<p>\u907f\u514d\u5b9e\u4f8b\u5316\u5bf9\u8c61\u65f6\u9020\u6210cpu\u5cf0\u503c</p> <p>\u5982\u679c\u6211\u4eec\u5728\u67d0\u4e00\u4e2a\u7279\u5b9a\u65f6\u95f4\uff0c\u96c6\u4e2d\u521b\u5efa\u5f88\u591a\u5bf9\u8c61\uff0c\u4f1a\u9020\u6210\u8fd9\u4e00\u65f6\u95f4\u6bb5\u7684cpu\u5cf0\u503c\uff0c\u6211\u4eec\u7684\u6e38\u620f\u5c31\u4f1a\u5728\u8fd9\u4e00\u65f6\u95f4\u6bb5\u5c31\u4f1a\u51fa\u73b0\u5361\u987f\uff0c\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u534f\u7a0b\u505a\u4e00\u4e9b\u95f4\u9694\u3002 \u6253\u4e2a\u6bd4\u65b9\uff0c\u6211\u4eec\u5f00\u53d1\u4e00\u4e2arpg\u6e38\u620f\uff0c\u5f53\u6211\u4eec\u5207\u6362\u5230\u4e00\u4e2a\u65b0\u7684\u5730\u56fe\uff0c\u5730\u56fe\u4e2d\u6709\u5927\u91cf\u7684\u602a\u7269\uff0c\u5982\u679c\u6211\u4eec\u5728\u8fdb\u5165\u5730\u56fe\u65f6\u96c6\u4e2d\u521b\u5efa\u6240\u6709\u7684\u602a\u7269\uff0c\u90a3\u4e48\u5728\u521d\u59cb\u8fdb\u5165\u5730\u56fe\u7684\u77ac\u95f4\uff0c\u5fc5\u7136\u4f1a\u975e\u5e38\u7684\u5361\u987f\u3002\u6211\u4eec\u53ef\u4ee5\u505a\u7684\u5c31\u662f\u5728\u52a0\u8f7d\u8fdb\u5ea6\u6216\u8fdb\u5165\u5730\u56fe\u540e\uff0c\u4f7f\u7528\u534f\u7a0b\uff0c\u5982\u6bcf\u4e00\u5e27\u521b\u5efa\u4e00\u4e2a\u602a\u7269\uff0c\u8fd9\u6837\u53ef\u4ee5\u5728\u6211\u4eec\u5b8c\u6210\u5176\u4ed6\u52a8\u4f5c\uff08\u5982\u884c\u8d70\uff09\u7684\u6bcf\u5e27\u540c\u65f6(\u4e4b\u540e)\uff0c\u9010\u6e10\u521b\u5efa\u6e38\u620f\u5bf9\u8c61\uff0c\u8fd9\u6837\u6211\u4eec\u57fa\u672c\u4e0d\u4f1a\u611f\u89c9\u5230\u6e38\u620f\u7684\u5361\u987f\uff0c\u5e76\u4e14\u540c\u6837\u5b9e\u73b0\u4e86\u6211\u4eec\u521b\u5efa\u6e38\u620f\u5bf9\u8c61\u7684\u9700\u6c42\u3002</p> <p>Unity\u4e2d\u7684\u534f\u7a0b\u65b9\u6cd5\u901a\u8fc7yield\u8fd9\u4e2a\u7279\u6b8a\u7684\u5c5e\u6027\uff0c\u53ef\u4ee5\u5728\u4efb\u4f55\u4f4d\u7f6e\u3001\u4efb\u610f\u65f6\u523b\u6682\u505c\u3002\u4e5f\u53ef\u4ee5\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u6216\u4e8b\u4ef6\u540e\u7ee7\u7eed\u6267\u884c\uff0c\u800c\u4e0d\u5f71\u54cd\u4e0a\u4e00\u6b21\u6267\u884c\u7684\u5c31\u7ed3\u679c\uff0c\u63d0\u4f9b\u4e86\u6781\u5927\u5730\u4fbf\u5229\u6027\u548c\u5b9e\u7528\u6027\u3002</p> <p>\u534f\u7a0b\u5728\u6bcf\u6b21\u6267\u884c\u65f6\u90fd\u4f1a\u65b0\u5efa\u4e00\u4e2a\uff08\u4f2a\uff09\u65b0\u7ebf\u7a0b\u6765\u6267\u884c\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u7684\u6267\u884c\u60c5\u51b5\u3002</p> <pre><code>private int instanceCount;\nvoid Start(){\n    insCount = 10;\n    //\u542f\u52a8\u534f\u7a0b\n    StartCoroutine(SpawnInstance());\n}\n\nIEnumerator SpawnInstance(){\n    while(insCount &gt; 0){\n        //\u8fd9\u91cc\u521b\u5efa\u6e38\u620f\u7269\u4f53\n        insCount --;\n        //\u534f\u7a0b\u8fd4\u56de\uff0c\u5728\u56fa\u5b9a\u65f6\u95f4\u540e\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801\n        yield return new WaitForSeconds(1f);\n    }\n}\n</code></pre> <ul> <li>\u6ce8\u610f\uff1a\u5728\u4f7f\u7528\u534f\u7a0b\u65f6\uff0cyield\u672c\u4e0d\u4f1a\u4ea7\u751f\u5806\u5185\u5b58\u5206\u914d\uff0c\u4f46\u662f\u5982\u679cyield\u5e26\u6709\u53c2\u6570\u8fd4\u56de\uff0c\u5219\u4f1a\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u5185\u5b58\u5783\u573e \u4f8b\u5982\uff1a<code>yield return 0;</code>\u7531\u4e8e\u9700\u8981\u8fd4\u56de0\uff0c\u5f15\u53d1\u4e86\u88c5\u7bb1\u64cd\u4f5c\uff0c\u6240\u4ee5\u4f1a\u4ea7\u751f\u5185\u5b58\u5783\u573e\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u907f\u514d\u5185\u5b58\u5783\u573e\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u8fd4\u56de\uff1a<code>yield return null;</code>\u5982\u679c\u6211\u4eec\u6bcf\u6b21\u8fd4\u56de\u65f6\uff0c\u90fd\u4f1anew\u4e00\u4e2a\u76f8\u540c\u7684\u53d8\u91cf\uff0c \u4f8b\u5982\u6211\u4eec\u4e0a\u8fb9\u7684\u4ee3\u7801<code>yield return new WaitForSeconds(1f);</code>\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u7f13\u5b58\u6765\u907f\u514d\u8fd9\u6837\u7684\u5185\u5b58\u5783\u573e\u4ea7\u751f\uff1a</li> </ul> <pre><code>WaitForSeconds spawnWait = new WaiForSeconds(1f);\n\nIEnumerator SpawnInstance(){\n    while(insCount &gt; 0){\n        //\u8fd9\u91cc\u521b\u5efa\u6e38\u620f\u7269\u4f53\n        insCount --;\n        //\u534f\u7a0b\u8fd4\u56de\uff0c\u5728spawnWait\u65f6\u95f4\u540e\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801\n        yield return spawnWait;\n    }\n}\n</code></pre>"},{"location":"game/perf/cpu/#5gc","title":"5.GC(\u5783\u573e\u56de\u6536)","text":"<p>\u5c3d\u91cf\u5c11\u7684\u4f7f\u7528\u4f1a\u8c03\u7528GC\u7684\u4ee3\u7801</p> <p>\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e0b\uff0c\u5728\u6211\u4eec\u5199\u4ee3\u7801\u65f6\uff0c\u54ea\u4e9b\u64cd\u4f5c\u4f1a\u8c03\u7528GC\uff1a 1\uff09 \u5728\u5806\u5185\u5b58\u8fdb\u884c\u5185\u5b58\u5206\u914d\u64cd\u4f5c\uff0c\u800c\u5185\u5b58\u4e0d\u591f\u65f6\u4fbf\u4f1a\u89e6\u53d1\u5783\u573e\u56de\u6536\u6765\u5229\u7528\u95f2\u7f6e\u5185\u5b58\uff1b 2\uff09 GC\u4f1a\u81ea\u52a8\u7684\u89e6\u53d1\uff0c\u4e0d\u540c\u5e73\u53f0\u9891\u7387\u4e0d\u540c\uff1b 3\uff09 GC\u53ef\u4ee5\u624b\u52a8\u6267\u884c\u3002</p> <p>\u5176\u4e2d\u6700\u4e3b\u8981\u7684\u5c31\u662f\u7b2c\u4e00\u70b9\uff0c\u5982\u679cGC\u9020\u6210\u6027\u80fd\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u9700\u8981\u77e5\u9053\u54ea\u90e8\u5206\u4ee3\u7801\u4f1a\u9020\u6210GC\uff0c\u5185\u5b58\u5783\u573e\u5728\u53d8\u91cf\u4e0d\u518d\u6fc0\u6d3b\u65f6\u4ea7\u751f\uff0c\u6240\u4ee5\u9996\u5148\u6211\u4eec\u9700\u8981\u77e5\u9053\u5806\u5185\u5b58\u4e0a\u5206\u914d\u7684\u662f\u4ec0\u4e48\u53d8\u91cf\u3002</p> <p>\u5373\u4f7f\u662f\u521d\u5b66\u8005\u4e5f\u5e94\u8be5\u4e86\u89e3\u5728C#\u4e2d\uff0c\u503c\u7c7b\u578b\u53d8\u91cf\u90fd\u5728\u6808\u4e0a\u8fdb\u884c\u5185\u5b58\u5206\u914d\uff08\u5982int = 7 \u5176\u5bf9\u5e94\u7684\u53d8\u91cf\u5728\u51fd\u6570\u8c03\u7528\u5b8c\u540e\u4f1a\u7acb\u5373\u56de\u6536\uff09\uff0c\u5f15\u7528\u7c7b\u578b\u90fd\u5728\u5806\u5185\u5b58\u4e0a\u5206\u914d\uff08\u5982List myList = new List() \u5176\u5bf9\u5e94\u7684\u53d8\u91cf\u5728GC\u7684\u65f6\u5019\u624d\u56de\u6536\uff09\u3002</p> <p>\u5728\u4e86\u89e3\u4e86\u8fd9\u4e9b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u5408\u4e4b\u524d\u6240\u5b66\u7684profier\u5de5\u5177\u6765\u5b9a\u4f4d\u9020\u6210\u5927\u91cf\u5185\u5b58\u5206\u914d\u7684\u51fd\u6570\uff0c\u4e00\u65e6\u5b9a\u4f4d\u8be5\u51fd\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5206\u6790\u89e3\u51b3\u5176\u9020\u6210\u95ee\u9898\u7684\u539f\u56e0\u4ece\u800c\u51cf\u5c11\u5185\u5b58\u5783\u573e\u7684\u4ea7\u751f\u3002</p> <p>\u6211\u4eec\u5728\u4e4b\u524d\u5df2\u7ecf\u63d0\u5230\u4e86\u90e8\u5206\u4f1a\u8c03\u7528GC\u7684\u64cd\u4f5c\uff0c\u5e76\u4e14\u4e86\u89e3\u4e86GC\u7684\u57fa\u672c\u539f\u7406\uff0c\u8fd9\u91cc\u6211\u4eec\u518d\u8bf4\u4e00\u4e9b\u4f1a\u8c03\u7528GC\u7684\u64cd\u4f5c\u3002</p> <ul> <li> <p>\u6bd4\u5982String\u7684\u76f8\u52a0\u64cd\u4f5c\uff0c \u4f1a\u9891\u7e41\u7533\u8bf7\u5185\u5b58\u5e76\u91ca\u653e\uff0c\u5bfc\u81f4GC\u9891\u7e41\uff08\u5728c#\u4e2d\uff0c\u5b57\u7b26\u4e32\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u6bcf\u6b21\u6211\u4eec\u64cd\u7eb5\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u6bd4\u5982\u8fd9\u91cc\u6240\u8bf4\u7684\u76f8\u52a0\u64cd\u4f5c\uff09\uff0cUnity\u5c06\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u66f4\u65b0\u503c\u7684\u65b0\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u521b\u5efa\u548c\u9500\u6bc1\u5b57\u7b26\u4e32\u90fd\u4f1a\u4ea7\u751f\u5783\u573e\u3002\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528System.Text.StringBuilder\u3002</p> </li> <li> <p>\u5728unity\u4e2d\uff0c\u5f88\u591a\u51fd\u6570\u8c03\u7528\u4e5f\u4f1a\u9020\u6210\u5185\u5b58\u5783\u573e\uff0c\u6bd4\u5982\u4e4b\u524d\u6240\u8bf4\u5230\u7684GetComponent\uff0c\u8fd8\u6709GameObject.name\u6216GameObject.tag\uff0cInput.touches\uff0cPhysics.SphereCastAll()\u7b49\u3002   \u6211\u4eec\u53ef\u4ee5\u5982\u4e0a\u6587\u7b2c\u4e00\u70b9\u63cf\u8ff0\u7684\u65b9\u6cd5\uff0c\u5148\u5bf9\u5176\u8fdb\u884c\u7f13\u5b58\u3002\u800c\u4e14unity\u4e5f\u63d0\u4f9b\u4e86\u76f8\u5173\u7684\u51fd\u6570\u6765\u66ff\u6362\u4ed6\u4eec\uff0c\u6bd4\u5982GameObject.tag\u6211\u4eec\u53ef\u4ee5\u4f7fGameObject.CompareTag()\u6765\u66ff\u4ee3\uff0cInput.touches\u53ef\u4ee5\u4f7f\u7528Input.GetTouch()\uff0c\u6216\u8005\u7528Physics.SphereCastNonAlloc()\u6765\u4ee3\u66ffPhysics.SphereCastAll()\u3002</p> </li> </ul> <p>\u4ee5\u4e0a\u662f\u6211\u4eec\u5728\u5b9e\u9645\u7684unity\u9879\u76ee\u4e2d\u8fdb\u884ccpu\u4f18\u5316\u7684\u4e3b\u8981\u6ce8\u610f\u65b9\u5411\uff0c\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u9879\u76ee\u7684\u4f18\u5316\u4e2d\uff0c\u8fd8\u6709\u66f4\u591a\u7684\u65b9\u6cd5\u548c\u7ec6\u8282\u9700\u8981\u6211\u4eec\u6ce8\u610f\uff0c\u4f8b\u5982</p> <p>1\uff09\u51cf\u5c11\u5bf9\u7c92\u5b50\u7cfb\u7edfPlay()\u7684\u8c03\u7528\uff1b</p> <p>2\uff09\u5904\u7406Rigidbody\u65f6\uff0c\u4f7f\u7528FixedUpdate\uff0c\u8bbe\u7f6eFixed timestep\uff0c\u51cf\u5c11\u7269\u7406\u8ba1\u7b97\u6b21\u6570\uff1b</p> <p>3\uff09\u5982\u679c\u53ef\u4ee5\uff0c\u5c3d\u91cf\u4e0d\u7528MeshCollider\uff0c\u5982\u679c\u4e0d\u80fd\u907f\u514d\u7684\u8bdd\uff0c\u5c3d\u91cf\u7528\u51cf\u5c11Mesh\u7684\u9762\u7247\u6570\uff0c\u6216\u7528\u8f83\u5c11\u9762\u7247\u7684\u7269\u4f53\u6765\u4ee3\u66ff\uff1b</p> <p>4\uff09\u4f7f\u7528\u5185\u5efa\u6570\u7ec4\u5982\u4f7f\u7528Vector3.zero\u800c\u4e0d\u662fnew Vector(0,0,0);</p> <p>5\uff09\u6bcf\u6b21\u8bbf\u95eeTransform.position/rotation\u90fd\u6709\u76f8\u5e94\u7684\u6d88\u8017\u3002\u80fdcache\u5c31cache\u5176\u8fd4\u56de\u7ed3\u679c\u3002</p> <p>6\uff09\u5982\u679c\u53ef\u80fd\uff0c\u5c3d\u91cf\u7528Queue/Stack\u6765\u4ee3\u66ffList</p> <p>7\uff09 \u540c\u4e00\u811a\u672c\u4e2d\u9891\u7e41\u4f7f\u7528\u7684\u53d8\u91cf\u5efa\u8bae\u58f0\u660e\u5176\u4e3a\u5168\u5c40\u53d8\u91cf\uff0c\u811a\u672c\u4e4b\u95f4\u9891\u7e41\u8c03\u7528\u7684\u53d8\u91cf\u6216\u65b9\u6cd5\u5efa\u8bae\u58f0\u660e\u4e3a\u5168\u5c40\u9759\u6001\u53d8\u91cf\u6216\u65b9\u6cd5\uff1b</p> <p>\u5728\u672c\u6587\u4e2d\uff0c\u53ea\u80fd\u7528\u4e00\u4e9b\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u8bb2\u8ff0\u4e00\u4e9b\u5e38\u89c1\u7684\u6027\u80fd\u95ee\u9898\u53ca\u4f18\u5316\u65b9\u6cd5\uff0c\u800c\u66f4\u591a\u7684\u4f18\u5316\u95ee\u9898\uff0c\u9700\u8981\u8bfb\u8005\u5728\u5177\u4f53\u7684\u9879\u76ee\u4e2d\u53d1\u73b0\uff0c\u5e76\u6839\u636e\u5b9e\u9645\u7684\u5e94\u7528\u573a\u666f\u6765\u9009\u62e9\u5408\u9002\u7684\u4f18\u5316\u65b9\u6cd5</p>"},{"location":"game/perf/cpu/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81eahttps://zhuanlan.zhihu.com/p/39998137</p>"},{"location":"game/perf/render/","title":"Unity3D\u6027\u80fd\u4f18\u5316\u2014\u2014\u6e32\u67d3\u7bc7","text":""},{"location":"game/perf/render/#_1","title":"\u6e32\u67d3\u4f18\u5316","text":"<p>\u5728\u4e86\u89e3\u4f18\u5316\u6e32\u67d3\u524d\uff0c\u6211\u4eec\u9700\u8981\u4e86\u89e3\u5728unity\u4e2d\uff0c\u6bcf\u4e00\u5e27\u7684\u6e32\u67d3CPU\u548cGPU\u90fd\u505a\u4e86\u4e9b\u4ec0\u4e48\uff1a</p> <p>1\uff09CPU\u68c0\u67e5\u573a\u666f\u4e2d\u6bcf\u4e2a\u5bf9\u8c61\uff0c\u51b3\u5b9a\u4ed6\u4eec\u662f\u5426\u5e94\u8be5\u88ab\u6e32\u67d3\u3002\uff08\u8fd9\u4e9b\u5bf9\u8c61\u53ea\u6709\u6ee1\u8db3\u4e00\u5b9a\u7684\u6761\u4ef6\u624d\u4f1a\u88ab\u6e32\u67d3\u3002\uff09</p> <p>2\uff09CPU\u6536\u96c6\u5373\u5c06\u88ab\u6e32\u67d3\u7684\u5bf9\u8c61\u4fe1\u606f\uff0c\u5e76\u628a\u8fd9\u4e9b\u4fe1\u606f\u5206\u7c7b\u4e3a\u6e32\u67d3\u6307\u4ee4\uff08\u4e5f\u5c31\u662fdraw calls\uff0c\u6211\u4eec\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\u4e5f\u6709\u63d0\u5230\uff0cDraw Call\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u547d\u4ee4\uff09\u3002\u4e00\u4e2adraw call\u5305\u542b\u7f51\u683c\u6570\u636e\u4ee5\u53ca\u7f51\u683c\u5982\u4f55\u88ab\u6e32\u67d3\u3002\u5728\u67d0\u4e9b\u573a\u666f\uff0c\u5171\u4eab\u8bbe\u7f6e\u7684\u4e00\u4e9b\u5bf9\u8c61\u53ef\u80fd\u4f1a\u88ab\u5408\u5e76\u4e3a\u4e00\u4e2adraw call\u3002\u5408\u5e76\u4e0d\u540c\u5bf9\u8c61\u7684\u6570\u636e\u5230\u540c\u4e00\u4e2adraw call\u88ab\u79f0\u4f5cbatching\u3002</p> <p>3\uff09CPU\u7ed9\u6bcf\u4e2adraw call\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5305\uff0c\u79f0\u4e3abatch\u3002\u6bcf\u4e00\u4e2abatch\u5fc5\u987b\u5305\u542b\u4e00\u4e2adraw call\u3002</p> <p>4\uff09CPU\u4f1a\u53d1\u51fa\u6307\u4ee4\uff0c\u4f7fGPU\u6539\u53d8\u4e00\u4e9b\u6e32\u67d3\u72b6\u6001\u3002\u8fd9\u4e2a\u6307\u4ee4\u88ab\u79f0\u4e3aSetPass call\u3002SetPass call\u901a\u77e5GPU\uff0c\u5982\u4f55\u53bb\u6e32\u67d3\u4e0b\u4e00\u4e2a\u7f51\u683c\u3002\u53ea\u6709\u5728\u6e32\u67d3\u4e0b\u4e00\u4e2a\u7f51\u683c\u65f6\uff0c\u5176\u6e32\u67d3\u72b6\u6001\u76f8\u5bf9\u4e8e\u6e32\u67d3\u4e0a\u4e00\u4e2a\u7f51\u683c\u53d1\u751f\u4e86\u53d8\u5316\u65f6\uff0c\u624d\u4f1a\u8c03\u7528SetPass call\u3002</p> <p>5\uff09CPU\u628adraw call\u53d1\u9001\u7ed9GPU\u3002draw call\u901a\u77e5GPU\u4f7f\u7528\u6700\u8fd1\u7684SetPass call\u53bb\u6e32\u67d3\u6307\u5b9a\u7684\u7f51\u683c\u3002</p> <p>6\uff09\u6709\u65f6\uff0cbatch\u53ef\u80fd\u9700\u8981\u4e0d\u6b62\u4e00\u4e2a\u7684pass\u3002pass\u662fshader\u4ee3\u7801\u7684\u4e00\u90e8\u5206\uff0c\u800c\u65b0\u7684pass\u9700\u8981\u6539\u53d8\u6e32\u67d3\u72b6\u6001\u3002\u5bf9\u4e8ebatch\u4e2d\u7684\u6bcf\u4e2apass\uff0cCPU\u5fc5\u987b\u53d1\u9001\u4e00\u4e2a\u65b0\u7684SetPass call\u7136\u540e\u5fc5\u987b\u8981\u518d\u6b21\u53d1\u9001draw call\u3002</p> <p>7\uff09GPU\u6309\u7167CPU\u53d1\u9001\u7684\u6307\u4ee4\u987a\u5e8f\u5904\u7406\u8fd9\u4e9b\u6307\u4ee4\u3002</p> <p>8\uff09\u5982\u679c\u5f53\u524d\u4efb\u52a1\u662fSetPass call\uff0c\u90a3\u4e48GPU\u66f4\u65b0\u6e32\u67d3\u72b6\u6001\u3002</p> <p>9\uff09\u5982\u679c\u5f53\u524d\u4efb\u52a1\u662fdraw call\uff0c\u90a3\u4e48GPU\u6e32\u67d3\u7f51\u683c\u3002\u6e32\u67d3\u7f51\u683c\u53d1\u751f\u5728\u5f88\u591a\u9636\u6bb5\uff0c\u4e0d\u540c\u9636\u6bb5\u7684shader\u4ee3\u7801\u53ef\u4ee5\u5b9a\u4e49\u6e32\u67d3\u3002\u5176\u4e2d\uff1a\u9876\u70b9\u7740\u8272\u5668vertex shader\u544a\u8bc9GPU\u600e\u4e48\u5904\u7406\u7f51\u683c\u7684\u9876\u70b9\u3002\u7247\u5143\u7740\u8272\u5668fragment shader\u544a\u8bc9GPU\u600e\u4e48\u7ed8\u5236\u5355\u72ec\u7684\u50cf\u7d20\u3002</p> <p>10\uff09\u4ee5\u4e0a\u8fc7\u7a0b\u4f1a\u91cd\u590d\u6267\u884c\uff0c\u76f4\u5230\u6240\u6709CPU\u53d1\u9001\u7684\u4efb\u52a1\u90fd\u88abGPU\u5b8c\u6210\u3002</p> <p>\u7406\u89e3\u6e32\u67d3\u6700\u91cd\u8981\u7684\u662f\uff1a\u4e3a\u4e86\u6e32\u67d3\u4e00\u5e27\uff0cCPU\u548cGPU\u5fc5\u987b\u90fd\u5b8c\u6210\u4ed6\u4eec\u7684\u4efb\u52a1\u3002\u4ed6\u4eec\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u82b1\u8d39\u4e86\u8fc7\u957f\u7684\u65f6\u95f4\u53bb\u5b8c\u6210\u4efb\u52a1\uff0c\u90fd\u4f1a\u9020\u6210\u6e32\u67d3\u5ef6\u8fdf\u3002\u6e32\u67d3\u95ee\u9898\u6709\u4e24\u4e2a\u57fa\u672c\u7684\u539f\u56e0\u3002\u7b2c\u4e00\u7c7b\u95ee\u9898\u662f\u7531\u4f4e\u6548\u7684\u6e32\u67d3\u7ba1\u7ebf\u5f15\u8d77\u3002\u5f53\u6e32\u67d3\u7ba1\u7ebf\u4e2d\u4e00\u6b65\u6216\u8005\u591a\u6b65\u82b1\u8d39\u4e86\u592a\u957f\u65f6\u95f4\uff0c\u6253\u65ad\u4e86\u5e73\u6ed1\u7684\u6570\u636e\u6d41\u65f6\uff0c\u6e32\u67d3\u7ba1\u7ebf\u4f1a\u5f88\u4f4e\u6548\u3002\u6e32\u67d3\u7ba1\u7ebf\u7684\u4f4e\u6548\u88ab\u79f0\u4e3a\u74f6\u9888\u3002\u7b2c\u4e8c\u7c7b\u95ee\u9898\u662f\u7531\u4e8e\uff0c\u6e32\u67d3\u7ba1\u7ebf\u88ab\u585e\u5165\u4e86\u592a\u591a\u7684\u6570\u636e\u3002\u5373\u4f7f\u662f\u6700\u9ad8\u6548\u7684\u6e32\u67d3\u7ba1\u7ebf\uff0c\u5bf9\u4e8e\u4e00\u5e27\u4e2d\u53ef\u4ee5\u5904\u7406\u7684\u6570\u636e\u91cf\u4e5f\u662f\u6709\u9650\u5236\u7684\u3002</p> <p>\u6e32\u67d3\u4f18\u5316\u7684\u4e3b\u8981\u76ee\u7684\u5c31\u662f**\u51cf\u5c11\u6e32\u67d3\u7684\u5de5\u4f5c\u91cf**\uff0c\u63a7\u5236\u6e32\u67d3\u7684\u5de5\u4f5c\u91cf\u662f\u4fdd\u8bc1\u6548\u7387\u7684\u6839\u672c\uff0c\u800c\u6bcf\u5e27\u6e32\u67d3\u7684\u9876\u70b9\u6570\u91cf\u662f\u8861\u91cf\u6e32\u67d3\u5de5\u4f5c\u91cf\u6700\u76f4\u89c2\u7684\u6807\u51c6\u4e4b\u4e00\uff1a</p> <p>\u6bcf\u5e27\u53ef\u6e32\u67d3\u7684\u9876\u70b9\u6570\u91cf\u4e3b\u8981\u53d6\u51b3\u4e8e\u8bbe\u5907\u7684CPU\u548cGPU\u3002 \u4e0d\u8fc7\u901a\u5e38\u6765\u8bf4PC\u6e38\u620f\u6bcf\u5e27\u6e32\u67d3\u7684\u9876\u70b9\u4e2a\u6570\u4e0d\u5b9c\u8d85\u8fc72M\uff0c\u79fb\u52a8\u6e38\u620f\u6bcf\u5e27\u6e32\u67d3\u7684\u9876\u70b9\u6570\u91cf\u4e0d\u5b9c\u8d85\u8fc70.1M\u3002</p>"},{"location":"game/perf/render/#cpu","title":"CPU\u6e32\u67d3\u4f18\u5316","text":"<ul> <li>\u4e86\u89e3CPU\u548cGPU\u7684\u6e32\u67d3\u5de5\u4f5c\u540e\uff0c\u6211\u4eec\u518d\u6765\u4e86\u89e3Unity\u4e2d\u5177\u4f53\u4f18\u5316\u95ee\u9898\uff0c\u5f53\u6211\u4eec\u786e\u5b9a\u662f\u6027\u80fd\u95ee\u9898\u662f\u6e32\u67d3\u6240\u5f15\u8d77\u540e\uff0c\u9996\u5148\u8981\u786e\u5b9a\u662fCPU\u9650\u5236\u8fd8\u662fGPU\u9650\u5236\uff0c\u4e0d\u540c\u7684\u95ee\u9898\u5c31\u9700\u8981\u4e0d\u540c\u7684\u89e3\u51b3\u65b9\u6848\u3002</li> </ul>"},{"location":"game/perf/render/#cpu_1","title":"CPU\u9650\u5236\uff1a","text":"<ul> <li> <p>\u5728\u6e32\u67d3\u6bcf\u4e00\u5e27\u4e2dCPU\u4f1a\u5b8c\u6210\u4e09\u4e2a\u4efb\u52a1\uff1a\u786e\u5b9a\u7ed8\u5236\u7684\u7269\u4f53 \u2014&gt; \u4e3aGPU\u51c6\u5907\u547d\u4ee4 \u2014&gt; \u53d1\u9001\u547d\u4ee4\u7ed9GPU\u3002</p> </li> <li> <p>\u8fd9\u4e9b\u4efb\u52a1\u901a\u8fc7\u591a\u7ebf\u7a0b\u5b8c\u6210\u3002\u591a\u7ebf\u7a0b\u5141\u8bb8\u4e0d\u540c\u7684\u4efb\u52a1\u540c\u65f6\u6267\u884c\uff1b\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\u65f6\uff0c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u5176\u4ed6\u4efb\u52a1\u3002\u8fd9\u610f\u5473\u7740\u5de5\u4f5c\u80fd\u591f\u66f4\u5feb\u7684\u5b8c\u6210\u3002\u5f53\u6e32\u67d3\u4efb\u52a1\u88ab\u5206\u53d1\u5230\u4e0d\u540c\u7684\u7ebf\u7a0b\u65f6\uff0c\u79f0\u4e3a\u591a\u7ebf\u7a0b\u6e32\u67d3\u3002</p> </li> <li> <p>Unity\u6e32\u67d3\u8fc7\u7a0b\u4e2d\u548c\u4e09\u7c7b\u7ebf\u7a0b\u76f8\u5173\uff1a\u4e3b\u7ebf\u7a0b\uff0c\u6e32\u67d3\u7ebf\u7a0b\u548c\u5de5\u4f5c\u7ebf\u7a0b\u3002\u4e3b\u7ebf\u7a0b\u7528\u4e8e\u6211\u4eec\u6e38\u620f\u7684\u4e3b\u8981CPU\u4efb\u52a1\uff0c\u5305\u62ec\u4e00\u4e9b\u6e32\u67d3\u4efb\u52a1\u3002\u6e32\u67d3\u8fdb\u7a0b\u662f\u4e13\u95e8\u7528\u4e8e\u53d1\u9001\u547d\u4ee4\u7ed9GPU\u7684\u3002\u6bcf\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u6267\u884c\u4e00\u4e2a\u5355\u72ec\u7684\u4efb\u52a1\uff0c\u4f8b\u5982\u5254\u9664\u548c\u7f51\u683c\u8499\u76ae\u3002\u54ea\u4e9b\u4efb\u52a1\u6267\u884c\u5728\u54ea\u4e2a\u7ebf\u7a0b\uff0c\u53d6\u51b3\u4e8e\u6211\u4eec\u6e38\u620f\u8fd0\u884c\u7684\u786c\u4ef6\u548c\u6e38\u620f\u7684\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0cCPU\u7684\u6838\u5fc3\u6570\u91cf\u8d8a\u591a\uff0c\u5c31\u4f1a\u751f\u6210\u8d8a\u591a\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6570\u3002\u56e0\u6b64\uff0c\u5728\u6211\u4eec\u7684\u76ee\u6807\u786c\u4ef6\u4e0a\u8fdb\u884c\u6027\u80fd\u5206\u6790\u662f\u5341\u5206\u91cd\u8981\u7684\u3002\u5728\u4e0d\u540c\u7684\u8bbe\u5907\u4e0a\uff0c\u6211\u4eec\u9879\u76ee\u7684\u8868\u73b0\u53ef\u80fd\u76f8\u5dee\u5f88\u591a\u3002</p> </li> <li> <p>\u7531\u4e8e\u591a\u7ebf\u7a0b\u6e32\u67d3\u975e\u5e38\u590d\u6742\u5e76\u4e14\u4f9d\u8d56\u786c\u4ef6\uff0c\u5728\u6211\u4eec\u5c1d\u8bd5\u6539\u8fdb\u6027\u80fd\u65f6\uff0c\u5fc5\u987b\u9996\u5148\u627e\u5230\u662f\u54ea\u4e9b\u4efb\u52a1\u5bfc\u81f4\u4e86CPU\u95ee\u9898\uff08\u53ef\u4ee5\u901a\u8fc7Profiler\u6765\u68c0\u67e5\uff09\u3002\u5982\u679c\u6211\u4eec\u7684\u6e38\u620f\u8fd0\u884c\u7f13\u6162\u662f\u56e0\u4e3a\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u5254\u9664\u64cd\u4f5c\u82b1\u8d39\u4e86\u592a\u957f\u7684\u65f6\u95f4\uff0c\u90a3\u5982\u679c\u6211\u4eec\u5728\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u964d\u4f4e\u53d1\u9001\u7ed9GPU\u547d\u4ee4\u7684\u65f6\u95f4\u662f\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5e2e\u52a9\u7684\u3002</p> </li> <li> <p>\u53d1\u9001\u547d\u4ee4\u5230GPU\u82b1\u8d39\u65f6\u95f4\u8fc7\u957f\u662f\u5f15\u8d77CPU\u9650\u5236\u7684\u6700\u5e38\u89c1\u7684\u539f\u56e0\uff0c\u5176\u6700\u8017\u65f6\u7684\u64cd\u4f5c\u662fSetPass call\u3002\u5982\u679cCPU\u9650\u5236\u662f\u7531\u53d1\u9001\u547d\u4ee4\u5230GPU\u5f15\u8d77\u7684\uff0c\u90a3\u4e48\u964d\u4f4eSetPass\u7684\u6570\u91cf\u901a\u5e38\u662f\u6700\u597d\u7684\u6539\u5584\u6027\u80fd\u7684\u65b9\u5f0f\u3002\u6211\u4eec\u53ef\u4ee5\u5728Statistics\u7a97\u53e3\u4e2d\u89c2\u5bdf\u5230\u5176\u6570\u91cf\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> </li> </ul> <p></p> <ul> <li>\u964d\u4f4eSetPass call\u548cbatches\u6570\u91cf\uff0c\u6211\u4eec\u901a\u5e38\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u6765\u8fdb\u884c\uff1a</li> <li>\u51cf\u5c11\u8981\u6e32\u67d3\u7684\u5bf9\u8c61\u6570\u91cf\uff0c\u901a\u5e38\u53ef\u4ee5\u540c\u65f6\u964d\u4f4eSetPass call\u548cbatches\u7684\u6570\u91cf\u3002</li> <li>\u51cf\u5c11\u6bcf\u4e2a\u8981\u6e32\u67d3\u7684\u5bf9\u8c61\u7684\u6e32\u67d3\u6b21\u6570\uff0c\u901a\u5e38\u53ef\u4ee5\u964d\u4f4eSetPass call</li> <li>\u5408\u5e76\u8981\u6e32\u67d3\u7684\u5bf9\u8c61\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u964d\u4f4ebatches\u6570\u91cf\u4e0d\u540c\u7684\u6280\u672f\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u9879\u76ee\uff0c\u6211\u4eec\u5728\u9879\u76ee\u5f00\u53d1\u4e2d\u56e0\u8be5\u4ece\u9879\u76ee\u672c\u8eab\u9700\u6c42\u51fa\u53d1\u6765\u9009\u62e9\u6700\u5408\u9002\u7684\u65b9\u6cd5\u3002</li> </ul> <p>\u6211\u4eec\u4e0b\u9762\u5217\u4e3e\u4ee5\u4e0a\u51e0\u4e2a\u65b9\u9762\u5177\u4f53\u7684\u4f18\u5316\u65b9\u6cd5\u53ca\u6280\u672f</p>"},{"location":"game/perf/render/#_2","title":"\u51cf\u5c11\u8981\u6e32\u67d3\u7684\u5bf9\u8c61\u6570\u91cf","text":"<p>1.\u624b\u52a8\u51cf\u5c11\u573a\u666f\u4e2d\u7269\u4f53\u7684\u6570\u91cf</p> <p>\u8fd9\u662f\u4e00\u4e2a\u6700\u76f4\u89c2\u4e14\u6709\u6548\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982\u5728\u591a\u4eba\u6e38\u620f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u51cf\u5c11\u53ef\u89c1\u73a9\u5bb6\u7684\u6570\u91cf\uff0c\u5982\u679c\u4e0d\u5f71\u54cd\u6e38\u620f\u6027\u548c\u73a9\u5bb6\u4f53\u9a8c\uff0c\u90a3\u8fd9\u662f\u5c31\u662f\u4e00\u4e2a\u5373\u65b9\u4fbf\u53c8\u5feb\u6377\u7684\u65b9\u6cd5\u3002</p> <p>2.Occlusion Culling\uff08\u906e\u6321\u5254\u9664\uff09</p> <p>\u906e\u6321\u5254\u9664\u7684\u539f\u7406\u5c31\u662f\u5f53\u4e00\u4e2a\u7269\u4f53\u88ab\u5176\u4ed6\u7269\u4f53\u906e\u6321\u4f4f\uff0c\u4e0d\u5728\u6444\u50cf\u673a\u7684\u53ef\u89c6\u8303\u56f4\u5185\u65f6\u4e0d\u5bf9\u5176\u8fdb\u884c\u6e32\u67d3\u3002\u5177\u4f53\u65b9\u6cd5\u5982\u4e0b\u6240\u793a\uff1a \u628a\u6240\u6709\u7269\u4f53\u9009\u4e2d\uff0cInspector\u9762\u677f\u4e2d\u7684static\u4e0b\u62c9\u83dc\u5355\u4e2d\u52fe\u9009Occlusion Static \u548c Occludee Static\u3002</p> <p></p> <p>\u5728Window\u4e2d\u9009\u62e9Occlusion Culling\u3002</p> <p></p> <p>\u7136\u540e\u5728Occlusion Culling\u9762\u677f\u4e2d\u9009\u62e9Bake\uff0c\u5e76\u70b9\u51fb\u53f3\u4e0b\u89d2Bake\u6309\u94ae</p> <p></p> <p>\u5728bake\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bd4\u906e\u6321\u5254\u9664\u524d\u540e\u7684\u5dee\u522b (\u906e\u6321\u5254\u9664\u524d)</p> <p></p> <p>(\u906e\u6321\u5254\u9664\u540e)</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u573a\u666f\u4e2d\u88ab\u906e\u6321\u90e8\u5206\u5e76\u6ca1\u6709\u88ab\u6e32\u67d3\u3002</p> <ul> <li>\u5728Occlusion bake\u4e2d\u6709\u4e09\u4e2a\u53c2\u6570\uff1a   Smallest Occluder\uff1a\u8bbe\u7f6e\u6700\u5c0f\u906e\u6321\u7269\u7684\u5c3a\u5bf8\uff0c\u5f53\u906e\u6321\u7269\u7684\u957f\u5ea6\u6216\u8005\u5bbd\u5927\u4e8e\u8bbe\u5b9a\u503c\u65f6\uff0c\u8be5\u7269\u4f53\u624d\u80fd\u591f\u906e\u6321\u4f4f\u540e\u9762\u7684\u7269\u4f53\u3002   Smallest Hole\uff1a\u8bbe\u7f6e\u6700\u5c0f\u5b54\u7684\u5c3a\u5bf8\uff0c\u5f53\u7a7f\u8fc7\u7269\u4f53\u5185\u90e8\u7684\u5b54\u6216\u8005\u591a\u4e2a\u7269\u4f53\u5806\u53e0\u5f62\u6210\u7684\u5b54\u7684\u5927\u5c0f\u5c0f\u4e8e\u8bbe\u5b9a\u7684\u503c\u65f6\uff0c\u906e\u6321\u5254\u9664\u70d8\u7119\u5c06\u5ffd\u7565\u8be5\u5b54\u7684\u5b58\u5728\u3002   Backface Threshold\uff1a\u8bbe\u7f6e\u80cc\u9762\u79fb\u9664\u9608\u503c\uff0c\u7528\u4e8e\u4f18\u5316\u573a\u666f\uff0c\u5f53\u8be5\u503c\u4e3a100\u65f6\uff0c\u6444\u50cf\u673a\u62cd\u6444\u4e0d\u5230\u7684\u80cc\u9762\u4fe1\u606f\u4e5f\u4f1a\u5b8c\u6574\u4fdd\u7559\uff1b\u5f53\u8be5\u503c\u8f83\u5c0f\u65f6\uff0c\u7cfb\u7edf\u5c06\u5bf9\u80cc\u9762\u4fe1\u606f\u8fdb\u884c\u4f18\u5316\u751a\u81f3\u53bb\u6389\u80cc\u666f\u4fe1\u606f\u3002</li> </ul> <p>**Occlusion Culling\uff08\u906e\u6321\u5254\u9664\uff09**\u662f\u5bf9\u4e8e\u573a\u666f\u4f18\u5316\u6700\u91cd\u8981\u7684\u6280\u672f\u4e4b\u4e00\uff0c\u5bf9\u4e8e\u8f83\u5927\u7684\u573a\u666f\u4e00\u5b9a\u8981\u4f7f\u7528\u906e\u6321\u5254\u9664\uff0c\u5927\u573a\u666f\u4e2d\u8fc7\u591a\u7684\u7ed8\u5236\u6e32\u67d3\u4f1a\u9020\u6210\u5f88\u5927\u7684\u6027\u80fd\u635f\u8017\u3002</p> <p>3.\u6444\u50cf\u673aClipping Planes</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6444\u50cf\u673a\u7684Clipping Planes \u7684Far\u88c1\u526a\u8fdc\u7aef\uff0c\u4ece\u800c\u964d\u4f4e\u6444\u50cf\u673a\u7684\u7ed8\u5236\u8303\u56f4\uff0c\u5982\u540c\u6240\u793a\uff1a</p> <p></p> <p>\u4e3a\u4e86\u964d\u4f4e\u6027\u80fd\u635f\u8017\u540c\u65f6\u4fdd\u8bc1\u6e38\u620f\u8d28\u91cf\uff0cFar\u7684\u503c\u5e94\u8be5\u5408\u7406\u63a7\u5236\uff0c\u4e0d\u8981\u9020\u6210\u4e0d\u597d\u7684\u6e38\u620f\u4f53\u9a8c\uff0c\u6216\u8005\u6211\u4eec\u53ef\u4ee5\u7528\u96fe\u6765\u63a9\u76d6\u4e0d\u88ab\u6e32\u67d3\u7684\u8fdc\u7aef\u3002</p>"},{"location":"game/perf/render/#_3","title":"\u51cf\u5c11\u6e32\u67d3\u5bf9\u8c61\u7684\u6e32\u67d3\u6b21\u6570","text":"<p>\u5728\u6e38\u620f\u4e2d\uff0c\u5b9e\u65f6\u7684\u5149\u7167\u3001\u9634\u5f71\u3001\u53cd\u5c04\u53ef\u4ee5\u6781\u5927\u7684\u63d0\u5347\u89c2\u611f\uff0c\u4f46\u8fd9\u4e9b\u64cd\u4f5c\u9700\u8981\u8017\u8d39\u6781\u9ad8\u7684\u6027\u80fd\u3002</p> <p>1.Lightmap(\u5149\u7167\u8d34\u56fe)</p> <p>Unity\u706f\u5149\u9ed8\u8ba4\u662f\u5b9e\u65f6\u5149\u7167\uff0c\u4e5f\u5c31\u662f\u8bf4\u7269\u4f53\u5728\u706f\u5149\u4e0b\u4e0d\u540c\u4f4d\u7f6e\u4f1a\u4ea7\u751f\u4e0d\u540c\u706f\u5149\u6548\u679c\uff0c\u7531\u4e8e\u52a8\u6001\u5149\u6e90\u5728\u5b9e\u65f6\u5149\u7167\u4e0b\u4f1a\u53cb\u5927\u91cf\u7684Setpass Calls\uff0c\u4e3a\u4e86\u51cf\u5c0fSetpass Calls\uff0c\u6211\u4eec\u53ef\u4ee5\u70d8\u7119\u706f\u5149\u6548\u679c\uff0cUnity\u4f1a\u4e3a\u6211\u4eec\u751f\u6210\u5149\u7167\u8d34\u56fe\uff0c\u8fd9\u6837\u5927\u5927\u51cf\u5c11\u4e86Setpass Calls\u3002</p> <p>\u4e3a\u4e86\u4e86\u89e3\u5149\u7167\u8d34\u56fe\uff0c\u6211\u4eec\u5148\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee</p> <p></p> <p>\u6211\u4eec\u6709\u4e94\u4e2a\u70b9\u5149\u6e90\uff0c\u5728\u8fd0\u884c\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u5230Setpass Calls\u6bd4\u8f83\u5927\u3002\u800c\u6211\u4eec\u7684\u76ee\u7684\u5c31\u662f\u51cf\u5c11Setpass Calls\u3002</p> <p></p> <p>\u9996\u5148\u6211\u4eec\u628a\u88ab\u5149\u7167\u5230\u7684\u7269\u4f53\u52fe\u9009\u4e0aLightmap Static\u3002</p> <p></p> <p>\u7136\u540e\u628a\u6240\u6709\u5149\u6e90\u7684Mode\u8bbe\u7f6e\u4e3aBaked</p> <p>Realtime\uff1a \u5b9e\u65f6\uff08\u9ed8\u8ba4\uff09/ Baked\uff1a \u70d8\u7119 / Mixed\uff1a \u6df7\u5408</p> <p></p> <p>\u9009\u62e9window \u2014\u2014&gt; Lighting \u2014\u2014&gt; Settings</p> <p></p> <p>\u6211\u4eec\u5728Lighting\u8bbe\u7f6e\u9762\u677f\u4e2d\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9bLightmapping\u8bbe\u7f6e\uff0c\u8fd9\u91cc\u6211\u4eec\u70b9\u51fb\u53f3\u4e0b\u89d2\u7684Generate Lighting\uff0c\u4e5f\u53ef\u4ee5\u52fe\u9009\u65c1\u8fb9\u7684Auto Genenrate\uff08\u4e0d\u5efa\u8bae\u52fe\u9009\uff09\u7136\u540e\u5f00\u59cb\u751f\u6210\u5149\u7167\u8d34\u56fe\uff0c\u5b8c\u6210\u540e\u4f1a\u51fa\u73b0\u4ee5\u4e0b\u6587\u4ef6</p> <p></p> <p>\u5e76\u4e14\u53ef\u4ee5\u770b\u5230Setpass Calls\u4e5f\u4ece\u4e4b\u524d\u768423\u964d\u5230\u4e868</p> <p></p> <p>**Lightmapping**\u66f4\u591a\u7684\u4f7f\u7528\u65b9\u6cd5\u8bf7\u53c2\u7167Unity \u5b98\u65b9\u6587\u6863 \u8fd9\u91cc\u53ea\u4ecb\u7ecd\u57fa\u672c\u7684\u4f18\u5316\u76f8\u5173</p> <p>2.\u9634\u5f71</p> <p>\u5728unity\u4e2d\uff0c\u9634\u5f71\u76f8\u5173\u7684\u4f18\u5316\u6211\u4eec\u53ef\u4ee5\u5728\u8d28\u91cf\u8bbe\u7f6e\u4e2d\u8fdb\u884c</p> <p></p> <ol> <li>\uff09\u9634\u5f71 (Shadows)\uff1a\u6b64\u9879\u51b3\u5b9a\u5e94\u8be5\u4f7f\u7528\u54ea\u79cd\u9634\u5f71\u7c7b\u578b\u3002    \u786c\u9634\u5f71\u548c\u8f6f\u9634\u5f71 (Hard and Soft Shadows)\uff1a\u786c\u9634\u5f71\u548c\u8f6f\u9634\u5f71\u90fd\u5c06\u5f97\u5230\u6e32\u67d3\u3002    \u4ec5\u786c\u9634\u5f71 (Hard Shadows Only)\uff1a\u4ec5\u786c\u9634\u5f71 (hard shadows) \u5c06\u5f97\u5230\u6e32\u67d3\u3002    \u7981\u7528\u9634\u5f71 (Disable Shadows)\uff1a\u6ca1\u6709\u9634\u5f71\u4f1a\u88ab\u6e32\u67d3\u3002</li> <li>\uff09\u9634\u5f71\u5206\u8fa8\u7387 (Shadow resolution)\uff1a\u9634\u5f71\u53ef\u4ee5\u6309\u4ee5\u4e0b\u51e0\u79cd\u4e0d\u540c\u5206\u8fa8\u7387\u8fdb\u884c\u6e32\u67d3\uff1a \u4f4e (Low) \u3001\u4e2d (Medium) \u3001\u9ad8 (High) \u548c\u5f88\u9ad8 (Very High)\u3002\u5206\u8fa8\u7387\u8d8a\u9ad8\uff0c\u5904\u7406\u5f00\u9500\u5c31\u8d8a\u5927\u3002</li> <li>\uff09\u9634\u5f71\u6295\u5c04 (Shadow Projection)\uff1a\u4ece\u5e73\u884c\u5149\u6e90\u6295\u5c04\u9634\u5f71\u6709\u4e24\u79cd\u65b9\u6cd5\u3002\u7d27\u5bc6\u914d\u5408 (Close Fit) \u6e32\u67d3\u5206\u8fa8\u7387\u66f4\u9ad8\u7684\u9634\u5f71\uff0c\u4f46\u662f\u5982\u679c\u6444\u5f71\u673a\u79fb\u52a8\uff0c\u8fd9\u4e9b\u9634\u5f71\u6709\u65f6\u5c31\u4f1a\u6709\u4e9b\u8bb8\u6447\u6643\u3002\u7a33\u5b9a\u914d\u5408 (Stable Fit) \u6e32\u67d3\u5206\u8fa8\u7387\u66f4\u4f4e\u7684\u9634\u5f71\uff0c\u800c\u9634\u5f71\u4e0d\u4f1a\u968f\u6444\u5f71\u673a\u7684\u79fb\u52a8\u800c\u6447\u6643\u3002</li> <li>\uff09\u9634\u5f71\u8ddd\u79bb (Shadow Distance)\uff1a\u4ece\u6444\u5f71\u673a\u5904\u53ef\u4ee5\u770b\u89c1\u9634\u5f71\u7684\u6700\u5927\u8ddd\u79bb\u3002\u8d85\u51fa\u6b64\u8ddd\u79bb\u7684\u9634\u5f71\u5c06\u4e0d\u4f1a\u88ab\u6e32\u67d3\u3002</li> <li>\uff09\u9634\u5f71\u5c42\u53e0 (Shadow Cascades)\uff1a\u9634\u5f71\u5c42\u53e0 (shadow cascades) \u6570\u53ef\u8bbe\u7f6e\u4e3a\u96f6\u3001\u4e8c\u6216\u56db\u3002\u5c42\u53e0\u6570\u8d8a\u9ad8\u8d28\u91cf\u8d8a\u597d\uff0c\u4f46\u8fd9\u8981\u4ee5\u5904\u7406\u5f00\u9500\u4e3a\u4ee3\u4ef7\u3002</li> </ol> <p>3.\u53cd\u5c04\u63a2\u5934</p> <p>\u53cd\u5c04\u63a2\u5934\u6ca1\u6709\u5f88\u597d\u7684\u4f18\u5316\u65b9\u6cd5\uff0c\u5728\u6211\u4eec\u5b9e\u9645\u7684\u9879\u76ee\u4e2d\u5374\u5e38\u4f1a\u7528\u5230\uff0c\u4ee5\u521b\u5efa\u66f4\u771f\u5b9e\u7684\u53cd\u5c04\uff0c\u4f46\u5374\u4f1a\u589e\u52a0batches\uff0c \u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u5728\u6027\u80fd\u6d88\u8017\u8f83\u5927\u7684\u573a\u5408\u5c3d\u91cf\u6700\u5c0f\u5316\u5176\u4f7f\u7528\u7387\u3002</p>"},{"location":"game/perf/render/#_4","title":"\u5408\u5e76\u8981\u6e32\u67d3\u7684\u5bf9\u8c61\u7684\u6570\u636e","text":"<ol> <li> <p>\u52a8\u6001\u6279\u5904\u7406\u548c\u9759\u6001\u6279\u5904\u7406</p> </li> <li> <p>\u5728Unity\u4e2d\u5982\u679c\u52a8\u6001\u7269\u4f53\u5171\u7528\u76f8\u540c\u7684\u6750\u8d28\uff0c\u90a3\u4e48Unity\u4f1a\u81ea\u52a8\u5bf9\u8fd9\u4e9b\u7269\u4f53\u8fdb\u884c\u6279\u5904\u7406\u3002\u52a8\u6001\u6279\u5904\u7406\u64cd\u4f5c\u662f\u81ea\u52a8\u5b8c\u6210\u7684\u3002\u5728\u4e0b\u9762\u7684\u4e24\u5e45\u56fe\u4e2d\uff0c\u6211\u5728\u573a\u666f\u91cc\u653e\u5165\u4e24\u4e2a\u7269\u4f53\uff0c\u5206\u522b\u7528\u540c\u4e00\u6750\u8d28\u7403\u548c\u4e0d\u540c\u7684\u6750\u8d28\u7403\uff0c\u8bf7\u6ce8\u610fSetpass Calls\u3002</p> </li> </ol> <p></p> <p></p> <p>\u4f46\u540c\u65f6\u6211\u4eec\u6ce8\u610fCPU\u65f6\u95f4\uff0c\u540c\u4e00\u6750\u8d28\u7684CPU\u65f6\u95f4\u660e\u663e\u66f4\u9ad8\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u6ce8\u610f\u589e\u52a0\u7684CPU\u65f6\u95f4\u662f\u5426\u4f1a\u9ad8\u4e8e\u4f18\u5316\u8282\u7701\u7684\u65f6\u95f4\u3002</p> <ul> <li>\u6211\u4eec\u8fdb\u884c\u9759\u6001\u6279\u5904\u7406\u65f6\uff0c\u5176\u7f51\u683c\u4f1a\u5408\u5e76\uff0c\u8fd9\u4e5f\u662f\u8fdb\u884c\u9759\u6001\u6279\u5904\u7406\u7684\u4e00\u4e2a\u91cd\u8981\u8fc7\u7a0b\uff0c\u6211\u4eec\u9700\u8981\u4ed6\u4eec\u4f7f\u7528\u540c\u4e00\u4e2a\u7f51\u683c\u540c\u4e00\u4e2a\u6750\u8d28\u3002\u9759\u6001\u6279\u5904\u7406\u6ca1\u52a8\u6001\u6279\u5904\u7406\u7684\u8bf8\u591a\u9650\u5236\uff0c\u4e14\u4e0d\u4f1a\u9020\u6210CPU\u635f\u8017\uff0c\u4f46\u4f1a\u6709\u66f4\u9ad8\u7684\u5185\u5b58\u5360\u7528\u3002   \u4f7f\u7528\u9759\u6001\u6279\u5904\u7406\u65f6\uff0c\u53ea\u9700\u8981\u540c\u4e00\u4e2a\u6750\u8d28\u4e14\u6279\u5904\u7406\u7684\u7269\u4f53\u5904\u4e8e\u9759\u6001\uff0c\u540c\u65f6\u52fe\u4e0aStatic\u3002</li> </ul> <p></p> <p>\u53ef\u4ee5\u4ece\u4e0b\u56fe\u770b\u5230\uff0cSetpass Calls\u540c\u6837\u964d\u4f4e\uff0c\u4e14CPU\u65f6\u95f4\u4e5f\u6ca1\u6709\u589e\u52a0\u3002</p> <p></p> <p>2.\u7eb9\u7406\u56fe\u96c6</p> <p>\u7eb9\u7406\u56fe\u96c6\u662f\u628a\u5927\u91cf\u7684\u5c0f\u7eb9\u7406\u5408\u5e76\u4e3a\u4e00\u5f20\u5927\u7684\u7eb9\u7406\u56fe\u7684\u6280\u672f\uff0c\u5f53\u6211\u4eec\u4f7f\u7528\u8fd9\u4e2a\u6280\u672f\u4e3a\u6e38\u620f\u521b\u5efa\u7f8e\u672f\u8d44\u6e90\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u4fdd\u7269\u4f53\u5171\u4eab\u540c\u4e00\u56fe\u96c6\uff0c\u56e0\u6b64\u9002\u5408\u5408\u5e76\u3002Unity\u5185\u7f6e\u4e86\u56fe\u96c6\u5de5\u5177\u8001\u7248\u672c\u4e3aSprite Packer\uff0c\u65b0\u7248\u672c\u4e3aSpriteAtlas\u3002\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\u56fe\u3002</p> <p></p> <p></p> <p></p> <p></p>"},{"location":"game/perf/render/#gpu","title":"GPU\u6e32\u67d3\u4f18\u5316","text":"<ul> <li>\u4f18\u5316GPU\u6e32\u67d3\u95ee\u9898\u4e3b\u8981\u4ece\u4e09\u4e2a\u65b9\u9762\u6765\u8fdb\u884c\uff0c\u5206\u522b\u662f**\u9876\u70b9\uff0c\u586b\u5145\uff0c\u5e26\u5bbd**\u3002\u6211\u4eec\u9700\u8981\u660e\u786e\u8fd9\u4e09\u4e2a\u65b9\u9762\u7684\u6982\u5ff5\u3002</li> </ul> <p>**1.\u9876\u70b9\u5904\u7406\u3002**\u9876\u70b9\u5904\u7406\u662f\u6307GPU\u9700\u8981\u6e32\u67d3\u7f51\u683c\u4e2d\u6bcf\u4e00\u4e2a\u9876\u70b9\u7684\u5de5\u4f5c\u3002 \u9876\u70b9\u5904\u7406\u7684\u6d88\u8017\u53d7\u4e24\u65b9\u9762\u5f71\u54cd\uff1a\u5fc5\u987b\u6e32\u67d3\u7684\u9876\u70b9\u6570\u91cf\uff0c\u4ee5\u53ca\u5728\u6bcf\u4e2a\u9876\u70b9\u4e0a\u8981\u8fdb\u884c\u7684\u64cd\u4f5c\u6570\u91cf\u3002</p> <p>**2.\u586b\u5145\u7387\u3002**\u586b\u5145\u7387\u662f\u6307GPU\u5728\u5c4f\u5e55\u4e0a\u6bcf\u79d2\u53ef\u4ee5\u6e32\u67d3\u7684\u50cf\u7d20\u6570\u3002\u5982\u679c\u6211\u4eec\u7684\u6e38\u620f\u53d7\u5230\u586b\u5145\u7387\u7684\u9650\u5236\uff0c\u610f\u5473\u7740\u6211\u4eec\u7684\u6e38\u620f\u6bcf\u5e27\u5c1d\u8bd5\u7ed8\u5236\u7684\u50cf\u7d20\u6570\u91cf\u8d85\u8fc7\u4e86GPU\u7684\u5904\u7406\u80fd\u529b\u3002</p> <p>**3.\u663e\u5b58\u5e26\u5bbd\u3002**\u663e\u5b58\u5e26\u5bbd\u662f\u6307GPU\u8bfb\u5199\u5176\u4e13\u7528\u5185\u5b58\u7684\u901f\u5ea6\u3002\u5982\u679c\u6211\u4eec\u7684\u6e38\u620f\u901f\u5ea6\u53d7\u9650\u4e8e\u663e\u5b58\u5e26\u5bbd\uff0c\u901a\u5e38\u53ef\u80fd\u662f\u6211\u4eec\u4f7f\u7528\u7684\u7eb9\u7406\u592a\u5927\uff0c\u4ee5\u81f3\u4e8eGPU\u65e0\u6cd5\u5feb\u901f\u5904\u7406\u3002</p> <ul> <li>\u5bf9\u4e8eGPU\u6027\u80fd\u7684\u4f18\u5316\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Profiler\u5206\u6790\uff0c\u5e76\u5173\u6ce8GPU\u65f6\u95f4\uff0c\u6765\u9501\u5b9a\u5f15\u8d77\u6027\u80fd\u95ee\u9898\u7684\u539f\u56e0\uff0c\u4ece\u800c\u8fdb\u884c\u4f18\u5316\u3002</li> </ul> <p></p> <p>\u5bf9\u4e8eGPU\u4f18\u5316\u95ee\u9898\u6211\u4eec\u4e3b\u8981\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u51e0\u4e2a\u6280\u672f\u6765\u8fdb\u884c</p> <p>GPU\u6e32\u67d3\u4f18\u5316\u4e2d\uff0c\u6211\u4eec\u5e38\u4f1a\u8fdb\u884c\u4e00\u4e9bshader\u7684\u4f18\u5316\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u6211\u5e0c\u671b\u653e\u5230\u540e\u7eedshader\u76f8\u5173\u7684\u6587\u7ae0\u4e2d\uff0c\u4ee5\u4fbf\u65b0\u624b\u53ef\u4ee5\u6709\u66f4\u6e05\u6670\u7684\u6982\u5ff5\u3002</p> <p>1.\u7eb9\u7406\u538b\u7f29</p> <p>\u7eb9\u7406\u538b\u7f29\u6280\u672f\u53ef\u4ee5\u540c\u65f6\u6781\u5927\u7684\u964d\u4f4e\u7eb9\u7406\u5728\u78c1\u76d8\u548c\u5185\u5b58\u4e2d\u7684\u5927\u5c0f\u3002\u5982\u679c\u662f\u663e\u5b58\u5e26\u5bbd\u7684\u95ee\u9898\uff0c\u90a3\u4e48\u4f7f\u7528\u7eb9\u7406\u538b\u7f29\u51cf\u5c0f\u7eb9\u7406\u5728\u5185\u5b58\u7684\u5927\u5c0f\u53ef\u4ee5\u5e2e\u52a9\u6539\u5584\u6027\u80fd\uff0cUnity\u63d0\u4f9b\u4e86\u5f88\u591a\u7eb9\u7406\u538b\u7f29\u7684\u683c\u5f0f\u548c\u8bbe\u7f6e\uff0c\u8fd0\u7528\u4e5f\u5341\u5206\u7b80\u5355\uff0c\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\u3001\u673a\u5668\u548c\u573a\u666f\u6211\u4eec\u4f7f\u7528\u7684\u65b9\u5f0f\u4e5f\u6709\u6240\u4e0d\u540c\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u7167Unity \u5b98\u65b9\u6587\u6863</p> <p>2.Mipmap</p> <p>\u5982\u679c\u6211\u4eec\u7684\u573a\u666f\u5305\u542b\u8ddd\u79bb\u6444\u50cf\u673a\u5f88\u8fdc\u7684\u7269\u4f53\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528miapmap\u6765\u7f13\u89e3\u663e\u5b58\u5e26\u5bbd\u7684\u95ee\u9898\uff0cmipmap\u7684\u4e3b\u8981\u4f5c\u7528\u4fbf\u662f\u6a21\u578b\u7684\u8d34\u56fe\u4f1a\u6839\u636e\u6444\u50cf\u673a\u8ddd\u79bb\u6a21\u578b\u7684\u8fdc\u8fd1\u800c\u8c03\u6574\u4e0d\u540c\u8d28\u91cf\u7684\u8d34\u56fe\u663e\u793a\uff0c\u4ee5\u8fbe\u5230\u4f18\u5316\u76ee\u7684\u3002\u5176\u7528\u6cd5\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u6ce8\u610f\u8fd9\u5f20\u56fe\u7247\u7684\u5927\u5c0f\uff08\u53f3\u4e0b\u89d2\uff09 \u9009\u4e2dGenerate Mip maps\uff0c\u70b9\u51fbApply\u786e\u5b9a</p> <p></p> <p>\u8fd9\u91cc\u53ef\u4ee5\u53d1\u73b0\u56fe\u7247\u5927\u5c0f\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528MipMap\u6280\u672f\u4e4b\u540e\uff0c\u4f1a\u5bf9\u6b64\u8d34\u56fe\u751f\u6210\u516b\u5f20\u7cbe\u5ea6\u8d28\u91cf\u4e0d\u540c\u7684\u8d34\u56fe\uff0c\u6240\u4ee5\u5185\u5b58\u5360\u7528\u53d8\u5927\u3002</p> <p>\u4e0b\u56fe\u4e2d\u4e24\u4e2a\u7269\u4f53\u5176\u4e00\u6ca1\u6709\u8bbe\u7f6emipmap\uff0c\u6211\u4eec\u6765\u67e5\u770b\u53d1\u751f\u4e86\u4ec0\u4e48\u53d8\u5316</p> <p></p> <p>\u5f88\u660e\u663e\uff0c\u5de6\u8fb9\u6ca1\u6709\u8bbe\u7f6emipmap\u7684\u7269\u4f53\uff0c\u5373\u4f7f\u6444\u50cf\u673a\u62c9\u8fdc\uff0c\u5176\u6e05\u6670\u5ea6\u4e5f\u5e76\u6ca1\u6709\u53d1\u751f\u53d8\u5316</p> <p>3.LOD</p> <p>LOD\u4e0eMipmap\u7c7b\u4f3c\uff0c\u6839\u636e\u8ddd\u79bb\u7684\u8fdc\u8fd1\u4f7f\u7528\u4e0d\u540c\u7cbe\u5ea6\u6a21\u578b\uff0c\u8fdc\u5904\u9009\u62e9\u4f4e\u7cbe\u5ea6\u7684\u6a21\u578b\uff0c\u8fd1\u7684\u65f6\u5019\u9009\u62e9\u9ad8\u7cbe\u5ea6\u6a21\u578b\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u6a21\u578b\u4e0a\u9762\u7684\u9876\u70b9\u548c\u9762\u7247\u6570\u91cf\u4ece\u800c\u63d0\u9ad8\u6027\u80fd\u3002 \u5176\u548cMipmap\u7684\u5dee\u5f02\u4e3b\u8981\u5728\u4e00Mipmap\u9488\u5bf9\u8d34\u56fe\uff0c\u800cLOD\u9488\u5bf9\u6a21\u578b\u3002Mipmap\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u516b\u5f20\u7cbe\u5ea6\u4e0d\u540c\u7684\u8d34\u56fe\uff0c\u800cLOD\u5fc5\u987b\u7531\u6211\u4eec\u81ea\u5df1\u63d0\u4f9b\u4e09\u4e2a\u4e0d\u540c\u7cbe\u5ea6\u7684\u6a21\u578b\u3002 \u6211\u4eec\u6765\u4e86\u89e3\u4e00\u4e0bLOD\u7684\u7528\u6cd5\uff0c\u9996\u5148\u9700\u8981\u4e09\u4e2a\u76f8\u540c\u7684\u6a21\u578b\uff0c\u4f46\u662f\u8fd9\u4e09\u4e2a\u6a21\u578b\u4ed6\u4eec\u7684\u4e09\u89d2\u9762\u548c\u9876\u70b9\u6570\u90fd\u4e0d\u540c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4ee3\u8868\u4e09\u79cd\u4ece\u9ad8\u2014\u4e2d\u2014\u4f4e\u7684\u5c42\u7ea7(\u8fd9\u91cc\u6211\u4f7f\u7528\u7c92\u5b50\u6765\u4ee3\u66ff\uff0c \u5206\u522b\u7528rate 50-20-5)</p> <p></p> <p>\u5728TestLOD\u4e2d\u6dfb\u52a0\u7ec4\u4ef6LOD Group</p> <p></p> <p>\u5728LOD Group\u4e2d\uff0c\u6211\u4eec\u628a\u5bf9\u5e94\u767e\u5206\u6bd4\u53ef\u89c1\u5ea6\u7684\u7269\u4f53\u6dfb\u52a0\u5230\u8fdb\u53bb</p> <p></p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u8fd0\u884c\u65f6\u7684\u6548\u679c\u53ca\u6027\u80fd\u5206\u6790</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u968f\u7740\u6444\u50cf\u673a\u4f4d\u7f6e\u7684\u79fb\u52a8\uff0c\u6211\u4eec\u7684\u7c92\u5b50\u4f1a\u53d1\u751f\u5927\u3001\u4e2d\u3001\u5c0f\u4e09\u79cd\u53d8\u5316\uff08\u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e09\u79cd\u7cbe\u5ea6\u7684\u6a21\u578b\uff0c\u540c\u6837\uff0c\u968f\u7740\u6444\u50cf\u673a\u7684\u4f4d\u7f6e\u6539\u53d8\uff0c\u6a21\u578b\u7684\u7cbe\u5ea6\u4e5f\u5c31\u4f1a\u53d1\u751f\u53d8\u5316\u3002\u90a3\u4e48\u53ef\u60f3\u800c\u77e5\uff0c\u6027\u80fd\u635f\u8017\u4e5f\u5c31\u4f1a\u53d1\u751f\u6539\u53d8\uff09</p>"},{"location":"game/perf/render/#_5","title":"\u53c2\u8003","text":"<p>\u6458\u81eahttps://zhuanlan.zhihu.com/p/40900056</p>"},{"location":"game/perf/tools/","title":"Unity3D\u6027\u80fd\u4f18\u5316\u2014\u2014\u5de5\u5177\u7bc7","text":"<p>\u6027\u80fd\u4f18\u5316\u662f\u6e38\u620f\u9879\u76ee\u5f00\u53d1\u4e2d\u4e00\u4e2a\u91cd\u8981\u4e14\u5fc5\u987b\u7684\u5143\u7d20\u3002\u7528\u6237\u548c\u9879\u76ee\u7684\u9700\u6c42\u5728\u5e76\u4e14\u4f1a\u6301\u7eed\u589e\u957f\u3002\u800c\u5373\u4fbf\u5728\u786c\u4ef6\u8bbe\u5907\u9ad8\u901f\u53d1\u5c55\u7684\u4eca\u5929\uff0c\u6e38\u620f\u7279\u6548\u3001\u753b\u8d28\u3001\u573a\u666f\u590d\u6742\u5ea6\u7684\u9700\u6c42\u4e5f\u90fd\u5411\u7740\u69a8\u5e72\u786c\u4ef6\u6027\u80fd\u7684\u8d8b\u52bf\u63d0\u5347\uff0c\u65e0\u8bba\u7814\u53d1\u56e2\u961f\u6709\u591a\u4e48\u4e30\u5bcc\u7684\u7ecf\u9a8c\u79ef\u7d2f\uff0c\u6027\u80fd\u4f18\u5316\u6c38\u8fdc\u662f\u4e00\u4e2a\u975e\u5e38\u68d8\u624b\u800c\u53c8\u65e0\u6cd5\u7ed5\u5f00\u7684\u95ee\u9898\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u901a\u8fc7\u767e\u5ea6\u3001\u8c37\u6b4c\u3001\u77e5\u4e4e\u53ef\u4ee5\u641c\u5230\u5927\u628a\u5173\u4e8eUnity\u6027\u80fd\u4f18\u5316\u7684\u6587\u7ae0\uff0c\u4f46\u5927\u591a\u53ea\u662f\u7b80\u5355\u7684\u8bba\u8ff0\u3001\u4ecb\u7ecd\u3001\u7ffb\u8bd1\u548c\u8f6c\u8f7d\uff0c\u6216\u9488\u5bf9\u67d0\u4e2d\u7279\u5b9a\u95ee\u9898\u4f18\u5316\u65b9\u5f0f\u7684\u6559\u7a0b\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u63a8\u51faUnity3D\u6027\u80fd\u4f18\u5316\u7cfb\u5217\u6587\u7ae0\uff0c\u65e8\u5728\u7ed9\u8bfb\u8005\u63d0\u4f9b\u4e00\u4e2a\u5168\u9762\u3001\u6613\u61c2\u3001\u53ef\u64cd\u4f5c\u7684unity\u4f18\u5316\u6559\u7a0b\uff0c\u4ee5\u4fbf\u521d\u5b66\u8005\u5b66\u4e60\u4f7f\u7528\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u7684\u7b2c\u4e00\u7bc7\u6587\u7ae0\uff0c\u4e3b\u8981\u4f5c\u4e3a\u4e00\u4e2a\u5f15\u5bfc\uff0c\u901a\u8fc7\u8bb2\u89e3\u5bf9unity\u4f18\u5316\u5de5\u5177\u7684\u4e86\u89e3\u53ca\u4f7f\u7528\uff0c\u7ed9\u8bfb\u8005\u63d0\u4f9b\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u8fdb\u884c\u6e38\u620f\u6027\u80fd\u4f18\u5316\u7684\u6d41\u7a0b\u548c\u601d\u8def\u3002</p> <ul> <li>\u5bf9\u4e8eUnity\u6027\u80fd\u4f18\u5316\uff0c\u5b98\u65b9\u6709\u975e\u5e38\u597d\u7684\u6559\u7a0b\uff0c\uff08\u53c2\u89c1\u5b98\u65b9\u6559\u7a0b\uff09\u3002\u5982\u679c\u82f1\u6587\u6c34\u5e73\u4e00\u822c\uff0c\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6559\u7a0b\u7ffb\u8bd1\u3002</li> <li>\u540c\u65f6\u4f60\u4e5f\u53ef\u4ee5\u53bb\u770b\u770b\u817e\u8baf\u662f\u5982\u4f55\u505aUnity\u624b\u6e38\u6027\u80fd\u4f18\u5316\u7684\u3002</li> <li>\u4ee5\u53ca\u901a\u8fc7\u7b2c\u4e09\u65b9\u4f18\u5316\u5e73\u53f0\u7684\u6e38\u620f\u6027\u80fd\u5206\u6790\u62a5\u544a\u6765\u4e86\u89e3\u6e38\u620f\u5f00\u53d1\u4e2d\u6027\u80fd\u4f18\u5316\u7684\u4e3b\u8981\u65b9\u5f0f\u53ca\u65b9\u5411\u3002</li> </ul>"},{"location":"game/perf/tools/#_1","title":"\u6e38\u620f\u6027\u80fd\u7b80\u8ff0","text":"<p>\u63d0\u8d77\u6e38\u620f\u6027\u80fd\uff0c\u9996\u5148\u8981\u63d0\u5230\u7684\u5c31\u662f\uff0c\u4e0d\u4ec5\u5f00\u53d1\u4eba\u5458\uff0c\u6240\u6709\u6e38\u620f\u73a9\u5bb6\u90fd\u5e94\u8be5\u4f1a\u63a5\u89e6\u5230\u7684\u4e00\u4e2a\u540d\u8bcd\uff1a\u5e27\u7387\uff08Frame rate\uff09\u3002</p> <p>\u5e27\u7387\u662f\u8861\u91cf\u6e38\u620f\u6027\u80fd\u7684\u57fa\u672c\u6307\u6807\u3002\u5728\u6e38\u620f\u4e2d\uff0c\u201c\u4e00\u5e27\u201d\u4fbf\u662f\u662f\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a\u7684\u4e00\u4e2a\u9759\u6b62\u753b\u9762\u3002\u7ed8\u5236\u4e00\u5e27\u5230\u5c4f\u5e55\u4e0a\u4e5f\u53eb\u505a\u6e32\u67d3\u4e00\u5e27\u3002\u6bcf\u79d2\u7684\u5e27\u6570(fps)\u6216\u8005\u8bf4\u5e27\u7387\u8868\u793aGPU\u5904\u7406\u65f6\u6bcf\u79d2\u949f\u80fd\u591f\u66f4\u65b0\u7684\u6b21\u6570\u3002\u9ad8\u7684\u5e27\u7387\u53ef\u4ee5\u5f97\u5230\u66f4\u6d41\u7545\u3001\u66f4\u903c\u771f\u7684\u52a8\u753b\u3002</p> <p>\u73b0\u9636\u6bb5\u5927\u591a\u6570\u6e38\u620f\u7684\u7406\u60f3\u5e27\u7387\u662f60FPS\uff0c\u5176\u5e26\u6765\u7684\u4ea4\u4e92\u611f\u548c\u771f\u5b9e\u611f\u4f1a\u66f4\u52a0\u5f3a\u70c8\u3002\u901a\u5e38\u6765\u8bf4\uff0c\u5e27\u7387\u572830FPS\u4ee5\u4e0a\u90fd\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u4e0d\u9700\u8981\u5feb\u901f\u53cd\u5e94\u4e92\u52a8\u7684\u6e38\u620f\uff0c\u4f8b\u5982\u4f11\u95f2\u3001\u89e3\u5bc6\u3001\u5192\u9669\u7c7b\u6e38\u620f\u7b49\u3002\u6709\u4e9b\u9879\u76ee\u6709\u7279\u6b8a\u7684\u9700\u6c42\uff0c\u6bd4\u5982VR\u6e38\u620f\uff0c\u81f3\u5c11\u9700\u898190FPS\u3002\u5f53\u5e27\u7387\u964d\u4f4e\u523030FPS\u4ee5\u4e0b\u65f6\uff0c\u73a9\u5bb6\u901a\u5e38\u4f1a\u6709\u4e0d\u597d\u7684\u4f53\u9a8c\u3002</p> <p> \u800c\u73b0\u9636\u6bb5\u968f\u7740\u652f\u6301144HZ\u5237\u65b0\u7387\u7684\u786c\u4ef6\u8bbe\u5907\u7684\u6d8c\u73b0\uff0c\u80fd\u5426\u7ef4\u6301\u5bf9\u5e94\u9ad8\u5e27\u7387\u53c8\u662f\u4e00\u9879\u65b0\u7684\u6307\u6807\uff0c\u5c24\u5176\u662f\u5728\u7535\u7ade\u9886\u57df</p> <p>\u4f46\u5728\u6e38\u620f\u4e2d\u91cd\u8981\u7684\u4e0d\u4ec5\u4ec5\u5e27\u7387\u7684\u901f\u5ea6\uff0c\u5e27\u7387\u540c\u65f6\u4e5f\u5fc5\u987b\u975e\u5e38\u7a33\u5b9a\u3002\u73a9\u5bb6\u901a\u5e38\u5bf9\u5e27\u7387\u7684\u53d8\u5316\u6bd4\u8f83\u654f\u611f\uff0c\u4e0d\u7a33\u5b9a\u7684\u5e27\u7387\u901a\u5e38\u4f1a\u6bd4\u4f4e\u4e00\u4e9b\u4f46\u662f\u5f88\u7a33\u5b9a\u7684\u5e27\u7387\u8868\u73b0\u66f4\u5dee\u3002</p> <p>\u867d\u7136**\u5e27\u7387**\u662f\u4e00\u4e2a\u6211\u4eec\u8c08\u8bba\u6e38\u620f\u6027\u80fd\u7684\u57fa\u672c\u6807\u51c6\uff0c\u4f46\u662f\u5f53\u6211\u4eec\u63d0\u5347\u6e38\u620f\u6027\u80fd\u65f6\uff0c\u66f4\u56e0\u8be5\u60f3\u5230\u7684\u662f\u6e32\u67d3\u4e00\u5e27\u9700\u8981\u591a\u5c11\u6beb\u79d2\u3002\u5e27\u7387\u7684\u76f8\u5bf9\u6539\u53d8\u5728\u4e0d\u540c\u8303\u56f4\u4f1a\u6709\u4e0d\u540c\u7684\u53d8\u5316\u3002\u6bd4\u5982\uff0c\u4ece60\u523050FPS\u5448\u73b0\u51fa\u7684\u662f\u989d\u59163.3\u6beb\u79d2\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u4f46\u662f\u4ece30\u523020FPS\u5448\u73b0\u51fa\u7684\u662f\u989d\u5916\u768416.6\u6beb\u79d2\u7684\u8fd0\u884c\u65f6\u95f4\u3002\u5728\u8fd9\u91cc\uff0c\u540c\u6837\u964d\u4f4e\u4e8610FPS\uff0c\u4f46\u662f\u6e32\u67d3\u4e00\u5e27\u4e0a\u65f6\u95f4\u7684\u5dee\u522b\u662f\u5f88\u663e\u8457\u7684\u3002</p> <p>\u6211\u4eec\u8fd8\u9700\u8981\u4e86\u89e3\u6e32\u67d3\u4e00\u5e27\u9700\u8981\u591a\u5c11\u6beb\u79d2\u624d\u80fd\u6ee1\u8db3\u5f53\u524d\u5e27\u7387\u3002\u901a\u8fc7\u516c\u5f0f 1000/\uff08\u60f3\u8981\u8fbe\u5230\u7684\u5e27\u7387\uff09\u3002\u901a\u8fc7\u8fd9\u4e2a\u516c\u5f0f\u53ef\u4ee5\u5f97\u5230\uff0c30FPS\u5fc5\u987b\u572833.3\u6beb\u79d2\u4e4b\u5185\u6e32\u67d3\u5b8c\u4e00\u5e27\uff0c60FPS\u5fc5\u987b\u572816.6\u6beb\u79d2\u5185\u6e32\u67d3\u5b8c\u4e00\u5e27\u3002</p> <p>\u6e32\u67d3\u4e00\u5e27\uff0cUnity\u9700\u8981\u6267\u884c\u5f88\u591a\u4efb\u52a1\u3002\u6bd4\u5982\uff0cUnity\u9700\u8981\u66f4\u65b0\u6e38\u620f\u7684\u72b6\u6001\u3002\u6709\u4e00\u4e9b\u4efb\u52a1\u5728\u6bcf\u4e00\u5e27\u90fd\u9700\u8981\u6267\u884c\uff0c\u5305\u62ec\u6267\u884c\u811a\u672c\uff0c\u8fd0\u884c\u5149\u7167\u8ba1\u7b97\u7b49\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6709\u8bb8\u591a\u64cd\u4f5c\u662f\u5728\u4e00\u5e27\u6267\u884c\u591a\u6b21\u7684\uff0c\u4f8b\u5982\u7269\u7406\u8fd0\u7b97\u3002\u5f53\u6240\u6709\u8fd9\u4e9b\u4efb\u52a1\u90fd\u6267\u884c\u7684\u8db3\u591f\u5feb\u65f6\uff0c\u6211\u4eec\u7684\u6e38\u620f\u624d\u4f1a\u6709\u7a33\u5b9a\u4e14\u7406\u60f3\u7684\u5e27\u7387\u3002\u5f53\u8fd9\u4e9b\u4efb\u52a1\u6267\u884c\u4e0d\u6ee1\u8db3\u9700\u6c42\u65f6\uff0c\u6e32\u67d3\u4e00\u5e27\u5c06\u82b1\u8d39\u66f4\u591a\u7684\u65f6\u95f4\uff0c\u5e76\u4e14\u5e27\u7387\u4f1a\u56e0\u6b64\u4e0b\u964d\u3002</p> <p>\u77e5\u9053\u54ea\u4e9b\u4efb\u52a1\u82b1\u8d39\u4e86\u8fc7\u591a\u7684\u65f6\u95f4\uff0c\u662f\u6e38\u620f\u6027\u80fd\u95ee\u9898\u7684\u5173\u952e\u3002\u4e00\u65e6\u6211\u4eec\u77e5\u9053\u4e86\u54ea\u4e9b\u4efb\u52a1\u964d\u4f4e\u4e86\u5e27\u7387\uff0c\u4fbf\u53ef\u4ee5\u5c1d\u8bd5\u4f18\u5316\u6e38\u620f\u7684\u8fd9\u4e00\u90e8\u5206\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6027\u80fd\u5206\u6790\u5de5\u5177\u662f\u6e38\u620f\u4f18\u5316\u7684\u91cd\u70b9\u4e4b\u4e00\u3002</p>"},{"location":"game/perf/tools/#unity3d_1","title":"Unity3d\u6027\u80fd\u5206\u6790\u5de5\u5177","text":"<p>\u5de5\u6b32\u5584\u5176\u4e8b\u5fc5\u5148\u5229\u5176\u5668\uff0c\u8fd9\u91cc\u6211\u4eec\u6765\u8bb2\u89e3Unity3D\u4f18\u5316\u6240\u9700\u7684\u5de5\u5177</p> <p>\u5982\u679c\u6e38\u620f\u5b58\u5728\u6027\u80fd\u95ee\u9898\uff0c\u6e38\u620f\u8fd0\u884c\u5c31\u4f1a\u51fa\u73b0\u7f13\u6162\u3001\u5361\u987f\u3001\u6389\u5e27\u751a\u81f3\u76f4\u63a5\u95ea\u9000\u7b49\u73b0\u8c61\u3002\u5728\u6211\u4eec\u5c1d\u8bd5\u89e3\u51b3\u95ee\u9898\u524d\uff0c\u9700\u8981\u5148\u77e5\u9053\u5176\u95ee\u9898\u7684\u8d77\u56e0\uff0c\u800c\u5c1d\u8bd5\u4e0d\u540c\u7684\u89e3\u51b3\u65b9\u6848\u3002\u82e5\u4ec5\u9760\u731c\u6d4b\u6216\u8005\u4f9d\u636e\u81ea\u8eab\u539f\u6709\u7684\u7ecf\u9a8c\u53bb\u89e3\u51b3\u95ee\u9898\uff0c\u90a3\u6211\u4eec\u53ef\u80fd\u4f1a\u505a\u65e0\u7528\u529f\uff0c\u751a\u81f3\u5f15\u7533\u51fa\u66f4\u590d\u6742\u7684\u95ee\u9898\u3002</p> <p>\u5728\u8fd9\u4e9b\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u7528\u5230\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u6027\u80fd\u5206\u6790\u5de5\u5177\u4e3b\u8981\u6d4b\u8bd5\u6e38\u620f\u8fd0\u884c\u65f6\u5404\u4e2a\u65b9\u9762\u6027\u80fd\uff0c\u5982CPU\u3001GPU\u3001\u5185\u5b58\u7b49\u3002\u901a\u8fc7\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u6211\u4eec\u80fd\u591f\u900f\u8fc7\u6e38\u620f\u8fd0\u884c\u7684\u5916\u5728\u8868\u73b0\uff0c\u83b7\u53d6\u5185\u5728\u4fe1\u606f\uff0c\u800c\u8fd9\u4e9b\u4fe1\u606f\u4fbf\u662f\u6211\u4eec\u9501\u5b9a\u5f15\u8d77\u6027\u80fd\u95ee\u9898\u7684\u5173\u952e\u6240\u5728\u3002</p> <p>\u5728\u6211\u4eec\u8fdb\u884cUnity\u6027\u80fd\u4f18\u5316\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6700\u4e3b\u8981\u7528\u7684\u5230\u6027\u80fd\u5206\u6790\u5de5\u5177\u5305\u62ec\uff0cUnity\u81ea\u5e26\u7684**Unity Profile**\uff0cIOS\u7aef\u7684**XCode** \uff0c\u4ee5\u53ca\u4e00\u4e9b\u7b2c\u4e09\u65b9\u63d2\u4ef6\uff0c\u5982\u817e\u8baf\u63a8\u51fa\u7684UPA\u6027\u80fd\u5206\u6790\u5de5\u5177\u3002</p> <p>\u6211\u4eec\u4e3b\u8981\u9488\u5bf9**Unity Profile**\u8fdb\u884c\u8bb2\u89e3\uff0c\u4e4b\u540e\u4e5f\u4f1a\u7565\u5fae\u4ecb\u7ecd\u53e6\u5916\u4e00\u4e9b\u6027\u80fd\u5206\u6790\u5de5\u5177\u3002</p>"},{"location":"game/perf/tools/#unity-profile","title":"Unity Profile","text":"<p>**Unity Profile**\u662fUnity\u4e2d\u6700\u5e38\u7528\u7684\u5b98\u65b9\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u5728\u4f7f\u7528Unity\u5f00\u53d1\u6e38\u620f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u501f\u52a9Profiler\u6765\u5206\u6790CPU\u3001GPU\u53ca\u5185\u5b58\u4f7f\u7528\u72b6\u51b5\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002</p> <p>\u9996\u5148\u6211\u4eec\u6765\u4e86\u89e3Unity Profile\u7684\u9762\u677f\uff1a \u6211\u4eec\u901a\u8fc7Window\u2014\u2014&gt;Profiler\u6765\u6fc0\u6d3bUnity Profile\u9762\u677f</p> <p></p> <p>\u5728\u4e0b\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230Unity Profile\u9762\u677f\uff0c\u5176\u4e2d\u6709\u5f88\u591aprofilers\uff0c\u6bcf\u4e2aprofiler\u663e\u793a\u6211\u4eec\u5f53\u524d\u9879\u76ee\u4e00\u4e2a\u65b9\u9762\u7684\u4fe1\u606f\uff0c\u5982CPU\u3001GPU\u3001\u6e32\u67d3(Rendering)\u3001\u5185\u5b58(Memory)\u3001\u58f0\u97f3(Audio)\u3001\u89c6\u5c4f(Video)\u3001\u7269\u7406(Physics)\u3001ui\u53ca\u5168\u5c40\u5149\u7167(global illumination)\u3002</p> <p></p> <p>\u5f53\u9879\u76ee\u8fd0\u884c\u65f6\uff0c\u6bcf\u4e2aprofilers\u4f1a\u968f\u7740\u8fd0\u884c\u65f6\u95f4\u6765\u663e\u793a\u6570\u636e\uff0c\u6709\u4e9b\u6027\u80fd\u95ee\u9898\u662f\u6301\u7eed\u6027\u7684\uff0c\u6709\u4e9b\u4ec5\u5728\u67d0\u4e00\u5e27\u4e2d\u51fa\u73b0\uff0c\u8fd8\u6709\u4e9b\u6027\u80fd\u95ee\u9898\u53ef\u80fd\u4f1a\u968f\u65f6\u95f4\u63a8\u79fb\u800c\u9010\u6e10\u663e\u51fa\u51fa\u6765\u3002</p> <p>\u5728\u9762\u677f\u7684\u4e0b\u534a\u90e8\u5206\u663e\u793a\u4e86\u6211\u4eec\u9009\u4e2d\u7684profilers\u5f53\u524d\u5e27\u7684\u8be6\u7ec6\u5185\u5bb9\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u9009\u62e9\u5217\u6807\u9898\uff0c\u901a\u8fc7\u8fd9\u4e00\u5217\u7684\u4fe1\u606f\u503c\u6765\u6392\u5e8f\u3002 \u5728CPU usage profiler\u4e2d\u7684\u5217\u8868\u9898\u5206\u522b\u4e3a\uff1a Total:\u5f53\u524d\u4efb\u52a1\u7684\u65f6\u95f4\u6d88\u8017\u5360\u5f53\u524d\u5e27cpu\u6d88\u8017\u7684\u65f6\u95f4\u6bd4\u4f8b\u3002 Self:\u4efb\u52a1\u81ea\u8eab\u65f6\u95f4\u6d88\u8017\u5360\u5f53\u524d\u5e27cpu\u6d88\u8017\u7684\u65f6\u95f4\u6bd4\u4f8b\u3002 Calls:\u5f53\u524d\u4efb\u52a1\u5728\u5f53\u524d\u5e27\u5185\u88ab\u8c03\u7528\u7684\u6b21\u6570\u3002 GC Alloc:\u5f53\u524d\u4efb\u52a1\u5728\u5f53\u524d\u5e27\u5185\u8fdb\u884c\u8fc7\u5185\u5b58\u56de\u6536\u548c\u5206\u914d\u7684\u6b21\u6570\u3002 Time ms:\u5f53\u524d\u4efb\u52a1\u5728\u5f53\u524d\u5e27\u5185\u7684\u8017\u65f6\u603b\u65f6\u95f4\u3002 Self ms:\u5f53\u524d\u4efb\u52a1\u81ea\u8eab(\u4e0d\u5305\u542b\u5185\u90e8\u7684\u5b50\u4efb\u52a1)\u65f6\u95f4\u6d88\u8017\u3002</p> <p></p> <p>\u5f53\u6211\u4eec\u5728\u5c42\u7ea7\u89c6\u56fe\u4e2d\u70b9\u51fb\u51fd\u6570\u540d\u5b57\u65f6\uff0cCPU usage profiler\u5c06\u5728Profiler\u7a97\u53e3\u4e0a\u90e8\u7684\u56fe\u5f62\u89c6\u56fe\u4e2d\u9ad8\u4eae\u663e\u793a\u8fd9\u4e2a\u51fd\u6570\u7684\u4fe1\u606f\u3002\u6bd4\u5982\u6211\u4eec\u9009\u4e2dCameta.Render\uff0cRendering\u7684\u4fe1\u606f\u5c31\u4f1a\u88ab\u9ad8\u4eae\u663e\u793a\u51fa\u6765\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5Profiler\u7684\u5de6\u4e0b\u7684\u4e0b\u62c9\u83dc\u5355\u4e2d\u9009\u62e9Timeline\u3002</p> <p></p> <p>Timeline\u663e\u793a\u4e86\u4e24\u4ef6\u4e8b\uff1acpu\u4efb\u52a1\u7684\u6267\u884c\u987a\u5e8f\u548c\u54ea\u4e2a\u7ebf\u7a0b\u8d1f\u8d23\u4ec0\u4e48\u4efb\u52a1\u3002\u7ebf\u7a0b\u5141\u8bb8\u4e0d\u540c\u7684\u4efb\u52a1\u540c\u65f6\u6267\u884c\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\u65f6\uff0c\u53e6\u5916\u7684\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u53e6\u4e00\u4e2a\u5b8c\u5168\u4e0d\u540c\u7684\u4efb\u52a1\u3002\u548cUnity\u7684\u6e32\u67d3\u8fc7\u7a0b\u76f8\u5173\u7684\u7ebf\u7a0b\u6709\u4e09\u79cd\uff1a\u4e3b\u7ebf\u7a0b\uff0c\u6e32\u67d3\u7ebf\u7a0b\u548cworker threads\u3002\u4e86\u89e3\u54ea\u4e2a\u7ebf\u7a0b\u8d1f\u8d23\u54ea\u4e9b\u4efb\u52a1\u7684\u7528\u5904\u975e\u5e38\u4e4b\u5927\uff0c\u4e00\u65e6\u6211\u4eec\u77e5\u9053\u4e86\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u7684\u4efb\u52a1\u6267\u884c\u7684\u901f\u7387\u6700\u4f4e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u5e94\u8be5\u96c6\u4e2d\u4f18\u5316\u5728\u90a3\u4e2a\u7ebf\u7a0b\u4e0a\u7684\u64cd\u4f5c\u3002</p> <p></p> <p>\u4ee5\u4e0a\u6240\u663e\u793a\u7684\u6570\u636e\u4f9d\u8d56\u4e8e\u6211\u4eec\u5f53\u524d\u9009\u62e9\u7684profiler\u3002\u4f8b\u5982\uff0c\u5f53\u9009\u4e2d\u5185\u5b58\u65f6\uff0c\u8fd9\u4e2a\u533a\u57df\u663e\u793a\u4f8b\u5982\u6e38\u620f\u8d44\u6e90\u4f7f\u7528\u7684\u5185\u5b58\u548c\u603b\u5185\u5b58\u5360\u7528\u7b49\u3002\u5982\u679c\u9009\u4e2d\u6e32\u67d3profiler\uff0c\u8fd9\u91cc\u4f1a\u663e\u793a\u88ab\u6e32\u67d3\u7684\u5bf9\u8c61\u6570\u91cf\u6216\u8005\u6e32\u67d3\u64cd\u4f5c\u6267\u884c\u6b21\u6570\u7b49\u6570\u636e\u3002</p> <p>\u8fd9\u4e9bprofiler\u4f1a\u63d0\u4f9b\u5f88\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f46\u662f\u6211\u4eec\u5e76\u4e0d\u603b\u9700\u8981\u4f7f\u7528\u6240\u6709\u7684profiler\u3002\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u5728\u5206\u6790\u6e38\u620f\u6027\u80fd\u65f6\u901a\u5e38\u53ea\u662f\u89c2\u5bdf\u4e00\u4e2a\u6216\u8005\u4e24\u4e2aprofiler\uff0c\u800c\u4e0d\u9700\u8981\u89c2\u5bdf\u7684\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u53f3\u4e0a\u89d2\u7684\u201dX\u201d\u5173\u95ed\uff0c\u5982\u679c\u9700\u8981\u5728\u6dfb\u52a0\u56de\u6765\uff0c\u53ef\u4ee5\u901a\u8fc7\u5de6\u4e0a\u89d2Add Profiler\u3002 \u4f8b\u5982\uff0c\u5f53\u6211\u4eec\u7684\u6e38\u620f\u8fd0\u884c\u7684\u6bd4\u8f83\u6162\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u4e00\u5f00\u59cb\u5148\u67e5\u770bCPU usage profiler\uff0cCPU usage profiler\u4e5f\u662f\u5728\u6211\u4eec\u8fdb\u884c\u4f18\u5316\u5206\u6790\u65f6\u6700\u5e38\u7528\u7684Profiler\u3002</p> <p></p> <p>\u5f53\u7136\uff0c\u9664\u4e86CPU usage profiler\uff0cUnity Profiler\u4e2d\u5176\u4ed6\u7684Profiler\u5728\u4e00\u4e9b\u573a\u5408\u4e5f\u975e\u5e38\u7684\u6709\u7528\uff0c\u6bd4\u5982GPU\u3001\u5185\u5b58\u3001\u6e32\u67d3\u7b49\uff0c\u5176\u4f7f\u7528\u65b9\u6cd5\u548cCPU usage profiler\u4e5f\u662f\u5927\u540c\u5c0f\u5f02\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0a\u7684\u6b65\u9aa4\u6765\u67e5\u770b\u5e76\u5b66\u4e60\u3002</p> <p>\u6211\u4eec\u5728\u89c2\u5bdf\u6570\u636e\u65f6\uff0c\u9700\u8981\u89c2\u5bdf\u7684\u76ee\u6807\u6709\u5982\u4e0b\u51e0\u70b9\uff1a</p> <p>CPU: 1. GC Allow: \u4efb\u4f55\u4e00\u6b21\u6027\u5185\u5b58\u5206\u914d\u5927\u4e8e2KB\u7684\u9009\u9879\u3002 \u6bcf\u5e27\u90fd\u5177\u670920B\u4ee5\u4e0a\u5185\u5b58\u5206\u914d\u7684\u9009\u9879 \u3002</p> <p>GC\u76f8\u5173\u7684\u95ee\u9898\u548c\u4f18\u5316\uff0c\u5728\u4e4b\u540e\u6211\u4eec\u4f1a\u8be6\u7ec6\u7684\u4ecb\u7ecd\u3002</p> <ol> <li>Time ms:</li> </ol> <p>\u6ce8\u610f\u5360\u75285ms\u4ee5\u4e0a\u7684\u9009\u9879</p> <p>\u5185\u5b58 1. Texture: \u68c0\u67e5\u662f\u5426\u6709\u91cd\u590d\u8d44\u6e90\u548c\u8d85\u5927\u5185\u5b58\u662f\u5426\u9700\u8981\u538b\u7f29\u7b49.\u3002 2. AnimationClip: \u91cd\u70b9\u68c0\u67e5\u662f\u5426\u6709\u91cd\u590d\u8d44\u6e90.\u3002 3. Mesh\uff1a \u91cd\u70b9\u68c0\u67e5\u662f\u5426\u6709\u91cd\u590d\u8d44\u6e90\u3002</p>"},{"location":"game/perf/tools/#_2","title":"\u5b9e\u9645\u9879\u76ee\u4e2d\u7684\u4f18\u5316\u5efa\u8bae","text":"<p>\u5728\u4e86\u89e3\u4e86Unity Profiler\u540e\uff0c\u73b0\u5728\u6211\u4eec\u5728\u4e00\u4e2a\u5b9e\u9645\u9879\u76ee\u4e2d\u6765\u8fdb\u884c\u4e00\u6b21\u6027\u80fd\u5206\u6790\u3002\u540c\u65f6\u6765\u4e86\u89e3\u4e00\u822c\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u4e3b\u8981\u4f1a\u5f15\u8d77\u4e5f\u662f\u6211\u4eec\u4e3b\u8981\u53bb\u89c2\u5bdf\u7684\u6027\u80fd\u95ee\u9898\u51fa\u73b0\u5728\u4ec0\u4e48\u5730\u65b9\u3002</p> <p>\u4ee5\u4e0b\u662f\u6211\u505a\u7684\u4e00\u4e2a\u7b80\u5355\u7684\u6e38\u620f\u9879\u76ee\uff0c\u5e76\u672a\u505a\u4efb\u4f55\u6027\u80fd\u4f18\u5316\u5e76\u4e14\u6709\u5927\u91cf\u5f15\u8d77\u6027\u80fd\u95ee\u9898\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u66f4\u65b9\u4fbf\u5927\u5bb6\u89c2\u5bdf\u5176\u6027\u80fd\u95ee\u9898\uff0c\u5728\u4e4b\u540e\u6211\u4f1a\u628a\u5de5\u7a0b\u4e0a\u4f20\u5230github\u4f9b\u521d\u5b66\u8005\u4e0b\u8f7d\u5206\u6790\u3002</p> <p></p> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5728CPU usage profiler\u9762\u677f\u4e2d\u7684\u53ef\u89c2\u5bdf\u9879\uff0c\u5728\u9879\u76ee\u4e2d\u6211\u4eec\u53ef\u4ee5\u5148\u5173\u95ed**VSync\u5782\u76f4\u540c\u6b65**\u6765\u63d0\u9ad8\u5e27\u7387\u3002</p> <p>\u4e0b\u56fe\u4e2d\u6211\u5173\u95ed\u4e86\u9664VSync\u4e4b\u5916\u7684\u663e\u793a\uff0c\u53ef\u4ee5\u770b\u5230VSync\u7684\u6d88\u8017</p> <p></p> <p>\u5177\u4f53\u6b65\u9aa4\u662fedit-&gt;project settings-&gt;Quality\uff0c\u5728Inspector\u9762\u677f\u4e2d\uff0cV Sync count\u9009\u62e9don\u2019t Sync.</p> <p></p> <p>\u6211\u4eec\u6765\u7b80\u5355\u7684\u4ecb\u7ecd\u4e00\u4e0b\u4ec0\u4e48\u662f\u5782\u76f4\u540c\u6b65\uff0c\u4ee5\u53ca\u5173\u95ed\u5b83\u4e4b\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002</p> <p>\u8981\u7406\u89e3\u5782\u76f4\u540c\u6b65\uff0c\u9996\u5148\u660e\u767d\u663e\u793a\u5668\u7684\u5de5\u4f5c\u539f\u7406\u3002</p> <p>\u663e\u793a\u5668\u4e0a\u7684\u6240\u6709\u56fe\u50cf\u90fd\u662f\u5355\u4e2a\u50cf\u7d20\u7ec4\u6210\u4e86\u6c34\u5e73\u626b\u63cf\u7ebf\uff0c\u6c34\u5e73\u626b\u63cf\u7ebf\u5728\u5782\u76f4\u65b9\u5411\u7684\u5806\u79ef\u5f62\u6210\u4e86\u5b8c\u6574\u7684\u753b\u9762\uff0c\u65e0\u8bba\u662f\u9694\u884c\u626b\u63cf\u8fd8\u662f\u9010\u884c\u626b\u63cf\uff0c\u663e\u793a\u5668\u90fd\u6709\u4e24\u79cd\u540c\u6b65\u53c2\u6570\u2014\u2014\u6c34\u5e73\u540c\u6b65\u548c\u5782\u76f4\u540c\u6b65\u3002 \u5782\u76f4\u548c\u6c34\u5e73\u662fCRT\u663e\u793a\u5668\u4e2d\u4e24\u4e2a\u57fa\u672c\u7684\u540c\u6b65\u4fe1\u53f7\uff0c\u6c34\u5e73\u540c\u6b65\u4fe1\u53f7\u51b3\u5b9a\u4e86CRT\u753b\u51fa\u4e00\u6761\u6a2a\u8d8a\u5c4f\u5e55\u7ebf\u7684\u65f6\u95f4\uff0c\u5782\u76f4\u540c\u6b65\u4fe1\u53f7\u51b3\u5b9a\u4e86CRT\u4ece\u5c4f\u5e55\u9876\u90e8\u753b\u5230\u5e95\u90e8\uff0c\u518d\u8fd4\u56de\u539f\u59cb\u4f4d\u7f6e\u7684\u65f6\u95f4\uff0c\u800c\u5782\u76f4\u540c\u6b65\u4ee3\u8868\u7740CRT\u663e\u793a\u5668\u7684\u5237\u65b0\u7387\u6c34\u51c6\u3002 \u5728\u6e38\u620f\u9879\u76ee\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u9009\u62e9\u7b49\u5f85\u5782\u76f4\u540c\u6b65\u4fe1\u53f7\u4e5f\u5c31\u662f\u6253\u5f00\u5782\u76f4\u540c\u6b65\uff0c\u5728\u6e38\u620f\u4e2d\u6216\u8bb8\u6027\u80fd\u8f83\u5f3a\u7684\u663e\u5361\u4f1a\u8fc5\u901f\u7684\u7ed8\u5236\u5b8c\u4e00\u5c4f\u7684\u56fe\u50cf\uff0c\u4f46\u662f\u6ca1\u6709\u5782\u76f4\u540c\u6b65\u4fe1\u53f7\u7684\u5230\u8fbe\uff0c\u663e\u5361\u65e0\u6cd5\u7ed8\u5236\u4e0b\u4e00\u5c4f\uff0c\u53ea\u6709\u7b4985\u5355\u4f4d\u7684\u4fe1\u53f7\u5230\u8fbe\uff0c\u624d\u53ef\u4ee5\u7ed8\u5236\u3002\u8fd9\u6837FPS\u81ea\u7136\u8981\u53d7\u5230\u5237\u65b0\u7387\u8fd0\u884c\u503c\u7684\u5236\u7ea6\u3002 \u800c\u5982\u679c\u6211\u4eec\u9009\u62e9\u4e0d\u7b49\u5f85\u5782\u76f4\u540c\u6b65\u4fe1\u53f7\uff0c\u90a3\u4e48\u6e38\u620f\u4e2d\u7ed8\u5236\u5b8c\u4e00\u5c4f\u753b\u9762\uff0c\u663e\u5361\u548c\u663e\u793a\u5668\u65e0\u9700\u7b49\u5f85\u5782\u76f4\u540c\u6b65\u4fe1\u53f7\u5c31\u53ef\u4ee5\u5f00\u59cb\u4e0b\u4e00\u5c4f\u56fe\u50cf\u7684\u7ed8\u5236\uff0c\u81ea\u7136\u53ef\u4ee5\u5b8c\u5168\u53d1\u6325\u663e\u5361\u7684\u5b9e\u529b\u3002 \u4f46\u662f\uff0c\u6b63\u662f\u56e0\u4e3a\u5782\u76f4\u540c\u6b65\u7684\u5b58\u5728\uff0c\u624d\u80fd\u4f7f\u5f97\u6e38\u620f\u8fdb\u7a0b\u548c\u663e\u793a\u5668\u5237\u65b0\u7387\u540c\u6b65\uff0c\u4f7f\u5f97\u753b\u9762\u66f4\u52a0\u5e73\u6ed1\u548c\u7a33\u5b9a\u3002\u53d6\u6d88\u4e86\u5782\u76f4\u540c\u6b65\u4fe1\u53f7\uff0c\u56fa\u7136\u53ef\u4ee5\u6362\u6765\u66f4\u5feb\u7684\u901f\u5ea6\uff0c\u4f46\u662f\u5728\u56fe\u50cf\u7684\u8fde\u7eed\u6027\u4e0a\u52bf\u5fc5\u4f1a\u6253\u6298\u6263\u3002 \u9700\u8981\u6ce8\u610f\uff0cLCD\u663e\u793a\u5668\u5176\u5b9e\u4e5f\u662f\u5b58\u5728\u5237\u65b0\u7387\u7684\uff0c\u4f46\u5176\u673a\u5236\u4e0eCRT\u4e0d\u540c\uff0c\u8fd9\u91cc\u4e0d\u505a\u8fc7\u591a\u8d58\u8ff0\uff0c\u4f46\u662f\u5782\u76f4\u540c\u6b65\u548c\u6c34\u5e73\u540c\u6b65\u5bf9\u4e8eLCD\u663e\u793a\u5668\u6765\u8bf4\uff0c\u4e00\u6837\u662f\u6709\u5fc5\u8981\u7684\u3002</p> <p>\u5728\u5173\u95ed\u5782\u76f4\u540c\u6b65\u540e\uff0c\u6211\u4eec\u7ee7\u7eed\u770b\u6211\u4eec\u7684\u9879\u76ee</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u4ee5Total\u548cTime ms\u6392\u5e8f\uff0c\u5728\u56fe\u4e2d\u62c9\u9ed1\u7684\u9879\uff08Camera Render\uff09\u59cb\u7ec8\u6392\u5728\u6700\u524d\u9762\u3002 Camera Render\u662f\u76f8\u673a\u6e32\u67d3\u5de5\u4f5c\u7684CPU\u5360\u7528\u91cf\uff0c\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u6e32\u67d3\u662f\u6700\u5e38\u89c1\u7684\u5f15\u8d77\u6027\u80fd\u95ee\u9898\u7684\u539f\u56e0\u3002 \u800c\u56e0\u4e3a\u6e32\u67d3\u800c\u5f15\u8d77\u7684\u6027\u80fd\u95ee\u9898\u7684\u4f18\u5316\u662f\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u5de5\u7a0b\uff0c\u8fd9\u65b9\u9762\u7684\u4f18\u5316\u65b9\u6cd5\u5728\u6211\u4eec**\u540e\u7eed\u7684\u6587\u7ae0\u4e2d**\u4f1a\u6709\u8be6\u7ec6\u7684\u6559\u7a0b\u53bb\u5b66\u4e60\u548c\u5206\u6790\u3002\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5148\u4e86\u89e3\u3002 \u6211\u4eec\u8fd9\u4e2a\u9879\u76ee\u7684\u4f18\u5316\u4e2d\uff0c\u65e0\u7591\uff0c\u6e32\u67d3\u9020\u6210\u7684\u6027\u80fd\u635f\u8017\u662f\u4e00\u4e2a\u5927\u5934\u3002</p> <p>\u5982\u679c\u8bf4\uff0c\u5728\u6211\u4eec\u6027\u80fd\u5206\u6790\u4e2d\uff0c\u6e32\u67d3\u5df2\u7ecf\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u90a3\u4e48\u6211\u4eec\u63a5\u4e0b\u6765\u8981\u91cd\u70b9\u89c2\u5bdf\u7684\u5c31\u662fGC\uff0c\u4e5f\u5c31\u662f**\u5783\u573e\u56de\u6536\u6027\u80fd\u5206\u6790**\u3002 \u6211\u4eec\u6309\u7167GC Alloc\u7684\u987a\u5e8f\u6765\u663e\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u4e0b\u56fe\u3002</p> <p></p> <p>\u5728\u4e4b\u524d\u6211\u4eec\u63d0\u5230\u8fc7\uff0cGC Alloc\u4e2d\uff0c\u4efb\u4f55\u4e00\u6b21\u6027\u5185\u5b58\u5206\u914d\u5927\u4e8e2KB\u7684\u9009\u9879\uff0c\u6bcf\u5e27\u90fd\u5177\u670920B\u4ee5\u4e0a\u5185\u5b58\u5206\u914d\u7684\u9009\u9879 \uff0c\u662f\u9700\u8981\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u7684\uff0c\u663e\u800c\u6613\u89c1\uff0c\u6211\u4eec\u7684\u9879\u76ee\u4e2d\uff0c\u5bf9\u4e8eGC\u7684\u4f18\u5316\uff0c\u4e5f\u6709\u5f88\u5927\u7684\u95ee\u9898\u3002\u5173\u4e8eCG\u7684\u95ee\u9898\uff0c\u6211\u4eec\u4f1a\u5728\u4e0b\u4e00\u7bc7Unity3D\u6027\u80fd\u4f18\u5316\u2014\u2014CPU\u7bc7\u4e2d\uff0c\u8be6\u7ec6\u7684\u4ecb\u7ecd\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u5927\u81f4\u4ecb\u7ecd\u4e00\u4e0bGC\u7684\u673a\u5236\uff0c\u8981\u60f3\u4e86\u89e3\u5783\u573e\u56de\u6536\u5982\u4f55\u5de5\u4f5c\u4ee5\u53ca\u4f55\u65f6\u88ab\u89e6\u53d1\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u4e86\u89e3unity\u7684\u5185\u5b58\u7ba1\u7406\u673a\u5236\u3002Unity\u4e3b\u8981\u91c7\u7528\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u7684\u673a\u5236\uff0c\u5f00\u53d1\u65f6\u5728\u4ee3\u7801\u4e2d\u4e0d\u9700\u8981\u8be6\u7ec6\u5730\u544a\u8bc9unity\u5982\u4f55\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\uff0cunity\u5185\u90e8\u81ea\u8eab\u4f1a\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\u3002 Unity\u5185\u90e8\u6709\u4e24\u4e2a\u5185\u5b58\u7ba1\u7406\u6c60\uff0c\u5806\u5185\u5b58\u548c\u6808\u5185\u5b58\uff0c\u5783\u573e\u56de\u6536\u4e3b\u8981\u662f\u6307\u5806\u4e0a\u7684\u5185\u5b58\u5206\u914d\u548c\u56de\u6536\uff0cunity\u4e2d\u4f1a\u5b9a\u65f6\u5bf9\u5806\u5185\u5b58\u8fdb\u884cGC\u64cd\u4f5c\u3002 \u5f53\u5806\u5185\u5b58\u4e0a\u4e00\u4e2a\u53d8\u91cf\u4e0d\u518d\u5904\u4e8e\u6fc0\u6d3b\u72b6\u6001\u7684\u65f6\u5019\uff0c\u5176\u6240\u5360\u7528\u7684\u5185\u5b58\u5e76\u4e0d\u4f1a\u7acb\u523b\u88ab\u56de\u6536\uff0c\u4e0d\u518d\u4f7f\u7528\u7684\u5185\u5b58\u53ea\u4f1a\u5728GC\u7684\u65f6\u5019\u624d\u4f1a\u88ab\u56de\u6536\u3002 \u6bcf\u6b21\u8fd0\u884cGC\u7684\u65f6\u5019\uff0cGC\u4f1a\u68c0\u67e5\u5806\u5185\u5b58\u4e0a\u7684\u6bcf\u4e2a\u5b58\u50a8\u53d8\u91cf\uff0c\u5bf9\u6bcf\u4e2a\u53d8\u91cf\u4f1a\u68c0\u6d4b\u5176\u5f15\u7528\u662f\u5426\u5904\u4e8e\u6fc0\u6d3b\u72b6\u6001\uff0c\u5982\u679c\u53d8\u91cf\u7684\u5f15\u7528\u4e0d\u518d\u5904\u4e8e\u6fc0\u6d3b\u72b6\u6001\uff0c\u5219\u4f1a\u88ab\u6807\u8bb0\u4e3a\u53ef\u56de\u6536\uff0c\u88ab\u6807\u8bb0\u7684\u53d8\u91cf\u4f1a\u88ab\u79fb\u9664\uff0c\u5176\u6240\u5360\u6709\u7684\u5185\u5b58\u4f1a\u88ab\u56de\u6536\u5230\u5806\u5185\u5b58\u4e0a\u3002 GC\u64cd\u4f5c\u662f\u4e00\u4e2a\u6781\u5176\u8017\u8d39\u7684\u64cd\u4f5c\uff0c\u5806\u5185\u5b58\u4e0a\u7684\u53d8\u91cf\u6216\u8005\u5f15\u7528\u8d8a\u591a\u5219\u5176\u8fd0\u884c\u7684\u64cd\u4f5c\u4f1a\u66f4\u591a\uff0c\u8017\u8d39\u7684\u65f6\u95f4\u8d8a\u957f\u3002</p> <p>\u5982\u679c\u6211\u4eec\u4e5f\u6392\u9664\u4e86GC\u7684\u95ee\u9898\uff0c \u90a3\u4e48\u518d\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u8981\u8003\u8651\u5230\u662f\u5426\u662f\u811a\u672c\u7684\u4e00\u4e9b\u95ee\u9898\u9020\u6210\u6027\u80fd\u635f\u8017\u3002</p> <p>\u8fd9\u91cc\u7684\u811a\u672c\uff0c\u53ef\u80fd\u662f\u6211\u4eec\u81ea\u5df1\u5199\u7684\u4ee3\u7801\uff0c\u4e5f\u6709\u53ef\u80fd\u662f\u6211\u4eec\u4f7f\u7528\u7684\u4e00\u4e9b\u63d2\u4ef6\u7684\u4ee3\u7801\u3002\u5728CPU usage profiler\u9762\u677f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5173\u6ce8Script\u8fd9\u4e00\u9879\u3002</p> <p></p> <p>\u5982\u679c\u5728\u4e00\u4e2a\u5f88\u6162\u7684\u5e27\u4e2d\uff0c\u4e00\u5927\u90e8\u5206\u65f6\u95f4\u88ab\u811a\u672c\u8fd0\u884c\u6240\u6d88\u8017\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u4e9b\u6162\u7684\u811a\u672c\u53ef\u80fd\u5c31\u662f\u5f15\u8d77\u6027\u80fd\u95ee\u9898\u7684\u4e3b\u56e0\u3002\u6211\u4eec\u53ef\u4ee5\u66f4\u52a0\u6df1\u5165\u7684\u5206\u6790\u6570\u636e\u6765\u786e\u8ba4\u3002</p> <p>\u9996\u5148\u6211\u4eec\u6309\u7167Time ms\u6765\u6392\u5e8f\uff0c\u7136\u540e\u9009\u62e9\u4fe1\u606f\u5217\u8868\u4e2d\u7684\u9879\u76ee\uff0c\u5982\u679c\u662f\u7528\u6237\u811a\u672c\u7684\u51fd\u6570\uff0c\u90a3\u4e48\u5728Profiler\u4e0a\u65b9\u4f1a\u6709\u9ad8\u4eae\u811a\u672c\u7684\u90e8\u5206\u3002\u8fd9\u79cd\u60c5\u51b5\uff0c\u8bf4\u660e\u6e38\u620f\u7684\u6027\u80fd\u95ee\u9898\u662f\u548c\u7528\u6237\u811a\u672c\u76f8\u5173\u7684\uff0c\u5982\u4e0b\u56fe\u4e2d\u7684\u663e\u793a\uff0c\u8fd9\u90e8\u5206\u811a\u672c\u6027\u80fd\u95ee\u9898\u4e00\u5b9a\u662f\u4e0e\u6211\u4eecFixedUpdate\u6709\u5173\u3002</p> <p></p> <p>\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u518d\u5173\u6ce8\u4e00\u4e9b\u7269\u7406\u3001ui\u65b9\u9762\u7684\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u5728\u4e0a\u9762\u6211\u4eec\u8ba8\u8bba\u7684\uff0c\u662f\u51e0\u79cd\u6700\u5e38\u89c1\u7684\u6027\u80fd\u95ee\u9898\uff0c\u5728\u5b9e\u9645\u9879\u76ee\u4f18\u5316\u4e2d\uff0c\u5982\u679c\u6709\u6027\u80fd\u95ee\u9898\u4e5f\u9003\u4e0d\u5f00\u8fd9\u4e9b\uff0c\u5982\u679c\u5728\u8fd9\u4e9b\u65b9\u5411\u90fd\u5df2\u7ecf\u8fbe\u5230\u4e86\u6211\u4eec\u7684\u8981\u6c42\uff0c\u4f46\u6211\u4eec\u7684\u6e38\u620f\u4ecd\u7136\u6709\u6027\u80fd\u95ee\u9898\uff0c\u6211\u4eec\u5e94\u8be5\u9075\u5faa\u4e0a\u9762\u7684\u65b9\u6cd5\u89e3\u51b3\u95ee\u9898\uff1a\u6536\u96c6\u6570\u636e\u2014\u2014&gt;\u4f7f\u7528CPU usage profiler\u67e5\u770b\u4fe1\u606f\u2014\u2014&gt;\u627e\u5230\u5f15\u8d77\u95ee\u9898\u7684\u51fd\u6570\u3002\u4e00\u65e6\u6211\u4eec\u77e5\u9053\u4e86\u5f15\u8d77\u95ee\u9898\u51fd\u6570\u7684\u540d\u5b57\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u9488\u5bf9\u6027\u7684\uff0c\u5bf9\u5176\u8fdb\u884c\u4f18\u5316\u5904\u7406\u3002</p>"},{"location":"game/perf/tools/#_3","title":"\u5176\u4ed6\u6027\u80fd\u5206\u6790\u5de5\u5177","text":"<p>\u5728\u5f00\u5934\u6211\u4eec\u8bf4\u8fc7\uff0c\u5728\u6211\u4eec\u8fdb\u884cUnity\u6027\u80fd\u4f18\u5316\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6700\u4e3b\u8981\u7528\u7684\u5230\u6027\u80fd\u5206\u6790\u5de5\u5177\u5305\u62ec\uff0cUnity\u81ea\u5e26\u7684**Unity Profile**\uff0cIOS\u7aef**XCode Capture GPU frame**\u4ee5\u53ca\u4e00\u4e9b\u7b2c\u4e09\u65b9\u63d2\u4ef6\uff0c\u5982\u817e\u8baf\u63a8\u51fa\u7684UPA\u6027\u80fd\u5206\u6790\u5de5\u5177\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u7b80\u5355\u7684\u4ecb\u7ecd\u4e00\u4e0bXCode\u548cUPA.</p> <p>**Xcode**\u662f Mac OS X\u4e0a\u7684\u96c6\u6210\u5f00\u53d1\u5de5\u5177\u3002\u5728\u6211\u4eec\u6253\u5305Unity IOS\u7684\u9879\u76ee\u65f6\uff0c\u5fc5\u987b\u4f7f\u7528\u5230Xcode\u6765\u5e2e\u52a9\u6211\u4eec\u6253\u5305\u53ca\u53d1\u5e03\u3002</p> <p>Xcode\u7684\u529f\u80fd\u4e5f\u5341\u5206\u7684\u5f3a\u5927\uff0c\u5728\u6211\u4eec\u5f00\u53d1IOS\u7aef\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5176GPU frame Capture \u529f\u80fd\u4e3a\u6211\u4eec\u7684\u9879\u76ee\u8fdb\u884c\u6027\u80fd\u4f18\u5316\u5206\u6790\u3002</p> <p>\u5728unity\u4e2d\uff0c\u6211\u4eec\u6253\u5305\u65f6\u5728Run In Xcode as \u9009\u62e9debug\u6a21\u5f0f\uff0c\u5e76\u4e14\u52fe\u9009Development Build</p> <p></p> <p>\u6253\u5305\u5b8c\u6210\u540e\uff0c\u4f7f\u7528Xcode\u6253\u5f00\u6587\u4ef6\uff0c\u5728Xcode\u4e2d\u9009\u62e9Product \u2014\u2014&gt; Scheme\u2014\u2014&gt; Manage Schemes</p> <p></p> <p>\u7136\u540e\u4f1a\u51fa\u73b0\u5982\u4e0b\u754c\u9762</p> <p></p> <p>\u6211\u4eec\u53cc\u51fb\u8fd9\u4e2a\u9879\u76ee\u4f1a\u51fa\u73b0\u5982\u4e0b\u754c\u9762</p> <p></p> <p>\u7136\u540e\u6211\u4eec\u5728\u5de6\u4fa7\u9009\u4e2dRun\uff0c\u7136\u540e\u5728\u53f3\u4fa7\u9762\u677f\u9009\u62e9Options</p> <p></p> <p>\u5728GPU frame Capture\u4e2d\u9009\u62e9OpenGL ES\u6216\u8005Metal\u3002 \u5728Debug\u6a21\u5f0f\u4e0b\u8fd0\u884c\u9879\u76ee\uff0c\u5f53\u9879\u76ee\u5728\u771f\u673a\u4e0a\u5b8c\u5168\u52a0\u8f7d\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165Debug Navigator(View \u2014\u2014&gt; Navigators \u2014\u2014&gt; Show Debug Navigator)</p> <p></p> <p>\u4ee5\u4e0b\u662fGPU frame Capture\u5177\u4f53\u529f\u80fd\u7684\u754c\u9762\uff0c\u5728\u56fe\u5f62\u5316\u754c\u9762\u4e2d\uff0c\u53ef\u4ee5\u5728\u6e38\u620f\u8fd0\u884c\u65f6\u6e05\u6670\u7684\u4e86\u89e3\u5230CPU\u3001GPU\u3001\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\u3002</p> <p></p> <p></p> <p></p> <p>XCode\u7684Capture GPU frame\u529f\u80fd\u80fd**\u9ad8\u6548\u4e14\u5b9a\u91cf**\u5730\u5b9a\u4f4d\u5230GPU\u4e2dshader\u7684\u6d88\u8017\u3002</p>"},{"location":"game/perf/tools/#_4","title":"\u53c2\u8003","text":"<p>\u6458\u81eahttps://zhuanlan.zhihu.com/p/39529241</p>"},{"location":"interview/","title":"Android\u9762\u8bd5\u9898\u9898\u76ee","text":"<p>\u8ba9\u601d\u8003\u98de\u4e00\u4f1a\uff01\uff01\uff01\u518d\u770b\u7b54\u6848</p>"},{"location":"interview/android_communication/","title":"Android\u901a\u4fe1","text":"<p>\u8bf4\u4e0b\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f</p> \u56de\u7b54 <p>\u8fdb\u7a0b\u95f4\u901a\u4fe1\u53c8\u79f0<code>IPC(Inter-Process Communication)</code>,\u6307\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u76f8\u4e92\u901a\u4fe1\uff0c\u4ea4\u6362\u4fe1\u606f\u7684\u65b9\u6cd5\u3002\u6839\u636e\u8fdb\u7a0b\u901a\u4fe1\u65f6\u4fe1\u606f\u91cf\u5927\u5c0f\u7684\u4e0d\u540c,\u53ef\u4ee5\u5c06\u8fdb\u7a0b\u901a\u4fe1\u5212\u5206\u4e3a\u4e24\u5927\u7c7b\u578b:</p> <ul> <li> <p>\u4f4e\u7ea7\u901a\u4fe1,\u63a7\u5236\u4fe1\u606f\u7684\u901a\u4fe1(\u4e3b\u8981\u7528\u4e8e\u8fdb\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65,\u4e92\u65a5,\u7ec8\u6b62\u548c\u6302\u8d77\u7b49\u7b49\u63a7\u5236\u4fe1\u606f\u7684\u4f20\u9012)</p> </li> <li> <p>\u9ad8\u7ea7\u901a\u4fe1,\u5927\u6279\u6570\u636e\u4fe1\u606f\u7684\u901a\u4fe1(\u4e3b\u8981\u7528\u4e8e\u8fdb\u7a0b\u95f4\u6570\u636e\u5757\u6570\u636e\u7684\u4ea4\u6362\u548c\u5171\u4eab,\u5e38\u89c1\u7684\u9ad8\u7ea7\u901a\u4fe1\u6709\u7ba1\u9053,\u6d88\u606f\u961f\u5217,\u5171\u4eab\u5185\u5b58\u7b49)\u3002</p> </li> </ul> <p>IPC\u7684\u65b9\u5f0f\u901a\u5e38\u6709\u7ba1\u9053\uff08\u5305\u62ec\u65e0\u540d\u7ba1\u9053\u548c\u547d\u540d\u7ba1\u9053\uff09\u3001\u6d88\u606f\u961f\u5217\u3001\u4fe1\u53f7\u91cf\u3001\u5171\u4eab\u5b58\u50a8\u3001Socket\u3001Streams\u7b49\u3002\u5176\u4e2d Socket\u548cStreams\u652f\u6301\u4e0d\u540c\u4e3b\u673a\u4e0a\u7684\u4e24\u4e2a\u8fdb\u7a0bIPC\u3002</p> <ul> <li> <p>\u7ba1\u9053(Pipe)\u53ca\u6709\u540d\u7ba1\u9053(named pipe)</p> <p>\u7ba1\u9053\u901a\u5e38\u6307\u65e0\u540d\u7ba1\u9053\uff0c\u662f UNIX \u7cfb\u7edfIPC\u6700\u53e4\u8001\u7684\u5f62\u5f0f\uff0c\u662f\u4e00\u79cd\u534a\u53cc\u5de5\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u6570\u636e\u53ea\u80fd\u5355\u5411\u6d41\u52a8\uff0c\u800c\u4e14\u53ea\u80fd\u5728\u5177\u6709\u4eb2\u7f18\u5173\u7cfb\u7684\u8fdb\u7a0b\u95f4\u4f7f\u7528\u3002\u8fdb\u7a0b\u7684\u4eb2\u7f18\u5173\u7cfb\u901a\u5e38\u662f\u6307\u7236\u5b50\u8fdb\u7a0b\u5173\u7cfb\u3002\u6709\u540d\u7ba1\u9053\u4e5f\u662f\u534a\u53cc\u5de5\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u4f46\u662f\u5b83\u5141\u8bb8\u65e0\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002 \u5b83\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u5bf9\u4e8e\u5b83\u7684\u8bfb\u5199\u4e5f\u53ef\u4ee5\u4f7f\u7528\u666e\u901a\u7684read\u3001write \u7b49\u51fd\u6570\u3002\u4f46\u662f\u5b83\u4e0d\u662f\u666e\u901a\u7684\u6587\u4ef6\uff0c\u5e76\u4e0d\u5c5e\u4e8e\u5176\u4ed6\u4efb\u4f55\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u4e14\u53ea\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u3002</p> <p>\u5f53\u4e00\u4e2a\u7ba1\u9053\u5efa\u7acb\u65f6\uff0c\u5b83\u4f1a\u521b\u5efa\u4e24\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1a<code>fd[0]\u4e3a\u8bfb\u800c\u6253\u5f00\uff0cfd[1]\u4e3a\u5199\u800c\u6253\u5f00</code>\u3002\u5982\u4e0b\u56fe\uff1a </p> <p>\u8981\u5173\u95ed\u7ba1\u9053\u53ea\u9700\u5c06\u8fd9\u4e24\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u5173\u95ed\u5373\u53ef\u3002</p> <p>\u5355\u4e2a\u8fdb\u7a0b\u4e2d\u7684\u7ba1\u9053\u51e0\u4e4e\u6ca1\u6709\u4efb\u4f55\u7528\u5904\u3002\u6240\u4ee5\uff0c\u901a\u5e38\u8c03\u7528 pipe \u7684\u8fdb\u7a0b\u63a5\u7740\u8c03\u7528 fork\uff0c\u8fd9\u6837\u5c31\u521b\u5efa\u4e86\u7236\u8fdb\u7a0b\u4e0e\u5b50\u8fdb\u7a0b\u4e4b\u95f4\u7684 IPC \u901a\u9053\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a  \u82e5\u8981\u6570\u636e\u6d41\u4ece\u7236\u8fdb\u7a0b\u6d41\u5411\u5b50\u8fdb\u7a0b\uff0c\u5219\u5173\u95ed\u7236\u8fdb\u7a0b\u7684\u8bfb\u7aef\uff08fd[0]\uff09\u4e0e\u5b50\u8fdb\u7a0b\u7684\u5199\u7aef\uff08fd[1]\uff09\uff1b\u53cd\u4e4b\uff0c\u5219\u53ef\u4ee5\u4f7f\u6570\u636e\u6d41\u4ece\u5b50\u8fdb\u7a0b\u6d41\u5411\u7236\u8fdb\u7a0b\u3002</p> <p>FIFO\uff0c\u4e5f\u79f0\u4e3a\u547d\u540d\u7ba1\u9053\uff0c\u5b83\u662f\u4e00\u79cd\u6587\u4ef6\u7c7b\u578b\u3002 </p> <p>FIFO\u53ef\u4ee5\u5728\u65e0\u5173\u7684\u8fdb\u7a0b\u4e4b\u95f4\u4ea4\u6362\u6570\u636e\uff0c\u4e0e\u65e0\u540d\u7ba1\u9053\u4e0d\u540c\u3002FIFO\u6709\u8def\u5f84\u540d\u4e0e\u4e4b\u76f8\u5173\u8054\uff0c\u5b83\u4ee5\u4e00\u79cd\u7279\u6b8a\u8bbe\u5907\u6587\u4ef6\u5f62\u5f0f\u5b58\u5728\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002</p> <p>\u7ba1\u9053\u53ef\u7528\u4e8e\u5177\u6709\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\uff0c\u6709\u540d\u7ba1\u9053\u514b\u670d\u4e86\u7ba1\u9053\u6ca1\u6709\u540d\u5b57\u7684\u9650\u5236\uff0c\u56e0\u6b64\uff0c\u9664\u5177\u6709\u7ba1\u9053\u6240\u5177\u6709\u7684\u529f\u80fd\u5916\uff0c\u5b83\u8fd8\u5141\u8bb8\u65e0\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002</p> </li> <li> <p>\u6d88\u606f\u961f\u5217(Message Queue)</p> <p>\u6d88\u606f\u961f\u5217\u662f\u6d88\u606f\u7684\u94fe\u63a5\u8868\uff0c\u5305\u62ecPosix\u6d88\u606f\u961f\u5217system V\u6d88\u606f\u961f\u5217\uff0c\u5b58\u653e\u5728\u5185\u6838\u4e2d\u5e76\u7531\u6d88\u606f\u961f\u5217\u6807\u8bc6\u7b26(\u5373\u961f\u5217ID)\u6807\u8bc6\u3002\u6709\u8db3\u591f\u6743\u9650\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5411\u961f\u5217\u4e2d\u6dfb\u52a0\u6d88\u606f\uff0c\u88ab\u8d4b\u4e88\u8bfb\u6743\u9650\u7684\u8fdb\u7a0b\u5219\u53ef\u4ee5\u8bfb\u8d70\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002\u6d88\u606f\u961f\u5217\u514b\u670d\u4e86\u4fe1\u53f7\u627f\u8f7d\u4fe1\u606f\u91cf\u5c11\uff0c\u7ba1\u9053\u53ea\u80fd\u627f\u8f7d\u65e0\u683c\u5f0f\u5b57\u8282\u6d41\u4ee5\u53ca\u7f13\u51b2\u533a\u5927\u5c0f\u53d7\u9650\u7b49\u7f3a\u70b9\u3002</p> <p>\u7279\u70b9\u5982\u4e0b\uff1a</p> <ul> <li>\u6d88\u606f\u961f\u5217\u662f\u9762\u5411\u8bb0\u5f55\u7684\uff0c\u5176\u4e2d\u7684\u6d88\u606f\u5177\u6709\u7279\u5b9a\u7684\u683c\u5f0f\u4ee5\u53ca\u7279\u5b9a\u7684\u4f18\u5148\u7ea7\u3002</li> <li>\u6d88\u606f\u961f\u5217\u72ec\u7acb\u4e8e\u53d1\u9001\u4e0e\u63a5\u6536\u8fdb\u7a0b\u3002\u8fdb\u7a0b\u7ec8\u6b62\u65f6\uff0c\u6d88\u606f\u961f\u5217\u53ca\u5176\u5185\u5bb9\u5e76\u4e0d\u4f1a\u88ab\u5220\u9664\u3002</li> <li>\u6d88\u606f\u961f\u5217\u53ef\u4ee5\u5b9e\u73b0\u6d88\u606f\u7684\u968f\u673a\u67e5\u8be2,\u6d88\u606f\u4e0d\u4e00\u5b9a\u8981\u4ee5\u5148\u8fdb\u5148\u51fa\u7684\u6b21\u5e8f\u8bfb\u53d6,\u4e5f\u53ef\u4ee5\u6309\u6d88\u606f\u7684\u7c7b\u578b\u8bfb\u53d6\u3002   </li> </ul> </li> <li> <p>\u5171\u4eab\u5185\u5b58</p> </li> </ul> <p>\u5171\u4eab\u5185\u5b58\u5c31\u662f\u6620\u5c04\u4e00\u6bb5\u80fd\u88ab\u5176\u4ed6\u8fdb\u7a0b\u6240\u8bbf\u95ee\u7684\u5185\u5b58\uff0c\u8fd9\u6bb5\u5171\u4eab\u5185\u5b58\u7531\u4e00\u4e2a\u8fdb\u7a0b\u521b\u5efa\uff0c\u4f46\u591a\u4e2a\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3002\u5171\u4eab\u5185\u5b58\u662f\u6700\u5feb\u7684 IPC \u65b9\u5f0f\uff0c\u5b83\u662f\u9488\u5bf9\u5176\u4ed6\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f\u8fd0\u884c\u6548\u7387\u4f4e\u800c\u4e13\u95e8\u8bbe\u8ba1\u7684\u3002\u5b83\u5f80\u5f80\u4e0e\u5176\u4ed6\u901a\u4fe1\u673a\u5236\uff0c\u5982\u4fe1\u53f7\u4e24\uff0c\u914d\u5408\u4f7f\u7528\uff0c\u6765\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u7684\u540c\u6b65\u548c\u901a\u4fe1\u3002  </p> <ul> <li>\u4fe1\u53f7(Signal)</li> </ul> <p>\u4fe1\u53f7\u662f\u6bd4\u8f83\u590d\u6742\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u7528\u4e8e\u901a\u77e5\u63a5\u53d7\u8fdb\u7a0b\u6709\u67d0\u79cd\u4e8b\u4ef6\u53d1\u751f\uff0c\u9664\u4e86\u7528\u4e8e\u8fdb\u7a0b\u95f4\u901a\u4fe1\u5916\uff0c\u8fdb\u7a0b\u8fd8\u53ef\u4ee5\u53d1\u9001\u4fe1\u53f7\u7ed9\u8fdb\u7a0b\u672c\u8eab\u3002linux\u9664\u4e86\u652f\u6301Unix\u65e9\u671f\u4fe1\u53f7\u8bed\u4e49\u51fd\u6570signal\u5916\uff0c\u8fd8\u652f\u6301\u8bed\u4e49\u7b26\u5408Posix.1\u6807\u51c6\u7684\u4fe1\u53f7\u51fd\u6570sigaction\uff08\u5b9e\u9645\u4e0a\uff0c\u8be5\u51fd\u6570\u662f\u57fa\u4e8eBSD\u7684\uff0cBSD\u4e3a\u4e86\u5b9e\u73b0\u53ef\u9760\u4fe1\u53f7\u673a\u5236\uff0c\u53c8\u80fd\u591f\u7edf\u4e00\u5bf9\u5916\u63a5\u53e3\uff0c\u7528sigaction\u51fd\u6570\u91cd\u65b0\u5b9e\u73b0\u4e86signal\u51fd\u6570\uff09\u3002</p> <ul> <li>\u4fe1\u53f7\u91cf(semaphore)</li> </ul> <p>\u4fe1\u53f7\u91cf\u662f\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u591a\u4e2a\u8fdb\u7a0b\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u8bbf\u95ee\u3002\u4e0d\u662f\u7528\u4e8e\u4ea4\u6362\u5927\u6279\u6570\u636e,\u800c\u7528\u4e8e\u591a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\u3002\u5e38\u4f5c\u4e3a\u4e00\u79cd\u9501\u673a\u5236,\u9632\u6b62\u67d0\u8fdb\u7a0b\u5728\u8bbf\u95ee\u8d44\u6e90\u65f6\u5176\u5b83\u8fdb\u7a0b\u4e5f\u8bbf\u95ee\u8be5\u8d44\u6e90\u3002\u56e0\u6b64\uff0c\u4e3b\u8981\u4f5c\u4e3a\u8fdb\u7a0b\u95f4\u4ee5\u53ca\u540c\u4e00\u8fdb\u7a0b\u5185\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\u624b\u6bb5\u3002</p> <ul> <li>\u5957\u63a5\u53e3(Socket)</li> </ul> <p>\u66f4\u4e3a\u4e00\u822c\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff0c\u53ef\u7528\u4e8e\u4e0d\u540c\u673a\u5668\u4e4b\u95f4\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u8d77\u521d\u662f\u7531Unix\u7cfb\u7edf\u7684BSD\u5206\u652f\u5f00\u53d1\u51fa\u6765\u7684\uff0c\u4f46\u73b0\u5728\u4e00\u822c\u53ef\u4ee5\u79fb\u690d\u5230\u5176\u5b83\u7c7bUnix\u7cfb\u7edf\u4e0a,Linux\u548cSystem V\u7684\u53d8\u79cd\u90fd\u652f\u6301\u5957\u63a5\u5b57\u3002  </p> <p>\u8bf4\u4e0b\u7ebf\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f</p> \u56de\u7b54 <ul> <li>\u9501\u673a\u5236\uff1a\u5305\u62ec\u4e92\u65a5\u9501\u3001\u6761\u4ef6\u53d8\u91cf\u3001\u8bfb\u5199\u9501</li> </ul> <p>\u4e92\u65a5\u9501\u63d0\u4f9b\u4e86\u4ee5\u6392\u4ed6\u65b9\u5f0f\u9632\u6b62\u6570\u636e\u7ed3\u6784\u88ab\u5e76\u53d1\u4fee\u6539\u7684\u65b9\u6cd5\u3002 \u8bfb\u5199\u9501\u5141\u8bb8\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u5171\u4eab\u6570\u636e\uff0c\u800c\u5bf9\u5199\u64cd\u4f5c\u662f\u4e92\u65a5\u7684\u3002 \u6761\u4ef6\u53d8\u91cf\u53ef\u4ee5\u4ee5\u539f\u5b50\u7684\u65b9\u5f0f\u963b\u585e\u8fdb\u7a0b\uff0c\u76f4\u5230\u67d0\u4e2a\u7279\u5b9a\u6761\u4ef6\u4e3a\u771f\u4e3a\u6b62\u3002\u5bf9\u6761\u4ef6\u7684\u6d4b\u8bd5\u662f\u5728\u4e92\u65a5\u9501\u7684\u4fdd\u62a4\u4e0b\u8fdb\u884c\u7684\u3002\u6761\u4ef6\u53d8\u91cf\u59cb\u7ec8\u4e0e\u4e92\u65a5\u9501\u4e00\u8d77\u4f7f\u7528\u3002</p> <ul> <li>wait/notify \u7b49\u5f85</li> </ul> <p>\u7b49\u5f85\u901a\u77e5\u673a\u5236\u662f\u57fa\u4e8ewait\u548cnotify\u65b9\u6cd5\u6765\u5b9e\u73b0\u7684\uff0c\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5185\u8c03\u7528\u8be5\u7ebf\u7a0b\u9501\u5bf9\u8c61\u7684wait\u65b9\u6cd5\uff0c\u7ebf\u7a0b\u5c06\u8fdb\u5165\u7b49\u5f85\u961f\u5217\u8fdb\u884c\u7b49\u5f85\u76f4\u5230\u88ab\u901a\u77e5\u6216\u8005\u88ab\u5524\u9192\u3002</p> <ul> <li>Volatile \u5185\u5b58\u5171\u4eab</li> </ul> <p>volatile\u6709\u4e24\u5927\u7279\u6027\uff0c\u4e00\u662f\u53ef\u89c1\u6027\uff0c\u4e8c\u662f\u6709\u5e8f\u6027\uff0c\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\uff0c\u5176\u4e2d\u53ef\u89c1\u6027\u5c31\u662f\u53ef\u4ee5\u8ba9\u7ebf\u7a0b\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u3002</p> <ul> <li>\u4f7f\u7528\u6d88\u606f\u5b9e\u73b0\u901a\u4fe1</li> </ul> <p>\u5982Android\u7684Handler\u673a\u5236\uff0c\u901a\u8fc7\u6d88\u606f\u961f\u5217\u6765\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u7684\u901a\u4fe1\u3002</p> <p>\u8bf4\u4e0bBinder</p> \u56de\u7b54 <p>1.\u76f4\u89c2\u6765\u8bf4\uff0cBinder\u662fAndroid\u4e2d\u7684\u4e00\u4e2a\u7c7b\uff0c\u5b83\u7ee7\u627f\u4e86IBinder\u63a5\u53e3</p> <p>2.\u4eceIPC\u89d2\u5ea6\u6765\u8bf4\uff0cBinder\u662fAndroid\u4e2d\u7684\u4e00\u79cd\u8de8\u8fdb\u7a0b\u901a\u4fe1\u65b9\u5f0f\uff0cBinder\u8fd8\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u79cd\u865a\u62df\u7684\u7269\u7406\u8bbe\u5907\uff0c\u5b83\u7684\u8bbe\u5907\u9a71\u52a8\u662f/dev/binder\uff0c\u8be5\u901a\u4fe1\u65b9\u5f0f\u5728linux\u4e2d\u6ca1\u6709</p> <p>3.\u4eceAndroid Framework\u89d2\u5ea6\u6765\u8bf4\uff0cBinder\u662fServiceManager\u8fde\u63a5\u5404\u79cdManager\uff08ActivityManager\u3001WindowManager\uff0cetc\uff09\u548c\u76f8\u5e94ManagerService\u7684\u6865\u6881</p> <p>4.\u4eceAndroid\u5e94\u7528\u5c42\u6765\u8bf4\uff0cBinder\u662f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u8fdb\u884c\u901a\u4fe1\u7684\u5a92\u4ecb\uff0c\u5f53\u4f60bindService\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u4e86\u670d\u52a1\u7aef\u4e1a\u52a1\u8c03\u7528\u7684Binder\u5bf9\u8c61\uff0c\u901a\u8fc7\u8fd9\u4e2aBinder\u5bf9\u8c61\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u83b7\u53d6\u670d\u52a1\u7aef\u63d0\u4f9b\u7684\u670d\u52a1\u6216\u8005\u6570\u636e\uff0c\u8fd9\u91cc\u7684\u670d\u52a1\u5305\u62ec\u666e\u901a\u670d\u52a1\u548c\u57fa\u4e8eAIDL\u7684\u670d\u52a1\u3002</p> <p>\u7b80\u5355\u8bb2\u8bb2 binder \u9a71\u52a8</p> \u56de\u7b54 <ul> <li>Binder\u9a71\u52a8\u662fLinux\u5185\u6838\u4e2d\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u5b83\u7684\u8bbe\u5907\u9a71\u52a8\u662f/dev/binder\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\uff0c\u5b83\u7684\u5b9e\u73b0\u539f\u7406\u662f\u901a\u8fc7\u5185\u6838\u4e2d\u7684\u4e00\u4e2a\u94fe\u8868\u6765\u7ba1\u7406\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u5411\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u53d1\u9001\u6570\u636e\u65f6\uff0c\u5b83\u4f1a\u5728\u94fe\u8868\u4e2d\u521b\u5efa\u4e00\u4e2abinder_node\u7ed3\u6784\uff0c\u5f53\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u63a5\u6536\u5230\u6570\u636e\u65f6\uff0c\u5b83\u4f1a\u5728\u94fe\u8868\u4e2d\u521b\u5efa\u4e00\u4e2abinder_proc\u7ed3\u6784\uff0c\u5f53\u4e24\u4e2a\u8fdb\u7a0b\u7684\u901a\u4fe1\u7ed3\u675f\u65f6\uff0c\u5b83\u4eec\u4f1a\u5728\u94fe\u8868\u4e2d\u5220\u9664\u5bf9\u5e94\u7684binder_node\u548cbinder_proc\u7ed3\u6784\u3002</li> </ul> <p>Binder\u6846\u67b6\u4e2dServiceManager\u7684\u4f5c\u7528</p> \u56de\u7b54 <ul> <li>ServiceManager\u662f\u4e00\u4e2a\u5355\u4f8b\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u7ba1\u7406\u5404\u79cdManager\u548cManagerService\uff0c\u5b83\u7684\u5b9e\u73b0\u662f\u4e00\u4e2aHashMap\uff0ckey\u662fManager\u7684\u540d\u5b57\uff0cvalue\u662fManagerService\u7684Binder\u5bf9\u8c61\uff0c\u5f53\u5ba2\u6237\u7aef\u9700\u8981\u83b7\u53d6\u67d0\u4e2aManagerService\u7684\u65f6\u5019\uff0c\u5c31\u901a\u8fc7ServiceManager\u7684getService\u65b9\u6cd5\u83b7\u53d6\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5b9e\u73b0\u5c31\u662f\u4eceHashMap\u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684Binder\u5bf9\u8c61\uff0c\u7136\u540e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ul> <p>\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528Binder</p> \u56de\u7b54 <ul> <li>\u6027\u80fd\u65b9\u9762</li> </ul> <p>\u5728\u79fb\u52a8\u8bbe\u5907\u4e0a\uff08\u6027\u80fd\u53d7\u9650\u5236\u7684\u8bbe\u5907\uff0c\u6bd4\u5982\u8981\u7701\u7535\uff09\uff0c\u5e7f\u6cdb\u5730\u4f7f\u7528\u8de8\u8fdb\u7a0b\u901a\u4fe1\u5bf9\u901a\u4fe1\u673a\u5236\u7684\u6027\u80fd\u6709\u4e25\u683c\u7684\u8981\u6c42\uff0cBinder\u76f8\u5bf9\u51fa\u4f20\u7edf\u7684Socket\u65b9\u5f0f\uff0c\u66f4\u52a0\u9ad8\u6548\u3002Binder\u6570\u636e\u62f7\u8d1d\u53ea\u9700\u8981\u4e00\u6b21\uff0c\u800c\u7ba1\u9053\u3001\u6d88\u606f\u961f\u5217\u3001Socket\u90fd\u9700\u89812\u6b21\uff0c\u5171\u4eab\u5185\u5b58\u65b9\u5f0f\u4e00\u6b21\u5185\u5b58\u62f7\u8d1d\u90fd\u4e0d\u9700\u8981\uff0c\u4f46\u5b9e\u73b0\u65b9\u5f0f\u53c8\u6bd4\u8f83\u590d\u6742\u3002</p> <ul> <li>\u5b89\u5168\u65b9\u9762</li> </ul> <p>\u4f20\u7edf\u7684\u8fdb\u7a0b\u901a\u4fe1\u65b9\u5f0f\u5bf9\u4e8e\u901a\u4fe1\u53cc\u65b9\u7684\u8eab\u4efd\u5e76\u6ca1\u6709\u505a\u51fa\u4e25\u683c\u7684\u9a8c\u8bc1\uff0c\u6bd4\u5982Socket\u901a\u4fe1ip\u5730\u5740\u662f\u5ba2\u6237\u7aef\u624b\u52a8\u586b\u5165\uff0c\u5f88\u5bb9\u6613\u8fdb\u884c\u4f2a\u9020\uff0c\u800cBinder\u673a\u5236\u4ece\u534f\u8bae\u672c\u8eab\u5c31\u652f\u6301\u5bf9\u901a\u4fe1\u53cc\u65b9\u505a\u8eab\u4efd\u6821\u68c0\uff0c\u56e0\u800c\u5927\u5927\u63d0\u5347\u4e86\u5b89\u5168\u6027\u3002</p> <ul> <li>\u8fd8\u6709\u4e00\u4e9b\u597d\u5904\uff0c\u5982\u5b9e\u73b0\u9762\u8c61\u5bf9\u8c61\u7684\u8c03\u7528\u65b9\u5f0f\uff0c\u5728\u4f7f\u7528Binder\u65f6\u5c31\u548c\u8c03\u7528\u4e00\u4e2a\u672c\u5730\u5b9e\u4f8b\u4e00\u6837\u3002</li> </ul> <p>Binder\u4e2d\u662f\u5982\u4f55\u8fdb\u884c\u7ebf\u7a0b\u7ba1\u7406\u7684</p> \u56de\u7b54 <ul> <li> <p>\u6bcf\u4e2aBinder\u7684Server\u8fdb\u7a0b\u4f1a\u521b\u5efa\u5f88\u591a\u7ebf\u7a0b\u6765\u5904\u7406Binder\u8bf7\u6c42\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\u521b\u5efa\u4e86\u4e00\u4e2aBinder\u7684\u7ebf\u7a0b\u6c60\u5427\uff08\u867d\u7136\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5b8c\u5168\u662f\u8fd9\u6837\u7b80\u5355\u7684\u7ebf\u7a0b\u7ba1\u7406\u65b9\u5f0f\uff09\uff0c\u800c\u771f\u6b63\u7ba1\u7406\u8fd9\u4e9b\u7ebf\u7a0b\u5e76\u4e0d\u662f\u7531\u8fd9\u4e2aServer\u7aef\u6765\u7ba1\u7406\u7684\uff0c\u800c\u662f\u7531Binder\u9a71\u52a8\u8fdb\u884c\u7ba1\u7406\u7684\u3002</p> </li> <li> <p>\u4e00\u4e2a\u8fdb\u7a0b\u7684Binder\u7ebf\u7a0b\u6570\u9ed8\u8ba4\u6700\u5927\u662f16\uff0c\u8d85\u8fc7\u7684\u8bf7\u6c42\u4f1a\u88ab\u963b\u585e\u7b49\u5f85\u7a7a\u95f2\u7684Binder\u7ebf\u7a0b\u3002\u7406\u89e3\u8fd9\u4e00\u70b9\u7684\u8bdd\uff0c\u4f60\u505a\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65f6\u5904\u7406\u5e76\u53d1\u95ee\u9898\u5c31\u4f1a\u6709\u4e00\u4e2a\u5e95\uff0c\u6bd4\u5982\u4f7f\u7528ContentProvider\u65f6\uff08\u53c8\u4e00\u4e2a\u4f7f\u7528Binder\u673a\u5236\u7684\u7ec4\u4ef6\uff09\uff0c\u4f60\u5c31\u5f88\u6e05\u695a\u5b83\u7684CRUD\uff08\u521b\u5efa\u3001\u68c0\u7d22\u3001\u66f4\u65b0\u548c\u5220\u9664\uff09\u65b9\u6cd5\u53ea\u80fd\u540c\u65f6\u670916\u4e2a\u7ebf\u7a0b\u5728\u8dd1\u3002</p> </li> </ul> <p>binder \u4e00\u6b21\u62f7\u8d1d\u539f\u7406</p> \u56de\u7b54 <ul> <li>\u4e00\u6b21\u62f7\u8d1d\u7684\u539f\u7406\u662f\u901a\u8fc7Binder\u9a71\u52a8\u7684mmap\u5b9e\u73b0\u7684\uff0c\u5f53\u5ba2\u6237\u7aef\u8c03\u7528\u670d\u52a1\u7aef\u7684\u65b9\u6cd5\u65f6\uff0c\u670d\u52a1\u7aef\u4f1a\u5c06\u6570\u636e\u62f7\u8d1d\u5230Binder\u9a71\u52a8\u7684\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u901a\u8fc7Binder\u9a71\u52a8\u7684mmap\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u81ea\u5df1\u7684\u5185\u5b58\u4e2d\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u4e00\u6b21\u62f7\u8d1d\u3002</li> </ul> <p>aidl\u5b9e\u73b0\u539f\u7406</p> \u56de\u7b54 <ul> <li>aidl\u662f\u4e00\u4e2a\u5de5\u5177\uff0c\u5b83\u4f1a\u6839\u636e\u4f60\u5b9a\u4e49\u7684\u63a5\u53e3\u751f\u6210\u4e00\u4e2aJava\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u4f60\u5b9a\u4e49\u7684\u63a5\u53e3\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u7c7b\u4e2d\u5b9e\u73b0\u4e86\u4e00\u4e2atransact\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u662f\u771f\u6b63\u7684\u8de8\u8fdb\u7a0b\u901a\u4fe1\u65b9\u6cd5\uff0c\u5b83\u4f1a\u5c06\u4f60\u4f20\u5165\u7684\u53c2\u6570\u6253\u5305\u6210\u4e00\u4e2aParcel\u5bf9\u8c61\uff0c\u7136\u540e\u8c03\u7528Binder\u9a71\u52a8\u7684transact\u65b9\u6cd5\uff0c\u5c06\u8fd9\u4e2aParcel\u5bf9\u8c61\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u518d\u5c06\u8fd9\u4e2aParcel\u5bf9\u8c61\u89e3\u6790\u51fa\u6765\uff0c\u7136\u540e\u8c03\u7528\u4f60\u5b9a\u4e49\u7684\u65b9\u6cd5\uff0c\u6700\u540e\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ul> <p>\u8c08\u8c08\u6d88\u606f\u673a\u5236Hander</p> \u56de\u7b54 <ul> <li>\u4f5c\u7528\uff1a</li> </ul> <p>\u8de8\u7ebf\u7a0b\u901a\u4fe1\u3002\u5f53\u5b50\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u8017\u65f6\u64cd\u4f5c\u540e\u9700\u8981\u66f4\u65b0UI\u65f6\uff0c\u901a\u8fc7Handler\u5c06\u6709\u5173UI\u7684\u64cd\u4f5c\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002</p> <ul> <li>\u56db\u8981\u7d20\uff1a</li> </ul> <p>Message\uff08\u6d88\u606f\uff09\uff1a\u9700\u8981\u88ab\u4f20\u9012\u7684\u6d88\u606f\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u6d88\u606fID\uff0c\u6d88\u606f\u5904\u7406\u5bf9\u8c61\u4ee5\u53ca\u5904\u7406\u7684\u6570\u636e\u7b49\uff0c\u7531MessageQueue\u7edf\u4e00\u5217\u961f\uff0c\u6700\u7ec8\u7531Handler\u5904\u7406\u3002</p> <p>MessageQueue\uff08\u6d88\u606f\u961f\u5217\uff09\uff1a\u7528\u6765\u5b58\u653eHandler\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\uff0c\u5185\u90e8\u901a\u8fc7\u5355\u94fe\u8868\u7684\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u62a4\u6d88\u606f\u5217\u8868\uff0c\u7b49\u5f85Looper\u7684\u62bd\u53d6\u3002</p> <p>Handler\uff08\u5904\u7406\u8005\uff09\uff1a\u8d1f\u8d23Message\u7684\u53d1\u9001\u53ca\u5904\u7406\u3002\u901a\u8fc7 Handler.sendMessage() \u5411\u6d88\u606f\u6c60\u53d1\u9001\u5404\u79cd\u6d88\u606f\u4e8b\u4ef6\uff1b\u901a\u8fc7 Handler.handleMessage() \u5904\u7406\u76f8\u5e94\u7684\u6d88\u606f\u4e8b\u4ef6\u3002</p> <p>Looper\uff08\u6d88\u606f\u6cf5\uff09\uff1a\u901a\u8fc7Looper.loop()\u4e0d\u65ad\u5730\u4eceMessageQueue\u4e2d\u62bd\u53d6Message\uff0c\u6309\u5206\u53d1\u673a\u5236\u5c06\u6d88\u606f\u5206\u53d1\u7ed9\u76ee\u6807\u5904\u7406\u8005\u3002</p> <ul> <li> <p>\u5177\u4f53\u6d41\u7a0b</p> <ul> <li> <p>Handler.sendMessage()\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u4f1a\u901a\u8fc7MessageQueue.enqueueMessage()\u5411MessageQueue\u4e2d\u6dfb\u52a0\u4e00\u6761\u6d88\u606f\uff1b</p> </li> <li> <p>\u901a\u8fc7Looper.loop()\u5f00\u542f\u5faa\u73af\u540e\uff0c\u4e0d\u65ad\u8f6e\u8be2\u8c03\u7528MessageQueue.next()\uff1b</p> </li> <li> <p>\u8c03\u7528\u76ee\u6807Handler.dispatchMessage()\u53bb\u4f20\u9012\u6d88\u606f\uff0c\u76ee\u6807Handler\u6536\u5230\u6d88\u606f\u540e\u8c03\u7528Handler.handlerMessage()\u5904\u7406\u6d88\u606f\u3002</p> </li> </ul> <p></p> </li> </ul> <p>\u4e00\u4e2a\u7ebf\u7a0b\u662f\u5426\u53ef\u4ee5\u6709\u591a\u4e2aLooper\u3001\u591a\u4e2a\u4e2aMessageQueue\uff0c\u591a\u4e2aHandler\uff1f</p> \u56de\u7b54 <p>Android\u4e2d\u4e00\u4e2a\u7ebf\u7a0b\u6700\u591a\u4ec5\u4ec5\u80fd\u6709\u4e00\u4e2aLooper\uff0c\u82e5\u5728\u5df2\u6709Looper\u7684\u7ebf\u7a0b\u4e2d\u8c03\u7528Looper.prepare()\u4f1a\u629b\u51faRuntimeException(\u201cOnly one Looper may be created per thread\u201d)\u3002 <pre><code>public static void prepare() {\nprepare(true);\n}\nprivate static void prepare(boolean quitAllowed) {\nif (sThreadLocal.get() != null) {\nthrow new RuntimeException(\"Only one Looper may be created per thread\");\n}\nsThreadLocal.set(new Looper(quitAllowed));\n}\n</code></pre> \u800c Looper\u6709\u4e00\u4e2aMessageQueue\uff0c\u4f46\u53ef\u4ee5\u5904\u7406\u6765\u81ea\u591a\u4e2aHandler\u7684Message\u3002 \u6240\u4ee5 \u4e00\u4e2a\u7ebf\u7a0b\u53ea\u6709\u4e00\u4e2aLooper\u3001\u53ea\u6709\u4e00\u4e2aMessageQueue\uff0c\u53ef\u4ee5\u6709\u591a\u4e2aHandler</p> <p>Looper.loop\u662f\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u62ff\u4e0d\u5230\u9700\u8981\u5904\u7406\u7684Message\u5c31\u4f1a\u963b\u585e\uff0c\u90a3\u5728UI\u7ebf\u7a0b\u4e2d\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u5bfc\u81f4ANR\uff1f</p> \u56de\u7b54 <p>\u56e0\u4e3aAndroid \u7684\u662f\u7531\u4e8b\u4ef6\u9a71\u52a8\u7684\uff0clooper.loop() \u4e0d\u65ad\u5730\u63a5\u6536\u4e8b\u4ef6\u3001\u5904\u7406\u4e8b\u4ef6\uff0c\u6bcf\u4e00\u4e2a\u70b9\u51fb\u89e6\u6478\u6216\u8005\u8bf4Activity\u7684\u751f\u547d\u5468\u671f\u90fd\u662f\u8fd0\u884c\u5728 Looper.loop() \u7684\u63a7\u5236\u4e4b\u4e0b\uff0c\u5982\u679c\u5b83\u505c\u6b62\u4e86\uff0c\u5e94\u7528\u4e5f\u5c31\u505c\u6b62\u4e86\u3002\u53ea\u80fd\u662f\u67d0\u4e00\u4e2a\u6d88\u606f\u6216\u8005\u8bf4\u5bf9\u6d88\u606f\u7684\u5904\u7406\u963b\u585e\u4e86 Looper.loop()\uff0c\u800c\u4e0d\u662f Looper.loop() \u963b\u585e\u5b83\u3002</p> <p>Looper.loop\u662f\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u6d88\u8017\u6027\u80fd\u5417</p> \u56de\u7b54 <p>\u4e3b\u7ebf\u7a0bLooper\u4ece\u6d88\u606f\u961f\u5217\u8bfb\u53d6\u6d88\u606f\uff0c\u5f53\u8bfb\u5b8c\u6240\u6709\u6d88\u606f\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u963b\u585e\u3002\u5b50\u7ebf\u7a0b\u5f80\u6d88\u606f\u961f\u5217\u53d1\u9001\u6d88\u606f\uff0c\u5e76\u4e14\u5f80\u7ba1\u9053\u6587\u4ef6\u5199\u6570\u636e\uff0c\u4e3b\u7ebf\u7a0b\u5373\u88ab\u5524\u9192\uff0c\u4ece\u7ba1\u9053\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\uff0c\u4e3b\u7ebf\u7a0b\u88ab\u5524\u9192\u53ea\u662f\u4e3a\u4e86\u8bfb\u53d6\u6d88\u606f\uff0c\u5f53\u6d88\u606f\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u518d\u6b21\u7761\u7720\u3002\u56e0\u6b64loop\u7684\u5faa\u73af\u5e76\u4e0d\u4f1a\u5bf9CPU\u6027\u80fd\u6709\u8fc7\u591a\u7684\u6d88\u8017\u3002</p> <p>Handler \u5982\u4f55\u907f\u514d\u5185\u5b58\u6cc4\u6f0f</p> \u56de\u7b54 <p>Handler\u9020\u6210\u5185\u5b58\u6cc4\u9732\u7684\u539f\u56e0\uff1a\u975e\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u6216\u8005\u533f\u540d\u5185\u90e8\u7c7b\uff0c\u4f7f\u5f97Handler\u9ed8\u8ba4\u6301\u6709\u5916\u90e8\u7c7b\u7684\u5f15\u7528\u3002\u5728Activity\u9500\u6bc1\u65f6\uff0c\u7531\u4e8eHandler\u53ef\u80fd\u6709\u672a\u6267\u884c\u5b8c/\u6b63\u5728\u6267\u884c\u7684Message\u3002\u5bfc\u81f4Handler\u6301\u6709Activity\u7684\u5f15\u7528\u3002\u8fdb\u800c\u5bfc\u81f4GC\u65e0\u6cd5\u56de\u6536Activity\u3002</p> <ul> <li> <p>\u89e3\u51b3\u65b9\u6cd5</p> <ol> <li> <p>Activity\u9500\u6bc1\u65f6\uff0c\u6e05\u7a7aHandler\u4e2d\uff0c\u672a\u6267\u884c\u6216\u6b63\u5728\u6267\u884c\u7684Callback\u4ee5\u53caMessage\u3002 <pre><code>    // \u6e05\u7a7a\u6d88\u606f\u961f\u5217\uff0c\u79fb\u9664\u5bf9\u5916\u90e8\u7c7b\u7684\u5f15\u7528\n@Override\nprotected void onDestroy() {\nsuper.onDestroy();\nmHandler.removeCallbacksAndMessages(null);\n}\n</code></pre></p> </li> <li> <p>\u9759\u6001\u5185\u90e8\u7c7b+\u5f31\u5f15\u7528 <pre><code>private static class AppHandler extends Handler {\n//\u5f31\u5f15\u7528\uff0c\u5728\u5783\u573e\u56de\u6536\u65f6\uff0c\u88ab\u56de\u6536\nWeakReference&lt;Activity&gt; activity;\nAppHandler(Activity activity){\nthis.activity=new WeakReference&lt;Activity&gt;(activity);\n}\npublic void handleMessage(Message message){\nswitch (message.what){\n//todo\n}\n}\n} </code></pre></p> </li> </ol> </li> </ul> <p>\u4e3b\u7ebf\u7a0b Looper \u4ec0\u4e48\u65f6\u5019\u9000\u51fa\u5faa\u73af</p> \u56de\u7b54 <p>\u5f53 ActivityThread \u5185\u90e8\u7684 Handler \u6536\u5230\u4e86 EXIT_APPLICATION \u6d88\u606f\u540e\uff0c\u5c31\u4f1a\u9000\u51fa Looper \u5faa\u73af</p> <pre><code>public void handleMessage(Message msg) {\nswitch (msg.what) {\ncase EXIT_APPLICATION:\nif (mInitialApplication != null) {\nmInitialApplication.onTerminate();\n}\nLooper.myLooper().quit();\nbreak;\n}\n}\n</code></pre>"},{"location":"interview/android_components/","title":"Android \u56db\u5927\u7ec4\u4ef6","text":""},{"location":"interview/android_components/#context","title":"Context","text":"<p>\u8bf4\u8bf4\u5bf9Context\u7684\u7406\u89e3</p> \u56de\u7b54 <ul> <li>Context\u662f\u4ec0\u4e48 Context\u662f\u4e00\u4e2a\u62bd\u8c61\u57fa\u7c7b\u3002\u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f\u4e0a\u4e0b\u6587\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\u73af\u5883\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u5728\u67d0\u4e00\u4e2a\u573a\u666f\u4e2d\u672c\u8eab\u6240\u5305\u542b\u7684\u4e00\u4e9b\u6f5c\u5728\u4fe1\u606f\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u83b7\u53d6\u7a0b\u5e8f\u8fd0\u884c\u7684\u4e00\u4e9b\u73af\u5883\u57fa\u7840\u4fe1\u606f\u3002</li> <li>Context\u7c7b\u56fe\u5173\u7cfb  Context\u4e0b\u6709\u4e24\u4e2a\u5b50\u7c7b\uff0c<code>ContextWrapper</code>\u662f\u4e0a\u4e0b\u6587\u529f\u80fd\u7684\u5c01\u88c5\u7c7b\uff0c\u800c<code>ContextImpl</code>\u5219\u662f\u4e0a\u4e0b\u6587\u529f\u80fd\u7684\u5b9e\u73b0\u7c7b\u3002ContextWrapper\u53c8\u6709\u4e09\u4e2a\u76f4\u63a5\u7684\u5b50\u7c7b\uff0c<code>ContextThemeWrapper</code>\u3001<code>Service</code>\u548c<code>Application</code>\u3002\u5176\u4e2d\uff0c<code>ContextThemeWrapper</code>\u662f\u4e00\u4e2a\u5e26\u4e3b\u9898\u7684\u5c01\u88c5\u7c7b\uff0c\u800c\u5b83\u6709\u4e00\u4e2a\u76f4\u63a5\u5b50\u7c7b\u5c31\u662f<code>Activity</code>.\u7c7b\u56fe\u5982\u4e0b <pre><code>classDiagram\n  Context &lt;|-- ContextWrapper\n  Context &lt;|-- ContextImpl\n  ContextWrapper &lt;|-- Application\n  ContextWrapper &lt;|-- Service\n  ContextWrapper &lt;|-- ContextThemeWrapper\n ContextThemeWrapper &lt;|-- Activity\n class ContextWrapper{\n    ~mBase Context\n    ~attachBaseContext()\n    +getBaseContext()\n }\n  class Application{\n    +LoadedApk: LoadedApk\n    ~attach()\n }\n  class Service{\n    -mApplication: Application\n    ~attach()\n    +getApplication()\n  }\n\n class ContextThemeWrapper{\n    -mTheme:Resources.Theme\n    ~attachBaseContext()\n }\n  class Activity{\n    -mApplication: Application\n    ~attach()\n    +getApplication()\n  }\n  class ContextImpl{\n    ~mMainThread ActivityThead\n    +getApplicationContext()\n  }\n  class Context{\n    +getApplicationInfo()\n    +getApplicationContext()\n  }</code></pre></li> <li>Context\u4f7f\u7528\u7279\u6b8a\u573a\u666f \u5728\u7edd\u5927\u591a\u6570\u573a\u666f\u4e0b\uff0cActivity\u3001Service\u548cApplication\u8fd9\u4e09\u79cd\u7c7b\u578b\u7684Context\u90fd\u662f\u53ef\u4ee5\u901a\u7528\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u5177\u4f53Context\u7684\u529f\u80fd\u5219\u662f\u7531<code>ContextImpl</code>\u7c7b\u53bb\u5b9e\u73b0\u7684\u3002\u4e0d\u8fc7\u6709\u51e0\u79cd\u573a\u666f\u6bd4\u8f83\u7279\u6b8a\uff1a<ul> <li>startActivity<ul> <li>\u5f53\u4e3a<code>Activity Context</code>\u5219\u53ef\u76f4\u63a5\u4f7f\u7528;</li> <li>\u5f53\u4e3a\u5176\u4ed6Context, \u5219\u5fc5\u987b\u5e26\u4e0a<code>FLAG_ACTIVITY_NEW_TASK</code> flags\u624d\u80fd\u4f7f\u7528;</li> </ul> </li> <li>Dialog\u5219\u5fc5\u987b\u5728\u4e00\u4e2aActivity\u4e0a\u9762\u5f39\u51fa\uff08\u9664\u975e\u662f\u7cfb\u7edf\u7ea7\u522b\u5410\u53f8\uff09</li> <li>\u5728<code>Receiver #onReceive</code>\u51fd\u6570\u4e2d\u53d6\u5f97\u7684Context\u4e0d\u5141\u8bb8\u6267\u884c<code>bindService()</code>\u64cd\u4f5c,\u56e0\u4e3a\u5176\u5b9e\u9645\u4e3aReceiverRestrictedContext,\u5176\u5bf9<code>bindService</code>\u505a\u4e86\u9650\u5236\u3002</li> </ul> </li> <li><code>getApplication()</code>\u548c<code>getApplicationContext()</code>\u533a\u522b \u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b, <code>getApplication()</code>\u548c<code>getApplicationContext()</code>\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u5b8c\u5168\u4e00\u81f4, \u8fd4\u56de\u503c\u4e5f\u76f8\u540c; \u90a3\u4e48\u4e24\u8005\u5230\u5e95\u6709\u4ec0\u4e48\u533a\u522b\u5462? <ul> <li>\u5bf9\u4e8e<code>Activity/Service</code>\u6765\u8bf4, <code>getApplication()</code>\u548c<code>getApplicationContext()</code>\u7684\u8fd4\u56de\u503c\u5b8c\u5168\u76f8\u540c; \u9664\u975e\u5382\u5546\u4fee\u6539\u8fc7\u63a5\u53e3;</li> <li><code>BroadcastReceiver</code>\u5728<code>onReceive</code>\u7684\u8fc7\u7a0b, \u80fd\u4f7f\u7528<code>getBaseContext().getApplicationContext</code>\u83b7\u53d6\u6240\u5728Application, \u800c\u65e0\u6cd5\u4f7f\u7528<code>getApplication</code>;</li> <li><code>ContentProvider</code>\u80fd\u4f7f\u7528<code>getContext().getApplicationContext()</code>\u83b7\u53d6\u6240\u5728Application. \u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6ca1\u6709\u95ee\u9898, \u4f46\u662f\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u7a7a\u6307\u9488\u7684\u95ee\u9898, \u60c5\u51b5\u5982\u4e0b:\u5f53\u540c\u4e00\u4e2a\u8fdb\u7a0b\u6709\u591a\u4e2aapk\u7684\u60c5\u51b5\u4e0b, \u5bf9\u4e8e\u7b2c\u4e8c\u4e2aapk\u662f\u7531provider\u65b9\u5f0f\u62c9\u8d77\u7684, \u524d\u9762\u4ecb\u7ecd\u8fc7provider\u521b\u5efa\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u521d\u59cb\u5316\u6240\u5728application, \u6b64\u65f6\u6267\u884c getContext().getApplicationContext()\u8fd4\u56de\u7684\u7ed3\u679c\u4fbf\u662fNULL. \u6240\u4ee5\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\u8981\u505a\u597d\u5224\u7a7a.\uff0c\u53c2\u89c1\u7406\u89e3Android Context</li> </ul> </li> </ul>"},{"location":"interview/android_components/#activity","title":"Activity\u76f8\u5173","text":"<p>\u8bf4\u4e0bActivity\u7684\u751f\u547d\u5468\u671f</p> \u56de\u7b54 <ul> <li>onCreate()\u8868\u793aActivity \u6b63\u5728\u521b\u5efa\uff0c\u5e38\u505a\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u5982setContentView\u754c\u9762\u8d44\u6e90\u3001\u521d\u59cb\u5316\u6570\u636e</li> <li>onStart()\u8868\u793aActivity \u6b63\u5728\u542f\u52a8\uff0c\u8fd9\u65f6Activity \u53ef\u89c1\u4f46\u4e0d\u5728\u524d\u53f0\uff0c\u65e0\u6cd5\u548c\u7528\u6237\u4ea4\u4e92\uff0c\u53ef\u4ee5\u505a\u4e00\u4e9b\u8d44\u6e90\u51c6\u5907\u5de5\u4f5c\uff0c\u5982\u5f00\u542f\u8f6e\u64ad\u56fe\u81ea\u52a8\u65e0\u9650\u8f6e\u64ad</li> <li>onResume()\u8868\u793aActivity \u83b7\u5f97\u7126\u70b9\uff0c\u6b64\u65f6Activity \u53ef\u89c1\u4e14\u5728\u524d\u53f0\u5e76\u5f00\u59cb\u6d3b\u52a8</li> <li>onPause()\u8868\u793aActivity \u6b63\u5728\u505c\u6b62\uff0c\u53ef\u505a \u6570\u636e\u5b58\u50a8\u3001\u505c\u6b62\u52a8\u753b\u7b49\u64cd\u4f5c</li> <li>onStop()\u8868\u793aactivity \u5373\u5c06\u505c\u6b62\uff0c\u53ef\u505a\u7a0d\u5fae\u91cd\u91cf\u7ea7\u56de\u6536\u5de5\u4f5c\uff0c\u5982\u53d6\u6d88\u7f51\u7edc\u8fde\u63a5\u3001\u6ce8\u9500\u5e7f\u64ad\u63a5\u6536\u5668\uff0c\u6682\u505c\u8f6e\u64ad\u56fe\u65e0\u9650\u8f6e\u64ad\u7b49</li> <li>onDestroy()\u8868\u793aActivity \u5373\u5c06\u9500\u6bc1\uff0c\u5e38\u505a\u56de\u6536\u5de5\u4f5c\u3001\u8d44\u6e90\u91ca\u653e</li> <li>onRestart()\u8868\u793a\u5f53Activity\u7531\u540e\u53f0\u5207\u6362\u5230\u524d\u53f0\uff0c\u7531\u4e0d\u53ef\u89c1\u5230\u53ef\u89c1\u65f6\u4f1a\u8c03\u7528\uff0c\u8868\u793aActivity \u91cd\u65b0\u542f\u52a8</li> </ul> <p>\u8bf4\u4e00\u4e0bonSaveInstanceState()\u548conRestoreInstanceState()</p> \u56de\u7b54 <ul> <li>Activity\u7684 onSaveInstanceState()\u548conRestoreInstanceState()\u5e76\u4e0d\u662f\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff0c\u5b83\u4eec\u4e0d\u540c\u4e8eonCreate()\u3001onPause()\u7b49\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff0c\u5b83\u4eec\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u88ab\u89e6\u53d1\u3002</li> <li>\u4ec0\u4e48\u65f6\u5019\u4f1a\u89e6\u53d1\u8d70\u8fd9\u4e24\u4e2a\u65b9\u6cd5\uff1f \u5f53\u5e94\u7528\u9047\u5230\u610f\u5916\u60c5\u51b5\uff08\u5982\uff1a\u5185\u5b58\u4e0d\u8db3\u3001\u7528\u6237\u76f4\u63a5\u6309Home\u952e\uff09\u7531\u7cfb\u7edf\u9500\u6bc1\u4e00\u4e2aActivity\uff0c<code>onSaveInstanceState()</code> \u4f1a\u88ab\u8c03\u7528\u3002\u4f46\u662f\u5f53\u7528\u6237\u4e3b\u52a8\u53bb\u9500\u6bc1\u4e00\u4e2aActivity\u65f6\uff0c\u4f8b\u5982\u5728\u5e94\u7528\u4e2d\u6309\u8fd4\u56de\u952e\uff0c<code>onSaveInstanceState()</code>\u5c31\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002\u901a\u5e38onSaveInstanceState()\u53ea\u9002\u5408\u7528\u4e8e\u4fdd\u5b58\u4e00\u4e9b\u4e34\u65f6\u6027\u7684\u72b6\u6001\uff0c\u800conPause()\u9002\u5408\u7528\u4e8e\u6570\u636e\u7684\u6301\u4e45\u5316\u4fdd\u5b58\u3002</li> <li>onSaveInstanceState()\u88ab\u6267\u884c\u7684\u573a\u666f\u6709\u54ea\u4e9b\uff1f</li> <li>\u957f\u6309HOME\u952e\uff0c\u9009\u62e9\u8fd0\u884c\u5176\u4ed6\u7684\u7a0b\u5e8f\u65f6</li> <li>\u9501\u5c4f\u65f6</li> <li>\u4eceactivity A\u4e2d\u542f\u52a8\u4e00\u4e2a\u65b0\u7684activity\u65f6</li> <li>\u5c4f\u5e55\u65b9\u5411\u5207\u6362\u65f6</li> <li>onRestoreInstanceState \u53ea\u6709\u5728activity\u88ab\u7cfb\u7edf\u56de\u6536\uff0c\u91cd\u65b0\u521b\u5efaactivity\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u88ab\u8c03\u7528(\u5982\u6a2a\u7ad6\u5c4f\u5207\u6362)\u3002 </li> <li>onCreat()\u548conRestoreInstanceState()\u6062\u590d\u6570\u636e\u533a\u522b</li> <li>\u56e0\u4e3aonSaveInstanceState \u4e0d\u4e00\u5b9a\u4f1a\u88ab\u8c03\u7528\uff0c\u6240\u4ee5onCreate()\u91cc\u7684Bundle\u53c2\u6570\u53ef\u80fd\u4e3a\u7a7a\uff0c\u5982\u679c\u4f7f\u7528onCreate()\u6765\u6062\u590d\u6570\u636e\uff0c\u4e00\u5b9a\u8981\u505a\u975e\u7a7a\u5224\u65ad\u3002\u800conRestoreInstanceState\u7684Bundle\u53c2\u6570\u4e00\u5b9a\u4e0d\u4f1a\u662f\u7a7a\u503c\uff0c\u56e0\u4e3a\u5b83\u53ea\u6709\u5728\u4e0a\u6b21activity\u88ab\u56de\u6536\u4e86\u624d\u4f1a\u8c03\u7528\u3002</li> <li>onRestoreInstanceState\u662f\u5728onStart()\u4e4b\u540e\u88ab\u8c03\u7528\u7684\u3002\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981onCreate()\u4e2d\u505a\u7684\u4e00\u4e9b\u521d\u59cb\u5316\u5b8c\u6210\u4e4b\u540e\u518d\u6062\u590d\u6570\u636e\uff0c\u7528onRestoreInstanceState\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002</li> </ul> <p>app\u5207\u6362\u5230\u540e\u53f0\uff0c\u5f53\u524dactivity\u4f1a\u8d70onDestory\u65b9\u6cd5\u5417\uff1f</p> \u56de\u7b54 <p>\u4e0d\u4f1a\u8d70onDestory\u65b9\u6cd5\uff0c\u4f1a\u5148\u540e\u8d70onPause\u548conStop\u65b9\u6cd5\u3002</p> <p>activity\u88ab\u7cfb\u7edf\u6740\u6b7b\uff0c\u662f\u5426\u8d70destory\u6d41\u7a0b\uff1f</p> \u56de\u7b54 <ul> <li>\u4e3b\u52a8\u6740\u6b7b(\u4ece\u6700\u8fd1\u4efb\u52a1\u5212\u6389) \u53ea\u4f1a\u8d70\u542f\u52a8Activity\u7684onDestroy\u7684\u751f\u547d\u5468\u671f\uff0c\u5176\u4ed6activity\u7684onDestroy\u4e0d\u4f1a\u56de\u8c03\u5230\uff08\u6d4b\u8bd5\u673a\u5668\uff1aNexus 6p\uff09 </li> <li>\u610f\u5916\u6740\u6b7b(\u7cfb\u7edf\u8d44\u6e90\u4e0d\u8db3\u3001\u5f3a\u5236\u505c\u6b62\uff09 \u5e94\u7528\u53ea\u6709\u5728\u8fdb\u7a0b\u5b58\u6d3b\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u6309\u7167\u6b63\u5e38\u7684\u751f\u547d\u5468\u671f\u8fdb\u884c\u6267\u884c\uff0c\u5982\u679c\u8fdb\u7a0b\u7a81\u7136\u88abkill\u6389\uff0c\u76f8\u5f53\u4e8eSystem.exit(0); \u8fdb\u7a0b\u88ab\u6740\u6b7b\uff0c\u6839\u672c\u4e0d\u4f1a\u8d70\uff08activity\uff0cfragment\uff09\u751f\u547d\u5468\u671f\u3002\u53ea\u6709\u5728\u8fdb\u7a0b\u4e0d\u88abkill\u6389\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u624d\u4f1a\u6267\u884condestory\uff08\uff09\u65b9\u6cd5</li> </ul> <p>\u8bf4\u4e0bActivity\u7684\u56db\u79cd\u542f\u52a8\u6a21\u5f0f\uff1f</p> \u56de\u7b54 <ul> <li>Activity\u7684\u56db\u79cd\u542f\u52a8\u6a21\u5f0f<ul> <li>standard\u6807\u51c6\u6a21\u5f0f\uff1a\u6bcf\u6b21\u542f\u52a8\u4e00\u4e2aActivity\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b9e\u4f8b</li> <li>singleTop\u6808\u9876\u590d\u7528\u6a21\u5f0f\uff1a\u5982\u679c\u65b0Activity\u5df2\u7ecf\u4f4d\u4e8e\u4efb\u52a1\u6808\u7684\u6808\u9876\uff0c\u5c31\u4e0d\u4f1a\u91cd\u65b0\u521b\u5efa\uff0c\u5e76\u56de\u8c03 onNewIntent(intent) \u65b9\u6cd5\uff1b\u4e3a\u9632\u6b62\u5feb\u901f\u70b9\u51fb\u65f6\u591a\u6b21startActivity\uff0c\u53ef\u4ee5\u5c06\u76ee\u6807Activity\u8bbe\u7f6e\u4e3asingleTop\uff0c\u5982APP\u63a5\u6536\u5230\u591a\u6761\u63a8\u9001\u6d88\u606f\uff0c\u70b9\u5f00\u4e0d\u540c\u6d88\u606f\uff0c\u5747\u7531\u540c\u4e00\u5b9e\u4f8b\u5c55\u793a\u3002</li> <li>singleTask\u6808\u5185\u590d\u7528\u6a21\u5f0f\uff1a\u53ea\u8981\u8be5Activity\u5728\u4e00\u4e2a\u4efb\u52a1\u6808\u4e2d\u5b58\u5728\uff0c\u90fd\u4e0d\u4f1a\u91cd\u65b0\u521b\u5efa\uff0c\u5e76\u56de\u8c03 onNewIntent(intent) \u65b9\u6cd5\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u7cfb\u7edf\u4f1a\u5148\u5bfb\u627e\u662f\u5426\u5b58\u5728\u9700\u8981\u7684\u6808\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u8be5\u6808\uff0c\u5c31\u521b\u5efa\u4e00\u4e2a\u4efb\u52a1\u6808\uff0c\u5e76\u628a\u8be5Activity\u653e\u8fdb\u53bb\uff1b\u5982\u679c\u5b58\u5728\uff0c\u5c31\u4f1a\u521b\u5efa\u5230\u5df2\u7ecf\u5b58\u5728\u7684\u6808\u4e2d\uff0c\u5e76\u4e14\u4f1aclearTop\uff0c\u5373\u4f1a\u628a\u6808\u9876\u6240\u6709Activity\u6e05\u9664\uff1b\u5e38\u7528\u4e8e\u4e3b\u9875\u548c\u767b\u9646\u9875\uff0c\u65e0\u8bba\u54ea\u79cd\u4e1a\u52a1\u573a\u666f\u4e0b\u518d\u6b21\u56de\u5230\u6b64\u9875\uff0c\u90fd\u4e0d\u5e94\u4fdd\u7559\u4e4b\u4e0aActivity\u3002\u4f46\u5f53\u6211\u4eec\u4e3b\u9875\u540c\u65f6\u4e5f\u662f\u542f\u52a8\u9875\u65f6\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u65e0\u8bba\u6211\u4eec\u6253\u5f00\u591a\u5c11\u9875\u9762\uff0c\u5e94\u7528\u8fdb\u5165\u540e\u53f0\u518d\u542f\u52a8\u4f1a\u76f4\u63a5\u56de\u5230\u4e3b\u9875\u3002\u8fd9\u79cd\u60c5\u51b5\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u9762\uff1a1.\u589e\u52a0\u95ea\u5c4f\u9875\u4f5c\u4e3a\u542f\u52a8\u9875\uff0c\u6865\u63a5\u5230\u4e3b\u9875\uff08\u5927\u90e8\u5206app\u505a\u6cd5\uff09\uff0c2.\u4e3b\u9875\u8bbe\u7f6e\u4e3aSingleTop\uff0c\u81ea\u884c\u5efa\u7acb\u6808\u7ba1\u7406\u7cfb\u7edf\uff08\u8fd9\u6837\u7684\u597d\u5904\u662f\u51cf\u5c11\u4e00\u4e2aActivity\uff0c\u63d0\u9ad8\u542f\u52a8\u901f\u5ea6</li> <li>singleInstance\u5355\u5b9e\u4f8b\u6a21\u5f0f\uff1a\u5177\u6709\u6b64\u6a21\u5f0f\u7684Activity\u53ea\u80fd\u5355\u72ec\u4f4d\u4e8e\u4e00\u4e2a\u4efb\u52a1\u6808\u4e2d\uff0c\u4e14\u6b64\u4efb\u52a1\u6808\u4e2d\u53ea\u6709\u552f\u4e00\u4e00\u4e2a\u5b9e\u4f8b\u3002\u5982APP\u7ecf\u5e38\u8c03\u7528\u7684\u62e8\u6253\u7535\u8bdd\u3001\u7cfb\u7edf\u901a\u8baf\u5f55\u3001\u5730\u56fe\u7c7bAPP \u7b49\u9875\u9762\uff0c\u4e0d\u540cAPP\u8c03\u7528\u6b64\u7c7bActivity \u65f6\uff0c\u9996\u6b21\u521b\u5efa\u5b9e\u4f8b\uff0c\u4e4b\u540e\u5176\u4ed6APP\u53ea\u80fd\u590d\u7528\u6b64\u5b9e\u4f8b\u3002</li> </ul> </li> </ul> <p>Activity\u4efb\u52a1\u6808\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f\u540c\u4e00\u7a0b\u5e8f\u4e0d\u540c\u7684Activity\u662f\u5426\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684Task\u4efb\u52a1\u6808\u4e2d\uff1f</p> \u56de\u7b54 <ul> <li>\u4ec0\u4e48\u662fActivity Stack<ul> <li>Activity\u627f\u62c5\u4e86\u5927\u91cf\u7684\u663e\u793a\u548c\u4ea4\u4e92\u5de5\u4f5c\uff0c\u4ece\u67d0\u79cd\u89d2\u5ea6\u4e0a\u5c06\uff0c\u6211\u4eec\u770b\u89c1\u7684\u5e94\u7528\u7a0b\u5e8f\u5c31\u662f\u8bb8\u591a\u4e2aActivity\u7684\u7ec4\u5408\u3002\u4e3a\u4e86\u8ba9\u8fd9\u8bb8\u591a Activity\u534f\u540c\u5de5\u4f5c\u800c\u4e0d\u81f3\u4e8e\u4ea7\u751f\u6df7\u4e71\uff0cAndroid\u5e73\u53f0\u8bbe\u8ba1\u4e86\u4e00\u79cd\u5806\u6808\u673a\u5236\u7528\u4e8e\u7ba1\u7406Activity\uff0c\u5176\u9075\u5faa\u5148\u8fdb\u540e\u51fa\u7684\u539f\u5219\uff0c\u7cfb\u7edf\u603b\u662f\u663e\u793a\u4f4d\u4e8e\u6808 \u9876\u7684Activity </li> </ul> </li> <li>\u4ec0\u4e48\u662fTask<ul> <li>Task\u662f\u6307\u5c06\u76f8\u5173\u7684Activity\u7ec4\u5408\u5230\u4e00\u8d77\uff0c\u4ee5Activity Stack\u7684\u65b9\u5f0f\u8fdb\u884c\u7ba1\u7406\uff0cTask\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2aActivity\u6808\uff0c\u901a\u5e38\u7528\u6237\u611f\u53d7\u7684\u4e00\u4e2aApplication\u5c31\u662f\u4e00\u4e2aTask\uff0c\u4f46\u662f\u4ece\u6839\u672c\u4e0a\u8bb2\uff0c\u4e00\u4e2aTask\u662f\u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u591a\u4e2aAndroid Application\u7ec4\u6210\u7684\u3002\uff08\u5982\u62cd\u7167\u6d41\u7a0b\uff0c\u5148\u8df3\u8f6c\u5230\u76f8\u673a\u5e94\u7528Activity\uff0c\u5f53\u5b8c\u6210\u62cd\u7167\u529f\u80fd\u540e\u518d\u8fd4\u56de\u5f53\u524dActivity\u83b7\u53d6\u7ed3\u679c\uff0c\u8fd9\u662f\u4e00\u4e2a<code>task</code>\uff09\u3002</li> </ul> </li> <li>\u540c\u4e00\u7a0b\u5e8f\u4e0d\u540c\u7684Activity\u662f\u5426\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684Task\u4efb\u52a1\u6808\u4e2d\uff1f<ul> <li>\u53ef\u4ee5\u7684\u3002\u6bd4\u5982\uff1a\u542f\u52a8\u6a21\u5f0f\u91cc\u6709\u4e2aSingleinstance\uff0c\u53ef\u4ee5\u8fd0\u884c\u5728\u53e6\u5916\u7684\u5355\u72ec\u7684\u4efb\u52a1\u6808\u91cc\u9762\u3002\u7528\u8fd9\u4e2a\u6a21\u5f0f\u542f\u52a8\u7684activity\uff0c\u5728\u5185\u5b58\u4e2d\u53ea\u6709\u4e00\u4efd\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u91cd\u590d\u7684\u5f00\u542f\u3002</li> <li>\u4e5f\u53ef\u4ee5\u5728\u6fc0\u6d3b\u4e00\u4e2a\u65b0\u7684activity\u65f6\u5019,\u7ed9intent\u8bbe\u7f6eflag\uff0cIntent\u7684flag\u6dfb\u52a0<code>FLAG_ACTIVITY_NEW_TASK</code>\uff0c\u8fd9\u4e2a\u88ab\u6fc0\u6d3b\u7684activity\u5c31\u4f1a\u5728\u65b0\u7684task\u6808\u91cc\u9762</li> </ul> </li> </ul> <p>\u4e24\u4e2aActivity\u4e4b\u95f4\u600e\u4e48\u4f20\u9012\u6570\u636e\uff1fintent\u548cbundle\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u4e3a\u4ec0\u4e48\u6709\u4e86intent\u8fd8\u8981\u8bbe\u8ba1bundle\uff1f</p> \u56de\u7b54 <ul> <li>\u4e24\u4e2aActivity\u4e4b\u95f4\u600e\u4e48\u4f20\u9012\u6570\u636e\uff1f<ul> <li>\u57fa\u672c\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u901a\u8fc7Intent\u4f20\u9012\u6570\u636e</li> <li>\u628a\u6570\u636e\u5c01\u88c5\u81f3intent\u5bf9\u8c61\u4e2d <pre><code>Intent intent = new Intent(content, MeActivity.class);\nintent.putExtra(\"goods_id\", goods_id);\ncontent.startActivity(intent);\n</code></pre></li> <li>\u628a\u6570\u636e\u5c01\u88c5\u81f3bundle\u5bf9\u8c61\u4e2d</li> <li>\u628abundle\u5bf9\u8c61\u5c01\u88c5\u81f3intent\u5bf9\u8c61\u4e2d <pre><code>Bundle bundle = new Bundle();\nbundle.putString(\"malename\", \"\u674e\u5fd7\");\nintent.putExtras(bundle);\nstartActivity(intent); </code></pre></li> </ul> </li> <li>intent\u548cbundle\u6709\u4ec0\u4e48\u533a\u522b\uff1f<ul> <li>Intent\u4f20\u9012\u6570\u636e\u548cBundle\u4f20\u9012\u6570\u636e\u662f\u4e00\u56de\u4e8b\uff0cIntent\u4f20\u9012\u65f6\u5185\u90e8\u8fd8\u662f\u8c03\u7528\u4e86Bundle\u3002 <pre><code>public @NonNull Intent putExtra(String name, String value) {\nif (mExtras == null) {\nmExtras = new Bundle();\n}\nmExtras.putString(name, value);\nreturn this;\n}\n</code></pre></li> </ul> </li> <li>\u4e3a\u4ec0\u4e48\u6709\u4e86intent\u8fd8\u8981\u8bbe\u8ba1bundle\uff1f<ul> <li>Bundle\u53ea\u662f\u4e00\u4e2a\u4fe1\u606f\u7684\u8f7d\u4f53\uff0c\u5185\u90e8\u5176\u5b9e\u5c31\u662f\u7ef4\u62a4\u4e86\u4e00\u4e2aMap\u3002 <li>Intent\u867d\u7136\u5185\u90e8\u4e5f\u662f\u901a\u8fc7\u6301\u6709\u4e00\u4e2aBundle\u6765\u5b58\u50a8\u4fe1\u606f\u7684\uff0c\u4f46Intent\u4e00\u65b9\u9762\u4f5c\u4e3a\u4e00\u4e2a\u9ad8\u9891\u4f7f\u7528\u7684\u7ec4\u4ef6\uff0c\u66f4\u5173\u6ce8\u6613\u7528\u6027\uff0c\u63d0\u4f9b\u4e86\u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5cBundle\u7684\u7cfb\u5217\u51fd\u6570<code>putExtra(xxx)</code>\uff0c\u53e6\u4e00\u65b9\u9762Intent\u4f5c\u4e3a\u4e00\u4e2a\u6d88\u606f\u4f20\u9012\u5bf9\u8c61\uff0c\u8d1f\u8d23\u7ec4\u4ef6\u4e4b\u95f4\u7684\u6570\u636e\u901a\u4fe1\uff0c\u76f8\u5f53\u4e8e\u7ec4\u4ef6\u4e4b\u95f4\u7684\u534f\u8bae\uff0c\u6709\u5176\u7279\u6b8a\u7684\u201d\u534f\u8bae\u201c\u8bed\u8a00\uff0c\u5982\u53ef\u4ee5\u4f7f\u7528 <code>setComponent()\u3001setClass()\u3001setClassName()</code>\u8bbe\u7f6e\u8981\u542f\u52a8\u7684\u7ec4\u4ef6\u540d\u79f0\uff0c\u53e6\u5916\u8fd8\u6709<code>setAction()</code>\u3001<code>setData()</code>\u3001<code>setflags()</code>\u7b49</li>"},{"location":"interview/android_components/#service","title":"Service\u76f8\u5173","text":"<p> \u4ecb\u7ecd\u4e00\u4e0bService\uff0c\u542f\u52a8Service\u6709\u51e0\u79cd\u65b9\u5f0f\uff0c\u751f\u547d\u5468\u671f\u662f\u600e\u6837\u7684\uff1f</p> \u56de\u7b54 <ul> <li>Service\u5206\u4e3a\u4e24\u79cd<ul> <li>\u672c\u5730\u670d\u52a1\uff0c\u5c5e\u4e8e\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u901a\u8fc7startService\u6765\u542f\u52a8\u6216\u8005\u901a\u8fc7bindService\u6765\u7ed1\u5b9a\u5e76\u4e14\u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61\u3002\u5982\u679c\u53ea\u662f\u60f3\u5f00\u4e2a\u670d\u52a1\u5728\u540e\u53f0\u8fd0\u884c\u7684\u8bdd\uff0c\u76f4\u63a5startService\u5373\u53ef\uff0c\u5982\u679c\u9700\u8981\u76f8\u4e92\u4e4b\u95f4\u8fdb\u884c\u4f20\u503c\u6216\u8005\u64cd\u4f5c\u7684\u8bdd\uff0c\u5c31\u5e94\u8be5\u901a\u8fc7bindService\u3002</li> <li>\u8fdc\u7a0b\u670d\u52a1\uff08\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\uff09\uff0c\u901a\u8fc7bindService\u6765\u7ed1\u5b9a\u5e76\u4e14\u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61\u3002</li> </ul> </li> <li>\u5bf9\u5e94\u7684\u751f\u547d\u5468\u671f\u5982\u4e0b\uff1a<ul> <li><code>context.startService()</code> -&gt; <code>onCreate()</code>-&gt; <code>onStartCommand()</code>-&gt;Service running----- \u8c03\u7528<code>context.stopService()</code> -&gt;<code>onDestroy()</code>-&gt;Service stop</li> <li><code>context.bindService()</code>-&gt;<code>onCreate()</code>-&gt;<code>onBind()</code>-&gt;Service running----\u8c03\u7528<code>context.unbindService</code>-&gt;<code>onUnbind()</code> -&gt; <code>onDestroy()</code>-&gt;Service stop</li> </ul> </li> <li>Service\u751f\u547d\u5468\u671f\u89e3\u91ca<ul> <li>onCreate\uff08\uff09\uff1a\u670d\u52a1\u7b2c\u4e00\u6b21\u88ab\u521b\u5efa\u65f6\u8c03\u7528</li> <li>onStartComand\uff08\uff09\uff1a\u670d\u52a1\u542f\u52a8\u65f6\u8c03\u7528</li> <li>onBind\uff08\uff09\uff1a\u670d\u52a1\u88ab\u7ed1\u5b9a\u65f6\u8c03\u7528</li> <li>onUnBind\uff08\uff09\uff1a\u670d\u52a1\u88ab\u89e3\u7ed1\u65f6\u8c03\u7528</li> <li>onDestroy\uff08\uff09\uff1a\u670d\u52a1\u505c\u6b62\u65f6\u8c03\u7528</li> </ul> </li> </ul> <p>service\u5982\u4f55\u6740\u4e0d\u6b7b?</p> \u56de\u7b54 <ul> <li>onStartCommand\u65b9\u6cd5\uff0c\u8fd4\u56deSTART_STICKY\uff08\u7c98\u6027\uff09\u5f53service\u56e0\u5185\u5b58\u4e0d\u8db3\u88abkill\uff0c\u5f53\u5185\u5b58\u53c8\u6709\u7684\u65f6\u5019\uff0cservice\u53c8\u88ab\u91cd\u65b0\u521b\u5efa</li> <li>\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff0c\u5728\u670d\u52a1\u91cc\u7684ondestory\u91cc\u53d1\u9001\u5e7f\u64ad \u5728\u5e7f\u64ad\u91cc\u518d\u6b21\u5f00\u542f\u8fd9\u4e2a\u670d\u52a1,\u53cc\u8fdb\u7a0b\u5b88\u62a4     </li> </ul> <p>\u5148start\u540ebind\u64cd\u4f5cservice\uff0c\u6b64\u65f6\u5982\u4f55\u505a\u624d\u80fd\u56de\u8c03Service\u7684destory()\u65b9\u6cd5</p> \u56de\u7b54 <p>\u4e00\u4e2a\u670d\u52a1\u53ea\u8981\u88ab\u542f\u52a8\u6216\u8005\u88ab\u7ed1\u5b9a\u4e86\u4e4b\u540e\uff0c\u5c31\u4f1a\u4e00\u76f4\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\uff0c\u5fc5\u987b\u8981\u8ba9\u4ee5\u4e0a\u4e24\u79cd\u6761\u4ef6\u540c\u65f6\u4e0d\u6ee1\u8db3\uff0c\u670d\u52a1\u624d\u80fd\u88ab\u9500\u6bc1\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8981\u540c\u65f6\u8c03\u7528<code>stopService()</code>\u548c<code>unbindService()</code>\u65b9\u6cd5\uff0conDestroy()\u65b9\u6cd5\u624d\u4f1a\u6267\u884c  </p> <p>\u662f\u5426\u80fd\u5728Service\u8fdb\u884c\u8017\u65f6\u64cd\u4f5c?</p> \u56de\u7b54 <ul> <li>\u9ed8\u8ba4\u60c5\u51b5,\u5982\u679c\u6ca1\u6709\u663e\u793a\u7684\u6307\u5b9aservice\u6240\u8fd0\u884c\u7684\u8fdb\u7a0b,Service\u548cActivity\u662f\u8fd0\u884c\u5728\u5f53\u524dapp\u6240\u5728\u8fdb\u7a0b\u7684mainThread(UI\u4e3b\u7ebf\u7a0b)\u91cc\u9762\u3002</li> <li>service\u91cc\u9762\u4e0d\u80fd\u6267\u884c\u8017\u65f6\u7684\u64cd\u4f5c(\u7f51\u7edc\u8bf7\u6c42,\u62f7\u8d1d\u6570\u636e\u5e93,\u5927\u6587\u4ef6)\uff0c\u5728Service\u91cc\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u4e3b\u7ebf\u7a0b\u88ab\u963b\u585e\uff08ANR\uff09\u7684\u60c5\u51b5  </li> </ul>"},{"location":"interview/android_components/#broadcastreceiver","title":"BroadcastReceiver\u76f8\u5173","text":"<p>\u5e7f\u64ad\u6709\u54ea\u4e9b\u6ce8\u518c\u65b9\u5f0f\uff1f\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> \u56de\u7b54 <ul> <li>\u9759\u6001\u6ce8\u518c\uff1a\u5e38\u9a7b\u7cfb\u7edf\uff0c\u4e0d\u53d7\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u5f71\u54cd\uff0c\u5373\u4fbf\u5e94\u7528\u9000\u51fa\uff0c\u5e7f\u64ad\u8fd8\u662f\u53ef\u4ee5\u88ab\u63a5\u6536\uff0c\u8017\u7535\u3001\u5360\u5185\u5b58\u3002</li> <li>\u52a8\u6001\u6ce8\u518c\uff1a\u975e\u5e38\u9a7b\uff0c\u8ddf\u968f\u7ec4\u4ef6\u7684\u751f\u547d\u53d8\u5316\uff0c\u7ec4\u4ef6\u7ed3\u675f\uff0c\u5e7f\u64ad\u7ed3\u675f\u3002\u5728\u7ec4\u4ef6\u7ed3\u675f\u524d\uff0c\u9700\u8981\u5148\u79fb\u9664\u5e7f\u64ad\uff0c\u5426\u5219\u5bb9\u6613\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\u3002</li> </ul> <p>\u5e7f\u64ad\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879</p> \u56de\u7b54 <ul> <li>BroadCastReceiver \u7684\u751f\u547d\u5468\u671f\u5f88\u77ed\u6682\uff0c\u5f53\u63a5\u6536\u5230\u5e7f\u64ad\u7684\u65f6\u5019\u521b\u5efa\uff0c\u5f53onReceive()\u65b9\u6cd5\u7ed3\u675f\u540e\u9500\u6bc1</li> <li>\u56e0\u4e3aBroadCastReceiver\u7684\u58f0\u660e\u5468\u671f\u5f88\u77ed\u6682\uff0c\u6240\u4ee5\u4e0d\u8981\u5728\u5e7f\u64ad\u63a5\u6536\u5668\u4e2d\u53bb\u521b\u5efa\u5b50\u7ebf\u7a0b\u505a\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5e7f\u64ad\u63a5\u53d7\u8005\u88ab\u9500\u6bc1\u540e\uff0c\u8fd9\u4e2a\u5b50\u8fdb\u7a0b\u5c31\u4f1a\u6210\u4e3a\u7a7a\u8fdb\u7a0b\uff0c\u5f88\u5bb9\u6613\u88ab\u6740\u6b7b</li> <li>BroadCastReceiver\u662f\u8fd0\u884c\u5728\u4e3b\u7ebf\u7a0b\u7684\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u5728BroadCastReceiver\u4e2d\u53bb\u505a\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u5426\u5219\u5c31\u4f1a\u51fa\u73b0ANR\u5f02\u5e38 </li> </ul>"},{"location":"interview/android_components/#contentprovider","title":"ContentProvider\u76f8\u5173","text":"<p>Android \u8bbe\u8ba1 ContentProvider \u7684\u76ee\u7684\u662f\u4ec0\u4e48\u5462\uff1f</p> \u56de\u7b54 <ul> <li>\u9690\u85cf\u6570\u636e\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5bf9\u5916\u63d0\u4f9b\u7edf\u4e00\u7684\u6570\u636e\u8bbf\u95ee\u63a5\u53e3\uff1b</li> <li>\u66f4\u597d\u7684\u6570\u636e\u8bbf\u95ee\u6743\u9650\u7ba1\u7406\u3002ContentProvider \u53ef\u4ee5\u5bf9\u5f00\u53d1\u7684\u6570\u636e\u8fdb\u884c\u6743\u9650\u8bbe\u7f6e\uff0c\u4e0d\u540c\u7684 URI \u53ef\u4ee5\u5bf9\u5e94\u4e0d\u540c\u7684\u6743\u9650\uff0c\u53ea\u6709\u7b26\u5408\u6743\u9650\u8981\u6c42\u7684\u7ec4\u4ef6\u624d\u80fd\u8bbf\u95ee\u5230 ContentProvider \u7684\u5177\u4f53\u64cd\u4f5c\u3002</li> <li>ContentProvider \u5c01\u88c5\u4e86\u8de8\u8fdb\u7a0b\u5171\u4eab\u7684\u903b\u8f91\uff0c\u6211\u4eec\u53ea\u9700\u8981 Uri \u5373\u53ef\u8bbf\u95ee\u6570\u636e\u3002\u7531\u7cfb\u7edf\u6765\u7ba1\u7406 ContentProvider \u7684\u521b\u5efa\u3001\u751f\u547d\u5468\u671f\u53ca\u8bbf\u95ee\u7684\u7ebf\u7a0b\u5206\u914d\uff0c\u7b80\u5316\u6211\u4eec\u5728\u5e94\u7528\u95f4\u5171\u4eab\u6570\u636e\uff08 \u8fdb\u7a0b\u95f4\u901a\u4fe1 \uff09\u7684\u65b9\u5f0f\u3002\u6211\u4eec\u53ea\u7ba1\u901a\u8fc7 ContentResolver \u8bbf\u95ee ContentProvider \u6240\u63d0\u793a\u7684\u6570\u636e\u63a5\u53e3\uff0c\u800c\u4e0d\u9700\u8981\u62c5\u5fc3\u5b83\u6240\u5728\u8fdb\u7a0b\u662f\u542f\u52a8\u8fd8\u662f\u672a\u542f\u52a8\u3002</li> </ul> <p>\u8fd0\u884c\u5728\u4e3b\u7ebf\u7a0b\u7684 ContentProvider \u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u7684 UI \u64cd\u4f5c?</p> \u56de\u7b54 <ul> <li><code>ContentProvider</code> \u7684 <code>onCreate()</code> \u662f\u8fd0\u884c\u5728 <code>UI</code> \u7ebf\u7a0b\u7684\uff0c\u800c <code>query()</code> \uff0c<code>insert()</code> \uff0c<code>delete()</code> \uff0c<code>update()</code> \u8bbf\u95ee\u5b9e\u8d28\u4e0a\u662f\u901a\u8fc7<code>Binder</code>\u65b9\u5f0f\u8c03\u7528\uff0c\u8fd0\u884c\u5728binder\u7ebf\u7a0b\u6c60\uff0c\u6240\u4ee5\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5e76\u4e0d\u4f1a\u963b\u585e <code>ContentProvider</code> \u6240\u5728\u8fdb\u7a0b\u7684\u4e3b\u7ebf\u7a0b\uff0c\u4f46\u53ef\u80fd\u4f1a\u963b\u585e\u8c03\u7528\u8005\u6240\u5728\u7684\u8fdb\u7a0b\u7684 <code>UI</code> \u7ebf\u7a0b\uff01\u6240\u4ee5\uff0c\u8c03\u7528 <code>ContentProvider</code> \u7684\u64cd\u4f5c\u4ecd\u7136\u8981\u653e\u5728\u5b50\u7ebf\u7a0b\u4e2d\u53bb\u505a\u3002    </li> </ul>"},{"location":"interview/android_event/","title":"Android \u4e8b\u4ef6\u76f8\u5173","text":"<p>\u7b80\u5355\u63cf\u8ff0\u8f93\u5165\u4e8b\u4ef6\u4f20\u9012\u7684\u7cfb\u7edf\u539f\u7406</p> \u56de\u7b54 <p></p> <ol> <li> <p><code>eventhub</code>\u6784\u5efa\u7684\u65f6\u5019\u4f1a\u904d\u5386\u6574\u4e2a<code>/dev/input</code>\u8def\u5f84\u4e0b\u7684fd\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230<code>epoll</code>\u4e2d\uff0c\u540c\u65f6\u8fd8\u4f1a\u76d1\u542c\u6b64\u8def\u5f84\u4e0b\u65b0\u7684\u8bbe\u5907\u7684\u521b\u5efa\u548c\u5378\u8f7d</p> </li> <li> <p>\u5f53driver\u5411\u7279\u5b9a\u63cf\u8ff0\u7b26\u5199\u5165\u4e8b\u4ef6\u540e\uff0c\u4f1a\u89e6\u53d1\u5524\u9192<code>epoll</code>\u8d77\u6765\u5de5\u4f5c\uff0c\u8fd9\u65f6\u5019<code>eventHub</code>\u901a\u8fc7<code>read</code>\u65b9\u6cd5\u4ece\u63cf\u8ff0\u7b26\u4e2d\u8bfb\u53d6\u539f\u59cb\u4e8b\u4ef6\uff0c\u7136\u540e\u901a\u8fc7\u7b80\u5355\u5c01\u88c5\u6210rawEvent\u5e76\u4f20\u9012\u7ed9<code>InputReader</code>\u3002</p> </li> <li> <p><code>InputReader</code>\u4e2d\u7684threadLoop\u4e2d\u4f1a\u8c03\u7528eventHub\u7684getEvents\u6765\u83b7\u53d6\u8f93\u5165\u4e8b\u4ef6\uff0c\u7136\u540e\u901a\u8fc7\u8c03\u7528<code>notifyxxx</code>\u65b9\u6cd5\u5c06\u4e8b\u4ef6\u4f20\u9012\u5230<code>InputDispater</code>\u5e76\u6700\u7ec8\u901a\u8fc7<code>notifyxxx</code>\u65b9\u6cd5\u4f20\u9012\u5230\u4e0a\u5c42</p> </li> <li> <p>\u5728<code>InputEventReceiver</code>\u4e2d\u7684<code>dispatchInputEvent</code>\u65b9\u6cd5\u4e2d\u4f1a\u8c03\u7528<code>onInputEvent</code>\u65b9\u6cd5\u8fdb\u884c\u4e8b\u4ef6\u7684\u5904\u7406,\u5177\u4f53\u5b9e\u73b0\u7c7b\u662f<code>ViewRootImpl#WindowInputEventReceiver</code>\uff0c\u5176\u5185\u90e8\u4f1a\u8c03\u7528<code>enqueueInputEvent</code>\u65b9\u6cd5\u5bf9\u4e8b\u4ef6\u8fdb\u884c\u5165\u961f</p> </li> <li> <p>\u5bf9\u4e8b\u4ef6\u8fdb\u4e00\u6b65\u5904\u7406\u4e4b\u540e\uff0c\u901a\u8fc7<code>mView#dispatchxxxEvent</code>\u5c06\u4e8b\u4ef6\u5206\u53d1\u5230<code>DecorView</code>\u4e2d, </p> </li> <li> <p><code>DecorView</code>\u901a\u8fc7Window.Callback#dispatchxxxEvent\u4f1a\u5c06\u4e8b\u4ef6\u4f20\u9012\u5230<code>Window.Callback</code>\uff08Activity\u6216\u8005Dialog\uff09\u91cc\uff0c</p> </li> <li> <p><code>Window.Callback</code>\uff08Activity\u6216\u8005Dialog\uff09\u901a\u8fc7<code>mDecor#superDispatchKeyEvent</code>\u65b9\u6cd5\u5c06\u4e8b\u91cd\u65b0\u4f20\u9012\u5230<code>DecorView</code>\u4e2d</p> </li> <li> <p><code>DecorView</code> \u76f4\u63a5\u8c03\u7528DecorView\u7684\u7236\u7c7b\u7684<code>dispatchKeyEvent</code>\u65b9\u6cd5\uff0c\u5c06\u4e8b\u4ef6\u4f20\u9012\u5230<code>ViewGroup</code>\u4e2d\uff0c \u5982\u679c\u4e8b\u4ef6\u6ca1\u6709\u88ab\u5904\u7406\u6389\u7684\u8bdd\uff0c\u5c31\u4f1a\u901a\u8fc7<code>ViewRootImpl</code>\u5c06\u5176\u4f5c\u4e3a<code>UnhandledEvent</code>\u8fdb\u884c\u5904\u7406\u3002</p> </li> <li> <p><code>ViewGroup</code>\u901a\u8fc7<code>dispatchxxxEvent</code>\u65b9\u6cd5\u5c06\u4e8b\u4ef6\u4f20\u9012\u5230<code>View</code>\u4e2d</p> </li> </ol> <p>\u7b80\u5355\u63cf\u8ff0\u6309\u952e\u4e8b\u4ef6\u6d3e\u53d1\u6d41\u7a0b</p> \u56de\u7b54 <ul> <li> <p>\u9996\u5148\u6309\u952e\u4e8b\u4ef6\u5c06\u901a\u8fc7<code>View.dispatchKeyEventPreIme()</code>\u6d3e\u53d1\u7ed9\u63a7\u4ef6\u6811\u3002\u6b64\u65f6\u5f00\u53d1\u8005\u53ef\u4ee5\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406\u7684\u573a\u6240\u662f<code>View.dispatchKeyEventPreIme()</code>\u6216<code>View.onKeyPreIme()</code>\u3002</p> </li> <li> <p>\u7136\u540e\u6309\u952e\u4e8b\u4ef6\u5c06\u901a\u8fc7<code>InputManager.dispatchKeyEvent()</code>\u6d3e\u53d1\u7ed9\u8f93\u5165\u6cd5\u3002\u6b64\u65f6\u5904\u7406\u4e8b\u4ef6\u7684\u573a\u6240\u662f\u5f53\u524d\u8f93\u5165\u6cd5\u6240\u5728\u7684<code>InputMethodService\u7684onKeyDown()/onKeyUp()</code>\u7b49\u7cfb\u5217\u56de\u8c03\u3002</p> </li> <li> <p>\u4e4b\u540e\u6309\u952e\u4e8b\u4ef6\u5c06\u88ab<code>View.checkForLeavingTouchModeAndConsume()</code>\u65b9\u6cd5\u7528\u6765\u5c1d\u8bd5\u9000\u51fa\u89e6\u6478\u6a21\u5f0f\u3002</p> </li> <li> <p>\u518d\u4e4b\u540e\u6309\u952e\u4e8b\u4ef6\u5c06\u88ab<code>View.dispatchKeyEvent()</code>\u5728\u6b64\u6d3e\u53d1\u7ed9\u63a7\u4ef6\u6811\u3002\u6b64\u65f6\u5f00\u53d1\u8005\u53ef\u4ee5\u8fdb\u884c\u4e8b\u4ef6\u5904\u7406\u7684\u573a\u6240\u662f<code>View.dispatchKeyEvent()</code>,\u901a\u8fc7<code>View.setOnKeyListener()</code>\u65b9\u6cd5\u8bbe\u7f6e\u7684<code>OnKeyListener</code>,\u4ee5\u53ca<code>View.onKeyDown()/onKeyUp()</code>\u7b49\u7cfb\u5217\u56de\u8c03\u3002</p> </li> <li> <p><code>PhoneFallbackEventHandler</code>\u5c06\u5728\u4e0a\u8ff0\u5bf9\u8c61\u90fd\u6ca1\u6709\u6d88\u8d39\u4e8b\u4ef6\u65f6\u5c1d\u8bd5\u5bf9\u4e8b\u4ef6\u8fdb\u884c\u5904\u7406\u3002</p> </li> <li> <p>\u6700\u540e<code>ViewRootImpl</code>\u5c06\u5c1d\u8bd5\u901a\u8fc7\u6309\u952e\u4e8b\u4ef6\u4f7f\u7126\u70b9\u5728\u63a7\u4ef6\u4e4b\u95f4\u6e38\u8d70\u3002</p> </li> </ul> <p>\u7b80\u5355\u63cf\u8ff0\u89e6\u6478\u4e8b\u4ef6\u6d3e\u53d1\u673a\u5236</p> \u56de\u7b54 <p>\u6d3e\u53d1\u6d41\u7a0b</p> <ul> <li> <p>\u4e8b\u4ef6\u6700\u5148\u88ab\u53d1\u9001\u5230\u4f60\u7684Activity\u4e2d</p> </li> <li> <p>\u518d\u7531Activity\u53d1\u9001\u7ed9RootView</p> </li> <li> <p>\u7236View\u8c03\u7528dispatchTouchEvent\u5f00\u542f\u4e8b\u4ef6\u5206\u53d1</p> </li> <li> <p>\u7236View\u8c03\u7528onInterceptTouchEvent\u5224\u65ad\u662f\u5426\u62e6\u622a\u8be5\u4e8b\u4ef6\uff0c\u4e00\u65e6\u62e6\u622a\u540e\u8be5\u4e8b\u4ef6\u7684\u540e\u7eed\u4e8b\u4ef6(\u5982DOWN\u4e4b\u540e\u7684MOVE\u548cUP)\u90fd\u76f4\u63a5\u62e6\u622a\uff0c\u4e0d\u4f1a\u518d\u8fdb\u884c\u5224\u65ad\u3002</p> </li> <li> <p>\u5982\u679c\u7236View\u8fdb\u884c\u62e6\u622a\uff0c\u7236View\u8c03\u7528onTouchEvent\u8fdb\u884c\u5904\u7406\u3002</p> </li> <li> <p>\u5982\u679c\u7236View\u4e0d\u62e6\u622a\uff0c\u4f1a\u8c03\u7528\u5b50View\u7684dispatchTouchEvent\u8fdb\u884c\u4e8b\u4ef6\u7684\u5c42\u5c42\u5206\u53d1\u3002</p> </li> <li> <p>\u5982\u679conTouchEvent()\u8fd4\u56detrue\uff0c\u8868\u793a\u4e8b\u4ef6\u88ab\u6d88\u8d39\uff0c\u4e8b\u4ef6\u7684\u4f20\u9012\u5c31\u4f1a\u505c\u6b62\u3002 \u5426\u5219\uff0conTouchEvent\u4e00\u5c42\u4e00\u5c42\u5f80\u4e0a\u8fd4\u56de\uff0c\u76f4\u5230Activity\u3002</p> </li> </ul> <p>\u91cd\u8981\u539f\u5219\uff1a\u4e8b\u4ef6\u5e8f\u5217\u7684\u4e0d\u53ef\u4e2d\u65ad\u6027</p> <p>\u4e00\u65e6\u4e00\u4e2a\u63a7\u4ef6\u51b3\u5b9a\u4e86\u63a5\u53d7\u4e00\u4e2a\u89e6\u63a7\u70b9\u7684<code>ACTION_DOWN</code>/\u6216<code>ACTION_POINTER_DOWN</code>\u4e8b\u4ef6(\u5728\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u4e2d\u8fd4\u56detrue),\u8868\u793a\u63a7\u4ef6\u5c06\u63a5\u53d7\u5e8f\u5217\u7684\u6240\u6709\u540e\u7eed\u4e8b\u4ef6,\u5373\u4fbf\u89e6\u63a7\u70b9\u79fb\u52a8\u5230\u63a7\u4ef6\u533a\u57df\u4e4b\u5916\u4e5f\u662f\u5982\u6b64\u3002</p> <p>\u89e6\u6478\u4e8b\u4ef6\u7684\u5e8f\u5217\u9664ACTION_UP\u4ee5\u5916\u8fd8\u6709\u4e00\u79cd\u7ed3\u675f\u6807\u5fd7\u2014\u2014<code>ACTION_CANCEL</code>\u3002\u6bd4\u5982,\u4e00\u4e2a\u6b63\u5728\u63a5\u53d7\u4e8b\u4ef6\u5e8f\u5217\u7684\u63a7\u4ef6\u4ece\u63a7\u4ef6\u6811\u4e2d\u88ab\u79fb\u9664,\u6216\u8005\u53d1\u751f\u4e86Activity\u5207\u6362\u7b49,\u90a3\u4e48\u5b83\u5c06\u6536\u5230ACTION_CANCEL\u800c\u4e0d\u662fACTION_UP,\u6b64\u65f6\u63a7\u4ef6**\u9700\u8981\u4e2d\u65ad\u5bf9\u4e8b\u4ef6\u7684\u5904\u7406\u5e76\u5c06\u81ea\u5df1\u6062\u590d\u5230\u63a5\u53d7\u4e8b\u4ef6\u5e8f\u5217\u4e4b\u524d\u7684\u72b6\u6001\u3002**</p> <p>ViewGroup\u786e\u5b9a\u89e6\u6478\u4e8b\u4ef6\u6d3e\u53d1\u76ee\u6807\u7684\u539f\u5219</p> \u56de\u7b54 <ul> <li> <p>\u4ec5\u5f53\u4e8b\u4ef6\u7684\u52a8\u4f5c\u4e3aACTION_DOWN\u6216ACTION_POINTER_UP\u65f6\u624d\u4f1a\u8fdb\u884c\u6d3e\u53d1\u76ee\u6807\u7684\u67e5\u627e\u3002\u56e0\u4e3a\u8fd9\u4e9b\u52a8\u4f5c\u6807\u5fd7\u7740\u65b0\u7684\u4e8b\u4ef6\u5b50\u5e8f\u5217\u7684\u5f00\u59cb,ViewGroup\u4ec5\u9700\u8981\u5bf9\u65b0\u7684\u5e8f\u5217\u67e5\u627e\u4e00\u4e2a\u6d3e\u53d1\u76ee\u6807\u3002</p> </li> <li> <p>ViewGroup\u4f1a\u6cbf\u7740\u7ed8\u5236\u987a\u5e8f\u76f8\u53cd\u7684\u65b9\u5411,\u5373\u4ece\u4e0a\u5230\u4e0b\u8fdb\u884c\u67e5\u627e\u3002\u6bd5\u7adf\u7528\u6237\u5f80\u5f80\u90fd\u662f\u5e0c\u671b\u70b9\u51fb\u5728\u4ed6\u80fd\u770b\u5f97\u5230\u7684\u4e1c\u897f\u4e0a\u3002\u56e0\u6b64ZOrder\u8d8a\u9760\u4e0a\u7684\u63a7\u4ef6\u62e5\u6709\u8d8a\u9ad8\u7684\u63a5\u53d7\u4e8b\u4ef6\u7684\u4f18\u5148\u7ea7\u3002</p> </li> <li> <p>ViewGroup\u4f1a\u5c06\u4e00\u4e2a\u63a7\u4ef6\u4f5c\u4e3a\u6d3e\u53d1\u76ee\u6807\u5019\u9009\u7684\u5148\u51b3\u6761\u4ef6\u662f\u4e8b\u4ef6\u7684\u5750\u6807\u4f4d\u4e8e\u5176\u8fb9\u754c\u5185\u90e8\u3002\u5f53\u4e8b\u4ef6\u843d\u5165\u5b50\u63a7\u4ef6\u5185\u90e8\u5e76\u4e14\u5b83\u63a5\u53d7\u8fc7\u53e6\u5916\u4e00\u6761\u4e8b\u4ef6\u5e8f\u5217\u65f6,\u5219\u76f4\u63a5\u8ba4\u5b9a\u5b83\u5c31\u662f\u6b64\u4e8b\u4ef6\u5e8f\u5217\u7684\u6d3e\u53d1\u76ee\u6807\u3002\u56e0\u4e3a\u5f53\u7528\u6237\u5c06\u624b\u6307\u6309\u5728\u4e00\u4e2a\u63a7\u4ef6\u4e0a,\u518d\u628a\u53e6\u4e00\u6839\u624b\u6307\u4e5f\u6309\u5728\u5176\u4e0a\u65f6,\u5f88\u53ef\u80fd\u662f\u4ed6\u60f3\u5bf9\u6b64\u63a7\u4ef6\u8fdb\u884c\u591a\u70b9\u64cd\u4f5c\u3002      </p> </li> <li> <p>ViewGroup\u4f1a\u9996\u5148\u901a\u8fc7dispatchTransformedTouchEvent()\u5c1d\u8bd5\u5c06\u4e8b\u4ef6\u6d3e\u53d1\u7ed9\u5019\u9009\u63a7\u4ef6,\u5018\u82e5\u63a7\u4ef6\u5728\u5176\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u4e2d\u8fd4\u56detrue,\u5219\u53ef\u4ee5\u786e\u5b9a\u5b83\u5c31\u662f\u6d3e\u53d1\u76ee\u6807,\u5426\u5219\u7ee7\u7eed\u6d4b\u8bd5\u4e0b\u4e00\u4e2a\u5b50\u63a7\u4ef6\u3002</p> </li> <li> <p>\u5f53\u904d\u5386\u4e86\u6240\u6709\u5b50\u63a7\u4ef6\u540e\u90fd\u65e0\u6cd5\u627e\u5230\u4e00\u4e2a\u5408\u9002\u7684\u6d3e\u53d1\u76ee\u6807\u65f6(\u4e8b\u4ef6\u843d\u5728\u4e86\u6240\u6709\u5b50\u63a7\u4ef6\u4e4b\u5916,\u6216\u8005\u6240\u6709\u5b50\u63a7\u4ef6\u5bf9\u6b64\u4e8b\u4ef6\u90fd\u4e0d\u611f\u5174\u8da3),ViewGroup\u4f1a\u5f3a\u884c\u5c06\u63a5\u53d7\u4e86\u4e0a\u4e00\u6761\u4e8b\u4ef6\u5e8f\u5217\u7684\u5b50\u63a7\u4ef6\u4f5c\u4e3a\u6d3e\u53d1\u76ee\u6807\u3002\u56e0\u4e3aViewGroup\u731c\u6d4b\u7528\u6237\u4ee5\u76f8\u90bb\u6b21\u5e8f\u6309\u4e0b\u7684\u4e24\u6839\u624b\u6307\u5e94\u8be5\u5305\u542b\u7740\u80fd\u591f\u5171\u540c\u5b8c\u6210\u67d0\u79cd\u4efb\u52a1\u7684\u671f\u671b\u3002\u53ef\u4ee5\u770b\u51fa,ViewGroup\u5c3d\u5176\u6240\u80fd\u5730\u5c06\u4e8b\u4ef6\u6d3e\u53d1\u7ed9\u5b50\u63a7\u4ef6,\u800c\u4e0d\u662f\u5c06\u4e8b\u4ef6\u7559\u7ed9\u81ea\u5df1\u5904\u7406\u3002\u4e0d\u8fc7\u5f53\u76ee\u524d\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u5b50\u63a7\u4ef6\u6b63\u5728\u63a5\u53d7\u4e8b\u4ef6\u5e8f\u5217\u65f6(mFirstTouchTarget\u4e3anull),ViewGroup\u4fbf\u4e0d\u5f97\u4e0d\u5c06\u4e8b\u4ef6\u4ea4\u7ed9\u81ea\u5df1\u5904\u7406\u4e86</p> </li> </ul> <p>\u8bf4\u4e0bonInterceptTouchEvent()\u7684\u4f5c\u7528</p> \u56de\u7b54 <p>\u624b\u6307\u6309\u4e0b(DOWN)\uff0c\u5230\u624b\u6307\u62ac\u8d77(UP)\uff0c\u4e2d\u95f4\u7531\u96f6\u4e2a\u3001\u4e00\u4e2a\u6216\u8005\u65e0\u6570\u4e2a\u79fb\u52a8(MOVE)\u8fde\u63a5\u8d77\u6765\u79f0\u4e4b\u4e3a\u4e00\u4e2a\u4e8b\u4ef6\u5e8f\u5217</p> <p>\u4f5c\u7528\u5bf9\u8c61\u4ec5\u4e3aViewGroup\u3002\u610f\u4e3a\u62e6\u622a\u64cd\u4f5c\u3002\u4e8b\u4ef6\u4f20\u9012\u8fc7\u6765\u4e4b\u540e\uff0c\u6839\u636e\u8fd4\u56de\u503c\u7684\u4e0d\u540c\u6765\u5224\u65ad\u662f\u5426\u9700\u8981\u8fdb\u884c\u62e6\u622a\u64cd\u4f5c\u3002</p> <ul> <li> <p>true\uff1a\u4ee3\u8868\u62e6\u622a\u8fd9\u4e2a\u4e8b\u4ef6\u3002\u4e8b\u4ef6\u4e0d\u4f1a\u518d\u5f80\u4e0b\u4f20\u9012\uff0c\u800c\u662f\u4ea4\u7ed9\u4e86ViewGroup\u81ea\u8eab\u7684onTouch\u53bb\u5904\u7406\u3002\u6b64\u65b9\u6cd5\u8fd4\u56detrue\u65f6\uff0c\u4e00\u4e2a\u4e8b\u4ef6\u5e8f\u5217\u53ea\u8c03\u7528\u4e00\u6b21\uff0c\u7b49\u4e8e\u8bf4\u540e\u9762\u7684MOVE\u4e0eUP\u4e0d\u4f1a\u518d\u6267\u884conInterceptTouchEvent\u65b9\u6cd5\uff0c\u800c\u662f\u76f4\u63a5\u53bb\u6267\u884conTouch\u65b9\u6cd5\u3002</p> </li> <li> <p>super/false\uff1a\u4ee3\u8868\u4e0d\u62e6\u622a\u8fd9\u4e2a\u4e8b\u4ef6\uff0c\u4e8b\u4ef6\u4f20\u9012\u7ed9\u5b50\u7c7bView\u7684dispatchTouchEvent\u53bb\u5904\u7406\u3002</p> </li> </ul> <p>\u5728\u4f7f\u7528\u62e6\u622a\u65b9\u6cd5onInterceptTouchEvent\u7684\u65f6\u5019\uff0c\u9700\u8981\u6ce8\u610f\u4e24\u79cd\u7279\u6b8a\u60c5\u51b5\u3002</p> <ul> <li> <p>\u4e00\u6b21\u4e8b\u4ef6\u5e8f\u5217\u4e2d\uff0c\u8be5\u65b9\u6cd5\u4e00\u65e6\u88ab\u8c03\u7528\u8fd4\u56de\u4e86true\u5c31\u4e0d\u4f1a\u5728\u8c03\u7528\u4e86\u3002\u5047\u8bbe\u5728Down\u4e8b\u4ef6\u88ab\u8c03\u7528\u65f6\u8fd4\u56de\u4e86true\uff0c\u90a3\u4e48Move\u4e0eUp\u4e8b\u4ef6\u4fbf\u4e0d\u4f1a\u518d\u53bb\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u800c\u662f\u76f4\u63a5\u53bb\u6267\u884conTouchEvent\u65b9\u6cd5\u3002</p> </li> <li> <p>\u5047\u8bbeViewGroup\u6ca1\u6709\u62e6\u622aDown\u4e8b\u4ef6\uff0c\u800c\u662f\u62e6\u622a\u4e86Move\u4e8b\u4ef6\uff0c\u90a3\u4e48\u8fd9\u4e2aDown\u4f1a\u76f4\u63a5\u4f20\u9012\u7ed9\u5b50\u7c7bView\uff0c\u800c\u540e\u9762\u7684Move\u7531\u4e8e\u88ab\u62e6\u622a\u4e86\uff0c\u4f46\u662f\u4ed6\u5e76\u4e0d\u4f1a\u4f20\u9012\u7ed9\u81ea\u8eab\u7684onTouchEvent\u65b9\u6cd5\uff0c\u800c\u662f\u88ab\u4f5c\u4e3a\u4e00\u4e2aCancel\u65b9\u6cd5\u4f20\u9012\u7ed9\u5b50\u7c7b\u7684View\uff0c\u800c\u540e\u9762\u518d\u6765\u7684Move\u5219\u4f1a\u88ab\u4f20\u9012\u7ed9\u81ea\u8eab\u7684View\u53bb\u5904\u7406\uff0c\u800c\u5b50\u7c7b\u7684View\u4e5f\u4e0d\u518d\u4f1a\u6536\u5230\u540e\u7eed\u4e8b\u4ef6\u3002</p> </li> </ul> <p>\u8bf4\u4e0brequestDisallowTouchIntercept()\u7684\u4f5c\u7528</p> \u56de\u7b54 <p>ViewGroup\u53ef\u4ee5\u901a\u8fc7<code>onInterceptTouchEvent</code>\u5bf9\u89e6\u63a7\u4e8b\u4ef6\u8fdb\u884c\u4e2d\u65ad\u6216\u8005\u7a83\u53d6\u5b50 View \u7684\u89e6\u63a7\u4e8b\u4ef6\u3002\u4f46\u662f\u6709\u65f6\u5019\u6211\u4eec\u5e0c\u671b\u5b50 View \u80fd\u591f\u5b8c\u5168\u63a5\u7ba1\u89e6\u63a7\u4e8b\u4ef6\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u8c03\u7528<code>requestDisallowInterceptTouchEvent</code>\u65b9\u6cd5\u6765\u7981\u6b62\u7236 View \u5bf9\u89e6\u63a7\u4e8b\u4ef6\u7684\u62e6\u622a\u3002</p> <p>\u4f8b\u5b50\uff1a ScrollView\uff08\u5185\u90e8\u6709\u4e00\u4e2a Button\uff09\uff0c\u5f53\u624b\u6307\u653e\u5230 Button \u4e0a\uff0c\u7136\u540e\u8fdb\u884c\u4e0a\u4e0b\u6ed1\u52a8\uff0c\u4f1a\u53d1\u73b0\u624b\u52bf\u4ea4\u7ed9\u4e86 ScrollView\uff0c\u5e76\u4e14\u5f00\u59cb\u6eda\u52a8\uff08ScrollView \u4f18\u5148\u4e8e Button \u7684\u54cd\u5e94\uff09\u3002\u5982\u679c\u4f60\u81ea\u5b9a\u4e49\u7684\u5b50\u89c6\u56fe\u51fa\u4e8e\u67d0\u4e9b\u539f\u56e0,\u4e5f\u51c6\u5907\u5904\u7406\u4e00\u4e9b\u62d6\u62fd\u4e8b\u4ef6\u65f6\uff0c\u8fd9\u6837\u7684\u8bdd,\u4f60\u5e0c\u671b\u6682\u65f6\u7684\u7531\u5b50\u89c6\u56fe\u53bb\u5904\u7406\u62d6\u62fd\uff0c\u4ece\u800c\u9700\u8981\u963b\u6b62ScrollView\u53bb\u5904\u7406\u62d6\u62fd\uff0c\u8fd9\u65f6\u53ef\u4ee5\u628a<code>requestDisallowInterceptTouchEvent</code>\u6807\u8bc6\u7f6e\u4e3atrue\u4e00\u6bb5\u65f6\u95f4,\u4e4b\u540e\u518d\u6e05\u6389\u6b64\u6807\u8bc6\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f,\u8fd9\u4e2a\u6807\u8bc6\u53ea\u5bf9\u5f53\u524d\u7684\u624b\u52bf\u6709\u6548\uff0c \u5f53<code>ACTION_UP</code>\u53d1\u751f\uff0c\u53c8\u4e00\u4e2a\u65b0\u7684<code>ACTION_DOWN</code>\u5230\u6765\u65f6\uff0c\u8fd9\u610f\u5473\u7740\u4e00\u4e2a\u65b0\u7684\u624b\u52bf\u7684\u5f00\u59cb,\u90a3\u4e48\u4e4b\u524d\u8bbe\u7f6e\u7684\u6807\u8bc6\u5c31\u4f1a\u88ab\u7f6e\u7a7a , \u5982\u679c\u4ecd\u9700\u8981\u62e6\u622a\uff0c\u9700\u8981\u518d\u6b21\u8c03\u7528<code>requestDisallowTouchIntercept()</code>\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u9700\u8981\u9488\u5bf9\u67d0\u4e2a\u624b\u52bf\uff0c\u6bcf\u6b21\u90fd\u8c03\u7528\u8be5\u65b9\u6cd5\u53bb\u8bbe\u7f6e\u4e2d\u65ad\u6807\u8bc6</p> <p>\u8bf4\u4e0bViewConfiguration\u7684\u4f5c\u7528</p> \u56de\u7b54 <p>ViewConfiguration \u6709\u5f88\u591a\u5e38\u91cf.\u8fd9\u4e9b\u5e38\u91cf\u4f9b\u6846\u67b6\u4f7f\u7528\uff0c\u800c\u5f53\u4f60\u5728\u505a\u81ea\u5b9a\u4e49\u624b\u52bf\u65f6\uff0c\u4f60\u4e5f\u9700\u8981\u5728\u4f60\u7684\u7a0b\u5e8f\u4e2d\u628a\u8fd9\u4e9b\u5e38\u91cf\u62ff\u6765\u7528\uff0c\u6765\u4f7f\u4f60\u7684\u4e8b\u4ef6\u5904\u7406\u8ddf\u7cfb\u7edf\u7684\u4f53\u9a8c\u4e00\u81f4\u3002 \u8fd9\u91cc\u7684\u5927\u591a\u6570\u5e38\u91cf\u662f\u8ddf\u89e6\u6478\u4e8b\u4ef6\u6709\u5173\u7684,\u4f46\u4e0d\u5168\u662f\uff0c\u6709\u4e9b\u4e5f\u4f1a\u8ddf\u753b\u56fe\u6216\u5176\u4ed6\u65b9\u9762\u76f8\u5173\u3002\u5c31\u5927\u90e8\u5206\u800c\u8a00,\u8fd9\u4e9b\u5e38\u91cf\u662f\u57fa\u4e8e\u89e6\u6478\u7684 \u63a5\u4e0b\u6765\u6211\u6765\u8bb2\u51e0\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5e38\u91cf</p> <ul> <li>getScaledTouchSlop()</li> </ul> <p>\u79fb\u52a8\u4e8b\u4ef6\u53ef\u80fd\u4f1a\u5728\u88ab\u89c6\u4e3a\u62d6\u52a8\u4e4b\u524d\u53d1\u751f\u53d8\u5316\u7684\u8ddd\u79bb</p> <ul> <li>getScaledMinimumFlingVelocity()</li> </ul> <p>\u7cfb\u7edf\u8ba4\u4e3a\u963b\u529b\u53ef\u4ee5\u53d8\u4e3a\u7529\u5c3e\u7684\u6700\u5c0f\u901f\u5ea6</p> <ul> <li>getScaledPagingTouchSlop()</li> </ul> <p>\u6b64\u5e38\u91cf\u5728ViewPager\u4e2d\u6709\u88ab\u7528\u5230,\u8fd9\u4e2atouch slop\u6307\u7684\u662f\u6a2a\u5411\u6ed1\u52a8\u7ffb\u9875\u3002\u4e5f\u4e0d\u662f\u8bf4\u6240\u6709\u6a2a\u5411\u7684slop\u90fd\u7528\u8fd9\u4e2a\u5e38\u91cf\u3002\u6bd4\u65b9\u8bf4\u6a2a\u5411\u7684ScrollView\u7528\u7684\u8fd8\u662f\u7b2c\u4e00\u79cdslop\u6765\u505a\u68c0\u67e5\uff0c\u8d77\u521d\u8bbe\u8ba1\u8fd9\u4e24\u4e2a\u4e0d\u540c\u7684\u5e38\u91cf\u7684\u4e3b\u8981\u539f\u56e0\u662f**\u5f53\u628aScrollView\u653e\u5230ViewPager\u4e2d\u65f6\uff0c\u600e\u6837\u624d\u80fd\u4f7f\u4e24\u8005\u90fd\u5de5\u4f5c\u7684\u597d\uff0c\u5728x\u8f74\u8ddfy\u8f74\u4e0a,\u5206\u522b\u6709\u4e24\u79cd\u4e0d\u540c\u7684slop\u68c0\u67e5\uff0c\u8fd9\u6837\u5c31\u5f88\u5bb9\u6613\u5224\u65ad\u51fa\u54ea\u4e2a\u8f74\u80dc\u51fa,\u4ee5\u4fbf\u51b3\u5b9a\u4f60\u662f\u4e0a\u5212\u8fd8\u662f\u4fa7\u6ed1**\u3002</p> <ul> <li>getLongPressTimeout()</li> </ul> <p>\u7cfb\u7edf\u957f\u6309\u4e8b\u4ef6\u8d85\u65f6\u65f6\u95f4</p> <p>\u5c31\u4e0d\u540c\u7684\u624b\u673a\u5c4f\u5e55\u800c\u8a00,\u7528\u8fd9\u4e9b\u9884\u5b9a\u4e49\u7684\u5e38\u91cf\u53e6\u5916\u4e00\u4e2a\u597d\u5904\u5c31\u662f,\u8fd9\u4e9b\u5e38\u91cf\u90fd\u662f\u50cfdp\u4e4b\u7c7b\u7684,\u5176\u503c\u662f\u8ddf\u5206\u8fa8\u7387\u65e0\u5173\u7684,\u6240\u4ee5\u4f60\u4e0d\u7528\u81ea\u5df1\u53bb\u627e\u4e00\u4e9b\u968f\u673a\u7684\u50cf\u7d20\u70b9\u6570, \u6765\u5145\u5f53\u4f60\u81ea\u5df1\u7684slop\u68c0\u67e5\u4e86   </p> <p>\u8bf4\u4e0b\u6ed1\u52a8\u51b2\u7a81</p> \u56de\u7b54 <p>\u6ed1\u52a8\u51b2\u7a81\u6709\u54ea\u4e9b\u573a\u666f\uff1f</p> <ul> <li> <p>\u5185\u5c42\u548c\u5916\u5c42\u6ed1\u52a8\u65b9\u5411\u4e0d\u4e00\u81f4\uff1a\u4e00\u4e2a\u5782\u76f4\uff0c\u4e00\u4e2a\u6c34\u5e73\u3002\u6bd4\u5982\u8f6e\u64ad\u56feViewPager\u548cScrollView</p> </li> <li> <p>\u5185\u5c42\u548c\u5916\u5c42\u6ed1\u52a8\u65b9\u5411\u4e00\u81f4\uff1a\u5747\u5782\u76f4or\u6c34\u5e73\u3002\u6bd4\u5982scrollView\u548cRecyclerView</p> </li> <li> <p>\u524d\u4e24\u8005\u5c42\u5c42\u5d4c\u5957\u3002\u6bd4\u5982ScrollView\u548cRecyclerView(recyclerView\u4e2d\u53c8\u5d4c\u5957recyclerView)</p> </li> </ul> <p>\u6ed1\u52a8\u51b2\u7a81\u5904\u7406\u539f\u5219</p> <ul> <li> <p>\u5bf9\u4e8e\u5185\u5916\u5c42\u6ed1\u52a8\u65b9\u5411\u4e0d\u540c\uff0c\u53ea\u9700\u8981\u6839\u636e\u6ed1\u52a8\u65b9\u5411\u6765\u7ed9\u76f8\u5e94\u63a7\u4ef6\u62e6\u622a</p> </li> <li> <p>\u5bf9\u4e8e\u5185\u5916\u5c42\u6ed1\u52a8\u65b9\u5411\u76f8\u540c\uff0c\u9700\u8981\u6839\u636e\u4e1a\u52a1\u6765\u8fdb\u884c\u4e8b\u4ef6\u62e6\u622a\uff0c\u89c4\u5b9a\u4f55\u65f6\u8ba9\u5916\u90e8View\u62e6\u622a\u4e8b\u4ef6\u4f55\u65f6\u7531\u5185\u90e8View\u62e6\u622a\u4e8b\u4ef6\u3002</p> </li> <li> <p>\u524d\u4e24\u8005\u5d4c\u5957\u7684\u60c5\u51b5\uff0c\u6839\u636e\u524d\u4e24\u79cd\u539f\u5219\u5c42\u5c42\u5904\u7406\u5373\u53ef\u3002</p> </li> </ul> <p>\u6ed1\u52a8\u51b2\u7a81\u89e3\u51b3\u529e\u6cd5\u6709\u54ea\u4e9b\uff1f</p> <ul> <li> <p>\u5916\u90e8\u62e6\u622a\u6cd5\uff1a\u6307\u70b9\u51fb\u4e8b\u4ef6\u90fd\u5148\u7ecf\u8fc7\u7236\u5bb9\u5668\u7684\u62e6\u622a\u5904\u7406\uff0c\u5982\u679c\u7236\u5bb9\u5668\u9700\u8981\u6b64\u4e8b\u4ef6\u5c31\u62e6\u622a\uff0c\u5426\u5219\u5c31\u4e0d\u62e6\u622a\u3002\u5177\u4f53\u65b9\u6cd5\uff1a\u9700\u8981\u91cd\u5199\u7236\u5bb9\u5668\u7684onInterceptTouchEvent\u65b9\u6cd5\uff0c\u5728\u5185\u90e8\u505a\u51fa\u76f8\u5e94\u7684\u62e6\u622a\u3002</p> </li> <li> <p>\u5185\u90e8\u62e6\u622a\u6cd5\uff1a\u6307\u7236\u5bb9\u5668\u4e0d\u62e6\u622a\u4efb\u4f55\u4e8b\u4ef6\uff0c\u800c\u5c06\u6240\u6709\u7684\u4e8b\u4ef6\u90fd\u4f20\u9012\u7ed9\u5b50\u5bb9\u5668\uff0c\u5982\u679c\u5b50\u5bb9\u5668\u9700\u8981\u6b64\u4e8b\u4ef6\u5c31\u76f4\u63a5\u6d88\u8017\uff0c\u5426\u5219\u5c31\u4ea4\u7531\u7236\u5bb9\u5668\u8fdb\u884c\u5904\u7406\u3002\u5177\u4f53\u65b9\u6cd5\uff1a\u9700\u8981\u914d\u5408requestDisallowInterceptTouchEvent\u65b9\u6cd5\u3002</p> </li> </ul> <p>\u5916\u90e8\u62e6\u622a\u89e3\u51b3\u6ed1\u52a8\u51b2\u7a81\u6cd5</p> <ul> <li> <p>\u5916\u90e8\u62e6\u622a\u6cd5\u8981\u70b9</p> <ul> <li> <p>\u7236\u5bb9\u5668\u7684onInterceptTouchEvent\u65b9\u6cd5\u4e2d\u5904\u7406</p> </li> <li> <p>ACTION_DOWN\u4e0d\u62e6\u622a\uff0c\u4e00\u65e6\u62e6\u622a\u4f1a\u5bfc\u81f4\u540e\u7eed\u4e8b\u4ef6\u90fd\u76f4\u63a5\u4ea4\u7ed9\u7236\u5bb9\u5668\u5904\u7406\u3002</p> </li> <li> <p>ACTION_MOVE\u4e2d\u6839\u636e\u60c5\u51b5\u8fdb\u884c\u62e6\u622a\uff0c\u62e6\u622a\uff1areturn true\uff0c\u4e0d\u62e6\u622a\uff1areturn false\uff08\u5916\u90e8\u62e6\u622a\u6838\u5fc3\uff09</p> </li> <li> <p>ACTION_UP\u4e0d\u62e6\u622a\uff0c\u5982\u679c\u7236\u63a7\u4ef6\u62e6\u622aUP\uff0c\u4f1a\u5bfc\u81f4\u5b50\u5143\u7d20\u63a5\u6536\u4e0d\u5230UP\u8fdb\u4e00\u6b65\u4f1a\u8ba9onClick\u65b9\u6cd5\u65e0\u6cd5\u89e6\u53d1\u3002\u6b64\u5916UP\u62e6\u622a\u4e5f\u6ca1\u4ec0\u4e48\u7528\u3002</p> </li> </ul> </li> </ul> <p>onTouch()\u3001onTouchEvent()\u548conClick()\u5173\u7cfb\u662f\u600e\u6837\u7684\uff0c\u54ea\u4e00\u4e2a\u5148\u6267\u884c</p> \u56de\u7b54 <p>onTouch-&gt;onTouchEvent-&gt;onClick</p> <ul> <li> <p>\u5f53\u4e00\u4e2aView\u9700\u8981\u5904\u7406\u4e8b\u4ef6\u65f6\uff0c\u5982\u679c\u5b83\u8bbe\u7f6e\u4e86OnTouchListener\uff0c\u90a3\u4e48OnTouchListener\u7684onTouch\u65b9\u6cd5\u4f1a\u88ab\u56de\u8c03\u3002</p> </li> <li> <p>\u8fd9\u65f6\u4e8b\u4ef6\u5982\u4f55\u5904\u7406\u8fd8\u5f97\u770bonTouch\u7684\u8fd4\u56de\u503c\uff0c\u5982\u679c\u8fd4\u56defalse\uff0c\u5219\u5f53\u524dView\u7684onTouchEvent\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\uff1b\u5982\u679c\u8fd4\u56detrue\uff0c\u90a3\u4e48onTouchEvent\u65b9\u6cd5\u5c06\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002\u7531\u6b64\u53ef\u89c1\uff0c\u7ed9View\u8bbe\u7f6e\u7684onTouchListener\uff0c\u5176\u4f18\u5148\u7ea7\u6bd4onTouchEvent\u8981\u9ad8\u3002</p> </li> <li> <p>\u5982\u679c\u5f53\u524d\u65b9\u6cd5\u4e2d\u8bbe\u7f6e\u4e86onClickListener\uff0c\u90a3\u4e48\u5b83\u7684onClick\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u5e38\u7528\u7684OnClickListener\uff0c\u5176\u4f18\u5148\u7ea7\u522b\u6700\u4f4e\u3002</p> </li> </ul> <p>\u5982\u679c\u8bbe\u7f6e\u4e86onClickListener, \u4f46\u662fonClick()\u6ca1\u6709\u8c03\u7528\uff0c\u53ef\u80fd\u4ea7\u751f\u7684\u539f\u56e0</p> \u56de\u7b54 <ul> <li> <p>\u7236View\u62e6\u622a\u4e86\u4e8b\u4ef6\uff0c\u6ca1\u6709\u4f20\u9012\u5230\u5f53\u524dView</p> </li> <li> <p>View\u7684Enabled = false(setEnabled(false)): view\u5904\u4e8e\u4e0d\u53ef\u7528\u72b6\u6001\uff0c\u4f1a\u76f4\u63a5\u8fd4\u56de\u3002</p> </li> <li> <p>View\u7684Clickable = false(setClickable\\setLongClickable(false)):view\u4e0d\u53ef\u4ee5\u70b9\u51fb\uff0c\u4e0d\u4f1a\u6267\u884conClick</p> </li> <li> <p>View\u8bbe\u7f6e\u4e86onTouchListener\uff0c\u4e14\u6d88\u8017\u4e86\u4e8b\u4ef6\u3002\u4f1a\u63d0\u524d\u8fd4\u56de\u3002</p> </li> <li> <p>View\u8bbe\u7f6e\u4e86TouchDelegate\uff0c\u4e14\u6d88\u8017\u4e86\u4e8b\u4ef6\u3002\u4f1a\u63d0\u524d\u8fd4\u56de\u3002</p> </li> </ul> <p>View\u6ed1\u52a8\u6709\u54ea\u4e9b\u65b9\u6cd5\uff1f</p> \u56de\u7b54 <ul> <li> <p>layout\uff1a\u5bf9View\u8fdb\u884c\u91cd\u65b0\u5e03\u5c40\u5b9a\u4f4d\u3002\u5728onTouchEvent()\u65b9\u6cd5\u4e2d\u83b7\u5f97\u63a7\u4ef6\u6ed1\u52a8\u524d\u540e\u7684\u504f\u79fb\u3002\u7136\u540e\u901a\u8fc7layout\u65b9\u6cd5\u91cd\u65b0\u8bbe\u7f6e\u3002</p> </li> <li> <p>offsetLeftAndRight\u548coffsetTopAndBottom:\u7cfb\u7edf\u63d0\u4f9b\u4e0a\u4e0b/\u5de6\u53f3\u540c\u65f6\u504f\u79fb\u7684API\u3002onTouchEvent()\u4e2d\u8c03\u7528</p> </li> <li> <p>LayoutParams: \u66f4\u6539\u81ea\u8eab\u5e03\u5c40\u53c2\u6570</p> </li> <li> <p>scrollTo/scrollBy: \u672c\u8d28\u662f\u79fb\u52a8View\u7684\u5185\u5bb9\uff0c\u9700\u8981\u901a\u8fc7\u7236\u5bb9\u5668\u7684\u8be5\u65b9\u6cd5\u6765\u6ed1\u52a8\u5f53\u524dView</p> </li> <li> <p>Scroller: \u5e73\u6ed1\u6ed1\u52a8\uff0c\u901a\u8fc7\u91cd\u8f7dcomputeScroll()\uff0c\u4f7f\u7528scrollTo/scrollBy\u5b8c\u6210\u6ed1\u52a8\u6548\u679c\u3002</p> </li> <li> <p>\u5c5e\u6027\u52a8\u753b: \u52a8\u753b\u5bf9View\u8fdb\u884c\u6ed1\u52a8</p> </li> <li> <p>ViewDragHelper: \u8c37\u6b4c\u63d0\u4f9b\u7684\u8f85\u52a9\u7c7b\uff0c\u7528\u4e8e\u5b8c\u6210\u5404\u79cd\u62d6\u62fd\u6548\u679c</p> </li> </ul> <p>\u8bf4\u4e0bScroller</p> \u56de\u7b54 <p>Scroller\u7528\u4e8e\u5c01\u88c5\u6ed1\u52a8, \u63d0\u4f9b\u4e86\u57fa\u4e8e\u65f6\u95f4\u7684\u6ed1\u52a8\u504f\u79fb\u503c\uff0c\u4f46\u662f\u5b9e\u9645\u6ed1\u52a8\u9700\u8981\u6211\u4eec\u53bb\u8d1f\u8d23\u3002</p> <p>Scroller\u5de5\u4f5c\u539f\u7406\uff1f</p> <ul> <li> <p>Scroller\u672c\u8eab\u4e0d\u80fd\u5b9e\u73b0View\u7684\u6ed1\u52a8\uff0cView\u91cd\u7ed8\u4e4b\u540edraw\u65b9\u6cd5\u4f1a\u8c03\u7528\u81ea\u5df1\u5b9e\u73b0\u7684computeScroll()\uff0c\u624d\u771f\u6b63\u5b9e\u73b0\u4e86\u6ed1\u52a8</p> </li> <li> <p>\u4e0d\u65ad\u8ba9View\u91cd\u7ed8\uff0c\u6bcf\u4e00\u6b21\u91cd\u7ed8\u8ddd\u79bb\u6ed1\u52a8\u7684\u5f00\u59cb\u65f6\u95f4\u6709\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\uff0c\u901a\u8fc7\u8be5\u65f6\u95f4\u53ef\u4ee5\u5f97\u5230View\u5f53\u524d\u7684\u6ed1\u52a8\u8ddd\u79bb</p> </li> <li> <p>View\u7684\u6bcf\u6b21\u91cd\u7ed8\u90fd\u4f1a\u5bfc\u81f4View\u7684\u5c0f\u5e45\u6ed1\u52a8\uff0c\u591a\u6b21\u5c0f\u5e45\u6ed1\u52a8\u5c31\u7ec4\u6210\u4e86\u5f39\u6027\u6ed1\u52a8</p> </li> </ul> <p>\u8bf4\u4e0bTouchDelegate</p> \u56de\u7b54 <p>TouchDelegate\u8ba9\u7236\u89c6\u56fe\u80fd\u591f\u5c06\u5b50\u89c6\u56fe\u7684\u53ef\u8f7b\u89e6\u533a\u57df\u6269\u5c55\u5230\u5b50\u89c6\u56fe\u7684\u8fb9\u754c\u4e4b\u5916\u3002\u5f53\u5b50\u89c6\u56fe\u5fc5\u987b\u8f83\u5c0f\uff0c\u540c\u65f6\u53c8\u5e94\u8be5\u5177\u6709\u8f83\u5927\u7684\u8f7b\u89e6\u533a\u57df\u65f6\uff0c\u6b64\u65b9\u6cd5\u5f88\u6709\u7528\u3002</p> <p>TouchDelegate\u7684\u4f7f\u7528\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u8003\u8651\u4ee5\u4e0b\u8fd9\u79cd\u60c5\u5f62</p> <p></p> <p>\u6211\u4eec\u60f3\u6269\u5927View2\u7684\u70b9\u51fb\u533a\u57df\u81f3View1\u5185\u90e8\u7684Bounds\u533a\u57df\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>view1.post(new Runnable() {\n@Override\npublic void run() {\nRect bounds = new Rect();\n// \u83b7\u53d6View2\u5360\u636e\u7684\u77e9\u5f62\u533a\u57df\u5728\u5176\u7236View\uff08\u4e5f\u5c31\u662fView1\uff09\u4e2d\u7684\u76f8\u5bf9\u5750\u6807\nview2.getHitRect(bounds);\n// \u8ba1\u7b97\u6269\u5c55\u540e\u7684j\u77e9\u5f62\u533a\u57dfBounds\u76f8\u5bf9\u4e8eView1\u7684\u5750\u6807\uff0cleft\u3001top\u3001right\u3001bottom\u5206\u522b\u4e3aView2\u5728\u5404\u4e2a\u65b9\u5411\u4e0a\u7684\u6269\u5c55\u8303\u56f4\nbounds.left -= left;\nbounds.top -= top;\nbounds.right += right;\nbounds.bottom += bottom;\n// \u521b\u5efaTouchDelegate\uff0cdelegateView\u4e3aView2\nTouchDelegate touchDelegate = new TouchDelegate(bounds, view2);\n// \u4e3aView1\u8bbe\u7f6eTouchDelegate\uff0c\u539f\u56e0\u53ef\u4ee5\u53c2\u8003View.java\u4e2dmTouchDelegate\u7684\u6ce8\u91ca\n// The delegate to handle touch events that are physically in this view but should be handled by another view.\nview1.setTouchDelegate(touchDelegate);\n}\n});\n</code></pre>"},{"location":"interview/android_screen/","title":"android \u5c4f\u5e55\u9002\u914d&amp;\u8d44\u6e90\u76f8\u5173","text":"<p>\u57fa\u7840\u6982\u5ff5\uff1a\u50cf\u7d20\u3001\u5c4f\u5e55\u5c3a\u5bf8\u3001\u5206\u8fa8\u7387\u3001dpi\u3001dp\u3001sp</p> \u56de\u7b54 <ol> <li>\u50cf\u7d20\uff1a\u901a\u5e38\u6240\u8bf4\u7684\u50cf\u7d20\uff0c\u5c31\u662fCCD/CMOS\u4e0a\u5149\u7535\u611f\u5e94\u5143\u4ef6\u7684\u6570\u91cf\uff0c\u4e00\u4e2a\u611f\u5149\u5143\u4ef6\u7ecf\u8fc7\u611f\u5149\uff0c\u5149\u7535\u4fe1\u53f7\u8f6c\u6362\uff0cA/D\u8f6c\u6362\u7b49\u6b65\u9aa4\u4ee5\u540e\uff0c\u5728\u8f93\u51fa\u7684\u7167\u7247\u4e0a\u5c31\u5f62\u6210\u4e00\u4e2a\u70b9\uff0c\u6211\u4eec\u5982\u679c\u628a\u5f71\u50cf\u653e\u5927\u6570\u500d\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e9b\u8fde\u7eed\u8272\u8c03\u5176\u5b9e\u662f\u7531\u8bb8\u591a\u8272\u5f69\u76f8\u8fd1\u7684\u5c0f\u65b9\u70b9\u6240\u7ec4\u6210\uff0c\u8fd9\u4e9b\u5c0f\u65b9\u70b9\u5c31\u662f\u6784\u6210\u5f71\u50cf\u7684\u6700\u5c0f\u5355\u4f4d\u201c\u50cf\u7d20\u201d\uff08Pixel\uff09\u3002\u7b80\u800c\u8a00\u4e4b\uff0c\u50cf\u7d20\u5c31\u662f\u624b\u673a\u5c4f\u5e55\u7684\u6700\u5c0f\u6784\u6210\u5355\u5143\u3002  </li> <li>\u5206\u8fa8\u7387\uff1a\u5c4f\u5e55\u7684\u50cf\u7d20\u70b9\u7684\u6570\u91cf\uff0c\u5355\u4f4d\u662f\u50cf\u7d20\u3002\u6bd4\u5982\uff1a19201080 \u5206\u8fa8\u7387\uff0c\u8868\u793a\u5f53\u524d\u8bbe\u5907\u7684\u5c4f\u5e55\u662f\u7531 \u6a2a\u54111080 \u7eb5\u54111920 \u4e2a\u50cf\u7d20\u70b9 \u7ec4\u5408\u800c\u6210\u3002</li> <li>\u5c4f\u5e55\u5c3a\u5bf8\uff1a\u5c4f\u5e55\u5bf9\u89d2\u7ebf\u7684\u957f\u5ea6\uff0c\u5355\u4f4d\u662f\u82f1\u5bf8\u3002  </li> <li>\u5c4f\u5e55\u5c3a\u5bf8\u3001\u5206\u8fa8\u7387\u3001\u50cf\u7d20\u5bc6\u5ea6\u4e09\u8005\u5173\u7cfb </li> <li>\u5c4f\u5e55\u50cf\u7d20\u5bc6\u5ea6(dpi)\uff1a\u6bcf\u82f1\u5bf8\u7684\u50cf\u7d20\u70b9\u7684\u6570\u91cf\uff0c\u5355\u4f4d\u662fdpi\u3002\u6807\u51c6\u5c4f\u5e55\u5206\u8fa8\u7387 \uff1a160dpi \u3002\u5373\uff1a\u4e00\u5e73\u65b9\u82f1\u5bf8\u9762\u79ef\uff0c\u5b58\u5728160\u50cf\u7d20\u70b9\u3002\uff08mdpi\uff09.</li> <li>dp\uff1adensity-independent pixels\uff0c\u5bc6\u5ea6\u65e0\u5173\u50cf\u7d20\uff0c\u662f\u4e00\u79cd\u62bd\u8c61\u7684\u5355\u4f4d\uff0c\u5b83\u7684\u5927\u5c0f\u4e0d\u53d7\u5c4f\u5e55\u5bc6\u5ea6\u7684\u5f71\u54cd\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u6839\u636e\u5c4f\u5e55\u5bc6\u5ea6\u6765\u8ba1\u7b97\u7684\u3002\u53ef\u4ee5\u4fdd\u8bc1\u5728\u4e0d\u540c\u7684\u5c4f\u5e55\u50cf\u7d20\u5bc6\u5ea6\u7684\u624b\u673a\u4e0a\u663e\u793a \u5f88\u76f8\u4f3c\u7684\u6548\u679c\u3002</li> <li>sp\uff1ascale-independent pixels\uff0c\u7f29\u653e\u65e0\u5173\u50cf\u7d20\uff0c\u662f\u4e00\u79cd\u62bd\u8c61\u7684\u5355\u4f4d\uff0c\u5b83\u7684\u5927\u5c0f\u4e0d\u53d7\u5c4f\u5e55\u5bc6\u5ea6\u7684\u5f71\u54cd\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u6839\u636e\u5c4f\u5e55\u5bc6\u5ea6\u6765\u8ba1\u7b97\u7684\u3002\u4e13\u95e8\u7528\u4e8e\u5b57\u4f53\u5927\u5c0f\u8868\u793a\u3002 <p>\u63a8\u8350\u4f7f\u752812sp\u4ee5\u4e0a\u7684\u5076\u6570\u4f5c\u4e3a \u5b57\u4f53\u5927\u5c0f, \u4e0d\u8981\u4f7f\u7528\u5947\u6570\uff0c\u6216\u8005\u6d6e\u70b9\u578b\u5c0f\u6570\uff0c\u56e0\u4e3a\u5bb9\u6613\u9020\u6210\u7cbe\u5ea6\u4e22\u5931\u3002</p> </li> </ol> <p>ppi\u4e0edpi\u7684\u533a\u522b</p> \u56de\u7b54 <ul> <li>dpi\u662f\u50cf\u7d20\u5bc6\u5ea6\uff0c\u6307\u7684\u662f\u5728\u7cfb\u7edf\u8f6f\u4ef6\u4e0a\u6307\u5b9a\u7684\u5355\u4f4d\u5c3a\u5bf8\u7684\u50cf\u7d20\u6570\u91cf\uff0c\u5b83\u5f80\u5f80\u662f\u5199\u5728\u7cfb\u7edf\u51fa\u5382\u914d\u7f6e\u6587\u4ef6\u7684\u4e00\u4e2a\u56fa\u5b9a\u503c</li> <li>ppi\u662f\u50cf\u7d20\u5bc6\u5ea6\uff0c\u6307\u7684\u662f\u5728\u5c4f\u5e55\u4e0a\u5b9e\u9645\u663e\u793a\u7684\u50cf\u7d20\u6570\u91cf\uff0c\u662f\u7269\u7406\u4e0a\u7684\u6982\u5ff5\uff0c\u5b83\u662f\u6839\u636e\u5c4f\u5e55\u7684\u7269\u7406\u5c3a\u5bf8\u548c\u5206\u8fa8\u7387\u8ba1\u7b97\u51fa\u6765\u7684\u4e00\u4e2a\u503c\uff0c\u5b83\u662f\u4e00\u4e2a\u52a8\u6001\u503c\uff0c\u4e0d\u662f\u56fa\u5b9a\u503c</li> <li>dpi\u662f\u8f6f\u4ef6\u53c2\u8003\u4e86\u7269\u7406\u50cf\u7d20\u5bc6\u5ea6\u540e\uff0c\u4eba\u4e3a\u6307\u5b9a\u7684\u4e00\u4e2a\u503c\uff0c\u8fd9\u6837\u4fdd\u8bc1\u4e86\u67d0\u4e00\u4e2a\u533a\u95f4\u5185\u7684\u7269\u7406\u50cf\u7d20\u5bc6\u5ea6\u5728\u8f6f\u4ef6\u4e0a\u90fd\u4f7f\u7528\u540c\u4e00\u4e2a\u503c\u3002\u8fd9\u6837\u4f1a\u6709\u5229\u4e8e\u6211\u4eec\u7684UI\u9002\u914d\u3002 <p>\u6bd4\u5982\uff0c\u51e0\u90e8\u76f8\u540c\u5206\u8fa8\u7387\u4e0d\u540c\u5c3a\u5bf8\u7684\u624b\u673a\u7684ppi\u53ef\u80fd\u5206\u522b\u662f\u662f430,440,450,\u90a3\u4e48\u5728Android\u7cfb\u7edf\u4e2d\uff0c\u53ef\u80fddpi\u4f1a\u5168\u90e8\u6307\u5b9a\u4e3a480.\u8fd9\u6837\u7684\u8bdd\uff0cdpi/160\u5c31\u4f1a\u662f\u4e00\u4e2a\u76f8\u5bf9\u56fa\u5b9a\u7684\u6570\u503c\uff0c\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u76f8\u540c\u5206\u8fa8\u7387\u4e0b\u4e0d\u540c\u5c3a\u5bf8\u7684\u624b\u673a\u8868\u73b0\u4e00\u81f4\u3002</p> </li> </ul> <p>dp\u4e0epx\u7684\u8f6c\u6362</p> \u56de\u7b54 <p>\u5728Android\u4e2d\uff0c\u89c4\u5b9a\u4ee5160dpi\uff08\u5373\u5c4f\u5e55\u5206\u8fa8\u7387\u4e3a320x480\uff09\u4e3a\u57fa\u51c6\uff1a1dp=1px</p> \u5bc6\u5ea6\u7c7b\u578b \u4ee3\u8868\u7684\u5206\u8fa8\u7387\uff08px) \u5c4f\u5e55\u5bc6\u5ea6\uff08dpi\uff09 \u6362\u7b97\uff08px/dp\uff09 \u4f4e\u5bc6\u5ea6\uff08ldpi\uff09 240x320 120 1dp=0.75px \u4e2d\u5bc6\u5ea6\uff08mdpi\uff09 320x480 160 1dp=1px \u9ad8\u5bc6\u5ea6\uff08hdpi\uff09 480x800 240 1dp=1.5px \u8d85\u9ad8\u5bc6\u5ea6\uff08xhdpi\uff09 720x1280 320 1dp=2px \u8d85\u8d85\u9ad8\u5bc6\u5ea6\uff08xxhdpi\uff09 1080x1920 480 1dp=3px <p>\u5b98\u65b9\u8bf4\u660e</p> <ul> <li>ldpi (low) ~120dpi</li> <li>mdpi (medium) ~160dpi</li> <li>hdpi(high) ~240dpi</li> <li>xhdpi (extra-high) ~320dpi</li> <li>xxhdpi (extra-extra-high) ~480dpi</li> <li>xxxhdpi (extra-extra-extra-high) ~640dpi</li> </ul> <p></p> <ul> <li>xlarge screens are at least 960dp x 720dp</li> <li>large screens are at least 640dp x 480dp</li> <li>normal screens are at least 470dp x 320dp</li> <li>small screens are at least 426dp x 320dp </li> </ul> <p>\u4e3a\u4ec0\u4e48 \u6709\u4e86dp\u5355\u4f4d\uff0c\u4f9d\u7136\u8981\u9002\u914d\u5462</p> \u56de\u7b54 <p>dp\u662f\u5bc6\u5ea6\u65e0\u5173\u50cf\u7d20\uff0c\u4f46\u662f\u4e0d\u662f\u5c4f\u5e55\u65e0\u5173\u50cf\u7d20\uff0c\u4e0d\u540c\u7684\u5c4f\u5e55\u5c3a\u5bf8\u3001\u5206\u8fa8\u7387\u3001\u5bc6\u5ea6\uff0cdp\u7684\u5927\u5c0f\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u9700\u8981\u9002\u914d\u3002</p> <p>\u4ee5320*480 dpi160\u7684\u5c4f\u5e55\u4e3a\u6807\u51c6\uff0c\u753b\u4e86\u4e00\u6761\u957f\u5ea6\u4e3a160px\u7684\u7ebf\uff0c\u957f\u5ea6\u4e3a\u5c4f\u5e55\u5bbd\u5ea6\u7684\u4e00\u534a\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4f60\u76f4\u63a5\u7528 160dp\uff0c\u4e00\u822c\u5c31\u80fd\u5b8c\u6210\u9002\u914d\u3002\u4f46\u662f\u5982\u679c\u8fd9\u6837\u7684\u5e03\u5c40 \u8fd0\u884c\u5728320x480\u5206\u8fa8\u7387\uff0c\u4f46\u662f\u5c4f\u5e55\u5bc6\u5ea6\u4e3a150dpi \u7565\u5c0f\u4e8e 160dpi\uff0c\u8fd9\u4e2a\u65f6\u5019 \u4f60\u5e03\u5c40\u91cc\u9762\u5199\u7684160dp\u5c31\u4f1a\u5b9e\u9645\u8d85\u8fc7160px \u4e0d\u518d\u662f\u5360\u5c4f\u5e55\u5bbd\u7684\u4e00\u534a\uff0c\u800c\u662f\u7565\u5fae\u8d85\u8fc7\u3002</p> <p>sp\u548cdp\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> \u56de\u7b54 <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cdp\u548csp\u6548\u679c\u7c7b\u4f3c\uff0c\u4f46\u662f\u6709\u4e00\u70b9\uff0c\u5982\u679c\u7528\u6237 \u8c03\u6574\u4e86\u624b\u673a\u5b57\u4f53\uff0c\u6bd4\u5982 \u4ece\u6807\u51c6\uff0c\u53d8\u6210\u4e86 \u8d85\u5927\uff0c\u90a3\u4e48\uff0c1dp \u539f\u672c\u7b49\u4e8e1px\u4f9d\u7136\u4e0d\u53d8\uff0c\u4f46\u662f1sp\u5c31\u4f1a\u4ece1px\u53d8\u62103px\uff08\u53ea\u662f\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6570\u503c\u4e0d\u5fc5\u8ba4\u771f\uff09. \u56e0\u6b64\uff0c\u5728\u7528\u6237\u8c03\u6574\u5b57\u4f53\u7684\u60c5\u51b5\u4e0b\uff0c\u540c\u6837\u7684\u5e03\u5c40\uff0c\u53ef\u80fd\u51fa\u73b0 \u7a97\u53e3\u5927\u5c0f\u4e0d\u53d8\uff0c\u4f46\u662f\u6587\u5b57\u5c3a\u5bf8\u53d1\u751f\u53d8\u5316\u7684\u60c5\u51b5\u3002</p> <p>\u540c\u4e00\u4e2a\u5e03\u5c40\u6587\u4ef6\u4e2d\uff0c\u6211\u4f7f\u7528\u7ebf\u6027\u5e03\u5c40\u548c\u76f8\u5bf9\u5e03\u5c40\u90fd\u53ef\u4ee5\u8fbe\u6210\u76ee\u7684\uff0c\u90a3\u4e48\u5982\u4f55\u6289\u62e9\uff1f</p> \u56de\u7b54 <p>\u4f7f\u7528\u76f8\u5bf9\u5e03\u5c40\uff0c\u5f88\u6709\u53ef\u80fd\u51fa\u73b0 \u7b2c\u4e00\u6b21\u6d4b\u91cf\"\u4e0d\u6ee1\u610f\"\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u4f1a\u6d4b\u91cf\u7b2c\u4e8c\u6b21\u3002\u5982\u679c\u4e24\u8005\u90fd\u53ef\u4ee5\u8fbe\u6210\u76ee\u7684\uff0c\u5e76\u4e14\u4e24\u8005\u7684\u5e03\u5c40\u5c42\u7ea7\u76f8\u540c\uff0c\u5e76\u4e14\u7ebf\u6027\u5e03\u5c40\u4e2d\u6ca1\u6709\u4f7f\u7528\u5230\u6743\u91cd(\u6743\u91cd\u53ef\u80fd\u4e5f\u4f1a\u89e6\u53d1\u7b2c\u4e8c\u6b21\u6d4b\u91cf)\uff0c\u6b64\u65f6\uff0c\u4f18\u5148\u4f7f\u7528\u7ebf\u6027\u5e03\u5c40\u3002 \u9664\u6b64\u4e4b\u5916\uff0c\u90fd\u9009\u62e9\u76f8\u5bf9\u5e03\u5c40\u3002</p> <p>\u9002\u914d\u7b56\u7565</p> \u56de\u7b54 <ul> <li>\u4f7f\u7528 \u591a\u5957\u5e03\u5c40 \u9002\u5e94\u4e0d\u540c\u5c4f\u5e55\uff0c\u4f7f\u7528\u5e03\u5c40\u9650\u5b9a\u7b26\uff1a\u6700\u5c0f\u5bbd\u5ea6\u3001\u53ef\u7528\u5bbd\u5ea6\u3001\u65b9\u5411\u3001\u5206\u8fa8\u7387\u9650\u5b9a\u7b26\u7b49\u3002</li> <li>\u4ee3\u7801\u9002\u914d, \u4e00\u822c\u7528\u4e8e\u52a8\u6001\u521b\u5efa \u63a7\u4ef6\uff0c\u6216\u8005\u81ea\u5b9a\u4e49view\u81ea\u5df1\u7ed8\u5236\u56fe\u5f62\u7684\u65f6\u5019\u3002</li> <li>\u5e03\u5c40\u7ec4\u4ef6\u7684\u9002\u914d,<ul> <li>\u4f7f\u7528\u50cf\u7d20\u5bc6\u5ea6\u65e0\u5173\u7684\u5355\u4f4d dp sp</li> <li>\u675c\u7edd\u4f7f\u7528\u7edd\u5bf9\u5e03\u5c40\uff0c\u591a\u4f7f\u7528\u76f8\u5bf9\u548c\u7ebf\u6027\u5e03\u5c40</li> <li>\u591a\u4f7f\u7528 wrap_content match_parent \u4ee5\u53ca\u7ebf\u6027\u5e03\u5c40\u7684\u6743\u91cd</li> <li>\u591a\u7528 minWidth minHeight,lines \u7b49\u5c5e\u6027</li> <li>\u4f7f\u7528\u591a\u5957\u9650\u5b9a\u7684 dimens\u4e2d\u5b9a\u4e49\u7684\u5c3a\u5bf8</li> </ul> </li> <li>\u5934\u6761\u65b9\u6848: \u76f4\u63a5\u53d8\u66f4DisplayMetrics\u4e2d\u7684density</li> </ul> <p>\u6bd4\u5982\uff0c\u8bbe\u8ba1\u7a3f\u5bbd\u5ea6\u662f360px\uff0c\u90a3\u4e48\u5f00\u53d1\u8fd9\u8fb9\u5c31\u4f1a\u628a\u76ee\u6807dp\u503c\u8bbe\u4e3a360dp\uff0c\u5728\u4e0d\u540c\u7684\u8bbe\u5907\u4e2d\uff0c\u52a8\u6001\u4fee\u6539density\u503c\uff0c\u4ece\u800c\u4fdd\u8bc1(\u624b\u673a\u50cf\u7d20\u5bbd\u5ea6)px/density\u8fd9\u4e2a\u503c\u59cb\u7ec8\u662f360dp,\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u80fd\u4fdd\u8bc1UI\u5728\u4e0d\u540c\u7684\u8bbe\u5907\u4e0a\u8868\u73b0\u4e00\u81f4\u4e86\u3002   </p> <p><pre><code>public static void setCustomDensity\n(Activity activity,final Application application){\nfinal DisplayMetrics appDisplayMetrics\n=application.getResource().getDisplayMetrics();\nfinal float targetDensity=appDisplayMetrics.widthPixels/360;\nfinal int targetDensityDpi=(int)(160*targetDensity);\nappDisplayMetrics.density=targetDensity;\nappDisplayMetrics.densityDpi=targetDensity;\n//Activty \u7684DisplayMetrics\u4e5f\u8981\u8bbe\u7f6e\nfinal DisplayMetrics activityDisplayMetrics\n=activity.getResource().getDisplayMetrics();\nactivityDisplayMetrics.density=targetDensity;\nactivityDisplayMetrics.densityDpi=targetDensity;\n}\n</code></pre>     \u7f3a\u70b9: \u8fd9\u4e2a\u65b9\u6848\u4f9d\u8d56\u4e8e\u8bbe\u8ba1\u56fe\u5c3a\u5bf8\uff0c\u4f46\u662f\u9879\u76ee\u4e2d\u7684\u7cfb\u7edf\u63a7\u4ef6\u3001\u4e09\u65b9\u5e93\u63a7\u4ef6\u3001\u7b49\u975e\u6211\u4eec\u9879\u76ee\u81ea\u8eab\u8bbe\u8ba1\u7684\u63a7\u4ef6\uff0c\u5b83\u4eec\u7684\u8bbe\u8ba1\u56fe\u5c3a\u5bf8\u5e76\u4e0d\u4f1a\u548c\u6211\u4eec\u9879\u76ee\u81ea\u8eab\u7684\u8bbe\u8ba1\u56fe\u5c3a\u5bf8\u4e00\u6837,\u5f53\u8fd9\u4e2a\u9002\u914d\u65b9\u6848\u4e0d\u5206\u7c7b\u578b\uff0c\u5c06\u6240\u6709\u63a7\u4ef6\u90fd\u5f3a\u884c\u4f7f\u7528\u6211\u4eec\u9879\u76ee\u81ea\u8eab\u7684\u8bbe\u8ba1\u56fe\u5c3a\u5bf8\u8fdb\u884c\u9002\u914d\u65f6\uff0c\u8fd9\u65f6\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u5f53\u67d0\u4e2a\u7cfb\u7edf\u63a7\u4ef6\u6216\u4e09\u65b9\u5e93\u63a7\u4ef6\u7684\u8bbe\u8ba1\u56fe\u5c3a\u5bf8\u548c\u548c\u6211\u4eec\u9879\u76ee\u81ea\u8eab\u7684\u8bbe\u8ba1\u56fe\u5c3a\u5bf8\u5dee\u8ddd\u975e\u5e38\u5927\u65f6\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u8d8a\u4e25\u91cd\u3002</p> <p>\u5982\u4f55\u5728\u4ee3\u7801\u4e2d\u83b7\u53d6\u5c4f\u5e55\u7684\u5bbd\u9ad8\uff1f</p> \u56de\u7b54 <ul> <li>\u83b7\u53d6\u5c4f\u5e55\u7684\u5bbd\u9ad8<ul> <li>\u901a\u8fc7<code>getResources().getDisplayMetrics().widthPixels</code>\u83b7\u53d6\u5c4f\u5e55\u7684\u5bbd\u5ea6</li> <li>\u901a\u8fc7<code>getResources().getDisplayMetrics().heightPixels</code>\u83b7\u53d6\u5c4f\u5e55\u7684\u9ad8\u5ea6</li> </ul> </li> <li>\u83b7\u53d6\u5c4f\u5e55\u7684\u5bc6\u5ea6<ul> <li>\u901a\u8fc7<code>getResources().getDisplayMetrics().density</code>\u83b7\u53d6\u5c4f\u5e55\u7684\u5bc6\u5ea6</li> </ul> </li> <li>\u83b7\u53d6\u5c4f\u5e55\u7684\u5bc6\u5ea6dpi<ul> <li>\u901a\u8fc7<code>getResources().getDisplayMetrics().densityDpi</code>\u83b7\u53d6\u5c4f\u5e55\u7684\u5bc6\u5ea6dpi</li> </ul> </li> </ul> <p>\u5982\u4f55\u5728\u4ee3\u7801\u4e2d\u83b7\u53d6\u72b6\u6001\u680f\u7684\u9ad8\u5ea6\uff1f</p> \u56de\u7b54 <ul> <li>\u901a\u8fc7<code>getResources().getDimensionPixelSize(R.dimen.status_bar_height)</code>\u83b7\u53d6\u72b6\u6001\u680f\u7684\u9ad8\u5ea6</li> </ul> <p>\u5982\u4f55\u5728\u4ee3\u7801\u4e2d\u83b7\u53d6\u5bfc\u822a\u680f\u7684\u9ad8\u5ea6\uff1f</p> \u56de\u7b54 <ul> <li>\u901a\u8fc7<code>getResources().getDimensionPixelSize(R.dimen.navigation_bar_height)</code>\u83b7\u53d6\u5bfc\u822a\u680f\u7684\u9ad8\u5ea6</li> </ul> <p>res\u76ee\u5f55\u548cassets\u76ee\u5f55\u7684\u533a\u522b</p> \u56de\u7b54 <ul> <li> <p>assets\uff1a\u4e0d\u4f1a\u5728 R\u6587\u4ef6\u4e2d\u751f\u6210\u76f8\u5e94\u6807\u8bb0\uff0c\u5b58\u653e\u5230\u8fd9\u91cc\u7684\u8d44\u6e90\u5728\u6253\u5305\u65f6\u4f1a\u6253\u5305\u5230\u7a0b\u5e8f\u5b89\u88c5\u5305\u4e2d\u3002\uff08\u901a\u8fc7 AssetManager \u7c7b\u8bbf\u95ee\u8fd9\u4e9b\u6587\u4ef6\uff09</p> </li> <li> <p>res\uff1a\u4f1a\u5728 R \u6587\u4ef6\u4e2d\u751f\u6210 id\u6807\u8bb0\uff0c\u8d44\u6e90\u5728\u6253\u5305\u65f6\u5982\u679c\u4f7f\u7528\u5230\u5219\u6253\u5305\u5230\u5b89\u88c5\u5305\u4e2d\uff0c\u672a\u7528\u5230\u4e0d\u4f1a\u6253\u5165\u5b89\u88c5\u5305\u4e2d\u3002</p> </li> <li> <p>res/anim\uff1a\u5b58\u653e\u52a8\u753b\u8d44\u6e90</p> </li> <li> <p>res/raw\uff1a\u548c asset\u4e0b\u6587\u4ef6\u4e00\u6837\uff0c\u6253\u5305\u65f6\u76f4\u63a5\u6253\u5165\u7a0b\u5e8f\u5b89\u88c5\u5305\u4e2d\uff08\u4f1a\u6620\u5c04\u5230 R\u6587\u4ef6\u4e2d\uff09</p> </li> </ul> <p>R\u6587\u4ef6\u662f\u5982\u4f55\u751f\u6210\u7684\uff0c\u4e3b\u8981\u6709\u4ec0\u4e48\u4f5c\u7528</p> \u56de\u7b54 <p>R.java\u6587\u4ef6\u662f\u7f16\u8bd1\u5668\u81ea\u52a8\u751f\u6210\u7684\uff0c\u5b83\u65e0\u9700\u5f00\u53d1\u4eba\u5458\u5bf9\u5176\u8fdb\u884c\u7ef4\u62a4\u3002R.java\u4f1a\u81ea\u52a8\u6536\u5f55\u5f53\u524d\u5e94\u7528\u4e2d\u6240\u6709\u7684\u8d44\u6e90\uff0c\u5e76\u6839\u636e\u8fd9\u4e9b\u8d44\u6e90\u5efa\u7acb\u5bf9\u5e94\u7684ID\uff0c\u5305\u62ec\uff1a\u5e03\u5c40\u8d44\u6e90\u3001\u63a7\u4ef6\u8d44\u6e90\u3001String\u8d44\u6e90\u3001Drawable\u8d44\u6e90\u7b49\u3002\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u628aR.java\u7406\u89e3\u6210\u662f\u5f53\u524dAndroid\u5e94\u7528\u7684\u8d44\u6e90\u5b57\u5178\u3002</p> <p>\u5b83\u7684\u4f5c\u7528\u662f\u8ba9\u4f60\u53ef\u4ee5\u901a\u8fc7R\u7c7b\u6765\u8c03\u7528\u8d44\u6e90\uff0c\u4f8b\u5982\uff1a<code>R.drawable.test</code>\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7R\u7c7b\u6765\u8c03\u7528drawable\u76ee\u5f55\u4e0b\u7684test\u6587\u4ef6\u3002</p>"},{"location":"interview/android_sys/","title":"Android \u7cfb\u7edf\u539f\u7406","text":""},{"location":"interview/android_sys/#_1","title":"\u7cfb\u7edf\u76f8\u5173","text":"<p>\u8bf4\u8bf4Android \u7cfb\u7edf\u5f00\u673a\u6d41\u7a0b</p> \u56de\u7b54"},{"location":"interview/android_sys/#ams","title":"AMS\u76f8\u5173","text":"<p>\u8bf4\u8bf4Android app \u542f\u52a8\u6d41\u7a0b</p> \u56de\u7b54"},{"location":"interview/android_sys/#_2","title":"\u7f16\u8bd1\u76f8\u5173","text":"<p>\u7b80\u5355\u8bf4\u8bf4 dexopt \u4e0e dex2oat \u7684\u533a\u522b\uff1f</p> \u56de\u7b54 <p>\u901a\u8fc7\u4e0a\u56fe\u53ef\u4ee5\u5f88\u660e\u663e\u7684\u770b\u51fa <code>dexopt</code> \u4e0e <code>dex2oat</code> \u7684\u533a\u522b\uff0c\u524d\u8005\u9488\u5bf9 Dalvik \u865a\u62df\u673a\uff0c\u540e\u8005\u9488\u5bf9 Art \u865a\u62df\u673a\u3002</p> <ul> <li> <p>\u57285.0\u4ee5\u524d\u7684\u7248\u672c\uff0cAndroid \u4f7f\u7528Dalvik\u865a\u62df\u673a\uff0c\u5728\u52a0\u8f7dDex\u65f6\u4f1a\u89e6\u53d1dexopt\u751f\u6210odex\u6587\u4ef6\uff0c\u5b9e\u9645\u4e0a\u662f\u5bf9 dex \u6587\u4ef6 \u8fdb\u884c <code>verification</code> \u548c <code>optimization</code>\u64cd\u4f5c\uff08\u8b6c\u5982\u4f18\u5316\u8c03\u7528\u865a\u62df\u6307\u4ee4\u7b49\uff09, \u5728\u8fd0\u884c\u65f6\uff0c\u901a\u8fc7JIT\u7f16\u8bd1\u5668\u5c06\u70ed\u70b9\u4ee3\u7801\u7f16\u8bd1\u6210native\u4ee3\u7801\uff0c\u5176\u4f59\u7684\u4e00\u8fb9\u8fd0\u884c\uff0c\u4e00\u8fb9\u7f16\u8bd1\u3002</p> </li> <li> <p>\u57285.0\u4e4b\u540e\u7684\u7248\u672c\uff0cAndroid \u4f7f\u7528ART\u865a\u62df\u673a\uff0cAPK\u5728\u5b89\u88c5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u901a\u8fc7dex2oat\u5de5\u5177\u751f\u6210\u4e00\u4e2aOAT\u6587\u4ef6\u3002oat\u6587\u4ef6\u662f\u4e00\u79cdAndroid\u79c1\u6709ELF\u6587\u4ef6\u683c\u5f0f\uff0c\u5b83\u9075\u5faaELF\u683c\u5f0f\uff0cELF\u662fUnix\u7cfb\u7edf\u4e0a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u53ef\u4ee5\u76f4\u63a5\u88ab\u672c\u5730\u5904\u7406\u5668\u6267\u884c</p> </li> </ul>"},{"location":"interview/android_view/","title":"Android \u89c6\u56fe\u76f8\u5173","text":"<p>\u8bf4\u4e0b\u5bf9Window\u7684\u7406\u89e3</p> \u56de\u7b54 <p>Window\u662f\u4e00\u4e2a\u62bd\u8c61\u6982\u5ff5\uff0c\u6bcf\u4e00\u4e2aWindow\u90fd\u5bf9\u5e94\u4e00\u4e2aView\u548c\u4e00\u4e2aViewRootImpl\uff0cWindow\u548cView\u901a\u8fc7ViewRootImpl\u6765\u5efa\u7acb\u8054\u7cfb\uff0c\u56e0\u6b64Window\u4e0d\u662f\u5b9e\u9645\u5b58\u5728\u7684\uff0c\u4ed6\u662f\u4ee5View\u7684\u5f62\u5f0f\u5b58\u5728\u7684\uff0c\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95eeWindow\uff0c\u53ea\u6709\u901a\u8fc7WindowManager\u624d\u80fd\u8bbf\u95ee</p> <p>Window\u8868\u793a\u7a97\u53e3\u7684\u6982\u5ff5\uff0c\u4ed6\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4ed6\u7684\u771f\u6b63\u5b9e\u73b0\u7c7b\u662fPhoneWindow\uff0cWindowManager\u7528\u6765\u5bf9Window\u8fdb\u884c\u7ba1\u7406\uff0c\u662f\u5916\u63a5\u8bbf\u95eeWindow\u7684\u5165\u53e3\uff0cWindow\u64cd\u4f5c\u7684\u5177\u4f53\u5b9e\u73b0\u662f\u5728WindowManagerService\u4e2d\uff0cWindowMager\u548cWindowManagerService\u4ea4\u4e92\u662fIPC\u7684\u8fc7\u7a0b</p> <p>Android\u4e2d\u6240\u6709\u7684\u89c6\u56fe\u90fd\u662f\u9644\u52a0\u5728Window\u4e0a\u4e0a\u5448\u73b0\u7684\uff0c\u4e0d\u7ba1Activity,Dialog,Toast,\u4ed6\u4eec\u7684\u89c6\u56fe\u90fd\u662f\u9644\u52a0\u5728Window\u4e0a\u7684,\u56e0\u6b64Window\u5b9e\u9645\u4e0a\u662fView\u7684\u76f4\u63a5\u7ba1\u7406\u8005</p> <p>Window\u6709\u51e0\u79cd\u7c7b\u578b\uff1a</p> <ul> <li> <p>\u5e94\u7528Window\uff1a\u5bf9\u5e94\u4e00\u4e2aActivity\u3002</p> </li> <li> <p>\u5b50Window\uff1a\u4e0d\u80fd\u5355\u72ec\u5b58\u5728\uff0c\u9700\u9644\u5c5e\u7279\u5b9a\u7684\u7236Window\u3002\u5982Dialog\u3002</p> </li> <li> <p>\u7cfb\u7edfWindow\uff1a \u9700\u7533\u660e\u6743\u9650\u624d\u80fd\u521b\u5efa\u3002\u5982Toast\u3002</p> </li> </ul> <p>Activity\u3001View\u3001Window\u4e09\u8005\u4e4b\u95f4\u7684\u5173\u7cfb</p> \u56de\u7b54 <p>\u5728Activity\u542f\u52a8\u8fc7\u7a0b\u5176\u4e2d\u7684attach()\u65b9\u6cd5\u4e2d\u521d\u59cb\u5316\u4e86PhoneWindow\uff0c\u800cPhoneWindow\u662fWindow\u7684\u552f\u4e00\u5b9e\u73b0\u7c7b\uff0c\u7136\u540eActivity\u901a\u8fc7setContentView\u5c06View\u8bbe\u7f6e\u5230\u4e86PhoneWindow\u4e0a\uff0c\u800cView\u901a\u8fc7WindowManager\u7684addView()\u3001removeView()\u3001updateViewLayout()\u5bf9View\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>\u8bf4\u4e0b\u5bf9ViewRootImpl\u7684\u7406\u89e3</p> \u56de\u7b54 <ul> <li> <p>ViewRootImpl\u5b9e\u73b0\u4e86\u4e00\u4e2a\u63a7\u4ef6\u6811\u7684\u6839\u3002\u5b83\u8d1f\u8d23\u4e0eWMS\u76f4\u63a5\u901a\u4fe1,\u8d1f\u8d23\u7ba1\u7406Surface,\u8d1f\u8d23\u89e6\u53d1\u63a7\u4ef6\u7684\u6d4b\u91cf\u4e0e\u5e03\u5c40,\u8d1f\u8d23\u89e6\u53d1\u63a7\u4ef6\u7684\u7ed8\u5236,\u540c\u65f6\u4e5f\u662f\u8f93\u5165\u4e8b\u4ef6\u7684\u4e2d\u8f6c\u7ad9\u3002\u63a7\u4ef6\u3001\u5e03\u5c40\u53c2\u6570\u4ee5\u53caViewRootImpl\u4e09\u8005\u5171\u540c\u7ec4\u6210\u4e86\u5ba2\u6237\u7aef\u7684\u4e00\u4e2a\u7a97\u53e3\u3002\u6216\u8005\u8bf4,\u5728\u63a7\u4ef6\u7cfb\u7edf\u4e2d\u7684\u7a97\u53e3\u5c31\u662f\u63a7\u4ef6\u3001\u5e03\u5c40\u53c2\u6570\u4e0eViewRootImpl\u5bf9\u8c61\u7684\u4e00\u4e2a\u4e09\u5143\u7ec4\u3002</p> </li> <li> <p>\u5b83\u65e2\u975eView\u7684\u5b50\u7c7b\uff0c\u4e5f\u975eView\u7684\u7236\u7c7b\uff0c\u4f46\u662f\uff0c\u5b83\u5b9e\u73b0\u4e86ViewParent\u63a5\u53e3\uff0c\u8fd9\u8ba9\u5b83\u53ef\u4ee5\u4f5c\u4e3aView\u7684\u540d\u4e49\u4e0a\u7684\u7236\u89c6\u56fe</p> </li> </ul> <p></p> <p>\u8bf4\u4e0bDecorView\u7684\u7406\u89e3</p> \u56de\u7b54 <ul> <li> <p>\u4ec0\u4e48\u662fDecorView</p> <ul> <li>DecorView\u662f\u9876\u7ea7View\uff0c\u672c\u8d28\u5c31\u662f\u4e00\u4e2aFrameLayout\uff0c\u5b83\u53ef\u4ee5\u88ab\u8ba4\u4e3a\u662fAndroid\u89c6\u56fe\u6811\u7684\u6839\u8282\u70b9\u89c6\u56fe\u3002</li> <li>\u5305\u542b\u4e86\u4e24\u4e2a\u90e8\u5206\uff0c\u6807\u9898\u680f\u548c\u5185\u5bb9\u680f, \u5185\u5bb9\u680fid\u662fcontent\uff0c\u4e5f\u5c31\u662factivity\u4e2dsetContentView\u6240\u8bbe\u7f6e\u7684\u90e8\u5206\uff0c\u6700\u7ec8\u5c06\u5e03\u5c40\u6dfb\u52a0\u5230id\u4e3acontent\u7684FrameLayout\u4e2d</li> </ul> </li> <li> <p>DecorView\u7684\u804c\u8d23</p> </li> </ul> <p>Activity\u5c31\u50cf\u4e2a\u63a7\u5236\u5668\uff0c\u4e0d\u8d1f\u8d23\u89c6\u56fe\u90e8\u5206\u3002Window\u50cf\u4e2a\u627f\u8f7d\u5668\uff0c\u88c5\u7740\u5185\u90e8\u89c6\u56fe\u3002DecorView\u5c31\u662f\u4e2a\u9876\u5c42\u89c6\u56fe\uff0c\u662f\u6240\u6709View\u7684\u6700\u5916\u5c42\u5e03\u5c40\u3002ViewRoot\u50cf\u4e2a\u8fde\u63a5\u5668\uff0c\u8d1f\u8d23\u6c9f\u901a\uff0c\u901a\u8fc7\u786c\u4ef6\u7684\u611f\u77e5\u6765\u901a\u77e5\u89c6\u56fe\uff0c\u8fdb\u884c\u7528\u6237\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002</p> <p>Dialog\u548cWindow\u6709\u4ec0\u4e48\u5173\u7cfb</p> \u56de\u7b54 <p>\u770b\u6e90\u7801\u53ef\u77e5\u5728Dialog\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u76f4\u63a5\u76f4\u63a5\u6784\u9020\u4e86\u4e00\u4e2aPhoneWindow\uff0c\u5e76\u8d4b\u503c\u7ed9Dialog\u7684\u6210\u5458\u53d8\u91cfmWindow\uff0c\u4ece\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\u5176\u5b9eDialog\u548cActivity\u7684\u663e\u793a\u903b\u8f91\u90fd\u662f\u7c7b\u4f3c\u7684\uff0c\u90fd\u662f\u901a\u8fc7\u5bf9\u5e94\u7684Window\u53d8\u91cf\u6765\u5b9e\u73b0\u7a97\u53e3\u7684\u52a0\u8f7d\u4e0e\u663e\u793a\u7684\u3002\u7136\u540e\u6211\u4eec\u6267\u884c\u4e86\u4e00\u4e9bWindow\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u6bd4\u5982\u8bbe\u7f6e\u56de\u8c03\u51fd\u6570\u4e3a\u672c\u8eab\uff0c\u7136\u540e\u8c03\u7528Window\u7c7b\u7684setWindowManager\u65b9\u6cd5\uff0c\u5e76\u4f20\u5165\u4e86WindowManager\u3002\u7136\u540e\u521b\u5efa\u4e00\u4e2a\u5bf9\u8bdd\u6846\u76d1\u542chandler\u5bf9\u8c61 <pre><code>    Dialog(@NonNull Context context, @StyleRes int themeResId, boolean createContextThemeWrapper) {\nif (createContextThemeWrapper) {\nif (themeResId == 0) {\nfinal TypedValue outValue = new TypedValue();\ncontext.getTheme().resolveAttribute(R.attr.dialogTheme, outValue, true);\nthemeResId = outValue.resourceId;\n}\n//\u521b\u5efa\u4e00\u4e2aContext\nmContext = new ContextThemeWrapper(context, themeResId);\n} else {\nmContext = context;\n}\n//\u83b7\u53d6\u4e00\u4e2aWindowManager\u5bf9\u8c61\nmWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);\n//\u521b\u5efa\u4e00\u4e2aWindow\u5bf9\u8c61\nfinal Window w = new PhoneWindow(mContext);\n//\u5c06Window\u5bf9\u8c61w\u8d4b\u503c\u7ed9mWindow\nmWindow = w;\n//\u4e3aWindowd\u5bf9\u8c61\u8bbe\u7f6e\u56de\u8c03\uff0c\u5e76\u4e14\u5b83\u672c\u8eab\u5b9e\u73b0\u4e86\u8fd9\u4e9b\u56de\u8c03\u51fd\u6570\nw.setCallback(this);\nw.setOnWindowDismissedCallback(this);\n//\u4e3aWindow\u5bf9\u8c61\u8bbe\u7f6eWindowManager\u5bf9\u8c61\nw.setWindowManager(mWindowManager, null, null);\nw.setGravity(Gravity.CENTER);\n//\u521b\u5efa\u4e00\u4e2a\u5bf9\u8bdd\u6846\u76d1\u542cHandler\nmListenersHandler = new ListenersHandler(this);\n}\n</code></pre></p> <p>PopupWindow\u548cDialog\u6709\u4ec0\u4e48\u533a\u522b</p> \u56de\u7b54 <ol> <li>AlertDialog \u662f\u975e\u963b\u585e\u5f0f\u5bf9\u8bdd\u6846\uff1b\u800cPopupWindow \u662f\u963b\u585e\u5f0f\u5bf9\u8bdd\u6846\u3002AlertDialog \u5f39\u51fa\u65f6\uff0c\u540e\u53f0\u8fd8\u53ef\u4ee5\u505a\u4e8b\u60c5\uff1bPopupWindow \u5f39\u51fa\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u7b49\u5f85\uff0c\u5728PopupWindow \u9000\u51fa\u524d\uff0c\u7a0b\u5e8f\u4e00\u76f4\u7b49\u5f85\uff0c\u53ea\u6709\u5f53\u6211\u4eec\u8c03\u7528\u4e86 dismiss() \u65b9\u6cd5\u7684\u540e\uff0cPopupWindow \u9000\u51fa\uff0c\u7a0b\u5e8f\u624d\u4f1a\u5411\u4e0b\u6267\u884c\u3002\u6211\u4eec\u5728\u5199\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u9009\u62e9\u4f7f\u7528 Popupwindow \u6216\u8005\u662f Dialog.</li> <li>\u4e24\u8005\u6700\u6839\u672c\u7684\u533a\u522b\u5728\u4e8e\u6709\u6ca1\u6709\u65b0\u5efa\u4e00\u4e2a window\uff0cPopupWindow \u6ca1\u6709\u65b0\u5efa\uff0c\u800c\u662f\u901a\u8fc7 WMS \u5c06 View \u52a0\u5230 DecorView\uff1bDialog \u662f\u65b0\u5efa\u4e86\u4e00\u4e2a window (PhoneWindow)\uff0c\u76f8\u5f53\u4e8e\u8d70\u4e86\u4e00\u904d Activity \u4e2d\u521b\u5efa window \u7684\u6d41\u7a0b\u3002</li> </ol> <p>\u8bf4\u4e0b\u5bf9View\u7684\u7406\u89e3</p> \u56de\u7b54 <p>View \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4ed6\u8d1f\u8d23\u5bf9 \u6e32\u67d3\u3001\u5e03\u5c40\u4ee5\u53ca\u89e6\u6478\u4e8b\u4ef6\u8fdb\u884c\u62bd\u8c61</p> <ul> <li>\u5e03\u5c40\u62bd\u8c61 \u5e03\u5c40\uff0c\u662f View \u6700\u91cd\u8981\u7684\u7279\u6027\uff0c\u8bf8\u5982\u5c42\u7ea7\u63a7\u5236\u3001\u77e9\u5f62\u5927\u5c0f\u3001Matrix \u53d8\u6362\u90fd\u5c5e\u4e8e\u5e03\u5c40\u62bd\u8c61\u7684\u8303\u7574\uff0c\u5e03\u5c40\u662f\u6e32\u67d3\u3001\u89e6\u6478\u4e24\u8005\u7684\u57fa\u7840\u3002</li> <li>\u89e6\u6478\u4e8b\u4ef6\u62bd\u8c61 \u6240\u8c13\u89e6\u63a7\uff0c\u6709\u89e6\u624d\u6709\u63a7\uff0c\u4e00\u65b9\u9762 View \u8981\u8d1f\u8d23\u63a5\u6536\u89e6\u6478\u4e8b\u4ef6\uff0c\u53e6\u4e00\u65b9\u9762 View \u8981\u8d1f\u8d23\u53cd\u9988\u63a5\u6536\u5230\u7684\u89e6\u6478\u4e8b\u4ef6\u3002\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u4e3b\u8981\u6709\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u5192\u6ce1\u3001\u5411\u4e0a\u9012\u5f52\u3002</li> </ul> <p>\u5192\u6ce1\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4e3a\u4e86\u627e\u51fa\u89e6\u6478\u70b9\u6240\u5728\u7684 View\uff0c\u5728\u627e\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5f62\u6210\u54cd\u5e94\u94fe\uff0c\u4e00\u65e6\u786e\u5b9a\u597d\u54cd\u5e94\u8005\u548c\u54cd\u5e94\u94fe\uff0c\u89e6\u6478\u7684\u8fc7\u7a0b\u5c31\u5f00\u59cb\u4e86\u3002\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199 <code>dispatchTouchEvent(MotionEvent event)</code> \u9a8c\u8bc1\u3002</p> <p>\u5192\u6ce1\u8fc7\u7a0b\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u4f1a\u5f97\u5230\u54cd\u5e94\u8005 A\uff0c\u7d27\u63a5\u7740 <code>touchstart / touchmove / touchend / touchcancel</code> \u4e8b\u4ef6\u5c31\u4f1a\u5206\u53d1\u5230\u8fd9\u4e2a\u54cd\u5e94\u8005\u8eab\u4e0a\u3002 A \u4f1a\u6839\u636e\u4e8b\u4ef6\u7c7b\u578b\uff0c\u8c03\u7528 <code>onTouchEvent(MotionEvent event)</code> \u6216\u8005 <code>onInterceptTouchEvent(MotionEvent event)</code> \u6765\u5904\u7406\u4e8b\u4ef6\u3002\u5982\u679c A \u6ca1\u6709\u5904\u7406\u4e8b\u4ef6\uff0c\u90a3\u4e48\u4e8b\u4ef6\u5c31\u4f1a\u5411\u4e0a\u9012\u5f52\uff0c\u4e00\u76f4\u5230\u6839 View\uff0c\u5982\u679c\u6839 View \u4e5f\u6ca1\u6709\u5904\u7406\u4e8b\u4ef6\uff0c\u90a3\u4e48\u4e8b\u4ef6\u5c31\u4f1a\u88ab\u4e22\u5f03\u3002</p> <ul> <li>\u6e32\u67d3\u62bd\u8c61 \u6e32\u67d3\uff0c\u662f View \u6700\u57fa\u672c\u7684\u7279\u6027\uff0cView \u8981\u8d1f\u8d23\u628a\u81ea\u5df1\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u6e32\u67d3\u3002\u4e00\u822c\u6765\u8bf4 View \u4e0d\u4f1a\u76f4\u63a5\u9762\u5411 \u5e95\u5c42\u56fe\u5f62\u5e93\uff08\u5982OpenGL\uff09 \u8fdb\u884c\u5c01\u88c5\uff0c\u800c\u662f\u901a\u8fc7\u4e2d\u95f4\u5c42\uff0c\u5728 iOS \u4e0a\uff0c\u4f7f\u7528\u7684\u662f <code>CALayer(CoreGraphics)</code>\uff0c\u800c\u5728 Android \u4e0a\uff0c\u4f7f\u7528\u7684\u662f <code>Canvas (Skia)</code>\u3002</li> </ul> <p>\u7b80\u5355\u8bf4\u4e0bView\u7684\u7ed8\u5236\u6d41\u7a0b</p> \u56de\u7b54 <p>View\u7684\u7ed8\u5236\u6d41\u7a0b\u662f\u4eceViewRoot\u7684PerformTraversals\u65b9\u6cd5\u5f00\u59cb\u7684\u3002\u5927\u6982\u7684\u6d41\u7a0b\u5982\u4e0b\u6240\u793a</p> <ul> <li>\u9884\u6d4b\u91cf\u9636\u6bb5\u3002</li> </ul> <p>\u8fd9\u662f\u8fdb\u5165performTraversals\uff08\uff09\u65b9\u6cd5\u540e\u7684\u7b2c\u4e00\u4e2a\u9636\u6bb5\uff0c\u5b83\u4f1a\u5bf9\u63a7\u4ef6\u6811\u8fdb\u884c\u7b2c\u4e00\u6b21\u6d4b\u91cf\u3002\u6d4b\u91cf\u7ed3\u679c\u53ef\u4ee5\u901a\u8fc7mView.getMeasuredWidth\uff08\uff09/Height\uff08\uff09\u83b7\u5f97\u3002\u5728\u6b64\u9636\u6bb5\u4e2d\u5c06\u4f1a\u8ba1\u7b97\u51fa\u63a7\u4ef6\u6811\u4e3a\u663e\u793a\u5176\u5185\u5bb9\u6240\u9700\u7684\u5c3a\u5bf8\uff0c\u5373\u671f\u671b\u7684\u7a97\u53e3\u5c3a\u5bf8\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d\uff0cView\u53ca\u5176\u5b50\u7c7b\u7684onMeasure\uff08\uff09\u65b9\u6cd5\u5c06\u4f1a\u6cbf\u7740\u63a7\u4ef6\u6811\u4f9d\u6b21\u5f97\u5230\u56de\u8c03\u3002</p> <ul> <li>\u5e03\u5c40\u7a97\u53e3\u9636\u6bb5\u3002</li> </ul> <p>\u6839\u636e\u9884\u6d4b\u91cf\u7684\u7ed3\u679c\uff0c\u901a\u8fc7IWindowSession.relayout\uff08\uff09\u65b9\u6cd5\u5411WMS\u8bf7\u6c42\u8c03\u6574\u7a97\u53e3\u7684\u5c3a\u5bf8\u7b49\u5c5e\u6027\uff0c\u8fd9\u5c06\u5f15\u53d1WMS\u5bf9\u7a97\u53e3\u8fdb\u884c\u91cd\u65b0\u5e03\u5c40\uff0c\u5e76\u5c06\u5e03\u5c40\u7ed3\u679c\u8fd4\u56de\u7ed9ViewRootImpl\u3002</p> <ul> <li>\u6700\u7ec8\u6d4b\u91cf\u9636\u6bb5\u3002</li> </ul> <p>\u9884\u6d4b\u91cf\u7684\u7ed3\u679c\u662f\u63a7\u4ef6\u6811\u6240\u671f\u671b\u7684\u7a97\u53e3\u5c3a\u5bf8\u3002\u7136\u800c\u7531\u4e8e\u5728WMS\u4e2d\u5f71\u54cd\u7a97\u53e3\u5e03\u5c40\u7684\u56e0\u7d20\u5f88\u591a,WMS\u4e0d\u4e00\u5b9a\u4f1a\u5c06\u7a97\u53e3\u51c6\u786e\u5730\u5e03\u5c40\u4e3a\u63a7\u4ef6\u6811\u6240\u8981\u6c42\u7684\u5c3a\u5bf8,\u800c\u8feb\u4e8eWMS\u4f5c\u4e3a\u7cfb\u7edf\u670d\u52a1\u7684\u5f3a\u52bf\u5730\u4f4d,\u63a7\u4ef6\u6811\u4e0d\u5f97\u4e0d\u63a5\u53d7WMS\u7684\u5e03\u5c40\u7ed3\u679c\u3002\u56e0\u6b64\u5728\u8fd9\u4e2a\u9636\u6bb5,performTraversals()\u5c06\u4ee5\u7a97\u53e3\u7684\u5b9e\u9645\u5c3a\u5bf8\u5bf9\u63a7\u4ef6\u8fdb\u884c\u6700\u7ec8\u6d4b\u91cf\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d,View\u53ca\u5176\u5b50\u7c7b\u7684onMeasure()\u65b9\u6cd5\u5c06\u4f1a\u6cbf\u7740\u63a7\u4ef6\u6811\u4f9d\u6b21\u88ab\u56de\u8c03\u3002</p> <ul> <li>\u5e03\u5c40\u63a7\u4ef6\u6811\u9636\u6bb5\u3002</li> </ul> <p>\u5b8c\u6210\u6700\u7ec8\u6d4b\u91cf\u4e4b\u540e\u4fbf\u53ef\u4ee5\u5bf9\u63a7\u4ef6\u6811\u8fdb\u884c\u5e03\u5c40\u3002\u6d4b\u91cf\u786e\u5b9a\u7684\u662f\u63a7\u4ef6\u7684\u5c3a\u5bf8,\u800c\u5e03\u5c40\u5219\u662f\u786e\u5b9a\u63a7\u4ef6\u7684\u4f4d\u7f6e\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d,View\u53ca\u5176\u5b50\u7c7b\u7684onLayout()\u65b9\u6cd5\u5c06\u4f1a\u88ab\u56de\u8c03\u3002</p> <ul> <li>\u7ed8\u5236\u9636\u6bb5\u3002</li> </ul> <p>\u8fd9\u662fperformTraversals\uff08\uff09\u7684\u6700\u7ec8\u9636\u6bb5\u3002\u786e\u5b9a\u63a7\u4ef6\u7684\u4f4d\u7f6e\u4e0e\u5c3a\u5bf8\u540e\uff0c\u4fbf\u53ef\u4ee5\u5bf9\u63a7\u4ef6\u6811\u8fdb\u884c\u7ed8\u5236\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d\uff0cView\u53ca\u5176\u5b50\u7c7b\u7684onDraw\uff08\uff09\u65b9\u6cd5\u5c06\u4f1a\u88ab\u56de\u8c03\u3002</p> <p>\u8bf4\u4e0bMeasureSpec\u7684\u7406\u89e3</p> \u56de\u7b54 <p>MeasureSpec\u7528\u4e8e\u6307\u5bfc\u63a7\u4ef6\u5bf9\u81ea\u8eab\u8fdb\u884c\u6d4b\u91cf\uff0c \u4ee3\u8868\u4e00\u4e2a32\u4f4dint\u503c\uff0c\u9ad82\u4f4d\u4ee3\u8868SpecMode\uff0c\u4f4e30\u4f4d\u4ee3\u8868SpecSize,SpecMode\u662f\u6307\u6d4b\u91cf\u6a21\u5f0f\uff0c\u800cSpecSize\u662f\u6307\u5728\u67d0\u79cd\u6d4b\u91cf\u6a21\u5f0f\u4e0b\u7684\u89c4\u683c\u5927\u5c0f,\u662f\u7236\u63a7\u4ef6\u5efa\u8bae\u5c3a\u5bf8 \uff0c\u5efa\u8bae\u5c3a\u5bf8\u5bf9\u6d4b\u91cf\u7ed3\u679c\u7684\u5f71\u54cd\u4f9d<code>SPEC_MODE</code>\u7684\u4e0d\u540c\u800c\u4e0d\u540c\u3002<code>SPEC_MODE</code>\u7684\u53d6\u503c\u53d6\u51b3\u4e8e\u6b64\u63a7\u4ef6\u7684<code>LayoutParams.width/height</code>\u7684\u8bbe\u7f6e,\u53ef\u4ee5\u662f\u5982\u4e0b\u4e09\u79cd\u503c\u4e4b\u4e00\u3002</p> <ul> <li> <p>MeasureSpec.UNSPECIFIED(0):\u8868\u793a\u63a7\u4ef6\u5728\u8fdb\u884c\u6d4b\u91cf\u65f6,\u53ef\u4ee5\u65e0\u89c6SPEC_SIZE\u7684\u503c\u3002\u63a7\u4ef6\u53ef\u4ee5\u662f\u5b83\u6240\u671f\u671b\u7684\u4efb\u610f\u5c3a\u5bf8\u3002</p> </li> <li> <p>MeasureSpec.EXACTLY(1):\u8868\u793a\u5b50\u63a7\u4ef6\u5fc5\u987b\u4e3aSPEC_SIZE\u6240\u6307\u5b9a\u7684\u5c3a\u5bf8\u3002\u5f53\u63a7\u4ef6\u7684LayoutParams.width/height\u4e3a\u4e00\u786e\u5b9a\u503c,\u6216\u8005\u662fMATCH_PARENT\u65f6,\u5bf9\u5e94\u7684MeasureSpec\u53c2\u6570\u4f1a\u4f7f\u7528\u8fd9\u4e2aSPEC_MODE\u3002</p> </li> <li> <p>MeasureSpec.AT_MOST(2):\u8868\u793a\u5b50\u63a7\u4ef6\u53ef\u4ee5\u662f\u5b83\u6240\u671f\u671b\u7684\u5c3a\u5bf8,\u4f46\u662f\u4e0d\u5f97\u5927\u4e8eSPEC_SIZE\u3002\u5f53\u63a7\u4ef6\u7684LayoutParams.width/height\u4e3aWRAP_CONTENT\u65f6,\u5bf9\u5e94\u7684MeasureSpec\u53c2\u6570\u4f1a\u4f7f\u7528\u8fd9\u4e2aSPEC_MODE\u3002</p> </li> </ul> <p>\u8bf4\u4e0bCPU\u548cGPU\u7684\u533a\u522b</p> \u56de\u7b54 <ul> <li> <p>CPU\uff08Central Processing Unit\uff0c\u4e2d\u592e\u5904\u7406\u5668\uff09 \u662f\u8ba1\u7b97\u673a\u8bbe\u5907\u6838\u5fc3\u5668\u4ef6\uff0c\u7528\u4e8e\u6267\u884c\u7a0b\u5e8f\u4ee3\u7801\uff1bCPU\u7684\u63a7\u5236\u5668\u8f83\u4e3a\u590d\u6742\uff0c\u800cALU\u6570\u91cf\u8f83\u5c11\u3002\u56e0\u6b64CPU\u64c5\u957f\u5404\u79cd\u590d\u6742\u7684\u903b\u8f91\u8fd0\u7b97\uff0c\u4f46\u4e0d\u64c5\u957f\u6570\u5b66\u5c24\u5176\u662f\u6d6e\u70b9\u8fd0\u7b97</p> </li> <li> <p>GPU\uff08Graphics Processing Unit\uff0c\u56fe\u5f62\u5904\u7406\u5668 \u4e3b\u8981\u7528\u4e8e\u5904\u7406\u56fe\u5f62\u8fd0\u7b97\uff0c\u901a\u5e38\u6240\u8bf4\u201c\u663e\u5361\u201d\u7684\u6838\u5fc3\u90e8\u4ef6\u5c31\u662fGPU\u3002 \u548cCPU\u4e0d\u540c\u7684\u662f\uff0cGPU\u5c31\u662f\u4e3a\u5b9e\u73b0\u5927\u91cf\u6570\u5b66\u8fd0\u7b97\u8bbe\u8ba1\u7684\u3002GPU\u7684\u63a7\u5236\u5668\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u5305\u542b\u4e86\u5927\u91cfALU\u3002GPU\u4e2d\u7684ALU\u4f7f\u7528\u4e86\u5e76\u884c\u8bbe\u8ba1\uff0c\u4e14\u5177\u6709\u8f83\u591a\u6d6e\u70b9\u8fd0\u7b97\u5355\u5143, \u66f4\u64c5\u957f\u6570\u5b66\u8fd0\u7b97</p> </li> </ul> <p>\u63a7\u5236\u5668\uff0c\u7528\u4e8e\u534f\u8c03\u63a7\u5236\u6574\u4e2aCPU\u7684\u8fd0\u884c\uff0c\u5305\u62ec\u53d6\u51fa\u6307\u4ee4\u3001\u63a7\u5236\u5176\u4ed6\u6a21\u5757\u7684\u8fd0\u884c\u7b49</p> <p>ALU\uff08Arithmetic Logic Unit\uff09 \u662f\u7b97\u672f\u903b\u8f91\u5355\u5143\uff0c\u7528\u4e8e\u8fdb\u884c\u6570\u5b66\u3001\u903b\u8f91\u8fd0\u7b97</p> <p>\u8bf4\u4e0b\u786c\u4ef6\u52a0\u901f</p> \u56de\u7b54 <p>\u786c\u4ef6\u52a0\u901f\u76f4\u89c2\u4e0a\u8bf4\u662f\u4f9d\u8d56GPU\u5b9e\u73b0\u56fe\u5f62\u7ed8\u5236\u52a0\u901f\uff0c\u8f6f\u786c\u4ef6\u52a0\u901f\u7684\u533a\u522b\u662f\u6307\u56fe\u5f62\u7ed8\u5236\u7a76\u7adf\u662fGPU\u6765\u5904\u7406\u8fd8\u662fCPU\uff0c\u5982\u679c\u662fGPU\u5c31\u8ba4\u4e3a\u662f\u786c\u4ef6\u52a0\u901f\uff0c\u53cd\u4e4b\u7528CPU\u5c31\u662f\u8f6f\u4ef6\u7ed8\u5236\u3002</p> <p>\u786c\u4ef6\u6e32\u67d3\u60c5\u51b5\u4e0b\uff0capp \u5b58\u5728\u4e3b\u7ebf\u7a0b\u548c\u6e32\u67d3\u7ebf\u7a0b\uff1b\u8f6f\u4ef6\u6e32\u67d3\u60c5\u51b5\u4e0b\uff0c app \u53ea\u6709\u4e3b\u7ebf\u7a0b\u6ca1\u6709\u6e32\u67d3\u7ebf\u7a0b</p> <p>\u786c\u4ef6\u6e32\u67d3\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5c06Canvas\u7684\u7ed8\u5236\u6307\u4ee4(<code>Canvas\u7684drawXxx()</code>)\u7f16\u8bd1\u5e76\u4f18\u5316\u4e3a\u786c\u4ef6\u7ed8\u5236\u6307\u4ee4\u5e8f\u5217(<code>DisplayList</code>),  CPU\u7528\u4e8e\u63a7\u5236\u590d\u6742\u7ed8\u5236\u903b\u8f91\u3001\u6784\u5efa\u6216\u66f4\u65b0DisplayList\uff1bGPU\u7528\u4e8e\u5b8c\u6210\u56fe\u5f62\u8ba1\u7b97\u3001\u6e32\u67d3DisplayList</p> <p>\u786c\u4ef6\u6e32\u67d3\u60c5\u51b5\u4e0b\uff0cApp \u7684\u6027\u80fd\u662f\u8981\u4f18\u4e8e\u8f6f\u4ef6\u6e32\u67d3\u7684</p> <p>\u8bf4\u4e0b\u79bb\u5c4f\u7f13\u5b58(HardwareLayer)</p> \u56de\u7b54 <p>\u5f88\u591a\u4eba\u4f1a\u628a Android \u4e2d\u7684\u786c\u4ef6\u52a0\u901f\u548c Hardware Layer \u641e\u6df7\uff0c\u4f1a\u4ee5\u4e3a\u542f\u7528\u4e86\u786c\u4ef6\u52a0\u901f\uff0c\u5c31\u662f\u542f\u7528\u4e86 Hardware Layer. \u5176\u5b9e\u8fd9\u4e2a\u6982\u5ff5\u4e3b\u8981\u662f\u9488\u5bf9 View \u6765\u8bf4\u7684\uff0c \u4e0e\u6b64\u65f6 App \u662f\u786c\u4ef6\u6e32\u67d3\u8fd8\u662f\u8f6f\u4ef6\u6e32\u67d3\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\uff0c\u4f46\u662f\u4f1a\u6709\u4f9d\u8d56\u5173\u7cfb\u3002</p> <p>\u4e00\u4e2a View \u7684 layerType \u5171\u6709\u4e09\u79cd\u72b6\u6001:</p> <ul> <li> <p>LAYER_TYPE_NONE\uff1a\u9ed8\u8ba4\u72b6\u6001\uff0c\u4e0d\u4f7f\u7528 Hardware Layer\uff0cView \u7684\u7ed8\u5236\u5185\u5bb9\u76f4\u63a5\u7ed8\u5236\u5728\u5c4f\u5e55\u4e0a</p> </li> <li> <p>LAYER_TYPE_SOFTWARE\uff1aSoftware layerType , \u6807\u8bc6\u8fd9\u4e2a View \u6709\u4e00\u4e2a\u8f6f\u4ef6\u5b9e\u73b0\u7684 Layer \uff0c\u600e\u4e48\u4e2a\u8f6f\u4ef6\u5b9e\u73b0\u6cd5\u5462\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u8fd9\u4e2a View\uff0c\u6839\u636e\u4e00\u5b9a\u7684\u6761\u4ef6\uff0c\u53d8\u6210\u4e00\u4e2a Bitmap \u5bf9\u8c61</p> </li> <li> <p>LAYER_TYPE_HARDWARE\uff1aHardware layerType \uff0c\u6807\u8bc6\u8fd9\u4e2a View \u6709\u4e00\u4e2a\u786c\u4ef6\u5b9e\u73b0\u7684 Layer \uff0c\u8fd9\u91cc\u7684\u786c\u4ef6\u6307\u7684\u662f GPU \uff0c\u90a3\u4e48\u786c\u4ef6\u5b9e\u73b0\u7684 Layer \u987e\u540d\u601d\u4e49\u5c31\u662f\u901a\u8fc7 GPU \u6765\u5b9e\u73b0\u7684\uff0c\u901a\u5e38\u662fOpenGL\u786c\u4ef6\u4e0a\u7684 \u5e27\u7f13\u51b2\u5bf9\u8c61\u6216FBO\uff08\u79bb\u5c4f\u6e32\u67d3 Buffer\uff09 \u3002</p> </li> </ul> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc Hardware layerType \u662f\u4f9d\u8d56\u786c\u4ef6\u52a0\u901f\u7684\uff0c\u5982\u679c\u786c\u4ef6\u52a0\u901f\u5f00\u542f\uff0c\u90a3\u4e48\u624d\u4f1a\u6709 FBO \u6216\u8005\u5e27\u7f13\u51b2 \uff1b \u5982\u679c\u786c\u4ef6\u52a0\u901f\u5173\u95ed\uff0c\u90a3\u4e48\u5c31\u7b97\u4f60\u8bbe\u7f6e\u4e00\u4e2a View \u7684 LayerType \u662f Hardware Layer \uff0c\u4e5f\u4f1a\u6309\u7167 Software Layer \u53bb\u505a\u5904\u7406</p> <p>Hardware layer \u7684\u4f5c\u7528\uff1a</p> <ul> <li> <p>\u786c\u4ef6\u5c42\u53ef\u7528\u4e8e\u5c06\u7279\u5b9a\u989c\u8272\u8fc7\u6ee4\u5668\u548c/\u6216\u6df7\u5408\u6a21\u5f0f\u548c/\u6216\u534a\u900f\u660e\u5e94\u7528\u4e8e\u89c6\u56fe\u53ca\u5176\u6240\u6709\u5b50\u89c6\u56fe</p> </li> <li> <p>\u786c\u4ef6\u5c42\u53ef\u7528\u4e8e\u5c06\u590d\u6742\u89c6\u56fe\u6811\u7f13\u5b58\u5230\u7eb9\u7406\u4e2d\uff0c\u5e76\u964d\u4f4e\u7ed8\u5236\u64cd\u4f5c\u7684\u590d\u6742\u6027\u3002 \u4f8b\u5982\uff0c\u5728\u4f7f\u7528\u8f6c\u6362\u52a8\u753b\u590d\u6742\u89c6\u56fe\u6811\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u786c\u4ef6\u5c42\u4ec5\u6e32\u67d3\u89c6\u56fe\u6811\u4e00\u6b21\uff0c\u8fd9\u4e2a\u662f\u6700\u4e3b\u8981\u7684\u4e00\u4e2a\u70b9</p> </li> <li> <p>\u5728\u89c6\u56fe\u4e0a\u5e94\u7528\u65cb\u8f6c\u53d8\u6362\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u786c\u4ef6\u5c42\u6765\u63d0\u9ad8\u6e32\u67d3\u8d28\u91cf\u3002 \u5b83\u8fd8\u53ef\u7528\u4e8e\u5728\u89c6\u56fe\u4e0a\u5e94\u75283D\u53d8\u6362\u65f6\u9632\u6b62\u6f5c\u5728\u7684\u526a\u5207\u95ee\u9898</p> </li> </ul> <p>\u5e94\u7528</p> <p>Hardware Layer \u5bf9 <code>alpha \\ translation \\ scale \\ rotation \\ pivot</code> \u8fd9\u51e0\u4e2a\u5c5e\u6027\u52a8\u753b\u6027\u80fd\u6709\u5e2e\u52a9\uff0c\u8fd9\u4e5f\u662f <code>Hardware Layer</code> \u4f7f\u7528\u6700\u9891\u7e41\u7684\u4f18\u5316  (\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 \uff1a \u5728\u505a\u4e0a\u8ff0\u52a8\u753b\u7684\u65f6\u5019\uff0c\u5728\u52a8\u753b\u5f00\u59cb\u524d\uff0c\u5c06\u8fd9\u4e2a View \u7684 LayerType \u8bbe\u7f6e\u4e3a LAYER_TYPE_HARDWARE \uff0c\u5728\u52a8\u753b\u7ed3\u675f\u540e\uff0c\u5c06 layerType \u91cd\u65b0\u8bbe\u7f6e\u4e3a LAYER_TYPE_NONE , \u8bbe\u7f6e\u56de\u6765\u7684\u539f\u56e0\u662f Hardware Layer \u4f7f\u7528\u7684\u662f \u663e\u5b58(Video Memory)\uff0c\u8bbe\u7f6e\u4e3a NONE \u4e4b\u540e\u8fd9\u90e8\u5206\u4f7f\u7528\u7684\u5185\u5b58\u5c06\u4f1a\u56de\u6536 )</p> <p>\u6ce8\u610f\u5c5e\u6027\u52a8\u753b\u7684\u8fc7\u7a0b\u4e2d( \u6bd4\u5982 AnimationUpdate \u56de\u8c03\u4e2d)\uff0c\u4e0d\u8981\u505a\u9664\u4e86\u4e0a\u8ff0\u5c5e\u6027\u66f4\u65b0\u4e4b\u5916\u7684\u5176\u4ed6\u4e8b\u60c5\uff0c\u6bd4\u5982\u6dfb\u52a0\u5220\u9664\u5b50 View\u3001\u4fee\u6539 View \u7684\u663e\u793a\u5185\u5bb9\u7b49\uff0c\u8fd9\u4f1a\u4f7f\u5f97 <code>FBO</code> \u5931\u6548\uff0c\u6027\u80fd\u53cd\u800c\u53d8\u5dee</p> <p>Software Layer \u662f\u5bf9 Hardware Layer \u7684\u4e00\u4e2a\u8865\u5145\uff0c\u5982\u679c App \u5904\u4e8e\u67d0\u79cd\u60c5\u51b5\u4e0d\u80fd\u4f7f\u7528 Hardware Layer \uff0c\u90a3\u4e48 Software Layer \u5c31\u4f1a\u6d3e\u4e0a\u7528\u573a \u3002 Hardware Layer \u4e0d\u652f\u6301\u7684 API \u7684\u5b9e\u73b0\u4e5f\u5f97\u7528 Software Layer \u6765\u5b9e\u73b0\u3002 \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u4e0a Hardware Layer \u53ef\u80fd\u8981\u505a\u975e\u5e38\u591a\u7684\u5de5\u4f5c\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u6e32\u67d3\u89c6\u56fe\u3002\u7f13\u5b58\u4e00\u4e2a\u5c42\u9700\u8981\u82b1\u8d39\u65f6\u95f4\uff0c\u56e0\u4e3a\u8fd9\u4e00\u6b65\u8981\u5212\u5206\u4e3a\u4e24\u4e2a\u8fc7\u7a0b\uff1a\u9996\u5148\uff0c\u89c6\u56fe\u6e32\u67d3\u5165 GPU \u4e0a\u7684\u4e00\u4e2a\u5c42\u4e2d\uff0c\u7136\u540e\uff0cGPU \u518d\u6e32\u67d3\u90a3\u4e2a\u5c42\u5230\u7a97\u53e3\uff0c\u5982\u679c View \u7684\u6e32\u67d3\u5341\u5206\u7b80\u5355\uff08\u6bd4\u5982\u4e00\u4e2a\u7eaf\u8272\uff09\uff0c\u90a3\u4e48\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u8bbe\u7f6e Hardware Layer \u53ef\u80fd\u589e\u52a0\u4e0d\u5fc5\u8981\u7684\u5f00\u9500</p> <p>\u8bf4\u4e0bRenderThread</p> \u56de\u7b54 <p>\u5728\u8bf4<code>RenderThread</code>\u4e4b\u524d\uff0c \u5148\u8981\u77e5\u9053\u786c\u4ef6\u52a0\u901f\u3002\u542f\u52a8\u786c\u4ef6\u52a0\u901f\u540e\uff0c\u5728 Measure\u3001Layout\u3001Draw \u7684 Draw \u8fd9\u4e2a\u73af\u8282\uff0cAndroid \u4f7f\u7528 DisplayList \u8fdb\u884c\u7ed8\u5236\u800c\u975e\u76f4\u63a5\u4f7f\u7528 CPU \u7ed8\u5236\u6bcf\u4e00\u5e27\u3002DisplayList \u662f\u4e00\u7cfb\u5217\u7ed8\u5236\u64cd\u4f5c\u7684\u8bb0\u5f55\uff0c\u62bd\u8c61\u4e3a <code>RenderNode</code> \u7c7b\uff0c\u8fd9\u6837\u95f4\u63a5\u7684\u8fdb\u884c\u7ed8\u5236\u64cd\u4f5c\u7684\u4f18\u70b9\u5982\u4e0b</p> <ul> <li> <p>DisplayList \u53ef\u4ee5\u6309\u9700\u591a\u6b21\u7ed8\u5236\u800c\u65e0\u987b\u540c\u4e1a\u52a1\u903b\u8f91\u4ea4\u4e92</p> </li> <li> <p>\u7279\u5b9a\u7684\u7ed8\u5236\u64cd\u4f5c\uff08\u5982 translation\uff0c scale \u7b49\uff09\u53ef\u4ee5\u4f5c\u7528\u4e8e\u6574\u4e2a DisplayList \u800c\u65e0\u987b\u91cd\u65b0\u5206\u53d1\u7ed8\u5236\u64cd\u4f5c</p> </li> <li> <p>\u5f53\u77e5\u6653\u4e86\u6240\u6709\u7ed8\u5236\u64cd\u4f5c\u540e\uff0c\u53ef\u4ee5\u9488\u5bf9\u5176\u8fdb\u884c\u4f18\u5316\uff1a\u4f8b\u5982\uff0c\u6240\u6709\u7684\u6587\u672c\u53ef\u4ee5\u4e00\u8d77\u8fdb\u884c\u7ed8\u5236\u4e00\u6b21\u3002</p> </li> <li> <p>\u4ee5\u5c06\u5bf9 display list \u7684\u5904\u7406\u8f6c\u79fb\u81f3\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff08\u975e UI \u7ebf\u7a0b\uff09\u3002</p> </li> </ul> <p>\u6700\u540e\u4e00\u70b9\u6070\u597d\u662f RenderThread \u8d1f\u8d23\u7684\uff1a\u5728 UI \u7ebf\u7a0b\u5916\u6267\u884c\u4f18\u5316\u64cd\u4f5c\u4e0e\u5c06\u7ed8\u5236\u64cd\u4f5c\u5206\u53d1\u7ed9 GPU\u3002</p> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u786c\u4ef6\u52a0\u901f\u662f\u5f00\u542f\u7684\uff0c\u4e3b\u7ebf\u7a0b\u7684 draw \u51fd\u6570\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u6267\u884c drawCall \uff0c\u800c\u662f\u628a\u8981 draw \u7684\u5185\u5bb9\u8bb0\u5f55\u5230 DIsplayList \u91cc\u9762\uff0c\u540c\u6b65\u5230 RenderThread \u4e2d\uff0c\u4e00\u65e6\u540c\u6b65\u5b8c\u6210\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u88ab\u91ca\u653e\u51fa\u6765\u505a\u5176\u4ed6\u7684\u4e8b\u60c5\uff0cRenderThread \u5219\u7ee7\u7eed\u8fdb\u884c\u6e32\u67d3\u5de5\u4f5c:</p> <ol> <li> <p>\u4e0a\u4f20Bitmap\u5230GPU\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09</p> </li> <li> <p>\u5bf9DisplayList\u8fdb\u884c\u4f18\u5316\u3001\u52a0\u5de5</p> </li> <li> <p>\u4e0eSurfaceFlinger\u901a\u4fe1\uff0c\u83b7\u53d6Buffer</p> </li> <li> <p>\u8c03\u7528 OpenGL \u7684\u7ed8\u5236\u63a5\u53e3\uff0c\u6267\u884c\u771f\u6b63\u7684DrawOp</p> </li> <li> <p>\u5c06\u7ed8\u5236\u597d\u7684Buffer swap \u7ed9SurfaceFlinger\u8fdb\u884c\u5408\u6210\uff0c\u7531\u5b83\u8d1f\u8d23\u5c06Buffer\u663e\u793a\u5230\u5c4f\u5e55\u4e0a</p> </li> </ol> <p>\u8bf4\u4e0bInvalidate</p> \u56de\u7b54 <p>invalidate()\u65b9\u6cd5\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c,\u800cscheduleTraversals()\u6240\u5f15\u53d1\u7684\u201c\u904d\u5386\u201d\u4e5f\u662f\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c(\u56e0\u4e3ascheduleTraversals()\u662f\u5411\u4e3b\u7ebf\u7a0b\u7684Handler\u53d1\u9001\u6d88\u606f)\u3002 \u6240\u4ee5 \u8c03\u7528invalidate()\u65b9\u6cd5\u5e76\u4e0d\u4f1a\u4f7f\u5f97\u201c\u904d\u5386\u201d\u7acb\u5373\u5f00\u59cb,\u8fd9\u662f\u56e0\u4e3a\u5728\u8c03\u7528invalidate()\u7684\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\u4e4b\u524d(\u51c6\u786e\u5730\u8bf4\u662f\u4e3b\u7ebf\u7a0b\u7684Looper\u5904\u7406\u5b8c\u5176\u4ed6\u6d88\u606f\u4e4b\u524d),\u4e3b\u7ebf\u7a0b\u6839\u672c\u6ca1\u6709\u673a\u4f1a\u5904\u7406scheduleTraversals()\u6240\u53d1\u51fa\u7684\u6d88\u606f\u3002 \u8fd9\u79cd\u673a\u5236\u5e26\u6765\u7684\u597d\u5904\u662f:</p> <ul> <li> <p>\u5728\u4e00\u4e2a\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u8fde\u7eed\u8c03\u7528\u591a\u4e2a\u63a7\u4ef6\u7684invalidate()\u65b9\u6cd5,\u800c\u4e0d\u7528\u62c5\u5fc3\u4f1a\u7531\u4e8e\u591a\u6b21\u91cd\u7ed8\u800c\u4ea7\u751f\u7684\u7684\u6548\u7387\u95ee\u9898\u3002</p> </li> <li> <p>\u53e6\u5916,\u591a\u6b21\u8c03\u7528invalidate()\u65b9\u6cd5\u4f1a\u4f7f\u5f97ViewRootImpl\u591a\u6b21\u63a5\u6536\u5230\u8bbe\u7f6e\u810f\u533a\u57df\u7684\u8bf7\u6c42,ViewRootImpl\u4f1a\u5c06\u8fd9\u4e9b\u810f\u533a\u57df\u7d2f\u52a0\u5230mDirty\u4e2d,\u8fdb\u800c\u5728\u968f\u540e\u7684\u201c\u904d\u5386\u201d\u4e2d\u4e00\u6b21\u6027\u5730\u5b8c\u6210\u6240\u6709\u810f\u533a\u57df\u7684\u91cd\u7ed8\u3002</p> </li> </ul> <p>View.invalidate()\u5728\u56de\u6eaf\u5230ViewRootImpl\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5c06\u6cbf\u9014\u7684\u63a7\u4ef6\u6807\u8bb0\u4e3a\u810f\u7684,\u4e5f\u5c31\u662f\u5c06<code>PFLAG_DIRTY</code>\u6216<code>PFLAG_DIRTY_OPAQUE</code>\u4e24\u8005\u4e4b\u4e00\u6dfb\u52a0\u5230<code>View.mPrivateFlags</code>\u6210\u5458\u4e2d\u3002 \u4e24\u8005\u90fd\u8868\u793a\u63a7\u4ef6\u9700\u8981\u968f\u540e\u8fdb\u884c\u91cd\u7ed8,\u4e0d\u8fc7\u4e8c\u8005\u5728\u91cd\u7ed8\u6548\u7387\u4e0a\u6709\u533a\u522b\u3002 \u5728invalidate()\u7684\u8fc7\u7a0b\u4e2d,\u5982\u679c\u63a7\u4ef6\u662f\u201c\u5b9e\u5fc3\u201d\u7684,\u5219\u4f1a\u5c06\u6b64\u63a7\u4ef6\u6807\u8bb0\u4e3a<code>PFLAG_DIRTY_OPAQUE</code>,\u5426\u5219\u4e3a<code>PFLAG_DIRTY</code>\u3002 \u63a7\u4ef6\u7cfb\u7edf\u5728\u91cd\u7ed8\u8fc7\u7a0b\u4e2d\u533a\u5206\u8fd9\u4e24\u79cd\u6807\u8bb0\u4ee5\u51b3\u5b9a\u662f\u5426\u4e3a\u6b64\u63a7\u4ef6\u7ed8\u5236\u80cc\u666f\u3002\u5bf9\u201c\u5b9e\u5fc3\u201d\u63a7\u4ef6\u6765\u8bf4,\u5176\u80cc\u666f\u662f\u88abonDraw()\u7684\u5185\u5bb9\u5b8c\u5168\u906e\u6321\u7684,\u56e0\u6b64\u4fbf\u53ef\u8df3\u8fc7\u80cc\u666f\u7684\u7ed8\u5236\u5de5\u4f5c\u4ece\u800c\u63d0\u9ad8\u6548\u7387\u3002</p> <p>View\u6709\u4e00\u4e2a\u65b9\u6cd5isOpaque()\u4f9b\u5176\u5b50\u7c7b\u8fdb\u884c\u91cd\u5199,\u7528\u4e8e\u901a\u8fc7\u8fd4\u56de\u503c\u786e\u8ba4\u6b64\u63a7\u4ef6\u662f\u5426\u4e3a\u201c\u5b9e\u5fc3\u201d\u7684\u3002\u6240\u8c13\u7684\u201c\u5b9e\u5fc3\u201d\u63a7\u4ef6,\u662f\u6307\u5728\u5176onDraw()\u65b9\u6cd5\u4e2d\u80fd\u591f\u4fdd\u8bc1\u6b64\u63a7\u4ef6\u7684\u6240\u6709\u533a\u57df\u90fd\u4f1a\u88ab\u5176\u6240\u7ed8\u5236\u7684\u5185\u5bb9\u5b8c\u5168\u8986\u76d6\u3002\u6362\u53e5\u8bdd\u8bf4,\u900f\u8fc7\u6b64\u63a7\u4ef6\u6240\u5c5e\u7684\u533a\u57df\u65e0\u6cd5\u770b\u5230\u6b64\u63a7\u4ef6\u4e4b\u4e0b\u7684\u5185\u5bb9,\u4e5f\u5c31\u662f\u65e2\u6ca1\u6709\u534a\u900f\u660e\u4e5f\u6ca1\u6709\u7a7a\u7f3a\u7684\u90e8\u5206\u3002</p> <p>invalidate()\u8be5\u65b9\u6cd5\u9012\u5f52\u8c03\u7528\u7236View\u7684invalidateChildInParent()\u65b9\u6cd5\uff0c\u76f4\u5230\u8c03\u7528ViewRootImpl\u7684invalidateChildInParent()\u65b9\u6cd5\uff0c\u6700\u7ec8\u89e6\u53d1ViewRootImpl\u7684performTraversals()\u65b9\u6cd5\uff0c\u4ece\u800c\u89e6\u53d1View\u7684draw()\u65b9\u6cd5\u3002</p> <p><pre><code>private void draw(boolean fullRedrawNeeded) {\n...\nif (!dirty.isEmpty() || mIsAnimating || accessibilityFocusDirty) {\n&lt;!--\u5173\u952e\u70b91 \u662f\u5426\u5f00\u542f\u786c\u4ef6\u52a0\u901f-- if (mAttachInfo.mHardwareRenderer != null &amp;&amp; mAttachInfo.mHardwareRenderer.isEnabled()) {\n...\ndirty.setEmpty();\nmBlockResizeBuffer = false;\n&lt;!--\u5173\u952e\u70b92 \u786c\u4ef6\u52a0\u901f\u7ed8\u5236-- mAttachInfo.mHardwareRenderer.draw(mView, mAttachInfo, this);\n} else {\n...\n&lt;!--\u5173\u952e\u70b93 \u8f6f\u4ef6\u7ed8\u5236-- if (!drawSoftware(surface, mAttachInfo, xOffset, yOffset, scalingRequired, dirty)) {\nreturn;\n}\n...\n</code></pre> \u5173\u952e\u70b91\u662f\u542f\u7528\u786c\u4ef6\u52a0\u901f\u7684\u6761\u4ef6\uff0c\u5fc5\u987b\u652f\u6301\u786c\u4ef6\u5e76\u4e14\u5f00\u542f\u4e86\u786c\u4ef6\u52a0\u901f\u624d\u53ef\u4ee5\uff0c\u6ee1\u8db3\uff0c\u5c31\u5229\u7528 HardwareRenderer.draw\uff0c\u5426\u5219 drawSoftware\uff08\u8f6f\u4ef6\u7ed8\u5236\uff09</p> <p>drawSoftware</p> <p>drawSoftware()\u4e3b\u8981\u67094\u6b65\u5de5\u4f5c:</p> <ol> <li> <p>\u901a\u8fc7Surface.lockCanvas()\u83b7\u53d6\u4e00\u4e2a\u7528\u4e8e\u7ed8\u5236\u7684Canvas\u3002</p> </li> <li> <p>\u5bf9Canvas\u8fdb\u884c\u53d8\u6362\u4ee5\u5b9e\u73b0\u6eda\u52a8\u6548\u679c\u3002</p> </li> <li> <p>\u901a\u8fc7mView.draw()\u5c06\u6839\u63a7\u4ef6\u7ed8\u5236\u5728Canvas\u4e0a\u3002</p> </li> <li> <p>\u901a\u8fc7Surface.unlockCanvasAndPost()\u663e\u793a\u7ed8\u5236\u540e\u7684\u5185\u5bb9\u3002</p> </li> </ol> <p>\u5176\u4e2d draw()\u4e3b\u8981\u6267\u884c\u4ee5\u4e0b\u5de5\u4f5c</p> <ul> <li> <p>\u7ed8\u5236\u80cc\u666f,\u6ce8\u610f\u80cc\u666f\u4e0d\u4f1a\u53d7\u5230\u6eda\u52a8\u7684\u5f71\u54cd\u3002</p> </li> <li> <p>\u901a\u8fc7\u8c03\u7528onDraw()\u65b9\u6cd5\u7ed8\u5236\u63a7\u4ef6\u81ea\u8eab\u7684\u5185\u5bb9</p> </li> <li> <p>\u901a\u8fc7\u8c03\u7528dispatchDraw()\u7ed8\u5236\u5176\u5b50\u63a7\u4ef6\u3002</p> </li> <li> <p>\u7ed8\u5236\u63a7\u4ef6\u7684\u88c5\u9970,\u5373\u6eda\u52a8\u6761     </p> </li> </ul> <p>HardwareRender.draw</p> <ul> <li>\u83b7\u53d6Canvas\u3002</li> </ul> <p>\u4e0d\u540c\u4e8e\u8f6f\u4ef6\u7ed8\u5236\u65f6\u7528Surface.lockCanvas()\u65b0\u5efa\u4e00\u4e2aCanvas,HardwareCanvas\u5728HardwareRenderer\u521b\u5efa\u4e4b\u521d\u4fbf\u5df2\u88ab\u521b\u5efa\u5e76\u7ed1\u5b9a\u5728\u7531Surface\u521b\u5efa\u7684EGLSurface\u4e0a\u3002</p> <ul> <li>\u5bf9Canvas\u8fdb\u884c\u53d8\u6362\u4ee5\u5b9e\u73b0\u6eda\u52a8\u6548\u679c\u3002</li> </ul> <p>\u7531\u4e8e\u786c\u4ef6\u7ed8\u5236\u7684\u8fc7\u7a0b\u4f4d\u4e8eHardwareRenderer\u5185\u90e8,\u56e0\u6b64ViewRootImpl\u9700\u8981\u5728onHardwarePreDraw()\u56de\u8c03\u4e2d\u5b8c\u6210\u8fd9\u4e2a\u64cd\u4f5c\u3002</p> <ul> <li>\u7ed8\u5236\u63a7\u4ef6\u5185\u5bb9\u3002</li> </ul> <p>\u8fd9\u662f\u786c\u4ef6\u52a0\u901f\u7ed8\u5236\u4e0e\u8f6f\u4ef6\u7ed8\u5236\u6700\u6839\u672c\u7684\u533a\u522b\u3002\u8f6f\u4ef6\u7ed8\u5236\u662f\u901a\u8fc7View.draw()\u4ee5\u9012\u5f52\u7684\u65b9\u5f0f\u5c06\u6574\u4e2a\u63a7\u4ef6\u6811\u7528\u7ed9\u5b9a\u7684Canvas\u76f4\u63a5\u7ed8\u5236\u5728Surface\u4e0a\u3002\u800c\u786c\u4ef6\u52a0\u901f\u7ed8\u5236\u5219\u5148\u901a\u8fc7View.getDisplayList()\u83b7\u53d6\u6839\u63a7\u4ef6\u7684DisplayList,\u7136\u540e\u518d\u5c06\u8fd9\u4e2aDisplayList\u7ed8\u5236\u5728Surface\u4e0a\u3002\u901a\u8fc7View.getDisplayList()\u6240\u83b7\u53d6\u7684DisplayList\u4e2d\u5305\u542b\u4e86\u5df2\u7f16\u8bd1\u8fc7\u7684\u7528\u4e8e\u7ed8\u5236\u6574\u4e2a\u63a7\u4ef6\u6811\u7684\u7ed8\u56fe\u6307\u4ee4\u3002\u5982\u679c\u8bf4\u8f6f\u4ef6\u7ed8\u5236\u662f\u76f4\u63a5\u7ed8\u5236,\u90a3\u4e48\u786c\u4ef6\u52a0\u901f\u7ed8\u5236\u5219\u662f\u901a\u8fc7\u8fc7DisplayList\u95f4\u63a5\u7ed8\u5236\u3002</p> <ul> <li>\u5c06\u7ed8\u5236\u7ed3\u679c\u663e\u793a\u51fa\u6765\u3002</li> </ul> <p>\u786c\u4ef6\u52a0\u901f\u7ed8\u5236\u901a\u8fc7sEgl.swapBuffers()\u5c06\u7ed8\u5236\u5185\u5bb9\u663e\u793a\u51fa\u6765\u3002\u5176\u672c\u8d28\u4e0eSurface.unlockCanvasAndPost()\u65b9\u6cd5\u4e00\u81f4,\u90fd\u662f\u901a\u8fc7ANativeWindow::queueBuffer()\u5c06\u7ed8\u5236\u5185\u5bb9\u53d1\u5e03\u7ed9SurfaceFlinger\u3002</p> <p>requestLayout()\u3001invalidate()\u4e0epostInvalidate()\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> \u56de\u7b54 <p>invalidate() &amp;postInvalidate()</p> <ul> <li> <p>invalidate()\u8be5\u65b9\u6cd5\u9012\u5f52\u8c03\u7528\u7236View\u7684invalidateChildInParent()\u65b9\u6cd5\uff0c\u76f4\u5230\u8c03\u7528ViewRootImpl\u7684invalidateChildInParent()\u65b9\u6cd5\uff0c\u6700\u7ec8\u89e6\u53d1ViewRootImpl\u7684performTraversals()\u65b9\u6cd5\uff0c\u6b64\u65f6mLayoutRequestede\u4e3afalse\uff0c\u4e0d\u4f1a\u89e6\u53d1onMesaure()\u4e0eonLayout()\u65b9\u6cd5\uff0c\u6709\u53ef\u80fd\u4f1a\u89e6\u53d1onDraw()\u65b9\u6cd5\u3002</p> </li> <li> <p>\u5171\u540c\u70b9\uff1a\u90fd\u662f\u8c03\u7528onDraw()\u65b9\u6cd5\uff0c\u7136\u540e\u53bb\u8fbe\u5230\u91cd\u7ed8view\u7684\u76ee\u7684</p> </li> <li> <p>\u533a\u522b\uff1ainvalidate()\u7528\u4e8e\u4e3b\u7ebf\u7a0b\uff0cpostInvalidate()\u53ef\u4ee5\u5728UI\u7ebf\u7a0b\u8c03\u7528\uff0c\u4e5f\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8c03\u7528\uff0cpostInvalidate()\u65b9\u6cd5\u5185\u90e8\u901a\u8fc7Handler\u53d1\u9001\u4e86\u4e00\u4e2a\u6d88\u606f\u5c06\u7ebf\u7a0b\u5207\u56de\u5230UI\u7ebf\u7a0b\u901a\u77e5\u91cd\u65b0\u7ed8\u5236\uff0c\u5e76\u4e0d\u662f\u8bf4postInvalidate()\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u66f4\u65b0UI,\u672c\u8d28\u4e0a\u8fd8\u662f\u5728UI\u7ebf\u7a0b\u53d1\u751f\u91cd\u7ed8\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u4f7f\u7528postInvalidate()\u5b83\u5185\u90e8\u4f1a\u5e2e\u6211\u4eec\u5207\u6362\u7ebf\u7a0b</p> </li> </ul> <p>requestLayout()</p> <ul> <li> <p>\u8be5\u65b9\u6cd5\u4f1a\u9012\u5f52\u8c03\u7528\u7236\u7a97\u53e3\u7684requestLayout()\u65b9\u6cd5\uff0c\u76f4\u5230\u89e6\u53d1ViewRootImpl\u7684performTraversals()\u65b9\u6cd5\uff0c\u6b64\u65f6mLayoutRequestede\u4e3atrue\uff0c\u4f1a\u89e6\u53d1onMesaure()\u4e0eonLayout()\u65b9\u6cd5\uff0c\u4e0d\u4e00\u5b9a\u4f1a\u89e6\u53d1onDraw()\u65b9\u6cd5\u3002</p> </li> <li> <p>\u5f53view\u786e\u5b9a\u81ea\u8eab\u5df2\u7ecf\u4e0d\u518d\u9002\u5408\u73b0\u6709\u7684\u533a\u57df\u65f6\uff0c\u8be5view\u672c\u8eab\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u8981\u6c42parent view(\u7236\u7c7b\u7684\u89c6\u56fe)\u91cd\u65b0\u8c03\u7528\u4ed6\u7684onMeasure\u3001onLayout\u6765\u91cd\u65b0\u8bbe\u7f6e\u81ea\u5df1\u4f4d\u7f6e\u3002 \u7279\u522b\u662f\u5f53view\u7684layoutparameter\u53d1\u751f\u6539\u53d8\uff0c\u5e76\u4e14\u5b83\u7684\u503c\u8fd8\u6ca1\u80fd\u5e94\u7528\u5230view\u4e0a\u65f6\uff0c\u8fd9\u65f6\u5019\u9002\u5408\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5requestLayout()\u3002requestLayout\u8c03\u7528onMeasure\u548conLayout\uff0c\u4e0d\u4e00\u5b9a\u8c03\u7528onDraw</p> </li> </ul> <p>requestLayout()\u4f55\u65f6\u4e0d\u4f1a\u89e6\u53d1onDraw()\uff1f</p> <ul> <li>\u5982\u679c\u6ca1\u6709\u6539\u53d8\u63a7\u4ef6\u7684<code>left\\right\\top\\bottom</code>\u5c31\u4e0d\u4f1a\u89e6\u53d1onDraw()</li> </ul> <p>invalidate()\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u89e6\u53d1onDraw\uff1f</p> <ul> <li>\u5728ViewGroup\u4e2d\uff0cinvalidate\u9ed8\u8ba4\u4e0d\u91cd\u65b0\u7ed8\u5236\u5b50view\u3002</li> </ul> <p>\u5982\u4f55\u8ba9ViewGroup\u5728invalidate\u65f6\u4f1a\u89e6\u53d1onDraw\uff1f</p> <ul> <li>\u672c\u8d28\u9700\u8981\u5c06ViewGroup\u7684dirtyOpaque\u8bbe\u7f6e\u4e3afalse<ul> <li>1.\u5728\u6784\u9020\u51fd\u6570\u4e2d\u8c03\u7528setWillNotDraw(false);</li> <li>2.\u7ed9ViewGroup\u8bbe\u7f6e\u80cc\u666f\u3002\u8c03\u7528setBackground\u3002</li> </ul> </li> </ul> <p>getWidth()\u65b9\u6cd5\u548cgetMeasureWidth()\u533a\u522b\u5462\uff1f\u4e3a\u4ec0\u4e48\u6709\u65f6\u5019\u7528getWidth()\u6216\u8005getMeasureWidth()\u5f97\u52300\uff1f</p> \u56de\u7b54 <p>getMeasureWidth()</p> <p>getMeasureWidth()\u65b9\u6cd5\u5728measure()\u8fc7\u7a0b\u7ed3\u675f\u540e\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u4e86\uff0c\u53e6\u5916\uff0cgetMeasureWidth()\u65b9\u6cd5\u4e2d\u7684\u503c\u662f\u901a\u8fc7setMeasuredDimension()\u65b9\u6cd5\u6765\u8fdb\u884c\u8bbe\u7f6e\u7684</p> <p>getWidth()</p> <p>getWidth()\u65b9\u6cd5\u8981\u5728layout()\u8fc7\u7a0b\u7ed3\u675f\u540e\u624d\u80fd\u83b7\u53d6\u5230\uff0cgetWidth()\u65b9\u6cd5\u4e2d\u7684\u503c\u5219\u662f\u901a\u8fc7\u89c6\u56fe\u53f3\u8fb9\u7684\u5750\u6807\u51cf\u53bb\u5de6\u8fb9\u7684\u5750\u6807\u8ba1\u7b97\u51fa\u6765\u7684\u3002</p> <p>\u4e3a\u4ec0\u4e48\u6709\u65f6\u5019\u7528getWidth()\u6216\u8005getMeasureWidth()\u5f97\u52300</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u5728Activity\u7684<code>onCreate</code>\u8c03\u7528<code>setContentView</code>\u6765\u521d\u59cb\u5316view\uff0c\u901a\u8fc7\u5206\u6790<code>setContentView</code>\u6e90\u7801\u53ef\u4ee5\u77e5\u9053\uff0c\u6700\u7ec8\u5176\u4f1a\u8c03\u7528\u5230<code>requestLayout</code>, \u5176\u4f1a\u8c03\u7528<code>scheduleTraversals</code>,\u4ece\u800c\u6267\u884c\u63a7\u4ef6\u7684\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236\uff0c\u800c<code>scheduleTraversals()</code>\u662f\u5411\u4e3b\u7ebf\u7a0b\u7684Handler\u53d1\u9001\u6d88\u606f\uff0c\u6240\u4ee5\u5728\u4e3b\u7ebf\u7a0b\u7684Looper\u5904\u7406\u5b8c\u5176\u4ed6\u6d88\u606f\u4e4b\u524d\uff0c,\u4e3b\u7ebf\u7a0b\u6839\u672c\u6ca1\u6709\u673a\u4f1a\u5904\u7406<code>scheduleTraversals()</code>\u6240\u53d1\u51fa\u7684\u6d88\u606f\uff0c\u6240\u4ee5\u65e0\u6cd5\u4fdd\u8bc1Activity\u6267\u884c\u4e86onCreate()\u3001onStart()\u3001onResume()\u65f6\u67d0\u4e2aView\u5df2\u7ecf\u6d4b\u91cf\u5b8c\u6bd5\u4e86\uff0c\u5982\u679cView\u8fd8\u6ca1\u6709\u6d4b\u91cf\u5b8c\u6bd5\uff0c\u90a3\u4e48\u83b7\u5f97\u5bbd\uff0f\u9ad8\u5c31\u662f\uff10</p> <p>\u83b7\u5f97View\u5bbd\u9ad8\u7684\u529e\u6cd5</p> \u56de\u7b54 <p>onWindowFocusChanged</p> <p>View\u5df2\u7ecf\u521d\u59cb\u5316\u5b8c\u6bd5\uff0c\u53ef\u4ee5\u83b7\u5f97\u5bbd\u9ad8\uff1bActivity\u5f97\u5230\u7126\u70b9\u548c\u5931\u53bb\u7126\u70b9\u5747\u4f1a\u8c03\u7528\u4e00\u6b21(\u9891\u7e41onResume\u548conPause\u4f1a\u5bfc\u81f4\u9891\u7e41\u8c03\u7528)</p> <p>view.post(runnable)</p> <p>\u901a\u8fc7post\u5c06\u4e00\u4e2arunnable\u6295\u9012\u5230\u6d88\u606f\u961f\u5217\u5c3e\u90e8\uff1b\u7b49\u5230Looper\u8c03\u7528\u6b21runnable\u65f6\uff0cView\u5df2\u7ecf\u5b8c\u6210\u521d\u59cb\u5316</p> <p>ViewTreeObserver</p> <p>\u4f7f\u7528ViewTreeObserver\u7684\u63a5\u53e3\uff0c\u53ef\u4ee5\u5728View\u6811\u72b6\u6001\u6539\u53d8\u6216\u8005View\u6811\u5185\u90e8View\u7684\u53ef\u89c1\u6027\u6539\u53d8\u65f6\uff0conGlobalLayout\u4f1a\u88ab\u56de\u8c03\uff1b\u80fd\u6b63\u786e\u83b7\u53d6View\u5bbd/\u9ad8</p> <p>view.measure</p> <p>\u81ea\u5b9a\u4e49View\u7684\u6ce8\u610f\u4e8b\u9879</p> \u56de\u7b54 <ul> <li> <p>\u4e0d\u5e94\u8be5\u5728onDraw\u505a\u5185\u5b58\u5206\u914d\u7684\u4e8b\u60c5\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bfc\u81f4GC\uff0c\u4ece\u800c\u5bfc\u81f4\u5361\u987f</p> </li> <li> <p>View\u9700\u8981\u652f\u6301wrap_content\u3001padding</p> </li> <li> <p>ViewGroup\u9700\u8981\u652f\u6301\u5b50View\u7684margin\u548c\u81ea\u8eab\u7684padding</p> </li> <li> <p>\u5c3d\u91cf\u4e0d\u8981\u5728View\u4e2d\u4f7f\u7528Handler\uff0cView\u5df2\u7ecf\u6709post\u7cfb\u5217\u65b9\u6cd5</p> </li> <li> <p>View\u5982\u679c\u6709\u7ebf\u7a0b\u6216\u8005\u52a8\u753b\uff0c\u9700\u8981\u53ca\u65f6\u505c\u6b62(onDetachedFromWindow\u4f1a\u5728View\u88abremove\u65f6\u8c03\u7528)\u2014\u2014\u907f\u514d\u5185\u5b58\u6cc4\u9732</p> </li> <li> <p>View\u5982\u679c\u6709\u6ed1\u52a8\u5d4c\u5957\u60c5\u5f62\uff0c\u9700\u8981\u5904\u7406\u597d\u6ed1\u52a8\u51b2\u7a81</p> </li> </ul> <p>\u8bf4\u4e0bSurfaceView</p> \u56de\u7b54 <p>SurfaceView\u548cView\u533a\u522b\uff1a</p> <p>SurfaceView\u7b2c\u4e00\u5370\u8c61\u5b83\u662f\u4e00\u4e2aview\uff0c\u56e0\u4e3a\u5b83\u7ee7\u627f\u4e86View\uff0c\u6709\u4e24\u4e2a\u76f4\u63a5\u5b50\u7c7bGLSurfaceView,VideoView\u3002\u4f46SurfaceView\u548c\u666e\u901a\u7684view\u53c8\u6709\u8f83\u5927\u533a\u522b\u3002</p> <p>\u6700\u663e\u8457\u7684\u533a\u522b\u5c31\u662f\u666e\u901aview\u548c\u5b83\u7684\u5bbf\u4e3b\u7a97\u53e3\u5171\u4eab\u4e00\u4e2a\u7ed8\u56fe\u8868\u9762\uff08Surface\uff09\uff0cSurfaceView\u867d\u7136\u4e5f\u5728View\u7684\u6811\u5f62\u7ed3\u6784\u4e2d\uff0c\u4f46\u662f\u5b83\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u7ed8\u56fe\u8868\u9762\uff0cSurface \u5185\u90e8\u6301\u6709\u4e00\u4e2aCanvas\uff0c\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2aCanvas\u7ed8\u5236\u3002</p> <p>SurfaceView\u63d0\u4f9b\u4e00\u4e2a\u76f4\u63a5\u7684\u7ed8\u56fe\u8868\u9762\uff08Surface\uff09\u5d4c\u5165\u5230\u89c6\u56fe\u7ed3\u6784\u5c42\u6b21\u4e2d\u3002\u4f60\u53ef\u4ee5\u63a7\u5236\u8fd9\u4e2aSurface\u7684\u683c\u5f0f\uff0c\u5927\u5c0f\uff0cSurfaceView\u8d1f\u8d23\u5728\u5c4f\u5e55\u4e0a\u6b63\u786e\u7684\u6446\u653eSurface\u3002\u7b80\u5355\u8bf4\u5c31\u662fSurfaceView\u62e5\u6709\u81ea\u5df1\u7684Surface\uff0c\u5b83\u4e0e\u5bbf\u4e3b\u7a97\u53e3\u662f\u5206\u79bb\u7684\u3002</p> <p>\u6211\u4eec\u77e5\u9053\u7a97\u53e3\u4e2d\u7684view\u5171\u4eab\u4e00\u4e2awindow\uff0cwindow\u53c8\u5bf9\u5e94\u4e00\u4e2aSurface\uff0c\u6240\u4ee5\u7a97\u53e3\u4e2d\u7684view\u5171\u4eab\u4e00\u4e2aSurface\uff0c\u800cSurfaceView\u62e5\u6709\u81ea\u5df1\u7684Surface\u3002SurfaceView\u4f1a\u521b\u5efa\u4e00\u4e2a\u7f6e\u4e8e\u5e94\u7528\u7a97\u53e3\u4e4b\u540e\u7684\u65b0\u7a97\u53e3\uff0cSurfaceView\u76f8\u5f53\u4e8e\u5728Window\u4e0a\u6316\u4e00\u4e2a\u6d1e\uff0c\u5b83\u5c31\u662f\u663e\u793a\u5728\u8fd9\u4e2a\u6d1e\u91cc\uff0c\u5176\u4ed6\u7684View\u662f\u663e\u793a\u5728Window\u4e0a\uff0c\u6240\u4ee5View\u53ef\u4ee5\u663e\u793a\u5728 SurfaceView\u4e4b\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e9b\u5c42\u5728SurfaceView\u4e4b\u4e0a\u3002</p> <p>SurfaceView\u7684\u7a97\u53e3\u5237\u65b0\u7684\u65f6\u5019\u4e0d\u9700\u8981\u91cd\u7ed8\u5e94\u7528\u7a0b\u5e8f\u7684\u7a97\u53e3\u800candroid\u666e\u901a\u7a97\u53e3\u7684\u89c6\u56fe\u7ed8\u5236\u673a\u5236\u662f\u4e00\u5c42\u4e00\u5c42\u7684\uff0c\u4efb\u4f55\u4e00\u4e2a\u5b50\u5143\u7d20\u6216\u8005\u662f\u5c40\u90e8\u7684\u5237\u65b0\u90fd\u4f1a\u5bfc\u81f4\u6574\u4e2a\u89c6\u56fe\u7ed3\u6784\u5168\u90e8\u91cd\u7ed8\u4e00\u6b21\u3002</p> <p>\u5bf9\u4e8e\u666e\u901a\u7684view\uff0cAndroid\u4e2d\u7684\u7a97\u53e3\u754c\u9762\u5305\u62ec\u591a\u4e2aView\u7ec4\u6210\u7684View Hierachy\u7684\u6811\u5f62\u7ed3\u6784\uff0c\u53ea\u6709\u6700\u9876\u5c42\u7684DecorView\u624d\u5bf9WMS\u53ef\u89c1\uff0c\u8fd9\u4e2aDecorView\u5728WMS\u4e2d\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684WindowState\uff0c\u6b64\u65f6APP\u8bf7\u6c42\u521b\u5efaSurface\u65f6\uff0c\u4f1a\u5728SurfaceFlinger\u5185\u90e8\u5efa\u7acb\u5bf9\u5e94\u7684Layer\u3002\u800c\u5bf9\u4e8eSurfaceView\u5b83\u81ea\u5e26\u4e00\u4e2aSurface\uff0c\u8fd9\u4e2aSurface\u5728WMS\u6709\u81ea\u5df1\u5bf9\u5e94\u7684WindowState\uff0c\u5728SurfaceFlinger\u4e2d\u6709\u81ea\u5df1\u5bf9\u5e94\u7684layer\u3002SurfaceView\u4eceAPP\u7aef\u770b\u5b83\u4ecd\u7136\u5728View hierachy\u7ed3\u6784\u4e2d\uff0c\u4f46\u5728WMS\u548cSurfaceFlinger\u4e2d\u5b83\u4e0e\u5bbf\u4e3b\u7a97\u53e3\u662f\u5206\u79bb\u7684\u3002\u56e0\u6b64SurfaceView\u7684Surface\u7684\u6e32\u67d3\u53ef\u4ee5\u653e\u5230\u5355\u72ec\u7ebf\u7a0b\u53bb\u505a\uff0c\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u5bf9\u4e8b\u4ef6\u7684\u54cd\u5e94\u3002\u4f46\u56e0\u4e3a\u8fd9\u4e2aSurface\u4e0d\u5728View hierachy\u4e2d\uff0c\u5b83\u7684\u663e\u793a\u4e5f\u4e0d\u53d7View\u7684\u5c5e\u6027\u63a7\u5236\uff0c\u6240\u4ee5\u4e0d\u80fd\u8fdb\u884c\u5e73\u79fb\uff0c\u7f29\u653e\u7b49\u53d8\u6362\uff08\u5bf9SurfaceView\u8fdb\u884cScrollBy\uff0cScrollTo\u64cd\u4f5c\u6ca1\u6709\u6548\u679c\uff08\u8fd8\u6709\u900f\u660e\u5ea6\uff0c\u65cb\u8f6c\uff09\uff0c\u666e\u901aView\u8fdb\u884c\u5e73\u79fb\u64cd\u4f5c\uff0c\u5185\u90e8\u5185\u5bb9\u4f1a\u79fb\u52a8\uff0cSurfaceView\u8fdb\u884c\u8fd9\u4e9b\u64cd\u4f5c\u5185\u90e8\u4e0d\u4f1a\u79fb\u52a8\u3002\u5982\u679c\u5bf9\u5305\u88f9\u5b83\u7684ViewGroup\u8fdb\u884c\u5e73\u79fb\u65cb\u8f6c\u7b49\u64cd\u4f5c\uff0c\u4e5f\u65e0\u6cd5\u8fbe\u5230\u6211\u4eec\u60f3\u8981\u7684\u6548\u679c\u3002\u540c\u65f6SurfaceView\u4e0d\u80fd\u653e\u5728\u7c7b\u4f3cRecyclerView\u6216ScrollView\u4e2d\uff0c\u4e00\u4e9bView\u4e2d\u7684\u7279\u6027\u4e5f\u65e0\u6cd5\u4f7f\u7528\u3002</p> <p>SurfaceView\u4e0d\u652f\u6301\u5e73\u79fb\uff0c\u7f29\u653e\uff0c\u65cb\u8f6c\u7b49\u52a8\u753b\uff0c\u4f46\u662f\u5f53\u6211\u4eec\u5229\u7528SurfaceView\u6d4b\u8bd5\u8fd9\u4e9b\u4e0d\u652f\u6301\u7684\u52a8\u753b\u65f6\uff0c\u5982\u679c\u4f7f\u7528\u7684\u662f7.0 \u751a\u81f3\u66f4\u9ad8\u7248\u672c\u7684Android\u7cfb\u7edf\uff0c\u4f1a\u53d1\u73b0SurfaceView\u4e5f\u652f\u6301\u5e73\u79fb\uff0c\u7f29\u653e\u7684\u52a8\u753b\u64cd\u4f5c\u3002 </p> <p>SurfaceView\u4f7f\u7528\u573a\u666f\uff1a</p> <ul> <li>View\u9002\u7528\u4e3b\u52a8\u66f4\u65b0\uff0cSurfaceView \u9002\u7528\u88ab\u52a8\u66f4\u65b0\uff0c\u5982\u9891\u7e41\u7684\u5237\u65b0</li> <li>View\u5728UI\u7ebf\u7a0b\u66f4\u65b0\uff0c\u5728\u975eUI\u7ebf\u7a0b\u66f4\u65b0\u4f1a\u62a5\u9519\uff0c\u5f53\u5728\u4e3b\u7ebf\u7a0b\u66f4\u65b0view\u65f6\u5982\u679c\u8017\u65f6\u8fc7\u957f\u4e5f\u4f1a\u51fa\u9519, SurfaceView\u5728\u5b50\u7ebf\u7a0b\u5237\u65b0\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u9002\u7528\u4e8e\u754c\u9762\u9891\u7e41\u66f4\u65b0\u3001\u5bf9\u5e27\u7387\u8981\u6c42\u8f83\u9ad8\u7684\u60c5\u51b5\u3002</li> <li>SurfaceView\u53ef\u4ee5\u63a7\u5236\u5237\u65b0\u9891\u7387\u3002</li> <li>SurfaceView\u5e95\u5c42\u5229\u7528\u53cc\u7f13\u5b58\u673a\u5236\uff0c\u7ed8\u56fe\u65f6\u4e0d\u4f1a\u51fa\u73b0\u95ea\u70c1\u95ee\u9898\u3002</li> </ul> <p>\u53cc\u7f13\u51b2\u6280\u672f\u662f\u6e38\u620f\u5f00\u53d1\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u6280\u672f\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3 \u53cd\u590d\u5c40\u90e8\u5237\u5c4f\u5e26\u6765\u7684\u95ea\u70c1\u3002\u6e38\u620f\uff0c\u89c6\u9891\u7b49\u753b\u9762\u53d8\u5316\u8f83\u9891\u7e41\uff0c\u524d\u9762\u8fd8\u6ca1\u6709\u663e\u793a\u5b8c\uff0c\u7a0b\u5e8f\u53c8\u8bf7\u6c42\u91cd\u65b0\u7ed8\u5236\uff0c\u8fd9\u6837\u5c4f\u5e55\u5c31\u4f1a\u4e0d\u505c\u5730\u95ea\u70c1\u3002\u53cc\u7f13\u51b2\u6280\u672f\u4f1a\u628a\u8981\u5904\u7406\u7684\u56fe\u7247\u5728\u5185\u5b58\u4e2d\u5904\u7406\u597d\u4e4b\u540e\uff0c\u628a\u8981\u753b\u7684\u4e1c\u897f\u5148\u753b\u5230\u4e00\u4e2a\u5185\u5b58\u533a\u57df\u91cc\uff0c\u7136\u540e\u6574\u4f53\u7684\u4e00\u6b21\u6027\u753b\u51fa\u6765\uff0c\u5c06\u5176\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u3002</p> <p>RecyclerView LayoutManager\u4f5c\u7528\uff1f</p> \u56de\u7b54 <p>LayoutManager\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f</p> <ul> <li> <p>LayoutManager\u7684\u804c\u8d23\u662f\u6446\u653eItem\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e14\u8d1f\u8d23\u51b3\u5b9a\u4f55\u65f6\u56de\u6536\u548c\u91cd\u7528Item\u3002</p> </li> <li> <p>RecyclerView \u5141\u8bb8\u81ea\u5b9a\u4e49\u89c4\u5219\u53bb\u653e\u7f6e\u5b50 view\uff0c\u8fd9\u4e2a\u89c4\u5219\u7684\u63a7\u5236\u8005\u5c31\u662f  LayoutManager\u3002\u4e00\u4e2a RecyclerView \u5982\u679c\u60f3\u5c55\u793a\u5185\u5bb9\uff0c\u5c31\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2a LayoutManager</p> </li> </ul> <p>LayoutManager\u6837\u5f0f\u6709\u54ea\u4e9b\uff1f</p> <ul> <li> <p>LinearLayoutManager \u6c34\u5e73\u6216\u8005\u5782\u76f4\u7684Item\u89c6\u56fe\u3002</p> </li> <li> <p>GridLayoutManager \u7f51\u683cItem\u89c6\u56fe\u3002</p> </li> <li> <p>StaggeredGridLayoutManager \u4ea4\u9519\u7684\u7f51\u683cItem\u89c6\u56fe\u3002</p> </li> </ul> <p>RecyclerView\u7684\u591a\u7ea7\u7f13\u5b58\u673a\u5236\uff0c\u6bcf\u7ea7\u7f13\u5b58\u5230\u5e95\u8d77\u5230\u4ec0\u4e48\u6837\u7684\u4f5c\u7528\uff1f</p> \u56de\u7b54 <p>\u5927\u6982\u4e86\u89e3\u4e0b Recycler \u7684\u51e0\u4e2a\u7f13\u5b58\u53d8\u91cf\uff1a <pre><code>    public final class Recycler {\nprivate ArrayList&lt;ViewHolder&gt; mChangedScrap = null; final ArrayList&lt;ViewHolder&gt; mAttachedScrap = new ArrayList&lt;&gt;();      final ArrayList&lt;ViewHolder&gt; mCachedViews = new ArrayList&lt;ViewHolder&gt;(); private ViewCacheExtension mViewCacheExtension;\nprivate RecycledViewPool mRecyclerPool;\n} </code></pre> RecyclerView\u5728\u83b7\u53d6ViewHolder\u65f6,\u4f18\u5148\u4f1a\u5230\u8fd9 mAttachedScrap \u4e0e mChangedScrap \u4e24\u4e2a\u7f13\u5b58\u6765\u627e\u3002\u5176\u6b21\u624d\u662f mCachedViews\uff0c\u6700\u540e\u624d\u662fRecyclerViewPool\u3002</p> \u7f13\u5b58\u7ea7\u522b createVH bindVH \u53d8\u91cf \u542b\u4e49 \u4e00\u7ea7\u7f13\u5b58(Scrap View) \u5426 \u5426 mAttachedScrap mAttachedScrap\u5b58\u50a8\u7684\u662f\u5f53\u524d\u8fd8\u5728\u5c4f\u5e55\u4e2d\u7684ViewHolder\u3002\u5339\u914d\u673a\u5236\u6309\u7167position\u548cid\u8fdb\u884c\u5339\u914d \u4e00\u7ea7\u7f13\u5b58(Scrap View) \u5426 \u662f mChangedScrap mChangedScrap\u5b58\u50a8\u7684\u662f\u6570\u636e\u88ab\u66f4\u65b0\u7684ViewHolder,\u6bd4\u5982\u8bf4\u8c03\u7528\u4e86Adapter\u7684 notifyXXX \u65b9\u6cd5 \u4e8c\u7ea7\u7f13\u5b58(Cache View) \u5426 \u5426 mCachedViews \u9ed8\u8ba4\u5927\u5c0f\u4e3a2\uff0c\u7f13\u5b58\u79bb\u5f00\u5c4f\u5e55\u7684viewHolder. \u89e3\u51b3\u4e24\u70b9\uff1a 1. \u9891\u7e41\u8fdb\u5165/\u79bb\u5f00\u5c4f\u5e55\u7684ViewHolder\u5bfc\u81f4\u7684\u5185\u5b58\u6296\u52a8\u7684\u95ee\u9898\uff1b2.\u8fd8\u6709\u7528\u4e8e\u4fdd\u5b58Prefetch\u7684ViewHoder. \u4e09\u7ea7\u7f13\u5b58(\u53ef\u9009\u53ef\u914d\u7f6e) \u5426 \u5426 ViewCacheExtension \u81ea\u5b9a\u4e49\u7f13\u5b58\uff0c\u901a\u5e38\u7528\u4e0d\u5230\uff0cgetViewForPositionAndType \u6765\u5b9e\u73b0\u81ea\u5df1\u7684\u7f13\u5b58 \u4f7f\u7528\u573a\u666f\uff1a\u4f4d\u7f6e\u56fa\u5b9a \u5185\u5bb9\u4e0d\u53d8 \u6570\u91cf\u6709\u9650 \u56db\u7ea7\u7f13\u5b58(\u7f13\u5b58\u6c60) \u5426 \u662f RecyclerViewPool \u6839\u636eViewType\u6765\u7f13\u5b58ViewHolder\uff0c\u6bcf\u4e2aViewType\u7684\u6570\u7ec4\u5927\u5c0f\u9ed8\u8ba4\u4e3a5\uff0c\u53ef\u4ee5\u52a8\u6001\u7684\u6539\u53d8 \u7f13\u5b58\u7684ViewHolder\u9700\u8981\u91cd\u65b0\u7ed1\u5b9a(bindView). \u4e5f\u53ef\u4ee5 RecyclerView\u4e4b\u95f4\u5171\u4eabViewHolder\u7684\u7f13\u5b58\u6c60Pool. <p>RecyclerView\u5e38\u89c1\u7684\u4f18\u5316\u65b9\u5f0f\uff1f</p> \u56de\u7b54 <p>RecyclerView \u4f18\u5316 \u6700\u91cd\u8981\u662f \u51cf\u5c11 <code>createViewHolder</code>, <code>bindViewHolder</code> \u7684\u8017\u65f6(\u65f6\u95f4)\u548c\u8c03\u7528\u6b21\u6570</p> <ol> <li> <p>\u901a\u8fc7 RecycleView.setItemViewCacheSize(size); \u6765\u52a0\u5927 RecyclerView \u7684\u7f13\u5b58\uff0c\u7528\u7a7a\u95f4\u6362\u65f6\u95f4\u6765\u63d0\u9ad8\u6eda\u52a8\u7684\u6d41\u7545\u6027\u3002</p> </li> <li> <p>\u5982\u679c\u591a\u4e2a RecycledView \u7684 Adapter \u662f\u4e00\u6837\u7684\uff0c\u6bd4\u5982\u5d4c\u5957\u7684 RecyclerView \u4e2d\u5b58\u5728\u4e00\u6837\u7684 Adapter\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e RecyclerView.setRecycledViewPool(pool); \u6765\u5171\u7528\u4e00\u4e2a RecycledViewPool\u3002</p> </li> <li> <p>\u5982\u679c Item \u9ad8\u5ea6\u662f\u56fa\u5b9a\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528 RecyclerView.setHasFixedSize(true); \u6765\u907f\u514d requestLayout \u6d6a\u8d39\u8d44\u6e90\uff1b</p> </li> <li> <p>\u8bbe\u7f6e RecyclerView.addOnScrollListener(listener); \u6765\u5bf9\u6ed1\u52a8\u8fc7\u7a0b\u4e2d\u505c\u6b62\u52a0\u8f7d\u7684\u64cd\u4f5c</p> </li> <li> <p>\u5982\u679c\u4e0d\u8981\u6c42\u52a8\u753b\uff0c\u53ef\u4ee5\u901a\u8fc7 ((SimpleItemAnimator) rv.getItemAnimator()).setSupportsChangeAnimations(false); \u628a\u9ed8\u8ba4\u52a8\u753b\u5173\u95ed\u6765\u63d0\u9ad8\u6548\u7387\u3002</p> </li> <li> <p>\u901a\u8fc7\u91cd\u5199 RecyclerView.onViewRecycled(holder) \u6765\u56de\u6536\u8d44\u6e90\u3002\u6bd4\u5982\u91ca\u653e\u4e00\u4e9b\u56fe\u7247\u8d44\u6e90,Glid,ImageView\u7b49\u7b49.</p> </li> <li> <p>\u5bf9itemView\u4e2d\u5b69\u5b50View\u7684\u70b9\u51fb\u4e8b\u4ef6\u4f18\u5316</p> <p>onBindViewHolder() \u4e2d\u9891\u7e41\u521b\u5efa\u65b0\u7684 onClickListener \u5b9e\u4f8b\u6ca1\u6709\u5fc5\u8981\uff0c\u5efa\u8bae\u5b9e\u9645\u5f00\u53d1\u4e2d\u5e94\u8be5\u5728 onCreateViewHolder() \u4e2d\u6bcf\u6b21\u4e3a\u65b0\u5efa\u7684 View \u8bbe\u7f6e\u4e00\u6b21\u5c31\u884c\u3002</p> </li> <li> <p>\u4f7f\u7528\u9884\u52a0\u8f7d <code>Prefetch</code> </p> </li> <li> <p>DiffUtil\u5237\u65b0\u4f18\u5316</p> <ul> <li>\u5206\u9875\u62c9\u53d6\u8fdc\u7aef\u6570\u636e\uff0c\u5bf9\u62c9\u53d6\u4e0b\u6765\u7684\u8fdc\u7aef\u6570\u636e\u8fdb\u884c\u7f13\u5b58\uff0c\u63d0\u5347\u4e8c\u6b21\u52a0\u8f7d\u901f\u5ea6\uff1b\u5bf9\u4e8e\u65b0\u589e\u6216\u8005\u5220\u9664\u6570\u636e\u901a\u8fc7 DiffUtil \u6765\u8fdb\u884c\u5c40\u90e8\u5237\u65b0\u6570\u636e\uff0c\u800c\u4e0d\u662f\u4e00\u5473\u5730\u5168\u5c40\u5237\u65b0\u6570\u636e\u3002</li> </ul> </li> <li> <p>\u5e03\u5c40\u4f18\u5316</p> <ul> <li>\u51cf\u5c11 xml \u6587\u4ef6 inflate \u65f6\u95f4</li> </ul> <p>\u8fd9\u91cc\u7684 xml \u6587\u4ef6\u4e0d\u4ec5\u5305\u62ec layout \u7684 xml\uff0c\u8fd8\u5305\u62ec drawable \u7684 xml\uff0cxml \u6587\u4ef6 inflate \u51fa ItemView \u662f\u901a\u8fc7\u8017\u65f6\u7684 IO \u64cd\u4f5c\uff0c\u5c24\u5176\u5f53 Item \u7684\u590d\u7528\u51e0\u7387\u5f88\u4f4e\u7684\u60c5\u51b5\u4e0b\uff0c\u968f\u7740 Type \u7684\u589e\u591a\uff0c\u8fd9\u79cd inflate \u5e26\u6765\u7684\u635f\u8017\u662f\u76f8\u5f53\u5927\u7684\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u7528\u4ee3\u7801\u53bb\u751f\u6210\u5e03\u5c40\uff0c\u5373 new View() \u7684\u65b9\u5f0f\uff0c\u53ea\u8981\u641e\u6e05\u695a xml \u4e2d\u6bcf\u4e2a\u8282\u70b9\u7684\u5c5e\u6027\u5bf9\u5e94\u7684 API \u5373\u53ef\u3002</p> <ul> <li>\u51cf\u5c11 View \u5bf9\u8c61\u7684\u521b\u5efa</li> </ul> <p>\u4e00\u4e2a\u7a0d\u5fae\u590d\u6742\u7684 Item \u4f1a\u5305\u542b\u5927\u91cf\u7684 View\uff0c\u800c\u5927\u91cf\u7684 View \u7684\u521b\u5efa\u4e5f\u4f1a\u6d88\u8017\u5927\u91cf\u65f6\u95f4\uff0c\u6240\u4ee5\u8981\u5c3d\u53ef\u80fd\u7b80\u5316 ItemView\uff1b\u8bbe\u8ba1 ItemType \u65f6\uff0c\u5bf9\u591a ViewType \u80fd\u591f\u5171\u7528\u7684\u90e8\u5206\u5c3d\u91cf\u8bbe\u8ba1\u6210\u81ea\u5b9a\u4e49 View\uff0c\u51cf\u5c11 View \u7684\u6784\u9020\u548c\u5d4c\u5957\u3002</p> </li> </ol>"},{"location":"interview/java_basic/","title":"JAVA\u57fa\u7840\u95ee\u9898","text":"<p>\u6210\u5458\u53d8\u91cf\u4e0e\u5c40\u90e8\u53d8\u91cf\u7684\u533a\u522b\u6709\u54ea\u4e9b\uff1f</p> \u56de\u7b54 <ol> <li>\u4ece\u8bed\u6cd5\u5f62\u5f0f\u4e0a\u770b:\u6210\u5458\u53d8\u91cf\u662f\u5c5e\u4e8e\u7c7b\u7684\uff0c\u800c\u5c40\u90e8\u53d8\u91cf\u662f\u5728\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\u6216\u662f\u65b9\u6cd5\u7684\u53c2\u6570\uff1b\u6210\u5458\u53d8\u91cf\u53ef\u4ee5\u88ab <code>public</code>,<code>private</code>,<code>static</code> \u7b49\u4fee\u9970\u7b26\u6240\u4fee\u9970\uff0c\u800c\u5c40\u90e8\u53d8\u91cf\u4e0d\u80fd\u88ab\u8bbf\u95ee\u63a7\u5236\u4fee\u9970\u7b26\u53ca <code>static</code> \u6240\u4fee\u9970\uff1b\u4f46\u662f\uff0c\u6210\u5458\u53d8\u91cf\u548c\u5c40\u90e8\u53d8\u91cf\u90fd\u80fd\u88ab <code>final</code> \u6240\u4fee\u9970\u3002</li> <li>\u4ece\u53d8\u91cf\u5728\u5185\u5b58\u4e2d\u7684\u5b58\u50a8\u65b9\u5f0f\u6765\u770b:\u5982\u679c\u6210\u5458\u53d8\u91cf\u662f\u4f7f\u7528<code>static</code>\u4fee\u9970\u7684\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6210\u5458\u53d8\u91cf\u662f\u5c5e\u4e8e\u7c7b\u7684\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528<code>static</code>\u4fee\u9970\uff0c\u8fd9\u4e2a\u6210\u5458\u53d8\u91cf\u662f\u5c5e\u4e8e\u5b9e\u4f8b\u7684\u3002\u5bf9\u8c61\u5b58\u4e8e\u5806\u5185\u5b58\uff0c\u5982\u679c\u5c40\u90e8\u53d8\u91cf\u7c7b\u578b\u4e3a\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u90a3\u4e48\u5b58\u50a8\u5728\u6808\u5185\u5b58\uff0c\u5982\u679c\u4e3a\u5f15\u7528\u6570\u636e\u7c7b\u578b\uff0c\u90a3\u5b58\u653e\u7684\u662f\u6307\u5411\u5806\u5185\u5b58\u5bf9\u8c61\u7684\u5f15\u7528\u6216\u8005\u662f\u6307\u5411\u5e38\u91cf\u6c60\u4e2d\u7684\u5730\u5740\u3002</li> <li>\u4ece\u53d8\u91cf\u5728\u5185\u5b58\u4e2d\u7684\u751f\u5b58\u65f6\u95f4\u4e0a\u770b:\u6210\u5458\u53d8\u91cf\u662f\u5bf9\u8c61\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u968f\u7740\u5bf9\u8c61\u7684\u521b\u5efa\u800c\u5b58\u5728\uff0c\u800c\u5c40\u90e8\u53d8\u91cf\u968f\u7740\u65b9\u6cd5\u7684\u8c03\u7528\u800c\u81ea\u52a8\u6d88\u5931\u3002</li> <li>\u6210\u5458\u53d8\u91cf\u5982\u679c\u6ca1\u6709\u88ab\u8d4b\u521d\u503c:\u5219\u4f1a\u81ea\u52a8\u4ee5\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\u800c\u8d4b\u503c\uff08\u4e00\u79cd\u60c5\u51b5\u4f8b\u5916:\u88ab <code>final</code> \u4fee\u9970\u7684\u6210\u5458\u53d8\u91cf\u4e5f\u5fc5\u987b\u663e\u5f0f\u5730\u8d4b\u503c\uff09\uff0c\u800c\u5c40\u90e8\u53d8\u91cf\u5219\u4e0d\u4f1a\u81ea\u52a8\u8d4b\u503c\u3002</li> </ol> <p>\u6784\u9020\u5668 Constructor \u662f\u5426\u53ef\u88ab override</p> \u56de\u7b54 <p>Constructor \u4e0d\u80fd\u88ab override(\u91cd\u5199),\u4f46\u662f\u53ef\u4ee5 overload(\u91cd\u8f7d),\u6240\u4ee5\u4f60\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u7c7b\u4e2d\u6709\u591a\u4e2a\u6784\u9020\u51fd\u6570\u7684\u60c5\u51b5\u3002</p> <p>==\u4e0eequals\u533a\u522b</p> \u56de\u7b54 <ul> <li>\u5bf9\u4e8e==\uff0c\u5982\u679c\u4f5c\u7528\u4e8e\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u91cf\uff0c\u5219\u76f4\u63a5\u6bd4\u8f83\u5176\u5b58\u50a8\u7684 \u201c\u503c\u201d\u662f\u5426\u76f8\u7b49\uff1b\u5982\u679c\u4f5c\u7528\u4e8e\u5f15\u7528\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u5219\u6bd4\u8f83\u7684\u662f\u6240\u6307\u5411\u7684\u5bf9\u8c61\u7684\u5730\u5740</li> <li>\u5bf9\u4e8eequals\u65b9\u6cd5\uff0c\u6ce8\u610f\uff1aequals\u65b9\u6cd5\u4e0d\u80fd\u4f5c\u7528\u4e8e\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53d8\u91cf;\u5982\u679c\u6ca1\u6709\u5bf9equals\u65b9\u6cd5\u8fdb\u884c\u91cd\u5199\uff0c\u5219\u6bd4\u8f83\u7684\u662f\u5f15\u7528\u7c7b\u578b\u7684\u53d8\u91cf\u6240\u6307\u5411\u7684\u5bf9\u8c61\u7684\u5730\u5740\uff1b\u8bf8\u5982String\u3001Date\u7b49\u7c7b\u5bf9equals\u65b9\u6cd5\u8fdb\u884c\u4e86\u91cd\u5199\u7684\u8bdd\uff0c\u6bd4\u8f83\u7684\u662f\u6240\u6307\u5411\u7684\u5bf9\u8c61\u7684\u5185\u5bb9\u3002</li> </ul> <p>\u8bf4\u4e00\u4e0bhashcode\u7684\u4f5c\u7528\uff1f\u4e3a\u4ec0\u4e48\u91cd\u5199 equals \u65f6\u5fc5\u987b\u91cd\u5199 hashCode \u65b9\u6cd5</p> \u56de\u7b54 <ul> <li>hashCode()\u4ecb\u7ecd:</li> </ul> <p><code>hashCode()</code> \u7684\u4f5c\u7528\u662f\u83b7\u53d6\u54c8\u5e0c\u7801\uff0c\u4e5f\u79f0\u4e3a\u6563\u5217\u7801\uff1b\u5b83\u5b9e\u9645\u4e0a\u662f\u8fd4\u56de\u4e00\u4e2a int \u6574\u6570\u3002\u8fd9\u4e2a\u54c8\u5e0c\u7801\u7684\u4f5c\u7528\u662f\u786e\u5b9a\u8be5\u5bf9\u8c61\u5728\u54c8\u5e0c\u8868\u4e2d\u7684\u7d22\u5f15\u4f4d\u7f6e\u3002<code>hashCode()</code>\u5b9a\u4e49\u5728 JDK \u7684 <code>Object</code> \u7c7b\u4e2d\uff0c\u8fd9\u5c31\u610f\u5473\u7740 Java \u4e2d\u7684\u4efb\u4f55\u7c7b\u90fd\u5305\u542b\u6709 <code>hashCode()</code> \u51fd\u6570\u3002\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a <code>Object</code> \u7684 hashcode \u65b9\u6cd5\u662f\u672c\u5730\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u7528 c \u8bed\u8a00\u6216 c++ \u5b9e\u73b0\u7684\uff0c\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u6765\u5c06\u5bf9\u8c61\u7684 \u5185\u5b58\u5730\u5740 \u8f6c\u6362\u4e3a\u6574\u6570\u4e4b\u540e\u8fd4\u56de\u3002 <pre><code>public native int hashCode();\n</code></pre> \u6563\u5217\u8868\u5b58\u50a8\u7684\u662f\u952e\u503c\u5bf9(key-value)\uff0c\u5b83\u7684\u7279\u70b9\u662f\uff1a\u80fd\u6839\u636e\u201c\u952e\u201d\u5feb\u901f\u7684\u68c0\u7d22\u51fa\u5bf9\u5e94\u7684\u201c\u503c\u201d\u3002\u8fd9\u5176\u4e2d\u5c31\u5229\u7528\u5230\u4e86\u6563\u5217\u7801\uff01\uff08\u53ef\u4ee5\u5feb\u901f\u627e\u5230\u6240\u9700\u8981\u7684\u5bf9\u8c61\uff09</p> <ul> <li>\u4e3a\u4ec0\u4e48\u8981\u6709 hashCode\uff1f</li> </ul> <p>\u6211\u4eec\u4ee5\u201c<code>HashSet</code> \u5982\u4f55\u68c0\u67e5\u91cd\u590d\u201d\u4e3a\u4f8b\u5b50\u6765\u8bf4\u660e\u4e3a\u4ec0\u4e48\u8981\u6709 hashCode\uff1f \u5f53\u4f60\u628a\u5bf9\u8c61\u52a0\u5165 <code>HashSet</code> \u65f6\uff0c<code>HashSet</code> \u4f1a\u5148\u8ba1\u7b97\u5bf9\u8c61\u7684 hashcode \u503c\u6765\u5224\u65ad\u5bf9\u8c61\u52a0\u5165\u7684\u4f4d\u7f6e\uff0c\u540c\u65f6\u4e5f\u4f1a\u4e0e\u5176\u4ed6\u5df2\u7ecf\u52a0\u5165\u7684\u5bf9\u8c61\u7684 hashcode \u503c\u4f5c\u6bd4\u8f83\uff0c\u5982\u679c\u6ca1\u6709\u76f8\u7b26\u7684 hashcode\uff0c<code>HashSet</code> \u4f1a\u5047\u8bbe\u5bf9\u8c61\u6ca1\u6709\u91cd\u590d\u51fa\u73b0\u3002\u4f46\u662f\u5982\u679c\u53d1\u73b0\u6709\u76f8\u540c hashcode \u503c\u7684\u5bf9\u8c61\uff0c\u8fd9\u65f6\u4f1a\u8c03\u7528 <code>equals()</code> \u65b9\u6cd5\u6765\u68c0\u67e5 hashcode \u76f8\u7b49\u7684\u5bf9\u8c61\u662f\u5426\u771f\u7684\u76f8\u540c\u3002\u5982\u679c\u4e24\u8005\u76f8\u540c\uff0c<code>HashSet</code> \u5c31\u4e0d\u4f1a\u8ba9\u5176\u52a0\u5165\u64cd\u4f5c\u6210\u529f\u3002\u5982\u679c\u4e0d\u540c\u7684\u8bdd\uff0c\u5c31\u4f1a\u91cd\u65b0\u6563\u5217\u5230\u5176\u4ed6\u4f4d\u7f6e\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u5927\u5927\u51cf\u5c11\u4e86 equals \u7684\u6b21\u6570\uff0c\u76f8\u5e94\u5c31\u5927\u5927\u63d0\u9ad8\u4e86\u6267\u884c\u901f\u5ea6\u3002</p> <ul> <li>\u4e3a\u4ec0\u4e48\u91cd\u5199 <code>equals</code> \u65f6\u5fc5\u987b\u91cd\u5199 <code>hashCode</code> \u65b9\u6cd5\uff1f</li> </ul> <p>\u5982\u679c\u4e24\u4e2a\u5bf9\u8c61\u76f8\u7b49\uff0c\u5219 hashcode \u4e00\u5b9a\u4e5f\u662f\u76f8\u540c\u7684\u3002\u4e24\u4e2a\u5bf9\u8c61\u76f8\u7b49,\u5bf9\u4e24\u4e2a\u5bf9\u8c61\u5206\u522b\u8c03\u7528 equals \u65b9\u6cd5\u90fd\u8fd4\u56de true\u3002\u4f46\u662f\uff0c\u4e24\u4e2a\u5bf9\u8c61\u6709\u76f8\u540c\u7684 hashcode \u503c\uff0c\u5b83\u4eec\u4e5f\u4e0d\u4e00\u5b9a\u662f\u76f8\u7b49\u7684 \u3002\u56e0\u6b64\uff0cequals \u65b9\u6cd5\u88ab\u8986\u76d6\u8fc7\uff0c\u5219 <code>hashCode</code> \u65b9\u6cd5\u4e5f\u5fc5\u987b\u88ab\u8986\u76d6\u3002</p> <p><code>hashCode()</code>\u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u5bf9\u5806\u4e0a\u7684\u5bf9\u8c61\u4ea7\u751f\u72ec\u7279\u503c\u3002\u5982\u679c\u6ca1\u6709\u91cd\u5199 <code>hashCode()</code>\uff0c\u5219\u8be5 class \u7684\u4e24\u4e2a\u5bf9\u8c61\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u4f1a\u76f8\u7b49\uff08\u5373\u4f7f\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u6307\u5411\u76f8\u540c\u7684\u6570\u636e\uff09</p> <ul> <li>\u4e3a\u4ec0\u4e48\u4e24\u4e2a\u5bf9\u8c61\u6709\u76f8\u540c\u7684 hashcode \u503c\uff0c\u5b83\u4eec\u4e5f\u4e0d\u4e00\u5b9a\u662f\u76f8\u7b49\u7684\uff1f</li> </ul> <p>\u56e0\u4e3a <code>hashCode()</code> \u6240\u4f7f\u7528\u7684hash\u7b97\u6cd5\u4e5f\u8bb8\u521a\u597d\u4f1a\u8ba9\u591a\u4e2a\u5bf9\u8c61\u4f20\u56de\u76f8\u540c\u7684hash\u503c\u3002\u8d8a\u7cdf\u7cd5\u7684hash\u7b97\u6cd5\u8d8a\u5bb9\u6613\u78b0\u649e\uff0c\u4f46\u8fd9\u4e5f\u4e0e\u6570\u636e\u503c\u57df\u5206\u5e03\u7684\u7279\u6027\u6709\u5173\uff08\u6240\u8c13\u78b0\u649e\u4e5f\u5c31\u662f\u6307\u7684\u662f\u4e0d\u540c\u7684\u5bf9\u8c61\u5f97\u5230\u76f8\u540c\u7684 <code>hashCode</code>\u3002 \u6211\u4eec\u521a\u521a\u4e5f\u63d0\u5230\u4e86 <code>HashSet</code>,\u5982\u679c <code>HashSet</code> \u5728\u5bf9\u6bd4\u7684\u65f6\u5019\uff0c\u540c\u6837\u7684 hashcode \u6709\u591a\u4e2a\u5bf9\u8c61\uff0c\u5b83\u4f1a\u4f7f\u7528 <code>equals()</code> \u6765\u5224\u65ad\u662f\u5426\u771f\u7684\u76f8\u540c\u3002\u4e5f\u5c31\u662f\u8bf4 <code>hashcode</code> \u53ea\u662f\u7528\u6765\u7f29\u5c0f\u67e5\u627e\u6210\u672c\u3002</p> <p>\u8bf7\u624b\u5199equal\u65b9\u6cd5\u3010String\u7c7b\u3011\uff0c\u8bb2\u8bb2\u5177\u4f53\u7684\u539f\u7406\uff1fObject\u7c7b\u7684equla\u65b9\u6cd5\u662f\u600e\u6837\u7684\uff1f</p> \u56de\u7b54 <ul> <li>\u4ee3\u7801\u5982\u4e0b\u6240\u793a <pre><code>public boolean equals(Object anObject) {\n// 1\u3001 \u8ddf\u81ea\u8eab\u6bd4\u8f83\nif (this == anObject) {\nreturn true;\n}\n//  2\u3001 \u5426\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\nif (anObject instanceof String) {\nString anotherString = (String) anObject;\nint n = count;\n// 3\u3001 \u662f\u5426\u957f\u5ea6\u4e00\u81f4\nif (n == anotherString.count) {\nint i = 0;\nwhile (n-- != 0) {\n// 4\u3001\u5bf9\u6bd4\u6bcf\u4e2a\u5b57\u7b26\u4e32\nif (charAt(i) != anotherString.charAt(i))\nreturn false;\ni++;\n}\nreturn true;\n}\n}\nreturn false;\n}\n</code></pre></li> <li>Object\u7c7b\u7684equla\u65b9\u6cd5\u662f\u600e\u6837\u7684 <pre><code>public boolean equals(Object obj) {\nreturn (this == obj);\n}\n</code></pre></li> </ul> <p>\u4e3a\u4ec0\u4e48 Java \u4e2d\u7684 String \u662f\u4e0d\u53ef\u53d8\u7684\uff08Immutable\uff09\uff1fString\u4e0d\u53ef\u53d8\u7684\u597d\u5904\uff1f</p> \u56de\u7b54 <ul> <li>\u4e0d\u53ef\u53d8\u7c7bString\u7684\u539f\u56e0<ul> <li>String\u4e3b\u8981\u7684\u4e09\u4e2a\u6210\u5458\u53d8\u91cf <code>char value[]</code>\uff0c <code>int offset</code>, <code>int count</code>\u5747\u662fprivate\uff0cfinal\u7684\uff0c\u5e76\u4e14\u6ca1\u6709\u5bf9\u5e94\u7684 getter/setter;</li> <li>String \u5bf9\u8c61\u4e00\u65e6\u521d\u59cb\u5316\u5b8c\u6210\uff0c\u4e0a\u8ff0\u4e09\u4e2a\u6210\u5458\u53d8\u91cf\u5c31\u4e0d\u53ef\u4fee\u6539\uff1b\u5e76\u4e14\u5176\u6240\u63d0\u4f9b\u7684\u63a5\u53e3\u4efb\u4f55\u5bf9\u8fd9\u4e9b\u57df\u7684\u4fee\u6539\u90fd\u5c06\u8fd4\u56de\u4e00\u4e2a\u65b0\u5bf9\u8c61\uff1b</li> <li>\u662f\u5178\u578b\u7684 <code>Immutable</code> \u7c7b\uff0c\u88ab\u58f0\u660e\u6210\u4e3a <code>final class</code>\uff0c\u6240\u6709\u5c5e\u6027\u4e5f\u90fd\u662ffinal\u7684\u3002\u4e5f\u7531\u4e8e\u5b83\u7684\u4e0d\u53ef\u53d8\uff0c\u7c7b\u4f3c\u62fc\u63a5\u3001\u88c1\u526a\u5b57\u7b26\u4e32\u7b49\u52a8\u4f5c\uff0c\u90fd\u4f1a\u4ea7\u751f\u65b0\u7684 String \u5bf9\u8c61\u3002</li> </ul> </li> <li>String\u4e0d\u53ef\u53d8\u7684\u597d\u5904<ul> <li>\u53ef\u4ee5\u7f13\u5b58 hash \u503c<ul> <li>\u56e0\u4e3a String \u7684 hash \u503c\u7ecf\u5e38\u88ab\u4f7f\u7528\uff0c\u4f8b\u5982 String \u7528\u505a HashMap \u7684 key\u3002\u4e0d\u53ef\u53d8\u7684\u7279\u6027\u53ef\u4ee5\u4f7f\u5f97 hash \u503c\u4e5f\u4e0d\u53ef\u53d8\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u8ba1\u7b97\u3002</li> </ul> </li> <li>String Pool \u7684\u9700\u8981<ul> <li>\u5982\u679c\u4e00\u4e2aString\u5bf9\u8c61\u5df2\u7ecf\u88ab\u521b\u5efa\u8fc7\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u4ece String Pool \u4e2d\u53d6\u5f97\u5f15\u7528\u3002\u53ea\u6709 String \u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u624d\u53ef\u80fd\u4f7f\u7528 String Pool\u3002</li> </ul> </li> <li>\u5b89\u5168\u6027<ul> <li>String \u7ecf\u5e38\u4f5c\u4e3a\u53c2\u6570\uff0cString \u4e0d\u53ef\u53d8\u6027\u53ef\u4ee5\u4fdd\u8bc1\u53c2\u6570\u4e0d\u53ef\u53d8\u3002\u4f8b\u5982\u5728\u4f5c\u4e3a\u7f51\u7edc\u8fde\u63a5\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u5982\u679c String \u662f\u53ef\u53d8\u7684\uff0c\u90a3\u4e48\u5728\u7f51\u7edc\u8fde\u63a5\u8fc7\u7a0b\u4e2d\uff0cString \u88ab\u6539\u53d8\uff0c\u6539\u53d8 String \u5bf9\u8c61\u7684\u90a3\u4e00\u65b9\u4ee5\u4e3a\u73b0\u5728\u8fde\u63a5\u7684\u662f\u5176\u5b83\u4e3b\u673a\uff0c\u800c\u5b9e\u9645\u60c5\u51b5\u5374\u4e0d\u4e00\u5b9a\u662f\u3002</li> </ul> </li> <li>\u7ebf\u7a0b\u5b89\u5168<ul> <li>String \u4e0d\u53ef\u53d8\u6027\u5929\u751f\u5177\u5907\u7ebf\u7a0b\u5b89\u5168\uff0c\u53ef\u4ee5\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u5b89\u5168\u5730\u4f7f\u7528\u3002</li> </ul> </li> </ul> </li> <li>\u6709\u4ec0\u4e48\u529e\u6cd5\u80fd\u591f\u6539\u53d8String<ul> <li>\u901a\u8fc7\u53cd\u5c04\u6765\u6539\u53d8String\u7684<code>value</code>\u53d8\u91cf </li> </ul> </li> </ul> <p>\u8bf7\u8bf4\u4e0bString\u4e0eStringBuffer\u533a\u522b</p> \u56de\u7b54 <ul> <li>String\u662f\u5b57\u7b26\u4e32\u5e38\u91cf\uff0c\u800cStringBuffer\u3001StringBuilder\u90fd\u662f\u5b57\u7b26\u4e32\u53d8\u91cf\uff0c\u5373String\u5bf9\u8c61\u4e00\u521b\u5efa\u540e\u4e0d\u53ef\u66f4\u6539\uff0c\u800c\u540e\u4e24\u8005\u7684\u5bf9\u8c61\u662f\u53ef\u66f4\u6539\u7684\uff1a</li> <li>StringBuffer\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u800cStringBuilder\u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u8fd9\u662f\u7531\u4e8eStringBuffer\u5bf9\u65b9\u6cd5\u52a0\u4e86\u540c\u6b65\u9501\u6216\u8005\u5bf9\u8c03\u7528\u7684\u65b9\u6cd5\u52a0\u4e86\u540c\u6b65\u9501</li> <li>String\u66f4\u9002\u7528\u4e8e\u5c11\u91cf\u7684\u5b57\u7b26\u4e32\u64cd\u4f5c\u7684\u60c5\u51b5\uff0cStringBuilder\u9002\u7528\u4e8e\u5355\u7ebf\u7a0b\u4e0b\u5728\u5b57\u7b26\u7f13\u51b2\u533a\u8fdb\u884c\u5927\u91cf\u64cd\u4f5c\u7684\u60c5\u51b5\uff0cStringBuffer\u9002\u7528\u4e8e\u591a\u7ebf\u7a0b\u4e0b\u5728\u5b57\u7b26\u7f13\u51b2\u533a\u8fdb\u884c\u5927\u91cf\u64cd\u4f5c\u7684\u60c5\u51b5</li> </ul> <p>String a=\"\"\u548cString a=new String(\"\")\u7684\u7684\u5173\u7cfb\u548c\u5f02\u540c</p> \u56de\u7b54 <ul> <li>\u901a\u8fc7<code>String a=\"\"</code>\u76f4\u63a5\u8d4b\u503c\u7684\u65b9\u5f0f\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\uff0c\u5b58\u5728\u4e8e\u5e38\u91cf\u6c60\uff1b\u6ce8\u610f\uff0c\u76f8\u540c\u5185\u5bb9\u7684\u5b57\u7b26\u4e32\u5728\u5e38\u91cf\u6c60\u4e2d\u53ea\u6709\u4e00\u4e2a\uff0c\u5373\u5982\u679c\u6c60\u5df2\u5305\u542b\u5185\u5bb9\u76f8\u7b49\u7684\u5b57\u7b26\u4e32\u4f1a\u8fd4\u56de\u6c60\u4e2d\u7684\u5b57\u7b26\u4e32\uff0c\u53cd\u4e4b\u4f1a\u5c06\u8be5\u5b57\u7b26\u4e32\u653e\u5165\u6c60\u4e2d</li> <li>\u901a\u8fc7<code>new String(\"\")</code>\u521b\u5efa\u7684\u5b57\u7b26\u4e32\u4e0d\u662f\u5e38\u91cf\u662f\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u4f1a\u5728\u5806\u5185\u5b58\u5f00\u8f9f\u7a7a\u95f4\u5e76\u5b58\u653e\u6570\u636e\uff0c\u4e14\u6bcf\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\u90fd\u6709\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4      </li> </ul> <p>\u5982\u4f55\u5b9e\u73b0\u5bf9\u8c61\u514b\u9686\uff1f\u514b\u9686\u6709\u54ea\u4e9b\u65b9\u5f0f\uff1f\u6df1\u514b\u9686\u548c\u6d45\u514b\u9686\u6709\u4f55\u533a\u522b\uff1f</p> \u56de\u7b54 <ul> <li>\u514b\u9686\u6709\u54ea\u4e9b\u65b9\u5f0f<ul> <li>\u514b\u9686\uff08\u590d\u5236\uff09\u5728Java\u4e2d\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u64cd\u4f5c\uff0c\u76ee\u7684\u662f\u5feb\u901f\u83b7\u53d6\u4e00\u4e2a\u5bf9\u8c61\u526f\u672c\u3002\u514b\u9686\u5206\u4e3a\u6df1\u514b\u9686\u548c\u6d45\u514b\u9686\u3002</li> <li>\u6d45\u514b\u9686\uff1a\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\uff0c\u65b0\u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u539f\u6765\u5bf9\u8c61\u5b8c\u5168\u76f8\u540c\uff0c\u5bf9\u4e8e\u975e\u57fa\u672c\u7c7b\u578b\u5c5e\u6027\uff0c\u4ecd\u6307\u5411\u539f\u6709\u5c5e\u6027\u6240\u6307\u5411\u7684\u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\u3002</li> <li>\u6df1\u514b\u9686\uff1a\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\uff0c\u5c5e\u6027\u4e2d\u5f15\u7528\u7684\u5176\u4ed6\u5bf9\u8c61\u4e5f\u4f1a\u88ab\u514b\u9686\uff0c\u4e0d\u518d\u6307\u5411\u539f\u6709\u5bf9\u8c61\u5730\u5740\u3002</li> </ul> </li> <li>\u6df1\u514b\u9686\u548c\u6d45\u514b\u9686\u6709\u4f55\u533a\u522b<ul> <li>\u6df1\u6d45\u514b\u9686\u90fd\u4f1a\u5728\u5806\u4e2d\u65b0\u5206\u914d\u4e00\u5757\u533a\u57df\uff0c\u533a\u522b\u5728\u4e8e\u5bf9\u8c61\u5c5e\u6027\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u5426\u9700\u8981\u8fdb\u884c\u514b\u9686\uff08\u9012\u5f52\u6027\u7684\uff09\u3002</li> </ul> </li> <li>Java\u7684clone()\u65b9\u6cd5    \u4e00\u822c\u800c\u8a00\uff0cclone\uff08\uff09\u65b9\u6cd5\u6ee1\u8db3<ul> <li>1.\u5bf9\u4efb\u4f55\u7684\u5bf9\u8c61x\uff0c\u90fd\u6709<code>x.clone() !=x</code>  \u56e0\u4e3a\u514b\u9686\u5bf9\u8c61\u4e0e\u539f\u5bf9\u8c61\u4e0d\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61</li> <li>2.\u5bf9\u4efb\u4f55\u7684\u5bf9\u8c61x\uff0c\u90fd\u6709<code>x.clone().getClass()==x.getClass()</code> ,\u514b\u9686\u5bf9\u8c61\u4e0e\u539f\u5bf9\u8c61\u7684\u7c7b\u578b\u4e00\u6837</li> <li> <ol> <li>\u5982\u679c\u5bf9\u8c61x\u7684equals()\u65b9\u6cd5\u5b9a\u4e49\u6070\u5f53\uff0c\u90a3\u4e48<code>x.clone().equals(x)</code>\u5e94\u8be5\u6210\u7acb</li> </ol> </li> </ul> </li> <li>\u6ce8\u610f:<ul> <li>\u5982\u679c\u5bf9\u8c61\u5b9e\u73b0Cloneable\u5e76\u91cd\u5199clone\u65b9\u6cd5 \u4e0d\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c \u65f6,\u8c03\u7528clone\u662f\u8fdb\u884c\u7684\u6d45\u514b\u9686\u3002\u800c\u4f7f\u7528\u5bf9\u8c61\u6d41\u5c06\u5bf9\u8c61\u5199\u5165\u6d41\u7136\u540e\u518d\u8bfb\u51fa\u662f\u8fdb\u884c\u7684\u6df1\u514b\u9686\u3002</li> <li>\u57fa\u4e8e\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u5b9e\u73b0\u7684\u514b\u9686\u4e0d\u4ec5\u4ec5\u662f\u6df1\u5ea6\u514b\u9686\uff0c\u66f4\u91cd\u8981\u7684\u662f\u901a\u8fc7\u6cdb\u578b\u9650\u5b9a\uff0c\u53ef\u4ee5\u68c0\u67e5\u51fa\u8981\u514b\u9686\u7684\u5bf9\u8c61\u662f\u5426\u652f\u6301\u5e8f\u5217\u5316\uff0c\u8fd9\u9879\u68c0\u67e5\u662f\u7f16\u8bd1\u5668\u5b8c\u6210\u7684\uff0c\u4e0d\u662f\u5728\u8fd0\u884c\u65f6\u629b\u51fa\u5f02\u5e38\uff0c\u8fd9\u79cd\u662f\u65b9\u6848\u660e\u663e\u4f18\u4e8e\u4f7f\u7528Object\u7c7b\u7684clone\u65b9\u6cd5\u514b\u9686\u5bf9\u8c61\u3002</li> </ul> </li> </ul> <p>new Integer(123) \u4e0e Integer.valueOf(123)\u6709\u4f55\u533a\u522b\uff0c\u8bf7\u4ece\u5e95\u5c42\u5b9e\u73b0\u5206\u6790\u4e24\u8005\u533a\u522b\uff1f</p> \u56de\u7b54 <ul> <li> <p>\u533a\u522b\u5728\u4e8e\uff1a</p> <ul> <li><code>new Integer(123)</code> \u6bcf\u6b21\u90fd\u4f1a\u65b0\u5efa\u4e00\u4e2a\u5bf9\u8c61\uff1b</li> <li><code>Integer.valueOf(123)</code> \u4f1a\u4f7f\u7528\u7f13\u5b58\u6c60\u4e2d\u7684\u5bf9\u8c61\uff0c\u591a\u6b21\u8c03\u7528\u4f1a\u53d6\u5f97\u540c\u4e00\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\u3002 <pre><code>Integer x = new Integer(123);\nInteger y = new Integer(123);\nSystem.out.println(x == y);    // false\nInteger z = Integer.valueOf(123);\nInteger k = Integer.valueOf(123);\nSystem.out.println(z == k);   // true\n</code></pre></li> </ul> </li> <li> <p>valueOf() \u5b9e\u73b0\u539f\u7406 valueOf() \u65b9\u6cd5\u7684\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u5148\u5224\u65ad\u503c\u662f\u5426\u5728\u7f13\u5b58\u6c60\u4e2d\uff0c\u5982\u679c\u5728\u7684\u8bdd\u5c31\u76f4\u63a5\u8fd4\u56de\u7f13\u5b58\u6c60\u7684\u5185\u5bb9\u3002 <pre><code>public static Integer valueOf(int i) {\nif (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)\nreturn IntegerCache.cache[i + (-IntegerCache.low)];\nreturn new Integer(i);\n}\n</code></pre></p> <ul> <li> <p>\u5728 Java 8 \u4e2d\uff0cInteger \u7f13\u5b58\u6c60\u7684\u5927\u5c0f\u9ed8\u8ba4\u4e3a -128~127\u3002 <pre><code>static final int low = -128;\nstatic final int high;\nstatic final Integer cache[];\nstatic {\n// high value may be configured by property\nint h = 127;\nString integerCacheHighPropValue =\nsun.misc.VM.getSavedProperty(\"java.lang.Integer.IntegerCache.high\");\nif (integerCacheHighPropValue != null) {\ntry {\nint i = parseInt(integerCacheHighPropValue);\ni = Math.max(i, 127);\n// Maximum array size is Integer.MAX_VALUE\nh = Math.min(i, Integer.MAX_VALUE - (-low) -1);\n} catch( NumberFormatException nfe) {\n// If the property cannot be parsed into an int, ignore it.\n}\n}\nhigh = h;\ncache = new Integer[(high - low) + 1];\nint j = low;\nfor(int k = 0; k &lt; cache.length; k++)\ncache[k] = new Integer(j++);\n// range [-128, 127] must be interned (JLS7 5.1.7)\nassert IntegerCache.high &gt;= 127;\n}\n</code></pre></p> </li> <li> <p>\u7f16\u8bd1\u5668\u4f1a\u5728\u81ea\u52a8\u88c5\u7bb1\u8fc7\u7a0b\u8c03\u7528 valueOf() \u65b9\u6cd5\uff0c\u56e0\u6b64\u591a\u4e2aInteger\u5b9e\u4f8b\u4f7f\u7528\u81ea\u52a8\u88c5\u7bb1\u6765\u521b\u5efa\u5e76\u4e14\u503c\u76f8\u540c\uff0c\u90a3\u4e48\u5c31\u4f1a\u5f15\u7528\u76f8\u540c\u7684\u5bf9\u8c61\u3002 <pre><code>Integer m = 123;\nInteger n = 123;\nSystem.out.println(m == n); // true\n</code></pre></p> </li> <li> <p>\u57fa\u672c\u7c7b\u578b\u5bf9\u5e94\u7684\u7f13\u51b2\u6c60\u5982\u4e0b\uff1a</p> <ul> <li>boolean values true and false</li> <li>all byte values</li> <li>short values between -128 and 127</li> <li>int values between -128 and 127</li> <li>char in the range \\u0000 to \\u007F</li> </ul> </li> </ul> <p>\u5728\u4f7f\u7528\u8fd9\u4e9b\u57fa\u672c\u7c7b\u578b\u5bf9\u5e94\u7684\u5305\u88c5\u7c7b\u578b\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7f13\u51b2\u6c60\u4e2d\u7684\u5bf9\u8c61\u3002</p> </li> </ul> <p>\u8bf4\u4e00\u4e0b\u5bf9final\u7684\u7406\u89e3</p> \u56de\u7b54 <ul> <li>final \u5173\u952e\u5b57\u4e3b\u8981\u2f64\u5728\u4e09\u4e2a\u5730\u2f45\uff1a\u53d8\u91cf\u3001\u2f45\u6cd5\u3001\u7c7b\u3002<ul> <li>\u5bf9\u4e8e\u2f00\u4e2a final \u53d8\u91cf\uff0c\u5982\u679c\u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u5219\u5176\u6570\u503c\u2f00\u65e6\u5728\u521d\u59cb\u5316\u4e4b\u540e\u4fbf\u4e0d\u80fd\u66f4 \u6539\uff1b\u5982\u679c\u662f\u5f15\u2f64\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u5219\u5728\u5bf9\u5176\u521d\u59cb\u5316\u4e4b\u540e\u4fbf\u4e0d\u80fd\u518d\u8ba9\u5176\u6307\u5411\u53e6\u2f00\u4e2a\u5bf9\u8c61\u3002 </li> <li>\u5f53\u2f64 final \u4fee\u9970\u2f00\u4e2a\u7c7b\u65f6\uff0c\u8868\u660e\u8fd9\u4e2a\u7c7b\u4e0d\u80fd\u88ab\u7ee7\u627f\u3002final \u7c7b\u4e2d\u7684\u6240\u6709\u6210\u5458\u2f45\u6cd5\u90fd\u4f1a\u88ab\u9690\u5f0f\u5730 \u6307\u5b9a\u4e3a final \u2f45\u6cd5\u3002 </li> <li>\u4f7f\u2f64 final \u2f45\u6cd5\u7684\u539f\u56e0\u6709\u4e24\u4e2a\u3002\u7b2c\u2f00\u4e2a\u539f\u56e0\u662f\u628a\u2f45\u6cd5\u9501\u5b9a\uff0c\u4ee5\u9632\u4efb\u4f55\u7ee7\u627f\u7c7b\u4fee\u6539\u5b83\u7684\u542b\u4e49\uff1b \u7b2c\u2f06\u4e2a\u539f\u56e0\u662f\u6548\u7387\u3002\u5728\u65e9\u671f\u7684 Java \u5b9e\u73b0\u7248\u672c\u4e2d\uff0c\u4f1a\u5c06 final \u2f45\u6cd5\u8f6c\u4e3a\u5185\u5d4c\u8c03\u2f64\u3002\u4f46\u662f\u5982\u679c\u2f45 \u6cd5\u8fc7\u4e8e\u5e9e\u2f24\uff0c\u53ef\u80fd\u770b\u4e0d\u5230\u5185\u5d4c\u8c03\u2f64\u5e26\u6765\u7684\u4efb\u4f55\u6027\u80fd\u63d0\u5347\uff08\u73b0\u5728\u7684 Java \u7248\u672c\u5df2\u7ecf\u4e0d\u9700\u8981\u4f7f\u2f64 final \u2f45\u6cd5\u8fdb\u2f8f\u8fd9\u4e9b\u4f18\u5316\u4e86\uff09\u3002\u7c7b\u4e2d\u6240\u6709\u7684 private \u2f45\u6cd5\u90fd\u9690\u5f0f\u5730\u6307\u5b9a\u4e3a final\u3002</li> </ul> </li> </ul> <p>\u4e3a\u4ec0\u4e48Java\u4e2d\u53ea\u6709\u503c\u4f20\u9012</p> \u56de\u7b54 <ul> <li>\u503c\u4f20\u9012<ul> <li>\u6309\u503c\u8c03\u2f64 (call by value) \u8868\u793a\u2f45\u6cd5\u63a5\u6536\u7684\u662f\u8c03\u2f64\u8005\u63d0\u4f9b\u7684\u503c\uff0c\u2f7d \u6309\u5f15\u2f64\u8c03\u2f64\uff08call by reference) \u8868\u793a\u2f45\u6cd5\u63a5\u6536\u7684\u662f\u8c03\u2f64\u8005\u63d0\u4f9b\u7684\u53d8\u91cf\u5730\u5740\u3002\u2f00\u4e2a\u2f45\u6cd5\u53ef\u4ee5\u4fee\u6539\u4f20\u9012\u5f15\u2f64\u6240\u5bf9\u5e94\u7684\u53d8\u91cf\u503c\uff0c\u2f7d\u4e0d\u80fd\u4fee\u6539\u4f20\u9012\u503c\u8c03\u2f64\u6240\u5bf9\u5e94\u7684\u53d8\u91cf\u503c\u3002 Java \u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u2f94\u603b\u662f\u91c7\u2f64\u6309\u503c\u8c03\u2f64\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u2f45\u6cd5\u5f97\u5230\u7684\u662f\u6240\u6709\u53c2\u6570\u503c\u7684\u2f00\u4e2a\u62f7\u2ec9\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u2f45\u6cd5\u4e0d\u80fd\u4fee\u6539\u4f20\u9012\u7ed9\u5b83\u7684\u4efb\u4f55\u53c2\u6570\u53d8\u91cf\u7684\u5185\u5bb9\u3002</li> </ul> </li> <li>\u793a\u4f8b<ul> <li>\u4e0b\u9762\u901a\u8fc7 3 \u4e2a\u4f8b\u5b50\u6765\u7ed9\u8bf4\u660e</li> </ul> </li> </ul> <p>example 1 <pre><code>public static void main(String[] args) {\nint num1 = 10;\nint num2 = 20;\nswap(num1, num2);\nSystem.out.println(\"num1 = \" + num1);\nSystem.out.println(\"num2 = \" + num2);\n}\npublic static void swap(int a, int b) {\nint temp = a;\na = b;\nb = temp;\nSystem.out.println(\"a = \" + a);\nSystem.out.println(\"b = \" + b);\n}\n</code></pre> \u7ed3\u679c\uff1a <pre><code>a = 20\nb = 10\nnum1 = 10\nnum2 = 20\n</code></pre> \u89e3\u6790\uff1a </p> <p>\u5728 swap \u65b9\u6cd5\u4e2d\uff0ca\u3001b \u7684\u503c\u8fdb\u884c\u4ea4\u6362\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5230 num1\u3001num2\u3002\u56e0\u4e3a\uff0ca\u3001b \u4e2d\u7684\u503c\uff0c\u53ea\u662f\u4ece num1\u3001num2 \u7684\u590d\u5236\u8fc7\u6765\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0ca\u3001b \u76f8\u5f53\u4e8e num1\u3001num2 \u7684\u526f\u672c\uff0c\u526f\u672c\u7684\u5185\u5bb9\u65e0\u8bba\u600e\u4e48\u4fee\u6539\uff0c\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230\u539f\u4ef6\u672c\u8eab\u3002</p> <p>\u901a\u8fc7\u4e0a\u9762\u4f8b\u5b50\uff0c\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86\u4e00\u4e2a\u65b9\u6cd5\u4e0d\u80fd\u4fee\u6539\u4e00\u4e2a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u800c\u5bf9\u8c61\u5f15\u7528\u4f5c\u4e3a\u53c2\u6570\u5c31\u4e0d\u4e00\u6837\uff0c\u8bf7\u770b example2.</p> <p>example 2</p> <pre><code>    public static void main(String[] args) {\nint[] arr = { 1, 2, 3, 4, 5 };\nSystem.out.println(arr[0]);\nchange(arr);\nSystem.out.println(arr[0]);\n}\npublic static void change(int[] array) {\n// \u5c06\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u53d8\u4e3a0\narray[0] = 0;\n}\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>1\n0\n</code></pre> <p>\u89e3\u6790\uff1a</p> <p></p> <p>array \u88ab\u521d\u59cb\u5316 arr \u7684\u62f7\u8d1d\u4e5f\u5c31\u662f\u4e00\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u4e5f\u5c31\u662f\u8bf4 array \u548c arr \u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u6570\u7ec4\u5bf9\u8c61\u3002 \u56e0\u6b64\uff0c\u5916\u90e8\u5bf9\u5f15\u7528\u5bf9\u8c61\u7684\u6539\u53d8\u4f1a\u53cd\u6620\u5230\u6240\u5bf9\u5e94\u7684\u5bf9\u8c61\u4e0a\u3002</p> <p>\u901a\u8fc7 example2 \u6211\u4eec\u5df2\u7ecf\u770b\u5230\uff0c\u5b9e\u73b0\u4e00\u4e2a\u6539\u53d8\u5bf9\u8c61\u53c2\u6570\u72b6\u6001\u7684\u65b9\u6cd5\u5e76\u4e0d\u662f\u4e00\u4ef6\u96be\u4e8b\u3002\u7406\u7531\u5f88\u7b80\u5355\uff0c\u65b9\u6cd5\u5f97\u5230\u7684\u662f\u5bf9\u8c61\u5f15\u7528\u7684\u62f7\u8d1d\uff0c\u5bf9\u8c61\u5f15\u7528\u53ca\u5176\u4ed6\u7684\u62f7\u8d1d\u540c\u65f6\u5f15\u7528\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002</p> <p>\u5f88\u591a\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\uff08\u7279\u522b\u662f\uff0cC++\u548c Pascal)\u63d0\u4f9b\u4e86\u4e24\u79cd\u53c2\u6570\u4f20\u9012\u7684\u65b9\u5f0f\uff1a\u503c\u8c03\u7528\u548c\u5f15\u7528\u8c03\u7528\u3002\u6709\u4e9b\u7a0b\u5e8f\u5458\u8ba4\u4e3a Java \u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u5bf9\u5bf9\u8c61\u91c7\u7528\u7684\u662f\u5f15\u7528\u8c03\u7528\uff0c\u5b9e\u9645\u4e0a\uff0c\u8fd9\u79cd\u7406\u89e3\u662f\u4e0d\u5bf9\u7684\u3002\u7531\u4e8e\u8fd9\u79cd\u8bef\u89e3\u5177\u6709\u4e00\u5b9a\u7684\u666e\u904d\u6027\uff0c\u6240\u4ee5\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u53cd\u4f8b\u6765\u8be6\u7ec6\u5730\u9610\u8ff0\u4e00\u4e0b\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>example 3</p> <pre><code>public class Test {\npublic static void main(String[] args) {\n// TODO Auto-generated method stub\nStudent s1 = new Student(\"\u5c0f\u5f20\");\nStudent s2 = new Student(\"\u5c0f\u674e\");\nTest.swap(s1, s2);\nSystem.out.println(\"s1:\" + s1.getName());\nSystem.out.println(\"s2:\" + s2.getName());\n}\npublic static void swap(Student x, Student y) {\nStudent temp = x;\nx = y;\ny = temp;\nSystem.out.println(\"x:\" + x.getName());\nSystem.out.println(\"y:\" + y.getName());\n}\n}\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>x:\u5c0f\u674e\ny:\u5c0f\u5f20\ns1:\u5c0f\u5f20\ns2:\u5c0f\u674e\n</code></pre> <p>\u89e3\u6790\uff1a</p> <p>\u4ea4\u6362\u4e4b\u524d\uff1a</p> <p></p> <p>\u4ea4\u6362\u4e4b\u540e\uff1a</p> <p></p> <p>\u901a\u8fc7\u4e0a\u9762\u4e24\u5f20\u56fe\u53ef\u4ee5\u5f88\u6e05\u6670\u7684\u770b\u51fa\uff1a \u65b9\u6cd5\u5e76\u6ca1\u6709\u6539\u53d8\u5b58\u50a8\u5728\u53d8\u91cf s1 \u548c s2 \u4e2d\u7684\u5bf9\u8c61\u5f15\u7528\u3002swap \u65b9\u6cd5\u7684\u53c2\u6570 x \u548c y \u88ab\u521d\u59cb\u5316\u4e3a\u4e24\u4e2a\u5bf9\u8c61\u5f15\u7528\u7684\u62f7\u8d1d\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4ea4\u6362\u7684\u662f\u8fd9\u4e24\u4e2a\u62f7\u8d1d</p> <p>\u603b\u7ed3</p> <p>Java \u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u5bf9\u5bf9\u8c61\u91c7\u7528\u7684\u4e0d\u662f\u5f15\u7528\u8c03\u7528\uff0c\u5b9e\u9645\u4e0a\uff0c\u5bf9\u8c61\u5f15\u7528\u662f\u6309 \u503c\u4f20\u9012\u7684\u3002</p> <p>\u4e0b\u9762\u518d\u603b\u7ed3\u4e00\u4e0b Java \u4e2d\u65b9\u6cd5\u53c2\u6570\u7684\u4f7f\u7528\u60c5\u51b5\uff1a</p> <ul> <li>\u4e00\u4e2a\u65b9\u6cd5\u4e0d\u80fd\u4fee\u6539\u4e00\u4e2a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53c2\u6570\uff08\u5373\u6570\u503c\u578b\u6216\u5e03\u5c14\u578b\uff09\u3002</li> <li>\u4e00\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u6539\u53d8\u4e00\u4e2a\u5bf9\u8c61\u53c2\u6570\u7684\u72b6\u6001\u3002</li> <li>\u4e00\u4e2a\u65b9\u6cd5\u4e0d\u80fd\u8ba9\u5bf9\u8c61\u53c2\u6570\u5f15\u7528\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u3002</li> </ul> <p>\u8bf4\u4e00\u4e0b\u5f02\u5e38\u5904\u7406\u673a\u5236\uff1f</p> \u56de\u7b54 <ul> <li>Java \u5f02\u5e38\u7c7b\u5c42\u6b21\u7ed3\u6784  \u5728 Java \u4e2d\uff0c\u6240\u6709\u7684\u5f02\u5e38\u90fd\u6709\u4e00\u4e2a\u5171\u540c\u7684\u7956\u5148 <code>java.lang</code> \u5305\u4e2d\u7684 <code>Throwable</code> \u7c7b\u3002<code>Throwable</code> \u7c7b\u6709\u4e24\u4e2a\u91cd\u8981\u7684\u5b50\u7c7b <code>Exception</code>\uff08\u5f02\u5e38\uff09\u548c <code>Error</code>\uff08\u9519\u8bef\uff09\u3002<code>Exception</code> \u80fd\u88ab\u7a0b\u5e8f\u672c\u8eab\u5904\u7406(<code>try-catch</code>)\uff0c <code>Error</code> \u662f\u65e0\u6cd5\u5904\u7406\u7684(\u53ea\u80fd\u5c3d\u91cf\u907f\u514d)\u3002 <code>Exception</code> \u548c <code>Error</code> \u4e8c\u8005\u90fd\u662f Java \u5f02\u5e38\u5904\u7406\u7684\u91cd\u8981\u5b50\u7c7b\uff0c\u5404\u81ea\u90fd\u5305\u542b\u5927\u91cf\u5b50\u7c7b\u3002<ul> <li><code>Exception</code> :\u7a0b\u5e8f\u672c\u8eab\u53ef\u4ee5\u5904\u7406\u7684\u5f02\u5e38\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>catch</code> \u6765\u8fdb\u884c\u6355\u83b7\u3002<code>Exception</code> \u53c8\u53ef\u4ee5\u5206\u4e3a \u53d7\u68c0\u67e5\u5f02\u5e38(\u5fc5\u987b\u5904\u7406) \u548c \u4e0d\u53d7\u68c0\u67e5\u5f02\u5e38(\u53ef\u4ee5\u4e0d\u5904\u7406)\u3002</li> <li><code>Error</code> \uff1a<code>Error</code> \u5c5e\u4e8e\u7a0b\u5e8f\u65e0\u6cd5\u5904\u7406\u7684\u9519\u8bef \uff0c\u6211\u4eec\u6ca1\u529e\u6cd5\u901a\u8fc7 <code>catch</code> \u6765\u8fdb\u884c\u6355\u83b7 \u3002\u4f8b\u5982\uff0cJava \u865a\u62df\u673a\u8fd0\u884c\u9519\u8bef\uff08<code>Virtual MachineError</code>\uff09\u3001\u865a\u62df\u673a\u5185\u5b58\u4e0d\u591f\u9519\u8bef(<code>OutOfMemoryError</code>)\u3001\u7c7b\u5b9a\u4e49\u9519\u8bef\uff08<code>NoClassDefFoundError</code>\uff09\u7b49 \u3002\u8fd9\u4e9b\u5f02\u5e38\u53d1\u751f\u65f6\uff0cJava \u865a\u62df\u673a\uff08JVM\uff09\u4e00\u822c\u4f1a\u9009\u62e9\u7ebf\u7a0b\u7ec8\u6b62\u3002</li> </ul> </li> </ul> <p>Java\u4e2d\u68c0\u67e5\u5f02\u5e38\u548c\u975e\u68c0\u67e5\u5f02\u5e38\u7684\u533a\u522b</p> \u56de\u7b54 <ul> <li>\u53d7\u68c0\u67e5\u5f02\u5e38 Java \u4ee3\u7801\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u53d7\u68c0\u67e5\u5f02\u5e38\u6ca1\u6709\u88ab <code>catch</code>/<code>throw</code> \u5904\u7406\u7684\u8bdd\uff0c\u5c31\u6ca1\u529e\u6cd5\u901a\u8fc7\u7f16\u8bd1 \u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u6bb5 IO \u64cd\u4f5c\u7684\u4ee3\u7801\u3002 \u9664\u4e86<code>RuntimeException</code>\u53ca\u5176\u5b50\u7c7b\u4ee5\u5916\uff0c\u5176\u4ed6\u7684<code>Exception</code>\u7c7b\u53ca\u5176\u5b50\u7c7b\u90fd\u5c5e\u4e8e\u68c0\u67e5\u5f02\u5e38 \u3002\u5e38\u89c1\u7684\u53d7\u68c0\u67e5\u5f02\u5e38\u6709\uff1a IO \u76f8\u5173\u7684\u5f02\u5e38\u3001<code>ClassNotFoundException</code> \u3001<code>SQLException</code>...\u3002</li> <li>\u4e0d\u53d7\u68c0\u67e5\u5f02\u5e38 Java \u4ee3\u7801\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d \uff0c\u6211\u4eec\u5373\u4f7f\u4e0d\u5904\u7406\u4e0d\u53d7\u68c0\u67e5\u5f02\u5e38\u4e5f\u53ef\u4ee5\u6b63\u5e38\u901a\u8fc7\u7f16\u8bd1\u3002 <code>RuntimeException</code> \u53ca\u5176\u5b50\u7c7b\u90fd\u7edf\u79f0\u4e3a\u975e\u53d7\u68c0\u67e5\u5f02\u5e38\uff0c\u4f8b\u5982\uff1a<code>NullPoin\u200bterException</code>\u3001<code>NumberFormatException</code>\uff08\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\uff09\u3001<code>ArrayIndexOutOfBoundsException</code>\uff08\u6570\u7ec4\u8d8a\u754c\uff09\u3001<code>ClassCastException</code>\uff08\u7c7b\u578b\u8f6c\u6362\u9519\u8bef\uff09\u3001<code>ArithmeticException</code>\uff08\u7b97\u672f\u9519\u8bef\uff09\u7b49\u3002</li> </ul> <p>\u4ec0\u4e48\u60c5\u51b5\u4e0b finally \u5757\u4e0d\u4f1a\u88ab\u6267\u884c</p> \u56de\u7b54 <ol> <li>\u5728 <code>try</code> \u6216 <code>finally</code>\u5757\u4e2d\u7528\u4e86 <code>System.exit(int)</code>\u9000\u51fa\u7a0b\u5e8f\u3002\u4f46\u662f\uff0c\u5982\u679c <code>System.exit(int)</code> \u5728\u5f02\u5e38\u8bed\u53e5\u4e4b\u540e\uff0c<code>finally</code> \u8fd8\u662f\u4f1a\u88ab\u6267\u884c</li> <li>\u7a0b\u5e8f\u6240\u5728\u7684\u7ebf\u7a0b\u6b7b\u4ea1\u3002</li> <li>\u5173\u95ed CPU\u3002</li> </ol> <p>\u5f53\u5728 try \u5757\u6216 catch \u5757\u4e2d\u9047\u5230 return \u8bed\u53e5\u65f6 finally \u5757\u4f1a\u4e0d\u4f1a\u88ab\u6267\u884c</p> \u56de\u7b54 <p>\u4f1a\uff0c\u5728\u65b9\u6cd5\u8fd4\u56de\u4e4b\u524d\uff0cfinally \u8bed\u53e5\u7684\u5185\u5bb9\u5c06\u88ab\u6267\u884c\uff0c\u5e76\u4e14 finally \u8bed\u53e5\u7684\u8fd4\u56de\u503c\u5c06\u4f1a\u8986\u76d6\u539f\u59cb\u7684\u8fd4\u56de\u503c\u3002 <pre><code>    public static int f(int value) {\ntry {\nreturn value * value;\n} finally {\nif (value == 2) {\nreturn 0;\n}\n}\n}\n</code></pre> \u5982\u679c\u8c03\u7528 <code>f(2)</code>\uff0c\u8fd4\u56de\u503c\u5c06\u662f 0\uff0c\u56e0\u4e3a finally \u8bed\u53e5\u7684\u8fd4\u56de\u503c\u8986\u76d6\u4e86 try \u8bed\u53e5\u5757\u7684\u8fd4\u56de\u503c\u3002</p> <p>\u8bf4\u4e0bIO\u6d41</p> \u56de\u7b54 <ul> <li>\u6309\u7167\u6d41\u7684\u6d41\u5411\u5206\uff0c\u53ef\u4ee5\u5206\u4e3a\u8f93\u5165\u6d41\u548c\u8f93\u51fa\u6d41\uff1b</li> <li>\u6309\u7167\u64cd\u4f5c\u5355\u5143\u5212\u5206\uff0c\u53ef\u4ee5\u5212\u5206\u4e3a\u5b57\u8282\u6d41\u548c\u5b57\u7b26\u6d41\uff1b</li> <li>\u6309\u7167\u6d41\u7684\u89d2\u8272\u5212\u5206\u4e3a\u8282\u70b9\u6d41\u548c\u5904\u7406\u6d41\u3002</li> </ul> <p>Java Io \u6d41\u5171\u6d89\u53ca 40 \u591a\u4e2a\u7c7b\uff0c\u8fd9\u4e9b\u7c7b\u770b\u4e0a\u53bb\u5f88\u6742\u4e71\uff0c\u4f46\u5b9e\u9645\u4e0a\u5f88\u6709\u89c4\u5219\uff0c\u800c\u4e14\u5f7c\u6b64\u4e4b\u95f4\u5b58\u5728\u975e\u5e38\u7d27\u5bc6\u7684\u8054\u7cfb\uff0c Java I0 \u6d41\u7684 40 \u591a\u4e2a\u7c7b\u90fd\u662f\u4ece\u5982\u4e0b 4 \u4e2a\u62bd\u8c61\u7c7b\u57fa\u7c7b\u4e2d\u6d3e\u751f\u51fa\u6765\u7684\u3002</p> <ul> <li>InputStream/Reader: \u6240\u6709\u7684\u8f93\u5165\u6d41\u7684\u57fa\u7c7b\uff0c\u524d\u8005\u662f\u5b57\u8282\u8f93\u5165\u6d41\uff0c\u540e\u8005\u662f\u5b57\u7b26\u8f93\u5165\u6d41\u3002</li> <li>OutputStream/Writer: \u6240\u6709\u8f93\u51fa\u6d41\u7684\u57fa\u7c7b\uff0c\u524d\u8005\u662f\u5b57\u8282\u8f93\u51fa\u6d41\uff0c\u540e\u8005\u662f\u5b57\u7b26\u8f93\u51fa\u6d41\u3002</li> </ul> <p>\u65e2\u7136\u6709\u4e86\u5b57\u8282\u6d41,\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709\u5b57\u7b26\u6d41?</p> \u56de\u7b54 <p>\u95ee\u9898\u672c\u8d28\u60f3\u95ee\uff1a\u4e0d\u7ba1\u662f\u6587\u4ef6\u8bfb\u5199\u8fd8\u662f\u7f51\u7edc\u53d1\u9001\u63a5\u6536\uff0c\u4fe1\u606f\u7684\u6700\u5c0f\u5b58\u50a8\u5355\u5143\u90fd\u662f\u5b57\u8282\uff0c\u90a3\u4e3a\u4ec0\u4e48 I/O \u6d41\u64cd\u4f5c\u8981\u5206\u4e3a\u5b57\u8282\u6d41\u64cd\u4f5c\u548c\u5b57\u7b26\u6d41\u64cd\u4f5c\u5462\uff1f</p> <p>\u5b57\u7b26\u6d41\u662f\u7531 Java \u865a\u62df\u673a\u5c06\u5b57\u8282\u8f6c\u6362\u5f97\u5230\u7684\uff0c\u95ee\u9898\u5c31\u51fa\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u8fd8\u7b97\u662f\u975e\u5e38\u8017\u65f6\uff0c\u5e76\u4e14\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u77e5\u9053\u7f16\u7801\u7c7b\u578b\u5c31\u5f88\u5bb9\u6613\u51fa\u73b0\u4e71\u7801\u95ee\u9898\u3002\u6240\u4ee5\uff0c I/O \u6d41\u5c31\u5e72\u8106\u63d0\u4f9b\u4e86\u4e00\u4e2a\u76f4\u63a5\u64cd\u4f5c\u5b57\u7b26\u7684\u63a5\u53e3\uff0c\u65b9\u4fbf\u6211\u4eec\u5e73\u65f6\u5bf9\u5b57\u7b26\u8fdb\u884c\u6d41\u64cd\u4f5c\u3002\u5982\u679c\u97f3\u9891\u6587\u4ef6\u3001\u56fe\u7247\u7b49\u5a92\u4f53\u6587\u4ef6\u7528\u5b57\u8282\u6d41\u6bd4\u8f83\u597d\uff0c\u5982\u679c\u6d89\u53ca\u5230\u5b57\u7b26\u7684\u8bdd\u4f7f\u7528\u5b57\u7b26\u6d41\u6bd4\u8f83\u597d\u3002</p> <p>BIO,NIO,AIO \u6709\u4ec0\u4e48\u533a\u522b?</p> \u56de\u7b54 <ul> <li>BIO (Blocking I/O): \u540c\u6b65\u963b\u585e I/O \u6a21\u5f0f\uff0c\u6570\u636e\u7684\u8bfb\u53d6\u5199\u5165\u5fc5\u987b\u963b\u585e\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5185\u7b49\u5f85\u5176\u5b8c\u6210\u3002\u5728\u6d3b\u52a8\u8fde\u63a5\u6570\u4e0d\u662f\u7279\u522b\u9ad8\uff08\u5c0f\u4e8e\u5355\u673a 1000\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u79cd\u6a21\u578b\u662f\u6bd4\u8f83\u4e0d\u9519\u7684\uff0c\u53ef\u4ee5\u8ba9\u6bcf\u4e00\u4e2a\u8fde\u63a5\u4e13\u6ce8\u4e8e\u81ea\u5df1\u7684 I/O \u5e76\u4e14\u7f16\u7a0b\u6a21\u578b\u7b80\u5355\uff0c\u4e5f\u4e0d\u7528\u8fc7\u591a\u8003\u8651\u7cfb\u7edf\u7684\u8fc7\u8f7d\u3001\u9650\u6d41\u7b49\u95ee\u9898\u3002\u7ebf\u7a0b\u6c60\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u5929\u7136\u7684\u6f0f\u6597\uff0c\u53ef\u4ee5\u7f13\u51b2\u4e00\u4e9b\u7cfb\u7edf\u5904\u7406\u4e0d\u4e86\u7684\u8fde\u63a5\u6216\u8bf7\u6c42\u3002\u4f46\u662f\uff0c\u5f53\u9762\u5bf9\u5341\u4e07\u751a\u81f3\u767e\u4e07\u7ea7\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u4f20\u7edf\u7684 BIO \u6a21\u578b\u662f\u65e0\u80fd\u4e3a\u529b\u7684\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u66f4\u9ad8\u6548\u7684 I/O \u5904\u7406\u6a21\u578b\u6765\u5e94\u5bf9\u66f4\u9ad8\u7684\u5e76\u53d1\u91cf\u3002</li> <li>NIO (Non-blocking/New I/O): NIO \u662f\u4e00\u79cd\u540c\u6b65\u975e\u963b\u585e\u7684 I/O \u6a21\u578b\uff0c\u5728 Java 1.4 \u4e2d\u5f15\u5165\u4e86 NIO \u6846\u67b6\uff0c\u5bf9\u5e94 java.nio \u5305\uff0c\u63d0\u4f9b\u4e86 Channel , Selector\uff0cBuffer \u7b49\u62bd\u8c61\u3002NIO \u4e2d\u7684 N \u53ef\u4ee5\u7406\u89e3\u4e3a Non-blocking\uff0c\u4e0d\u5355\u7eaf\u662f New\u3002\u5b83\u652f\u6301\u9762\u5411\u7f13\u51b2\u7684\uff0c\u57fa\u4e8e\u901a\u9053\u7684 I/O \u64cd\u4f5c\u65b9\u6cd5\u3002 NIO \u63d0\u4f9b\u4e86\u4e0e\u4f20\u7edf BIO \u6a21\u578b\u4e2d\u7684 <code>Socket</code> \u548c <code>ServerSocket</code> \u76f8\u5bf9\u5e94\u7684 <code>SocketChannel</code> \u548c <code>ServerSocketChannel</code> \u4e24\u79cd\u4e0d\u540c\u7684\u5957\u63a5\u5b57\u901a\u9053\u5b9e\u73b0,\u4e24\u79cd\u901a\u9053\u90fd\u652f\u6301\u963b\u585e\u548c\u975e\u963b\u585e\u4e24\u79cd\u6a21\u5f0f\u3002\u963b\u585e\u6a21\u5f0f\u4f7f\u7528\u5c31\u50cf\u4f20\u7edf\u4e2d\u7684\u652f\u6301\u4e00\u6837\uff0c\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u662f\u6027\u80fd\u548c\u53ef\u9760\u6027\u90fd\u4e0d\u597d\uff1b\u975e\u963b\u585e\u6a21\u5f0f\u6b63\u597d\u4e0e\u4e4b\u76f8\u53cd\u3002\u5bf9\u4e8e\u4f4e\u8d1f\u8f7d\u3001\u4f4e\u5e76\u53d1\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u4f7f\u7528\u540c\u6b65\u963b\u585e I/O \u6765\u63d0\u5347\u5f00\u53d1\u901f\u7387\u548c\u66f4\u597d\u7684\u7ef4\u62a4\u6027\uff1b\u5bf9\u4e8e\u9ad8\u8d1f\u8f7d\u3001\u9ad8\u5e76\u53d1\u7684\uff08\u7f51\u7edc\uff09\u5e94\u7528\uff0c\u5e94\u4f7f\u7528 NIO \u7684\u975e\u963b\u585e\u6a21\u5f0f\u6765\u5f00\u53d1</li> <li>AIO (Asynchronous I/O): AIO \u4e5f\u5c31\u662f NIO 2\u3002\u5728 Java 7 \u4e2d\u5f15\u5165\u4e86 NIO \u7684\u6539\u8fdb\u7248 NIO 2,\u5b83\u662f\u5f02\u6b65\u975e\u963b\u585e\u7684 IO \u6a21\u578b\u3002\u5f02\u6b65 IO \u662f\u57fa\u4e8e\u4e8b\u4ef6\u548c\u56de\u8c03\u673a\u5236\u5b9e\u73b0\u7684\uff0c\u4e5f\u5c31\u662f\u5e94\u7528\u64cd\u4f5c\u4e4b\u540e\u4f1a\u76f4\u63a5\u8fd4\u56de\uff0c\u4e0d\u4f1a\u5835\u585e\u5728\u90a3\u91cc\uff0c\u5f53\u540e\u53f0\u5904\u7406\u5b8c\u6210\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u901a\u77e5\u76f8\u5e94\u7684\u7ebf\u7a0b\u8fdb\u884c\u540e\u7eed\u7684\u64cd\u4f5c\u3002AIO \u662f\u5f02\u6b65 IO \u7684\u7f29\u5199\uff0c\u867d\u7136 NIO \u5728\u7f51\u7edc\u64cd\u4f5c\u4e2d\uff0c\u63d0\u4f9b\u4e86\u975e\u963b\u585e\u7684\u65b9\u6cd5\uff0c\u4f46\u662f NIO \u7684 IO \u884c\u4e3a\u8fd8\u662f\u540c\u6b65\u7684\u3002\u5bf9\u4e8e NIO \u6765\u8bf4\uff0c\u6211\u4eec\u7684\u4e1a\u52a1\u7ebf\u7a0b\u662f\u5728 IO \u64cd\u4f5c\u51c6\u5907\u597d\u65f6\uff0c\u5f97\u5230\u901a\u77e5\uff0c\u63a5\u7740\u5c31\u7531\u8fd9\u4e2a\u7ebf\u7a0b\u81ea\u884c\u8fdb\u884c IO \u64cd\u4f5c\uff0cIO \u64cd\u4f5c\u672c\u8eab\u662f\u540c\u6b65\u7684\u3002</li> </ul>"},{"location":"interview/java_collection/","title":"Java \u96c6\u5408","text":"<p>\u5bb9\u5668\u4e2d\u7684\u8bbe\u8ba1\u6a21\u5f0f</p> \u56de\u7b54 <ul> <li>\u8fed\u4ee3\u5668\u6a21\u5f0f<ul> <li>Collection \u7ee7\u627f\u4e86 Iterable \u63a5\u53e3\uff0c\u5176\u4e2d\u7684 iterator() \u65b9\u6cd5\u80fd\u591f\u4ea7\u751f\u4e00\u4e2a Iterator \u5bf9\u8c61\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u53ef\u4ee5\u8fed\u4ee3\u904d\u5386 Collection \u4e2d\u7684\u5143\u7d20\u3002</li> </ul> </li> <li>\u9002\u914d\u5668\u6a21\u5f0f<ul> <li><code>java.util.Arrays#asList()</code> \u53ef\u4ee5\u628a\u6570\u7ec4\u7c7b\u578b\u8f6c\u6362\u4e3a List \u7c7b\u578b\u3002</li> </ul> </li> </ul> <p>ArrayList \u4e0e Vector\u3001LinkedList \u533a\u522b</p> \u56de\u7b54 <ul> <li>ArrayList \u662f List \u7684\u4e3b\u8981\u5b9e\u73b0\u7c7b\uff0c\u5e95\u5c42\u4f7f\u7528 <code>Object[ ]</code>\u5b58\u50a8\uff0c\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff0c\u9002\u7528\u4e8e\u9891\u7e41\u7684\u67e5\u627e\u5de5\u4f5c\uff0c\u7ebf\u7a0b\u4e0d\u5b89\u5168</li> <li>Vector \u662f List \u7684\u53e4\u8001\u5b9e\u73b0\u7c7b\uff0c\u5e95\u5c42\u4f7f\u7528 <code>Object[ ]</code> \u5b58\u50a8\uff0c\u7ebf\u7a0b\u5b89\u5168\u7684</li> <li>LinkedList\u57fa\u4e8e\u53cc\u5411\u94fe\u8868\u5b9e\u73b0\uff0c\u53ea\u80fd\u987a\u5e8f\u8bbf\u95ee\uff0c\u4f46\u662f\u53ef\u4ee5\u5feb\u901f\u5730\u5728\u94fe\u8868\u4e2d\u95f4\u63d2\u5165\u548c\u5220\u9664\u5143\u7d20\u3002\u4e0d\u4ec5\u5982\u6b64\uff0cLinkedList \u8fd8\u53ef\u4ee5\u7528\u4f5c\u6808\u3001\u961f\u5217\u548c\u53cc\u5411\u961f\u5217</li> </ul> <p>\u8bf4\u4e00\u8bf4 ArrayList \u7684\u6269\u5bb9\u673a\u5236\u5427</p> \u56de\u7b54 <ul> <li>\u6dfb\u52a0\u5143\u7d20\u65f6\u4f7f\u7528 <code>ensureCapacityInternal()</code> \u65b9\u6cd5\u6765\u4fdd\u8bc1\u5bb9\u91cf\u8db3\u591f\uff0c\u5982\u679c\u4e0d\u591f\u65f6\uff0c\u9700\u8981\u4f7f\u7528 <code>grow()</code> \u65b9\u6cd5\u8fdb\u884c\u6269\u5bb9\uff0c\u65b0\u5bb9\u91cf\u7684\u5927\u5c0f\u4e3a <code>oldCapacity + (oldCapacity &gt;&gt; 1)</code>\uff0c\u5373 <code>oldCapacity+oldCapacity/2</code>\u3002\u5176\u4e2d oldCapacity &gt;&gt; 1 \u9700\u8981\u53d6\u6574\uff0c\u6240\u4ee5\u65b0\u5bb9\u91cf\u5927\u7ea6\u662f\u65e7\u5bb9\u91cf\u7684 1.5 \u500d\u5de6\u53f3\u3002\uff08oldCapacity \u4e3a\u5076\u6570\u5c31\u662f 1.5 \u500d\uff0c\u4e3a\u5947\u6570\u5c31\u662f 1.5 \u500d-0.5\uff09</li> <li>\u6269\u5bb9\u64cd\u4f5c\u9700\u8981\u8c03\u7528 Arrays.copyOf() \u628a\u539f\u6570\u7ec4\u6574\u4e2a\u590d\u5236\u5230\u65b0\u6570\u7ec4\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4ee3\u4ef7\u5f88\u9ad8\uff0c\u56e0\u6b64\u6700\u597d\u5728\u521b\u5efa ArrayList \u5bf9\u8c61\u65f6\u5c31\u6307\u5b9a\u5927\u6982\u7684\u5bb9\u91cf\u5927\u5c0f\uff0c\u51cf\u5c11\u6269\u5bb9\u64cd\u4f5c\u7684\u6b21\u6570 <pre><code>public boolean add(E e) {\nensureCapacityInternal(size + 1);  // Increments modCount!!\nelementData[size++] = e;\nreturn true;\n}\nprivate void ensureCapacityInternal(int minCapacity) {\nif (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\nminCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);\n}\nensureExplicitCapacity(minCapacity);\n}\nprivate void ensureExplicitCapacity(int minCapacity) {\nmodCount++;\n// overflow-conscious code\nif (minCapacity - elementData.length &gt; 0)\ngrow(minCapacity);\n}\nprivate void grow(int minCapacity) {\n// overflow-conscious code\nint oldCapacity = elementData.length;\nint newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);\nif (newCapacity - minCapacity &lt; 0)\nnewCapacity = minCapacity;\nif (newCapacity - MAX_ARRAY_SIZE &gt; 0)\nnewCapacity = hugeCapacity(minCapacity);\n// minCapacity is usually close to size, so this is a win:\nelementData = Arrays.copyOf(elementData, newCapacity);\n}\n</code></pre></li> </ul> <p>HashMap \u548c Hashtable \u7684\u533a\u522b</p> \u56de\u7b54 <ul> <li>\u7ebf\u7a0b\u662f\u5426\u5b89\u5168\uff1a HashMap \u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0cHashTable \u662f\u7ebf\u7a0b\u5b89\u5168\u7684,\u56e0\u4e3a HashTable \u5185\u90e8\u7684\u65b9\u6cd5\u57fa\u672c\u90fd\u7ecf\u8fc7synchronized \u4fee\u9970\u3002</li> <li>\u6548\u7387\uff1a \u56e0\u4e3a\u7ebf\u7a0b\u5b89\u5168\u7684\u95ee\u9898\uff0cHashMap \u8981\u6bd4 HashTable \u6548\u7387\u9ad8\u4e00\u70b9\u3002\u53e6\u5916\uff0cHashTable \u57fa\u672c\u88ab\u6dd8\u6c70\uff0c\u4e0d\u8981\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b83\uff1b</li> <li>\u5bf9 Null key \u548c Null value \u7684\u652f\u6301\uff1a HashMap \u53ef\u4ee5\u5b58\u50a8 null \u7684 key \u548c value\uff0c\u4f46 null \u4f5c\u4e3a\u952e\u53ea\u80fd\u6709\u4e00\u4e2a\uff0cnull \u4f5c\u4e3a\u503c\u53ef\u4ee5\u6709\u591a\u4e2a\uff1bHashTable \u4e0d\u5141\u8bb8\u6709 null \u952e\u548c null \u503c\uff0c\u5426\u5219\u4f1a\u629b\u51fa NullPointerException\u3002</li> <li>\u521d\u59cb\u5bb9\u91cf\u5927\u5c0f\u548c\u6bcf\u6b21\u6269\u5145\u5bb9\u91cf\u5927\u5c0f\u7684\u4e0d\u540c \uff1a \u2460 \u521b\u5efa\u65f6\u5982\u679c\u4e0d\u6307\u5b9a\u5bb9\u91cf\u521d\u59cb\u503c\uff0cHashtable \u9ed8\u8ba4\u7684\u521d\u59cb\u5927\u5c0f\u4e3a 11\uff0c\u4e4b\u540e\u6bcf\u6b21\u6269\u5145\uff0c\u5bb9\u91cf\u53d8\u4e3a\u539f\u6765\u7684 2n+1\u3002HashMap \u9ed8\u8ba4\u7684\u521d\u59cb\u5316\u5927\u5c0f\u4e3a 16\u3002\u4e4b\u540e\u6bcf\u6b21\u6269\u5145\uff0c\u5bb9\u91cf\u53d8\u4e3a\u539f\u6765\u7684 2 \u500d\u3002\u2461 \u521b\u5efa\u65f6\u5982\u679c\u7ed9\u5b9a\u4e86\u5bb9\u91cf\u521d\u59cb\u503c\uff0c\u90a3\u4e48 Hashtable \u4f1a\u76f4\u63a5\u4f7f\u7528\u4f60\u7ed9\u5b9a\u7684\u5927\u5c0f\uff0c\u800c HashMap \u4f1a\u5c06\u5176\u6269\u5145\u4e3a 2 \u7684\u5e42\u6b21\u65b9\u5927\u5c0f</li> <li>\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1a JDK1.8 \u4ee5\u540e\u7684 HashMap \u5728\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u65f6\u6709\u4e86\u8f83\u5927\u7684\u53d8\u5316\uff0c\u5f53\u94fe\u8868\u957f\u5ea6\u5927\u4e8e\u9608\u503c\uff08\u9ed8\u8ba4\u4e3a 8\uff09\uff08\u5c06\u94fe\u8868\u8f6c\u6362\u6210\u7ea2\u9ed1\u6811\u524d\u4f1a\u5224\u65ad\uff0c\u5982\u679c\u5f53\u524d\u6570\u7ec4\u7684\u957f\u5ea6\u5c0f\u4e8e 64\uff0c\u90a3\u4e48\u4f1a\u9009\u62e9\u5148\u8fdb\u884c\u6570\u7ec4\u6269\u5bb9\uff0c\u800c\u4e0d\u662f\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811\uff09\u65f6\uff0c\u5c06\u94fe\u8868\u8f6c\u5316\u4e3a\u7ea2\u9ed1\u6811\uff0c\u4ee5\u51cf\u5c11\u641c\u7d22\u65f6\u95f4\u3002Hashtable \u6ca1\u6709\u8fd9\u6837\u7684\u673a\u5236\u3002</li> </ul> <p>HashMap \u548c HashSet\u533a\u522b</p> \u56de\u7b54 <p>HashSet \u5e95\u5c42\u5c31\u662f\u57fa\u4e8e HashMap \u5b9e\u73b0\u7684\u3002\uff08HashSet \u7684\u6e90\u7801\u975e\u5e38\u975e\u5e38\u5c11\uff0c\u56e0\u4e3a\u9664\u4e86 clone()\u3001writeObject()\u3001readObject()\u662f HashSet \u81ea\u5df1\u4e0d\u5f97\u4e0d\u5b9e\u73b0\u4e4b\u5916\uff0c\u5176\u4ed6\u65b9\u6cd5\u90fd\u662f\u76f4\u63a5\u8c03\u7528 HashMap \u4e2d\u7684\u65b9\u6cd5\u3002</p> <p>HashMap\u7684\u5e95\u5c42\u5b9e\u73b0</p> \u56de\u7b54 <ul> <li>JDK1.8 \u4e4b\u524d JDK1.8 \u4e4b\u524d <code>HashMap</code> \u5e95\u5c42\u662f \u6570\u7ec4\u548c\u94fe\u8868 \u7ed3\u5408\u5728\u4e00\u8d77\u4f7f\u7528\u4e5f\u5c31\u662f \u94fe\u8868\u6563\u5217\u3002HashMap \u901a\u8fc7 key \u7684 hashCode \u7ecf\u8fc7\u6270\u52a8\u51fd\u6570\u5904\u7406\u8fc7\u540e\u5f97\u5230 hash \u503c\uff0c\u7136\u540e\u901a\u8fc7 (n - 1) &amp; hash \u5224\u65ad\u5f53\u524d\u5143\u7d20\u5b58\u653e\u7684\u4f4d\u7f6e\uff08\u8fd9\u91cc\u7684 n \u6307\u7684\u662f\u6570\u7ec4\u7684\u957f\u5ea6\uff09\uff0c\u5982\u679c\u5f53\u524d\u4f4d\u7f6e\u5b58\u5728\u5143\u7d20\u7684\u8bdd\uff0c\u5c31\u5224\u65ad\u8be5\u5143\u7d20\u4e0e\u8981\u5b58\u5165\u7684\u5143\u7d20\u7684 hash \u503c\u4ee5\u53ca key \u662f\u5426\u76f8\u540c\uff0c\u5982\u679c\u76f8\u540c\u7684\u8bdd\uff0c\u76f4\u63a5\u8986\u76d6\uff0c\u4e0d\u76f8\u540c\u5c31\u901a\u8fc7\u62c9\u94fe\u6cd5\u89e3\u51b3\u51b2\u7a81\u3002</li> </ul> <p>\u6240\u8c13\u6270\u52a8\u51fd\u6570\u6307\u7684\u5c31\u662f HashMap \u7684 hash \u65b9\u6cd5\u3002\u4f7f\u7528 hash \u65b9\u6cd5\u4e5f\u5c31\u662f\u6270\u52a8\u51fd\u6570\u662f\u4e3a\u4e86\u9632\u6b62\u4e00\u4e9b\u5b9e\u73b0\u6bd4\u8f83\u5dee\u7684 hashCode() \u65b9\u6cd5 \u6362\u53e5\u8bdd\u8bf4\u4f7f\u7528\u6270\u52a8\u51fd\u6570\u4e4b\u540e\u53ef\u4ee5\u51cf\u5c11\u78b0\u649e\u3002 JDK 1.8 HashMap \u7684 hash \u65b9\u6cd5\u6e90\u7801:</p> <p>JDK 1.8 \u7684 hash \u65b9\u6cd5 \u76f8\u6bd4\u4e8e JDK 1.7 hash \u65b9\u6cd5\u66f4\u52a0\u7b80\u5316\uff0c\u4f46\u662f\u539f\u7406\u4e0d\u53d8\u3002</p> <pre><code>    static final int hash(Object key) {\nint h;\n// key.hashCode()\uff1a\u8fd4\u56de\u6563\u5217\u503c\u4e5f\u5c31\u662fhashcode\n// ^ \uff1a\u6309\u4f4d\u5f02\u6216\n// &gt;&gt;&gt;:\u65e0\u7b26\u53f7\u53f3\u79fb\uff0c\u5ffd\u7565\u7b26\u53f7\u4f4d\uff0c\u7a7a\u4f4d\u90fd\u4ee50\u8865\u9f50\nreturn (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);\n}\n</code></pre> <p>\u5bf9\u6bd4\u4e00\u4e0b JDK1.7 \u7684 HashMap \u7684 hash \u65b9\u6cd5\u6e90\u7801.</p> <pre><code>static int hash(int h) {\n// This function ensures that hashCodes that differ only by\n// constant multiples at each bit position have a bounded\n// number of collisions (approximately 8 at default load factor).\nh ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);\nreturn h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);\n}\n</code></pre> <p>\u76f8\u6bd4\u4e8e JDK1.8 \u7684 hash \u65b9\u6cd5 \uff0cJDK 1.7 \u7684 hash \u65b9\u6cd5\u7684\u6027\u80fd\u4f1a\u7a0d\u5dee\u4e00\u70b9\u70b9\uff0c\u56e0\u4e3a\u6bd5\u7adf\u6270\u52a8\u4e86 4 \u6b21\u3002</p> <p>\u6240\u8c13 \u201c\u62c9\u94fe\u6cd5\u201d \u5c31\u662f\uff1a\u5c06\u94fe\u8868\u548c\u6570\u7ec4\u76f8\u7ed3\u5408\u3002\u4e5f\u5c31\u662f\u8bf4\u521b\u5efa\u4e00\u4e2a\u94fe\u8868\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u6bcf\u4e00\u683c\u5c31\u662f\u4e00\u4e2a\u94fe\u8868\u3002\u82e5\u9047\u5230\u54c8\u5e0c\u51b2\u7a81\uff0c\u5219\u5c06\u51b2\u7a81\u7684\u503c\u52a0\u5230\u94fe\u8868\u4e2d\u5373\u53ef\u3002 </p> <ul> <li>JDK1.8 \u4e4b\u540e \u76f8\u6bd4\u4e8e\u4e4b\u524d\u7684\u7248\u672c\uff0c JDK1.8 \u4e4b\u540e\u5728\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u65f6\u6709\u4e86\u8f83\u5927\u7684\u53d8\u5316\uff0c\u5f53\u94fe\u8868\u957f\u5ea6\u5927\u4e8e\u9608\u503c\uff08\u9ed8\u8ba4\u4e3a 8\uff09\uff08\u5c06\u94fe\u8868\u8f6c\u6362\u6210\u7ea2\u9ed1\u6811\u524d\u4f1a\u5224\u65ad\uff0c\u5982\u679c\u5f53\u524d\u6570\u7ec4\u7684\u957f\u5ea6\u5c0f\u4e8e 64\uff0c\u90a3\u4e48\u4f1a\u9009\u62e9\u5148\u8fdb\u884c\u6570\u7ec4\u6269\u5bb9\uff0c\u800c\u4e0d\u662f\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811\uff09\u65f6\uff0c\u5c06\u94fe\u8868\u8f6c\u5316\u4e3a\u7ea2\u9ed1\u6811\uff0c\u4ee5\u51cf\u5c11\u641c\u7d22\u65f6\u95f4\u3002  <p>TreeMap\u3001TreeSet \u4ee5\u53ca JDK1.8 \u4e4b\u540e\u7684 HashMap \u5e95\u5c42\u90fd\u7528\u5230\u4e86\u7ea2\u9ed1\u6811\u3002\u7ea2\u9ed1\u6811\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u7f3a\u9677\uff0c\u56e0\u4e3a\u4e8c\u53c9\u67e5\u627e\u6811\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u9000\u5316\u6210\u4e00\u4e2a\u7ebf\u6027\u7ed3\u6784\u3002</p> </li> </ul> <p>HashMap \u7684\u957f\u5ea6\u4e3a\u4ec0\u4e48\u662f2\u7684\u5e42\u6b21\u65b9</p> \u56de\u7b54 <p>\u4e3a\u4e86\u80fd\u8ba9 HashMap \u5b58\u53d6\u9ad8\u6548\uff0c\u5c3d\u91cf\u8f83\u5c11\u78b0\u649e\uff0c\u4e5f\u5c31\u662f\u8981\u5c3d\u91cf\u628a\u6570\u636e\u5206\u914d\u5747\u5300\u3002\u6211\u4eec\u4e0a\u9762\u4e5f\u8bb2\u5230\u4e86\u8fc7\u4e86\uff0cHash \u503c\u7684\u8303\u56f4\u503c-2147483648\u52302147483647\uff0c\u524d\u540e\u52a0\u8d77\u6765\u5927\u698240\u4ebf\u7684\u6620\u5c04\u7a7a\u95f4\uff0c\u53ea\u8981\u54c8\u5e0c\u51fd\u6570\u6620\u5c04\u5f97\u6bd4\u8f83\u5747\u5300\u677e\u6563\uff0c\u4e00\u822c\u5e94\u7528\u662f\u5f88\u96be\u51fa\u73b0\u78b0\u649e\u7684\u3002\u4f46\u95ee\u9898\u662f\u4e00\u4e2a40\u4ebf\u957f\u5ea6\u7684\u6570\u7ec4\uff0c\u5185\u5b58\u662f\u653e\u4e0d\u4e0b\u7684\u3002\u6240\u4ee5\u8fd9\u4e2a\u6563\u5217\u503c\u662f\u4e0d\u80fd\u76f4\u63a5\u62ff\u6765\u7528\u7684\u3002\u7528\u4e4b\u524d\u8fd8\u8981\u5148\u505a\u5bf9\u6570\u7ec4\u7684\u957f\u5ea6\u53d6\u6a21\u8fd0\u7b97\uff0c\u5f97\u5230\u7684\u4f59\u6570\u624d\u80fd\u7528\u6765\u8981\u5b58\u653e\u7684\u4f4d\u7f6e\u4e5f\u5c31\u662f\u5bf9\u5e94\u7684\u6570\u7ec4\u4e0b\u6807\u3002\u8fd9\u4e2a\u6570\u7ec4\u4e0b\u6807\u7684\u8ba1\u7b97\u65b9\u6cd5\u662f\u201c <code>(n - 1) &amp; hash</code>\u201d\u3002\uff08n\u4ee3\u8868\u6570\u7ec4\u957f\u5ea6\uff09\u3002\u8fd9\u4e5f\u5c31\u89e3\u91ca\u4e86 HashMap \u7684\u957f\u5ea6\u4e3a\u4ec0\u4e48\u662f2\u7684\u5e42\u6b21\u65b9\u3002</p> <p>\u8fd9\u4e2a\u7b97\u6cd5\u5e94\u8be5\u5982\u4f55\u8bbe\u8ba1\u5462\uff1f</p> <p>\u6211\u4eec\u9996\u5148\u53ef\u80fd\u4f1a\u60f3\u5230\u91c7\u7528%\u53d6\u4f59\u7684\u64cd\u4f5c\u6765\u5b9e\u73b0\u3002\u4f46\u662f\uff0c\u91cd\u70b9\u6765\u4e86\uff1a\u201c\u53d6\u4f59(%)\u64cd\u4f5c\u4e2d\u5982\u679c\u9664\u6570\u662f2\u7684\u5e42\u6b21\u5219\u7b49\u4ef7\u4e8e\u4e0e\u5176\u9664\u6570\u51cf\u4e00\u7684\u4e0e(&amp;)\u64cd\u4f5c\uff08\u4e5f\u5c31\u662f\u8bf4 hash%length==hash&amp;(length-1)\u7684\u524d\u63d0\u662f length \u662f2\u7684 n \u6b21\u65b9\uff1b\uff09\u3002\u201d \u5e76\u4e14 \u91c7\u7528\u4e8c\u8fdb\u5236\u4f4d\u64cd\u4f5c &amp;\uff0c\u76f8\u5bf9\u4e8e%\u80fd\u591f\u63d0\u9ad8\u8fd0\u7b97\u6548\u7387\uff0c\u8fd9\u5c31\u89e3\u91ca\u4e86 HashMap \u7684\u957f\u5ea6\u4e3a\u4ec0\u4e48\u662f2\u7684\u5e42\u6b21\u65b9\u3002</p> <p>HashMap \u591a\u7ebf\u7a0b\u64cd\u4f5c\u5bfc\u81f4\u6b7b\u5faa\u73af\u95ee\u9898</p> \u56de\u7b54 <p>\u4e3b\u8981\u539f\u56e0\u5728\u4e8e \u5e76\u53d1\u4e0b\u7684Rehash \u4f1a\u9020\u6210\u5143\u7d20\u4e4b\u95f4\u4f1a\u5f62\u6210\u4e00\u4e2a\u5faa\u73af\u94fe\u8868\u3002\u4e0d\u8fc7\uff0cjdk 1.8 \u540e\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\u8fd8\u662f\u4e0d\u5efa\u8bae\u5728\u591a\u7ebf\u7a0b\u4e0b\u4f7f\u7528 HashMap,\u56e0\u4e3a\u591a\u7ebf\u7a0b\u4e0b\u4f7f\u7528 HashMap \u8fd8\u662f\u4f1a\u5b58\u5728\u5176\u4ed6\u95ee\u9898\u6bd4\u5982\u6570\u636e\u4e22\u5931\u3002\u5e76\u53d1\u73af\u5883\u4e0b\u63a8\u8350\u4f7f\u7528 ConcurrentHashMap \u3002</p> <p>\u8bf4\u4e00\u4e0bConcurrentHashMap</p> \u56de\u7b54 <ul> <li> <p>JDK1.8\u4e4b\u524d  \u5e95\u5c42\u91c7\u7528 <code>\u5206\u6bb5\u7684\u6570\u7ec4+\u94fe\u8868</code> \u5b9e\u73b0\uff0c \u9996\u5148\u5c06\u6570\u636e\u5206\u4e3a\u4e00\u6bb5\u4e00\u6bb5\u7684\u5b58\u50a8\uff0c\u7136\u540e\u7ed9\u6bcf\u4e00\u6bb5\u6570\u636e\u914d\u4e00\u628a\u9501\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u5360\u7528\u9501\u8bbf\u95ee\u5176\u4e2d\u4e00\u4e2a\u6bb5\u6570\u636e\u65f6\uff0c\u5176\u4ed6\u6bb5\u7684\u6570\u636e\u4e5f\u80fd\u88ab\u5176\u4ed6\u7ebf\u7a0b\u8bbf\u95ee <code>ConcurrentHashMap</code> \u662f\u7531 <code>Segment</code> \u6570\u7ec4\u7ed3\u6784\u548c <code>HashEntry</code> \u6570\u7ec4\u7ed3\u6784\u7ec4\u6210\u3002 Segment \u5b9e\u73b0\u4e86 <code>ReentrantLock</code>,\u6240\u4ee5 <code>Segment</code> \u662f\u4e00\u79cd\u53ef\u91cd\u5165\u9501\uff0c\u626e\u6f14\u9501\u7684\u89d2\u8272\u3002<code>HashEntry</code> \u7528\u4e8e\u5b58\u50a8\u952e\u503c\u5bf9\u6570\u636e\u3002 <pre><code>static class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable {\n}\n</code></pre> \u4e00\u4e2a <code>ConcurrentHashMap</code> \u91cc\u5305\u542b\u4e00\u4e2a <code>Segment</code> \u6570\u7ec4\u3002<code>Segment</code> \u7684\u7ed3\u6784\u548c <code>HashMap</code> \u7c7b\u4f3c\uff0c\u662f\u4e00\u79cd\u6570\u7ec4\u548c\u94fe\u8868\u7ed3\u6784\uff0c\u4e00\u4e2a <code>Segment</code> \u5305\u542b\u4e00\u4e2a <code>HashEntry</code> \u6570\u7ec4\uff0c\u6bcf\u4e2a <code>HashEntry</code> \u662f\u4e00\u4e2a\u94fe\u8868\u7ed3\u6784\u7684\u5143\u7d20\uff0c\u6bcf\u4e2a <code>Segment</code> \u5b88\u62a4\u7740\u4e00\u4e2a <code>HashEntry</code> \u6570\u7ec4\u91cc\u7684\u5143\u7d20\uff0c\u5f53\u5bf9 <code>HashEntry</code> \u6570\u7ec4\u7684\u6570\u636e\u8fdb\u884c\u4fee\u6539\u65f6\uff0c\u5fc5\u987b\u9996\u5148\u83b7\u5f97\u5bf9\u5e94\u7684 <code>Segment</code> \u7684\u9501\u3002</p> </li> <li> <p>JDK1.8\u4e4b\u540e <code>ConcurrentHashMap</code> \u53d6\u6d88\u4e86 <code>Segment</code> \u5206\u6bb5\u9501\uff0c\u91c7\u7528 CAS \u548c <code>synchronized</code> \u6765\u4fdd\u8bc1\u5e76\u53d1\u5b89\u5168\u3002\u6570\u636e\u7ed3\u6784\u8ddf HashMap1.8 \u7684\u7ed3\u6784\u7c7b\u4f3c\uff0c\u6570\u7ec4+\u94fe\u8868/\u7ea2\u9ed1\u4e8c\u53c9\u6811\u3002Java 8 \u5728\u94fe\u8868\u957f\u5ea6\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\uff088\uff09\u65f6\u5c06\u94fe\u8868\uff08\u5bfb\u5740\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(N)\uff09\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811\uff08\u5bfb\u5740\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(log(N))\uff09 <code>synchronized</code> \u53ea\u9501\u5b9a\u5f53\u524d\u94fe\u8868\u6216\u7ea2\u9ed1\u4e8c\u53c9\u6811\u7684\u9996\u8282\u70b9\uff0c\u8fd9\u6837\u53ea\u8981 hash \u4e0d\u51b2\u7a81\uff0c\u5c31\u4e0d\u4f1a\u4ea7\u751f\u5e76\u53d1\uff0c\u6548\u7387\u53c8\u63d0\u5347 N \u500d\uff08JDK1.6 \u4ee5\u540e \u5bf9 synchronized \u9501\u505a\u4e86\u5f88\u591a\u4f18\u5316\uff09 \u3002</p> </li> </ul> <p>\u8bf4\u4e00\u4e0bWeakHashMap</p> \u56de\u7b54 <ul> <li> <p>\u539f\u7406\uff1a WeakHashMap \u7684 Entry \u7ee7\u627f\u81ea WeakReference\uff0c\u88ab WeakReference \u5173\u8054\u7684\u5bf9\u8c61\u5728\u4e0b\u4e00\u6b21\u5783\u573e\u56de\u6536\u65f6\u4f1a\u88ab\u56de\u6536\u3002</p> </li> <li> <p>\u4f5c\u7528\uff1a WeakHashMap \u4e3b\u8981\u7528\u6765\u5b9e\u73b0\u7f13\u5b58\uff0c\u901a\u8fc7\u4f7f\u7528 WeakHashMap \u6765\u5f15\u7528\u7f13\u5b58\u5bf9\u8c61\uff0c\u7531 JVM \u5bf9\u8fd9\u90e8\u5206\u7f13\u5b58\u8fdb\u884c\u56de\u6536\u3002 <pre><code>private static class Entry&lt;K,V&gt; extends WeakReference&lt;Object&gt; implements Map.Entry&lt;K,V&gt;\n</code></pre></p> </li> <li> <p>Entry\u7684Value\u662f\u5426\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\uff1aWeakHashMap\u4f1a\u5728\u5728\u8bbf\u95ee\u5185\u5bb9\uff08<code>put</code>,<code>get</code>\uff09\u7684\u65f6\u5019\u91ca\u653e\u5185\u90e8\u4e0d\u7528\u7684\u5bf9\u8c61\uff08\u5b9e\u5219\u662f\u901a\u8fc7\u8bbf\u95ee\u8c03\u7528\u4e86\u5b83\u7684<code>expungeStaleEntries</code>\u51fd\u6570\uff09 <pre><code>    private void expungeStaleEntries() {\nfor (Object x; (x = queue.poll()) != null; ) {\nsynchronized (queue) {\n@SuppressWarnings(\"unchecked\")\nEntry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) x;\nint i = indexFor(e.hash, table.length);\nEntry&lt;K,V&gt; prev = table[i];\nEntry&lt;K,V&gt; p = prev;\nwhile (p != null) {\nEntry&lt;K,V&gt; next = p.next;\nif (p == e) {\nif (prev == e)\ntable[i] = next;\nelse\nprev.next = next;\n// Must not null out e.next;\n// stale entries may be in use by a HashIterator\ne.value = null; // Help GC\nsize--;\nbreak;\n}\nprev = p;\np = next;\n}\n}\n}\n}\n</code></pre></p> </li> </ul> <p>\u8bf4\u4e00\u4e0bLinkedHashMap</p> \u56de\u7b54 <ul> <li>\u7ee7\u627f\u81ea HashMap\uff0c\u56e0\u6b64\u5177\u6709\u548c HashMap \u4e00\u6837\u7684\u5feb\u901f\u67e5\u627e\u7279\u6027\u3002</li> <li>\u5185\u90e8\u7ef4\u62a4\u4e86\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u7528\u6765\u7ef4\u62a4\u63d2\u5165\u987a\u5e8f\u6216\u8005 LRU \u987a\u5e8f\u3002</li> <li>\u5f53\u7ef4\u62a4 LRU \u987a\u5e8f\u65f6\u53ef\u4ee5\u5b9e\u73b0LRU\u7f13\u5b58<ul> <li>\u5f53\u4e00\u4e2a\u8282\u70b9\u88ab\u8bbf\u95ee\u65f6\uff0c\u901a\u8fc7<code>afterNodeAccess</code>\u65b9\u6cd5\u4fdd\u8bc1\u5728\u6bcf\u6b21\u8bbf\u95ee\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u4f1a\u5c06\u8fd9\u4e2a\u8282\u70b9\u79fb\u5230\u94fe\u8868\u5c3e\u90e8\uff0c\u4fdd\u8bc1\u94fe\u8868\u5c3e\u90e8\u662f\u6700\u8fd1\u8bbf\u95ee\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u94fe\u8868\u9996\u90e8\u5c31\u662f\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u8282\u70b9\u3002</li> <li><code>afterNodeInsertion</code>\u5728 put \u7b49\u64cd\u4f5c\u4e4b\u540e\u6267\u884c\uff0c\u5f53 <code>removeEldestEntry()</code> \u65b9\u6cd5\u8fd4\u56de true \u65f6\u4f1a\u79fb\u9664\u6700\u665a\u7684\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u94fe\u8868\u9996\u90e8\u8282\u70b9 first</li> </ul> </li> <li>LRU \u793a\u4f8b <pre><code>class LRUCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; {\nprivate static final int MAX_ENTRIES = 3;\nprotected boolean removeEldestEntry(Map.Entry eldest) {\nreturn size() &gt; MAX_ENTRIES;\n}\nLRUCache() {\nsuper(MAX_ENTRIES, 0.75f, true);\n}\n}\n</code></pre></li> </ul> <p>\u8bf4\u4e00\u4e0bCopyOnWriteArrayList</p> \u56de\u7b54 <ul> <li>\u8bfb\u5199\u5206\u79bb \u5199\u64cd\u4f5c\u5728\u4e00\u4e2a\u590d\u5236\u7684\u6570\u7ec4\u4e0a\u8fdb\u884c\uff0c\u8bfb\u64cd\u4f5c\u8fd8\u662f\u5728\u539f\u59cb\u6570\u7ec4\u4e2d\u8fdb\u884c\uff0c\u8bfb\u5199\u5206\u79bb\uff0c\u4e92\u4e0d\u5f71\u54cd\u3002 \u5199\u64cd\u4f5c\u9700\u8981\u52a0\u9501\uff0c\u9632\u6b62\u5e76\u53d1\u5199\u5165\u65f6\u5bfc\u81f4\u5199\u5165\u6570\u636e\u4e22\u5931\u3002 \u5199\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e\u9700\u8981\u628a\u539f\u59cb\u6570\u7ec4\u6307\u5411\u65b0\u7684\u590d\u5236\u6570\u7ec4\u3002</li> <li>\u9002\u7528\u573a\u666f CopyOnWriteArrayList \u5728\u5199\u64cd\u4f5c\u7684\u540c\u65f6\u5141\u8bb8\u8bfb\u64cd\u4f5c\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u8bfb\u64cd\u4f5c\u7684\u6027\u80fd\uff0c\u56e0\u6b64\u5f88\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u5e94\u7528\u573a\u666f\u3002 \u4f46\u662f CopyOnWriteArrayList \u6709\u5176\u7f3a\u9677\uff1a<ul> <li>\u5185\u5b58\u5360\u7528\uff1a\u5728\u5199\u64cd\u4f5c\u65f6\u9700\u8981\u590d\u5236\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\uff0c\u4f7f\u5f97\u5185\u5b58\u5360\u7528\u4e3a\u539f\u6765\u7684\u4e24\u500d\u5de6\u53f3\uff1b</li> <li>\u6570\u636e\u4e0d\u4e00\u81f4\uff1a\u8bfb\u64cd\u4f5c\u4e0d\u80fd\u8bfb\u53d6\u5b9e\u65f6\u6027\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u90e8\u5206\u5199\u64cd\u4f5c\u7684\u6570\u636e\u8fd8\u672a\u540c\u6b65\u5230\u8bfb\u6570\u7ec4\u4e2d\u3002 <p>\u6240\u4ee5 CopyOnWriteArrayList \u4e0d\u9002\u5408\u5185\u5b58\u654f\u611f\u4ee5\u53ca\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u5f88\u9ad8\u7684\u573a\u666f\u3002</p> </li> </ul> </li> </ul> <p>\u8bf4\u4e00\u4e0bCopyOnWriteArrayList\u548c\u8bfb\u5199\u9501\u533a\u522b</p> \u56de\u7b54 <ul> <li>\u76f8\u540c\u70b9\uff1a1. \u4e24\u8005\u90fd\u662f\u901a\u8fc7\u8bfb\u5199\u5206\u79bb\u7684\u601d\u60f3\u5b9e\u73b0\uff1b2.\u8bfb\u7ebf\u7a0b\u95f4\u662f\u4e92\u4e0d\u963b\u585e\u7684</li> <li>\u4e0d\u540c\u70b9\uff1a\u5bf9\u8bfb\u5199\u9501\u800c\u8a00\uff0c\u4e3a\u4e86\u5b9e\u73b0\u6570\u636e\u5b9e\u65f6\u6027\uff0c\u5728\u5199\u9501\u88ab\u83b7\u53d6\u540e\uff0c\u8bfb\u7ebf\u7a0b\u4f1a\u7b49\u5f85\u6216\u8005\u5f53\u8bfb\u9501\u88ab\u83b7\u53d6\u540e\uff0c\u5199\u7ebf\u7a0b\u4f1a\u7b49\u5f85\uff0c\u4ece\u800c\u89e3\u51b3\u201c\u810f\u8bfb\u201d\u7b49\u95ee\u9898\u3002\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u4f7f\u7528\u8bfb\u5199\u9501\u4f9d\u7136\u4f1a\u51fa\u73b0\u8bfb\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85\u7684\u60c5\u51b5\u3002\u800c COW \u5219\u5b8c\u5168\u653e\u5f00\u4e86\u727a\u7272\u6570\u636e\u5b9e\u65f6\u6027\u800c\u4fdd\u8bc1\u6570\u636e\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u5373\u8bfb\u7ebf\u7a0b\u5bf9\u6570\u636e\u7684\u66f4\u65b0\u662f\u5ef6\u65f6\u611f\u77e5\u7684\uff0c\u56e0\u6b64\u8bfb\u7ebf\u7a0b\u4e0d\u4f1a\u5b58\u5728\u7b49\u5f85\u7684\u60c5\u51b5\u3002</li> </ul> <p>\u6bd4\u8f83 HashSet\u3001LinkedHashSet \u548c TreeSet \u4e09\u8005\u7684\u5f02\u540c</p> \u56de\u7b54 <ul> <li>TreeSet\uff1a\u57fa\u4e8e\u7ea2\u9ed1\u6811\u5b9e\u73b0\uff0c\u652f\u6301\u6709\u5e8f\u6027\u64cd\u4f5c\uff0c\u4f8b\u5982\u6839\u636e\u4e00\u4e2a\u8303\u56f4\u67e5\u627e\u5143\u7d20\u7684\u64cd\u4f5c\u3002\u4f46\u662f\u67e5\u627e\u6548\u7387\u4e0d\u5982 HashSet\uff0cHashSet \u67e5\u627e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff0cTreeSet \u5219\u4e3a O(logN)\u3002</li> <li>HashSet\uff1a\u57fa\u4e8e\u54c8\u5e0c\u8868\u5b9e\u73b0\uff0c\u652f\u6301\u5feb\u901f\u67e5\u627e\uff0c\u4f46\u4e0d\u652f\u6301\u6709\u5e8f\u6027\u64cd\u4f5c\u3002\u5e76\u4e14\u5931\u53bb\u4e86\u5143\u7d20\u7684\u63d2\u5165\u987a\u5e8f\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f7f\u7528 Iterator \u904d\u5386 HashSet \u5f97\u5230\u7684\u7ed3\u679c\u662f\u4e0d\u786e\u5b9a\u7684\u3002</li> <li>LinkedHashSet\uff1a\u5177\u6709 HashSet \u7684\u67e5\u627e\u6548\u7387\uff0c\u5e76\u4e14\u5185\u90e8\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u7ef4\u62a4\u5143\u7d20\u7684\u63d2\u5165\u987a\u5e8f\u3002</li> </ul> <p>\u8bf4\u4e00\u4e0bThreadLocal</p> \u56de\u7b54 <ul> <li>\u4f7f\u7528</li> </ul> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u521b\u5efa\u7684\u53d8\u91cf\u662f\u53ef\u4ee5\u88ab\u4efb\u4f55\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5e76\u4fee\u6539\u7684\u3002\u5982\u679c\u60f3\u5b9e\u73b0\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u4e13\u5c5e\u672c\u5730\u53d8\u91cf\u8be5\u5982\u4f55\u89e3\u51b3\u5462\uff1f JDK \u4e2d\u63d0\u4f9b\u7684<code>ThreadLocal</code>\u7c7b\u6b63\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\u3002 <code>ThreadLocal</code>\u7c7b\u4e3b\u8981\u89e3\u51b3\u7684\u5c31\u662f\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u7ed1\u5b9a\u81ea\u5df1\u7684\u503c\uff0c\u53ef\u4ee5\u5c06<code>ThreadLocal</code>\u7c7b\u5f62\u8c61\u7684\u6bd4\u55bb\u6210\u5b58\u653e\u6570\u636e\u7684\u76d2\u5b50\uff0c\u76d2\u5b50\u4e2d\u53ef\u4ee5\u5b58\u50a8\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e\u3002</p> <p>ThreadLocal \u4e0d\u662f\u7528\u6765\u89e3\u51b3\u5171\u4eab\u5bf9\u8c61\u7684\u591a\u7ebf\u7a0b\u8bbf\u95ee\u95ee\u9898\u7684\uff0c\u6570\u636e\u5b9e\u8d28\u4e0a\u662f\u653e\u5728\u6bcf\u4e2a thread \u5b9e\u4f8b\u5f15\u7528\u7684 threadLocalMap,\u4e5f\u5c31\u662f\u8bf4**\u6bcf\u4e2a\u4e0d\u540c\u7684\u7ebf\u7a0b\u90fd\u62e5\u6709\u4e13\u5c5e\u4e8e\u81ea\u5df1\u7684\u6570\u636e\u5bb9\u5668\uff08threadLocalMap\uff09\uff0c\u5f7c\u6b64\u4e0d\u5f71\u54cd**\u3002\u56e0\u6b64 threadLocal \u53ea\u9002\u7528\u4e8e \u5171\u4eab\u5bf9\u8c61\u4f1a\u9020\u6210\u7ebf\u7a0b\u5b89\u5168 \u7684\u4e1a\u52a1\u573a\u666f\u3002</p> <ul> <li>\u5b9e\u73b0\u539f\u7406</li> </ul> <p>\u6211\u4eec\u5148\u4ece\u6700\u57fa\u672c\u7684get()\u65b9\u6cd5\u8bf4\u8d77\uff1a <pre><code>    public T get() {\n//\u83b7\u5f97\u5f53\u524d\u7ebf\u7a0b\nThread t = Thread.currentThread();\n//\u6bcf\u4e2a\u7ebf\u7a0b \u90fd\u6709\u4e00\u4e2a\u81ea\u5df1\u7684ThreadLocalMap\uff0c\n//ThreadLocalMap\u91cc\u5c31\u4fdd\u5b58\u7740\u6240\u6709\u7684ThreadLocal\u53d8\u91cf\nThreadLocalMap map = getMap(t);\nif (map != null) {\n//ThreadLocalMap\u7684key\u5c31\u662f\u5f53\u524dThreadLocal\u5bf9\u8c61\u5b9e\u4f8b\uff0c\n//\u591a\u4e2aThreadLocal\u53d8\u91cf\u90fd\u662f\u653e\u5728\u8fd9\u4e2amap\u4e2d\u7684\nThreadLocalMap.Entry e = map.getEntry(this);\nif (e != null) {\n@SuppressWarnings(\"unchecked\")\n//\u4ecemap\u91cc\u53d6\u51fa\u6765\u7684\u503c\u5c31\u662f\u6211\u4eec\u9700\u8981\u7684\u8fd9\u4e2aThreadLocal\u53d8\u91cf\nT result = (T)e.value;\nreturn result;\n}\n}\n// \u5982\u679cmap\u6ca1\u6709\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u5728\u8fd9\u91cc\u521d\u59cb\u5316\u4e00\u4e0b\nreturn setInitialValue();\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u4e2aThread\u4e2d\u90fd\u5177\u5907\u4e00\u4e2a<code>ThreadLocalMap</code>\uff0c\u800c ThreadLocalMap\u53ef\u4ee5\u5b58\u50a8\u4ee5ThreadLocal\u4e3a key \uff0cObject \u5bf9\u8c61\u4e3a value \u7684\u952e\u503c\u5bf9</p> <ul> <li>\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898</li> </ul> <p>ThreadLocal.ThreadLocalMap\u662f\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684Map\uff0c\u5b83\u7684\u6bcf\u4e2aEntry\u7684key\u90fd\u662f\u4e00\u4e2a\u5f31\u5f15\u7528\uff1a <pre><code>     static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; {\n/** The value associated with this ThreadLocal. */\nObject value;\n//key\u5c31\u662f\u4e00\u4e2a\u5f31\u5f15\u7528\nEntry(ThreadLocal&lt;?&gt; k, Object v) {\nsuper(k);\nvalue = v;\n}\n}\n</code></pre></p> <p>\u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904\u662f\uff0c\u5982\u679c\u8fd9\u4e2a\u53d8\u91cf\u4e0d\u518d\u88ab\u5176\u4ed6\u5bf9\u8c61\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u81ea\u52a8\u56de\u6536\u8fd9\u4e2aThreadLocal\u5bf9\u8c61\uff0c\u907f\u514d\u53ef\u80fd\u7684\u5185\u5b58\u6cc4\u9732\u3002</p> <p>\u867d\u7136ThreadLocalMap\u4e2d\u7684key\u662f\u5f31\u5f15\u7528\uff0c\u5f53\u4e0d\u5b58\u5728\u5916\u90e8\u5f3a\u5f15\u7528\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u81ea\u52a8\u88ab\u56de\u6536\uff0c\u4f46\u662fEntry\u4e2d\u7684value\u4f9d\u7136\u662f\u5f3a\u5f15\u7528\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c<code>ThreadLocalMap</code> \u4e2d\u5c31\u4f1a\u51fa\u73b0 key \u4e3a null \u7684 Entry\u3002\u5047\u5982\u6211\u4eec\u4e0d\u505a\u4efb\u4f55\u63aa\u65bd\u7684\u8bdd\uff0cvalue \u6c38\u8fdc\u65e0\u6cd5\u88ab GC \u56de\u6536\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u80fd\u4f1a\u4ea7\u751f\u5185\u5b58\u6cc4\u9732\u3002ThreadLocalMap \u5b9e\u73b0\u4e2d\u5df2\u7ecf\u8003\u8651\u4e86\u8fd9\u79cd\u60c5\u51b5\uff0c\u5728\u8c03\u7528 <code>set()</code>\u3001<code>get()</code>\u3001<code>remove()</code> \u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u4f1a\u6e05\u7406\u6389 key \u4e3a null \u7684\u8bb0\u5f55\u3002</p> <p>\u4ee5getEntry()\u4e3a\u4f8b\uff1a</p> <pre><code> private Entry getEntry(ThreadLocal&lt;?&gt; key) {\nint i = key.threadLocalHashCode &amp; (table.length - 1);\nEntry e = table[i];\nif (e != null &amp;&amp; e.get() == key)\n//\u5982\u679c\u627e\u5230key\uff0c\u76f4\u63a5\u8fd4\u56de\nreturn e;\nelse\n//\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5c31\u4f1a\u5c1d\u8bd5\u6e05\u7406\uff0c\u5982\u679c\u4f60\u603b\u662f\u8bbf\u95ee\u5b58\u5728\u7684key\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6e05\u7406\u6c38\u8fdc\u4e0d\u4f1a\u8fdb\u6765\nreturn getEntryAfterMiss(key, i, e);\n}\n</code></pre> <p>\u4e0b\u9762\u662fgetEntryAfterMiss()\u7684\u5b9e\u73b0\uff1a</p> <pre><code>private Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) {\nEntry[] tab = table;\nint len = tab.length;\nwhile (e != null) {\n// \u6574\u4e2ae\u662fentry \uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5f31\u5f15\u7528\nThreadLocal&lt;?&gt; k = e.get();\n//\u5982\u679c\u627e\u5230\u4e86\uff0c\u5c31\u8fd4\u56de\nif (k == key)\nreturn e;\nif (k == null)\n//\u5982\u679ckey\u4e3anull\uff0c\u8bf4\u660e\u5f31\u5f15\u7528\u5df2\u7ecf\u88ab\u56de\u6536\u4e86\n//\u90a3\u4e48\u5c31\u8981\u5728\u8fd9\u91cc\u56de\u6536\u91cc\u9762\u7684value\u4e86\nexpungeStaleEntry(i);\nelse\n//\u5982\u679ckey\u4e0d\u662f\u8981\u627e\u7684\u90a3\u4e2a\uff0c\u90a3\u8bf4\u660e\u6709hash\u51b2\u7a81\uff0c\u8fd9\u91cc\u662f\u5904\u7406\u51b2\u7a81\uff0c\u627e\u4e0b\u4e00\u4e2aentry\ni = nextIndex(i, len);\ne = tab[i];\n}\nreturn null;\n}\n</code></pre> <p>\u771f\u6b63\u7528\u6765\u56de\u6536value\u7684\u662fexpungeStaleEntry()\u65b9\u6cd5\uff0c\u5728remove()\u548cset()\u65b9\u6cd5\u4e2d\uff0c\u90fd\u4f1a\u76f4\u63a5\u6216\u8005\u95f4\u63a5\u8c03\u7528\u5230\u8fd9\u4e2a\u65b9\u6cd5\u8fdb\u884cvalue\u7684\u6e05\u7406\uff1a</p> <p>\u4ece\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\uff0cThreadLocal\u4e3a\u4e86\u907f\u514d\u5185\u5b58\u6cc4\u9732\uff0c\u4e5f\u7b97\u662f\u82b1\u4e86\u4e00\u756a\u5927\u5fc3\u601d\u3002\u4e0d\u4ec5\u4f7f\u7528\u4e86\u5f31\u5f15\u7528\u7ef4\u62a4key\uff0c\u8fd8\u4f1a\u5728\u6bcf\u4e2a\u64cd\u4f5c\u4e0a\u68c0\u67e5key\u662f\u5426\u88ab\u56de\u6536\uff0c\u8fdb\u800c\u518d\u56de\u6536value\u3002</p> <p>\u4f46\u662f\u4ece\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\uff0cThreadLocal\u5e76\u4e0d\u80fd100%\u4fdd\u8bc1\u4e0d\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u6bd4\u5982\uff0c\u5f88\u4e0d\u5e78\u7684\uff0c\u4f60\u7684get()\u65b9\u6cd5\u603b\u662f\u8bbf\u95ee\u56fa\u5b9a\u51e0\u4e2a\u4e00\u76f4\u5b58\u5728\u7684ThreadLocal\uff0c\u90a3\u4e48\u6e05\u7406\u52a8\u4f5c\u5c31\u4e0d\u4f1a\u6267\u884c\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u673a\u4f1a\u8c03\u7528set()\u548cremove()\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5185\u5b58\u6cc4\u6f0f\u4f9d\u7136\u4f1a\u53d1\u751f\u3002</p> <p>\u56e0\u6b64\uff0c\u4e00\u4e2a\u826f\u597d\u7684\u4e60\u60ef\u4f9d\u7136\u662f\uff1a\u5f53\u4f60\u4e0d\u9700\u8981\u8fd9\u4e2aThreadLocal\u53d8\u91cf\u65f6\uff0c\u4e3b\u52a8\u8c03\u7528remove()\uff0c\u8fd9\u6837\u5bf9\u6574\u4e2a\u7cfb\u7edf\u662f\u6709\u597d\u5904\u7684\u3002</p> <ul> <li>Hash\u51b2\u7a81\u5904\u7406</li> </ul> <p>ThreadLocalMap\u4f5c\u4e3a\u4e00\u4e2aHashMap\u548cjava.util.HashMap\u7684\u5b9e\u73b0\u662f\u4e0d\u540c\u7684\u3002\u5bf9\u4e8ejava.util.HashMap\u4f7f\u7528\u7684\u662f\u94fe\u8868\u6cd5\u6765\u5904\u7406\u51b2\u7a81\uff1a</p> <p></p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8eThreadLocalMap\uff0c\u5b83\u4f7f\u7528\u7684\u662f\u7b80\u5355\u7684\u7ebf\u6027\u63a2\u6d4b\u6cd5\uff0c\u5982\u679c\u53d1\u751f\u4e86\u5143\u7d20\u51b2\u7a81\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u4e0b\u4e00\u4e2a\u69fd\u4f4d\u5b58\u653e\uff1a</p> <p></p> <p>\u4e4b\u6240\u4ee5\u91c7\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\u4e3b\u8981\u662f\u56e0\u4e3a\uff1a\u5728 ThreadLocalMap \u4e2d\u7684\u6563\u5217\u503c\u5206\u6563\u7684\u5341\u5206\u5747\u5300\uff0c\u5f88\u5c11\u4f1a\u51fa\u73b0\u51b2\u7a81\u3002\u5e76\u4e14 ThreadLocalMap \u7ecf\u5e38\u9700\u8981\u6e05\u9664\u65e0\u7528\u7684\u5bf9\u8c61\uff0c\u4f7f\u7528\u7eaf\u6570\u7ec4\u66f4\u52a0\u65b9\u4fbf\u3002</p>"},{"location":"interview/java_jvm/","title":"JVM \u76f8\u5173","text":"<p>\u4ecb\u7ecd\u4e0b Java \u5185\u5b58\u533a\u57df(\u8fd0\u884c\u65f6\u6570\u636e\u533a)</p> \u56de\u7b54 <p>Java\u865a\u62df\u673a\u7ba1\u7406\u7684\u5185\u5b58\u5305\u62ec\u51e0\u4e2a\u8fd0\u884c\u65f6\u6570\u636e\u5185\u5b58\uff1a\u65b9\u6cd5\u533a\u3001\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808\u3001\u5806\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u5176\u4e2d\u65b9\u6cd5\u533a\u548c\u5806\u662f\u7531\u7ebf\u7a0b\u5171\u4eab\u7684\u6570\u636e\u533a\uff0c\u5176\u4ed6\u51e0\u4e2a\u662f\u7ebf\u7a0b\u9694\u79bb\u7684\u6570\u636e\u533a</p> <ul> <li> <p>\u7a0b\u5e8f\u8ba1\u6570\u5668 \u7a0b\u5e8f\u8ba1\u6570\u5668\u662f\u4e00\u5757\u8f83\u5c0f\u7684\u5185\u5b58\uff0c\u4ed6\u53ef\u4ee5\u770b\u505a\u662f\u5f53\u524d\u7ebf\u7a0b\u6240\u6267\u884c\u7684\u884c\u53f7\u6307\u793a\u5668\u3002\u5b57\u8282\u7801\u89e3\u91ca\u5668\u5de5\u4f5c\u7684\u65f6\u5019\u5c31\u662f\u901a\u8fc7\u6539\u53d8\u8fd9\u4e2a\u8ba1\u6570\u5668\u7684\u503c\u6765\u9009\u53d6\u4e0b\u4e00\u6761\u9700\u8981\u6267\u884c\u7684\u5b57\u8282\u7801\u7684\u6307\u4ee4\uff0c\u5206\u652f\u3001\u5faa\u73af\u3001\u8df3\u8f6c\u3001\u5f02\u5e38\u5904\u7406\u3001\u7ebf\u7a0b\u6062\u590d\u7b49\u57fa\u7840\u529f\u80fd\u90fd\u9700\u8981\u4f9d\u8d56\u8fd9\u4e2a\u8ba1\u6570\u5668\u6765\u5b8c\u6210\u3002\u5982\u679c\u7ebf\u7a0b\u6b63\u5728\u6267\u884c\u7684\u662f\u4e00\u4e2aJava\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u8ba1\u6570\u5668\u8bb0\u5f55\u7684\u662f\u6b63\u5728\u6267\u884c\u7684\u865a\u62df\u673a\u5b57\u8282\u7801\u6307\u4ee4\u7684\u5730\u5740\uff1b\u5982\u679c\u6b63\u5728\u6267\u884c\u7684\u662fNative\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u8ba1\u6570\u5668\u5219\u4e3a\u7a7a\u3002\u6b64\u5185\u5b58\u533a\u57df\u662f\u552f\u4e00\u4e00\u4e2a\u5728Java\u865a\u62df\u673a\u89c4\u8303\u4e2d\u6ca1\u6709\u89c4\u5b9a\u4efb\u4f55OutOfMemotyError\u60c5\u51b5\u7684\u533a\u57df</p> </li> <li> <p>Java\u865a\u62df\u673a\u6808 \u865a\u62df\u673a\u6808\u63cf\u8ff0\u7684\u662fJava\u65b9\u6cd5\u6267\u884c\u7684\u5185\u5b58\u6a21\u578b\uff1a\u6bcf\u4e2a\u65b9\u6cd5\u5728\u6267\u884c\u7684\u540c\u65f6\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\u7528\u4e8e\u50a8\u5b58\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u52a8\u6001\u94fe\u63a5\u3001\u65b9\u6cd5\u51fa\u53e3\u7b49\u4fe1\u606f\u3002\u6bcf\u4e2a\u65b9\u6cd5\u4ece\u8c03\u7528\u76f4\u81f3\u5b8c\u6210\u7684\u8fc7\u7a0b\uff0c\u5c31\u5bf9\u5e94\u7740\u4e00\u4e2a\u6808\u5e27\u5728\u865a\u62df\u673a\u6808\u4e2d\u5165\u6808\u5230\u51fa\u6808\u7684\u8fc7\u7a0b\u3002\u6808\u5185\u5b58\u5c31\u662f\u865a\u62df\u673a\u6808\uff0c\u6216\u8005\u8bf4\u662f\u865a\u62df\u673a\u6808\u4e2d\u5c40\u90e8\u53d8\u91cf\u8868\u7684\u90e8\u5206\u3002\u5c40\u90e8\u53d8\u91cf\u8868\u5b58\u653e\u4e86\u7f16\u8f91\u671f\u53ef\u77e5\u7684\u5404\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08boolean\u3001byte\u3001char\u3001short\u3001int\u3001float\u3001long\u3001double\uff09\u3001\u5bf9\u8c61\u5f15\u7528\uff08refrence\uff09\u7c7b\u578b\u548creturnAddress\u7c7b\u578b\uff08\u6307\u5411\u4e86\u4e00\u6761\u5b57\u8282\u7801\u6307\u4ee4\u7684\u5730\u5740\uff09\u3002\u5176\u4e2d64\u4f4d\u957f\u5ea6\u7684long\u548cdouble\u7c7b\u578b\u7684\u6570\u636e\u4f1a\u5360\u7528\u4e24\u4e2a\u5c40\u90e8\u53d8\u91cf\u7a7a\u95f4\uff0c\u5176\u4f59\u7684\u6570\u636e\u7c7b\u578b\u53ea\u5360\u75281\u4e2a\u3002Java\u865a\u62df\u673a\u89c4\u8303\u5bf9\u8fd9\u4e2a\u533a\u57df\u89c4\u5b9a\u4e86\u4e24\u79cd\u5f02\u5e38\u72b6\u51b5\uff1a\u5982\u679c\u7ebf\u7a0b\u8bf7\u6c42\u7684\u6808\u6df1\u5ea6\u5927\u4e8e\u865a\u62df\u673a\u6240\u5141\u8bb8\u7684\u6df1\u5ea6\uff0c\u5c06\u629b\u51faStackOverflowError\u5f02\u5e38\u3002\u5982\u679c\u865a\u62df\u673a\u6269\u5c55\u65f6\u65e0\u6cd5\u7533\u8bf7\u5230\u8db3\u591f\u7684\u5185\u5b58\uff0c\u5c31\u4f1a\u8dd1\u51faOutOfMemoryError\u5f02\u5e38</p> </li> <li> <p>\u672c\u5730\u65b9\u6cd5\u6808 \u672c\u5730\u65b9\u6cd5\u6808\u548c\u865a\u62df\u673a\u6808\u53d1\u6325\u7684\u4f5c\u7528\u662f\u975e\u5e38\u7c7b\u4f3c\u7684\uff0c\u4ed6\u4eec\u7684\u533a\u522b\u662f\u865a\u62df\u673a\u6808\u4e3a\u865a\u62df\u673a\u6267\u884cJava\u65b9\u6cd5\uff08\u4e5f\u5c31\u662f\u5b57\u8282\u7801\uff09\u670d\u52a1\uff0c\u800c\u672c\u5730\u65b9\u6cd5\u6808\u5219\u4e3a\u865a\u62df\u673a\u4f7f\u7528\u5230\u7684Native\u65b9\u6cd5\u670d\u52a1\u3002\u672c\u5730\u65b9\u6cd5\u6808\u533a\u57df\u4e5f\u4f1a\u629b\u51faStackOverflowError\u548cOutOfMemoryErroy\u5f02\u5e38</p> </li> <li> <p>Java\u5806 \u5806\u662fJava\u865a\u62df\u673a\u6240\u7ba1\u7406\u7684\u5185\u5b58\u4e2d\u6700\u5927\u7684\u4e00\u5757\u3002Java\u5806\u662f\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u5728\u865a\u62df\u673a\u542f\u52a8\u7684\u65f6\u5019\u521b\u5efa\uff0c\u6b64\u5185\u5b58\u533a\u57df\u7684\u552f\u4e00\u76ee\u7684\u662f\u5b58\u653e\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u5bf9\u8c61\u5b9e\u4f8b\u90fd\u5728\u8fd9\u91cc\u5206\u914d\u5185\u5b58\u3002\u6240\u6709\u7684\u5bf9\u8c61\u5b9e\u4f8b\u548c\u6570\u7ec4\u90fd\u5728\u5806\u4e0a\u5206\u914d\u3002Java\u5806\u662f\u5783\u573e\u6536\u96c6\u5668\u7ba1\u7406\u7684\u4e3b\u8981\u533a\u57df\u3002Java\u5806\u7ec6\u5206\u4e3a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u3002\u4e0d\u7ba1\u600e\u6837\uff0c\u5212\u5206\u7684\u76ee\u7684\u90fd\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u56de\u6536\u5185\u5b58\uff0c\u6216\u8005\u66f4\u5feb\u5730\u5206\u914d\u5185\u5b58\u3002Java\u5806\u53ef\u4ee5\u5904\u4e8e\u7269\u7406\u4e0a\u4e0d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\uff0c\u53ea\u8981\u903b\u8f91\u4e0a\u662f\u8fde\u7eed\u7684\u5373\u53ef\u3002\u5982\u679c\u5728\u5806\u4e2d\u6ca1\u6709\u5b8c\u6210\u5b9e\u4f8b\u5206\u914d\uff0c\u5e76\u4e14\u5806\u4e5f\u65e0\u6cd5\u5728\u6269\u5c55\u65f6\u5c06\u4f1a\u629b\u51faOutOfMemoryError\u5f02\u5e38</p> </li> <li> <p>\u65b9\u6cd5\u533a \u65b9\u6cd5\u533a\u5b83\u7528\u4e8e\u50a8\u5b58\u5df2\u88ab\u865a\u62df\u673a\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u3001\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7b49\u6570\u636e\u3002\u9664\u4e86Java\u5806\u4e00\u6837\u4e0d\u9700\u8981\u8fde\u7eed\u7684\u5185\u5b58\u548c\u53ef\u4ee5\u9009\u62e9\u56fa\u5b9a\u5927\u5c0f\u6216\u8005\u53ef\u6269\u5c55\u5916\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u4e0d\u5b9e\u73b0\u5783\u573e\u6536\u96c6\u3002\u8fd9\u4e2a\u533a\u57df\u7684\u5185\u5b58\u56de\u6536\u76ee\u6807\u4e3b\u8981\u662f\u9488\u5bf9\u5e38\u91cf\u6c60\u7684\u56de\u6536\u548c\u5bf9\u7c7b\u578b\u7684\u5378\u8f7d\u3002\u5f53\u65b9\u6cd5\u533a\u65e0\u6cd5\u6ee1\u8db3\u5185\u5b58\u5206\u914d\u9700\u6c42\u65f6\uff0c\u5c06\u629b\u51faOutOfMemoryErroy\u5f02\u5e38</p> </li> <li> <p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60 \u5b83\u662f\u65b9\u6cd5\u533a\u7684\u4e00\u90e8\u5206\u3002Class\u6587\u4ef6\u4e2d\u9664\u4e86\u6709\u5173\u7684\u7248\u672c\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u63a5\u53e3\u7b49\u63cf\u8ff0\u4fe1\u606f\u5916\u3001\u8fd8\u6709\u4e00\u9879\u4fe1\u606f\u662f\u5e38\u91cf\u6c60\uff0c\u7528\u4e8e\u5b58\u653e\u7f16\u8f91\u671f\u751f\u6210\u7684\u5404\u79cd\u5b57\u9762\u91cf\u548c\u7b26\u53f7\u5f15\u7528\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u5c06\u5728\u7c7b\u52a0\u8f7d\u540e\u8fdb\u5165\u65b9\u6cd5\u533a\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\u5b58\u653e\u3002Java\u8bed\u8a00\u5e76\u4e0d\u8981\u6c42\u5e38\u91cf\u4e00\u5b9a\u53ea\u6709\u7f16\u8f91\u671f\u624d\u80fd\u4ea7\u751f\uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u5c06\u65b0\u7684\u5e38\u91cf\u653e\u5165\u6c60\u4e2d\uff0c\u8fd9\u79cd\u7279\u6027\u88ab\u5f00\u53d1\u4eba\u5458\u5229\u7528\u5f97\u6bd4\u8f83\u591a\u7684\u4fbf\u662fString\u7c7b\u7684intern()\u65b9\u6cd5\u3002\u5f53\u5e38\u91cf\u6c60\u65e0\u6cd5\u518d\u7533\u8bf7\u5230\u5185\u5b58\u65f6\u4f1a\u629b\u51faOutOfMemoryError\u5f02\u5e38</p> </li> </ul> <p> \u7a0b\u5e8f\u8ba1\u6570\u5668\u4e3a\u4ec0\u4e48\u662f\u79c1\u6709\u7684?</p> \u56de\u7b54 <p>\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e3b\u8981\u6709\u4e0b\u9762\u4e24\u4e2a\u4f5c\u7528\uff1a</p> <ol> <li> <p>\u5b57\u8282\u7801\u89e3\u91ca\u5668\u901a\u8fc7\u6539\u53d8\u7a0b\u5e8f\u8ba1\u6570\u5668\u6765\u4f9d\u6b21\u8bfb\u53d6\u6307\u4ee4\uff0c\u4ece\u800c\u5b9e\u73b0\u4ee3\u7801\u7684\u6d41\u7a0b\u63a7\u5236\uff0c\u5982\uff1a\u987a\u5e8f\u6267\u884c\u3001\u9009\u62e9\u3001\u5faa\u73af\u3001\u5f02\u5e38\u5904\u7406\u3002</p> </li> <li> <p>\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u7528\u4e8e\u8bb0\u5f55\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u7684\u4f4d\u7f6e\uff0c\u4ece\u800c\u5f53\u7ebf\u7a0b\u88ab\u5207\u6362\u56de\u6765\u7684\u65f6\u5019\u80fd\u591f\u77e5\u9053\u8be5\u7ebf\u7a0b\u4e0a\u6b21\u8fd0\u884c\u5230\u54ea\u513f\u4e86\u3002</p> </li> </ol> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u6267\u884c\u7684\u662f native \u65b9\u6cd5\uff0c\u90a3\u4e48\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55\u7684\u662f undefined \u5730\u5740\uff0c\u53ea\u6709\u6267\u884c\u7684\u662f Java \u4ee3\u7801\u65f6\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55\u7684\u624d\u662f\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u3002</p> <p>\u6240\u4ee5\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u79c1\u6709\u4e3b\u8981\u662f\u4e3a\u4e86 \u7ebf\u7a0b\u5207\u6362\u540e\u80fd\u6062\u590d\u5230\u6b63\u786e\u7684\u6267\u884c\u4f4d\u7f6e\u3002</p> <p> \u865a\u62df\u673a\u6808\u548c\u672c\u5730\u65b9\u6cd5\u6808\u4e3a\u4ec0\u4e48\u662f\u79c1\u6709\u7684?</p> \u56de\u7b54 <ul> <li> <p>\u865a\u62df\u673a\u6808\uff1a \u6bcf\u4e2a Java \u65b9\u6cd5\u5728\u6267\u884c\u7684\u540c\u65f6\u4f1a\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\u7528\u4e8e\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u5e38\u91cf\u6c60\u5f15\u7528\u7b49\u4fe1\u606f\u3002\u4ece\u65b9\u6cd5\u8c03\u7528\u76f4\u81f3\u6267\u884c\u5b8c\u6210\u7684\u8fc7\u7a0b\uff0c\u5c31\u5bf9\u5e94\u7740\u4e00\u4e2a\u6808\u5e27\u5728 Java \u865a\u62df\u673a\u6808\u4e2d\u5165\u6808\u548c\u51fa\u6808\u7684\u8fc7\u7a0b\u3002</p> </li> <li> <p>\u672c\u5730\u65b9\u6cd5\u6808\uff1a \u548c\u865a\u62df\u673a\u6808\u6240\u53d1\u6325\u7684\u4f5c\u7528\u975e\u5e38\u76f8\u4f3c\uff0c\u533a\u522b\u662f\uff1a \u865a\u62df\u673a\u6808\u4e3a\u865a\u62df\u673a\u6267\u884c Java \u65b9\u6cd5 \uff08\u4e5f\u5c31\u662f\u5b57\u8282\u7801\uff09\u670d\u52a1\uff0c\u800c\u672c\u5730\u65b9\u6cd5\u6808\u5219\u4e3a\u865a\u62df\u673a\u4f7f\u7528\u5230\u7684 Native \u65b9\u6cd5\u670d\u52a1\u3002 \u5728 HotSpot \u865a\u62df\u673a\u4e2d\u548c Java \u865a\u62df\u673a\u6808\u5408\u4e8c\u4e3a\u4e00\u3002</p> </li> </ul> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86 \u4fdd\u8bc1\u7ebf\u7a0b\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf\u4e0d\u88ab\u522b\u7684\u7ebf\u7a0b\u8bbf\u95ee\u5230\uff0c\u865a\u62df\u673a\u6808\u548c\u672c\u5730\u65b9\u6cd5\u6808\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\u3002</p> <p> \u8bf4\u4e00\u4e0bJava\u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b</p> \u56de\u7b54 <p></p> <ol> <li> <p>\u7c7b\u52a0\u8f7d\u68c0\u67e5 \u865a\u62df\u673a\u9047\u5230\u4e00\u6761 new \u6307\u4ee4\u65f6\uff0c\u9996\u5148\u5c06\u53bb\u68c0\u67e5\u8fd9\u4e2a\u6307\u4ee4\u7684\u53c2\u6570\u662f\u5426\u80fd\u5728\u5e38\u91cf\u6c60\u4e2d\u5b9a\u4f4d\u5230\u8fd9\u4e2a\u7c7b\u7684\u7b26\u53f7\u5f15\u7528\uff0c\u5e76\u4e14\u68c0\u67e5\u8fd9\u4e2a\u7b26\u53f7\u5f15\u7528\u4ee3\u8868\u7684\u7c7b\u662f\u5426\u5df2\u88ab\u52a0\u8f7d\u8fc7\u3001\u89e3\u6790\u548c\u521d\u59cb\u5316\u8fc7\u3002\u5982\u679c\u6ca1\u6709\uff0c\u90a3\u5fc5\u987b\u5148\u6267\u884c\u76f8\u5e94\u7684\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u3002</p> </li> <li> <p>\u5206\u914d\u5185\u5b58 \u5728\u7c7b\u52a0\u8f7d\u68c0\u67e5\u901a\u8fc7\u540e\uff0c\u63a5\u4e0b\u6765\u865a\u62df\u673a\u5c06\u4e3a\u65b0\u751f\u5bf9\u8c61\u5206\u914d\u5185\u5b58\u3002\u5bf9\u8c61\u6240\u9700\u7684\u5185\u5b58\u5927\u5c0f\u5728\u7c7b\u52a0\u8f7d\u5b8c\u6210\u540e\u4fbf\u53ef\u786e\u5b9a\uff0c\u4e3a\u5bf9\u8c61\u5206\u914d\u7a7a\u95f4\u7684\u4efb\u52a1\u7b49\u540c\u4e8e\u628a\u4e00\u5757\u786e\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u4ece Java \u5806\u4e2d\u5212\u5206\u51fa\u6765\u3002\u5206\u914d\u65b9\u5f0f\u6709 \u201c\u6307\u9488\u78b0\u649e\u201d \u548c \u201c\u7a7a\u95f2\u5217\u8868\u201d \u4e24\u79cd\uff0c\u9009\u62e9\u54ea\u79cd\u5206\u914d\u65b9\u5f0f\u7531 Java \u5806\u662f\u5426\u89c4\u6574\u51b3\u5b9a\uff0c\u800c Java \u5806\u662f\u5426\u89c4\u6574\u53c8\u7531\u6240\u91c7\u7528\u7684\u5783\u573e\u6536\u96c6\u5668\u662f\u5426\u5e26\u6709\u538b\u7f29\u6574\u7406\u529f\u80fd\u51b3\u5b9a\u3002  \u9009\u62e9\u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u4e2d\u7684\u54ea\u4e00\u79cd\uff0c\u53d6\u51b3\u4e8e Java \u5806\u5185\u5b58\u662f\u5426\u89c4\u6574\u3002\u800c Java \u5806\u5185\u5b58\u662f\u5426\u89c4\u6574\uff0c\u53d6\u51b3\u4e8e GC \u6536\u96c6\u5668\u7684\u7b97\u6cd5\u662f\"\u6807\u8bb0-\u6e05\u9664\"\uff0c\u8fd8\u662f\"\u6807\u8bb0-\u6574\u7406\"\uff08\u4e5f\u79f0\u4f5c\"\u6807\u8bb0-\u538b\u7f29\"\uff09\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u590d\u5236\u7b97\u6cd5\u5185\u5b58\u4e5f\u662f\u89c4\u6574\u7684</p> <ul> <li>\u5185\u5b58\u5206\u914d\u5e76\u53d1\u95ee\u9898 \u5728\u521b\u5efa\u5bf9\u8c61\u7684\u65f6\u5019\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u95ee\u9898\uff0c\u5c31\u662f\u7ebf\u7a0b\u5b89\u5168\uff0c\u56e0\u4e3a\u5728\u5b9e\u9645\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u521b\u5efa\u5bf9\u8c61\u662f\u5f88\u9891\u7e41\u7684\u4e8b\u60c5\uff0c\u4f5c\u4e3a\u865a\u62df\u673a\u6765\u8bf4\uff0c\u5fc5\u987b\u8981\u4fdd\u8bc1\u7ebf\u7a0b\u662f\u5b89\u5168\u7684\uff0c\u901a\u5e38\u6765\u8bb2\uff0c\u865a\u62df\u673a\u91c7\u7528\u4e24\u79cd\u65b9\u5f0f\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1a<ul> <li>CAS+\u5931\u8d25\u91cd\u8bd5\uff1a CAS \u662f\u4e50\u89c2\u9501\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002\u6240\u8c13\u4e50\u89c2\u9501\u5c31\u662f\uff0c\u6bcf\u6b21\u4e0d\u52a0\u9501\u800c\u662f\u5047\u8bbe\u6ca1\u6709\u51b2\u7a81\u800c\u53bb\u5b8c\u6210\u67d0\u9879\u64cd\u4f5c\uff0c\u5982\u679c\u56e0\u4e3a\u51b2\u7a81\u5931\u8d25\u5c31\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\u3002\u865a\u62df\u673a\u91c7\u7528 CAS \u914d\u4e0a\u5931\u8d25\u91cd\u8bd5\u7684\u65b9\u5f0f\u4fdd\u8bc1\u66f4\u65b0\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002</li> <li>TLAB\uff1a \u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u9884\u5148\u5728 Eden \u533a\u5206\u914d\u4e00\u5757\u513f\u5185\u5b58\uff0cJVM \u5728\u7ed9\u7ebf\u7a0b\u4e2d\u7684\u5bf9\u8c61\u5206\u914d\u5185\u5b58\u65f6\uff0c\u9996\u5148\u5728 TLAB \u5206\u914d\uff0c\u5f53\u5bf9\u8c61\u5927\u4e8e TLAB \u4e2d\u7684\u5269\u4f59\u5185\u5b58\u6216 TLAB \u7684\u5185\u5b58\u5df2\u7528\u5c3d\u65f6\uff0c\u518d\u91c7\u7528\u4e0a\u8ff0\u7684 CAS \u8fdb\u884c\u5185\u5b58\u5206\u914d</li> </ul> </li> </ul> </li> <li> <p>\u521d\u59cb\u5316\u96f6\u503c \u5185\u5b58\u5206\u914d\u5b8c\u6210\u540e\uff0c\u865a\u62df\u673a\u9700\u8981\u5c06\u5206\u914d\u5230\u7684\u5185\u5b58\u7a7a\u95f4\u90fd\u521d\u59cb\u5316\u4e3a\u96f6\u503c\uff08\u4e0d\u5305\u62ec\u5bf9\u8c61\u5934\uff09\uff0c\u8fd9\u4e00\u6b65\u64cd\u4f5c\u4fdd\u8bc1\u4e86\u5bf9\u8c61\u7684\u5b9e\u4f8b\u5b57\u6bb5\u5728 Java \u4ee3\u7801\u4e2d\u53ef\u4ee5\u4e0d\u8d4b\u521d\u59cb\u503c\u5c31\u76f4\u63a5\u4f7f\u7528\uff0c\u7a0b\u5e8f\u80fd\u8bbf\u95ee\u5230\u8fd9\u4e9b\u5b57\u6bb5\u7684\u6570\u636e\u7c7b\u578b\u6240\u5bf9\u5e94\u7684\u96f6\u503c\u3002</p> </li> <li> <p>\u8bbe\u7f6e\u5bf9\u8c61\u5934 \u521d\u59cb\u5316\u96f6\u503c\u5b8c\u6210\u4e4b\u540e\uff0c\u865a\u62df\u673a\u8981\u5bf9\u5bf9\u8c61\u8fdb\u884c\u5fc5\u8981\u7684\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8fd9\u4e2a\u5bf9\u8c61\u662f\u54ea\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u3001\u5982\u4f55\u624d\u80fd\u627e\u5230\u7c7b\u7684\u5143\u6570\u636e\u4fe1\u606f\u3001\u5bf9\u8c61\u7684\u54c8\u5e0c\u7801\u3001\u5bf9\u8c61\u7684 GC \u5206\u4ee3\u5e74\u9f84\u7b49\u4fe1\u606f\u3002 \u8fd9\u4e9b\u4fe1\u606f\u5b58\u653e\u5728\u5bf9\u8c61\u5934\u4e2d\u3002 \u53e6\u5916\uff0c\u6839\u636e\u865a\u62df\u673a\u5f53\u524d\u8fd0\u884c\u72b6\u6001\u7684\u4e0d\u540c\uff0c\u5982\u662f\u5426\u542f\u7528\u504f\u5411\u9501\u7b49\uff0c\u5bf9\u8c61\u5934\u4f1a\u6709\u4e0d\u540c\u7684\u8bbe\u7f6e\u65b9\u5f0f\u3002</p> </li> <li> <p>\u6267\u884c init \u65b9\u6cd5 \u5728\u4e0a\u9762\u5de5\u4f5c\u90fd\u5b8c\u6210\u4e4b\u540e\uff0c\u4ece\u865a\u62df\u673a\u7684\u89c6\u89d2\u6765\u770b\uff0c\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u5df2\u7ecf\u4ea7\u751f\u4e86\uff0c\u4f46\u4ece Java \u7a0b\u5e8f\u7684\u89c6\u89d2\u6765\u770b\uff0c\u5bf9\u8c61\u521b\u5efa\u624d\u521a\u5f00\u59cb\uff0c \u65b9\u6cd5\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u6240\u6709\u7684\u5b57\u6bb5\u90fd\u8fd8\u4e3a\u96f6\u3002\u6240\u4ee5\u4e00\u822c\u6765\u8bf4\uff0c\u6267\u884c new \u6307\u4ee4\u4e4b\u540e\u4f1a\u63a5\u7740\u6267\u884c  \u65b9\u6cd5\uff0c\u521d\u59cb\u5316\u6210\u5458\u53d8\u91cf\u503c\uff0c\u540c\u65f6\u6267\u884c\u641c\u96c6\u5230\u7684{}\u4ee3\u7801\u5757\u903b\u8f91\uff0c\u6700\u540e\u6267\u884c\u5bf9\u8c61\u6784\u9020\u65b9\u6cd5\u3002\u6267\u884c\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u8fd9\u91cc\u505a\u7684\u64cd\u4f5c\u624d\u662f\u7a0b\u5e8f\u5458\u771f\u6b63\u60f3\u505a\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u521d\u59cb\u5316\u5176\u4ed6\u5bf9\u8c61\u554a\u7b49\u7b49\u64cd\u4f5c\uff0c\u81f3\u6b64\uff0c\u5bf9\u8c61\u521b\u5efa\u6210\u529f\u3002 <p> \u8bf4\u4e00\u4e0b\u5806\u5185\u5b58\u4e2d\u5bf9\u8c61\u7684\u5206\u914d\u7684\u57fa\u672c\u7b56\u7565</p> \u56de\u7b54 <p>Java \u5806\u662f\u5783\u573e\u6536\u96c6\u5668\u7ba1\u7406\u7684\u4e3b\u8981\u533a\u57df\uff0c\u56e0\u6b64\u4e5f\u88ab\u79f0\u4f5cGC \u5806\uff08Garbage Collected Heap\uff09\u3002\u4ece\u5783\u573e\u56de\u6536\u7684\u89d2\u5ea6\uff0c\u7531\u4e8e\u73b0\u5728\u6536\u96c6\u5668\u57fa\u672c\u90fd\u91c7\u7528\u5206\u4ee3\u5783\u573e\u6536\u96c6\u7b97\u6cd5\uff0c\u5728 Java \u4e2d\uff0c\u5806\u88ab\u5212\u5206\u6210\u4e24\u4e2a\u4e0d\u540c\u7684\u533a\u57df\uff1a\u65b0\u751f\u4ee3 ( Young )\u3001\u8001\u5e74\u4ee3 ( Old )\u3002\u65b0\u751f\u4ee3 ( Young ) \u53c8\u88ab\u5212\u5206\u4e3a\u4e09\u4e2a\u533a\u57df\uff1aEden\u3001From Survivor\u3001To Survivor\u3002\u8fd9\u6837\u5212\u5206\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u4f7f JVM \u80fd\u591f\u66f4\u597d\u7684\u7ba1\u7406\u5806\u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\uff0c\u5305\u62ec\u5185\u5b58\u7684\u5206\u914d\u4ee5\u53ca\u56de\u6536\u3002</p> <p>\u5806\u7684\u5185\u5b58\u6a21\u578b\u5927\u81f4\u4e3a\uff1a </p> <ol> <li> <p>\u5bf9\u8c61\u4f18\u5148\u5728 eden \u533a\u5206\u914d \u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5bf9\u8c61\u5728\u65b0\u751f\u4ee3\u4e2d eden \u533a\u5206\u914d\u3002\u5f53 eden \u533a\u6ca1\u6709\u8db3\u591f\u7a7a\u95f4\u8fdb\u884c\u5206\u914d\u65f6\uff0c\u865a\u62df\u673a\u5c06\u53d1\u8d77\u4e00\u6b21 <code>Minor GC</code>\u3002\u7ecf\u8fc7\u8fd9\u6b21 GC \u540e\uff0cEden \u533a\u548c\"From\"\u533a\u5df2\u7ecf\u88ab\u6e05\u7a7a\u3002\u5982\u679c\u5bf9\u8c61\u8fd8\u5b58\u6d3b\uff0c\u5219\u4f1a\u8fdb\u5165\"To\"\u533a\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\"From\"\u548c\"To\"\u4f1a\u4ea4\u6362\u4ed6\u4eec\u7684\u89d2\u8272\uff0c\u4e5f\u5c31\u662f\u65b0\u7684\"To\"\u5c31\u662f\u4e0a\u6b21 GC \u524d\u7684\u201cFrom\u201d\uff0c\u65b0\u7684\"From\"\u5c31\u662f\u4e0a\u6b21 GC \u524d\u7684\"To\"\u3002\u4e0d\u7ba1\u600e\u6837\uff0c\u90fd\u4f1a\u4fdd\u8bc1\u540d\u4e3a To \u7684 Survivor \u533a\u57df\u662f\u7a7a\u7684\u3002Minor GC \u4f1a\u4e00\u76f4\u91cd\u590d\u8fd9\u6837\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u201cTo\u201d\u533a\u88ab\u586b\u6ee1\uff0c\"To\"\u533a\u88ab\u586b\u6ee1\u4e4b\u540e\uff0c\u4f1a\u5c06\u6240\u6709\u5bf9\u8c61\u79fb\u52a8\u5230\u8001\u5e74\u4ee3\u4e2d\u3002</p> </li> <li> <p>\u5927\u5bf9\u8c61\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3 \u5927\u5bf9\u8c61\u5c31\u662f\u9700\u8981\u5927\u91cf\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7684\u5bf9\u8c61\uff08\u6bd4\u5982\uff1a\u5b57\u7b26\u4e32\u3001\u6570\u7ec4\uff09\u3002</p> <ul> <li>\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u5462\uff1f \u4e3a\u4e86\u907f\u514d\u4e3a\u5927\u5bf9\u8c61\u5206\u914d\u5185\u5b58\u65f6\u7531\u4e8e\u5206\u914d\u62c5\u4fdd\u673a\u5236\u5e26\u6765\u7684\u590d\u5236\u800c\u964d\u4f4e\u6548\u7387\u3002</li> </ul> </li> <li> <p>\u957f\u671f\u5b58\u6d3b\u7684\u5bf9\u8c61\u5c06\u8fdb\u5165\u8001\u5e74\u4ee3 \u5982\u679c\u5bf9\u8c61\u5728 Eden \u51fa\u751f\u5e76\u7ecf\u8fc7\u7b2c\u4e00\u6b21 Minor GC \u540e\u4ecd\u7136\u80fd\u591f\u5b58\u6d3b\uff0c\u5e76\u4e14\u80fd\u88ab Survivor \u5bb9\u7eb3\u7684\u8bdd\uff0c\u5c06\u88ab\u79fb\u52a8\u5230 Survivor \u7a7a\u95f4\u4e2d\uff0c\u5e76\u5c06\u5bf9\u8c61\u5e74\u9f84\u8bbe\u4e3a 1.\u5bf9\u8c61\u5728 Survivor \u4e2d\u6bcf\u71ac\u8fc7\u4e00\u6b21 MinorGC,\u5e74\u9f84\u5c31\u589e\u52a0 1 \u5c81\uff0c\u5f53\u5b83\u7684\u5e74\u9f84\u589e\u52a0\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff08\u9ed8\u8ba4\u4e3a 15 \u5c81\uff09\uff0c\u5c31\u4f1a\u88ab\u664b\u5347\u5230\u8001\u5e74\u4ee3\u4e2d</p> </li> </ol> <p>\u7b80\u5355\u7684\u4ecb\u7ecd\u4e00\u4e0b\u5f3a\u5f15\u7528,\u8f6f\u5f15\u7528,\u5f31\u5f15\u7528,\u865a\u5f15\u7528</p> \u56de\u7b54 <ul> <li> <p>\u5f3a\u5f15\u7528(StrongReference) \u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u5177\u6709\u5f3a\u5f15\u7528\uff0c\u90a3\u5c31\u7c7b\u4f3c\u4e8e\u5fc5\u4e0d\u53ef\u5c11\u7684\u751f\u6d3b\u7528\u54c1\uff0c\u5783\u573e\u56de\u6536\u5668\u7edd\u4e0d\u4f1a\u56de\u6536\u5b83\u3002\u5f53\u5185\u5b58\u7a7a \u95f4\u4e0d\u8db3\uff0cJava\u865a\u62df\u673a\u5b81\u613f\u629b\u51faOutOfMemoryError\u9519\u8bef\uff0c\u4f7f\u7a0b\u5e8f\u5f02\u5e38\u7ec8\u6b62\uff0c\u4e5f\u4e0d\u4f1a\u9760\u968f\u610f\u56de\u6536\u5177\u6709\u5f3a\u5f15\u7528\u7684\u5bf9\u8c61\u6765\u89e3\u51b3\u5185\u5b58\u4e0d\u8db3\u95ee\u9898\u3002</p> </li> <li> <p>\u8f6f\u5f15\u7528(SoftReference) \u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u53ea\u5177\u6709\u8f6f\u5f15\u7528\uff0c\u90a3\u5c31\u7c7b\u4f3c\u4e8e\u53ef\u6709\u53ef\u65e0\u7684\u751f\u6d3b\u7528\u54c1\u3002\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u8db3\u591f\uff0c\u5783\u573e\u56de\u6536\u5668\u5c31\u4e0d\u4f1a\u56de\u6536\u5b83\uff0c\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u8db3\u4e86\uff0c\u5c31\u4f1a\u56de\u6536\u8fd9\u4e9b\u5bf9\u8c61\u7684\u5185\u5b58\u3002\u53ea\u8981\u5783\u573e\u56de\u6536\u5668\u6ca1\u6709\u56de\u6536\u5b83\uff0c\u8be5\u5bf9\u8c61\u5c31\u53ef\u4ee5\u88ab\u7a0b\u5e8f\u4f7f\u7528\u3002\u8f6f\u5f15\u7528\u53ef\u7528\u6765\u5b9e\u73b0\u5185\u5b58\u654f\u611f\u7684\u9ad8\u901f\u7f13\u5b58\u3002\u8f6f\u5f15\u7528\u53ef\u4ee5\u548c\u4e00\u4e2a\u5f15\u7528\u961f\u5217\uff08ReferenceQueue\uff09\u8054\u5408\u4f7f\u7528\uff0c\u5982\u679c\u8f6f\u5f15\u7528\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\uff0cJAVA\u865a\u62df\u673a\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6f\u5f15\u7528\u52a0\u5165\u5230\u4e0e\u4e4b\u5173\u8054\u7684\u5f15\u7528\u961f\u5217\u4e2d\u3002</p> </li> <li> <p>\u5f31\u5f15\u7528(WeakReference) \u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u53ea\u5177\u6709\u5f31\u5f15\u7528\uff0c\u90a3\u5c31\u7c7b\u4f3c\u4e8e\u53ef\u6709\u53ef\u65e0\u7684\u751f\u6d3b\u7528\u54c1\u3002\u5f31\u5f15\u7528\u4e0e\u8f6f\u5f15\u7528\u7684\u533a\u522b\u5728\u4e8e\uff1a\u53ea\u5177\u6709\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\u62e5\u6709\u66f4\u77ed\u6682\u7684\u751f\u547d\u5468\u671f\u3002\u5728\u5783\u573e\u56de\u6536\u5668\u7ebf\u7a0b\u626b\u63cf\u5b83\u6240\u7ba1\u8f96\u7684\u5185\u5b58\u533a\u57df\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u65e6\u53d1\u73b0\u4e86\u53ea\u5177\u6709\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u5f53\u524d\u5185\u5b58\u7a7a\u95f4\u8db3\u591f\u4e0e\u5426\uff0c\u90fd\u4f1a\u56de\u6536\u5b83\u7684\u5185\u5b58\u3002\u4e0d\u8fc7\uff0c\u7531\u4e8e\u5783\u573e\u56de\u6536\u5668\u662f\u4e00\u4e2a\u4f18\u5148\u7ea7\u5f88\u4f4e\u7684\u7ebf\u7a0b\uff0c \u56e0\u6b64\u4e0d\u4e00\u5b9a\u4f1a\u5f88\u5feb\u53d1\u73b0\u90a3\u4e9b\u53ea\u5177\u6709\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\u3002\u5f31\u5f15\u7528\u53ef\u4ee5\u548c\u4e00\u4e2a\u5f15\u7528\u961f\u5217\uff08ReferenceQueue\uff09\u8054\u5408\u4f7f\u7528\uff0c\u5982\u679c\u5f31\u5f15\u7528\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\uff0cJava\u865a\u62df\u673a\u5c31\u4f1a\u628a\u8fd9\u4e2a\u5f31\u5f15\u7528\u52a0\u5165\u5230\u4e0e\u4e4b\u5173\u8054\u7684\u5f15\u7528\u961f\u5217\u4e2d\u3002</p> </li> <li> <p>\u865a\u5f15\u7528\uff08PhantomReference \"\u865a\u5f15\u7528\"\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u5f62\u540c\u865a\u8bbe\uff0c\u4e0e\u5176\u4ed6\u51e0\u79cd\u5f15\u7528\u90fd\u4e0d\u540c\uff0c\u865a\u5f15\u7528\u5e76\u4e0d\u4f1a\u51b3\u5b9a\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u3002\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u4ec5\u6301\u6709\u865a\u5f15\u7528\uff0c\u90a3\u4e48\u5b83\u5c31\u548c\u6ca1\u6709\u4efb\u4f55\u5f15\u7528\u4e00\u6837\uff0c\u5728\u4efb\u4f55\u65f6\u5019\u90fd\u53ef\u80fd\u88ab\u5783\u573e\u56de\u6536\u3002\u865a\u5f15\u7528\u4e3b\u8981\u7528\u6765\u8ddf\u8e2a\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\u7684\u6d3b\u52a8\u3002 </p> <ul> <li>\u865a\u5f15\u7528\u4e0e\u8f6f\u5f15\u7528\u548c\u5f31\u5f15\u7528\u7684\u4e00\u4e2a\u533a\u522b\u5728\u4e8e\uff1a \u865a\u5f15\u7528\u5fc5\u987b\u548c\u5f15\u7528\u961f\u5217\uff08ReferenceQueue\uff09\u8054\u5408\u4f7f\u7528\u3002\u5f53\u5783 \u573e\u56de\u6536\u5668\u51c6\u5907\u56de\u6536\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u5982\u679c\u53d1\u73b0\u5b83\u8fd8\u6709\u865a\u5f15\u7528\uff0c\u5c31\u4f1a\u5728\u56de\u6536\u5bf9\u8c61\u7684\u5185\u5b58\u4e4b\u524d\uff0c\u628a\u8fd9\u4e2a\u865a\u5f15\u7528\u52a0\u5165\u5230\u4e0e\u4e4b\u5173\u8054\u7684\u5f15\u7528\u961f\u5217\u4e2d\u3002\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u5224\u65ad\u5f15\u7528\u961f\u5217\u4e2d\u662f \u5426\u5df2\u7ecf\u52a0\u5165\u4e86\u865a\u5f15\u7528\uff0c\u6765\u4e86\u89e3\u88ab\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u5426\u5c06\u8981\u88ab\u5783\u573e\u56de\u6536\u3002\u7a0b\u5e8f\u5982\u679c\u53d1\u73b0\u67d0\u4e2a\u865a\u5f15\u7528\u5df2\u7ecf\u88ab\u52a0\u5165\u5230\u5f15\u7528\u961f\u5217\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u7684\u5185\u5b58\u88ab\u56de\u6536\u4e4b\u524d\u91c7\u53d6\u5fc5\u8981\u7684\u884c\u52a8\u3002</li> </ul> </li> </ul> <p>\u5783\u573e\u6536\u96c6\u6709\u54ea\u4e9b\u7b97\u6cd5\uff0c\u5404\u81ea\u7684\u7279\u70b9\uff1f</p> \u56de\u7b54 <ul> <li> <p>\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5 \u8be5\u7b97\u6cd5\u5206\u4e3a\u201c\u6807\u8bb0\u201d\u548c\u201c\u6e05\u9664\u201d\u9636\u6bb5\uff1a\u9996\u5148\u6807\u8bb0\u51fa\u6240\u6709\u4e0d\u9700\u8981\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u5728\u6807\u8bb0\u5b8c\u6210\u540e\u7edf\u4e00\u56de\u6536\u6389\u6240\u6709\u6ca1\u6709\u88ab\u6807\u8bb0\u7684\u5bf9\u8c61\u3002\u5b83\u662f\u6700\u57fa\u7840\u7684\u6536\u96c6\u7b97\u6cd5\uff0c\u540e\u7eed\u7684\u7b97\u6cd5\u90fd\u662f\u5bf9\u5176\u4e0d\u8db3\u8fdb\u884c\u6539\u8fdb\u5f97\u5230\u3002\u8fd9\u79cd\u5783\u573e\u6536\u96c6\u7b97\u6cd5\u4f1a\u5e26\u6765\u4e24\u4e2a\u660e\u663e\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u6548\u7387\u95ee\u9898</li> <li>\u7a7a\u95f4\u95ee\u9898\uff08\u6807\u8bb0\u6e05\u9664\u540e\u4f1a\u4ea7\u751f\u5927\u91cf\u4e0d\u8fde\u7eed\u7684\u788e\u7247\uff09 </li> </ol> </li> <li> <p>\u590d\u5236\u7b97\u6cd5  \u4e3a\u4e86\u89e3\u51b3\u6548\u7387\u95ee\u9898\uff0c\u201c\u590d\u5236\u201d\u6536\u96c6\u7b97\u6cd5\u51fa\u73b0\u4e86\u3002\u5b83\u53ef\u4ee5\u5c06\u5185\u5b58\u5206\u4e3a\u5927\u5c0f\u76f8\u540c\u7684\u4e24\u5757\uff0c\u6bcf\u6b21\u4f7f\u7528\u5176\u4e2d\u7684\u4e00\u5757\u3002\u5f53\u8fd9\u4e00\u5757\u7684\u5185\u5b58\u4f7f\u7528\u5b8c\u540e\uff0c\u5c31\u5c06\u8fd8\u5b58\u6d3b\u7684\u5bf9\u8c61\u590d\u5236\u5230\u53e6\u4e00\u5757\u53bb\uff0c\u7136\u540e\u518d\u628a\u4f7f\u7528\u7684\u7a7a\u95f4\u4e00\u6b21\u6e05\u7406\u6389\u3002\u8fd9\u6837\u5c31\u4f7f\u6bcf\u6b21\u7684\u5185\u5b58\u56de\u6536\u90fd\u662f\u5bf9\u5185\u5b58\u533a\u95f4\u7684\u4e00\u534a\u8fdb\u884c\u56de\u6536\u3002 </p> </li> <li> <p>\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5  \u6839\u636e\u8001\u5e74\u4ee3\u7684\u7279\u70b9\u63d0\u51fa\u7684\u4e00\u79cd\u6807\u8bb0\u7b97\u6cd5\uff0c\u6807\u8bb0\u8fc7\u7a0b\u4ecd\u7136\u4e0e\u201c\u6807\u8bb0-\u6e05\u9664\u201d\u7b97\u6cd5\u4e00\u6837\uff0c\u4f46\u540e\u7eed\u6b65\u9aa4\u4e0d\u662f\u76f4\u63a5\u5bf9\u53ef\u56de\u6536\u5bf9\u8c61\u56de\u6536\uff0c\u800c\u662f\u8ba9\u6240\u6709\u5b58\u6d3b\u7684\u5bf9\u8c61\u5411\u4e00\u7aef\u79fb\u52a8\uff0c\u7136\u540e\u76f4\u63a5\u6e05\u7406\u6389\u7aef\u8fb9\u754c\u4ee5\u5916\u7684\u5185\u5b58\u3002 </p> </li> <li> <p>\u5206\u4ee3\u6536\u96c6\u7b97\u6cd5  \u5f53\u524d\u865a\u62df\u673a\u7684\u5783\u573e\u6536\u96c6\u90fd\u91c7\u7528\u5206\u4ee3\u6536\u96c6\u7b97\u6cd5\uff0c\u8fd9\u79cd\u7b97\u6cd5\u6ca1\u6709\u4ec0\u4e48\u65b0\u7684\u601d\u60f3\uff0c\u53ea\u662f\u6839\u636e\u5bf9\u8c61\u5b58\u6d3b\u5468\u671f\u7684\u4e0d\u540c\u5c06\u5185\u5b58\u5206\u4e3a\u51e0\u5757\u3002\u4e00\u822c\u5c06 java \u5806\u5206\u4e3a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u5404\u4e2a\u5e74\u4ee3\u7684\u7279\u70b9\u9009\u62e9\u5408\u9002\u7684\u5783\u573e\u6536\u96c6\u7b97\u6cd5\u3002\u6bd4\u5982\u5728\u65b0\u751f\u4ee3\u4e2d\uff0c\u6bcf\u6b21\u6536\u96c6\u90fd\u4f1a\u6709\u5927\u91cf\u5bf9\u8c61\u6b7b\u53bb\uff0c\u6240\u4ee5\u53ef\u4ee5\u9009\u62e9\u590d\u5236\u7b97\u6cd5\uff0c\u53ea\u9700\u8981\u4ed8\u51fa\u5c11\u91cf\u5bf9\u8c61\u7684\u590d\u5236\u6210\u672c\u5c31\u53ef\u4ee5\u5b8c\u6210\u6bcf\u6b21\u5783\u573e\u6536\u96c6\u3002\u800c\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u5b58\u6d3b\u51e0\u7387\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u800c\u4e14\u6ca1\u6709\u989d\u5916\u7684\u7a7a\u95f4\u5bf9\u5b83\u8fdb\u884c\u5206\u914d\u62c5\u4fdd\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u9009\u62e9\u201c\u6807\u8bb0-\u6e05\u9664\u201d\u6216\u201c\u6807\u8bb0-\u6574\u7406\u201d\u7b97\u6cd5\u8fdb\u884c\u5783\u573e\u6536\u96c6\u3002</p> </li> </ul>"},{"location":"interview/java_thread/","title":"Java \u591a\u7ebf\u7a0b","text":"<p>\u4ec0\u4e48\u662f\u7ebf\u7a0b\u548c\u8fdb\u7a0b?</p> \u56de\u7b54 <ul> <li> <p>\u4f55\u4e3a\u8fdb\u7a0b?  \u8fdb\u7a0b\u662f\u7a0b\u5e8f\u7684\u4e00\u6b21\u6267\u884c\u8fc7\u7a0b\uff0c\u662f\u7cfb\u7edf\u8fd0\u884c\u7a0b\u5e8f\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u56e0\u6b64\u8fdb\u7a0b\u662f\u52a8\u6001\u7684\u3002\u7cfb\u7edf\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\u5373\u662f\u4e00\u4e2a\u8fdb\u7a0b\u4ece\u521b\u5efa\uff0c\u8fd0\u884c\u5230\u6d88\u4ea1\u7684\u8fc7\u7a0b\u3002</p> </li> <li> <p>\u4f55\u4e3a\u7ebf\u7a0b? \u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u76f8\u4f3c\uff0c\u4f46\u7ebf\u7a0b\u662f\u4e00\u4e2a\u6bd4\u8fdb\u7a0b\u66f4\u5c0f\u7684\u6267\u884c\u5355\u4f4d\u3002\u4e00\u4e2a\u8fdb\u7a0b\u5728\u5176\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4ea7\u751f\u591a\u4e2a\u7ebf\u7a0b\u3002\u4e0e\u8fdb\u7a0b\u4e0d\u540c\u7684\u662f\u540c\u7c7b\u7684\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7684 \u5806 \u548c \u65b9\u6cd5\u533a \u8d44\u6e90\uff0c\u4f46\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1\u7684 \u7a0b\u5e8f\u8ba1\u6570\u5668\u3001\u865a\u62df\u673a\u6808 \u548c \u672c\u5730\u65b9\u6cd5\u6808\uff0c\u6240\u4ee5\u7cfb\u7edf\u5728\u4ea7\u751f\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6216\u662f\u5728\u5404\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u4f5c\u5207\u6362\u5de5\u4f5c\u65f6\uff0c\u8d1f\u62c5\u8981\u6bd4\u8fdb\u7a0b\u5c0f\u5f97\u591a\uff0c\u4e5f\u6b63\u56e0\u4e3a\u5982\u6b64\uff0c\u7ebf\u7a0b\u4e5f\u88ab\u79f0\u4e3a\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\u3002</p> </li> </ul> <p>\u5e76\u53d1\u4e0e\u5e76\u884c\u7684\u533a\u522b\uff0c\u540c\u6b65\u548c\u5f02\u6b65\u7684\u533a\u522b</p> \u56de\u7b54 <p>\u5e76\u53d1\u4e0e\u5e76\u884c\u7684\u533a\u522b</p> <ul> <li> <p>\u5e76\u53d1\uff1a\u4e24\u4e2a\u53ca\u4e24\u4e2a\u4ee5\u4e0a\u7684\u4f5c\u4e1a\u5728\u540c\u4e00 \u65f6\u95f4\u6bb5 \u5185\u6267\u884c\u3002</p> </li> <li> <p>\u5e76\u884c\uff1a\u4e24\u4e2a\u53ca\u4e24\u4e2a\u4ee5\u4e0a\u7684\u4f5c\u4e1a\u5728\u540c\u4e00 \u65f6\u523b \u6267\u884c\u3002</p> </li> </ul> <p>\u6700\u5173\u952e\u7684\u70b9\u662f\uff1a\u662f\u5426\u662f \u540c\u65f6 \u6267\u884c\u3002</p> <p>\u540c\u6b65\u548c\u5f02\u6b65\u7684\u533a\u522b</p> <ul> <li>\u540c\u6b65 \uff1a \u53d1\u51fa\u4e00\u4e2a\u8c03\u7528\u4e4b\u540e\uff0c\u5728\u6ca1\u6709\u5f97\u5230\u7ed3\u679c\u4e4b\u524d\uff0c \u8be5\u8c03\u7528\u5c31\u4e0d\u53ef\u4ee5\u8fd4\u56de\uff0c\u4e00\u76f4\u7b49\u5f85\u3002</li> <li>\u5f02\u6b65 \uff1a\u8c03\u7528\u5728\u53d1\u51fa\u4e4b\u540e\uff0c\u4e0d\u7528\u7b49\u5f85\u8fd4\u56de\u7ed3\u679c\uff0c\u8be5\u8c03\u7528\u76f4\u63a5\u8fd4\u56de\u3002</li> </ul> <p>\u4ec0\u4e48\u662f\u4e0a\u4e0b\u6587\u5207\u6362?</p> \u56de\u7b54 <p>\u7ebf\u7a0b\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u6709\u81ea\u5df1\u7684\u8fd0\u884c\u6761\u4ef6\u548c\u72b6\u6001\uff08\u4e5f\u79f0\u4e0a\u4e0b\u6587\uff09\uff0c\u6bd4\u5982\u4e0a\u6587\u6240\u8bf4\u5230\u8fc7\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u6808\u4fe1\u606f\u7b49\u3002\u5f53\u51fa\u73b0\u5982\u4e0b\u60c5\u51b5\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u4f1a\u4ece\u5360\u7528 CPU \u72b6\u6001\u4e2d\u9000\u51fa\u3002</p> <ul> <li>\u4e3b\u52a8\u8ba9\u51fa CPU\uff0c\u6bd4\u5982\u8c03\u7528\u4e86 <code>sleep()</code>, <code>wait()</code> \u7b49\u3002</li> <li>\u65f6\u95f4\u7247\u7528\u5b8c\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u8981\u9632\u6b62\u4e00\u4e2a\u7ebf\u7a0b\u6216\u8005\u8fdb\u7a0b\u957f\u65f6\u95f4\u5360\u7528 CPU \u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u6216\u8005\u8fdb\u7a0b\u997f\u6b7b\u3002</li> <li>\u8c03\u7528\u4e86\u963b\u585e\u7c7b\u578b\u7684\u7cfb\u7edf\u4e2d\u65ad\uff0c\u6bd4\u5982\u8bf7\u6c42 IO\uff0c\u7ebf\u7a0b\u88ab\u963b\u585e\u3002</li> <li>\u88ab\u7ec8\u6b62\u6216\u7ed3\u675f\u8fd0\u884c</li> </ul> <p>\u8fd9\u5176\u4e2d\u524d\u4e09\u79cd\u90fd\u4f1a\u53d1\u751f\u7ebf\u7a0b\u5207\u6362\uff0c\u7ebf\u7a0b\u5207\u6362\u610f\u5473\u7740\u9700\u8981\u4fdd\u5b58\u5f53\u524d\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\uff0c\u7559\u5f85\u7ebf\u7a0b\u4e0b\u6b21\u5360\u7528 CPU \u7684\u65f6\u5019\u6062\u590d\u73b0\u573a\u3002\u5e76\u52a0\u8f7d\u4e0b\u4e00\u4e2a\u5c06\u8981\u5360\u7528 CPU \u7684\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u3002\u8fd9\u5c31\u662f\u6240\u8c13\u7684 \u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u4e0a\u4e0b\u6587\u5207\u6362\u662f\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u529f\u80fd\uff0c\u56e0\u5176\u6bcf\u6b21\u9700\u8981\u4fdd\u5b58\u4fe1\u606f\u6062\u590d\u4fe1\u606f\uff0c\u8fd9\u5c06\u4f1a\u5360\u7528 CPU\uff0c\u5185\u5b58\u7b49\u7cfb\u7edf\u8d44\u6e90\u8fdb\u884c\u5904\u7406\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u6548\u7387\u4f1a\u6709\u4e00\u5b9a\u635f\u8017\uff0c\u5982\u679c\u9891\u7e41\u5207\u6362\u5c31\u4f1a\u9020\u6210\u6574\u4f53\u6548\u7387\u4f4e\u4e0b\u3002</p> <p>sleep() \u65b9\u6cd5\u548c wait() \u65b9\u6cd5\u5bf9\u6bd4</p> \u56de\u7b54 <ul> <li> <p>\u5171\u540c\u70b9 \uff1a\u4e24\u8005\u90fd\u53ef\u4ee5\u6682\u505c\u7ebf\u7a0b\u7684\u6267\u884c\u3002</p> </li> <li> <p>\u533a\u522b \uff1a</p> <ul> <li><code>sleep()</code> \u65b9\u6cd5\u6ca1\u6709\u91ca\u653e\u9501\uff0c\u800c <code>wait()</code> \u65b9\u6cd5\u91ca\u653e\u4e86\u9501 \u3002</li> <li><code>wait()</code> \u901a\u5e38\u88ab\u7528\u4e8e\u7ebf\u7a0b\u95f4\u4ea4\u4e92/\u901a\u4fe1\uff0c<code>sleep()</code>\u901a\u5e38\u88ab\u7528\u4e8e\u6682\u505c\u6267\u884c\u3002</li> <li><code>wait()</code> \u65b9\u6cd5\u88ab\u8c03\u7528\u540e\uff0c\u7ebf\u7a0b\u4e0d\u4f1a\u81ea\u52a8\u82cf\u9192\uff0c\u9700\u8981\u522b\u7684\u7ebf\u7a0b\u8c03\u7528\u540c\u4e00\u4e2a\u5bf9\u8c61\u4e0a\u7684 <code>notify()</code>\u6216\u8005 <code>notifyAll()</code> \u65b9\u6cd5\u3002<code>sleep()</code>\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7ebf\u7a0b\u4f1a\u81ea\u52a8\u82cf\u9192\uff0c\u6216\u8005\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>wait(long timeout)</code> \u8d85\u65f6\u540e\u7ebf\u7a0b\u4f1a\u81ea\u52a8\u82cf\u9192\u3002</li> <li><code>sleep()</code> \u662f <code>Thread</code> \u7c7b\u7684\u9759\u6001\u672c\u5730\u65b9\u6cd5\uff0c<code>wait()</code> \u5219\u662f <code>Object</code> \u7c7b\u7684\u672c\u5730\u65b9\u6cd5\u3002</li> </ul> </li> </ul> <p>\u5982\u4f55\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\uff1f</p> \u56de\u7b54 <p>\u5728 Java \u4e2d\uff0c<code>volatile</code> \u5173\u952e\u5b57\u9664\u4e86\u53ef\u4ee5\u4fdd\u8bc1\u53d8\u91cf\u7684\u53ef\u89c1\u6027\uff0c\u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u4f5c\u7528\u5c31\u662f\u9632\u6b62 JVM \u7684\u6307\u4ee4\u91cd\u6392\u5e8f\u3002 \u5982\u679c\u6211\u4eec\u5c06\u53d8\u91cf\u58f0\u660e\u4e3a <code>volatile</code> \uff0c\u5728\u5bf9\u8fd9\u4e2a\u53d8\u91cf\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4f1a\u901a\u8fc7\u63d2\u5165\u7279\u5b9a\u7684 \u5185\u5b58\u5c4f\u969c \u7684\u65b9\u5f0f\u6765\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u3002</p> <p>volatile \u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u4e48\uff1f</p> \u56de\u7b54 <p><code>volatile</code> \u5173\u952e\u5b57\u80fd\u4fdd\u8bc1\u53d8\u91cf\u7684\u53ef\u89c1\u6027\uff0c\u4f46\u4e0d\u80fd\u4fdd\u8bc1\u5bf9\u53d8\u91cf\u7684\u64cd\u4f5c\u662f\u539f\u5b50\u6027\u7684\u3002</p> <p>\u8bf4\u4e00\u8bf4\u5bf9\u4e8e synchronized \u5173\u952e\u5b57\u7684\u4e86\u89e3</p> \u56de\u7b54 <p><code>synchronized</code> \u7ffb\u8bd1\u6210\u4e2d\u6587\u662f\u540c\u6b65\u7684\u7684\u610f\u601d\uff0c\u4e3b\u8981\u89e3\u51b3\u7684\u662f\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u8bbf\u95ee\u8d44\u6e90\u7684\u540c\u6b65\u6027\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u88ab\u5b83\u4fee\u9970\u7684\u65b9\u6cd5\u6216\u8005\u4ee3\u7801\u5757\u5728\u4efb\u610f\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u3002</p> <p>\u5728 Java \u65e9\u671f\u7248\u672c\u4e2d\uff0c<code>synchronized</code> \u5c5e\u4e8e \u91cd\u91cf\u7ea7\u9501\uff0c\u6548\u7387\u4f4e\u4e0b\u3002 \u56e0\u4e3a\u76d1\u89c6\u5668\u9501\uff08monitor\uff09\u662f\u4f9d\u8d56\u4e8e\u5e95\u5c42\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684 <code>Mutex Lock</code> \u6765\u5b9e\u73b0\u7684\uff0cJava \u7684\u7ebf\u7a0b\u662f\u6620\u5c04\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u539f\u751f\u7ebf\u7a0b\u4e4b\u4e0a\u7684\u3002\u5982\u679c\u8981\u6302\u8d77\u6216\u8005\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u90fd\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5e2e\u5fd9\u5b8c\u6210\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5207\u6362\u65f6\u9700\u8981\u4ece\u7528\u6237\u6001\u8f6c\u6362\u5230\u5185\u6838\u6001\uff0c\u8fd9\u4e2a\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\u9700\u8981\u76f8\u5bf9\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\uff0c\u65f6\u95f4\u6210\u672c\u76f8\u5bf9\u8f83\u9ad8\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5728 Java 6 \u4e4b\u540e\uff0cJava \u5b98\u65b9\u5bf9\u4ece JVM \u5c42\u9762\u5bf9 <code>synchronized</code> \u8f83\u5927\u4f18\u5316\uff0c\u6240\u4ee5\u73b0\u5728\u7684 <code>synchronized</code> \u9501\u6548\u7387\u4e5f\u4f18\u5316\u5f97\u5f88\u4e0d\u9519\u4e86\u3002JDK1.6 \u5bf9\u9501\u7684\u5b9e\u73b0\u5f15\u5165\u4e86\u5927\u91cf\u7684\u4f18\u5316\uff0c\u5982\u81ea\u65cb\u9501\u3001\u9002\u5e94\u6027\u81ea\u65cb\u9501\u3001\u9501\u6d88\u9664\u3001\u9501\u7c97\u5316\u3001\u504f\u5411\u9501\u3001\u8f7b\u91cf\u7ea7\u9501\u7b49\u6280\u672f\u6765\u51cf\u5c11\u9501\u64cd\u4f5c\u7684\u5f00\u9500\u3002\u6240\u4ee5\uff0c\u4f60\u4f1a\u53d1\u73b0\u76ee\u524d\u7684\u8bdd\uff0c\u4e0d\u8bba\u662f\u5404\u79cd\u5f00\u6e90\u6846\u67b6\u8fd8\u662f JDK \u6e90\u7801\u90fd\u5927\u91cf\u4f7f\u7528\u4e86 <code>synchronized</code> \u5173\u952e\u5b57\u3002\u7684\u4e86\u89e3</p> <p>\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528 synchronized \u5173\u952e\u5b57\u4fee\u9970\u4e48\uff1f</p> \u56de\u7b54 <p>\u6784\u9020\u65b9\u6cd5\u4e0d\u80fd\u4f7f\u7528 synchronized \u5173\u952e\u5b57\u4fee\u9970\u3002</p> <p>\u6784\u9020\u65b9\u6cd5\u672c\u8eab\u5c31\u5c5e\u4e8e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4e0d\u5b58\u5728\u540c\u6b65\u7684\u6784\u9020\u65b9\u6cd5\u4e00\u8bf4\u3002\u8bf4\u7ed3\u8bba\uff1a</p> <p>synchronized \u548c volatile \u7684\u533a\u522b\uff1f</p> \u56de\u7b54 <p><code>synchronized</code> \u5173\u952e\u5b57\u548c <code>volatile</code> \u5173\u952e\u5b57\u662f\u4e24\u4e2a\u4e92\u8865\u7684\u5b58\u5728\uff0c\u800c\u4e0d\u662f\u5bf9\u7acb\u7684\u5b58\u5728\uff01</p> <ul> <li><code>volatile</code> \u5173\u952e\u5b57\u662f\u7ebf\u7a0b\u540c\u6b65\u7684\u8f7b\u91cf\u7ea7\u5b9e\u73b0\uff0c\u6240\u4ee5 <code>volatile</code>\u6027\u80fd\u80af\u5b9a\u6bd4<code>synchronized</code>\u5173\u952e\u5b57\u8981\u597d \u3002\u4f46\u662f <code>volatile</code> \u5173\u952e\u5b57\u53ea\u80fd\u7528\u4e8e\u53d8\u91cf\u800c <code>synchronized</code> \u5173\u952e\u5b57\u53ef\u4ee5\u4fee\u9970\u65b9\u6cd5\u4ee5\u53ca\u4ee3\u7801\u5757 \u3002</li> <li><code>volatile</code> \u5173\u952e\u5b57\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u89c1\u6027\uff0c\u4f46\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u539f\u5b50\u6027\u3002<code>synchronized</code> \u5173\u952e\u5b57\u4e24\u8005\u90fd\u80fd\u4fdd\u8bc1\u3002</li> <li><code>volatile</code>\u5173\u952e\u5b57\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u53d8\u91cf\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u53ef\u89c1\u6027\uff0c\u800c <code>synchronized</code> \u5173\u952e\u5b57\u89e3\u51b3\u7684\u662f\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u8bbf\u95ee\u8d44\u6e90\u7684\u540c\u6b65\u6027\u3002</li> </ul> <p>synchronized \u548c ReentrantLock \u7684\u533a\u522b</p> \u56de\u7b54 <ul> <li>\u4e24\u8005\u90fd\u662f\u53ef\u91cd\u5165\u9501</li> </ul> <p>\u201c\u53ef\u91cd\u5165\u9501\u201d \u6307\u7684\u662f\u81ea\u5df1\u53ef\u4ee5\u518d\u6b21\u83b7\u53d6\u81ea\u5df1\u7684\u5185\u90e8\u9501\u3002\u6bd4\u5982\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u5f97\u4e86\u67d0\u4e2a\u5bf9\u8c61\u7684\u9501\uff0c\u6b64\u65f6\u8fd9\u4e2a\u5bf9\u8c61\u9501\u8fd8\u6ca1\u6709\u91ca\u653e\uff0c\u5f53\u5176\u518d\u6b21\u60f3\u8981\u83b7\u53d6\u8fd9\u4e2a\u5bf9\u8c61\u7684\u9501\u7684\u65f6\u5019\u8fd8\u662f\u53ef\u4ee5\u83b7\u53d6\u7684\uff0c\u5982\u679c\u662f\u4e0d\u53ef\u91cd\u5165\u9501\u7684\u8bdd\uff0c\u5c31\u4f1a\u9020\u6210\u6b7b\u9501\u3002\u540c\u4e00\u4e2a\u7ebf\u7a0b\u6bcf\u6b21\u83b7\u53d6\u9501\uff0c\u9501\u7684\u8ba1\u6570\u5668\u90fd\u81ea\u589e 1\uff0c\u6240\u4ee5\u8981\u7b49\u5230\u9501\u7684\u8ba1\u6570\u5668\u4e0b\u964d\u4e3a 0 \u65f6\u624d\u80fd\u91ca\u653e\u9501\u3002</p> <ul> <li>synchronized \u4f9d\u8d56\u4e8e JVM \u800c ReentrantLock \u4f9d\u8d56\u4e8e API</li> </ul> <p><code>synchronized</code> \u662f\u4f9d\u8d56\u4e8e JVM \u5b9e\u73b0\u7684\uff0c\u524d\u9762\u6211\u4eec\u4e5f\u8bb2\u5230\u4e86 \u865a\u62df\u673a\u56e2\u961f\u5728 JDK1.6 \u4e3a <code>synchronized</code> \u5173\u952e\u5b57\u8fdb\u884c\u4e86\u5f88\u591a\u4f18\u5316\uff0c\u4f46\u662f\u8fd9\u4e9b\u4f18\u5316\u90fd\u662f\u5728\u865a\u62df\u673a\u5c42\u9762\u5b9e\u73b0\u7684\uff0c\u5e76\u6ca1\u6709\u76f4\u63a5\u66b4\u9732\u7ed9\u6211\u4eec\u3002<code>ReentrantLock</code> \u662f JDK \u5c42\u9762\u5b9e\u73b0\u7684\uff08\u4e5f\u5c31\u662f API \u5c42\u9762\uff0c\u9700\u8981 lock() \u548c unlock() \u65b9\u6cd5\u914d\u5408 try/finally \u8bed\u53e5\u5757\u6765\u5b8c\u6210\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u5b83\u7684\u6e90\u4ee3\u7801\uff0c\u6765\u770b\u5b83\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002</p> <ul> <li> <p>ReentrantLock \u6bd4 synchronized \u589e\u52a0\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd \u76f8\u6bd4<code>synchronized</code>\uff0c<code>ReentrantLock</code>\u589e\u52a0\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\u3002\u4e3b\u8981\u6765\u8bf4\u4e3b\u8981\u6709\u4e09\u70b9\uff1a</p> <ul> <li> <p>\u7b49\u5f85\u53ef\u4e2d\u65ad : <code>ReentrantLock</code>\u63d0\u4f9b\u4e86\u4e00\u79cd\u80fd\u591f\u4e2d\u65ad\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u7684\u673a\u5236\uff0c\u901a\u8fc7 <code>lock.lockInterruptibly()</code> \u6765\u5b9e\u73b0\u8fd9\u4e2a\u673a\u5236\u3002\u4e5f\u5c31\u662f\u8bf4\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\u53ef\u4ee5\u9009\u62e9\u653e\u5f03\u7b49\u5f85\uff0c\u6539\u4e3a\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\u3002</p> </li> <li> <p>\u53ef\u5b9e\u73b0\u516c\u5e73\u9501 : <code>ReentrantLock</code>\u53ef\u4ee5\u6307\u5b9a\u662f\u516c\u5e73\u9501\u8fd8\u662f\u975e\u516c\u5e73\u9501\u3002\u800c<code>synchronized</code>\u53ea\u80fd\u662f\u975e\u516c\u5e73\u9501\u3002\u6240\u8c13\u7684\u516c\u5e73\u9501\u5c31\u662f\u5148\u7b49\u5f85\u7684\u7ebf\u7a0b\u5148\u83b7\u5f97\u9501\u3002<code>ReentrantLock</code>\u9ed8\u8ba4\u60c5\u51b5\u662f\u975e\u516c\u5e73\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>ReentrantLock</code>\u7c7b\u7684<code>ReentrantLock(boolean fair)</code>\u6784\u9020\u65b9\u6cd5\u6765\u5236\u5b9a\u662f\u5426\u662f\u516c\u5e73\u7684\u3002</p> </li> <li> <p>\u53ef\u5b9e\u73b0\u9009\u62e9\u6027\u901a\u77e5\uff08\u9501\u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2a\u6761\u4ef6\uff09: <code>synchronized</code>\u5173\u952e\u5b57\u4e0e<code>wait()</code>\u548c<code>notify()</code>/<code>notifyAll()</code>\u65b9\u6cd5\u76f8\u7ed3\u5408\u53ef\u4ee5\u5b9e\u73b0\u7b49\u5f85/\u901a\u77e5\u673a\u5236\u3002<code>ReentrantLock</code>\u7c7b\u5f53\u7136\u4e5f\u53ef\u4ee5\u5b9e\u73b0\uff0c\u4f46\u662f\u9700\u8981\u501f\u52a9\u4e8e<code>Condition</code>\u63a5\u53e3\u4e0e<code>newCondition()</code>\u65b9\u6cd5\u3002</p> </li> </ul> </li> </ul> <p>ThreadLocal \u6709\u4ec0\u4e48\u7528</p> \u56de\u7b54 <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u521b\u5efa\u7684\u53d8\u91cf\u662f\u53ef\u4ee5\u88ab\u4efb\u4f55\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5e76\u4fee\u6539\u7684\u3002\u5982\u679c\u60f3\u5b9e\u73b0\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u4e13\u5c5e\u672c\u5730\u53d8\u91cf\u8be5\u5982\u4f55\u89e3\u51b3\u5462\uff1f</p> <p>JDK \u4e2d\u81ea\u5e26\u7684<code>ThreadLocal</code>\u7c7b\u6b63\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\u3002 <code>ThreadLocal</code>\u7c7b\u4e3b\u8981\u89e3\u51b3\u7684\u5c31\u662f\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u7ed1\u5b9a\u81ea\u5df1\u7684\u503c\uff0c\u53ef\u4ee5\u5c06<code>ThreadLocal</code>\u7c7b\u5f62\u8c61\u7684\u6bd4\u55bb\u6210\u5b58\u653e\u6570\u636e\u7684\u76d2\u5b50\uff0c\u76d2\u5b50\u4e2d\u53ef\u4ee5\u5b58\u50a8\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e\u3002</p> <p>\u5982\u679c\u4f60\u521b\u5efa\u4e86\u4e00\u4e2a<code>ThreadLocal</code>\u53d8\u91cf\uff0c\u90a3\u4e48\u8bbf\u95ee\u8fd9\u4e2a\u53d8\u91cf\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u6709\u8fd9\u4e2a\u53d8\u91cf\u7684\u672c\u5730\u526f\u672c\uff0c\u8fd9\u4e5f\u662f<code>ThreadLocal</code>\u53d8\u91cf\u540d\u7684\u7531\u6765\u3002\u4ed6\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>get\uff08\uff09</code> \u548c <code>set\uff08\uff09</code> \u65b9\u6cd5\u6765\u83b7\u53d6\u9ed8\u8ba4\u503c\u6216\u5c06\u5176\u503c\u66f4\u6539\u4e3a\u5f53\u524d\u7ebf\u7a0b\u6240\u5b58\u7684\u526f\u672c\u7684\u503c\uff0c\u4ece\u800c\u907f\u514d\u4e86\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u3002</p> <p>\u518d\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a\u4e24\u4e2a\u4eba\u53bb\u5b9d\u5c4b\u6536\u96c6\u5b9d\u7269\uff0c\u8fd9\u4e24\u4e2a\u5171\u7528\u4e00\u4e2a\u888b\u5b50\u7684\u8bdd\u80af\u5b9a\u4f1a\u4ea7\u751f\u4e89\u6267\uff0c\u4f46\u662f\u7ed9\u4ed6\u4eec\u4e24\u4e2a\u4eba\u6bcf\u4e2a\u4eba\u5206\u914d\u4e00\u4e2a\u888b\u5b50\u7684\u8bdd\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u95ee\u9898\u3002\u5982\u679c\u628a\u8fd9\u4e24\u4e2a\u4eba\u6bd4\u4f5c\u7ebf\u7a0b\u7684\u8bdd\uff0c\u90a3\u4e48 ThreadLocal \u5c31\u662f\u7528\u6765\u907f\u514d\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u7ade\u4e89\u7684\u3002</p>"},{"location":"native/","title":"C&amp;C++","text":""},{"location":"native/JNI/Android-JNI/","title":"Android JNI \u4f7f\u7528\u603b\u7ed3","text":""},{"location":"native/JNI/Android-JNI/#1-jni-ndk","title":"1. JNI \u548c NDK \u7684\u533a\u522b","text":"<p>JNI \u5168\u79f0\u662f Java Native Interface\uff0c\u5373 Java \u672c\u5730\u63a5\u53e3\u3002\u5b83\u662f\u7528\u6765\u4f7f\u5f97 Java \u8bed\u8a00\u548c C/C++ \u8bed\u8a00\u76f8\u4e92\u8c03\u7528\u7684\u3002\u5b83\u672c\u8eab\u548c Android \u5e76\u65e0\u5173\u7cfb\uff0c\u53ea\u662f\u5728 Android \u5f00\u53d1\u4e2d\u4f1a\u7528\u5230\uff0c\u5728\u5176\u4ed6\u5730\u65b9\u4e5f\u4f1a\u7528\u5230\u7684\u3002</p> <p>\u800c NDK \u7684\u5168\u79f0\u662f Native Development Kit\uff0c\u548c SDK \u7684\u5168\u79f0\u662f Software Development Kit \u4e00\u6837\uff0c\u90fd\u662f\u5f00\u53d1\u5de5\u5177\u5305\u3002NDK \u662f Android \u5f00\u53d1\u7684\u5de5\u5177\u5305\uff0c\u4e3b\u8981\u7528\u4f5c C/C++ \u5f00\u53d1\uff0c\u63d0\u4f9b\u4e86\u76f8\u5173\u7684\u52a8\u6001\u5e93\u3002</p>"},{"location":"native/JNI/Android-JNI/#2-jni","title":"2. JNI\u6570\u636e\u7c7b\u578b","text":""},{"location":"native/JNI/Android-JNI/#21","title":"2.1 \u57fa\u672c\u6570\u636e\u7c7b\u578b\u8f6c\u6362","text":"<p>\u5728 Java \u4e2d\u4f20\u9012\u7684\u53c2\u6570\u7c7b\u578b\u662f int\uff0c\u800c\u5728 JNI \u4e2d\u5c31\u6210\u4e86 jint\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230 Java \u5230 JNI \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u3002</p> <p>\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> Java \u7c7b\u578b Native \u7c7b\u578b \u7b26\u53f7\u5c5e\u6027 \u5b57\u957f boolean jboolean \u65e0\u7b26\u53f7 8\u4f4d byte jbyte \u65e0\u7b26\u53f7 8\u4f4d char jchar \u65e0\u7b26\u53f7 16\u4f4d short jshort \u6709\u7b26\u53f7 16\u4f4d int jnit \u6709\u7b26\u53f7 32\u4f4d long jlong \u6709\u7b26\u53f7 64\u4f4d float jfloat \u6709\u7b26\u53f7 32\u4f4d double jdouble \u6709\u7b26\u53f7 64\u4f4d <p>\u6211\u4eec\u4f20\u9012\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u5728 JNI \u4e2d\u90fd\u6709\u76f8\u5bf9\u7684\u6570\u636e\u7c7b\u578b\u3002</p>"},{"location":"native/JNI/Android-JNI/#22","title":"2.2. \u5f15\u7528\u6570\u636e\u7c7b\u578b\u8f6c\u6362","text":"<p>\u9664\u4e86\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4e4b\u5916\uff0c\u5f15\u7528\u6570\u636e\u7c7b\u578b\u4e5f\u6709\u7740\u4e00\u4e00\u5bf9\u5e94\u3002</p> Java \u5f15\u7528\u7c7b\u578b Native \u7c7b\u578b Java \u5f15\u7528\u7c7b\u578b Native \u7c7b\u578b All objects jobject char[][] jcharArray java.lang.Class jclass short[][] jshortArray java.lang.String jstring int[][] jintArray Object[][] jobjectArray long[][] jlongArray boolean[][] jbooleanArray float[][] jfloatArray byte[][] jbyteArray double[][] jdoubleArray java.lang.Throwable jthrowable <p>\u53ef\u4ee5\u770b\u5230\uff0c\u9664\u4e86 Java \u4e2d\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u6570\u7ec4\u3001Class\u3001String \u548c Throwable \u5916\uff0c\u5176\u4f59\u6240\u6709 Java \u5bf9\u8c61\u7684\u6570\u636e\u7c7b\u578b\u5728 JNI \u4e2d\u90fd\u7528 jobject \u8868\u793a\u3002</p>"},{"location":"native/JNI/Android-JNI/#3-jni","title":"3. JNI\u53c2\u6570\u5206\u6790","text":"<p>\u5728 AS \u65b0\u5efa\u5de5\u7a0b\u65f6\u82e5\u9009\u62e9\u4e86 Include C++ Support\uff0c\u5c31\u4f1a\u81ea\u5e26\u914d\u7f6e\u597d\u7684 C++ \u5f00\u53d1\u73af\u5883\u3002</p> <p>\u5728\u58f0\u660e native \u65b9\u6cd5\u65f6\u8fd8\u662f\u7528 Java \u6765\u5199\u6bd4\u8f83\u597d\uff0c\u6bd4 Kotlin \u7684 external \u5173\u952e\u5b57\u8981\u53cb\u597d\u591a\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u5feb\u6377\u952e\u751f\u6210\u5bf9\u7528\u7684 C++ \u65b9\u6cd5\u3002</p> <p>\u58f0\u660e native \u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>public static native int plus(int a, int b);\n</code></pre> <p>\u5feb\u6377\u952e\u4fbf\u4f1a\u751f\u6210\u5bf9\u5e94\u7684 C++ \u65b9\u6cd5</p> <pre><code>extern \"C\"\nJNIEXPORT jint JNICALL\nJava_com_adison_notes_NativeClass_plus(JNIEnv *env, jclass clazz, jint a, jint b) {\njint sum = a + b;\nreturn sum;\n}\n</code></pre> <p>\u5728 Java \u5c42\u4e2d\u53ea\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u800c\u5728 C++ \u4ee3\u7801\u5c31\u6709\u56db\u4e2a\u53c2\u6570\u4e86\uff0c\u81f3\u5c11\u90fd\u4f1a\u5305\u542b\u524d\u9762\u4e24\u4e2a\u53c2\u6570\uff0c\u4e0b\u9762\u8bb2\u89e3\u8fd9\u4e9b\u53c2\u6570\u610f\u4e49\u3002</p>"},{"location":"native/JNI/Android-JNI/#31-jnienv","title":"3.1 JNIEnv","text":"<p><code>JNIEnv*</code> \u662f\u5b9a\u4e49\u4efb\u610f native \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5b83\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u8bbf\u95ee\u865a\u62df\u673a\u5185\u90e8\u7684\u5404\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u540c\u65f6\u5b83\u8fd8\u6307\u5411 JVM \u51fd\u6570\u8868\u7684\u6307\u9488\uff0c\u51fd\u6570\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5165\u53e3\u6307\u5411\u4e00\u4e2a JNI \u51fd\u6570\uff0c\u6bcf\u4e2a\u51fd\u6570\u7528\u4e8e\u8bbf\u95ee JVM \u4e2d\u7279\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u3002</p>"},{"location":"native/JNI/Android-JNI/#jnienv","title":"JNIEnv \u7c7b\u578b\u58f0\u660e","text":"<pre><code>#if defined(__cplusplus)\ntypedef _JNIEnv JNIEnv;\ntypedef _JavaVM JavaVM;\n#else\ntypedef const struct JNINativeInterface* JNIEnv;\ntypedef const struct JNIInvokeInterface* JavaVM;\n#endif\n</code></pre> <p>\u7531\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u77e5 , JNIEnv \u662f\u901a\u8fc7 typedef \u5c06\u5176\u5b83\u7684\u7c7b\u578b\u5b9a\u4e49\u4e3a JNIEnv \u7c7b\u578b\u7684 ;</p> <p><code>__cplusplus</code> \u662f C++ \u7f16\u8bd1\u5668\u4e2d\u5b9a\u4e49\u7684\u5b8f , C \u8bed\u8a00\u7f16\u8bd1\u5668\u4e2d\u6ca1\u6709\u5b9a\u4e49\u8be5\u5b8f , \u901a\u8fc7\u8be5\u5b8f\u5b9a\u4e49 , \u53ef\u4ee5\u533a\u5206\u5f53\u524d\u662f C++ \u73af\u5883\u8fd8\u662f C\u8bed\u8a00\u73af\u5883 ;</p> <p>C\u8bed\u8a00\u73af\u5883</p> <p>\u5728C\u8bed\u8a00\u73af\u5883\u4e0b \u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u9762\u6d89\u53ca\u4e86\u4e09\u7c7b\u6307\u9488\uff0cJNIEnv * \u672c\u8eab\u5c31\u662f\u6307\u9488\uff0c\u800c\u5b83\u6307\u5411\u7684\u4e5f\u662f\u6307\u9488\uff0c\u5728 JVM \u51fd\u6570\u8868\u91cc\u9762\u7684\u6bcf\u4e00\u9879\u53c8\u90fd\u662f\u6307\u9488\u3002</p> <p>JNINativeInterface \u7ed3\u6784\u4f53\u90e8\u5206\u4ee3\u7801\u793a\u4f8b : \u8be5\u7ed3\u6784\u4f53\u5b9a\u4e49\u5728 jni.h \u5934\u6587\u4ef6\u4e2d ;</p> <pre><code>struct JNINativeInterface {\nvoid*       reserved0;\nvoid*       reserved1;\nvoid*       reserved2;\nvoid*       reserved3;\njint        (*GetVersion)(JNIEnv *);\njclass      (*DefineClass)(JNIEnv*, const char*, jobject, const jbyte*,\njsize);\njclass      (*FindClass)(JNIEnv*, const char*);\njmethodID   (*FromReflectedMethod)(JNIEnv*, jobject);\njfieldID    (*FromReflectedField)(JNIEnv*, jobject);\n/* spec doesn't show jboolean parameter */\njobject     (*ToReflectedMethod)(JNIEnv*, jclass, jmethodID, jboolean);\njclass      (*GetSuperclass)(JNIEnv*, jclass);\njboolean    (*IsAssignableFrom)(JNIEnv*, jclass, jclass);\n/* spec doesn't show jboolean parameter */\njobject     (*ToReflectedField)(JNIEnv*, jclass, jfieldID, jboolean);\njint        (*Throw)(JNIEnv*, jthrowable);\njint        (*ThrowNew)(JNIEnv *, jclass, const char *);\njthrowable  (*ExceptionOccurred)(JNIEnv*);\nvoid        (*ExceptionDescribe)(JNIEnv*);\nvoid        (*ExceptionClear)(JNIEnv*);\nvoid        (*FatalError)(JNIEnv*, const char*);\n...\njstring     (*NewStringUTF)(JNIEnv*, const char*);\n...\n};\n</code></pre> <p>C++ \u73af\u5883</p> <p>\u800c\u5728 C++ \u4e2d , \u5c06 _JNIEnv \u7ed3\u6784\u4f53\u7c7b\u578b \u901a\u8fc7 typedef \u4e3a\u5176\u58f0\u660e\u522b\u540d JNIEnv ;</p> <p>_JNIEnv \u7ed3\u6784\u4f53 \u90e8\u5206\u4ee3\u7801\u793a\u4f8b :</p> <pre><code>struct _JNIEnv {\n/* do not rename this; it does not seem to be entirely opaque */\nconst struct JNINativeInterface* functions;\n#if defined(__cplusplus)\njint GetVersion()\n{ return functions-&gt;GetVersion(this); }\njclass DefineClass(const char *name, jobject loader, const jbyte* buf,\njsize bufLen)\n{ return functions-&gt;DefineClass(this, name, loader, buf, bufLen); }\njclass FindClass(const char* name)\n{ return functions-&gt;FindClass(this, name); }\njmethodID FromReflectedMethod(jobject method)\n{ return functions-&gt;FromReflectedMethod(this, method); }\njfieldID FromReflectedField(jobject field)\n{ return functions-&gt;FromReflectedField(this, field); }\njobject ToReflectedMethod(jclass cls, jmethodID methodID, jboolean isStatic)\n{ return functions-&gt;ToReflectedMethod(this, cls, methodID, isStatic); }\njclass GetSuperclass(jclass clazz)\n{ return functions-&gt;GetSuperclass(this, clazz); }\n...\njstring NewStringUTF(const char* bytes)\n{ return functions-&gt;NewStringUTF(this, bytes); }\n...\n}\n</code></pre>"},{"location":"native/JNI/Android-JNI/#32-jclass","title":"3.2 jclass \u53c2\u6570","text":"<p>jclass \u662f native \u51fd\u6570\u91cc\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7c7b\u578b\uff0c\u4f46\u5374\u4e0d\u662f\u4e00\u5b9a\u7684\u3002</p> <p>\u5982\u679c\u8be5 native \u65b9\u6cd5\u662f\u4e00\u4e2a\u9759\u6001 static \u65b9\u6cd5\uff0c\u90a3\u4e48\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f jclass \u7c7b\u578b\uff0c\u6307\u7684\u662f\u8c03\u7528\u8be5\u51fd\u6570\u7684\u7c7b\u3002</p> <p>\u5982\u679c\u662f\u4e00\u4e2a\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u90a3\u4e48\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f jobject \u7c7b\u578b\uff0c\u6307\u7684\u662f\u8c03\u7528\u8be5\u51fd\u6570\u7684\u5bf9\u8c61\u3002</p>"},{"location":"native/JNI/Android-JNI/#33-jniexportjnicall","title":"3.3 JNIEXPORT\u548cJNICALL","text":"<p>JNIEXPORT\u548cJNICALL\u90fd\u662fJNI\u7684\u5173\u952e\u5b57\uff0c\u8868\u793a\u6b64\u51fd\u6570\u662f\u8981\u88abJNI\u8c03\u7528\u7684\u3002</p>"},{"location":"native/JNI/Android-JNI/#jniexport","title":"JNIEXPORT \u5b8f\u5b9a\u4e49\u4f5c\u7528","text":"<p>Windows \u4e2d\u5982\u679c\u9700\u8981\u751f\u6210\u52a8\u6001\u5e93 , \u5e76\u4e14\u9700\u8981\u5c06\u8be5\u52a8\u6001\u5e93\u4ea4\u7ed9\u5176\u5b83\u9879\u76ee\u4f7f\u7528 , \u9700\u8981\u5728\u65b9\u6cd5\u524d\u52a0\u5165\u7279\u6b8a\u6807\u8bc6 , \u624d\u80fd \u5728\u5916\u90e8 \u7a0b\u5e8f\u4ee3\u7801\u4e2d \u8c03\u7528\u8be5 DLL \u52a8\u6001\u5e93\u4e2d\u5b9a\u4e49\u7684\u65b9\u6cd5 ;</p> <ol> <li> <p>Windows \u5e73\u53f0 : \u9700\u8981\u5c06\u65b9\u6cd5 \u8fd4\u56de\u503c \u4e4b\u524d\u52a0\u5165 <code>__declspec(dllexport)</code> \u6807\u8bc6 ;</p> </li> <li> <p>Linux \u5e73\u53f0 : \u9700\u8981\u5c06\u65b9\u6cd5 \u8fd4\u56de\u503c \u4e4b\u524d\u52a0\u5165 <code>attribute ((visibility (\u201cdefault\u201d)))</code> \u6807\u8bc6 ;</p> </li> </ol> <p>\u8be5\u58f0\u660e\u7684\u4f5c\u7528\u662f\u4fdd\u8bc1\u5728\u672c\u52a8\u6001\u5e93\u4e2d\u58f0\u660e\u7684\u65b9\u6cd5 , \u80fd\u591f\u5728\u5176\u4ed6\u9879\u76ee\u4e2d\u53ef\u4ee5\u88ab\u8c03\u7528 ;</p>"},{"location":"native/JNI/Android-JNI/#jnicall","title":"JNICALL\u5b8f\u5b9a\u4e49\u4f5c\u7528 :","text":"<ol> <li>Windows \u5e73\u53f0   : JNICALL \u88ab\u5b9a\u4e49\u4e3a<code>__stdcall</code> , <code>__stdcall</code> \u662f\u4e00\u79cd\u51fd\u6570\u8c03\u7528\u53c2\u6570\u7684\u7ea6\u5b9a , \u5728 Windows \u4e2d\u8c03\u7528\u51fd\u6570\u65f6 , \u8be5\u51fd\u6570\u7684\u53c2\u6570\u662f\u4ee5 \u6808 \u7684\u5f62\u5f0f\u4fdd\u5b58\u7684 , \u6808 \u4e2d\u5143\u7d20\u662f\u540e\u8fdb\u5148\u51fa\u7684 , <code>__stdcall</code> \u8868\u793a\u53c2\u6570\u662f\u4ece\u53f3\u5230\u5de6\u4fdd\u5b58\u7684 ;</li> </ol> <p>__stdcall \u7528\u4e8e \u5b9a\u4e49 \u51fd\u6570\u5165\u6808\u89c4\u5219 ( \u4ece\u53f3\u5230\u5de6 ) , \u548c \u5806\u6808\u6e05\u7406\u89c4\u5219 ;</p> <ol> <li>Linux \u5e73\u53f0 : JNICALL \u6ca1\u6709\u8fdb\u884c\u5b9a\u4e49 , \u76f4\u63a5\u7f6e\u7a7a ; \u5728 Linux \u4e2d\u53ef\u4ee5\u4e0d\u7528\u5199 JNIEXPORT \u548c JNICALL \u5b8f ;</li> </ol>"},{"location":"native/JNI/Android-JNI/#4-jni","title":"4. JNI\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"native/JNI/Android-JNI/#41-javavm","title":"4.1 \u83b7\u53d6 JavaVM","text":"<p><code>JavaVM</code> \u662fJNI\u5b9a\u4e49\u7684\u9664JNIEnv\u4e4b\u5916\u53e6\u4e00\u6838\u5fc3\u6570\u636e\u63a5\u53e3\uff0c\u7406\u8bba\u4e0a\u4f60\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u521b\u5efa\u591a\u4e2a <code>JavaVM</code>\u7684\u5b9e\u4f8b\uff0c\u4f46\u662f\u5b89\u5353\u53ea\u5141\u8bb8\u4e00\u4e2a\u3002\u83b7\u53d6\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u65b9\u5f0f\u6bd4\u8f83\u7b80\u5355\uff0c\u4f60\u9700\u8981\u5728Java\u4ee3\u7801 \u4e2d\u50cf\u4e0b\u9762\u8fd9\u6837\u52a0\u8f7d\u52a8\u6001\u5e93\uff1a</p> <pre><code>static {\n    System.loadLibrary(\"your-native-lib\");\n}\n</code></pre> <p>\u5728\u5e93\u52a0\u8f7d\u7684\u65f6\u5019\uff0c\u4e0b\u9762\u8fd9\u4e2a\u51fd\u6570\u4f1a\u88ab\u8c03\u7528\uff1a</p> <pre><code>jint JNI_OnLoad(JavaVM* vm, void* reserved);\n</code></pre> <p>\u4f60\u53ef\u4ee5\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u628a\u53c2\u6570<code>vm</code>\u7f13\u5b58\u4e0b\u6765\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u53ea\u5141\u8bb8\u6709\u4e00\u4e2a<code>JavaVM</code>\u7684\u5b9e\u4f8b\uff0c\u6240\u4ee5\u628a\u5b83\u5f53\u6210\u5168\u5c40\u53d8\u91cf<code>cache</code>\u4e0b\u6765\u5e94\u8be5\u662f\u5b89\u5168\u7684\u3002</p>"},{"location":"native/JNI/Android-JNI/#42-native-java","title":"4.2 \u4ece native \u5c42\u76f4\u63a5\u8c03\u7528 Java \u4ee3\u7801","text":"<p>\u5f88\u591a\u65f6\u5019\uff0c\u4f60\u7684native\u4ee3\u7801\u5efa\u7acb\u81ea\u5df1\u7684\u7ebf\u7a0b\uff08\u6bd4\u5982\u5efa\u7acb\u7ebf\u7a0b\u76d1\u542c\uff09\uff0c\u5e76\u5728\u5408\u9002\u7684\u65f6\u5019\u56de\u8c03 Java \u4ee3\u7801\uff0c\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u50cf\u4e0a\u9762\u90a3\u6837\u76f4\u63a5\u83b7\u5f97 <code>JNIEnv</code>\uff0c\u83b7\u53d6\u5b83\u7684\u5b9e\u4f8b\u9700\u8981\u628a\u4f60\u7684\u7ebf\u7a0b <code>Attach</code>\u5230<code>JavaVM</code>\u4e0a\u53bb\uff0c\u8c03\u7528\u7684\u65b9\u6cd5\u662f <code>JavaVM::AttachCurrentThread</code></p> <pre><code>JNIEnv* env;\nGetJVM()-&gt;AttachCurrentThread(&amp;env, nullptr);\n</code></pre> <p>\u8fd9\u91cc\u4f60\u9700\u8981\u7528\u5230<code>JavaVM</code>\u7684\u5b9e\u4f8b\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u83b7\u53d6\u65b9\u5f0f\u53ef\u4ee5\u53c2\u8003\u4e0a\u4e00\u4e2a\u5c0f\u8282\u3002\u4f7f\u7528\u5b8c\u4e4b\u540e\u4f60 \u9700\u8981\u8c03\u7528 <code>JavaVM::DetachCurrentThread</code>\u51fd\u6570\u89e3\u7ed1\u7ebf\u7a0b\u3002</p> <pre><code>GetJVM()-&gt;DetachCurrentThread();\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u7ecf\u7ed1\u5b9a\u5230<code>JavaVM</code>\u4e0a\u7684\u7ebf\u7a0b\u8c03\u7528<code>AttachCurrentThread</code>\u4e0d\u4f1a\u6709\u4efb \u4f55\u5f71\u54cd\u3002\u5982\u679c\u4f60\u7684\u7ebf\u7a0b\u5df2\u7ecf\u7ed1\u5b9a\u5230\u4e86<code>JavaVM</code>\u4e0a\uff0c\u4f60\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528<code>JavaVM::GetEnv</code>\u83b7\u53d6 <code>JNIEnv</code>\uff0c\u5982\u679c\u4f60\u7684\u7ebf\u7a0b\u6ca1\u6709\u7ed1\u5b9a\uff0c\u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de<code>JNI_EDETACHED</code>\u3002\u6211\u7684\u4e60\u60ef\u662f\u5c01\u88c5\u4e00\u4e2a \u667a\u80fd\u6307\u9488\u7c7b\u81ea\u52a8\u5b8c\u6210\u8fd9\u4e9b\u64cd\u4f5c\u3002</p> <pre><code>class JNIEnvPtr {\npublic:\n    JNIEnvPtr() : env_{nullptr}, need_detach_{false} {\n        if (GetJVM()-&gt;GetEnv((void**) &amp;env_, JNI_VERSION_1_6) ==\n            JNI_EDETACHED) {\n            GetJVM()-&gt;AttachCurrentThread(&amp;env_, nullptr);\n            need_detach_ = true;\n        }\n    }\n\n    ~JNIEnvPtr() {\n        if (need_detach_) {\n            GetJVM()-&gt;DetachCurrentThread();\n        }\n    }\n\n    JNIEnv* operator-&gt;() {\n        return env_;\n    }\n\nprivate:\n    JNIEnvPtr(const JNIEnvPtr&amp;) = delete;\n    JNIEnvPtr&amp; operator=(const JNIEnvPtr&amp;) = delete;\n\nprivate:\n    JNIEnv* env_;\n    bool need_detach_;\n};\n</code></pre> <p>\u8fd9\u4e2a\u7c7b\u5728\u6784\u9020\u51fd\u6570\u4e2d\u8c03\u7528<code>AttachCurrentThread</code>\u5728\u6790\u6784\u4e2d\u8c03\u7528<code>DetachCurrentThread</code>\uff0c\u7136 \u540e\u91cd\u8f7d<code>-&gt;</code>\u64cd\u4f5c\u7b26\u3002\u4f60\u53ef\u4ee5\u50cf\u4e0b\u9762\u8fd9\u6837\u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\u7c7b\u3002</p> <pre><code>// native \u4ee3\u7801\u9700\u8981\u56de\u8c03 Java \u4ee3\u7801\n\nNativeClass::NativeMethod() {\n    JNIEnvPtr env;\n    env-&gt;CallVoidMethod(instance, method, args...);\n}\n</code></pre>"},{"location":"native/JNI/Android-JNI/#43-jclass-jmethodid-jfieldid","title":"4.3 \u83b7\u53d6 jclass, jmethodID, jfieldID","text":"<p>\u5982\u679c\u4f60\u60f3\u8981\u8c03\u7528Java\u5c42\u7684\u4ee3\u7801\uff0c\u4f60\u9700\u8981\u4f7f\u7528 JNIEnv\uff0c\u6bd4\u5982\u4f60\u60f3\u8981\u8c03\u7528\u4e00\u4e2a\u65e0\u8fd4\u56de\u503c\u65e0\u53c2\u6570\u7684\u6210\u5458\u51fd\u6570\uff0c\u8bed\u6cd5\u5927\u6982\u5982\u4e0b\uff1a</p> <pre><code>env-&gt;CallVoidMethod(instance, method);\n</code></pre> <p>\u8fd9\u91cc\u4f60\u6700\u5c11\u9700\u8981\u4e24\u4e2a\u53c2\u6570<code>instance</code>\u548c<code>method</code>\uff0c\u56e0\u4e3a\u4f60\u8981\u8c03\u7528\u4e00\u4e2a\u65b9\u6cd5\u4f60\u81f3\u5c11\u9700\u8981\u6709\u4e00 \u4e2a\u5bf9\u8c61\u4ee5\u53ca\u4e00\u4e2a\u6210\u5458\u51fd\u6570\u540d\u79f0\u3002\u5173\u4e8e<code>instance</code>\u5982\u4f55\u83b7\u53d6\uff0c\u6211\u4eec\u653e\u5728\u4e0b\u4e00\u4e2a\u5c0f\u8282\uff0c\u8fd9\u91cc\u4e3b\u8981 \u8ba8\u8bba\u5982\u4f55\u83b7\u53d6<code>method</code>\u3002</p> <p>\u5728 Java \u4e2d\u6240\u6709\u7684\u65b9\u6cd5\u5fc5\u7136\u5c5e\u4e8e\u67d0\u4e00\u4e2a\u7c7b\uff0c\u6240\u4ee5\u83b7\u53d6 <code>method</code> \u4e4b\u524d\u4f60\u9700\u8981\u83b7\u53d6 <code>class</code>\uff0c \u5b83\u4eec\u7c7b\u578b\u5206\u522b\u4e3a<code>jclass</code>,<code>jmethod</code>\u3002</p>"},{"location":"native/JNI/Android-JNI/#44","title":"4.4 \u83b7\u53d6\u7c7b\u7684\u5f15\u7528","text":"<p>\u8c03\u7528<code>JNIEnv::FindClass</code>\u53ef\u4ee5\u83b7\u53d6\u5bf9\u4e8e\u7684 class \u7684\u5b9e\u4f8b\u3002</p> <pre><code>jclass clazz = env-&gt;FindClass(\"full/name/of/your/class\");\n</code></pre>"},{"location":"native/JNI/Android-JNI/#45","title":"4.5 \u83b7\u53d6\u6210\u5458\u51fd\u6570\u7684\u5f15\u7528","text":"<p>\u83b7\u53d6\u4e00\u4e2a\u65b9\u6cd5\u7684\u5f15\u7528\u9700\u8981\u8c03\u7528<code>JNIEnv::GetMethodID</code>\u65b9\u6cd5\u3002</p> <pre><code>jmethodID = env-&gt;GetMethodID(clazz, \"method\", \"()V\");\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e0a\u9762\u83b7\u53d6\u7684\u7c7b\u5f15\u7528\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u65b9\u6cd5\u540d\u79f0\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u65b9\u6cd5\u7684\u7b7e\u540d\u3002\u5173\u4e8e \u7b7e\u540d\u7684\u5199\u6cd5\uff0c\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863\u7684Type Signatures\u4e00\u5c0f\u8282</p> <p>\u9700\u8981\u989d\u5916\u6ce8\u610f\u7684\u5730\u65b9\u662f\uff0c\u6784\u9020\u51fd\u6570\u7684\u51fd\u6570\u540d\u79f0\u4e3a<code>&lt;init&gt;</code></p>"},{"location":"native/JNI/Android-JNI/#46","title":"4.6  \u83b7\u53d6\u6210\u5458\u53d8\u91cf\u7684\u5f15\u7528","text":"<p>\u83b7\u53d6\u6210\u5458\u53d8\u91cf\u7684\u5f15\u7528\u548c\u83b7\u53d6\u6210\u5458\u51fd\u6570\u7684\u5f15\u7528\u662f\u7c7b\u4f3c\u7684\uff0c\u8c03\u7528<code>JNIEnv::GetFieldID</code>\u5373\u53ef\uff0c\u8fd9 \u91cc\u4e0d\u518d\u8d58\u8ff0\u3002</p>"},{"location":"native/JNI/Android-JNI/#47","title":"4.7 \u5931\u6548\u95ee\u9898","text":"<p>\u7279\u522b\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f\uff0cjclass, methodID \u548c fieldID \u5728\u7c7b unload \u4e4b\u524d\u90fd\u662f\u6709\u6548\uff0c\u867d\u7136 \u4e00\u4e2a\u7c7b\u4f1a unload \u7684\u60c5\u51b5\u975e\u5e38\u5c11\u89c1\uff0c\u4f46\u662f\u5e76\u4e0d\u662f\u6ca1\u6709\u53ef\u80fd\u3002\u6240\u4ee5\u5982\u679c\u4f60\u60f3\u8981\u4fdd\u8bc1\u4f60\u7684\u8fd9\u4e9b\u5f15 \u7528\u6709\u6548\u7684\u8bdd\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u8fd9\u79cd\u65b9\u5f0f\u5bf9\u4f60\u7528\u5230\u7684\u7c7b\uff0c\u65b9\u6cd5\uff0c\u6210\u5458\u53d8\u91cf\u8fdb\u884c\u7f13\u5b58\uff1a</p> <pre><code>private static native void nativeInit();\n\nstatic {\n    nativeInit();\n}\n</code></pre> <p>\u7136\u540e\u5728\u4f60\u7684 native \u65b9\u6cd5\u4e2d\u83b7\u53d6\u5e76\u7f13\u5b58\u4f60\u7528\u5230\u7684 entity\u3002</p> <pre><code>Java_xxxx_nativeInit(JNIEnv *env, jobject instance) {\n    // \u67e5\u627e\u5e76\u4e14\u7f13\u5b58\u4f60\u9700\u8981\u7528\u5230\u7684\u4e0a\u8ff0\u5bf9\u8c61\n}\n</code></pre> <p>\u5f53\u7136\u5982\u679c\u4f60\u4f7f\u7528 <code>System.loadLibrary</code> \u4f60\u4e5f\u53ef\u4ee5\u5728 <code>JNI_OnLoad</code> \u51fd\u6570\u4e2d\u7f13\u5b58\u8fd9\u4e9b\u4e1c\u897f\u3002</p>"},{"location":"native/JNI/Android-JNI/#48","title":"4.8  \u8f85\u52a9\u5de5\u5177","text":"<p>\u4e0b\u9762\u8fd9\u4e24\u4e2a\u5b8f\u5b9a\u4e49\u6765\u81ea <code>libvlc-android</code> \u53ef\u4ee5\u7528\u6765\u65b9\u4fbf\u7684\u83b7\u53d6 jclass\uff0cjmetod\uff0cjfield</p> <pre><code>#define GET_CLASS(clazz, str, b_globlal)                                    \\\n    do {                                                                    \\\n        (clazz) = env-&gt;FindClass((str));                                    \\\n        if (!(clazz)) {                                                     \\\n            return -1;                                                      \\\n        }                                                                   \\\n        if (b_globlal) {                                                    \\\n            (clazz) = reinterpret_cast&lt;jclass&gt;(env-&gt;NewGlobalRef((clazz))); \\\n            if (!(clazz)) {                                                 \\\n                return -1;                                                  \\\n            }                                                               \\\n        }                                                                   \\\n    } while (0)\n\n#define GET_ID(get, id, clazz, str, args)                 \\\n    do {                                                  \\\n        (id) = env-&gt;get((clazz), (str), (args));          \\\n        if (!(id)) {                                      \\\n            return -1;                                    \\\n        }                                                 \\\n    } while (0)\n</code></pre> <p>\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>GET_CLASS(clazz, \"full/class/name\", false); // \u7b2c\u4e09\u4e2a\u53c2\u6570\u540e\u9762\u89e3\u91ca\nGET_ID(GetMethodID, method, clazz, \"method\", \"()V\");\nGET_ID(GetFieldID, field, clazz, \"filed\", \"I\");\n</code></pre> <p>\u6b64\u5916\u8fd9\u4e9b class, methodID\uff0c filedID \u662f\u4e0d\u4f1a\u53d8\u7684\u4e1c\u897f\uff08\u4ece\u903b\u8f91\u4e0a\u7406\u89e3\uff0c\u7c7b\u540d\uff0c\u65b9\u6cd5\u540d\uff0c \u6210\u5458\u540d\u90fd\u4e0d\u4f1a\u5728\u8fd0\u884c\u662f\u66f4\u6539\uff09\uff0c\u4f60\u53ef\u4ee5\u7f13\u5b58\u4f60\u67e5\u627e\u597d\u7684\u5f15\u7528\u4f5c\u4e3a\u5168\u5c40\u53d8\u91cf\uff0c\u4e00\u65b9\u9762\u53ef\u4ee5\u63d0\u5347 \u6548\u7387\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u65b9\u4fbf\u4f7f\u7528\uff0c\u56e0\u4e3a\u4f60\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u91cd\u65b0\u67e5\u627e\u3002\u4e2a\u4eba\u7684\u4e60\u60ef\u662f\u5199\u4e00\u4e2a\u7ed3\u6784\u4f53\u7684 \u5355\u4f8b\uff0c\u5728 <code>JNI_OnLoad</code>\u4e2d\u67e5\u627e\u5e76\u7f13\u5b58\u8fd9\u4e9b\u5b9e\u4f53\uff0c\u7136\u540e\u5728<code>JNI_OnUnload</code>\u4e2d\u6e05\u7406\u7f13\u5b58\u3002</p>"},{"location":"native/JNI/Android-JNI/#49-instance","title":"4.9 \u83b7\u53d6 instance","text":"<p>\u524d\u9762\u63d0\u5230\uff0c\u5982\u679c\u60f3\u8981\u5728 native \u5c42\u8c03\u7528 java \u5c42\u7684\u51fd\u6570\uff0c\u4f60\u81f3\u5c11\u4e00\u4e2a\u5bf9\u8c61\u548c\u4e00\u4e2a\u6210\u5458\u65b9\u6cd5\uff0c \u4e0a\u4e00\u5c0f\u8282\u8bb2\u8ff0\u4e86\u5982\u4f55\u83b7\u53d6\u6210\u5458\u65b9\u6cd5\uff0c\u8fd9\u4e00\u5c0f\u8282\u4e3b\u8981\u8bb2\u8ff0\u5982\u83b7\u53d6\u4e00\u4e2aJava\u5bf9\u8c61\u4e5f\u5c31\u662f instance\u3002\u83b7\u53d6\u7684\u5b83\u901a\u5e38\u662f\u901a\u8fc7\u4e00\u4e0b\u4e09\u79cd\u9014\u5f84\uff1a</p>"},{"location":"native/JNI/Android-JNI/#native","title":"native \u4ee3\u7801\u53c2\u6570","text":"<p><code>instance</code>\u7684\u83b7\u53d6\u548c<code>JNIEnv</code>\u7684\u83b7\u53d6\u662f\u7c7b\u4f3c\u7684\uff0c\u5982\u679c\u4f60\u7684\u65b9\u6cd5\u662fJava\u4ee3\u7801\u7684native\u5b9e\u73b0\uff0c\u90a3 \u4e48JNI\u4f1a\u81ea\u52a8\u628a\u8c03\u7528\u8be5\u5bf9\u8c61\u7684\u5b9e\u4f8b\u4f20\u9012\u7ed9\u4f60\u3002</p> <pre><code>JNIEXPORT void JNICALL\nJava_xxxxx_nativeMethod(JNIEnv *env, jobject instance);\n</code></pre> <p>\u4e0a\u9762\u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u4f60\u9700\u8981\u7684\u5bf9\u8c61\u3002\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u4f7f\u7528\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u6bd4\u5982\uff1a</p> <pre><code>JNIEXPORT void JNICALL\nJava_xxxxx_nativeMethod(JNIEnv *env, jobject instance) {\n    auto&amp; cached_fields = CachedFields::GetInstance();  // \u53c2\u8003\u4e0a\u4e00\u5c0f\u8282\n    env-&gt;CallVoidMethod(instance, cached_fields.methodID)\n}\n</code></pre>"},{"location":"native/JNI/Android-JNI/#callobjectmethod","title":"CallObjectMethod","text":"<p>\u5728<code>instance</code>\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8c03\u7528\u8fd9\u4e2a<code>instance</code>\u8fd4\u56de\u5bf9\u8c61\u7684\u65b9\u6cd5\u6765\u83b7\u53d6\u53e6\u4e00\u4e2a <code>instance</code>\uff0c\u6bd4\u5982\uff1a</p> <pre><code>jobject obj_ = env-&gt;CallObjectMethod(instance, methodID, args);\n</code></pre>"},{"location":"native/JNI/Android-JNI/#newobject","title":"NewObject","text":"<p>\u5982\u679c\u4f60\u6ca1\u6709\u8fd9\u6837\u7684 instance \u5b58\u5728\uff0c\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u521b\u5efa\u4e00\u4e2ajava\u5bf9\u8c61\uff0c\u8c03\u7528 <code>JNIEnv::NewObject</code>\u5373\u53ef\u3002</p> <pre><code>jobject obj_ = env-&gt;NewObject(fields.clazz, fields.ctrID);\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u9700\u8981 jclass \u548c\u6784\u9020\u51fd\u6570\u7684 jmethod\uff08\u5173\u4e8e\u5982\u4f55\u83b7\u53d6\u6784\u9020\u51fd\u6570\u7684\u5f15\u7528\u53ef\u4ee5\u67e5\u770b\u4e0a\u4e00 \u5c0f\u8282\uff09\u3002</p>"},{"location":"native/JNI/Android-JNI/#410","title":"4.10 \u5f15\u7528\u7684\u5c40\u90e8\u6027\u548c\u5168\u5c40\u6027","text":"<p>\u6240\u6709\u4f20\u9012\u5230native\u51fd\u6570\u4e2d\u7684\u53c2\u6570\u548c\u4eceJNI\u51fd\u6570\u4e2d\u8fd4\u56de\u7684\u5bf9\u8c61\u90fd\u662f\u5c40\u90e8\u5f15\u7528\uff0c\u6bd4\u5982\uff1a</p> <pre><code>JNIEXPORT void JNICALL\nJava_xxxxx_nativeMethod(JNIEnv *env, jobject instance) {\n    jobject obj_ = env-&gt;CallObjectMethod(instance, methodID, args);\n}\n</code></pre> <p><code>instance</code> \u548c <code>obj_</code> \u90fd\u662f\u5c40\u90e8\u5f15\u7528\uff0c\u8fd9\u79cd\u5f15\u7528\u4e00\u65e6\u51fd\u6570\u8fd4\u56de\u5c31\u4f1a\u5931\u6548\uff0c\u5373\u4f7f\u4f60\u4fdd\u5b58\u5b83\u4eec \u4e5f\u4e0d\u4f1a\u5ef6\u957f\u5b83\u4eec\u7684\u751f\u547d\u5468\u671f\u3002</p> <pre><code>jobject instance_backup;\n\nJNIEXPORT void JNICALL\nJava_xxxxx_nativeMethod(JNIEnv *env, jobject instance) {\n    instance_backup = instance;\n}\n\nNativeClass::NativeMethod() {\n    JNIEnvPtr env;\n    env-&gt;CallVoidMethod(instance_backup, methodID); // \u9519\u8bef\uff01\uff01\uff01\uff01\uff01\n}\n</code></pre> <p>\u8fd9\u6761\u89c4\u5219\u5bf9\u4e8e\u6240\u6709\u7684 jobject \u7684\u5b50\u7c7b\uff08\u5305\u62ec jclas\uff0c jstring\uff0cjarray\uff09\u90fd\u662f\u9002\u7528\u7684\uff0c\u5982 \u679c\u4f60\u60f3\u8981\u5f15\u7528\u4fdd\u6301\u6709\u6548\uff0c\u4f60\u9700\u8981\u8c03\u7528<code>JNIEnv::NewGlobalRef</code>\u6765\u83b7\u53d6\u4e00\u4e2a\u5168\u5c40\u7684\u5f15\u7528\u3002</p> <pre><code>jclass localClass = env-&gt;FindClass(\"MyClass\");\njclass globalClass = reinterpret_cast&lt;jclass&gt;(env-&gt;NewGlobalRef(localClass));\n</code></pre> <p>\u5728\u4f60\u8c03\u7528 DeleteGlobalRef \u4e4b\u524d\uff0c\u8fd9\u4e2a\u5f15\u7528\u90fd\u4f1a\u6709\u6548\u3002\u6240\u4ee5\u5982\u679c\u4f60\u60f3\u8981\u4fdd\u5b58\u4e00\u4e2a\u5c40\u90e8\u5f15\u7528 \uff0c\u4f60\u53ef\u4ee5\u50cf\u4e0b\u9762\u8fd9\u6837\u7ec4\u7ec7\u4f60\u7684\u4ee3\u7801\uff1a</p> <pre><code>class Widget {\npublic:\n    Widget(jobject instance) {\n        JNIEnvPtr env;\n        instance_ = env-&gt;NewGlobalRef(instance);\n    }\n\n    ~Widget() {\n        JNIEnvPtr env;\n        env-&gt;DeleteGlobalRef(instance_);\n    }\n\n    void Function() {\n        // \u4f7f\u7528 instance_;\n    }\n\nprivate:\n    jobject instance_;\n};\n</code></pre>"},{"location":"native/JNI/Android-JNI/#411","title":"4.11 \u5168\u5c40\u548c\u5c40\u90e8\u5f15\u7528\u7684\u5220\u9664","text":"<p>\u5168\u5c40\u5f15\u7528\u9700\u8981\u4f60\u624b\u52a8\u8c03\u7528 <code>DeleteGlobalRef</code> \u6765\u5220\u9664\uff0c\u4f46\u662f\u5c40\u90e8\u7684\u5f15\u7528\u901a\u5e38\u4e0d\u9700\u8981\u3002\u4f46\u662f \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u4e86 AttachCurrentThread \u7ed1\u5b9a\u7ebf\u7a0b\uff0c\u90a3\u4e48\u5728\u4f60\u8c03\u7528 DetachCurrentThread \u4e4b\u524d\uff0c\u4f60\u7684\u5c40\u90e8\u5f15\u7528\u90fd\u4e0d\u4f1a\u81ea\u52a8\u56de\u6536\uff0c\u8fd9\u610f\u5473\u7740\u5982\u679c\u4f60\u5728\u4e00\u4e2a\u5faa\u73af\u4e2d \u521b\u5efa\u4e86\u5c40\u90e8\u5f15\u7528\uff0c\u4f60\u901a\u5e38\u9700\u8981\u5728\u5faa\u73af\u5185\u90e8\u5220\u9664\u6389\u5b83\uff0c\u56e0\u4e3a\u7cfb\u7edf\u901a\u5e38\u53ea\u4fdd\u8bc1\u4e86 16 \u4e2a\u5c40\u90e8\u5f15\u7528 \u7684 slot \u3002\u5982\u679c\u4f60\u9700\u8981\u8d85\u8fc7 16 \u4e2a\uff0c\u4f60\u5c31\u5fc5\u987b\u5220\u9664\u4e00\u4e9blocal\u5f15\u7528\uff0c\u6216\u8005\u4f7f\u7528 EnsureLocalCapacity/PushLocalFrame \u4e3a\u5c40\u90e8\u5f15\u7528\u9884\u7559\u66f4\u591a\u7684slot\u3002</p>"},{"location":"native/JNI/Android-JNI/#412","title":"4.12 \u6210\u5bf9\u7684\u4f7f\u7528\u51fd\u6570","text":"<p>JNI\u4e2d\u6709\u4e00\u4e9b\u51fd\u6570\u662f\u9700\u8981\u6210\u5bf9\u7684\u4f7f\u7528\u7684\uff0c\u5426\u5219\u4f1a\u6709\u5185\u5b58\u6cc4\u9732\uff0c\u5e38\u7528\u7684\u6709\u4ee5\u4e0b\u8fd9\u4e9b\u3002</p> <pre><code>const char * GetStringUTFChars(jstring string, jboolean *isCopy);\nvoid ReleaseStringUTFChars(jstring string, const char *utf);\n\nNativeType *Get&lt;PrimitiveType&gt;ArrayElements(ArrayType array, jboolean *isCopy);\nvoid Release&lt;PrimitiveType&gt;ArrayElements(ArrayType array, NativeType *elems, jint mode);\n</code></pre> <p>\u524d\u9762\u8fd9\u4e00\u7ec4\u7528\u6765\u64cd\u4f5c\u5b57\u7b26\u4e32\uff0c\u540e\u9762\u8fd9\u4e00\u7ec4\u7528\u6765\u64cd\u4f5c\u6570\u7ec4\u3002</p>"},{"location":"native/JNI/Android-JNI/#_1","title":"\u53c2\u8003","text":"<p>JNI \u65b9\u6cd5\u89e3\u6790 ( JNIEnv *env \u53c2\u6570 )</p> <p>JNI \u65b9\u6cd5\u89e3\u6790 ( JNIEXPORT \u4e0e JNICALL \u5b8f\u5b9a\u4e49\u4f5c\u7528 )</p> <p>Android JNI \u4f7f\u7528\u603b\u7ed3</p> <p>Android JNI \u57fa\u672c\u64cd\u4f5c</p>"},{"location":"native/JNI/JNI-op/","title":"JNI\u4f18\u5316","text":""},{"location":"native/JNI/JNI-op/#1-c","title":"1. \u4f7f\u7528\u5171\u4eabC++ \u8fd0\u884c\u65f6\u5e93","text":"<p>\u5728NDK\u4e2d\u4f7f\u7528 C++ \u65f6\uff0c\u8bf7\u4f7f\u7528\u6700\u65b0 NDK\uff0c\u5e76\u9009\u62e9\u4f7f\u7528 libc++ \u5171\u4eabSTL \u4f5c\u4e3a C++ STL\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u591a\u4e2a so \u5171\u4eab\u4e00\u4e2a C++ STL\uff0c\u56e0\u4e3a\u4f7f\u7528\u9759\u6001STL\u5c06\u4f1a\u5728\u6bcf\u4e2a so \u5e93\u4e2d\u51fa\u73b0\u91cd\u590d\u4ee3\u7801\uff0c\u589e\u52a0\u5e94\u7528\u5927\u5c0f\uff0c\u5e76\u4e14\u7531\u4e8e\u5168\u5c40\u6570\u636e\u548c\u9759\u6001\u6784\u9020\u51fd\u6570\u5728\u5185\u7684 STL \u5c06\u540c\u65f6\u5b58\u5728\u4e8e\u4e24\u4e2a\u5e93\u4e2d\u3002\u6b64\u5e94\u7528\u7684\u8fd0\u884c\u65f6\u884c\u4e3a\u672a\u5b9a\u4e49\uff0c\u56e0\u6b64\u5728\u5b9e\u9645\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5e94\u7528\u4f1a\u7ecf\u5e38\u5d29\u6e83\u3002\u4f8b\u5982\uff1a\u5185\u5b58\u5728\u4e00\u4e2a\u5e93\u4e2d\u5206\u914d\uff0c\u800c\u5728\u53e6\u4e00\u4e2a\u5e93\u4e2d\u91ca\u653e\uff0c\u4ece\u800c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u6216\u5806\u635f\u574f\u3002</p>"},{"location":"native/JNI/JNI-op/#11","title":"1.1. \u89e3\u51b3\u65b9\u6848","text":"<ul> <li>ndk-build</li> </ul> <p>\u5728 Application.mk \u4e2d\u6dfb\u52a0</p> <pre><code>APP_STL := c++_shared\n</code></pre> <ul> <li>cmake</li> </ul> <p>\u5728 build.gradle \u4e2d\u6dfb\u52a0</p> <pre><code>externalNativeBuild {\ncmake {\narguments \"-DANDROID_STL=c++_shared\"\n}\n}\n</code></pre>"},{"location":"native/JNI/JNI-op/#12-libc_sharedso","title":"1.2. libc++_shared.so \u51b2\u7a81\u89e3\u51b3","text":"<p>\u4f7f\u7528  c++_shared \u7f16\u8bd1\u540e aar \u4e2d\u5c06\u9644\u5e26 libc++_shared.so\uff0c\u5982\u679c\u6709\u591a\u4e2aaar \u90fd\u9644\u5e26\u4e86  libc++_shared.so\uff0c\u5c06\u5bfc\u81f4APP\u5de5\u7a0b\u4e2d\u7f16\u8bd1\u4e0d\u8fc7\uff0c\u6b64\u65f6\u53ef\u4ee5\u91c7\u53d6\u4e0b\u9762\u4e24\u79cd\u529e\u6cd5\uff1a</p> <ul> <li>APP \u5de5\u7a0b\u4e2d build.gradle \u4e2d\u6dfb\u52a0\u7f16\u8bd1\u914d\u7f6e</li> </ul> <pre><code>packagingOptions {\npickFirst 'lib/*/libc++_shared.so'\n}\n</code></pre> <ul> <li>\u5728\u7f16\u8bd1 so \u5e93\u7684\u5de5\u7a0b build.gradle \u4e2d\u6dfb\u52a0\u914d\u7f6e\u6392\u9664  libc++_shared.so,  \u7531App\u5de5\u7a0b\u8d1f\u8d23\u6dfb\u52a0 libc++_shared.so \uff1a</li> </ul> <pre><code>libraryVariants.all { variant -&gt;\ndef bundleTask = variant.packageLibrary\ndef reBundleTask = tasks.create(\"reBundle${variant.name.capitalize()}Aar\", Zip) {\ndef dir = bundleTask.destinationDir\ndef path = bundleTask.archivePath\ndef name = bundleTask.archiveName\narchiveName name + \".bak\"\ndestinationDir dir\nfrom(zipTree(path)) {\nexclude \"jni/*/libc++_shared.so\"\n}\ndoLast {\ndelete path\nfile(\"$dir/$name\" + \".bak\").renameTo(path)\n}\n}\nbundleTask.finalizedBy reBundleTask\nvariant.assemble.dependsOn reBundleTask\n}\n</code></pre>"},{"location":"native/JNI/JNI-op/#2","title":"2. \u5f00\u542f\u7f16\u8bd1\u4f18\u5316","text":"<p>\u5982\u679c\u4f7f\u7528 GCC \u53ef\u4ee5 -Os \u6253\u5f00\u4f18\u5316\uff0c\u5982\u679c\u4f7f\u7528 Clang \u53ef\u4ee5 -Oz \u6253\u5f00\u4f18\u5316</p>"},{"location":"native/JNI/JNI-op/#21","title":"2.1. \u89e3\u51b3\u65b9\u6848","text":"<ul> <li>ndk-build</li> </ul> <p>\u5728 Android.mk \u4e2d\u6dfb\u52a0</p> <pre><code>LOCAL_CFLAGS += -Os -Oz\nLOCAL_CPPFLAGS += -Os -Oz\n</code></pre> <ul> <li>cmake</li> </ul> <p>\u5728 build.gradle \u4e2d\u6dfb\u52a0</p> <pre><code>externalNativeBuild {\ncmake {\ncFlags \"-Os -Oz\"\ncppFlags \"-Os -Oz\"\n}\n}\n</code></pre>"},{"location":"native/JNI/JNI-op/#3","title":"3. \u9690\u85cf\u7b26\u53f7","text":"<pre><code>-fvisibility=hidden\n</code></pre> <p>\u9690\u85cfelf\u7b26\u53f7\u8868\uff0c\u53ef\u4ee5\u51cf\u5c11 so \u6587\u4ef6\u5927\u5c0f\uff0c\u63d0\u5347\u6027\u80fd \u6ce8\u610f\uff1a\u9700\u8981\u5728\u63d0\u4f9b\u7ed9 java \u5c42\u66b4\u9732\u7684JNI\u51fd\u6570\u53ef\u4ee5 \u5728\u65b9\u6cd5\u4e0a\u6dfb\u52a0 JNIEXPORT \u5b8f\u6216\u8005\u6dfb\u52a0\u5c5e\u6027 attribute ((visibility (\"default\")))</p> <pre><code>-fvisibility-inlines-hidden\n</code></pre> <p>\u9690\u85cf\u6240\u6709\u5185\u8054\u51fd\u6570\uff0c\u4ece\u800c\u51cf\u5c0f\u5bfc\u51fa\u7b26\u53f7\u8868\u7684\u5927\u5c0f\uff0c\u65e2\u80fd\u7f29\u51cf\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u8fd8\u80fd\u63d0\u9ad8\u8fd0\u884c\u6027\u80fd</p>"},{"location":"native/JNI/JNI-op/#31","title":"3.1. \u89e3\u51b3\u65b9\u6848","text":"<ul> <li>ndk-build</li> </ul> <p>\u5728 Android.mk \u4e2d\u6dfb\u52a0</p> <pre><code>LOCAL_CFLAGS += -fvisibility=hidden\nLOCAL_CPPFLAGS += -fvisibility=hidden -fvisibility-inlines-hidden\n</code></pre> <ul> <li>cmake \u5728 build.gradle \u4e2d\u6dfb\u52a0</li> </ul> <pre><code>externalNativeBuild {\ncmake {\ncFlags \"-fvisibility=hidden\"\ncppFlags \"-fvisibility=hidden -fvisibility-inlines-hidden\"\n}\n}\n</code></pre>"},{"location":"native/JNI/JNI-op/#4","title":"4. \u5220\u9664\u65e0\u7528\u51fd\u6570","text":"<p>\u4f7f\u7528 --gc-section \u7f16\u8bd1\u9009\u9879\u51cf\u5c0f\u7a0b\u5e8f\u4f53\u79ef</p> <p>\u89e3\u51b3\u65b9\u6848</p> <ul> <li>ndk-build</li> </ul> <p>\u5728 Android.mk \u4e2d\u6dfb\u52a0</p> <pre><code>LOCAL_CPPFLAGS += -ffunction-sections -fdata-sections\nLOCAL_CFLAGS += -ffunction-sections -fdata-sections LOCAL_LDFLAGS += -Wl,--gc-sections\n</code></pre> <ul> <li>cmake</li> </ul> <p>\u5728 build.gradle \u4e2d\u6dfb\u52a0</p> <pre><code>externalNativeBuild {\ncmake {\ncFlags \"-ffunction-sections -fdata-sections\"\ncppFlags \"-ffunction-sections -fdata-sections\"\n}\n}\n</code></pre>"},{"location":"native/JNI/JNI-op/#5-rtti","title":"5. \u4e0d\u4f7f\u7528\u5f02\u5e38\u548cRTTI","text":"<p>\u5728C++ \u4e2d\u4f7f\u7528\u5f02\u5e38\u548c RTTI \u4f1a\u663e\u8457\u589e\u52a0\u6587\u4ef6\u5927\u5c0f\uff0c\u56e0\u6b64\u5c3d\u91cf\u4e0d\u8981\u5728 C++\u4e2d \u4f7f\u7528\u5f02\u5e38\u548c RTTI\uff0c\u5982\u679c\u4ee3\u7801\u4e2d\u6ca1\u6709\u4f7f\u7528\u5230 \u5f02\u5e38\u548c RTTI \u8bf7\u5220\u9664\u76f8\u5173 feature \u548c flags</p>"},{"location":"native/JNI/JNI-op/#51","title":"5.1. \u89e3\u51b3\u65b9\u6848","text":"<ul> <li>ndk-build</li> </ul> <pre><code>\u4ece LOCAL_CPP_FEATURES \u4e2d \u5220\u9664 exceptions \u548c rtti\n\u4ece APP_CPPFLAGS \u4e2d \u5220\u9664 -frtti \u548c -fexceptions\n\u4ece LOCAL_CPPFLAGS \u4e2d \u5220\u9664 -frtti \u548c -fexceptions\n</code></pre> <ul> <li>cmake</li> </ul> <pre><code>\u5220\u9664 cppFlags \"-frtti\"\n\u5220\u9664 cppFlags \"-fexceptions\"\n</code></pre>"},{"location":"native/JNI/JNI-op/#6-iostream","title":"6. \u4e0d\u4f7f\u7528iostream","text":"<p>\u5c3d\u91cf\u4e0d\u8981\u5728 C++ \u4ee3\u7801\u4e2d\u4f7f\u7528 iostream\uff0c\u5982\uff1a</p> <pre><code>#include&lt;iostream&gt;\nstd::cout &lt;&lt; \"test\" &lt;&lt;std::endl;\n</code></pre> <p>\u5176\u4ed6\u7c7b\u4f3c\u7528\u6cd5\uff1a<code>std::cin</code>\uff0c<code>std::cout</code>\uff0c<code>std::cerr</code>\uff0c<code>std::clog</code>\uff0c<code>std::wcin</code>\uff0c<code>std::wcout</code>\uff0c<code>std::wcerr</code>\uff0c<code>std::wclog</code></p> <p>\u8fd9\u6837\u6ca1\u6709\u4ec0\u4e48\u4f5c\u7528\u5e76\u4e14\u4f1a\u663e\u8457\u589e\u52a0 so \u6587\u4ef6\u5927\u5c0f</p>"},{"location":"native/JNI/JNI-op/#61","title":"6.1. \u89e3\u51b3\u65b9\u6848","text":"<p>\u5220\u9664 iostream \u76f8\u5173\u4ee3\u7801\u8c03\u7528\uff0c\u5982\u679c\u6709\u6253\u65e5\u5fd7\u9700\u8981\u53ef\u4ee5\u4f7f\u7528 __android_log_print</p> <pre><code>#define LOG_TAG \"native_log\"\n#define LOGI(...) __android_log_print(ANDROID_LOG_INFO,LOG_TAG,__VA_ARGS__)\n#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR,LOG_TAG,__VA_ARGS__)\nLOGE(\"AndroidBitmap_getInfo() failed ! error=%d\", ret);\n</code></pre>"},{"location":"native/JNI/JNI-op/#_1","title":"\u53c2\u8003","text":"<p>https://juejin.cn/post/6844903889683103757</p>"},{"location":"native/basic/C%2B%2Bbasic/","title":"C++ \u57fa\u7840\u77e5\u8bc6","text":""},{"location":"native/basic/C%2B%2Bbasic/#1","title":"1. \u8fd0\u7b97\u7b26\u91cd\u8f7d","text":"<p>\u60a8\u53ef\u4ee5\u91cd\u5b9a\u4e49\u6216\u91cd\u8f7d\u5927\u90e8\u5206 C++ \u5185\u7f6e\u7684\u8fd0\u7b97\u7b26\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u80fd\u4f7f\u7528\u81ea\u5b9a\u4e49\u7c7b\u578b\u7684\u8fd0\u7b97\u7b26\u3002</p> <p>\u91cd\u8f7d\u7684\u8fd0\u7b97\u7b26\u662f\u5e26\u6709\u7279\u6b8a\u540d\u79f0\u7684\u51fd\u6570\uff0c\u51fd\u6570\u540d\u662f\u7531\u5173\u952e\u5b57 operator \u548c\u5176\u540e\u8981\u91cd\u8f7d\u7684\u8fd0\u7b97\u7b26\u7b26\u53f7\u6784\u6210\u7684\u3002\u4e0e\u5176\u4ed6\u51fd\u6570\u4e00\u6837\uff0c\u91cd\u8f7d\u8fd0\u7b97\u7b26\u6709\u4e00\u4e2a\u8fd4\u56de\u7c7b\u578b\u548c\u4e00\u4e2a\u53c2\u6570\u5217\u8868\u3002</p> <pre><code>Box operator+(const Box&amp;);\n</code></pre> <p>\u58f0\u660e\u52a0\u6cd5\u8fd0\u7b97\u7b26\u7528\u4e8e\u628a\u4e24\u4e2a Box \u5bf9\u8c61\u76f8\u52a0\uff0c\u8fd4\u56de\u6700\u7ec8\u7684 Box \u5bf9\u8c61\u3002\u5927\u591a\u6570\u7684\u91cd\u8f7d\u8fd0\u7b97\u7b26\u53ef\u88ab\u5b9a\u4e49\u4e3a\u666e\u901a\u7684\u975e\u6210\u5458\u51fd\u6570\u6216\u8005\u88ab\u5b9a\u4e49\u4e3a\u7c7b\u6210\u5458\u51fd\u6570\u3002\u5982\u679c\u6211\u4eec\u5b9a\u4e49\u4e0a\u9762\u7684\u51fd\u6570\u4e3a\u7c7b\u7684\u975e\u6210\u5458\u51fd\u6570\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u4e3a\u6bcf\u6b21\u64cd\u4f5c\u4f20\u9012\u4e24\u4e2a\u53c2\u6570\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>Box operator+(const Box&amp;, const Box&amp;);\n</code></pre> <p>\u4e0b\u9762\u7684\u5b9e\u4f8b\u4f7f\u7528\u6210\u5458\u51fd\u6570\u6f14\u793a\u4e86\u8fd0\u7b97\u7b26\u91cd\u8f7d\u7684\u6982\u5ff5\u3002\u5728\u8fd9\u91cc\uff0c\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\uff0c\u5bf9\u8c61\u7684\u5c5e\u6027\u4f7f\u7528 this \u8fd0\u7b97\u7b26\u8fdb\u884c\u8bbf\u95ee\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nclass Box\n{\npublic:\ndouble getVolume(void)\n{\nreturn length * breadth * height;\n}\nvoid setLength( double len )\n{\nlength = len;\n}\nvoid setBreadth( double bre )\n{\nbreadth = bre;\n}\nvoid setHeight( double hei )\n{\nheight = hei;\n}\n// \u91cd\u8f7d + \u8fd0\u7b97\u7b26\uff0c\u7528\u4e8e\u628a\u4e24\u4e2a Box \u5bf9\u8c61\u76f8\u52a0\nBox operator+(const Box&amp; b)\n{\nBox box;\nbox.length = this-&gt;length + b.length;\nbox.breadth = this-&gt;breadth + b.breadth;\nbox.height = this-&gt;height + b.height;\nreturn box;\n}\nprivate:\ndouble length;      // \u957f\u5ea6\ndouble breadth;     // \u5bbd\u5ea6\ndouble height;      // \u9ad8\u5ea6\n};\n// \u7a0b\u5e8f\u7684\u4e3b\u51fd\u6570\nint main( )\n{\nBox Box1;                // \u58f0\u660e Box1\uff0c\u7c7b\u578b\u4e3a Box\nBox Box2;                // \u58f0\u660e Box2\uff0c\u7c7b\u578b\u4e3a Box\nBox Box3;                // \u58f0\u660e Box3\uff0c\u7c7b\u578b\u4e3a Box\ndouble volume = 0.0;     // \u628a\u4f53\u79ef\u5b58\u50a8\u5728\u8be5\u53d8\u91cf\u4e2d\n// Box1 \u8be6\u8ff0\nBox1.setLength(6.0); Box1.setBreadth(7.0); Box1.setHeight(5.0);\n// Box2 \u8be6\u8ff0\nBox2.setLength(12.0); Box2.setBreadth(13.0); Box2.setHeight(10.0);\n// Box1 \u7684\u4f53\u79ef\nvolume = Box1.getVolume();\ncout &lt;&lt; \"Volume of Box1 : \" &lt;&lt; volume &lt;&lt;endl;\n// Box2 \u7684\u4f53\u79ef\nvolume = Box2.getVolume();\ncout &lt;&lt; \"Volume of Box2 : \" &lt;&lt; volume &lt;&lt;endl;\n// \u628a\u4e24\u4e2a\u5bf9\u8c61\u76f8\u52a0\uff0c\u5f97\u5230 Box3\nBox3 = Box1 + Box2;\n// Box3 \u7684\u4f53\u79ef\nvolume = Box3.getVolume();\ncout &lt;&lt; \"Volume of Box3 : \" &lt;&lt; volume &lt;&lt;endl;\nreturn 0;\n}\n</code></pre> <p>\u5f53\u4e0a\u9762\u7684\u4ee3\u7801\u88ab\u7f16\u8bd1\u548c\u6267\u884c\u65f6\uff0c\u5b83\u4f1a\u4ea7\u751f\u4e0b\u5217\u7ed3\u679c\uff1a</p> <pre><code>Volume of Box1 : 210\nVolume of Box2 : 1560\nVolume of Box3 : 5400\n</code></pre>"},{"location":"native/basic/C%2B%2Bbasic/#2","title":"2. \u7c7b\u578b\u8f6c\u6362","text":"<p>C++ \u5f15\u5165\u65b0\u7684\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u673a\u5236\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u514b\u670dC\u8bed\u8a00\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u7684\u4ee5\u4e0b\u7f3a\u70b9\uff1a</p> <ul> <li>\u8f6c\u6362\u592a\u8fc7\u968f\u610f\uff0c\u53ef\u4ee5\u5728\u4efb\u610f\u7c7b\u578b\u4e4b\u95f4\u8f6c\u6362\u3002</li> <li>\u6ca1\u6709\u7edf\u4e00\u7684\u5173\u952e\u5b57\u548c\u6807\u793a\u7b26\u3002\u5bf9\u4e8e\u5927\u578b\u7cfb\u7edf\uff0c\u505a\u4ee3\u7801\u6392\u67e5\u65f6\u5bb9\u6613\u9057\u6f0f\u548c\u5ffd\u7565</li> </ul> <p>C \u98ce\u683c\u7684\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u5f88\u7b80\u5355\uff0c\u4e0d\u7ba1\u4ec0\u4e48\u7c7b\u578b\u7684\u8f6c\u6362\u7edf\u7edf\u662f\uff1aType b = (Type)a</p> <p>C++ \u5f15\u5165\u4e86\u56db\u79cd\u529f\u80fd\u4e0d\u540c\u7684\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u8fd0\u7b97\u7b26\u4ee5\u8fdb\u884c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff1a<code>static_cast</code>\u3001<code>reinterpret_cast</code>\u3001<code>const_cast</code> \u548c <code>dynamic_cast</code>\uff0c\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u8fd0\u7b97\u7b26 &lt;\u8981\u8f6c\u6362\u5230\u7684\u7c7b\u578b&gt; (\u5f85\u8f6c\u6362\u7684\u8868\u8fbe\u5f0f)\n</code></pre> <ul> <li><code>const_cast &lt;type&gt; (expr)</code>: const_cast \u8fd0\u7b97\u7b26\u7528\u4e8e\u4fee\u6539\u7c7b\u578b\u7684 const / volatile \u5c5e\u6027\u3002\u9664\u4e86 const \u6216 volatile \u5c5e\u6027\u4e4b\u5916\uff0c\u76ee\u6807\u7c7b\u578b\u5fc5\u987b\u4e0e\u6e90\u7c7b\u578b\u76f8\u540c\u3002\u8fd9\u79cd\u7c7b\u578b\u7684\u8f6c\u6362\u4e3b\u8981\u662f\u7528\u6765\u64cd\u4f5c\u6240\u4f20\u5bf9\u8c61\u7684 const \u5c5e\u6027\uff0c\u53ef\u4ee5\u52a0\u4e0a const \u5c5e\u6027\uff0c\u4e5f\u53ef\u4ee5\u53bb\u6389 const \u5c5e\u6027\u3002</li> <li><code>dynamic_cast&lt;type&gt; (expr)</code>: dynamic_cast \u5728\u8fd0\u884c\u65f6\u6267\u884c\u8f6c\u6362\uff0c\u9a8c\u8bc1\u8f6c\u6362\u7684\u6709\u6548\u6027\u3002\u5982\u679c\u8f6c\u6362\u672a\u6267\u884c\uff0c\u5219\u8f6c\u6362\u5931\u8d25\uff0c\u8868\u8fbe\u5f0f expr \u88ab\u5224\u5b9a\u4e3a null\u3002dynamic_cast \u6267\u884c\u52a8\u6001\u8f6c\u6362\u65f6\uff0ctype \u5fc5\u987b\u662f\u7c7b\u7684\u6307\u9488\u3001\u7c7b\u7684\u5f15\u7528\u6216\u8005 void*\uff0c\u5982\u679c type \u662f\u7c7b\u6307\u9488\u7c7b\u578b\uff0c\u90a3\u4e48 expr \u4e5f\u5fc5\u987b\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u5982\u679c type \u662f\u4e00\u4e2a\u5f15\u7528\uff0c\u90a3\u4e48 expr \u4e5f\u5fc5\u987b\u662f\u4e00\u4e2a\u5f15\u7528\u3002</li> <li><code>reinterpret_cast&lt;type&gt; (expr)</code>: reinterpret_cast \u8fd0\u7b97\u7b26\u628a\u67d0\u79cd\u6307\u9488\u6539\u4e3a\u5176\u4ed6\u7c7b\u578b\u7684\u6307\u9488\u3002\u5b83\u53ef\u4ee5\u628a\u4e00\u4e2a\u6307\u9488\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6574\u6570\uff0c\u4e5f\u53ef\u4ee5\u628a\u4e00\u4e2a\u6574\u6570\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6307\u9488\u3002</li> <li><code>static_cast&lt;type&gt; (expr)</code>: static_cast \u8fd0\u7b97\u7b26\u6267\u884c\u975e\u52a8\u6001\u8f6c\u6362\uff0c\u6ca1\u6709\u8fd0\u884c\u65f6\u7c7b\u68c0\u67e5\u6765\u4fdd\u8bc1\u8f6c\u6362\u7684\u5b89\u5168\u6027\u3002\u4f8b\u5982\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u628a\u4e00\u4e2a\u57fa\u7c7b\u6307\u9488\u8f6c\u6362\u4e3a\u6d3e\u751f\u7c7b\u6307\u9488\u3002</li> </ul>"},{"location":"native/basic/C%2B%2Bbasic/#3","title":"3. \u5f15\u7528","text":"<p>\u5f15\u7528\u53d8\u91cf\u662f\u4e00\u4e2a\u522b\u540d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u662f\u67d0\u4e2a\u5df2\u5b58\u5728\u53d8\u91cf\u7684\u53e6\u4e00\u4e2a\u540d\u5b57\u3002\u4e00\u65e6\u628a\u5f15\u7528\u521d\u59cb\u5316\u4e3a\u67d0\u4e2a\u53d8\u91cf\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u8be5\u5f15\u7528\u540d\u79f0\u6216\u53d8\u91cf\u540d\u79f0\u6765\u6307\u5411\u53d8\u91cf\u3002</p>"},{"location":"native/basic/C%2B%2Bbasic/#31-vs","title":"3.1 \u5f15\u7528 vs \u6307\u9488","text":"<p>\u7528\u5f88\u5bb9\u6613\u4e0e\u6307\u9488\u6df7\u6dc6\uff0c\u5b83\u4eec\u4e4b\u95f4\u6709\u4e09\u4e2a\u4e3b\u8981\u7684\u4e0d\u540c\uff1a</p> <ul> <li>\u4e0d\u5b58\u5728\u7a7a\u5f15\u7528\u3002\u5f15\u7528\u5fc5\u987b\u8fde\u63a5\u5230\u4e00\u5757\u5408\u6cd5\u7684\u5185\u5b58\u3002</li> <li>\u4e00\u65e6\u5f15\u7528\u88ab\u521d\u59cb\u5316\u4e3a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5c31\u4e0d\u80fd\u88ab\u6307\u5411\u5230\u53e6\u4e00\u4e2a\u5bf9\u8c61\u3002\u6307\u9488\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u6307\u5411\u5230\u53e6\u4e00\u4e2a\u5bf9\u8c61\u3002</li> <li>\u5f15\u7528\u5fc5\u987b\u5728\u521b\u5efa\u65f6\u88ab\u521d\u59cb\u5316\u3002\u6307\u9488\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u95f4\u88ab\u521d\u59cb\u5316\u3002</li> </ul> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main ()\n{\n// \u58f0\u660e\u7b80\u5355\u7684\u53d8\u91cf\nint    i;\ndouble d;\n// \u58f0\u660e\u5f15\u7528\u53d8\u91cf\nint&amp;    r = i;\ndouble&amp; s = d;\ni = 5;\ncout &lt;&lt; \"Value of i : \" &lt;&lt; i &lt;&lt; endl;\ncout &lt;&lt; \"Value of i reference : \" &lt;&lt; r  &lt;&lt; endl;\nd = 11.7;\ncout &lt;&lt; \"Value of d : \" &lt;&lt; d &lt;&lt; endl;\ncout &lt;&lt; \"Value of d reference : \" &lt;&lt; s  &lt;&lt; endl;\nreturn 0;\n}\n</code></pre> <p>\u5f53\u4e0a\u9762\u7684\u4ee3\u7801\u88ab\u7f16\u8bd1\u548c\u6267\u884c\u65f6\uff0c\u5b83\u4f1a\u4ea7\u751f\u4e0b\u5217\u7ed3\u679c\uff1a</p> <pre><code>Value of i : 5\nValue of i reference : 5\nValue of d : 11.7\nValue of d reference : 11.7\n</code></pre>"},{"location":"native/basic/Cbasic/","title":"C \u57fa\u7840\u77e5\u8bc6","text":""},{"location":"native/basic/Cbasic/#1","title":"1. \u6307\u9488","text":"<p>\u6307\u9488\u4e5f\u5c31\u662f\u5185\u5b58\u5730\u5740\uff0c\u6307\u9488\u53d8\u91cf\u662f\u7528\u6765\u5b58\u653e\u5185\u5b58\u5730\u5740\u7684\u53d8\u91cf\u3002\u5c31\u50cf\u5176\u4ed6\u53d8\u91cf\u6216\u5e38\u91cf\u4e00\u6837\uff0c\u60a8\u5fc5\u987b\u5728\u4f7f\u7528\u6307\u9488\u5b58\u50a8\u5176\u4ed6\u53d8\u91cf\u5730\u5740\u4e4b\u524d\uff0c\u5bf9\u5176\u8fdb\u884c\u58f0\u660e\u3002\u6307\u9488\u53d8\u91cf\u58f0\u660e\u7684\u4e00\u822c\u5f62\u5f0f\u4e3a\uff1a</p> <pre><code>type *var-name;\n</code></pre>"},{"location":"native/basic/Cbasic/#11","title":"1.1 \u51fd\u6570\u6307\u9488","text":"<p>\u51fd\u6570\u6307\u9488\u662f\u6307\u6307\u5411\u51fd\u6570\u7684\u6307\u9488\u53d8\u91cf</p> <pre><code>typedef int (*fun_ptr)(int,int); // \u58f0\u660e\u4e00\u4e2a\u6307\u5411\u540c\u6837\u53c2\u6570\u3001\u8fd4\u56de\u503c\u7684\u51fd\u6570\u6307\u9488\u7c7b\u578b\n</code></pre>"},{"location":"native/basic/Cbasic/#_1","title":"\u5b9e\u4f8b","text":"<pre><code>#include &lt;iostream&gt;\n#include &lt;stdio.h&gt;\nint max(int x, int y)\n{\nreturn x &gt; y ? x : y;\n}\nint main(void)\n{\n/* p \u662f\u51fd\u6570\u6307\u9488 */\nint (*p)(int, int) = &amp;max; // &amp;\u53ef\u4ee5\u7701\u7565\nint a, b, c, d;\nprintf(\"\u8bf7\u8f93\u5165\u4e09\u4e2a\u6570\u5b57:\");\nscanf_s(\"%d %d %d\", &amp;a, &amp;b, &amp;c);\n/* \u4e0e\u76f4\u63a5\u8c03\u7528\u51fd\u6570\u7b49\u4ef7\uff0cd = max(max(a, b), c) */\nd = p(p(a, b), c);\nprintf(\"\u6700\u5927\u7684\u6570\u5b57\u662f: %d\\n\", d);\nreturn 0;\n}\n</code></pre> <p>\u7f16\u8bd1\u6267\u884c\uff0c\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u8bf7\u8f93\u5165\u4e09\u4e2a\u6570\u5b57:1 2 3\n\u6700\u5927\u7684\u6570\u5b57\u662f: 3\n</code></pre>"},{"location":"native/basic/Cbasic/#12","title":"1.2 \u6307\u9488\u51fd\u6570","text":"<p>\u6307\u9488\u51fd\u6570\u662f\u6307\u5e26\u6307\u9488\u7684\u51fd\u6570\uff0c\u672c\u8d28\u662f\u4e00\u4e2a\u51fd\u6570\u3002\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u662f\u67d0\u4e00\u7c7b\u578b\u7684\u6307\u9488</p> <pre><code>typedef  *fun_ptr(int,int); </code></pre>"},{"location":"native/basic/Cbasic/#_2","title":"\u5b9e\u4f8b","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n#include &lt;stdlib.h&gt; /* \u8981\u751f\u6210\u548c\u8fd4\u56de\u968f\u673a\u6570\u7684\u51fd\u6570 */\nint * getRandom( )\n{\nstatic int  r[10];\nint i;\n/* \u8bbe\u7f6e\u79cd\u5b50 */\nsrand( (unsigned)time( NULL ) );\nfor ( i = 0; i &lt; 10; ++i)\n{\nr[i] = rand();\nprintf(\"%d\\n\", r[i] );\n}\nreturn r;\n}\n/* \u8981\u8c03\u7528\u4e0a\u9762\u5b9a\u4e49\u51fd\u6570\u7684\u4e3b\u51fd\u6570 */\nint main ()\n{\n/* \u4e00\u4e2a\u6307\u5411\u6574\u6570\u7684\u6307\u9488 */\nint *p;\nint i;\np = getRandom();\nfor ( i = 0; i &lt; 10; i++ )\n{\nprintf(\"*(p + [%d]) : %d\\n\", i, *(p + i) );\n}\nreturn 0;\n}\n</code></pre> <p>\u7f16\u8bd1\u6267\u884c\uff0c\u8f93\u51fa\u5982\u4e0b\u201c</p> <pre><code>16562\n22027\n2149\n13523\n21768\n29726\n1835\n28355\n16562\n12275\n*(p + [0]) : 16562\n*(p + [1]) : 22027\n*(p + [2]) : 2149\n*(p + [3]) : 13523\n*(p + [4]) : 21768\n*(p + [5]) : 29726\n*(p + [6]) : 1835\n*(p + [7]) : 28355\n*(p + [8]) : 16562\n*(p + [9]) : 12275\n</code></pre>"},{"location":"native/basic/Cbasic/#13","title":"1.3 \u6570\u7ec4\u6307\u9488(\u884c\u6307\u9488)","text":"<p>\u6570\u7ec4\u6307\u9488\uff0c\u6307\u7684\u662f\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\uff0c\u5373\u6570\u7ec4\u9996\u5143\u7d20\u5730\u5740\u7684\u6307\u9488\u3002</p> <pre><code>typedef (*p)[n]; </code></pre>"},{"location":"native/basic/Cbasic/#_3","title":"\u5b9e\u4f8b","text":"<pre><code>int a[3][4]\nint (*p)[4]; //\u8be5\u8bed\u53e5\u662f\u5b9a\u4e49\u4e00\u4e2a\u6570\u7ec4\u6307\u9488\uff0c\u6307\u5411\u542b4\u4e2a\u5143\u7d20\u7684\u4e00\u7ef4\u6570\u7ec4\np = a; //\u5c06\u8be5\u4e8c\u7ef4\u6570\u7ec4\u7684\u9996\u5730\u5740\u8d4b\u7ed9p\uff0c\u4e5f\u5c31\u662fa[0]\u6216&amp;a[0][0]\np++; //\u8be5\u8bed\u53e5\u6267\u884c\u8fc7\u540e\uff0c\u4e5f\u5c31\u662fp=p+1;\u8de8\u8fc7\u884ca[0][]\u6307\u5411\u4e86\u884ca[1][]\n</code></pre>"},{"location":"native/basic/Cbasic/#2","title":"2. \u7ed3\u6784\u4f53","text":"<p>\u7ed3\u6784\u4f53 \u662f C \u7f16\u7a0b\u4e2d\u53e6\u4e00\u79cd\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u53ef\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5b83\u5141\u8bb8\u60a8\u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u9879\u3002\u4e3a\u4e86\u5b9a\u4e49\u7ed3\u6784\uff0c\u60a8\u5fc5\u987b\u4f7f\u7528 struct \u8bed\u53e5\u3002struct \u8bed\u53e5\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5305\u542b\u591a\u4e2a\u6210\u5458\u7684\u65b0\u7684\u6570\u636e\u7c7b\u578b\uff0cstruct \u8bed\u53e5\u7684\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>struct tag { member-list\nmember-list member-list  ...\n} variable-list ;\n</code></pre> <p>tag \u662f\u7ed3\u6784\u4f53\u6807\u7b7e\u3002</p> <p>member-list \u662f\u6807\u51c6\u7684\u53d8\u91cf\u5b9a\u4e49\uff0c\u6bd4\u5982 int i; \u6216\u8005 float f\uff0c\u6216\u8005\u5176\u4ed6\u6709\u6548\u7684\u53d8\u91cf\u5b9a\u4e49\u3002</p> <p>variable-list \u7ed3\u6784\u53d8\u91cf\uff0c\u5b9a\u4e49\u5728\u7ed3\u6784\u7684\u672b\u5c3e\uff0c\u6700\u540e\u4e00\u4e2a\u5206\u53f7\u4e4b\u524d\uff0c\u60a8\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u7ed3\u6784\u53d8\u91cf\u3002</p>"},{"location":"native/basic/Cbasic/#21","title":"2.1 \u7ed3\u6784\u4f53\u5927\u5c0f","text":""},{"location":"native/basic/Cbasic/#_4","title":"\u5185\u5b58\u5bf9\u9f50","text":"<pre><code>/32\u4f4d\u7cfb\u7edf\n#include&lt;stdio.h&gt;\nstruct{\nint x;\nchar y;\n}s;\nint main()\n{\nprintf(\"%d\\n\",sizeof(s);  // \u8f93\u51fa8\nreturn 0;\n}\n</code></pre> <p>\u73b0\u4ee3\u8ba1\u7b97\u673a\u4e2d\u5185\u5b58\u7a7a\u95f4\u90fd\u662f\u6309\u7167 byte \u5212\u5206\u7684\uff0c\u4ece\u7406\u8bba\u4e0a\u8bb2\u4f3c\u4e4e\u5bf9\u4efb\u4f55\u7c7b\u578b\u7684\u53d8\u91cf\u7684\u8bbf\u95ee\u53ef\u4ee5\u4ece\u4efb\u4f55\u5730\u5740\u5f00\u59cb\uff0c\u4f46\u662f\u5b9e\u9645\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u5bf9\u57fa\u672c\u7c7b\u578b\u6570\u636e\u5728\u5185\u5b58\u4e2d\u5b58\u653e\u7684\u4f4d\u7f6e\u6709\u9650\u5236\uff0c\u5b83\u4eec\u4f1a\u8981\u6c42\u8fd9\u4e9b\u6570\u636e\u7684\u9996\u5730\u5740\u7684\u503c\u662f\u67d0\u4e2a\u6570k\uff08\u901a\u5e38\u5b83\u4e3a4\u62168\uff09\u7684\u500d\u6570\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u5185\u5b58\u5bf9\u9f50\u3002</p>"},{"location":"native/basic/Cbasic/#_5","title":"\u5185\u5b58\u5bf9\u9f50\u89c4\u5219","text":"<p>\u6bcf\u4e2a\u7279\u5b9a\u5e73\u53f0\u4e0a\u7684\u7f16\u8bd1\u5668\u90fd\u6709\u81ea\u5df1\u7684\u9ed8\u8ba4\u201c\u5bf9\u9f50\u7cfb\u6570\u201d\uff08\u4e5f\u53eb\u5bf9\u9f50\u6a21\u6570\uff09\u3002gcc\u4e2d\u9ed8\u8ba4#pragma pack(4)\uff0c\u53ef\u4ee5\u901a\u8fc7\u9884\u7f16\u8bd1\u547d\u4ee4#pragma pack(n)\uff0cn = 1,2,4,8,16\u6765\u6539\u53d8\u8fd9\u4e00\u7cfb\u6570\u3002</p> <p>\u6709\u6548\u5bf9\u5176\u503c\uff1a\u662f\u7ed9\u5b9a\u503c#pragma pack(n)\u548c\u7ed3\u6784\u4f53\u4e2d\u6700\u957f\u6570\u636e\u7c7b\u578b\u957f\u5ea6\u4e2d\u8f83\u5c0f\u7684\u90a3\u4e2a\u3002\u6709\u6548\u5bf9\u9f50\u503c\u4e5f\u53eb \u5bf9\u9f50\u5355\u4f4d\u3002</p> <p>\u4e86\u89e3\u4e86\u4e0a\u9762\u7684\u6982\u5ff5\u540e\uff0c\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u6765\u770b\u770b\u5185\u5b58\u5bf9\u9f50\u9700\u8981\u9075\u5faa\u7684\u89c4\u5219\uff1a</p> <p>(1) \u7ed3\u6784\u4f53\u7b2c\u4e00\u4e2a\u6210\u5458\u7684 \u504f\u79fb\u91cf\uff08offset\uff09 \u4e3a0\uff0c\u4ee5\u540e\u6bcf\u4e2a\u6210\u5458\u76f8\u5bf9\u4e8e\u7ed3\u6784\u4f53\u9996\u5730\u5740\u7684 offset \u90fd\u662f \u8be5\u6210\u5458\u5927\u5c0f\u4e0e\u6709\u6548\u5bf9\u9f50\u503c\u4e2d\u8f83\u5c0f\u90a3\u4e2a \u7684\u6574\u6570\u500d\uff0c\u5982\u6709\u9700\u8981\u7f16\u8bd1\u5668\u4f1a\u5728\u6210\u5458\u4e4b\u95f4\u52a0\u4e0a\u586b\u5145\u5b57\u8282\u3002</p> <p>(3)  \u7ed3\u6784\u4f53\u7684\u603b\u5927\u5c0f \u4e3a \u6709\u6548\u5bf9\u9f50\u503c \u7684 \u6574\u6570\u500d \uff0c\u5982\u6709\u9700\u8981\u7f16\u8bd1\u5668\u4f1a\u5728\u6700\u672b\u4e00\u4e2a\u6210\u5458\u4e4b\u540e\u52a0\u4e0a\u586b\u5145\u5b57\u8282\u3002</p> <pre><code>//32\u4f4d\u7cfb\u7edf\n#include&lt;stdio.h&gt;\nstruct\n{\nint i;    char c1;  char c2;  }x1;\nstruct{\nchar c1;  int i;    char c2;  }x2;\nstruct{\nchar c1;  char c2; int i;    }x3;\nint main()\n{\nprintf(\"%d\\n\",sizeof(x1));  // \u8f93\u51fa8\nprintf(\"%d\\n\",sizeof(x2));  // \u8f93\u51fa12\nprintf(\"%d\\n\",sizeof(x3));  // \u8f93\u51fa8\nreturn 0;\n}\n</code></pre> <p>\u4e0a\u9762\u4f8b\u5b50\u4e09\u4e2a\u7ed3\u6784\u4f53\u7684\u5185\u5b58\u5e03\u5c40\u5982\u4e0b\uff1a</p> <p></p> <p>\u5f53\u7ed3\u6784\u4f53\u9700\u8981\u5185\u5b58\u8fc7\u5927\uff0c\u4f7f\u7528\u52a8\u6001\u5185\u5b58\u7533\u8bf7\u3002\u7ed3\u6784\u4f53\u5360\u7528\u5b57\u8282\u6570\u548c\u7ed3\u6784\u4f53\u5185\u5b57\u6bb5\u6709\u5173\uff0c\u6307\u9488\u5360\u7528\u5185\u5b58\u5c31\u662f4/8\u5b57\u8282\uff0c\u56e0\u6b64\u4f20\u6307\u9488\u6bd4\u4f20\u503c\u6548\u679c\u66f4\u9ad8</p>"},{"location":"native/basic/Cplus_auto/","title":"C++ auto\u7c7b\u578b\u63a8\u5bfc\u5b8c\u5168\u653b\u7565","text":"<p>\u5728 C++11 \u4e4b\u524d\u7684\u7248\u672c\uff08C++98 \u548c C++ 03\uff09\u4e2d\uff0c\u5b9a\u4e49\u53d8\u91cf\u6216\u8005\u58f0\u660e\u53d8\u91cf\u4e4b\u524d\u90fd\u5fc5\u987b\u6307\u660e\u5b83\u7684\u7c7b\u578b\uff0c\u6bd4\u5982 int\u3001char \u7b49\uff1b\u4f46\u662f\u5728\u4e00\u4e9b\u6bd4\u8f83\u7075\u6d3b\u7684\u8bed\u8a00\u4e2d\uff0c\u6bd4\u5982 C#\u3001JavaScript\u3001PHP\u3001Python \u7b49\uff0c\u7a0b\u5e8f\u5458\u5728\u5b9a\u4e49\u53d8\u91cf\u65f6\u53ef\u4ee5\u4e0d\u6307\u660e\u5177\u4f53\u7684\u7c7b\u578b\uff0c\u800c\u662f\u8ba9\u7f16\u8bd1\u5668\uff08\u6216\u8005\u89e3\u91ca\u5668\uff09\u81ea\u5df1\u53bb\u63a8\u5bfc\uff0c\u8fd9\u5c31\u8ba9\u4ee3\u7801\u7684\u7f16\u5199\u66f4\u52a0\u65b9\u4fbf\u3002</p> <p>C++11 \u4e3a\u4e86\u987a\u5e94\u8fd9\u79cd\u8d8b\u52bf\u4e5f\u5f00\u59cb\u652f\u6301\u81ea\u52a8\u7c7b\u578b\u63a8\u5bfc\u4e86\uff01C++11 \u4f7f\u7528 auto \u5173\u952e\u5b57\u6765\u652f\u6301\u81ea\u52a8\u7c7b\u578b\u63a8\u5bfc\u3002</p>"},{"location":"native/basic/Cplus_auto/#auto","title":"auto \u7c7b\u578b\u63a8\u5bfc\u7684\u8bed\u6cd5\u548c\u89c4\u5219","text":"<p>\u5728\u4e4b\u524d\u7684 C++ \u7248\u672c\u4e2d\uff0cauto \u5173\u952e\u5b57\u7528\u6765\u6307\u660e\u53d8\u91cf\u7684\u5b58\u50a8\u7c7b\u578b\uff0c\u5b83\u548c static \u5173\u952e\u5b57\u662f\u76f8\u5bf9\u7684\u3002auto \u8868\u793a\u53d8\u91cf\u662f\u81ea\u52a8\u5b58\u50a8\u7684\uff0c\u8fd9\u4e5f\u662f\u7f16\u8bd1\u5668\u7684\u9ed8\u8ba4\u89c4\u5219\uff0c\u6240\u4ee5\u5199\u4e0d\u5199\u90fd\u4e00\u6837\uff0c\u4e00\u822c\u6211\u4eec\u4e5f\u4e0d\u5199\uff0c\u8fd9\u4f7f\u5f97 auto \u5173\u952e\u5b57\u7684\u5b58\u5728\u53d8\u5f97\u975e\u5e38\u9e21\u808b\u3002</p> <p>C++11 \u8d4b\u4e88 auto \u5173\u952e\u5b57\u65b0\u7684\u542b\u4e49\uff0c\u4f7f\u7528\u5b83\u6765\u505a\u81ea\u52a8\u7c7b\u578b\u63a8\u5bfc\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f7f\u7528\u4e86 auto \u5173\u952e\u5b57\u4ee5\u540e\uff0c\u7f16\u8bd1\u5668\u4f1a\u5728\u7f16\u8bd1\u671f\u95f4\u81ea\u52a8\u63a8\u5bfc\u51fa\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u4e0d\u7528\u624b\u52a8\u6307\u660e\u53d8\u91cf\u7684\u6570\u636e\u7c7b\u578b\u4e86\u3002</p> <p>auto \u5173\u952e\u5b57\u57fa\u672c\u7684\u4f7f\u7528\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>auto name = value;\n</code></pre> <p>name \u662f\u53d8\u91cf\u7684\u540d\u5b57\uff0cvalue \u662f\u53d8\u91cf\u7684\u521d\u59cb\u503c\u3002</p> <p>\u6ce8\u610f\uff1aauto \u4ec5\u4ec5\u662f\u4e00\u4e2a\u5360\u4f4d\u7b26\uff0c\u5728\u7f16\u8bd1\u5668\u671f\u95f4\u5b83\u4f1a\u88ab\u771f\u6b63\u7684\u7c7b\u578b\u6240\u66ff\u4ee3\u3002\u6216\u8005\u8bf4\uff0cC++ \u4e2d\u7684\u53d8\u91cf\u5fc5\u987b\u662f\u6709\u660e\u786e\u7c7b\u578b\u7684\uff0c\u53ea\u662f\u8fd9\u4e2a\u7c7b\u578b\u662f\u7531\u7f16\u8bd1\u5668\u81ea\u5df1\u63a8\u5bfc\u51fa\u6765\u7684\u3002</p> <p>auto \u7c7b\u578b\u63a8\u5bfc\u7684\u7b80\u5355\u4f8b\u5b50\uff1a</p> <pre><code>auto n = 10;\nauto f = 12.8;\nauto p = &amp;n;\nauto url = \"http://c.biancheng.net/cplus/\";\n</code></pre> <p>\u4e0b\u9762\u6211\u4eec\u6765\u89e3\u91ca\u4e00\u4e0b\uff1a</p> <ul> <li>\u7b2c 1 \u884c\u4e2d\uff0c10 \u662f\u4e00\u4e2a\u6574\u6570\uff0c\u9ed8\u8ba4\u662f int \u7c7b\u578b\uff0c\u6240\u4ee5\u63a8\u5bfc\u51fa\u53d8\u91cf n \u7684\u7c7b\u578b\u662f int\u3002</li> <li>\u7b2c 2 \u884c\u4e2d\uff0c12.8 \u662f\u4e00\u4e2a\u5c0f\u6570\uff0c\u9ed8\u8ba4\u662f double \u7c7b\u578b\uff0c\u6240\u4ee5\u63a8\u5bfc\u51fa\u53d8\u91cf f \u7684\u7c7b\u578b\u662f double\u3002</li> <li>\u7b2c 3 \u884c\u4e2d\uff0c&amp;n \u7684\u7ed3\u679c\u662f\u4e00\u4e2a int* \u7c7b\u578b\u7684\u6307\u9488\uff0c\u6240\u4ee5\u63a8\u5bfc\u51fa\u53d8\u91cf p \u7684\u7c7b\u578b\u662f int*\u3002</li> <li>\u7b2c 4 \u884c\u4e2d\uff0c\u7531\u53cc\u5f15\u53f7<code>\"\"</code>\u5305\u56f4\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u662f const char* \u7c7b\u578b\uff0c\u6240\u4ee5\u63a8\u5bfc\u51fa\u53d8\u91cf url \u7684\u7c7b\u578b\u662f const char*\uff0c\u4e5f\u5373\u4e00\u4e2a\u5e38\u91cf\u6307\u9488\u3002</li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u8fde\u7eed\u5b9a\u4e49\u591a\u4e2a\u53d8\u91cf\uff1a</p> <pre><code>int n = 20;\nauto *p = &amp;n, m = 99;\n</code></pre> <p>\u5148\u770b\u524d\u9762\u7684\u7b2c\u4e00\u4e2a\u5b50\u8868\u8fbe\u5f0f\uff0c&amp;n \u7684\u7c7b\u578b\u662f int*\uff0c\u7f16\u8bd1\u5668\u4f1a\u6839\u636e auto *p \u63a8\u5bfc\u51fa auto \u4e3a int\u3002\u540e\u9762\u7684 m \u53d8\u91cf\u81ea\u7136\u4e5f\u4e3a int \u7c7b\u578b\uff0c\u6240\u4ee5\u628a 99 \u8d4b\u503c\u7ed9\u5b83\u4e5f\u662f\u6b63\u786e\u7684\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u8981\u6ce8\u610f\uff0c\u63a8\u5bfc\u7684\u65f6\u5019\u4e0d\u80fd\u6709\u4e8c\u4e49\u6027\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u7f16\u8bd1\u5668\u6839\u636e\u7b2c\u4e00\u4e2a\u5b50\u8868\u8fbe\u5f0f\u5df2\u7ecf\u63a8\u5bfc\u51fa auto \u4e3a int \u7c7b\u578b\uff0c\u90a3\u4e48\u540e\u9762\u7684 m \u4e5f\u53ea\u80fd\u662f int \u7c7b\u578b\uff0c\u5982\u679c\u5199\u4f5c<code>m=12.5</code>\u5c31\u662f\u9519\u8bef\u7684\uff0c\u56e0\u4e3a 12.5 \u662fdouble \u7c7b\u578b\uff0c\u8fd9\u548c int \u662f\u51b2\u7a81\u7684\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a\u503c\u5f97\u6ce8\u610f\u7684\u5730\u65b9\u662f\uff1a\u4f7f\u7528 auto \u7c7b\u578b\u63a8\u5bfc\u7684\u53d8\u91cf\u5fc5\u987b\u9a6c\u4e0a\u521d\u59cb\u5316\uff0c\u8fd9\u4e2a\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u56e0\u4e3a auto \u5728 C++11 \u4e2d\u53ea\u662f\u201c\u5360\u4f4d\u7b26\u201d\uff0c\u5e76\u975e\u5982 int \u4e00\u6837\u7684\u771f\u6b63\u7684\u7c7b\u578b\u58f0\u660e\u3002</p>"},{"location":"native/basic/Cplus_auto/#auto_1","title":"auto \u7684\u9ad8\u7ea7\u7528\u6cd5","text":"<p>auto \u9664\u4e86\u53ef\u4ee5\u72ec\u7acb\u4f7f\u7528\uff0c\u8fd8\u53ef\u4ee5\u548c\u67d0\u4e9b\u5177\u4f53\u7c7b\u578b\u6df7\u5408\u4f7f\u7528\uff0c\u8fd9\u6837 auto \u8868\u793a\u7684\u5c31\u662f\u201c\u534a\u4e2a\u201d\u7c7b\u578b\uff0c\u800c\u4e0d\u662f\u5b8c\u6574\u7684\u7c7b\u578b\u3002\u8bf7\u770b\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>int  x = 0;\nauto *p1 = &amp;x;   //p1 \u4e3a int *\uff0cauto \u63a8\u5bfc\u4e3a int\nauto  p2 = &amp;x;   //p2 \u4e3a int*\uff0cauto \u63a8\u5bfc\u4e3a int*\nauto &amp;r1  = x;   //r1 \u4e3a int&amp;\uff0cauto \u63a8\u5bfc\u4e3a int\nauto r2 = r1;    //r2 \u4e3a  int\uff0cauto \u63a8\u5bfc\u4e3a int\n</code></pre> <p>\u4e0b\u9762\u6211\u4eec\u6765\u89e3\u91ca\u4e00\u4e0b\uff1a</p> <ul> <li>\u7b2c 2 \u884c\u4ee3\u7801\u4e2d\uff0cp1 \u4e3a int* \u7c7b\u578b\uff0c\u4e5f\u5373 auto * \u4e3a int *\uff0c\u6240\u4ee5 auto \u88ab\u63a8\u5bfc\u6210\u4e86 int \u7c7b\u578b\u3002</li> <li>\u7b2c 3 \u884c\u4ee3\u7801\u4e2d\uff0cauto \u88ab\u63a8\u5bfc\u4e3a int* \u7c7b\u578b\uff0c\u524d\u8fb9\u7684\u4f8b\u5b50\u4e5f\u5df2\u7ecf\u6f14\u793a\u8fc7\u4e86\u3002</li> <li>\u7b2c 4 \u884c\u4ee3\u7801\u4e2d\uff0cr1 \u4e3a int &amp; \u7c7b\u578b\uff0cauto \u88ab\u63a8\u5bfc\u4e3a int \u7c7b\u578b\u3002</li> <li>\u7b2c 5 \u884c\u4ee3\u7801\u662f\u9700\u8981\u91cd\u70b9\u8bf4\u660e\u7684\uff0cr1 \u672c\u6765\u662f int&amp; \u7c7b\u578b\uff0c\u4f46\u662f auto \u5374\u88ab\u63a8\u5bfc\u4e3a int \u7c7b\u578b\uff0c\u8fd9\u8868\u660e\u5f53<code>=</code>\u53f3\u8fb9\u7684\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u5f15\u7528\u7c7b\u578b\u65f6\uff0cauto \u4f1a\u628a\u5f15\u7528\u629b\u5f03\uff0c\u76f4\u63a5\u63a8\u5bfc\u51fa\u5b83\u7684\u539f\u59cb\u7c7b\u578b\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e0b auto \u548c const \u7684\u7ed3\u5408\uff1a</p> <pre><code>int  x = 0;\nauto *p1 = &amp;x;   //p1 \u4e3a int *\uff0cauto \u63a8\u5bfc\u4e3a int\nauto  p2 = &amp;x;   //p2 \u4e3a int*\uff0cauto \u63a8\u5bfc\u4e3a int*\nauto &amp;r1  = x;   //r1 \u4e3a int&amp;\uff0cauto \u63a8\u5bfc\u4e3a int\nauto r2 = r1;    //r2 \u4e3a  int\uff0cauto \u63a8\u5bfc\u4e3a int\n</code></pre> <p>\u4e0b\u9762\u6211\u4eec\u6765\u89e3\u91ca\u4e00\u4e0b\uff1a</p> <ul> <li>\u7b2c 2 \u884c\u4ee3\u7801\u4e2d\uff0cn \u4e3a const int\uff0cauto \u88ab\u63a8\u5bfc\u4e3a int\u3002</li> <li>\u7b2c 3 \u884c\u4ee3\u7801\u4e2d\uff0cn \u4e3a const int \u7c7b\u578b\uff0c\u4f46\u662f auto \u5374\u88ab\u63a8\u5bfc\u4e3a int \u7c7b\u578b\uff0c\u8fd9\u8bf4\u660e\u5f53<code>=</code>\u53f3\u8fb9\u7684\u8868\u8fbe\u5f0f\u5e26\u6709 const \u5c5e\u6027\u65f6\uff0c auto \u4e0d\u4f1a\u4f7f\u7528 const \u5c5e\u6027\uff0c\u800c\u662f\u76f4\u63a5\u63a8\u5bfc\u51fa non-const \u7c7b\u578b\u3002</li> <li>\u7b2c 4 \u884c\u4ee3\u7801\u4e2d\uff0cauto \u88ab\u63a8\u5bfc\u4e3a int \u7c7b\u578b\uff0c\u8fd9\u4e2a\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002</li> <li>\u7b2c 5 \u884c\u4ee3\u7801\u4e2d\uff0cr1 \u662f const int &amp; \u7c7b\u578b\uff0cauto \u4e5f\u88ab\u63a8\u5bfc\u4e3a const int \u7c7b\u578b\uff0c\u8fd9\u8bf4\u660e\u5f53 const \u548c\u5f15\u7528\u7ed3\u5408\u65f6\uff0cauto \u7684\u63a8\u5bfc\u5c06\u4fdd\u7559\u8868\u8fbe\u5f0f\u7684 const \u7c7b\u578b\u3002</li> </ul> <p>\u6700\u540e\u6211\u4eec\u6765\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b auto \u4e0e const \u7ed3\u5408\u7684\u7528\u6cd5\uff1a</p> <ul> <li>\u5f53\u7c7b\u578b\u4e0d\u4e3a\u5f15\u7528\u65f6\uff0cauto \u7684\u63a8\u5bfc\u7ed3\u679c\u5c06\u4e0d\u4fdd\u7559\u8868\u8fbe\u5f0f\u7684 const \u5c5e\u6027\uff1b</li> <li>\u5f53\u7c7b\u578b\u4e3a\u5f15\u7528\u65f6\uff0cauto \u7684\u63a8\u5bfc\u7ed3\u679c\u5c06\u4fdd\u7559\u8868\u8fbe\u5f0f\u7684 const \u5c5e\u6027\u3002</li> </ul>"},{"location":"native/basic/Cplus_auto/#auto_2","title":"auto \u7684\u9650\u5236","text":"<p>\u524d\u9762\u4ecb\u7ecd\u63a8\u5bfc\u89c4\u5219\u7684\u65f6\u5019\u6211\u4eec\u8bf4\u8fc7\uff0c\u4f7f\u7528 auto \u7684\u65f6\u5019\u5fc5\u987b\u5bf9\u53d8\u91cf\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u8fd9\u662f auto \u7684\u9650\u5236\u4e4b\u4e00\u3002\u90a3\u4e48\uff0c\u9664\u6b64\u4ee5\u5916\uff0cauto \u8fd8\u6709\u54ea\u4e9b\u5176\u5b83\u7684\u9650\u5236\u5462\uff1f</p> <p>1) auto \u4e0d\u80fd\u5728\u51fd\u6570\u7684\u53c2\u6570\u4e2d\u4f7f\u7528\u3002</p> <p>\u8fd9\u4e2a\u5e94\u8be5\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u6211\u4eec\u5728\u5b9a\u4e49\u51fd\u6570\u7684\u65f6\u5019\u53ea\u662f\u5bf9\u53c2\u6570\u8fdb\u884c\u4e86\u58f0\u660e\uff0c\u6307\u660e\u4e86\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u4f46\u5e76\u6ca1\u6709\u7ed9\u5b83\u8d4b\u503c\uff0c\u53ea\u6709\u5728\u5b9e\u9645\u8c03\u7528\u51fd\u6570\u7684\u65f6\u5019\u624d\u4f1a\u7ed9\u53c2\u6570\u8d4b\u503c\uff1b\u800c auto \u8981\u6c42\u5fc5\u987b\u5bf9\u53d8\u91cf\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u6240\u4ee5\u8fd9\u662f\u77db\u76fe\u7684\u3002</p> <p>2) auto \u4e0d\u80fd\u4f5c\u7528\u4e8e\u7c7b\u7684\u975e\u9759\u6001\u6210\u5458\u53d8\u91cf\uff08\u4e5f\u5c31\u662f\u6ca1\u6709 static \u5173\u952e\u5b57\u4fee\u9970\u7684\u6210\u5458\u53d8\u91cf\uff09\u4e2d\u3002</p> <p>3) auto \u5173\u952e\u5b57\u4e0d\u80fd\u5b9a\u4e49\u6570\u7ec4\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u4f8b\u5b50\u5c31\u662f\u9519\u8bef\u7684\uff1a</p> <pre><code>char url[] = \"http://c.biancheng.net/\";\nauto str[] = url; //arr \u4e3a\u6570\u7ec4\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528 auto\n</code></pre> <p>4) auto \u4e0d\u80fd\u4f5c\u7528\u4e8e\u6a21\u677f\u53c2\u6570\uff0c\u8bf7\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a</p> <pre><code>template &lt;typename T&gt;\nclass A{\n//TODO:\n};\nint  main(){\nA&lt;int&gt; C1;\nA&lt;auto&gt; C2 = C1;  //\u9519\u8bef\nreturn 0;\n}\n</code></pre>"},{"location":"native/basic/Cplus_auto/#auto_3","title":"auto \u7684\u5e94\u7528","text":"<p>\u8bf4\u4e86\u90a3\u4e48\u591a auto \u7684\u63a8\u5bfc\u89c4\u5219\u548c\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879\uff0c\u90a3\u4e48 auto \u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u5230\u5e95\u6709\u4ec0\u4e48\u5e94\u7528\u5462\uff1f\u4e0b\u9762\u6211\u4eec\u5217\u4e3e\u4e24\u4e2a\u5178\u578b\u7684\u5e94\u7528\u573a\u666f\u3002</p>"},{"location":"native/basic/Cplus_auto/#auto_4","title":"\u4f7f\u7528 auto \u5b9a\u4e49\u8fed\u4ee3\u5668","text":"<p>auto \u7684\u4e00\u4e2a\u5178\u578b\u5e94\u7528\u573a\u666f\u662f\u7528\u6765\u5b9a\u4e49 stl \u7684\u8fed\u4ee3\u5668\u3002</p> <p>\u6211\u4eec\u5728\u4f7f\u7528 stl \u5bb9\u5668\u7684\u65f6\u5019\uff0c\u9700\u8981\u4f7f\u7528\u8fed\u4ee3\u5668\u6765\u904d\u5386\u5bb9\u5668\u91cc\u9762\u7684\u5143\u7d20\uff1b\u4e0d\u540c\u5bb9\u5668\u7684\u8fed\u4ee3\u5668\u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u5728\u5b9a\u4e49\u8fed\u4ee3\u5668\u65f6\u5fc5\u987b\u6307\u660e\u3002\u800c\u8fed\u4ee3\u5668\u7684\u7c7b\u578b\u6709\u65f6\u5019\u6bd4\u8f83\u590d\u6742\uff0c\u4e66\u5199\u8d77\u6765\u5f88\u9ebb\u70e6\uff0c\u8bf7\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;vector&gt;\nusing namespace std;\nint main(){\nvector&lt; vector&lt;int&gt; &gt; v;\nvector&lt; vector&lt;int&gt; &gt;::iterator i = v.begin();\nreturn 0;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u5b9a\u4e49\u8fed\u4ee3\u5668 i \u7684\u65f6\u5019\uff0c\u7c7b\u578b\u4e66\u5199\u6bd4\u8f83\u5197\u957f\uff0c\u5bb9\u6613\u51fa\u9519\u3002\u7136\u800c\u6709\u4e86 auto \u7c7b\u578b\u63a8\u5bfc\uff0c\u6211\u4eec\u5927\u53ef\u4e0d\u5fc5\u8fd9\u6837\uff0c\u53ea\u5199\u4e00\u4e2a auto \u5373\u53ef\u3002</p> <p>\u4fee\u6539\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u4f7f\u4e4b\u53d8\u5f97\u66f4\u52a0\u7b80\u6d01\uff1a</p> <pre><code>#include &lt;vector&gt;\nusing namespace std;\nint main(){\nvector&lt; vector&lt;int&gt; &gt; v;\nauto i = v.begin();  //\u4f7f\u7528 auto \u4ee3\u66ff\u5177\u4f53\u7684\u7c7b\u578b\nreturn 0;\n}\n</code></pre> <p>auto \u53ef\u4ee5\u6839\u636e\u8868\u8fbe\u5f0f v.begin() \u7684\u7c7b\u578b\uff08begin() \u51fd\u6570\u7684\u8fd4\u56de\u503c\u7c7b\u578b\uff09\u6765\u63a8\u5bfc\u51fa\u53d8\u91cf i \u7684\u7c7b\u578b\u3002</p>"},{"location":"native/basic/Cplus_auto/#auto_5","title":"auto \u7528\u4e8e\u6cdb\u578b\u7f16\u7a0b","text":"<p>auto \u7684\u53e6\u4e00\u4e2a\u5e94\u7528\u5c31\u662f\u5f53\u6211\u4eec\u4e0d\u77e5\u9053\u53d8\u91cf\u662f\u4ec0\u4e48\u7c7b\u578b\uff0c\u6216\u8005\u4e0d\u5e0c\u671b\u6307\u660e\u5177\u4f53\u7c7b\u578b\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u6cdb\u578b\u7f16\u7a0b\u4e2d\u3002\u6211\u4eec\u63a5\u7740\u770b\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nclass A{\npublic:\nstatic int get(void){\nreturn 100;\n}\n};\nclass B{\npublic:\nstatic const char* get(void){\nreturn \"http://c.biancheng.net/cplus/\";\n}\n};\ntemplate &lt;typename T&gt;\nvoid func(void){\nauto val = T::get();\ncout &lt;&lt; val &lt;&lt; endl;\n}\nint main(void){\nfunc&lt;A&gt;();\nfunc&lt;B&gt;();\nreturn 0;\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\uff1a</p> <pre><code>100\nhttp://c.biancheng.net/cplus/\n</code></pre> <p>\u672c\u4f8b\u4e2d\u7684\u6a21\u677f\u51fd\u6570 func() \u4f1a\u8c03\u7528\u6240\u6709\u7c7b\u7684\u9759\u6001\u51fd\u6570 get()\uff0c\u5e76\u5bf9\u5b83\u7684\u8fd4\u56de\u503c\u505a\u7edf\u4e00\u5904\u7406\uff0c\u4f46\u662f get() \u7684\u8fd4\u56de\u503c\u7c7b\u578b\u5e76\u4e0d\u4e00\u6837\uff0c\u800c\u4e14\u4e0d\u80fd\u81ea\u52a8\u8f6c\u6362\u3002\u8fd9\u79cd\u8981\u6c42\u5728\u4ee5\u524d\u7684 C++ \u7248\u672c\u4e2d\u5b9e\u73b0\u8d77\u6765\u975e\u5e38\u7684\u9ebb\u70e6\uff0c\u9700\u8981\u989d\u5916\u589e\u52a0\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\uff0c\u5e76\u5728\u8c03\u7528\u65f6\u624b\u52a8\u7ed9\u8be5\u6a21\u677f\u53c2\u6570\u8d4b\u503c\uff0c\u7528\u4ee5\u6307\u660e\u53d8\u91cf val \u7684\u7c7b\u578b\u3002</p> <p>\u4f46\u662f\u6709\u4e86 auto \u7c7b\u578b\u81ea\u52a8\u63a8\u5bfc\uff0c\u7f16\u8bd1\u5668\u5c31\u6839\u636e get() \u7684\u8fd4\u56de\u503c\u81ea\u5df1\u63a8\u5bfc\u51fa val \u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u5c31\u4e0d\u7528\u518d\u589e\u52a0\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u4e86\u3002</p> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u6f14\u793a\u4e86\u4e0d\u4f7f\u7528 auto \u7684\u89e3\u51b3\u529e\u6cd5\uff1a</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nclass A{\npublic:\nstatic int get(void){\nreturn 100;\n}\n};\nclass B{\npublic:\nstatic const char* get(void){\nreturn \"http://c.biancheng.net/cplus/\";\n}\n};\ntemplate &lt;typename T1, typename T2&gt;  //\u989d\u5916\u589e\u52a0\u4e00\u4e2a\u6a21\u677f\u53c2\u6570 T2\nvoid func(void){\nT2 val = T1::get();\ncout &lt;&lt; val &lt;&lt; endl;\n}\nint main(void){\n//\u8c03\u7528\u65f6\u4e5f\u8981\u624b\u52a8\u7ed9\u6a21\u677f\u53c2\u6570\u8d4b\u503c\nfunc&lt;A, int&gt;();\nfunc&lt;B, const char*&gt;();\nreturn 0;\n}\n</code></pre>"},{"location":"native/basic/Cplus_auto/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea http://c.biancheng.net/view/6984.html</p>"},{"location":"native/basic/Cplus_decltype/","title":"C++ decltype\u7c7b\u578b\u63a8\u5bfc\u5b8c\u5168\u653b\u7565","text":"<p>decltype \u662f C++11 \u65b0\u589e\u7684\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u5b83\u548c auto \u7684\u529f\u80fd\u4e00\u6837\uff0c\u90fd\u7528\u6765\u5728\u7f16\u8bd1\u65f6\u671f\u8fdb\u884c\u81ea\u52a8\u7c7b\u578b\u63a8\u5bfc\u3002\u4e0d\u4e86\u89e3 auto \u7528\u6cd5\u7684\u8bfb\u8005\u8bf7\u8f6c\u5230\u300aC++ auto\u300b\u3002</p> <p>decltype \u662f\u201cdeclare type\u201d\u7684\u7f29\u5199\uff0c\u8bd1\u4e3a\u201c\u58f0\u660e\u7c7b\u578b\u201d\u3002</p> <p>\u65e2\u7136\u5df2\u7ecf\u6709\u4e86 auto \u5173\u952e\u5b57\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 decltype \u5173\u952e\u5b57\u5462\uff1f\u56e0\u4e3a auto \u5e76\u4e0d\u9002\u7528\u4e8e\u6240\u6709\u7684\u81ea\u52a8\u7c7b\u578b\u63a8\u5bfc\u573a\u666f\uff0c\u5728\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b auto \u7528\u8d77\u6765\u975e\u5e38\u4e0d\u65b9\u4fbf\uff0c\u751a\u81f3\u538b\u6839\u65e0\u6cd5\u4f7f\u7528\uff0c\u6240\u4ee5 decltype \u5173\u952e\u5b57\u4e5f\u88ab\u5f15\u5165\u5230 C++11 \u4e2d\u3002</p> <p>auto \u548c decltype \u5173\u952e\u5b57\u90fd\u53ef\u4ee5\u81ea\u52a8\u63a8\u5bfc\u51fa\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u4f46\u5b83\u4eec\u7684\u7528\u6cd5\u662f\u6709\u533a\u522b\u7684\uff1a</p> <pre><code>auto varname = value;\ndecltype(exp) varname = value;\n</code></pre> <p>\u5176\u4e2d\uff0cvarname \u8868\u793a\u53d8\u91cf\u540d\uff0cvalue \u8868\u793a\u8d4b\u7ed9\u53d8\u91cf\u7684\u503c\uff0cexp \u8868\u793a\u4e00\u4e2a\u8868\u8fbe\u5f0f\u3002</p> <p>auto \u6839\u636e<code>=</code>\u53f3\u8fb9\u7684\u521d\u59cb\u503c value \u63a8\u5bfc\u51fa\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u800c decltype \u6839\u636e exp \u8868\u8fbe\u5f0f\u63a8\u5bfc\u51fa\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u8ddf<code>=</code>\u53f3\u8fb9\u7684 value \u6ca1\u6709\u5173\u7cfb\u3002</p> <p>\u53e6\u5916\uff0cauto \u8981\u6c42\u53d8\u91cf\u5fc5\u987b\u521d\u59cb\u5316\uff0c\u800c decltype \u4e0d\u8981\u6c42\u3002\u8fd9\u5f88\u5bb9\u6613\u7406\u89e3\uff0cauto \u662f\u6839\u636e\u53d8\u91cf\u7684\u521d\u59cb\u503c\u6765\u63a8\u5bfc\u51fa\u53d8\u91cf\u7c7b\u578b\u7684\uff0c\u5982\u679c\u4e0d\u521d\u59cb\u5316\uff0c\u53d8\u91cf\u7684\u7c7b\u578b\u4e5f\u5c31\u65e0\u6cd5\u63a8\u5bfc\u4e86\u3002decltype \u53ef\u4ee5\u5199\u6210\u4e0b\u9762\u7684\u5f62\u5f0f\uff1a</p> <pre><code>decltype(exp) varname;\n</code></pre>"},{"location":"native/basic/Cplus_decltype/#exp","title":"exp \u6ce8\u610f\u4e8b\u9879","text":"<p>\u539f\u5219\u4e0a\u8bb2\uff0cexp \u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u8868\u8fbe\u5f0f\uff0c\u5b83\u53ef\u4ee5\u662f\u4efb\u610f\u590d\u6742\u7684\u5f62\u5f0f\uff0c\u4f46\u662f\u6211\u4eec\u5fc5\u987b\u8981\u4fdd\u8bc1 exp \u7684\u7ed3\u679c\u662f\u6709\u7c7b\u578b\u7684\uff0c\u4e0d\u80fd\u662f void\uff1b\u4f8b\u5982\uff0c\u5f53 exp \u8c03\u7528\u4e00\u4e2a\u8fd4\u56de\u503c\u7c7b\u578b\u4e3a void \u7684\u51fd\u6570\u65f6\uff0cexp \u7684\u7ed3\u679c\u4e5f\u662f void \u7c7b\u578b\uff0c\u6b64\u65f6\u5c31\u4f1a\u5bfc\u81f4\u7f16\u8bd1\u9519\u8bef\u3002</p> <p>C++ decltype \u7528\u6cd5\u4e3e\u4f8b\uff1a</p> <pre><code>int a = 0;\ndecltype(a) b = 1;  //b \u88ab\u63a8\u5bfc\u6210\u4e86 int\ndecltype(10.8) x = 5.5;  //x \u88ab\u63a8\u5bfc\u6210\u4e86 double\ndecltype(x + 100) y;  //y \u88ab\u63a8\u5bfc\u6210\u4e86 double\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cdecltype \u80fd\u591f\u6839\u636e\u53d8\u91cf\u3001\u5b57\u9762\u91cf\u3001\u5e26\u6709\u8fd0\u7b97\u7b26\u7684\u8868\u8fbe\u5f0f\u63a8\u5bfc\u51fa\u53d8\u91cf\u7684\u7c7b\u578b\u3002\u8bfb\u8005\u8bf7\u7559\u610f\u7b2c 4 \u884c\uff0cy \u6ca1\u6709\u88ab\u521d\u59cb\u5316\u3002</p>"},{"location":"native/basic/Cplus_decltype/#decltype","title":"decltype \u63a8\u5bfc\u89c4\u5219","text":"<p>\u4e0a\u9762\u7684\u4f8b\u5b50\u8ba9\u6211\u4eec\u521d\u6b65\u611f\u53d7\u4e86\u4e00\u4e0b decltype \u7684\u7528\u6cd5\uff0c\u4f46\u4f60\u4e0d\u8981\u8ba4\u4e3a decltype \u5c31\u8fd9\u4e48\u7b80\u5355\uff0c\u5b83\u7684\u73a9\u6cd5\u5b9e\u9645\u4e0a\u53ef\u4ee5\u975e\u5e38\u590d\u6742\u3002\u5f53\u7a0b\u5e8f\u5458\u4f7f\u7528 decltype(exp) \u83b7\u53d6\u7c7b\u578b\u65f6\uff0c\u7f16\u8bd1\u5668\u5c06\u6839\u636e\u4ee5\u4e0b\u4e09\u6761\u89c4\u5219\u5f97\u51fa\u7ed3\u679c\uff1a</p> <ul> <li>\u5982\u679c exp \u662f\u4e00\u4e2a\u4e0d\u88ab\u62ec\u53f7<code>( )</code>\u5305\u56f4\u7684\u8868\u8fbe\u5f0f\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u7c7b\u6210\u5458\u8bbf\u95ee\u8868\u8fbe\u5f0f\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u53d8\u91cf\uff0c\u90a3\u4e48 decltype(exp) \u7684\u7c7b\u578b\u5c31\u548c exp \u4e00\u81f4\uff0c\u8fd9\u662f\u6700\u666e\u904d\u6700\u5e38\u89c1\u7684\u60c5\u51b5\u3002</li> <li>\u5982\u679c exp \u662f\u51fd\u6570\u8c03\u7528\uff0c\u90a3\u4e48 decltype(exp) \u7684\u7c7b\u578b\u5c31\u548c\u51fd\u6570\u8fd4\u56de\u503c\u7684\u7c7b\u578b\u4e00\u81f4\u3002</li> <li>\u5982\u679c exp \u662f\u4e00\u4e2a\u5de6\u503c\uff0c\u6216\u8005\u88ab\u62ec\u53f7<code>( )</code>\u5305\u56f4\uff0c\u90a3\u4e48 decltype(exp) \u7684\u7c7b\u578b\u5c31\u662f exp \u7684\u5f15\u7528\uff1b\u5047\u8bbe exp \u7684\u7c7b\u578b\u4e3a T\uff0c\u90a3\u4e48 decltype(exp) \u7684\u7c7b\u578b\u5c31\u662f T&amp;\u3002</li> </ul> <p>\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3 decltype \u7684\u63a8\u5bfc\u89c4\u5219\uff0c\u4e0b\u9762\u6765\u770b\u51e0\u4e2a\u5b9e\u9645\u7684\u4f8b\u5b50\u3002</p> <p>\u3010\u5b9e\u4f8b1\u3011exp \u662f\u4e00\u4e2a\u666e\u901a\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>#include &lt;string&gt;\nusing namespace std;\nclass Student{\npublic:\nstatic int total;\nstring name;\nint age;\nfloat scores;\n};\nint Student::total = 0;\nint  main(){\nint n = 0;\nconst int &amp;r = n;\nStudent stu;\ndecltype(n) a = n;  //n \u4e3a int \u7c7b\u578b\uff0ca \u88ab\u63a8\u5bfc\u4e3a int \u7c7b\u578b\ndecltype(r) b = n;     //r \u4e3a const int&amp; \u7c7b\u578b, b \u88ab\u63a8\u5bfc\u4e3a const int&amp; \u7c7b\u578b\ndecltype(Student::total) c = 0;  //total \u4e3a\u7c7b Student \u7684\u4e00\u4e2a int \u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\uff0cc \u88ab\u63a8\u5bfc\u4e3a int \u7c7b\u578b\ndecltype(stu.name) url = \"http://c.biancheng.net/cplus/\";  //total \u4e3a\u7c7b Student \u7684\u4e00\u4e2a string \u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\uff0c url \u88ab\u63a8\u5bfc\u4e3a string \u7c7b\u578b\nreturn 0;\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u6309\u7167\u63a8\u5bfc\u89c4\u5219 1\uff0c\u5bf9\u4e8e\u4e00\u822c\u7684\u8868\u8fbe\u5f0f\uff0cdecltype \u7684\u63a8\u5bfc\u7ed3\u679c\u5c31\u548c\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\u4e00\u81f4\u3002</p> <p>\u3010\u5b9e\u4f8b2\u3011exp \u4e3a\u51fd\u6570\u8c03\u7528\uff1a</p> <pre><code>//\u51fd\u6570\u58f0\u660e\nint&amp; func_int_r(int, char);  //\u8fd4\u56de\u503c\u4e3a int&amp;\nint&amp;&amp; func_int_rr(void);  //\u8fd4\u56de\u503c\u4e3a int&amp;&amp;\nint func_int(double);  //\u8fd4\u56de\u503c\u4e3a int\nconst int&amp; fun_cint_r(int, int, int);  //\u8fd4\u56de\u503c\u4e3a const int&amp;\nconst int&amp;&amp; func_cint_rr(void);  //\u8fd4\u56de\u503c\u4e3a const int&amp;&amp;\n//decltype\u7c7b\u578b\u63a8\u5bfc\nint n = 100;\ndecltype(func_int_r(100, 'A')) a = n;  //a \u7684\u7c7b\u578b\u4e3a int&amp;\ndecltype(func_int_rr()) b = 0;  //b \u7684\u7c7b\u578b\u4e3a int&amp;&amp;\ndecltype(func_int(10.5)) c = 0;   //c \u7684\u7c7b\u578b\u4e3a int\ndecltype(fun_cint_r(1,2,3))  x = n;    //x \u7684\u7c7b\u578b\u4e3a const int &amp;\ndecltype(func_cint_rr()) y = 0;  // y \u7684\u7c7b\u578b\u4e3a const int&amp;&amp;\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cexp \u4e2d\u8c03\u7528\u51fd\u6570\u65f6\u9700\u8981\u5e26\u4e0a\u62ec\u53f7\u548c\u53c2\u6570\uff0c\u4f46\u8fd9\u4ec5\u4ec5\u662f\u5f62\u5f0f\uff0c\u5e76\u4e0d\u4f1a\u771f\u7684\u53bb\u6267\u884c\u51fd\u6570\u4ee3\u7801\u3002</p> <p>\u3010\u5b9e\u4f8b3\u3011exp \u662f\u5de6\u503c\uff0c\u6216\u8005\u88ab<code>( )</code>\u5305\u56f4\uff1a</p> <pre><code>using namespace std;\nclass Base{\npublic:\nint x;\n};\nint main(){\nconst Base obj;\n//\u5e26\u6709\u62ec\u53f7\u7684\u8868\u8fbe\u5f0f\ndecltype(obj.x) a = 0;  //obj.x \u4e3a\u7c7b\u7684\u6210\u5458\u8bbf\u95ee\u8868\u8fbe\u5f0f\uff0c\u7b26\u5408\u63a8\u5bfc\u89c4\u5219\u4e00\uff0ca \u7684\u7c7b\u578b\u4e3a int\ndecltype((obj.x)) b = a;  //obj.x \u5e26\u6709\u62ec\u53f7\uff0c\u7b26\u5408\u63a8\u5bfc\u89c4\u5219\u4e09\uff0cb \u7684\u7c7b\u578b\u4e3a int&amp;\u3002\n//\u52a0\u6cd5\u8868\u8fbe\u5f0f\nint n = 0, m = 0;\ndecltype(n + m) c = 0;  //n+m \u5f97\u5230\u4e00\u4e2a\u53f3\u503c\uff0c\u7b26\u5408\u63a8\u5bfc\u89c4\u5219\u4e00\uff0c\u6240\u4ee5\u63a8\u5bfc\u7ed3\u679c\u4e3a int\ndecltype(n = n + m) d = c;  //n=n+m \u5f97\u5230\u4e00\u4e2a\u5de6\u503c\uff0c\u7b26\u53f7\u63a8\u5bfc\u89c4\u5219\u4e09\uff0c\u6240\u4ee5\u63a8\u5bfc\u7ed3\u679c\u4e3a int&amp;\nreturn 0;\n}\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u91cd\u70b9\u8bf4\u4e00\u4e0b\u5de6\u503c\u548c\u53f3\u503c\uff1a\u5de6\u503c\u662f\u6307\u90a3\u4e9b\u5728\u8868\u8fbe\u5f0f\u6267\u884c\u7ed3\u675f\u540e\u4f9d\u7136\u5b58\u5728\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u6301\u4e45\u6027\u7684\u6570\u636e\uff1b\u53f3\u503c\u662f\u6307\u90a3\u4e9b\u5728\u8868\u8fbe\u5f0f\u6267\u884c\u7ed3\u675f\u540e\u4e0d\u518d\u5b58\u5728\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4e34\u65f6\u6027\u7684\u6570\u636e\u3002\u6709\u4e00\u79cd\u5f88\u7b80\u5355\u7684\u65b9\u6cd5\u6765\u533a\u5206\u5de6\u503c\u548c\u53f3\u503c\uff0c\u5bf9\u8868\u8fbe\u5f0f\u53d6\u5730\u5740\uff0c\u5982\u679c\u7f16\u8bd1\u5668\u4e0d\u62a5\u9519\u5c31\u4e3a\u5de6\u503c\uff0c\u5426\u5219\u4e3a\u53f3\u503c\u3002</p>"},{"location":"native/basic/Cplus_decltype/#decltype_1","title":"decltype \u7684\u5b9e\u9645\u5e94\u7528","text":"<p>auto \u7684\u8bed\u6cd5\u683c\u5f0f\u6bd4 decltype \u7b80\u5355\uff0c\u6240\u4ee5\u5728\u4e00\u822c\u7684\u7c7b\u578b\u63a8\u5bfc\u4e2d\uff0c\u4f7f\u7528 auto \u6bd4\u4f7f\u7528 decltype \u66f4\u52a0\u65b9\u4fbf\uff0c\u4f60\u53ef\u4ee5\u8f6c\u5230\u300aC++ auto\u300b\u67e5\u770b\u5f88\u591a\u7c7b\u4f3c\u7684\u4f8b\u5b50\uff0c\u672c\u8282\u4ec5\u6f14\u793a\u53ea\u80fd\u4f7f\u7528 decltype \u7684\u60c5\u5f62\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0cauto \u53ea\u80fd\u7528\u4e8e\u7c7b\u7684\u9759\u6001\u6210\u5458\uff0c\u4e0d\u80fd\u7528\u4e8e\u7c7b\u7684\u975e\u9759\u6001\u6210\u5458\uff08\u666e\u901a\u6210\u5458\uff09\uff0c\u5982\u679c\u6211\u4eec\u60f3\u63a8\u5bfc\u975e\u9759\u6001\u6210\u5458\u7684\u7c7b\u578b\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u5fc5\u987b\u4f7f\u7528 decltype \u4e86\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u6a21\u677f\u7684\u5b9a\u4e49\uff1a</p> <pre><code>#include &lt;vector&gt;\nusing namespace std;\ntemplate &lt;typename T&gt;\nclass Base {\npublic:\nvoid func(T&amp; container) {\nm_it = container.begin();\n}\nprivate:\ntypename T::iterator m_it;  //\u6ce8\u610f\u8fd9\u91cc\n};\nint main()\n{\nconst vector&lt;int&gt; v;\nBase&lt;const vector&lt;int&gt;&gt; obj;\nobj.func(v);\nreturn 0;\n}\n</code></pre> <p>\u5355\u72ec\u770b Base \u7c7b\u4e2d m_it \u6210\u5458\u7684\u5b9a\u4e49\uff0c\u5f88\u96be\u770b\u51fa\u4f1a\u6709\u4ec0\u4e48\u9519\u8bef\uff0c\u4f46\u5728\u4f7f\u7528 Base \u7c7b\u7684\u65f6\u5019\uff0c\u5982\u679c\u4f20\u5165\u4e00\u4e2a const \u7c7b\u578b\u7684\u5bb9\u5668\uff0c\u7f16\u8bd1\u5668\u9a6c\u4e0a\u5c31\u4f1a\u5f39\u51fa\u4e00\u5927\u5806\u9519\u8bef\u4fe1\u606f\u3002\u539f\u56e0\u5c31\u5728\u4e8e\uff0c<code>T::iterator</code>\u5e76\u4e0d\u80fd\u5305\u62ec\u6240\u6709\u7684\u8fed\u4ee3\u5668\u7c7b\u578b\uff0c\u5f53 T \u662f\u4e00\u4e2a const \u5bb9\u5668\u65f6\uff0c\u5e94\u5f53\u4f7f\u7528 const_iterator\u3002</p> <p>\u8981\u60f3\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728\u4e4b\u524d\u7684 C++98/03 \u7248\u672c\u4e0b\u53ea\u80fd\u60f3\u529e\u6cd5\u628a const \u7c7b\u578b\u7684\u5bb9\u5668\u7528\u6a21\u677f\u7279\u5316\u5355\u72ec\u5904\u7406\uff0c\u589e\u52a0\u4e86\u4e0d\u5c11\u5de5\u4f5c\u91cf\uff0c\u770b\u8d77\u6765\u4e5f\u975e\u5e38\u6666\u6da9\u3002\u4f46\u662f\u6709\u4e86 C++11 \u7684 decltype \u5173\u952e\u5b57\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd9\u6837\u5199\uff1a</p> <pre><code>template &lt;typename T&gt;\nclass Base {\npublic:\nvoid func(T&amp; container) {\nm_it = container.begin();\n}\nprivate:\ndecltype(T().begin()) m_it;  //\u6ce8\u610f\u8fd9\u91cc\n};\n</code></pre> <p>\u770b\u8d77\u6765\u662f\u4e0d\u662f\u5f88\u6e05\u723d\uff1f</p> <p>\u6ce8\u610f\uff0c\u6709\u4e9b\u4f4e\u7248\u672c\u7684\u7f16\u8bd1\u5668\u4e0d\u652f\u6301<code>T().begin()</code>\u8fd9\u79cd\u5199\u6cd5\uff0c\u4ee5\u4e0a\u4ee3\u7801\u6211\u5728 VS2019 \u4e0b\u6d4b\u8bd5\u901a\u8fc7\uff0c\u5728 VS2015 \u4e0b\u6d4b\u8bd5\u5931\u8d25\u3002</p>"},{"location":"native/basic/Cplus_decltype/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea http://c.biancheng.net/view/7151.html</p>"},{"location":"native/basic/Cplus_nullptr/","title":"C++11 nullptr\uff1a\u521d\u59cb\u5316\u7a7a\u6307\u9488","text":"<p>\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u907f\u514d\u4ea7\u751f\u201c\u91ce\u6307\u9488\u201d\u6700\u6709\u6548\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u5728\u5b9a\u4e49\u6307\u9488\u7684\u540c\u65f6\u5b8c\u6210\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u5373\u4fbf\u8be5\u6307\u9488\u7684\u6307\u5411\u5c1a\u672a\u660e\u786e\uff0c\u4e5f\u8981\u5c06\u5176\u521d\u59cb\u5316\u4e3a\u7a7a\u6307\u9488\u3002</p> <p>\u6240\u8c13\u201c\u91ce\u6307\u9488\u201d\uff0c\u53c8\u79f0\u201c\u60ac\u6302\u6307\u9488\u201d\uff0c\u6307\u7684\u662f\u6ca1\u6709\u660e\u786e\u6307\u5411\u7684\u6307\u9488\u3002\u91ce\u6307\u9488\u5f80\u5f80\u6307\u5411\u7684\u662f\u90a3\u4e9b\u4e0d\u53ef\u7528\u7684\u5185\u5b58\u533a\u57df\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u50cf\u64cd\u4f5c\u666e\u901a\u6307\u9488\u90a3\u6837\u4f7f\u7528\u91ce\u6307\u9488\uff08\u4f8b\u5982 &amp;p\uff09\uff0c\u6781\u53ef\u80fd\u5bfc\u81f4\u7a0b\u5e8f\u53d1\u751f\u5f02\u5e38\u3002</p> <p>C++98/03 \u6807\u51c6\u4e2d\uff0c\u5c06\u4e00\u4e2a\u6307\u9488\u521d\u59cb\u5316\u4e3a\u7a7a\u6307\u9488\u7684\u65b9\u5f0f\u6709 2 \u79cd\uff1a</p> <pre><code>int *p = 0;int *p = NULL; //\u63a8\u8350\u4f7f\u7528\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6307\u9488\u660e\u786e\u6307\u5411 0\uff080x0000 0000\uff09\u8fd9\u4e2a\u5185\u5b58\u7a7a\u95f4\u3002\u4e00\u65b9\u9762\uff0c\u660e\u786e\u6307\u9488\u7684\u6307\u5411\u53ef\u4ee5\u907f\u514d\u5176\u6210\u4e3a\u91ce\u6307\u9488\uff1b\u53e6\u4e00\u65b9\u9762\uff0c\u5927\u591a\u6570\u64cd\u4f5c\u7cfb\u7edf\u90fd\u4e0d\u5141\u8bb8\u7528\u6237\u5bf9\u5730\u5740\u4e3a 0 \u7684\u5185\u5b58\u7a7a\u95f4\u6267\u884c\u5199\u64cd\u4f5c\uff0c\u82e5\u7528\u6237\u5728\u7a0b\u5e8f\u4e2d\u5c1d\u8bd5\u4fee\u6539\u5176\u5185\u5bb9\uff0c\u5219\u7a0b\u5e8f\u8fd0\u884c\u4f1a\u76f4\u63a5\u62a5\u9519\u3002</p> <p>\u76f8\u6bd4\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u66f4\u4e60\u60ef\u5c06\u6307\u9488\u521d\u59cb\u5316\u4e3a NULL\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cNULL \u5e76\u4e0d\u662f C++ \u7684\u5173\u952e\u5b57\uff0c\u5b83\u662f C++ \u4e3a\u6211\u4eec\u4e8b\u5148\u5b9a\u4e49\u597d\u7684\u4e00\u4e2a\u5b8f\uff0c\u5e76\u4e14\u5b83\u7684\u503c\u5f80\u5f80\u5c31\u662f\u5b57\u9762\u91cf 0\uff08#define NULL 0\uff09\u3002</p> <p>C++ \u4e2d\u5c06 NULL \u5b9a\u4e49\u4e3a\u5b57\u9762\u5e38\u91cf 0\uff0c\u867d\u7136\u80fd\u6ee1\u8db3\u5927\u90e8\u5206\u573a\u666f\u7684\u9700\u8981\uff0c\u4f46\u4e2a\u522b\u60c5\u51b5\u4e0b\uff0c\u5b83\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u7684\u8fd0\u884c\u548c\u6211\u4eec\u7684\u9884\u671f\u4e0d\u7b26\u3002\u4f8b\u5982\uff1a</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nvoid isnull(void *c){\ncout &lt;&lt; \"void*c\" &lt;&lt; endl;\n}\nvoid isnull(int n){\ncout &lt;&lt; \"int n\" &lt;&lt; endl;\n}\nint main() {\nisnull(0);\nisnull(NULL);\nreturn 0;\n}\n</code></pre> <p>\u7a0b\u5e8f\u6267\u884c\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>int n\nint n\n</code></pre> <p>\u5bf9\u4e8e isnull(0) \u6765\u8bf4\uff0c\u663e\u7136\u5b83\u771f\u6b63\u8c03\u7528\u7684\u662f\u53c2\u6570\u4e3a\u6574\u5f62\u7684 isnull() \u51fd\u6570\uff1b\u800c\u5bf9\u4e8e isnull(NULL)\uff0c\u6211\u4eec\u671f\u671b\u5b83\u5b9e\u9645\u8c03\u7528\u7684\u662f\u53c2\u6570\u4e3a void*c \u7684 isnull() \u51fd\u6570\uff0c\u4f46\u89c2\u5bdf\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u4e0d\u96be\u770b\u51fa\uff0c\u5e76\u4e0d\u7b26\u5408\u6211\u4eec\u7684\u9884\u671f\u3002</p> <p>C++ 98/03 \u6807\u51c6\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u60f3\u4ee4 isnull(NULL) \u5b9e\u9645\u8c03\u7528\u7684\u662f isnull(void* c)\uff0c\u5c31\u9700\u8981\u5bf9 NULL\uff08\u6216\u8005 0\uff09\u8fdb\u884c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff1a</p> <pre><code>isnull( (void*)NULL );\nisnull( (void*)0 );\n</code></pre> <p>\u5982\u6b64\uff0c\u624d\u4f1a\u6210\u529f\u8c03\u7528\u6211\u4eec\u9884\u671f\u7684\u51fd\u6570\uff08\u8bfb\u8005\u53ef\u81ea\u884c\u6267\u884c\u6b64\u4ee3\u7801\uff0c\u89c2\u5bdf\u8f93\u51fa\u7ed3\u679c\uff09\u3002</p> <p>\u7531\u4e8e C++ 98 \u6807\u51c6\u4f7f\u7528\u671f\u95f4\uff0cNULL \u5df2\u7ecf\u5f97\u5230\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\uff0c\u51fa\u4e8e\u517c\u5bb9\u6027\u7684\u8003\u8651\uff0cC++11 \u6807\u51c6\u5e76\u6ca1\u6709\u5bf9 NULL \u7684\u5b8f\u5b9a\u4e49\u505a\u4efb\u4f55\u4fee\u6539\u3002\u4e3a\u4e86\u4fee\u6b63 C++ \u5b58\u5728\u7684\u8fd9\u4e00 BUG\uff0cC++ \u6807\u51c6\u59d4\u5458\u4f1a\u6700\u7ec8\u51b3\u5b9a\u53e6\u5176\u7089\u7076\uff0c\u5728 C++11 \u6807\u51c6\u4e2d\u5f15\u5165\u4e00\u4e2a\u65b0\u5173\u952e\u5b57\uff0c\u5373 nullptr\u3002</p> <p>\u5728\u4f7f\u7528 nullptr \u4e4b\u524d\uff0c\u8bfb\u8005\u9700\u4fdd\u8bc1\u81ea\u5df1\u4f7f\u7528\u7684\u7f16\u8bd1\u5668\u652f\u6301\u8be5\u5173\u952e\u5b57\u3002\u4ee5 Visual Studio \u548c codeblocks \u4e3a\u4f8b\uff0c\u524d\u8005\u65e9\u5728 2010 \u7248\u672c\u5c31\u5bf9 C++ 11 \u6807\u51c6\u4e2d\u7684\u90e8\u5206\u7279\u6027\u63d0\u4f9b\u4e86\u652f\u6301\uff0c\u5176\u4e2d\u5c31\u5305\u62ec nullptr\uff1b\u5982\u679c\u4f7f\u7528\u540e\u8005\uff0c\u8bfb\u8005\u9700\u5c06\u5176 G++ \u7f16\u8bd1\u5668\u7248\u672c\u81f3\u5c11\u5347\u7ea7\u81f3 4.6.1\uff08\u540c\u65f6\u5f00\u542f -std=c++0x \u7f16\u8bd1\u9009\u9879\uff09\u3002</p> <p>nullptr \u662f nullptr_t \u7c7b\u578b\u7684\u53f3\u503c\u5e38\u91cf\uff0c\u4e13\u7528\u4e8e\u521d\u59cb\u5316\u7a7a\u7c7b\u578b\u6307\u9488\u3002nullptr_t \u662f C++11 \u65b0\u589e\u52a0\u7684\u6570\u636e\u7c7b\u578b\uff0c\u53ef\u79f0\u4e3a\u201c\u6307\u9488\u7a7a\u503c\u7c7b\u578b\u201d\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cnullpter \u4ec5\u662f\u8be5\u7c7b\u578b\u7684\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\uff08\u5df2\u7ecf\u5b9a\u4e49\u597d\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff09\uff0c\u5982\u679c\u9700\u8981\u6211\u4eec\u5b8c\u5168\u5b9a\u4e49\u51fa\u591a\u4e2a\u540c nullptr \u5b8c\u5168\u4e00\u6837\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002</p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cnullptr \u53ef\u4ee5\u88ab\u9690\u5f0f\u8f6c\u6362\u6210\u4efb\u610f\u7684\u6307\u9488\u7c7b\u578b\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>int * a1 = nullptr;\nchar * a2 = nullptr;\ndouble * a3 = nullptr;\n</code></pre> <p>\u663e\u7136\uff0c\u4e0d\u540c\u7c7b\u578b\u7684\u6307\u9488\u53d8\u91cf\u90fd\u53ef\u4ee5\u4f7f\u7528 nullptr \u6765\u521d\u59cb\u5316\uff0c\u7f16\u8bd1\u5668\u5206\u522b\u5c06 nullptr \u9690\u5f0f\u8f6c\u6362\u6210 int*\u3001char* \u4ee5\u53ca double* \u6307\u9488\u7c7b\u578b\u3002</p> <p>\u53e6\u5916\uff0c\u901a\u8fc7\u5c06\u6307\u9488\u521d\u59cb\u5316\u4e3a nullptr\uff0c\u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3 NULL \u9057\u7559\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nvoid isnull(void *c){\ncout &lt;&lt; \"void*c\" &lt;&lt; endl;\n}\nvoid isnull(int n){\ncout &lt;&lt; \"int n\" &lt;&lt; endl;\n}\nint main() {\nisnull(NULL);\nisnull(nullptr);\nreturn 0;\n}\n</code></pre> <p>\u7a0b\u5e8f\u6267\u884c\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>int n\nvoid*c\n</code></pre> <p>\u501f\u52a9\u6267\u884c\u7ed3\u679c\u4e0d\u96be\u770b\u51fa\uff0c\u7531\u4e8e nullptr \u65e0\u6cd5\u9690\u5f0f\u8f6c\u6362\u4e3a\u6574\u5f62\uff0c\u800c\u53ef\u4ee5\u9690\u5f0f\u5339\u914d\u6307\u9488\u7c7b\u578b\uff0c\u56e0\u6b64\u6267\u884c\u7ed3\u679c\u548c\u6211\u4eec\u7684\u9884\u671f\u76f8\u7b26\u3002</p> <p>\u603b\u4e4b\u5728 C++11 \u6807\u51c6\u4e0b\uff0c\u76f8\u6bd4 NULL \u548c 0\uff0c\u4f7f\u7528 nullptr \u521d\u59cb\u5316\u7a7a\u6307\u9488\u53ef\u4ee5\u4ee4\u6211\u4eec\u7f16\u5199\u7684\u7a0b\u5e8f\u66f4\u52a0\u5065\u58ee\u3002</p>"},{"location":"native/basic/Cplus_nullptr/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81eahttp://c.biancheng.net/view/7887.html</p>"},{"location":"native/basic/Cplus_shared_ptr/","title":"C++11 shared_ptr\u667a\u80fd\u6307\u9488","text":"<p>\u5728\u5b9e\u9645\u7684 C++ \u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u9047\u5230\u8bf8\u5982\u7a0b\u5e8f\u8fd0\u884c\u4e2d\u7a81\u7136\u5d29\u6e83\u3001\u7a0b\u5e8f\u8fd0\u884c\u6240\u7528\u5185\u5b58\u8d8a\u6765\u8d8a\u591a\u6700\u7ec8\u4e0d\u5f97\u4e0d\u91cd\u542f\u7b49\u95ee\u9898\uff0c\u8fd9\u4e9b\u95ee\u9898\u5f80\u5f80\u90fd\u662f\u5185\u5b58\u8d44\u6e90\u7ba1\u7406\u4e0d\u5f53\u9020\u6210\u7684\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u6709\u4e9b\u5185\u5b58\u8d44\u6e90\u5df2\u7ecf\u88ab\u91ca\u653e\uff0c\u4f46\u6307\u5411\u5b83\u7684\u6307\u9488\u5e76\u6ca1\u6709\u6539\u53d8\u6307\u5411\uff08\u6210\u4e3a\u4e86\u91ce\u6307\u9488\uff09\uff0c\u5e76\u4e14\u540e\u7eed\u8fd8\u5728\u4f7f\u7528\uff1b</li> <li>\u6709\u4e9b\u5185\u5b58\u8d44\u6e90\u5df2\u7ecf\u88ab\u91ca\u653e\uff0c\u540e\u671f\u53c8\u8bd5\u56fe\u518d\u91ca\u653e\u4e00\u6b21\uff08\u91cd\u590d\u91ca\u653e\u540c\u4e00\u5757\u5185\u5b58\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u8fd0\u884c\u5d29\u6e83\uff09\uff1b</li> <li>\u6ca1\u6709\u53ca\u65f6\u91ca\u653e\u4e0d\u518d\u4f7f\u7528\u7684\u5185\u5b58\u8d44\u6e90\uff0c\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\uff0c\u7a0b\u5e8f\u5360\u7528\u7684\u5185\u5b58\u8d44\u6e90\u8d8a\u6765\u8d8a\u591a\u3002</li> </ul> <p>\u9488\u5bf9\u4ee5\u4e0a\u8fd9\u4e9b\u60c5\u51b5\uff0c\u5f88\u591a\u7a0b\u5e8f\u5458\u8ba4\u4e3a C++ \u8bed\u8a00\u5e94\u8be5\u63d0\u4f9b\u66f4\u53cb\u597d\u7684\u5185\u5b58\u7ba1\u7406\u673a\u5236\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06\u7cbe\u529b\u96c6\u4e2d\u4e8e\u5f00\u53d1\u9879\u76ee\u7684\u5404\u4e2a\u529f\u80fd\u4e0a\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u663e\u793a\u5185\u5b58\u7ba1\u7406\u7684\u66ff\u4ee3\u65b9\u6848\u5f88\u65e9\u5c31\u6709\u4e86\uff0c\u65e9\u5728 1959 \u5e74\u524d\u540e\uff0c\u5c31\u6709\u4eba\u63d0\u51fa\u4e86\u201c\u5783\u573e\u81ea\u52a8\u56de\u6536\u201d\u673a\u5236\u3002\u6240\u8c13\u5783\u573e\uff0c\u6307\u7684\u662f\u90a3\u4e9b\u4e0d\u518d\u4f7f\u7528\u6216\u8005\u6ca1\u6709\u4efb\u4f55\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u800c\u201c\u56de\u6536\u201d\u5219\u6307\u7684\u662f\u5c06\u8fd9\u4e9b\u201c\u5783\u573e\u201d\u6536\u96c6\u8d77\u6765\u4ee5\u4fbf\u518d\u6b21\u5229\u7528\u3002</p> <p>\u5982\u4eca\uff0c\u5783\u573e\u56de\u6536\u673a\u5236\u5df2\u7ecf\u5927\u884c\u5176\u9053\uff0c\u5f97\u5230\u4e86\u8bf8\u591a\u7f16\u7a0b\u8bed\u8a00\u7684\u652f\u6301\uff0c\u4f8b\u5982 Java\u3001Python\u3001C#\u3001PHP \u7b49\u3002\u800c C++ \u867d\u7136\u4ece\u6765\u6ca1\u6709\u516c\u5f00\u5f97\u652f\u6301\u8fc7\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u4f46 C++98/03 \u6807\u51c6\u4e2d\uff0c\u652f\u6301\u4f7f\u7528 auto_ptr \u667a\u80fd\u6307\u9488\u6765\u5b9e\u73b0\u5806\u5185\u5b58\u7684\u81ea\u52a8\u56de\u6536\uff1bC++11 \u65b0\u6807\u51c6\u5728\u5e9f\u5f03 auto_ptr \u7684\u540c\u65f6\uff0c\u589e\u6dfb\u4e86 unique_ptr\u3001shared_ptr \u4ee5\u53ca weak_ptr \u8fd9 3 \u4e2a\u667a\u80fd\u6307\u9488\u6765\u5b9e\u73b0\u5806\u5185\u5b58\u7684\u81ea\u52a8\u56de\u6536\u3002</p> <p>\u6240\u8c13\u667a\u80fd\u6307\u9488\uff0c\u53ef\u4ee5\u4ece\u5b57\u9762\u4e0a\u7406\u89e3\u4e3a\u201c\u667a\u80fd\u201d\u7684\u6307\u9488\u3002\u5177\u4f53\u6765\u8bb2\uff0c\u667a\u80fd\u6307\u9488\u548c\u666e\u901a\u6307\u9488\u7684\u7528\u6cd5\u662f\u76f8\u4f3c\u7684\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u667a\u80fd\u6307\u9488\u53ef\u4ee5\u5728\u9002\u5f53\u65f6\u673a\u81ea\u52a8\u91ca\u653e\u5206\u914d\u7684\u5185\u5b58\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f7f\u7528\u667a\u80fd\u6307\u9488\u53ef\u4ee5\u5f88\u597d\u5730\u907f\u514d\u201c\u5fd8\u8bb0\u91ca\u653e\u5185\u5b58\u800c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u201d\u95ee\u9898\u51fa\u73b0\u3002\u7531\u6b64\u53ef\u89c1\uff0cC++ \u4e5f\u9010\u6e10\u5f00\u59cb\u652f\u6301\u5783\u573e\u56de\u6536\u673a\u5236\u4e86\uff0c\u5c3d\u7ba1\u76ee\u524d\u652f\u6301\u7a0b\u5ea6\u8fd8\u6709\u9650\u3002</p> <p>C++ \u667a\u80fd\u6307\u9488\u5e95\u5c42\u662f\u91c7\u7528\u5f15\u7528\u8ba1\u6570\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u3002\u7b80\u5355\u7684\u7406\u89e3\uff0c\u667a\u80fd\u6307\u9488\u5728\u7533\u8bf7\u5806\u5185\u5b58\u7a7a\u95f4\u7684\u540c\u65f6\uff0c\u4f1a\u4e3a\u5176\u914d\u5907\u4e00\u4e2a\u6574\u5f62\u503c\uff08\u521d\u59cb\u503c\u4e3a 1\uff09\uff0c\u6bcf\u5f53\u6709\u65b0\u5bf9\u8c61\u4f7f\u7528\u6b64\u5806\u5185\u5b58\u65f6\uff0c\u8be5\u6574\u5f62\u503c +1\uff1b\u53cd\u4e4b\uff0c\u6bcf\u5f53\u4f7f\u7528\u6b64\u5806\u5185\u5b58\u7684\u5bf9\u8c61\u88ab\u91ca\u653e\u65f6\uff0c\u8be5\u6574\u5f62\u503c\u51cf 1\u3002\u5f53\u5806\u7a7a\u95f4\u5bf9\u5e94\u7684\u6574\u5f62\u503c\u4e3a 0 \u65f6\uff0c\u5373\u8868\u660e\u4e0d\u518d\u6709\u5bf9\u8c61\u4f7f\u7528\u5b83\uff0c\u8be5\u5806\u7a7a\u95f4\u5c31\u4f1a\u88ab\u91ca\u653e\u6389\u3002</p>"},{"location":"native/basic/Cplus_shared_ptr/#c11-shared_ptr_1","title":"C++11 shared_ptr\u667a\u80fd\u6307\u9488","text":"<p>\u5b9e\u9645\u4e0a\uff0c\u6bcf\u79cd\u667a\u80fd\u6307\u9488\u90fd\u662f\u4ee5\u7c7b\u6a21\u677f\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\uff0cshared_ptr \u4e5f\u4e0d\u4f8b\u5916\u3002shared_ptr\uff08\u5176\u4e2d T \u8868\u793a\u6307\u9488\u6307\u5411\u7684\u5177\u4f53\u6570\u636e\u7c7b\u578b\uff09\u7684\u5b9a\u4e49\u4f4d\u4e8e<code>&lt;memory&gt;</code>\u5934\u6587\u4ef6\uff0c\u5e76\u4f4d\u4e8e std \u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u56e0\u6b64\u5728\u4f7f\u7528\u8be5\u7c7b\u578b\u6307\u9488\u65f6\uff0c\u7a0b\u5e8f\u4e2d\u5e94\u5305\u542b\u5982\u4e0b 2 \u884c\u4ee3\u7801\uff1a <pre><code>#include &lt;memory&gt;using namespace std;\n</code></pre> <p>\u6ce8\u610f\uff0c\u7b2c 2 \u884c\u4ee3\u7801\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u6dfb\u52a0\uff0c\u5219\u540e\u7eed\u5728\u4f7f\u7528 shared_ptr \u667a\u80fd\u6307\u9488\u65f6\uff0c\u5c31\u9700\u8981\u660e\u786e\u6307\u660e<code>std::</code>\u3002</p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u548c unique_ptr\u3001weak_ptr \u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u591a\u4e2a shared_ptr \u667a\u80fd\u6307\u9488\u53ef\u4ee5\u5171\u540c\u4f7f\u7528\u540c\u4e00\u5757\u5806\u5185\u5b58\u3002\u5e76\u4e14\uff0c\u7531\u4e8e\u8be5\u7c7b\u578b\u667a\u80fd\u6307\u9488\u5728\u5b9e\u73b0\u4e0a\u91c7\u7528\u7684\u662f\u5f15\u7528\u8ba1\u6570\u673a\u5236\uff0c\u5373\u4fbf\u6709\u4e00\u4e2a shared_ptr \u6307\u9488\u653e\u5f03\u4e86\u5806\u5185\u5b58\u7684\u201c\u4f7f\u7528\u6743\u201d\uff08\u5f15\u7528\u8ba1\u6570\u51cf 1\uff09\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u6307\u5411\u540c\u4e00\u5806\u5185\u5b58\u7684 shared_ptr \u6307\u9488\uff08\u53ea\u6709\u5f15\u7528\u8ba1\u6570\u4e3a 0 \u65f6\uff0c\u5806\u5185\u5b58\u624d\u4f1a\u88ab\u81ea\u52a8\u91ca\u653e\uff09\u3002</p>"},{"location":"native/basic/Cplus_shared_ptr/#1shared_ptr","title":"1\u3001shared_ptr\u667a\u80fd\u6307\u9488\u7684\u521b\u5efa","text":"<p>shared_ptr\\&lt;T&gt; \u7c7b\u6a21\u677f\u4e2d\uff0c\u63d0\u4f9b\u4e86\u591a\u79cd\u5b9e\u7528\u7684\u6784\u9020\u51fd\u6570\uff0c\u8fd9\u91cc\u7ed9\u8bfb\u8005\u5217\u4e3e\u4e86\u51e0\u4e2a\u5e38\u7528\u7684\u6784\u9020\u51fd\u6570\uff08\u4ee5\u6784\u5efa\u6307\u5411 int \u7c7b\u578b\u6570\u636e\u7684\u667a\u80fd\u6307\u9488\u4e3a\u4f8b\uff09\u3002</p> <p>1) \u901a\u8fc7\u5982\u4e0b 2 \u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u6784\u9020\u51fa shared_ptr \u7c7b\u578b\u7684\u7a7a\u667a\u80fd\u6307\u9488\uff1a <pre><code>std::shared_ptr&lt;int&gt; p1;             //\u4e0d\u4f20\u5165\u4efb\u4f55\u5b9e\u53c2\nstd::shared_ptr&lt;int&gt; p2(nullptr);    //\u4f20\u5165\u7a7a\u6307\u9488 nullptr\n</code></pre> <p>\u6ce8\u610f\uff0c\u7a7a\u7684 shared_ptr \u6307\u9488\uff0c\u5176\u521d\u59cb\u5f15\u7528\u8ba1\u6570\u4e3a 0\uff0c\u800c\u4e0d\u662f 1\u3002</p> <p>2) \u5728\u6784\u5efa shared_ptr \u667a\u80fd\u6307\u9488\uff0c\u4e5f\u53ef\u4ee5\u660e\u786e\u5176\u6307\u5411\u3002\u4f8b\u5982\uff1a</p> <pre><code>std::shared_ptr&lt;int&gt; p3(new int(10));\n</code></pre> <p>\u7531\u6b64\uff0c\u6211\u4eec\u5c31\u6210\u529f\u6784\u5efa\u4e86\u4e00\u4e2a shared_ptr \u667a\u80fd\u6307\u9488\uff0c\u5176\u6307\u5411\u4e00\u5757\u5b58\u6709 10 \u8fd9\u4e2a int \u7c7b\u578b\u6570\u636e\u7684\u5806\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u540c\u65f6\uff0cC++11 \u6807\u51c6\u4e2d\u8fd8\u63d0\u4f9b\u4e86 std::make_shared \u6a21\u677f\u51fd\u6570\uff0c\u5176\u53ef\u4ee5\u7528\u4e8e\u521d\u59cb\u5316 shared_ptr \u667a\u80fd\u6307\u9488\uff0c\u4f8b\u5982\uff1a <pre><code>std::shared_ptr&lt;int&gt; p3 = std::make_shared&lt;int&gt;(10);\n</code></pre> <p>\u4ee5\u4e0a 2 \u79cd\u65b9\u5f0f\u521b\u5efa\u7684 p3 \u662f\u5b8c\u5168\u76f8\u540c\u3002</p> <p>3) \u9664\u6b64\u4e4b\u5916\uff0cshared_ptr\\&lt;T&gt; \u6a21\u677f\u8fd8\u63d0\u4f9b\u6709\u76f8\u5e94\u7684\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u548c\u79fb\u52a8\u6784\u9020\u51fd\u6570\uff0c\u4f8b\u5982\uff1a</p> <pre><code>//\u8c03\u7528\u62f7\u8d1d\u6784\u9020\u51fd\u6570\nstd::shared_ptr&lt;int&gt; p4(p3);//\u6216\u8005 std::shared_ptr&lt;int&gt; p4 = p3;\n//\u8c03\u7528\u79fb\u52a8\u6784\u9020\u51fd\u6570\nstd::shared_ptr&lt;int&gt; p5(std::move(p4)); //\u6216\u8005 std::shared_ptr&lt;int&gt; p5 = std::move(p4);\n</code></pre> <p>\u6709\u5173\u62f7\u8d1d\u6784\u9020\u51fd\u6570\uff0c\u8bfb\u8005\u53ef\u9605\u8bfb\u300aC++\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u300b\u4e00\u8282\u505a\u7cfb\u7edf\u4e86\u89e3\uff1b\u6709\u5173\u79fb\u52a8\u6784\u9020\u51fd\u6570\uff0c\u8bfb\u8005\u53ef\u9605\u8bfb\u300aC++\u79fb\u52a8\u6784\u9020\u51fd\u6570\u300b\u505a\u8be6\u7ec6\u4e86\u89e3\uff1b\u6709\u5173 move() \u51fd\u6570\u7684\u529f\u80fd\u548c\u7528\u6cd5\uff0c\u8bfb\u8005\u53ef\u9605\u8bfb\u300aC++11 move()\u300b\u4e00\u8282\u3002</p> <p>\u5982\u4e0a\u6240\u793a\uff0cp3 \u548c p4 \u90fd\u662f shared_ptr \u7c7b\u578b\u7684\u667a\u80fd\u6307\u9488\uff0c\u56e0\u6b64\u53ef\u4ee5\u7528 p3 \u6765\u521d\u59cb\u5316 p4\uff0c\u7531\u4e8e p3 \u662f\u5de6\u503c\uff0c\u56e0\u6b64\u4f1a\u8c03\u7528\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c p3 \u4e3a\u7a7a\u667a\u80fd\u6307\u9488\uff0c\u5219 p4 \u4e5f\u4e3a\u7a7a\u667a\u80fd\u6307\u9488\uff0c\u5176\u5f15\u7528\u8ba1\u6570\u521d\u59cb\u503c\u4e3a 0\uff1b\u53cd\u4e4b\uff0c\u5219\u8868\u660e p4 \u548c p3 \u6307\u5411\u540c\u4e00\u5757\u5806\u5185\u5b58\uff0c\u540c\u65f6\u8be5\u5806\u7a7a\u95f4\u7684\u5f15\u7528\u8ba1\u6570\u4f1a\u52a0 1\u3002</p> <p>\u800c\u5bf9\u4e8e std::move(p4) \u6765\u8bf4\uff0c\u8be5\u51fd\u6570\u4f1a\u5f3a\u5236\u5c06 p4 \u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u53f3\u503c\uff0c\u56e0\u6b64\u521d\u59cb\u5316 p5 \u8c03\u7528\u7684\u662f\u79fb\u52a8\u6784\u9020\u51fd\u6570\u3002\u53e6\u5916\u548c\u8c03\u7528\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u4e0d\u540c\uff0c\u7528 std::move(p4) \u521d\u59cb\u5316 p5\uff0c\u4f1a\u4f7f\u5f97 p5 \u62e5\u6709\u4e86 p4 \u7684\u5806\u5185\u5b58\uff0c\u800c p4 \u5219\u53d8\u6210\u4e86\u7a7a\u667a\u80fd\u6307\u9488\u3002</p> <p>\u6ce8\u610f\uff0c\u540c\u4e00\u666e\u901a\u6307\u9488\u4e0d\u80fd\u540c\u65f6\u4e3a\u591a\u4e2a shared_ptr \u5bf9\u8c61\u8d4b\u503c\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u53d1\u751f\u5f02\u5e38\u3002\u4f8b\u5982\uff1a</p> <pre><code>int* ptr = new int;\nstd::shared_ptr&lt;int&gt; p1(ptr);\nstd::shared_ptr&lt;int&gt; p2(ptr);//\u9519\u8bef\n</code></pre> <p>4) \u5728\u521d\u59cb\u5316 shared_ptr \u667a\u80fd\u6307\u9488\u65f6\uff0c\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6240\u6307\u5806\u5185\u5b58\u7684\u91ca\u653e\u89c4\u5219\uff0c\u8fd9\u6837\u5f53\u5806\u5185\u5b58\u7684\u5f15\u7528\u8ba1\u6570\u4e3a 0 \u65f6\uff0c\u4f1a\u4f18\u5148\u8c03\u7528\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u91ca\u653e\u89c4\u5219\u3002</p> <p>\u5728\u67d0\u4e9b\u573a\u666f\u4e2d\uff0c\u81ea\u5b9a\u4e49\u91ca\u653e\u89c4\u5219\u662f\u5f88\u6709\u5fc5\u8981\u7684\u3002\u6bd4\u5982\uff0c\u5bf9\u4e8e\u7533\u8bf7\u7684\u52a8\u6001\u6570\u7ec4\u6765\u8bf4\uff0cshared_ptr \u6307\u9488\u9ed8\u8ba4\u7684\u91ca\u653e\u89c4\u5219\u662f\u4e0d\u652f\u6301\u91ca\u653e\u6570\u7ec4\u7684\uff0c\u53ea\u80fd\u81ea\u5b9a\u4e49\u5bf9\u5e94\u7684\u91ca\u653e\u89c4\u5219\uff0c\u624d\u80fd\u6b63\u786e\u5730\u91ca\u653e\u7533\u8bf7\u7684\u5806\u5185\u5b58\u3002</p> <p>\u5bf9\u4e8e\u7533\u8bf7\u7684\u52a8\u6001\u6570\u7ec4\uff0c\u91ca\u653e\u89c4\u5219\u53ef\u4ee5\u4f7f\u7528 C++11 \u6807\u51c6\u4e2d\u63d0\u4f9b\u7684 default_delete \u6a21\u677f\u7c7b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u91ca\u653e\u89c4\u5219\uff1a <pre><code>//\u6307\u5b9a default_delete \u4f5c\u4e3a\u91ca\u653e\u89c4\u5219\nstd::shared_ptr&lt;int&gt; p6(new int[10], std::default_delete&lt;int[]&gt;());\n//\u81ea\u5b9a\u4e49\u91ca\u653e\u89c4\u5219\nvoid deleteInt(int*p) {\ndelete []p;\n}\n//\u521d\u59cb\u5316\u667a\u80fd\u6307\u9488\uff0c\u5e76\u81ea\u5b9a\u4e49\u91ca\u653e\u89c4\u5219\nstd::shared_ptr&lt;int&gt; p7(new int[10], deleteInt);\n</code></pre> <p>\u5b9e\u9645\u4e0a\u501f\u52a9 lambda \u8868\u8fbe\u5f0f\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u50cf\u5982\u4e0b\u8fd9\u6837\u521d\u59cb\u5316 p7\uff0c\u5b83\u4eec\u662f\u5b8c\u5168\u76f8\u540c\u7684\uff1a</p> <pre><code>std::shared_ptr&lt;int&gt; p7(new int[10], [](int* p) {delete[]p; });\n</code></pre> <p>shared_ptr\\&lt;T&gt; \u6a21\u677f\u7c7b\u8fd8\u63d0\u4f9b\u6709\u5176\u5b83\u4e00\u4e9b\u521d\u59cb\u5316\u667a\u80fd\u6307\u9488\u7684\u65b9\u6cd5\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u524d\u5f80\u8bb2\u89e3 shared_ptr \u7684\u5b98\u7f51\u505a\u7cfb\u7edf\u4e86\u89e3\u3002</p>"},{"location":"native/basic/Cplus_shared_ptr/#2shared_ptrt","title":"2\u3001shared_ptr\\&lt;T&gt;\u6a21\u677f\u7c7b\u63d0\u4f9b\u7684\u6210\u5458\u65b9\u6cd5","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u7528\u6237\u4f7f\u7528 shared_ptr \u667a\u80fd\u6307\u9488\uff0cshared_ptr \u6a21\u677f\u7c7b\u8fd8\u63d0\u4f9b\u6709\u4e00\u4e9b\u5b9e\u7528\u7684\u6210\u5458\u65b9\u6cd5\uff0c\u5b83\u4eec\u5404\u81ea\u7684\u529f\u80fd\u5982\u8868 1 \u6240\u793a\u3002 \u6210\u5458\u65b9\u6cd5\u540d \u529f \u80fd operator=() \u91cd\u8f7d\u8d4b\u503c\u53f7\uff0c\u4f7f\u5f97\u540c\u4e00\u7c7b\u578b\u7684 shared_ptr \u667a\u80fd\u6307\u9488\u53ef\u4ee5\u76f8\u4e92\u8d4b\u503c\u3002 operator*() \u91cd\u8f7d * \u53f7\uff0c\u83b7\u53d6\u5f53\u524d shared_ptr \u667a\u80fd\u6307\u9488\u5bf9\u8c61\u6307\u5411\u7684\u6570\u636e\u3002 operator-&gt;() \u91cd\u8f7d -&gt; \u53f7\uff0c\u5f53\u667a\u80fd\u6307\u9488\u6307\u5411\u7684\u6570\u636e\u7c7b\u578b\u4e3a\u81ea\u5b9a\u4e49\u7684\u7ed3\u6784\u4f53\u65f6\uff0c\u901a\u8fc7 -&gt; \u8fd0\u7b97\u7b26\u53ef\u4ee5\u83b7\u53d6\u5176\u5185\u90e8\u7684\u6307\u5b9a\u6210\u5458\u3002 swap() \u4ea4\u6362 2 \u4e2a\u76f8\u540c\u7c7b\u578b shared_ptr \u667a\u80fd\u6307\u9488\u7684\u5185\u5bb9\u3002 reset() \u5f53\u51fd\u6570\u6ca1\u6709\u5b9e\u53c2\u65f6\uff0c\u8be5\u51fd\u6570\u4f1a\u4f7f\u5f53\u524d shared_ptr \u6240\u6307\u5806\u5185\u5b58\u7684\u5f15\u7528\u8ba1\u6570\u51cf 1\uff0c\u540c\u65f6\u5c06\u5f53\u524d\u5bf9\u8c61\u91cd\u7f6e\u4e3a\u4e00\u4e2a\u7a7a\u6307\u9488\uff1b\u5f53\u4e3a\u51fd\u6570\u4f20\u9012\u4e00\u4e2a\u65b0\u7533\u8bf7\u7684\u5806\u5185\u5b58\u65f6\uff0c\u5219\u8c03\u7528\u8be5\u51fd\u6570\u7684 shared_ptr \u5bf9\u8c61\u4f1a\u83b7\u5f97\u8be5\u5b58\u50a8\u7a7a\u95f4\u7684\u6240\u6709\u6743\uff0c\u5e76\u4e14\u5f15\u7528\u8ba1\u6570\u7684\u521d\u59cb\u503c\u4e3a 1\u3002 get() \u83b7\u5f97 shared_ptr \u5bf9\u8c61\u5185\u90e8\u5305\u542b\u7684\u666e\u901a\u6307\u9488\u3002 use_count() \u8fd4\u56de\u540c\u5f53\u524d shared_ptr \u5bf9\u8c61\uff08\u5305\u62ec\u5b83\uff09\u6307\u5411\u76f8\u540c\u7684\u6240\u6709 shared_ptr \u5bf9\u8c61\u7684\u6570\u91cf\u3002 unique() \u5224\u65ad\u5f53\u524d shared_ptr \u5bf9\u8c61\u6307\u5411\u7684\u5806\u5185\u5b58\uff0c\u662f\u5426\u4e0d\u518d\u6709\u5176\u5b83 shared_ptr \u5bf9\u8c61\u518d\u6307\u5411\u5b83\u3002 operator bool() \u5224\u65ad\u5f53\u524d shared_ptr \u5bf9\u8c61\u662f\u5426\u4e3a\u7a7a\u667a\u80fd\u6307\u9488\uff0c\u5982\u679c\u662f\u7a7a\u6307\u9488\uff0c\u8fd4\u56de false\uff1b\u53cd\u4e4b\uff0c\u8fd4\u56de true\u3002 <p>\u9664\u6b64\u4e4b\u5916\uff0cC++11 \u6807\u51c6\u8fd8\u652f\u6301\u540c\u4e00\u7c7b\u578b\u7684 shared_ptr \u5bf9\u8c61\uff0c\u6216\u8005 shared_ptr \u548c nullptr \u4e4b\u95f4\uff0c\u8fdb\u884c ==\uff0c!=\uff0c&lt;\uff0c&lt;=\uff0c&gt;\uff0c&gt;= \u8fd0\u7b97\u3002</p> <p>\u4e0b\u9762\u7a0b\u5e8f\u7ed9\u5927\u5bb6\u6f14\u793a\u4e86 shared_ptr \u667a\u80fd\u6307\u9488\u7684\u57fa\u672c\u7528\u6cd5\uff0c\u4ee5\u53ca\u8be5\u6a21\u677f\u7c7b\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6210\u5458\u65b9\u6cd5\u7684\u7528\u6cd5\uff1a</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;memory&gt;\nusing namespace std;\nint main()\n{\n//\u6784\u5efa 2 \u4e2a\u667a\u80fd\u6307\u9488\nstd::shared_ptr&lt;int&gt; p1(new int(10));\nstd::shared_ptr&lt;int&gt; p2(p1);\n//\u8f93\u51fa p2 \u6307\u5411\u7684\u6570\u636e\ncout &lt;&lt; *p2 &lt;&lt; endl;\np1.reset();//\u5f15\u7528\u8ba1\u6570\u51cf 1,p1\u4e3a\u7a7a\u6307\u9488\nif (p1) {\ncout &lt;&lt; \"p1 \u4e0d\u4e3a\u7a7a\" &lt;&lt; endl;\n}\nelse {\ncout &lt;&lt; \"p1 \u4e3a\u7a7a\" &lt;&lt; endl;\n}\n//\u4ee5\u4e0a\u64cd\u4f5c\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd p2\ncout &lt;&lt; *p2 &lt;&lt; endl;\n//\u5224\u65ad\u5f53\u524d\u548c p2 \u540c\u6307\u5411\u7684\u667a\u80fd\u6307\u9488\u6709\u591a\u5c11\u4e2a\ncout &lt;&lt; p2.use_count() &lt;&lt; endl;\nreturn 0;\n}\n</code></pre> <p>\u7a0b\u5e8f\u6267\u884c\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>10\np1 \u4e3a\u7a7a\n10\n1\n</code></pre>"},{"location":"native/basic/Cplus_shared_ptr/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea http://c.biancheng.net/view/7898.html</p>"},{"location":"native/basic/__emutls_get_address/","title":"dlopen\u65f6\u627e\u4e0d\u5230__emutls_get_address\u7b26\u53f7","text":"<p>\u8f6c\u81ea\uff1ahttps://zhuanlan.zhihu.com/p/392288963</p> <p>\u6700\u8fd1\u9047\u5230\u4e00\u4e2a\u6bd4\u8f83\u8be1\u5f02\u7684\u95ee\u9898\uff0c\u6709\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u4e4b\u524d\u662f\u9759\u6001\u94fe\u63a5\u7684STL\uff08c++_static\uff09\uff0c\u6539\u6210\u52a8\u6001\u94fe\u63a5STL\uff08c++_shared\uff09\u4e4b\u540e\uff0c\u5728&gt;=Android 11\u7684\u624b\u673a\u4e0a\u4f1a\u62a5dlopen\u62a5\u627e\u4e0d\u5230__emutls_get_address\u7b26\u53f7\u3002</p> <p>\u9996\u5148\u7528nm\u67e5\u770b\u4e0b\u8fd9\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\u91cc\u7684\u7b26\u53f7\uff1a</p> <pre><code>$ nm libxxx.so |grep __emutls_get_address\n         U __emutls_get_address\n</code></pre> <p>\u8fd9\u4e2aU\u8868\u793a\u672a\u5b9a\u4e49\uff0c\u4e5f\u5c31\u662f\u7b26\u53f7\u7684\u5b9a\u4e49\u5728\u5176\u4ed6\u5e93\u4e2d\u3002\u6211\u4eec\u7528\u7684\u662fndk21b\uff0c\u5230ndk\u7684\u76ee\u5f55\u770b\u4e0blibc++_shared.so\u91cc\u7684\u7b26\u53f7\uff1a</p> <pre><code>$ cd toolchains/llvm/prebuilt/darwin-x86_64/sysroot/usr/lib/arm-linux-androideabi\n$ nm libc++_shared.so |grep __emutls_get_address                                                        00070364 t __emutls_get_address\n</code></pre> <p>\u8fd9\u4e2a\u5c0f\u5199\u7684t\u8868\u793a\u662f\u5185\u90e8\u7b26\u53f7\uff0c\u4e0d\u66b4\u9732\u7ed9\u5916\u90e8\u4f7f\u7528\uff08\u66b4\u9732\u7ed9\u5916\u90e8\u7684\u8bdd\u5e94\u8be5\u662f\u5927\u5199\u7684T\uff09\u3002\u8fd9\u4e2a\u5c31\u6709\u70b9\u5947\u602a\u4e86\uff0c\u6211\u4eec\u7684\u52a8\u6001\u5e93\u91cc\u6ca1\u6709\u8fd9\u4e2a\u7b26\u53f7\uff0c\u7136\u540e\u4f9d\u8d56\u7684libc++_shared.so\u91cc\u7684\u7b26\u53f7\u53c8\u4e0d\u5bf9\u5916\u66b4\u9732\uff0c\u80af\u5b9a\u627e\u4e0d\u5230\u554a\u3002\u3002\u3002</p> <p>\u6700\u540e\u67e5\u51fa\u6765\u7684\u539f\u56e0\u662f\uff1a</p> <p>\u6211\u4eec\u7f16\u8bd1\u81ea\u5df1\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u7684\u662f\u8001\u7248\u672cndk\u91cc\u7684ibc++_shared.so\uff0c\u800c\u6253\u5305\u8fdbapk\u7684\uff0c\u662fndk21b\u91cc\u7684libc++_shared.so\u3002</p> <p>\u8fd9\u4e2a\u8001\u7248\u672c\u7684libc++_shared.so\u662f\u4f1a\u66b4\u9732\u8fd9\u4e2a__emutls_get_address\u7684\u7b26\u53f7\u7684\u3002\u7531\u4e8e\u8001\u7248\u672c\u7684\u5e93\u6ca1\u6709\u5e26\u7b26\u53f7\uff0c\u56e0\u6b64\u4e0d\u80fd\u7528nm\u547d\u4ee4\u67e5\u770b\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528readelf\u67e5\u770b\uff1a</p> <pre><code>$ readelf -s libc++_shared.so | grep __emutls_get_address\n  2110: 000846a0   316 FUNC    GLOBAL DEFAULT   11 __emutls_get_address\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u7b26\u53f7\u7684\u53ef\u89c1\u6027\u662fGLOBAL DEFAULT\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5readelf\u518d\u770b\u4e0bndk21b\u7684libc++_shared.so\u91cc\u7684\u7b26\u53f7\uff1a</p> <pre><code>$ readelf -s libc++_shared.so| grep __emutls_get_address                                  s\n 37081: 00070364   324 FUNC    LOCAL  HIDDEN    13 __emutls_get_address\n</code></pre> <p>\u53d1\u73b0\u533a\u522b\u6ca1\uff0c\u8fd9\u91cc\u7684\u53ef\u89c1\u6027\u662fLOCAL HIDDEN\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u5916\u66b4\u9732\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u94fe\u63a5\u5668\u4f1a\u81ea\u52a8\u5e2e\u6211\u4eec\u94fe\u63a5 libgcc_real.a\uff0c\u800clibgcc_real.a\u91cc\u662f\u5305\u542b\u8fd9\u4e2a\u7b26\u53f7\u7684\uff1a</p> <pre><code>$ cd toolchains/llvm/prebuilt/darwin-x86_64/lib/gcc/arm-linux-androideabi/4.9.x/armv7-a\n$ nm libgcc_real.a|grep __emutls_get_address\n0000020c T __emutls_get_address\n</code></pre> <p>\u7ed3\u8bba\uff1a</p> <p>\u7f16\u8bd1\u65f6\u7528\u7684stl\u7248\u672c\u4e00\u5b9a\u8981\u8ddf\u6253\u5305\u5230apk\u91cc\u7684stl\u7248\u672c\u4fdd\u6301\u4e00\u81f4\uff0c\u5426\u5219\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e9b\u83ab\u540d\u5176\u5999\u7684\u7248\u672c\u517c\u5bb9\u95ee\u9898\u3002</p> <p>P.S. \u5982\u679c\u4e0d\u6e05\u695a\u7b26\u53f7\u5728\u54ea\u4e2a\u5e93\u4e2d\uff0c\u53ef\u4ee5lldb attach\u5230app\u4e0a\uff0c\u7136\u540e\u7528<code>image lookup --symbol 'xxx'</code>\u5728\u6240\u6709\u4f9d\u8d56\u5e93\u4e2d\u8fdb\u884c\u641c\u7d22\u3002</p>"},{"location":"native/basic/compilation-principle/","title":"\u7f16\u8bd1\u539f\u7406","text":""},{"location":"native/basic/compilation-principle/#1","title":"1 \u7f16\u8bd1\u6d41\u7a0b","text":"<p>\u7f16\u8bd1\u5206\u4e3a\u56db\u5927\u8fc7\u7a0b\uff1a</p> <ul> <li>\u9884\u5904\u7406</li> </ul> <p>\u5b8c\u6210\u5b8f\u66ff\u6362\u3001\u6587\u4ef6\u5f15\u5165\uff0c\u4ee5\u53ca\u53bb\u9664\u7a7a\u884c\u3001\u6ce8\u91ca\u7b49\uff0c\u4e3a\u4e0b\u4e00\u6b65\u7684\u7f16\u8bd1\u505a\u51c6\u5907\u3002\u4e5f\u5c31\u662f\u5bf9\u5404\u79cd\u9884\u5904\u7406\u547d\u4ee4\u8fdb\u884c\u5904\u7406\uff0c\u5305\u62ec\u5934\u6587\u4ef6\u7684\u5305\u542b\u3001\u5b8f\u5b9a\u4e49\u7684\u6269\u5c55\u3001\u6761\u4ef6\u7f16\u8bd1\u7684\u9009\u62e9\u7b49\u3002</p> <ul> <li>\u7f16\u8bd1</li> </ul> <p>\u5c06\u9884\u5904\u7406\u540e\u7684\u4ee3\u7801\u7f16\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d\uff0c\u9996\u5148\u8981\u68c0\u67e5\u4ee3\u7801\u7684\u89c4\u8303\u6027\u3001\u662f\u5426\u6709\u8bed\u6cd5\u9519\u8bef\u7b49\uff0c\u4ee5\u786e\u5b9a\u4ee3\u7801\u5b9e\u9645\u8981\u505a\u7684\u5de5\u4f5c\uff0c\u5728\u68c0\u67e5\u65e0\u8bef\u540e\uff0c\u518d\u628a\u4ee3\u7801\u7ffb\u8bd1\u6210\u6c47\u7f16\u8bed\u8a00\u3002</p> <p>\u7f16\u8bd1\u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u5148\u5206\u6790\uff0c\u540e\u7efc\u5408\u3002\u5206\u6790\uff0c\u5c31\u662f\u6307\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\u3001\u8bed\u4e49\u5206\u6790\u548c\u4e2d\u95f4\u4ee3\u7801\u751f\u6210\u3002\u7efc\u5408\uff0c\u5c31\u662f\u6307\u4ee3\u7801\u4f18\u5316\u548c\u4ee3\u7801\u751f\u6210\u3002</p> <p>\u5927\u591a\u6570\u7684\u7f16\u8bd1\u7a0b\u5e8f\u76f4\u63a5\u4ea7\u751f\u673a\u5668\u8bed\u8a00\u7684\u76ee\u6807\u4ee3\u7801\uff0c\u5f62\u6210\u53ef\u6267\u884c\u7684\u76ee\u6807\u6587\u4ef6\uff0c\u4e5f\u6709\u7684\u662f\u5148\u4ea7\u751f\u6c47\u7f16\u8bed\u8a00\u4e00\u7ea7\u7684\u7b26\u53f7\u4ee3\u7801\u6587\u4ef6\uff0c\u518d\u8c03\u7528\u6c47\u7f16\u7a0b\u5e8f\u8fdb\u884c\u7ffb\u8bd1\u548c\u52a0\u5de5\u5904\u7406\uff0c\u6700\u540e\u4ea7\u751f\u53ef\u6267\u884c\u7684\u673a\u5668\u8bed\u8a00\u76ee\u6807\u6587\u4ef6\u3002</p> <ul> <li>\u6c47\u7f16</li> </ul> <p>\u6c47\u7f16\u5c31\u662f\u628a\u7f16\u8bd1\u9636\u6bb5\u751f\u6210\u7684\u201c\uff0es\u201d\u6587\u4ef6\u8f6c\u6210\u4e8c\u8fdb\u5236\u76ee\u6807\u4ee3\u7801\uff0c\u4e5f\u5c31\u662f\u673a\u5668\u4ee3\u7801\uff0801\u5e8f\u5217\uff09</p> <ul> <li>\u94fe\u63a5</li> </ul> <p>\u94fe\u63a5\u5c31\u662f\u5c06\u591a\u4e2a\u76ee\u6807\u6587\u4ef6\u4ee5\u53ca\u6240\u9700\u7684\u5e93\u6587\u4ef6\u94fe\u63a5\u751f\u6210\u53ef\u6267\u884c\u76ee\u6807\u6587\u4ef6\u7684\u8fc7\u7a0b</p>"},{"location":"native/basic/compilation-principle/#2","title":"2. \u52a8&amp;\u9759\u6001\u5e93","text":""},{"location":"native/basic/compilation-principle/#21","title":"2.1 \u9759\u6001\u5e93\uff1a","text":"<p>\u9759\u6001\u5e93\u5b9e\u9645\u5c31\u662f\u4e00\u4e9b\u76ee\u6807\u6587\u4ef6\uff08\u4e00\u822c\u4ee5.o\u7ed3\u5c3e\uff09\u7684\u96c6\u5408\uff0c\u9759\u6001\u5e93\u4e00\u822c\u4ee5.a\u7ed3\u5c3e\uff0c\u53ea\u7528\u4e8e\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u9636\u6bb5\u3002</p> <p>\u5728\u94fe\u63a5\u6b65\u9aa4\u4e2d\uff0c\u94fe\u63a5\u5668\u5c06\u4ece\u5e93\u6587\u4ef6\u53d6\u5f97\u6240\u9700\u4ee3\u7801\uff0c\u590d\u5236\u5230\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u3002\u8fd9\u79cd\u5e93\u79f0\u4e3a\u9759\u6001\u5e93\u3002\u5176\u7279\u70b9\u662f\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u5e93\u4ee3\u7801\u7684\u4e00\u4efd\u5b8c\u6574\u62f7\u8d1d\uff0c\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u88ab\u8f7d\u5165\u7a0b\u5e8f\u4e2d\u3002\u7f3a\u70b9\u5c31\u662f\u591a\u6b21\u4f7f\u7528\u5c31\u4f1a\u6709\u591a\u4efd\u5197\u4f59\u62f7\u8d1d\uff0c\u5e76\u4e14\u5bf9\u7a0b\u5e8f\u7684\u66f4\u65b0\u3001\u90e8\u7f72\u548c\u53d1\u5e03\u4f1a\u5e26\u6765\u9ebb\u70e6\uff0c\u5982\u679c\u9759\u6001\u5e93\u6709\u66f4\u65b0\uff0c\u90a3\u4e48\u6240\u6709\u4f7f\u7528\u5b83\u7684\u7a0b\u5e8f\u90fd\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u3001\u53d1\u5e03</p>"},{"location":"native/basic/compilation-principle/#22","title":"2.2 \u52a8\u6001\u5e93\uff1a","text":"<p>\u52a8\u6001\u5e93\u5728\u94fe\u63a5\u9636\u6bb5\u6ca1\u6709\u88ab\u590d\u5236\u5230\u7a0b\u5e8f\u4e2d\uff0c\u800c\u662f\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7531\u7cfb\u7edf\u52a8\u6001\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u4f9b\u7a0b\u5e8f\u8c03\u7528\u3002</p> <p>\u7cfb\u7edf\u53ea\u9700\u8f7d\u5165\u4e00\u6b21\u52a8\u6001\u5e93\uff0c\u4e0d\u540c\u7684\u7a0b\u5e8f\u53ef\u4ee5\u5f97\u5230\u5185\u5b58\u4e2d\u76f8\u540c\u52a8\u6001\u5e93\u7684\u526f\u672c\uff0c\u56e0\u6b64\u8282\u7701\u4e86\u5f88\u591a\u5185\u5b58\u3002</p>"},{"location":"native/basic/compilation-principle/#23","title":"2.3 \u9759\u6001\u5e93\u4e0e\u52a8\u6001\u5e93\u533a\u522b","text":"<p>\u8f7d\u5165\u65f6\u523b\u4e0d\u540c \uff1a</p> <ul> <li> <p>\u9759\u6001\u5e93\u5728\u7a0b\u5e8f\u7f16\u8bd1\u65f6\u4f1a\u94fe\u63a5\u5230\u76ee\u6807\u4ee3\u7801\u4e2d\uff0c\u7a0b\u5e8f\u8fd0\u884c\u65f6\u4e0d\u518d\u9700\u8981\u9759\u6001\u5e93\uff0c\u56e0\u6b64\u4f53\u79ef\u8f83\u5927\u3002\u800c\u4e14\u6bcf\u6b21\u7f16\u8bd1\u90fd\u9700\u8981\u8f7d\u5165\u9759\u6001\u4ee3\u7801\uff0c\u56e0\u6b64\u5185\u5b58\u5f00\u9500\u5927\u3002</p> </li> <li> <p>\u52a8\u6001\u5e93\u5728\u7a0b\u5e8f\u7f16\u8bd1\u65f6\u4e0d\u4f1a\u88ab\u94fe\u63a5\u5230\u76ee\u6807\u4ee3\u7801\u4e2d\uff0c\u800c\u662f\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u624d\u88ab\u8f7d\u5165\uff0c\u7a0b\u5e8f\u8fd0\u884c\u65f6\u9700\u8981\u52a8\u6001\u5e93\u5b58\u5728\uff0c\u56e0\u6b64\u4f53\u79ef\u8f83\u5c0f\u3002\u800c\u4e14\u7cfb\u7edf\u53ea\u9700\u8f7d\u5165\u4e00\u6b21\u52a8\u6001\u5e93\uff0c\u4e0d\u540c\u7a0b\u5e8f\u53ef\u4ee5\u5f97\u5230\u5185\u5b58\u4e2d\u76f8\u540c\u7684\u52a8\u6001\u5e93\u526f\u672c\uff0c\u56e0\u6b64\u5185\u5b58\u5f00\u9500\u5c0f\u3002</p> </li> </ul>"},{"location":"native/basic/compilation-principle/#3-makefile","title":"3. Makefile","text":"<p>makefile\u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217\u7684\u89c4\u5219\u6765\u6307\u5b9a\uff0c\u54ea\u4e9b\u6587\u4ef6\u9700\u8981\u5148\u7f16\u8bd1\uff0c\u54ea\u4e9b\u6587\u4ef6\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\uff0c\u5982\u4f55\u8fdb\u884c\u94fe\u63a5\u7b49\u64cd\u4f5c\u3002makefile \u5c31\u662f\u201c\u81ea\u52a8\u5316\u7f16\u8bd1\u201d\uff0c\u544a\u8bc9make\u547d\u4ee4\u5982\u4f55\u7f16\u8bd1\u548c\u94fe\u63a5\u3002</p>"},{"location":"native/basic/compilation-principle/#31-makefile","title":"3.1 Makefile\u8bed\u6cd5","text":"<p>Makefile\u5305\u542b\u4e86\u4e94\u4e2a\u91cd\u8981\u7684\u4e1c\u897f\uff1a\u663e\u793a\u89c4\u5219\u3001\u9690\u6666\u89c4\u5219\u3001\u53d8\u91cf\u5b9a\u4e49\u3001\u6587\u4ef6\u6307\u793a\u548c\u6ce8\u91ca\u3002</p> <ol> <li>\u663e\u793a\u89c4\u5219\uff1a\u663e\u793a\u89c4\u5219\u8bf4\u660e\u4e86\uff0c\u5982\u4f55\u751f\u6210\u4e00\u4e2a\u6216\u591a\u4e2a\u76ee\u6807\u3002\u8fd9\u662f\u7531Makefile\u6307\u51fa\u8981\u751f\u6210\u7684\u6587\u4ef6\u548c\u6587\u4ef6\u4f9d\u8d56\u7684\u6587\u4ef6\u3002</li> <li>\u9690\u6666\u89c4\u5219\uff1a\u57fa\u4e8eMakefile\u7684\u81ea\u52a8\u63a8\u5bfc\u529f\u80fd</li> <li>\u53d8\u91cf\u7684\u5b9a\u4e49\uff1a\u4e00\u822c\u662f\u5b57\u7b26\u4e32</li> <li>\u6587\u4ef6\u6307\u793a\uff1a\u4e00\u822c\u662f\u5728Makefile\u4e2d\u5f15\u7528\u53e6\u5916\u4e00\u4e2amakefile\u6587\u4ef6\uff1b\u6839\u636e\u67d0\u4e9b\u89c4\u5219\u6307\u5b9aMakefile\u4e2d\u6709\u6548\u7684\u90e8\u5206\uff1b\u591a\u884c</li> <li>\u6ce8\u91ca\uff1a#\u6307\u793a\u6ce8\u91ca</li> </ol>"},{"location":"native/basic/compilation-principle/#32-makefile","title":"3.2 Makefile\u662f\u5982\u4f55\u5de5\u4f5c\u7684","text":"<p>\u9ed8\u8ba4\u65b9\u5f0f\u4e0b\uff0c\u8f93\u5165<code>make</code>\u547d\u4ee4\u540e\uff1a</p> <ul> <li> <p>make \u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u627e\u540d\u5b57\u53eb\u201cMakefile\u201d\u6216\u201cmakefile\u201d\u7684\u6587\u4ef6\u3002</p> </li> <li> <p>\u5982\u679c\u627e\u5230\uff0c\u5b83\u4f1a\u627e\u6587\u4ef6\u4e2d\u7b2c\u4e00\u4e2a\u76ee\u6807\u6587\u4ef6\uff08target\uff09\uff0c\u5e76\u628a\u8fd9\u4e2atarget\u4f5c\u4e3a\u6700\u7ec8\u7684\u76ee\u6807\u6587\u4ef6\uff0c\u5982\u524d\u9762\u793a\u4f8b\u4e2d\u7684\u201cmain\u201d\u3002</p> </li> <li> <p>\u5982\u679c main \u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u6216main\u6240\u4f9d\u8d56\u7684.o\u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\u8981\u6bd4main\u6587\u4ef6\u8981\u65b0\uff0c\u90a3\u4e48\u5b83\u4f1a\u6267\u884c\u540e\u9762\u6240\u5b9a\u4e49\u7684\u547d\u4ee4\u6765\u751f\u6210main\u6587\u4ef6\u3002</p> </li> <li> <p>\u5982\u679c main \u6240\u4f9d\u8d56\u7684.o\u6587\u4ef6\u4e5f\u5b58\u5728\uff0c\u90a3\u4e48make\u4f1a\u5728\u5f53\u524d\u6587\u4ef6\u4e2d\u627e\u76ee\u6807\u4e3a.o\u6587\u4ef6\u7684\u4f9d\u8d56\u6027\uff0c\u82e5\u627e\u5230\u5219\u6839\u636e\u89c4\u5219\u751f\u6210.o\u6587\u4ef6\u3002</p> </li> <li> <p>make \u518d\u7528.o\u6587\u4ef6\u58f0\u660emake\u7684\u7ec8\u6781\u4efb\u52a1\uff0c\u4e5f\u5c31\u662f\u6267\u884c\u6587\u4ef6\u201cmain\u201d\u3002</p> </li> </ul>"},{"location":"native/basic/compilation-principle/#33","title":"3.3 \u793a\u4f8b","text":"<pre><code>CC = gcc  RM = rm  CFLAGS += -D _YUQIANG  TARGETS := myapp  all:$(TARGETS)  \n$(TARGETS):main.c  \n$(CC) $(CFLAGS) $^ -o $@  clean:  -$(RM) -f *.o  -$(RM) -f $(TARGETS)\n</code></pre>"},{"location":"native/basic/compilation-principle/#4-cmake","title":"4. CMake","text":"<p>CMake\u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u6784\u5efa\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u7b80\u5355\u7684\u8bed\u53e5\u6765\u63cf\u8ff0\u6240\u6709\u5e73\u53f0\u7684\u5b89\u88c5\uff08\u7f16\u8bd1\u8fc7\u7a0b\uff09\u3002\u80fd\u591f\u8f93\u51fa\u5404\u79cd\u5404\u6837\u7684makefile\u6216\u8005project\u6587\u4ef6\u3002CMake\u5e76\u4e0d\u76f4\u63a5\u6784\u5efa\u51fa\u6700\u7ec8\u7684\u8f6f\u4ef6\uff0c\u800c\u662f\u4ea7\u751f\u5176\u4ed6\u5de5\u5177\u7684\u811a\u672c\uff08\u5982makefile\uff09\uff0c\u7136\u540e\u518d\u4f9d\u636e\u8fd9\u4e2a\u5de5\u5177\u7684\u6784\u5efa\u65b9\u5f0f\u4f7f\u7528\u3002</p> <p>CMake\u662f\u4e00\u4e2a\u6bd4make\u66f4\u9ad8\u7ea7\u7684\u7f16\u8bd1\u914d\u7f6e\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u5e73\u53f0\u3001\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\uff0c\u751f\u6210\u76f8\u5e94\u7684makefile\u6216\u8005vcproj\u9879\u76ee\uff0c\u4ece\u800c\u8fbe\u5230\u8de8\u5e73\u53f0\u7684\u76ee\u7684\u3002Android Studio\u5229\u7528CMake\u751f \u6210\u7684\u662fninja\u3002ninja\u662f\u4e00\u4e2a\u5c0f\u578b\u7684\u5173\u6ce8\u901f\u5ea6\u7684\u6784\u5efa\u7cfb\u7edf\u3002\u6211\u4eec\u4e0d\u9700\u8981\u5173\u5fc3ninja\u7684\u811a\u672c\uff0c\u77e5\u9053\u600e\u4e48\u914d\u7f6eCMake\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>CMake\u5176\u5b9e\u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u652f\u6301\u4ea7\u51fa\u5404\u79cd\u4e0d\u540c\u7684\u6784\u5efa\u811a\u672c\u7684\u4e00\u4e2a\u5de5\u5177\u3002</p> <p>\u5728Android Studio 2.2\u53ca\u4ee5\u4e0a\uff0c\u6784\u5efa\u539f\u751f\u5e93\u7684\u9ed8\u8ba4\u5de5\u5177\u662fCMake\u3002</p>"},{"location":"native/basic/compilation-principle/#41-cmake","title":"4.1 CMake\u5e38\u7528\u547d\u4ee4","text":""},{"location":"native/basic/compilation-principle/#cmake","title":"\u6307\u5b9a cmake \u7684\u6700\u5c0f\u7248\u672c","text":"<p><pre><code>cmake_minimum_required(VERSION 3.4.1)\n</code></pre> \u8fd9\u884c\u547d\u4ee4\u662f\u53ef\u9009\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u5199\u8fd9\u53e5\u8bdd\uff0c\u4f46\u5728\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5982\u679c CMakeLists.txt \u6587\u4ef6\u4e2d\u4f7f\u7528\u4e86\u4e00\u4e9b\u9ad8\u7248\u672c cmake \u7279\u6709\u7684\u4e00\u4e9b\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u52a0\u4e0a\u8fd9\u6837\u4e00\u884c\uff0c\u63d0\u9192\u7528\u6237\u5347\u7ea7\u5230\u8be5\u7248\u672c\u4e4b\u540e\u518d\u6267\u884c cmake\u3002</p>"},{"location":"native/basic/compilation-principle/#_2","title":"\u8bbe\u7f6e\u9879\u76ee\u540d\u79f0","text":"<p><pre><code>project(demo)\n</code></pre> \u8fd9\u4e2a\u547d\u4ee4\u4e0d\u662f\u5f3a\u5236\u6027\u7684\uff0c\u4f46\u6700\u597d\u90fd\u52a0\u4e0a\u3002\u5b83\u4f1a\u5f15\u5165\u4e24\u4e2a\u53d8\u91cf <code>demo_BINARY_DIR</code> \u548c <code>demo_SOURCE_DIR</code>\uff0c\u540c\u65f6\uff0ccmake \u81ea\u52a8\u5b9a\u4e49\u4e86\u4e24\u4e2a\u7b49\u4ef7\u7684\u53d8\u91cf <code>PROJECT_BINARY_DIR</code> \u548c <code>PROJECT_SOURCE_DIR</code>\u3002</p>"},{"location":"native/basic/compilation-principle/#_3","title":"\u8bbe\u7f6e\u7f16\u8bd1\u7c7b\u578b","text":"<p><pre><code>add_executable(demo demo.cpp) # \u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\nadd_library(common STATIC util.cpp) # \u751f\u6210\u9759\u6001\u5e93\nadd_library(common SHARED util.cpp) # \u751f\u6210\u52a8\u6001\u5e93\u6216\u5171\u4eab\u5e93\nadd_library \u9ed8\u8ba4\u751f\u6210\u662f\u9759\u6001\u5e93\uff0c\u901a\u8fc7\u4ee5\u4e0a\u547d\u4ee4\u751f\u6210\u6587\u4ef6\u540d\u5b57\uff0c\n</code></pre> \u5728 Linux \u4e0b\u662f\uff1a</p> <pre><code>demo\nlibcommon.a\nlibcommon.so\n</code></pre> <p>\u5728 Windows \u4e0b\u662f\uff1a</p> <pre><code>demo.exe\ncommon.lib\ncommon.dll\n</code></pre>"},{"location":"native/basic/compilation-principle/#_4","title":"\u6307\u5b9a\u7f16\u8bd1\u5305\u542b\u7684\u6e90\u6587\u4ef6","text":""},{"location":"native/basic/compilation-principle/#_5","title":"\u660e\u786e\u6307\u5b9a\u5305\u542b\u54ea\u4e9b\u6e90\u6587\u4ef6","text":"<pre><code>add_library(demo demo.cpp test.cpp util.cpp)\n</code></pre>"},{"location":"native/basic/compilation-principle/#cpp","title":"\u641c\u7d22\u6240\u6709\u7684 cpp \u6587\u4ef6","text":"<p>aux_source_directory(dir VAR) \u53d1\u73b0\u4e00\u4e2a\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6e90\u4ee3\u7801\u6587\u4ef6\u5e76\u5c06\u5217\u8868\u5b58\u50a8\u5728\u4e00\u4e2a\u53d8\u91cf\u4e2d\u3002</p> <pre><code>aux_source_directory(. SRC_LIST) # \u641c\u7d22\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709.cpp\u6587\u4ef6\nadd_library(demo ${SRC_LIST})\n</code></pre>"},{"location":"native/basic/compilation-principle/#_6","title":"\u81ea\u5b9a\u4e49\u641c\u7d22\u89c4\u5219","text":"<pre><code>file(GLOB SRC_LIST \"*.cpp\" \"protocol/*.cpp\")\nadd_library(demo ${SRC_LIST})\n# \u6216\u8005\nfile(GLOB SRC_LIST \"*.cpp\")\nfile(GLOB SRC_PROTOCOL_LIST \"protocol/*.cpp\")\nadd_library(demo ${SRC_LIST} ${SRC_PROTOCOL_LIST})\n# \u6216\u8005\naux_source_directory(. SRC_LIST)\naux_source_directory(protocol SRC_PROTOCOL_LIST)\nadd_library(demo ${SRC_LIST} ${SRC_PROTOCOL_LIST})\n</code></pre>"},{"location":"native/basic/compilation-principle/#_7","title":"\u67e5\u627e\u6307\u5b9a\u7684\u5e93\u6587\u4ef6","text":"<p><pre><code>find_library(VAR name path)\u67e5\u627e\u5230\u6307\u5b9a\u7684\u9884\u7f16\u8bd1\u5e93\uff0c\u5e76\u5c06\u5b83\u7684\u8def\u5f84\u5b58\u50a8\u5728\u53d8\u91cf\u4e2d\u3002\n\u9ed8\u8ba4\u7684\u641c\u7d22\u8def\u5f84\u4e3a cmake \u5305\u542b\u7684\u7cfb\u7edf\u5e93\uff0c\u56e0\u6b64\u5982\u679c\u662f NDK \u7684\u516c\u5171\u5e93\u53ea\u9700\u8981\u6307\u5b9a\u5e93\u7684 name \u5373\u53ef\u3002\nfind_library( # Sets the name of the path variable.\nlog-lib\n# Specifies the name of the NDK library that\n# you want CMake to locate.\nlog )\n</code></pre> \u7c7b\u4f3c\u7684\u547d\u4ee4\u8fd8\u6709 find_file()\u3001find_path()\u3001find_program()\u3001find_package()\u3002</p>"},{"location":"native/basic/compilation-principle/#_8","title":"\u8bbe\u7f6e\u5305\u542b\u7684\u76ee\u5f55","text":"<p><pre><code>include_directories(\n${CMAKE_CURRENT_SOURCE_DIR}\n${CMAKE_CURRENT_BINARY_DIR}\n${CMAKE_CURRENT_SOURCE_DIR}/include\n)\n</code></pre> Linux \u4e0b\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\u5305\u542b\u7684\u76ee\u5f55 <pre><code>set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -I${CMAKE_CURRENT_SOURCE_DIR}\")\n</code></pre></p>"},{"location":"native/basic/compilation-principle/#_9","title":"\u8bbe\u7f6e\u94fe\u63a5\u5e93\u641c\u7d22\u76ee\u5f55","text":"<p><pre><code>link_directories(\n${CMAKE_CURRENT_SOURCE_DIR}/libs\n)\n</code></pre> Linux \u4e0b\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u8bbe\u7f6e\u5305\u542b\u7684\u76ee\u5f55 <pre><code>set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -L${CMAKE_CURRENT_SOURCE_DIR}/libs\")\n</code></pre></p>"},{"location":"native/basic/compilation-principle/#target","title":"\u8bbe\u7f6e target \u9700\u8981\u94fe\u63a5\u7684\u5e93","text":"<p><pre><code>target_link_libraries( # \u76ee\u6807\u5e93\ndemo\n# \u76ee\u6807\u5e93\u9700\u8981\u94fe\u63a5\u7684\u5e93\n# log-lib \u662f\u4e0a\u9762 find_library \u6307\u5b9a\u7684\u53d8\u91cf\u540d\n${log-lib} )\n</code></pre> \u5728 Windows \u4e0b\uff0c\u7cfb\u7edf\u4f1a\u6839\u636e\u94fe\u63a5\u5e93\u76ee\u5f55\uff0c\u641c\u7d22xxx.lib \u6587\u4ef6\uff0cLinux \u4e0b\u4f1a\u641c\u7d22 xxx.so \u6216\u8005 xxx.a \u6587\u4ef6\uff0c\u5982\u679c\u90fd\u5b58\u5728\u4f1a\u4f18\u5148\u94fe\u63a5\u52a8\u6001\u5e93\uff08so \u540e\u7f00\uff09\u3002</p>"},{"location":"native/basic/compilation-principle/#_10","title":"\u6307\u5b9a\u94fe\u63a5\u52a8\u6001\u5e93\u6216\u9759\u6001\u5e93","text":"<pre><code>target_link_libraries(demo libface.a) # \u94fe\u63a5libface.a\ntarget_link_libraries(demo libface.so) # \u94fe\u63a5libface.so\n</code></pre>"},{"location":"native/basic/compilation-principle/#_11","title":"\u6307\u5b9a\u5168\u8def\u5f84","text":"<pre><code>target_link_libraries(demo ${CMAKE_CURRENT_SOURCE_DIR}/libs/libface.a)\ntarget_link_libraries(demo ${CMAKE_CURRENT_SOURCE_DIR}/libs/libface.so)\n</code></pre>"},{"location":"native/basic/compilation-principle/#_12","title":"\u6307\u5b9a\u94fe\u63a5\u591a\u4e2a\u5e93","text":"<pre><code>target_link_libraries(demo\n${CMAKE_CURRENT_SOURCE_DIR}/libs/libface.a\nboost_system.a\nboost_thread\npthread)\n</code></pre>"},{"location":"native/basic/compilation-principle/#_13","title":"\u8bbe\u7f6e\u53d8\u91cf","text":""},{"location":"native/basic/compilation-principle/#set","title":"set \u76f4\u63a5\u8bbe\u7f6e\u53d8\u91cf\u7684\u503c","text":"<pre><code>set(SRC_LIST main.cpp test.cpp)\nadd_executable(demo ${SRC_LIST})\n</code></pre>"},{"location":"native/basic/compilation-principle/#set_1","title":"set \u8ffd\u52a0\u8bbe\u7f6e\u53d8\u91cf\u7684\u503c","text":"<pre><code>set(SRC_LIST main.cpp)\nset(SRC_LIST ${SRC_LIST} test.cpp)\nadd_executable(demo ${SRC_LIST})\n</code></pre>"},{"location":"native/basic/compilation-principle/#list","title":"list \u8ffd\u52a0\u6216\u8005\u5220\u9664\u53d8\u91cf\u7684\u503c","text":"<pre><code>set(SRC_LIST main.cpp)\nlist(APPEND SRC_LIST test.cpp)\nlist(REMOVE_ITEM SRC_LIST main.cpp)\nadd_executable(demo ${SRC_LIST})\n</code></pre>"},{"location":"native/basic/compilation-principle/#_14","title":"\u6761\u4ef6\u63a7\u5236","text":""},{"location":"native/basic/compilation-principle/#ifelseifelseendif","title":"if\u2026elseif\u2026else\u2026endif","text":"<p>\u903b\u8f91\u5224\u65ad\u548c\u6bd4\u8f83\uff1a</p> <ul> <li> <p><code>if (expression)\uff1aexpression</code> \u4e0d\u4e3a\u7a7a\uff080,N,NO,OFF,FALSE,NOTFOUND\uff09\u65f6\u4e3a\u771f</p> </li> <li> <p><code>if (not exp)</code>\uff1a\u4e0e\u4e0a\u9762\u76f8\u53cd</p> </li> <li> <p><code>if (var1 AND var2)</code></p> </li> <li> <p><code>if (var1 OR var2)</code></p> </li> <li> <p><code>if (COMMAND cmd)</code>\uff1a\u5982\u679c cmd \u786e\u5b9e\u662f\u547d\u4ee4\u5e76\u53ef\u8c03\u7528\u4e3a\u771f</p> </li> <li> <p><code>if (EXISTS dir) if (EXISTS file)</code>\uff1a\u5982\u679c\u76ee\u5f55\u6216\u6587\u4ef6\u5b58\u5728\u4e3a\u771f</p> </li> <li> <p><code>if (file1 IS_NEWER_THAN file2)</code>\uff1a\u5f53 file1 \u6bd4 file2 \u65b0\uff0c\u6216 file1/file2 \u4e2d\u6709\u4e00\u4e2a\u4e0d\u5b58\u5728\u65f6\u4e3a\u771f\uff0c\u6587\u4ef6\u540d\u9700\u4f7f\u7528\u5168\u8def\u5f84</p> </li> <li> <p><code>if (IS_DIRECTORY dir)</code>\uff1a\u5f53 dir \u662f\u76ee\u5f55\u65f6\u4e3a\u771f</p> </li> <li> <p><code>if (DEFINED var)</code>\uff1a\u5982\u679c\u53d8\u91cf\u88ab\u5b9a\u4e49\u4e3a\u771f</p> </li> <li> <p><code>if (var MATCHES regex)</code>\uff1a\u7ed9\u5b9a\u7684\u53d8\u91cf\u6216\u8005\u5b57\u7b26\u4e32\u80fd\u591f\u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f regex \u65f6\u4e3a\u771f\uff0c\u6b64\u5904 var \u53ef\u4ee5\u7528 var \u540d\uff0c\u4e5f\u53ef\u4ee5\u7528 ${var}</p> </li> <li> <p><code>if (string MATCHES regex)</code></p> </li> </ul> <p>\u6570\u5b57\u6bd4\u8f83\uff1a</p> <ul> <li> <p><code>if (variable LESS number)</code>\uff1aLESS \u5c0f\u4e8e</p> </li> <li> <p><code>if (string LESS number)</code></p> </li> <li> <p><code>if (variable GREATER number)</code>\uff1aGREATER \u5927\u4e8e</p> </li> <li> <p><code>if (string GREATER number)</code></p> </li> <li> <p><code>if (variable EQUAL number)</code>\uff1aEQUAL \u7b49\u4e8e</p> </li> <li> <p><code>if (string EQUAL number)</code></p> </li> </ul> <p>\u5b57\u6bcd\u8868\u987a\u5e8f\u6bd4\u8f83\uff1a</p> <ul> <li> <p><code>if (variable STRLESS string)</code></p> </li> <li> <p><code>if (string STRLESS string)</code></p> </li> <li> <p><code>if (variable STRGREATER string)</code></p> </li> <li> <p><code>if (string STRGREATER string)</code></p> </li> <li> <p><code>if (variable STREQUAL string)</code></p> </li> <li> <p><code>if (string STREQUAL string)</code></p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>if(MSVC)\nset(LINK_LIBS common)\nelse()\nset(boost_thread boost_log.a boost_system.a)\nendif()\ntarget_link_libraries(demo ${LINK_LIBS})\n# \u6216\u8005\nif(UNIX)\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -std=c++11 -fpermissive -g\")\nelse()\nadd_definitions(-D_SCL_SECURE_NO_WARNINGS\nD_CRT_SECURE_NO_WARNINGS\n-D_WIN32_WINNT=0x601\n-D_WINSOCK_DEPRECATED_NO_WARNINGS)\nendif()\nif(${CMAKE_BUILD_TYPE} MATCHES \"debug\")\n...\nelse()\n...\nendif()\n</code></pre>"},{"location":"native/basic/compilation-principle/#whileendwhile","title":"while\u2026endwhile","text":"<pre><code>while(condition)\n...\nendwhile()\n</code></pre>"},{"location":"native/basic/compilation-principle/#foreachendforeach","title":"foreach\u2026endforeach","text":"<pre><code>foreach(loop_var RANGE start stop [step])\n...\nendforeach(loop_var)\nstart \u8868\u793a\u8d77\u59cb\u6570\uff0cstop \u8868\u793a\u7ec8\u6b62\u6570\uff0cstep \u8868\u793a\u6b65\u957f\uff0c\u793a\u4f8b\uff1a\nforeach(i RANGE 1 9 2)\nmessage(${i})\nendforeach(i)\n# \u8f93\u51fa\uff1a13579\n</code></pre>"},{"location":"native/basic/compilation-principle/#_15","title":"\u6253\u5370\u4fe1\u606f","text":"<pre><code>message(${PROJECT_SOURCE_DIR})\nmessage(\"build with debug mode\")\nmessage(WARNING \"this is warnning message\")\nmessage(FATAL_ERROR \"this build has many error\") # FATAL_ERROR \u4f1a\u5bfc\u81f4\u7f16\u8bd1\u5931\u8d25\n</code></pre>"},{"location":"native/basic/compilation-principle/#cmake_1","title":"\u5305\u542b\u5176\u5b83 cmake \u6587\u4ef6","text":"<pre><code>include(./common.cmake) # \u6307\u5b9a\u5305\u542b\u6587\u4ef6\u7684\u5168\u8def\u5f84\ninclude(def) # \u5728\u641c\u7d22\u8def\u5f84\u4e2d\u641c\u7d22def.cmake\u6587\u4ef6\nset(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake) # \u8bbe\u7f6einclude\u7684\u641c\u7d22\u8def\u5f84\n</code></pre>"},{"location":"native/basic/compilation-principle/#43-cmake","title":"4.3  CMake\u5e38\u7528\u53d8\u91cf","text":""},{"location":"native/basic/compilation-principle/#_16","title":"\u9884\u5b9a\u4e49\u53d8\u91cf","text":"<ul> <li><code>PROJECT_SOURCE_DIR</code>\uff1a\u5de5\u7a0b\u7684\u6839\u76ee\u5f55</li> <li><code>PROJECT_BINARY_DIR</code>\uff1a\u8fd0\u884c cmake \u547d\u4ee4\u7684\u76ee\u5f55\uff0c\u901a\u5e38\u662f <code>${PROJECT_SOURCE_DIR}/build</code></li> <li><code>PROJECT_NAME</code>\uff1a\u8fd4\u56de\u901a\u8fc7 project \u547d\u4ee4\u5b9a\u4e49\u7684\u9879\u76ee\u540d\u79f0</li> <li><code>CMAKE_CURRENT_SOURCE_DIR</code>\uff1a\u5f53\u524d\u5904\u7406\u7684 CMakeLists.txt \u6240\u5728\u7684\u8def\u5f84</li> <li><code>CMAKE_CURRENT_BINARY_DIR</code>\uff1atarget \u7f16\u8bd1\u76ee\u5f55</li> <li><code>CMAKE_CURRENT_LIST_DIR</code>\uff1aCMakeLists.txt \u7684\u5b8c\u6574\u8def\u5f84</li> <li><code>CMAKE_CURRENT_LIST_LINE</code>\uff1a\u5f53\u524d\u6240\u5728\u7684\u884c</li> <li><code>CMAKE_MODULE_PATH</code>\uff1a\u5b9a\u4e49\u81ea\u5df1\u7684 cmake \u6a21\u5757\u6240\u5728\u7684\u8def\u5f84\uff0c<code>SET(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)</code>\uff0c\u7136\u540e\u53ef\u4ee5\u7528INCLUDE\u547d\u4ee4\u6765\u8c03\u7528\u81ea\u5df1\u7684\u6a21\u5757</li> <li><code>EXECUTABLE_OUTPUT_PATH</code>\uff1a\u91cd\u65b0\u5b9a\u4e49\u76ee\u6807\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5b58\u653e\u4f4d\u7f6e</li> <li><code>LIBRARY_OUTPUT_PATH</code>\uff1a\u91cd\u65b0\u5b9a\u4e49\u76ee\u6807\u94fe\u63a5\u5e93\u6587\u4ef6\u7684\u5b58\u653e\u4f4d\u7f6e</li> </ul>"},{"location":"native/basic/compilation-principle/#_17","title":"\u73af\u5883\u53d8\u91cf","text":"<pre><code>\u4f7f\u7528\u73af\u5883\u53d8\u91cf\n$ENV{Name}\n\u5199\u5165\u73af\u5883\u53d8\u91cf\nset(ENV{Name} value) # \u8fd9\u91cc\u6ca1\u6709\u201c$\u201d\u7b26\u53f7\n</code></pre>"},{"location":"native/basic/compilation-principle/#_18","title":"\u7cfb\u7edf\u4fe1\u606f","text":"<ul> <li><code>CMAKE_MAJOR_VERSION</code>\uff1acmake \u4e3b\u7248\u672c\u53f7\uff0c\u6bd4\u5982 3.4.1 \u4e2d\u7684 3</li> <li><code>CMAKE_MINOR_VERSION</code>\uff1acmake \u6b21\u7248\u672c\u53f7\uff0c\u6bd4\u5982 3.4.1 \u4e2d\u7684 4</li> <li><code>CMAKE_PATCH_VERSION</code>\uff1acmake \u8865\u4e01\u7b49\u7ea7\uff0c\u6bd4\u5982 3.4.1 \u4e2d\u7684 1</li> <li><code>CMAKE_SYSTEM</code>\uff1a\u7cfb\u7edf\u540d\u79f0\uff0c\u6bd4\u5982 Linux-\u00ad2.6.22</li> <li><code>CMAKE_SYSTEM_NAME</code>\uff1a\u4e0d\u5305\u542b\u7248\u672c\u7684\u7cfb\u7edf\u540d\uff0c\u6bd4\u5982 Linux</li> <li><code>CMAKE_SYSTEM_VERSION</code>\uff1a\u7cfb\u7edf\u7248\u672c\uff0c\u6bd4\u5982 2.6.22</li> <li><code>CMAKE_SYSTEM_PROCESSOR</code>\uff1a\u5904\u7406\u5668\u540d\u79f0\uff0c\u6bd4\u5982 i686</li> <li><code>UNIX</code>\uff1a\u5728\u6240\u6709\u7684\u7c7b UNIX \u5e73\u53f0\u4e0b\u8be5\u503c\u4e3a TRUE\uff0c\u5305\u62ec OS X \u548c cygwin</li> <li><code>WIN32</code>\uff1a\u5728\u6240\u6709\u7684 win32 \u5e73\u53f0\u4e0b\u8be5\u503c\u4e3a TRUE\uff0c\u5305\u62ec cygwin</li> </ul>"},{"location":"native/basic/compilation-principle/#_19","title":"\u4e3b\u8981\u5f00\u5173\u9009\u9879","text":"<ul> <li><code>BUILD_SHARED_LIBS</code>\uff1a\u8fd9\u4e2a\u5f00\u5173\u7528\u6765\u63a7\u5236\u9ed8\u8ba4\u7684\u5e93\u7f16\u8bd1\u65b9\u5f0f\uff0c\u5982\u679c\u4e0d\u8fdb\u884c\u8bbe\u7f6e\uff0c\u4f7f\u7528 add_library \u53c8\u6ca1\u6709\u6307\u5b9a\u5e93\u7c7b\u578b\u7684\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u7f16\u8bd1\u751f\u6210\u7684\u5e93\u90fd\u662f\u9759\u6001\u5e93\u3002\u5982\u679c <code>set(BUILD_SHARED_LIBS ON)</code> \u540e\uff0c\u9ed8\u8ba4\u751f\u6210\u7684\u4e3a\u52a8\u6001\u5e93</li> <li><code>CMAKE_C_FLAGS</code>\uff1a\u8bbe\u7f6e C \u7f16\u8bd1\u9009\u9879\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6307\u4ee4 add_definitions() \u6dfb\u52a0</li> <li><code>CMAKE_CXX_FLAGS</code>\uff1a\u8bbe\u7f6e C++ \u7f16\u8bd1\u9009\u9879\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6307\u4ee4 add_definitions() \u6dfb\u52a0 <pre><code>add_definitions(-DENABLE_DEBUG -DABC) # \u53c2\u6570\u4e4b\u95f4\u7528\u7a7a\u683c\u5206\u9694\n</code></pre></li> </ul>"},{"location":"native/basic/pointer%281%29/","title":"\u6df1\u5ea6\u957f\u6587\u6559\u4f60\u5f7b\u5e95\u638c\u63e1C++/C\u6307\u9488(\u4e00):\u57fa\u77f3","text":""},{"location":"native/basic/pointer%281%29/#_1","title":"\u4e00\uff0e\u57fa\u7840","text":"<p>C++\u6216\u8005C\u91cc\u9762\u6700\u5bb9\u6613\u8ba9\u4eba\u7cca\u6d82\u5e94\u8be5\u662f\u6307\u9488\u4e86,\u4e0d\u7ba1\u662f\u521d\u5b66\u8005\u751a\u81f3\u662f\u6709\u7ecf\u9a8c\u7684\u7ae5\u978b\u6709\u65f6\u5019\u5728\u7528\u6307\u9488\u7684\u65f6\u5019\u4e5f\u4f1a\u51fa\u73b0\u4e00\u4e9b\u5f88\u9690\u853d\u7684\u9519\u8bef. \u6307\u9488\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u5f88\u7ed5\u7684\u6982\u5ff5,\u800c\u6307\u9488\u53c8\u80fd\u591f\u548c\u5f88\u591a\u7684\u7ed3\u6784\u6bd4\u5982\u6570\u7ec4(\u4e8c\u7ef4\u6570\u7ec4),\u5b57\u7b26\u4e32,\u5185\u5b58\u5206\u914d\u548c\u7ba1\u7406\u7b49\u7b49\u4e00\u4e9b\u8054\u7cfb\u8d77\u6765\u53d8\u6210\u66f4\u52a0\u7ed5\u7684\u6982\u5ff5.\u6240\u4ee5\u57fa\u7840\u4e0d\u597d\u7684\u540c\u5b66\u5e38\u5e38\u4f1a\u72af\u4e00\u4e9b\u5f88\u65e0\u5398\u5934\u7684\u9519\u8bef,\u4f46\u662f\u9ad8\u624b\u4e5f\u4f1a\u72af\u9519\u8bef,\u800c\u4e14\u66f4\u52a0\u9690\u853d. \u63a5\u4e0b\u6765\u6240\u6709\u7684\u6587\u7ae0\u5185\u5bb9\u5e76\u4e0d\u80fd\u591f\u4fdd\u8bc1\u4f60\u80fd\u591f\u5b8c\u5b8c\u5168\u5168\u907f\u514d\u5f00\u53d1\u4e2d\u7684\u9519\u8bef,\u4f46\u662f\u6587\u7ae0\u7684\u76ee\u6807\u662f\u5e2e\u52a9\u5f88\u591a\u7ae5\u978b\u5bf9\u4e8e\u6307\u9488\u6982\u5ff5\u505a\u4e00\u4e2a\u7cfb\u7edf\u6027\u7684\u5f52\u7eb3.\u51cf\u5c11\u72af\u9519\u8bef\u7684\u51e0\u7387.\u6216\u8005\u662f\u5e2e\u52a9\u521a\u521a\u5165\u95e8\u7684boy\u66f4\u52a0\u5feb\u901f\u6df1\u5165\u7684\u7406\u89e3\u6307\u9488,\u628a\u57fa\u7840\u6253\u5f97\u624e\u5b9e\u4e00\u70b9. \u6069,\u5f88\u591a\u4eba\u90fd\u8bf4\u6307\u9488\u5f88\u96be,\u90a3\u4e3a\u4ec0\u4e48\u8fd8\u8981\u5b66\u6307\u9488\u5462?\u5bf9\u4e8e\u8fd9\u6837\u7684\u95ee\u9898,\u62d2\u7edd\u56de\u7b54.</p>"},{"location":"native/basic/pointer%281%29/#i","title":"\u2160.\u5185\u5b58\u548c\u5730\u5740","text":"<p>\u6211\u4eec\u5df2\u7ecf\u5f88\u719f\u6089\u4e00\u4e9b\u57fa\u672c\u7684\u5b58\u50a8\u5355\u4f4d\u4e86,\u6bd4\u5982\u4e00\u4e2abit(\u4f4d)\u7528\u5b58\u50a80\u6216\u80051.\u4e5f\u53ef\u4ee5\u628a\u51e0\u4e2abit\u5408\u8d77\u6765\u8868\u793a\u66f4\u5927\u7684\u6570\u5b57,\u6bd4\u5982\u4e00\u4e2abyte(\u5b57\u8282)\u5c31\u5305\u542b\u4e868\u4e2abit.\u8fd9\u4e9b\u90fd\u662f\u5f88\u57fa\u7840\u5f88\u7b80\u5355\u7684\u4e1c\u897f.\u7136\u540e \u6211\u4eec\u53ef\u4ee5\u628a\u8ba1\u7b97\u673a\u7684\u5185\u5b58\u60f3\u8c61\u6210\u4e00\u4e2a\u5b57\u8282\u6570\u7ec4,\u5185\u5b58\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5730\u5740\u8868\u793a\u4e00\u4e2a\u5b57\u8282.</p> <p></p> <p>\u6bcf\u4e2a\u5b57\u8282\u4e2d\u90fd\u80fd\u591f\u5b58\u50a8\u4e00\u5b9a\u4f4d\u6570\u7684\u5185\u5bb9,\u56e0\u6b64,\u6bcf\u4e2a\u5b57\u8282\u90fd\u80fd\u591f\u901a\u8fc7\u4e00\u4e9b\u5730\u5740\u6765\u6807\u8bc6.\u6709\u65f6\u5019,\u4e00\u4e2a\u5b57\u8282\u4e0d\u591f,\u600e\u4e48\u529e\u5462?\u90a3\u4e48\u5c31\u540c\u65f6\u7528\u5f88\u591a\u4e2a\u5b57\u8282\u6765\u8868\u793a,\u6bd4\u5982\u4e00\u4e2aint\u5728\u6211\u7684\u7cfb\u7edf\u91cc\u9762\u5c31\u7528\u4e864\u4e2a\u5b57\u8282\u3002 \u4e0b\u9762\u7684\u56fe\u662f\u4e0a\u9762\u90a3\u5e45\u56fe\u7247\u6bcf\u4e24\u4e2a\u5b57\u8282\u5408\u5e76\u5728\u4e00\u8d77\u4e4b\u540e\u6837\u5b50.\u8fd9\u4e2a\u56e0\u4e3a\u662f\u4e24\u4e2a\u5b57\u8282\u5408\u5e76,\u6240\u4ee5\u5b83\u6210\u4e3a\u6bd4\u4e00\u4e2a\u5b57\u8282\u66f4\u5927\u7684\u5185\u5b58\u5355\u4f4d(\u5e9f\u8bdd),\u80fd\u591f\u5b58\u50a8\u7684\u4fe1\u606f\u5c31\u66f4\u591a(\u5e9f\u8bdd).\u4f46\u662f\u867d\u7136\u4e00\u4e2a\u5b57\u662f\u4e24\u4e2a\u5b57\u8282\u5408\u5e76\u7684,\u4f46\u662f\u5b83\u4ecd\u7136\u53ea\u5305\u542b\u4e00\u4e2a\u5730\u5740,\u4e5f\u5c31\u662f\u8bf4,\u5408\u5e76\u4e4b\u540e\u53ea\u9700\u8981\u4e00\u4e2a\u5730\u5740\u6765\u627e\u5230\u5408\u5e76\u4e4b\u540e\u7684\u5185\u5b58.</p> <p></p> <p>\u56e0\u6b64,\u6211\u4eec\u53ef\u4ee5\u5f97\u5230:</p> <ol> <li>\u5185\u5b58\u4e2d\u7684\u6bcf\u4e2a\u4f4d\u7f6e\u90fd\u7531\u4e00\u4e2a\u72ec\u4e00\u65e0\u4e8c\u7684\u5730\u5740\u8868\u793a.</li> <li>\u5185\u5b58\u4e2d\u7684\u6bcf\u4e2a\u4f4d\u7f6e\u90fd\u5305\u542b\u4e00\u4e2a\u503c.    \u901a\u4fd7\u4e00\u70b9,\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u5730\u5740,\u6765\u627e\u5230\u5185\u5b58\u4e2d\u7684\u67d0\u4e2a\u5177\u4f53\u4f4d\u7f6e,\u7136\u540e\u8bbf\u95ee\u5230(\u5f97\u5230)\u8be5\u4f4d\u7f6e\u7684\u503c(\u5141\u8bb8\u7684\u8bdd).\u8fd9\u5c31\u662f\u5185\u5b58\u548c\u5730\u5740\u7b80\u5355\u7684\u601d\u60f3.</li> </ol>"},{"location":"native/basic/pointer%281%29/#ii","title":"\u2161.\u6307\u9488\u542b\u4e49\u4e0e\u521b\u5efa\u65b9\u5f0f","text":"<p>\u6307\u9488\u8fd9\u4e2a\u540d\u5b57\u786e\u5b9e\u6298\u78e8\u8fc7\u5f88\u591a\u4eba,\u8fd9\u4e2a\u540d\u5b57\u662f\u4e2a\u597d\u540d\u5b57,\u540c\u65f6\u4e5f\u662f\u4e00\u4e2a\u975e\u5e38\u4e0d\u597d\u7684\u540d\u5b57. \u8bf4\u5b83\u597d,\u662f\u56e0\u4e3a\u6307\u9488\u8fd9\u4e2a\u4e1c\u897f\u5f88\u5f62\u8c61\u7684\u4f53\u73b0\u4e86\u5b83\u7684\u529f\u80fd:\u6307\u9488\u6307\u9488,\u6307\u5230\u67d0\u4e2a\u5730\u65b9\u67d0\u4e2a\u4f4d\u7f6e.\u975e\u5e38\u5f62\u8c61. \u5b83\u4e0d\u662f\u4e2a\u597d\u540d\u5b57\u662f\u56e0\u4e3a\u5979\u7684\u540d\u5b57\u6709\u65f6\u5019\u63a9\u76d6\u4e86\u5b83\u7684\u771f\u5b9e\u542b\u4e49.\u4e00\u822c\u6765\u8bf4\uff0c\u6307\u9488\u662f\u4e00\u4e2a\u5176\u503c\u4e3a\u5730\u5740\u7684\u53d8\u91cf\u3002\uff08\u5c31\u662f\u4e00\u4e2a\u5b58\u50a8\u5730\u5740\u7684\u53d8\u91cf\uff09 \u6240\u4ee5,\u8981\u517b\u6210\u4e00\u79cd\u6761\u4ef6\u53cd\u5c04,\u770b\u5230\u6307\u9488\u9996\u5148\u4e0d\u662f\u60f3\u5230\u4ed6\u80fd\u591f\u6307\u5411\u54ea\u91cc,\u800c\u662f\u60f3\u5230 \u8fd9\u4e2a\u53d8\u91cf\u5b58\u653e\u7684\u662f\u4e00\u4e2a\u5730\u5740,\u662f\u8fd9\u4e2a\u5730\u5740\u6307\u5411\u54ea\u91cc\u54ea\u91cc.(\u6bd4\u5982,char\u7c7b\u578b\u7684\u53d8\u91cf\u4e2d\u5b58\u653e\u7684\u662fchar\u7c7b\u578b\u7684\u6570\u636e.int\u53d8\u91cf\u4e2d\u5b58\u653e\u7684\u662fint\u7c7b\u578b\u7684\u6570\u636e.\u6307\u9488\u4e2d\u5b58\u653e\u7684\u662f\u4e00\u4e2a\u5730\u5740!!!)</p> <p>\u53cd\u590d\u7684\u628a\u4e0a\u9762\u7684\u6982\u5ff5\u6d88\u5316\u4e4b\u540e,\u6211\u4eec\u5c31\u6765\u770b\u4e24\u4e2a\u57fa\u672c\u7684\u8fd0\u7b97\u7b26: &amp;(\u53d6\u5740\u8fd0\u7b97\u7b26) \u548c* *(\u95f4\u63a5\u8bbf\u95ee\u8fd0\u7b97\u7b26/\u89e3\u5f15\u7528\u6307\u9488)*</p> <p>\u9996\u5148\u662f&amp;\u8fd0\u7b97\u7b26:\u5f53\u5b83\u540e\u9762\u8ddf\u4e00\u4e2a\u53d8\u91cf\u540d\u7684\u65f6\u5019,\u7ed9\u51fa\u8fd9\u4e2a\u53d8\u91cf\u540d\u7684\u5730\u5740.</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main()\n{\nint a=5;\ndouble b=10.4;\ncout&lt;&lt;\"Address of a:\"&lt;&lt;&amp;a&lt;&lt;endl;\ncout&lt;&lt;\"Address of b:\"&lt;&lt;&amp;b&lt;&lt;endl;\n}\n</code></pre> <p></p> <p>\u81f3\u4e8e*\u8fd0\u7b97\u7b26:\u5c31\u662f\u540e\u9762\u8ddf\u4e00\u4e2a\u6307\u9488\u7684\u65f6\u5019,\u5f97\u5230\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u4e2d\u7684\u5185\u5bb9.</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main()\n{\nint a=5;\ndouble b=10.4;\ncout&lt;&lt;\"Address of a:\"&lt;&lt;&amp;a&lt;&lt;endl;\ncout&lt;&lt;\"Address of b:\"&lt;&lt;&amp;b&lt;&lt;endl;\ncout&lt;&lt;\"a:\"&lt;&lt;*(&amp;a)&lt;&lt;endl;\n}\n</code></pre> <p></p> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u4f8b\u5b50\u4f60\u4f1a\u53d1\u73b0,\u8fd9\u91cc\u8f93\u51fa\u7684\u5730\u5740\u662f16\u8fdb\u5236\u7684\u6574\u5f62.\u5176\u5b9e\u4e8b\u5b9e\u4e0a,\u5728\u5927\u591a\u6570\u7cfb\u7edf\u7684\u5185\u90e8\uff0c\u6307\u9488\u6240\u5b58\u7684\u5730\u5740\u503c\u4e00\u822c\u662f\u4e00\u4e2a\u65e0\u7b26\u53f7\u7684\u6574\u6570\u3002\u4f46\u662f\uff0c\u8fd9\u5e76\u4e0d\u4ee3\u8868\u6307\u9488\u548c\u6574\u5f62\u6709\u4e00\u6837\u7684\u8fd0\u7b97\u89c4\u5219\u3002\u6307\u9488\u7c7b\u578b\u662f\u4e00\u79cd\u65b0\u7684\u7c7b\u578b\uff0c\u800c\u4e0d\u662f\u4e00\u79cd\u6574\u6570\u7c7b\u578b\u3002ANSI\u4e13\u95e8\u4e3a\u6307\u9488\u63d0\u4f9b\u4e86%p\u8f93\u51fa\u683c\u5f0f</p> <p>\u7406\u89e3\u4e0a\u9762\u4e24\u4e2a\u57fa\u672c\u7684\u8fd0\u7b97\u7b26\u4e4b\u540e,\u5c31\u53ef\u4ee5\u6b63\u5f0f\u5f00\u59cb\u8bb2\u6307\u9488\u7684\u521b\u5efa\u4e86. \u58f0\u660e\u6307\u9488\u7684\u6a21\u677f:</p> <p>\u6307\u5411\u5730\u5740\u7684\u6570\u636e\u7c7b\u578b * \u6307\u9488\u53d8\u91cf\u540d;</p> <p>\u5176\u4e2d,<code>*</code>\u53f7\u5fc5\u987b\u5e26,\u7528\u4ee5\u8868\u660e\u73b0\u5728\u521b\u5efa\u7684\u662f\u4e00\u4e2a\u6307\u9488\u7c7b\u578b\u7684\u53d8\u91cf.\u540c\u65f6,\u5f53\u4f60\u770b\u5230\u521b\u5efa\u53d8\u91cf\u7684\u8bed\u53e5\u4e2d\u5e26\u6709\u661f\u53f7<code>*</code>\u7684\u8bdd,\u90a3\u4e48\u8bf4\u660e\u90a3\u4e2a\u53d8\u91cf\u5fc5\u5b9a\u662f\u4e00\u4e2a\u6307\u9488\u53d8\u91cf!</p> <p>\u662f\u4e0d\u662f\u5f88\u7b80\u5355!\u4e3e\u4e00\u4e2a\u4f8b\u5b50\u8fdb\u4e00\u6b65\u6765\u7406\u89e3\u4e0a\u9762\u90a3\u4e2a\u7684\u542b\u4e49.\u6bd4\u5982\u6211\u60f3\u521b\u5efa\u4e00\u4e2a\u6307\u9488\u53d8\u91cf(\u5b58\u653e\u5730\u5740\u7684\u53d8\u91cf),\u8fd9\u4e2a\u6307\u9488(\u5730\u5740)\u662f\u6307\u5411\u4e00\u4e2a\u5b58\u50a8\u6574\u5f62\u7684\u5185\u5b58.\u90a3\u4e48\u6211\u5c31\u53ef\u4ee5\u5199\u4e3a:<code>int * leo</code>;\u540c\u7406,\u6307\u5411char\u7684\u6211\u53ef\u4ee5\u5199\u6210<code>char * c</code>;\u5176\u5b9e\u662f\u5f88\u7b80\u5355\u7684.</p> <p>\u8fd9\u91cc\u7ed3\u5408\u524d\u9762\u7684\u5185\u5bb9,\u7b80\u5355\u7684\u5199\u4e00\u4e2a\u4f8b\u5b50,\u5e76\u4e14\u4ecb\u7ecd\u4e00\u4e9b\u5199\u6cd5.(\u6700\u5f00\u59cb\u8ba9\u521d\u5b66\u8005\u8ff7\u60d1\u7684\u5730\u65b9\u5c31\u662f\u8fd9\u91cc\u4e86,\u56e0\u4e3a\u521b\u5efa\u65f6\u5019\u7684<code>*</code>\u53f7,\u89e3\u9664\u6307\u9488\u65f6\u5019\u7684<code>*</code>\u53f7,\u5404\u79cd\u7b26\u53f7\u6df7\u5728\u4e00\u8d77,\u4e00\u822c\u5c31\u76f4\u63a5\u61f5\u903c\u4e86.\u4f46\u662f\u8981\u662f\u597d\u597d\u638c\u63e1\u4e00\u4e9b\u7ecf\u9a8c\u7ed3\u8bba,\u8fd9\u91cc\u5f88\u5bb9\u6613\u8fc7\u53bb.)</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main()\n{\nint a=5,b=6,c=7,d=8;\ndouble e=3.1415;\n//\u5355\u72ec\u8d4b\u503c,\u5e76\u4e14*\u548cp_a\u7d27\u6328\u7740\nint *p_a=&amp;a;\n//\u591a\u4e2a\u8d4b\u503c(\u65e2\u6709\u6307\u9488,\u53c8\u6709\u666e\u901a\u53d8\u91cf)\nint * p_b=&amp;b,* p_c=&amp;c,*p_d=&amp;d,temp=100;\n//\u5355\u72ec\u8d4b\u503c,double\u7c7b\u578b\ndouble * p_e=&amp;e;\ncout&lt;&lt;p_a&lt;&lt;endl&lt;&lt;p_b&lt;&lt;endl&lt;&lt;p_c&lt;&lt;endl&lt;&lt;p_d&lt;&lt;endl&lt;&lt;p_e&lt;&lt;endl;\ncout&lt;&lt;temp&lt;&lt;endl;\n}\n</code></pre> <p></p> <p>\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u6709\u4e00\u4e9b\u53ef\u4ee5\u63d0\u70bc\u7684\u7ecf\u9a8c: \u9996\u5148,\u5c31\u662f\u521b\u5efa\u6307\u5411int\u6216\u8005double\u7684\u6307\u9488\u7684\u521b\u5efa\u65b9\u5f0f,\u8fd9\u4e2a\u524d\u9762\u90fd\u8bb2\u4e86\u5f88\u591a\u6b21\u4e86.\u5728\u8fd9\u4e2a\u4f8b\u5b50\u91cc\u9762\u4e5f\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u627e\u5230,\u6240\u4ee5\u8fd9\u91cc\u5c31\u4e0d\u5570\u55e6\u4e86.</p> <p>\u7136\u540e\u5c31\u662f\u521b\u5efa\u65f6\u5019\u7684\u5199\u6cd5.\u6bd4\u5982 <code>int *p_a=&amp;a;</code>\u8fd9\u53e5\u8bdd\u4e2d,<code>*</code>\u53f7\u662f\u7d27\u6328\u7740<code>p_a</code>\u7684,\u800c\u5728<code>int * p_b=&amp;b,* p_c=&amp;c,*p_d=&amp;d,temp=100;</code>\u8fd9\u53e5\u8bdd\u4e2d,*\u53f7\u662f\u53ef\u4ee5\u4e0d\u6328\u7740<code>p_b</code>\u548c<code>p_c</code>\u7684.\u4e5f\u5c31\u662f\u8bf4,\u521b\u5efa\u6307\u9488\u53d8\u91cf\u7684\u65f6\u5019,\u661f\u53f7\u7684\u4f4d\u7f6e\u662f\u5f88\u81ea\u7531\u7684.\u53ea\u8981\u662f\u51fa\u73b0\u4e86\u661f\u53f7,\u800c\u4e0d\u7ba1\u4e2d\u95f4\u662f\u4e0d\u662f\u6709\u7a7a\u683c,\u6211\u4eec\u4fbf\u8ba4\u4e3a,\u8fd9\u7b97\u662f\u521b\u5efa\u4e86\u4e00\u4e2a\u6307\u9488\u53d8\u91cf.</p> <p>\u5728\u522b\u4eba\u5199\u7684\u4ee3\u7801\u4e2d,\u4f60\u4f1a\u770b\u5230\u5f88\u591a\u7684\u5199\u6cd5,\u5176\u5b9e\u672c\u8d28\u5c31\u662f\u8fd9\u6837.\u6bd4\u5982\u6709\u4e9b\u4eba\u559c\u6b22\u5199\u6210<code>int* p_a=&amp;a;</code>\u5728\u8fd9\u91cc,<code>*</code>\u53f7\u7d27\u6328\u7740int,\u56e0\u4e3a\u6709\u4eba\u7406\u89e3\u4e3aint\u7684\u6307\u9488\u7c7b\u578b\u5373int*.\u6240\u4ee5,\u5199\u6cd5\u8fd9\u4e48\u591a,\u521d\u5b66\u8005\u80af\u5b9a\u662f\u4f1a\u8ff7\u60d1\u7684,\u8bb0\u4f4f\u524d\u9762\u7684\u7ecf\u9a8c,\u8fd9\u6837\u5c31\u89c1\u602a\u4e0d\u602a\u4e86.</p> <p>\u63a5\u4e0b\u6765,\u8fd8\u662f\u5728<code>int * p_b=&amp;b,* p_c=&amp;c,*p_d=&amp;d,temp=100;</code>\u8fd9\u53e5\u8bdd\u91cc\u9762,\u6700\u540e\u63a5\u4e86\u4e00\u4e2a<code>temp=100</code>,\u5343\u4e07\u4e0d\u8981\u4e5f\u628atemp\u4e5f\u5f53\u505a\u4e86\u4e00\u4e2a\u6307\u9488\u53d8\u91cf,\u4ed6\u53ea\u662f\u4e00\u4e2a\u666e\u901a\u7684\u53d8\u91cf.\u4e5f\u5c31\u662f\u8bf4,\u540c\u4e00\u53e5\u8bdd\u91cc\u9762,\u53ef\u4ee5\u6df7\u5408\u591a\u79cd\u7c7b\u578b\u7684\u8d4b\u503c,\u6307\u9488\u7684\u5e26<code>*</code>\u53f7,\u666e\u901a\u7684\u4e0d\u5e26<code>*</code>\u53f7.</p>"},{"location":"native/basic/pointer%281%29/#iii","title":"\u2162.\u4f7f\u7528\u6307\u9488","text":"<p>\u4f7f\u7528\u6307\u9488\u7684\u65b9\u5f0f\u6709\u5f88\u591a,\u6211\u4eec\u8fd9\u91cc\u8c08\u8c08\u6700\u57fa\u7840\u7684,\u540e\u9762\u4f1a\u66f4\u52a0\u6df1\u5165\u7684\u8bb2\u6307\u9488\u7684\u4f7f\u7528.\u524d\u9762\u5df2\u7ecf\u8bb2\u8fc7\u4e86\u6307\u9488\u7684\u521b\u5efa,\u63a5\u4e0b\u6765\u4e3b\u8981\u662f\u8bb2\u6307\u9488\u7684\u521d\u59cb\u5316\u95ee\u9898\u548c\u8d4b\u503c\u4ee5\u53ca\u89e3\u9664\u5f15\u7528\u7b49\u7b49\u95ee\u9898.</p> <p>\u9996\u5148\u662f\u521d\u59cb\u5316\u95ee\u9898.\u5728\u524d\u9762\u7684\u90a3\u4e00\u4e2a\u4f8b\u5b50\u4e2d,\u6211\u4eec\u5728\u521b\u5efa\u6307\u9488\u7684\u65f6\u5019\u90fd\u987a\u4fbf\u521d\u59cb\u5316\u4e86,\u90a3\u662f\u4e0d\u662f\u521b\u5efa\u6307\u9488\u5c31\u4e00\u5b9a\u8981\u521d\u59cb\u5316?\u80af\u5b9a\u4e0d\u662f!\u521b\u5efa\u6307\u9488\u7684\u65f6\u5019\u4e5f\u53ef\u4ee5\u4e0d\u521d\u59cb\u5316.\u56e0\u4e3a**\u6709\u65f6\u5019\u4f60\u521b\u5efa\u4e00\u4e2a\u6307\u9488\u53ea\u662f\u4e3a\u4e86\u540e\u7eed\u7684\u5de5\u4f5c**,\u6839\u672c\u6ca1\u6709\u4e1c\u897f\u62ff\u6765\u521d\u59cb\u5316.\u90a3\u4e48\u5230\u73b0\u5728,\u6211\u4eec\u89e3\u51b3\u4e86\u7b2c\u4e00\u4e2a\u95ee\u9898,\u90a3\u5c31\u662f**\u521b\u5efa\u6307\u9488\u53ef\u4ee5\u521d\u59cb\u5316\u4e5f\u53ef\u4ee5\u4e0d\u521d\u59cb\u5316**,.\u90a3\u4e48\u4f60\u80af\u5b9a\u4f1a\u8bf4,\u8fd9\u4e48\u7b80\u5355\u4e3a\u4ec0\u4e48\u8981\u5355\u72ec\u62ff\u51fa\u6765\u8bb2?\u662f\u56e0\u4e3a\u540e\u6765\u7684\u67d0\u4e9b\u64cd\u4f5c\u662f\u8981\u8003\u8651\u662f\u5426\u521d\u59cb\u5316\u7684\u95ee\u9898\u7684.\u597d\u4e86,\u4e0d\u7ed5\u5f2f\u4e86,\u8fd9\u91cc\u7684\u64cd\u4f5c\u4e3b\u8981\u662f\u8bb2\u95f4\u63a5\u8bbf\u95ee(\u89e3\u5f15\u7528\u6307\u9488)\u5e26\u6765\u7684\u4e00\u4e9b\u95ee\u9898.</p> <p>\u4e0d\u591a\u8bf4,\u76f4\u63a5\u4e0a\u4f8b\u5b50.</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main()\n{\nint num=5;\n//p_a\u6ca1\u6709\u521d\u59cb\u5316\nint *p_a1,*p_a2;\ncout&lt;&lt;\"p_a1:\"&lt;&lt;p_a1&lt;&lt;endl;\ncout&lt;&lt;\"p_a2:\"&lt;&lt;p_a2&lt;&lt;endl;\nint *p_b=&amp;num;\ncout&lt;&lt;\"p_b:\"&lt;&lt;p_b&lt;&lt;endl;\n//\u540c\u7c7b\u578b\u6307\u9488\u53ef\u4ee5\u8d4b\u503c\n//\u6ca1\u6709\u521d\u59cb\u5316\u7684\u6307\u9488\u4f9d\u7136\u53ef\u4ee5\u88ab\u8d4b\u503c(\u5730\u5740)\np_a1=p_b;\np_a2=&amp;num;\ncout&lt;&lt;\"changed p_a1:\"&lt;&lt;p_a1&lt;&lt;endl;\ncout&lt;&lt;\"changed p_a2:\"&lt;&lt;p_a2&lt;&lt;endl;\n}\n</code></pre> <p></p> <p>\u4e00\u53e5\u4e00\u53e5\u6765\u5206\u6790\u8fd9\u4e2a\u4f8b\u5b50.\u9996\u5148\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u6574\u5f62,\u503c\u4e3a5,\u7136\u540e\u6211\u4eec\u521b\u5efa\u4e86\u4e24\u4e2a\u6307\u5411int\u7c7b\u578b\u7684\u6307\u9488<code>p_a1</code>,<code>P_a2</code>,\u4f46\u662f\u6211\u4eec\u6ca1\u6709\u521d\u59cb\u5316.\u4ece\u6700\u540e\u7684\u8fd0\u884c\u7ed3\u679c\u6765\u770b,\u6307\u9488\u4e0d\u521d\u59cb\u5316\u662f\u53ef\u884c\u7684.\u7136\u540e\u521b\u5efa\u4e86\u4e00\u4e2a\u6307\u9488<code>p_b</code>\u5e76\u4e14\u521d\u59cb\u5316\u4e86,\u6240\u4ee5\u4ece\u7ed3\u679c\u6765\u770b,\u5c31\u662fnum\u7684\u5730\u5740.</p> <p>\u63a5\u4e0b\u6765\u6709\u4e24\u53e5:<code>p_a1=p_b; p_a2=&amp;num;</code></p> <p>\u524d\u9762\u90a3\u53e5\u662f\u76f4\u63a5\u628a<code>p_b</code>\u8fd9\u4e2a\u6307\u5411int\u7c7b\u578b\u7684\u6307\u9488\u76f4\u63a5\u8d4b\u7ed9\u4e86<code>p_a1</code>\u8fd9\u4e2a\u4e5f\u662f\u6307\u5411int\u7c7b\u578b\u7684\u6307\u9488,\u90a3\u4e48\u4ece\u6548\u679c\u4e0a\u9762\u6765\u770b,\u76f8\u5f53\u4e8e<code>p_a1</code>\u548c<code>p_b</code>\u6307\u5411\u540c\u6837\u7684\u5730\u5740\u2026..\u597d\u4e86,\u4e0d\u88c5\u903c\u4e86,\u56e0\u4e3a\u6307\u9488\u5c31\u662f\u5b58\u50a8\u5730\u5740\u7684\u561b,\u5176\u5b9e\u5c31\u662f\u628a\u8fd9\u4e2a\u53d8\u91cf\u4e2d\u5b58\u50a8\u7684\u5730\u5740\u8d4b\u7ed9\u4e86\u53e6\u5916\u4e00\u4e2a\u53d8\u91cf\u2026..\u975e\u5e38\u7b80\u5355.</p> <p>\u540e\u9762\u7b2c\u4e8c\u53e5\u5c31\u662f\u8bf4,\u5373\u4f7f\u4e0d\u521d\u59cb\u5316,\u6211\u8fd8\u662f\u80fd\u591f\u63a5\u6536\u5730\u5740.(\u7c7b\u6bd4<code>int n;n=5</code>).</p> <p>\u6240\u4ee5\u603b\u7ed3\u8d77\u6765\u5c31\u662f\u5373\u4f7f\u6ca1\u6709\u521d\u59cb\u5316,\u6211\u4f9d\u7136\u80fd\u591f\u4e24\u4e2a\u6307\u9488\u4e4b\u95f4\u8d4b\u503c(\u7c7b\u578b\u80af\u5b9a\u8981\u4e00\u6837\u5566)\u548c\u63a5\u53d7\u5730\u5740.\u4e5f\u6ca1\u6709\u4ec0\u4e48\u56f0\u96be\u7684.\u90a3\u4e48\u63a5\u7740\u770b.</p> <p>\u628a\u4e0a\u9762\u7684\u4ee3\u7801\u5c0f\u5c0f\u7684\u6539\u52a8\u4e00\u4e9b,\u4ee3\u7801\u53d8\u6210\u4e0b\u9762\u8fd9\u6837.</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main()\n{\nint num=5;\n//p_a\u6ca1\u6709\u521d\u59cb\u5316\nint *p_a1,*p_a2;\ncout&lt;&lt;\"p_a1:\"&lt;&lt;p_a1&lt;&lt;endl;\ncout&lt;&lt;\"p_a2:\"&lt;&lt;p_a2&lt;&lt;endl;\n*p_a1=12;\ncout&lt;&lt;*p_a1&lt;&lt;endl;\n}\n</code></pre> <p>\u8fd9\u91cc\u5c31\u52a0\u4e86\u4e00\u53e5<code>*p_a1=12;</code>\u8fd9\u53e5\u8bdd\u662f\u5f88\u5371\u9669\u7684.\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u6307\u5411int\u7684\u6307\u9488,\u4f46\u662f\u5e76\u6ca1\u6709\u521d\u59cb\u5316,\u4e5f\u5c31\u662f\u8bf4,\u6307\u9488\u4f1a\u5f97\u5230\u4e00\u4e2a\u968f\u673a\u7684\u5730\u5740(\u81f3\u5c11\u5927\u90e8\u5206\u7cfb\u7edf\u4e0a\u9762\u662f\u8fd9\u6837),\u53ef \u521b\u5efa\u6307\u9488\u7684\u8fc7\u7a0b\u5e76\u4e0d\u5305\u542b\u5bf9\u4e8e\u67d0\u4e2a\u6574\u5f62\u5185\u5b58\u4e0a\u7a7a\u95f4\u7684\u5f00\u8f9f.</p> <p><code>*p_a1=12;</code>\u7684\u8fc7\u7a0b\u5c31\u662f\u628a12\u8fd9\u4e2a\u6574\u5f62\u653e\u5230p_a1\u6307\u5411\u7684\u5185\u5b58\u7684\u8fc7\u7a0b.\u4f46\u662f\u7a7a\u95f4\u90fd\u6ca1\u6709\u5f00\u8f9f,\u600e\u4e48\u653e\u5462?\u6240\u4ee5\u8fd9\u4e2a\u8bed\u53e5\u6700\u7ec8\u662f\u4e0d\u662f\u8fd0\u884c\u6210\u529f\u90fd\u53d6\u51b3\u4e8e\u8fd0\u6c14.\u4e0d\u540c\u7684\u7cfb\u7edf\u4e0a\u9762\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u7ed3\u679c.\u4f46\u662f\u8fd9\u6837\u7684\u8bdd\u5c31\u7b97\u662f\u8fd0\u884c\u6210\u529f\u4e86\u53c8\u6709\u4ec0\u4e48\u610f\u4e49\u5462?</p> <p>\u6240\u4ee5,\u5176\u4ed6\u7684\u90fd\u4e0d\u8bf4, \u81f3\u5c11\u5728\u89e3\u5f15\u7528\u6307\u9488\u7684\u65f6\u5019,\u4f60\u9700\u8981\u4fdd\u8bc1\u4f60\u7684\u6307\u9488\u88ab\u6b63\u786e\u7684\u521d\u59cb\u5316\u6216\u8005\u6b63\u786e\u7684\u88ab\u8d4b\u8fc7\u67d0\u4e2a\u5730\u5740. \u4e0d\u7136,\u90a3\u6837\u7684\u89e3\u5f15\u7528\u6307\u9488\u64cd\u4f5c\u65e0\u610f\u4e49\u4e14\u5371\u9669.</p> <p>\u91cd\u8981:</p> <p>\u65e2\u7136\u524d\u9762\u8c08\u5230\u4e86\u89e3\u5f15\u7528\u6307\u9488(\u95f4\u63a5\u8bbf\u95ee),\u90a3\u5c31\u518d\u6765\u8bf4\u8bf4\u6307\u9488\u5e38\u91cf\u4e0e\u6307\u9488\u7684\u5f3a\u5236\u8f6c\u5316.</p> <p>\u5047\u5982\u6211\u4eec\u60f3\u5728\u4e00\u4e2a\u5730\u5740500\u5b58\u653e\u4e00\u4e2a\u6574\u6570100,\u6ca1\u9519,\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u8fd9\u4e2a\u5730\u5740\u662f500\u4e86,\u6240\u4ee5\u6211\u4eec\u5c31\u80fd\u591f\u8fd9\u4e48\u8d4b\u503c</p> <pre><code>*500=100;\n</code></pre> <p>\u8fd9\u53e5\u8bdd\u7684\u610f\u601d\u662f\u5f88\u660e\u786e\u7684,\u5148\u628a\u5730\u5740500\u89e3\u5f15\u7528\u7136\u540e\u628a100\u653e\u8fdb\u8fd9\u4e2a\u5185\u5b58.\u4f46\u662f\u8fd9\u53e5\u8bdd\u662f\u9519\u7684,\u56e0\u4e3a\u524d\u9762\u8bf4\u8fc7\u6307\u9488\u7c7b\u578b\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u7c7b\u578b.\u4f46\u662f\u6211\u4eec\u8fd9\u91cc\u7684500\u5c31\u662f\u4e00\u4e2a\u5f88\u666e\u901a\u7684\u6574\u5f62.\u4ed6\u662f\u80fd\u591f\u8868\u793a500\u8fd9\u4e2a\u5730\u5740\u6ca1\u6709\u9519,\u4f46\u662f\u5b83\u7684\u7c7b\u578b\u4e0d\u9002\u5408.\u56e0\u6b64,\u6211\u4eec\u8981\u628a\u8fd9\u4e2a\u666e\u901a\u7684\u6574\u5f62\u5f3a\u5236\u8f6c\u6362\u4e3a\u6307\u5411\u6574\u5f62\u7684\u6307\u9488\u7c7b\u578b.\u56e0\u6b64\u53ef\u4ee5\u8fd9\u6837\u5199</p> <p><pre><code>*(int *)500=100\n</code></pre> \u5176\u5b9e\u4f7f\u7528\u8fd9\u4e2a\u7684\u673a\u4f1a\u5f88\u5c11,\u4f46\u662f\u5e76\u4e0d\u610f\u5473\u8fd9\u4e2a\u4e0d\u91cd\u8981,\u9996\u5148\u5728\u67d0\u4e9b\u786c\u4ef6\u95ee\u9898\u91cc\u9762\u786e\u5b9e\u662f\u60f3\u8bbf\u95ee\u67d0\u4e9b\u786c\u4ef6\u4e0a\u9762\u7279\u5b9a\u7684\u5730\u5740\u7684\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u6cd5.\u540e\u9762\u8bb2\u5230\u5185\u5b58\u7ba1\u7406\u7684\u65f6\u5019,\u4e5f\u4f1a\u56de\u6765\u8fd9\u91cc.</p>"},{"location":"native/basic/pointer%281%29/#iv","title":"\u2163.\u6307\u9488\u8fd0\u7b97","text":"<p>\u6307\u9488\u7684\u8fd0\u7b97\u6709**\u7b97\u672f\u8fd0\u7b97**\u548c**\u5173\u7cfb\u8fd0\u7b97(\u6bd4\u8f83\u5927\u5c0f\u7b49\u7b49)**,\u4f46\u662f\u5728\u8fd9\u91cc\u4ec5\u4ec5\u662f\u63d0\u4e00\u4e0b,\u56e0\u4e3a\u8fd9\u90e8\u5206\u7684\u5185\u5bb9\u662f\u548c\u540e\u9762\u6307\u9488\u4e0e\u6570\u7ec4\u6709\u5173\u7cfb\u7684.\u5728\u540e\u9762\u6307\u9488\u4e0e\u6570\u7ec4\u4f1a\u5355\u72ec\u8bb2\u8fd9\u4e9b.</p>"},{"location":"native/basic/pointer%281%29/#vnullvoid","title":"\u2164.NULL\u6307\u9488\u548cvoid*","text":"<p>\u6709\u5f88\u591a\u5bf9\u4e8e\u6307\u9488\u4e0d\u662f\u5f88\u719f\u6089\u7684\u7ae5\u978b\u5728\u4e0a\u6570\u636e\u7ed3\u6784\u8bfe\u7684\u65f6\u5019\u4e00\u822c\u662f\u5f88\u61f5\u903c\u7684,\u56e0\u4e3a\u7528C\u8bb2\u6570\u636e\u7ed3\u6784\u7684\u65f6\u5019,\u6d89\u53ca\u5230\u5f88\u591a\u7684\u5185\u5b58\u5f00\u8f9f\u56de\u6536,\u4ee5\u53ca\u6307\u9488\u95ee\u9898(\u94fe\u5f0f\u7ed3\u6784).\u7136\u540e\u5f88\u591a\u4eba\u6ca1\u6709\u5b66\u597d\u4e0d\u662f\u56e0\u4e3a\u903b\u8f91\u80fd\u529b\u5dee,\u800c\u662f\u56e0\u4e3a\u5728\u4e00\u4e9b\u4ee3\u7801\u6216\u8005\u662f\u4f2a\u4ee3\u7801\u4e2d\u5bf9\u4e8e\u6307\u9488\u7684\u8ba4\u8bc6\u6a21\u68f1\u4e24\u53ef.\u4ee5\u81f3\u4e8e\u672c\u6765\u4ee3\u7801\u662f\u5b66\u4e60\u6570\u636e\u7ed3\u6784\u601d\u60f3\u7684\u597d\u5de5\u5177,\u53d8\u4e3a\u4e86\u5b66\u4e60\u6570\u636e\u7ed3\u6784\u7684\u8d1f\u62c5.</p>"},{"location":"native/basic/pointer%281%29/#null","title":"\u9996\u5148\u5148\u8bb2NULL\u6307\u9488.","text":"<p>NULL\u6307\u9488\u662f\u4e00\u79cd\u975e\u5e38\u7279\u6b8a\u7684\u6307\u9488(\u5e9f\u8bdd,\u4e0d\u7136\u5355\u72ec\u8bf4\u5b83\u5e72\u561b?),\u4e0d\u6307\u5411\u4efb\u4f55\u4e1c\u897f.\u8868\u793a\u4e0d\u6307\u5411\u4efb\u4f55\u4e1c\u897f\u7684\u6307\u9488(\u54e6,\u611f\u89c9\u597d\u5389\u5bb3\u7684\u6837\u5b50).\u4f46\u662f\u4e8b\u5b9e\u4e0a\u9762,\u8fd9\u79cd\u6280\u5de7\u975e\u5e38\u6709\u7528.(\u5f53\u4f60\u88ab\u94fe\u8868\u8650\u7684\u65f6\u5019\u5c31\u77e5\u9053\u4e86).</p> <p>\u6211\u4eec\u600e\u4e48\u628a\u4e00\u4e2a\u6307\u9488\u53d8\u4e3aNULL\u6307\u9488\u5462?\u5f88\u7b80\u5355,\u8d4b\u7ed9\u8fd9\u4e2a\u6307\u9488\u4e00\u4e2a0\u5c31\u884c\u4e86.\u4e0d\u7528\u8f6c\u5316,\u5c31\u662f\u6574\u5f62\u76840.\u540c\u6837,\u76f4\u63a5\u8d4bNULL\u4e5f\u662f\u884c\u7684.\u770b\u4e0b\u9762\u7684\u4f8b\u5b50.</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main()\n{\n//\u6d4b\u8bd5NULL\u662f\u4e0d\u662f0\nif(NULL==0)\ncout&lt;&lt;\"yes\"&lt;&lt;endl;\n//\u8f6c\u5316\u4e3aNULL\u6307\u9488\nint *p_a=0;\nint *p_b=NULL;\n}\n</code></pre> <p>\u4f8b\u5b50\u5f88\u7b80\u5355,\u5c31\u4e0d\u89e3\u91ca\u4e86.</p> <p>\u6709\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u662f,\u56e0\u4e3aNULL\u4e0d\u6307\u5411\u4efb\u4f55\u5730\u65b9,\u6240\u4ee5,\u4e5f\u5c31 \u80af\u5b9a\u4e0d\u80fd\u591f\u89e3\u5f15\u7528 \u4e86.\u8fd9\u70b9\u4e00\u5b9a\u8981\u6ce8\u610f.\u56e0\u4e3a\u8fde\u5730\u5740\u90fd\u6ca1\u6709,\u600e\u4e48\u5f97\u5230\u4e0d\u5b58\u5728\u7684\u5730\u5740\u4e2d\u7684\u503c\u5462?\u6240\u4ee5\u8981\u662f\u60f3\u4f60\u7684\u7a0b\u5e8f\u5065\u58ee,\u6700\u597d\u662f\u5728\u89e3\u5f15\u7528\u4e4b\u524d\u52a0\u4e00\u4e2a\u5224\u65ad\u662f\u5426\u4e3aNULL\u6307\u9488\u7684\u6b65\u9aa4,\u8981\u662f\u4f60\u6709\u8db3\u591f\u7684\u4fe1\u5fc3\u4ee5\u540e\u90fd\u4e0d\u4f1a\u6709\u95ee\u9898,\u90a3\u4e48\u4e0d\u52a0\u4e5f\u7f62.</p> <p>\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u662f\u5f53\u6211\u8bd5\u56fe\u5bf9\u4e00\u4e2aNULL\u6307\u9488\u89e3\u5f15\u7528\u4e4b\u540e\u7684\u7a0b\u5e8f\u8fd0\u884c\u60c5\u51b5.(\u5c31\u662f\u4e0a\u9762\u90a3\u4e2a\u4f8b\u5b50\u52a0\u4e86\u4e00\u53e5\u8bdd\u800c\u5df2)</p> <pre><code>#include &lt;iostream&gt;\nusing namespace std;\nint main()\n{\n//\u6d4b\u8bd5NULL\u662f\u4e0d\u662f0\nif(NULL==0)\ncout&lt;&lt;\"yes\"&lt;&lt;endl;\n//\u8f6c\u5316\u4e3aNULL\u6307\u9488\nint *p_a=0;\nint *p_b=NULL;\n//\u8bd5\u56fe\u89e3\u5f15\u7528\ncout&lt;&lt;*p_a&lt;&lt;endl;\n}\n</code></pre> <p></p> <p>\u76f4\u63a5\u5d29\u4e86,\u5176\u5b9e\u4e5f\u633a\u597d,\u81f3\u5c11\u6bd4\u627e\u4e0d\u5230\u7684\u9690\u5f62\u9519\u8bef\u8981\u597d.</p> <p>\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\u6709\u4e00\u53e5\u662f\u5224\u65ad<code>NULL==0</code>\u7684,\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e00\u4e0b,NULL\u662f\u4e00\u4e2a\u9884\u5904\u7406\u7684\u53d8\u91cf,\u503c\u4e3a0,\u5728\u5934\u6587\u4ef6cstdlib\u4e2d\u5b9a\u4e49,(\u6211\u8fd9\u91cc\u5e76\u6ca1\u6709\u663e\u5f0f\u8f7d\u5165\u4e5f\u80fd\u591f\u7528),\u56e0\u6b64\u7528\u5230NULL\u8fd9\u4e2a\u9884\u5904\u7406\u53d8\u91cf\u7684\u65f6\u5019,\u5c3d\u91cf\u5e26\u4e0acstdlib\u5934\u6587\u4ef6,\u89c4\u8303\u4e00\u70b9,\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u9519\u8bef. \u8bf4\u5230\u8fd9\u91cc,\u5176\u5b9e\u4f60\u53cd\u800c\u5e94\u8be5\u7591\u60d1\u4e86,\u6211\u4eec\u524d\u9762\u5df2\u7ecf\u8bf4\u8fc7\u4e86,\u6307\u9488\u5b58\u653e\u7684\u662f\u4e00\u4e2a\u5730\u5740.\u4e00\u822c\u6765\u8bf4,\u5730\u5740\u662f\u6574\u5f62\u6ca1\u9519,\u4f46\u662f\u5b83\u662f\u4e00\u79cd\u65b0\u7684\u7c7b\u578b\u6765\u8868\u793a\u5730\u5740.\u548c\u6574\u5f62\u5e76\u4e0d\u80fd\u591f\u517c\u5bb9\u6216\u8005\u8fd0\u7b97.\u4f46\u662f\u5f53\u4f7f\u75280\u6765\u8868\u793a\u7a7a\u6307\u9488\u7684\u65f6\u5019,\u6211\u4eec\u4fbf\u4f1a\u7591\u60d1,0\u5230\u5e95\u662f\u6574\u5f62\u5e38\u91cf\u8fd8\u662f\u4e00\u4e2a\u6307\u9488\u5e38\u91cf?</p> <p>\u56e0\u6b64,\u5728C++11\u4e2d,\u65b0\u5f15\u5165\u4e86\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\u7684\u5b57\u9762\u503c<code>nullptr</code>\u6765\u521d\u59cb\u5316\u6307\u9488\u4e3a\u7a7a\u6307\u9488.\u4ed6\u80fd\u591f\u88ab\u8f6c\u6362\u6210\u4efb\u4f55\u7c7b\u578b\u7684\u6307\u9488.</p> <pre><code>#include &lt;iostream&gt;\nint fun(int num)\n{\nreturn num+10;\n}\nint main()\n{\n//\u8868\u8fbe\u5f0f0==nullptr\u4e3a\u771f\u503c\nif(0==nullptr)\nstd::cout&lt;&lt;\"yes\"&lt;&lt;std::endl;\nint a=5;\nint *p=nullptr;\np=&amp;a;\nstd::cout&lt;&lt;\"Address of a:\"&lt;&lt;p&lt;&lt;std::endl;\nreturn 0;\n}\n</code></pre> <p></p> <p>\u8bb2\u5230\u73b0\u5728,\u53d1\u73b0\u524d\u9762\u5f88\u591a\u7684\u9519\u8bef\u90fd\u662f\u7531\u4e8e\u89e3\u5f15\u7528\u6ca1\u6709\u521d\u59cb\u5316\u7684\u6307\u9488\u5f15\u8d77\u6765\u7684.\u6240\u4ee5,\u8fd9\u91cc\u63d0\u4e2a\u5efa\u8bae,\u5c31\u662f \u5c3d\u91cf\u5b9a\u4e49\u4e86\u5bf9\u8c61\u4e4b\u540e\u518d\u5b9a\u4e49\u6307\u5411\u8fd9\u4e2a\u5bf9\u8c61\u7684\u6307\u9488,\u5bf9\u4e8e\u4e0d\u6e05\u695a\u7684\u6307\u5411\u54ea\u91cc\u7684\u6307\u9488,\u4e00\u5f8b\u521d\u59cb\u5316\u4e3a<code>nullptr(C++11)</code>\u6216\u8005<code>NULL(0)</code>.\u4e4b\u540e\u518d\u5224\u65ad\u662f\u5426\u6307\u5411\u5bf9\u8c61\u518d\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c.</p>"},{"location":"native/basic/pointer%281%29/#void","title":"\u63a5\u4e0b\u6765\u8bb2void*.","text":"<p><code>Void*</code>\u662f\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\u7684\u6307\u9488,\u80fd\u591f\u7528\u6765\u5b58\u653e\u4efb\u4f55\u7c7b\u578b\u5bf9\u8c61\u7684\u5730\u5740.\u901a\u4fd7\u6765\u8bf4,\u5c31\u662f\u6211\u4e0d\u77e5\u9053\u8fd9\u4e2a\u6307\u9488\u6307\u5411\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u5bf9\u8c61. \u8981\u662f\u8fd8\u662f\u7406\u89e3\u4e0d\u4e86\u90a3\u5c31\u4e0a\u4f8b\u5b50:</p> <pre><code>#include &lt;iostream&gt;\nint fun(int num)\n{\nreturn num+10;\n}\nint main()\n{\ndouble x=25.5;\n//\u666e\u901a\u6307\u9488\u7684\u8bdd\u7c7b\u578b\u8981\u4e25\u683c\u4fdd\u8bc1\ndouble *p=&amp;x;\n//void* \u7c7b\u578b\u53ef\u4ee5\u63a5\u53d7\u4efb\u610f\u7c7b\u578b\u5bf9\u8c61\u5730\u5740\nvoid *p_v=&amp;x;\nvoid *p_v2=p;\nstd::cout&lt;&lt;\"p_v:\"&lt;&lt;p_v&lt;&lt;std::endl;\nstd::cout&lt;&lt;\"p_v2:\"&lt;&lt;p_v2&lt;&lt;std::endl;\n}\n</code></pre> <p></p> <p><code>Void *</code>\u6682\u65f6\u4e86\u89e3\u5230\u8fd9\u91cc\u5c31\u884c\u4e86,\u540e\u9762\u5185\u5b58\u5206\u914d\u7684\u65f6\u5019\u8fd8\u4f1a\u4e13\u95e8\u548c\u4ed6\u6253\u4ea4\u9053.</p>"},{"location":"native/basic/pointer%281%29/#vi","title":"\u2165.\u6307\u9488\u7684\u6307\u9488","text":"<p>\u6307\u9488\u7684\u6307\u9488\u5c31\u662f\u6307\u5411\u6307\u9488\u7684\u6307\u9488.\u518d\u591a\u8bb2\u5c31\u7ed5\u6655\u4e86.\u76f4\u63a5\u770b\u5b9a\u4e49\u548c\u4f8b\u5b50\u5427.</p> <pre><code>#include &lt;iostream&gt;\nint main()\n{\nint a=10;\nint *p_a=&amp;a;\nint **pp_a=&amp;p_a;\nstd::cout&lt;&lt;\"p_a:\"&lt;&lt;p_a&lt;&lt;std::endl&lt;&lt;\"*p_a:\"&lt;&lt;*p_a&lt;&lt;std::endl;\nstd::cout&lt;&lt;std::endl;\nstd::cout&lt;&lt;\"PP_a:\"&lt;&lt;pp_a&lt;&lt;std::endl&lt;&lt;\"*pp_a:\"&lt;&lt;*pp_a&lt;&lt;std::endl&lt;&lt;\"**pp_a\"&lt;&lt;**pp_a&lt;&lt;std::endl;\n}\n</code></pre> <p></p> <p>\u901a\u8fc7\u8fd9\u4e2a\u4f8b\u5b50,\u6211\u4eec\u53d1\u73b0\u5176\u521b\u5efa\u65b9\u5f0f\u4e5f\u662f\u548c\u666e\u901a\u6307\u9488\u7684\u521b\u5efa\u65b9\u5f0f\u662f\u5dee\u4e0d\u591a\u7684,\u9664\u4e86\u521b\u5efa\u65f6\u5019\u7684\u4e24\u4e2a\u661f\u53f7<code>**</code>.\u90a3\u521b\u5efa\u6307\u9488\u5fc5\u5b9a\u9700\u8981\u6307\u9488\u7c7b\u578b,\u6307\u9488\u7c7b\u578b\u600e\u4e48\u9009\u62e9\u5462?\u901a\u4fd7\u4e00\u70b9\u8bf4,\u5c31\u662f\u8ddf\u7740\u524d\u9762\u7684\u8d70:\u6211\u4eec\u53d1\u73b0\u521b\u5efa\u6574\u5f62\u65f6\u5019\u4f7f\u7528\u7684\u662f<code>int</code>,\u6bd4\u5982\u8fd9\u91cc\u7684<code>int a=10;</code>.\u90a3\u6211\u4eec\u521b\u5efa\u6307\u5411a\u7684\u6307\u9488\u7684\u65f6\u5019,\u80af\u5b9a\u5fc5\u987b\u4e5f\u8981\u662fint\u4e86,\u6bd4\u5982\u8fd9\u91cc\u7684<code>int *p_a=&amp;a;</code>.\u6700\u540e\u521b\u5efa\u6307\u9488\u7684\u6307\u9488\u7684\u65f6\u5019,\u4e5f\u5c31\u7528int\u4e86.\u6bd4\u5982\u8fd9\u91cc\u7684<code>int **pp_a=&amp;p_a;</code> .\u5e76\u4e0d\u56f0\u96be</p> <p>\u53e6\u5916\u4e00\u4e2a\u5c31\u662f\u89e3\u5f15\u7528\u7684\u65f6\u5019,\u5e26\u4e0a\u4e24\u4e2a\u661f\u53f7,\u5c31\u56de\u5230\u7684\u6700\u5f00\u59cb\u7684\u90a3\u4e2a\u53d8\u91cf.\u8fd9\u4e48\u8bf4\u6709\u70b9\u6a21\u7cca.\u8be6\u7ec6\u6765\u8bf4,<code>**pp_a</code>\u56e0\u4e3a<code>*</code>\u7684\u4ece\u53f3\u5411\u5de6\u7684\u7ed3\u5408\u6027,\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5199\u6210<code>*(*pp_a)</code>,\u90a3\u4e48\u6211\u4eec\u77e5\u9053<code>pp_a</code>\u5b58\u653e\u7684\u662f<code>p_a</code>\u7684\u5730\u5740,<code>*pp_a</code>\u5c31\u662f\u8868\u793a<code>p_a</code>\u8fd9\u4e2a\u5730\u5740\u4e2d\u5b58\u653e\u7684\u5185\u5bb9\u5373<code>a</code>\u7684\u5730\u5740(\u4e0d\u80fd\u6655!!!).\u90a3\u4e48<code>*(*pp_a)</code>\u5c31\u76f8\u5f53\u4e8e<code>*p_a</code>\u6216\u8005<code>a</code>.</p> <p>\u81f3\u6b64,\u57fa\u672c\u7684\u6982\u5ff5\u90e8\u5206\u5c31\u7ed3\u675f\u5566.</p>"},{"location":"native/basic/pointer%281%29/#_2","title":"\u53c2\u8003","text":"<p>\u8f6c\u81eahttps://blog.csdn.net/xierhacker/article/details/52516742</p>"},{"location":"native/basic/pointer%282%29/","title":"\u6df1\u5ea6\u957f\u6587\u6559\u4f60\u5f7b\u5e95\u638c\u63e1C++/C\u6307\u9488(\u4e8c):\u6307\u9488\u548c\u6570\u7ec4\u4e0e\u5b57\u7b26\u4e32","text":"<p>\u8f6c\u81eahttps://blog.csdn.net/xierhacker/article/details/81078065</p>"},{"location":"native/basic/pointer%282%29/#_1","title":"\u4e00\uff1a\u590d\u4e60","text":"<p>\u9996\u5148\u5148\u56de\u987e\u4e00\u4e0b\u4e4b\u524d\u5bf9\u4e8e\u6307\u9488\u6982\u5ff5\u7684\u7406\u89e3. \u8ba1\u7b97\u673a\u5728\u5b58\u50a8\u6570\u636e\u7684\u65f6\u5019\u5fc5\u987b\u8ddf\u8e2a3\u79cd\u57fa\u672c\u5c5e\u6027</p> <ol> <li> <p>\u5b58\u50a8\u4f4d\u7f6e</p> </li> <li> <p>\u5b58\u50a8\u7684\u503c</p> </li> <li> <p>\u5b58\u50a8\u7684\u4fe1\u606f\u7c7b\u578b</p> </li> </ol> <p>\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u8bf4\u5df2\u7ecf\u8bf4\u5230\u4e86,\u8fd9\u91cc\u518d\u8bf4\u4e00\u904d,\u6307\u9488\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u5b58\u50a8\u7684\u662f\u5730\u5740\u3002 \u6240\u4ee5\u6307\u9488\u672c\u8d28\u662f\u4e00\u4e2a\u5730\u5740\uff01\u770b\u5230\u6307\u9488\u6761\u4ef6\u53cd\u5c04\u60f3\u5230\u5730\u5740\u3002    \u5bf9\u4e8e\u4e00\u4e2a\u5e38\u89c4\u53d8\u91cf\uff0c&amp;\u8fd0\u7b97\u7b26 \u5c31\u80fd\u591f\u53d6\u5f97\u4ed6\u7684\u5730\u5740\u3002\u6240\u4ee5\u4e00\u4e2a\u53d8\u91cf<code>var</code>\uff0c\u90a3\u4e48<code>&amp;var</code>\u5c31\u662f\u4e00\u4e2a\u5730\u5740\u3002</p> <pre><code>#include &lt;iostream&gt;\nint main()\n{\nint a=3;\nstd::cout&lt;&lt;\"the address of a:\"&lt;&lt;&amp;a&lt;&lt;std::endl;\nreturn 0;\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c:</p> <pre><code>the address of a:0x61ff18\n</code></pre> <p>\u8f93\u51fa\u5730\u5740\u662f\u4ee5\u5341\u516d\u8fdb\u5236\u6765\u8f93\u51fa\u7684\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u6307\u9488\u53d8\u91cf<code>pointer</code>\uff0c<code>*pointer</code>\u8868\u793a\u89e3\u9664\u5f15\u7528\uff0c\u5c06\u5176\u5e94\u7528\u4e8e\u6307\u9488\uff0c\u53ef\u4ee5\u5f97\u5230\u8be5\u5730\u5740\u5b58\u50a8\u7684\u503c\u3002\u4e14\u8fd9\u4e2a\u503c\u5c31\u662f\u5e38\u89c4\u7684\u503c\u3002</p> <pre><code>#include &lt;iostream&gt;\nint main()\n{\nint a=3;\nstd::cout&lt;&lt;\"the address of a:\"&lt;&lt;&amp;a&lt;&lt;std::endl;\nint* p_a=&amp;a;\nstd::cout&lt;&lt;\"the value of p_a is:\"&lt;&lt;p_a&lt;&lt;std::endl;\nstd::cout&lt;&lt;\"*p_a:\"&lt;&lt;*p_a&lt;&lt;std::endl;\nreturn 0;\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c:</p> <pre><code>the address of a:0x61ff18\nthe value of p_a is:0x61ff18\n*p_a:3\n</code></pre> <p>\u53ef\u4ee5\u77e5\u9053\uff0c\u8fd9\u91cc\u7684int\u53d8\u91cf\u548c\u6307\u9488\u53d8\u91cf\u5c31\u50cf\u540c\u4e00\u4e2a\u786c\u5e01\u7684\u6b63\u53cd\u9762\u3002\u53d8\u91cf\u8868\u793a\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528&amp;\u6765\u5f97\u5230\u5730\u5740\u3002 \u6307\u9488\u53d8\u91cf\u8868\u793a\u5730\u5740\uff0c\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528*\u6765\u5f97\u5230\u503c. <code>*p_a</code>\u548c<code>a</code>\u5c31\u662f\u7b49\u4ef7\u7684\u3002\u8fd9\u4e2a\u4e00\u5b9a\u8981\u77e5\u9053\uff0c\u662f\u540e\u9762\u4fee\u6539\u7684\u57fa\u7840\u3002</p>"},{"location":"native/basic/pointer%282%29/#_2","title":"\u58f0\u660e\u548c\u521d\u59cb\u5316\u6307\u9488","text":"<pre><code>typename*  name;\n</code></pre> <ul> <li>\u58f0\u660e\u7684\u65f6\u5019\u5fc5\u987b\u5e26\u6709<code>*</code>\u53f7\u6765\u8868\u793a\u8fd9\u4e2a\u65f6\u5019\u58f0\u660e\u7684\u662f\u4e00\u4e2a\u6307\u9488\u3002\u540c\u65f6\u5fc5\u987b\u7c7b\u578b\u8981\u660e\u786e\u3002</li> <li><code>*</code>\u53f7\u65c1\u8fb9\u7684\u7a7a\u683c\u662f\u53ef\u9009\u7684\uff0c\u4f46\u662f\u4e3a\u4e86\u4e0d\u548c\u89e3\u9664\u5e94\u7528\u7684<code>*</code>\u53f7\u76f8\u6df7\u6dc6\uff0c\u5f88\u591a\u4eba\u559c\u6b22\u8ba9<code>*</code>\u53f7\u7d27\u6328\u7740<code>typename</code>\uff08\u6bd4\u5982<code>int* p_a</code>\uff0c\u8868\u793a\u73b0\u5728\u6b63\u5728\u58f0\u660e\u7684\u662fint\u7c7b\u578b\u7684\u6307\u9488\u53d8\u91cf\uff09\u3002\u540c\u65f6\uff0c\u5728\u89e3\u9664\u5f15\u7528\u7684\u65f6\u5019\u7d27\u6328\u7740\u53d8\u91cf\uff0c\u8868\u793a\u662f\u5bf9\u8fd9\u4e2a\u53d8\u91cf\u7684\u89e3\u9664\u5f15\u7528\uff08<code>*p_a</code>\uff09</li> <li>\u5e94\u8be5\u6ce8\u610f\uff1a\u6307\u9488\u6307\u5411\u7684\u5730\u5740\u5b58\u50a8\u7684\u503c\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u957f\u5ea6\uff0c\u4f46\u662f\u6307\u9488\u672c\u8eab\u7684\u957f\u5ea6\u90fd\u662f\u4e00\u6837\u957f\u7684\uff01\uff08\u5730\u5740\u662f\u9700\u89812\u4e2a\u5b57\u8282\u8fd8\u662f\u9700\u89814\u4e2a\u5b57\u8282\uff0c\u53d6\u51b3\u4e8e\u7cfb\u7edf\u7684\u5b9e\u73b0\uff09</li> <li>\u53ef\u4ee5\u5728\u58f0\u660e\u6307\u9488\u7684\u65f6\u5019\u521d\u59cb\u5316\u6307\u9488\u3002\u8981\u6ce8\u610f\uff0c\u6307\u9488\u521d\u59cb\u5316\u65f6\u662f\u521d\u59cb\u5316\u5b83\u6307\u5411\u7684\u5730\u5740.\u8981\u662f\u6682\u65f6\u4e0d\u77e5\u9053\u8981\u521d\u59cb\u5316\u4e3a\u4ec0\u4e48\u6837\u5b50\u600e\u4e48\u529e? \u8fd9\u91cc\u63a8\u8350\u4e00\u79cd\u505a\u6cd5,\u5c31\u662f\u628a\u6307\u9488\u521d\u59cb\u5316\u4e3anullptr,\u7136\u540e\u5bf9\u6307\u9488\u8fdb\u884c\u5224\u65ad,\u8fd9\u6837\u80fd\u591f\u6709\u6548\u51cf\u5c11\u4e4b\u540e\u53ef\u80fd\u51fa\u73b0\u7684\u9519\u8bef.</li> </ul> <p>\u5fc5\u987b\u80cc\u4e0b\u6765\u7684\u7ecf\u9a8c\uff1a\u4e00\u5b9a\u8981\u5728\u5bf9\u6307\u9488\u89e3\u9664\u5f15\u7528\uff08*p_a\uff09\u4e4b\u524d\uff0c\u5c06\u6307\u9488\u521d\u59cb\u5316\u4e3a\u4e00\u4e2a\u786e\u5b9a\u7684\u9002\u5f53\u7684\u5730\u5740\u3002\u56e0\u4e3a,\u8981\u662f\u521d\u59cb\u5316\u7684\u65f6\u5019\u6ca1\u6709\u6307\u5b9a\u5730\u5740,\u90a3\u4e48\u89e3\u5f15\u7528\u7684\u5730\u5740\u8981\u4e48\u6ca1\u6709,\u8981\u4e48\u6709\u53ef\u80fd\u662f\u968f\u673a\u7684,\u8fd9\u6837\u98ce\u9669\u975e\u5e38\u5927.\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u63a8\u8350\u5c06\u6307\u9488\u521d\u59cb\u5316\u4e3a<code>nullptr</code>\u7684\u539f\u56e0,\u90a3\u4e48\u89e3\u5f15\u7528\u7684\u65f6\u5019\u53ef\u4ee5\u5148\u5224\u65ad\u662f\u5426\u4e3a<code>nullptr</code>,\u8981\u662f\u4e0d\u662f\u7684\u8bdd,\u8bf4\u660e\u8fd9\u4e2a\u6307\u9488\u6211\u4eec\u66fe\u7ecf\u624b\u52a8\u8d4b\u503c\u8fc7,\u53ef\u4ee5\u653e\u5fc3\u89e3\u5f15\u7528.</p>"},{"location":"native/basic/pointer%282%29/#_3","title":"\u4e8c.\u6307\u9488\u548c\u6570\u7ec4","text":"<p>\u8bf4\u5230\u6307\u9488\u548c\u6570\u7ec4,\u8fd9\u91cc\u76f4\u63a5\u8bf4\u4e09\u4e2a\u6700\u57fa\u672c\u7684\u89c4\u5219,\u8fd9\u4e09\u4e2a\u89c4\u5219\u57fa\u672c\u4e0a\u80fd\u591f\u6982\u62ec\u6307\u9488\u548c\u6570\u7ec4\u7684\u5e38\u89c1\u5173\u7cfb\u4e86.</p> <ol> <li> <p>\u4e00\u770b\u5230\u6570\u7ec4\uff0c\u5c31\u8981\u77e5\u9053\u6570\u7ec4\u540d\u53ef\u4ee5\u5f53\u505a\u8fd9\u4e2a\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5730\u5740\u3002\uff08<code>a=&amp;a[0]</code>\uff09</p> </li> <li> <p>\u5bf9\u4e8e\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\uff0c\u6307\u9488+n\u8868\u793a\u5f80\u540e\u79fb\u52a8n\u4e2a\u4f4d\u7f6e</p> </li> <li> <p>\u6307\u9488\u4e5f\u53ef\u4ee5\u50cf\u6570\u7ec4\u90a3\u6837\u7528<code>p_a[n]</code>\u8fd9\u79cd\u5f62\u5f0f\u76f4\u63a5\u53d6\u5143\u7d20\uff0c\u672c\u8d28\u662f<code>*(p_a+n)</code></p> </li> </ol>"},{"location":"native/basic/pointer%282%29/#_4","title":"\u4e09.\u6307\u9488\u548c\u5b57\u7b26\u4e32","text":"<p>\u6307\u9488\u548c\u5b57\u7b26\u4e32\u76f8\u4fe1\u662f\u5f88\u591a\u4eba\u4e00\u76f4\u5f04\u6df7\u6dc6\u7684\u5730\u65b9\u4e86.\u5176\u4e2d\u786e\u5b9e\u6709\u4e9b\u5730\u65b9\u9700\u8981\u7406\u4e00\u7406. \u6307\u9488\u548c\u5b57\u7b26\u4e32\u4e3b\u8981\u662f\u6307\u9488\u7528\u4e8ec\u98ce\u683c\u7684\u5b57\u7b26\u4e32.</p> <p>\u8fd9\u91cc\u9996\u5148\u628a\u91cd\u8981\u7684\u51e0\u4e2a\u89c4\u5219\u5217\u51fa\u6765,\u8fd9\u51e0\u4e2a\u89c4\u5219\u8db3\u591f\u5f04\u6e05\u695a\u6307\u9488\u548c\u5b57\u7b26\u4e32\u4e4b\u95f4\u7684\u5173\u7cfb\u4e86.</p> <ol> <li>\u5df2\u7ecf\u77e5\u9053\uff0cc\u98ce\u683c\u7684\u5b57\u7b26\u4e32\u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\uff0c\u6240\u4ee5\uff0c\u6570\u7ec4\u540d\u5c31\u662f\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u5730\u5740\u3002\u540c\u6837\uff0c\u4e00\u4e2a\u6307\u5411char\u7684\u6307\u9488\u53d8\u91cf\u4e5f\u80fd\u591f\u5b9e\u73b0\u5b57\u7b26\u4e32\u7684\u4e00\u4e9b\u4e1c\u897f.</li> <li>C++\u4e2d\uff0c\u5bf9\u4e8e\u5f15\u53f7\u5f15\u8d77\u6765\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u4ee3\u8868\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u5730\u5740\u3002</li> <li><code>cout</code>\u5bf9\u8c61\u8ba4\u4e3a\uff0c<code>char</code>\u7684\u5730\u5740\u662f\u5b57\u7b26\u4e32\u7684\u5730\u5740\uff0c\u56e0\u6b64\u5b83\u6253\u5370\u8be5\u5904\u7684\u5730\u5740\u5904\u7684\u5b57\u7b26\uff0c \u7136\u540e\u7ee7\u7eed\u6253\u5370\u540e\u9762\u7684\u5b57\u7b26\u3002\u76f4\u5230\u9047\u5230\u7a7a\u5b57\u7b26<code>\u2019\\0\u2019</code>\u4e4b\u540e\u624d\u505c\u6b62\u3002</li> </ol> <p>\u8fd9\u91cc\u4e3e\u4e00\u4e2a\u4f8b\u5b50\u6765\u8be6\u7ec6\u8bf4\u660e.</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;cstring&gt;\nint main()\n{\nchar animal[20]=\"bear\";\nconst char* bird=\"wren\";\nchar* p_s;\n//\u6570\u7ec4\u540d\u4e5f\u662f\u6307\u9488\nstd::cout&lt;&lt;animal&lt;&lt;\" and \"&lt;&lt;bird&lt;&lt;std::endl;\n//\u76f4\u63a5\u8f93\u51fa\u6307\u9488\np_s=animal;\nstd::cout&lt;&lt;\"p_s:\"&lt;&lt;p_s&lt;&lt;std::endl;\n//\u60f3\u8981\u8f93\u51fa\u771f\u7684\u5730\u5740\u600e\u4e48\u529e?\nstd::cout&lt;&lt;\"address of animal:\"&lt;&lt;(int*)animal&lt;&lt;std::endl;\nreturn 0;\n}\n</code></pre> <ol> <li>\u6c38\u8fdc\u5e94\u8be5\u8bb0\u4f4f\uff0c\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\u7684C\u98ce\u683c\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\uff0c\u5b57\u7b26\u6570\u7ec4\uff0c\u5b57\u7b26\u6307\u9488\u53d8\u91cf\u8fd9\u51e0\u4e2a\u662f\u76f8\u901a\u7b49\u4ef7\u7684\u3002</li> <li>\u6ce8\u610f<code>const char* bird=\"wren\";</code>\u8981\u662f\u4e0d\u4f7f\u7528const\u4f1a\u6709\u8b66\u544a,\u56e0\u4e3a\u4e0d\u80fd\u591f\u7528\u53ef\u53d8\u7684\u6307\u9488\u6765\u4fee\u6539\u5e38\u91cf.</li> <li>\u5f53cout\u540e\u9762\u662f\u5176\u4ed6\u7684\u6307\u9488\u7684\u65f6\u5019\uff0c\u4f1a\u8f93\u51fa\u8be5\u6307\u9488\u7684\u503c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5730\u5740\uff0c\u4f46\u662fcout\u9047\u5230char* \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8f93\u51fa\u5f53\u524dchar*\u6307\u5411\u7684\u503c\uff0c\u540c\u65f6\u4e5f\u4f1a\u8f93\u51fa\u540e\u9762\u7684\u503c\uff0c\u76f4\u5230\u9047\u5230\u7a7a\u5b57\u7b26\u4e3a\u6b62\u3002*</li> <li>\u6240\u4ee5\u5728\u4e0a\u9762\u7a0b\u5e8f\u768420\u548c21\u884c\u6709\u4e00\u4e2a\uff08<code>int*</code>\uff09\u5f3a\u5236\u8f6c\u5316\u4e3a\u6574\u5f62\u6307\u9488\uff0c\u4e0d\u7136\u5c31\u6ca1\u5f97\u8f93\u51fa\u4e86\u3002</li> </ol>"},{"location":"perf-opt/","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"perf-opt/Android/anr/anr/","title":"ANR\u539f\u7406","text":""},{"location":"perf-opt/Android/anr/anr/#1-anr","title":"1. ANR\u662f\u4ec0\u4e48","text":"<p>ANR\u5168\u79f0\u662fApplicatipon No Response\uff0cAndroid\u8bbe\u8ba1ANR\u7684\u7528\u610f\uff0c\u662f\u7cfb\u7edf\u901a\u8fc7\u4e0e\u4e4b\u4ea4\u4e92\u7684\u7ec4\u4ef6\u4ee5\u53ca\u7528\u6237\u4ea4\u4e92\u8fdb\u884c\u8d85\u65f6\u76d1\u63a7\uff0c\u7528\u6765\u5224\u65ad\u5e94\u7528\u8fdb\u7a0b\u662f\u5426\u5b58\u5728\u5361\u6b7b\u6216\u54cd\u5e94\u8fc7\u6162\u7684\u95ee\u9898\uff0c\u901a\u4fd7\u6765\u8bf4\u5c31\u662f\u5f88\u591a\u7cfb\u7edf\u4e2d\u770b\u95e8\u72d7(watchdog)\u7684\u8bbe\u8ba1\u601d\u60f3\u3002</p>"},{"location":"perf-opt/Android/anr/anr/#11-anr","title":"1.1. ANR\u8d85\u65f6\u9608\u503c","text":"<p>\u4e0d\u540c\u7ec4\u4ef6\u7684\u8d85\u65f6\u9608\u503c\u5404\u6709\u4e0d\u540c\uff0c\u5173\u4e8eservice\u3001broadcast\u3001contentprovider\u4ee5\u53cainput\u7684\u8d85\u65f6\u9608\u503c\u5982\u4e0b\u8868\uff1a</p> <p></p> <p>(\u56fe\u8868\u4ec5\u4f9b\u53c2\u8003\uff0c\u56fd\u5185\u5382\u5546\u53ef\u80fd\u4f1a\u6709\u8c03\u6574\uff0c\u6bcf\u4e2a\u5382\u5546\u7684\u6807\u51c6\u4e5f\u5b58\u5728\u5dee\u5f02)</p> <p>\u524d\u53f0\u4e0e\u540e\u53f0\u670d\u52a1\u7684\u533a\u522b</p> <p>\u7cfb\u7edf\u5bf9\u524d\u53f0\u670d\u52a1\u542f\u52a8\u7684\u8d85\u65f6\u4e3a20s\uff0c\u800c\u540e\u53f0\u670d\u52a1\u8d85\u65f6\u4e3a200s\uff0c\u90a3\u4e48\u7cfb\u7edf\u662f\u5982\u4f55\u533a\u522b\u524d\u53f0\u8fd8\u662f\u540e\u53f0    \u670d\u52a1\u5462\uff1f</p> <p>\u5728startService\u8fc7\u7a0b\u6839\u636e\u53d1\u8d77\u65b9\u8fdb\u7a0bcallerApp\u6240\u5c5e\u7684\u8fdb\u7a0b\u8c03\u5ea6\u7ec4\u6765\u51b3\u5b9a\u88ab\u542f\u52a8\u7684\u670d\u52a1\u662f\u5c5e\u4e8e  \u524d\u53f0\u8fd8\u662f\u540e\u53f0\u3002\u5f53\u53d1\u8d77\u65b9\u8fdb\u7a0b\u4e0d\u7b49\u4e8eProcessList.SCHED_GROUP_BACKGROUND(\u540e\u53f0\u8fdb\u7a0b\u7ec4)  \u5219\u8ba4\u4e3a\u662f\u524d\u53f0\u670d\u52a1\uff0c\u5426\u5219\u4e3a\u540e\u53f0\u670d\u52a1\uff0c\u5e76\u6807\u8bb0\u5728ServiceRecord\u7684\u6210\u5458\u53d8\u91cfcreatedFromFg\u3002</p> <p>\u4ec0\u4e48\u8fdb\u7a0b\u5c5e\u4e8eSCHED_GROUP_BACKGROUND\u8c03\u5ea6\u7ec4\u5462\uff1f\u8fdb\u7a0b\u8c03\u5ea6\u7ec4\u5927\u4f53\u53ef\u5206\u4e3aTOP\u3001\u524d\u53f0\u3001\u540e\u53f0\uff0c\u8fdb\u7a0b\u4f18\u5148\u7ea7\uff08Adj\uff09\u548c\u8fdb\u7a0b\u8c03\u5ea6\u7ec4\uff08SCHED_GROUP\uff09\u7b97\u6cd5\u8f83\u4e3a\u590d\u6742\uff0c\u5176\u5bf9\u5e94\u5173\u7cfb\u53ef\u7c97\u7565\u7406\u89e3 \u4e3aAdj\u7b49\u4e8e0\u7684\u8fdb\u7a0b\u5c5e\u4e8eTop\u8fdb\u7a0b\u7ec4\uff0cAdj\u7b49\u4e8e100\u6216\u8005200\u7684\u8fdb\u7a0b\u5c5e\u4e8e\u524d\u53f0\u8fdb\u7a0b\u7ec4\uff0cAdj\u5927\u4e8e200\u7684\u8fdb\u7a0b\u5c5e\u4e8e\u540e\u53f0\u8fdb\u7a0b\u7ec4\u3002\u5173\u4e8eAdj\u7684\u542b\u4e49\u89c1\u4e0b\u8868\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662fAdj&gt;200\u7684\u8fdb\u7a0b\u5bf9\u7528\u6237\u6765\u8bf4\u57fa\u672c\u662f\u65e0\u611f\u77e5\uff0c\u4e3b\u8981\u662f\u505a\u4e00\u4e9b\u540e\u53f0\u5de5\u4f5c\uff0c\u6545\u540e\u53f0\u670d\u52a1\u62e5\u6709\u66f4\u957f\u7684\u8d85\u65f6\u9608\u503c\uff0c\u540c\u65f6\u540e\u53f0\u670d\u52a1\u5c5e\u4e8e\u540e\u53f0\u8fdb \u7a0b\u8c03\u5ea6\u7ec4\uff0c\u76f8\u6bd4\u524d\u53f0\u670d\u52a1\u5c5e\u4e8e\u524d\u53f0\u8fdb\u7a0b\u8c03\u5ea6\u7ec4\uff0c\u5206\u914d\u66f4\u5c11\u7684CPU\u65f6\u95f4\u7247\u3002</p> <p>\u524d\u53f0\u4e0e\u540e\u53f0\u5e7f\u64ad\u533a\u522b</p> <p>\u524d\u53f0\u5e7f\u64ad\u8d85\u65f6\u4e3a10s\uff0c\u540e\u53f0\u5e7f\u64ad\u8d85\u65f6\u4e3a60s\uff0c\u90a3\u4e48\u5982\u4f55\u533a\u5206\u524d\u53f0\u548c\u540e\u53f0\u5e7f\u64ad\u5462\uff1f</p> <p>\u6839\u636e\u53d1\u9001\u5e7f\u64adsendBroadcast(Intent intent)\u4e2d\u7684intent\u7684flags\u662f\u5426\u5305\u542bFLAG_RECEIVER_FOREGROUND\u6765\u51b3\u5b9a\u628a\u8be5\u5e7f\u64ad\u662f\u653e\u5165\u524d\u53f0\u5e7f\u64ad\u961f\u5217\u6216\u8005\u540e\u53f0\u5e7f\u64ad\u961f\u5217\uff0c\u524d\u53f0\u5e7f\u64ad\u961f\u5217\u7684\u8d85\u65f6\u4e3a10s\uff0c\u540e\u53f0\u5e7f\u64ad\u961f\u5217\u7684\u8d85\u65f6\u4e3a60s\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5e7f\u64ad\u662f\u653e\u5165\u540e\u53f0\u5e7f\u64ad\u961f\u5217\uff0c\u9664\u975e\u6307\u660e\u52a0\u4e0aFLAG_RECEIVER_FOREGROUND\u6807\u8bc6\u3002</p>"},{"location":"perf-opt/Android/anr/anr/#2anr","title":"2.ANR\u89e6\u53d1\u539f\u7406","text":"<p>\u901a\u5e38\u6765\u8bb2\uff0cANR\u7684\u6765\u6e90\u5206\u4e3aService\u3001Broadcast\u3001Provider\u4ee5\u53caInput\u4e24\u79cd\u3002</p> <p>\u8fd9\u6837\u533a\u5206\u7684\u539f\u56e0\u662f\uff0c\u9996\u5148\uff0c\u524d\u8005\u53d1\u751f\u5728 \u5e94\u7528\u8fdb\u7a0b \u7ec4\u4ef6\u4e2d\u7684ANR\u95ee\u9898\u901a\u5e38\u662f\u76f8\u5bf9\u597d\u89e3\u51b3\u7684\uff0c\u82e5ANR\u672c\u8eab\u5bb9\u6613\u590d\u73b0\uff0c\u5f00\u53d1\u8005\u901a\u5e38\u4ec5\u9700\u8981\u786e\u5b9a\u7ec4\u4ef6\u7684\u4ee3\u7801\u4e2d\u662f\u5426\u5728 \u4e3b\u7ebf\u7a0b\u4e2d\u505a\u4e86\u8017\u65f6\u5904\u7406\uff1b\u800c\u540e\u8005ANR\u53d1\u751f\u7684\u539f\u56e0\u4e3a \u8f93\u5165\u4e8b\u4ef6 \u5206\u53d1\u8d85\u65f6\uff0c\u5305\u62ec\u6309\u952e\u548c\u5c4f\u5e55\u7684\u89e6\u6478\u4e8b\u4ef6\uff0c\u5176\u6574\u4e2a\u6d41\u7a0b\u76f8\u6bd4\u524d\u8005\u800c\u8a00\u903b\u8f91\u66f4\u52a0\u590d\u6742\u3002\u800c\u4e14Input\u7c7b\u578b\u7684ANR\u76f8\u5bf9\u4e8eService\u3001Broadcast\u3001Provider\uff0c\u5176\u5185\u90e8\u7684\u673a\u5236\u53c8\u622a\u7136\u4e0d\u540c\u3002</p>"},{"location":"perf-opt/Android/anr/anr/#21-servicebroadcastprovider","title":"2.1  Service\u3001Broadcast\u3001Provider","text":"<p>\u53ef\u4ee5\u628a\u53d1\u751fANR\u6bd4\u4f5c\u662f\u5f15\u7206\u70b8\u5f39\uff0c\u90a3\u4e48\u6574\u4e2a\u6d41\u7a0b\u5305\u542b\u4e09\u90e8\u5206\u7ec4\u6210\uff1a</p> <ol> <li> <p>\u57cb\u5b9a\u65f6\u70b8\u5f39\uff1a\u4e2d\u63a7\u7cfb\u7edf(system_server\u8fdb\u7a0b)\u542f\u52a8\u5012\u8ba1\u65f6\uff0c\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u5982\u679c\u76ee\u6807(\u5e94\u7528\u8fdb\u7a0b)\u6ca1\u6709\u5e72\u5b8c\u6240\u6709\u7684\u6d3b\uff0c\u5219\u4e2d\u63a7\u7cfb\u7edf\u4f1a\u5b9a\u5411\u70b8\u6bc1(\u6740\u8fdb\u7a0b)\u76ee\u6807\u3002</p> </li> <li> <p>\u62c6\u70b8\u5f39\uff1a\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u5e72\u5b8c\u5de5\u5730\u7684\u6240\u6709\u6d3b\uff0c\u5e76\u53ca\u65f6\u5411\u4e2d\u63a7\u7cfb\u7edf\u62a5\u544a\u5b8c\u6210\uff0c\u8bf7\u6c42\u89e3\u9664\u5b9a\u65f6\u70b8\u5f39\uff0c\u5219\u5e78\u514d\u4e8e\u96be\u3002</p> </li> <li> <p>\u5f15\u7206\u70b8\u5f39\uff1a\u4e2d\u63a7\u7cfb\u7edf\u7acb\u5373\u5c01\u88c5\u73b0\u573a\uff0c\u6293\u53d6\u5feb\u7167\uff0c\u641c\u96c6\u76ee\u6807\u6267\u884c\u6162\u7684\u7f6a\u8bc1(traces)\uff0c\u4fbf\u4e8e\u540e\u7eed\u7684\u6848\u4ef6\u4fa6\u7834(\u8c03\u8bd5\u5206\u6790)\uff0c\u6700\u540e\u662f\u70b8\u6bc1\u76ee\u6807\u3002</p> </li> </ol> <p>\u4ee5Service\u4e3a\u4f8b\uff0c\u6765\u770b\u770b\u57cb\u70b8\u5f39\u4e0e\u62c6\u70b8\u5f39\u5728\u6574\u4e2a\u670d\u52a1\u542f\u52a8(startService)\u8fc7\u7a0b\u6240\u5904\u7684\u73af\u8282\u3002</p> <p></p> <p>startService(\u57cb\u5b9a\u65f6\u70b8\u5f39)</p> <pre><code>//com.android.server.am.ActiveServices.java\nprivate final void realStartServiceLocked(ServiceRecord r,\nProcessRecord app, boolean execInFg) throws RemoteException {\n......\n//\u53d1\u4e2a\u5ef6\u8fdf\u6d88\u606f\u7ed9AMS\u7684Handler\nbumpServiceExecutingLocked(r, execInFg, \"create\");\n......\ntry {\n//IPC\u901a\u77e5app\u8fdb\u7a0b\u542f\u52a8Service\uff0c\u6267\u884chandleCreateService\napp.thread.scheduleCreateService(r, r.serviceInfo,\nmAm.compatibilityInfoForPackage(r.serviceInfo.applicationInfo),\napp.getReportedProcState());\n} catch (DeadObjectException e) {\n} finally {\n}\n}\nprivate final void bumpServiceExecutingLocked(ServiceRecord r, boolean fg, String why) {\nscheduleServiceTimeoutLocked(r.app);\n.....\n}\nvoid scheduleServiceTimeoutLocked(ProcessRecord proc) {\n...\n//\u53d1\u4e2a\u5ef6\u8fdf\u6d88\u606f\u7ed9AMS\u91cc\u9762\u7684\u4e00\u4e2aHandler, \u5f53\u8d85\u65f6\u540e\u4ecd\u6ca1\u6709remove\u8be5SERVICE_TIMEOUT_MSG\u6d88\u606f\uff0c\u5219\u6267\u884cservice Timeout\u6d41\u7a0b\nmAm.mHandler.sendMessageDelayed(msg,\nproc.execServicesFg ? SERVICE_TIMEOUT : SERVICE_BACKGROUND_TIMEOUT);\n}\n</code></pre> <p>serviceDoneExecuting(\u62c6\u70b8\u5f39)</p> <pre><code>//android.app.ActivityThread.java\n@UnsupportedAppUsage\nprivate void handleCreateService(CreateServiceData data) {\n......\nService service = null;\ntry {\n...\ntry {\n//Service\u542f\u52a8\u5b8c\u6210\uff0c\u9700\u8981\u901a\u77e5AMS\nActivityManager.getService().serviceDoneExecuting(\ndata.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);\n} catch (RemoteException e) {\n}\n} catch (Exception e) {\n}\n}\n//ActiveServices.java\nprivate void serviceDoneExecutingLocked(ServiceRecord r, boolean inDestroying,\nboolean finishing) {\n......\nmAm.mHandler.removeMessages(ActivityManagerService.SERVICE_TIMEOUT_MSG, r.app);\n......\n}\n</code></pre> <p>SERVICE_TIMEOUT(\u5f15\u7206\u70b8\u5f39)</p> <pre><code>//com.android.server.am.ActivityManagerService.java\nfinal MainHandler mHandler;\nfinal class MainHandler extends Handler {\n@Override\npublic void handleMessage(Message msg) {\nswitch (msg.what) {\n......\ncase SERVICE_TIMEOUT_MSG: {\n//\u8fd9\u4e2amServices\u662fActiveServices\nmServices.serviceTimeout((ProcessRecord)msg.obj);\n} break;\n}\n......\n}\n......\n}\n//com.android.server.am.ActiveServices.java\nvoid serviceTimeout(ProcessRecord proc) {\nString anrMessage = null;\nsynchronized(mAm) {\n//\u8ba1\u7b97\u662f\u5426\u6709service\u8d85\u65f6\nfinal long now = SystemClock.uptimeMillis();\nfinal long maxTime =  now -\n(proc.execServicesFg ? SERVICE_TIMEOUT : SERVICE_BACKGROUND_TIMEOUT);\nServiceRecord timeout = null;\nfor (int i=proc.executingServices.size()-1; i&gt;=0; i--) {\nServiceRecord sr = proc.executingServices.valueAt(i);\nif (sr.executingStart &lt; maxTime) {\ntimeout = sr;\nbreak;\n}\n}\nif (timeout != null &amp;&amp; mAm.mProcessList.mLruProcesses.contains(proc)) {\nanrMessage = \"executing service \" + timeout.shortInstanceName;\n}\n}\nif (anrMessage != null) {\n//\u89e6\u53d1ANR,appNotResponding\u65b9\u6cd5\u6765\u5904\u7406ANR\u7684\u6d41\u7a0b\uff08\u5f39\u51faapp\u65e0\u54cd\u5e94\u5f39\u7a97\u3001dump\u5806\u6808\u4ec0\u4e48\u7684\uff09\nmAm.mAnrHelper.appNotResponding(proc, anrMessage);\n}\n}\n</code></pre> <p>broadcast\u3001provider\u8ddfservice\u8d85\u65f6\u673a\u5236\u5927\u62b5\u76f8\u540c\uff0c\u4e0d\u8fc7provider\u7684\u8d85\u65f6\u662f\u5728provider\u8fdb\u7a0b\u9996\u6b21\u542f\u52a8\u7684\u65f6\u5019\u624d\u4f1a\u68c0\u6d4b\uff0c\u5f53provider\u8fdb\u7a0b\u5df2\u542f\u52a8\u7684\u573a\u666f\uff0c\u518d\u6b21\u8bf7\u6c42provider\u5e76\u4e0d\u4f1a\u89e6\u53d1provider\u8d85\u65f6\u3002</p>"},{"location":"perf-opt/Android/anr/anr/#22-input","title":"2.2  Input","text":"<p>input\u7684\u8d85\u65f6\u68c0\u6d4b\u673a\u5236\u8ddfservice\u3001broadcast\u3001provider\u622a\u7136\u4e0d\u540c\uff0c\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3input\u8fc7\u7a0b\u5148\u6765\u4ecb\u7ecd\u4e24\u4e2a\u91cd\u8981\u7ebf\u7a0b\u7684\u76f8\u5173\u5de5\u4f5c\uff1a</p> <ul> <li>InputReader\u7ebf\u7a0b\u8d1f\u8d23\u901a\u8fc7EventHub(\u76d1\u542c\u76ee\u5f55/dev/input)\u8bfb\u53d6\u8f93\u5165\u4e8b\u4ef6\uff0c\u4e00\u65e6\u76d1\u542c\u5230\u8f93\u5165\u4e8b\u4ef6\u5219\u653e\u5165\u5230InputDispatcher\u7684mInBoundQueue\u961f\u5217\uff0c\u5e76\u901a\u77e5\u5176\u5904\u7406\u8be5\u4e8b\u4ef6\uff1b</li> <li>InputDispatcher\u7ebf\u7a0b\u8d1f\u8d23\u5c06\u63a5\u6536\u5230\u7684\u8f93\u5165\u4e8b\u4ef6\u5206\u53d1\u7ed9\u76ee\u6807\u5e94\u7528\u7a97\u53e3\uff0c\u5206\u53d1\u8fc7\u7a0b\u4f7f\u7528\u52303\u4e2a\u4e8b\u4ef6\u961f\u5217\uff1a</li> <li>mInBoundQueue\u7528\u4e8e\u8bb0\u5f55InputReader\u53d1\u9001\u8fc7\u6765\u7684\u8f93\u5165\u4e8b\u4ef6\uff1b</li> <li>outBoundQueue\u7528\u4e8e\u8bb0\u5f55\u5373\u5c06\u5206\u53d1\u7ed9\u76ee\u6807\u5e94\u7528\u7a97\u53e3\u7684\u8f93\u5165\u4e8b\u4ef6\uff1b</li> <li>waitQueue\u7528\u4e8e\u8bb0\u5f55\u5df2\u5206\u53d1\u7ed9\u76ee\u6807\u5e94\u7528\uff0c\u4e14\u5e94\u7528\u5c1a\u672a\u5904\u7406\u5b8c\u6210\u7684\u8f93\u5165\u4e8b\u4ef6\uff1b</li> </ul> <p>input\u7684\u8d85\u65f6\u673a\u5236\u5e76\u975e\u65f6\u95f4\u5230\u4e86\u4e00\u5b9a\u5c31\u4f1a\u7206\u70b8\uff0c\u800c\u662f\u5904\u7406\u540e\u7eed\u4e0a\u62a5\u4e8b\u4ef6\u7684\u8fc7\u7a0b\u624d\u4f1a\u53bb\u68c0\u6d4b\u662f\u5426\u8be5\u7206\u70b8\uff0c\u6240\u4ee5\u66f4\u50cf\u662f\u626b\u96f7\u7684\u8fc7\u7a0b\uff0c\u5177\u4f53\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u56fe\u89e3\uff1a</p> <ol> <li>InputReader\u7ebf\u7a0b\u901a\u8fc7EventHub\u76d1\u542c\u5e95\u5c42\u4e0a\u62a5\u7684\u8f93\u5165\u4e8b\u4ef6\uff0c\u4e00\u65e6\u6536\u5230\u8f93\u5165\u4e8b\u4ef6\u5219\u5c06\u5176\u653e\u81f3mInBoundQueue\u961f\u5217\uff0c\u5e76\u5524\u9192InputDispatcher\u7ebf\u7a0b</li> <li>InputDispatcher\u5f00\u59cb\u5206\u53d1\u8f93\u5165\u4e8b\u4ef6\uff0c\u8bbe\u7f6e\u57cb\u96f7\u7684\u8d77\u70b9\u65f6\u95f4\u3002\u5148\u68c0\u6d4b\u662f\u5426\u6709\u6b63\u5728\u5904\u7406\u7684\u4e8b\u4ef6(mPendingEvent)\uff0c\u5982\u679c\u6ca1\u6709\u5219\u53d6\u51famInBoundQueue\u961f\u5934\u7684\u4e8b\u4ef6\uff0c\u5e76\u5c06\u5176\u8d4b\u503c\u7ed9mPendingEvent\uff0c\u4e14\u91cd\u7f6eANR\u7684timeout\uff1b\u5426\u5219\u4e0d\u4f1a\u4ecemInBoundQueue\u4e2d\u53d6\u51fa\u4e8b\u4ef6\uff0c\u4e5f\u4e0d\u4f1a\u91cd\u7f6etimeout\u3002\u7136\u540e\u68c0\u67e5\u7a97\u53e3\u662f\u5426\u5c31\u7eea(checkWindowReadyForMoreInputLocked)\uff0c\u6ee1\u8db3\u4ee5\u4e0b\u4efb\u4e00\u60c5\u51b5\uff0c\u5219\u4f1a\u8fdb\u5165\u626b\u96f7\u72b6\u6001(\u68c0\u6d4b\u524d\u4e00\u4e2a\u6b63\u5728\u5904\u7406\u7684\u4e8b\u4ef6\u662f\u5426\u8d85\u65f6)\uff0c\u7ec8\u6b62\u672c\u8f6e\u4e8b\u4ef6\u5206\u53d1\uff0c\u5426\u5219\u7ee7\u7eed\u6267\u884c\u6b65\u9aa43\u3002<ul> <li>\u5bf9\u4e8e\u6309\u952e\u7c7b\u578b\u7684\u8f93\u5165\u4e8b\u4ef6\uff0c\u5219outboundQueue\u6216\u8005waitQueue\u4e0d\u4e3a\u7a7a\uff0c</li> <li>\u5bf9\u4e8e\u975e\u6309\u952e\u7684\u8f93\u5165\u4e8b\u4ef6\uff0c\u5219waitQueue\u4e0d\u4e3a\u7a7a\uff0c\u4e14\u7b49\u5f85\u961f\u5934\u65f6\u95f4\u8d85\u65f6500ms</li> </ul> </li> <li>\u5f53\u5e94\u7528\u7a97\u53e3\u51c6\u5907\u5c31\u7eea\uff0c\u5219\u5c06mPendingEvent\u8f6c\u79fb\u5230outBoundQueue\u961f\u5217</li> <li>\u5f53outBoundQueue\u4e0d\u4e3a\u7a7a\uff0c\u4e14\u5e94\u7528\u7ba1\u9053\u5bf9\u7aef\u8fde\u63a5\u72b6\u6001\u6b63\u5e38\uff0c\u5219\u5c06\u6570\u636e\u4eceoutboundQueue\u4e2d\u53d6\u51fa\u4e8b\u4ef6\uff0c\u653e\u5165waitQueue\u961f\u5217</li> <li>InputDispatcher\u901a\u8fc7socket\u544a\u77e5\u76ee\u6807\u5e94\u7528\u6240\u5728\u8fdb\u7a0b\u53ef\u4ee5\u51c6\u5907\u5f00\u59cb\u5e72\u6d3b</li> <li>App\u5728\u521d\u59cb\u5316\u65f6\u9ed8\u8ba4\u5df2\u521b\u5efa\u8ddf\u4e2d\u63a7\u7cfb\u7edf\u53cc\u5411\u901a\u4fe1\u7684socketpair\uff0c\u6b64\u65f6App\u7684\u5305\u5de5\u5934(main\u7ebf\u7a0b)\u6536\u5230\u8f93\u5165\u4e8b\u4ef6\u540e\uff0c\u4f1a\u5c42\u5c42\u8f6c\u53d1\u5230\u76ee\u6807\u7a97\u53e3\u6765\u5904\u7406</li> <li>\u5305\u5de5\u5934\u5b8c\u6210\u5de5\u4f5c\u540e\uff0c\u4f1a\u901a\u8fc7socket\u5411\u4e2d\u63a7\u7cfb\u7edf\u6c47\u62a5\u5de5\u4f5c\u5b8c\u6210\uff0c\u5219\u4e2d\u63a7\u7cfb\u7edf\u4f1a\u5c06\u8be5\u4e8b\u4ef6\u4ecewaitQueue\u961f\u5217\u4e2d\u79fb\u9664\u3002</li> </ol> <p>input\u8d85\u65f6\u673a\u5236\u4e3a\u4ec0\u4e48\u662f\u626b\u96f7\uff0c\u800c\u975e\u5b9a\u65f6\u7206\u70b8\u5462\uff1f</p> <p>\u7531\u4e8e\u5bf9\u4e8einput\u6765\u8bf4\u5373\u4fbf\u67d0\u6b21\u4e8b\u4ef6\u6267\u884c\u65f6\u95f4\u8d85\u8fc7timeout\u65f6\u957f\uff0c\u53ea\u8981\u7528\u6237\u540e\u7eed\u5728\u6ca1\u6709\u518d\u751f\u6210\u8f93\u5165\u4e8b\u4ef6\uff0c\u5219\u4e0d\u4f1a\u89e6\u53d1ANR\u3002 \u8fd9\u91cc\u7684\u626b\u96f7\u662f\u6307\u5f53\u524d\u8f93\u5165\u7cfb\u7edf\u4e2d\u6b63\u5728\u5904\u7406\u7740\u67d0\u4e2a\u8017\u65f6\u4e8b\u4ef6\u7684\u524d\u63d0\u4e0b\uff0c\u540e\u7eed\u7684\u6bcf\u4e00\u6b21input\u4e8b\u4ef6\u90fd\u4f1a\u68c0\u6d4b\u524d\u4e00\u4e2a\u6b63\u5728\u5904\u7406\u7684\u4e8b\u4ef6\u662f\u5426\u8d85\u65f6\uff08\u8fdb\u5165\u626b\u96f7\u72b6\u6001\uff09\uff0c\u68c0\u6d4b\u5f53\u524d\u7684\u65f6\u95f4\u8ddd\u79bb\u4e0a\u6b21\u8f93\u5165\u4e8b\u4ef6\u5206\u53d1\u65f6\u95f4\u70b9\u662f\u5426\u8d85\u8fc7timeout\u65f6\u957f\u3002\u5982\u679c\u524d\u4e00\u4e2a\u8f93\u5165\u4e8b\u4ef6\u6ca1\u6709\u8d85\u65f6\uff0c\u5219\u4f1a\u91cd\u7f6eANR\u7684timeout\uff0c\u4ece\u800c\u4e0d\u4f1a\u7206\u70b8\u3002</p>"},{"location":"perf-opt/Android/anr/anr/#23-appnotresponding","title":"2.3 appNotResponding","text":"<p>\u65e0\u8bbaANR\u7684\u6765\u6e90\u662f\u54ea\u91cc\uff0c\u6700\u7ec8\u90fd\u4f1a\u8d70\u5230 ProcessRecord \u4e2d\u7684 appNotResponding\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5305\u62ec\u4e86ANR\u7684\u4e3b\u8981\u6d41\u7a0b\u3002</p> <pre><code>void appNotResponding(String activityShortComponentName, ApplicationInfo aInfo,\nString parentShortComponentName, WindowProcessController parentProcess,\nboolean aboveSystem, String annotation, boolean onlyDumpSelf) {\n//......\nfinal boolean isSilentAnr;\nsynchronized (mService) {\n// PowerManager.reboot() can block for a long time, so ignore ANRs while shutting down.\nif (mService.mAtmInternal.isShuttingDown()) {\nSlog.i(TAG, \"During shutdown skipping ANR: \" + this + \" \" + annotation);\nreturn;\n} else if (isNotResponding()) {\nSlog.i(TAG, \"Skipping duplicate ANR: \" + this + \" \" + annotation);\nreturn;\n} else if (isCrashing()) {\nSlog.i(TAG, \"Crashing app skipping ANR: \" + this + \" \" + annotation);\nreturn;\n} else if (killedByAm) {\nSlog.i(TAG, \"App already killed by AM skipping ANR: \" + this + \" \" + annotation);\nreturn;\n} else if (killed) {\nSlog.i(TAG, \"Skipping died app ANR: \" + this + \" \" + annotation);\nreturn;\n}\n// In case we come through here for the same app before completing\n// this one, mark as anring now so we will bail out.\nsetNotResponding(true);\n// Log the ANR to the event log.\nEventLog.writeEvent(EventLogTags.AM_ANR, userId, pid, processName, info.flags,\nannotation);\n// Dump thread traces as quickly as we can, starting with \"interesting\" processes.\nfirstPids.add(pid);\n// Don't dump other PIDs if it's a background ANR or is requested to only dump self.\nisSilentAnr = isSilentAnr();\n//......\n}\n</code></pre> <p>\u5148\u662f\u4e00\u957f\u4e32if else\uff0c\u7ed9\u51fa\u4e86\u51e0\u79cd\u6bd4\u8f83\u6781\u7aef\u7684\u60c5\u51b5\uff0c\u4f1a\u76f4\u63a5return\uff0c\u800c\u4e0d\u4f1a\u4ea7\u751f\u4e00\u4e2aANR\uff0c\u8fd9\u4e9b\u60c5\u51b5\u5305\u62ec\uff1a\u8fdb\u7a0b\u6b63\u5728\u5904\u4e8e\u6b63\u5728\u5173\u95ed\u7684\u72b6\u6001\uff0c\u6b63\u5728crash\u7684\u72b6\u6001\uff0c\u88abkill\u7684\u72b6\u6001\uff0c\u6216\u8005\u76f8\u540c\u8fdb\u7a0b\u5df2\u7ecf\u5904\u5728ANR\u7684\u6d41\u7a0b\u4e2d\u3002</p> <p>\u53e6\u5916\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u903b\u8f91\u5c31\u662f\u5224\u65ad\u5f53\u524dANR\u662f\u5426\u662f\u4e00\u4e2aSilentAnr\uff0c\u6240\u8c13\u201c\u6c89\u9ed8\u7684ANR\u201d\uff0c\u5176\u5b9e\u5c31\u662f\u540e\u53f0ANR\uff0c\u540e\u53f0ANR\u8ddf\u524d\u53f0ANR\u4f1a\u6709\u4e0d\u540c\u7684\u8868\u73b0\uff1a\u524d\u53f0ANR\u4f1a\u5f39\u65e0\u54cd\u5e94\u7684Dialog\uff0c\u540e\u53f0ANR\u4f1a\u76f4\u63a5\u6740\u6b7b\u8fdb\u7a0b\u3002\u51b3\u5b9a\u662f\u524d\u53f0\u6216\u8005\u540e\u53f0ANR\u53d6\u51b3\u4e8e\u8be5\u5e94\u7528\u53d1\u751fANR\u65f6 \u5bf9\u7528\u6237\u662f\u5426\u53ef\u611f\u77e5\uff0c\u6bd4\u5982\u62e5\u6709\u5f53\u524d\u524d\u53f0\u53ef\u89c1\u7684activity\u7684\u8fdb\u7a0b\uff0c\u6216\u8005\u62e5\u6709\u524d\u53f0\u901a\u77e5\u7684fg-service\u7684\u8fdb\u7a0b\uff0c\u8fd9\u4e9b\u662f\u7528\u6237\u53ef\u611f\u77e5\u7684\u573a\u666f\uff0c\u53d1\u751fANR\u5bf9\u7528\u6237\u4f53\u9a8c\u5f71\u54cd\u6bd4\u8f83\u5927\uff0c\u6545\u9700\u8981\u5f39\u6846\u8ba9\u7528\u6237\u51b3\u5b9a\u662f\u5426\u9000\u51fa\u8fd8\u662f\u7b49\u5f85\uff0c\u5982\u679c\u76f4\u63a5\u6740\u6389\u8fd9\u7c7b\u5e94\u7528\u4f1a\u7ed9\u7528\u6237\u9020\u6210\u83ab\u540d\u5176\u5999\u7684\u95ea\u9000\u3002\u540e\u53f0ANR\u76f8\u6bd4\u524d\u53f0ANR\uff0c\u53ea\u6293\u53d6\u53d1\u751f\u65e0\u54cd\u5e94\u8fdb\u7a0b\u7684trace\uff0c\u4e5f\u4e0d\u4f1a\u6536\u96c6CPU\u4fe1\u606f\uff0c\u5e76\u4e14\u4f1a\u5728\u540e\u53f0\u76f4\u63a5\u6740\u6389\u8be5\u65e0\u54cd\u5e94\u7684\u8fdb\u7a0b\uff0c\u4e0d\u4f1a\u5f39\u6846\u63d0\u793a\u7528\u6237\u3002\u53e6\u5916\uff0c\u5982\u679c\u5728\u5f00\u53d1\u8005\u9009\u9879\u4e2d\u52fe\u9009\u4e86\u201c\u663e\u793a\u540e\u53f0ANR\u201d\uff0c\u90a3\u4e48\u5168\u90e8ANR\u90fd\u4f1a\u88ab\u8ba4\u4e3a\u662f\u524d\u53f0ANR\u3002</p> <p>\u6211\u4eec\u7ee7\u7eed\u5206\u6790\u8fd9\u4e2a\u65b9\u6cd5\uff1a</p> <pre><code>if (!isSilentAnr &amp;&amp; !onlyDumpSelf) {\nint parentPid = pid;\nif (parentProcess != null &amp;&amp; parentProcess.getPid() &gt; 0) {\nparentPid = parentProcess.getPid();\n}\nif (parentPid != pid) firstPids.add(parentPid);\nif (MY_PID != pid &amp;&amp; MY_PID != parentPid) firstPids.add(MY_PID);\nfor (int i = getLruProcessList().size() - 1; i &gt;= 0; i--) {\nProcessRecord r = getLruProcessList().get(i);\nif (r != null &amp;&amp; r.thread != null) {\nint myPid = r.pid;\nif (myPid &gt; 0 &amp;&amp; myPid != pid &amp;&amp; myPid != parentPid &amp;&amp; myPid != MY_PID) {\nif (r.isPersistent()) {\nfirstPids.add(myPid);\nif (DEBUG_ANR) Slog.i(TAG, \"Adding persistent proc: \" + r);\n} else if (r.treatLikeActivity) {\nfirstPids.add(myPid);\nif (DEBUG_ANR) Slog.i(TAG, \"Adding likely IME: \" + r);\n} else {\nlastPids.put(myPid, Boolean.TRUE);\nif (DEBUG_ANR) Slog.i(TAG, \"Adding ANR proc: \" + r);\n}\n}\n}\n}\n}\n//......\n// don't dump native PIDs for background ANRs unless it is the process of interest\nString[] nativeProcs = null;\nif (isSilentAnr || onlyDumpSelf) {\nfor (int i = 0; i &lt; NATIVE_STACKS_OF_INTEREST.length; i++) {\nif (NATIVE_STACKS_OF_INTEREST[i].equals(processName)) {\nnativeProcs = new String[] { processName };\nbreak;\n}\n}\n} else {\nnativeProcs = NATIVE_STACKS_OF_INTEREST;\n}\nint[] pids = nativeProcs == null ? null : Process.getPidsForCommands(nativeProcs);\nArrayList&lt;Integer&gt; nativePids = null;\nif (pids != null) {\nnativePids = new ArrayList&lt;&gt;(pids.length);\nfor (int i : pids) {\nnativePids.add(i);\n}\n}\n</code></pre> <p>\u53d1\u751fANR\u540e\uff0c\u4e3a\u4e86\u80fd\u8ba9\u5f00\u53d1\u8005\u77e5\u9053ANR\u7684\u539f\u56e0\uff0c\u65b9\u4fbf\u5b9a\u4f4d\u95ee\u9898\uff0c\u4f1adump\u5f88\u591a\u4fe1\u606f\u5230ANR Trace\u6587\u4ef6\u91cc\uff0c\u4e0a\u9762\u7684\u903b\u8f91\u5c31\u662f\u9009\u62e9\u9700\u8981dump\u7684\u8fdb\u7a0b\u3002ANR Trace\u6587\u4ef6\u662f\u5305\u542b \u8bb8\u591a\u8fdb\u7a0b \u7684Trace\u4fe1\u606f\u7684\uff0c\u56e0\u4e3a\u4ea7\u751fANR\u7684\u539f\u56e0\u6709\u53ef\u80fd\u662f\u5176\u4ed6\u7684\u8fdb\u7a0b\u62a2\u5360\u4e86\u592a\u591a\u8d44\u6e90\uff0c\u6216\u8005IPC\u5230\u5176\u4ed6\u8fdb\u7a0b\uff08\u5c24\u5176\u662f\u7cfb\u7edf\u8fdb\u7a0b\uff09\u7684\u65f6\u5019\u5361\u4f4f\u5bfc\u81f4\u7684\u3002</p> <p>\u9009\u62e9\u9700\u8981dump\u7684\u8fdb\u7a0b\u662f\u4e00\u6bb5\u633a\u6709\u610f\u601d\u903b\u8f91\uff0c\u6211\u4eec\u7a0d\u5fae\u5206\u6790\u4e0b\uff1a\u9700\u8981\u88abdump\u7684\u8fdb\u7a0b\u88ab\u5206\u4e3a\u4e86firstPids\u3001nativePids\u4ee5\u53caextraPids\u4e09\u7c7b\uff1a</p> <ul> <li>firstPIds\uff1afirstPids\u662f\u9700\u8981\u9996\u5148dump\u7684\u91cd\u8981\u8fdb\u7a0b\uff0c\u53d1\u751fANR\u7684\u8fdb\u7a0b\u65e0\u8bba\u5982\u4f55\u662f\u4e00\u5b9a\u8981\u88abdump\u7684\uff0c\u4e5f\u662f\u9996\u5148\u88abdump\u7684\uff0c\u6240\u4ee5\u7b2c\u4e00\u4e2a\u88ab\u52a0\u5230firstPids\u4e2d\u3002\u5982\u679c\u662fSilentAnr\uff08\u5373\u540e\u53f0ANR\uff09\uff0c\u4e0d\u7528\u518d\u52a0\u5165\u4efb\u4f55\u5176\u4ed6\u7684\u8fdb\u7a0b\u3002\u5982\u679c\u4e0d\u662f\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u6dfb\u52a0\u5176\u4ed6\u7684\u8fdb\u7a0b\uff1a\u5982\u679c\u53d1\u751fANR\u7684\u8fdb\u7a0b\u4e0d\u662fsystem_server\u8fdb\u7a0b\u7684\u8bdd\uff0c\u9700\u8981\u6dfb\u52a0system_server\u8fdb\u7a0b\uff1b\u63a5\u4e0b\u6765\u8f6e\u8be2AMS\u7ef4\u62a4\u7684\u4e00\u4e2aLRU\u7684\u8fdb\u7a0bList\uff0c\u5982\u679c\u6700\u8fd1\u8bbf\u95ee\u7684\u8fdb\u7a0b\u5305\u542b\u4e86persistent\u7684\u8fdb\u7a0b\uff0c\u6216\u8005\u5e26\u6709 BIND_TREAT_LIKE_ACTVITY \u6807\u7b7e\u7684\u8fdb\u7a0b\uff0c\u90fd\u6dfb\u52a0\u5230firstPids\u4e2d\u3002</li> <li>extraPids\uff1aLRU\u8fdb\u7a0bList\u4e2d\u7684\u5176\u4ed6\u8fdb\u7a0b\uff0c\u90fd\u4f1a\u9996\u5148\u6dfb\u52a0\u5230lastPids\u4e2d\uff0c\u7136\u540elastPids\u4f1a\u8fdb\u4e00\u6b65\u88ab\u9009\u51fa\u6700\u8fd1CPU\u4f7f\u7528\u7387\u9ad8\u7684\u8fdb\u7a0b\uff0c\u8fdb\u4e00\u6b65\u7ec4\u6210extraPids\uff1b</li> <li>nativePids\uff1anativePids\u6700\u4e3a\u7b80\u5355\uff0c\u662f\u4e00\u4e9b\u56fa\u5b9a\u7684native\u7684\u7cfb\u7edf\u8fdb\u7a0b\uff0c\u5b9a\u4e49\u5728WatchDog.java\u4e2d\u3002</li> </ul> <p>\u62ff\u5230\u9700\u8981dump\u7684\u6240\u6709\u8fdb\u7a0b\u7684pid\u540e\uff0cAMS\u5f00\u59cb\u6309\u7167firstPids\u3001nativePids\u3001extraPids\u7684\u987a\u5e8fdump\u8fd9\u4e9b\u8fdb\u7a0b\u7684\u5806\u6808\uff1a</p> <p><pre><code>File tracesFile = ActivityManagerService.dumpStackTraces(firstPids,\nisSilentAnr ? null : processCpuTracker, isSilentAnr ? null : lastPids,\nnativePids, tracesFileException, offsets);\n</code></pre> \u8fd9\u91cc\u4e5f\u662f\u6211\u4eec\u9700\u8981\u91cd\u70b9\u5206\u6790\u7684\u5730\u65b9\uff0c\u6211\u4eec\u7ee7\u7eed\u770b\u8fd9\u91cc\u505a\u4e86\u4ec0\u4e48\uff0c\u8ddf\u5230AMS\u91cc\u9762\uff0c</p> <pre><code>//frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java\uff1a\npublic static Pair&lt;Long, Long&gt; dumpStackTraces(String tracesFile, ArrayList&lt;Integer&gt; firstPids,\nArrayList&lt;Integer&gt; nativePids, ArrayList&lt;Integer&gt; extraPids) {\n//\u8fd9\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u53d8\u91cf\uff0c\u89c4\u5b9a\u4e86\u6211\u4eecdump\u6240\u6709\u8fdb\u7a0b\u7684\u6700\u957f\u65f6\u95f4\uff0c\u56e0\u4e3adump\u8fdb\u7a0b\u6240\u6709\u7ebf\u7a0b\u7684\u5806\u6808\uff0c\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u91cd\u64cd\u4f5c\uff0c\u4f55\u51b5\u662f\u8981dump\u8bb8\u591a\u8fdb\u7a0b\uff0c\n//\u6240\u4ee5\u89c4\u5b9a\u4e86\u53d1\u751fANR\u4e4b\u540e\uff0cdump\u5168\u90e8\u8fdb\u7a0b\u7684\u603b\u65f6\u95f4\u4e0d\u80fd\u8d85\u8fc720\u79d2\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\uff0c\u9a6c\u4e0a\u8fd4\u56de\uff0c\u786e\u4fddANR\u5f39\u7a97\u53ef\u4ee5\u53ca\u65f6\u7684\u5f39\u51fa\uff08\u6216\u8005\u88abkill\u6389\uff09\nlong remainingTime = 20 * 1000;\n//......\nif (firstPids != null) {\nint num = firstPids.size();\nfor (int i = 0; i &lt; num; i++) {\n//......\nfinal long timeTaken = dumpJavaTracesTombstoned(pid, tracesFile,\nremainingTime);\nremainingTime -= timeTaken;\nif (remainingTime &lt;= 0) {\nSlog.e(TAG, \"Aborting stack trace dump (current firstPid=\" + pid\n+ \"); deadline exceeded.\");\nreturn firstPidStart &gt;= 0 ? new Pair&lt;&gt;(firstPidStart, firstPidEnd) : null;\n}\n//......\n}\n}\n//......\n}\nprivate static long dumpJavaTracesTombstoned(int pid, String fileName, long timeoutMs) {\nfinal long timeStart = SystemClock.elapsedRealtime();\nboolean javaSuccess = Debug.dumpJavaBacktraceToFileTimeout(pid, fileName,\n(int) (timeoutMs / 1000));\n//......\nreturn SystemClock.elapsedRealtime() - timeStart;\n}\n</code></pre> <p>\u518d\u4e00\u8def\u8ffd\u5230native\u5c42\u8d1f\u8d23dump\u5806\u6808\u7684 system/core/debuggerd/client/debuggerd_client.cpp\uff1a</p> <pre><code>bool debuggerd_trigger_dump(pid_t tid, DebuggerdDumpType dump_type, unsigned int timeout_ms, unique_fd output_fd) {\npid_t pid = tid;\n//......\n// Send the signal.\nconst int signal = (dump_type == kDebuggerdJavaBacktrace) ? SIGQUIT : BIONIC_SIGNAL_DEBUGGER;\nsigval val = {.sival_int = (dump_type == kDebuggerdNativeBacktrace) ? 1 : 0};\nif (sigqueue(pid, signal, val) != 0) {\nlog_error(output_fd, errno, \"failed to send signal to pid %d\", pid);\nreturn false;\n}\n//......\nLOG(INFO) &lt;&lt; TAG \"done dumping process \" &lt;&lt; pid;\nreturn true;\n}\n</code></pre> <p>\u8fd9\u91cc\u4f1a\u901a\u8fc7 sigqueue \u5411\u9700\u8981dump\u5806\u6808\u7684\u8fdb\u7a0b\u53d1\u9001SIGQUIT\u4fe1\u53f7\uff0c\u4e5f\u5c31\u662fsignal 3\u4fe1\u53f7\uff0c\u800c\u53d1\u751fANR\u7684\u8fdb\u7a0b\u662f\u4e00\u5b9a\u4f1a\u88abdump\u7684\uff0c\u4e5f\u662f\u7b2c\u4e00\u4e2a\u88abdump\u7684\u3002</p> <p>\u6bcf\u4e00\u4e2a\u5e94\u7528\u8fdb\u7a0b\u90fd\u4f1a\u6709\u4e00\u4e2aSignalCatcher\u7ebf\u7a0b\uff0c\u4e13\u95e8\u5904\u7406SIGQUIT</p> <pre><code>//art/runtime/signal_catcher.cc\nvoid* SignalCatcher::Run(void* arg) {\n//......\n// Set up mask with signals we want to handle.\nSignalSet signals;\nsignals.Add(SIGQUIT);\nsignals.Add(SIGUSR1);\nwhile (true) {\nint signal_number = signal_catcher-&gt;WaitForSignal(self, signals);\nif (signal_catcher-&gt;ShouldHalt()) {\nruntime-&gt;DetachCurrentThread();\nreturn nullptr;\n}\nswitch (signal_number) {\ncase SIGQUIT:\nsignal_catcher-&gt;HandleSigQuit();\nbreak;\ncase SIGUSR1:\nsignal_catcher-&gt;HandleSigUsr1();\nbreak;\ndefault:\nLOG(ERROR) &lt;&lt; \"Unexpected signal %d\" &lt;&lt; signal_number;\nbreak;\n}\n}\n}\n</code></pre> <p>WaitForSignal \u65b9\u6cd5\u8c03\u7528\u4e86 sigwait \u65b9\u6cd5\uff0c\u8fd9\u662f\u4e00\u4e2a\u963b\u585e\u65b9\u6cd5\u3002\u8fd9\u91cc\u7684\u6b7b\u5faa\u73af\uff0c\u5c31\u4f1a\u4e00\u76f4\u4e0d\u65ad\u7684\u7b49\u5f85\u76d1\u542cSIGQUIT\u548cSIGUSR1\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u7684\u5230\u6765\u3002</p> <p>SignalCatcher \u7ebf\u7a0b\u63a5\u6536\u5230\u4fe1\u53f7\u540e\uff0c\u9996\u5148 Dump \u5f53\u524d\u865a\u62df\u673a\u6709\u5173\u4fe1\u606f\uff0c\u5982\u5185\u5b58\u72b6\u6001\uff0c\u5bf9\u8c61\uff0c\u52a0\u8f7d Class\uff0cGC \u7b49\u7b49\uff0c\u63a5\u4e0b\u6765\u8bbe\u7f6e\u5404\u7ebf\u7a0b\u6807\u8bb0\u4f4d(check_point)\uff0c\u4ee5\u8bf7\u6c42\u7ebf\u7a0b\u6302\u8d77(suspend)\u3002\u5176\u5b83\u7ebf\u7a0b\u8fd0\u884c\u8fc7\u7a0b\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\u65f6\uff0c\u4f1a\u68c0\u67e5\u8be5\u6807\u8bb0\uff0c\u5982\u679c\u53d1\u73b0\u6709\u6302\u8d77\u8bf7\u6c42\uff0c\u4f1a\u4e3b\u52a8\u5c06\u81ea\u5df1\u6302\u8d77\u3002\u7b49\u5230\u6240\u6709\u7ebf\u7a0b\u6302\u8d77\u540e\uff0cSignalCatcher \u7ebf\u7a0b\u5f00\u59cb\u904d\u5386 Dump \u5404\u7ebf\u7a0b\u7684\u5806\u6808\u548c\u7ebf\u7a0b\u6570\u636e\uff0c\u7ed3\u675f\u4e4b\u540e\u518d\u5524\u9192\u7ebf\u7a0b\u3002\u671f\u95f4\u5982\u679c\u67d0\u4e9b\u7ebf\u7a0b\u4e00\u76f4\u65e0\u6cd5\u6302\u8d77\u76f4\u5230\u8d85\u65f6\uff0c\u90a3\u4e48\u672c\u6b21 Dump \u6d41\u7a0b\u5219\u5931\u8d25\uff0c\u5e76\u4e3b\u52a8\u629b\u51fa\u8d85\u65f6\u5f02\u5e38\u3002</p> <p></p> <p>\u6240\u4ee5ANR\u6574\u4e2a\u8fc7\u7a0b\uff1a\u5f53\u5e94\u7528\u53d1\u751fANR\u4e4b\u540e\uff0c\u7cfb\u7edf\u4f1a\u6536\u96c6\u8bb8\u591a\u8fdb\u7a0b\uff0c\u6765dump\u5806\u6808\uff0c\u4ece\u800c\u751f\u6210ANR Trace\u6587\u4ef6\uff0c\u6536\u96c6\u7684\u7b2c\u4e00\u4e2a\uff0c\u4e5f\u662f\u4e00\u5b9a\u4f1a\u88ab\u6536\u96c6\u5230\u7684\u8fdb\u7a0b\uff0c\u5c31\u662f\u53d1\u751fANR\u7684\u8fdb\u7a0b\uff0c\u63a5\u7740\u7cfb\u7edf\u5f00\u59cb\u5411\u8fd9\u4e9b\u5e94\u7528\u8fdb\u7a0b\u53d1\u9001SIGQUIT\u4fe1\u53f7\uff0c\u5e94\u7528\u8fdb\u7a0b\u6536\u5230SIGQUIT\u540e\u5f00\u59cbdump\u5806\u6808\u3002</p> <p></p> <p>\u4e8b\u5b9e\u4e0a\u8fdb\u7a0b\u53d1\u751fANR\u7684\u6574\u4e2a\u6d41\u7a0b\uff0c\u4e5f\u53ea\u6709dump\u5806\u6808\u7684\u884c\u4e3a\u4f1a\u5728\u53d1\u751fANR\u7684\u8fdb\u7a0b\u4e2d\u6267\u884c\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4ece\u6536\u5230SIGQUIT\u5f00\u59cb\uff08\u57081\uff09\uff0c\u5230\u4f7f\u7528socket\u5199Trace\uff08\u57082\uff09\u7ed3\u675f\uff0c\u7136\u540e\u518d\u7ee7\u7eed\u56de\u5230server\u8fdb\u7a0b\u5b8c\u6210\u5269\u4f59\u7684ANR\u6d41\u7a0b\u3002</p>"},{"location":"perf-opt/Android/anr/anr/#_1","title":"\u53c2\u8003","text":"<p>\u5f7b\u5e95\u7406\u89e3\u5b89\u5353\u5e94\u7528\u65e0\u54cd\u5e94\u673a\u5236</p> <p>\u5fae\u4fe1Android\u5ba2\u6237\u7aef\u7684ANR\u76d1\u63a7\u65b9\u6848</p> <p>\u4eca\u65e5\u5934\u6761 ANR \u4f18\u5316\u5b9e\u8df5\u7cfb\u5217 - \u8bbe\u8ba1\u539f\u7406\u53ca\u5f71\u54cd\u56e0\u7d20</p>"},{"location":"perf-opt/Android/anr/anr_monitor/","title":"ANR \u76d1\u63a7","text":"<p>Android M(6.0) \u7248\u672c\u4e4b\u540e\uff0c\u5e94\u7528\u4fa7\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u76d1\u542c <code>data/anr/trace</code> \u6587\u4ef6\uff0c\u76d1\u63a7\u662f\u5426\u53d1\u751f ANR\uff0c\u90a3\u4e48\u53c8\u6709\u4ec0\u4e48\u5176\u5b83\u624b\u6bb5\u53bb\u5224\u5b9a ANR \u5462\uff1f\u76ee\u524d\u4e86\u89e3\u5230\u7684\u65b9\u6848(\u601d\u8def)\u4e3b\u8981\u6709\u4e0b\u9762 2 \u79cd\uff1a</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#1-watchdog","title":"1. \u4e3b\u7ebf\u7a0b watchdog \u673a\u5236","text":"<p>\u6838\u5fc3\u601d\u60f3\u662f\u5728\u5e94\u7528\u5c42\u5b9a\u671f\u5411\u4e3b\u7ebf\u7a0b\u8bbe\u7f6e\u63a2\u6d4b\u6d88\u606f\uff0c\u5e76\u5728\u5f02\u6b65\u8bbe\u7f6e\u8d85\u65f6\u76d1\u6d4b\uff0c\u5982\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u53d1\u9001\u7684\u63a2\u6d4b\u6d88\u606f\u72b6\u6001\u66f4\u65b0\uff0c\u5219\u5224\u5b9a\u53ef\u80fd\u53d1\u751f ANR\uff0c\u4e3a\u4ec0\u4e48\u662f\u53ef\u80fd\u53d1\u751f ANR\uff1f\u56e0\u4e3a\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u4ece\u7cfb\u7edf\u670d\u52a1\u83b7\u53d6\u76f8\u5173\u6570\u636e(\u53ef\u901a\u8fc7<code>ActivityManagerService.getProcessesInErrorState()</code>\u65b9\u6cd5\u83b7\u53d6\u8fdb\u7a0b\u7684ANR\u4fe1\u606f)\uff0c\u8fdb\u4e00\u6b65\u5224\u5b9a\u662f\u5426\u771f\u7684\u53d1\u751f ANR\u3002</p> <p>ANR-WatchDog\u5c31\u662f\u4f7f\u7528\u8be5\u8fd9\u4e2a\u65b9\u6848, \u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>private final Handler _uiHandler = new Handler(Looper.getMainLooper());\nprivate final int _timeoutInterval;\nprivate volatile long _tick = 0;\nprivate volatile boolean _reported = false;\nprivate final Runnable _ticker = new Runnable() {\n@Override public void run() {\n_tick = 0;\n_reported = false;\n}\n};\n@Override\npublic void run() {\nsetName(\"|ANR-WatchDog|\");\n//_timeoutInterval\u4e3a\u8bbe\u5b9a\u7684\u8d85\u65f6\u65f6\u957f\nlong interval = _timeoutInterval;\nwhile (!isInterrupted()) {\n//_tick\u4e3a\u6807\u5fd7\uff0c\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e86\u4e0b\u9762\u53d1\u9001\u7684_ticker\u8fd9\u4e2aRunnable, \u90a3\u4e48_tick\u5c31\u4f1a\u88ab\u7f6e\u4e3a0\nboolean needPost = _tick == 0;\n//\u5728\u5b50\u7ebf\u7a0b\u91cc\u9762\u9700\u8981\u628a\u6807\u5fd7\u6539\u4e3a\u975e0\uff0c\u5f85\u4f1a\u513f\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e86\u624d\u77e5\u9053\n_tick += interval;\nif (needPost) {\n//\u53d1\u4e2a\u6d88\u606f\u7ed9\u4e3b\u7ebf\u7a0b\n_uiHandler.post(_ticker);\n}\n//\u5b50\u7ebf\u7a0b\u7761\u4e00\u6bb5\u65f6\u95f4\uff0c\u8d77\u6765\u7684\u65f6\u5019\u8981\u662f\u6807\u5fd7\u4f4d_tick\u6ca1\u6709\u88ab\u6539\u62100\uff0c\u8bf4\u660e\u4e3b\u7ebf\u7a0b\u592a\u5fd9\u4e86\uff0c\u6216\u8005\u5361\u987f\u4e86\uff0c\u6ca1\u6765\u5f97\u53ca\u6267\u884c\u8be5\u6d88\u606f\ntry {\nThread.sleep(interval);\n} catch (InterruptedException e) {\n_interruptionListener.onInterrupted(e);\nreturn ;\n}\n// If the main thread has not handled _ticker, it is blocked. ANR.\nif (_tick != 0 &amp;&amp; !_reported) {\n//noinspection ConstantConditions\n//\u6392\u9664debug\u7684\u60c5\u51b5\nif (!_ignoreDebugger &amp;&amp; (Debug.isDebuggerConnected() || Debug.waitingForDebugger())) {\nLog.w(\"ANRWatchdog\", \"An ANR was detected but ignored because the debugger is connected (you can prevent this with setIgnoreDebugger(true))\");\n_reported = true;\ncontinue ;\n}\n//\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2aInterceptor\u544a\u8bc9watchDog\uff0c\u5f53\u524d\u4e0a\u4e0b\u6587\u73af\u5883\u662f\u5426\u53ef\u4ee5\u8fdb\u884c\u4e0a\u62a5\ninterval = _anrInterceptor.intercept(_tick);\nif (interval &gt; 0) {\ncontinue;\n}\n//\u4e0a\u62a5\u7ebf\u7a0b\u5806\u6808\nfinal ANRError error;\nif (_namePrefix != null) {\nerror = ANRError.New(_tick, _namePrefix, _logThreadsWithoutStackTrace);\n} else {\nerror = ANRError.NewMainOnly(_tick);\n}\n//\u56de\u8c03\n_anrListener.onAppNotResponding(error);\ninterval = _timeoutInterval;\n_reported = true;\n}\n}\n}\n</code></pre>"},{"location":"perf-opt/Android/anr/anr_monitor/#2-signalquit","title":"2. \u76d1\u542c SIGNALQUIT \u4fe1\u53f7","text":"<p>\u6211\u4eec\u5728ANR\u539f\u7406\u63d0\u5230\u4e86\u865a\u62df\u673a\u662f\u901a\u8fc7\u6ce8\u518c\u548c\u76d1\u542c SIGNALQUIT \u4fe1\u53f7\u7684\u65b9\u5f0f\u6267\u884c\u8bf7\u6c42\u7684\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u5e94\u7528\u5c42\u53c2\u8003\u6b64\u65b9\u5f0f\u6ce8\u518c\u76f8\u540c\u4fe1\u53f7\u53bb\u76d1\u542c\u3002\u53ea\u8981\u6211\u4eec\u80fd\u76d1\u63a7\u5230\u7cfb\u7edf\u53d1\u9001\u7684SIGQUIT\u4fe1\u53f7\uff0c\u4e5f\u5c31\u80fd\u591f\u76d1\u63a7\u5230\u53d1\u751f\u4e86ANR\u3002</p> <p>\u5f53\u63a5\u6536\u5230\u8be5\u4fe1\u53f7\u65f6\uff0c\u8fc7\u6ee4\u573a\u666f\uff0c\u786e\u5b9a\u662f\u53d1\u751f\u7528\u6237\u53ef\u611f\u77e5\u7684 ANR \u4e4b\u540e\uff0c\u4ece Java \u5c42\u83b7\u53d6\u5404\u7ebf\u7a0b\u5806\u6808\uff0c\u6216\u901a\u8fc7\u53cd\u5c04\u65b9\u5f0f\u83b7\u53d6\u5230\u865a\u62df\u673a\u5185\u90e8 Dump \u7ebf\u7a0b\u5806\u6808\u7684\u63a5\u53e3\uff0c\u5728\u5185\u5b58\u6620\u5c04\u7684\u51fd\u6570\u5730\u5740\uff0c\u5f3a\u5236\u8c03\u7528\u8be5\u63a5\u53e3\uff0c\u5e76\u5c06\u6570\u636e\u91cd\u5b9a\u5411\u8f93\u51fa\u5230\u672c\u5730\u3002</p> <p>\u8be5\u65b9\u6848\u4ece\u601d\u8def\u4e0a\u6765\u8bf4\u4f18\u4e8e\u7b2c\u4e00\u79cd\u65b9\u6848\uff0c\u5e76\u4e14\u9075\u5faa\u7cfb\u7edf\u4fe1\u606f\u83b7\u53d6\u65b9\u5f0f\uff0c\u83b7\u53d6\u7684\u7ebf\u7a0b\u4fe1\u606f\u53ca\u865a\u62df\u673a\u4fe1\u606f\u66f4\u52a0\u5168\u9762\uff0c\u4f46\u7f3a\u70b9\u662f\u5bf9\u6027\u80fd\u5f71\u54cd\u6bd4\u8f83\u5927\uff0c\u5bf9\u4e8e\u590d\u6742\u7684 App \u6765\u8bf4\uff0c\u7edf\u8ba1\u5176\u8017\u65f6\uff0c\u90e8\u5206\u573a\u666f\u4e00\u6b21 Dump \u8017\u65f6\u53ef\u80fd\u8981\u8d85\u8fc7 10S\u3002</p> <p>Linux\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e24\u79cd\u76d1\u542c\u4fe1\u53f7\u7684\u65b9\u6cd5\uff0c\u4e00\u79cd\u662fSignalCatcher\u7ebf\u7a0b\u4f7f\u7528\u7684 sigwait \u65b9\u6cd5\u8fdb\u884c\u540c\u6b65\u3001\u963b\u585e\u5730\u76d1\u542c\uff0c\u53e6\u4e00\u79cd\u662f\u4f7f\u7528 sigaction \u65b9\u6cd5\u6ce8\u518csignal handler\u8fdb\u884c\u5f02\u6b65\u76d1\u542c\uff0c\u6211\u4eec\u90fd\u6765\u8bd5\u8bd5\u3002</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#21-sigwait","title":"2.1 sigwait","text":"<pre><code>static void *mySigQuitCatcher(void* args) {\nwhile (true) {\nint sig;\nsigset_t sigSet;\nsigemptyset(&amp;sigSet);\nsigaddset(&amp;sigSet, SIGQUIT);\nsigwait(&amp;sigSet, &amp;sig);\nif (sig == SIGQUIT) {\n//Got SIGQUIT\n}\n}\n}\npthread_t pid;\npthread_create(&amp;pid, nullptr, mySigQuitCatcher, nullptr);\npthread_detach(pid);\n</code></pre> <p>\u8fd9\u4e2a\u65f6\u5019\u5c31\u6709\u4e86\u4e24\u4e2a\u4e0d\u540c\u7684\u7ebf\u7a0b sigwait \u540c\u4e00\u4e2aSIGQUIT\uff0c\u5177\u4f53\u4f1a\u8d70\u5230\u54ea\u4e2a\u5462\uff0c\u6211\u4eec\u5728 sigwait \u7684\u6587\u6863\u4e2d\u627e\u5230\u4e86\u8fd9\u6837\u7684\u63cf\u8ff0\uff08 sigwait \u65b9\u6cd5\u662f\u7531 sigwaitinfo \u65b9\u6cd5\u5b9e\u73b0\u7684\uff09</p> <p></p> <p>\u539f\u6765 \u5f53\u6709\u4e24\u4e2a\u7ebf\u7a0b\u901a\u8fc7 sigwait \u65b9\u6cd5\u76d1\u542c\u540c\u4e00\u4e2a\u4fe1\u53f7\u65f6\uff0c\u5177\u4f53\u662f\u54ea\u4e00\u4e2a\u7ebf\u7a0b\u6536\u5230\u4fe1\u53f7\u65f6\u4e0d\u80fd\u786e\u5b9a\u7684\u3002\u4e0d\u786e\u5b9a\u53ef\u4e0d\u884c\uff0c\u5f53\u7136\u4e0d\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#22-signal-handler","title":"2.2  Signal Handler","text":"<p>\u90a3\u6211\u4eec\u518d\u8bd5\u4e0b\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u5426\u53ef\u884c\uff0c\u6211\u4eec\u901a\u8fc7\u53ef\u4ee5sigaction\u65b9\u6cd5\uff0c\u5efa\u7acb\u4e00\u4e2aSignal Handler\uff1a</p> <pre><code>void signalHandler(int sig, siginfo_t* info, void* uc) {\nif (sig == SIGQUIT) {\n//Got An ANR\n}\n}\nstruct sigaction sa;\nsa.sa_sigaction = signalHandler;\nsa.sa_flags = SA_ONSTACK | SA_SIGINFO | SA_RESTART;\nsigaction(SIGQUIT, &amp;sa, nullptr);\n</code></pre> <p>\u5efa\u7acb\u4e86Signal Handler\u4e4b\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u5728\u540c\u65f6\u6709 sigwait \u548csignal handler\u7684\u60c5\u51b5\u4e0b\uff0c\u4fe1\u53f7\u6ca1\u6709\u8d70\u5230\u6211\u4eec\u7684signal handler\u800c\u662f\u4f9d\u7136\u88ab\u7cfb\u7edf\u7684Signal Catcher\u7ebf\u7a0b\u6355\u83b7\u5230\u4e86\uff0c\u8fd9\u662f\u4ec0\u4e48\u539f\u56e0\u5462\uff1f</p> <p>\u539f\u6765\u662fAndroid\u9ed8\u8ba4\u628aSIGQUIT\u8bbe\u7f6e\u6210\u4e86BLOCKED\uff0c\u6240\u4ee5\u53ea\u4f1a\u54cd\u5e94 sigwait \u800c\u4e0d\u4f1a\u8fdb\u5165\u5230\u6211\u4eec\u8bbe\u7f6e\u7684handler\u65b9\u6cd5\u4e2d\u3002\u6211\u4eec\u901a\u8fc7 pthread_sigmask \u6216\u8005 sigprocmask \u628aSIGQUIT\u8bbe\u7f6e\u4e3aUNBLOCK\uff0c\u90a3\u4e48\u518d\u6b21\u6536\u5230SIGQUIT\u65f6\uff0c\u5c31\u4e00\u5b9a\u4f1a\u8fdb\u5165\u5230\u6211\u4eec\u7684handler\u65b9\u6cd5\u4e2d\u3002\u9700\u8981\u8fd9\u6837\u8bbe\u7f6e\uff1a</p> <pre><code>sigset_t sigSet;\nsigemptyset(&amp;sigSet);\nsigaddset(&amp;sigSet, SIGQUIT);\npthread_sigmask(SIG_UNBLOCK, &amp;sigSet, nullptr);\n</code></pre> <p>\u6700\u540e\u9700\u8981\u6ce8\u610f\uff0c\u6211\u4eec\u901a\u8fc7Signal Handler\u62a2\u5230\u4e86SIGQUIT\u540e\uff0c\u539f\u672c\u7684Signal Catcher\u7ebf\u7a0b\u4e2d\u7684 sigwait \u5c31\u4e0d\u518d\u80fd\u6536\u5230SIGQUIT\u4e86\uff0c\u539f\u672c\u7684dump\u5806\u6808\u7684\u903b\u8f91\u5c31\u65e0\u6cd5\u5b8c\u6210\u4e86\uff0c\u6211\u4eec\u4e3a\u4e86ANR\u7684\u6574\u4e2a\u903b\u8f91\u548c\u6d41\u7a0b\u8ddf\u539f\u6765\u5b8c\u5168\u4e00\u81f4\uff0c\u9700\u8981\u5728Signal Handler\u91cc\u9762\u91cd\u65b0\u5411Signal Catcher\u7ebf\u7a0b\u53d1\u9001\u4e00\u4e2aSIGQUIT\uff1a</p> <pre><code>int tid = getSignalCatcherThreadId(); //\u904d\u5386/proc/[pid]\u76ee\u5f55\uff0c\u627e\u5230SignalCatcher\u7ebf\u7a0b\u7684tid\ntgkill(getpid(), tid, SIGQUIT);\n</code></pre> <p>\uff08\u5982\u679c\u7f3a\u5c11\u4e86\u91cd\u65b0\u5411SignalCatcher\u53d1\u9001SIGQUIT\u7684\u6b65\u9aa4\uff0cAMS\u5c31\u4e00\u76f4\u7b49\u4e0d\u5230ANR\u8fdb\u7a0b\u5199\u5806\u6808\uff0c\u76f4\u523020\u79d2\u8d85\u65f6\u540e\uff0c\u624d\u4f1a\u88ab\u8feb\u4e2d\u65ad\uff0c\u800c\u7ee7\u7eed\u4e4b\u540e\u7684\u6d41\u7a0b\u3002\u76f4\u63a5\u7684\u8868\u73b0\u5c31\u662fANR\u5f39\u7a97\u975e\u5e38\u6162\uff0820\u79d2\u8d85\u65f6\u65f6\u95f4\uff09\uff0c\u5e76\u4e14/data/anr\u76ee\u5f55\u4e0b\u65e0\u6cd5\u6b63\u5e38\u751f\u6210\u5b8c\u6574\u7684 ANR Trace\u6587\u4ef6\u3002\uff09</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#3-anr","title":"3. \u5b8c\u5584\u7684ANR\u76d1\u63a7\u65b9\u6848","text":"<p>\u76d1\u63a7\u5230SIGQUIT\u4fe1\u53f7\u5e76\u4e0d\u7b49\u4e8e\u5c31\u76d1\u63a7\u5230\u4e86ANR\u3002</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#31","title":"3.1 \u8bef\u62a5","text":"<p>\u5145\u5206\u975e\u5fc5\u8981\u6761\u4ef61\uff1a\u53d1\u751fANR\u7684\u8fdb\u7a0b\u4e00\u5b9a\u4f1a\u6536\u5230SIGQUIT\u4fe1\u53f7\uff1b\u4f46\u662f\u6536\u5230SIGQUIT\u4fe1\u53f7\u7684\u8fdb\u7a0b\u5e76\u4e0d\u4e00\u5b9a\u53d1\u751f\u4e86ANR\u3002</p> <p>\u8003\u8651\u4e0b\u9762\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5176\u4ed6\u8fdb\u7a0b\u7684ANR\uff1a\u4e0a\u9762\u63d0\u5230\u8fc7\uff0c\u53d1\u751fANR\u4e4b\u540e\uff0c\u53d1\u751fANR\u7684\u8fdb\u7a0b\u5e76\u4e0d\u662f\u552f\u4e00\u9700\u8981dump\u5806\u6808\u7684\u8fdb\u7a0b\uff0c\u7cfb\u7edf\u4f1a\u6536\u96c6\u8bb8\u591a\u5176\u4ed6\u7684\u8fdb\u7a0b\u8fdb\u884cdump\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u4e00\u4e2a\u5e94\u7528\u53d1\u751fANR\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u7684\u5e94\u7528\u4e5f\u6709\u53ef\u80fd\u6536\u5230SIGQUIT\u4fe1\u53f7\u3002\u8fdb\u4e00\u6b65\uff0c\u6211\u4eec\u76d1\u63a7\u5230SIGQUIT\u65f6\uff0c\u53ef\u80fd\u662f\u76d1\u542c\u5230\u4e86\u5176\u4ed6\u8fdb\u7a0b\u4ea7\u751f\u7684ANR\uff0c\u4ece\u800c\u4ea7\u751f\u8bef\u62a5\u3002</li> <li>\u975eANR\u53d1\u9001SIGQUIT\uff1a\u53d1\u9001SIGQUIT\u4fe1\u53f7\u5176\u5b9e\u662f\u5f88\u5bb9\u6613\u7684\u4e00\u4ef6\u4e8b\u60c5\uff0c\u5f00\u53d1\u8005\u548c\u5382\u5546\u90fd\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u53d1\u9001\u4e00\u4e2aSIGQUIT\uff08java\u5c42\u8c03\u7528 android.os.Process.sendSignal \u65b9\u6cd5\uff1bNative\u5c42\u8c03\u7528 kill\u6216\u8005tgkill \u65b9\u6cd5\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u80fd\u4f1a\u6536\u5230\u975eANR\u6d41\u7a0b\u53d1\u9001\u7684SIGQUIT\u4fe1\u53f7\uff0c\u4ece\u800c\u4ea7\u751f\u8bef\u62a5\u3002</li> </ul> <p>\u600e\u4e48\u89e3\u51b3\u8fd9\u4e9b\u8bef\u62a5\u7684\u95ee\u9898\u5462\uff0c\u6211\u91cd\u65b0\u56de\u5230ANR\u6d41\u7a0b\u5f00\u59cb\u7684\u5730\u65b9:</p> <pre><code>void appNotResponding(String activityShortComponentName, ApplicationInfo aInfo,\nString parentShortComponentName, WindowProcessController parentProcess,\nboolean aboveSystem, String annotation, boolean onlyDumpSelf) {\n//......\nsynchronized (mService) {\nif (isSilentAnr() &amp;&amp; !isDebugging()) {\nkill(\"bg anr\", ApplicationExitInfo.REASON_ANR, true);\nreturn;\n}\n// Set the app's notResponding state, and look up the errorReportReceiver\nmakeAppNotRespondingLocked(activityShortComponentName,\nannotation != null ? \"ANR \" + annotation : \"ANR\", info.toString());\n// show ANR dialog ......\n}\n}\nprivate void makeAppNotRespondingLocked(String activity, String shortMsg, String longMsg) {\nsetNotResponding(true);\n// mAppErrors can be null if the AMS is constructed with injector only. This will only\n// happen in tests.\nif (mService.mAppErrors != null) {\nnotRespondingReport = mService.mAppErrors.generateProcessError(this,\nActivityManager.ProcessErrorStateInfo.NOT_RESPONDING,\nactivity, shortMsg, longMsg, null);\n}\nstartAppProblemLocked();\ngetWindowProcessController().stopFreezingActivities();\n}\n</code></pre> <p>\u5728ANR\u5f39\u7a97\u524d\uff0c\u4f1a\u6267\u884c\u5230 makeAppNotRespondingLocked \u65b9\u6cd5\u4e2d\uff0c\u5728\u8fd9\u91cc\u4f1a\u7ed9\u53d1\u751fANR\u8fdb\u7a0b\u6807\u8bb0\u4e00\u4e2a NOT_RESPONDING \u7684flag\u3002\u800c\u8fd9\u4e2aflag\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7ActivityManager\u6765\u83b7\u53d6\u3002</p> <pre><code>private static boolean checkErrorState() {\ntry {\nApplication application = sApplication == null ? Matrix.with().getApplication() : sApplication;\nActivityManager am = (ActivityManager) application.getSystemService(Context.ACTIVITY_SERVICE);\nList&lt;ActivityManager.ProcessErrorStateInfo&gt; procs = am.getProcessesInErrorState();\nif (procs == null) return false;\nfor (ActivityManager.ProcessErrorStateInfo proc : procs) {\nif (proc.pid != android.os.Process.myPid()) continue;\nif (proc.condition != ActivityManager.ProcessErrorStateInfo.NOT_RESPONDING) continue;\nreturn true;\n}\nreturn false;\n} catch (Throwable t){\nMatrixLog.e(TAG,\"[checkErrorState] error : %s\", t.getMessage());\n}\nreturn false;\n}\n</code></pre> <p>\u76d1\u63a7\u5230SIGQUIT\u540e\uff0c\u6211\u4eec\u572820\u79d2\u5185\uff0820\u79d2\u662fANR dump\u7684timeout\u65f6\u95f4\uff09\u4e0d\u65ad\u8f6e\u8be2\u81ea\u5df1\u662f\u5426\u6709NOT_RESPONDING\u5bf9flag\uff0c\u4e00\u65e6\u53d1\u73b0\u6709\u8fd9\u4e2aflag\uff0c\u90a3\u4e48\u9a6c\u4e0a\u5c31\u53ef\u4ee5\u8ba4\u5b9a\u53d1\u751f\u4e86\u4e00\u6b21ANR\u3002</p> <p>\uff08\u4f60\u53ef\u80fd\u4f1a\u60f3\uff0c\u6709\u8fd9\u4e48\u65b9\u4fbf\u7684\u65b9\u6cd5\uff0c\u76d1\u63a7SIGQUIT\u4fe1\u53f7\u4e0d\u662f\u591a\u4f59\u7684\u5417\uff1f\u76f4\u63a5\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u4e0d\u65ad\u8f6e\u8bad\u8fd9\u4e2aflag\u4e0d\u5c31\u5b8c\u4e8b\u4e86\uff1f\u662f\u7684\uff0c\u7406\u8bba\u4e0a\u786e\u5b9e\u80fd\u8fd9\u4e48\u505a\uff0c\u4f46\u662f\u8fd9\u4e48\u505a\u8fc7\u4e8e\u7684\u4f4e\u6548\u3001\u8017\u7535\u548c\u4e0d\u73af\u4fdd\u5916\uff0c\u66f4\u5173\u952e\u7684\u662f\uff0c\u4e0b\u9762\u6f0f\u62a5\u7684\u95ee\u9898\u4f9d\u7136\u65e0\u6cd5\u89e3\u51b3\uff09</p> <p>\u53e6\u5916\uff0cSignal Handler\u56de\u8c03\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570siginfo_t\uff0c\u4e5f\u5305\u542b\u4e86\u4e00\u4e9b\u6709\u7528\u7684\u4fe1\u606f\uff0c\u8be5\u7ed3\u6784\u4f53\u7684\u7b2c\u4e09\u4e2a\u5b57\u6bb5si_code\u8868\u793a\u8be5\u4fe1\u53f7\u88ab\u53d1\u9001\u7684\u65b9\u6cd5\uff0cSI_USER\u8868\u793a\u4fe1\u53f7\u662f\u901a\u8fc7kill\u53d1\u9001\u7684\uff0cSI_QUEUE\u8868\u793a\u4fe1\u53f7\u662f\u901a\u8fc7sigqueue\u53d1\u9001\u7684\u3002\u4f46\u5728Android\u7684ANR\u6d41\u7a0b\u4e2d\uff0c\u9ad8\u7248\u672c\u4f7f\u7528\u7684\u662fsigqueue\u53d1\u9001\u7684\u4fe1\u53f7\uff0c\u67d0\u4e9b\u4f4e\u7248\u672c\u4f7f\u7528\u7684\u662fkill\u53d1\u9001\u7684\u4fe1\u53f7\uff0c\u5e76\u4e0d\u7edf\u4e00\u3002</p> <p>\u800c\u7b2c\u4e94\u4e2a\u5b57\u6bb5\uff08\u6781\u5c11\u6570\u673a\u578b\u4e0a\u662f\u7b2c\u56db\u4e2a\u5b57\u6bb5\uff09si_pid\u8868\u793a\u7684\u662f\u53d1\u9001\u8be5\u4fe1\u53f7\u7684\u8fdb\u7a0b\u7684pid\uff0c\u8fd9\u91cc\u9002\u7528\u51e0\u4e4e\u6240\u6709Android\u7248\u672c\u548c\u673a\u578b\u7684\u4e00\u4e2a\u6761\u4ef6\u662f\uff1a\u5982\u679c\u53d1\u9001\u4fe1\u53f7\u7684\u8fdb\u7a0b\u662f\u81ea\u5df1\u7684\u8fdb\u7a0b\uff0c\u90a3\u4e48\u4e00\u5b9a\u4e0d\u662f\u4e00\u4e2aANR\u3002\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u6761\u4ef6\u6392\u9664\u81ea\u5df1\u53d1\u9001SIGQUIT\uff0c\u800c\u5bfc\u81f4\u8bef\u62a5\u7684\u60c5\u51b5\u3002</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#32","title":"3.2 \u6f0f\u62a5","text":"<p>\u5145\u5206\u975e\u5fc5\u8981\u6761\u4ef62\uff1a\u8fdb\u7a0b\u5904\u4e8eNOT_RESPONDING\u7684\u72b6\u6001\u53ef\u4ee5\u786e\u8ba4\u8be5\u8fdb\u7a0b\u53d1\u751f\u4e86ANR\u3002\u4f46\u662f\u53d1\u751fANR\u7684\u8fdb\u7a0b\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u88ab\u8bbe\u7f6e\u4e3aNOT_RESPONDING\u72b6\u6001\u3002</p> <p>\u8003\u8651\u4e0b\u9762\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u540e\u53f0ANR\uff08SilentAnr\uff09\uff1a\u4e4b\u524d\u5206\u6790ANR\u6d41\u7a0b\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u5982\u679cANR\u88ab\u6807\u8bb0\u4e3a\u4e86\u540e\u53f0ANR\uff08\u5373SilentAnr\uff09\uff0c\u90a3\u4e48\u6740\u6b7b\u8fdb\u7a0b\u540e\u5c31\u4f1a\u76f4\u63a5return\uff0c\u5e76\u4e0d\u4f1a\u8d70\u5230\u4ea7\u751f\u8fdb\u7a0b\u9519\u8bef\u72b6\u6001\u7684\u903b\u8f91\u3002\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u540e\u53f0ANR\u6ca1\u529e\u6cd5\u6355\u6349\u5230\uff0c\u800c\u540e\u53f0ANR\u7684\u91cf\u540c\u6837\u975e\u5e38\u5927\uff0c\u5e76\u4e14\u540e\u53f0ANR\u4f1a\u76f4\u63a5\u6740\u6b7b\u8fdb\u7a0b\uff0c\u5bf9\u7528\u6237\u7684\u4f53\u9a8c\u4e5f\u662f\u975e\u5e38\u8d1f\u9762\u7684\uff0c\u8fd9\u4e48\u5927\u4e00\u90e8\u5206ANR\u76d1\u63a7\u4e0d\u5230\uff0c\u5f53\u7136\u662f\u65e0\u6cd5\u63a5\u53d7\u7684\u3002</li> <li>\u95ea\u9000ANR\uff1a\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53d1\u73b0\u76f8\u5f53\u4e00\u90e8\u5206\u673a\u578b\uff08\u4f8b\u5982OPPO\u3001VIVO\u4e24\u5bb6\u7684\u9ad8Android\u7248\u672c\u7684\u673a\u578b\uff09\u4fee\u6539\u4e86ANR\u7684\u6d41\u7a0b\uff0c\u5373\u4f7f\u662f\u53d1\u751f\u5728\u524d\u53f0\u7684ANR\uff0c\u4e5f\u5e76\u4e0d\u4f1a\u5f39\u7a97\uff0c\u800c\u662f\u76f4\u63a5\u6740\u6b7b\u8fdb\u7a0b\uff0c\u5373\u95ea\u9000\u3002\u8fd9\u90e8\u5206\u7684\u673a\u578b\u8986\u76d6\u7684\u7528\u6237\u91cf\u4e5f\u975e\u5e38\u5927\u3002\u5e76\u4e14\uff0c\u786e\u5b9a\u4e24\u5bb6\u4eca\u540e\u7684\u65b0\u8bbe\u5907\u4f1a\u4e00\u76f4\u7ef4\u6301\u8fd9\u4e2a\u673a\u5236\u3002</li> </ul> <p>\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u79cd\u65b9\u6cd5\uff0c\u5728\u6536\u5230SIGQUIT\u4fe1\u53f7\u540e\uff0c\u80fd\u591f\u975e\u5e38\u5feb\u901f\u7684\u4fa6\u67e5\u51fa\u81ea\u5df1\u662f\u4e0d\u662f\u5df2\u5904\u4e8eANR\u7684\u72b6\u6001\uff0c\u8fdb\u884c\u5feb\u901f\u7684dump\u548c\u4e0a\u62a5\u3002\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e3b\u7ebf\u7a0b\u662f\u5426\u5904\u4e8e\u5361\u987f\u72b6\u6001\u6765\u5224\u65ad\u3002\u90a3\u4e48\u600e\u4e48\u6700\u5feb\u901f\u7684\u77e5\u9053\u4e3b\u7ebf\u7a0b\u662f\u4e0d\u662f\u5361\u4f4f\u4e86\u5462\uff1f\u6211\u4eec\u53cd\u5c04\u8fc7\u4e3b\u7ebf\u7a0bLooper\u7684mMessage\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u7684when\u53d8\u91cf\uff0c\u8868\u793a\u7684\u5c31\u662f\u5f53\u524d\u6b63\u5728\u5904\u7406\u7684\u6d88\u606f\u5165\u961f\u7684\u65f6\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7when\u53d8\u91cf\u51cf\u53bb\u5f53\u524d\u65f6\u95f4\uff0c\u5f97\u5230\u7684\u5c31\u662f\u7b49\u5f85\u65f6\u95f4\uff0c\u5982\u679c\u7b49\u5f85\u65f6\u95f4\u8fc7\u957f\uff0c\u5c31\u8bf4\u660e\u4e3b\u7ebf\u7a0b\u662f\u5904\u4e8e\u5361\u4f4f\u7684\u72b6\u6001\uff0c\u8fd9\u65f6\u5019\u6536\u5230SIGQUIT\u4fe1\u53f7\u57fa\u672c\u4e0a\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u7684\u786e\u53d1\u751f\u4e86\u4e00\u6b21ANR\uff1a</p> <pre><code>private static boolean isMainThreadStuck(){\ntry {\nMessageQueue mainQueue = Looper.getMainLooper().getQueue();\nField field = mainQueue.getClass().getDeclaredField(\"mMessages\");\nfield.setAccessible(true);\nfinal Message mMessage = (Message) field.get(mainQueue);\nif (mMessage != null) {\nlong when = mMessage.getWhen();\nif(when == 0) {\nreturn false;\n}\nlong time = when - SystemClock.uptimeMillis();\nlong timeThreshold = BACKGROUND_MSG_THRESHOLD;\nif (foreground) {\ntimeThreshold = FOREGROUND_MSG_THRESHOLD;\n}\nreturn time &lt; timeThreshold;\n}\n} catch (Exception e){\nreturn false;\n}\nreturn false;\n}\n</code></pre> <p>\u6211\u4eec\u901a\u8fc7\u4e0a\u9762\u51e0\u79cd\u673a\u5236\u6765\u7efc\u5408\u5224\u65ad\u6536\u5230SIGQUIT\u4fe1\u53f7\u540e\uff0c\u662f\u5426\u771f\u7684\u53d1\u751f\u4e86\u4e00\u6b21ANR\uff0c\u6700\u5927\u7a0b\u5ea6\u5730\u51cf\u5c11\u8bef\u62a5\u548c\u6f0f\u62a5\uff0c\u624d\u662f\u4e00\u4e2a\u6bd4\u8f83\u5b8c\u5584\u7684\u76d1\u63a7\u65b9\u6848\u3002</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#33-anr-trace","title":"3.3 \u989d\u5916\u6536\u83b7\uff1a\u83b7\u53d6ANR Trace","text":"<p>\u56de\u5230\u4e4b\u524d\u753b\u7684ANR\u6d41\u7a0b\u793a\u610f\u56fe\uff0cSignal Catcher\u7ebf\u7a0b\u5199Trace\uff08\u57082\uff09\u4e5f\u662f\u4e00\u4e2a\u8fb9\u754c\uff0c\u5e76\u4e14\u662f\u901a\u8fc7socket\u7684write\u65b9\u6cd5\u6765\u5199Trace\u7684\uff0c\u5982\u679c\u6211\u4eec\u80fd\u591fhook\u5230\u8fd9\u91cc\u7684write\uff0c\u6211\u4eec\u751a\u81f3\u5c31\u53ef\u4ee5\u62ff\u5230\u7cfb\u7edfdump\u7684ANR Trace\u5185\u5bb9\u3002\u8fd9\u4e2a\u5185\u5bb9\u975e\u5e38\u5168\u9762\uff0c\u5305\u62ec\u4e86\u6240\u6709\u7ebf\u7a0b\u7684\u5404\u79cd\u72b6\u6001\u3001\u9501\u548c\u5806\u6808\uff08\u5305\u62ecnative\u5806\u6808\uff09\uff0c\u5bf9\u4e8e\u6211\u4eec\u6392\u67e5\u95ee\u9898\u5341\u5206\u6709\u7528\uff0c\u5c24\u5176\u662f\u4e00\u4e9bnative\u95ee\u9898\u548c\u6b7b\u9501\u7b49\u95ee\u9898\u3002Native Hook\u6211\u4eec\u91c7\u7528PLT Hook \u65b9\u6848\u3002</p> <pre><code>int (*original_connect)(int __fd, const struct sockaddr* __addr, socklen_t __addr_length);\nint my_connect(int __fd, const struct sockaddr* __addr, socklen_t __addr_length) {\nif (strcmp(__addr-&gt;sa_data, \"/dev/socket/tombstoned_java_trace\") == 0) {\nisTraceWrite = true;\nsignalCatcherTid = gettid();\n}\nreturn original_connect(__fd, __addr, __addr_length);\n}\nint (*original_open)(const char *pathname, int flags, mode_t mode);\nint my_open(const char *pathname, int flags, mode_t mode) {\nif (strcmp(pathname, \"/data/anr/traces.txt\") == 0) {\nisTraceWrite = true;\nsignalCatcherTid = gettid();\n}\nreturn original_open(pathname, flags, mode);\n}\nssize_t (*original_write)(int fd, const void* const __pass_object_size0 buf, size_t count);\nssize_t my_write(int fd, const void* const buf, size_t count) {\nif(isTraceWrite &amp;&amp; signalCatcherTid == gettid()) {\nisTraceWrite = false;\nsignalCatcherTid = 0;\nchar *content = (char *) buf;\nprintAnrTrace(content);\n}\nreturn original_write(fd, buf, count);\n}\nvoid hookAnrTraceWrite() {\nint apiLevel = getApiLevel();\nif (apiLevel &lt; 19) {\nreturn;\n}\nif (apiLevel &gt;= 27) {\nplt_hook(\"libcutils.so\", \"connect\", (void *) my_connect, (void **) (&amp;original_connect));\n} else {\nplt_hook(\"libart.so\", \"open\", (void *) my_open, (void **) (&amp;original_open));\n}\nif (apiLevel &gt;= 30 || apiLevel == 25 || apiLevel ==24) {\nplt_hook(\"libc.so\", \"write\", (void *) my_write, (void **) (&amp;original_write));\n} else if (apiLevel == 29) {\nplt_hook(\"libbase.so\", \"write\", (void *) my_write, (void **) (&amp;original_write));\n} else {\nplt_hook(\"libart.so\", \"write\", (void *) my_write, (void **) (&amp;original_write));\n}\n}\n</code></pre> <p>\u5176\u4e2d\u6709\u51e0\u70b9\u9700\u8981\u6ce8\u610f\uff1a</p> <ul> <li>\u53eaHook ANR\u6d41\u7a0b\uff1a\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u57fa\u7840\u5e93\u4e2d\u7684connect/open/write\u65b9\u6cd5\u53ef\u80fd\u8c03\u7528\u7684\u6bd4\u8f83\u9891\u7e41\uff0c\u6211\u4eec\u9700\u8981\u628ahook\u7684\u5f71\u54cd\u964d\u5230\u6700\u4f4e\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u4f1a\u5728\u63a5\u6536\u5230SIGQUIT\u4fe1\u53f7\u540e\uff08\u91cd\u65b0\u53d1\u9001SIGQUIT\u4fe1\u53f7\u7ed9Signal Catcher\u524d\uff09\u8fdb\u884chook\uff0cANR\u6d41\u7a0b\u7ed3\u675f\u540e\u518dunhook\u3002</li> <li>\u53ea\u5904\u7406Signal Catcher\u7ebf\u7a0bopen/connect\u540e\u7684\u7b2c\u4e00\u6b21write\uff1a\u9664\u4e86Signal Catcher\u7ebf\u7a0b\u4e2d\u7684dump trace\u7684\u6d41\u7a0b\uff0c\u5176\u4ed6\u5730\u65b9\u8c03\u7528\u7684write\u65b9\u6cd5\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\uff0c\u5e76\u4e0d\u9700\u8981\u5904\u7406\u3002\u4f8b\u5982\uff0cdump trace\u7684\u6d41\u7a0b\u4f1a\u5728\u5728write\u65b9\u6cd5\u524d\uff0c\u7cfb\u7edf\u4f1a\u5148\u4f7f\u7528connet\u65b9\u6cd5\u94fe\u63a5\u4e00\u4e2apath\u4e3a\u201c/dev/socket/tombstoned_java_trace\u201d\u7684socket\uff0c\u6211\u4eec\u53ef\u4ee5hook connect\u65b9\u6cd5\uff0c\u62ff\u5230\u8fd9\u4e2asocket\u7684name\uff0c\u6211\u4eec\u53ea\u5904\u7406connect\u8fd9\u4e2asocket\u540e\uff0c\u76f8\u540c\u7ebf\u7a0b\uff08\u5373Signal Catcher\u7ebf\u7a0b\uff09\u7684\u7b2c\u4e00\u6b21write\uff0c\u8fd9\u6b21write\u7684\u5185\u5bb9\u624d\u662f\u6211\u4eec\u552f\u4e00\u5173\u5fc3\u7684\u3002</li> <li>Hook\u70b9\u56e0API Level\u800c\u4e0d\u540c\uff1a\u9700\u8981hook\u7684write\u65b9\u6cd5\u5728\u4e0d\u540c\u7684Android\u7248\u672c\u4e2d\uff0c\u6240\u5728\u7684so\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0c\u4e0d\u540cAPI Level\u9700\u8981\u5206\u522b\u5904\u7406\uff0chook\u4e0d\u540c\u7684so\u548c\u65b9\u6cd5\u3002</li> </ul> <p>\u8fd9\u4e2aHook Trace\u7684\u65b9\u6848\uff0c\u4e0d\u4ec5\u4ec5\u53ef\u4ee5\u7528\u6765\u67e5ANR\u95ee\u9898\uff0c\u4efb\u4f55\u65f6\u5019\u6211\u4eec\u90fd\u53ef\u4ee5\u624b\u52a8\u5411\u81ea\u5df1\u53d1\u9001\u4e00\u4e2aSIGQUIT\u4fe1\u53f7\uff0c\u4ece\u800chook\u5230\u5f53\u65f6\u7684Trace\u3002Trace\u7684\u5185\u5bb9\u5bf9\u4e8e\u6211\u4eec\u6392\u67e5\u7ebf\u7a0b\u6b7b\u9501\uff0c\u7ebf\u7a0b\u5f02\u5e38\uff0c\u8017\u7535\u7b49\u95ee\u9898\u90fd\u975e\u5e38\u6709\u5e2e\u52a9\u3002</p>"},{"location":"perf-opt/Android/anr/anr_monitor/#_1","title":"\u53c2\u8003","text":"<p>\u5fae\u4fe1Android\u5ba2\u6237\u7aef\u7684ANR\u76d1\u63a7\u65b9\u6848</p>"},{"location":"perf-opt/Android/anr/anr_trace/","title":"ANR \u5206\u6790","text":""},{"location":"perf-opt/Android/anr/anr_trace/#anr_1","title":"\u524d\u7f6e\u77e5\u8bc6\uff1aANR\u539f\u7406\u6982\u8ff0","text":""},{"location":"perf-opt/Android/anr/anr_trace/#anr_2","title":"ANR\u5f39\u7a97","text":"<p>\u5f39\u51faANR\u5bf9\u8bdd\u6846\u7684message\u6807\u8bc6</p> <p>ActivityManagerService.java#SHOW_NOT_RESPONDING_UI_MSG</p> <p><pre><code>public void handleMessage(Message msg) {\nswitch (msg.what) {\n...\ncase SHOW_NOT_RESPONDING_UI_MSG: {\nmAppErrors.handleShowAnrUi(msg);\nensureBootCompleted();\n} break;\n...\n</code></pre> \u5176\u8c03\u7528<code>AppErrors</code>\u7684<code>handleShowAnrUi</code>\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a<code>AppNotRespondingDialog</code>(\u7cfb\u7edf\u7684\u81ea\u5b9a\u4e49Dialog)\uff0c\u6700\u7ec8\u4f1a\u4ee5<code>TYPE_SYSTEM_ERROR</code>\u7684\u65b9\u5f0f\u5f39\u51fa\u3002 \u6240\u4ee5\uff0c\u5f39\u51faANR\u5bf9\u8bdd\u6846\u7684\u6761\u4ef6\u5c31\u662fAMS\u4e2d\u7684UiHandler\u6536\u5230\u4e86what\u4e3aSHOW_NOT_RESPONDING_UI_MSG\u7684\u6d88\u606f</p> <p>\u8fd9\u4e2a\u6d88\u606f\u662f\u5728\u54ea\u91cc\u53d1\u51fa</p> <p>ProcessErrorStateRecord#appNotResponding</p> <pre><code>void appNotResponding(...) {\n...\nsynchronized (mService) {\n...\nif (isSilentAnr() &amp;&amp; !mApp.isDebugging()) {\nmApp.killLocked(\"bg anr\", ApplicationExitInfo.REASON_ANR, true);\nreturn;\n}\n...\nif (mService.mUiHandler != null) {\n// Bring up the infamous App Not Responding dialog\nMessage msg = Message.obtain();\nmsg.what = ActivityManagerService.SHOW_NOT_RESPONDING_UI_MSG;\nmsg.obj = new AppNotRespondingDialog.Data(mApp, aInfo, aboveSystem);\nmService.mUiHandler.sendMessageDelayed(msg, anrDialogDelayMs);\n}\n}\n...\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u4f1a\u7ed9AMS(\u90a3\u4e2amService\u5c31\u662fAMS\u7684\u5b9e\u4f8b)\u7684UiHandler\u53d1\u9001\u8bf7\u6c42\u5f39\u51faANR\u5bf9\u8bdd\u6846\uff0c\u90a3\u5230\u5e95\u5728\u54ea\u4e9b\u5730\u65b9\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5462\uff1f \u4e00\u5171\u67095\u5904\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>ActiveServices#serviceTimeout\u65b9\u6cd5<ul> <li>\u540e\u53f0\u670d\u52a1\u8d85\u65f6</li> </ul> </li> <li>ActiveServices#serviceForegroundTimeout\uff1b<ul> <li>\u524d\u53f0\u670d\u52a1\u8d85\u65f6</li> </ul> </li> <li>ActivityManagerService#appNotRespondingViaProvider\uff1b<ul> <li>\u901a\u8fc7Provider\u53d1\u51fa\u7684\u65e0\u54cd\u5e94</li> </ul> </li> <li>BroadcastQueue#broadcastTimeoutLocked<ul> <li>\u6709\u5e8f\u5e7f\u64ad\u8d85\u65f6    </li> </ul> </li> <li>ActivityManagerService#inputDispatchingTimedOut\uff1b<ul> <li>input\u4e8b\u4ef6\u5206\u6d3e\u7684\u65f6\u5019\u8d85\u65f6(\u5904\u7406\u4e8b\u4ef6\u65f6\u88ab\u963b\u585e)\u6240\u53d1\u51fa\u7684\uff0cinput\u4e8b\u4ef6\uff0c\u8fd9\u91cc\u5206\u4e24\u79cd\uff0c\u4e00\u79cd\u662fKeyEvent(\u6309\u952e)\uff0c\u53e6\u4e00\u79cd\u662fMotionEvent(\u89e6\u6478)\u3002</li> </ul> </li> </ul>"},{"location":"perf-opt/Android/anr/anr_trace/#anr_3","title":"\u8d85\u65f6\u4e00\u5b9a\u4f1a\u51fa\u73b0ANR\u5f39\u6846\u5417\uff1f","text":"<ul> <li><code>SilentAnr</code>\u4e0d\u4f1a\u5f39\u7a97\uff0c \u6240\u8c13\u201c\u6c89\u9ed8\u7684ANR\u201d\uff0c\u5176\u5b9e\u5c31\u662f\u540e\u53f0ANR\uff0c\u540e\u53f0ANR\u8ddf\u524d\u53f0ANR\u4f1a\u6709\u4e0d\u540c\u7684\u8868\u73b0\uff1a\u524d\u53f0ANR\u4f1a\u5f39\u65e0\u54cd\u5e94\u7684Dialog\uff0c\u540e\u53f0ANR\u4f1a\u76f4\u63a5\u6740\u6b7b\u8fdb\u7a0b\u3002\u524d\u540e\u53f0ANR\u7684\u5224\u65ad\u7684\u539f\u5219\u662f\uff1a\u5982\u679c\u53d1\u751fANR\u7684\u8fdb\u7a0b\u5bf9\u7528\u6237\u6765\u8bf4\u662f\u6709\u611f\u77e5\u7684\uff0c\u5c31\u4f1a\u88ab\u8ba4\u4e3a\u662f\u524d\u53f0ANR\uff0c\u5426\u5219\u662f\u540e\u53f0ANR\u3002\u53e6\u5916\uff0c\u5982\u679c\u5728\u5f00\u53d1\u8005\u9009\u9879\u4e2d\u52fe\u9009\u4e86\u201c\u663e\u793a\u540e\u53f0ANR\u201d\uff0c\u90a3\u4e48\u5168\u90e8ANR\u90fd\u4f1a\u88ab\u8ba4\u4e3a\u662f\u524d\u53f0ANR\u3002     <pre><code>// A package is considered interesting if any of the following is true :\n//\n// - It's displaying an activity.\n// - It's the SystemUI.\n// - It has an overlay or a top UI visible.\n//\n// NOTE: The check whether a given ProcessRecord belongs to the systemui\n// process is a bit of a kludge, but the same pattern seems repeated at\n// several places in the system server.\n</code></pre></li> <li>input\u4e8b\u4ef6\u5206\u6d3e\u8d85\u65f6\u5904\u4e8edebug\u6216\u8005\u6765\u81ea\u5b50\u8fdb\u7a0b(\u8fd9\u4e2a\u60c5\u51b5\u4e0b\u4f1a\u76f4\u63a5kill\u6389\u5b50\u8fdb\u7a0b)\u4e0d\u4f1a\u5f39\u7a97 <p>ActivityManagerService.java#inputDispatchingTimedOut</p> </li> </ul> <pre><code>    boolean inputDispatchingTimedOut(...) {\nsynchronized (this) {\n//1.\u5904\u4e8edebug\nif (proc.isDebugging()) {\nreturn false;\n}\n//2. \u6765\u81ea\u5b50\u8fdb\u7a0b\nif (proc.getActiveInstrumentation() != null) {\nBundle info = new Bundle();\ninfo.putString(\"shortMsg\", \"keyDispatchingTimedOut\");\ninfo.putString(\"longMsg\", annotation);\nfinishInstrumentationLocked(proc, Activity.RESULT_CANCELED, info);\nreturn true;\n}\n}\nmAnrHelper.appNotResponding(proc, activityShortComponentName, aInfo,\nparentShortComponentName, parentProcess, aboveSystem, annotation);\nreturn true;\n}\n</code></pre> <p>ActivityManagerService.java#attachApplicationLocked</p> <pre><code>    private boolean attachApplicationLocked(...) {\n...\nProfilerInfo profilerInfo = mAppProfiler.setupProfilerInfoLocked(thread, app, instr);\n...\n}\n</code></pre> <p>AppProfiler.java#setupProfilerInfoLocked</p> <pre><code>    ProfilerInfo setupProfilerInfoLocked(...) {\n...\n// \u68c0\u67e5\u662f\u5426\u662f\u5b50\u8fdb\u7a0b   \n// Check if this is a secondary process that should be incorporated into some\n// currently active instrumentation.  (Note we do this AFTER all of the profiling\n// stuff above because profiling can currently happen only in the primary\n// instrumentation process.)\nif (mService.mActiveInstrumentation.size() &gt; 0 &amp;&amp; instr == null) {\n...\napp.setActiveInstrumentation(aInstr);\n...\n}\n...\n}\n</code></pre>"},{"location":"perf-opt/Android/anr/anr_trace/#1-anr","title":"1. \u5bfc\u81f4ANR\u7684\u539f\u56e0","text":"<p>\u5f88\u591a\u5f00\u53d1\u8005\u8ba4\u4e3a\uff0c\u90a3\u5c31\u662f\u8017\u65f6\u64cd\u4f5c\u5bfc\u81f4ANR\uff0c\u5168\u90e8\u662fapp\u5e94\u7528\u5c42\u7684\u95ee\u9898\u3002\u5b9e\u9645\u4e0a\uff0c\u7ebf\u4e0a\u73af\u5883\u5927\u90e8\u5206ANR\u7531\u7cfb\u7edf\u539f\u56e0\u5bfc\u81f4\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#11-anr","title":"1.1 \u5e94\u7528\u5c42\u5bfc\u81f4ANR\uff08\u8017\u65f6\u64cd\u4f5c\uff09","text":"<ul> <li> <p>\u4e3b\u7ebf\u7a0b\u8017\u65f6\uff1a\u5982\u6b7b\u5faa\u73af\u3001\u4e3b\u7ebf\u7a0bIO\u3001\u5904\u7406\u5927\u6570\u636e</p> </li> <li> <p>\u9501\u51fa\u9519\uff1a\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u5b50\u7ebf\u7a0b\u7684\u9501</p> </li> <li> <p>\u5185\u5b58\u7d27\u5f20\uff1a\u7cfb\u7edf\u5206\u914d\u7ed9\u4e00\u4e2a\u5e94\u7528\u7684\u5185\u5b58\u662f\u6709\u4e0a\u9650\u7684\uff0c\u957f\u671f\u5904\u4e8e\u5185\u5b58\u7d27\u5f20\uff0c\u4f1a\u5bfc\u81f4\u9891\u7e41\u5185\u5b58\u4ea4\u6362\uff0c\u8fdb\u800c\u5bfc\u81f4\u5e94\u7528\u7684\u4e00\u4e9b\u64cd\u4f5c\u8d85\u65f6</p> </li> </ul>"},{"location":"perf-opt/Android/anr/anr_trace/#12-anr","title":"1.2 \u7cfb\u7edf\u5bfc\u81f4ANR","text":"<ul> <li> <p>CPU\u88ab\u62a2\u5360\uff1a\u4e00\u822c\u6765\u8bf4\uff0c\u524d\u53f0\u5728\u73a9\u6e38\u620f\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f60\u7684\u540e\u53f0\u5e7f\u64ad\u88ab\u62a2\u5360CPU</p> </li> <li> <p>\u7cfb\u7edf\u670d\u52a1\u65e0\u6cd5\u53ca\u65f6\u54cd\u5e94\uff1a\u6bd4\u5982\u83b7\u53d6\u7cfb\u7edf\u8054\u7cfb\u4eba\u7b49\uff0c\u7cfb\u7edf\u7684\u670d\u52a1\u90fd\u662fBinder\u673a\u5236\uff0c\u670d\u52a1\u80fd\u529b\u4e5f\u662f\u6709\u9650\u7684\uff0c\u6709\u53ef\u80fd\u7cfb\u7edf\u670d\u52a1\u957f\u65f6\u95f4\u4e0d\u54cd\u5e94\u5bfc\u81f4ANR</p> </li> <li> <p>\u5176\u4ed6\u5e94\u7528\u5360\u7528\u7684\u5927\u91cf\u5185\u5b58</p> </li> </ul>"},{"location":"perf-opt/Android/anr/anr_trace/#2-anr","title":"2. ANR\u5206\u6790","text":""},{"location":"perf-opt/Android/anr/anr_trace/#21-cpu","title":"2.1 CPU \u8d1f\u8f7d","text":"<p>\u53d1\u751fANR\u65f6\uff0c \u5728<code>Logcat</code>\u4e2d\u641c\u7d22<code>ANR in</code>\u5173\u952e\u8bcd</p> <pre><code>Load: 2.62 / 2.55 / 2.25\nCPU usage from 0ms to 1987ms later (2020-03-10 08:31:55.169 to 2020-03-10 08:32:17.156):\n  41% 2080/system_server: 28% user + 12% kernel / faults: 76445 minor 180 major\n  26% 9378/com.xiaomi.store: 20% user + 6.8% kernel / faults: 68408 minor 68 major\n........\u7701\u7565N\u884c.....\n66% TOTAL: 20% user + 15% kernel + 28% iowait + 0.7% irq + 0.7% softirq\n</code></pre> <ul> <li>\u7b2c\u4e00\u884c\uff1a1\u30015\u300115 \u5206\u949f\u5185\u6b63\u5728\u4f7f\u7528\u548c\u7b49\u5f85\u4f7f\u7528CPU \u7684\u6d3b\u52a8\u8fdb\u7a0b\u7684\u5e73\u5747\u6570</li> <li>\u7b2c\u4e8c\u884c\uff1a\u8868\u660e\u8d1f\u8f7d\u4fe1\u606f\u6293\u53d6\u5728ANR\u53d1\u751f\u4e4b\u540e\u76840~1987ms\u3002\u540c\u65f6\u4e5f\u6307\u660e\u4e86ANR\u7684\u65f6\u95f4\u70b9\uff1a2020-03-10 08:31:55.169</li> <li>\u4e2d\u95f4\u90e8\u5206\uff1a\u5404\u4e2a\u8fdb\u7a0b\u5360\u7528\u7684CPU\u7684\u8be6\u7ec6\u60c5\u51b5</li> <li>\u6700\u540e\u4e00\u884c\uff1a\u5404\u4e2a\u8fdb\u7a0b\u5408\u8ba1\u5360\u7528\u7684CPU\u4fe1\u606f\u3002</li> </ul> <p>\u540d\u8bcd\u89e3\u91ca\uff1a</p> <ul> <li> <p>user:\u7528\u6237\u6001</p> </li> <li> <p>kernel:\u5185\u6838\u6001</p> </li> <li> <p>faults:\u5185\u5b58\u7f3a\u9875\uff0cminor\u2014\u2014\u8f7b\u5fae\u7684\uff0cmajor\u2014\u2014\u91cd\u5ea6\uff0c\u9700\u8981\u4ece\u78c1\u76d8\u62ff\u6570\u636e</p> </li> <li> <p>iowait:IO\u4f7f\u7528\uff08\u7b49\u5f85\uff09\u5360\u6bd4</p> </li> <li> <p>irq:\u786c\u4e2d\u65ad\uff0csoftirq:\u8f6f\u4e2d\u65ad</p> </li> </ul> <p>\u4e2d\u65ad</p> <p>\u4e2d\u65ad\u673a\u5236\uff1aCPU\u5728\u6267\u884c\u6307\u4ee4\u65f6\uff0c\u6536\u5230\u67d0\u4e2a\u4e2d\u65ad\u4fe1\u53f7\u8f6c\u800c\u53bb\u6267\u884c\u9884\u5148\u8bbe\u5b9a\u597d\u7684\u4ee3\u7801\uff0c\u7136\u540e\u518d\u8fd4\u56de\u5230\u539f\u6307\u4ee4\u6d41\u4e2d\u7ee7\u7eed\u6267\u884c\uff0c\u8fd9\u5c31\u662f\u4e2d\u65ad\u673a\u5236\u3002</p> <p>\u4e2d\u65ad\u5206\u4e3a\u786c\u4e2d\u65ad\u548c\u8f6f\u4e2d\u65ad\uff0c\u786c\u4e2d\u65ad\u662f\u7531\u5916\u90e8\u8bbe\u5907\u53d1\u51fa\u7684\u4e2d\u65ad\uff0c\u5982\u952e\u76d8\u3001\u9f20\u6807\u3001\u7f51\u5361\u3001\u786c\u76d8\u7b49\uff0c\u8f6f\u4e2d\u65ad\u662f\u7531CPU\u5185\u90e8\u4ea7\u751f\u7684\u4e2d\u65ad\uff0c\u5982\u7cfb\u7edf\u8c03\u7528\u3001\u5f02\u5e38\u7b49\u3002</p> <p>\u7f3a\u9875\u4e2d\u65ad\uff1a malloc()\u548cmmap()\u7b49\u5185\u5b58\u5206\u914d\u51fd\u6570\uff0c\u5728\u5206\u914d\u65f6\u53ea\u662f\u5efa\u7acb\u4e86\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u5e76\u6ca1\u6709\u5206\u914d\u865a\u62df\u5185\u5b58\u5bf9\u5e94\u7684\u7269\u7406\u5185\u5b58\u3002\u5f53\u8fdb\u7a0b\u8bbf\u95ee\u8fd9\u4e9b\u6ca1\u6709\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u7684\u865a\u62df\u5185\u5b58\u65f6\uff0c\u5904\u7406\u5668\u81ea\u52a8\u89e6\u53d1\u4e00\u4e2a\u7f3a\u9875\u4e2d\u65ad\uff0c\u6b64\u65f6CPU\u4f1a\u6682\u505c\u5f53\u524d\u8fdb\u7a0b\u7684\u6267\u884c\uff0c\u53bb\u6267\u884c\u7f3a\u9875\u4e2d\u65ad\u7684\u5904\u7406\u7a0b\u5e8f\uff0c\u5904\u7406\u5b8c\u540e\u518d\u8fd4\u56de\u5230\u539f\u8fdb\u7a0b\u4e2d\u7ee7\u7eed\u6267\u884c\u3002</p> <p>minor&amp;major\uff1a minor\u662f\u6307\u5185\u5b58\u9875\u4e0d\u5728\u5185\u5b58\u4e2d\uff0c\u4f46\u662f\u5728swap\u5206\u533a\u4e2d\uff0cmajor\u662f\u6307\u5185\u5b58\u9875\u4e0d\u5728\u5185\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728swap\u5206\u533a\u4e2d\uff0c\u9700\u8981\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002</p> <p>\u6ce8\u610f\uff1a</p> <ul> <li>iowait\u5360\u6bd4\u5f88\u9ad8\uff0c\u610f\u5473\u7740\u6709\u5f88\u5927\u53ef\u80fd\uff0c\u662fio\u8017\u65f6\u5bfc\u81f4ANR\uff0c\u5177\u4f53\u8fdb\u4e00\u6b65\u67e5\u770b\u6709\u6ca1\u6709\u8fdb\u7a0b<code>faults major</code>\u6bd4\u8f83\u591a\u3002</li> <li>\u5355\u8fdb\u7a0bCPU\u7684\u8d1f\u8f7d\u5e76\u4e0d\u662f\u4ee5100%\u4e3a\u4e0a\u9650\uff0c\u800c\u662f\u6709\u51e0\u4e2a\u6838\uff0c\u5c31\u6709\u767e\u5206\u4e4b\u51e0\u767e\uff0c\u59824\u6838\u4e0a\u9650\u4e3a400%\u3002</li> </ul> <p>CPU \u8d1f\u8f7d\u9ad8\u73b0\u8c61\u4e5f\u4f1a\u4f53\u73b0\u5728log\u65e5\u5fd7\u4e2d\uff0c\u641c\u7d22<code>slow_operation</code>, \u5982\u679c\u5b58\u5728\uff0c\u53ef\u80fdCPU\u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u7cfb\u7edf\u8fdb\u7a0b\u7684\u8c03\u5ea6\u4e5f\u4f1a\u53d7\u5230\u5f71\u54cd\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#22","title":"2.2 \u5185\u5b58\u4fe1\u606f","text":""},{"location":"perf-opt/Android/anr/anr_trace/#221-trace","title":"2.2.1 trace\u6587\u4ef6","text":"<p>\u53d1\u751fANR\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u4ea7\u751f\u4e00\u4efdanr\u65e5\u5fd7\u6587\u4ef6\uff08\u624b\u673a\u7684<code>data/anr/trace</code> \u6216\u8005<code>data/system/dropbox</code>\u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u79f0\u53ef\u80fd\u5404\u5382\u5546\u4e0d\u4e00\u6837\uff0c\u4e1a\u5185\u5927\u591a\u79f0\u547c\u4e3atrace\u6587\u4ef6\u3002</p> <p>\u8981\u662f\u4ece\u4e0a\u9762\u5f97\u4e0d\u5230trace\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>adb bugreport</code>\u5c1d\u8bd5\u83b7\u53d6\u3002trace\u6587\u4ef6\u4e2d\u6709\u5e94\u7528\u5185\u5b58\u4fe1\u606f\uff0c\u5982\u4e0b\uff1a</p> <pre><code>----- pid 8034 at 2023-01-02 10:11:04 -----\nCmd line: com.adison.notes\n....\n//\u7701\u7565N\u884c\n....\n//\u5df2\u5206\u914d\u5806\u5185\u5b58\u5927\u5c0f8762KB,\u5176\u4e2d3570KB\u5df2\u7528\uff0c\u603b\u5206\u914d89339\u4e2a\u5bf9\u8c61\nHeap: 59% free, 3570KB/8762KB; 89339 objects\n....\n//\u7701\u7565N\u884c\n....\n// \u8fdb\u7a0b\u521b\u5efa\u5230\u73b0\u5728\u4e00\u5171\u521b\u5efa\u4e86\u591a\u5c11\u5bf9\u8c61\nTotal number of allocations 127155 //\u8fdb\u7a0b\u521b\u5efa\u5230\u73b0\u5728\u4e00\u5171\u7533\u8bf7\u4e86\u591a\u5c11\u5185\u5b58\nTotal bytes allocated 6162KB\n//\u8fdb\u7a0b\u521b\u5efa\u5230\u73b0\u5728\u4e00\u5171\u91ca\u653e\u4e86\u591a\u5c11\u5185\u5b58\nTotal bytes freed 2591KB\n//\u4e0d\u6269\u5c55\u5806\u7684\u60c5\u51b5\u4e0b\u53ef\u7528\u7684\u5185\u5b58\nFree memory 5191KB\n//GC\u524d\u7684\u53ef\u7528\u5185\u5b58\nFree memory until GC 5191KB\n//OOM\u4e4b\u524d\u7684\u53ef\u7528\u5185\u5b58\nFree memory until OOME 252MB\n//\u5f53\u524d\u603b\u5185\u5b58\uff08\u5df2\u7528+\u53ef\u7528\uff09\nTotal memory 8762KB\n//\u8fdb\u7a0b\u6700\u591a\u80fd\u7533\u8bf7\u7684\u5185\u5b58\nMax memory 256MB\n....\n//\u7701\u7565N\u884c\n....\nsuspend all histogram:  Sum: 275us 99% C.I. 2us-92.160us Avg: 17.187us Max: 94us\n//\u5f53\u524d\u8fdb\u7a0b\u517115\u4e2a\u7ebf\u7a0b\nDALVIK THREADS (15):\n\"main\" prio=5 tid=1 Runnable\n| group=\"main\" sCount=0 dsCount=0 flags=0 obj=0x723b3830 self=0xe3540e10\n| sysTid=8034 nice=-10 cgrp=default sched=0/0 handle=0xed7bd474\n| state=R schedstat=( 27494067641 658836178 2642 ) utm=2723 stm=25 core=7 HZ=100\n| stack=0xff1e5000-0xff1e7000 stackSize=8192KB\n| held mutexes= \"mutator lock\"(shared held)\nat com.adison.notes.anr.ANRTest.makeMainThreadAnr(ANRTest.kt:21)\nat java.lang.reflect.Method.invoke(Native method)\nat androidx.appcompat.app.AppCompatViewInflater$DeclaredOnClickListener.onClick(AppCompatViewInflater.java:409)\nat android.view.View.performClick(View.java:8160)\nat android.widget.TextView.performClick(TextView.java:16222)\nat com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1119)\nat android.view.View.performClickInternal(View.java:8137)\nat android.view.View.access$3700(View.java:888)\nat android.view.View$PerformClick.run(View.java:30236)\nat android.os.Handler.handleCallback(Handler.java:938)\nat android.os.Handler.dispatchMessage(Handler.java:99)\nat android.os.Looper.loop(Looper.java:246)\nat android.app.ActivityThread.main(ActivityThread.java:8512)\nat java.lang.reflect.Method.invoke(Native method)\nat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:602)\nat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1130)\n</code></pre> <p>\u4ece\u542b\u4e49\u53ef\u4ee5\u5f97\u51fa\u7ed3\u8bba\uff1aFree memory until OOME \u7684\u503c\u5f88\u5c0f\u7684\u65f6\u5019\uff0c\u5df2\u7ecf\u5904\u4e8e\u5185\u5b58\u7d27\u5f20\u72b6\u6001\u3002\u5e94\u7528\u53ef\u80fd\u662f\u5360\u7528\u4e86\u8fc7\u591a\u5185\u5b58</p>"},{"location":"perf-opt/Android/anr/anr_trace/#222-logcat","title":"2.2.2 Logcat","text":"<p>\u6211\u4eec\u77e5\u9053\u901a\u5e38\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\uff0ckswapd\u7ebf\u7a0b\u4f1a\u6d3b\u8dc3\u8d77\u6765\u8fdb\u884c\u56de\u6536\u5185\u5b58\u3002\u67e5\u770bCPU \u8d1f\u8f7d\u65f6\u8981\u662f kswapd\u7684CPU\u5360\u636e\u6392\u8fdbtop3\u7684\u8bdd\uff0c\u8fd9\u4e2a\u95ee\u9898\u53d7\u7cfb\u7edf\u4f4e\u5185\u5b58\u5f71\u54cd\u6bd4\u8f83\u5927\u3002</p> <p></p> <p>\u53e6\u5916\u8fd9\u4e2a\u65f6\u5019\uff0c\u641c\u7d22<code>lowmemorykiller</code>\u5173\u952e\u8bcd\uff0c\u5982\u679c\u5b58\u5728\u5219\u67e5\u770b\u53d1\u751f\u65f6\u95f4\u548cANR\u65f6\u95f4\u662f\u5426\u5927\u81f4\u5bf9\u5e94\uff0c\u76f8\u5dee\u65e0\u51e0\u7684\u8bdd, \u53ef\u4ee5\u770b\u5230\u95ee\u9898\u65f6\u95f4\u533a\u57df\u4f1a\u6709\u8f83\u591a\u7684\u67e5\u6740\u8fdb\u7a0b\u884c\u4e3a\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u5173\u6ce8\u4e0b\"lowmemorykiller\"\u8fd9\u4e00\u884c\u6740\u7684\u8fdb\u7a0badj\u503c\uff0cadj\u503c\u8d8a\u4f4e\uff0c\u8bf4\u660e\u5f53\u524d\u7cfb\u7edf\u5185\u5b58\u8d8a\u5403\u7d27\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#223-eventlog","title":"2.2.3 eventlog","text":"<p>\u53e6\u5916\uff0c\u9664\u4e86trace\u6587\u4ef6\u4e2d\u6709\u5185\u5b58\u4fe1\u606f\uff0c\u666e\u901a\u7684<code>eventlog</code>\u65e5\u5fd7\u4e2d\uff0c\u4e5f\u6709\u5185\u5b58\u4fe1\u606f</p> <pre><code>04-02 22:00:08.195  1531  1544 I am_meminfo: [350937088,41086976,492830720,427937792,291887104]\n</code></pre> <p>\u4ee5\u4e0a\u56db\u4e2a\u503c\u5206\u522b\u6307\u7684\u662f\uff1a</p> <ul> <li>Cached</li> <li>Free,</li> <li>Zram,</li> <li>Kernel,Native</li> </ul> <p>Cached+Free\u7684\u5185\u5b58\u4ee3\u8868\u7740\u5f53\u524d\u6574\u4e2a\u624b\u673a\u7684\u53ef\u7528\u5185\u5b58\uff0c\u5982\u679c\u503c\u5f88\u5c0f\uff0c\u610f\u5473\u7740\u5904\u4e8e\u5185\u5b58\u7d27\u5f20\u72b6\u6001\u3002\u4e00\u822c\u4f4e\u5185\u5b58\u7684\u5224\u5b9a\u9608\u503c\u4e3a\uff1a4G \u5185\u5b58\u624b\u673a\u4ee5\u4e0b\u9600\u503c\uff1a350MB\uff0c\u4ee5\u4e0a\u9600\u503c\u5219\u4e3a\uff1a450MB</p> <p>\u5982\u679cANR\u65f6\u95f4\u70b9\u524d\u540e\uff0c\u65e5\u5fd7\u91cc\u6709\u6253\u5370onTrimMemory\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5185\u5b58\u7d27\u5f20\u7684\u4e00\u4e2a\u53c2\u8003\u5224\u65ad</p> <p>\u5728\u5f00\u53d1\u8c03\u8bd5\u4e2d\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u770bEventLog\u4fe1\u606f\uff1a</p> <pre><code>adb logcat -b events\n</code></pre> <p>EventLog</p> <p>\u5728\u5e73\u65f6\u5f00\u53d1\u548c\u5904\u7406bug\u7684\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u4f1a\u548cEventLog\u6253\u4ea4\u5230\uff0c\u901a\u8fc7EventLog\u6765\u5206\u6790Activity\u3001   Process\u3001CPU\u3001Window\u7b49\u76f8\u5173\u4fe1\u606f\u3002</p> <p>\u5728\u5f00\u53d1\u8c03\u8bd5\u4e2d\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u770bEventLog\u4fe1\u606f\uff1a <pre><code>adb logcat -b events\n</code></pre></p> <p>\u90a3\u4e48\u4f1a\u8f93\u51fa\u5927\u91cf\u7c7b\u4f3c\u8fd9\u6837\u7684\u4fe1\u606f\uff1a <pre><code>06-01 13:44:55.518  7361  8289 I am_create_service:                 [0,111484394,.StatService,10094,7769]\n06-01 13:44:55.540  7361  8343 I am_proc_bound:             [0,3976,com.android.providers.calendar]\n06-01 13:44:55.599  7361  8033 I am_create_service:     [0,61349752,.UpdateService,10034,1351]\n06-01 13:44:55.625  7361  7774 I am_destroy_service: [0,61349752,1351]\n...\n</code></pre></p> <p>\u4eceEventLog\u4e2d\u6211\u4eec\u53ef\u4ee5\u83b7\u53d6\u5230\u4e0d\u5c11\u6709\u7528\u7684\u4fe1\u606f\uff0c\u4e0b\u9762\u5217\u4e3e\u4e0b\u90e8\u5206\u5b57\u6bb5\u542b\u4e49\uff1a</p> <ul> <li>am_low_memory\uff1a\u4f4d\u4e8eAMS.killAllBackgroundProcesses\u6216\u8005AMS.appDiedLocked\uff0c\u8bb0\u5f55\u5f53\u524dLru\u8fdb\u7a0b\u961f\u5217\u957f\u5ea6\u3002</li> <li>am_pss\uff1a\u4f4d\u4e8eAMS.recordPssSampleLocked(</li> <li>am_meminfo\uff1a\u4f4d\u4e8eAMS.dumpApplicationMemoryUsage</li> <li>am_proc_start:\u4f4d\u4e8eAMS.startProcessLocked\uff0c\u542f\u52a8\u8fdb\u7a0b</li> <li>am_proc_bound:\u4f4d\u4e8eAMS.attachApplicationLocked</li> <li>am_kill: \u4f4d\u4e8eProcessRecord.kill\uff0c\u6740\u6389\u8fdb\u7a0b</li> <li>am_anr: \u4f4d\u4e8eAMS.appNotResponding \uff0c\u53ef\u4ee5\u6839\u636e\u65f6\u95f4\u6233\uff0c\u627e\u5230anr\u6587\u4ef6\u5939\u4e0b\u5bf9\u5e94\u7684trace\u6587\u4ef6</li> <li>am_crash:\u4f4d\u4e8eAMS.handleApplicationCrashInner</li> <li>am_wtf:\u4f4d\u4e8eAMS.handleApplicationWtf</li> <li>am_activity_launch_time\uff1a\u4f4d\u4e8eActivityRecord.reportLaunchTimeLocked()\uff0c\u540e\u9762\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u662fthisTime\u548c totalTime.</li> <li>am_activity_fully_drawn_time:\u4f4d\u4e8eActivityRecord.reportFullyDrawnLocked, \u540e\u9762\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u662fthisTime\u548c totalTime</li> </ul> <p>\u8be6\u7ec6\u53c2\u89c1Android EventLog\u542b\u4e49</p>"},{"location":"perf-opt/Android/anr/anr_trace/#23","title":"2.3 \u5806\u6808\u6d88\u606f","text":"<p>\u5806\u6808\u4fe1\u606f\u662f\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u4fe1\u606f\uff0c\u5c55\u793a\u4e86ANR\u53d1\u751f\u7684\u8fdb\u7a0b\u5f53\u524d\u6240\u6709\u7ebf\u7a0b\u7684\u72b6\u6001\u3002</p> <pre><code>suspend all histogram:  Sum: 2.834s 99% C.I. 5.738us-7145.919us Avg: 607.155us Max: 41543us\nDALVIK THREADS (248):\n\"Signal Catcher\" daemon prio=5 tid=4 Runnable\n  | group=\"system\" sCount=0 dsCount=0 flags=0 obj=0x18c84570 self=0x7252417800\n  | sysTid=7772 nice=0 cgrp=default sched=0/0 handle=0x725354ad50\n  | state=R schedstat=( 16273959 1085938 5 ) utm=0 stm=1 core=4 HZ=100\n| stack=0x7253454000-0x7253456000 stackSize=991KB\n  | held mutexes= \"mutator lock\"(shared held)\nnative: #00 pc 000000000042f8e8  /apex/com.android.runtime/lib64/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, int, BacktraceMap*, char const*, art::ArtMethod*, void*, bool)+140)\nnative: #01 pc 0000000000523590  /apex/com.android.runtime/lib64/libart.so (art::Thread::DumpStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool, BacktraceMap*, bool) const+508)\nnative: #02 pc 000000000053e75c  /apex/com.android.runtime/lib64/libart.so (art::DumpCheckpoint::Run(art::Thread*)+844)\nnative: #03 pc 000000000053735c  /apex/com.android.runtime/lib64/libart.so (art::ThreadList::RunCheckpoint(art::Closure*, art::Closure*)+504)\nnative: #04 pc 0000000000536744  /apex/com.android.runtime/lib64/libart.so (art::ThreadList::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool)+1048)\nnative: #05 pc 0000000000536228  /apex/com.android.runtime/lib64/libart.so (art::ThreadList::DumpForSigQuit(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;)+884)\nnative: #06 pc 00000000004ee4d8  /apex/com.android.runtime/lib64/libart.so (art::Runtime::DumpForSigQuit(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;)+196)\nnative: #07 pc 000000000050250c  /apex/com.android.runtime/lib64/libart.so (art::SignalCatcher::HandleSigQuit()+1356)\nnative: #08 pc 0000000000501558  /apex/com.android.runtime/lib64/libart.so (art::SignalCatcher::Run(void*)+268)\nnative: #09 pc 00000000000cf7c0  /apex/com.android.runtime/lib64/bionic/libc.so (__pthread_start(void*)+36)\nnative: #10 pc 00000000000721a8  /apex/com.android.runtime/lib64/bionic/libc.so (__start_thread+64)\n(no managed stack frames)\n\"main\" prio=5 tid=1 Sleeping\n  | group=\"main\" sCount=1 dsCount=0 flags=1 obj=0x73907540 self=0x725f010800\n  | sysTid=7761 nice=-10 cgrp=default sched=1073741825/2 handle=0x72e60080d0\n  | state=S schedstat=( 281909898 5919799 311 ) utm=20 stm=7 core=4 HZ=100\n| stack=0x7fca180000-0x7fca182000 stackSize=8192KB\n  | held mutexes=\nat java.lang.Thread.sleep(Native method)\n- sleeping on &lt;0x00f895d9&gt; (a java.lang.Object)\nat java.lang.Thread.sleep(Thread.java:443)\n- locked &lt;0x00f895d9&gt; (a java.lang.Object)\nat java.lang.Thread.sleep(Thread.java:359)\nat android.os.SystemClock.sleep(SystemClock.java:131)\nat com.xfhy.watchsignaldemo.MainActivity.makeAnr(MainActivity.kt:35)\nat java.lang.reflect.Method.invoke(Native method)\nat androidx.appcompat.app.AppCompatViewInflater$DeclaredOnClickListener.onClick(AppCompatViewInflater.java:441)\nat android.view.View.performClick(View.java:7317)\nat com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1219)\nat android.view.View.performClickInternal(View.java:7291)\nat android.view.View.access$3600(View.java:838)\nat android.view.View$PerformClick.run(View.java:28247)\nat android.os.Handler.handleCallback(Handler.java:900)\nat android.os.Handler.dispatchMessage(Handler.java:103)\nat android.os.Looper.loop(Looper.java:219)\nat android.app.ActivityThread.main(ActivityThread.java:8668)\nat java.lang.reflect.Method.invoke(Native method)\nat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:513)\nat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1109)\n... //\u6b64\u5904\u7701\u7565\u5269\u4f59\u7684N\u4e2a\u7ebf\u7a0b\n</code></pre>"},{"location":"perf-opt/Android/anr/anr_trace/#231","title":"2.3.1. \u53c2\u6570\u89e3\u8bfb","text":"<pre><code>\"Signal Catcher\" daemon prio=5 tid=4 Runnable\n| group=\"system\" sCount=0 dsCount=0 flags=0 obj=0x18c84570 self=0x7252417800\n| sysTid=7772 nice=0 cgrp=default sched=0/0 handle=0x725354ad50\n| state=R schedstat=( 16273959 1085938 5 ) utm=0 stm=1 core=4 HZ=100\n| stack=0x7253454000-0x7253456000 stackSize=991KB\n| held mutexes= \"mutator lock\"(shared held)\n</code></pre> <p>\u7b2c1\u884c\uff1a</p> <pre><code>\"Signal Catcher\" daemon prio=5 tid=4 Runnable\n</code></pre> <ul> <li> <p>\"Signal Catcher\" daemon \uff1a \u7ebf\u7a0b\u540d\uff0c\u6709daemon\u8868\u793a\u5b88\u62a4\u7ebf\u7a0b</p> </li> <li> <p>prio\uff1a\u7ebf\u7a0b\u4f18\u5148\u7ea7</p> </li> <li> <p>tid\uff1a\u7ebf\u7a0b\u5185\u90e8id</p> </li> <li> <p>\u7ebf\u7a0b\u72b6\u6001\uff1aRunnable</p> </li> </ul> <p>\u4e0b\u56fe\u4e3a\u7ebf\u7a0b\u72b6\u6001\u5bf9\u5e94\u5173\u7cfb\u8868\u3002</p> <p></p> <p>\u4e00\u822c\u6765\u8bf4\uff1amain\u7ebf\u7a0b\u5904\u4e8e BLOCK\u3001WAITING\u3001TIMEWAITING\u72b6\u6001\uff0c\u90a3\u57fa\u672c\u4e0a\u662f\u51fd\u6570\u963b\u585e\u5bfc\u81f4ANR\uff1b</p> <p>\u5982\u679cmain\u7ebf\u7a0b\u65e0\u5f02\u5e38\uff0c\u5219\u5e94\u8be5\u6392\u67e5CPU\u8d1f\u8f7d\u548c\u5185\u5b58\u73af\u5883\u3002</p> <p>\u7b2c2\u884c\uff1a</p> <pre><code>| group=\"system\" sCount=0 dsCount=0 flags=0 obj=0x18c84570 self=0x7252417800\n</code></pre> <ul> <li>group\uff1a\u7ebf\u7a0b\u6240\u5c5e\u7684\u7ebf\u7a0b\u7ec4</li> <li>sCount\uff1a\u7ebf\u7a0b\u6302\u8d77\u6b21\u6570</li> <li>dsCount\uff1a\u7528\u4e8e\u8c03\u8bd5\u7684\u7ebf\u7a0b\u6302\u8d77\u6b21\u6570</li> <li>obj\uff1a\u5f53\u524d\u7ebf\u7a0b\u5173\u8054\u7684Java\u7ebf\u7a0b\u5bf9\u8c61</li> <li>self\uff1a\u5f53\u524d\u7ebf\u7a0b\u5730\u5740</li> </ul> <p>\u7b2c3\u884c\uff1a</p> <pre><code>| sysTid=7772 nice=0 cgrp=default sched=0/0 handle=0x725354ad50\n</code></pre> <ul> <li>sysTid\uff1a\u7ebf\u7a0b\u771f\u6b63\u610f\u4e49\u4e0a\u7684tid</li> <li>nice\uff1a\u8c03\u5ea6\u4f18\u5148\u7ea7\uff0cnice\u7684\u53d6\u503c\u8303\u56f4\u4e3a-20\u523019\u3002\u901a\u5e38\u6765\u8bf4nice\u7684\u503c\u8d8a\u5927\uff0c\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u5c31\u8d8a\u4f4e\uff0c\u83b7\u5f97CPU\u8c03\u7528\u7684\u673a\u4f1a\u8d8a\u5c11\uff0cnice\u503c\u8d8a\u5c0f\uff0c\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u5219\u8d8a\u9ad8\uff0c\u83b7\u5f97CPU\u8c03\u7528\u7684\u673a\u4f1a\u8d8a\u591a\u3002</li> <li>cgrp\uff1a\u8fdb\u7a0b\u6240\u5c5e\u7684\u8fdb\u7a0b\u8c03\u5ea6\u7ec4</li> <li>sched\uff1a\u8c03\u5ea6\u7b56\u7565</li> <li>handle\uff1a\u51fd\u6570\u5904\u7406\u5730\u5740</li> </ul> <p>\u7b2c4\u884c\uff1a</p> <pre><code>| state=R schedstat=( 16273959 1085938 5 ) utm=0 stm=1 core=4 HZ=100\n</code></pre> <ul> <li>state\uff1a\u7ebf\u7a0b\u72b6\u6001</li> <li>schedstat\uff1aCPU\u8c03\u5ea6\u65f6\u95f4\u7edf\u8ba1\uff08schedstat\u62ec\u53f7\u4e2d\u76843\u4e2a\u6570\u5b57\u4f9d\u6b21\u662fRunning\u3001Runable\u3001Switch\uff0cRunning\u65f6\u95f4\uff1aCPU\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4dns\uff0cRunable\u65f6\u95f4\uff1aRQ\u961f\u5217\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4dns\uff0cSwitch\u6b21\u6570\uff1aCPU\u8c03\u5ea6\u5207\u6362\u6b21\u6570\uff09</li> <li>utm/stm\uff1a\u7528\u6237\u6001/\u5185\u6838\u6001\u7684CPU\u65f6\u95f4\uff0c\u7ebf\u7a0b\u7684cpu\u8017\u65f6\u662f\u4e24\u8005\u76f8\u52a0(utm+stm)\uff0cutm,stm \u5355\u4f4d\u6362\u7b97\u6210\u65f6\u95f4\u5355\u4f4d\u4e3a 1 \u6bd4 10ms\u3002</li> <li>core\uff1a\u6570\u5b57\u8868\u793a\u7684\u8dd1\u5728\u54ea\u4e2a\u6838\u4e0a\uff0ccore=4\u8868\u793a\u6253\u5370\u8fd9\u6bb5\u65e5\u5fd7\u65f6\u8be5\u7ebf\u7a0b\u8dd1\u5728CPU4\u4e0a</li> <li>HZ\uff1a\u65f6\u949f\u9891\u7387</li> </ul> <p>\u7b2c5\u884c\uff1a</p> <pre><code>| stack=0x7253454000-0x7253456000 stackSize=991KB\n</code></pre> <ul> <li>stack\uff1a\u7ebf\u7a0b\u6808\u7684\u5730\u5740\u533a\u95f4</li> <li>stackSize\uff1a\u6808\u7684\u5927\u5c0f</li> </ul> <p>\u7b2c6\u884c\uff1a</p> <pre><code>| held mutexes= \"mutator lock\"(shared held)\n</code></pre> <ul> <li>mutex\uff1a\u6240\u6301\u6709mutex\u7c7b\u578b\uff0c\u6709\u72ec\u5360\u9501exclusive\u548c\u5171\u4eab\u9501shared\u4e24\u7c7b</li> </ul>"},{"location":"perf-opt/Android/anr/anr_trace/#24-anr","title":"2.4 ANR \u5206\u6790\u601d\u8def","text":""},{"location":"perf-opt/Android/anr/anr_trace/#anr_4","title":"ANR\u5206\u6790\u601d\u8def","text":"<ol> <li>\u67e5\u770b\u5bf9\u5e94Trace\u65e5\u5fd7<ol> <li>\u4e1a\u52a1\u5806\u6808\u8017\u65f6\uff08\u7ebf\u7a0b\u5904\u4e8erunnable\u4f46\u5806\u6808\u5bf9\u5e94\u8c03\u7528\u5f88\u8017\u65f6\uff09</li> <li>\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u9501\u6216\u8005\u53d1\u751f\u6b7b\u9501\uff08\u7ebf\u7a0b\u72b6\u6001\u5904\u4e8eblock/wait\uff09</li> <li>\u5982\u679c\u786e\u5b9a\u662f\u4e0a\u8ff0\u95ee\u9898\uff0c\u90a3\u606d\u559c\u4f60\uff0c\u89e3\u51b3\u65b9\u6848\u5f88\u7b80\u5355\uff0c\u5904\u7406\u8017\u65f6\u8c03\u7528\u6216\u8005\u5904\u7406\u9501\u7b49\u5f85/\u6b7b\u9501 \u95ee\u9898\u5373\u53ef</li> </ol> </li> <li> <p>\u4f46\u5982\u679c\u53d1\u73b0Trace\u5806\u6808\u5b8c\u5168\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff08nativePollOnce\uff09\u6216\u8005\u6ca1\u6709\u547d\u4e2d\u8017\u65f6\u5806\u6808\uff0c\u90a3\u4e48\u5f88\uf967\u5e78\uff0c\u5c31\u9700\u8981\u6269\u5927\u53c2\u8003\u9762\uff1b</p> <ol> <li> <p>\u5206\u6790cpuinfo \u4fe1\u606f\uff1a</p> <ol> <li>\u7cfb\u7edf\u8d1f\u8f7d(Load) \uff1a</li> </ol> <p></p> <p>\u5206\u522b\u4ee3\u8868 ANR \u53d1\u751f\u524d 1 \u5206\u949f\uff0c\u524d 5 \u5206\u949f\uff0c\u524d 15 \u5206\u949f\u5404\u4e2a\u65f6\u95f4\u6bb5\u7cfb\u7edf CPU \u8d1f\u8f7d\uff0c\u5177\u4f53\u6570\u503c\u4ee3\u8868\u5355\u4f4d\u65f6\u95f4\u7b49\u5f85\u7cfb\u7edf\u8c03\u5ea6\u7684\u4efb\u52a1\u6570(\u53ef\u4ee5\u7406\u89e3\u4e3a\u7ebf\u7a0b)\u3002\u5982\u679c\u8fd9\u4e2a\u6570\u503c\u8fc7\u9ad8\uff0c\u5219\u8868\u793a\u5f53\u524d\u7cfb\u7edf\u4e2d\u9762\u4e34 CPU \u6216 IO \u7ade\u4e89\uff0c\u6b64\u65f6\uff0c\u666e\u901a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u8c03\u5ea6\u5c06\u4f1a\u53d7\u5230\u5f71\u54cd\u3002</p> <ol> <li>\u8fdb\u7a0b CPU \u4f7f\u7528\u7387\uff1a</li> </ol> <p></p> <p>\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u5230\u54ea\u7c7b\u8fdb\u7a0bCPU\u504f\u9ad8\uff0c\u5982\u679c\u5b58\u5728\u660e\u663e\u504f\u9ad8\u7684\u8fdb\u7a0b\uff0c\u90a3\u4e48ANR\u548c\u6b64\u8fdb\u7a0b\u62a2\u5360CPU\u6709\u4e00\u5b9a\u5173\u7cfb\u3002\u5f53\u7136\uff0c\u5982\u53d1\u73b0<code>Kswapd</code>\uff0c<code>emmc</code>\u6216\u8005<code>mmcqd</code>\u8fdb\u7a0b\u4e5f\u5728top\u4e2d\uff0c\u5219\u8bf4\u660e\u9047\u5230\u7cfb\u7edf\u5185\u5b58\u538b\uf98a\u6216\u6587\u4ef6IO\u5f00\u9500\u3002</p> <ol> <li>\u7cfb\u7edf CPU \u5206\u5e03\uff1a</li> </ol> <p></p> <p>\u53cd\u6620\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u7cfb\u7edf\u6574\u4f53 CPU \u4f7f\u7528\u7387\uff0c\u4ee5\u53ca user\uff0ckernel\uff0ciowait \u65b9\u5411\u7684 CPU \u5360\u6bd4\uff0c\u5982\u679c\u53d1\u751f\u5927\u91cf\u6587\u4ef6\u8bfb\u5199\u6216\u5185\u5b58\u7d27\u5f20\u7684\u573a\u666f\uff0c\u5219 iowait \u5360\u6bd4\u8f83\u9ad8</p> <ol> <li>\u5bf9\u6bd4\u5404\u7ebf\u7a0b CPU \u5360\u6bd4\uff0c\u4ee5\u53ca\u7ebf\u7a0b\u5185\u90e8 user \u548c kernel \u5360\u6bd4</li> </ol> <p></p> <p>\u5728 Trace \u65e5\u5fd7\u7684\u7ebf\u7a0b\u4fe1\u606f\u91cc\u4e5f\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u5230\u6bcf\u4e2a\u7ebf\u7a0b\u7684 utm\uff0cstm \u8017\u65f6</p> <p></p> </li> <li> <p>\u5206\u6790syslog\u4fe1\u606f\uff1a</p> <ol> <li>\u5206\u6790\u7ebf\u7a0b\u548c\u53e5\u67c4 \u5148\u770b\u7ebf\u7a0b\u6570\u548c\u53e5\u67c4\u6570\u662f\u5426\u6709\u5f02\u5e38\uff0c\u5982\u679c\u6709\u5f02\u5e38\uff0c\u518d\u770b\u4e0b\u662f\u5426\u6709\u660e\u663e\u5927\u91cf\u91cd\u590d\u7ebf\u7a0b\u548c\u53e5\u67c4</li> <li>\u5206\u6790meminfo\u4fe1\u606f \u7cfb\u7edf\u662f\u5426\u662f\u4f4e\u5185\u5b58\u673a\u5668/\u5904\u4e8e\u4f4e\u53ef\u7528\u5185\u5b58\u72b6\u6001</li> <li>\u5206\u6790logcat\u65e5\u5fd7\uff08system\u3001event\u3001main\uff09 \u641c\u7d22\u5173\u952e\u5b57<code>onTrimMemory</code>\u3001<code>am_low_memory\u6216\u8005lowmemorykiller</code>, <code>slow_operation</code>\uff0c<code>Kwork</code>\uff0c\u5224\u65ad\u5f53\u524d\u7cfb\u7edf\u662f\u5426\u5b58\u5728\u8d44\u6e90(CPU\uff0cMem\uff0cIO)\u7d27\u5f20\u7684\u60c5\u51b5\uff0c\u53e6\u5916\u4e5f\u53ef\u4ee5\u641c\u7d22<code>binder_sample</code>\u67e5\u770b\u4e3b\u7ebf\u7a0b\u7684binder\u8c03\u7528\u8017\u65f6\uff0c <code>binder starved</code>\u67e5\u770bbinder\u901a\u4fe1\u662f\u5426\u5904\u4e8e\u9965\u997f\u72b6\u6001,,<code>dvm_lock_sample</code>\u67e5\u770b\u540c\u6b65\u9501\u7ade\u4e89\u8bb0\u5f55</li> </ol> </li> </ol> </li> </ol>"},{"location":"perf-opt/Android/anr/anr_trace/#_1","title":"\u7591\u96be\u53c2\u6570\u89e3\u91ca","text":"<ul> <li>dvm_lock_sample\uff1a\u5728\u540c\u6b65\u9501\u53d1\u751fcontent\u7684\u65f6\u5019\uff0c\u865a\u62df\u673a\u4f1a\u5c06\u8fd9\u4e2a\u7ade\u4e89\u8bb0\u5f55\u5728eventlog\u4e2d, \u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003<code>art/runtime/monitor_android.cc#LogContentionEvent</code>\u51fd\u6570<ul> <li>log\u683c\u5f0f: <code>dvm_lock_sample (process|3),(main|1|5),(thread|3),(time|1|3),(file|3),(line|1|5),(ownerfile|3),(ownerline|1|5),(sample_percent|1|6)</code></li> <li>log\u89e3\u91ca\uff1a <code>\u6240\u5c5e\u8fdb\u7a0b\uff0c\u662f\u5426\u4e3a\u4e3b\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u540d\uff0c\u83b7\u53d6\u9501\u6240\u7528\u7684\u65f6\u95f4\uff0c\u83b7\u53d6\u9501\u4ee3\u7801\u6240\u5728\u7684\u6e90\u6587\u4ef6\uff0c\u884c\u53f7\uff0c\u9501\u88ab\u5360\u6709\u7684\u4ee3\u7801\u6240\u5728\u7684\u6e90\u6587\u4ef6\uff08\u5982\u679c\u4e0efile\u76f8\u540c\uff0c\u7528\"-\"\u8868\u793a\uff09\uff0c\u884c\u53f7\uff0c\u7b49\u5f85\u767e\u5206\u6bd4</code></li> <li>\u793a\u4f8b <pre><code>dvm_lock_sample: [com.yy.hiyo,1,main,516,,-1,net.ihago.base.srv.splash.UserSplashConfig com.yy.hiyo.module.splash.SplashManager.getWillLoadSplashData(),-,-1,void com.yy.hiyo.module.splash.SplashManager.readLocalData(),100]\n\u542b\u4e49\uff1a com.yy.hiyo\u8fdb\u7a0b\uff0c\u4e3b\u7ebf\u7a0b\u6267\u884c\u5230SplashManager.getWillLoadSplashData()\u65f6\uff0c\u7b49\u5f85\u76f8\u540c\u6587\u4ef6\u91cc\u9762\u7684SplashManager.readLocalData()\u6301\u6709\u7684\u9501\uff0c\u963b\u585e\u4e86516ms\n</code></pre></li> </ul> </li> <li> <p>binder_sample \uff1a\u76d1\u63a7\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u4e3b\u7ebf\u7a0b\u7684binde\u8c03\u7528\u7684\u8017\u65f6\u60c5\u51b5,\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003<code>frameworks/base/core/jni/android_util_Binder.cpp#conditionally_log_binder_call</code>\u51fd\u6570</p> <ul> <li>log \u683c\u5f0f\uff1a <code>binder_sample (descriptor|3),(method_num|1|5),(time|1|3),(blocking_package|3),(sample_percent|1|6)</code></li> <li>log \u89e3\u91ca\uff1a</li> </ul> \u53c2\u6570 \u610f\u4e49 \u5907\u6ce8 <code>descriptor</code> \u63a5\u53e3\u63cf\u8ff0\u7b26\uff0c\u8868\u793a\u88ab\u5361\u4f4f\u7684binder\u8c03\u7528\u5bf9\u5e94\u7684interface\u63a5\u53e3 \u4efb\u4f55\u4e00\u4e2abinder\u90fd\u5b9e\u73b0\u4e00\u4e2a\u63a5\u53e3\uff0cIPC\u8c03\u7528\u7528\u7684API\uff0c\u4efb\u4f55\u4e00\u4e2a\u63a5\u53e3\u90fd\u6709\u4e00\u4e2a\u63cf\u8ff0\u7b26\uff0c\u5373\u4e00\u4e2a\u5b57\u7b26\u4e32 <code>method_num</code> \u8c03\u7528\u65b9\u6cd5\u7684\u5e8f\u5217\u53f7 <code>time</code> \u8be5\u65b9\u6cd5\u8c03\u7528\u8017\u7528\u7684\u65f6\u95f4 <code>blocking_package</code> \u4ece\u54ea\u4e2a\u8fdb\u7a0b\u53d1\u8d77\u7684\u8c03\u7528 <code>sample_percent</code> \u88ab\u5361\u4f4f\u7684\u767e\u5206\u6bd4 \u6682\u65f6\u4e0d\u5173\u6ce8 <ul> <li>\u793a\u4f8b\uff1a <pre><code>I/binder_sample(  520):[com.android.internal.telephony.ITelephonyRegistry,7,12518,com.android.phone,100]\n\u542b\u4e49\uff1a\u4ececom.android.phone\u4e3b\u7ebf\u7a0b\u53d1\u8d77\u4e86\u4e00\u4e2aITelephonyRegistry\u63a5\u53e3\u7684\u7b2c7\u4e2a\u65b9\u6cd5\u7684binder\u8c03\u7528\uff0c\u8017\u65f612s\u3002\n</code></pre></li> </ul> </li> <li> <p>binder starved\uff1a\u5f53system_server\u7b49\u8fdb\u7a0b\u7684\u7ebf\u7a0b\u6c60\u4f7f\u7528\u5b8c, \u65e0\u7a7a\u95f2\u7ebf\u7a0b\u65f6, \u5219binder\u901a\u4fe1\u90fd\u5904\u4e8e\u9965\u997f\u72b6\u6001, \u5219\u9965\u997f\u72b6\u6001\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\u5219\u8f93\u51fa\u4fe1\u606f;</p> <ul> <li>\u793a\u4f8b   <pre><code>1232 1232 \"binder thread pool (16 threads) starved for 100 ms\"\n\u542b\u4e49\uff1asystem_server\u8fdb\u7a0b\u7684 \u7ebf\u7a0b\u6c60\u5df2\u6ee1\u7684\u6301\u7eed\u957f\u8fbe100ms\n</code></pre></li> </ul> </li> <li> <p>kswapd </p> </li> </ul> <p>\u662f linux \u4e2d\u7528\u4e8e\u9875\u9762\u56de\u6536\u7684\u5185\u6838\u7ebf\u7a0b\uff0c\u4e3b\u8981\u7528\u6765\u7ef4\u62a4\u53ef\u7528\u5185\u5b58\u4e0e\u6587\u4ef6\u7f13\u5b58\u7684\u5e73\u8861\uff0c\u4ee5\u8ffd\u6c42\u6027\u80fd\u6700\u5927\u5316\uff0c\u5f53\u8be5\u7ebf\u7a0b CPU \u5360\u7528\u8fc7\u9ad8\uff0c\u8bf4\u660e\u7cfb\u7edf\u53ef\u7528\u5185\u5b58\u7d27\u5f20\uff0c\u6216\u8005\u5185\u5b58\u788e\u7247\u5316\u4e25\u91cd\uff0c\u9700\u8981\u8fdb\u884c file cache \u56de\u5199\u6216\u8005\u5185\u5b58\u4ea4\u6362(\u4ea4\u6362\u5230\u78c1\u76d8)\uff0c\u7ebf\u7a0b CPU \u8fc7\u9ad8\u5219\u7cfb\u7edf\u6574\u4f53\u6027\u80fd\u5c06\u4f1a\u660e\u663e\u4e0b\u964d\uff0c\u8fdb\u800c\u5f71\u54cd\u6240\u6709\u5e94\u7528\u8c03\u5ea6\u3002</p> <ul> <li>mmcqd </li> </ul> <p>\u5185\u6838\u7ebf\u7a0b\uff0c\u4e3b\u8981\u4f5c\u7528\u662f\u628a\u4e0a\u5c42\u7684 IO \u8bf7\u6c42\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\u548c\u8f6c\u53d1\u5230 Driver \u5c42\uff0c\u5f53\u8be5\u7ebf\u7a0b CPU \u5360\u7528\u8fc7\u9ad8\uff0c\u8bf4\u660e\u7cfb\u7edf\u5b58\u5728\u5927\u91cf\u6587\u4ef6\u8bfb\u5199\uff0c\u5f53\u7136\u5982\u679c\u5185\u5b58\u7d27\u5f20\u4e5f\u4f1a\u89e6\u53d1\u6587\u4ef6\u56de\u5199\u548c\u5185\u5b58\u4ea4\u6362\u5230\u78c1\u76d8\uff0c\u6240\u4ee5 kswapd \u548c mmcqd \u7ecf\u5e38\u662f\u540c\u6b65\u51fa\u73b0\u7684\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#3-anr","title":"3. ANR \u6848\u4f8b\u5206\u6790","text":""},{"location":"perf-opt/Android/anr/anr_trace/#31","title":"3.1 \u4e3b\u7ebf\u7a0b\u8017\u65f6","text":"<pre><code>\"main\" prio=5 tid=1 Runnable\n| group=\"main\" sCount=0 dsCount=0 flags=0 obj=0x72deb848 self=0x7748c10800\n| sysTid=8968 nice=-10 cgrp=default sched=0/0 handle=0x77cfa75ed0\n| state=R schedstat=( 24783612979 48520902 756 ) utm=2473 stm=5 core=5 HZ=100\n| stack=0x7fce68b000-0x7fce68d000 stackSize=8192KB\n| held mutexes= \"mutator lock\"(shared held)\nat com.example.test.MainActivity$onCreate$2.onClick(MainActivity.kt:20)\u2014\u2014\u5173\u952e\u884c\uff01\uff01\uff01\nat android.view.View.performClick(View.java:7187)\nat android.view.View.performClickInternal(View.java:7164)\nat android.view.View.access$3500(View.java:813)\nat android.view.View$PerformClick.run(View.java:27640)\nat android.os.Handler.handleCallback(Handler.java:883)\nat android.os.Handler.dispatchMessage(Handler.java:100)\nat android.os.Looper.loop(Looper.java:230)\nat android.app.ActivityThread.main(ActivityThread.java:7725)\nat java.lang.reflect.Method.invoke(Native method)\nat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:526)\nat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1034)\n</code></pre> <p>\u4e0a\u8ff0\u65e5\u5fd7\u8868\u660e\uff0c\u4e3b\u7ebf\u7a0b\u6b63\u5904\u4e8e\u6267\u884c\u72b6\u6001\uff0c\u770b\u5806\u6808\u4fe1\u606f\u53ef\u77e5\u4e0d\u662f\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff0c\u53d1\u751fANR\u53ef\u80fd\u662f\u56e0\u4e3a\u4e00\u5904click\u76d1\u542c\u51fd\u6570\u91cc\u6267\u884c\u4e86\u8017\u65f6\u64cd\u4f5c\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#32","title":"3.2 \u4e3b\u7ebf\u7a0b\u65e0\u5361\u987f\uff0c\u5904\u4e8e\u6b63\u5e38\u72b6\u6001\u5806\u6808","text":"<pre><code>\"main\" prio=5 tid=1 Native\n| group=\"main\" sCount=1 dsCount=0 flags=1 obj=0x74b38080 self=0x7ad9014c00\n| sysTid=23081 nice=0 cgrp=default sched=0/0 handle=0x7b5fdc5548\n| state=S schedstat=( 284838633 166738594 505 ) utm=21 stm=7 core=1 HZ=100\n| stack=0x7fc95da000-0x7fc95dc000 stackSize=8MB\n| held mutexes=\nkernel: __switch_to+0xb0/0xbc\nkernel: SyS_epoll_wait+0x288/0x364\nkernel: SyS_epoll_pwait+0xb0/0x124\nkernel: cpu_switch_to+0x38c/0x2258\nnative: #00 pc 000000000007cd8c  /system/lib64/libc.so (__epoll_pwait+8)\nnative: #01 pc 0000000000014d48  /system/lib64/libutils.so (android::Looper::pollInner(int)+148)\nnative: #02 pc 0000000000014c18  /system/lib64/libutils.so (android::Looper::pollOnce(int, int*, int*, void**)+60)\nnative: #03 pc 00000000001275f4  /system/lib64/libandroid_runtime.so (android::android_os_MessageQueue_nativePollOnce(_JNIEnv*, _jobject*, long, int)+44)\nat android.os.MessageQueue.nativePollOnce(Native method)\nat android.os.MessageQueue.next(MessageQueue.java:330)\nat android.os.Looper.loop(Looper.java:169)\nat android.app.ActivityThread.main(ActivityThread.java:7073)\nat java.lang.reflect.Method.invoke(Native method)\nat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:536)\nat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:876)\n</code></pre> <p>\u6bd4\u5982\u8fd9\u4e2a\u4e3b\u7ebf\u7a0b\u5806\u6808\uff0c\u770b\u8d77\u6765\u5f88\u6b63\u5e38\uff0c\u4e3b\u7ebf\u7a0b\u662f\u7a7a\u95f2\u7684\uff0c\u56e0\u4e3a\u5b83\u6b63\u5904\u4e8enativePollOnce\uff0c\u6b63\u5728\u7b49\u5f85\u65b0\u6d88\u606f\u3002\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\uff0c\u90a3\u8fd8\u53d1\u751f\u4e86ANR\uff0c\u53ef\u80fd\u67092\u4e2a\u539f\u56e0\uff1a</p> <ol> <li>dump\u5806\u6808\u65f6\u673a\u592a\u665a\u4e86\uff0cANR\u5df2\u7ecf\u53d1\u751f\u8fc7\u4e86\uff0c\u624d\u53bbdump\u5806\u6808\uff0c\u6b64\u65f6\u4e3b\u7ebf\u7a0b\u5df2\u7ecf\u6062\u590d\u6b63\u5e38\u4e86</li> <li>CPU\u62a2\u5360\u6216\u8005\u5185\u5b58\u7d27\u5f20\u7b49\u5176\u4ed6\u56e0\u7d20\u5f15\u8d77</li> </ol> <p>\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u8981\u5148\u53bb\u5206\u6790CPU\u3001\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\u3002\u5176\u6b21\u53ef\u4ee5\u5173\u6ce8\u6293\u53d6\u65e5\u5fd7\u7684\u65f6\u95f4\u548cANR\u53d1\u751f\u7684\u65f6\u95f4\u662f\u5426\u76f8\u9694\u592a\u4e45\uff0c\u65f6\u95f4\u592a\u4e45\u8fd9\u4e2a\u5806\u6808\u5c31\u6ca1\u6709\u5206\u6790\u7684\u610f\u4e49\u4e86\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#33","title":"3.3 \u4e3b\u7ebf\u7a0b\u88ab\u9501\u963b\u585e","text":"<pre><code>\"main\" prio=5 tid=1 Blocked\n| group=\"main\" sCount=1 dsCount=0 flags=1 obj=0x72deb848 self=0x7748c10800\n| sysTid=22838 nice=-10 cgrp=default sched=0/0 handle=0x77cfa75ed0\n| state=S schedstat=( 390366023 28399376 279 ) utm=34 stm=5 core=1 HZ=100\n| stack=0x7fce68b000-0x7fce68d000 stackSize=8192KB\n| held mutexes=\nat com.example.test.MainActivity$onCreate$1.onClick(MainActivity.kt:15)\n- waiting to lock &lt;0x01aed1da&gt; (a java.lang.Object) held by thread 3 \u2014\u2014\u2014\u2014\u2014\u2014\u5173\u952e\u884c\uff01\uff01\uff01\nat android.view.View.performClick(View.java:7187)\nat android.view.View.performClickInternal(View.java:7164)\nat android.view.View.access$3500(View.java:813)\nat android.view.View$PerformClick.run(View.java:27640)\nat android.os.Handler.handleCallback(Handler.java:883)\nat android.os.Handler.dispatchMessage(Handler.java:100)\nat android.os.Looper.loop(Looper.java:230)\nat android.app.ActivityThread.main(ActivityThread.java:7725)\nat java.lang.reflect.Method.invoke(Native method)\nat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:526)\nat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1034)\n........\u7701\u7565N\u884c.....\n\"WQW TEST\" prio=5 tid=3 TimeWating\n| group=\"main\" sCount=1 dsCount=0 flags=1 obj=0x12c44230 self=0x772f0ec000\n| sysTid=22938 nice=0 cgrp=default sched=0/0 handle=0x77391fbd50\n| state=S schedstat=( 274896 0 1 ) utm=0 stm=0 core=1 HZ=100\n| stack=0x77390f9000-0x77390fb000 stackSize=1039KB\n| held mutexes=\nat java.lang.Thread.sleep(Native method)\n- sleeping on &lt;0x043831a6&gt; (a java.lang.Object)\nat java.lang.Thread.sleep(Thread.java:440)\n- locked &lt;0x043831a6&gt; (a java.lang.Object)\nat java.lang.Thread.sleep(Thread.java:356)\nat com.example.test.MainActivity$onCreate$2$thread$1.run(MainActivity.kt:22)\n- locked &lt;0x01aed1da&gt; (a java.lang.Object)\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u5173\u952e\u884c\uff01\uff01\uff01\nat java.lang.Thread.run(Thread.java:919)\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a\u5178\u578b\u7684\u4e3b\u7ebf\u7a0b\u88ab\u9501\u963b\u585e\u7684\u4f8b\u5b50\uff1b</p> <pre><code>waiting to lock &lt;0x01aed1da&gt; (a java.lang.Object) held by thread 3\n</code></pre> <p>\u5176\u4e2d\u7b49\u5f85\u7684\u9501\u662f<code>&lt;0x01aed1da&gt;</code>\uff0c\u8fd9\u4e2a\u9501\u7684\u6301\u6709\u8005\u662f\u7ebf\u7a0b 3\u3002\u8fdb\u4e00\u6b65\u641c\u7d22 \u201ctid=3\u201d \u627e\u5230\u7ebf\u7a0b3\uff0c \u53d1\u73b0\u5b83\u6b63\u5728TimeWating\u3002</p> <p>\u90a3\u4e48ANR\u7684\u539f\u56e0\u627e\u5230\u4e86\uff1a\u7ebf\u7a0b3\u6301\u6709\u4e86\u4e00\u628a\u9501\uff0c\u5e76\u4e14\u81ea\u8eab\u957f\u65f6\u95f4\u4e0d\u91ca\u653e\uff0c\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u8fd9\u628a\u9501\u53d1\u751f\u8d85\u65f6\u3002\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\uff0c\u5e38\u89c1\u56e0\u9501\u800cANR\u7684\u573a\u666f\u662f SharePreference\u5199\u5165\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#34-cpu","title":"3.4  CPU\u88ab\u62a2\u5360","text":"<pre><code>CPU usage from 0ms to 10625ms later (2020-03-09 14:38:31.633 to 2020-03-09 14:38:42.257):\n543% 2045/com.alibaba.android.rimet: 54% user + 89% kernel / faults: 4608 minor 1 major \u2014\u2014\u2014\u2014\u5173\u952e\u884c\uff01\uff01\uff01\n99% 674/android.hardware.camera.provider@2.4-service: 81% user + 18% kernel / faults: 403 minor\n24% 32589/com.wang.test: 22% user + 1.4% kernel / faults: 7432 minor 1 major\n........\u7701\u7565N\u884c.....\n</code></pre> <p>\u5982\u4e0a\u65e5\u5fd7\uff0c\u7b2c\u4e8c\u884c\u662f\u9489\u9489\u7684\u8fdb\u7a0b\uff0c\u5360\u636eCPU\u9ad8\u8fbe543%\uff0c\u62a2\u5360\u4e86\u5927\u90e8\u5206CPU\u8d44\u6e90\uff0c\u56e0\u800c\u5bfc\u81f4\u53d1\u751fANR\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#35-anr","title":"3.5 \u5185\u5b58\u7d27\u5f20\u5bfc\u81f4ANR","text":"<p>\u5982\u679c\u6709\u4e00\u4efd\u65e5\u5fd7\uff0cCPU\u548c\u5806\u6808\u90fd\u5f88\u6b63\u5e38\uff0c\u4ecd\u65e7\u53d1\u751fANR\uff0c\u8003\u8651\u662f\u5185\u5b58\u7d27\u5f20\u3002</p> <p>\u4eceCPU\u7b2c\u4e00\u884c\u4fe1\u606f\u53ef\u4ee5\u53d1\u73b0\uff0cANR\u7684\u65f6\u95f4\u70b9\u662f<code>2020-10-31 22:38:58.468\u2014CPU usage from 0ms to 21752ms later (2020-10-31 22:38:58.468 to 2020-10-31 22:39:20.220)</code></p> <p>\u63a5\u7740\u53bb\u7cfb\u7edf\u65e5\u5fd7\u91cc\u641c\u7d22<code>am_meminfo</code>\u3001onTrimMemory\u6216\u8005<code>GC</code>\u4fe1\u606f\uff0c <code>am_meminfo</code>\u8981\u662f\u6ca1\u6709\u641c\u7d22\u5230\u53ef\u4ee5\u4ece<code>Eventlog</code>\u4e2d\u641c\u3002\u4ee5<code>onTrimMemory</code>\u4e3a\u4f8b\uff1a</p> <pre><code>10-31 22:37:19.749 20733 20733 E Runtime : onTrimMemory level:80,pid:com.xxx.xxx:Launcher0\n10-31 22:37:33.458 20733 20733 E Runtime : onTrimMemory level:80,pid:com.xxx.xxx:Launcher0\n10-31 22:38:00.153 20733 20733 E Runtime : onTrimMemory level:80,pid:com.xxx.xxx:Launcher0\n10-31 22:38:58.731 20733 20733 E Runtime : onTrimMemory level:80,pid:com.xxx.xxx:Launcher0\n10-31 22:39:02.816 20733 20733 E Runtime : onTrimMemory level:80,pid:com.xxx.xxx:Launcher\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u53d1\u751fANR\u7684\u65f6\u95f4\u70b9\u524d\u540e\uff0c\u5185\u5b58\u90fd\u5904\u4e8e\u7d27\u5f20\u72b6\u6001\uff0clevel\u7b49\u7ea7\u662f80\uff0c\u67e5\u770bAndroid API \u6587\u6863\uff1b</p> <pre><code>/**\n    * Level for {@link #onTrimMemory(int)}: the process is nearing the end\n    * of the background LRU list, and if more memory isn't found soon it will\n    * be killed.\n    */\nstatic final int TRIM_MEMORY_COMPLETE = 80;\n</code></pre> <p>\u53ef\u77e580\u8fd9\u4e2a\u7b49\u7ea7\u662f\u5f88\u4e25\u91cd\u7684\uff0c\u5e94\u7528\u9a6c\u4e0a\u5c31\u8981\u88ab\u6740\u6b7b\uff0c\u88ab\u6740\u6b7b\u7684\u8fd9\u4e2a\u5e94\u7528\u4ece\u540d\u5b57\u53ef\u4ee5\u770b\u51fa\u6765\u662f\u684c\u9762\uff0c\u8fde\u684c\u9762\u90fd\u5feb\u8981\u88ab\u6740\u6b7b\uff0c\u90a3\u666e\u901a\u5e94\u7528\u80fd\u597d\u5230\u54ea\u91cc\u53bb\u5462\uff1f</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u53d1\u751f\u5185\u5b58\u7d27\u5f20\uff0c\u4f1a\u5bfc\u81f4\u591a\u4e2a\u5e94\u7528\u53d1\u751fANR\uff0c\u6240\u4ee5\u5728\u65e5\u5fd7\u4e2d\u5982\u679c\u53d1\u73b0\u6709\u591a\u4e2a\u5e94\u7528\u4e00\u8d77ANR\u4e86\uff0c\u53ef\u4ee5\u521d\u6b65\u5224\u5b9a\uff0c\u6b64ANR\u4e0e\u4f60\u7684\u5e94\u7528\u65e0\u5173\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#36-binderanr","title":"3.6 \u7cfb\u7edf\u670d\u52a1\u8d85\u65f6(Binder\u963b\u585e\u7b49\u5f85)\u5bfc\u81f4ANR","text":"<p>\u7cfb\u7edf\u670d\u52a1\u8d85\u65f6\u4e00\u822c\u4f1a\u5305\u542b BinderProxy.transactNative \u5173\u952e\u5b57\uff0c\u8bf7\u770b\u5982\u4e0b\u65e5\u5fd7\uff1a</p> <pre><code>\"main\" prio=5 tid=1 Native\n| group=\"main\" sCount=1 dsCount=0 obj=0x73ee6470 self=0xb4d76500\n| sysTid=22831 nice=0 cgrp=default sched=0/0 handle=0xb6f4bc00\n| state=S schedstat=( 0 0 0 ) utm=22 stm=22 core=0 HZ=100\n| stack=0xbe283000-0xbe285000 stackSize=8MB\n| held mutexes=\nnative: #00 pc 000410ac  /system/lib/libc.so (__ioctl+8)\nnative: #01 pc 000477e5  /system/lib/libc.so (ioctl+14)\nnative: #02 pc 0001e7c5  /system/lib/libbinder.so (android::IPCThreadState::talkWithDriver(bool)+132)\nnative: #03 pc 0001ee17  /system/lib/libbinder.so (android::IPCThreadState::waitForResponse(android::Parcel*, int*)+38)\nnative: #04 pc 0001efcd  /system/lib/libbinder.so (android::IPCThreadState::transact(int, unsigned int, android::Parcel const&amp;, android::Parcel*, unsigned int)+124)\nnative: #05 pc 00019fb7  /system/lib/libbinder.so (android::BpBinder::transact(unsigned int, android::Parcel const&amp;, android::Parcel*, unsigned int)+30)\nnative: #06 pc 00086de9  /system/lib/libandroid_runtime.so (???)\nnative: #07 pc 00d94629  /data/dalvik-cache/arm/system@framework@boot.oat (Java_android_os_BinderProxy_transactNative__ILandroid_os_Parcel_2Landroid_os_Parcel_2I+140)\nat android.os.BinderProxy.transactNative(Native method)\nat android.os.BinderProxy.transact(Binder.java:503)\nat android.net.INetworkPolicyManager$Stub$Proxy.getNetworkPolicies(INetworkPolicyManager.java:410)\nat android.net.NetworkPolicyManager.getNetworkPolicies(NetworkPolicyManager.java:174)\nat com.android.settings.net.NetworkPolicyEditor.read(NetworkPolicyEditor.java:57)\n........\u7701\u7565N\u884c.....\nat com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:762)\nat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:652)\n........\u7701\u7565N\u884c.....   \"Binder_4\" prio=5 tid=56 Blocked\n| group=\"main\" sCount=1 dsCount=0 obj=0x1321a0a0 self=0xad31e200\n| sysTid=2491 nice=0 cgrp=default sched=0/0 handle=0x9fd00930\n| state=S schedstat=( 0 0 0 ) utm=46441 stm=46582 core=1 HZ=100\n| stack=0x9fc04000-0x9fc06000 stackSize=1014KB\n| held mutexes=\nat com.android.server.net.NetworkPolicyManagerService.getNetworkPolicies(NetworkPolicyManagerService.java:1696)\n- waiting to lock &lt;0x07439315&gt; (a java.lang.Object) held by thread 35\nat android.net.INetworkPolicyManager$Stub.onTransact(INetworkPolicyManager.java:145)\nat android.os.Binder.execTransact(Binder.java:453\n........\u7701\u7565N\u884c.....   \"NetworkPolicy\" prio=5 tid=35 TimedWaiting\n| group=\"main\" sCount=1 dsCount=0 obj=0x12d98940 self=0x9f91f700\n| sysTid=2415 nice=0 cgrp=default sched=0/0 handle=0xa0f33930\n| state=S schedstat=( 0 0 0 ) utm=7681 stm=7783 core=0 HZ=100\n| stack=0xa0e31000-0xa0e33000 stackSize=1038KB\n| held mutexes=\nat java.lang.Object.wait!(Native method)\n- waiting on &lt;0x02580c1b&gt; (a java.lang.Object)\nat java.lang.Thread.parkFor$(Thread.java:1220)\n- locked &lt;0x02580c1b&gt; (a java.lang.Object)\nat sun.misc.Unsafe.park(Unsafe.java:299)\nat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\nat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2053)\nat java.util.concurrent.ArrayBlockingQueue.poll(ArrayBlockingQueue.java:372)\nat com.android.server.NativeDaemonConnector$ResponseQueue.remove(NativeDaemonConnector.java:634)\nat com.android.server.NativeDaemonConnector.executeForList(NativeDaemonConnector.java:426)\nat com.android.server.NativeDaemonConnector.execute(NativeDaemonConnector.java:345)\nat com.android.server.NativeDaemonConnector.execute(NativeDaemonConnector.java:340)\nat com.android.server.NetworkManagementService.setInterfaceQuota(NetworkManagementService.java:1712)\n- locked &lt;0x0b0f91b8&gt; (a java.lang.Object)\nat com.android.server.net.NetworkPolicyManagerService.setInterfaceQuota(NetworkPolicyManagerService.java:2421)\nat com.android.server.net.NetworkPolicyManagerService.updateNetworkRulesLocked(NetworkPolicyManagerService.java:1232)\nat com.android.server.net.NetworkPolicyManagerService$14.onReceive(NetworkPolicyManagerService.java:1060)\n- locked &lt;0x07439315&gt; (a java.lang.Object)\nat android.app.LoadedApk$ReceiverDispatcher$Args.run(LoadedApk.java:881)\nat android.os.Handler.handleCallback(Handler.java:739)\nat android.os.Handler.dispatchMessage(Handler.java:95)\nat android.os.Looper.loop(Looper.java:148)\nat android.os.HandlerThread.run(HandlerThread.java:61)\n</code></pre> <p>\u6211\u4eec\u5206\u6790\u4e0b\u4e0a\u9762\u5806\u6808\uff1a</p> <pre><code>  at android.os.BinderProxy.transactNative(Native method)\nat android.os.BinderProxy.transact(Binder.java:503)\nat android.net.INetworkPolicyManager$Stub$Proxy.getNetworkPolicies(INetworkPolicyManager.java:410)\n</code></pre> <p>\u4e3b\u7ebf\u7a0b\u88abBinder\u5bf9\u7aefblock\uff0c\u800c\u5bf9\u7aef\u662f\u5728systemserver\u4e2d\u7684NetworkPolicyManager\u3002</p> <p>\u63a5\u4e0b\u6765\u7ee7\u7eed\u53bb\u67e5NetworkPolicyManager\u4e3a\u4f55\u4f1a\u88abblock\u3002   \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u641c\u7d22getNetworkPolicies\uff0c\u4e00\u822c\u7684\u5bf9\u7aef\u7684\u51fd\u6570\u5e76\u4e0d\u4f1a\u4fee\u6539\u51fd\u6570\u540d\uff1a</p> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684\u5bf9\u7aef<code>Binder_4</code> \u88abTid=35\u7684\u4eba\u62ff\u4f4f\u4e86\u4e00\u628a\u9501<code>\uff080x07439315\uff09</code>\uff0c\u90a3\u4e48\u7ee7\u7eed\u770btid=35\u662f\u8c01\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a 1. \u641c\u7d22tid=35 2. \u641c\u7d220x07439315\uff0c\u627e\u5230  <code>- locked &lt;0x07439315&gt; (a java.lang.Object)</code></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c<code>NetworkPolicy\uff08tid=35</code>\uff09\u5728\u901a\u8fc7NativeDaemonConnector\u548cnetd\u901a\u4fe1\uff08setInterfaceQuota\uff09</p> <p>\u6211\u4eec\u7ed3\u5408log\u6765\u770b\u4e0b\u662f\u5426\u6709\u6709\u7528\u4fe1\u606f\uff0c\u6309\u7167\u4e4b\u524d\u7684\u7ecf\u9a8c\uff0cnetd\u5728\u6267\u884c\u5b8ccmd\u7684\u65f6\u5019\uff0c\u4f1a\u6253\u5370\u51fa<code>slow operation</code>\u3002   \u5728\u53d1\u751fANR\u7684\u524d\u540e\uff0c\u67e5\u627enetd\u76f8\u5173\u7684\u6253\u5370\uff1a</p> <pre><code>  06-19 15:29:00.997  1235  1270 I am_anr  : [0,22831,com.android.settings,818429509,Input dispatching timed out (Waiting because no window has focus but there is a focused application that may eventually add a window when it finishes starting up.)]\n06-19 15:29:05.683  1235  2415 E NetdConnector: NDC Command {55445 bandwidth setiquota seth_w0 9223372036854775807} took too long (4755ms\n  06-19 15:29:05.723  1235  2491 I dvm_lock_sample: [system_server,1,Binder_4,4919,NetworkPolicyManagerService.java,1696,-,1056,100]\n</code></pre> <p>\u4eceeventslog\u4e2d\u8fd8\u53ef\u4ee5\u53d1\u73b0\uff0csettings\u51fa\u73b0\u4e86\u4e24\u6b21\u8fde\u7eed\u7684ANR\uff0c\u800c\u4e0a\u4e0b\u6587\u4e2d\u90fd\u6709\u7c7b\u4f3c\u4e0a\u9762\u7684<code>dvm_lock_sample NetworkPolicyManagerService</code>\u76f8\u5173\u7684\u544a\u8b66\u3002   \u56e0\u6b64\u867d\u713615:28\u7684\u8fd9\u6b21ANR\u5e76\u6ca1\u6709\u6253\u51fa\u6709\u7528\u7684\u6808\uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u662f\u53ef\u4ee5\u731c\u6d4b\u51fa\u8fd9\u4e24\u6b21ANR\u7684\u539f\u56e0\u90fd\u662fnetd\u7684cmd\u8017\u65f6\u592a\u4e45\u5bfc\u81f4\u7684\uff08\u5728\u4e3b\u7ebf\u7a0b\u7684\u8c03\u7528\u8def\u5f84\u4e0a\u5b58\u5728\u5fc5\u7136\u7684block\uff09   \u90a3\u4e48\uff0c\u5728netd\u53ef\u80fd\u65e0\u6cd5\u4fee\u6539\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u53bbresolve\u8fd9\u4e2a\u95ee\u9898\u5462\u3002</p> <p>\u5c06\u53ef\u80fd\u5b58\u5728block\u7684\u64cd\u4f5c\u653e\u5230\u975eUI\u7ebf\u7a0b\u4e2d\u53bb\u505a\u3002</p> <p>NETD\u662fAndroid\u4e00\u4e2a\u4e13\u95e8\u7ba1\u7406\u7f51\u7edc\u94fe\u63a5, \u8def\u7531/\u5e26\u5bbd/\u9632\u706b\u5899\u7b56\u7565\u4ee5\u53caiptables\u7684\u7cfb\u7edfDaemon\u8fdb\u7a0b</p> <p>Eventlog\u4e2d\u7684dvm_lock_sample \uff1a\u5728\u540c\u6b65\u9501\u53d1\u751fcontent\u7684\u65f6\u5019\uff0c\u865a\u62df\u673a\u4f1a\u5c06\u8fd9\u4e2a\u7ade\u4e89\u8bb0\u5f55\u5728eventlog\u4e2d\uff1a</p> <pre><code> dvm_lock_sample: [system_server,1,Binder_7, 22, ActivityManagerService.java,15921,-,9628,4]\n</code></pre> <ul> <li>system_server: \u8fdb\u7a0b\u540d  </li> <li>Binder_7:\u88abblock\u7ebf\u7a0b</li> <li>22:block\u65f6\u95f4\uff08ms\uff09</li> <li>ActivityManagerService.java,15921: \u88abblock\u7684\u884c\u53f7</li> <li>9628: \u6301\u6709\u8005\u884c\u53f7                                                   </li> </ul> <p>\u5982\u679c\u4e3b\u7ebf\u7a0b\u662f\u88abbinder\u5bf9\u7aef\u3001\u88ab\u540c\u6b65\u9501block\uff0c\u90a3\u4e48eventlog\u4e2d\u5c31\u5f88\u6709\u53ef\u80fd\u4f1a\u6709dvm_lock_sample\u7684\u6253\u5370\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#37-binder","title":"3.7 Binder\u7ebf\u7a0b\u6c60\u8017\u5c3d","text":"<p>\u6211\u4eec\u77e5\u9053\u5e94\u7528\u6700\u591a\u652f\u630116\u4e2abinder \u7ebf\u7a0b\uff0cSystemServer\u652f\u6301\u6700\u591a32\u4e2abinder \u7ebf\u7a0b\u3002</p> <p>\u6211\u4eec\u5b9e\u9645\u9879\u76ee\u4e0a\uff0c\u4e0d\u65f6\u4f1a\u9047\u5230\u5bf9\u7aefBinder \u7ebf\u7a0b\u6c60\u8017\u5c3d\u5bfc\u81f4\u4e0d\u80fd\u54cd\u5e94\u7684\u6848\u4f8b\u3002</p> <p>\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0Binder \u6c60\u8017\u5c3d\u7684\u60c5\u51b5\u5462\uff1f</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8fdb\u7a0bA\u77ed\u65f6\u95f4\u5185\u53d1\u9001\u5f88\u591aBinder \u8bf7\u6c42\u7ed9\u8fdb\u7a0bB\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5728\u77ed\u65f6\u95f4\u5185\uff0c\u63a5\u6536\u7aef\u8fdb\u7a0bB\u7684Binder \u7ebf\u7a0b\u6c60\u4e2d\u768416\u4e2aBinder\u7ebf\u7a0b\uff0c\u90fd\u7528\u6765\u54cd\u5e94\u8fdb\u7a0bA\u7684Binder\u8bf7\u6c42\u3002</p> <p>\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684Binder\u7ebf\u7a0b\u6c60\u8017\u5c3d\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u8fdb\u7a0bB\u65e0\u6cd5\u5904\u7406\u8fdb\u7a0bA\u53d1\u8fc7\u6765\u7684\u65b0\u7684Binder\u8bf7\u6c42\u3002</p> <pre><code>\"main\" prio=5 tid=1 NATIVE | group=\"main\" sCount=1 dsCount=0 obj=0x4155acc0 self=0x414943f0\n| sysTid=3287 nice=-1 sched=0/0 cgrp=apps handle=1074065748\n| state=S schedstat=( 0 0 0 ) utm=1241 stm=340 core=0\n#00  pc 00021764  /system/lib/libc.so (epoll_wait+12)\n#01  pc 000105e3  /system/lib/libutils.so (android::Looper::pollInner(int)+94)\n#02  pc 00010811  /system/lib/libutils.so (android::Looper::pollOnce(int, int*, int*, void**)+92)\n#03  pc 0006b345  /system/lib/libandroid_runtime.so (android::NativeMessageQueue::pollOnce(_JNIEnv*, int)+22)\n#04  pc 0001e70c  /system/lib/libdvm.so (dvmPlatformInvoke+112)\n#05  pc 0004dc43  /system/lib/libdvm.so (dvmCallJNIMethod(unsigned int const*, JValue*, Method const*, Thread*)+398)\n#06  pc 00027778  /system/lib/libdvm.so\n#07  pc 0002e410  /system/lib/libdvm.so (dvmMterpStd(Thread*)+76)\n#08  pc 0002bac8  /system/lib/libdvm.so (dvmInterpret(Thread*, Method const*, JValue*)+156)\n#09  pc 00060259  /system/lib/libdvm.so (dvmInvokeMethod(Object*, Method const*, ArrayObject*, ArrayObject*, ClassObject*, bool)+392)\n#10  pc 000683eb  /system/lib/libdvm.so\n#11  pc 00027778  /system/lib/libdvm.so\n#12  pc 0002e410  /system/lib/libdvm.so (dvmMterpStd(Thread*)+76)\n#13  pc 0002bac8  /system/lib/libdvm.so (dvmInterpret(Thread*, Method const*, JValue*)+156)\n#14  pc 0005ff77  /system/lib/libdvm.so (dvmCallMethodV(Thread*, Method const*, Object*, bool, JValue*, std::__va_list)+338)\n#15  pc 0004982b  /system/lib/libdvm.so\n#16  pc 0004de13  /system/lib/libandroid_runtime.so\n#17  pc 0004ecdd  /system/lib/libandroid_runtime.so (android::AndroidRuntime::start(char const*, char const*)+532)\n#18  pc 00001423  /system/bin/app_process\n#19  pc 0000e403  /system/lib/libc.so (__libc_init+50)\n#20  pc 00000f34  /system/bin/app_process\nat android.os.MessageQueue.nativePollOnce(Native Method)\nat android.os.MessageQueue.next(MessageQueue.java:138)\nat android.os.Looper.loop(Looper.java:123)\nat android.app.ActivityThread.main(ActivityThread.java:5294)\nat java.lang.reflect.Method.invokeNative(Native Method)\nat java.lang.reflect.Method.invoke(Method.java:515)\nat com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:932)\nat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:748)\nat dalvik.system.NativeStart.main(Native Method)\n\"Binder_D\" prio=5 tid=21 WAIT\n| group=\"main\" sCount=1 dsCount=0 obj=0x41d6f468 self=0x555f4898\n| sysTid=3344 nice=0 sched=0/0 cgrp=apps handle=1442108096\n| state=S schedstat=( 0 0 0 ) utm=0 stm=0 core=3\nat java.lang.Object.wait(Native Method)\n- waiting on &lt;0x41d6f4c0&gt; (a java.lang.VMThread) held by tid=21 (Binder_D)\nat java.lang.Thread.parkFor(Thread.java:1205)\nat sun.misc.Unsafe.park(Unsafe.java:325)\nat java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\nat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:813)\nat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:846)\nat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1175)\nat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:180)\nat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:256)\nat android.view.SurfaceView$MyWindow.resized(SurfaceView.java:655)\nat android.view.IWindow$Stub.onTransact(IWindow.java:108)\nat android.os.Binder.execTransact(Binder.java:427)\nat dalvik.system.NativeStart.run(Native Method)\n\"Binder_F\" prio=5 tid=23 WAIT\n| group=\"main\" sCount=1 dsCount=0 obj=0x41d4e600 self=0x55cb63f8\n| sysTid=3351 nice=0 sched=0/0 cgrp=apps handle=1435714912\n| state=S schedstat=( 0 0 0 ) utm=1 stm=1 core=0\nat java.lang.Object.wait(Native Method)\n- waiting on &lt;0x41d4e658&gt; (a java.lang.VMThread) held by tid=23 (Binder_F)\nat java.lang.Thread.parkFor(Thread.java:1205)\nat sun.misc.Unsafe.park(Unsafe.java:325)\nat java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\nat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:813)\nat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:846)\nat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1175)\nat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:180)\nat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:256)\nat android.view.SurfaceView$MyWindow.resized(SurfaceView.java:655)\nat android.view.IWindow$Stub.onTransact(IWindow.java:108)\nat android.os.Binder.execTransact(Binder.java:427)\nat dalvik.system.NativeStart.run(Native Method)\n</code></pre> <p>\u4ece\u4e0a\u9762\u5806\u6808\u67e5\u770b\u4e3b\u7ebf\u7a0b\u7684\u6808\uff0c\u53d1\u73b0\u4e3b\u7ebf\u7a0b\u5728IDLE\u72b6\u6001\u3002\u7136\u540e\u53d1\u73b0\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u662fBinder10 \u4e14\u5728block\u72b6\u6001\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u4e0d\u662f\u975e\u5e38\u7e41\u5fd9\u7684\u9700\u8981\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684app\u662f\u4e0d\u9700\u898116\u4e2abinder\u7ebf\u7a0b\u7684\u3002 </p> <p>\u4e8e\u662f\u63a5\u7740\u67e5\u770b\u662f\u5426\u5176\u4ed6binder\u4e5f\u5b58\u5728\u5f02\u5e38\uff0c\u7ed3\u679c\u53d1\u73b0\u6240\u6709\u7684binder\u7ebf\u7a0b\u5747\u5904\u4e8e\u540c\u6837\u7684\u8c03\u7528\u6808\u3002</p> <p>\u5728\u8fd9\u79cdBinder\u6ee1\u7684\u60c5\u51b5\u4e0b\uff0csystemserver\u548capp\u4e4b\u95f4\u7684\u901a\u4fe1\u662f\u88abblock\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u65ad\u51fa ANR\u7684\u76f4\u63a5\u539f\u56e0\u5c31\u662f\u6b64\u5904\u4e0d\u5408\u5e38\u7406\u7684Binder\u88ab\u5360\u6ee1\u3002 \u9996\u5148\u901a\u8fc7\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\uff0csurfaceView\u4e2d\u8fd9\u884c\u5bf9\u5e94\u7684\u4ee3\u7801\u4e3a\u5982\u4e0b\uff1a</p> <pre><code>@Override\npublic void resized(Rect frame, Rect overscanInsets, Rect contentInsets,\nRect visibleInsets, boolean reportDraw, Configuration newConfig) {\nSurfaceView surfaceView = mSurfaceView.get();\nif (surfaceView != null) {\nif (DEBUG) Log.v(\n\"SurfaceView\", surfaceView + \" got resized: w=\" + frame.width()\n+ \" h=\" + frame.height() + \", cur w=\" + mCurWidth + \" h=\" + mCurHeight);\nLock.lock();\ntry {\nif (reportDraw) {\nsurfaceView.mUpdateWindowNeeded = true;\nsurfaceView.mReportDrawNeeded = true;\nsurfaceView.mHandler.sendEmptyMessage(UPDATE_WINDOW_MSG);\n} else if (surfaceView.mWinFrame.width() != frame.width()\n|| surfaceView.mWinFrame.height() != frame.height()) {\nsurfaceView.mUpdateWindowNeeded = true;\nsurfaceView.mHandler.sendEmptyMessage(UPDATE_WINDOW_MSG);\n}\n} finally {\nsurfaceView.mSurfaceLock.unlock();\n}\n}\n}\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u6240\u6709\u4f1alock\u548cunlock\u7684\u5730\u65b9\u90fd\u52a0\u4e0alog\uff0c\u518d\u590d\u73b0\u4e00\u6b21\u6765\u5f97\u5230\u771f\u76f8\u3002\u4e8e\u662f\u4e4e\u53d1\u73b0\u662f\u5728SingleTouchPointTest pass\u7684\u65f6\u5019\u5fd8\u8bb0unlockCanvs\u5bfc\u81f4\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#38","title":"3.8 \u65e0\u6548\u5806\u6808","text":"<p>\u5728\u6211\u4eec\u7684\u5b9e\u9645\u9879\u76ee\u4e0a\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u65e5\u5fd7\u63d0\u4f9b\u7684\u662f\u5b8c\u6574\u7684\uff0c\u53ef\u5806\u6808\u770b\u8d77\u6765\u5374\u4e0d\u50cf\"\u4f5c\u6848\"\u5806\u6808\uff0c\u5373\u51fa\u73b0\u7684\u5806\u6808\u5e76\u4e0d\u50cf\u662f\u771f\u6b63\u7684\u51f6\u624b\u3002</p> <p>\u5e38\u89c1\u7684\u4e00\u79cd\u60c5\u51b5: \u5806\u6808\u843d\u5728nativePollOnce\u4e0a\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\u901a\u5e38\u8bf4\u660e\u5f53\u524d\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\u662f\u7a7a\u95f2\u7684\uff0c\u6b64\u65f6\u5728\u7b49\u5f85\u5904\u7406\u4e0b\u4e00\u4e2amsg\uff0c\u6253\u5370\u65e5\u5fd7\u65f6\u771f\u6b63\u7684block\u6d88\u606f\u5df2\u7ecf\u8d70\u5b8c\u4e86\u3002</p> <p>\u6211\u4eec\u4ee5\u4e0b\u9762\u8fd9\u4e2a\u8ba1\u7b97\u5668\u7684anr\u4e3a\u4f8b</p> <pre><code>01-29 06:24:46.618452  1210  5962 I AnrManager: ANR in com.journeyui.calculator (com.journeyui.calculator/.Calculator), time=260439862\n01-29 06:24:46.618452  1210  5962 I AnrManager: Reason: Input dispatching timed out (ActivityRecord{51e27ca u0 com.journeyui.calculator/.Calculator t1837} does not have a focused window)\n01-29 06:24:46.618452  1210  5962 I AnrManager: Load: 31.7 / 33.43 / 30.98\n01-29 06:24:46.618452  1210  5962 I AnrManager: Android time :[2022-01-29 06:24:46.60] [260451.594]\n01-29 06:24:46.618452  1210  5962 I AnrManager: CPU usage from 167270ms to 0ms ago (2022-01-29 06:21:47.589 to 2022-01-29 06:24:34.860) with 99% awake:\n01-29 06:24:46.618452  1210  5962 I AnrManager:   226% 1210/system_server: 173% user + 52% kernel / faults: 1026822 minor 8 major\n01-29 06:24:46.618452  1210  5962 I AnrManager:   125% 459/logd: 16% user + 109% kernel / faults: 408 minor\n01-29 06:24:46.618452  1210  5962 I AnrManager:   29% 21567/com.journeyui.globalsearch: 18% user + 10% kernel / faults: 45071 minor 25 major\n01-29 06:24:46.618452  1210  5962 I AnrManager:   26% 639/surfaceflinger: 18% user + 8.6% kernel / faults: 4704 minor\n01-29 06:24:46.618452  1210  5962 I AnrManager:   26% 20889/com.yulong.android.gamecenter: 16% user + 9.3% kernel / faults: 21143 minor\n01-29 06:24:46.618452  1210  5962 I AnrManager:   24% 29706/com.sohu.inputmethod.sogou:home: 16% user + 8.6% kernel / faults: 21832 minor\n01-29 06:24:46.618452  1210  5962 I AnrManager:   24% 545/com.android.messaging: 15% user + 9% kernel / faults: 26023 minor 2 major\n//...\n01-29 06:24:46.618452  1210  5962 I AnrManager:   1.7% 3589/com.journeyui.calculator: 1% user + 0.6% kernel / faults: 3365 minor 5 major\n//...\n01-29 06:24:46.618480  1210  5962 I AnrManager: 75% TOTAL: 42% user + 33% kernel + 0% iowait + 0% softirq\n</code></pre> <p>\u9996\u5148\u770b\u4e0b\u662f\u5426\u53d7\u7cfb\u7edf\u73af\u5883\u5f71\u54cd</p> <p>\u4ece\u4e0a\u9762\u7684\u65e5\u5fd7\u7247\u6bb5\u53ef\u4ee5\u770b\u51fa\uff0c\u6574\u673a\u8d1f\u8f7d\u8f83\u9ad8\u8fbe\u5230\u4e8675%\uff0c\u4f46\u662f\u524d\u53f0\u8fdb\u7a0bcom.journeyui.calculator\u5360\u7528\u5e76\u4e0d\u9ad8\u53ea\u67091.7%\u3002</p> <p>top\u4e2d\u6ca1\u6709kswapd\u8eab\u5f71\uff0c\u6392\u9664\u4f4e\u5185\u5b58\u7684\u5f71\u54cd\uff0c\u6240\u4ee5\u8fd9\u4e2a\u95ee\u9898\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u53d7\u6574\u673a\u9ad8\u8d1f\u8f7d\u7684\u5f71\u54cd\u3002</p> <p>ANR\u53d1\u751f\u65f6SystemServer\u5360\u636e\u7a0d\u9ad8\u53ef\u80fd\u662f\u6b63\u5e38\u7684\uff0c\u56e0\u4e3aDump Trace\u65f6\u9700\u8981\u83b7\u53d6\u7cfb\u7edf\u6574\u4f53\u53ca\u5404\u8fdb\u7a0b CPU \u4f7f\u7528\u60c5\u51b5\uff0c\u77ed\u65f6\u95f4\u5185\u4f1a\u9020\u6210SystemServer\u5347\u9ad8\u3002</p> <p>\u63a5\u7740event\u65e5\u5fd7\u4e2d\u641c\u7d22\"am_anr\"\u5173\u952e\u5b57</p> <pre><code>01-29 06:24:34.907471 1210 5962 I am_anr : [0,3589,com.journeyui.calculator,684244549,\nInput dispatching timed out (ActivityRecord{51e27ca u0 com.journeyui.calculator/\n.Calculator t1837} does not have a focused window)]\n</code></pre> <p>\u6839\u636e\u65f6\u95f4\u6233\u627e\u5230\u5bf9\u5e94\u7684anr\u6587\u4ef6</p> <p></p> <p>\u6b64\u65f6\u6211\u4eec\u6ce8\u610f\u5230\u5806\u6808\u843d\u5728\u4e86nativePollOnce\u4e0a\uff0c\u524d\u9762\u8bf4\u8fc7\u843d\u5728nativePollOnce\u4e0a\uff0c\u8bf4\u660e\u5e94\u7528\u6b64\u65f6\u5df2\u7ecf\u5904\u4e8eidle\u72b6\u6001\u4e86\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u8bf4\u660e\u8017\u65f6\u6d88\u606f\u5df2\u57cb\u6ca1\u5728\u5386\u53f2\u6d88\u606f\u4e2d\uff0c\u5386\u53f2\u6d88\u606f\u7684\u8017\u65f6\u53ef\u80fd\u5b58\u5728\u4e0b\u9762\u7684\u51e0\u79cd\u60c5\u51b5</p> <ol> <li> <p>\u5e94\u7528\u4e3b\u7ebf\u7a0b\u5386\u53f2\u8c03\u5ea6\u4e2d\u5b58\u5728\u4e25\u91cd\u8017\u65f6\u7684\u6d88\u606f</p> </li> <li> <p>\u5e94\u7528\u4e3b\u7ebf\u7a0b\u5386\u53f2\u8c03\u5ea6\u4e2d\u5b58\u5728\u591a\u4e2a\u8017\u65f6\u7684\u6d88\u606f</p> </li> <li> <p>\u5e94\u7528\u4e3b\u7ebf\u7a0b\u5386\u53f2\u8c03\u5ea6\u4e2d\u5b58\u5728\u5927\u91cf\u6d88\u606f\u6bd4\u5982\u9ad8\u9891\u53d1\u9001\u6d88\u606f</p> </li> <li> <p>\u5e94\u7528\u4e3b\u7ebf\u7a0b\u672c\u8eab\u5e76\u4e0d\u8017\u65f6\uff0c\u800c\u662f\u53d7\u5230\u7cfb\u7edf\u73af\u5883\u56e0\u7d20\u5f71\u54cd(IO/\u4f4e\u5185\u5b58/\u9ad8\u8d1f\u8f7d\u7b49)</p> </li> </ol> <p>\u90a3\u4e48\u5386\u53f2\u8c03\u5ea6\u4e2d\u7684\u8017\u65f6\u6d88\u606f\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u5f97\u77e5\u5462\uff1f</p> <p>\u901a\u5e38\u624b\u673a\u5382\u5546\u4f1a\u505a\u65e5\u5fd7\u589e\u5f3a\uff0c\u5e38\u89c1\u7684\u601d\u8def\u5982\u4e0b:</p> <ol> <li>\u5bf9\u4e8e\u4e3b\u7ebf\u7a0b\u7684binder transaction \u8017\u65f6\u60c5\u51b5\uff0c \u8d85\u51fa\u8bbe\u5b9a\u9608\u503c\u5219\u8f93\u51fa\u8c03\u7528\u4fe1\u606f\u3002</li> <li>\u5f53\u7ebf\u7a0b\u7b49\u9501\u65f6\u95f4\u8d85\u51fa\u8bbe\u5b9a\u9608\u503c\uff0c\u5219\u8f93\u51fa\u5f53\u524d\u7684\u6301\u9501\u72b6\u6001\u3002</li> <li>\u4e3b\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u56de\u8c03\u65b9\u6cd5\u6267\u884c\u65f6\u95f4\u8d85\u51fa\u8bbe\u5b9a\u9608\u503c\uff0c\u5219\u8f93\u51fa\u76f8\u5e94\u4fe1\u606f\u3002</li> <li>\u5bf9\u4e8e\u975e\u5f02\u6b65Binder\u8c03\u7528\u8017\u65f6\u8d85\u51fa\u8bbe\u5b9a\u9608\u503c\u7684\u65f6\u5019\uff0c\u8f93\u51faBinder\u4fe1\u606f\u3002</li> </ol> <p>\u5bf9\u4e8e\u4e00\u4e9b\u5934\u90e8\u5e94\u7528\u5382\u5546\u5982\u5b57\u8282\u8df3\u52a8\u6709\u81ea\u7814\u7684Raster\u6d88\u606f\u76d1\u63a7\u5e73\u53f0\uff0c\u548c\u624b\u673a\u5382\u5546\u505a\u7684\u65e5\u5fd7\u589e\u5f3a\u76ee\u7684\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u4e3a\u4e86\u5c3d\u53ef\u80fd\u591a\u7684\u6536\u96c6\u7ebf\u7d22\u3002</p> <p>\u9664\u4e86\u843d\u5728nativePollOnce\u7684\u60c5\u51b5\uff0c\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u5219\u66f4\u52a0\u9690\u853d\uff0c\u5bb9\u6613\u5c06\u6211\u4eec\u5e26\u504f\u5206\u6790\u7684\u65b9\u5411\u3002\u90a3\u5c31\u662f\u5806\u6808\u6253\u5370\u51fa\u6765\u7684\u786e\u5b9e\u662f\u5e94\u7528\u81ea\u8eab\u7684\u5806\u6808\u3002</p> <p>\u4f46\u662f\u6839\u636e\u5806\u6808\u627e\u5230\u5bf9\u5e94\u4ee3\u7801\u540e\u53d1\u73b0\u8fd9\u6bb5\u4ee3\u7801\u4e0d\u53ef\u80fd\u4f1a\u51fa\u73b0\u8017\u65f6\uff0c\u8bf4\u660e\u8fd9\u6bb5\u5806\u6808\u53ef\u80fd\u53ea\u662f\u5145\u5f53\u4e86\"\u66ff\u7f6a\u7f8a\"\u7684\u89d2\u8272\uff0c\u800c\u771f\u6b63\u7684\"\u51f6\u624b\"\u65e9\u5df2\u85cf\u8eab\u5728\u4e86\u5386\u53f2\u6d88\u606f\u4e2d\u3002</p>"},{"location":"perf-opt/Android/anr/anr_trace/#_2","title":"\u53c2\u8003","text":"<p>\u5e72\u8d27\uff1aANR\u65e5\u5fd7\u5206\u6790\u5168\u9762\u89e3\u6790</p> <p>ANR\u95ee\u9898\u5206\u6790\u6307\u5317</p> <p>\u4e00\u6587\u5e26\u4f60\u4e0d\u518d\u60e7\u6015ANR </p>"},{"location":"perf-opt/Android/anr/sp/","title":"\u544a\u522b SharedPreference \u7b49\u5f85","text":"<p>Google \u5728\u8bbe\u8ba1\u4e4b\u521d\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\uff0c\u5b9e\u73b0\u4e86\u4e00\u5957\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u6301\u4e45\u5316\u65b9\u6848\u2014\u2014SharedPreference\uff08\u4ee5\u4e0b\u7b80\u79f0 sp\uff09\uff0c\u56e0\u4e3a\u5176\u7b80\u4fbf\u7684 API\uff0c\u65b9\u4fbf\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u5f97\u5230\u5f00\u53d1\u8005\u7684\u9752\u7750\uff0c\u5bf9\u5176\u4f9d\u8d56\u8d8a\u6765\u8d8a\u91cd\u3002\u5728\u5e94\u7528\u7248\u672c\u4e0d\u65ad\u8fed\u4ee3\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0 Google \u8bf4\u7684\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u5b58\u50a8\u662f\u6709\u539f\u56e0\u7684\uff0c\u8d8a\u662f\u91cd\u91cf\u7ea7\u7684\u5e94\u7528\u51fa\u73b0\u7684 ANR \u95ee\u9898\u8d8a\u4e25\u91cd\u3002\u672c\u6587\u4ece\u6e90\u7801\u5c42\u9762\u5206\u6790\u5728\u52a0\u8f7d\u548c\u5199\u5165\u8fc7\u7a0b\u4e2d\uff0c\u5bfc\u81f4 ANR \u95ee\u9898\u7684\u539f\u56e0\u4ee5\u53ca\u76f8\u5173\u7684\u4f18\u5316\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"perf-opt/Android/anr/sp/#1-sp-anr","title":"1. SP \u5bfc\u81f4 ANR \u539f\u56e0\u5206\u6790","text":"<p>\u7ecf\u5e38\u4f1a\u9047\u5230\u4e24\u7c7b\u5173\u4e8e SharedPreference \u95ee\u9898\uff0c\u4ee5\u4e0b\u5206\u522b\u4ecb\u7ecd\u5bfc\u81f4\u8fd9\u4e24\u7c7b ANR \u95ee\u9898\u7684\u539f\u56e0\u548c\u4f18\u5316\u65b9\u6848\u3002</p> <p>\u95ee\u9898\u4e00\uff1asp \u6587\u4ef6\u521b\u5efa\u4ee5\u540e\uff0c\u4f1a\u5355\u72ec\u7684\u4f7f\u7528\u4e00\u4e2a\u7ebf\u7a0b\u6765\u52a0\u8f7d\u89e3\u6790\u5bf9\u5e94\u7684 sp \u6587\u4ef6\u3002\u4f46\u662f\u5f53 UI \u7ebf\u7a0b\u5c1d\u8bd5\u8bbf\u95ee sp \u4e2d\u5185\u5bb9\u65f6\uff0c\u5982\u679c sp \u6587\u4ef6\u8fd8\u672a\u88ab\u5b8c\u5168\u52a0\u8f7d\u89e3\u6790\u5230\u5185\u5b58\uff0c\u6b64\u65f6 UI \u7ebf\u7a0b\u4f1a\u88ab block\uff0c\u76f4\u5230 SP \u6587\u4ef6\u88ab\u5b8c\u5168\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u4e3a\u6b62\u3002\u5177\u4f53 ANR \u7ebf\u7a0b\u5806\u6808\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e3b\u8981\u539f\u56e0\u662f SP \u6587\u4ef6\u672a\u88ab\u52a0\u8f7d\u6216\u89e3\u6790\u5230\u5185\u5b58\u4e2d\uff0c\u6b64\u65f6\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528 sp \u63d0\u4f9b\u7684\u63a5\u53e3\u3002sp \u88ab\u521b\u5efa\u7684\u65f6\u5019\u4f1a\u540c\u65f6\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u52a0\u8f7d\u5bf9\u5e94\u7684 sp \u6587\u4ef6\uff0c\u6267\u884c <code>startLoadFromDisk();</code></p> <pre><code>SharedPreferencesImpl(File file, int mode) {\nmFile = file;\nmBackupFile = makeBackupFile(file);\nmMode = mode;\nmLoaded = false;\nmMap = null;\nmThrowable = null;\nstartLoadFromDisk();\n}\n</code></pre> <p>\u5728 startLoadFromDisk()\u65f6\uff0c\u6807\u8bb0 sp \u4e0d\u53ef\u4f7f\u7528\u72b6\u6001\uff0c\u540e\u671f\u65e0\u8bba\u662f\u5c1d\u8bd5\u8bfb\u6570\u636e\u6216\u8005\u5199\u6570\u636e\uff0c\u8bfb\u5199\u7ebf\u7a0b\u90fd\u4f1a\u88ab block\uff0c\u76f4\u5230 sp \u6587\u4ef6\u88ab\u5168\u90e8\u52a0\u8f7d\u89e3\u6790\u5b8c\u6bd5\u3002</p> <pre><code>private void startLoadFromDisk() {\nsynchronized (mLock) {\nmLoaded = false; //\u6807\u8bb0 sp \u4e0d\u53ef\u4f7f\u7528\u72b6\u6001\n}\nnew Thread(\"SharedPreferencesImpl-load\") {\npublic void run() {\nloadFromDisk();\n}\n}.start();\n}\n</code></pre> <p>\u7ebf\u7a0b\u5728\u8bfb\u6216\u5199\u65f6\uff0c\u90fd\u4f1a\u8d70\u5230 <code>awaitLoadedLocked()</code>\u903b\u8f91\uff0c\u5728\u4e0a\u9762\u7684 <code>mLoaded \u4e3a false</code> \u5373 sp \u6587\u4ef6\u5c1a\u672a\u52a0\u8f7d\u89e3\u6790\u5230\u5185\u5b58\uff0c\u6b64\u65f6\u8bfb\u5199\u7ebf\u7a0b\u4f1a\u76f4\u63a5\u88ab block \u5230 mLock \u9501\u4e0a\uff0c\u76f4\u5230 loadFromDisk()\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\u3002</p> <pre><code>private void awaitLoadedLocked() {\nif (!mLoaded) {\n// Raise an explicit StrictMode onReadFromDisk for this\n// thread, since the real read will be in a different\n// thread and otherwise ignored by StrictMode.\nBlockGuard.getThreadPolicy().onReadFromDisk();\n}\nwhile (!mLoaded) {\ntry {\nmLock.wait(); // block\n} catch (InterruptedException unused) {\n}\n}\nif (mThrowable != null) {\nthrow new IllegalStateException(mThrowable);\n}\n}\n@Override\npublic Map&lt;String, ?&gt; getAll() {\nsynchronized (mLock) {\nawaitLoadedLocked(); //noinspection unchecked\nreturn new HashMap&lt;String, Object&gt;(mMap);\n}\n}\n@Override\n@Nullable\npublic String getString(String key, @Nullable String defValue) {\nsynchronized (mLock) {\nawaitLoadedLocked();\nString v = (String)mMap.get(key);\nreturn v != null ? v : defValue;\n}\n}\n</code></pre> <p>\u95ee\u9898\u4e8c\uff1aGoogle \u7cfb\u7edf\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u7684\u8de8\u8fdb\u7a0b\u5b8c\u6574\u6027\uff0c\u524d\u671f\u5e94\u7528\u53ef\u4ee5\u4f7f\u7528 sp \u6765\u505a\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff0c\u5728\u7ec4\u4ef6\u9500\u6bc1\u6216\u5176\u4ed6\u751f\u547d\u5468\u671f\u7684\u540c\u65f6\u4e3a\u4e86\u786e\u4fdd\u5f53\u524d\u8fd9\u4e2a\u5199\u5165\u4efb\u52a1\u5fc5\u987b\u5728\u5f53\u524d\u8fd9\u4e2a\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u5b8c\u6210\u5199\u5165\uff0c\u6b64\u65f6\u4e3b\u7ebf\u7a0b\u4f1a\u5728\u7ec4\u4ef6\u9500\u6bc1\u6216\u8005\u7ec4\u4ef6\u6682\u505c\u7684\u751f\u547d\u5468\u671f\u5185\u7b49\u5f85 sp \u5b8c\u5168\u5199\u5165\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u4e2d\uff0c\u5982\u4e0b\u56fe UI \u7ebf\u7a0b\u88ab block \u5728\u4e86 <code>QueuedWork.waitToFinish()</code>\u5904\uff0c\u63a5\u4e0b\u6765\u57fa\u4e8e\u6e90\u7801\u4ece apply \u5f00\u59cb\u5230\u6700\u540e\u5199\u5165\u6587\u4ef6\u6574\u4f53\u6d41\u7a0b\u68b3\u7406\u627e\u51fa\u95ee\u9898\u6839\u6e90\u3002</p> <p></p> <p>\u5177\u4f53\u9700\u8981\u7b49\u5f85\u6587\u4ef6\u5199\u5165\u7684\u6d88\u606f\u5728 AcitivtyThread \u7684 H \u4e2d\uff0c\u5177\u4f53\u6d88\u606f\u7c7b\u578b\u5982\u4e0b\uff1a</p> <pre><code>public static final int SERVICE_ARGS = 115;\npublic static final int STOP_SERVICE = 116;\npublic static final int PAUSE_ACTIVITY = 101;\npublic static final int STOP_ACTIVITY_SHOW = 103;\npublic static final int SLEEPING  = 137;\n</code></pre> <p>\u7531\u4e8e Google \u5b98\u65b9\u8bbe\u8ba1\u4e4b\u521d\u662f\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u5b58\u50a8\u65b9\u5f0f\uff0c\u8fd9\u79cd\u7b49\u5f85\u884c\u4e3a\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46\u662f\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u7531\u4e8e sp \u8fc7\u5ea6\u4f7f\u7528\uff0c\u8fd9\u4e2a\u7b49\u5f85\u7684\u65f6\u95f4\u88ab\u4e0d\u53ef\u63a7\u7684\u62c9\u957f\uff0c\u76f4\u5230\u6700\u540e\u51fa\u73b0 ANR\uff0c\u8fd9\u79cd\u95ee\u9898\u8d8a\u5728\u4e1a\u52a1\u7e41\u91cd\u7684\u5e94\u7528\u4e0a\u4f53\u73b0\u8d8a\u660e\u663e\u3002\u5177\u4f53\u95ee\u9898\u5806\u6808\u5982\u4e0b\uff0c\u5168\u662f\u7cfb\u7edf\u5806\u6808\uff0c\u63a5\u4e0b\u6765\u4ece waitToFinish \u5165\u624b\u5206\u6790\uff0c\u5256\u6790\u8fd9\u4e2a ANR \u7684\u6839\u6e90\u3002\u5177\u4f53 ANR \u5806\u6808\u5982\u4e0b\uff1a</p> <p></p> <p>\u524d\u671f sp \u63a5\u53e3\u53ea\u6709 commit \u63a5\u53e3\uff0c\u63a5\u53e3\u540c\u6b65\u5199\u5165\u6587\u4ef6\uff0c\u8fd9\u4e2a\u63a5\u53e3\u76f4\u63a5\u5f71\u54cd\u5f00\u53d1\u8005\u4f7f\u7528\uff0c\u4e8e\u662f Google \u5b98\u65b9\u5bf9\u5916\u63d0\u4f9b\u4e86\u5f02\u6b65\u7684 apply \u63a5\u53e3\uff0c\u7531\u4e8e\u5f00\u53d1\u8005\u8ba4\u4e3a\u8fd9\u4e2a\u5f02\u6b65\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u5f02\u6b65\uff0c\u5927\u89c4\u6a21\u7684\u4f7f\u7528 sp \u7684 appy \u63a5\u53e3\uff0c\u5c31\u662f\u8fd9\u79cd apply \u7684\u5b9e\u73b0\u65b9\u5f0f\u5bfc\u81f4\u4e86\u4e1a\u52a1\u91cf\u5927\u7684 APP \u6df1\u53d7\u8fd9\u4e2a apply \u8bbe\u8ba1\u7f3a\u9677\u5bfc\u81f4\u7684 ANR \u95ee\u9898\u5f71\u54cd\u3002</p> <p>apply \u63a5\u53e3\u6574\u4f53\u7684\u8be6\u7ec6\u8bbe\u8ba1\u601d\u8def\u5982\u4e0b\u56fe\uff08\u57fa\u4e8e Android8.0 \u53ca\u4ee5\u4e0b\u7248\u672c\u5206\u6790\uff09\uff1a</p> <p></p> <p>\u6574\u4f53\u7684\u601d\u8def\u7b80\u5355\u68b3\u7406\u5982\u4e0b\uff1a</p> <ol> <li> <p>sp.apply()\uff0c\u5199\u5165\u5185\u5b58\u540c\u65f6\u5f97\u5230\u9700\u8981\u540c\u6b65\u5199\u5165\u6587\u4ef6\u7684\u6570\u636e\u96c6\u5408 MemoryCommitResult\uff1a </p> </li> <li> <p>\u5c06 MemoryCommitResult \u5c01\u88c5\u6210 Runnable \u629b\u5230\u5b50\u7ebf\u7a0b queued-work-looper \u4e2d\uff1b</p> </li> <li> <p>\u5728\u5b50\u7ebf\u7a0b\u4e2d\u5c06 MemoryCommitResult \u4e2d\u7684 mapToWriteToDisk \u5bf9\u5e94\u7684 key-value \u5199\u5165\u5230\u6587\u4ef6\u4e2d\u53bb\uff1b</p> </li> <li> <p>\u6587\u4ef6\u5199\u5165\u5b8c\u6210\u4ee5\u540e\uff0c\u4f1a\u6267\u884c MemoryCommitResult \u7684 setDiskWriteResult \u65b9\u6cd5\uff0c\u5173\u952e\u7684\u6b65\u9aa4 writtenToDiskLatch.countDown() \u51fa\u73b0\u4e86\uff1b</p> </li> <li> <p>\u5982\u4e0b\u5f53\u4e3b\u7ebf\u4e2d\u6267\u884c\u5230 QueuedWork.waitToFinish()\u7684\u65f6\u5019\uff1b </p> </li> <li> <p>\u4e3b\u7ebf\u7a0b\u5230\u5e95\u5728\u5e72\u4ec0\u4e48\uff0c\u8fd9\u4e2a\u65f6\u5019\u5f97\u4ece QueuedWork.add(Runnable finisher)\u5165\u624b\uff0c\u5177\u4f53 Runnable \u5982\u4e0b\u56fe\uff0c\u8fd9\u4e2a\u5730\u65b9\u5c31\u662f\u5565\u4e5f\u6ca1\u5e72\uff0c\u76f4\u63a5\u7b49\u5728\u4e86 mcr.writtenToDiskLatch.await()\u4e0a\uff0c\u8fd9\u91cc\u5927\u5bb6\u5e94\u8be5\u6709\u70b9\u5370\u8c61\uff0c\u5c31\u662f\u6b65\u9aa4 4 \u4e2d\u5b50\u7ebf\u7a0b\u5728\u5199\u5b8c\u6587\u4ef6\u4ee5\u540e\u76f4\u63a5\u91ca\u653e\u7684\u90a3\u4e2a\u9501 </p> </li> </ol> <p>\u7ed3\u8bba\uff1a \u5c3d\u7ba1\u6574\u4f53 API \u7684\u6d41\u7a0b\u5206\u6790\u5f02\u5e38\u7684\u590d\u6742\uff0c\u628a\u4e00\u4e2a runnable \u5c01\u88c5\u4e86\u4e00\u5c42\u53c8\u4e00\u5c42\uff0c\u4ece\u8fd9\u4e2a\u7ebf\u7a0b\u629b\u5230\u90a3\u4e2a\u7ebf\u7a0b\uff0c\u5b50\u7ebf\u7a0b\u6267\u884c\u5b8c\u5199\u5165\u6587\u4ef6\u4ee5\u540e\u4f1a\u91ca\u653e\u9501\uff0c\u4e3b\u7ebf\u7a0b\u6267\u884c\u5230\u67d0\u4e9b\u5730\u65b9\u5f97\u7b49\u5f85\u5b50\u7ebf\u7a0b\u628a\u5199\u5165\u6587\u4ef6\u7684\u884c\u4e3a\u6267\u884c\u5b8c\u6bd5\uff0c\u4f46\u662f\u6574\u4f53\u7684\u601d\u8def\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002\u9020\u6210\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u6e90\u5c31\u662f\u592a\u591a pending \u7684 apply \u884c\u4e3a\u6ca1\u6709\u5199\u5165\u5230\u6587\u4ef6\uff0c\u4e3b\u7ebf\u7a0b\u5728\u6267\u884c\u5230\u6307\u5b9a\u6d88\u606f\u7684\u65f6\u5019\u4f1a\u6709\u7b49\u5f85\u884c\u4e3a\uff0c\u7b49\u5f85\u65f6\u95f4\u8fc7\u957f\u5c31\u4f1a\u51fa\u73b0 ANR\u3002</p> <p>\u5c3d\u7ba1 Google \u5b98\u65b9\u5728 Android 8.0 \u53ca\u4ee5\u540e\u7248\u672c\u5bf9 sp \u5199\u5165\u903b\u8f91\u8fdb\u884c\u4f18\u5316\uff0c\u671f\u671b\u662f\u5728\u4e0a\u8ff0\u6b65\u9aa4 6 \u4e2d UI \u7ebf\u7a0b\u4e0d\u662f\u50bb\u50bb\u7684\u7b49\uff0c\u800c\u662f\u5e2e\u52a9\u5b50\u7ebf\u7a0b\u4e00\u8d77\u5199\u5165\uff0c\u4f46\u662f\u7531\u4e8e\u662f\u4fdd\u5b88\u534f\u52a9\uff0c\u5e76\u6ca1\u6709\u5f88\u597d\u7684\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/anr/sp/#2","title":"2 .\u89e3\u51b3\u65b9\u6848","text":"<p>\u95ee\u9898\u4e00\uff1a\u9488\u5bf9\u52a0\u8f7d\u5f88\u6162\u7684\u95ee\u9898\uff0c\u4e00\u822c\u4f7f\u7528\u7684\u6bd4\u8f83\u591a\u7684\u662f\u91c7\u7528\u9884\u52a0\u8f7d\u7684\u65b9\u5f0f\u6765\u89e6\u53d1\u5230\u8fd9\u4e2a sp \u6587\u4ef6\u7684\u52a0\u8f7d\u548c\u89e3\u6790\uff0c\u8fd9\u6837\u5728\u771f\u6b63\u4f7f\u7528\u7684\u65f6\u5019\u5927\u6982\u7387 sp \u5df2\u7ecf\u52a0\u8f7d\u89e3\u6790\u5b8c\u6bd5\u4e86\uff1b\u771f\u6b63\u9700\u8981\u5904\u7406\u7684\u662f\u6838\u5fc3\u573a\u666f\u7684 sp \u4e00\u5b9a\u4e0d\u80fd\u592a\u5927\uff0cGoogle \u5b98\u65b9\u7684\u58f0\u660e\u8fd8\u662f\u6709\u5fc5\u8981\u9075\u5b88\u4e00\u4e0b\uff0c\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u6301\u4e45\u5316\u5b58\u50a8\u65b9\u5f0f\uff0c\u4e0d\u8981\u5b58\u592a\u591a\u6570\u636e\uff0c\u907f\u514d\u6587\u4ef6\u8fc7\u5927\uff0c\u5bfc\u81f4\u524d\u671f\u7684\u52a0\u8f7d\u89e3\u6790\u8017\u65f6\u8fc7\u4e45\u3002</p> <p>\u95ee\u9898\u4e8c\uff1a\u81f3\u4e8e Google \u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\uff0c\u63d0\u51fa\u4e86\u81ea\u5df1\u7684\u51e0\u4e2a\u731c\u60f3\uff1a</p> <ol> <li>Google \u5e0c\u671b\u505a\u5230\u6570\u636e\u53ef\u80fd\u5c3d\u53ef\u80fd\u53ca\u65f6\u7684\u5199\u5165\u6587\u4ef6\uff0c\u4f46\u662f\u8fd9\u6837\u7b49\u5f85\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\uff0c\u4e3b\u7ebf\u7a0b\u76f4\u63a5\u7b49\u5f85\u5e76\u4e0d\u4f1a\u63d0\u5347\u5199\u5165\u7684\u6548\u7387\uff1b</li> <li>\u671f\u671b sp \u5b9e\u65f6\u5199\u5165\u6587\u4ef6\uff0c\u4ee5\u65b9\u4fbf\u8de8\u8fdb\u7a0b\u7684\u65f6\u5019\u53ef\u4ee5\u5b9e\u65f6\u7684\u8bbf\u95ee\u5230 sp \u5185\u7684\u6587\u4ef6\uff0c\u8fd9\u79cd\u5f02\u6b65\u5199\u5165\u65b9\u5f0f\u672c\u8eab\u5c31\u6ca1\u529e\u6cd5\u786e\u4fdd\u5b9e\u65f6\u6027\uff1b</li> <li>\u53ef\u80fd\u662f\u5728\u7ec4\u4ef6\u53d1\u751f\u72b6\u6001\u5207\u6362\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u8fdb\u7a0b\u5185\u6ca1\u6709\u5565\u7ec4\u4ef6\uff0c\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u53ef\u80fd\u964d\u4f4e\uff0c\u5b58\u5728\u8fdb\u7a0b\u4f1a\u5728\u7cfb\u7edf\u8d44\u6e90\u5403\u7d27\u7684\u65f6\u5019\u88ab\u7cfb\u7edf\u5e72\u6389\uff0c\u8fd9\u79cd\u6982\u7387\u6781\u4f4e\uff0c\u51e0\u4e4e\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\uff1b</li> <li>\u611f\u89c9\u6700\u5927\u7684\u53ef\u80fd\u6027\u5c31\u662f Google \u5b98\u65b9\u5f53\u65f6\u662f\u4e3a\u4e86\u4ece commit \u65e0\u7f1d\u7684\u5207\u6362\u5230 apply\uff0c\u4f9d\u7136\u6a21\u62df\u539f\u6765\u7684 commit \u884c\u4e3a\uff0c\u53ea\u662f\u5c06\u539f\u6765\u7684\u6bcf\u6b21\u5199\u5165\u6587\u4ef6\u4e00\u6b21\u6539\u6210\u591a\u6b21 commit \u884c\u4e3a\u6700\u540e\u4e00\u6b21\u6027 apply \u5728\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u6240\u6709\u7684\u5199\u5165\u884c\u4e3a\u4e00\u6b21\u6027\u5168\u90e8\u5199\u5165\u3002</li> </ol> <p>\u901a\u8fc7\u4ee5\u4e0a\u5047\u8bbe\uff0c\u53d1\u73b0\u8fd9\u91cc\u7684\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u5b50\u7ebf\u7a0b\u5199\u5165\u6839\u672c\u6ca1\u6709\u4ec0\u4e48\u610f\u4e49\uff0c\u56e0\u6b64\u5e0c\u671b\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u5fc5\u8981\u7684\u624b\u6bb5\u8df3\u8fc7\u8fd9\u79cd\u65e0\u7528\u7684\u7b49\u5f85\u884c\u4e3a\uff0c\u5728\u7814\u7a76\u4e86\u6240\u6709\u7684 SharedPreference \u76f8\u5173\u7684\u903b\u8f91\u540e\u627e\u5230\u4ee5\u4e0b\u5165\u624b\u70b9\u3002\u4ee5\u4e0b\u662f 8.0 \u4ee5\u4e0b\u7248\u672c\u7684\u4f18\u5316\u7b56\u7565\uff0c8.0 \u53ca\u4ee5\u4e0a\u7248\u672c\u5904\u7406\u65b9\u5f0f\u7c7b\u4f3c</p> <p></p> <p>\u5982\u679c\u9700\u8981\u4e3b\u7ebf\u7a0b\u5728 waitToFinish \u7684\u65f6\u5019\u76f4\u63a5\u8df3\u8fc7\u53bb\uff0c\u8ba9 toTinish.run()\u6267\u884c\u5b8c\u6bd5\uff0c\u663e\u7136\u4e0d\u53ef\u80fd\uff0c\u5982\u679c\u80fd\u8ba9 sPendingWorkFinishers.poll()\u8fd4\u56de\u4e3a null\uff0c\u5219\u8fd9\u91cc\u7684\u7b49\u5f85\u884c\u4e3a\u76f4\u63a5\u5c31\u8df3\u8fc7\u53bb\u4e86\uff0csPendingWorkFinishers \u662f\u4e2a ConcurrentLinkedQueue \u96c6\u5408\uff0c\u53ef\u4ee5\u76f4\u63a5\u52a8\u6001\u4ee3\u7406\u8fd9\u4e2a\u96c6\u5408\uff0c\u590d\u5199 poll \u65b9\u6cd5\uff0c\u8ba9\u5176\u6c38\u8fdc\u8fd4\u56de null\uff0c\u8fd9\u4e2a\u65f6\u5019 UI \u6c38\u8fdc\u4e0d\u4f1a\u7b49\u5f85\u5b50\u7ebf\u7a0b\u5199\u5165\u6587\u4ef6\u5b8c\u6bd5\u3002\u4e8b\u5b9e\u8bc1\u660e\u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\u6709\u6548\u3002</p> <p></p> <p>\u9488\u5bf9\u8fd9\u79cd\u5199\u5165\u7b49\u5f85\u7684 ANR \u95ee\u9898\uff0c\u8fd8\u6709\u4e00\u79cd\u5c31\u662f\u5168\u5c40\u66ff\u6362\u5199\u5165\u65b9\u5f0f\uff0c\u901a\u8fc7\u63d2\u6869\u7684\u65b9\u5f0f\uff0c\u66ff\u6362\u6240\u6709\u7684 API \u5b9e\u73b0\uff0c\u91c7\u7528\u5176\u4ed6\u7684\u5b58\u50a8\u65b9\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4fee\u590d\u6210\u672c\u548c\u98ce\u9669\u8f83\u5927\uff0c\u4f46\u662f\u540e\u671f\u53ef\u4ee5\u968f\u673a\u7684\u66ff\u6362\u5b58\u50a8\u65b9\u5f0f\uff0c\u4f7f\u7528\u6bd4\u8f83\u7075\u6d3b\u3002</p> <p>Google \u65b0\u589e\u52a0\u4e86\u4e00\u4e2a\u65b0 Jetpack \u7684\u6210\u5458 DataStore\uff0c\u4e3b\u8981\u7528\u6765\u66ff\u6362 SharedPreferences\uff0c DataStore \u5e94\u8be5\u662f\u5f00\u53d1\u8005\u671f\u5f85\u5df2\u4e45\u7684\u5e93\uff0cDataStore \u662f\u57fa\u4e8e Flow \u5b9e\u73b0\u7684\uff0c\u4e00\u79cd\u65b0\u7684\u6570\u636e\u5b58\u50a8\u65b9\u6848\u3002</p>"},{"location":"perf-opt/Android/anr/sp/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://mp.weixin.qq.com/s/kfF83UmsGM5w43rDCH544g</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/","title":"Bitmap: \u4ece\u51fa\u751f\u5230\u6b7b\u4ea1","text":""},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#1","title":"1. \u57fa\u672c\u6982\u5ff5","text":"<ul> <li> <p>\u50cf\u7d20\uff08<code>Pixel</code>\uff09\uff1a \u6307\u53ef\u4ee5\u8868\u73b0\u4eae\u5ea6\u751a\u81f3\u8272\u5f69\u53d8\u5316\u7684\u4e00\u4e2a\u70b9\uff0c\u662f\u6784\u6210\u6570\u5b57\u56fe\u50cf\u7684\u6700\u5c0f\u5355\u4f4d\u3002\u50cf\u7d20\u5177\u6709\u5927\u5c0f\u76f8\u540c\u3001\u660e\u6697\u548c\u989c\u8272\u7684\u53d8\u5316\u3002\u7279\u70b9\u662f\u6709\u56fa\u5b9a\u7684\u4f4d\u7f6e\u548c\u7279\u5b9a\u7684\u989c\u8272\u503c\u3002</p> </li> <li> <p><code>color depth</code>\u3001<code>bit depth</code>\uff1a\u6bcf\u4e2a\u50cf\u7d20RBG\u82e5\u5404\u75288\u4f4d\u8868\u793a\uff0c<code>bit depth</code>\u5c31\u662f8bit\uff0c\u90a3\u4e48\u8fd9\u4e2a\u50cf\u7d20\u5c31\u752824\u4f4d\u8868\u793a\uff0c<code>color depth</code>\u5c31\u662f24bit\u3002\u4e00\u4e2a\u50cf\u7d20<code>color depth</code>\u8d8a\u6df1\uff0c\u50cf\u7d20\u8868\u8fbe\u7684\u989c\u8272\u548c\u4eae\u5ea6\u7684\u4f4d\u6570\u8d8a\u591a\uff0c\u6587\u4ef6\u5c31\u8d8a\u5927\u3002\u4e00\u4e2a<code>color depth</code>\u4e2d\u6bcf\u4e2a<code>channel</code>\u7684\u6df1\u5ea6\u5c31\u662f<code>bit depth</code>\u3002\u752832\u4f4d\u8868\u793a\u4e00\u4e2a\u50cf\u7d20\u7684\u8bdd\uff0cRBG\u5360\u752824\u4f4d\uff0c\u8fd8\u67098\u4f4d\u79f0\u4e3a<code>alpha channel</code>\u3002</p> </li> <li> <p><code>alpha composite</code>\u3001<code>alpha blend</code>\u3001<code>alpha channel</code>\uff1a \u6e32\u67d3\u56fe\u7247\u7684\u65f6\u5019\uff0c\u56fe\u7247\u6709\u65f6\u6709\u5f88\u591a\u56fe\u5c42\uff0c\u7136\u540e\u518d\u5c06\u591a\u4e2a\u56fe\u5c42\u7ec4\u5408\u8d77\u6765\uff0c\u8fd9\u53eb\u505a<code>alpha composite</code>\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u591a\u4e2a\u56fe\u5c42\u6bcf\u4e2a\u5bf9\u5e94\u50cf\u7d20\u5408\u6210\u7684\u8fc7\u7a0b\u53eb\u505a<code>alpha blend</code>\u3002\u900f\u8fc7\u770b\u5230\u4e0b\u4e00\u56fe\u5c42\uff0c\u5c31\u9700\u8981\u8bb0\u5f55\u4e00\u4e9b\u54ea\u91cc\u900f\u660e\u3001\u54ea\u91cc\u4e0d\u900f\u660e\u7684\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5c31\u88ab\u5b58\u5728\u4e00\u4e2a<code>alpha channel</code>\u4e2d\u4e86\u3002</p> </li> <li> <p>\u56fe\u7247\u5206\u8fa8\u7387\uff1a\u8ba1\u7b97\u673a\u663e\u793a\u7684\u56fe\u50cf\u662f\u7531\u50cf\u7d20\u70b9\u7ec4\u6210\u7684\uff0c\u56fe\u7247\u5c3a\u5bf8\u4e3a640 x 480\uff0c\u4ee3\u8868\u56fe\u7247\u6c34\u5e73\u6709640\u4e2a\u50cf\u7d20\u70b9\uff0c\u5782\u76f4\u6709480\u50cf\u7d20\u70b9\u3002</p> </li> </ul> <p>\u5404\u79cd\u56fe\u7247\u683c\u5f0f\u76ee\u7684\u662f\u5728\u7f51\u7edc\u4f20\u8f93\u548c\u5b58\u50a8\u7684\u65f6\u5019\u4f7f\u7528\u66f4\u5c11\u7684\u5b57\u8282\uff0c\u5373\u8d77\u5230\u538b\u7f29\u7684\u4f5c\u7528\uff0c\u6216\u8005\u652f\u6301\u591a\u5f20\u56fe\u7247\u7ec4\u5408\u6210\u4e00\u5f20\u52a8\u6001\u56fe\u3002\u5728\u56fe\u7247\u683c\u5f0f\u89e3\u7801\u540e\uff0c\u65e0\u8bba\u54ea\u79cd\u56fe\u7247\u7684\u683c\u5f0f\uff0c\u56fe\u7247\u6570\u636e\u90fd\u662f\u50cf\u7d20\u6570\u7ec4\u3002</p> <ul> <li>Bitmap\uff1a\u4f4d\u56fe\uff0c\u53c8\u79f0\u4e3a\u70b9\u9635\u56fe\u50cf\u3001\u50cf\u7d20\u56fe\u6216\u6805\u683c\u56fe\u50cf\uff0c\u662f\u7531\u50cf\u7d20\uff08\u56fe\u7247\u5143\u7d20\uff09\u7684\u5355\u4e2a\u70b9\u7ec4\u6210\u3002\u8fd9\u4e9b\u70b9\u53ef\u4ee5\u8fdb\u884c\u4e0d\u540c\u7684\u6392\u5217\u548c\u67d3\u8272\u4ee5\u6784\u6210\u56fe\u6837\u3002Bitmap\u7684\u627f\u8f7d\u5bb9\u5668\u662f<code>jpg</code>\u3001<code>png</code>\u7b49\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u662f\u5bf9bitmap\u7684\u538b\u7f29\u3002\u5f53jpg\u3001png\u7b49\u6587\u4ef6\u9700\u8981\u5c55\u793a\u5728\u624b\u673a\u4e0a\u7684\u63a7\u4ef6\u65f6\uff0c\u5c31\u4f1a\u89e3\u6790\u6210Bitmap\u5e76\u7ed8\u5236\u5230view\u4e0a\u3002 <p>Bitmap\u540c\u65f6\u4e5f\u8868\u793a\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u7528\u4e00\u4e2abit\u4f4d\u6765\u6807\u8bb0\u67d0\u4e2a\u5143\u7d20\u5bf9\u5e94\u7684Value\uff0c \u800cKey\u5373\u662f\u8be5\u5143\u7d20\u3002\u7531\u4e8e\u91c7\u7528\u4e86Bit\u4e3a\u5355\u4f4d\u6765\u5b58\u50a8\u6570\u636e\uff0c\u56e0\u6b64\u5728\u5b58\u50a8\u7a7a\u95f4\u65b9\u9762\uff0c\u53ef\u4ee5\u5927\u5927\u8282\u7701\u3002\u5177\u4f53\u53c2\u89c1\u4ec0\u4e48\u662fBit-map</p> </li> </ul>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#2-bitmap","title":"2. Bitmap \u603b\u89c8","text":"<p>App\u5f00\u53d1\u4e0d\u53ef\u907f\u514d\u7684\u8981\u548c\u56fe\u7247\u6253\u4ea4\u9053\uff0c\u7531\u4e8e\u5176\u5360\u7528\u5185\u5b58\u975e\u5e38\u5927\uff0c\u7ba1\u7406\u4e0d\u5f53\u5f88\u5bb9\u6613\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3\uff0c\u6700\u540eOOM\uff0c\u56fe\u7247\u7684\u80cc\u540e\u5176\u5b9e\u662fBitmap\uff0cBitmap \u5360\u5185\u5b58\u591a\u662f\u56e0\u4e3a\u5176\u50cf\u7d20\u6570\u636e(pixels)\u5927\u3002Bitmap \u50cf\u7d20\u6570\u636e\u7684\u5b58\u50a8\u5728\u4e0d\u540c Android \u7248\u672c\u4e4b\u95f4\u6709\u6240\u4e0d\u540c\uff0c\u5177\u4f53\u6765\u8bf4</p> \u7248\u672c \u5185\u5b58\u5206\u5e03 ~ Android 2.3.3(API 10) 1. \u4f4d\u56fe\u7684\u540e\u5907\u50cf\u7d20\u6570\u636e\u5b58\u50a8\u5728 Native \u5806\u4e2d\u3002Native \u5185\u5b58\u4e2d\u7684\u50cf\u7d20\u6570\u636e\u5e76\u4e0d\u4ee5\u53ef\u9884\u6d4b\u7684\u65b9\u5f0f\u91ca\u653e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u77ed\u6682\u8d85\u51fa\u5176\u5185\u5b58\u9650\u5236\u5e76\u5d29\u6e83\u3002 2. Android 2.2(API 8) \u65e0\u5e76\u53d1\u5783\u573e\u56de\u6536\u529f\u80fd, \u5f53\u53d1\u751f\u5783\u573e\u56de\u6536\u65f6\uff0c\u5e94\u7528\u7684\u7ebf\u7a0b\u4f1a\u505c\u6b62\u3002\u8fd9\u4f1a\u5bfc\u81f4\u5ef6\u8fdf\uff0c\u4ece\u800c\u964d\u4f4e\u6027\u80fd\u3002 3. Android 2.3 \u6dfb\u52a0\u4e86\u5e76\u53d1\u5783\u573e\u56de\u6536\u529f\u80fd\uff0c\u8fd9\u610f\u5473\u7740\u7cfb\u7edf\u4e0d\u518d\u5f15\u7528\u4f4d\u56fe\u540e\uff0c\u5f88\u5feb\u5c31\u4f1a\u56de\u6536\u5185\u5b58 3.0\uff08API 11\uff09~ 7.1\uff08API 25\uff09 \u50cf\u7d20\u6570\u636e\u4f1a\u4e0e\u5173\u8054\u7684\u4f4d\u56fe\u4e00\u8d77\u5b58\u50a8\u5728 Dalvik/ART \u5806\u4e0a\u3002 8.0\uff08API 26\uff09~ \u4f4d\u56fe\u50cf\u7d20\u6570\u636e\u5b58\u50a8\u5728 Native \u5806\u4e2d\u3002\u914d\u5408 NativeAllocationRegistry \u8fdb\u884c\u5783\u573e\u56de\u6536 <p>\u6ca1\u6709\u7279\u6b8a\u8bf4\u660e\uff0c\u4e0b\u9762\u6d89\u53ca\u7684\u5185\u5bb9\u90fd\u662f\u57fa\u4e8e8.0\u4e4b\u540e\u7684\u7248\u672c\u3002</p> <p>\u5148\u4ece\u6574\u4f53\u4e0a\u770b\u4e00\u4e0b Bitmap\u3002 </p> <ul> <li>\u7528\u6237\u5728\u624b\u673a\u5c4f\u5e55\u4e0a\u770b\u5230\u7684\u662f\u4e00\u5f20\u5f20\u56fe\u7247</li> <li>App \u4e2d\u8fd9\u4e9b\u56fe\u7247\u5b9e\u9645\u4e0a\u662f BitmapDrawable</li> <li>BitmapDrawable \u662f\u5bf9 Bitmap \u7684\u5305\u88c5</li> <li>Bitmap \u662f\u5bf9 SkBitmap \u7684\u5305\u88c5\u3002\u5177\u4f53\u8bf4\u6765\uff0c Bitmap \u7684\u5177\u4f53\u5b9e\u73b0\u5305\u62ec Java \u5c42\u548c JNI \u5c42\uff0cJNI \u5c42\u4f9d\u8d56 Skia\u3002</li> <li>SkBitmap \u672c\u8d28\u4e0a\u53ef\u7b80\u5355\u7406\u89e3\u4e3a\u5185\u5b58\u4e2d\u7684\u4e00\u4e2a\u5b57\u8282\u6570\u7ec4   \u6240\u4ee5\u8bf4 Bitmap \u5176\u5b9e\u662f\u4e00\u4e2a\u5b57\u8282\u6570\u7ec4, \u672c\u8d28\u4e0a\u5c31\u662f\u5185\u5b58\u4e2d\u7684\u4e00\u5757\u6570\u636e\u3002\u6240\u8c13\u521b\u5efa Bitmap\uff0c\u4e0d\u8fc7\u662f\u8c03\u7528 malloc() \u5206\u914d\u4e00\u5757\u5185\u5b58\u3002\u800c\u56de\u6536 Bitmap\uff0c\u4e0d\u8fc7\u662f\u8c03\u7528 free() \u5c06\u4e4b\u524d\u7684\u5185\u5b58\u91ca\u653e\u6389\u3002</li> </ul> <p>\u4e3a\u4ec0\u4e48 Android 2.3.3 \u4e2d Native \u7684\u5185\u5b58\u91ca\u653e\u4e0d\u53ef\u9884\u6d4b\uff1f\u5728 Java \u5bf9\u8c61\u7684 finalize \u88ab\u8c03\u7528\u65f6\u76f4\u63a5\u91ca\u653e\u7684\u65b9\u6848\u6709\u4f55\u4e0d\u59a5?Android 8.0 \u7684 NativeAllocationRegistry \u7684\u5f15\u5165\u662f\u4e3a\u4e86\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898?</p> <p>\u5e26\u7740\u7591\u95ee\uff0c\u6211\u4eec\u53bb\u4e86\u89e3\u4e0bBitmap\u5176\u5185\u5b58\u662f\u5982\u4f55\u88ab\u5206\u914d\u548c\u9500\u6bc1\u4ee5\u53ca\u5b66\u4e60\u4e00\u4e0b<code>NativeAllocationRegistry</code>\u7684\u6280\u672f\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#3-bitmap","title":"3. Bitmap \u521b\u5efa","text":"<p>\u521b\u5efa Bitmap \u7684\u65b9\u5f0f\u5f88\u591a\uff0c</p> <ul> <li>\u53ef\u4ee5\u901a\u8fc7 SDK \u63d0\u4f9b\u7684 API \u6765\u521b\u5efa Bitmap</li> <li>\u52a0\u8f7d\u67d0\u4e9b\u5e03\u5c40\u6216\u8d44\u6e90\u65f6\u4f1a\u521b\u5efa Bitmap</li> <li>Glide \u7b49\u7b2c\u4e09\u65b9\u56fe\u7247\u5e93\u4f1a\u521b\u5efa Bitmap</li> </ul> <p>\u5148\u8bf4\u901a\u8fc7 API \u521b\u5efa Bitmap\u3002SDK \u4e2d\u521b\u5efa Bitmap \u7684 API \u5f88\u591a\uff0c\u5206\u6210\u4e09\u5927\u7c7b\uff1a</p> <ul> <li>\u521b\u5efa Bitmap - <code>Bitmap.createBitmap()</code> \u65b9\u6cd5\u5728\u5185\u5b58\u4e2d\u4ece\u65e0\u5230\u6709\u5730\u521b\u5efa Bitmap</li> <li>\u62f7\u8d1d Bitmap - <code>Bitmap.copy()</code> \u4ece\u5df2\u6709\u7684 Bitmap \u62f7\u8d1d\u51fa\u4e00\u4e2a\u65b0\u7684 Bitmap</li> <li>\u89e3\u7801 - \u4ece\u6587\u4ef6\u6216\u5b57\u8282\u6570\u7ec4\u7b49\u8d44\u6e90\u89e3\u7801\u5f97\u5230 Bitmap\uff0c\u8fd9\u662f\u6700\u5e38\u89c1\u7684\u521b\u5efa\u65b9\u5f0f</li> <li>BitmapFactory.decodeResource()</li> <li>ImageDecoder.decodeBitmap\u3002ImageDecoder \u662f Android 9.0 \u65b0\u52a0\u7684\u7c7b</li> </ul> <p>\u5047\u5982 <code>resId</code> \u5bf9\u5e94\u7684\u662f\u4e00\u5f20\u56fe\u7247\u3002\u52a0\u8f7d\u5982\u4e0b\u5e03\u5c40\u6587\u4ef6\u65f6\u4f1a\u521b\u5efa\u4e00\u4e2a Bitmap\uff1a</p> <pre><code>&lt;ImageView android:src=\"@drawable/resId\"&gt;\n</code></pre> <p>\u4ee3\u7801\u4e2d\u52a0\u8f7d\u8d44\u6e90\u4e5f\u4f1a\u521b\u5efa\u51fa\u4e00\u4e2a Bitmap\uff1a</p> <pre><code>Drawable drawable = Resources.getDrawable(resId)\n</code></pre> <p>\u5b9e\u9645\u9879\u76ee\u4e2d\u5f80\u5f80\u4e0d\u662f\u76f4\u63a5\u8c03\u7528 API \u6765\u521b\u5efa Bitmap\uff0c\u800c\u662f\u4f7f\u7528 Glide \u6216 Picosso \u7b49\u7b2c\u4e09\u65b9\u56fe\u7247\u5e93\u3002\u8fd9\u4e9b\u5e93\u6210\u719f\u7a33\u5b9a\uff0c\u63a5\u53e3\u6613\u7528\uff0c\u5f00\u53d1\u4e2d\u5904\u7406 Bitmap \u53d8\u5f97\u8f7b\u677e\u3002</p> <pre><code>Glide.with(this).load(\"http://goo.gl/gEgYUd\").into(imageView);\n</code></pre> <p>\u4ee5 Glide \u4e3a\u4f8b\uff0c\u53ea\u8981\u4e00\u884c\u4ee3\u7801\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u4ece\u7f51\u7edc\u4e0a\u52a0\u8f7d\u4e00\u5f20\u56fe\u7247\u3002\u4f46\u53e6\u4e00\u65b9\u9762\uff0cGlide \u4e5f\u8ba9 Bitmap \u7684\u521b\u5efa\u66f4\u52a0\u591a\u6837\u548c\u590d\u6742\u3002</p> <p>\u592a\u591a\u7684\u521b\u5efa Bitmap \u7684\u65b9\u5f0f\uff0c\u7b80\u76f4\u8ba9\u4eba\u5934\u5927\u3002\u4f46\u597d\u5728\u65e0\u8bba\u54ea\u79cd\u521b\u5efa\u65b9\u5f0f\uff0c\u6700\u7ec8\u6b8a\u9014\u540c\u5f52\u3002\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <p>Java \u5c42\u7684\u521b\u5efa Bitmap \u7684 \u6240\u6709 API \u8fdb\u5165\u5230 Native \u5c42\u540e\uff0c\u5168\u90fd\u4f1a\u8d70\u8fd9\u56db\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u8d44\u6e90\u8f6c\u6362 - \u8fd9\u4e00\u6b65\u5c06 Java \u5c42\u4f20\u6765\u7684\u4e0d\u540c\u7c7b\u578b\u7684\u8d44\u6e90\u8f6c\u6362\u6210\u89e3\u7801\u5668\u53ef\u8bc6\u522b\u7684\u6570\u636e\u7c7b\u578b</li> <li>\u5185\u5b58\u5206\u914d - \u8fd9\u4e00\u6b65\u662f\u5206\u914d\u5185\u5b58\uff0c\u5206\u914d\u65f6\u4f1a\u662f\u5426\u590d\u7528 Bitmap \u7b49\u56e0\u7d20</li> <li>\u56fe\u7247\u89e3\u7801 - \u5b9e\u9645\u7684\u89e3\u7801\u5de5\u4f5c\u7531\u7b2c\u4e09\u65b9\u5e93\uff0c\u89e3\u7801\u7ed3\u679c\u586b\u5728\u4e0a\u4e00\u6b65\u5206\u914d\u7684\u5185\u5b58\u4e2d\u3002\u6ce8\uff0c<code>Bitmap.createBitmap()</code> \u548c <code>Bitmap.copy()</code> \u521b\u5efa\u7684 Bitmap \u4e0d\u9700\u8981\u8fdb\u884c\u56fe\u7247\u89e3\u7801</li> <li>\u521b\u5efa\u5bf9\u8c61 - \u8fd9\u4e00\u6b65\u521b\u5efa Java \u5bf9\u8c61\uff0c\u5c06\u5305\u542b\u89e3\u7801\u6570\u636e\u7684\u5185\u5b58\u5757\u5305\u88c5\u6210 Java \u5c42\u7684 <code>android.graphics.Bitmap</code> \u5bf9\u8c61</li> </ul> <p>\u4ece\u4e0a\u9762\u53ef\u4ee5 BitmapFactory.doDecode() \u51fd\u6570\u662f\u521b\u5efa Bitmap \u7684\u6838\u5fc3\uff0c\u5b83\u8d1f\u8d23\u5185\u5b58\u5206\u914d\u548c\u56fe\u7247\u89e3\u7801\uff0c\u5176\u5173\u952e\u6b65\u9aa4\u5305\u62ec\uff1a</p> <ol> <li>Update with options supplied by the client.</li> <li>Create the codec.</li> <li>Handle sampleSize. (\u8ddf BitmapFactory.Options.inSampleSize \u53c2\u6570\u76f8\u5173)</li> <li>Set the decode colorType.</li> <li>Handle scale. (\u8ddf BitmapFactory.Options.inScaled \u53c2\u6570\u76f8\u5173)</li> <li>Handle reuseBitmap (\u8ddf BitmapFactory.Options.inBitmap \u53c2\u6570\u76f8\u5173)</li> <li>Choose decodeAllocator</li> <li>Construct a color table</li> <li>AllocPixels</li> <li>Use SkAndroidCodec to perform the decode.</li> <li>Create the java bitmap</li> </ol> <p>\u6211\u4eec\u4ee5<code>BitmapFactory#decodeFile</code>\u4e3a\u4f8b\uff0c\u7b80\u5355\u770b\u770bbitmap\u521b\u5efa\u8fc7\u7a0b\u3002</p> <p><pre><code>  public static Bitmap decodeFile(String pathName, Options opts) {\n...\ntry {\nstream = new FileInputStream(pathName);\nbm = decodeStream(stream, null, opts);\n} catch (Exception e) {\n...\nreturn bm;\n}\npublic static Bitmap decodeStream(@Nullable InputStream is, @Nullable Rect outPadding,\n@Nullable Options opts) {\n...\nif (is instanceof AssetManager.AssetInputStream) {\nfinal long asset = ((AssetManager.AssetInputStream) is).getNativeAsset();\nbm = nativeDecodeAsset(asset, outPadding, opts, Options.nativeInBitmap(opts),\nOptions.nativeColorSpace(opts));\n} else {\n// \u5047\u8bbe\u662f\u666e\u901a\u6587\u4ef6\uff0c\u8c03\u7528\u5230\u8fd9\u91cc\nbm = decodeStreamInternal(is, outPadding, opts);\n}\n...\nreturn bm;\n}\nprivate static Bitmap decodeStreamInternal(@NonNull InputStream is,\n@Nullable Rect outPadding, @Nullable Options opts) {\n// ASSERT(is != null);\nbyte [] tempStorage = null;\nif (opts != null) tempStorage = opts.inTempStorage;\nif (tempStorage == null) tempStorage = new byte[DECODE_BUFFER_SIZE];\nreturn nativeDecodeStream(is, tempStorage, outPadding, opts,\nOptions.nativeInBitmap(opts),\nOptions.nativeColorSpace(opts));\n}\n</code></pre> BitmapFactory.cpp <pre><code>static jobject nativeDecodeStream(JNIEnv* env, jobject clazz, jobject is, jbyteArray storage,\njobject padding, jobject options) {\njobject bitmap = NULL;\n// 1. \u8d44\u6e90\u8f6c\u6362 Stream-&gt;SkStream-&gt;SkStreamRewindable\nstd::unique_ptr&lt;SkStream&gt; stream(CreateJavaInputStreamAdaptor(env, is, storage));\nif (stream.get()) {\nstd::unique_ptr&lt;SkStreamRewindable&gt; bufferedStream(\nSkFrontBufferedStream::Create(stream.release(), SkCodec::MinBufferedBytesNeeded()));\nSkASSERT(bufferedStream.get() != NULL);\nbitmap = doDecode(env, bufferedStream.release(), padding, options);\n}\nreturn bitmap;\n}\nstatic jobject doDecode(JNIEnv* env, std::unique_ptr&lt;SkStreamRewindable&gt; stream,\njobject padding, jobject options) {\n...                    // 2.\u6839\u636estream\u7279\u70b9\u521b\u5efa\u89e3\u7801\u5668\nNinePatchPeeker peeker;\nstd::unique_ptr&lt;SkAndroidCodec&gt; codec;\n{\nSkCodec::Result result;\nstd::unique_ptr&lt;SkCodec&gt; c = SkCodec::MakeFromStream(std::move(stream), &amp;result,\n&amp;peeker);\nif (!c) {\nSkString msg;\nmsg.printf(\"Failed to create image decoder with message '%s'\",\nSkCodec::ResultToString(result));\nreturn nullObjectReturn(msg.c_str());\n}\ncodec = SkAndroidCodec::MakeFromCodec(std::move(c));\nif (!codec) {\nreturn nullObjectReturn(\"SkAndroidCodec::MakeFromCodec returned null\");\n}\n}\n...\n// 3. \u521b\u5efa\u5185\u5b58\u5206\u914d\u5668\nHeapAllocator defaultAllocator;\nRecyclingPixelAllocator recyclingAllocator(reuseBitmap, existingBufferSize);\nScaleCheckingAllocator scaleCheckingAllocator(scale, existingBufferSize);\nSkBitmap::HeapAllocator heapAllocator;\nSkBitmap::Allocator* decodeAllocator;\nif (javaBitmap != nullptr &amp;&amp; willScale) {\n// This will allocate pixels using a HeapAllocator, since there will be an extra\n// scaling step that copies these pixels into Java memory.  This allocator\n// also checks that the recycled javaBitmap is large enough.\ndecodeAllocator = &amp;scaleCheckingAllocator;\n} else if (javaBitmap != nullptr) {\ndecodeAllocator = &amp;recyclingAllocator;\n} else if (willScale || isHardware) {\n// This will allocate pixels using a HeapAllocator,\n// for scale case: there will be an extra scaling step.\n// for hardware case: there will be extra swizzling &amp; upload to gralloc step.\ndecodeAllocator = &amp;heapAllocator;\n} else {\ndecodeAllocator = &amp;defaultAllocator;\n}\n...\n// 4. \u5206\u914d\u5185\u5b58\nSkBitmap decodingBitmap;\nif (!decodingBitmap.setInfo(bitmapInfo) ||\n!decodingBitmap.tryAllocPixels(decodeAllocator)) {\nreturn nullptr;\n}\n...\n// 5. \u56fe\u7247\u89e3\u7801\nSkCodec::Result result = codec-&gt;getAndroidPixels(decodeInfo, decodingBitmap.getPixels(),\ndecodingBitmap.rowBytes(), &amp;codecOptions);\nswitch (result) {\ncase SkCodec::kSuccess:\ncase SkCodec::kIncompleteInput:\nbreak;\ndefault:\nreturn nullObjectReturn(\"codec-&gt;getAndroidPixels() failed.\");\n}\n...\n// 6. \u521b\u5efajava\u5bf9\u8c61\nreturn bitmap::createBitmap(env, defaultAllocator.getStorageObjAndReset(),\nbitmapCreateFlags, ninePatchChunk, ninePatchInsets, -1);\n}\n</code></pre></p> <p>\u4e0b\u9762\u8be6\u7ec6\u5c55\u5f00\u63cf\u8ff0\u4e0b</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#31","title":"3.1. \u8d44\u6e90\u8f6c\u6362","text":"<p>\u5728 JNI \u5c42\u5c06Java \u5c42\u7684\u5f85\u89e3\u7801\u8d44\u6e90\uff08\u5305\u542b<code>File</code>,<code>Resource</code>,<code>ByteArray</code>,<code>Stream</code>,<code>FileDescriptor</code>\uff09\u91cd\u65b0\u5212\u5206\u6210\u56db\u79cd\uff0c\u5305\u62ec\uff1a<code>DecodeFileDescriptor</code>,<code>DecodeStream</code>,<code>DecodeByteArray</code>,<code>DecodeAsset</code></p> <p><code>BitmapFactory</code> \u63d0\u4f9b\u56db\u4e2a\u65b9\u6cd5\u5bf9\u8d44\u6e90\u8fdb\u884c\u8f6c\u6362\uff0c\u6240\u6709\u7684\u8d44\u6e90\u90fd\u4f1a\u8f6c\u6362\u6210\u4e0e <code>SkStreamRewindable</code> \u517c\u5bb9\u7684\u6570\u636e</p> <pre><code>nativeDecodeFileDescriptor()\nnativeDecodeStream()\nnativeDecodeByteArray()\nnativeDecodeAsset()\n</code></pre> <p></p> <p>\u6700\u540e\uff0cBitmapFactory.doDecode() \u7edf\u4e00\u89e3\u7801\u5904\u7406 <code>SkStreamRewindable</code>\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#32","title":"3.2. \u5185\u5b58\u5206\u914d","text":"<p>\u89e3\u7801\u524d\u7684\u7b2c\u4e8c\u9879\u5de5\u4f5c\u662f\u5185\u5b58\u5206\u914d\u3002</p> <p>\u9996\u5148\u662f\u9009\u62e9 <code>decodeAllocator</code> (\u89c1\u4e0a\u6587\u63d0\u5230\u7684 <code>BitmapFactory.doDecode()</code> \u7684\u7b2c7\u6b65)\u3002\u6709\u4ee5\u4e0b\u51e0\u79cd Allocator \u53ef\u4f9b\u9009\u62e9\uff1a</p> <p></p> <p>\u9009\u62e9 Allocator \u65f6\u8003\u8651\u7684\u56e0\u7d20\u5305\u62ec\uff1a\u662f\u5426\u590d\u7528\u5df2\u6709 Bitmap\uff0c\u662f\u5426\u4f1a\u7f29\u653e Bitmap\uff0c\u662f\u5426\u662f Hardware Bitmap\u3002\u9009\u62e9\u7b56\u7565\u603b\u7ed3\u5982\u4e0b\uff1a</p> \u662f\u5426\u590d\u7528\u5df2\u6709 Bitmap \u662f\u5426\u4f1a\u7f29\u653e Bitmap \u662f\u5426\u662f Hardware Bitmap Allocator\u7c7b\u578b \u662f \u662f - ScaleCheckingAllocator \u662f \u5426 - RecyclingPixelAllocator \u5426 \u662f \u662f SkBitmap::HeapAllocator - - - HeapAllocator (\u7f3a\u7701\u7684Allocator) <p>\u63a5\u4e0b\u6765\uff0c\u4f7f\u7528\u9009\u5b9a\u7684 Allocator \u5206\u914d\u5185\u5b58\u3002</p> <pre><code>BitmapFactory.doDecode() -&gt;\n    SkBitmap.tryAllocPixels() -&gt;\n            Allocator.allocPixelRef()\n</code></pre> <p>\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>// BitmapFactory.cpp\nstatic jobject doDecode() {\n...\nSkBitmap decodingBitmap;\nif (!decodingBitmap.setInfo(bitmapInfo) ||\n!decodingBitmap.tryAllocPixels(decodeAllocator, colorTable.get())) {\n// SkAndroidCodec should recommend a valid SkImageInfo, so setInfo()\n// should only only fail if the calculated value for rowBytes is too\n// large.\n// tryAllocPixels() can fail due to OOM on the Java heap, OOM on the\n// native heap, or the recycled javaBitmap being too small to reuse.\nreturn nullptr;\n}\n...\n}\n// SkBitmap.cpp https://github.com/google/skia/blob/master/src/core/SkBitmap.cpp#L213\nbool SkBitmap::tryAllocPixels(Allocator* allocator) {\nHeapAllocator stdalloc;\nif (nullptr == allocator) {\nallocator = &amp;stdalloc;\n}\nreturn allocator-&gt;allocPixelRef(this);\n}\n</code></pre> <p>Allocator \u7684\u7c7b\u578b\u6709\u56db\u79cd\uff0c\u6211\u4eec\u53ea\u770b\u5176\u4e2d\u7684\u4e24\u79cd\u3002</p> <ul> <li> <p>\u5148\u770b <code>SkBitmap::HeapAllocator</code> \u4f5c\u4e3a Allocator \u8fdb\u884c\u5185\u5b58\u5206\u914d\u7684\u6d41\u7a0b\u3002</p> </li> <li> <p>SkBitmap::tryAllocPixels</p> </li> <li>SkBitmap::HeapAllocator::allocPixelRef</li> <li>SkMallocPixelRef::MakeAllocate</li> <li>sk_calloc_canfail</li> <li>sk_malloc_flags</li> </ul> <p>\u5bf9\u5e94\u7684\u4ee3\u7801\u5982\u4e0b(\u53ef\u4ee5\u770b\u5230\u6700\u7ec8\u4f1a\u8c03\u7528 <code>malloc()</code> \u5206\u914d\u6307\u5b9a\u5927\u5c0f\u7684\u5185\u5b58)\uff1a</p> <pre><code>// SkMallocPixelRef.cpp\nsk_sp&lt;SkPixelRef&gt; SkMallocPixelRef::MakeAllocate(const SkImageInfo&amp; info, size_t rowBytes) {\n...\nvoid* addr = sk_calloc_canfail(size);\n...\n}\n// SkMalloc.h\nstatic inline void* sk_calloc_canfail(size_t size) {\n#if defined(IS_FUZZING_WITH_LIBFUZZER)\n// The Libfuzzer environment is very susceptible to OOM, so to avoid those\n// just pretend we can't allocate more than 200kb.\nif (size &gt; 200000) {\nreturn nullptr;\n}\n#endif\nreturn sk_malloc_flags(size, SK_MALLOC_ZERO_INITIALIZE);\n}\n// SkMemory_malloc.cpp\nvoid* sk_malloc_flags(size_t size, unsigned flags) {\nvoid* p;\nif (flags &amp; SK_MALLOC_ZERO_INITIALIZE) {\np = calloc(size, 1);\n} else {\np = malloc(size);\n}\nif (flags &amp; SK_MALLOC_THROW) {\nreturn throw_on_failure(size, p);\n} else {\nreturn p;\n}\n}\n/** We explicitly use the same allocator for our pixels that SkMask does,\n so that we can freely assign memory allocated by one class to the other.\n */\nbool SkBitmap::HeapAllocator::allocPixelRef(SkBitmap* dst) {\nconst SkImageInfo info = dst-&gt;info();\nif (kUnknown_SkColorType == info.colorType()) {\n//        SkDebugf(\"unsupported config for info %d\\n\", dst-&gt;config());\nreturn false;\n}\nsk_sp&lt;SkPixelRef&gt; pr = SkMallocPixelRef::MakeAllocate(info, dst-&gt;rowBytes());\nif (!pr) {\nreturn false;\n}\ndst-&gt;setPixelRef(std::move(pr), 0, 0);\nSkDEBUGCODE(dst-&gt;validate();)\nreturn true;\n}\nvoid SkBitmap::setPixelRef(sk_sp&lt;SkPixelRef&gt; pr, int dx, int dy) {\n...\nfPixelRef = kUnknown_SkColorType != this-&gt;colorType() ? std::move(pr) : nullptr;\nvoid* p = nullptr;\nsize_t rowBytes = this-&gt;rowBytes();\n// ignore dx,dy if there is no pixelref\nif (fPixelRef) {\nrowBytes = fPixelRef-&gt;rowBytes();\n// TODO(reed):  Enforce that PixelRefs must have non-null pixels.\np = fPixelRef-&gt;pixels();\nif (p) {\np = (char*)p + dy * rowBytes + dx * this-&gt;bytesPerPixel();\n}\n}\nSkPixmapPriv::ResetPixmapKeepInfo(&amp;fPixmap, p, rowBytes);\n...\n}\n</code></pre> <ul> <li> <p>\u518d\u6765\u770b <code>HeapAllocator</code> \u4f5c\u4e3a Allocator \u8fdb\u884c\u5185\u5b58\u5206\u914d\u7684\u6d41\u7a0b\u3002</p> </li> <li> <p>SkBitmap::tryAllocPixels</p> </li> <li>HeapAllocator::allocPixelRef</li> <li>android::Bitmap::allocateHeapBitmap</li> </ul> <p>\u5bf9\u5e94\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>// GraphicsJNI.h https://android.googlesource.com/platform/frameworks/base/+/refs/heads/oreo-release/core/jni/android/graphics/GraphicsJNI.h#125\nclass HeapAllocator : public SkBRDAllocator {\npublic:\nHeapAllocator() { };\n~HeapAllocator() { };\nvirtual bool allocPixelRef(SkBitmap* bitmap, SkColorTable* ctable) override;\n/**\n     * Fetches the backing allocation object. Must be called!\n     */\nandroid::Bitmap* getStorageObjAndReset() {\nreturn mStorage.release();\n};\nSkCodec::ZeroInitialized zeroInit() const override { return SkCodec::kYes_ZeroInitialized; }\nprivate:\nsk_sp&lt;android::Bitmap&gt; mStorage;\n};\n// Graphics.cpp https://android.googlesource.com/platform/frameworks/base/+/refs/heads/oreo-release/core/jni/android/graphics/Graphics.cpp#616\nbool HeapAllocator::allocPixelRef(SkBitmap* bitmap, SkColorTable* ctable) {\n// \u521b\u5efa Native Bitmap \u5bf9\u8c61\uff0c\u5e76\u5c06\u6307\u9488\u8bb0\u5f55\u5230 HeapAllocator#mStorage \u5b57\u6bb5\u4e2d\nmStorage = android::Bitmap::allocateHeapBitmap(bitmap, ctable);\nreturn !!mStorage;\n}\n// Bitmap.cpp https://android.googlesource.com/platform/frameworks/base/+/refs/heads/oreo-release/libs/hwui/hwui/Bitmap.cpp#86\nstatic sk_sp&lt;Bitmap&gt; allocateHeapBitmap(size_t size, const SkImageInfo&amp; info, size_t rowBytes) {\n// \u4f7f\u7528\u5e93\u51fd\u6570 calloc \u5206\u914d size*1 \u7684\u8fde\u7eed\u7a7a\u95f4\nvoid* addr = calloc(size, 1);\nif (!addr) {\nreturn nullptr;\n}\n// \u521b\u5efa Native Bitmap \u5bf9\u8c61\nreturn sk_sp&lt;Bitmap&gt;(new Bitmap(addr, size, info, rowBytes));\n}\nBitmap::Bitmap(void* address, size_t size, const SkImageInfo&amp; info, size_t rowBytes, SkColorTable* ctable)\n: SkPixelRef(info)\n, mPixelStorageType(PixelStorageType::Heap) {\n// \u6307\u5411\u50cf\u7d20\u6570\u636e\u7684\u5185\u5b58\u6307\u9488\nmPixelStorage.heap.address = address;\n// \u50cf\u7d20\u6570\u636e\u5927\u5c0f\nmPixelStorage.heap.size = size;\nreconfigure(info, rowBytes, ctable);\n}\n</code></pre> <p>\u5bf9\u4e8e <code>RecyclingPixelAllocator</code> \u548c <code>ScaleCheckingAllocator</code> \u7684\u60c5\u51b5\uff0c\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u5206\u6790\u3002</p> <p>\u65e0\u8bba\u54ea\u79cd Allocator\uff0c\u6700\u7ec8\u8981\u4e48\u8c03\u7528 <code>malloc()</code> \u5206\u914d\u5185\u5b58\uff0c\u8981\u4e48\u590d\u7528\u4e4b\u524d\u5206\u914d\u7684\u5185\u5b58\u3002\u5206\u914d/\u590d\u7528\u5b8c\u6210\u540e\uff0c\u7531 <code>SkBitmap</code> \u6765\u6301\u6709\u3002</p> <p>\u6ce8\uff1a</p> <ul> <li>\u51c6\u786e\u6765\u8bf4\uff0c<code>SkBitmap::HeapAllocator</code> \u5206\u914d\u5185\u5b58\u7531 SkBitmap \u7684 SkPixmap \u6301\u6709\uff0c\u800c\u4e0d\u662f SkBitmap \u6301\u6709\u3002\u5ffd\u7565\u8fd9\u4e2a\u7ec6\u8282</li> <li>\u51c6\u786e\u6765\u8bf4\uff0c<code>HeapAllocator</code> \u5206\u914d\u7684\u5185\u5b58\u662f\u7531 <code>android::Bitmap.mStorage</code> \u6301\u6709\uff0c\u800c\u4e0d\u662f SkBitmap \u6301\u6709\u3002\u4f46 <code>android::Bitmap</code> \u4e0e SkBitmap \u6709\u67d0\u79cd\u5173\u8054\uff0c\u6240\u4ee5\u53ef\u4ee5\u5ffd\u7565\u8fd9\u4e2a\u7ec6\u8282</li> </ul>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#33","title":"3.3. \u56fe\u7247\u89e3\u7801","text":"<p>\u5728 Skia \u4e2d <code>SkCodec</code> \u4ee3\u8868\u89e3\u7801\u5668\uff0c\u89e3\u7801\u5668\u7684\u7c7b\u5c42\u6b21\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p></p> <p>Skia \u5c06\u5b9e\u9645\u7684\u89e3\u7801\u5de5\u4f5c\u4ea4\u7531\u7b2c\u4e09\u65b9\u5e93\uff0c\u4e0d\u540c\u56fe\u7247\u683c\u5f0f\u6709\u5404\u81ea\u5bf9\u5e94\u7684\u89e3\u7801\u5668\u3002\u6bd4\u5982 PNG \u56fe\u7247\u7531 <code>SkPngCodec</code> \u89e3\u7801\uff0c\u800c <code>SkPngCodec</code> \u5b9e\u9645\u4e0a\u662f\u5bf9 libpng \u7684\u5c01\u88c5\u3002</p> <p>\u524d\u9762\u63d0\u5230 <code>BitmapFactory.doDecode()</code> \u7684\u7b2c2\u6b65\u662f\u521b\u5efa\u89e3\u7801\u5668\uff0c\u7b2c10\u6b65\u662f\u8c03\u7528\u8be5\u89e3\u7801\u5668\u8fdb\u884c\u89e3\u7801\u3002</p> <ul> <li>SkCodec::MakeFromStream() \u6839\u636e\u56fe\u7247\u683c\u5f0f\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684 <code>SkCodec</code>\uff0c\u6bd4\u5982\u4e3a PNG \u56fe\u7247\u9009\u62e9 <code>SkPngCodec</code></li> <li>SkAndroidCodec::MakeFromStream() \u521b\u5efa <code>SkAndroidCodec</code>\uff0c \u5b83\u662f\u4e0a\u4e00\u6b65\u521b\u5efa\u7684 <code>SkCodec</code> \u7684\u4ee3\u7406\u3002<code>SkAndroidCodec</code> \u7684\u5177\u4f53\u7c7b\u578b\u8ddf\u56fe\u7247\u683c\u5f0f\u6709\u5173\u3002PNG\uff0cJPEG\uff0cGIF\uff0cBMP \u7b49\u683c\u5f0f\u65f6\u5176\u7c7b\u578b\u662f <code>SkSampledCodec</code>\uff0cWEBP \u683c\u5f0f\u65f6\u662f <code>SkAndroidCodecAdapter</code></li> <li>\u8c03\u7528 SkAndroidCodec.getAndroidPixels() \u89e3\u7801</li> </ul> <p>\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>static jobject doDecode() {\n...\nSkCodec::Result result = codec-&gt;getAndroidPixels(decodeInfo, decodingBitmap.getPixels(),\ndecodingBitmap.rowBytes(), &amp;codecOptions);\n...\n}\n</code></pre> <p>\u4ee5 PNG \u56fe\u7247\u4e3a\u4f8b\u6765\u5206\u6790\u3002</p> <p>\u9996\u5148\uff0c\u5bf9\u4e8e PNG \u56fe\u7247 <code>codec</code> \u662f <code>SkSampledCodec</code>\uff0c <code>SkSampledCodec</code> \u4f7f\u7528\u7684\u89e3\u7801\u5668\u662f <code>SkPngCodec</code> (\u89c1 <code>SkAndroidCodec.fCodec</code> \u5b57\u6bb5)\u3002</p> <p></p> <p>\u7b2c\u4e00\u6b65\u662f\u8c03\u7528 <code>codec-&gt;getAndroidPixels()</code> \u65b9\u6cd5\u3002\u6ce8\u610f\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6b63\u662f\u4e0a\u4e00\u6b65\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u3002</p> <p>\u63a5\u4e0b\u6765\u662f\u4e00\u7cfb\u5217\u51fd\u6570\u8c03\u7528\u3002\u6ce8\u610f\u4f20\u5165\u7684\u5185\u5b58\u5730\u5740\u53c2\u6570 <code>dst</code> \u5373\u53ef\uff0c\u5176\u4ed6\u7ec6\u8282\u5ffd\u7565\u3002</p> <p>\u7136\u540e\u4f1a\u6267\u884c\u5230 <code>SkPngCodec.onGetPixels()</code> \u65b9\u6cd5\u3002\u5b83\u4f7f\u7528 libpng \u5e93\u89e3\u7801 PNG \u56fe\u7247\u3002</p> <pre><code>SkCodec::Result SkPngCodec::onGetPixels(const SkImageInfo&amp; dstInfo, void* dst,\nsize_t rowBytes, const Options&amp; options,\nint* rowsDecoded) {\nResult result = this-&gt;initializeXforms(dstInfo, options);\nif (kSuccess != result) {\nreturn result;\n}\nif (options.fSubset) {\nreturn kUnimplemented;\n}\nthis-&gt;allocateStorage(dstInfo);\nthis-&gt;initializeXformParams();\nreturn this-&gt;decodeAllRows(dst, rowBytes, rowsDecoded);\n}\n</code></pre> <p>\u6700\u7ec8\uff0c\u89e3\u7801\u7ed3\u679c\u4fdd\u5b58\u5728 <code>dst</code> \u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#34-java","title":"3.4. \u521b\u5efaJava\u5bf9\u8c61","text":"<p>\u89e3\u7801\u5b8c\u6210\u540e\u5f97\u5230 Native \u5c42\u7684 <code>SkBitmap</code> \u5bf9\u8c61\uff0c\u6700\u540e\u4e00\u6b65\u5de5\u4f5c\u662f\u5c06\u5176\u5c01\u88c5\u6210 Java \u5c42\u53ef\u4ee5\u4f7f\u7528\u7684 <code>Bitmap</code> \u5bf9\u8c61\u3002</p> <p>\u8fd9\u4e00\u6b65\u7684\u8fc7\u7a0b\u76f8\u5bf9\u7b80\u5355\uff0c\u5206\u4e3a\u4e09\u6b65\uff1a</p> <pre><code>BitmapFactory.doDecode() -&gt;\n    Bitmap.createBitmap() -&gt;\n            Java Bitmap \u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u4fdd\u5b58 `mNativePtr` (\u50cf\u7d20\u6570\u636e\u5185\u5b58\u5757\u7684\u5730\u5740)\n</code></pre> <p>\u5bf9\u5e94\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>// BitmapFactory.cpp\nstatic jobject doDecode() {\nSkBitmap decodingBitmap;    ...\nSkCodec::Result result = ...\nSkBitmap outputBitmap;\noutputBitmap.swap(decodingBitmap);                ...\n// now create the java bitmap\nreturn bitmap::createBitmap(env, defaultAllocator.getStorageObjAndReset(),\nbitmapCreateFlags, ninePatchChunk, ninePatchInsets, -1);    }\n// Bitmap.cpp\njobject createBitmap(JNIEnv* env, Bitmap* bitmap,\nint bitmapCreateFlags, jbyteArray ninePatchChunk, jobject ninePatchInsets,\nint density) {\nbool isMutable = bitmapCreateFlags &amp; kBitmapCreateFlag_Mutable;\nbool isPremultiplied = bitmapCreateFlags &amp; kBitmapCreateFlag_Premultiplied;\n// The caller needs to have already set the alpha type properly, so the\n// native SkBitmap stays in sync with the Java Bitmap.\nassert_premultiplied(bitmap-&gt;info(), isPremultiplied);\nBitmapWrapper* bitmapWrapper = new BitmapWrapper(bitmap);\njobject obj = env-&gt;NewObject(gBitmap_class, gBitmap_constructorMethodID,\nreinterpret_cast&lt;jlong&gt;(bitmapWrapper), bitmap-&gt;width(), bitmap-&gt;height(), density,\nisMutable, isPremultiplied, ninePatchChunk, ninePatchInsets);\nif (env-&gt;ExceptionCheck() != 0) {\nALOGE(\"*** Uncaught exception returned from Java call!\\n\");\nenv-&gt;ExceptionDescribe();\n}\nreturn obj;\n}\n</code></pre> <pre><code>// Bitmap.java\npublic final class Bitmap implements Parcelable {\n// Convenience for JNI access\nprivate final long mNativePtr;    /**\n     * Private constructor that must received an already allocated native bitmap\n     * int (pointer).\n     */\n// called from JNI\nBitmap(long nativeBitmap, int width, int height, int density,\nboolean isMutable, boolean requestPremultiplied,\nbyte[] ninePatchChunk, NinePatch.InsetStruct ninePatchInsets) {\nif (nativeBitmap == 0) {\nthrow new RuntimeException(\"internal error: native bitmap is 0\");\n}\n...\nmNativePtr = nativeBitmap;\n...        }\n}\n</code></pre> <p>\u81f3\u6b64\uff0cJava \u5c42\u7684 <code>Bitmap</code> \u5bf9\u8c61\u521b\u5efa\u5b8c\u6bd5\uff0c\u5b83\u5728\u5185\u5b58\u4e2d\u5927\u81f4\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#4","title":"4. \u9500\u6bc1","text":"<p>Java \u5c42\u7684 Bitmap \u5bf9\u8c61\u6709\u70b9\u7279\u522b\uff0c\u7279\u522b\u4e4b\u5904\u5728\u4e8e\u5176\u50cf\u7d20\u6570\u636e\u4fdd\u5b58\u5728 native heap\u3002\u6211\u4eec\u77e5\u9053\uff0c native heap \u5e76\u4e0d\u88ab JVM \u7ba1\u7406\uff0c\u90a3\u5982\u4f55\u4fdd\u8bc1 Bitmap \u5bf9\u8c61\u672c\u8eab\u88ab GC \u540e native heap \u4e2d\u7684\u5185\u5b58\u4e5f\u80fd\u6b63\u786e\u56de\u6536\u5462\uff1f</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#41-recycle","title":"4.1. recycle","text":"<p>\u9996\u5148\u60f3\u5230\u7684\u662f\u5728\u4ee3\u7801\u4e3b\u52a8\u8c03\u7528 Bitmap.recycle() \u65b9\u6cd5\u6765\u91ca\u653e native \u5185\u5b58\u3002</p> <p>\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u6765\u770b\u5177\u4f53\u4ee3\u7801\u3002</p> <pre><code>    /**\n     * Free the native object associated with this bitmap, and clear the\n     * reference to the pixel data. This will not free the pixel data synchronously;\n     * it simply allows it to be garbage collected if there are no other references.\n     * The bitmap is marked as \"dead\", meaning it will throw an exception if\n     * getPixels() or setPixels() is called, and will draw nothing. This operation\n     * cannot be reversed, so it should only be called if you are sure there are no\n     * further uses for the bitmap. This is an advanced call, and normally need\n     * not be called, since the normal GC process will free up this memory when\n     * there are no more references to this bitmap.\n     */\npublic void recycle() {\nif (!mRecycled &amp;&amp; mNativePtr != 0) {\nif (nativeRecycle(mNativePtr)) {\n// return value indicates whether native pixel object was actually recycled.\n// false indicates that it is still in use at the native level and these\n// objects should not be collected now. They will be collected later when the\n// Bitmap itself is collected.\nmNinePatchChunk = null;\n}\nmRecycled = true;\n}\n}\n</code></pre> <pre><code>// Bitmap.cpp https://android.googlesource.com/platform/frameworks/base/+/refs/heads/oreo-release/core/jni/android/graphics/Bitmap.cpp#872\nstatic jboolean Bitmap_recycle(JNIEnv* env, jobject, jlong bitmapHandle) {\nLocalScopedBitmap bitmap(bitmapHandle);\nbitmap-&gt;freePixels();\nreturn JNI_TRUE;\n}\n// Convenience class that does not take a global ref on the pixels, relying\n// on the caller already having a local JNI ref\nclass LocalScopedBitmap {\npublic:\nexplicit LocalScopedBitmap(jlong bitmapHandle)\n: mBitmapWrapper(reinterpret_cast&lt;BitmapWrapper*&gt;(bitmapHandle)) {}\nBitmapWrapper* operator-&gt;() {\nreturn mBitmapWrapper;\n}\nvoid* pixels() {\nreturn mBitmapWrapper-&gt;bitmap().pixels();\n}\nbool valid() {\nreturn mBitmapWrapper &amp;&amp; mBitmapWrapper-&gt;valid();\n}\nprivate:\nBitmapWrapper* mBitmapWrapper;\n};\nclass BitmapWrapper {\npublic:\nBitmapWrapper(Bitmap* bitmap)\n: mBitmap(bitmap) { }\nvoid freePixels() {\nmInfo = mBitmap-&gt;info();\nmHasHardwareMipMap = mBitmap-&gt;hasHardwareMipMap();\nmAllocationSize = mBitmap-&gt;getAllocationByteCount();\nmRowBytes = mBitmap-&gt;rowBytes();\nmGenerationId = mBitmap-&gt;getGenerationID();\nmIsHardware = mBitmap-&gt;isHardware();\nmBitmap.reset();\n}\n}\n</code></pre> <pre><code>    /** Resets to its initial state; all fields are set to zero, as if SkBitmap had\n        been initialized by SkBitmap().\n        Sets width, height, row bytes to zero; pixel address to nullptr; SkColorType to\n        kUnknown_SkColorType; and SkAlphaType to kUnknown_SkAlphaType.\n        If SkPixelRef is allocated, its reference count is decreased by one, releasing\n        its memory if SkBitmap is the sole owner.\n    */\nvoid reset() {\nfPixelRef = nullptr;  // Free pixels.\nfPixmap.reset();\nfFlags = 0;        }\n</code></pre> <ul> <li>\u9996\u5148\uff0cApp \u4e3b\u52a8\u8c03\u7528 <code>Bitmap.recycle()</code> \u65b9\u6cd5</li> <li>\u63a5\u4e0b\u6765\uff0c<code>Bitmap.recycle()</code> \u8c03\u7528\u5bf9\u5e94\u7684 native \u65b9\u6cd5 <code>Bitmap_recycle()</code></li> <li>\u7136\u540e\u4f1a\u8fdb\u5165\u5230 <code>BitmapWrapper.freePixels()</code> \u65b9\u6cd5</li> <li>\u6700\u540e\uff0cSkBitmap.reset() \u5c06 <code>fPixelRef</code> \u7f6e\u7a7a\u3002\u6ce8\uff1a\u4e4b\u524d\u5206\u914d\u5185\u5b58\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u770b\u5230 <code>fPixelRef</code> \u662f\u5982\u4f55\u88ab\u8d4b\u503c\u7684</li> </ul> <p><code>fPixelRef</code> \u539f\u672c\u6307\u5411\u4e00\u4e2a <code>SkMallocPixelRef</code> \u5bf9\u8c61\u3002\u5c06 <code>fPixelRef</code> \u7f6e\u7a7a\u540e\uff0c\u8be5\u5bf9\u8c61\u5f15\u7528\u6570\u53d8\u62100\u65f6\uff0c<code>~SkMallocPixelRef()</code> \u6790\u6784\u65b9\u6cd5\u88ab\u8c03\u7528\uff0c\u5e76\u89e6\u53d1 sk_free_releaseproc() \u65b9\u6cd5\u6267\u884c\uff0c\u56de\u6536\u5185\u5b58\u3002</p> <p>\u6ce8\u610f\u8fd9\u91cc\u7684 <code>sk_free_releaseproc</code>\u3002 \u5b83\u662f\u65b9\u6cd5\u5730\u5740\uff0c\u5728\u4e4b\u524d\u7684\u5206\u914d\u5185\u5b58\u8fc7\u7a0b\u4e2d\u4f5c\u4e3a <code>SkMallocPixelRef()</code> \u6784\u9020\u65b9\u6cd5\u7684 <code>SkMallocPixelRef::ReleaseProc</code> \u53c2\u6570\u88ab\u4f20\u8fdb\u6765\u7684\u3002<code>sk_free_releaseproc</code> \u6307\u5411\u7684\u65b9\u6cd5\u8d1f\u8d23\u6700\u7ec8\u7684\u5185\u5b58\u56de\u6536\u3002</p> <pre><code>// SkMemory_malloc.cpp https://github.com/google/skia/blob/master/src/ports/SkMemory_malloc.cpp#L66\nvoid sk_free(void* p) {\nif (p) {\nfree(p);\n}\n}\n// SkMallocPixelRef.cpp https://github.com/google/skia/blob/master/src/core/SkMallocPixelRef.cpp#L33\n// assumes ptr was allocated via sk_malloc\nstatic void sk_free_releaseproc(void* ptr, void*) {\nsk_free(ptr);\n}\n// SkMallocPixelRef.cpp https://github.com/google/skia/blob/master/src/core/SkMallocPixelRef.cpp#L57\nsk_sp&lt;SkPixelRef&gt; SkMallocPixelRef::MakeAllocate(const SkImageInfo&amp; info, size_t rowBytes) {\n... void* addr = sk_calloc_canfail(size);\nif (nullptr == addr) {\nreturn nullptr;\n}\nreturn sk_sp&lt;SkPixelRef&gt;(new SkMallocPixelRef(info, addr, rowBytes,\nsk_free_releaseproc, nullptr));\n}\n// SkMallocPixelRef.cpp https://github.com/google/skia/blob/master/src/core/SkMallocPixelRef.cpp#L133\nSkMallocPixelRef::~SkMallocPixelRef() {\nif (fReleaseProc != nullptr) {\nfReleaseProc(this-&gt;pixels(), fReleaseProcContext);\n}\n}\n</code></pre>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#42","title":"4.2. \u81ea\u52a8\u91ca\u653e","text":"<p>\u5b9e\u9645\u4e0a\u73b0\u5728\u7684 Android \u5e94\u7528\u4e2d\u591a\u6570\u573a\u666f\u4ee3\u7801\u4e0d\u4e3b\u52a8\u8c03\u7528 <code>recycle()</code>\uff0c native \u5185\u5b58\u4e5f\u80fd\u6b63\u786e\u56de\u6536\u3002\u8fd9\u662f\u4e3a\u4f55\uff1f\u79d8\u5bc6\u5728\u4e8e NativeAllocationRegistry\u3002</p> <p>NativeAllocationRegistry \u7528\u4e8e\u5c06 native \u5185\u5b58\u8ddf Java \u5bf9\u8c61\u5173\u8054\uff0c\u5e76\u5c06\u5b83\u4eec\u6ce8\u518c\u5230 Java \u8fd0\u884c\u65f6\u3002\u6ce8\u518c Java \u5bf9\u8c61\u5173\u8054\u7684 native \u5185\u5b58\u6709\u51e0\u4e2a\u597d\u5904\uff1a</p> <ul> <li>Java \u8fd0\u884c\u65f6\u5728 GC \u8c03\u5ea6\u65f6\u53ef\u8003\u8651 native \u5185\u5b58\u72b6\u6001</li> <li>Java \u8fd0\u884c\u65f6\u5728 Java \u5bf9\u8c61\u53d8\u5f97\u4e0d\u53ef\u8fbe\u65f6\u53ef\u4ee5\u4f7f\u7528\u7528\u6237\u63d0\u4f9b\u7684\u51fd\u6570\u6765\u81ea\u52a8\u6e05\u7406 native \u5185\u5b58</li> </ul> <p>\u6765\u770b\u4ee3\u7801\u3002</p> <pre><code>     // Bitmap \u5bf9\u8c61\u65e0\u6cd5\u76f4\u63a5 new, \u5176\u521b\u5efa\u6d41\u7a0b, \u6211\u4eec\u5df2\u7ecf\u5206\u6790\u8fc7\u4e86\nBitmap(long nativeBitmap, int width, int height, int density,\nboolean isMutable, boolean requestPremultiplied,\nbyte[] ninePatchChunk, NinePatch.InsetStruct ninePatchInsets) {\nif (nativeBitmap == 0) {\nthrow new RuntimeException(\"internal error: native bitmap is 0\");\n}\nmWidth = width;\nmHeight = height;\nmIsMutable = isMutable;\nmRequestPremultiplied = requestPremultiplied;\nmNinePatchChunk = ninePatchChunk;\nmNinePatchInsets = ninePatchInsets;\nif (density &gt;= 0) {\nmDensity = density;\n}\n// 1. \u4fdd\u5b58 Native \u5c42\u5bf9\u5e94\u7684 SkiaBitmap \u7684\u53e5\u67c4\u503c\nmNativePtr = nativeBitmap;\nlong nativeSize = NATIVE_ALLOCATION_SIZE + getAllocationByteCount();\n// 2. nativeGetNativeFinalizer \u83b7\u53d6 Native \u7684 Finalizer.\n// 3. \u521b\u5efa NativeAllocationRegistry \u5bf9\u8c61\nNativeAllocationRegistry registry = new NativeAllocationRegistry(\nBitmap.class.getClassLoader(), nativeGetNativeFinalizer(), nativeSize);\n// 4. \u6ce8\u518c\u8fd9\u4e2a java \u5bf9\u8c61\u548c native \u5bf9\u8c61\nregistry.registerNativeAllocation(this, nativeBitmap);\n......\n}\n// \u83b7\u53d6 Native \u7684 Finalizer\nprivate static native long nativeGetNativeFinalizer();      </code></pre> <p>Bitmap \u521b\u5efa\u4e4b\u540e, \u5176\u6784\u9020\u51fd\u6570\u5185\u90e8\u7684\u64cd\u4f5c\u5982\u4e0b</p> <ul> <li>nativeGetNativeFinalizer \u83b7\u53d6 native \u5c42\u7684 Finalizer</li> <li>\u5b9e\u4f8b\u5316 NativeAllocationRegistry</li> <li>\u901a\u8fc7 NativeAllocationRegistry.registerNativeAllocation \u76d1\u542c\u8fd9\u4e2a Java \u548c Native \u5bf9\u8c61</li> </ul> <p>\u5f53 Java \u5c42 Bitmap \u5bf9\u8c61\u4e0d\u53ef\u8fbe\u540e\u5173\u8054\u7684 native \u5185\u5b58\u4f1a\u7531 <code>nativeGetNativeFinalizer()</code> \u6307\u5b9a\u7684\u65b9\u6cd5\u6765\u56de\u6536\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>\u83b7\u53d6 native \u5c42\u7684 Finalizer</li> </ul> <pre><code>namespace android {\nnamespace bitmap {\nstatic void Bitmap_destruct(BitmapWrapper* bitmap) {\ndelete bitmap;\n}\n// \u8fd9\u91cc\u628a Bitmap_destruct \u51fd\u6570\u5730\u5740\u8f6c\u4e3a long \u7c7b\u578b\u7684\u53e5\u67c4\u503c\u8fd4\u56de\u7ed9 Java \u5c42\nstatic jlong Bitmap_getNativeFinalizer(JNIEnv*, jobject) {\nreturn static_cast&lt;jlong&gt;(reinterpret_cast&lt;uintptr_t&gt;(&amp;Bitmap_destruct));\n}\n}\n}\n</code></pre> <p>native \u5c42\u7684 Finalizer \u5373 Bitmap_destruct \u51fd\u6570, \u6709\u4e86\u8fd9\u4e2a\u51fd\u6570, \u6211\u4eec\u4fbf\u53ef\u4ee5\u5feb\u901f\u7684\u56de\u6536 native \u7684 BitmapWrapper \u5185\u5b58\u4e86</p> <ul> <li>NativeAllocationRegistry \u7684\u521b\u5efa</li> </ul> <pre><code>public class NativeAllocationRegistry {\n\n    private final ClassLoader classLoader;\n    private final long freeFunction;\n    private final long size;\n\n    public NativeAllocationRegistry(ClassLoader classLoader, long freeFunction, long size) {\n        if (size &lt; 0) {\n            throw new IllegalArgumentException(\"Invalid native allocation size: \" + size);\n        }\n        this.classLoader = classLoader;\n        this.freeFunction = freeFunction;\n        this.size = size;\n    }\n\n}\n</code></pre> <p>NativeAllocationRegistry \u7684\u6784\u9020\u51fd\u6570, \u5373\u5c06\u5f62\u53c2\u4fdd\u5b58\u5230\u4e86\u6210\u5458\u53d8\u91cf, \u5e76\u6ca1\u6709\u505a\u591a\u4f59\u7684\u521d\u59cb\u5316\u64cd\u4f5c, \u4e0b\u9762\u770b\u770b\u5b83\u7684 registerNativeAllocation \u65b9\u6cd5</p> <pre><code>public class NativeAllocationRegistry {\n\n   public Runnable registerNativeAllocation(Object referent, long nativePtr) {\n          ......\n          CleanerThunk thunk;\n          CleanerRunner result;\n          try {\n              // 1. \u521b\u5efa native \u5185\u5b58\u5757\u6e05\u7406\u5668 CleanerThunk\n              thunk = new CleanerThunk();\n              // 2. \u521b\u5efa\u6e05\u7406\u8005, \u6301\u6709 Java \u5f15\u7528\u548c thunk\n              Cleaner cleaner = Cleaner.create(referent, thunk);\n              // 3 .\u521b\u5efa Runner \u4ea4\u7531\u5916\u754c\u4e3b\u52a8\u89e6\u53d1\u6e05\u7406\u64cd\u4f5c\n              result = new CleanerRunner(cleaner);\n              // 4.1 \u901a\u77e5 Runtime \u5206\u914d\u4e86 size \u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\n              registerNativeAllocation(this.size);\n          } catch (VirtualMachineError vme /* probably OutOfMemoryError */) {\n              // 4.2 \u6ce8\u518c\u5931\u8d25, \u91ca\u653e native \u7684\u5185\u5b58\n              applyFreeFunction(freeFunction, nativePtr);\n              throw vme;\n          } // Other exceptions are impossible.\n          // 5. \u8ba9 ClearThunk \u7ed1\u5b9a Native \u7684\u5bf9\u8c61\u7684\u53e5\u67c4\n          thunk.setNativePtr(nativePtr);\n          return result;\n      }\n\n      private class CleanerThunk implements Runnable {\n          private long nativePtr;\n\n          public CleanerThunk() {\n              this.nativePtr = 0;\n          }\n\n          public void run() {\n              if (nativePtr != 0) {\n                  // \u91ca\u653e Native \u5bf9\u8c61\n                  applyFreeFunction(freeFunction, nativePtr);\n                  // \u901a\u77e5 Runtime \u91ca\u653e\u4e86 size \u5927\u5c0f\u7684 Native \u5185\u5b58\n                  registerNativeFree(size);\n              }\n          }\n\n          public void setNativePtr(long nativePtr) {\n              this.nativePtr = nativePtr;\n          }\n      }\n\n      private static class CleanerRunner implements Runnable {\n          private final Cleaner cleaner;\n\n          public CleanerRunner(Cleaner cleaner) {\n              this.cleaner = cleaner;\n          }\n\n          public void run() {\n              // \u6267\u884c cleaner \u7684 clean \u64cd\u4f5c\n              cleaner.clean();\n          }\n      }\n\n      // \u901a\u77e5 Runtime \u5206\u914d\u4e86 size \u5927\u5c0f\u7684 Native \u5185\u5b58\n      private static void registerNativeAllocation(long size) {\n          VMRuntime.getRuntime().registerNativeAllocation((int)Math.min(size, Integer.MAX_VALUE));\n      }\n\n      // \u901a\u77e5 Runtime \u91ca\u653e\u4e86 size \u5927\u5c0f\u7684 Native \u5185\u5b58\n      private static void registerNativeFree(long size) {\n          VMRuntime.getRuntime().registerNativeFree((int)Math.min(size, Integer.MAX_VALUE));\n      }\n\n      // \u901a\u8fc7\u6784\u9020\u65f6\u4f20\u5165\u7684 freeFunction \u91ca\u653e\u5185\u5b58\n      public static native void applyFreeFunction(long freeFunction, long nativePtr);\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 registerNativeAllocation \u65b9\u6cd5\u4e2d\u4e3b\u8981\u64cd\u4f5c\u5982\u4e0b</p> <ul> <li>\u521b\u5efa Native \u5185\u5b58\u6e05\u7406\u5668 CleanerThunk</li> <li>\u6301\u6709 native \u5bf9\u8c61\u6307\u9488\u548c freeFunction</li> <li>\u521b\u5efa\u6e05\u7406\u8005 Cleaner \u5b83\u8d1f\u8d23\u76d1\u542c Java \u5bf9\u8c61\u5f15\u7528\u72b6\u6001, \u88ab GC \u65f6\u81ea\u52a8\u89e6\u53d1 CleanerThunk \u7684\u5185\u5b58\u91ca\u653e</li> <li>\u6709\u4e9b\u7c7b\u4f3c\u4e8e\u4e4b\u524d\u6211\u4eec\u5728\u5bf9\u8c61\u7684 finalize \u4e2d\u91ca\u653e Native \u5185\u5b58</li> <li>\u521b\u5efa\u6210\u529f, \u8c03\u7528 VMRuntime.registerNativeAllocation, \u6ce8\u518c Native \u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f</li> <li>\u521b\u5efa\u5931\u8d25, \u76f4\u63a5\u901a\u8fc7 applyFreeFunction \u91ca\u653e Native \u5bf9\u8c61</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u5173\u6ce8\u4e00\u4e0b Cleaner \u662f\u5982\u4f55\u81ea\u52a8\u5904\u7406 Native \u5bf9\u8c61\u91ca\u653e\u7684, \u4ee5\u53ca Runtime.registerNativeAllocation \u7684\u64cd\u4f5c</p> <ul> <li>Cleaner \u7684\u521b\u5efa</li> </ul> <pre><code>  public class Cleaner\n      extends PhantomReference&lt;Object&gt;\n  {\n\n      // \u865a\u5f15\u7528\u7684\u5f15\u7528\u961f\u5217\u65e0\u5b9e\u9645\u610f\u4e49, \u7528\u4e8e\u6784\u9020\u51fd\u6570\u4f20\u5165\n      private static final ReferenceQueue&lt;Object&gt; dummyQueue = new ReferenceQueue&lt;&gt;();\n\n      // \u53cc\u5411\u94fe\u8868\u7684\u5934\u7ed3\u70b9\n      static private Cleaner first = null;\n\n      // \u524d\u9a71&amp;\u540e\u7ee7\u6307\u9488\n      private Cleaner\n          next = null,\n          prev = null;\n\n      //\n      private static synchronized Cleaner add(Cleaner cl) {\n          if (first != null) {\n              cl.next = first;\n              first.prev = cl;\n          }\n          first = cl;\n          return cl;\n      }\n\n      private static synchronized boolean remove(Cleaner cl) {\n\n          // If already removed, do nothing\n          if (cl.next == cl)\n              return false;\n\n          // Update list\n          if (first == cl) {\n              if (cl.next != null)\n                  first = cl.next;\n              else\n                  first = cl.prev;\n          }          if (cl.next != null)\n              cl.next.prev = cl.prev;\n          if (cl.prev != null)\n              cl.prev.next = cl.next;\n\n          // Indicate removal by pointing the cleaner to itself\n          cl.next = cl;\n          cl.prev = cl;\n          return true;\n\n      }\n\n      // \u6e05\u7406\u56de\u8c03\n      private final Runnable thunk;\n\n      // \u6784\u9020\n      private Cleaner(Object referent, Runnable thunk) {\n          super(referent, dummyQueue);\n          this.thunk = thunk;\n      }\n\n      /**\n       * Creates a new cleaner.\n       *\n       * @param  ob the referent object to be cleaned\n       * @param  thunk\n       *         The cleanup code to be run when the cleaner is invoked.  The\n       *         cleanup code is run directly from the reference-handler thread,\n       *         so it should be as simple and straightforward as possible.\n       *\n       * @return  The new cleaner\n       */\n      public static Cleaner create(Object ob, Runnable thunk) {\n          if (thunk == null)\n              return null;\n          return add(new Cleaner(ob, thunk));\n      }\n\n      /**\n       * Runs this cleaner, if it has not been run before.\n       */\n      public void clean() {\n          if (!remove(this))\n              return;\n          try {\n              thunk.run();\n          } catch (final Throwable x) {\n              AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {\n                      public Void run() {\n                          if (System.err != null)\n                              new Error(\"Cleaner terminated abnormally\", x)\n                                  .printStackTrace();\n                          System.exit(1);\n                          return null;\n                      }});\n          }\n      }\n\n  }\n</code></pre> <p>Cleaner \u5bf9\u8c61\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u7684\u7ed3\u70b9, \u6700\u7ec8\u5728\u5185\u5b58\u4e2d\u7ec4\u6210\u4e00\u4e2a Cleaner \u53cc\u5411\u94fe\u8868, \u901a\u8fc7 Cleaner.clean \u65b9\u6cd5, \u4f1a\u89e6\u53d1 Cleaner \u7684 thunk.run \u6267\u884c\u771f\u6b63\u7684\u6e05\u7406\u64cd\u4f5c</p> <p>Cleaner \u7684\u6784\u9020\u51fd\u6570\u4e2d\u6709\u5982\u4e0b\u7684\u6ce8\u91ca</p> <p>The cleanup code is run directly from the reference-handler thread, so it should be as simple and straightforward as possible.</p> <p>\u4ece\u6ce8\u91ca\u4e2d\u53ef\u4ee5\u770b\u51fa, \u8fd9\u4e2a Cleaner.clean \u65b9\u6cd5\u7531 \u5f15\u7528\u5904\u7406\u7ebf\u7a0b \u76f4\u63a5\u56de\u8c03\u7684, \u5e76\u4e14\u63d0\u793a\u6211\u4eec\u4e0d\u8981\u8ba9 thunk.run \u6267\u884c\u8017\u65f6\u64cd\u4f5c</p> <p>\u770b\u5230\u8fd9\u91cc\u6211\u4eec\u5927\u6982\u5c31\u80fd\u591f\u660e\u767d, \u4e3a\u4ec0\u4e48 Bitmap \u4e2d\u627e\u4e0d\u5230 finalize \u65b9\u6cd5, \u4e5f\u80fd\u91ca\u653e Native \u5185\u5b58\u4e86, \u56e0\u4e3a\u4e00\u4e2a Bitmap \u5bf9\u8c61\u4f1a\u88ab\u5305\u88c5\u6210 Cleaner, \u6210\u4e3a Cleaner \u94fe\u8868\u4e2d\u7684\u4e00\u5458, \u5b83\u7684\u6e05\u7406\u64cd\u4f5c\u7531 \u5f15\u7528\u5904\u7406\u7ebf\u7a0b \u76f4\u63a5\u56de\u8c03 Cleaner.clean \u6267\u884c\u6570\u636e\u6e05\u7406, \u540c\u6837\u80fd\u591f\u53ca\u65f6\u91ca\u653e\u5185\u5b58</p> <ul> <li>VMRuntime.registerNativeAllocation</li> </ul> <pre><code>public final class VMRuntime {\n      /**\n       * Holds the VMRuntime singleton.\n       */\n      private static final VMRuntime THE_ONE = new VMRuntime();\n\n      /**\n       * Returns the object that represents the VM instance's Dalvik-specific\n       * runtime environment.\n       *\n       * @return the runtime object\n       */\n      public static VMRuntime getRuntime() {\n          return THE_ONE;\n      }\n\n      /**\n       * Registers a native allocation so that the heap knows about it and performs GC as required.\n       * If the number of native allocated bytes exceeds the native allocation watermark, the\n       * function requests a concurrent GC. If the native bytes allocated exceeds a second higher\n       * watermark, it is determined that the application is registering native allocations at an\n       * unusually high rate and a GC is performed inside of the function to prevent memory usage\n       * from excessively increasing.\n       */\n      public native void registerNativeAllocation(int bytes);\n}\n</code></pre> <p>\u8fd9\u91cc\u7684 registerNativeAllocation \u662f\u4e00\u4e2a native \u65b9\u6cd5, \u5b83\u7684\u5b9e\u73b0\u5b9a\u4e49\u5728 dalvik_system_VMRuntime.cc \u4e2d\u4e0b\u9762\u6211\u4eec\u770b\u770b\u5b83\u7684\u5b9e\u73b0</p> <pre><code>// android-9.0.0_r3/art/runtime/native/dalvik_system_VMRuntime.cc\nnamespace art {\n......\nstatic void VMRuntime_registerNativeAllocation(JNIEnv* env, jobject, jint bytes) {\nif (UNLIKELY(bytes &lt; 0)) {\nScopedObjectAccess soa(env);\nThrowRuntimeException(\"allocation size negative %d\", bytes);\nreturn;\n}\n// \u5c06\u8bb0\u5f55 Native \u5206\u914d\u7684\u5185\u5b58\u7684\u64cd\u4f5c, \u4ea4\u7531 ART \u7684 Heap \u6267\u884c\nRuntime::Current()-&gt;GetHeap()-&gt;RegisterNativeAllocation(env, static_cast&lt;size_t&gt;(bytes));\n}\n......\n}\n// android-9.0.0_r3/art/runtime/gc/heap.cc\nnamespace art {\nnamespace gc {\n......\nvoid Heap::RegisterNativeAllocation(JNIEnv* env, size_t bytes) {\n// \u4ea4\u7531 new_native_bytes_allocated_ \u539f\u5b50\u7c7b\u7d2f\u52a0 Native \u5bf9\u8c61\u5206\u914d\u7684\u5185\u5b58\nsize_t old_value = new_native_bytes_allocated_.FetchAndAddRelaxed(bytes);\n// \u5224\u65ad Native \u5206\u914d\u7684\u5185\u5b58\u662f\u5426\u89e6\u53d1\u4e86 GC \u9608\u503c, \u8d85\u8fc7\u4e86\u5219\u8fdb\u884c GC \u64cd\u4f5c\u91ca\u653e Java \u548c Native \u5185\u5b58\nif (old_value &gt; NativeAllocationGcWatermark() * HeapGrowthMultiplier() &amp;&amp;\n!IsGCRequestPending()) {\n// Trigger another GC because there have been enough native bytes\n// allocated since the last GC.\nif (IsGcConcurrent()) {\nRequestConcurrentGC(ThreadForEnv(env), kGcCauseForNativeAlloc, /*force_full*/true);\n} else {\nCollectGarbageInternal(NonStickyGcType(), kGcCauseForNativeAlloc, false);\n}\n}\n}\n......\n}\n}\n</code></pre> <p>Native \u5c42\u7684\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355, \u5b83\u5c06 Native \u5206\u914d\u7684\u5185\u5b58\u8fdb\u884c\u7d2f\u52a0, \u5f53 Java \u5bf9\u8c61\u6301\u6709\u7684 Native \u5185\u5b58\u8d85\u8fc7\u4e86\u9608\u503c, \u5219\u8fdb\u884c GC \u64cd\u4f5c</p> <p>\u8fd9\u91cc\u770b\u5230\u9608\u503c\u7684\u662f\u7531 NativeAllocationGcWatermark() * HeapGrowthMultiplier() \u7ec4\u6210, \u4e0b\u9762\u63a2\u7a76\u4e00\u4e0b Native \u5185\u5b58 GC \u9608\u503c\u7684\u503c</p> <ul> <li>\u6ce8\u518c Native \u5185\u5b58\u89e6\u53d1\u865a\u62df\u673a GC \u7684\u9608\u503c\u8ba1\u7b97</li> </ul> <pre><code>// android-9.0.0_r3/art/runtime/gc/heap.h\nclass Heap {\npublic:\n// \u8ba1\u7b97 Native \u5206\u914d\u5185\u5b58\u7684\u4e58\u6570\ndouble foreground_heap_growth_multiplier_;\n// \u8ba1\u7b97 Native \u5185\u5b58\u9608\u503c\nsize_t max_free_;\nALWAYS_INLINE size_t NativeAllocationGcWatermark() const {\nreturn max_free_;\n}\n}\n// android-9.0.0_r3/art/runtime/gc/heap.cc\ndouble Heap::HeapGrowthMultiplier() const {\n// \u4e0d\u8003\u8651\u540e\u53f0\u6682\u505c\u65f6\u957f, \u4e58\u6570\u5219\u76f4\u63a5\u8fd4\u56de 1.0, \u8fd9\u6837 Native \u89e6\u53d1 GC \u7684\u9608\u503c\u8f83\u5c11, GC \u4f1a\u66f4\u9891\u7e41\nif (!CareAboutPauseTimes()) {\nreturn 1.0;\n}\n// \u9ed8\u8ba4\u4f7f\u7528 foreground_heap_growth_multiplier_\nreturn foreground_heap_growth_multiplier_;\n}\n</code></pre> <p>\u8fd9\u91cc\u5e76\u6ca1\u6709\u5177\u4f53\u7684\u8d4b\u503c, Heap \u7684\u521b\u5efa\u662f\u5728 Runtime::Init \u4e2d\u6267\u884c\u7684, \u6211\u4eec\u770b\u770b\u8fd9\u4e2a\u4e24\u4e2a\u6570\u636e\u6ce8\u5165\u7684\u662f\u591a\u5c11</p> <pre><code>// android-9.0.0_r3/art/runtime/runtime.cc\nstatic constexpr double kExtraDefaultHeapGrowthMultiplier = kUseReadBarrier ? 1.0 : 0.0;\nbool Runtime::Init(RuntimeArgumentMap&amp;&amp; runtime_options_in) {\n......\nfloat foreground_heap_growth_multiplier;\nif (is_low_memory_mode_ &amp;&amp; !runtime_options.Exists(Opt::ForegroundHeapGrowthMultiplier)) {\n// \u82e5\u4e3a\u4f4e\u5185\u5b58\u8bbe\u5907, \u4e58\u6570\u4e3a 1.0\nforeground_heap_growth_multiplier = 1.0f;\n} else {\n// \u4ece runtime_options \u53d6\u503c\nforeground_heap_growth_multiplier =\nruntime_options.GetOrDefault(Opt::ForegroundHeapGrowthMultiplier) +\nkExtraDefaultHeapGrowthMultiplier;\n}\nheap_ = new gc::Heap(runtime_options.GetOrDefault(Opt::MemoryInitialSize),\nruntime_options.GetOrDefault(Opt::HeapGrowthLimit),\nruntime_options.GetOrDefault(Opt::HeapMinFree),\n// \u8fd9\u91cc\u6ce8\u5165\u4e86 max_free_\nruntime_options.GetOrDefault(Opt::HeapMaxFree),\nruntime_options.GetOrDefault(Opt::HeapTargetUtilization),\n// \u9608\u503c\u4e58\u6570\nforeground_heap_growth_multiplier,\nruntime_options.GetOrDefault(Opt::MemoryMaximumSize),\nruntime_options.GetOrDefault(Opt::NonMovingSpaceCapacity),\nruntime_options.GetOrDefault(Opt::Image),\nruntime_options.GetOrDefault(Opt::ImageInstructionSet),\n// Override the collector type to CC if the read barrier config.\nkUseReadBarrier ? gc::kCollectorTypeCC : xgc_option.collector_type_,\nkUseReadBarrier ? BackgroundGcOption(gc::kCollectorTypeCCBackground)\n: runtime_options.GetOrDefault(Opt::BackgroundGc),\nruntime_options.GetOrDefault(Opt::LargeObjectSpace),\nruntime_options.GetOrDefault(Opt::LargeObjectThreshold),\nruntime_options.GetOrDefault(Opt::ParallelGCThreads),\nruntime_options.GetOrDefault(Opt::ConcGCThreads),\nruntime_options.Exists(Opt::LowMemoryMode),\nruntime_options.GetOrDefault(Opt::LongPauseLogThreshold),\nruntime_options.GetOrDefault(Opt::LongGCLogThreshold),\nruntime_options.Exists(Opt::IgnoreMaxFootprint),\nruntime_options.GetOrDefault(Opt::UseTLAB),\nxgc_option.verify_pre_gc_heap_,\nxgc_option.verify_pre_sweeping_heap_,\nxgc_option.verify_post_gc_heap_,\nxgc_option.verify_pre_gc_rosalloc_,\nxgc_option.verify_pre_sweeping_rosalloc_,\nxgc_option.verify_post_gc_rosalloc_,\nxgc_option.gcstress_,\nxgc_option.measure_,\nruntime_options.GetOrDefault(Opt::EnableHSpaceCompactForOOM),\nruntime_options.GetOrDefault(Opt::HSpaceCompactForOOMMinIntervalsMs));\n......\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u7684\u53c2\u6570\u662f\u4ece runtime_options \u4e2d\u53d6\u5230\u7684, \u4ed6\u4eec\u7684\u5b9a\u4e49\u5982\u4e0b</p> <pre><code>// android-9.0.0_r3/art/runtime/runtime_options.def\nRUNTIME_OPTIONS_KEY (MemoryKiB, HeapMaxFree, gc::Heap::kDefaultMaxFree)\nRUNTIME_OPTIONS_KEY (double, ForegroundHeapGrowthMultiplier gc::Heap::kDefaultHeapGrowthMultiplier)\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u6700\u7ec8\u53c8\u4f1a\u56de\u5230 heap.h \u4e2d, \u4e0b\u9762\u770b\u770b\u8fd9\u4e2a Native \u5185\u5b58\u9608\u503c\u5230\u5e95\u662f\u591a\u5c11</p> <pre><code>// android-9.0.0_r3/art/runtime/gc/heap.h\nclass Heap {\n public:\n  // If true, measure the total allocation time.\n  static constexpr size_t kDefaultMaxFree = 2 * MB;\n  static constexpr double kDefaultHeapGrowthMultiplier = 2.0;\n  ......\n}\n</code></pre> <p>\u6545 Native \u5185\u5b58\u5206\u914d\u8d85\u8fc7 4MB, \u4fbf\u4f1a\u5c1d\u8bd5\u89e6\u53d1\u865a\u62df\u673a GC</p> <p>\u901a\u8fc7\u6e90\u7801\u5206\u6790\u53ef\u4ee5\u53d1\u73b0, \u539f\u6765\u5411 ART \u865a\u62df\u673a\u6ce8\u518c Native \u5206\u914d\u5927\u5c0f, \u662f\u4e3a\u4e86\u8ba9 Native \u5206\u914d\u7684\u5185\u5b58\u4e5f\u6210\u4e3a\u865a\u62df\u673a GC \u7684\u6743\u91cd\u4e4b\u4e00, \u5f53 Java \u5bf9\u5e94\u7684 Native \u5bf9\u8c61\u5185\u5b58\u5206\u914d\u603b\u548c\u8d85\u8fc7 4MB, \u4fbf\u4f1a\u5c1d\u8bd5\u89e6\u53d1\u865a\u62df\u673a\u7684 GC</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#5","title":"5. \u603b\u7ed3","text":"<p>\u901a\u8fc7\u4e00\u6b65\u6b65\u5206\u6790\uff0c\u6700\u7ec8\u4e0d\u96be\u53d1\u73b0 Bitmap \u672c\u8d28\u4e0a\u5c31\u662f\u5185\u5b58\u4e2d\u7684\u4e00\u5757\u6570\u636e\u3002\u6240\u8c13\u521b\u5efa Bitmap\uff0c\u4e0d\u8fc7\u662f\u8c03\u7528 <code>malloc()</code> \u5206\u914d\u4e00\u5757\u5185\u5b58\u3002\u800c\u56de\u6536 Bitmap\uff0c\u4e0d\u8fc7\u662f\u8c03\u7528 <code>free()</code> \u5c06\u4e4b\u524d\u7684\u5185\u5b58\u91ca\u653e\u6389\u3002</p> <p>\u4e3a\u4ec0\u4e48 2.3.3 ~ 7.0 \u8981\u653e\u5230 Java \u5806? \u76f4\u63a5\u653e\u5230 Native \u4e2d, \u7136\u540e\u5728 Java \u5bf9\u8c61 finalize \u8c03\u7528\u7684\u65f6\u5019\u91ca\u653e\u4e0d\u884c\u5417?</p> <ul> <li>Java \u5c42\u7684 Bitmap \u5bf9\u8c61\u662f\u4e00\u4e2a\u58f3, \u975e\u5e38\u5c0f, \u56e0\u6b64\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0 Native \u5806\u5feb\u5230\u4e86 3G, Java \u5806\u624d 10 MB, 10MB \u662f\u65e0\u6cd5\u89e6\u53d1 Dalvik GC \u7684, \u56e0\u6b64\u8fd9\u4e2a java \u5bf9\u8c61\u7684 finalize \u5e76\u975e\u90a3\u4e48\u5bb9\u6613\u8c03\u7528, \u56e0\u6b64\u53ef\u80fd\u4f1a\u51fa\u73b0 Native \u5806 OOM \u7684\u60c5\u51b5, \u6545\u9700\u8981\u6211\u4eec\u624b\u52a8 recycle</li> <li>\u50cf\u7d20\u6570\u636e\u76f4\u63a5\u653e\u7f6e\u5230 Java \u5806, Java \u5806\u5c31\u80fd\u76f4\u63a5\u7edf\u8ba1\u5230\u771f\u6b63\u7684\u5185\u5b58\u6570\u636e, \u80fd\u591f\u6839\u636e\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u51c6\u786e\u89e6\u53d1 GC \u56de\u6536\u6570\u636e</li> <li>\u9690\u60a3\u4fbf\u662f Java \u5806\u5185\u5b58\u7a7a\u95f4\u6bd4\u8f83\u5c0f, \u5bb9\u5668\u9020\u6210 Java \u5806\u7684 OOM</li> </ul> <p>\u4e3a\u4ec0\u4e48 8.0 \u53c8\u653e\u7f6e\u5230\u4e86 Native \u5806\u4e2d?</p> <ul> <li>\u4f7f\u7528 NativeAllocationRegistry \u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898, \u89e6\u53d1 ART \u5806 GC \u7684\u6761\u4ef6\u4e0d\u4ec5\u4ec5\u662f\u5806\u5360\u7528\u4e0d\u8db3, \u901a\u8fc7 VMRuntime.registerNativeAllocation \u6ce8\u518c\u7684 Native \u5185\u5b58\u7d2f\u8ba1\u8d85\u8fc7\u4e86\u9608\u503c(4MB)\u4e4b\u540e\u65f6\u4e5f\u4f1a\u89e6\u53d1 GC</li> <li>\u800c\u4e14 ART \u7684 GC \u6027\u80fd\u6bd4 Dalvik \u597d\u7684\u591a, \u4e0d\u4f1a\u8f7b\u6613\u9020\u6210\u4e3b\u7ebf\u7a0b\u5361\u987f</li> </ul>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#6-80bitmap","title":"6. 8.0\u4e4b\u524dBitmap\u5185\u5b58\u5206\u914d\u539f\u7406","text":"<p>Bitmap\u4e2d\u6709\u4e2abyte[] mBuffer\uff0c\u5176\u5b9e\u5c31\u662f\u7528\u6765\u5b58\u50a8\u50cf\u7d20\u6570\u636e\u7684\uff0c\u5f88\u660e\u663e\u5b83\u4f4d\u4e8ejava heap\u4e2d</p> <pre><code>public final class Bitmap implements Parcelable {\nprivate static final String TAG = \"Bitmap\";\n...\nprivate byte[] mBuffer;\n...\n}\n</code></pre> <p>\u6211\u4eec\u4ee5<code>Bitmap#createBitmap</code>\u65b9\u6cd5\u4e3a\u4f8b\uff0c\u6574\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u8be6\u7ec6\u5206\u6790\u53ef\u53c2\u8003Android Bitmap\u53d8\u8fc1\u4e0e\u539f\u7406\u89e3\u6790</p>"},{"location":"perf-opt/Android/bitmap/bitmap-from-birth-to-death/#_1","title":"\u53c2\u8003","text":"<ul> <li>Bitmap \u4f4d\u56fe\u5185\u5b58\u7684\u6f14\u8fdb\u6d41\u7a0b</li> <li>Bitmap: \u4ece\u51fa\u751f\u5230\u6b7b\u4ea1</li> </ul>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/","title":"Bitamp \u5185\u5b58\u5360\u7528\u5206\u6790","text":""},{"location":"perf-opt/Android/bitmap/bitmap-memory/#1","title":"1. \u524d\u8a00","text":"<p>\u9605\u8bfb\u672c\u7bc7\u4e4b\u524d\uff0c\u5148\u6765\u60f3\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li>Q1\uff1a\u4e00\u5f20\u56fe\u7247\u7684\u6587\u4ef6\u5927\u5c0f\u548c\u5176\u5185\u5b58\u5360\u7528\u5927\u5c0f\u6709\u5173\u7cfb\u5417\uff1f</li> <li>Q3\uff1a\u4e00\u5f20\u56fe\u7247\uff0c\u5206\u522b\u653e\u5728drawable-nodpi,drawable-mdpi,drawable-hdpi, drawable-xxhdpi,drawable-xxxhdpi\u8fd9\u51e0\u4e2a\u8d44\u6e90\u76ee\u5f55\u4e2d\uff0c\u52a0\u8f7d\u540e\u5360\u7528\u5185\u5b58\u76f8\u540c\u5417\uff1f</li> <li>Q4\uff1a\u4e00\u5f20\u56fe\u7247\u653e\u5728ImageView\u4e2d\uff0c\u5360\u7528\u5185\u5b58\u5927\u5c0f\u548cImageView\u7684\u5927\u5c0f\u6709\u5173\u7cfb\u5417\uff1f</li> </ul> <p>\u56f4\u7ed5\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u63a2\u8ba8\u4e0bBitmap\u7684\u5185\u5b58\u5360\u7528\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#2","title":"2. \u57fa\u7840\u6982\u5ff5","text":"<p>\u8fd9\u91cc\u5148\u8981\u641e\u6e05\u695a DisplayMetrics \u7684\u4e24\u4e2a\u53d8\u91cf\uff0c\u6458\u5f55\u5b98\u65b9\u6587\u6863\u7684\u89e3\u91ca\uff1a</p> <ul> <li>density\uff1aThe logical density of the display. This is a scaling factor for the Density Independent Pixel unit, where one DIP is one pixel on an approximately 160 dpi screen (for example a 240x320, 1.5\u201dx2\u201d screen), providing the baseline of the system\u2019s display. Thus on a 160dpi screen this density value will be 1; on a 120 dpi screen it would be .75; etc. This value does not exactly follow the real screen size (as given by xdpi and ydpi, but rather is used to scale the size of the overall UI in steps based on gross changes in the display dpi. For example, a 240x320 screen will have a density of 1 even if its width is 1.8\u201d, 1.3\u201d, etc. However, if the screen resolution is increased to 320x480 but the screen size remained 1.5\u201dx2\u201d then the density would be increased (probably to 1.5).</li> <li>densityDpi\uff1aThe screen density expressed as dots-per-inch.</li> </ul> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a density \u7684\u6570\u503c\u662f 1dp=density px\uff1bdensityDpi \u662f\u5c4f\u5e55\u6bcf\u82f1\u5bf8\u5bf9\u5e94\u591a\u5c11\u4e2a\u70b9\uff08\u4e0d\u662f\u50cf\u7d20\u70b9\uff09\uff0c\u5b83\u4eec\u4e4b\u95f4\u516c\u5f0f\u662f <code>px = dp * (densityDpi / 160)</code>\uff0c\u4e5f\u5c31\u662f<code>density = 160/densityDpi</code>\uff0c\u5728 DisplayMetrics \u5f53\u4e2d\uff0c\u8fd9\u4e24\u4e2a\u7684\u5173\u7cfb\u662f\u7ebf\u6027\u7684\uff1a</p> densityDpi(\u5bc6\u5ea6\u503c) 160 240 320 480 640 density(\u5bc6\u5ea6) 1 1.5 2 3 4 \u8d44\u6e90\u76ee\u5f55 mdpi hdpi xhdpi xxhdpi xxxhdpi \u4ee3\u8868\u5206\u8fa8\u7387 320x480 480x800 720x1280 1080x1920 1440x2560 <p>\u4e3a\u4e86\u4e0d\u5f15\u8d77\u6df7\u6dc6\uff0c\u672c\u6587\u6240\u6709\u63d0\u5230\u7684\u5bc6\u5ea6\u9664\u975e\u7279\u522b\u8bf4\u660e\uff0c\u90fd\u6307\u7684\u662f densityDpi\uff0c\u5f53\u7136\u5982\u679c\u4f60\u613f\u610f\uff0c\u4e5f\u53ef\u4ee5\u7528 density \u6765\u8bf4\u660e\u95ee\u9898\u3002</p> <p>\u53e6\u5916\uff0c\u672c\u6587\u7684\u4f9d\u636e\u4e3b\u8981\u6765\u81ea android 9.0 \u7684\u6e90\u7801\uff0c\u5176\u4ed6\u7248\u672c\u53ef\u80fd\u7565\u6709\u51fa\u5165\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#3","title":"3. \u6b63\u6587","text":""},{"location":"perf-opt/Android/bitmap/bitmap-memory/#31","title":"3.1 \u5b9e\u8df5","text":"<p>\u4e0b\u9762\uff0c\u6211\u4eec\u505a\u51e0\u4e2a\u5b9e\u9a8c\uff0c\u770b\u770b\u56fe\u7247\u5185\u5b58\u7a76\u7adf\u8ddf\u4ec0\u4e48\u56e0\u7d20\u6709\u5173</p> <p>\u5982\u65e0\u7279\u6b8a\u8bf4\u660e\uff0c\u6d4b\u8bd5\u673a\u5668\u4e3a \u534e\u4e3aP30\uff0c\u5206\u8fa8\u73871080x2340\uff0c\u5c4f\u5e55\u5bc6\u5ea6480</p> <p>\u5173\u4e8e\u5206\u8fa8\u7387\u53ef\u4ee5\u901a\u8fc7  <code>adb shell wm size</code> \u83b7\u53d6\uff0c \u5c4f\u5e55\u5bc6\u5ea6\u53ef\u4ee5\u901a\u8fc7 <code>adb shell wm density</code> \u83b7\u53d6</p> <p></p> <p>\u8fd9\u662f\u4e00\u5f20\u666e\u901a\u7684\u56fe\u7247\uff0c\u6765\u770b\u770b\u5b83\u7684\u5177\u4f53\u4fe1\u606f\uff1a</p> <p></p> <p>\u56fe\u7247\u7684\u5206\u8fa8\u7387\u662f 2171*1381\uff0c\u800c\u6211\u4eec\u5728\u7535\u8111\u4e0a\u770b\u5230\u7684\u8fd9\u5f20 png \u56fe\u7247\u5927\u5c0f\u6709 619KB\uff0c\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff1a</p> <p>\u6211\u4eec\u770b\u5230\u7684\u4e00\u5f20\u5927\u5c0f\u4e3a 619KB \u7684  \u56fe\u7247\uff0c\u5b83\u5728\u5185\u5b58\u4e2d\u5360\u6709\u7684\u5927\u5c0f\u4e5f\u662f 619KB \u5417\uff1f</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#_1","title":"\u5b9e\u9a8c\u4e00\uff1a","text":"<p>\u628a\u56fe\u7247\u653e\u5230<code>drawable-nodpi</code>\u5e95\u4e0b\uff0c\u65b0\u5efa\u4e00\u4e2a\u5e03\u5c40\u6587\u4ef6\u6dfb\u52a0\u4e00\u4e2a<code>ImageView</code></p> <p>\u5e03\u5c40\u5982\u4e0b</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\nxmlns:app=\"http://schemas.android.com/apk/res-auto\"\nxmlns:tools=\"http://schemas.android.com/tools\"\nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\"\nandroid:orientation=\"vertical\"&gt;\n&lt;androidx.appcompat.widget.AppCompatImageView\nandroid:id=\"@+id/testIv\"\nandroid:layout_width=\"wrap_content\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_gravity=\"center_horizontal\"\napp:layout_constraintBottom_toBottomOf=\"parent\"\napp:layout_constraintEnd_toEndOf=\"parent\"\napp:layout_constraintHorizontal_bias=\"0.5\"\napp:layout_constraintStart_toStartOf=\"parent\"\napp:layout_constraintTop_toTopOf=\"parent\"\napp:layout_constraintVertical_bias=\"0.5\" /&gt;\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> <p>\u6d4b\u8bd5\u4ee3\u7801</p> <pre><code>override fun onCreate(savedInstanceState: Bundle?) {\nsuper.onCreate(savedInstanceState)\nsetContentView(R.layout.activity_bitmap_test)\nval imageView = findViewById&lt;ImageView&gt;(R.id.testIv)\nloadResImage(imageView);\n}\nprivate fun loadResImage(imageView: ImageView) {\nval options = BitmapFactory.Options()\nval bitmap = BitmapFactory.decodeResource(resources, R.drawable.android, options)\nimageView.setImageBitmap(bitmap)\nimageView.post {\nLog.i(TAG, \"bitmap\uff1aAllocationByteCount = \" + bitmap.allocationByteCount)\nLog.i(TAG, \"bitmap.width:\" + bitmap.width + \":::bitmap.height:\" + bitmap.height)\nLog.i(TAG, \"inTargetDensity:\" + options.inTargetDensity)\nLog.i(TAG, \"imageview.width:\" + imageView.width + \":::imageview.height:\" + imageView.height)\n}\n}\n</code></pre> <p>\u8f93\u5165\u5982\u4e0b</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u867d\u7136bitmap\u7684\u5bbd\u9ad8\u548c\u539f\u56fe\u5bbd\u9ad8\u4e00\u81f4\uff0c\u4f46\u662f\u5176\u5360\u7528\u5185\u5bb9\u7ea6\u4e3a11M\uff0c\u8ddf\u56fe\u7247\u6587\u4ef6\u5927\u5c0f\u5e76\u6ca1\u5173\u7cfb</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u641e\u6e05\u695a\u4e00\u4e2a\u6982\u5ff5\uff1a\u6211\u4eec\u5728\u7535\u8111\u4e0a\u770b\u5230\u56fe\u7247\u662f\u7ecf\u8fc7\u76f8\u5bf9\u5e94\u7684\u538b\u7f29\u7b97\u6cd5\u5c06\u539f\u56fe\u6bcf\u4e2a\u50cf\u7d20\u70b9\u4fe1\u606f\u8f6c\u6362\u7528\u53e6\u4e00\u79cd\u6570\u636e\u683c\u5f0f\u8868\u793a\uff0c\u4ee5\u6b64\u8fbe\u5230\u538b\u7f29\u76ee\u7684\uff0c\u51cf\u5c11\u56fe\u7247\u6587\u4ef6\u5927\u5c0f\u3002\u8be6\u7ec6\u53ef\u67e5\u770b</p> <p>\u800c\u5f53\u6211\u4eec\u901a\u8fc7\u4ee3\u7801\uff0c\u5c06\u8fd9\u5f20\u56fe\u7247\u52a0\u8f7d\u8fdb\u5185\u5b58\u65f6\uff0c\u4f1a\u5148\u89e3\u6790\u56fe\u7247\u6587\u4ef6\u672c\u8eab\u7684\u6570\u636e\u683c\u5f0f\uff0c\u7136\u540e\u8fd8\u539f\u4e3a\u4f4d\u56fe\uff0c\u4e5f\u5c31\u662f Bitmap \u5bf9\u8c61\uff0cBitmap \u7684\u5927\u5c0f\u8ddf\u56fe\u7247\u6587\u4ef6\u5927\u5c0f\u65e0\u5173\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#_2","title":"\u5b9e\u9a8c\u4e8c\uff1a","text":"<p>\u4fee\u6539ImageView\u5bbd\u9ad8\u5982\u4e0b\uff1a</p> <pre><code>    &lt;androidx.appcompat.widget.AppCompatImageView\nandroid:id=\"@+id/testIv\"\nandroid:layout_width=\"100dp\"\nandroid:layout_height=\"100dp\"\nandroid:layout_gravity=\"center_horizontal\"\napp:layout_constraintBottom_toBottomOf=\"parent\"\napp:layout_constraintEnd_toEndOf=\"parent\"\napp:layout_constraintHorizontal_bias=\"0.5\"\napp:layout_constraintStart_toStartOf=\"parent\"\napp:layout_constraintTop_toTopOf=\"parent\"\napp:layout_constraintVertical_bias=\"0.5\" /&gt;\n</code></pre> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u56fe\u7247\u5728\u8bbe\u5907\u4e0a\u867d\u7136\u663e\u793a\u6bd4\u8f83\u5c0f\uff0c\u4f46\u662f\u5176\u5185\u5b58\u5360\u7528\u5374\u6ca1\u6709\u53d8\u5316\uff1b\u6240\u4ee5 ImageView\u7684\u5927\u5c0f\u548c\u56fe\u7247\u5360\u7528\u5185\u5b58\u5927\u5c0f\u65e0\u5173</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#_3","title":"\u5b9e\u9a8c\u4e09\uff1a","text":"<p>\u628a\u56fe\u7247\u5206\u522b\u653e\u5230<code>mdpi</code>,<code>hdpi</code>,<code>xhdpi</code>,<code>xxhdpi</code>,<code>xxxhdpi</code>,<code>nodpi</code>, \u67e5\u770b\u5176\u5185\u5b58,\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u653e\u5728\u4e0d\u540c\u7684\u8d44\u6e90\u76ee\u5f55\uff0c\u5176bitmap\u5927\u5c0f\u548c\u5360\u7528\u5185\u5b58\u662f\u4e0d\u4e00\u6837\u7684\uff0c</p> <p>nodpi\u548cxxhdpi\u7684bimap\u7684\u5927\u5c0f\u662f\u4e00\u81f4\u7684\uff0c\u800c\u673a\u5668\u5bc6\u5ea6\u521a\u597d\u662f480\uff0c\u6240\u4ee5bitmap\u5360\u7528\u5185\u5b58\u5927\u5c0f\u548c\u673a\u5668\u5c4f\u5e55\u5bc6\u5ea6\u662f\u6709\u4e00\u5b9a\u5185\u5728\u8054\u7cfb\uff0c\u8fd9\u4e2a\u6211\u4eec\u4e0b\u9762\u518d\u6df1\u7a76\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#_4","title":"\u5b9e\u9a8c\u4e09\uff1a","text":"<p>\u4fee\u6539Bitmap\u7684\u8272\u5f69\u6a21\u5f0f\uff1a\u5206\u522b\u8bbe\u7f6e\u6d4b\u8bd5</p> <pre><code>//Bitmap.Config.RGB_565\noptions.inPreferredConfig = Bitmap.Config.RGB_565\n// Bitmap.Config.ARGB_8888\noptions.inPreferredConfig = Bitmap.Config.ARGB_8888\n</code></pre> <p>\u8f93\u51fa\u5982\u4e0b</p> <p></p> <p>\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u8272\u5f69\u6a21\u5f0f\uff0c\u5176bitmap\u5927\u5c0f\u4e00\u6837\uff0c\u4f46\u5360\u7528\u5185\u5b58\u662f\u4e0d\u4e00\u6837\u7684\uff0cRGB_565\u5360\u7528\u5185\u5b58\u662fARGB_8888\u7684\u4e00\u534a</p> <p>\u5728\u4e0a\u9762\u5b9e\u9a8c\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u8bbe\u7f6e\u4e00\u4e0b<code>Bitmap\u7684inSampleSize</code>\u5982\u4e0b</p> <pre><code> options.inSampleSize = 2\n</code></pre> <p></p> <p>\u53ef\u4ee5\u8bbe\u7f6einSampleSize\u4e3a2\u4e4b\u540e\uff0c\u5176bitmap\u5bbd\u9ad8\u7ea6\u53d8\u6210\u539f\u6765\u7684\u4e00\u534a\uff0c\u5360\u7528\u5185\u5b58\u7ea6\u53d8\u6210\u539f\u6765\u7684\u00bc</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#_5","title":"\u5c0f\u7ed3","text":"<p>\u901a\u8fc7\u524d\u9762\u7684\u5b9e\u9a8c\uff0c\u6211\u4eec\u5c31\u4e0d\u96be\u77e5\u9053\uff0c\u5f71\u54cdBitmap \u5185\u5b58\u5360\u7528\u7684\u5927\u5c0f\u53ef\u80fd\u6709\u4ee5\u4e0b\u56e0\u7d20\uff1a</p> <ul> <li>\u539f\u59cb\u6587\u4ef6\u5b58\u653e\u7684\u8d44\u6e90\u76ee\u5f55</li> <li>\u76ee\u6807\u5c4f\u5e55\u7684\u5bc6\u5ea6</li> <li>Bitmap Config\uff1a\u8272\u5f69\u683c\u5f0f\u3001\u91c7\u6837\u7387\u7b49</li> </ul>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#33","title":"3.3 \u6e90\u7801\u5206\u6790","text":"<p>\u4e0b\u9762\u4ece\u6e90\u7801\u89d2\u5ea6\u8bba\u8bc1\u4e0b\u4e0a\u9762\u5b9e\u9a8c\u662f\u5426\u6b63\u786e\u3002</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#331","title":"3.3.1 \u5185\u5b58\u8ba1\u7b97\u516c\u5f0f","text":"<p>\u5bf9\u4e8eBitmap\u5360\u7528\u591a\u5c11\u5185\u5b58\uff0cAndroid \u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u4fbf\u7684API\uff1a</p> <pre><code>public final int getAllocationByteCount() {\nif (mRecycled) {\nLog.w(TAG, \"Called getAllocationByteCount() on a recycle()'d bitmap! \"\n+ \"This is undefined behavior!\");\nreturn 0;\n}\nreturn nativeGetAllocationByteCount(mNativePtr);\n}\nprivate static native int nativeGetAllocationByteCount(long nativeBitmap)\n</code></pre> <p>\u5728Android 4.4\u4ee5\u524d\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u4f7f\u7528\u4e0b\u9762\u7684API\uff1a</p> <pre><code>public final int getByteCount() {\nif (mRecycled) {\nLog.w(TAG, \"Called getByteCount() on a recycle()'d bitmap! \"\n+ \"This is undefined behavior!\");\nreturn 0;\n}\n// int result permits bitmaps up to 46,340 x 46,340\nreturn getRowBytes() * getHeight();\n}\n</code></pre> <p>\u90a3\u4e48\u8fd9\u4e24\u4e2a\u8ba1\u7b97\u516c\u5f0f\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f<p>Android 4.4\u4e4b\u540e\u5982\u679c\u8bbe\u7f6e\u4e86<code>BitmapFactory.Options.inBitmap</code> \u5b57\u6bb5\uff0c\u90a3\u4e48\u91c7\u7528 Options \u5bf9\u8c61\u7684\u89e3\u7801\u65b9\u6cd5\u4f1a\u5728\u52a0\u8f7d\u5185\u5bb9\u65f6\u5c1d\u8bd5\u91cd\u590d\u4f7f\u7528\u73b0\u6709\u4f4d\u56fe, \u53ea\u8981\u4fdd\u8bc1\u65e7Bitmap\u7684\u5927\u5c0f\u662f\u5927\u4e8e\u7b49\u4e8e\u65b0Bitmap\u5927\u5c0f\u5373\u53ef\u3002\u90a3\u4e48\u8fd9\u65f6\u5019bitmap\u5360\u7528\u5185\u5b58\u5927\u5c0f<code>(getAllocationByteCount)</code>\u8fd8\u662f\u4fdd\u6301\u4e3a\u88ab\u590d\u7528Bitmap\u7684\u5927\u5c0f\uff0c\u4f1a\u6bd4\u5176\u672c\u8eab\u5360\u7528\u5185\u5b58\u5927\u5c0f<code>(getByteCount)</code>\u8981\u5927</p> <p>Android 4.4\u4e4b\u540e\u4f7f\u7528<code>(getAllocationByteCount)</code>\u83b7\u53d6\u56fe\u7247\u5360\u7528\u5185\u5b58\u4f1a\u66f4\u51c6\u786e</p> </p> <p>\u4ece\u4e0a\u9762\u53ef\u77e5\uff0c\u6700\u7ec8\u8ba1\u7b97bitmap\u7684\u65b9\u6cd5\u662f<code>nativeGetAllocationByteCount</code>,\u6211\u4eec\u627e\u5230\u5176\u5728native\u4e2d\u5b9a\u4e49</p> <p>base\\core\\jni\\android\\graphics\\Bitmap.cpp</p> <pre><code>static const JNINativeMethod gBitmapMethods[] = {\n\u00b7\u00b7\u00b7\n{   \"nativeGetAllocationByteCount\", \"(J)I\", (void*)Bitmap_getAllocationByteCount },\n\u00b7\u00b7\u00b7\n};\nstatic jint Bitmap_getAllocationByteCount(JNIEnv* env, jobject, jlong bitmapPtr) {\nLocalScopedBitmap bitmapHandle(bitmapPtr);\nreturn static_cast&lt;jint&gt;(bitmapHandle-&gt;getAllocationByteCount());\n}\n</code></pre> <p>\u7ee7\u7eed\u5f80\u4e0b\u8ddf\u5230<code>BitmapWrapper#getAllocationByteCount()</code>\uff0c\u5982\u4e0b</p> <pre><code>size_t getAllocationByteCount() const {\nif (mBitmap) {\nreturn mBitmap-&gt;getAllocationByteCount();\n}\nreturn mAllocationSize;\n}\n</code></pre> <p>base\\libs\\hwui\\hwui\\Bitmap.cpp</p> <pre><code>size_t Bitmap::getAllocationByteCount() const {\nswitch (mPixelStorageType) {\ncase PixelStorageType::Heap:\nreturn mPixelStorage.heap.size;\ndefault:\nreturn rowBytes() * height();\n}\n}\n</code></pre> <p>\u4eceBitmap: \u4ece\u51fa\u751f\u5230\u6b7b\u4ea1\u53ef\u77e5\uff0cAndroid 8.0\u4e4b\u540eBitmap\u5185\u5b58\u4e00\u822c\u7531HeapAllocator\u6765\u5206\u914d</p> <p><pre><code>bool HeapAllocator::allocPixelRef(SkBitmap* bitmap, SkColorTable* ctable) {\nmStorage = android::Bitmap::allocateHeapBitmap(bitmap, ctable);\nreturn !!mStorage;\n}\n</code></pre> base\\libs\\hwui\\hwui\\Bitmap.cpp</p> <p><pre><code>static sk_sp&lt;Bitmap&gt; allocateBitmap(SkBitmap* bitmap, AllocPixelRef alloc) {\nconst SkImageInfo&amp; info = bitmap-&gt;info(); // info\uff1a\u56fe\u7247\u53c2\u6570\nif (info.colorType() == kUnknown_SkColorType) {\nLOG_ALWAYS_FATAL(\"unknown bitmap configuration\");\nreturn nullptr;\n}\nsize_t size; // size\uff1a\u50cf\u7d20\u6570\u636e\u5185\u5b58\u5927\u5c0f \u4ea6\u5373\u662f\u4e0a\u8ff0mPixelStorage.heap.size\n// we must respect the rowBytes value already set on the bitmap instead of\n// attempting to compute our own.\nconst size_t rowBytes = bitmap-&gt;rowBytes(); // rowBytes\uff1a\u4e00\u884c\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\n// \u8ba1\u7b97\u50cf\u7d20\u6570\u636e\u5185\u5b58\u5927\u5c0f\uff0c\u5e76\u5c06\u7ed3\u679c\u8d4b\u503c\u5230 size \u53d8\u91cf\u4e0a\nif (!computeAllocationSize(rowBytes, bitmap-&gt;height(), &amp;size)) {\nreturn nullptr;\n}\nauto wrapper = alloc(size, info, rowBytes);\nif (wrapper) {\nwrapper-&gt;getSkBitmap(bitmap);\n}\nreturn wrapper;\n}\nstatic bool computeAllocationSize(size_t rowBytes, int height, size_t* size) {\nint32_t rowBytes32 = SkToS32(rowBytes);\nint64_t bigSize = (int64_t)height * rowBytes32;\nif (rowBytes32 &lt; 0 || !sk_64_isS32(bigSize)) {\nreturn false;  // allocation will be too large\n}\n*size = sk_64_asS32(bigSize);\nreturn true;\n}\n</code></pre> \u6240\u4ee5 <code>bitmapInRam = rowBytes*bitmapHeight</code></p> <p>\u8ddf\u8e2a\u4e0browBytes\u7684\u5b9e\u73b0</p> <p>SkPixelRef.h</p> <p><pre><code>size_t rowBytes() const { return fRowBytes; }\n</code></pre> \u770b\u4e0bfRowBytes\u5728\u54ea\u91cc\u8d4b\u503c\uff1a</p> <p>SkPixelRef.cpp</p> <pre><code>void SkPixelRef::android_only_reset(int width, int height, size_t rowBytes) { fWidth = width; fHeight = height; fRowBytes = rowBytes; this-&gt;notifyPixelsChanged(); }\n</code></pre> <p>\u518d\u770b\u4e0bandroid_only_reset\u7684\u8c03\u7528\u94fe\u8def\uff0c</p> <p>base\\libs\\hwui\\hwui\\Bitmap.cpp</p> <pre><code>void Bitmap::reconfigure(const SkImageInfo&amp; newInfo, size_t rowBytes) {\nmInfo = validateAlpha(newInfo);\n// Dirty hack is dirty\n// TODO: Figure something out here, Skia's current design makes this\n// really hard to work with. Skia really, really wants immutable objects,\n// but with the nested-ref-count hackery going on that's just not\n// feasible without going insane trying to figure it out\nthis-&gt;android_only_reset(mInfo.width(), mInfo.height(), rowBytes);\n}\n</code></pre> <p>\u518d\u770b\u4e0b reconfigure \u7684\u8c03\u7528\u94fe\u8def\uff0c\u5982\u4e0b\uff1a</p> <pre><code>void Bitmap::reconfigure(const SkImageInfo&amp; info) { reconfigure(info, info.minRowBytes()); }\n</code></pre> <p>\u53d1\u73b0rowBytes()\u6700\u7ec8\u662f SkImageInfo \u4e2d\u7684 minRowBytes() \u8ba1\u7b97\u7684\uff0c\u7ee7\u7eed\u8ddf\u8e2aSkImageInfo.h\uff1a</p> <p><pre><code>size_t minRowBytes() const {\nreturn (size_t)this-&gt;minRowBytes64();\n}\nuint64_t minRowBytes64() const {\nreturn sk_64_mul(fWidth, this-&gt;bytesPerPixel());\n}\nint bytesPerPixel() const {\nreturn SkColorTypeBytesPerPixel(fColorType);\n}\nstatic int SkColorTypeBytesPerPixel(SkColorType ct) {\nstatic const uint8_t gSize[] = {\n0,  // Unknown\n1,  // Alpha_8\n2,  // RGB_565\n2,  // ARGB_4444\n4,  // RGBA_8888\n4,  // BGRA_8888\n1,  // kIndex_8\n};\nSK_COMPILE_ASSERT(SK_ARRAY_COUNT(gSize) == (size_t)(kLastEnum_SkColorType + 1),\nsize_mismatch_with_SkColorType_enum);\nSkASSERT((size_t)ct &lt; SK_ARRAY_COUNT(gSize));\nreturn gSize[ct];\n}\n</code></pre> SkMath.h <pre><code>static inline int64_t sk_64_mul(int64_t a, int64_t b) {\nreturn a * b;\n}\n</code></pre></p> <p>\u8ddf\u8e2a\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u53d1\u73b0 ARGB_8888\uff08\u4e5f\u5c31\u662f\u6211\u4eec\u6700\u5e38\u7528\u7684 Bitmap \u7684\u683c\u5f0f\uff09\u7684\u4e00\u4e2a\u50cf\u7d20\u5360\u7528 4byte\uff0c\u90a3\u4e48 rowBytes \u5b9e\u9645\u4e0a\u5c31\u662f 4*width bytes\u3002</p> <p>\u53ef\u4ee5\u5f97\u77e5 <code>rowBytes(\u4e00\u884c\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f) =  bitmapWidth*\u6bcf\u4e2a\u50cf\u7d20\u5360\u7528\u5927\u5c0f</code></p> <p>\u4ece\u8fd9\u53ef\u4ee5\u5f97\u51fa\u521d\u6b65\u7ed3\u8bba\uff0c\u4e00\u5f20 ARGB_8888 \u7684 Bitmap \u5360\u7528\u5185\u5b58\u7684\u8ba1\u7b97\u516c\u5f0f</p> <p>bitmapInRam = bitmapWidth*bitmapHeight *4 bytes</p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u8bba\u8bc1\u4e86\u56fe\u7247\u5360\u7528\u5185\u5b58\u548c\u8272\u5f69\u683c\u5f0f\u7684\u5173\u7cfb\uff0c\u4f46 bitmap\u5bbd\u9ad8\u4e0d\u4e00\u5b9a\u7b49\u4e8e\u56fe\u7247\u672c\u8eab\u5bbd\u9ad8\uff0c\u4e0b\u9762\u6211\u4eec\u4ee5\u5b9e\u9a8c\u7528\u5230\u7684\u65b9\u6cd5<code>BitmapFactory.decodeResource</code>\u770b\u4e0bbitmap\u5bbd\u9ad8\u548c\u56fe\u7247\u672c\u8eab\u5bbd\u9ad8\u7684\u5173\u7cfb</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#bitmapfactorydecoderesource","title":"BitmapFactory.decodeResource","text":"<p>BitmapFactory.java</p> <pre><code>   public static Bitmap decodeResource(Resources res, int id, Options opts) {\nvalidate(opts);\nBitmap bm = null;\nInputStream is = null; try {\nfinal TypedValue value = new TypedValue();\n//openRawResource\u4f1a\u6839\u636e\u8d44\u6e90\u7f29\u653e\u7684\u4f4d\u7f6e\u5bf9TypedValue\u7684inDensity\u8d4b\u503c\uff0c\u5982xxhdpi\uff0c \u5c31\u662f480\nis = res.openRawResource(id, value);\nbm = decodeResourceStream(res, value, is, null, opts);\n} catch (Exception e) {\n/*  do nothing.\n                If the exception happened on open, bm will be null.\n                If it happened on close, bm is still valid.\n            */\n} finally {\ntry {\nif (is != null) is.close();\n} catch (IOException e) {\n// Ignore\n}\n}\nif (bm == null &amp;&amp; opts != null &amp;&amp; opts.inBitmap != null) {\nthrow new IllegalArgumentException(\"Problem decoding into existing bitmap\");\n}\nreturn bm;\n}\npublic static Bitmap decodeResourceStream(@Nullable Resources res, @Nullable TypedValue value,\n@Nullable InputStream is, @Nullable Rect pad, @Nullable Options opts) {\nvalidate(opts);\nif (opts == null) {\nopts = new Options();\n}\nif (opts.inDensity == 0 &amp;&amp; value != null) {\nfinal int density = value.density;\nif (density == TypedValue.DENSITY_DEFAULT) {\nopts.inDensity = DisplayMetrics.DENSITY_DEFAULT;\n} else if (density != TypedValue.DENSITY_NONE) {\nopts.inDensity = density; //\u8fd9\u91ccdensity\u7684\u503c\u5982\u679c\u5bf9\u5e94\u8d44\u6e90\u76ee\u5f55\u4e3axxhdpi\u7684\u8bdd\uff0c\u5c31\u662f480\n}\n}\nif (opts.inTargetDensity == 0 &amp;&amp; res != null) {\n//\u8bf7\u6ce8\u610f\uff0cinTargetDensity\u5c31\u662f\u5f53\u524d\u7684\u663e\u793a\u5bc6\u5ea6\uff0c\u6bd4\u5982\u534e\u4e3aP30\u65f6\u5c31\u662f480\nopts.inTargetDensity = res.getDisplayMetrics().densityDpi;\n}\nreturn decodeStream(is, pad, opts);\n}\n</code></pre> <p>inDensity \u5c31\u662f\u539f\u59cb\u8d44\u6e90\u7684 density\uff0cinTargetDensity \u5c31\u662f\u5c4f\u5e55\u7684 density\u3002</p> <p>\u6700\u7ec8\u8c03\u7528\u5230<code>nativeDecodeStream</code></p> <pre><code> private static native Bitmap nativeDecodeStream(InputStream is, byte[] storage,\nRect padding, Options opts);\n</code></pre> <p>BitmapFactory.cpp</p> <pre><code>static jobject nativeDecodeStream(JNIEnv* env, jobject clazz, jobject is, jbyteArray storage,\njobject padding, jobject options) {\n...\n...\nbitmap = doDecode(env, std::move(bufferedStream), padding, options);\n}\nreturn bitmap;\n}\nstatic jobject doDecode(JNIEnv* env, std::unique_ptr&lt;SkStreamRewindable&gt; stream,\njobject padding, jobject options) {\n\u00b7\u00b7\u00b7\nint sampleSize = 1;\nfloat scale = 1.0f;\n\u00b7\u00b7\u00b7\nif (options != NULL) {\n// \u83b7\u53d6inSampleSize\nsampleSize = env-&gt;GetIntField(options, gOptions_sampleSizeFieldID);\n// \u4fee\u6b63sampleSize\nif (sampleSize &lt;= 0) {\nsampleSize = 1;\n}\nif (env-&gt;GetBooleanField(options, gOptions_scaledFieldID)) {\n// \u83b7\u53d6inDensity\nconst int density = env-&gt;GetIntField(options, gOptions_densityFieldID);\n// \u83b7\u53d6targetDensity\nconst int targetDensity = env-&gt;GetIntField(options, gOptions_targetDensityFieldID);\n// \u83b7\u53d6inScreenDensity\uff0c\u9ed8\u8ba4\u7b49\u4e8e0\nconst int screenDensity = env-&gt;GetIntField(options, gOptions_screenDensityFieldID);\nif (density != 0 &amp;&amp; targetDensity != 0 &amp;&amp; density != screenDensity) {\n// \u5f97\u5230 \u7f29\u653e\u56e0\u5b50scale\nscale = (float) targetDensity / density;\n}\n}\n}\n\u00b7\u00b7\u00b7\n// Determine the output size.\nSkISize size = codec-&gt;getSampledDimensions(sampleSize);\n// \u7ecf\u8fc7\u91c7\u6837\u4e4b\u540e\u7684\u5c3a\u5bf8\nint scaledWidth = size.width();\nint scaledHeight = size.height();\nbool willScale = false;\n\u00b7\u00b7\u00b7\n// \u6839\u636e\u524d\u9762\u7684density\u548ctargetDensity\u8ba1\u7b97\u51fa\u7684scale,\u518d\u6b21\u8ba1\u7b97\u7f29\u653e\u7684\u5bbd\u9ad8\nif (scale != 1.0f) {\nwillScale = true;\nscaledWidth = static_cast&lt;int&gt;(scaledWidth * scale + 0.5f);\nscaledHeight = static_cast&lt;int&gt;(scaledHeight * scale + 0.5f);\n}\n\u00b7\u00b7\u00b7\nSkBitmap decodingBitmap;\nif (!decodingBitmap.setInfo(bitmapInfo) ||\n!decodingBitmap.tryAllocPixels(decodeAllocator)) {\n// SkAndroidCodec should recommend a valid SkImageInfo, so setInfo()\n// should only only fail if the calculated value for rowBytes is too\n// large.\n// tryAllocPixels() can fail due to OOM on the Java heap, OOM on the\n// native heap, or the recycled javaBitmap being too small to reuse.\nreturn nullptr;\n}\n\u00b7\u00b7\u00b7\n// Use SkAndroidCodec to perform the decode.\nSkAndroidCodec::AndroidOptions codecOptions;\ncodecOptions.fZeroInitialized = decodeAllocator == &amp;defaultAllocator ?\nSkCodec::kYes_ZeroInitialized : SkCodec::kNo_ZeroInitialized;\ncodecOptions.fSampleSize = sampleSize;\nSkCodec::Result result = codec-&gt;getAndroidPixels(decodeInfo, decodingBitmap.getPixels(),\ndecodingBitmap.rowBytes(), &amp;codecOptions);\nswitch (result) {\ncase SkCodec::kSuccess:\ncase SkCodec::kIncompleteInput:\nbreak;\ndefault:\nreturn nullObjectReturn(\"codec-&gt;getAndroidPixels() failed.\");\n}\n\u00b7\u00b7\u00b7\n// \u7f29\u653e\u6bd4\u4f8b\nconst float scaleX = scaledWidth / float(decodingBitmap.width());\nconst float scaleY = scaledHeight / float(decodingBitmap.height());\nSkBitmap outputBitmap;\nif (willScale) {\n// Set the allocator for the outputBitmap.\nSkBitmap::Allocator* outputAllocator;\nif (javaBitmap != nullptr) {\noutputAllocator = &amp;recyclingAllocator;\n} else {\noutputAllocator = &amp;defaultAllocator;\n}\nSkColorType scaledColorType = decodingBitmap.colorType();\n// FIXME: If the alphaType is kUnpremul and the image has alpha, the\n// colors may not be correct, since Skia does not yet support drawing\n// to/from unpremultiplied bitmaps.\noutputBitmap.setInfo(\nbitmapInfo.makeWH(scaledWidth, scaledHeight).makeColorType(scaledColorType));\nif (!outputBitmap.tryAllocPixels(outputAllocator)) {\n// This should only fail on OOM.  The recyclingAllocator should have\n// enough memory since we check this before decoding using the\n// scaleCheckingAllocator.\nreturn nullObjectReturn(\"allocation failed for scaled bitmap\");\n}\nSkCanvas canvas(outputBitmap, SkCanvas::ColorBehavior::kLegacy);\n// Canvas \u653e\u5927 scale \u500d\uff0c\u76f8\u5f53\u4e8e\u628a\u8fd9\u5f20 bitmap \u653e\u5927\u4e86 scale \u500d\ncanvas.scale(scaleX, scaleY);\ncanvas.drawBitmap(decodingBitmap, 0.0f, 0.0f, &amp;paint);\n} \u00b7\u00b7\u00b7\nreturn bitmap::createBitmap(env, defaultAllocator.getStorageObjAndReset(),\nbitmapCreateFlags, ninePatchChunk, ninePatchInsets, -1);\n}\n</code></pre> <p>\u81f3\u6b64\uff0c\u53ef\u77e5Bitmap\u5c3a\u5bf8\u516c\u5f0f\u4e3a</p> <pre><code>bitmapWidth = \u56fe\u7247\u5bbd\u5ea6/inSampleSize*inTargetDensity/inDensity\nbitmapHeight = \u56fe\u7247\u9ad8\u5ea6/inSampleSize*inTargetDensity/inDensity\n</code></pre> <p>\u6240\u4ee5\uff0cBitmap\u5185\u5b58\u5360\u7528\u516c\u5f0f\u4e3a</p> <p>bitmapInRam = bitmapWidth* bitmapHeight*\u6bcf\u4e2a\u50cf\u7d20\u5360\u7528\u5927\u5c0f</p> <p>\u518d\u770b\u4e0b\u6211\u4eec\u7684\u5b9e\u9a8c\u4e09\uff0c\u4e00\u5f20 2171*1381 \u7684\u56fe\u7247\uff0c\u6211\u628a\u5b83\u653e\u5230 drawable-xhdpi \u76ee\u5f55\u4e0b\uff0c\u5728 \u534e\u4e3aP30 \u4e0a\u52a0\u8f7d\uff0c\u5360\u7528\u5185\u5b58<code>26994016B</code>\uff0c\u5176\u4e2d density \u5bf9\u5e94 xhdpi \u4e3a320\uff0ctargetDensity \u5bf9\u5e94\u534e\u4e3aP30\u7684\u5bc6\u5ea6\u4e3a480\uff1a</p> <p>2171*480/320 * 1381*480 /320  * 4 = 26983359B</p> <p>\u4f1a\u53d1\u73b0\u6211\u4eec\u8ba1\u7b97\u548c\u7cfb\u7edf\u83b7\u53d6\u5230\u7684\u6570\u503c\u4e0d\u4e00\u6837</p> <p>\u8fd9\u662f\u56e0\u4e3a\u7cbe\u5ea6\u95ee\u9898\uff0c\u7531\u4e0a\u9762\u6e90\u7801\u53ef\u77e5</p> <pre><code>if (scale != 1.0f) {\nwillScale = true;\nscaledWidth = static_cast&lt;int&gt;(scaledWidth * scale + 0.5f);\nscaledHeight = static_cast&lt;int&gt;(scaledHeight * scale + 0.5f);\n}\n</code></pre> <p>\u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\uff0c</p> <pre><code>scaledWidth = int(2171 * (480 / 320f) + 0.5)= int(3257.0) = 3257\nscaledHeight = int( 1381 * (480 / 320f) + 0.5) = int(2072.0) = 2072\n</code></pre> <p>3257  * 2072 *  4 = 26994016 </p> <p>\u548cAPI\u5f97\u5230\u7684\u6570\u503c\u4e00\u81f4\uff0c\u81f3\u6b64\uff0cBitmap\u7684\u5185\u5b58\u5360\u7528\u5206\u6790\u5b8c\u6bd5\uff01\uff01\uff01</p>"},{"location":"perf-opt/Android/bitmap/bitmap-memory/#_6","title":"\u53c2\u8003","text":"<p>\u4f60\u7684 Bitmap \u7a76\u7adf\u5360\u591a\u5927\u5185\u5b58\uff1f</p>"},{"location":"perf-opt/Android/bitmap/glide/","title":"Glide \u6838\u5fc3\u539f\u7406\u901f\u8bfb","text":"<p>\u4e0d\u9677\u4e8e\u832b\u832b\u6e90\u7801\u4e4b\u4e2d\uff0c\u53ea\u53d6\u5176\u6838\u5fc3</p>"},{"location":"perf-opt/Android/bitmap/glide/#1","title":"1. \u603b\u89c8","text":"<p>\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801\u52a0\u8f7d\u4e00\u5f20\u7f51\u7edc\u56fe\u7247\uff1a <pre><code>Glide.with(this).load(url).into(imgView);\n</code></pre> \u6d41\u7a0b\u5927\u6982\u5982\u4e0b\uff1a </p>"},{"location":"perf-opt/Android/bitmap/glide/#glide_1","title":"Glide \u7279\u70b9","text":"<p>\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a\u4f18\u79c0\u7684\u56fe\u7247\u52a0\u8f7d\u5e93\uff0c\u90fd\u4f1a\u6709\u4ee5\u4e0b\u51e0\u4e2a\u7279\u70b9\uff1a</p> <ul> <li>\u652f\u6301\u591a\u79cd\u56fe\u7247\u683c\u5f0f\uff0c\u5982\uff1a<code>jpg</code>\u3001<code>png</code>\u3001<code>webp</code>\u3001<code>gif</code> \u7b49</li> <li>\u652f\u6301\u591a\u79cd\u6570\u636e\u6e90\uff0c\u5982\uff1a<code>\u7f51\u7edc</code>\u3001<code>\u672c\u5730</code>\u3001<code>assets</code> \u7b49</li> <li>\u652f\u6301\u591a\u79cd\u7f13\u5b58\u7b56\u7565\uff0c\u5982\uff1a<code>\u5185\u5b58</code>\u3001<code>\u78c1\u76d8</code>\u3001<code>\u7f51\u7edc</code> \u7b49</li> </ul> <p>\u800cGlide\u5904\u7406\u5177\u5907\u4ee5\u4e0a\u7279\u70b9\u5916\uff0c\u8fd8\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>\u751f\u547d\u5468\u671f\u611f\u77e5\uff08\u6839\u636eActivity\u6216\u8005Fragment\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\u56fe\u7247\u52a0\u8f7d\u8bf7\u6c42\uff09</li> <li>\u9ad8\u6548\u5904\u7406Bitmap\uff08bitmap\u7684\u590d\u7528\u548c\u4e3b\u52a8\u56de\u6536\uff0c\u51cf\u5c11\u7cfb\u7edf\u56de\u6536\u538b\u529b\uff09</li> <li>\u66f4\u9ad8\u6548\u7684\u7f13\u5b58\u7b56\u7565\uff0c\u52a0\u8f7d\u901f\u5ea6\u5feb\u4e14\u5185\u5b58\u5f00\u9500\u5c0f</li> </ul>"},{"location":"perf-opt/Android/bitmap/glide/#2","title":"2. \u6838\u5fc3\u539f\u7406","text":""},{"location":"perf-opt/Android/bitmap/glide/#21-glide","title":"2.1 Glide\u662f\u5982\u4f55\u611f\u77e5\u751f\u547d\u5468\u671f\u7684","text":"<ol> <li>\u4f20\u5165Activity/Fragment/Context</li> </ol> <p><code>Glide#with</code> <pre><code> public static RequestManager with(@NonNull Activity activity) {\nreturn getRetriever(activity).get(activity); #1\n}\n</code></pre> 2. \u5173\u8054\u751f\u547d\u5468\u671f</p> <p><code>RequestManagerRetriever#get</code> <pre><code>  public RequestManager get(@NonNull Activity activity) {\nif (Util.isOnBackgroundThread()) {\nreturn get(activity.getApplicationContext());\n} else if (activity instanceof FragmentActivity) {\nreturn get((FragmentActivity) activity);  #2\n} else {\n....\n}\n}\n@NonNull\npublic RequestManager get(@NonNull FragmentActivity activity) {\n...\n//Glide \u7ec8\u4e8e\u652f\u6301\u5b98\u65b9\u7684lyfecycle\u65b9\u6848\u4e86\uff0c\u867d\u7136\u662f\u5b9e\u9a8c\u6027\u7684\uff0c\u4f46\u4e0d\u5f71\u54cd\u5206\u6790\uff0c\u5c31\u4ee5\u8fd9\u4e2a\u4e3a\u4f8b\u5427\nif (useLifecycleInsteadOfInjectingFragments()) {\nContext context = activity.getApplicationContext();\nGlide glide = Glide.get(context);\n#4\nreturn lifecycleRequestManagerRetriever.getOrCreate(\ncontext,\nglide\nactivity.getLifecycle(),\nactivity.getSupportFragmentManager(),\nisActivityVisible);\n} else {\n...\n}\n}\n</code></pre> <code>LifecycleRequestManagerRetriever#getOrCreate</code> <pre><code>  RequestManager getOrCreate(\nContext context,\nGlide glide,\nfinal Lifecycle lifecycle,\nFragmentManager childFragmentManager,\nboolean isParentVisible) {\nUtil.assertMainThread();\nRequestManager result = getOnly(lifecycle);\nif (result == null) {\n//LifecycleLifecycle \u662f\u5173\u8054Activity\u751f\u547d\u5468\u671f\u548cRequestManager\u7684\u6865\u6881\n#5 LifecycleLifecycle glideLifecycle = new LifecycleLifecycle(lifecycle);\n// \u8fd9\u91cc\u4f1a\u6784\u5efaRequestManager\u5e76\u4e14\u548cLifecycle\u5173\u8054\n#6\nresult =\nfactory.build(\nglide,\nglideLifecycle,\nnew SupportRequestManagerTreeNode(childFragmentManager),\ncontext);\n...\n}\nreturn result;\n}\n</code></pre> 3. \u611f\u77e5\u751f\u547d\u5468\u671f</p> <p><code>RequestManager</code> <pre><code>  RequestManager(\nGlide glide,\nLifecycle lifecycle,\nRequestManagerTreeNode treeNode,\nRequestTracker requestTracker,\nConnectivityMonitorFactory factory,\nContext context) {\n...\n// \u5173\u8054\u751f\u547d\u5468\u671f\n#7\nlifecycle.addListener(this);\n...\n}\n// \u611f\u77e5\u751f\u547d\u5468\u671f\u5904\u7406\u8bf7\u6c42.\n@Override\npublic synchronized void onStart() {\nresumeRequests();\ntargetTracker.onStart();\n}\n// \u611f\u77e5\u751f\u547d\u5468\u671f\u5904\u7406\u8bf7\u6c42.\n@Override\npublic synchronized void onStop() {\npauseRequests();\ntargetTracker.onStop();\n}\n// \u611f\u77e5\u751f\u547d\u5468\u671f\u5904\u7406\u8bf7\u6c42.\n@Override\npublic synchronized void onDestroy() {\ntargetTracker.onDestroy();\nfor (Target&lt;?&gt; target : targetTracker.getAll()) {\nclear(target);\n}\ntargetTracker.clear();\nrequestTracker.clearRequests();\nlifecycle.removeListener(this);\nlifecycle.removeListener(connectivityMonitor);\nUtil.removeCallbacksOnUiThread(addSelfToLifecycle);\nglide.unregisterRequestManager(this);\n}\n</code></pre></p> <p><code>LifecycleLifecycle</code> \u662f\u5173\u8054Activity\u751f\u547d\u5468\u671f\u548cRequestManager\u7684\u6865\u6881</p> <pre><code>final class LifecycleLifecycle implements Lifecycle, LifecycleObserver {\n@NonNull\nprivate final Set&lt;LifecycleListener&gt; lifecycleListeners = new HashSet&lt;LifecycleListener&gt;();\n@NonNull private final androidx.lifecycle.Lifecycle lifecycle;\n//\u8fd9\u91cc\u662f#4\u7684 activity.getLifecycle()\nLifecycleLifecycle(androidx.lifecycle.Lifecycle lifecycle) {\nthis.lifecycle = lifecycle;\n// LifecycleLifecycle \u4f5c\u4e3a LifecycleObserver \u6ce8\u518c\u5230 Activity Lifecycle\nlifecycle.addObserver(this);\n}\n@OnLifecycleEvent(Event.ON_START)\npublic void onStart(@NonNull LifecycleOwner owner) {\nfor (LifecycleListener lifecycleListener : Util.getSnapshot(lifecycleListeners)) {\nlifecycleListener.onStart();\n}\n}\n@OnLifecycleEvent(Event.ON_STOP)\npublic void onStop(@NonNull LifecycleOwner owner) {\nfor (LifecycleListener lifecycleListener : Util.getSnapshot(lifecycleListeners)) {\nlifecycleListener.onStop();\n}\n}\n@OnLifecycleEvent(Event.ON_DESTROY)\npublic void onDestroy(@NonNull LifecycleOwner owner) {\nfor (LifecycleListener lifecycleListener : Util.getSnapshot(lifecycleListeners)) {\nlifecycleListener.onDestroy();\n}\nowner.getLifecycle().removeObserver(this);\n}\n// RequestManager \u4f5c\u4e3a LifecycleListener \u6ce8\u518c\u5230 LifecycleLifecycle\uff0c\u4ece\u800c\u95f4\u63a5\u6ce8\u518c\u5230 Activity Lifecycle\n@Override\npublic void addListener(@NonNull LifecycleListener listener) {\nlifecycleListeners.add(listener);\nif (lifecycle.getCurrentState() == State.DESTROYED) {\nlistener.onDestroy();\n} else if (lifecycle.getCurrentState().isAtLeast(State.STARTED)) {\nlistener.onStart();\n} else {\nlistener.onStop();\n}\n}\n@Override\npublic void removeListener(@NonNull LifecycleListener listener) {\nlifecycleListeners.remove(listener);\n}\n}\n</code></pre>"},{"location":"perf-opt/Android/bitmap/glide/#_1","title":"\u5c0f\u7ed3","text":"<ol> <li>\u83b7\u53d6\u5bf9\u5e94Activity\u7684<code>Lifecycle</code>, \u628a<code>Lifecycle</code>\u4f5c\u4e3a LifecycleObserver \u6ce8\u518c\u5230 <code>Activity Lifecycle</code>\uff1b</li> <li>\u5728\u521b\u5efa<code>RequestManager</code>\u65f6\uff0cRequestManager \u4f5c\u4e3a <code>LifecycleListener</code> \u6ce8\u518c\u5230 Lifecycle\uff0c\u4ece\u800c\u95f4\u63a5\u6ce8\u518c\u5230 Activity Lifecycle;</li> <li>\u8fd9\u6837\u5f53Activity\u751f\u547d\u5468\u671f\u53d8\u5316\u7684\u65f6\u5019\uff0c\u5c31\u80fd\u901a\u8fc7\u63a5\u53e3\u56de\u8c03\u53bb\u901a\u77e5RequestManager\u5904\u7406\u8bf7\u6c42.</li> </ol> <p>\u4ee5\u4e0a\u662fGlide\u652f\u6301\u5b98\u65b9\u7684lyfecycle\u65b9\u6848\u7684\u5904\u7406\u6d41\u7a0b\uff0c\u5176\u5b9e\u9ed8\u8ba4Glide\u662f\u81ea\u5df1\u5b9e\u73b0\u4e86\u4e00\u5957\u751f\u547d\u5468\u671f\u611f\u77e5\u65b9\u6848\uff0c\u8fd9\u91cc\u4e0d\u505a\u5206\u6790\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u53bb\u770b\u6e90\u7801\u6216\u8005\u67e5\u770b\u7f51\u4e0a\u76f8\u5173\u6587\u7ae0\u3002</p>"},{"location":"perf-opt/Android/bitmap/glide/#22","title":"2.2 \u7f13\u5b58\u7b56\u7565","text":"<p>Glide\u7684\u7f13\u5b58\u5206\u4e3a\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u5185\u5b58\u7f13\u5b58\uff0c\u4e00\u79cd\u662f\u78c1\u76d8\u7f13\u5b58\u3002\u5176\u4e2d\u5185\u5b58\u7f13\u5b58\u53c8\u5206\u4e3a\u6d3b\u52a8\u8d44\u6e90\u548cLRU\u5185\u5b58\u7f13\u5b58\uff0c\u78c1\u76d8\u7f13\u5b58\u53c8\u5206\u4e3a\u539f\u59cb\u6570\u636e\u7f13\u5b58\u548c\u8f6c\u6362\u540e\u7684\u6570\u636e\u7f13\u5b58\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cGlide \u4f1a\u5728\u5f00\u59cb\u4e00\u4e2a\u65b0\u7684\u56fe\u7247\u8bf7\u6c42\u4e4b\u524d\u68c0\u67e5\u4ee5\u4e0b\u591a\u7ea7\u7684\u7f13\u5b58\uff1a</p> <ol> <li>\u6d3b\u52a8\u8d44\u6e90 (<code>Active Resources</code>) - \u73b0\u5728\u662f\u5426\u6709\u53e6\u4e00\u4e2a View \u6b63\u5728\u5c55\u793a\u8fd9\u5f20\u56fe\u7247\uff1f</li> <li>\u5185\u5b58\u7f13\u5b58 (<code>Memory cache</code>) - \u8be5\u56fe\u7247\u662f\u5426\u6700\u8fd1\u88ab\u52a0\u8f7d\u8fc7\u5e76\u4ecd\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\uff1f</li> <li>\u8d44\u6e90\u7c7b\u578b\uff08<code>Resource</code>\uff09 - \u8be5\u56fe\u7247\u662f\u5426\u4e4b\u524d\u66fe\u88ab\u89e3\u7801\u3001\u8f6c\u6362\u5e76\u5199\u5165\u8fc7\u78c1\u76d8\u7f13\u5b58\uff1f</li> <li>\u6570\u636e\u6765\u6e90 (<code>Data</code>) - \u6784\u5efa\u8fd9\u4e2a\u56fe\u7247\u7684\u8d44\u6e90\u662f\u5426\u4e4b\u524d\u66fe\u88ab\u5199\u5165\u8fc7\u6587\u4ef6\u7f13\u5b58\uff1f</li> </ol> <p>\u524d\u4e24\u6b65\u68c0\u67e5\u56fe\u7247\u662f\u5426\u5728\u5185\u5b58\u4e2d\uff0c\u5982\u679c\u662f\u5219\u76f4\u63a5\u8fd4\u56de\u56fe\u7247\u3002\u540e\u4e24\u6b65\u5219\u68c0\u67e5\u56fe\u7247\u662f\u5426\u5728\u78c1\u76d8\u4e0a\uff0c\u4ee5\u4fbf\u5feb\u901f\u4f46\u5f02\u6b65\u5730\u8fd4\u56de\u56fe\u7247\u3002</p> <p>\u5982\u679c\u56db\u4e2a\u6b65\u9aa4\u90fd\u672a\u80fd\u627e\u5230\u56fe\u7247\uff0c\u5219Glide\u4f1a\u8fd4\u56de\u5230\u539f\u59cb\u8d44\u6e90\u4ee5\u53d6\u56de\u6570\u636e\uff08\u539f\u59cb\u6587\u4ef6\uff0cUri, Url\u7b49\uff09\u3002</p>"},{"location":"perf-opt/Android/bitmap/glide/#_2","title":"\u5185\u5b58\u7f13\u5b58","text":"<ol> <li>\u5148\u4ece\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58\u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u83b7\u53d6\u5230\u5219\u76f4\u63a5\u8fd4\u56de</li> <li>\u4e0d\u5728\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58\uff0c\u5219\u5c1d\u8bd5\u4eceLRU\u5185\u5b58\u7f13\u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u83b7\u53d6\u5230\u5219\u8fd4\u56de\uff0c\u4eceLru\u7f13\u5b58\u5220\u9664\u5e76\u5c06\u5176\u52a0\u5165\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58</li> </ol> <p>\u5177\u4f53\u4ee3\u7801\u5982\u4e0b</p> <p><code>Engine#loadFromMemory</code> <pre><code>  private EngineResource&lt;?&gt; loadFromMemory(\nEngineKey key, boolean isMemoryCacheable, long startTime) {\nif (!isMemoryCacheable) {\nreturn null;\n}\n#1 \u4ece\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58\u4e2d\u83b7\u53d6\nEngineResource&lt;?&gt; active = loadFromActiveResources(key);\nif (active != null) {\nif (VERBOSE_IS_LOGGABLE) {\nlogWithTimeAndKey(\"Loaded resource from active resources\", startTime, key);\n}\nreturn active;\n}\n#2 \u4eceLRU\u5185\u5b58\u7f13\u4e2d\u83b7\u53d6\nEngineResource&lt;?&gt; cached = loadFromCache(key);\nif (cached != null) {\nif (VERBOSE_IS_LOGGABLE) {\nlogWithTimeAndKey(\"Loaded resource from cache\", startTime, key);\n}\nreturn cached;\n}\nreturn null;\n}\nprivate EngineResource&lt;?&gt; loadFromActiveResources(Key key) {\n// \u4ece ActiveResources \u4e2d\u52a0\u8f7d\u7f13\u5b58\u6570\u636e\nEngineResource&lt;?&gt; active = activeResources.get(key);\nif (active != null) {\n//\u6d3b\u52a8\u5f15\u7528\u8ba1\u6570+1\nactive.acquire();\n}\nreturn active;\n}\nprivate EngineResource&lt;?&gt; loadFromCache(Key key) {\nEngineResource&lt;?&gt; cached = getEngineResourceFromCache(key);\nif (cached != null) {\n//\u6d3b\u52a8\u5f15\u7528\u8ba1\u6570+1\ncached.acquire();\n// \u52a0\u5165\u6d3b\u52a8\u7f13\u5b58\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u5df2\u7ecf\u4ece LRU \u7f13\u5b58\u4e2d\u79fb\u9664\u4e86\nactiveResources.activate(key, cached);\n}\nreturn cached;\n}\nprivate EngineResource&lt;?&gt; getEngineResourceFromCache(Key key) {\n// cache\u662fLruResourceCache\u7684\u5b9e\u73b0\n// \u4ece LruResourceCache \u4e2d\u52a0\u8f7d\u7f13\u5b58\u6570\u636e\uff0c\u5e76\u79fb\u9664\nResource&lt;?&gt; cached = cache.remove(key);\nfinal EngineResource&lt;?&gt; result;\nif (cached == null) {\nresult = null;\n} else if (cached instanceof EngineResource) {\n// Save an object allocation if we've cached an EngineResource (the typical case).\nresult = (EngineResource&lt;?&gt;) cached;\n} else {\nresult =\nnew EngineResource&lt;&gt;(\ncached, /*isMemoryCacheable=*/ true, /*isRecyclable=*/ true, key, /*listener=*/ this);\n}\nreturn result;\n}\n</code></pre> 3. \u5f53\u8bf7\u6c42\u88ab\u53d6\u6d88\u6216\u8005Request\u63a5\u6536\u5230\u751f\u547d\u5468\u671f\u8c03\u7528onDestroy\u9875\u9762\u9500\u6bc1\u7684\u65f6\u5019\u4f1a\u901a\u77e5Request\u8bf7\u6c42\u91ca\u653e\u6d3b\u52a8\u8d44\u6e90\uff0c\u4ece\u800c\u5c06\u6d3b\u52a8\u8d44\u6e90\u4ece\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58\u4e2d\u79fb\u9664\uff0c\u540c\u65f6\u5c06\u6d3b\u52a8\u8d44\u6e90\u52a0\u5165\u5230LRU\u5185\u5b58\u7f13\u5b58\u4e2d</p> <p><code>SingleRequest#clear</code> <pre><code>  @Override\npublic void clear() {\n...\nengine.release(toRelease);\n...\n}\n</code></pre></p> <p><code>Engine#release</code> <pre><code>  public void release(Resource&lt;?&gt; resource) {\n...\n((EngineResource&lt;?&gt;) resource).release();\n...\n}\n</code></pre> <code>EngineResource#release</code> <pre><code>  void release() {\n...\nif (--acquired == 0) {\n// \u5f15\u7528\u8ba1\u6570\u5f520\nrelease = true;\n}\nif (release) {\n//Engine \u5b9e\u73b0\u4e86ResourceListener\nlistener.onResourceReleased(key, this);\n}\n}\n</code></pre> <code>Engine#onResourceReleased</code> <pre><code> public void onResourceReleased(Key cacheKey, EngineResource&lt;?&gt; resource) {\n// \u4ece\u6d3b\u52a8\u7f13\u5b58\u4e2d\u79fb\u9664\nactiveResources.deactivate(cacheKey);\nif (resource.isMemoryCacheable()) {\n// \u52a0\u5165 LRU \u7f13\u5b58\ncache.put(cacheKey, resource);\n} else {\nresourceRecycler.recycle(resource, /*forceNextFrame=*/ false);\n}\n}\n</code></pre></p> <p>\u4e3a\u4ec0\u4e48\u8981\u6709\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58?</p> <ol> <li>\u964d\u4f4e\u5185\u5b58\u538b\u529b\uff0c\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f ActiveResources \u4e2d\u7684 HashMap \u662f\u5f31\u5f15\u7528\u7ef4\u62a4\u7684\uff0c\u800c LruCache \u4e2d\u7684 LinkedHashMap \u7528\u7684\u662f\u5f3a\u5f15\u7528\u3002\u56e0\u4e3a\u5f31\u5f15\u7528\u5bf9\u8c61\u4f1a\u968f\u65f6\u88ab gc \u56de\u6536\uff0c\u6240\u4ee5\u53ef\u4ee5\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f</li> <li>\u63d0\u9ad8\u7f13\u5b58\u6548\u7387 \u5982\u679c\u6ca1\u6709\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58\uff0c\u6bcf\u4e00\u6b21\u4f7f\u7528\u7684\u8d44\u6e90\u90fd\u52a0\u5165\u5185\u5b58\u7f13\u5b58\uff0c\u6781\u6709\u53ef\u80fd\u56e0\u4e3a\u653e\u5165Lru\u7f13\u5b58\u7684\u6570\u636e\u8fc7\u591a\uff0c\u5bfc\u81f4\u6b63\u5728\u4f7f\u7528\u8d44\u6e90\u4eceLru\u7f13\u5b58\u4e2d\u79fb\u9664\uff0c\u7b49\u5230\u4e0b\u6b21\u6765\u8fdb\u884c\u52a0\u8f7d\u7684\u65f6\u5019\u56e0\u4e3a\u6ca1\u6709\u5bf9\u5e94\u7684\u5f15\u7528\u5173\u7cfb\uff0c\u627e\u4e0d\u5230\u539f\u6765\u5185\u5b58\u4e2d\u6b63\u5728\u4f7f\u7528\u7684\u90a3\u4e2a\u8d44\u6e90\uff0c\u4ece\u800c\u9700\u8981\u518d\u6b21\u4ece\u6587\u4ef6\u6216\u8005\u7f51\u7edc\u8fdb\u884c\u6570\u636e\u52a0\u8f7d\u3002</li> </ol>"},{"location":"perf-opt/Android/bitmap/glide/#_3","title":"\u78c1\u76d8\u7f13\u5b58","text":"<p>\u9996\u5148\u4e86\u89e3\u4e00\u4e0b\u78c1\u76d8\u7f13\u5b58\u7b56\u7565</p> <ul> <li><code>DiskCacheStrategy.NONE</code>\uff1a \u8868\u793a\u4e0d\u7f13\u5b58\u4efb\u4f55\u5185\u5bb9\u3002</li> <li><code>DiskCacheStrategy.RESOURCE</code>\uff1a \u53ea\u7f13\u5b58\u8f6c\u6362\u8fc7\u540e\u7684\u56fe\u7247\u3002</li> <li><code>DiskCacheStrategy.DATA</code>\uff1a \u53ea\u7f13\u5b58\u539f\u59cb\u56fe\u7247\u3002</li> <li><code>DiskCacheStrategy.ALL</code> \uff1a \u65e2\u7f13\u5b58\u539f\u59cb\u56fe\u7247\uff0c\u4e5f\u7f13\u5b58\u8f6c\u6362\u8fc7\u540e\u7684\u56fe\u7247\u3002</li> <li><code>DiskCacheStrategy.AUTOMATIC</code>\uff1a\u9ed8\u8ba4\u7b56\u7565\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u5bf9\u672c\u5730\u548c\u8fdc\u7a0b\u56fe\u7247\u4f7f\u7528\u6700\u4f73\u7684\u7b56\u7565\u3002\u5982\u679c\u662f\u8fdc\u7a0b\u56fe\u7247\uff0c\u5219\u53ea\u7f13\u5b58\u539f\u59cb\u56fe\u7247\uff1b\u56e0\u4e3a\u4e0b\u8f7d\u8fdc\u7a0b\u6570\u636e\u76f8\u6bd4\u8c03\u6574\u78c1\u76d8\u4e0a\u5df2\u7ecf\u5b58\u5728\u7684\u6570\u636e\u8981\u6602\u8d35\u5f97\u591a. \u5982\u679c\u662f\u672c\u5730\u56fe\u7247\uff0c\u90a3\u4e48\u53ea\u7f13\u5b58\u8f6c\u6362\u8fc7\u540e\u7684\u56fe\u7247, \u56e0\u4e3a\u5373\u4f7f\u4f60\u9700\u8981\u518d\u6b21\u751f\u6210\u53e6\u4e00\u4e2a\u5c3a\u5bf8\u6216\u7c7b\u578b\u7684\u56fe\u7247\uff0c\u53d6\u56de\u539f\u59cb\u6570\u636e\u4e5f\u5f88\u5bb9\u6613\u3002</li> </ul> <p>\u4ee5<code>RESOURCE</code>\u4e3a\u4f8b\uff0c\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b</p> <p><code>ResourceCacheGenerator#startNext</code> <pre><code>  public boolean startNext() {\n... currentKey =\nnew ResourceCacheKey( // NOPMD AvoidInstantiatingObjectsInLoops\nhelper.getArrayPool(),\nsourceId,\nhelper.getSignature(),\nhelper.getWidth(),\nhelper.getHeight(),\ntransformation,\nresourceClass,\nhelper.getOptions());\n// \u4ece\u78c1\u76d8\u7f13\u5b58\u4e2d\u83b7\u53d6 \uff0cDiskCache\u662fDiskLruCacheWrapper\u7684\u5b9e\u4f8b\uff0c\u5bf9\u5e94\u7684\u662fDiskLruCache\u7684\u5c01\u88c5\ncacheFile = helper.getDiskCache().get(currentKey);\nif (cacheFile != null) {\nsourceKey = sourceId;\nmodelLoaders = helper.getModelLoaders(cacheFile);\nmodelLoaderIndex = 0;\n}\n...\nloadData =\nmodelLoader.buildLoadData(\ncacheFile, helper.getWidth(), helper.getHeight(), helper.getOptions());\nif (loadData != null &amp;&amp; helper.hasLoadPath(loadData.fetcher.getDataClass())) {\nstarted = true;\nloadData.fetcher.loadData(helper.getPriority(), this);\n}\n...\n}\n</code></pre> \u4ece\u78c1\u76d8\u7f13\u5b58\u52a0\u8f7d\u5b8c\u4e4b\u540e\u4e5f\u4f1a\u52a0\u5165\u5230\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58, \u8fd9\u91cc\u662f\u901a\u8fc7<code>EngineJobListener#onEngineJobComplete</code>\u56de\u8c03\u5b8c\u6210</p> <pre><code> public synchronized void onEngineJobComplete(\nEngineJob&lt;?&gt; engineJob, Key key, EngineResource&lt;?&gt; resource) {\nif (resource != null &amp;&amp; resource.isMemoryCacheable()) {\n// \u52a0\u5165\u6d3b\u52a8\u8d44\u6e90\u7f13\u5b58\nactiveResources.activate(key, resource);\n}\n...\n}\n</code></pre> <p> \u4e3a\u4ec0\u4e48\u9700\u8981\u4e24\u79cd\u78c1\u76d8\u7f13\u5b58</p> <ol> <li>\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u6765\u6e90\u5728\u5360\u7528\u7a7a\u95f4\u548c\u6548\u7387\u4e0a\u9009\u62e9\u6700\u4f73\u65b9\u6848 \u5982\u679c\u662f\u8fdc\u7a0b\u56fe\u7247\uff0c\u5219\u53ea\u7f13\u5b58\u539f\u59cb\u56fe\u7247\uff1b\u56e0\u4e3a\u4e0b\u8f7d\u8fdc\u7a0b\u6570\u636e\u76f8\u6bd4\u8c03\u6574\u78c1\u76d8\u4e0a\u5df2\u7ecf\u5b58\u5728\u7684\u6570\u636e\u8981\u6602\u8d35\u5f97\u591a. \u5982\u679c\u662f\u672c\u5730\u56fe\u7247\uff0c\u90a3\u4e48\u53ea\u7f13\u5b58\u8f6c\u6362\u8fc7\u540e\u7684\u56fe\u7247, \u56e0\u4e3a\u5373\u4f7f\u4f60\u9700\u8981\u518d\u6b21\u751f\u6210\u53e6\u4e00\u4e2a\u5c3a\u5bf8\u6216\u7c7b\u578b\u7684\u56fe\u7247\uff0c\u53d6\u56de\u539f\u59cb\u6570\u636e\u4e5f\u5f88\u5bb9\u6613\u3002</li> <li>\u63d0\u9ad8\u7f13\u5b58\u6548\u7387 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u540c\u4e00\u5f20\u56fe\u7247\uff0c\u6211\u4eec\u5148\u5728<code>100*100</code>\u7684View\u662f\u5c55\u793a\uff0c\u518d\u5728<code>200*200</code>\u7684View\u4e0a\u5c55\u793a, \u5982\u679c\u4e0d\u7f13\u5b58\u53d8\u6362\u540e\u7684\u7c7b\u578b\u76f8\u5f53\u4e8e\u6bcf\u6b21\u90fd\u8981\u8fdb\u884c\u4e00\u6b21\u53d8\u6362\u64cd\u4f5c\uff0c\u5982\u679c\u4e0d\u7f13\u5b58\u539f\u59cb\u6570\u636e\u5219\u6bcf\u6b21\u90fd\u8981\u53bb\u91cd\u65b0\u4e0b\u8f7d\u6570\u636e</li> </ol>"},{"location":"perf-opt/Android/bitmap/glide/#23","title":"2.3 \u5185\u5b58\u4f18\u5316","text":"<p>\u6211\u4eec\u5148\u56de\u987e\u4e0bBitamp \u5185\u5b58\u5360\u7528\u5206\u6790, \u6211\u4eec\u77e5\u9053bitmap\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a</p> <p><pre><code>bitmapInRam = bitmapWidth*bitmapHeight*bytesPerPixel\nbitmapWidth = \u56fe\u7247\u5bbd\u5ea6/inSampleSize*inTargetDensity/inDensity\nbitmapHeight = \u56fe\u7247\u9ad8\u5ea6/inSampleSize*inTargetDensity/inDensity\n</code></pre> \u7531\u4e8e\u6211\u4eec\u4e0d\u662f\u4ece\u8d44\u6e90\u76ee\u5f55\u8bfb\u53d6\u56fe\u7247\uff0c\u6240\u4ee5inTargetDensity/inDensity=1\uff0c\u6240\u4ee5bitmapInRam = (\u56fe\u7247\u5bbd\u5ea6/inSampleSize) * (\u56fe\u7247\u9ad8\u5ea6/inSampleSize)*bytesPerPixel</p> <p>\u663e\u800c\u6613\u89c1\uff0c\u5047\u8bbe\u56fe\u7247\u5206\u8fa8\u7387\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u4eceinSampleSize\u548cbytesPerPixel\u4e24\u4e2a\u65b9\u9762\u8fdb\u884c\u4f18\u5316\uff0c\u53e6\u5916\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>inBitmap</code>\u6765\u590d\u7528bitmap\uff0c\u51cf\u5c11bitmap\u7684\u5185\u5b58\u5206\u914d\uff0c\u4e0b\u9762\u770b\u4e0bGlide\u662f\u5982\u4f55\u505a\u7684\u3002</p>"},{"location":"perf-opt/Android/bitmap/glide/#insamplesize","title":"\u5c3a\u5bf8\u4f18\u5316(inSampleSize)","text":"<p>\u5f53\u56fe\u7247\u5927\u5c0f\u4e0eView\u5927\u5c0f\u4e0d\u4e00\u81f4\u65f6\uff0c\u53ef\u4ee5\u7528inSampleSize\u8fdb\u884c\u5c3a\u5bf8\u4f18\u5316\uff0c \u4f8b\u5982ImageView\u53ea\u6709100*100\uff0c\u800c\u56fe\u7247\u7684\u5206\u8fa8\u7387\u4e3a800 * 800\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528inSampleSize\u5bf9Bitmap\u8fdb\u884c\u5c3a\u5bf8\u7f29\u653e,\u91c7\u6837\u7387\u8d8a\u9ad8\uff0c\u56fe\u7247\u8d8a\u5c0f\u3002</p> <p><code>Downsampler#calculateScaling</code> <pre><code>  private static void calculateScaling(\nImageType imageType,\nImageReader imageReader,\nDecodeCallbacks decodeCallbacks,\nBitmapPool bitmapPool,\nDownsampleStrategy downsampleStrategy,\nint degreesToRotate,\nint sourceWidth,\nint sourceHeight,\nint targetWidth,\nint targetHeight,\nBitmapFactory.Options options)\nthrows IOException {\n...\n//\u83b7\u53d6exactScaleFactor\uff0c downsampleStrategy\uff1a\u91c7\u6837\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e3aDownsampleStrategy#FIT_CENTER,\u53d6\u51b3\u4e8e\u4f60ImageView\u8bbe\u7f6e\u7684scaleType\nfinal float exactScaleFactor =\ndownsampleStrategy.getScaleFactor(\norientedSourceWidth, orientedSourceHeight, targetWidth, targetHeight);\nSampleSizeRounding rounding =\ndownsampleStrategy.getSampleSizeRounding(\norientedSourceWidth, orientedSourceHeight, targetWidth, targetHeight);\nif (rounding == null) {\nthrow new IllegalArgumentException(\"Cannot round with null rounding\");\n}\n//\u83b7\u53d6Bitmap\u8f93\u51fa\u5bbd\u9ad8\nint outWidth = round(exactScaleFactor * orientedSourceWidth);\nint outHeight = round(exactScaleFactor * orientedSourceHeight);\nint widthScaleFactor = orientedSourceWidth / outWidth;\nint heightScaleFactor = orientedSourceHeight / outHeight;\n// \u6839\u636e\u7f29\u653e\u7b56\u7565\u662f\u7701\u5185\u5b58\u8fd8\u662f\u9ad8\u54c1\u8d28\uff0c\u51b3\u5b9a\u53d6\u5bbd\u9ad8\u6bd4\u7684\u6700\u5927\u503c\u8fd8\u662f\u6700\u5c0f\u503c\nint scaleFactor =\nrounding == SampleSizeRounding.MEMORY\n? Math.max(widthScaleFactor, heightScaleFactor)\n: Math.min(widthScaleFactor, heightScaleFactor);\nint powerOfTwoSampleSize;\n// \u5728Android M\u53ca\u4ee5\u4e0b\u7248\u672c\uff0cBitmapFactory\u4e0d\u652f\u6301wbmp\u683c\u5f0f\u7684\u56fe\u7247\u8fdb\u884c\u7f29\u653e\nif (Build.VERSION.SDK_INT &lt;= 23\n&amp;&amp; NO_DOWNSAMPLE_PRE_N_MIME_TYPES.contains(options.outMimeType)) {\npowerOfTwoSampleSize = 1;\n} else {\n//\u5bf9scaleFactor\u518d\u8fdb\u884c\u5904\u7406\uff0c\u901a\u8fc7highestOneBit()\u628a\u8ba1\u7b97\u7684\u6bd4\u4f8b\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd12\u7684\u5e42\npowerOfTwoSampleSize = Math.max(1, Integer.highestOneBit(scaleFactor));\nif (rounding == SampleSizeRounding.MEMORY\n&amp;&amp; powerOfTwoSampleSize &lt; (1.f / exactScaleFactor)) {\n//\u5982\u679c\u7f29\u653e\u7b56\u7565\u4e3a\u7701\u5185\u5b58\uff0c\u5e76\u4e14\u8ba1\u7b97\u5f97\u51fa\u7684sampleSize &lt; exactScaleFactor,\u5219sampleSize\u518d\u589e\u52a0\u4e00\u500d\npowerOfTwoSampleSize = powerOfTwoSampleSize &lt;&lt; 1;\n}\n}\n//\u8bbe\u7f6einSampleSize\noptions.inSampleSize = powerOfTwoSampleSize;\n...\n}\n</code></pre></p>"},{"location":"perf-opt/Android/bitmap/glide/#bytesperpixel","title":"\u56fe\u7247\u683c\u5f0f\u4f18\u5316(bytesPerPixel)","text":"<p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\u53ef\u4ee5\u770b\u51fa\uff0cBitmap\u5360\u7528\u7684\u5185\u5b58\u4e3b\u8981\u662f\u7531<code>width * height * bytesPerPixel</code>\u51b3\u5b9a\u7684\uff0c\u5176\u4e2d<code>bytesPerPixel</code>\u662f\u7531<code>Bitmap.Config</code>\u51b3\u5b9a\u7684\uff0c\u5982\u4e0b\u8868\u6240\u793a</p> Config bytesPerPixel ALPHA_8 1 ARGB_4444 2 ARGB_8888 4 RGB_565 2 <p>\u4e0d\u540c\u683c\u5f0f\u5bf9\u5e94\u6bcf\u4e2a\u50cf\u7d20\u6240\u5360\u7528\u7684\u5b57\u8282\u4e0d\u4e00\u6837\uff0c\u6240\u5b58\u50a8\u7684\u8272\u5f69\u4fe1\u606f\u4e5f\u4e0d\u540c\u3002\u540c\u4e00\u5f20100\u50cf\u7d20\u7684\u56fe\u7247\uff0cARGB_8888\u5c31\u5360\u4e86400\u5b57\u8282\uff0cRGB_565\u624d\u5360200\u5b57\u8282</p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\u5728Glide4.0\u4e4b\u524d,Glide\u9ed8\u8ba4\u4f7f\u7528<code>RGB565</code>\u683c\u5f0f\uff0c\u8fd9\u6837\u6bd4\u8f83\u7701\u5185\u5b58\uff0c\u4f46\u5bf9\u4e8e\u7279\u5b9a\u7684\u56fe\u7247\u6709\u660e\u663e\u7684\u753b\u8d28\u95ee\u9898\uff0c\u8b6c\u5982\u6761\u7eb9(<code>banding</code>)\u548c\u7740\u8272(<code>tinting</code>), \u6240\u4ee5Glide4.0\u4e4b\u540e\uff0c\u9ed8\u8ba4\u683c\u5f0f\u5df2\u7ecf\u53d8\u6210\u4e86<code>ARGB_8888</code>\u683c\u5f0f\u4e86, \u56fe\u7247\u8d28\u91cf\u53d8\u9ad8\u4e86\uff0c\u4f46\u5185\u5b58\u4f7f\u7528\u4e5f\u589e\u52a0\u4e86\u3002 \u8fd9\u672c\u8eab\u4e5f\u5c31\u662f\u8d28\u91cf\u4e0e\u5185\u5b58\u4e4b\u95f4\u7684\u53d6\u820d\uff0c\u5982\u679c\u5e94\u7528\u6240\u9700\u56fe\u7247\u7684\u8d28\u91cf\u8981\u6c42\u4e0d\u9ad8\uff0c\u4e5f\u53ef\u4ee5\u4fee\u6539\u9ed8\u8ba4\u683c\u5f0f\uff0c\u901a\u8fc7\u5728 <code>AppGlideModule</code> \u4e2d\u5e94\u7528\u4e00\u4e2a <code>RequestOption</code>\uff1a <pre><code>@GlideModule\npublic final class YourAppGlideModule extends GlideModule {\n@Override\npublic void applyOptions(Context context, GlideBuilder builder) {\nbuilder.setDefaultRequestOptions(new RequestOptions().format(DecodeFormat.PREFER_RGB_565));\n}\n}\n</code></pre></p>"},{"location":"perf-opt/Android/bitmap/glide/#inbitmap","title":"\u5185\u5b58\u590d\u7528\u4f18\u5316(inBitmap)","text":"<p>\u5728 Android 3.0\uff08API \u7ea7\u522b 11\uff09\u5f00\u59cb\uff0c\u7cfb\u7edf\u5f15\u5165\u4e86 <code>BitmapFactory.Options.inBitmap</code> \u5b57\u6bb5\u3002\u5982\u679c\u8bbe\u7f6e\u4e86\u6b64\u9009\u9879\uff0c\u90a3\u4e48\u91c7\u7528 Options \u5bf9\u8c61\u7684\u89e3\u7801\u65b9\u6cd5\u4f1a\u5728\u751f\u6210\u76ee\u6807 Bitmap \u65f6\u5c1d\u8bd5\u590d\u7528 inBitmap\uff0c\u8fd9\u610f\u5473\u7740 inBitmap \u7684\u5185\u5b58\u5f97\u5230\u4e86\u91cd\u590d\u4f7f\u7528\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u6027\u80fd\uff0c\u540c\u65f6\u79fb\u9664\u4e86\u5185\u5b58\u5206\u914d\u548c\u53d6\u6d88\u5206\u914d\u3002\u4e0d\u8fc7 inBitmap \u7684\u4f7f\u7528\u65b9\u5f0f\u5b58\u5728\u67d0\u4e9b\u9650\u5236\uff0c\u5728 Android 4.4\uff08API \u7ea7\u522b 19\uff09\u4e4b\u524d\u7cfb\u7edf\u4ec5\u652f\u6301\u590d\u7528\u5927\u5c0f\u76f8\u540c\u7684\u4f4d\u56fe\uff0c4.4 \u4e4b\u540e\u53ea\u8981 inBitmap \u7684\u5927\u5c0f\u6bd4\u76ee\u6807 Bitmap \u5927\u5373\u53ef</p> <p>\u65e2\u7136\u60f3\u590d\u7528Bitmap\uff0c\u5c31\u9700\u8981\u6709\u96c6\u5408\u6765\u5b58\u50a8\u8fd9\u4e9bBitmap\uff0c\u5728Glide\u4e2d\uff0c<code>BitmapPool</code>\u5c31\u662f\u5e72\u8fd9\u4e8b\u7684\u3002Glide \u901a\u8fc7 SDK \u7248\u672c\u4e0d\u540c\u521b\u5efa\u4e0d\u540c\u7684 BitmapPool \u5b9e\u4f8b\uff0c\u7248\u672c\u4f4e\u4e8e <code>Build.VERSION_CODES.HONEYCOMB(11)</code> \u5b9e\u4f8b\u4e3a <code>BitmapPoolAdapter</code>\uff0c\u662f\u4e2a\u7a7a\u5b9e\u73b0\u3002Glide \u771f\u6b63\u6709\u6548\u7684<code>BitmapPool</code> \u5b9e\u4f8b\u662f<code>LruBitmapPool</code>\u3002</p> <p><code>LruBitmapPool</code> <pre><code>public class LruBitmapPool implements BitmapPool {\nLruBitmapPool(long maxSize, LruPoolStrategy strategy, Set&lt;Bitmap.Config&gt; allowedConfigs) {\nthis.initialMaxSize = maxSize;\nthis.maxSize = maxSize;\nthis.strategy = strategy;\nthis.allowedConfigs = allowedConfigs;\nthis.tracker = new NullBitmapTracker();\n}\n@Override\npublic synchronized void put(Bitmap bitmap) {\n...\nif (!bitmap.isMutable()\n|| strategy.getSize(bitmap) &gt; maxSize\n|| !allowedConfigs.contains(bitmap.getConfig())) {\nreturn;\n}\nfinal int size = strategy.getSize(bitmap);\nstrategy.put(bitmap);\n\u00b7\u00b7\u00b7\n}\n@Override\n@NonNull\npublic Bitmap get(int width, int height, Bitmap.Config config) {\nBitmap result = getDirtyOrNull(width, height, config);\nif (result != null) {\nresult.eraseColor(Color.TRANSPARENT);\n} else {\nresult = createBitmap(width, height, config);\n}\nreturn result;\n}\n@Nullable\nprivate synchronized Bitmap getDirtyOrNull(\nint width, int height, @Nullable Bitmap.Config config) {\nfinal Bitmap result = strategy.get(width, height, config != null ? config : DEFAULT_CONFIG);\nif (result == null) {\nmisses++;\n} else {\nhits++;\ncurrentSize -= strategy.getSize(result);\ntracker.remove(result);\nnormalize(result);\n}\n...\nreturn result;\n}\n...\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230<code>LruBitmapPool</code> \u4e2d\u6ca1\u6709\u505a\u592a\u591a\u7684\u4e8b\uff0c\u53ea\u662f\u505a\u4e00\u4e9b\u7f13\u5b58\u5927\u5c0f\u7ba1\u7406\u3001\u5c01\u88c5\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u7b49\u64cd\u4f5c, \u4e3b\u8981\u4efb\u52a1\u90fd\u4ea4\u7ed9\u4e86 <code>LruPoolStrategy</code>\uff0c\u8fd9\u91cc\u91c7\u7528\u7684\u662f<code>\u7b56\u7565\u6a21\u5f0f</code>\u3002</p> <p><code>LruPoolStrategy</code> \u6709\u4e24\u4e2a\u5b9e\u73b0\u7c7b\uff1a<code>SizeConfigStrategy</code> \u4ee5\u53ca <code>AttributeStrategy</code>\uff0c\u5176\u4e2d\uff0c<code>AttributeStrategy</code> \u9002\u7528\u4e8e Android 4.4 \u4ee5\u4e0b\u7684\u7248\u672c\uff0c<code>SizeConfigStrategy</code> \u9002\u7528\u4e8e Android 4.4 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\u3002</p> <p><code>AttributeStrategy</code> \u901a\u8fc7 Bitmap \u7684 width\uff08\u56fe\u7247\u5bbd\u5ea6\uff09\u3001height\uff08\u56fe\u7247\u9ad8\u5ea6\uff09 \u548c config\uff08\u56fe\u7247\u989c\u8272\u7a7a\u95f4\uff0c\u6bd4\u5982 ARGB_8888 \u7b49\uff09 \u4e09\u4e2a\u53c2\u6570\u4f5c\u4e3a Bitmap \u7684\u552f\u4e00\u6807\u8bc6\u3002\u5f53\u83b7\u53d6 Bitmap \u7684\u65f6\u5019\u53ea\u6709\u8fd9\u4e09\u4e2a\u6761\u4ef6\u5b8c\u5168\u5339\u914d\u624d\u884c\u3002\u800c <code>SizeConfigStrategy</code> \u4f7f\u7528 size\uff08\u56fe\u7247\u7684\u50cf\u7d20\u603b\u6570\uff09 \u548c config \u4f5c\u4e3a\u552f\u4e00\u6807\u8bc6\u3002\u5f53\u83b7\u53d6\u7684\u65f6\u5019\u4f1a\u5148\u627e\u51fa cofig \u5339\u914d\u7684 Bitmap\uff08\u4e00\u822c\u5c31\u662f config \u76f8\u540c\uff09\uff0c\u7136\u540e\u4fdd\u8bc1\u8be5 Bitmap \u7684 size \u5927\u4e8e\u6211\u4eec\u671f\u671b\u7684 size \u5e76\u4e14\u5c0f\u4e8e\u671f\u671b size \u7684 8 \u500d\u5373\u53ef\u590d\u7528\u3002</p> <p>\u5f97\u5230\u53ef\u590d\u7528Bitmap\u4e4b\u540e\uff0cGlide\u5c31\u8bbe\u7f6e\u5230\u5bf9\u5e94<code>BitmapFactory.Options</code>:</p> <p><code>Downsampler#setInBitmap</code> </p> <pre><code>  private static void setInBitmap(\nBitmapFactory.Options options, BitmapPool bitmapPool, int width, int height) {\n@Nullable Bitmap.Config expectedConfig = null;\n...\noptions.inBitmap = bitmapPool.getDirty(width, height, expectedConfig);\n}\n</code></pre> <p>\u6c60\u5316 (Pooling)</p> <p>Glide\u4e2d\u9664\u4e86bitmap\u4e4b\u5916\uff0c\u5bf9\u4e8e<code>byte[] \u6570\u7ec4</code>\uff0c <code>int[] \u6570\u7ec4</code>\u4e5f\u505a\u4e86\u590d\u7528\uff0c\u8fd9\u4e2a\u4f53\u73b0\u5728<code>LruArrayPool</code>\u4e2d\uff0c\u8b6c\u5982\u7528\u4e8e<code>BitmapFactory.Options.inTempStorage</code>\u7684\u503c\uff0c\u8fd9\u4e2a\u4f5c\u7528\u662f\u6307\u5b9a\u89e3\u7801\u8fc7\u7a0b\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u3002</p> <p>\u201c\u6c60\u5316\u201d\u4ee5\u53ca\u5bf9\u8c61\u590d\u7528\u8fd9\u4e9b\u8d44\u6e90\uff0c\u53ef\u4ee5\u51cf\u5c11\u5e94\u7528\u4e2d\u7684\u5185\u5b58\u6296\u52a8\u6570\u91cf\u3002\u5982\u679c\u6bcf\u6b21\u4f7f\u7528\u7684\u65f6\u5019\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u56e0\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u5bfc\u81f4\u865a\u62df\u673a GC\uff0c\u4ece\u800c\u9020\u6210\u9875\u9762\u5361\u987f\u73b0\u8c61</p> <p>\u57285.0\u4e4b\u524d\uff0cDalvik \u6709\u4e24\u79cd\u57fa\u672c\u7684 GC \u6a21\u5f0f\uff0c <code>GC_CONCURRENT</code>\u548c <code>GC_FOR_ALLOC</code> \u3002</p> <ul> <li> <p><code>GC_CONCURRENT</code>\uff1a\u5bf9\u4e8e\u6bcf\u6b21\u6536\u96c6\u5c06\u963b\u585e\u4e3b\u7ebf\u7a0b\u5927\u7ea6 5ms \u3002\u56e0\u4e3a\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u6bd4\u4e00\u5e27(16ms)\u8981\u5c0f\uff0cGC_CONCURRENT \u901a\u5e38\u4e0d\u4f1a\u9020\u6210\u4f60\u7684\u5e94\u7528\u4e22\u5e27\u3002</p> </li> <li> <p><code>GC_FOR_ALLOC</code>\uff1a\u662f\u4e00\u79cd <code>stop-the-world</code> \u6536\u96c6\uff0c\u53ef\u80fd\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u8fbe\u5230 125ms \u4ee5\u4e0a\u3002<code>GC_FOR_ALLOC</code> \u51e0\u4e4e\u6bcf\u6b21\u90fd\u4f1a\u9020\u6210\u4f60\u7684\u5e94\u7528\u4e22\u5931\u591a\u4e2a\u5e27\uff0c\u5bfc\u81f4\u89c6\u89c9\u5361\u987f\uff0c\u7279\u522b\u662f\u5728\u6ed1\u52a8\u7684\u65f6\u5019\u3002</p> </li> </ul> <p>\u4e0d\u5e78\u7684\u662f\uff0c<code>Dalvik</code> \u4f3c\u4e4e\u751a\u81f3\u8fde\u9002\u5ea6\u7684\u5206\u914d\uff08\u4f8b\u5982\u4e00\u4e2a 16kb \u7684\u7f13\u51b2\u533a\uff09\u90fd\u5904\u7406\u5f97\u4e0d\u662f\u5f88\u597d\u3002\u91cd\u590d\u7684\u4e2d\u7b49\u5206\u914d\uff0c\u6216\u5373\u4f7f\u5355\u6b21\u5927\u7684\u5206\u914d\uff08\u6bd4\u5982\u8bf4\u4e00\u4e2a <code>Bitmap</code> \uff09\uff0c\u5c06\u4f1a\u5bfc\u81f4 <code>GC_FOR_ALLOC</code>\u3002\u56e0\u6b64\uff0c\u4f60\u5206\u914d\u7684\u5185\u5b58\u8d8a\u591a\uff0c\u5c31\u4f1a\u62db\u6765\u8d8a\u591a <code>stop-the-world</code> \u7684 <code>GC</code>\uff0c\u800c\u4f60\u7684\u5e94\u7528\u5c06\u6709\u66f4\u591a\u7684\u4e22\u5e27\u3002</p> <p>\u901a\u8fc7\u590d\u7528\u4e2d\u5230\u5927\u5c3a\u5bf8\u7684\u8d44\u6e90\uff0c Glide \u53ef\u4ee5\u5e2e\u4f60\u5c3d\u53ef\u80fd\u5730\u51cf\u5c11\u8fd9\u79cd GC\uff0c\u4ee5\u4fdd\u6301\u5e94\u7528\u7684\u6d41\u7545\u3002</p> <p>\u867d\u7136 Android 5.0\u4e4b\u540e\u4f7f\u7528 <code>ART</code>, \u8fd0\u884c\u65f6\u7684 GC \u60e9\u7f5a\u6bd4 Dalvik \u8fd0\u884c\u65f6\u8981\u4f4e\uff0c\u4f46\u65e0\u8bba\u4f7f\u7528\u4ec0\u4e48\u8bbe\u5907\uff0c\u8fc7\u591a\u5185\u5b58\u5206\u914d\u90fd\u4f1a\u964d\u4f4e\u5e94\u7528\u7684\u6027\u80fd\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/","title":"\u56fe\u7247\u6587\u4ef6\u6280\u672f\u539f\u7406","text":""},{"location":"perf-opt/Android/bitmap/image/#_2","title":"\u8ba1\u7b97\u673a\u5b58\u50a8\u672c\u8d28","text":"<p>\u8ba1\u7b97\u673a\u6240\u6709\u7684\u6587\u4ef6\u5747\u4e3a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5305\u62ec\u6587\u672c\u6587\u4ef6\uff08\u5b83\u662f\u7279\u6b8a\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4e3a\u4ec0\u4e48\u7279\u6b8a\uff1f\u56e0\u4e3a\u5b83\u91cc\u9762\u5168\u90e8\u53ef\u76f4\u63a5\u7ffb\u8bd1\u4e3a\u5b57\u7b26\uff09\uff0c\u8fd9\u4e9b\u4e8c\u8fdb\u5236\u6587\u4ef6\u5c31\u662f\u4e00\u7fa40101\u96c6\u5408\uff08\u7279\u5b9a\u8f6f\u4ef6\u80fd\u6253\u5f00\u5c31\u80fd\u770b\u5230\uff09\uff0c\u4ed6\u4eec\u7684\u8bfb\u53d6\u4e0e\u5199\u5165\uff0c\u8fc7\u7a0b\u5b8c\u5168\u76f8\u540c\uff1a</p> <ul> <li>\u8bfb\u5165\u5185\u5b58\uff1a\u6587\u4ef6\u2192\u4e8c\u8fdb\u5236\u6d41\u2192\u2192\u6309\u683c\u5f0f \u89e3\u7801\u2192\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u6570\u636e</li> <li>\u5199\u51fa\u6587\u4ef6\uff1a\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u6570\u636e\u2192\u6309\u683c\u5f0f \u7f16\u7801\u2192\u4e8c\u8fdb\u5236\u6d41\u2192\u6587\u4ef6</li> </ul> <p>\u6240\u6709\u6587\u4ef6\u7684\u8bfb\u5199\u8fc7\u7a0b\u90fd\u662f\u8fd9\u6837\u7684\uff0c\u53ea\u662f \u89e3\u7801 \u4e0e \u7f16\u7801 \u7684\u683c\u5f0f\u4e0d\u540c\u800c\u5df2\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_3","title":"\u663e\u793a\u539f\u7406","text":"<p>\u5148\u7528\u4e00\u53e5\u8bdd\u603b\u7ed3\u663e\u793a\u539f\u7406\uff1a \u8ba1\u7b97\u673a\u4e2d\u7684\u6587\u5b57\u548c\u56fe\u50cf\u90fd\u662f\u4ee5\u50cf\u7d20\u7684\u5f62\u5f0f\u663e\u793a\u7684\u3002\u663e\u793a\u5b57\u7b26\u7684\u672c\u8d28\u4e5f\u662f\u663e\u793a\u56fe\u50cf\u2014\u2014\u6bcf\u4e00\u4e2a\u6c49\u5b57\u3001\u82f1\u6587\u5b57\u7b26\u90fd\u662f\u4ee5\u50cf\u7d20\u7684\u5f62\u5f0f\u5728\u5c4f\u5e55\u4e0a\u8f93\u51fa\u3002</p> <p>\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u4ee5\u50cf\u7d20\u5f62\u5f0f\u7ec4\u6210\u56fe\u5f62\u548c\u6587\u5b57\u7684\u4e0d\u4ec5\u4ec5\u662f\u8ba1\u7b97\u673a\uff0c\u8fd8\u5305\u62ec\u6211\u4eec\u7ecf\u5e38\u89c1\u5230\u7684\u300c\u5341\u5b57\u7ee3\u300d\uff0c\u505a\u5de5\u7cbe\u7ec6\u7684\u591a\u8272\u5341\u5b57\u7ee3\u51e0\u4e4e\u53ef\u4ee5\u6a21\u62df\u7167\u7247\u7684\u89c6\u89c9\u6548\u679c\u3002</p> <p></p> <p>\u4e0e\u9759\u6001\u7684\u5341\u5b57\u7ee3\u4e0d\u540c\uff0c\u8ba1\u7b97\u673a\u7684\u663e\u793a\u5668\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\u5b83\u8981\u663e\u793a\u7684\u5185\u5bb9\u662f\u52a8\u6001\u7684\u3001\u53d8\u5316\u7684\u3002</p> <p>\u5148\u4ece\u663e\u793a\u5668\u8bf4\u8d77\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_4","title":"\u53d1\u5149\u4e8c\u6781\u7ba1\u663e\u793a\u5668","text":"<p>\u5982\u679c\u8bf4\u624b\u673a\u3001\u7535\u8111\u7684\u663e\u793a\u5c4f\u7531\u4e8e\u50cf\u7d20\u592a\u5c0f\u4e86\u5bfc\u81f4\u6211\u4eec\u770b\u4e0d\u51fa\u5b83\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u90a3\u4e48\u4e0b\u9762\u7684\u663e\u793a\u5c4f\u4f60\u4e00\u5b9a\u89c1\u8fc7\u5e76\u4e14\u770b\u5f97\u61c2\u3002</p> <p></p> <p>\u8fd9\u79cd\u663e\u793a\u5c4f\u79f0\u4e3a\u300c\u53d1\u5149\u4e8c\u6781\u7ba1\u663e\u793a\u5c4f\u300d\uff0c\u8fd9\u79cd\u5355\u8272\u663e\u793a\u5c4f\u7531\u4e00\u79cd\u989c\u8272\u7684\u53d1\u5149\u4e8c\u6781\u7ba1\u7ec4\u6210\uff0c\u7531\u9a71\u52a8\u7535\u8def\u51b3\u5b9a\u6bcf\u4e00\u4e2a\u4e8c\u6781\u7ba1\u7684\u4eae\u6216\u706d\uff0c\u6bcf\u4e00\u4e2a\u4e8c\u6781\u7ba1\u53ef\u4ee5\u88ab\u79f0\u4e3a\u4e00\u4e2a\u300c\u50cf\u7d20\u300d\u3002 \u5355\u8272\u663e\u793a\u5c4f\u7684\u989c\u8272\u7531\u53d1\u5149\u4e8c\u6781\u7ba1\u7684\u989c\u8272\u51b3\u5b9a\uff0c\u4eba\u4eec\u5f53\u7136\u4e0d\u53ef\u80fd\u6ee1\u8db3\u5355\u8272\u663e\u793a\uff0c\u600e\u6837\u624d\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u53d1\u5149\u4e8c\u6781\u7ba1\u53d1\u51fa\u5404\u79cd\u989c\u8272\u7684\u5149\u5462\uff1f\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u5c31\u662f\u628a\u4e09\u79cd\u989c\u8272\u7684\u53d1\u5149\u4e8c\u6781\u7ba1\u505a\u5230\u4e00\u8d77\uff0c\u8fd9\u4e09\u79cd\u989c\u8272\u5c31\u662f\u4e09\u539f\u8272\u2014\u2014\u7ea2\u8272\u3001\u7eff\u8272\u548c\u84dd\u8272\u3002\u8fd9\u4e09\u4e2a\u4e8c\u6781\u7ba1\u4ee5\u4e0d\u540c\u7684\u4eae\u5ea6\u53d1\u5149\uff0c\u5c31\u53ef\u4ee5\u7ec4\u5408\u6210\u591a\u79cd\u989c\u8272\uff0c\u5728\u73b0\u5b9e\u4e2d\u8fd9\u4e09\u4e2a\u4e8c\u6781\u7ba1\u88ab\u7ec4\u5408\u5230\u4e00\u8d77\uff1a</p> <p> </p> <p>\u6211\u4eec\u770b\u5230\u7684\u5927\u578b\u6237\u5916\u5e7f\u544a\u5c4f\u5f88\u591a\u5c31\u662f\u91c7\u7528\u8fd9\u79cd\u663e\u793a\u539f\u7406\u7684\uff0c\u8fd9\u79cd\u663e\u793a\u5c4f\u4e0a\u91c7\u7528\u7684\u53d1\u5149\u4e8c\u6781\u7ba1\u5355\u4e2a\u4f53\u79ef\u8d8a\u5c0f\u3001\u6570\u91cf\u8d8a\u591a\uff0c\u663e\u793a\u7684\u56fe\u5f62\u6548\u679c\u5c31\u8d8a\u7ec6\u817b\u548c\u4e30\u5bcc\uff1a</p> <p></p>"},{"location":"perf-opt/Android/bitmap/image/#oled","title":"OLED\u663e\u793a\u5c4f","text":"<p>\u90a3\u4e48\uff0c\u5982\u679c\u628a\u53d1\u5149\u4e8c\u6781\u7ba1\u505a\u7684\u5f88\u5c0f\u3001\u5f88\u8584\uff0c\u662f\u4e0d\u662f\u5c31\u53ef\u4ee5\u7528\u4e8e\u624b\u673a\u548c\u7535\u8111\u5c4f\u5e55\u5462\uff1f \u662f\u7684\uff0c\u8fd1\u5e74\u6765\u4e00\u4e9b\u624b\u673a\uff08\u5982iPhone X\uff09\u5c31\u91c7\u7528\u4e86\u88ab\u79f0\u4e3aOLED\u7684\u663e\u793a\u6280\u672f\uff0c\u6240\u4e0d\u540c\u7684\u662f\u91c7\u7528\u4e86\u300c\u6709\u673a\u53d1\u5149\u4e8c\u6781\u7ba1\u300d\uff08Organic Light-Emitting Diode\uff0c\u7f29\u5199OLED\uff09\uff0c\u8fd9\u79cd\u53d1\u5149\u4e8c\u6781\u7ba1\u53ef\u4ee5\u505a\u7684\u5f88\u5c0f\u3001\u5f88\u8584\uff0c\u4e0b\u56fe\u662fiPhone X\u7684OLED\u5c4f\u5e55\uff1a</p> <p></p> <p>OLED\u5c4f\u5e55\u4e0a\u6bcf\u4e00\u4e2a\u50cf\u7d20\u90fd\u7531\u4e09\u4e2a\u53d1\u5149\u4e8c\u6781\u7ba1\u7ec4\u6210\uff0c\u5b83\u4eec\u50cf\u706f\u6ce1\u4e00\u6837\u4f1a\u8001\u5316\uff0c\u8001\u5316\u7684\u53d1\u5149\u4e8c\u6781\u7ba1\u7684\u4eae\u5ea6\u4f1a\u53d1\u751f\u8870\u51cf\uff1b\u5982\u679c\u4e00\u4e2a\u663e\u793a\u5c4f\u957f\u671f\u663e\u793a\u4e00\u526f\u753b\u9762\uff0c\u5219\u5c4f\u5e55\u4e0a\u7684\u53d1\u5149\u4e8c\u6781\u7ba1\u8001\u5316\u7a0b\u5ea6\u4f1a\u4e0d\u4e00\u6837\u3002\u8fd9\u5c31\u5e26\u6765OLED\u663e\u793a\u5c4f\u7684\u786c\u4f24\u2014\u2014\u4fd7\u79f0\u300c\u70e7\u5c4f\u300d\uff0c\u6709\u65f6\u4e5f\u79f0\u5b83\u4e3a\u300c\u6b8b\u5f71\u300d\uff08\u5982\u4e0b\u56fe\u7684iPhone X\uff09\u3002\u597d\u5728\u8fd9\u79cd\u60c5\u51b5\u591a\u51fa\u73b0\u5728\u4e00\u4e9b\u957f\u65f6\u95f4\u3001\u9ad8\u4eae\u5ea6\u663e\u793a\u540c\u4e00\u4e2a\u753b\u9762\u7684\u624b\u673a\u4e0a\u3002</p> <p></p> <p>\u6b64\u5916\uff0c\u7531\u4e8eOLED\u663e\u793a\u5c4f\u662f\u4e3b\u52a8\u53d1\u5149\u7684\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u505a\u6210\u900f\u660e\u7684\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#lcd","title":"LCD\u663e\u793a\u5c4f","text":"<p>OLED\u662f\u6700\u8fd1\u4e00\u4e9b\u5e74\u624d\u51fa\u73b0\u7684\u65b0\u6280\u672f\uff0c\u8fd8\u5b58\u5728\u6210\u672c\u9ad8\u3001\u5de5\u827a\u4e0d\u6210\u719f\u7684\u7f3a\u70b9\u3002\u56e0\u6b64\u6211\u4eec\u73b0\u5728\u4f7f\u7528\u7684\u7535\u89c6\u673a\u3001\u663e\u793a\u5668\u4e3b\u8981\u8fd8\u662f\u4ee5LCD\u4e3a\u4e3b\u3002 LCD\u7684\u5168\u79f0\u662f\u300c\u6db2\u6676\u663e\u793a\u5668\u300d\uff08Liquid-Crystal Display\uff0c\u7f29\u5199\uff1aLCD\uff09\u3002\u4e0eOLED\u4e0d\u540c\u7684\u662f\u5728\u663e\u793a\u5c4f\u672c\u8eab\u4e0d\u53d1\u5149\uff0c\u800c\u662f\u6709\u4e00\u4e2a\u767d\u8272\u7684\u80cc\u5149\u5149\u6e90\u3002LCD\u663e\u793a\u5c4f\u901a\u8fc7\u8584\u819c\u6676\u4f53\u7ba1\u63a7\u5236\u6db2\u6676\u7684\u504f\u8f6c\u89d2\u5ea6\uff0c\u8fdb\u800c\u80fd\u63a7\u5236\u900f\u8fc7\u5b83\u7684\u80cc\u5149\u4eae\u5ea6\uff1b\u900f\u8fc7\u6db2\u6676\u5c42\u7684\u80cc\u5149\u518d\u901a\u8fc7\u5f69\u8272\u6ee4\u5149\u7247\uff0c\u5c31\u53d8\u6210\u4e09\u79cd\u989c\u8272\u3001\u5f3a\u5f31\u4e0d\u540c\u7684\u989c\u8272\uff0c\u8fdb\u800c\u7ec4\u5408\u6210\u5404\u79cd\u989c\u8272\u3002</p> <p></p> <p>\u6bcf\u4e00\u4e2a\u6db2\u6676\u663e\u793a\u5668\u90fd\u7531\u6570\u767e\u4e07\u4e2a\u8fd9\u6837\u7684\u4e09\u8272\u5355\u5143\u7ec4\u6210\uff0c\u6700\u7ec8\u6210\u4e3a\u6211\u4eec\u5728\u5c4f\u5e55\u4e0a\u770b\u5230\u7684\u56fe\u50cf\u3002</p> <p></p> <p>LCD\u663e\u793a\u5668\u4e5f\u6709\u8001\u5316\u7684\u95ee\u9898\uff0c\u4e0d\u8fc7\u5b83\u7684\u8001\u5316\u901a\u5e38\u662f\u80cc\u5149\u5149\u6e90\u7684\u8001\u5316\uff0c\u662f\u5747\u5300\u7684\u800c\u4e0d\u662f\u5c40\u90e8\u7684\uff0c\u56e0\u6b64\u4e0d\u4f1a\u51fa\u73b0OLED\u663e\u793a\u5668\u7684\u6b8b\u5f71\u95ee\u9898\u3002\u4e00\u4e9b\u663e\u793a\u5c4f\u7528\u7684\u65f6\u95f4\u957f\u4e86\u989c\u8272\u4e0d\u9c9c\u8273\u3001\u5c4f\u5e55\u53d1\u9ec4\u5c31\u662f\u8001\u5316\u7684\u8868\u73b0\u3002 \u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u65e0\u8bba\u4f55\u79cd\u7c7b\u578b\u7684\u663e\u793a\u5668\uff0c\u5b83\u7684\u6bcf\u4e00\u4e2a\u50cf\u7d20\u90fd\u662f\u7531\u4e09\u79cd\u989c\u8272\u7684\u70b9\u7ec4\u6210\uff0c\u8fd9\u4e09\u79cd\u989c\u8272\u5206\u522b\u662f\u7ea2\u8272\uff08Red\uff09\u3001\u7eff\u8272\uff08Green\uff09\u548c\u84dd\u8272\uff08Blue\uff09\u3002 \u7406\u8bba\u4e0a\uff0c\u8fd9\u4e09\u79cd\u989c\u8272\u7684\u4eae\u5ea6\u88ab\u8bbe\u7f6e\u4e3a0-255\u7ea7\uff0c\u8fd9\u6837\u4e00\u6765\u4e09\u79cd\u989c\u8272\u7684\u4e0d\u540c\u4eae\u5ea6\u53ef\u4ee5\u6709256\u00d7256\u00d7256\u79cd\u7ec4\u5408\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u4e00\u4e2a\u70b9\u53ef\u4ee5\u7ec4\u5408\u6210\u4e00\u5343\u516d\u767e\u4e03\u5341\u4e03\u4e07\u4e03\u5343\u4e8c\u767e\u4e00\u5341\u516d\u79cd\u989c\u8272\uff0c\u8fd9\u5b9e\u9645\u4e0a\u5df2\u7ecf\u8d85\u8fc7\u4e86\u4eba\u773c\u5bf9\u989c\u8272\u7684\u5206\u8fa8\u529b\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_5","title":"\u663e\u793a\u9a71\u52a8\u7535\u8def","text":"<p>\u663e\u793a\u5668\u91cc\u6709\u4e00\u5757\u88ab\u79f0\u4e3a\u300c\u9a71\u52a8\u677f\u300d\u7684\u7535\u8def\uff0c\u5b83\u4e00\u65b9\u9762\u63a7\u5236\u7740\u663e\u793a\u9762\u677f\u4e0a\u7684\u6bcf\u4e00\u4e2a\u5b50\u50cf\u7d20\u7684\u4eae\u706d\uff0c\u53e6\u4e00\u65b9\u9762\u901a\u8fc7VGAHDMIDVI\u8fd9\u4e9b\u63a5\u53e3\u4e0e\u4e3b\u673a\u7684\u663e\u5361\u8fde\u63a5\uff0c\u63a5\u53d7\u4e3b\u673a\u8f93\u51fa\u7684\u663e\u793a\u4fe1\u53f7\u3002</p> <p></p> <p>\u4e0e\u5927\u591a\u6570\u4eba\u60f3\u8c61\u7684\u4e0d\u4e00\u6837\u7684\u662f\u2014\u2014\u663e\u793a\u5668\u5e76\u4e0d\u662f\u4e00\u6b21\u6027\u63a7\u5236\u663e\u793a\u9762\u677f\u4e0a\u6240\u6709\u50cf\u7d20\u7684\u989c\u8272\uff0c\u800c\u662f\u4e00\u6b21\u63a7\u5236\u201c\u4e00\u884c\u201d\uff0c\u81ea\u4e0a\u81f3\u4e0b\u5730\u63a7\u5236\u663e\u793a\u9762\u677f\u4e0a\u6bcf\u4e00\u884c\u50cf\u7d20\uff0c\u5468\u800c\u590d\u59cb\u3002\u7531\u4e8e\u5237\u65b0\u7684\u901f\u5ea6\u5f88\u5feb\uff08\u4e00\u79d2\u949f60\u6b21\uff09\uff0c\u56e0\u6b64\u4f60\u4e0d\u4f1a\u770b\u5230\u5c4f\u5e55\u5728\u95ea\u70c1\uff0c\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u964d\u4f4e\u786c\u4ef6\u8bbe\u8ba1\u7684\u590d\u6742\u5ea6\u3002 \u5982\u679c\u4f60\u7528\u8f83\u5feb\u7684\u5feb\u95e8\u901f\u5ea6\u62cd\u6444\u8001\u5f0fCRT\u663e\u793a\u5668\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u771f\u7684\u201c\u4e00\u884c\u884c\u5730\u201d\u663e\u793a\u56fe\u50cf\uff08\u6db2\u6676\u663e\u793a\u5668\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0c\u4f46\u5b83\u4e5f\u662f\u9010\u884c\u626b\u63cf\u7684\uff09</p> <p></p>"},{"location":"perf-opt/Android/bitmap/image/#_6","title":"\u663e\u793a\u9002\u914d\u5668\uff08\u663e\u5361\uff09","text":"<p>\u663e\u5361\u7684\u804c\u80fd\u662f\u5c06\u8981\u663e\u793a\u7684\u56fe\u5f62\u6216\u6587\u672c\u8f6c\u6362\u6210\u53ef\u4ee5\u9a71\u52a8\u663e\u793a\u5668\u7684\u7535\u4fe1\u53f7\uff0c\u5b83\u6709\u4e09\u4e2a\u91cd\u8981\u7684\u7ec4\u6210\u90e8\u5206\uff1a</p> <ul> <li>\u663e\u5b58</li> <li>\u663e\u5361BIOS</li> <li>GPU</li> </ul> <p>\u4e0b\u56fe\u662f\u4e00\u4e2a\u6bd4\u8f83\u8001\u7684AGP\u663e\u5361\uff0c\u6211\u4e4b\u6240\u4ee5\u9009\u62e9\u8fd9\u4e2a\u63d2\u56fe\u662f\u4e00\u4e9b\u65b0\u7684\u663e\u5361\u5f80\u5f80\u6709\u5e9e\u5927\u7684\u6563\u70ed\u7247\u906e\u6321\u4f4f\u4e86\u4e0b\u9762\u7684\u5143\u4ef6\u3002</p> <p></p>"},{"location":"perf-opt/Android/bitmap/image/#_7","title":"\u663e\u5b58","text":"<p>\u663e\u5b58\u662f\u663e\u5361\u4e0a\u7684\u72ec\u7acb\u5b58\u50a8\u5668\uff0c\u548c\u4e3b\u677f\u4e0a\u7684\u5185\u5b58\u4e00\u6837\u662f\u4e00\u79cd\u968f\u673a\u5b58\u50a8\u5668\uff0c\u5b83\u7528\u6765\u5b58\u50a8\u5373\u5c06\u8981\u663e\u793a\u7684\u6570\u636e\u3002\u4f60\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff0c\u7a0b\u5e8f\u5458\u8d1f\u8d23\u5c06\u8981\u663e\u793a\u7684\u5b57\u7b26\u6216\u56fe\u50cf\u6570\u636e\u9001\u5165\u663e\u5b58\uff0c\u63a5\u4e0b\u6765\u7684\u5de5\u4f5c\u4ea4\u7ed9GPU\u548c\u76f8\u5173\u7684\u5916\u56f4\u7535\u8def\u5c31\u53ef\u4ee5\u4e86\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_8","title":"\u5b57\u7b26\u7684\u663e\u793a","text":"<p>\u4f8b\u5982\u8981\u663e\u793a\u82f1\u6587\u5b57\u7b26\uff0c\u7a0b\u5e8f\u5458\u53ef\u4ee5\u5c06\u5b57\u7b26\u7684\u7f16\u7801\u548c\u663e\u793a\u683c\u5f0f\u76f4\u63a5\u9001\u5165\u663e\u5b58\u2014\u2014\u8981\u5728\u5c4f\u5e55\u6700\u5de6\u4e0a\u65b9\u663e\u793a\u4e00\u4e2aZ, \u628a\u5b83\u7684ASCII\u7f16\u780190\u9001\u5165\u663e\u5b58\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u5373\u53ef\uff08\u63a5\u4e0b\u6765\u7684\u7b2c\u4e8c\u4e2a\u5b57\u8282\u7528\u4e8e\u63a7\u5236\u663e\u793a\u683c\u5f0f\uff09,\u4f8b\u5982\u4e0b\u9762\u7684C\u7a0b\u5e8f\u7684\u4f5c\u7528\u662f\u5728\u5c4f\u5e55\u5de6\u4e0a\u89d2\u663e\u793a\u5b57\u7b26Z:</p> <p><pre><code>char far *vBuffer=(char far*)0xB8000000;  *vBuffer=90;  vBuffer++;\n*vBuffer=7;\n</code></pre> \u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u9001\u8fdb\u53bb\u7684\u662f90\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u5728\u5c4f\u5e55\u4e0a\u663e\u793a\u4e00\u4e2aZ\u5462\uff1f\u56e0\u4e3a\u5728\u663e\u5361\u7684BIOS\u4e2d\u5b58\u50a8\u4e86\u6bcf\u4e00\u4e2aASCII\u5b57\u7b26\u7684\u56fe\u5f62\u6570\u636e\uff08\u50cf\u7d20\u4fe1\u606f\uff09\uff0cGPU\u4f1a\u6839\u636e\u7f16\u7801\u53d6\u51fa\u8fd9\u4e2a\u5b57\u7b26\u50cf\u7d20\u4fe1\u606f\uff0c\u5c06\u5176\u8f6c\u6362\u6210\u5c4f\u5e55\u4e0a\u663e\u793a\u7684\u7535\u4fe1\u53f7\uff1a</p> <p></p>"},{"location":"perf-opt/Android/bitmap/image/#_9","title":"\u56fe\u50cf\u7684\u663e\u793a","text":"<p>\u4e0e\u663e\u793a\u5b57\u7b26\u65f6\u76f4\u63a5\u5411\u663e\u5b58\u9001\u5b57\u7b26\u7f16\u7801\u4e0d\u540c\uff0c\u56fe\u50cf\u7684\u663e\u793a\u8981\u9ebb\u70e6\u4e00\u70b9\uff0c\u4f46\u672c\u8d28\u4ecd\u7136\u662f\u5411\u663e\u5b58\u9001\u6570\u636e\u3002 \u9001\u7684\u6570\u636e\u662f\u6bcf\u4e00\u4e2a\u50cf\u7d20\u7684\u989c\u8272\u503c\uff0c\u4f8b\u5982\u4e0b\u9762\u7684\u7167\u7247\uff0c\u6bcf\u4e00\u4e2a\u50cf\u7d20\u90fd\u53ef\u4ee5\u7406\u89e3\u6210\u4e3a\u4e09\u79cd\u4e0d\u540c\u989c\u8272\u7684\u7ec4\u5408\uff0c\u4f60\u53ea\u9700\u8981\u5c06\u6bcf\u4e00\u4e2a\u50cf\u7d20\u7684RGB\u503c\u9001\u5165\u663e\u5b58\uff0cGPU\u4f1a\u8d1f\u8d23\u5c06\u5176\u8f6c\u6362\u6210\u7535\u4fe1\u53f7\u5e76\u8f93\u51fa\u7ed9\u663e\u793a\u5668\uff1a</p> <p></p> <p>\u53e6\u5916\uff0c\u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5bf9GPU\u53d1\u9001\u6307\u4ee4\uff0c\u7528\u4ee5\u8fdb\u884c\u4e00\u4e9b\u590d\u6742\u76843D\u663e\u793a\u6216\u8005\u5176\u5b83\u8ba1\u7b97\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_10","title":"\u56fe\u50cf\u57fa\u7840\u77e5\u8bc6","text":""},{"location":"perf-opt/Android/bitmap/image/#_11","title":"\u56fe\u50cf\u538b\u7f29\u6280\u672f","text":""},{"location":"perf-opt/Android/bitmap/image/#lossless-compression","title":"\u65e0\u635f\u538b\u7f29\uff08Lossless Compression\uff09\uff1a","text":"<p>\u6307\u6570\u636e\u7ecf\u8fc7\u538b\u7f29\u540e\uff0c\u4fe1\u606f\u4e0d\u53d7\u635f\u5931\uff0c\u8fd8\u80fd\u5b8c\u5168\u6062\u590d\u5230\u538b\u7f29\u524d\u7684\u539f\u6837</p> <p>\u5982\u884c\u7a0b\u7f16\u7801\uff08RLE\uff09\uff08.BMP .TIFF\u53caAVI\u7b49\u683c\u5f0f\u6587\u4ef6\u538b\u7f29\u91c7\u7528\u6b64\u7b97\u6cd5\uff09 \u73b0\u5b9e\u4e2d\u6709\u8bb8\u591a\u8fd9\u6837\u7684\u56fe\u50cf\uff0c\u5728\u4e00\u5e45\u56fe\u50cf\u4e2d\u5177\u6709\u8bb8\u591a\u989c\u8272\u76f8\u540c\u7684\u56fe\u5757\u3002\u5728\u8fd9\u4e9b\u56fe\u5757\u4e2d\uff0c\u8bb8\u591a\u884c\u4e0a\u90fd\u5177\u6709\u76f8\u540c\u7684\u989c\u8272\uff0c\u6216\u8005\u5728\u4e00\u884c\u4e0a\u6709\u8bb8\u591a\u8fde\u7eed\u7684\u50cf\u7d20\u90fd\u5177\u6709\u76f8\u540c\u7684\u989c\u8272\u503c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u4e0d\u9700\u8981\u5b58\u50a8\u6bcf\u4e00\u4e2a\u50cf\u7d20\u7684\u989c\u8272\u503c\uff0c\u800c\u4ec5\u4ec5\u5b58\u50a8\u4e00\u4e2a\u50cf\u7d20\u7684\u989c\u8272\u503c\uff0c\u4ee5\u53ca\u5177\u6709\u76f8\u540c\u989c\u8272\u7684\u50cf\u7d20\u6570\u76ee\u5c31\u53ef\u4ee5\uff0c\u6216\u8005\u5b58\u50a8\u50cf\u7d20\u7684\u989c\u8272\u503c\uff0c\u4ee5\u53ca\u5177\u6709\u76f8\u540c\u989c\u8272\u503c\u7684\u884c\u6570\u3002 \u8fd9\u79cd\u538b\u7f29\u7f16\u7801\u79f0\u4e3a\u884c\u7a0b\u7f16\u7801(run length encoding\uff0cRLE)\uff0c\u5177\u6709\u76f8\u540c\u989c\u8272\u5e76\u4e14\u662f\u8fde\u7eed\u7684\u50cf\u7d20\u6570\u76ee\u79f0\u4e3a\u884c\u7a0b\u957f\u5ea6\u3002 \u4e3e\u4f8b</p> <p>\u538b\u7f29\u524d 000000003333333333 222222222226666666 \u538b\u7f29\u540e (0,8) (3,10) (2,11) (6,7)</p>"},{"location":"perf-opt/Android/bitmap/image/#lossy-compression","title":"\u6709\u635f\u538b\u7f29\uff08lossy compression\uff09","text":"<p>\u6709\u635f\u538b\u7f29\u7b97\u6cd5\u662f\u4e00\u79cd\u6570\u636e\u538b\u7f29\u65b9\u6cd5\uff0c\u7ecf\u8fc7\u6b64\u65b9\u6cd5\u538b\u7f29\u3001\u89e3\u538b\u7684\u6570\u636e\u4f1a\u4e0e\u539f\u59cb\u6570\u636e\u4e0d\u540c\u4f46\u662f\u975e\u5e38\u63a5\u8fd1\u3002\u5b83\u662f\u4e0e\u65e0\u635f\u6570\u636e\u538b\u7f29\u76f8\u5bf9\u7684\u538b\u7f29\u65b9\u6cd5\u3002\u6709\u635f\u6570\u636e\u538b\u7f29\u53c8\u79f0\u7834\u574f\u6027\u8d44\u6599\u538b\u7f29\u3001\u6709\u635f\u538b\u7f29\u3001\u6709\u635f\u538b\u7f29\u3001\u4e0d\u53ef\u9006\u538b\u7f29</p> <p>\u5176\u539f\u7406\u662f\u501f\u7531\u5c06\u6b21\u8981\u7684\u4fe1\u606f\u6570\u636e\u820d\u5f03\uff0c\u727a\u7272\u4e00\u4e9b\u8d28\u91cf\u6765\u51cf\u5c11\u6570\u636e\u91cf\u3001\u63d0\u9ad8\u538b\u7f29\u6bd4\u3002</p> <p>\u5982\u56fe\u50cf\u76f8\u90bb\u7684\u8272\u5757\uff0c\u989c\u8272\u5176\u5b9e\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u6bd4\u5982(0,200,0)\u548c(0,201,0) \u4eba\u5176\u5b9e\u611f\u89c9\u4e0d\u51fa\u6765\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u5b83\u4eec\u7edf\u4e00\u7528(0,200,0)\u8868\u793a\uff0c\u5728\u4e0a\u9762\u8fd9\u79cdRLE\u7b97\u6cd5\u57fa\u7840\u4e0a\uff0c\u53c8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u538b\u7f29</p>"},{"location":"perf-opt/Android/bitmap/image/#_12","title":"\u7d22\u5f15\u8272 &amp; \u76f4\u63a5\u8272","text":"<p>\u7d22\u5f15\u8272\uff1a</p> <p>\u7d22\u5f15\u989c\u8272\u662f\u4e00\u79cd\u4ee5\u6709\u9650\u7684\u65b9\u5f0f\u7ba1\u7406\u6570\u5b57\u56fe\u50cf\u989c\u8272\u7684\u6280\u672f\uff0c\u4ee5\u8282\u7701\u8ba1\u7b97\u673a\u5185\u5b58\u548c\u6587\u4ef6\u5b58\u50a8\uff0c\u540c\u65f6\u52a0\u901f\u663e\u793a\u5237\u65b0\u548c\u6587\u4ef6\u4f20\u8f93\u3002\u5373<code>\u7528\u4e00\u4e2a\u6570\u5b57\u6765\u4ee3\u8868\uff08\u7d22\u5f15\uff09\u4e00\u79cd\u989c\u8272\uff0c\u5728\u5b58\u50a8\u56fe\u7247\u7684\u65f6\u5019\uff0c\u5b58\u50a8\u4e00\u4e2a\u6570\u5b57\u7684\u7ec4\u5408\uff0c\u540c\u65f6\u5b58\u50a8\u6570\u5b57\u5230\u56fe\u7247\u989c\u8272\u7684\u6620\u5c04</code>\u3002\u8fd9\u79cd\u65b9\u5f0f\u53ea\u80fd<code>\u5b58\u50a8\u6709\u9650\u79cd\u989c\u8272</code>\uff0c\u901a\u5e38\u662f256\u79cd\u989c\u8272\uff0c\u5bf9\u5e94\u5230\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c\u4f7f\u7528\u4e00\u4e2a\u5b57\u8282\u7684\u6570\u5b57\u6765\u7d22\u5f15\u4e00\u79cd\u989c\u8272\u3002</p> <p>\u7d22\u5f15\u8272\u5e38\u89c1\u67091\u4f4d\uff08\u5373\u9ed1\u767d\uff09\uff0c8\u4f4d\uff08\u5373\u7070\u9636/256\u8272\uff09\uff0c16\u4f4d\uff08\u5373\u9ad8\u5f69\uff09\uff0c24\u4f4d\uff08\u5373\u771f\u5f69\uff09\uff0c30/36/48\u4f4d\uff08\u5373\u5168\u5f69\uff09\uff0c\u66f4\u591a\u8be6\u7ec6\u53c2\u8003\u8be5\u767e\u79d1\u3002</p> <p>\u76f4\u63a5\u8272\uff1a</p> <p><code>\u4f7f\u7528\u56db\u4e2a\u6570\u5b57\u6765\u4ee3\u8868\u4e00\u79cd\u989c\u8272\uff0c\u8fd9\u56db\u4e2a\u6570\u5b57\u5206\u522b\u4ee3\u8868\u8fd9\u4e2a\u989c\u8272\u4e2d\u7ea2\u8272\u3001\u7eff\u8272\u3001\u84dd\u8272\u4ee5\u53ca\u900f\u660e\u5ea6\uff08\u5373rgba\uff09</code>\u3002\u73b0\u5728\u6d41\u884c\u7684\u663e\u793a\u8bbe\u5907\u53ef\u4ee5\u5728\u8fd9\u56db\u4e2a\u7ef4\u5ea6\u5206\u522b\u652f\u6301256\u79cd\u53d8\u5316\uff0c\u6240\u4ee5\u76f4\u63a5\u8272\u53ef\u4ee5\u8868\u793a2\u768432\u6b21\u65b9\u79cd\u989c\u8272\u3002\u5f53\u7136\u5e76\u975e\u6240\u6709\u7684\u76f4\u63a5\u8272\u90fd\u652f\u6301\u8fd9\u4e48\u591a\u79cd\uff0c\u4e3a\u538b\u7f29\u7a7a\u95f4\u4f7f\u7528\uff0c\u6709\u53ef\u80fd\u53ea\u6709\u8868\u8fbe\u7ea2\u3001\u7eff\u3001\u84dd\u7684\u4e09\u4e2a\u6570\u5b57\uff0c\u6bcf\u4e2a\u6570\u5b57\u4e5f\u53ef\u80fd\u4e0d\u652f\u6301256\u79cd\u53d8\u5316\u4e4b\u591a\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_13","title":"\u4f4d\u56fe &amp; \u77e2\u91cf\u56fe\uff1a","text":"<p>\u4f4d\u56fe\uff1a</p> <p>\u4f4d\u56fe(bitmap)\uff0c\u4e5f\u53eb\u505a\u70b9\u9635\u56fe\uff0c\u6805\u683c\u56fe\u50cf\uff0c\u50cf\u7d20\u56fe\uff0c\u7b80\u5355\u7684\u8bf4\uff0c<code>\u5c31\u662f\u6700\u5c0f\u5355\u4f4d\u7531\u50cf\u7d20\u6784\u6210\u7684\u56fe\uff0c\u7f29\u653e\u4f1a\u5931\u771f</code>\u3002\u6784\u6210\u4f4d\u56fe\u7684\u6700\u5c0f\u5355\u4f4d\u662f\u50cf\u7d20\uff0c\u4f4d\u56fe\u5c31\u662f\u7531\u50cf\u7d20\u9635\u5217\u7684\u6392\u5217\u6765\u5b9e\u73b0\u5176\u663e\u793a\u6548\u679c\u7684\uff0c\u6bcf\u4e2a\u50cf\u7d20\u6709\u81ea\u5df1\u7684\u989c\u8272\u4fe1\u606f\uff0c\u5728\u5bf9\u4f4d\u56fe\u56fe\u50cf\u8fdb\u884c\u7f16\u8f91\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ef\u64cd\u4f5c\u7684\u5bf9\u8c61\u662f\u6bcf\u4e2a\u50cf\u7d20\uff0c\u6211\u4eec\u53ef\u4ee5\u6539\u53d8\u56fe\u50cf\u7684\u8272\u76f8\u3001\u9971\u548c\u5ea6\u3001\u660e\u5ea6\uff0c\u4ece\u800c\u6539\u53d8\u56fe\u50cf\u7684\u663e\u793a\u6548\u679c\u3002\u4e3e\u4e2a\u4f8b\u5b50\u6765\u8bf4\uff0c\u4f4d\u56fe\u56fe\u50cf\u5c31\u597d\u6bd4\u5728\u5de8\u5927\u7684\u6c99\u76d8\u4e0a\u753b\u597d\u7684\u753b\uff0c\u5f53\u4f60\u4ece\u8fdc\u5904\u770b\u7684\u65f6\u5019\uff0c\u753b\u9762\u7ec6\u817b\u591a\u5f69\uff0c\u4f46\u662f\u5f53\u4f60\u9760\u7684\u975e\u5e38\u8fd1\u7684\u65f6\u5019\uff0c\u4f60\u5c31\u80fd\u770b\u5230\u7ec4\u6210\u753b\u9762\u7684\u6bcf\u7c92\u6c99\u5b50\u4ee5\u53ca\u6bcf\u4e2a\u6c99\u7c92\u5355\u7eaf\u7684\u4e0d\u53ef\u53d8\u5316\u989c\u8272\u3002</p> <p>\u77e2\u91cf\u56fe\uff1a</p> <p>\u77e2\u91cf\u56fe(vector)\uff0c\u4e5f\u53eb\u505a\u5411\u91cf\u56fe\uff0c\u7b80\u5355\u7684\u8bf4\uff0c\u5c31\u662f<code>\u7f29\u653e\u4e0d\u5931\u771f\u7684\u56fe\u50cf\u683c\u5f0f</code>\u3002\u77e2\u91cf\u56fe\u662f\u901a\u8fc7\u591a\u4e2a\u5bf9\u8c61\u7684\u7ec4\u5408\u751f\u6210\u7684\uff0c\u5bf9\u5176\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5bf9\u8c61\u7684\u7eaa\u5f55\u65b9\u5f0f\uff0c\u90fd\u662f\u4ee5\u6570\u5b66\u51fd\u6570\u6765\u5b9e\u73b0\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u77e2\u91cf\u56fe\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u8c61\u4f4d\u56fe\u90a3\u6837\u8bb0\u5f55\u753b\u9762\u4e0a\u6bcf\u4e00\u70b9\u7684\u4fe1\u606f\uff0c\u800c\u662f\u7eaa\u5f55\u4e86\u5143\u7d20\u5f62\u72b6\u53ca\u989c\u8272\u7684\u7b97\u6cd5\uff0c\u5f53\u4f60\u6253\u5f00\u4e00\u5e45\u77e2\u91cf\u56fe\u7684\u65f6\u5019\uff0c\u8f6f\u4ef6\u5bf9\u56fe\u5f62\u76f8\u5bf9\u5e94\u7684\u51fd\u6570\u8fdb\u884c\u8fd0\u7b97\uff0c\u5c06\u8fd0\u7b97\u7ed3\u679c(\u56fe\u5f62\u7684\u5f62\u72b6\u548c\u989c\u8272)\u663e\u793a\u7ed9\u4f60\u770b\u3002\u65e0\u8bba\u663e\u793a\u753b\u9762\u662f\u5927\u8fd8\u662f\u5c0f\uff0c\u753b\u9762\u4e0a\u7684\u5bf9\u8c61\u5bf9\u5e94\u7684\u7b97\u6cd5\u662f\u4e0d\u53d8\u7684\uff0c\u6240\u4ee5\uff0c\u5373\u4f7f\u5bf9\u753b\u9762\u8fdb\u884c\u500d\u6570\u76f8\u5f53\u5927\u7684\u7f29\u653e\uff0c\u5176\u663e\u793a\u6548\u679c\u4ecd\u7136\u76f8\u540c(\u4e0d\u5931\u771f)\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0c\u77e2\u91cf\u56fe\u5c31\u597d\u6bd4\u753b\u5728\u8d28\u91cf\u975e\u5e38\u597d\u7684\u6a61\u80f6\u819c\u4e0a\u7684\u56fe\uff0c\u4e0d\u7ba1\u5bf9\u6a61\u80f6\u819c\u600e\u6837\u7684\u5e38\u5bbd\u7b49\u6bd4\u6210\u500d\u62c9\u4f38\uff0c\u753b\u9762\u4f9d\u7136\u6e05\u6670\uff0c\u4e0d\u7ba1\u4f60\u79bb\u5f97\u591a\u4e48\u8fd1\u53bb\u770b\uff0c\u4e5f\u4e0d\u4f1a\u770b\u5230\u56fe\u5f62\u7684\u6700\u5c0f\u5355\u4f4d\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_14","title":"\u56fe\u7247\u7c7b\u578b","text":""},{"location":"perf-opt/Android/bitmap/image/#1bmp","title":"1.BMP","text":"<p>BMP\u53d6\u81ea\u4f4d\u56feBitMaP\u7684\u7f29\u5199\uff0c\u4e5f\u79f0\u4e3aDIB\uff08\u4e0e\u8bbe\u5907\u65e0\u5173\u7684\u4f4d\u56fe\uff09\uff0c\u662f\u4e00\u79cd\u4e0e\u663e\u793a\u5668\u65e0\u5173\u7684\u4f4d\u56fe\u6570\u5b57\u56fe\u50cf\u6587\u4ef6\u683c\u5f0f\u3002BMP\u540c\u65f6\u652f\u6301\u7d22\u5f15\u8272\u548c\u76f4\u63a5\u8272\uff0c\u4f46\u662f\u5176\u51e0\u4e4e\u6ca1\u6709\u538b\u7f29\uff0c\u6240\u4ee5\u901a\u5e38\u56fe\u7247\u975e\u5e38\u7684\u5927\uff0c\u4e5f\u5bfc\u81f4\u4e86\u5176\u51e0\u4e4e\u6ca1\u6709\u7528\u6b66\u4e4b\u5730\uff0c\u73b0\u5728\u9664\u4e86\u5728Windows\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u8fd8\u6bd4\u8f83\u5e38\u89c1\u4e4b\u5916\uff0c\u6211\u4eec\u51e0\u4e4e\u770b\u4e0d\u5230\u5b83\u3002\u518d\u52a0\u4e0a\u6d4f\u89c8\u5668\u7684\u4e0d\u652f\u6301\uff0c\u6240\u4ee5\u4f5c\u4e3aweb\u5f00\u53d1\uff0c\u66f4\u52a0\u5c11\u4e8e\u770b\u5230BMP\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#2jpgjpegjoint-photographic-experts-group","title":"2.JPG/JPEG\uff08Joint Photographic Experts Group\uff0c\u8054\u5408\u56fe\u5f62\u4e13\u5bb6\u7ec4\u56fe\u7247\uff09","text":"<p>JPEG\u662f<code>\u6709\u635f\u7684\u3001\u91c7\u7528\u76f4\u63a5\u8272\u7684\u3001\u70b9\u9635\u56fe</code>\u3002JPEG\u4e5f\u662f\u4e00\u79cd\u9488\u5bf9\u7167\u7247\u5f71\u50cf\u800c\u5e7f\u6cdb\u4f7f\u7528\u7684\u6709\u635f\u538b\u7f29\u6807\u51c6\u65b9\u6cd5\u3002JPEG\u56fe\u7247\u683c\u5f0f\u7684\u8bbe\u8ba1\u76ee\u6807\uff0c\u662f\u5728\u4e0d\u5f71\u54cd\u4eba\u7c7b\u53ef\u5206\u8fa8\u7684\u56fe\u7247\u8d28\u91cf\u7684\u524d\u63d0\u4e0b\uff0c\u5c3d\u53ef\u80fd\u7684\u538b\u7f29\u6587\u4ef6\u5927\u5c0f\u3002\u8fd9\u610f\u5473\u7740JPEG\u53bb\u6389\u4e86\u4e00\u90e8\u5206\u56fe\u7247\u7684\u539f\u59cb\u4fe1\u606f\uff0c\u4e5f\u5373\u662f\u8fdb\u884c\u4e86\u6709\u635f\u538b\u7f29\u3002JPEG\u7684\u56fe\u7247\u7684\u4f18\u70b9\uff0c\u662f\u91c7\u7528\u4e86\u76f4\u63a5\u8272\uff0c\u5f97\u76ca\u4e8e\u66f4\u4e30\u5bcc\u7684\u8272\u5f69\uff0cJPEG\u975e\u5e38\u9002\u5408\u7528\u6765\u5b58\u50a8\u7167\u7247\uff0c\u7528\u6765\u8868\u8fbe\u66f4\u751f\u52a8\u7684\u56fe\u50cf\u6548\u679c\uff0c\u6bd4\u5982\u989c\u8272\u6e10\u53d8\u3002</p> <p>JPEG\u7684\u7b97\u6cd5\u6bd4\u8f83\u590d\u6742\uff0c \u5982\u679c\u6709\u5174\u8da3\u53ef\u4ee5\u53c2\u8003\u8be5\u6587\u7ae0</p> <p>\u5176\u5927\u6982\u5206\u4e3a\u4e09\u6b65\uff1a</p> <ol> <li>\u628a\u6570\u636e\u5206\u4e3a\u201c\u91cd\u8981\u90e8\u5206\u201d\u548c\u201c\u4e0d\u91cd\u8981\u90e8\u5206\u201d</li> <li>\u6ee4\u6389\u4e0d\u91cd\u8981\u7684\u90e8\u5206</li> <li>\u4fdd\u5b58</li> </ol>"},{"location":"perf-opt/Android/bitmap/image/#3pngportable-network-graphics","title":"3.PNG\uff08Portable Network Graphics\uff0c\u4fbf\u643a\u5f0f\u7f51\u7edc\u56fe\u50cf\u683c\u5f0f\uff09","text":"<p>\u4fbf\u643a\u5f0f\u7f51\u7edc\u56fe\u5f62\uff08\u82f1\u8bed\uff1aPortable Network Graphics\uff0c\u7f29\u5199\uff1aPNG\uff09\u662f\u4e00\u79cd\u65e0\u635f\u538b\u7f29\u7684\u4f4d\u56fe\u56fe\u5f62\u683c\u5f0f\uff0c\u652f\u6301\u7d22\u5f15\u3001\u7070\u5ea6\u3001RGB\u4e09\u79cd\u989c\u8272\u65b9\u6848\u4ee5\u53caAlpha\u901a\u9053\u7b49\u7279\u6027\u3002PNG\u7684\u5f00\u53d1\u76ee\u6807\u662f\u6539\u5584\u5e76\u53d6\u4ee3GIF\u4f5c\u4e3a\u9002\u5408\u7f51\u7edc\u4f20\u8f93\u7684\u683c\u5f0f\u800c\u4e0d\u9700\u4e13\u5229\u8bb8\u53ef\uff0c\u6240\u4ee5\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e\u4e92\u8054\u7f51\u53ca\u5176\u4ed6\u65b9\u9762\u4e0a\u3002</p> <p>PNG-8</p> <p><code>PNG-8\u662f\u65e0\u635f\u7684\u3001\u4f7f\u7528\u7d22\u5f15\u8272\u7684\u70b9\u9635\u56fe</code>\u3002PNG\u662f\u4e00\u79cd\u6bd4\u8f83\u65b0\u7684\u56fe\u7247\u683c\u5f0f\uff0cPNG-8\u662f\u975e\u5e38\u597d\u7684GIF\u683c\u5f0f\u66ff\u4ee3\u8005\uff0c\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u4f7f\u7528PNG-8\u800c\u4e0d\u662fGIF\uff0c\u56e0\u4e3a\u5728\u76f8\u540c\u7684\u56fe\u7247\u6548\u679c\u4e0b\uff0cPNG-8\u5177\u6709\u66f4\u5c0f\u7684\u6587\u4ef6\u4f53\u79ef\u3002\u9664\u6b64\u4e4b\u5916\uff0cPNG-8\u8fd8\u652f\u6301\u900f\u660e\u5ea6\u7684\u8c03\u8282\uff0c\u800cGIF\u5e76\u4e0d\u652f\u6301\u3002 \u73b0\u5728\uff0c\u9664\u975e\u9700\u8981\u52a8\u753b\u7684\u652f\u6301\uff0c\u5426\u5219\u6211\u4eec\u6ca1\u6709\u7406\u7531\u4f7f\u7528GIF\u800c\u4e0d\u662fPNG-8\u3002\u5f53\u7136\u4e86\uff0cPNG-8\u672c\u8eab\u4e5f\u662f\u652f\u6301\u52a8\u753b\u7684\uff0c\u53ea\u662f\u6d4f\u89c8\u5668\u652f\u6301\u5f97\u4e0d\u597d\uff0c\u4e0d\u50cfGIF\u90a3\u6837\u53d7\u5230\u5e7f\u6cdb\u7684\u652f\u6301\u3002</p> <p>PNG-24</p> <p><code>PNG-24\u662fPNG\u7684\u76f4\u63a5\u8272\u7248\u672c\u3002PNG-24\u662f\u65e0\u635f\u7684\u3001\u4f7f\u7528\u76f4\u63a5\u8272\u7684\u70b9\u9635\u56fe</code>\u3002\u65e0\u635f\u7684\u3001\u4f7f\u7528\u76f4\u63a5\u8272\u7684\u70b9\u9635\u56fe\uff0c\u542c\u8d77\u6765\u975e\u5e38\u50cfBMP\uff0c\u662f\u7684\uff0c\u4ece\u663e\u793a\u6548\u679c\u4e0a\u6765\u770b\uff0cPNG-24\u8ddfBMP\u6ca1\u6709\u4e0d\u540c\u3002PNG-24\u7684\u4f18\u70b9\u5728\u4e8e\uff0c\u5b83\u538b\u7f29\u4e86\u56fe\u7247\u7684\u6570\u636e\uff0c\u4f7f\u5f97\u540c\u6837\u6548\u679c\u7684\u56fe\u7247\uff0cPNG-24\u683c\u5f0f\u7684\u6587\u4ef6\u5927\u5c0f\u8981\u6bd4BMP\u5c0f\u5f97\u591a\u3002\u5f53\u7136\uff0cPNG24\u7684\u56fe\u7247\u8fd8\u662f\u8981\u6bd4JPEG\u3001GIF\u3001PNG-8\u5927\u5f97\u591a\u3002\u867d\u7136PNG-24\u7684\u4e00\u4e2a\u5f88\u5927\u7684\u76ee\u6807\uff0c\u662f\u66ff\u6362JPEG\u7684\u4f7f\u7528\u3002\u4f46\u4e00\u822c\u800c\u8a00\uff0cPNG-24\u7684\u6587\u4ef6\u5927\u5c0f\u662fJPEG\u7684\u4e94\u500d\u4e4b\u591a\uff0c\u800c\u663e\u793a\u6548\u679c\u5219\u901a\u5e38\u53ea\u80fd\u83b7\u5f97\u4e00\u70b9\u70b9\u63d0\u5347\u3002\u6240\u4ee5\uff0c\u53ea\u6709\u5728\u4f60\u4e0d\u5728\u4e4e\u56fe\u7247\u7684\u6587\u4ef6\u4f53\u79ef\uff0c\u800c\u60f3\u8981\u6700\u597d\u7684\u663e\u793a\u6548\u679c\u65f6\uff0c\u624d\u5e94\u8be5\u4f7f\u7528PNG-24\u683c\u5f0f\u3002\u53e6\u5916\uff0cPNG-24\u8ddfPNG-8\u4e00\u6837\uff0c\u662f\u652f\u6301\u56fe\u7247\u900f\u660e\u5ea6\u7684\u3002</p> <p>PNG-32</p> <p>PNG32\u4e5f\u662fPNG\u7684\u76f4\u63a5\u8272\u7248\u672c\u3002\u5176\u8868\u73b0\u4e0ePNG-24\u5dee\u4e0d\u591a\u3002</p> <p>\u4e09\u8005\u7684\u533a\u522b\u5728\u4e8e\uff1a</p> <ul> <li>PNG-32\u6bcf\u4e2a\u50cf\u7d20\u7684\u6df1\u5ea6\u4e3a32bits\uff0c\u5176\u4e2dRGBA\u56db\u4e2a\u901a\u9053\u5404\u53608bits\u3002\u6240\u8c13\u7684RGBA\u56db\u4e2a\u901a\u9053\uff0c\u5c31\u662f\u7ea2\uff0c\u7eff\uff0c\u84dd\uff0c\u900f\u660e \u8fd9\u56db\u79cd\u8272\u503c\u5404\u81ea\u7684\u5927\u5c0f\uff0c\u90fd\u75288bits\u6765\u8868\u793a\uff080\uff5e255\uff09\u3002</li> <li>PNG-24\u7684\u50cf\u7d20\u6df1\u5ea6\u4e3a24bits\uff0c\u5176\u4e2dRGB\u4e09\u4e2a\u901a\u9053\u5404\u53608bits\u3002</li> <li>PNG-8\u5219\u662f\u4f7f\u75288\u4f4d\u7684\u7d22\u5f15\u8272\u3002</li> </ul>"},{"location":"perf-opt/Android/bitmap/image/#4gif","title":"4.GIF","text":"<p>\u5168\u79f0Graphics Interchange Format\uff0c\u91c7\u7528<code>LZW\u538b\u7f29\u7b97\u6cd5\u8fdb\u884c\u7f16\u7801\u3002\u662f\u65e0\u635f\u7684\u3001\u91c7\u7528\u7d22\u5f15\u8272\u7684\u70b9\u9635\u56fe</code>\u3002GIF\u662f\u65e0\u635f\u7684\uff0c\u91c7\u7528GIF\u683c\u5f0f\u4fdd\u5b58\u56fe\u7247\u4e0d\u4f1a\u964d\u4f4e\u56fe\u7247\u8d28\u91cf\u3002\u4f46\u5f97\u76ca\u4e8e\u6570\u636e\u7684\u538b\u7f29\uff0cGIF\u683c\u5f0f\u7684\u56fe\u7247\uff0c\u5176\u6587\u4ef6\u5927\u5c0f\u8981\u8fdc\u5c0f\u4e8eBMP\u683c\u5f0f\u7684\u56fe\u7247\u3002\u6587\u4ef6\u5c0f\uff0c\u662fGIF\u683c\u5f0f\u7684\u4f18\u70b9\uff0c\u540c\u65f6\uff0cGIF\u683c\u5f0f\u8fd8\u5177\u6709\u652f\u6301\u52a8\u753b\u4ee5\u53ca\u900f\u660e\u7684\u4f18\u70b9\u3002\u4f46\uff0cGIF\u683c\u5f0f\u4ec5\u652f\u63018bit\u7684\u7d22\u5f15\u8272\uff0c\u5373\u5728\u6574\u4e2a\u56fe\u7247\u4e2d\uff0c\u53ea\u80fd\u5b58\u5728256\u79cd\u4e0d\u540c\u7684\u989c\u8272\u3002</p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e0bGIF\u4f7f\u7528\u7684LZW\u538b\u7f29\u7b97\u6cd5\uff0c\u8be6\u7ec6\u53ef\u53c2\u8003\u8be5\u6587\u7ae0\uff1a</p> <p>LZW\u7f16\u7801 (Encoding) \u7684\u6838\u5fc3\u601d\u60f3\u5176\u5b9e\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u628a\u51fa\u73b0\u8fc7\u7684\u5b57\u7b26\u4e32\u6620\u5c04\u5230\u8bb0\u53f7\u4e0a\uff0c\u8fd9\u6837\u5c31\u53ef\u80fd\u7528\u8f83\u77ed\u7684\u7f16\u7801\u6765\u8868\u793a\u957f\u7684\u5b57\u7b26\u4e32\uff0c\u5b9e\u73b0\u538b\u7f29\u3002 \u6bd4\u5982\uff1a \u6211\u4eec\u53ef\u4ee5\u5c06ABCDEFG \u8f6c\u6210 1 \u6765\u4ee3\u8868\uff0c \u8fd9\u6837\u6570\u636e\u5c31\u4f1a\u51cf\u5c11\u5f88\u591a\u3002\u518d\u52a0\u4e0a\uff0cLZW\u7f16\u7801\u662f\u81ea\u89e3\u91ca (self-explaining) \u7684\uff0c\u5373\u6620\u5c04\u5b57\u5178\u4e0d\u4f1a\u5199\u5230\u538b\u7f29\u6570\u636e\u91cc\uff0c\u4ed6\u662f\u5728\u89e3\u7801\u7684\u8fc7\u7a0b\u4e2d\u8fd8\u539f\u51fa\u7f16\u7801\u65f6\u7528\u7684\u5b57\u5178\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#5webp","title":"5.WebP","text":"<p>\u7279\u70b9\uff1a\u652f\u6301\u65e0\u635f&amp;\u6709\u635f\u538b\u7f29\uff0c\u6587\u4ef6\u66f4\u5c0f\uff0c\u56fe\u50cf\u8d28\u91cf\u9ad8</p> <p>WebP\u662f\u7531google\u63a8\u51fa\uff0c\u76ee\u6807\u662f\u51cf\u5c11\u6587\u4ef6\u5927\u5c0f\uff0c\u4f46\u8fbe\u5230\u548cJPEG\u683c\u5f0f\u76f8\u540c\u7684\u56fe\u7247\u8d28\u91cf\uff0c\u5e0c\u671b\u80fd\u591f\u51cf\u5c11\u56fe\u7247\u6863\u5728\u7f51\u7edc\u4e0a\u7684\u53d1\u9001\u65f6\u95f4\u3002\u622a\u81f32021\u5e745\u6708\uff0c\u5df2\u670994%\u7684\u6d4f\u89c8\u5668\u652f\u6301\u6b64\u683c\u5f0f\u3002\u76f8\u8f83\u7f16\u7801JPEG\u6587\u4ef6\uff0c\u7f16\u7801\u540c\u6837\u8d28\u91cf\u7684WebP\u6587\u4ef6\u9700\u8981\u5360\u7528\u66f4\u591a\u7684\u8ba1\u7b97\u8d44\u6e90\u3002</p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e0bWebP\u4f7f\u7528\u7684\u538b\u7f29\u7b97\u6cd5\uff0c\u8be6\u7ec6\u53ef\u53c2\u8003\u8be5\u6587\u7ae0\uff1a \u6709\u635fWebP\u57fa\u4e8eVP8\u89c6\u9891\u7f16\u7801\u4e2d\u7684\u9884\u6d4b\u7f16\u7801\u65b9\u6cd5\u6765\u538b\u7f29\u56fe\u50cf\u6570\u636e\uff0c\u5176\u57fa\u672c\u6b65\u9aa4\u7c7b\u4f3c\u4e8eJPEG\u538b\u7f29\uff0c\u4e3b\u8981\u5305\u542b\u683c\u5f0f\u8f6c\u6362\u3001\u5206\u5272\u5b50\u5757\u3001\u9884\u6d4b\u7f16\u7801\u3001FDCT\u3001\u91cf\u5316\u3001Z\u6392\u5217\u3001\u71b5\u7f16\u7801 \u65e0\u635fWebP\u57fa\u4e8e\u4f7f\u7528\u4e0d\u540c\u7684\u6280\u672f\u5bf9\u56fe\u50cf\u6570\u636e\u8fdb\u884c\u8f6c\u6362\uff0c\u5305\u62ec\uff1a\u9884\u6d4b\u7a7a\u95f4\u53d8\u6362\u3001\u8272\u5f69\u7a7a\u95f4\u8f6c\u6362\u3001\u4f7f\u7528\u8c03\u8272\u677f\u3001\u591a\u50cf\u7d20\u6253\u5305\u6210\u4e00\u4e2a\u50cf\u7d20\u3001alpha\u503c\u66ff\u6362\u7b49\u6280\u672f</p>"},{"location":"perf-opt/Android/bitmap/image/#6svg-scalable-vector-graphics","title":"6.SVG (Scalable Vector Graphics\uff0c\u53ef\u7f29\u653e\u77e2\u91cf\u56fe\u5f62)","text":"<p>\u4e0e\u4e0a\u9762\u4e09\u79cd\u56fe\u50cf\u683c\u5f0f\u6700\u5927\u7684\u4e0d\u540c\u5728\u4e8e\uff0cSVG\u5e76\u4e0d\u662f\u4f4d\u56fe\u683c\u5f0f\uff0c\u800c\u662f\u4e00\u79cd\u77e2\u91cf\u56fe\u5f62\u683c\u5f0f\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u53ef\u4ee5\u5728\u4efb\u610f\u5206\u8fa8\u7387\u4e0a\u663e\u793a\uff0c\u800c\u4e0d\u7834\u574f\u56fe\u50cf\u7684\u6e05\u6670\u5ea6\u548c\u7ec6\u8282\u3002 \u8fd9\u662f\u56e0\u4e3a\u4f4d\u56fe\u56fe\u50cf\u50a8\u5b58\u56fe\u50cf\u4e0a\u6bcf\u4e00\u70b9\u7684\u50cf\u7d20\u503c\uff0c\u800c\u77e2\u91cf\u56fe\u50cf\u7528\u70b9\u548c\u7ebf\u6765\u63cf\u8ff0\u7269\u4f53\uff0c\u80fd\u591f\u63d0\u4f9b\u6e05\u6670\u7684\u753b\u9762\u3002\u5b83\u662f\u4f7f\u7528XML\u6765\u63cf\u8ff0\u56fe\u7247\u7684\uff0c\u4e00\u822c\u6765\u8bf4\uff0cSVG\u6587\u4ef6\u8981\u6bd4JPEG\u548cGIF\u7684\u6587\u4ef6\u8981\u5c0f\uff0c\u5728\u4e0b\u8f7d\u6216\u79fb\u52a8\u8bbe\u5907\u4e0a\u663e\u793a\u65f6\u901f\u5ea6\u4e5f\u66f4\u5feb\u3002</p>"},{"location":"perf-opt/Android/bitmap/image/#_15","title":"\u56fe\u7247\u6bd4\u8f83\u4e0e\u573a\u666f\u5e94\u7528","text":"\u7c7b\u578b \u4f18\u70b9 \u7f3a\u70b9 \u5e94\u7528\u573a\u666f BMP \u65e0\u635f\u538b\u7f29\uff0c\u56fe\u8d28\u6700\u597d\uff0c\u652f\u6301\u7d22\u5f15\u8272\u548c\u76f4\u63a5\u8272 \u6587\u4ef6\u8fc7\u5927 \u76ee\u524d\u4ec5\u5b58\u4e8eWINDOWS\u7cfb\u7edf GIF \u65e0\u635f\u538b\u7f29\uff0c\u652f\u6301\u52a8\u753b\u53ca\u900f\u660e \u4ec5\u652f\u6301256\u79cd\u989c\u8272\uff0c\u753b\u8d28\u5dee \u9700\u8981\u52a8\u753b\u7684\u9700\u6c42 JPEG \u6587\u4ef6\u5c0f \u6709\u635f\u538b\u7f29\uff0c\u753b\u8d28\u635f\u5931 \u4e0d\u8003\u8651\u8fc7\u597d\u753b\u8d28\u4e14\u9700\u54cd\u5e94\u901f\u5ea6\u8f83\u5feb\uff0c \u5982\u5927\u80cc\u666f\u56fe PNG-8 \u65e0\u635f\u538b\u7f29\uff0c \u652f\u6301\u900f\u660e \u753b\u8d28\u4e2d\u7b49 \u5e94\u7528\u4e8e\u5927\u591a\u6570\u4e2d\u5c0f\u56fe\u4e14\u8981\u6c42\u753b\u8d28\u6bd4\u8f83\u597d\u7684\u9700\u6c42 WebP \u65e0\u635f&amp;\u6709\u635f\u538b\u7f29\uff0c \u652f\u6301\u900f\u660e \u89e3\u7801\u65f6\u95f4\u66f4\u957f \u5e94\u7528\u4e8e\u5bf9\u56fe\u7247\u4f53\u79ef\u6709\u66f4\u9ad8\u8981\u6c42\u7684\u9700\u6c42 SVG \u652f\u6301\u653e\u5927\u7f29\u5c0f\u800c\u4e0d\u5f71\u54cd\u753b\u8d28 \u7f16\u5199\u9ebb\u70e6\uff0c\u6027\u80fd\u5dee \u591a\u5e94\u7528\u4e8eICON\u4e4b\u7c7b"},{"location":"perf-opt/Android/bitmap/image/#_16","title":"\u77e2\u91cf\u56fe\u4f1a\u53d6\u4ee3\u4f4d\u56fe\u5417\uff1f","text":"<p>\u77e2\u91cf\u56fe\u4e0d\u80fd\u4ee3\u66ff\u4f4d\u56fe\u3002 \u77e2\u91cf\u56fe\u662f\u7531\u70b9\u7ebf\u9762\u6784\u6210\u7684\uff0c\u5b83\u4e0d\u662f\u76f8\u673a\u62cd\u51fa\u6765\u7684\uff0c\u800c\u662f\u4eba\u4e3a\u8f6f\u4ef6\u7ed8\u5236\u51fa\u6765\u7684\u3002 \u6240\u4ee5 \u77e2\u91cf\u56fe\u662f\u3010\u753b\u3011\uff0c\u800c\u4f4d\u56fe\u662f\u3010\u50cf\u3011\u3002\u5982\u679c\u5236\u4f5c\u4e00\u5e45\u7ec6\u8282\u8fd8\u539f\u5230\u9010\u4e2a\u50cf\u7d20\u6c34\u51c6\u7684\u77e2\u91cf\u56fe\uff0c\u90a3\u4e48\u5b83\u4e0d\u662f\u5df2\u7ecf\u53d8\u6210\u4e86\u4f4d\u56fe\uff08\u7528\u9635\u5217\u6a21\u62df\u4f4d\u56fe\u753b\uff09\uff0c\u5c31\u662f\u6709\u7740\u60ca\u4eba\u6570\u91cf\u7684\u77e2\u91cf\u5143\u7d20\u548c\u6050\u6016\u7684 \u6587\u4ef6\u4f53\u79ef\uff08\u7528\u7ebf\u9762\u8272\u52fe\u753b\uff09</p>"},{"location":"perf-opt/Android/bitmap/image/#_17","title":"\u53c2\u8003","text":"<p>\u5e38\u89c1\u56fe\u7247\u683c\u5f0f\u4e86\u89e3</p> <p>\u56fe\u7247\u6587\u4ef6\u524d\u4e16\u4eca\u751f\u548c\u884d\u751f\u6280\u672f\u539f\u7406</p>"},{"location":"perf-opt/Android/bitmap/imge-format/","title":"\u4e86\u89e3\u5404\u79cd\u56fe\u5f62\u683c\u5f0f\u7684\u7f16\u7801\u65b9\u5f0f","text":""},{"location":"perf-opt/Android/bitmap/imge-format/#1101","title":"1.\u8ba1\u7b97\u673a\u56fe\u5f62101","text":"<p>\u5728\u5f00\u59cb\u56fe\u7247\u4e4b\u65c5\u4e4b\u524d\uff0c\u5148\u6765\u804a\u804a\u56fe\u5f62\u5b66\u7684\u4e00\u4e9b\u57fa\u7840\uff0c\u8fd9\u4e9b\u5728\u56fe\u7247\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\u6216\u591a\u6216\u5c11\u90fd\u8981\u63a5\u89e6\u3002</p> <p>1.\u50cf\u7d20\u70b9\uff1a\u8ba1\u7b97\u673a\u663e\u793a\u7684\u56fe\u50cf\u662f\u7531\u50cf\u7d20\u70b9\u7ec4\u6210\u7684\uff0c\u6bcf\u4e2a\u50cf\u7d20\u70b9\u6709RGB\u4e09\u79cd\u989c\u8272\uff0c\u8fd9\u4e09\u79cd\u989c\u8272\u6309\u4e00\u5b9a\u6bd4\u4f8b\u6df7\u5408\u5c31\u53ef\u4ee5\u5f97\u5230\u5b9e\u9645\u7684\u8272\u503c\u3002\u56fe\u7247\u5c3a\u5bf8\u4e3a640 x 480\uff0c\u4ee3\u8868\u56fe\u7247\u6c34\u5e73\u6709640\u4e2a\u50cf\u7d20\u70b9\uff0c\u5782\u76f4\u6709480\u50cf\u7d20\u70b9\u3002</p> <p>2.color depth\u3001bit depth\uff1a \u6bcf\u4e2a\u50cf\u7d20RBG\u82e5\u5404\u75288\u4f4d\u8868\u793a\uff0cbit depth\u5c31\u662f8bit\uff0c\u90a3\u4e48\u8fd9\u4e2a\u50cf\u7d20\u5c31\u752824\u4f4d\u8868\u793a\uff0ccolor depth\u5c31\u662f24bit\u3002\u4e00\u4e2a\u50cf\u7d20color depth\u8d8a\u6df1\uff0c\u50cf\u7d20\u8868\u8fbe\u7684\u989c\u8272\u548c\u4eae\u5ea6\u7684\u4f4d\u6570\u8d8a\u591a\uff0c\u6587\u4ef6\u5c31\u8d8a\u5927\u3002\u4e00\u4e2acolor depth\u4e2d\u6bcf\u4e2achannel\u7684\u6df1\u5ea6\u5c31\u662fbit depth\u3002\u752832\u4f4d\u8868\u793a\u4e00\u4e2a\u50cf\u7d20\u7684\u8bdd\uff0cRBG\u5360\u752824\u4f4d\uff0c\u8fd8\u67098\u4f4d\u79f0\u4e3aalpha channel\u3002</p> <p>3.alpha composite\u3001alpha blend\u3001alpha channel\uff1a\u6e32\u67d3\u56fe\u7247\u7684\u65f6\u5019\uff0c\u56fe\u7247\u6709\u65f6\u6709\u5f88\u591a\u56fe\u5c42\uff0c\u7136\u540e\u518d\u5c06\u591a\u4e2a\u56fe\u5c42\u7ec4\u5408\u8d77\u6765\uff0c\u8fd9\u53eb\u505aalpha composite\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u591a\u4e2a\u56fe\u5c42\u6bcf\u4e2a\u5bf9\u5e94\u50cf\u7d20\u5408\u6210\u7684\u8fc7\u7a0b\u53eb\u505aalpha blend\u3002</p> <p> </p> <p>\u800c\u6bcf\u4e2a\u56fe\u5c42\u662f\u5426\u53ef\u4ee5\u88ab\u900f\u8fc7\u770b\u5230\u4e0b\u4e00\u56fe\u5c42\uff0c\u5c31\u9700\u8981\u8bb0\u5f55\u4e00\u4e9b\u54ea\u91cc\u900f\u660e\u3001\u54ea\u91cc\u4e0d\u900f\u660e\u7684\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5c31\u88ab\u5b58\u5728\u4e00\u4e2aalpha channel\u4e2d\u4e86\u3002</p> <p>4.color space\uff1aRGB\u4e09\u4e2a\u989c\u8272\u53ef\u4ee5\u6620\u5c04\u5230\u4e00\u4e2a\u4e09\u7ef4\u7a7a\u95f4\uff0c\u6bcf\u4e2a\u989c\u8272\u5b9a\u4e49\u4e00\u4e2a\u5750\u6807\u8f74\uff0c\u6bcf\u4e2a\u989c\u8272\u90fd\u5728\u8fd9\u4e2a\u4e09\u7ef4\u7a7a\u95f4\u6709\u552f\u4e00\u7684\u4f4d\u7f6e\u3002\u8fd9\u4e2a\u7a7a\u95f4\u5c31\u662fcolor space\u3002color space\u6709\u591a\u79cd\uff0cAdobeRGB\u3001CMYK\u7b49\u7b49\u3002      </p> <p></p> <p>5.color model\uff1a\u5c06\u989c\u8272\u6620\u5c04\u5230\u4e09\u7ef4\u7a7a\u95f4\u7684\u62bd\u8c61\u6570\u5b66\u6a21\u578b\u5c31\u662fcolor model</p> <p>6.color components\uff1acolor component\u662f\u50cf\u7d20\u7684\u989c\u8272\u5355\u4f4d\uff0ccolor components\u662f\u50cf\u7d20\u6240\u6709\u8fd9\u79cd\u5355\u4f4d\u7684\u96c6\u5408\u3002\u6784\u6210\u50cf\u7d20\u6240\u5728\u7684color space\u5750\u6807\u8f74\u7684\u989c\u8272\u5c31\u662f\u50cf\u7d20\u7684\u4e00\u4e2acolor component\u3002\u6bd4\u5982\uff0cRBG\u50cf\u7d20\u7684color components\u4e3a\u4e09\u4e2a\u989c\u8272\u7684color component\u518d\u52a0\u4e0aalpha channel\u3002</p> <p>\u5404\u79cd\u56fe\u7247\u683c\u5f0f\u76ee\u7684\u662f\u5728\u7f51\u7edc\u4f20\u8f93\u548c\u5b58\u50a8\u7684\u65f6\u5019\u4f7f\u7528\u66f4\u5c11\u7684\u5b57\u8282\uff0c\u5373\u8d77\u5230\u538b\u7f29\u7684\u4f5c\u7528\uff0c\u6216\u8005\u652f\u6301\u591a\u5f20\u56fe\u7247\u7ec4\u5408\u6210\u4e00\u5f20\u52a8\u6001\u56fe\u3002\u5728\u56fe\u7247\u683c\u5f0f\u89e3\u7801\u540e\uff0c\u65e0\u8bba\u56fe\u7247\u7684\u683c\u5f0f\uff0c\u56fe\u7247\u6570\u636e\u90fd\u662f\u50cf\u7d20\u6570\u7ec4\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#2-jpeg","title":"2. JPEG","text":"<p>\u4f5c\u4e3a\u6700\u60a0\u4e45\u3001\u6700\u5e7f\u6cdb\u6d41\u4f20\u7684\u56fe\u7247\u683c\u5f0f\uff0c\u4ece\u5b83\u5f00\u59cb\u56fe\u7247\u4e4b\u65c5\u662f\u518d\u5408\u9002\u4e0d\u8fc7\u7684\u4e86\u3002\u5148\u804a\u804aJPEG\u7f16\u7801\u518d\u770b\u770bJPEG\u6587\u4ef6\u683c\u5f0f\uff0c\u5bf9JPEG\u5c31\u53ef\u4ee5\u6709\u4e00\u5b9a\u7684\u7406\u89e3\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#21-jpeg","title":"2.1. JPEG\u7f16\u7801","text":"<p>JPEG\u7f16\u7801\u662f\u57fa\u4e8e\u4e24\u4e2aidea\uff0c\u7b2c\u4e00\u4e2a\u662f\u57fa\u4e8e\u76f8\u90bb\u7684\u50cf\u7d20\u4fe1\u606f\u662f\u76f8\u8fd1\u7684\uff0c\u5373\u7a7a\u95f4\u5197\u4f59\u6027\uff0c\u5c3d\u91cf\u5c11\u8bb0\u5f55\u91cd\u590d\u7684\u6570\u636e\u6765\u8fbe\u5230\u538b\u7f29\u7684\u6548\u679c\u3002\u7b2c\u4e8c\u4e2a\u662f\u57fa\u4e8e\u56fe\u50cf\u4fe1\u53f7\u7684\u9891\u8c31\u7279\u6027\uff0c\u56fe\u50cf\u5305\u542b\u5404\u79cd\u9891\u7387\uff0c\u5927\u90e8\u5206\u4e3a\u4f4e\u9891\u9891\u8c31\uff0c\u5c11\u90e8\u5206\u4e3a\u9ad8\u9891\u9891\u8c31\u3002\u53ef\u4ee5\u4fdd\u7559\u5305\u542b\u56fe\u50cf\u4fe1\u606f\u8f83\u591a\u7684\u4f4e\u9891\u9891\u8c31\uff0c\u820d\u53bb\u5305\u542b\u56fe\u50cf\u4fe1\u606f\u8f83\u5c11\u7684\u9ad8\u9891\u9891\u8c31\u3002\u800c\u8fbe\u5230\u56fe\u7247\u8d28\u91cf\u6ca1\u6709\u53ef\u5bdf\u89c9\u7684\u635f\u4f24\uff0c\u53c8\u80fd\u8fbe\u5230\u538b\u7f29\u7684\u6548\u679c\u3002\u8fd9\u4e5f\u8bf4\u660e\u4e86JPEG\u662f\u6709\u635f\u7f16\u7801\u3002</p> <p>1.\u8272\u5f69\u7a7a\u95f4\u8f6c\u6362\uff0c\u5c06RGB\u8272\u5f69\u7a7a\u95f4\u8f6c\u6362\u5230\u5176\u4ed6\u8272\u5f69\u7a7a\u95f4\uff0c\u6bd4\u5982YUV\u8272\u5f69\u7a7a\u95f4\u3002Y\u4ee3\u8868\u8272\u5f69\u4eae\u5ea6(Luminance)\u3001U\u4ee3\u8868\u8272\u5ea6(Chrominance)\u3001V\u4ee3\u8868\u6d53\u5ea6(Chroma)\uff0c\u4ee5\u8fd9\u4e09\u4e2a\u5b9a\u4e49\u5750\u6807\u8f74\u5efa\u7acb\u4e09\u7ef4\u7a7a\u95f4\u3002\u8f6c\u6362\u4e3aYUV\u8272\u5f69\u7a7a\u95f4\u4ee5\u540e\uff0c\u56e0\u4e3a\u76f8\u90bb\u7684\u56db\u4e2a\u50cf\u7d20\u70b9U\u548cV\u53ef\u4ee5\u7528\u7528\u4e00\u4e2a\u503c\u6765\u8868\u793a</p> <p></p> <p>\u8fd9\u6837\u6bcf\u56db\u4e2a\u50cf\u7d20\u70b9\uff0c\u5b58\u50a84\u4e2aY\u30011\u4e2aU\u3001\u4e00\u4e2aV\u3002YUV\u548cRGB\u4e00\u6837\u90fd\u75288\u4f4d\u6765\u8868\u793a\uff0cYUV\u8272\u5f69\u7a7a\u95f4\u5c31\u6bd4RGB\u8272\u5f69\u7a7a\u95f4\u6240\u9700\u7684\u5b58\u50a8\u7a7a\u95f4\u5c11\u4e00\u534a\uff0c\u6570\u636e\u5c31\u88ab\u538b\u7f29\u5230\u4e86\u4e00\u534a\u3002\u5b8c\u6210\u4e86\u7b2c\u4e00\u4e2aidea\u3002</p> <p>2.\u79bb\u6563\u4f59\u5f26\u53d8\u6362DCT DCT\u662f\u5085\u91cc\u53f6\u53d8\u6362\u7684\u4e00\u79cd\uff0c\u53d8\u6362\u540e\u4f1a\u5f97\u5230\u4e00\u4e2a\u7cfb\u6570\u3002\u5177\u4f53\u516c\u5f0f\u5c31\u4e0d\u8be6\u7ec6\u8bf4\u660e\u4e86\u3002</p> <p></p> <p>\u5047\u5982\u4e00\u5f20\u56fe\u7247\u5206\u5272\u62108X8\u7684\u53d6\u6837\u5757\u5982\u4e0b</p> <p></p> <p>\u5bf9\u53d6\u6837\u5757\u8fdb\u884cDCT\uff0c\u53d6\u6837\u5757\u4f1a\u4ece\u8272\u5f69\u57df\u8f6c\u6362\u4e3a\u9891\u7387\u57df\u7684DCT\u7cfb\u6570\u5757\u3002\u56fe\u7247\u7ecf\u8fc7\u6b64\u6b65\u9aa4\u4f1a\u8f93\u51fa\u4e00\u4e2a\u9891\u7387\u7cfb\u6570\u77e9\u9635\uff0c\u5de6\u4e0a\u7684\u7cfb\u6570\u5e45\u5ea6\u503c\u6700\u5927\uff0c\u8d8a\u5f80\u53f3\u4e0b\uff0c\u7cfb\u6570\u7684\u5e45\u5ea6\u503c\u8d8a\u5c0f\uff0c\u9891\u7387\u8d8a\u9ad8\u3002\u5927\u90e8\u5206\u56fe\u7247\u4fe1\u606f\u90fd\u5728\u5de6\u4e0a\u533a\u57df\uff0c\u79bb\u5de6\u4e0a\u8d8a\u6765\u8d8a\u8fdc\u7684\u53f3\u4e0b\u51e0\u4e4e\u4e0d\u542b\u6709\u56fe\u7247\u4fe1\u606f\uff0c\u751a\u81f3\u53ea\u542b\u6742\u6ce2\u3002</p> <p></p> <p>\u8fd9\u4e00\u6b65\u9aa4\u6ca1\u6709\u538b\u7f29\u4f5c\u7528\uff0c\u5b83\u76ee\u7684\u662f\u4e3a\u4e0b\u4e00\u6b65\u9aa4\u627e\u4f4e\u9891\u548c\u9ad8\u9891\u533a\u57df\uff0c\u4e5f\u5c31\u662f\u627e\u51fa\u7559\u4e0b\u7684\u533a\u57df\u548c\u820d\u53bb\u7684\u533a\u57df\u3002</p> <p>3.\u91cf\u5316</p> <p>\u6b64\u6b65\u662f\u5c06\u4e0a\u6b65\u6c42\u5f97\u7684DCT\u7cfb\u6570\u7684\u7b80\u5316\u7684\u8fc7\u7a0b\uff0c\u5229\u7528\u4eba\u773c\u5bf9\u9ad8\u9891\u90e8\u5206\u4e0d\u654f\u611f\u7684\u7279\u6027\u6765\u820d\u53bb\u9ad8\u9891\u90e8\u5206\u3002 \u5c06\u4e0a\u6b65\u6240\u5f97\u7684\u9891\u7387\u7cfb\u6570\u77e9\u9635\u548c\u4eae\u5ea6\u91cf\u5316\u8868(\u5982\u4e0b)</p> <p></p> <p>\u8fdb\u884c\u8ba1\u7b97\u3002\u91cf\u5316\u8868\u5c31\u662f\u63a7\u5236\u538b\u7f29\u6bd4\u7684\u5173\u952e\u3002\u9891\u7387\u7cfb\u6570\u77e9\u9635\u7684\u6570\u503c\u9664\u4ee5\u5bf9\u5e94\u91cf\u5316\u8868\u4f4d\u7f6e\u4e0a\u7684\u6570\u503c\uff0c\u5e76\u56db\u820d\u4e94\u5165\u5230\u6700\u8fd1\u7684\u6574\u6570\u3002\u4ee5\u7b2c\u4e00\u884c\u7b2c\u4e00\u4e2a\u6570\u636e\u4e3a\u4f8b</p> <p></p> <p>\u6b64\u6b65\u540e\uff0c\u9ad8\u9891\u6bb5\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u96f6\u3002</p> <p></p> <p>\u89e3\u7801\u7684\u65f6\u5019\uff0c\u53cd\u91cf\u5316\u6b65\u9aa4\u4f1a\u4e58\u56de\u91cf\u5316\u8868\u76f8\u5e94\u503c\uff0c\u4f46\u662f\u56db\u820d\u4e94\u5165\u5bfc\u81f4\u4f4e\u9891\u6709\u6240\u635f\u5931\uff0c\u9ad8\u98910\u5b57\u6bb5\u88ab\u820d\u5f03\u3002\u6b64\u6b65\u4e3a\u6709\u635f\u8fd0\u7b97\uff0c\u4f1a\u5bfc\u81f4\u56fe\u50cf\u8d28\u91cf\u53d8\u4f4e\u3002\u81f3\u6b64\uff0c\u5b8c\u6210\u4e86\u7b2c\u4e8c\u4e2aidea\u3002</p> <p>4.zig-zag\u6e38\u7a0b\u7f16\u7801</p> <p>\u91cf\u5316\u540e\u7684\u6570\u636e\u8fd8\u53ef\u4ee5\u8fdb\u884c\u7b80\u5316\uff0c\u66f4\u5927\u7a0b\u5ea6\u7684\u53bb\u538b\u7f29\u3002</p> <p>\u5bf9\u4e0a\u6b65\u6240\u5f97\u77e9\u9635\u8fdb\u884cZ\u5f62\u7f16\u6392</p> <p></p> <p>\u6240\u5f97\u7ed3\u679c\u4e3a\u221226\uff0c\u22123\uff0c0\uff0c\u22123\uff0c\u22123\uff0c\u22126\uff0c2\uff0c\u22124\uff0c1 \u22124\uff0c1\uff0c1\uff0c5\uff0c1\uff0c2\uff0c\u22121\uff0c1\uff0c\u22121\uff0c2\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c\u22121\uff0c\u22121\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0\uff0c0 \uff0c\u53ef\u4ee5\u770b\u51fa\u8fd9\u6837\u4f1a\u51fa\u73b0\u8fde\u7eed\u7684\u591a\u4e2a0\uff0c\u8fd9\u6837\u5229\u4e8e\u8fdb\u884c\u6e38\u7a0b\u7f16\u7801\u3002</p> <p>\u6e38\u7a0b\u7f16\u7801\u4f1a\u7528\u7b80\u5316\u7684\u65b9\u5f0f\u53bb\u8bb0\u5f55\u91cd\u590d\u51fa\u73b0\u7684\u5185\u5bb9\uff0c\u6700\u540e\u7f16\u7801\u540e\u51fa\u6765\u7684\u4f4d\u6570\u8fdc\u5c0f\u4e8e\u539f\u59cb\u5b57\u7b26\u4e32\u7684\u4f4d\u6570\uff0c\u5b9e\u73b0\u5927\u5e45\u5ea6\u7684\u6570\u636e\u538b\u7f29\u3002\u5e76\u4e14\u6e38\u7a0b\u7f16\u7801\u7528\u56fa\u5b9a\u76844\u4f4d\u6765\u5b58\u50a8\u91cd\u590d\u7684\u6570\u91cf\uff0c\u6240\u4ee5\u6700\u591a\u91cd\u590d\u5185\u5bb9\u53ef\u4ee5\u8bb0\u5f55\u6570\u91cf\u4e3a15\uff0c\u8d85\u8fc715\u6b21\u8981\u8fdb\u884c\u5206\u6bb5\u5904\u7406\u3002JPEG\u5bf9\u6e38\u7a0b\u7f16\u7801\u8fdb\u884c\u6309\u9700\u66f4\u6539\uff0c\u53ea\u5c060\u4f5c\u4e3a\u91cd\u590d\u7684\u5185\u5bb9\uff0c\u6bcf\u4e2a\u6570\u503c\u8bb0\u5f55\u524d\u9762\u6709\u591a\u5c11\u91cd\u590d\u76840\uff0c\u672b\u5c3e\u5982\u679c\u90fd\u662f0\u7528EOB\u4f5c\u4e3a\u4ee3\u8868\u3002\u6b64\u6b65\u4e0d\u5305\u542b\u7b2c\u4e00\u4e2a\u6570\u503c\uff0c\u7b2c\u4e00\u4e2a\u6570\u4e3a\u76f4\u6d41\u7cfb\u6570\uff0c\u6b64\u6b65\u53ea\u5904\u7406\u4ea4\u6d41\u7cfb\u6570\u3002</p> <p>\u8fd9\u91cc\u4f7f\u7528\u7684zig-zag\u7f16\u6392\u540e\u518d\u8fdb\u884c\u6e38\u7a0b\u7f16\u7801\u5982\u4e0b</p> <p>(0,-3);(1,-3);(0,-3);(0,-6);(0,2);(0,-4);(0,1);(0,-4);(0,1);(0,1);(0,5);(0,1);(0,2);(0,-1);(0,1);(0,-1);(0,2);(5,-1);(0,-1);EOB;</p> <p>5.\u8303\u5f0fHuffman\u7f16\u7801</p> <p>JPEG\u5c06zig-zag\u6e38\u7a0b\u7f16\u7801\u540e\u7684\u7ed3\u679c\u8fdb\u4e00\u6b65\u8fdb\u884c\u538b\u7f29\uff0c\u5148\u5c06\u4e0a\u6b65\u6240\u5f97\u5143\u7ec4\u540e\u4e00\u90e8\u5206\u7528\u4e0b\u8868\u8fdb\u884c\u8f6c\u6362\u7f16\u7801\uff0c\u518d\u5c06\u5143\u7ec4\u524d\u4e00\u90e8\u5206\u4e0e\u540e\u4e00\u90e8\u5206\u7684\u7ec4\u503c\u7684\u7ec4\u5408\u7528\u8303\u5f0fhuffman\u8fdb\u884c\u7f16\u7801\u3002</p> <pre><code>             \u6570\u503c                 \u7ec4              \u5b9e\u9645\u4fdd\u5b58\u503c\n0                   0                   -\n-1,1                  1                  0,1\n-3,-2,2,3                2              00,01,10,11\n-7,-6,-5,-4,4,5,6,7            3    000,001,010,011,100,101,110,111\n-15,..,-8,8,..,15            4       0000,..,0111,1000,..,1111\n-31,..,-16,16,..,31           5     00000,..,01111,10000,..,11111\n-63,..,-32,32,..,63           6                   .\n-127,..,-64,64,..,127          7                   .\n-255,..,-128,128,..,255         8                   .\n-511,..,-256,256,..,511         9                   .\n-1023,..,-512,512,..,1023       10                   .\n-2047,..,-1024,1024,..,2047      11                   .\n-4095,..,-2048,2048,..,4095      12                   .\n-8191,..,-4096,4096,..,8191      13                   .\n-16383,..,-8192,8192,..,16383     14                   .\n-32767,..,-16384,16384,..,32767    15                   .\n</code></pre> <p>\u6bd4\u5982\u7b2c\u4e00\u9879(0,-3)\uff0c\u5c06-3\u4fdd\u5b58\u4e3a\u8868\u4e2d\u5bf9\u5e94\u7684\u5b9e\u9645\u4fdd\u5b58\u503c00\uff0c0\u4e0e-3\u7684\u7ec4\u503c2\u7ec4\u5408\uff0c\u5219\u7b2c\u4e00\u9879\u66f4\u6539\u4e3a(0,2) ,00\u3002\u518d\u5c06\u62ec\u53f7\u91cc\u7684\u503c\u548c\u6210\u4e3a\u4e00\u4e2a\u5b57\u828202\uff0c\u9ad84\u4f4d\u662f\u524d\u97620\u7684\u4e2a\u6570\uff0c\u4f4e\u56db\u4f4d\u662f\u5206\u7ec4\u540e\u503c\u7684\u7ec4\u3002</p> <p>\u7136\u540e\u5c0602\u53bbHuffman\u8868\u4e2d\u67e5\u627e\uff0cJPEG\u5b58\u50a8\u7684\u65f6\u5019\u4f1a\u5b58\u50a8\u5b9a\u4e49\u7684Huffman\u8868\uff0c\u5e76\u4e14\u5206\u4e3a4\u4e2a\u8868\uff0c\u76f4\u6d41\u4eae\u5ea6\u8868\u3001\u76f4\u6d41\u8272\u5ea6\u8868\u3001\u4ea4\u6d41\u4eae\u5ea6\u8868\u3001\u4ea4\u6d41\u8272\u5ea6\u8868\u300202\u6bd4\u5982\u5728\u76f8\u5e94Huffman\u8868\u4e2d\u4e3a100\uff0c\u5219\u7b2c\u4e00\u9879\u66f4\u6539\u4e3a100 00\uff0c\u6700\u540e\u5b58\u50a8\u7684\u5b57\u8282\u5c31\u4e3a100 00\u3002 \u5bf9zig-zag\u6e38\u7a0b\u7f16\u7801\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u5bf9\u7b2c\u4e00\u4e2a\u6570\u636e\u8fdb\u884c\u7f16\u7801\u3002\u6700\u540e\u4e00\u6b65\u5c31\u662f\u5c06\u7b2c\u4e00\u4e2a\u6570\u636e\u53bb\u76f8\u5e94\u7684Huffman\u8868\u67e5\u8be2\uff0c\u5c06\u7ed3\u679c\u653e\u5728\u7ed3\u679c\u7684\u9996\u90e8\uff0c\u5c31\u5f97\u5230\u4e86\u7f16\u7801\u7684\u6570\u636e\u3002</p> <p>Huffman\u8868\u4f1a\u4f7f\u5f97\u51fa\u73b0\u9891\u7387\u9ad8\u7684\u6570\u5b57\u5c0f\u4e8e8\u4f4d\uff0c\u800c\u51fa\u73b0\u9891\u7387\u9ad8\u7684\u6570\u5b57\u5927\u4e8e8\u4f4d\uff0c\u8fd9\u6837\u603b\u4f53\u5b58\u50a8\u53ef\u4ee5\u51cf\u5c11\u5f88\u591a\u7a7a\u95f4\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#22-jpeg","title":"2.2. JPEG\u6587\u4ef6\u683c\u5f0f","text":"<p>\u5927\u90e8\u5206\u56fe\u7247\u5305\u62ecJPEG\u662f\u7531\u5927\u7aef\u6cd5(big-endian)\u8fdb\u884c\u5b58\u50a8\u7684\uff0c\u4e00\u822c\u7528Intel\u82af\u7247\u7684\u8ba1\u7b97\u662f\u5c0f\u7aef\u6cd5(little-endian)\u8fdb\u884c\u5b58\u50a8\u7684\u3002\u8fd9\u610f\u5473\u7740\uff0c\u56fe\u7247\u89e3\u7801\u7684\u65f6\u5019\u8981\u8fdb\u884c\u5927\u7aef\u6cd5\u5230\u5c0f\u7aef\u6cd5\u7684\u8f6c\u6362\u624d\u80fd\u7f16\u7801\u3002</p> <pre><code>static unsigned short swap_bigendian_to_littleendian_Two_Byte(unsigned short value) {\nreturn (unsigned short)((value &amp; 0x00FF) &lt;&lt; 8) | (unsigned short)((value &amp; 0xFF00) &gt;&gt; 8);\n}\nstatic unsigned int swap_bigendian_to_littleendian_Four_Byte(unsigned int value) {\nreturn (unsigned int)((value &amp; 0x000000FF) &lt;&lt; 24) | (unsigned int)((value &amp; 0x0000FF00) &lt;&lt; 16)\n| (unsigned int)((value &amp; 0x00FF0000) &lt;&lt; 8) | (unsigned int)((value &amp; 0xFF000000) &gt;&gt; 24);\n}\n</code></pre> <p>JPEG\u6587\u4ef6\u662f\u5206\u4e3a\u591a\u4e2asegment\uff0c\u6bcf\u4e2asegment\u8d77\u59cb\u6709segment\u6807\u8bc6\uff0c\u6807\u8bc6\u524d\u4e24\u4e2a\u5143\u7ec4\u89c4\u5b9a\u662f0xff\uff0c\u540e\u4e24\u4e2a\u5143\u7ec4\u4ee3\u8868segment\u7684\u5185\u5bb9\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e9b\u5e38\u7528\u7684segment\u6807\u8bc6\u3002</p> <pre><code>SOI   = ffd8   \u56fe\u7247\u5f00\u59cb\nEOI   = ffd9   \u56fe\u7247\u7ed3\u675f\nAPP0  = ffe0   \u6309JFIF\u6807\u51c6\u552f\u4e00\u8bc6\u522b\u4e00\u4e2aJPG\u7684\u6807\u5fd7\nSOF0  = ffc0   \u5e27\u5f00\u59cb\nSOF2  = ffc2   \u5e27\u5f00\u59cb\nSOS   = ffda   \u626b\u63cf\u884c\u5f00\u59cb\nDNL   = ffdc   \u5b9a\u4e49\u884c\u6570\nDRI   = ffdd   \u5b9a\u4e49\u91cd\u65b0\u5f00\u59cb\u95f4\u9694\nDQT   = ffdb   \u5b9a\u4e49\u91cf\u5316\u8868\nDHT   = ffc4   \u5b9a\u4e49Huffman\u8868\nCOM   = fffe   \u8bc4\u8bba\n</code></pre> <p>\u5982\u679c\u53ea\u7559\u4e0bsegment\u6807\u8bc6\uff0c\u5219\u4e0a\u9762\u4e3e\u4e2a\u6817\u5b50\u56fe\u7247\u6587\u4ef6\u683c\u5f0f\u5982\u4e0b</p> <pre><code>ffd8 ffe0 .... ffdb .... ffc0 .... .... ffc4 .... ffc4 .... ffc4 ....\n.... ff00 .... ff00 .... ff00 ....\n.... ff00 .... ff00 .... ff00 .... .... ff00 .... ff00 .... ff00 ....\n.... ff00 .... ffd9 \u56fe\u7247\u5f00\u59cb----\u4f5c\u4e3aJPG\u6587\u4ef6\u7684\u8bc6\u522b----\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u91cf\u5316\u8868\n----\u56fe\u7247\u5e27\u7684\u5f00\u59cb----\u4e00\u4e2a\u5230\u56db\u4e2aHuffman\u8868(\u76f4\u6d41\u4eae\u5ea6\u3001\u76f4\u6d41\u8272\u5ea6\u3001\u4ea4\u6d41\u4eae\u5ea6\u3001\u4ea4\u6d41\u8272\u5ea6)\n----\u5360\u4f4d\u7b26(\u626b\u63cf\u65f6\u76f4\u63a5\u88ab\u5ffd\u7565)----\u5360\u4f4d\u7b26----\u5360\u4f4d\u7b26----\n\u56fe\u7247\u7ed3\u675f\n</code></pre> <p>JPEG\u6709baseline\u3001progressive\u7f16\u7801\u65b9\u5f0f\uff0cbaseline\u89e3\u7801\u65f6\u4f1a\u89e3\u7801\u51fa\u90e8\u5206\u9ad8\u8d28\u91cf\u56fe\u7247\uff0c\u5e76\u4ece\u56fe\u7247\u9876\u90e8\u5230\u56fe\u7247\u5e95\u90e8\u3001\u4ece\u56fe\u7247\u5de6\u8fb9\u5230\u56fe\u7247\u53f3\u8fb9\u987a\u5e8f\u89e3\u7801\u3002progressive\u89e3\u7801\u4f1a\u5148\u89e3\u7801\u51fa\u6574\u5f20\u7684\u4f4e\u8d28\u91cf\u56fe\u7247\uff0c\u518d\u89e3\u7801\u51fa\u9ad8\u8d28\u91cf\u56fe\u7247\uff0c\u4ece\u4f4e\u8d28\u91cf\u56fe\u7247\u5230\u9ad8\u8d28\u91cf\u56fe\u7247\uff0c\u6709\u4e00\u79cd\u56fe\u7247\u9010\u6e10\u6e05\u6670\u7684\u611f\u89c9\uff0c\u4ece\u800c\u83b7\u5f97\u4e86\u66f4\u52a0\u7684\u89c6\u89c9\u4f53\u9a8c\u3002baseline\u901a\u5e38\u4f1a\u5305\u62ecSOF0\u6ca1\u6709\u4e00\u4e2aSOS\u6216\u4e00\u4e2a\uff0c\u800cprogressive\u901a\u5e38\u4f1a\u5305\u62ecSOF2\u548c\u591a\u4e2aSOS\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#3-png","title":"3. PNG","text":"<p>\u7b2c\u4e8c\u5e7f\u4e3a\u6d41\u4f20\u7684\u56fe\u7247\u683c\u5f0f\uff0c\u65e0\u635f\u7f16\u7801(lossless)\uff0c\u4e3a\u4e86\u6539\u5584\u548c\u66ff\u6362GIF\u800c\u88ab\u5f00\u53d1\u51fa\u6765\uff0c\u7ed3\u679c\u5e76\u6ca1\u6709\u505a\u5230\u3002</p> <p></p>"},{"location":"perf-opt/Android/bitmap/imge-format/#31-png","title":"3.1. PNG\u7f16\u7801","text":"<p>PNG\u7f16\u7801\u57fa\u4e8e\u4e00\u4e2aidea\uff0c\u5229\u7528\u7a7a\u95f4\u5197\u4f59\u6027\u8ba9LZ77\u6d3e\u751f\u7b97\u6cd5\u66f4\u52a0\u9ad8\u6548\u3002LZ77\u6d3e\u751f\u7b97\u6cd5\u5e7f\u6cdb\u5e94\u7528\u5728\u901a\u4fe1\u8ba1\u7b97\u673a\u9886\u57df\uff0c\u662f\u79cd\u4e0e\u56fe\u50cf\u7279\u6027\u65e0\u5173\u7684\u6587\u4ef6\u538b\u7f29\u7b97\u6cd5\uff0c\u4e3b\u8981\u5229\u7528\u6570\u636e\u7684\u91cd\u590d\u5e8f\u5217\u6765\u5b9e\u73b0\u6570\u636e\u538b\u7f29\u7684\uff0cPNG\u7f16\u7801\u7684\u4efb\u52a1\u5c31\u662f\u8ba9\u56fe\u7247\u6570\u636e\u51fa\u73b0\u66f4\u591a\u7684\u91cd\u590d\u5e8f\u5217\u6765\u63d0\u9ad8LZ77\u6d3e\u751f\u7684\u7b97\u6cd5\u7684\u6548\u7387\u3002</p> <p>1.Pass extraction</p> <p>PNG\u5206\u4e3ainterlace(\u9694\u884c\u626b\u63cf)\u548cnon-interlace(\u975e\u9694\u884c\u626b\u63cf)\uff0cinterlace\u63d0\u4f9b\u4e00\u79cd\u66f4\u53eb\u53cb\u597d\u7684\u89c6\u89c9\u4f53\u9a8c\uff0c\u5c31\u50cfJPEG\u7684progressive\u4e00\u6837\u3002</p> <p>Pass Extraction\u4f1a\u6839\u636einterlace\u6216\u8005non-interlace\uff0c\u4ece\u800c\u7528\u4e0d\u540c\u987a\u5e8f\u63d0\u53d6\u51fa\u50cf\u7d20\uff0c\u7136\u540e\u5206\u6210\u4e0d\u540c\u7684\u7ec4\uff0c\u6309\u63d0\u53d6\u51fa\u7684\u987a\u5e8f\u5b58\u50a8\u50cf\u7d20\u3002interlace\u4f1a\u5206\u62107\u7ec4\uff0cnon-interlace\u4f1a\u5206\u62101\u7ec4\u3002</p> <p></p> <p>\u8fd9\u6837\u4f1a\u5bfc\u81f4interlace\u4f1ascan\u4e00\u904d\uff0cnon-interlace\u4f1ascan\u4e03\u904d\u3002non-interlace\u5b58\u50a8\u7684\u6570\u636e\u4f1a\u6bd4interlace\u591a\u4e00\u70b9\uff0c7\u6b21scan\u8fc7\u7a0b\u5982\u4e0b\u56fe</p> <p></p> <p>2.Scanline serialization</p> <p>\u5c06\u5206\u7ec4\u51fa\u6765\u7684\u50cf\u7d20\u6309\u884c\u6765\u5e8f\u5217\u5316\uff0c\u4ee5\u4fbf\u4e0b\u4e00\u6b65\u9aa4\u8fdb\u884c\u8ba1\u7b97\u3002</p> <p>3.Filtering</p> <p>Filtering\u5b98\u65b9\u7684method\u53ea\u5b9a\u4e49\u4e860\uff0c\u5176\u4ed6\u6570\u5b57\u4ee5\u540e\u7559\u4e0b\u4f5c\u4e3a\u62d3\u5c55\u3002\u4e0d\u8fc7\u67095\u79cdtype\u3002\u5047\u8bbe\u4f60\u60f3\u8981Filter\u7684\u662f\u50cf\u7d20x</p> <p></p> <p>\u90a3\u4e48\u5b9a\u4e49a\u4e3ax\u524d\u4e00\u4e2a\u50cf\u7d20\uff0cb\u4e3ax\u4e0a\u4e00\u884c\u50cf\u7d20\u5bf9\u5e94\u4f4d\u7f6e\u7684\u50cf\u7d20\uff0cc\u4e3ab\u524d\u4e00\u4e2a\u50cf\u7d20\u3002</p> <p>\u5b9a\u4e49Filt(x)\u51fd\u6570\u7684\u7ed3\u679c\u4e3ax\u7ecf\u8fc7Filtering\u6b65\u9aa4\u7684\u503c\u3002Recon(x)\u4e3a\u89e3\u7801\u53cdFiltering\u6b65\u9aa4\u7684\u503c\u3002</p> <p>Orig(x)\u51fd\u6570\u7684\u7ed3\u679c\u4e3ax\u7684\u503c\u3002floor(x)\u51fd\u6570\u4e3afloor API\u3002PaethPredictor\u51fd\u6570\u4e3a</p> <pre><code>p = a + b - c\npa = abs(p - a)\npb = abs(p - b)\npc = abs(p - c)\nif (pa \nPr = a;\n} else if (pb \nPr = b;\n} else {\nPr = c;\n}\nreturn Pr\n</code></pre> <p>\u5219Filter type\u5bf9\u5e94\u7684\u51fd\u6570\u8868\u5982\u4e0b\u3002 </p> <p>\u5047\u5982\u4e00\u4e2a\u50cf\u7d20\u7684\u5b57\u8282\u6d41\u503c\u4e3a1\u5230255\u3002\u5982\u679c\u4e0d\u7ecf\u8fc7\u8fd9\u6b65\uff0c\u76f4\u63a5\u8fdb\u884ccompression\uff0c\u8fd9\u4e2a\u5b57\u8282\u6d41\u6ca1\u6709\u91cd\u590d\u7684\u5e8f\u5217\uff0c\u4f1a\u5bfc\u81f4compression\u6ca1\u6709\u4f5c\u7528\u3002\u5982\u679c\u8981\u662f\u7ecf\u8fc7Filter type\u4e3aSub\uff0c\u5b57\u8282\u6d41\u4f1a\u6709\u5f88\u591a\u5b57\u8282\u4e3a\u91cd\u590d\u76841\uff0c\u8fd9\u4f1a\u8ba9compression\u5927\u5927\u538b\u7f29\u6570\u636e\u91cf\u3002</p> <p>4.Compression</p> <p>\u4e0a\u6587\u63d0\u5230\u8fc7\uff0cPNG\u538b\u7f29\u7528\u7684\u662fLZ77\u6d3e\u751f\u7684\u7b97\u6cd5\uff0c\u5177\u4f53\u7b97\u6cd5\u5c31\u4e0d\u8be6\u7ec6\u5c55\u5f00\u4e86\u3002\u4e0d\u8fc7\u8fd9\u662f\u4e00\u79cd\u65e0\u635f\u538b\u7f29\u7b97\u6cd5\u3002PNG\u538b\u7f29\u6b65\u9aa4\u6ca1\u6709\u7528\u5230\u56fe\u7247\u7684\u4fe1\u53f7\u6216\u8272\u5f69\u7a7a\u95f4\u7279\u6027\u3002</p> <p>5.Chunking</p> <p>\u5c06\u538b\u7f29\u540e\u7684\u6570\u636e\u62c6\u5206\u6210\u591a\u4e2achunk\uff0c\u6765\u66f4\u597d\u7684\u7ba1\u7406\u6570\u636e\u548c\u8bfb\u53d6\u6570\u636e\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#32-png","title":"3.2. PNG\u6587\u4ef6\u683c\u5f0f","text":"<p>PNG\u6587\u4ef6\u8d77\u59cb\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u5e8f\u5217\u6765\u6807\u8bc6\u6587\u4ef6\u4e3aPNG\uff0c137 80 78 71 13 10 26 10(\u5341\u8fdb\u5236)\uff0c\u5176\u4f59\u7684\u6570\u636e\u5c31\u662f\u591a\u4e2achunk\uff0c\u4e00\u79cd\u4e3a\u5173\u952echunk\uff0c\u53e6\u4e00\u79cd\u4e3a\u8f85\u52a9chunk\u3002\u5173\u952echunk\u662f\u5fc5\u987b\u6709\u7684\uff0c\u5173\u952e\u7684\u56fe\u50cf\u6570\u636e\u5c31\u5728\u5173\u952echunk\u91cc\u3002</p> <p>\u5148\u6765\u770b\u4e00\u4e0bchunk\u7684\u7ed3\u6784</p> <pre><code>typedef struct {\nunsigned int length;\nunsigned int chunk_type;\nunsigned char *chunk_data;\nunsigned int crc;\n}chunk;\n</code></pre> <p>chunk\u91cc\u7684length\u5b57\u6bb5\uff0c\u53ea\u8bb0\u5f55chunk_data\u7684\u957f\u5ea6\uff0c\u4e0d\u7ba1\u5176\u4ed6\u5b57\u6bb5\u3002chunk_type\u7684\u503c\u4ece65-90\u621697-122\uff0c\u4ee3\u8868A-Z\u6216a-z\uff0c\u7528\u5b57\u7b26\u6765\u6807\u8bc6chunk\u7684\u7c7b\u578b\u3002crc\u4ee3\u8868\u9664length\u5b57\u6bb5\u5916\u7684\u4e09\u4e2a\u5b57\u6bb5\u7684\u5faa\u73af\u5197\u4f59\u5dee\u9519\u68c0\u9a8c(TCP\u6821\u9a8c)\u3002</p> <p>\u5173\u952echunk\u7684\u51fa\u73b0\u987a\u5e8f\u5fc5\u987b\u5982\u4e0b\uff1aIHDR(\u5934\u4fe1\u606f)\u3001PLTE(\u8c03\u8272\u677f)\u3001IDAT(\u56fe\u7247\u6570\u636e\u5757)\u3001IEND(\u7ed3\u5c3e\u6807\u8bc6)</p> <p>IHDR</p> <p>\u7ed3\u6784\u5982\u4e0b\uff0c\u5176\u4ed6\u5b57\u7b26\u5728\u77e5\u9053png\u5982\u4f55\u7f16\u7801\u5c31\u5f88\u597d\u7406\u89e3\u4e86\uff0c\u5c31\u6709color_type\u6ca1\u6709\u63d0\u53ca\uff0ccolor_type\u662f\u5229\u7528\u4f4d\u7ec4\u5408\u6765\u8868\u793a\u7684\uff0c1\u4ee3\u8868\u4f7f\u7528PLTE\u30012\u4ee3\u8868\u662f\u771f\u5f69\u56fe\u7247\uff0c3\u4ee3\u8868\u6709alpha channel\u3002</p> <pre><code>typedef struct {\nunsigned int width;\nunsigned int height;\nunsigned char bit_depth;\nunsigned char color_type;\nunsigned char compression_method;\nunsigned char filter_method;\nunsigned char interlace_method;\n} IHDR;\n</code></pre> <p>PLTE</p> <p>\u8c03\u8272\u677f\u5305\u62ec1\u5230256\u4e2a\u8272\u5f69\uff0c\u6bcf\u4e2a\u8272\u5f69RGB\u4e09\u79cd\u989c\u8272\u5404\u53601\u5b57\u8282\uff0c\u5e76\u4e14\u6bcf\u79cd\u8272\u5f69\u6709\u4ece0\u5f00\u59cb\u9010\u6e10\u589e\u5927\u7684\u7d22\u5f15\u3002\u5b9e\u9645\u5b58\u50a8\u65f6\uff0c\u6bcf\u4e2a\u8272\u5f69\u6784\u6210\u4e00\u4e2a3\u5b57\u8282\u7684\u5355\u4f4d\uff0c\u8c03\u8272\u677f\u5b58\u50a8\u591a\u4e2a\u8fd9\u79cd\u5355\u4f4d\uff0c\u4e0d\u5b58\u50a8\u5355\u4f4d\u7684\u7d22\u5f15\u3002PLTE\u7684\u8272\u5f69\u6570\u4e0d\u80fd\u8d85\u8fc7\u50cf\u7d20bit depth\u80fd\u8868\u8fbe\u7684\u8272\u5f69\u6570\u3002\u6bd4\u5982bit depth\u4e3a4bit\uff0c\u5219PLTE\u7684\u8272\u5f69\u6570\u4e0d\u80fd\u8d85\u8fc72\u76844\u6b21\u65b9\u537316\u3002PLTE\u7684\u76ee\u7684\u5c31\u662f\uff0c\u51cf\u5c0f\u56fe\u50cf\u6570\u636e\u7684\u5927\u5c0f\uff0c\u6709\u4e86PLTE\uff0c\u50cf\u7d20\u70b9\u5c31\u4e0d\u7528\u5b58\u50a8RGB\u8272\u5f69\u4e86\uff0c\u76f4\u63a5\u5b58\u50a8PLTE\u7684\u7d22\u5f15\u5c31\u53ef\u4ee5\u4e86\u3002\u5728\u89e3\u7801\u65f6\uff0c\u901a\u8fc7\u7d22\u5f15 * 3\uff0c\u5c31\u53ef\u4ee5\u4ece\u8c03\u8272\u677f\u4e8c\u8fdb\u5236\u6d41\u4e2d\u627e\u5230\u76f8\u5e94\u7684\u8272\u5f69\u4f4d\u7f6e\u3002</p> <p>IDAT</p> <p>\u7ecf\u8fc7\u7f16\u7801\u7684\u56fe\u50cf\u6570\u636echunk\uff0c\u53ef\u80fd\u6709\u591a\u4e2a\u3002</p> <p>IEND</p> <p>\u6807\u5fd7\u56fe\u50cf\u7684\u7ed3\u675f\uff0c\u6ca1\u6709chunk_data\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#4-apng","title":"4. APNG","text":"<p>APNG\u662f\u4e3aPNG\u52a8\u56fe\u505a\u7684\u7b80\u5355\u62d3\u5c55\u3002APNG\u5305\u542b\u591a\u4e2aPNG\uff0c\u5c06\u591a\u4e2aPNG\u7684\u56fe\u7247\u6570\u636e\u4f5c\u4e3aAPNG\u7684\u6bcf\u4e00\u5e27\uff0c\u7136\u540e\u5c06\u591a\u4e2aPNG\u91cd\u590d\u7684\u5176\u4ed6\u6570\u636e\u53ea\u4fdd\u7559\u4e0b\u4e00\u4efd\u3002APNG\u652f\u6301PNG\u7684\u6240\u6709chunk\uff0c\u5e76\u4e14\u8fd8\u6709\u51e0\u4e2aPNG\u4e0d\u5305\u62ec\u7684\u5173\u952echunk\uff0cACTL\u3001FCTL\uff0c\u5e76\u4e14\u5c06IDAT\u547d\u540d\u4e3aFDAT\uff0c\u8fd8\u589e\u52a0\u4e86\u4e00\u4e2asequence_number\u5b57\u6bb5\u3002APNG\u7b2c\u4e00\u4e2a\u6570\u636e\u5757\u4ecd\u662f\u53ebIDAT\u800c\u4e0d\u53ebFDAT\uff0c\u8fd9\u6837\u8bbe\u7f6e\u4e86\u4e00\u4e2adefault image\uff0c\u76ee\u7684\u662f\u4e3a\u8ba9\u4e0d\u652f\u6301APNG\u7684\u89e3\u7801\u5668\u4e5f\u53ef\u4ee5\u89e3\u7801\u51fa\u4e00\u5f20default image\u3002</p> <pre><code>                                            APNG                          \nIHDR\nACTL\nPNG_1       PNG_2      PNG_3                FCTL\nIHDR        IHDR       IHDR       ---&gt;      IDAT\nIDAT        IDAT       IDAT       ---&gt;      FCTL\n\u5176\u4ed6Chunk   \u5176\u4ed6Chunk   \u5176\u4ed6Chunk            FDAT\nIEND        IEND       IEND                 FCTL\nFDAT\n\u5176\u4ed6Chunk\nIEND\n</code></pre> <p>ACTL</p> <p>ACTL\u662f\u63a7\u5236\u52a8\u753b\u7684chunk\uff0cnum_frames\u8bb0\u5f55APNG\u6709\u591a\u5c11\u5e27\uff0cnum_playes\u8bb0\u5f55APNG\u64ad\u653e\u52a8\u753b\u591a\u5c11\u904d\u3002</p> <pre><code>typedef struct {\nunsigned int num_frames;\nunsigned int num_playes;\n}actl;\n</code></pre> <p>FCTL</p> <p>FCTL\u662f\u6bcf\u4e2a\u5e27\u7684\u5934\u90e8chunk\uff0c\u7ed3\u6784\u5982\u4e0b</p> <pre><code>typedef struct {\nunsigned int sequence_number;\nunsigned int width;\nunsigned int height;\nunsigned int x_offset;\nunsigned int y_offset;\nunsigned short delay_num;\nunsigned short delay_den;\nunsigned char dispose_op;\nunsigned char blend_op;\n}fctl;\n</code></pre> <p>delay_num\u4e3a\u8fd9\u4e00\u5e27\u663e\u793a\u65f6\u95f4\u7684\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u5206\u5b50\uff0cdelay_den\u4e3a\u8fd9\u4e00\u5e27\u663e\u793a\u65f6\u95f4\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u5206\u6bcd\u3002</p> <p>blend_op\u53d6\u503c\u53ef\u80fd\u4e3aAPNG_BLEND_OP_SOURCE\u6216APNG_BLEND_OP_OVER\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u53d6\u51b3\u6b64\u5e27\u5728\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u662f\u5426\u9700\u8981alpha blend\u3002\u5982\u679c\u662fAPNG_BLEND_OP_SOURCE\uff0c\u5219\u4e0d\u8fdb\u884calpha blend\uff0c\u5728\u753b\u5e03\u4e0a\u6e05\u7a7a\u4e0a\u5e27\u7684\u6e32\u67d3\u3002APNG_BLEND_OP_OVER\u5219\u8fdb\u884c\uff0c\u5728\u753b\u5e03\u4e0a\u7ee7\u7eed\u4e0a\u5e27\u6e32\u67d3\u3002</p> <p>dispose_op\u53d6\u503c\u53ef\u80fd\u4e3aAPNG_DISPOSE_OP_NONE\u3001APNG_DISPOSE_OP_BACKGROUND\u3001APNG_DISPOSE_OP_PREVIOUS\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u53d6\u51b3\u6b64\u5e27\u5904\u7406\u7ed3\u675f\u65f6\u7684\u64cd\u4f5c\u3002APNG_DISPOSE_OP_NONE\u8868\u793a\u4e3a\u4e0d\u4f5c\u64cd\u4f5c\uff0cAPNG_DISPOSE_OP_BACKGROUND\u8868\u793a\u4e3a\u5c06\u753b\u5e03\u4e0a\u6b64\u5e27\u6e05\u7a7a\u4e3a\u900f\u660e\u9ed1\u8272\uff0cAPNG_DISPOSE_OP_PREVIOUS\u8868\u793a\u4e3a\u5c06\u753b\u5e03\u8fd8\u539f\u4e3a\u4e0a\u4e00\u5e27\u7ed3\u675f\u65f6\u7684\u5185\u5bb9\u3002</p> <p>APNG\u89e3\u7801\u65f6\u8fd8\u6709\u5173\u4e8echunk\u6b63\u786e\u6027\u7684\u68c0\u6d4b</p> <p>1.IHDR\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u4e14\u5fc5\u987b\u4e3a\u5f00\u5934\u3002</p> <p>2.ACTL\u5fc5\u987b\u53ea\u6709\u4e00\u4e2a\u3002</p> <p>3.FCTL\u548cFDAT\u4e2d\u7684sequence_number\u5fc5\u987b\u6309\u987a\u5e8f\u9012\u589e\uff0c\u4e0d\u80fd\u6709\u95f4\u9694\u548c\u91cd\u590d\u3002</p> <p>4.FCTL\u7684\u4e2a\u6570\u5fc5\u987b\u548cACTL\u4e2d\u7684num_frames\u76f8\u7b49\u3002</p> <p>5.FCTL\u540e\u9762\u5fc5\u987b\u662fIDAT\u6216FDAT\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#5-webp","title":"5. WEBP","text":"<p>WEBP\u662fGoogle\u63a8\u51fa\u7684\u65b0\u4e00\u4ee3\u6587\u4ef6\u683c\u5f0f\uff0c\u671f\u671b\u4ee3\u66ffJPEG\u548cPNG\uff0c\u5728\u4e0eJPEG\u548cPNG\u76f8\u540c\u7684\u56fe\u7247\u8d28\u91cf\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5927\u5927\u7f29\u5c0f\u6587\u4ef6\u5927\u5c0f\u3002WEBP\u5206\u4e3a\u6709\u635f\u7f16\u7801\u548c\u65e0\u635f\u7f16\u7801(lossless)\uff0c\u6709\u635f\u7f16\u7801\u662f\u57fa\u4e8eVP8\u89c6\u9891\u683c\u5f0f\u7f16\u7801\uff0c\u800c\u65e0\u635f\u7f16\u7801\u662fWEBP\u5c0f\u7ec4\u5f00\u53d1\u51fa\u7684\u65b9\u5f0f\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#51-webp","title":"5.1. WEBP\u6709\u635f\u7f16\u7801","text":"<p>VP8\u7f16\u7801\u4e0eJPEG\u7f16\u7801\u76f8\u8fd1\uff0c\u5176\u4e2d\u6700\u4e3b\u8981\u7684\u4e0d\u540c\u662f\u5e94\u7528\u5e27\u5185\u9884\u6d4b(intra-prediction)\u3002\u5e27\u5185\u9884\u6d4b\u5c31\u662f\u5728\u4e00\u4e2a\u5e27\u5185\u5e94\u7528\u9884\u6d4b\u7f16\u7801\uff0c\u5229\u7528\u56fe\u50cf\u5df2\u7f16\u7801\u7684\u4e00\u90e8\u5206\u9884\u6d4b\u53e6\u4e00\u672a\u7f16\u7801\u90e8\u5206\uff0c\u7136\u540e\u5c06\u9884\u6d4b\u90e8\u5206\u7684\u539f\u56fe\u50cf\u6570\u636e\u51cf\u53bb\u9884\u6d4b\u51fa\u6765\u7684\u6570\u636e\uff0c\u5f97\u5230\u5dee\u503c(residual)\uff0c\u7136\u540e\u5bf9\u5dee\u503c\u8fdb\u884c\u7f16\u7801\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5dee\u503c\u6bd4\u539f\u6570\u636e\u5c0f\u5f97\u591a\uff0c\u53ef\u4ee5\u8fbe\u5230\u538b\u7f29\u7684\u76ee\u7684\u3002\u89e3\u7801\u7684\u65f6\u5019\uff0c\u5c06\u5dee\u503c\u548c\u9884\u6d4b\u503c\u6c42\u548c\uff0c\u5c31\u5f97\u5230\u4e86\u539f\u503c\u3002JPEG\u7f16\u7801\u7684\u662f\u539f\u503c\uff0c\u800cWEBP\u7f16\u7801\u7684\u662f\u5dee\u503c\uff0c\u8fd9\u662fWEBP\u6bd4JPEG\u540c\u6837\u56fe\u7247\u8d28\u91cf\uff0c\u4f53\u79ef\u66f4\u5c0f\u7684\u4e3b\u8981\u539f\u56e0\u3002</p> <p>\u4e0b\u9762\u6765\u770b\u770b\u5e27\u5185\u9884\u6d4b\uff0c\u5177\u4f53\u7ec6\u8282\u53ef\u4ee5\u5728The H.264 Advanced Video Compression Standard, Second Edition\u4e2d\u627e\u5230\u3002\u5e27\u5185\u9884\u6d4b\u5206\u4e3a\u4e24\u6b65\uff0c\u5b83\u4f1a\u5148\u627e\u5230\u5408\u9002\u7684\u5206\u5757\uff0c\u518d\u627e\u5230\u5206\u5757\u4e2d\u5408\u9002\u7684\u6a21\u5f0f\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u63cf\u8ff0\u56f4\u4e00\u5708\u7684\u591a\u79cd\u9884\u6d4b\u65b9\u6cd5\uff0c\u7528\u5de6\u4e00\u884c\u548c\u4e0a\u4e00\u884c\u8fdb\u884c4 x 4\u5206\u5757\u9884\u6d4b\u3002\u5bf9\u4e8e\u4eae\u5ea6\u53ef\u5206\u4e3a4 x 4 \u300116 x 16\u5b8f\u5757(macroblock)\u9884\u6d4b\uff0c4 x 4\u5757\u9884\u6d4b\u53eb\u505a4 \u00d7 4 Luma Prediction\uff0c16 x 16\u5757\u9884\u6d4b\u53eb\u505a16 \u00d7 16 Luma Prediction\u3002\u8272\u5ea6\u5206\u4e3a8 x 8\u5b8f\u5757(macroblock)\u9884\u6d4b\uff0c\u53eb\u505a8 \u00d7 8 Chroma Prediction\u3002</p> <p>\u4f7f\u7528\u54ea\u79cd\u5206\u5757\u9884\u6d4b\u662f\u7531\u89e3\u7801\u5668\u5728\u89e3\u7801\u65f6\u52a8\u6001\u51b3\u5b9a\u7684\u3002\u5206\u5757\u8d8a\u7cbe\u7ec6\uff0c\u9884\u6d4b\u7684\u8d8a\u51c6\uff0c\u9884\u6d4b\u540e\u7684\u5dee\u503c\u8d8a\u5c0f\u3002\u4f46\u662f\u5206\u5757\u8d8a\u7cbe\u7ec6\uff0c\u9700\u8981\u8bb0\u5f55\u5982\u4f55\u5206\u5757\u7684\u4fe1\u606f\u5c31\u8d8a\u591a\u3002\u6240\u4ee5\uff0c\u9009\u62e9\u54ea\u79cd\u5206\u5757\u9884\u6d4b\u662f\u5dee\u503c\u5927\u5c0f\u548c\u8bb0\u5f55\u5982\u4f55\u5206\u5757\u7684\u4fe1\u606f\u5927\u5c0f\u7684\u6743\u8861(trade-off)\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7ec6\u8282\u8d8a\u4e30\u5bcc\u7684\u5730\u65b9\u4f1a\u5206\u5757\u8d8a\u7ec6\uff0c\u5373\u4f7f\u75284 x 4\u5206\u5757\u9884\u6d4b\u3002\u7ec6\u8282\u76f8\u5bf9\u4e0d\u4e30\u5bcc\u7684\u5730\u65b9\u4f7f\u752816 x 16\u5206\u5757\u9884\u6d4b\u3002</p> <p>\u4e0d\u540c\u7684\u5206\u5757\u8fd8\u6709\u4e0d\u540c\u7684\u9884\u6d4b\u6a21\u5f0f\uff0c4 \u00d7 4 Luma Prediction\u67099\u79cd\u9884\u6d4b\u6a21\u5f0f\uff0c16 x 16 LumaPrediction\u67094\u79cd\u9884\u6d4b\u6a21\u5f0f\uff0c8 x 8 Chroma Prediction\u67094\u79cd\u9884\u6d4b\u6a21\u5f0f\u3002</p> <p>\u4e0d\u540c\u7684\u9884\u6d4b\u6a21\u5f0f\u7684\u601d\u60f3\u662f\u57fa\u4e8e\u89d2\u5ea6\u5e27\u5185\u9884\u6d4b(Angular Intra Prediction)\uff0c\u6216\u5c06\u88ab\u9884\u6d4b\u7684\u534a\u5706\u5212\u5206\u4e3a33\u4e2a\u89d2\u5ea6\uff0c\u4ece\u8fd9\u4e9b\u89d2\u5ea6\u6765\u9884\u6d4b\uff0c\u8fbe\u5230\u4e00\u79cd\u6e10\u53d8\u7684\u6548\u679c\u3002\u6216\u4ece\u5468\u56f4\u53d6\u5e73\u5747\u503c\u8fbe\u5230\u4e00\u79cd\u5e73\u9762\u7684\u6548\u679c\u3002\u4e0b\u56fe\u4e3a2-34\u517133\u4e2a\u89d2\u5ea6\u30010\u4e3aPlanar\u9884\u6d4b\u6a21\u5f0f\u30011\u4e3aDC\u9884\u6d4b\u6a21\u5f0f\u3002Planar\u9884\u6d4b\u6a21\u5f0f\u7684\u9884\u6d4b\u503c\u4e3a\u56db\u8fb9\u50cf\u7d20\u7684\u5747\u503c\u3002DC\u9884\u6d4b\u6a21\u5f0f\u7684\u9884\u6d4b\u503c\u4e3a\u5de6\u65b9\u548c\u4e0a\u65b9\u50cf\u7d20\u7684\u5747\u503c\u3002\u4e0d\u540c\u7684\u9884\u6d4b\u6a21\u5f0f\u5c31\u662f\u91c7\u7528\u67d0\u4e2a\u89d2\u5ea6\u6216\u5e73\u9762\u8fdb\u884c\u9884\u6d4b\u3002</p> <p></p> <p>4 \u00d7 4 Luma Prediction9\u79cd\u9884\u6d4b\u6a21\u5f0f\u5982\u4e0b\u56fe\uff0c\u5e26\u6709\u5b57\u6bcd\u4e3a\u5df2\u7f16\u7801\u5757\u7528\u6765\u9884\u6d4b\u5176\u4ed6\u5757\uff0c\u7070\u8272\u7684\u4e3a\u5f85\u9884\u6d4b\u5757\u3002</p> <p></p> <p>\u5bf9\u4e8e\u53ef\u80fd\u7684\u9884\u6d4b\u6a21\u5f0f\u90fd\u8981\u8ba1\u7b97\u51fa\u6765\uff0c\u7136\u540e\u8ba1\u7b97\u51fa\u6bcf\u79cd\u6a21\u5f0f\u7684SAE\uff0cSAE\u4e3a\u8861\u91cf\u9884\u6d4b\u7684\u9519\u8bef\u7a0b\u5ea6\uff0c\u6700\u540e\u9009\u7528\u9519\u8bef\u7a0b\u5ea6\u6700\u5c0f\u7684\u6a21\u5f0f\u3002\u4e0b\u56fe\u4e3a\u9884\u6d4b9\u79cd\u6a21\u5f0f\u540e\u6bd4\u8f83SAE\uff0c\u8089\u773c\u53ef\u4ee5\u770b\u51fa\u7b2c8\u79cd\u4e3a\u9884\u6d4b\u6700\u51c6\u786e\u7684\u6a21\u5f0f\uff0c\u5176SAE\u4e5f\u6700\u5c0f\u3002</p> <p></p> <p>WEBP\u7f16\u7801\u7b2c\u4e00\u6b65\u4e0eJPEG\u7f16\u7801\u4e00\u6837\uff0c\u8272\u5f69\u7a7a\u95f4\u8f6c\u6362\u3002\u7b2c\u4e8c\u6b65\u5c31\u662f\u5e27\u5185\u9884\u6d4b\u3002\u7b2c\u4e09\u6b65\u5bf9\u56fe\u50cf\u539f\u503c\u51cf\u53bb\u9884\u6d4b\u503c\u5f97\u5230\u7684\u5dee\u503c(residual)\u8fdb\u884cDCT\u3002\u7b2c\u56db\u6b65\u8fdb\u884c\u91cf\u5316\uff0cWebP\u91cf\u5316\u6bd4JPEG\u91cf\u5316\u66f4\u590d\u6742\uff0c\u53ef\u4ee5\u505a\u5230\u4e0d\u540c\u7684\u533a\u57df\uff0c\u8fdb\u884c\u4e0d\u540c\u7684\u91cf\u5316\u3002\u7b2c\u4e94\u6b65\u6e38\u7a0b\u7f16\u7801\u3002\u7b2c\u516d\u6b65\u7528\u7b97\u672f\u7f16\u7801Arithmetic coding\u4ee3\u66ffhuffman\u7f16\u7801\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#52-webp","title":"5.2. WEBP\u65e0\u635f\u7f16\u7801","text":"<p>WEBP\u65e0\u635f\u7f16\u7801\u4ecd\u662f\u57fa\u4e8e\u9884\u6d4b\u7f16\u7801\u548c\u51cf\u5c11\u7a7a\u95f4\u5197\u4f59\u6027\u3002</p> <p>1.Predictor Transform</p> <p>WEBP\u65e0\u635f\u7f16\u7801\u4f7f\u7528\u7684\u9884\u6d4b\u7f16\u7801\uff0c\u4e0e\u65e0\u635f\u7f16\u7801\u57fa\u4e8eVP8\u7684\u5e27\u5185\u9884\u6d4b\u4e0d\u540c\uff0c\u65e0\u635f\u7f16\u7801\u7684\u9884\u6d4b\u7f16\u7801\u5bf9\u4e00\u4e2a\u5757\u8fdb\u884c\u9884\u6d4b\u3002\u5e76\u4e14\u670914\u79cd\u4e0d\u540c\u7684\u6a21\u5f0f\u3002\u5047\u8bbe\uff0cP\u4e3a\u9884\u6d4b\u70b9\uff0cO\u3001TL\u3001T\u3001TR\u3001L\u4e3a\u5df2\u7f16\u7801\u70b9\uff0cX\u4e3a\u672a\u7f16\u7801\u70b9\uff0cTL\u4ee3\u8868Top-Left\uff0cTR\u4ee3\u8868Top-Right\u3002</p> <pre><code>\u9884\u6d4b\u5757P\u4f4d\u7f6e\u793a\u610f\u56fe\nO    O    O    O    O    O    O    O    O    O    O\nO    O    O    O    O    O    O    O    O    O    O\nO    O    O    O    TL   T    TR   O    O    O    O\nO    O    O    O    L    P    X    X    X    X    X\nX    X    X    X    X    X    X    X    X    X    X\nX    X    X    X    X    X    X    X    X    X    X\n\u6a21\u5f0f \u9884\u6d4b\u503c\n0 0xff000000\n1 L\n2  T\n3  TR\n4 TL\n5 Average2(Average2(L, TR), T)\n6   Average2(L, TL)\n7    Average2(L, T)\n8 Average2(TL, T)\n9    Average2(T, TR)\n10   Average2(Average2(L, TL), Average2(T, TR))\n11    Select(L, T, TL)\n12  ClampAddSubtractFull(L, T, TL)\n13    ClampAddSubtractHalf(Average2(L, T), TL)\n</code></pre> <p>\u6700\u540e\u4ecd\u5bf9\u771f\u5b9e\u503c\u548c\u9884\u6d4b\u503c\u7684\u5dee\u503c\u8fdb\u884c\u7f16\u7801\u3002</p> <p>2.Color Transform</p> <p>\u6b64\u6b65\u4e3a\u4e0b\u4e00\u6b65\u505a\u51c6\u5907\uff0c\u76ee\u7684\u662f\u51cf\u5c11\u7a7a\u95f4\u5197\u4f59\u6027\u3002JPEG\u548cPNG\u90fd\u662f\u51cf\u5c11\u50cf\u7d20\u95f4\u7684\u76f8\u5173\u6027\uff0cWEBP\u4ece\u50cf\u7d20\u5185\u90e8\u7740\u624b\u3002\u5c06\u50cf\u7d20Green\u989c\u8272\u503c\u4fdd\u7559\uff0cRed\u989c\u8272\u503c\u8f6c\u53d8\u4e3a\u4eceGreen\u503c\u8868\u8fbe\uff0cBlue\u989c\u8272\u503c\u4eceGreen\u989c\u8272\u548cRed\u989c\u8272\u503c\u8868\u8fbe\u3002</p> <p>3.Subtract Green Transform</p> <p>\u53bb\u6389Red\u989c\u8272\u503c\u4e2dGreen\u989c\u8272\u503c\u8868\u8fbe\u7684\u90e8\u5206\uff0c\u53bb\u6389Blue\u989c\u8272\u503c\u4e2dGreen\u989c\u8272\u503c\u8868\u8fbe\u7684\u90e8\u5206\u3002</p> <p>4.Color Indexing Transform</p> <p>\u5982\u679c\u6574\u5f20\u56fe\u7247\u50cf\u7d20\u7684\u989c\u8272\u503c\u6ca1\u6709\u8d85\u8fc7256\u4e2a\uff0c\u5219\u5efa\u7acb\u7c7b\u4f3c\u8c03\u8272\u677f\u4e00\u6837\u7684\u6570\u7ec4\u6765\u6620\u5c04\u989c\u8272\u3002\u50cf\u7d20\u5b58\u50a8\u7d22\u5f15\u5c31\u53ef\u4ee5\u3002</p> <p>5.Compression</p> <p>\u6bcf\u4e2a\u50cf\u7d20\u53ef\u4ee5\u75283\u4e2d\u4e0d\u540c\u7684\u65b9\u6cd5\u8fdb\u884c\u538b\u7f29\uff0cHuffman\u7f16\u7801(Huffman Coded Literals)\u3001LZ77\u540e\u5411\u5f15\u7528(LZ77 Backward Reference)\u3001\u989c\u8272\u7f13\u5b58\u7f16\u7801(Color Cache Code)\u3002\u5927\u90e8\u5206\u4ee3\u7801\u7528Huffman\u8fdb\u884c\u7f16\u7801\u3002\u800c\u5982\u679c\u9047\u5230\u4e86\u91cd\u590d\u7684\u5e8f\u5217\uff0c\u5c31\u4f1a\u4f7f\u7528LZ77\u540e\u5411\u5f15\u7528\u3002LZ77\u540e\u5411\u5f15\u7528\uff0c\u6307\u7684\u662f\u524d\u9762\u51fa\u73b0\u8fc7\u4e86\u76f8\u540c\u7684\u5e8f\u5217\uff0c\u540e\u9762\u7684\u91cd\u590d\u5e8f\u5217\u6539\u4e3a\u524d\u9762\u76f8\u540c\u5e8f\u5217\u4f4d\u7f6e\u7684\u5f15\u7528\u5373\u53ef\uff0c\u5f15\u7528\u7684\u65b9\u5f0f\u6309LZ77\u524d\u7f00\u7f16\u7801\u3002\u5f15\u7528\u5206\u4e3aLength\u548cDistance\u4e24\u90e8\u5206\uff0cLength\u4ee3\u8868\u5e8f\u5217\u7684\u957f\u5ea6\uff0cDistance\u4ee3\u8868\u524d\u9762\u5e8f\u5217\u7684\u4f4d\u7f6e\u3002\u989c\u8272\u7f13\u5b58\u7f16\u7801\u662f\u5728\u7f16\u7801\u548c\u89e3\u7801\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u7f13\u5b58\uff0c\u5c06\u6700\u8fd1\u7528\u8fc7\u7684\u989c\u8272\u7f13\u5b58\u5728\u4e00\u4e2a\u6570\u7ec4\u4e2d\uff0c\u968f\u7740\u626b\u63cf\u65b0\u7684\u50cf\u7d20\u7f13\u5b58\u4f1a\u4e0d\u65ad\u66f4\u65b0\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#53-webp","title":"5.3. WEBP\u6587\u4ef6\u683c\u5f0f","text":"<p>WEBP\u6587\u4ef6\u683c\u5f0f\u662f\u53c2\u7167RIFF(\u8d44\u6e90\u4ea4\u6362\u6863\u6848\u683c\u5f0f)\u6765\u5b58\u50a8\u7684\uff0cWEBP\u6587\u4ef6\u5f00\u5934\u662f\u56db\u5b57\u8282\u7684RIFF\u7684ASCII\u7801\u3001\u56db\u5b57\u8282\u7684\u6587\u4ef6\u5927\u5c0f\u3001\u56db\u5b57\u8282\u7684WEBP\u7684ASCII\u7801\u3002\u6587\u4ef6\u6784\u6210\u7684\u57fa\u672c\u5355\u4f4d\u548cPNG\u4e00\u81f4\u662fChunk\u3002</p> <p>chunk\u7ed3\u6784\u5982\u4e0b</p> <pre><code>typedef struct {\nunsigned int fourCC;   unsigned int size;\nunsigned char *payLoad;\n}Chunk;\n</code></pre> <p>FourCC\u4ee3\u8868chunk\u6807\u8bc6\u7684ASCII\u7801\u3002Size\u4ee3\u8868\u9664Size\u5b57\u6bb5\u7684\u957f\u5ea6\u3002PayLoad\u4ee3\u8868\u6570\u636e\u3002</p> <p>VP8X</p> <p>\u7d27\u63a5\u7740WEBP\u6587\u4ef6\u6807\u8bc6\u7b26\u7684\u662f\u62d3\u5c55Chunk VP8X(Extended)</p> <pre><code>typedef struct {\nunsigned char combine;  unsigned short reserved_first; unsigned char reserved_second; unsigned short canvas_width_minus_one_first;  unsigned char canvas_width_minus_one_second;  unsigned short canvas_height_minus_one_first;  unsigned char canvas_height_minus_one_second;  }VP8X;\n</code></pre> <p>VP8X\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f\u4e2a\u5408\u5e76\u5b57\u8282\uff0c\u8fd9\u4e2a\u5408\u5e76\u5b57\u8282\u7684\u9996\u4e24\u4f4d\u548c\u6700\u540e\u4e00\u4f4d\u4e3a\u4fdd\u7559\u4f4d\uff0c\u4e2d\u95f45\u4f4d\uff0c\u6bcf\u4f4d\u6807\u8bc6\u662f\u5426\u6709\u76f8\u5173\u7684Chunk\uff0c\u5206\u522b\u4e3aICC\u3001Alpha\u3001EXIF\u3001XMP\u3001Animation\u3002\u540e\u9762\u7684Reserve\u3001Canvas_Width_Minus_One\u3001Canvas_Height_Minus_One\u90fd\u662f\u4e24\u4e2a\u5b57\u6bb5\u7ec4\u5408\u6210\u4e00\u4e2a24\u4f4d\u5b57\u6bb5\u3002</p> <p>VP8\u548cVP8L</p> <p>\u6709\u635f\u7f16\u7801\u7684\u6570\u636eChunk\u4e3aVP8\uff0c\u6309\u7167VP8\u7684\u6807\u51c6\u7f16\u7801\u3002\u65e0\u635f\u7f16\u7801\u7684\u6570\u636eChunk\u4e3aVP8L\u3002</p> <p>ANIM</p> <p>ANIM\u4e3a\u63a7\u5236\u52a8\u753b\u7684Chunk\uff0cbackground_color\u4ee3\u8868\u753b\u5e03\u9ed8\u8ba4\u989c\u8272\uff0cloop_count\u4ee3\u8868\u52a8\u753b\u5faa\u73af\u6b21\u6570\uff0c\u7ed3\u6784\u5982\u4e0b</p> <pre><code>typedef struct {\nunsigned int background_color;\nunsigned short loop_count;\n}ANIM;\n</code></pre> <p>ANMF</p> <p>ANMF\u4e3a\u6bcf\u4e00\u5e27\u7684\u5934\u90e8Chunk\uff0c\u7ed3\u6784\u5982\u4e0b</p> <pre><code>typedef struct {\nunsigned short frame_x_first;\nunsigned char frame_x_second;\nunsigned short frame_y_first;\nunsigned char frame_y_second;\nunsigned short frame_width_minus_one_first;\nunsigned char frame_width_minus_one_second;\nunsigned short frame_height_minus_one_first;\nunsigned char frame_height_minus_one_second;\nunsigned short frame_duration_first;\nunsigned char frame_duration_second;\nunsigned char combine;  unsigned char *frame_data;\n}ANMF;\n</code></pre> <p>\u7ed3\u6784\u7684\u524d10\u4e2a\u5b57\u6bb5\u90fd\u662f\u4e24\u4e24\u7ec4\u5408\u621024\u4f4d\u5b57\u6bb5\u3002\u5206\u522b\u4e3a\u5e27\u8d77\u59cbx\u5750\u6807\u3001\u5e27\u8d77\u59cby\u5750\u6807\u3001\u5e27\u5bbd\u51cf\u4e00\u3001\u5e27\u9ad8\u51cf\u4e00\u3001\u5e27\u5c55\u793a\u65f6\u957f\u3002combine\u5b57\u6bb5\u524d6\u4f4d\u4e3a\u4fdd\u7559\u4f4d\uff0c\u540e\u4e00\u4f4d\u4e3ablending method\u4f4d\uff0c\u6700\u540e\u4e00\u4f4d\u4e3adisposal _method\u4f4d\u3002blending method\u503c\u4e3a0\uff0c\u5219\u4e0dalpha_blend\uff0c\u4e3a1\uff0c\u5219alpha_blend\uff0c\u8fd9\u4e0eAPNG\u4e00\u81f4\u3002disposal_method\u503c\u4e3a0\uff0c\u5219\u4e0d\u505a\u5904\u7406\uff0c\u4e3a1\uff0c\u5219\u5c06\u753b\u5e03\u6e05\u7a7a\u4e3a\u900f\u660e\u9ed1\u8272\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#6-bpg","title":"6. BPG","text":"<p>BPG\u4ecd\u662f\u4e00\u4e2a\u5e74\u8f7b\u7684\u56fe\u7247\u6587\u4ef6\u683c\u5f0f\uff0c\u57282014\u5e74\u88ab\u5f00\u53d1\u51fa\u6765\uff0c\u57fa\u4e8eHEVC\u89c6\u9891\u7f16\u7801\u6807\u51c6\u3002\u538b\u7f29\u6548\u679c\u76f8\u5f53\u60ca\u4eba\u3002\u5199\u672c\u6587\u7684\u65f6\u5019\u4ecd\u7136\u662f0.97\u7248\u672c\u53d1\u5e03\uff0c\u8fd8\u6ca1\u6709\u8fdb\u5165\u6b63\u5f0f\u7248\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#7","title":"7. \u7ed3\u8bed","text":"<p>\u4e86\u89e3\u4e86\u5404\u79cd\u56fe\u7247\u7684\u7f16\u7801\u683c\u5f0f\u540e\uff0c\u4e0d\u540c\u56fe\u7247\u683c\u5f0f\u7684\u4f18\u52a3\u5c31\u5f88\u597d\u7406\u89e3\u4e86\u3002\u4e00\u822c\u6765\u8bf4JPEG\u6bd4PNG\u538b\u7f29\u7a0b\u5ea6\u66f4\u5927\uff0c\u6587\u4ef6\u4f53\u79ef\u66f4\u5c0f\u3002\u56fe\u7247\u8272\u5f69\u8d8a\u590d\u6742\uff0c\u56fe\u7247\u4fe1\u606f\u8d8a\u591a\uff0c\u56fe\u7247\u4fe1\u53f7\u9ad8\u9891\u6bb5\u8d8a\u5c11\uff0cJPEG\u7684\u6709\u635f\u7f16\u7801\u635f\u5931\u8d8a\u5c11\u3002\u5bf9\u4e8e\u8272\u5f69\u590d\u6742\u7684\u56fe\u7247JPEG\u76f8\u6bd4PNG\u662f\u8f83\u597d\u7684\u9009\u62e9\u3002\u5bf9\u4e8e\u8272\u5f69\u5355\u4e00\u7684\u56fe\u7247\uff0cJPEG\u6709\u635f\u7f16\u7801\u540e\uff0c\u56fe\u7247\u9ad8\u9891\u6bb5\u5927\u91cf\u88ab\u4e22\u5f03\uff0c\u5bfc\u81f4\u56fe\u7247\u8d28\u91cf\u5f88\u5dee\uff0c\u8fd9\u79cd\u60c5\u51b5PNG\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002WEBP\u663e\u7136\u4f1a\u6bd4JPEG\u4f53\u79ef\u66f4\u5c0f\uff0c\u7f16\u7801\u65f6\u95f4\u66f4\u957f\uff0c\u4f46\u957f\u7684\u65f6\u95f4\u76f8\u5bf9\u4e8e\u4f20\u8f93\u65f6\u95f4\u53ef\u4ee5\u63a5\u53d7\u3002WEBP\u6bd4PNG\u4f53\u79ef\u66f4\u5c0f\uff0c\u8272\u5f69\u5355\u4e00\u7684\u60c5\u51b5\u4e0b\uff0c\u89e3\u7801\u65f6\u95f4\u6bd4PNG\u66f4\u77ed\uff0c\u8272\u5f69\u590d\u6742\u7684\u60c5\u51b5\u4e0b\uff0c\u89e3\u7801\u65f6\u95f4\u6bd4PNG\u66f4\u957f\u3002BPG\u56fe\u7247\u7684\u6587\u4ef6\u4f53\u79ef\u662f\u73b0\u9636\u6bb5\u56fe\u7247\u683c\u5f0f\u4e2d\u6700\u5c0f\u7684\uff0c\u89e3\u7801\u65f6\u95f4\u4e5f\u662f\u6700\u957f\u7684\u3002\u56e0\u4e3aBPG\u73b0\u5728\u652f\u6301\u60c5\u51b5\u4e0d\u592a\u7406\u60f3\uff0c\u800c\u4e14\u4e13\u5229\u4e5f\u662f\u5934\u75bc\u7684\u95ee\u9898\uff0cBPG\u7684\u672a\u6765\u5c1a\u4e0d\u660e\u6717\u3002\u5982\u679c\u8bf4\u60f3\u5c1d\u8bd5\u65b0\u7684\u56fe\u7247\u683c\u5f0f\u6765\u4f18\u5316\u6027\u80fd\uff0cWEBP\u662f\u5f88\u5b8c\u7f8e\u7684\u9009\u62e9\u3002BPG\u7684\u6210\u672c\u4f1a\u5927\u4e00\u4e9b\u3002</p> <p>\u4f60\u6211\u7684\u56fe\u7247\u4e4b\u65c5\u8fce\u6765\u4e86\u5c3e\u58f0\uff0c\u65b0\u7684\u56fe\u7247\u683c\u5f0f\u5728\u65e7\u7684\u56fe\u7247\u683c\u5f0f\u6216\u89c6\u9891\u683c\u5f0f\u57fa\u7840\u4e0a\u6d8c\u73b0\u51fa\u6765\u3002</p> <p>\u51e0\u5341\u5e74\u95f4\uff0c\u4eba\u4eec\u4e0d\u505c\u5bf9\u66f4\u9ad8\u6548\u7684\u7b97\u6cd5\u8fdb\u884c\u63a2\u7d22\uff0c\u51e0\u5341\u5e74\u540e\uff0c\u4ecd\u7136\u4f1a\u8fd9\u6837\u3002</p> <p>\u4eba\u7c7b\uff0c\u5c31\u662f\u8fd9\u4e48\u8fdb\u6b65\u8fc7\u6765\u7684\u3002</p>"},{"location":"perf-opt/Android/bitmap/imge-format/#_2","title":"\u53c2\u8003","text":"<p>\u6458\u81eahttp://blog.mrriddler.com/2016/07/20/%E5%9B%BE%E7%89%87%E4%B9%8B%E6%97%85/</p>"},{"location":"perf-opt/Android/command/dumpsys/","title":"dumpsys","text":"<p><code>dumpsys</code>\u547d\u4ee4\u529f\u80fd\u5f88\u5f3a\u5927,\u53ef\u4ee5\u83b7\u53d6\u8bbe\u5907\u4e0a\u8fd0\u884c\u7684\u6240\u6709\u7cfb\u7edf\u670d\u52a1\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u5982\u67e5\u770b\u5185\u5b58\u5360\u7528\u60c5\u51b5\u3001\u5e27\u7387\u4fe1\u606f\u3001\u6536\u96c6\u7f51\u7edc\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\u7b49\u7b49\u3002</p>"},{"location":"perf-opt/Android/command/dumpsys/#_1","title":"\u8bed\u6cd5","text":"<p>\u4f7f\u7528 dumpsys \u7684\u4e00\u822c\u8bed\u6cd5\u5982\u4e0b\uff1a <pre><code> adb shell dumpsys service [arguments]\n</code></pre> \u4f8b\u5982\uff1a\u67e5\u770b\u5305\u540d\u4e3a<code>com.xx.xx</code>\u7684\u5185\u5b58\u60c5\u51b5</p> <pre><code>adb shell dumpsys meminfo com.xx.xx\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u4efb\u4e00\u547d\u4ee4\u67e5\u770b\u4e0e <code>dumpsys</code> \u914d\u5408\u4f7f\u7528\u7684\u7cfb\u7edf\u670d\u52a1\u7684\u5b8c\u6574\u5217\u8868</p> <pre><code>adb shell dumpsys -l\nadb shell service list\n</code></pre>"},{"location":"perf-opt/Android/command/dumpsys/#_2","title":"\u7cfb\u7edf\u670d\u52a1","text":"\u670d\u52a1\u540d \u529f\u80fd activity AMS\u76f8\u5173\u4fe1\u606f package PMS\u76f8\u5173\u4fe1\u606f window WMS\u76f8\u5173\u4fe1\u606f processinfo \u8fdb\u7a0b\u670d\u52a1 procstats \u8fdb\u7a0b\u7edf\u8ba1 cpuinfo CPU meminfo \u5185\u5b58 gfxinfo \u56fe\u50cf SurfaceFlinger \u56fe\u50cf\u76f8\u5173 input IMS\u76f8\u5173\u4fe1\u606f power PMS\u76f8\u5173\u4fe1\u606f batterystats \u7535\u6c60\u7edf\u8ba1\u4fe1\u606f battery \u7535\u6c60\u4fe1\u606f alarm \u95f9\u949f\u4fe1\u606f dropbox \u8c03\u8bd5\u76f8\u5173 dbinfo \u6570\u636e\u5e93 appops app\u4f7f\u7528\u60c5\u51b5 permission \u6743\u9650 batteryproperties \u7535\u6c60\u76f8\u5173 audio \u67e5\u770b\u58f0\u97f3\u4fe1\u606f netstats \u67e5\u770b\u7f51\u7edc\u7edf\u8ba1\u4fe1\u606f diskstats \u67e5\u770b\u7a7a\u95f4free\u72b6\u6001 jobscheduler \u67e5\u770b\u4efb\u52a1\u8ba1\u5212 wifi wifi\u4fe1\u606f diskstats \u78c1\u76d8\u60c5\u51b5 usagestats \u7528\u6237\u4f7f\u7528\u60c5\u51b5 devicestoragemonitor \u8bbe\u5907\u4fe1\u606f \u2026 \u2026"},{"location":"perf-opt/Android/command/meminfo%E5%91%BD%E4%BB%A4/","title":"meminfo\u547d\u4ee4","text":"<p>\u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5</p>"},{"location":"perf-opt/Android/command/meminfo%E5%91%BD%E4%BB%A4/#_1","title":"\u8bed\u6cd5","text":"<pre><code>[adb shell] dumpsys meminfo package_name|pid </code></pre>"},{"location":"perf-opt/Android/command/meminfo%E5%91%BD%E4%BB%A4/#_2","title":"\u8f93\u51fa\u5982\u4e0b","text":"<pre><code>Applications Memory Usage (in Kilobytes):\nUptime: 103140608 Realtime: 103140608\n** MEMINFO in pid 14533 [package_name] **\n                   Pss  Private  Private  SwapPss      Rss     Heap     Heap     Heap\n                 Total    Dirty    Clean    Dirty    Total     Size    Alloc     Free\n                ------   ------   ------   ------   ------   ------   ------   ------\n  Native Heap    94226    94144        0     2485    94396   112740    89386    13924\nDalvik Heap    98179    98096        0      312    98392    92380    43228    49152\nDalvik Other    17886    13624        0       56    22248\nStack     4736     4736        0      450     4740\nAshmem      182      180        0        0      196\nGfx dev    39520    38224     1296        0    39520\nOther dev      169        0      168        0      396\n.so mmap    34230     3280    27940      272    39776\n.jar mmap     2616        0      524        0    20780\n.apk mmap    18513      208    13484        0    36812\n.ttf mmap      869        0      812        0      980\n.dex mmap    59773       20    59372       24    60168\n.oat mmap      442        0      212        0      840\n.art mmap     8749     7752       92     1849    11856\nOther mmap     4105      380     3336        1     5308\nEGL mtrack    27744    27744        0        0    27744\nGL mtrack    25240    25240        0        0    25240\nUnknown     5250     5200        0       40     5364\nTOTAL   447918   318828   107236     5489   447918   205120   132614    63076\nApp Summary\n                       Pss(KB)                        Rss(KB)\n------                         ------\n           Java Heap:   105940                         110248\nNative Heap:    94144                          94396\nCode:   105920                         167936\nStack:     4736                           4740\nGraphics:    92504                          92504\nPrivate Other:    22820\nSystem:    21854\nUnknown:                                   24932\nTOTAL PSS:   447918            TOTAL RSS:   494756       TOTAL SWAP PSS:     5489\nObjects\n               Views:     1510         ViewRootImpl:        1\nAppContexts:       11           Activities:        1\nAssets:       27        AssetManagers:        0\nLocal Binders:      130        Proxy Binders:       51\nParcel memory:       51         Parcel count:      206\nDeath Recipients:        4      OpenSSL Sockets:       12\nWebViews:        2\nSQL\n         MEMORY_USED:      803\nPAGECACHE_OVERFLOW:      248          MALLOC_SIZE:      117\nDATABASES\n      pgsz     dbsz   Lookaside(b)          cache  Dbname\n         4       84            100     4055/41/18  /data/user/0/com.yy.hiyo/databases/xxxx.db\n         4       20             95     1235/497/8  /data/user/0/com.yy.hiyo/databases/xxxx.db\n         4       32             31         1/30/2  /data/user/0/com.yy.hiyo/databases/com.google.android.datatransport.events\n         4      112            100       54/44/21  /data/user/0/com.yy.hiyo/databases/xxxx.db\n</code></pre>"},{"location":"perf-opt/Android/command/meminfo%E5%91%BD%E4%BB%A4/#_3","title":"\u8f93\u51fa\u8bf4\u660e","text":""},{"location":"perf-opt/Android/command/meminfo%E5%91%BD%E4%BB%A4/#_4","title":"\u5185\u5b58\u6307\u6807\u6982\u5ff5","text":"item \u5168\u79f0 \u542b\u4e49 \u7b49\u4ef7 USS Unique Set Size \u7269\u7406\u5185\u5b58 \u8fdb\u7a0b\u72ec\u5360\u7684\u5185\u5b58 PSS Proportional Set Size \u7269\u7406\u5185\u5b58 PSS= USS+ \u6309\u6bd4\u4f8b\u5305\u542b\u5171\u4eab\u5e93 RSS Resident Set Size \u7269\u7406\u5185\u5b58 RSS= USS+ \u5305\u542b\u5171\u4eab\u5e93 VSS Virtual Set Size \u865a\u62df\u5185\u5b58 VSS= RSS+ \u672a\u5206\u914d\u5b9e\u9645\u7269\u7406\u5185\u5b58 Dirty Clean <ul> <li>MEMINFO\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 829 total \u5171\u6709829\u4e2a\u8fdb\u7a0b 1 running \u5904\u4e8e\u8fd0\u884c\u4e2d\u7684\u67091\u4e2a 828 sleeping 828\u4e2a\u5728\u4f11\u7720\uff08sleep\uff09 0 stopped stoped\u72b6\u6001\u7684\u67090\u4e2a 0 zombie zombie\u72b6\u6001\uff08\u50f5\u5c38\uff09\u7684\u67090\u4e2a <ul> <li>App Summary\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 3665268K total \u7269\u7406\u5185\u5b58\u603b\u91cf\uff08\u7ea63.5GB) 3060140K used \u4f7f\u7528\u4e2d\u7684\u5185\u5b58\u603b\u91cf\uff08\u7ea611.7GB\uff09 605128K free \u7a7a\u95f2\u5185\u5b58\u603b\u91cf\uff08\u7ea6590M\uff09 1585152 buffers \u7f13\u5b58\u7684\u5185\u5b58\u91cf\uff08\u7ea61.5GB\uff09 <ul> <li>Objects\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 2097148K total \u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea62GB\uff09 622800K used \u4f7f\u7528\u7684\u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea6608M\uff09 1474348K free \u7a7a\u95f2\u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea61.4GB\uff09 1160664K cached \u7f13\u51b2\u7684\u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea61.1GB\uff09 <ul> <li>SQL\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 800%cpu CPU\u603b\u91cf 11%user \u7528\u6237\u7a7a\u95f4\u5360\u7528CPU\u7684\u767e\u5206\u6bd4(\u4e0d\u5305\u542bnice\u503c\u4e3a\u8d1f\u7684\u8fdb\u7a0b) 0%nice \u6539\u53d8\u8fc7\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u5360\u7528CPU\u7684\u767e\u5206\u6bd4(nice\u503c\u4e3a\u8d1f\u7684\u8fdb\u7a0b) 13%sys \u5185\u6838\u7a7a\u95f4\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 771%idle \u7a7a\u95f2CPU\u767e\u5206\u6bd4 0%iow IO\u7b49\u5f85\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 2%irq \u786c\u4e2d\u65ad\uff08Hardware IRQ\uff09\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 1%sirq \u8f6f\u4e2d\u65ad\uff08Software Interrupts\uff09\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 0%host \uff1f <ul> <li> <p>DATABASES\uff1a</p> \u5c55\u793a\u9879 \u8bf4\u660e PID \u8fdb\u7a0bid USER \u8fdb\u7a0b\u6240\u6709\u8005 PR \u8fdb\u7a0b\u4f18\u5148\u7ea7 NI nice\u503c\u3002\u8d1f\u503c\u8868\u793a\u9ad8\u4f18\u5148\u7ea7\uff0c\u6b63\u503c\u8868\u793a\u4f4e\u4f18\u5148\u7ea7 VIRT \u8fdb\u7a0b\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u603b\u91cf\u3002VIRT=SWAP+RES RES \u7a0b\u4f7f\u7528\u7684\u3001\u672a\u88ab\u6362\u51fa\u7684\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0cRES=CODE+DATA SHR \u5171\u4eab\u5185\u5b58\u5927\u5c0f S \u8fdb\u7a0b\u72b6\u6001\u3002D=\u4e0d\u53ef\u4e2d\u65ad\u7684\u7761\u7720\u72b6\u6001 R=\u8fd0\u884c S=\u7761\u7720 T=\u8ddf\u8e2a/\u505c\u6b62 Z=\u50f5\u5c38\u8fdb\u7a0b %CPU \u4e0a\u6b21\u66f4\u65b0\u5230\u73b0\u5728\u7684CPU\u65f6\u95f4\u5360\u7528\u767e\u5206\u6bd4 %MEM \u8fdb\u7a0b\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\u767e\u5206\u6bd4 TIME+ ARGS \u8fdb\u7a0b\u4f7f\u7528\u7684CPU\u65f6\u95f4\u603b\u8ba1\u548c\u8fdb\u7a0b\u540d </li> </ul>"},{"location":"perf-opt/Android/command/top/","title":"top\u547d\u4ee4","text":"<p>top\u547d\u4ee4\u662fLinux\u4e0b\u5e38\u7528\u7684\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u80fd\u591f\u5b9e\u65f6\u663e\u793a\u7cfb\u7edf\u4e2d\u5404\u4e2a\u8fdb\u7a0b\u7684\u8d44\u6e90\u5360\u7528\u72b6\u51b5\uff0c\u5305\u62ec\u8fdb\u7a0bID\u3001\u5185\u5b58\u5360\u7528\u7387\u3001CPU\u5360\u7528\u7387\u7b49,\u7c7b\u4f3c\u4e8eWindows\u7684\u4efb\u52a1\u7ba1\u7406\u5668\u3002top\u547d\u4ee4\u63d0\u4f9b\u4e86\u5b9e\u65f6\u7684\u5bf9\u7cfb\u7edf\u5904\u7406\u5668\u7684\u72b6\u6001\u76d1\u89c6.\u5b83\u5c06\u663e\u793a\u7cfb\u7edf\u4e2dCPU\u6700\u201c\u654f\u611f\u201d\u7684\u4efb\u52a1\u5217\u8868.\u8be5\u547d\u4ee4\u53ef\u4ee5\u6309CPU\u4f7f\u7528.\u5185\u5b58\u4f7f\u7528\u548c\u6267\u884c\u65f6\u95f4\u5bf9\u4efb\u52a1\u8fdb\u884c\u6392\u5e8f\u3002\u5728Android\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>adb shell</code>\u6765\u6267\u884clinux\u76f8\u5173\u547d\u4ee4\u3002</p> <p>Android \u63d0\u4f9b\u4e86\u5927\u591a\u6570\u5e38\u89c1\u7684 Unix \u547d\u4ee4\u884c\u5de5\u5177\u3002\u5982\u9700\u67e5\u770b\u53ef\u7528\u5de5\u5177\u7684\u5217\u8868\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4: <pre><code>adb shell ls /system/bin\n</code></pre></p>"},{"location":"perf-opt/Android/command/top/#_1","title":"\u8bed\u6cd5","text":"<pre><code>[adb shell] top [option]\n</code></pre>"},{"location":"perf-opt/Android/command/top/#_2","title":"\u5168\u5c40\u9009\u9879","text":"\u5168\u5c40\u9009\u9879 \u8bf4\u660e -h/--help \u663e\u793a\u5e2e\u52a9\u6d88\u606f\u3002"},{"location":"perf-opt/Android/command/top/#_3","title":"\u547d\u4ee4\u548c\u547d\u4ee4\u9009\u9879","text":"\u9009\u9879 \u8bf4\u660e -b \u6279\u5904\u7406 -H \u663e\u793a\u7ebf\u7a0b\u4fe1\u606f -k -field.. \u4fee\u6539\u9ed8\u8ba4\u6392\u5e8f\u5b57\u6bb5 \uff08\u9ed8\u8ba4\u662f-S,-%CPU,-ETIME,-PID\uff09 -o field.. \u4fee\u6539\u5c55\u793a\u5b57\u6bb5 \uff08\u9ed8\u8ba4\u662fPID,USER,PR,NI,VIRT,RES,SHR,S,%CPU,%MEM,TIME+,CMDLINE\uff09 -d n \u8bbe\u7f6en\u79d2\u66f4\u65b0\u4e00\u6b21\u4fe1\u606f\uff0c\u9ed8\u8ba4\u662f3\u79d2 -p pid \u663e\u793a\u6307\u5b9apid\u7684\u8fdb\u7a0b\u4fe1\u606f -m n \u53ea\u663e\u793an\u4e2a\u4efb\u52a1\u4fe1\u606f -u user \u6307\u5b9a\u7528\u6237\u540duser -n m \u5faa\u73af\u663e\u793am\u6b21"},{"location":"perf-opt/Android/command/top/#_4","title":"\u547d\u4ee4\u8f93\u51fa\u8bf4\u660e","text":""},{"location":"perf-opt/Android/command/top/#_5","title":"\u547d\u4ee4","text":"<pre><code>top\n</code></pre>"},{"location":"perf-opt/Android/command/top/#_6","title":"\u8f93\u51fa","text":"<pre><code>Tasks: 829 total,   1 running, 828 sleeping,   0 stopped,   0 zombie\n  Mem:  3665268K total,  3060140K used,   605128K free,   1585152 buffers\n Swap:  2097148K total,   622800K used,  1474348K free,  1160664K cached\n800%cpu  11%user   0%nice  13%sys 771%idle   0%iow   2%irq   1%sirq   0%host\n   PID USER         PR  NI VIRT  RES  SHR S[%CPU] %MEM     TIME+ ARGS\n   679 system       -3  -8  11G  13M 8.2M S  8.3   0.3   7:13.28 surfaceflinger\n  2801 u0_a197      20   0  13G  57M  36M S  6.6   1.5   2:56.09 com.breel.wall+\n 28115 shell        20   0  10G 3.5M 1.8M R  3.6   0.1   0:45.73 top\n   681 system       -3  -8  10G 3.9M 2.8M S  3.0   0.1   2:12.51 android.hardwa+\n 28686 root         20   0    0    0    0 S  1.6   0.0   0:00.57 [kworker/u16:1]\n28388 root         20   0    0    0    0 S  1.0   0.0   0:08.10 [kworker/u16:8]\n18994 u0_a159      10 -10  47G 170M 107M S  1.0   4.7   0:27.44 com.google.and+\n  1696 system       18  -2  16G 370M 278M S  1.0  10.3   5:16.30 system_server\n   312 root         RT   0    0    0    0 S  1.0   0.0   0:54.34 [crtc_commit:1+\n  3002 radio        20   0  14G  73M  43M S  0.6   2.0   0:26.95 com.android.ph+\n    10 root         20   0    0    0    0 S  0.6   0.0   0:11.32 [rcuop/0]\n28236 u0_a195      20   0  15G 107M  61M S  0.3   2.9   0:02.06 com.google.and+\n 27789 root         20   0    0    0    0 S  0.3   0.0   0:02.76 [kworker/3:0]\n1218 wifi         20   0  10G 2.7M 2.0M S  0.3   0.0   0:02.35 wificond\n  1032 wifi         20   0  10G  10M 1.9M S  0.3   0.2   0:28.13 vendor.google.+\n   651 root         RT   0    0    0    0 S  0.3   0.0   0:21.95 [sugov:0]\n264 root         -3   0    0    0    0 S  0.3   0.0   0:18.47 [kgsl_worker_t+\n    53 root         20   0    0    0    0 S  0.3   0.0   0:02.24 [rcuop/5]\n45 root         20   0    0    0    0 S  0.3   0.0   0:04.84 [rcuop/4]\n29 root         20   0    0    0    0 S  0.3   0.0   0:05.73 [rcuop/2]\n</code></pre>"},{"location":"perf-opt/Android/command/top/#_7","title":"\u8f93\u51fa\u8bf4\u660e","text":"<ul> <li>\u7b2c\u4e00\u884c: <code>Tasks</code> \u2014 \u4efb\u52a1\uff08\u8fdb\u7a0b\uff09\uff0c\u5177\u4f53\u4fe1\u606f\u8bf4\u660e\u5982\u4e0b\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 829 total \u5171\u6709829\u4e2a\u8fdb\u7a0b 1 running \u5904\u4e8e\u8fd0\u884c\u4e2d\u7684\u67091\u4e2a 828 sleeping 828\u4e2a\u5728\u4f11\u7720\uff08sleep\uff09 0 stopped stoped\u72b6\u6001\u7684\u67090\u4e2a 0 zombie zombie\u72b6\u6001\uff08\u50f5\u5c38\uff09\u7684\u67090\u4e2a <ul> <li>\u7b2c\u4e8c\u884c: \u5185\u5b58\u72b6\u6001\uff0c\u5177\u4f53\u4fe1\u606f\u8bf4\u660e\u5982\u4e0b\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 3665268K total \u7269\u7406\u5185\u5b58\u603b\u91cf\uff08\u7ea63.5GB) 3060140K used \u4f7f\u7528\u4e2d\u7684\u5185\u5b58\u603b\u91cf\uff08\u7ea611.7GB\uff09 605128K free \u7a7a\u95f2\u5185\u5b58\u603b\u91cf\uff08\u7ea6590M\uff09 1585152 buffers \u7f13\u5b58\u7684\u5185\u5b58\u91cf\uff08\u7ea61.5GB\uff09 <ul> <li>\u7b2c\u4e09\u884c\uff0cswap\u4ea4\u6362\u5206\u533a\u4fe1\u606f\uff0c\u5177\u4f53\u4fe1\u606f\u8bf4\u660e\u5982\u4e0b\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 2097148K total \u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea62GB\uff09 622800K used \u4f7f\u7528\u7684\u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea6608M\uff09 1474348K free \u7a7a\u95f2\u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea61.4GB\uff09 1160664K cached \u7f13\u51b2\u7684\u4ea4\u6362\u533a\u603b\u91cf\uff08\u7ea61.1GB\uff09 <ul> <li>\u7b2c\u56db\u884c\uff0ccpu\u72b6\u6001\u4fe1\u606f\uff0c\u5177\u4f53\u5c5e\u6027\u8bf4\u660e\u5982\u4e0b\uff1a</li> </ul> \u5c55\u793a\u9879 \u8bf4\u660e 800%cpu CPU\u603b\u91cf 11%user \u7528\u6237\u7a7a\u95f4\u5360\u7528CPU\u7684\u767e\u5206\u6bd4(\u4e0d\u5305\u542bnice\u503c\u4e3a\u8d1f\u7684\u8fdb\u7a0b) 0%nice \u6539\u53d8\u8fc7\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u5360\u7528CPU\u7684\u767e\u5206\u6bd4(nice\u503c\u4e3a\u8d1f\u7684\u8fdb\u7a0b) 13%sys \u5185\u6838\u7a7a\u95f4\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 771%idle \u7a7a\u95f2CPU\u767e\u5206\u6bd4 0%iow IO\u7b49\u5f85\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 2%irq \u786c\u4e2d\u65ad\uff08Hardware IRQ\uff09\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 1%sirq \u8f6f\u4e2d\u65ad\uff08Software Interrupts\uff09\u5360\u7528CPU\u7684\u767e\u5206\u6bd4 0%host \uff1f <ul> <li> <p>\u7b2c\u4e94\u884c\u4ee5\u4e0b\uff1a\u5404\u8fdb\u7a0b\uff08\u4efb\u52a1\uff09\u7684\u72b6\u6001\u76d1\u63a7\uff0c\u9879\u76ee\u5217\u4fe1\u606f\u8bf4\u660e\u5982\u4e0b\uff1a</p> \u5c55\u793a\u9879 \u8bf4\u660e PID \u8fdb\u7a0bid USER \u8fdb\u7a0b\u6240\u6709\u8005 PR \u8fdb\u7a0b\u4f18\u5148\u7ea7 NI nice\u503c\u3002\u8d1f\u503c\u8868\u793a\u9ad8\u4f18\u5148\u7ea7\uff0c\u6b63\u503c\u8868\u793a\u4f4e\u4f18\u5148\u7ea7 VIRT \u8fdb\u7a0b\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u603b\u91cf\u3002VIRT=SWAP+RES RES \u7a0b\u4f7f\u7528\u7684\u3001\u672a\u88ab\u6362\u51fa\u7684\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0cRES=CODE+DATA SHR \u5171\u4eab\u5185\u5b58\u5927\u5c0f S \u8fdb\u7a0b\u72b6\u6001\u3002D=\u4e0d\u53ef\u4e2d\u65ad\u7684\u7761\u7720\u72b6\u6001 R=\u8fd0\u884c S=\u7761\u7720 T=\u8ddf\u8e2a/\u505c\u6b62 Z=\u50f5\u5c38\u8fdb\u7a0b %CPU \u4e0a\u6b21\u66f4\u65b0\u5230\u73b0\u5728\u7684CPU\u65f6\u95f4\u5360\u7528\u767e\u5206\u6bd4 %MEM \u8fdb\u7a0b\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\u767e\u5206\u6bd4 TIME+ ARGS \u8fdb\u7a0b\u4f7f\u7528\u7684CPU\u65f6\u95f4\u603b\u8ba1\u548c\u8fdb\u7a0b\u540d </li> </ul>"},{"location":"perf-opt/Android/command/top/#_8","title":"\u8865\u5145\u8bf4\u660e","text":"<ol> <li>swap\u5206\u533a\uff1a\u5f53\u7cfb\u7edf\u7684\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5c06\u7269\u7406\u5185\u5b58\u4e2d\u7684\u4e00\u90e8\u5206\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\uff0c\u4ee5\u4f9b\u5f53\u524d\u8fd0\u884c\u7684\u7a0b\u5e8f\u4f7f\u7528\u3002 \u90a3\u4e9b\u88ab\u91ca\u653e\u7684\u7a7a\u95f4\u53ef\u80fd\u6765\u81ea\u4e00\u4e9b\u5f88\u957f\u65f6\u95f4\u6ca1\u6709\u4ec0\u4e48\u64cd\u4f5c\u7684\u7a0b\u5e8f\uff0c\u8fd9\u4e9b\u88ab\u91ca\u653e\u7684\u7a7a\u95f4\u88ab\u4e34\u65f6\u4fdd\u5b58\u5230Swap\u7a7a\u95f4\u4e2d\uff0c\u7b49\u5230\u90a3\u4e9b\u7a0b\u5e8f\u8981\u8fd0\u884c\u65f6\uff0c\u518d\u4eceSwap\u4e2d\u6062\u590d\u4fdd\u5b58\u7684\u6570\u636e\u5230\u5185\u5b58\u4e2d\u3002</li> </ol> <p>\u5173\u4e8eswap\u5206\u533a\uff0c\u53ef\u4ee5\u53c2\u8003swap \u5206\u533a</p> <ol> <li> <p>\u7b2c\u4e8c\u884c\u4e2d\u4f7f\u7528\u4e2d\u7684\u5185\u5b58\u603b\u91cf\uff08used\uff09\u6307\u7684\u662f\u73b0\u5728\u7cfb\u7edf\u5185\u6838\u63a7\u5236\u7684\u5185\u5b58\u6570\uff0c\u7a7a\u95f2\u5185\u5b58\u603b\u91cf\uff08free\uff09\u662f\u5185\u6838\u8fd8\u672a\u7eb3\u5165\u5176\u7ba1\u63a7\u8303\u56f4\u7684\u6570\u91cf\u3002\u7eb3\u5165\u5185\u6838\u7ba1\u7406\u7684\u5185\u5b58\u4e0d\u89c1\u5f97\u90fd\u5728\u4f7f\u7528\u4e2d\uff0c\u8fd8\u5305\u62ec\u8fc7\u53bb\u4f7f\u7528\u8fc7\u7684\u73b0\u5728\u53ef\u4ee5\u88ab\u91cd\u590d\u5229\u7528\u7684\u5185\u5b58\uff0c\u5185\u6838\u5e76\u4e0d\u628a\u8fd9\u4e9b\u53ef\u88ab\u91cd\u65b0\u4f7f\u7528\u7684\u5185\u5b58\u4ea4\u8fd8\u5230free\u4e2d\u53bb\uff0c\u56e0\u6b64\u5728android\u4e0afree\u5185\u5b58\u4f1a\u8d8a\u6765\u8d8a\u5c11\uff0c\u4f46\u4e0d\u7528\u4e3a\u6b64\u62c5\u5fc3\u3002</p> </li> <li> <p>\u5982\u679c\u51fa\u4e8e\u4e60\u60ef\u53bb\u8ba1\u7b97\u53ef\u7528\u5185\u5b58\u6570\uff0c\u8fd9\u91cc\u6709\u4e2a\u8fd1\u4f3c\u7684\u8ba1\u7b97\u516c\u5f0f\uff1a\u7b2c\u4e8c\u884c\u7684free + \u7b2c\u4e8c\u884c\u7684buffers + \u7b2c\u4e09\u884c\u7684cached\uff0c\u6309\u8fd9\u4e2a\u516c\u5f0f\u6b64\u53f0\u8bbe\u5907\u7684\u53ef\u7528\u5185\u5b58\uff1a605128K +1585152K +1160664K = 3.2GB\u5de6\u53f3\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u5185\u5b58\u76d1\u63a7\uff0c\u5728top\u91cc\u6211\u4eec\u8981\u65f6\u523b\u76d1\u63a7\u7b2c\u4e09\u884cswap\u4ea4\u6362\u5206\u533a\u7684used\uff0c\u5982\u679c\u8fd9\u4e2a\u6570\u503c\u5728\u4e0d\u65ad\u7684\u53d8\u5316\uff0c\u8bf4\u660e\u5185\u6838\u5728\u4e0d\u65ad\u8fdb\u884c\u5185\u5b58\u548cswap\u7684\u6570\u636e\u4ea4\u6362\uff0c\u8fd9\u662f\u771f\u6b63\u7684\u5185\u5b58\u4e0d\u591f\u7528\u4e86\u3002</p> </li> <li> <p>nice\u503c\u8868\u793a\u8fdb\u7a0b\u53ef\u88ab\u6267\u884c\u7684\u4f18\u5148\u7ea7\u7684\u4fee\u6b63\u6570\u503c\u3002\u8fdb\u7a0b\u4f18\u5148\u7ea7(PR)\u503c\u8d8a\u5c0f\u8d8a\u5feb\u88ab\u6267\u884c\uff0c\u52a0\u5165nice\u503c\u540e\uff0c\u5c06\u4f1a\u4f7f\u5f97PR\u53d8\u4e3a\uff1a<code>PR(new)=PR(old)+nice</code>\u3002\u5728LINUX\u7cfb\u7edf\u4e2d\uff0cNice\u503c\u7684\u8303\u56f4\u4ece-20\u5230+19</p> </li> <li>\u4e0d\u540c\u7684Android\u7cfb\u7edf\uff0ctop\u547d\u4ee4\u5f97\u5230\u7684\u7ed3\u679c\u6709\u6240\u4e0d\u540c\u3002\u4e0a\u8ff0\u662fAndroid O\uff088.0\u7cfb\u7edf\uff0clevel = 26\uff09 \u53ca\u4e4b\u540etop\u547d\u4ee4\u5f97\u5230\u7684\u7ed3\u679c\u3002Android N\uff087.1\u7cfb\u7edf\uff0clevel = 25\uff09 \u53ca\u4e4b\u524dtop\u547d\u4ee4\u5f97\u5230\u7ed3\u679c\u5982\u4e0b\uff1a</li> </ol> <pre><code>//CPU\u5360\u7528\u7387\uff1aUser \u7528\u6237\u8fdb\u7a0b\uff1bSystem \u7cfb\u7edf\u8fdb\u7a0b\uff1bIOW IO\u7b49\u5f85\u65f6\u95f4\uff1bIRQ \u786c\u4e2d\u65ad\u65f6\u95f4\nUser 0%, System 4%, IOW 0%, IRQ 0%\n// CPU\u4f7f\u7528\u60c5\u51b5\uff1a\n// User    \u5904\u4e8e\u7528\u6237\u6001\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u4e0d\u5305\u542b\u4f18\u5148\u503c\u4e3a\u8d1f\u8fdb\u7a0b\n// Nice    \u4f18\u5148\u503c\u4e3a\u8d1f\u7684\u8fdb\u7a0b\u6240\u5360\u7528\u7684CPU\u65f6\u95f4\n// Sys     \u5904\u4e8e\u6838\u5fc3\u6001\u7684\u8fd0\u884c\u65f6\u95f4\n// Idle    \u9664IO\u7b49\u5f85\u65f6\u95f4\u4ee5\u5916\u7684\u5176\u5b83\u7b49\u5f85\u65f6\u95f4 // IOW     IO\u7b49\u5f85\u65f6\u95f4\n// IRQ     \u786c\u4e2d\u65ad\u65f6\u95f4\n// SIRQ    \u8f6f\u4e2d\u65ad\u65f6\u95f4\nUser 2 + Nice 0 + Sys 12 + Idle 284 + IOW 0 + IRQ 0 + SIRQ 0 = 298\n//// \u8fdb\u7a0b\u5c5e\u6027\uff1a\n// PID     \u8fdb\u7a0b\u5728\u7cfb\u7edf\u4e2d\u7684ID\n// CPU%    \u5f53\u524d\u77ac\u65f6\u6240\u4ee5\u4f7f\u7528CPU\u5360\u7528\u7387\n// S       \u8fdb\u7a0b\u7684\u72b6\u6001\uff0c\u5176\u4e2dS\u8868\u793a\u4f11\u7720\uff0cR\u8868\u793a\u6b63\u5728\u8fd0\u884c\uff0cZ\u8868\u793a\u50f5\u6b7b\u72b6\u6001\uff0cN\u8868\u793a\u8be5\u8fdb\u7a0b\u4f18\u5148\u503c\u662f\u8d1f\u6570\u3002\n// #THR    \u7a0b\u5e8f\u5f53\u524d\u6240\u7528\u7684\u7ebf\u7a0b\u6570\n// VSS     Virtual Set Size \u865a\u62df\u8017\u7528\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\n// RSS     Resident Set Size \u5b9e\u9645\u4f7f\u7528\u7269\u7406\u5185\u5b58\uff08\u5305\u542b\u5171\u4eab\u5e93\u5360\u7528\u7684\u5185\u5b58\uff09\n// PCY     Policy\u7cfb\u7edf\u5bf9\u8fd9\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u7684\u8c03\u5ea6\u7b56\u7565\uff0cbg \u540e\u53f0\uff1bfg \u524d\u53f0\n// Name    \u7a0b\u5e8f\u540d\u79f0\n  PID USER     PR  NI CPU% S  #THR     VSS     RSS PCY Name\n6498 root     20   0   3% R     1   9116K   1888K  fg top\n  253 root     RT   0   0% S     1      0K      0K  fg nanohub\n    3 root     20   0   0% S     1      0K      0K  fg ksoftirqd/0\n  387 root     20   0   0% S     1      0K      0K  fg kworker/u16:4\n</code></pre>"},{"location":"perf-opt/Android/command/top/#topcpu","title":"\u4ee3\u7801\u901a\u8fc7top\u547d\u4ee4\u83b7\u53d6cpu\u4f7f\u7528\u7387","text":"<p>\u5728Android O\u4e4b\u524d\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u4f2a\u6587\u4ef6<code>/proc/stat</code>\u548c<code>/proc/&lt;pid&gt;/stat</code>\uff0c\u7136\u540e\u8ba1\u7b97\u5f97\u5230cpu\u4f7f\u7528\u7387\uff0cAndroid O\u4e4b\u540e\u6709\u6743\u9650\u9650\u5236\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7<code>top -n 1</code>\u83b7\u53d6cpu\u4f7f\u7528\u7387\uff0c\u4ee3\u7801\u5982\u4e0b <pre><code>    private fun getCpuDataForO(): Float {\nvar process: java.lang.Process? = null\nvar cpuRate = 0.0F\ntry {\nprocess = Runtime.getRuntime().exec(\"top -n 1\")\nval reader =\nBufferedReader(InputStreamReader(process.inputStream))\nvar line: String? = null\nvar cpuIndex = -1\nwhile (reader.readLine().also { line = it } != null) {\nline = line!!.trim { it &lt;= ' ' }\nif (TextUtils.isEmpty(line)) {\ncontinue\n}\nval tempIndex = getCPUIndex(line!!)\nif (tempIndex != -1) {\ncpuIndex = tempIndex\ncontinue\n}\nif (line!!.startsWith(android.os.Process.myPid().toString())) {\nif (cpuIndex == -1) {\ncontinue\n}\nval param = line!!.split(\"\\\\s+\".toRegex()).toTypedArray()\nif (param.size &lt;= cpuIndex) {\ncontinue\n}\nvar cpu = param[cpuIndex]\nif (cpu.endsWith(\"%\")) {\ncpu = cpu.substring(0, cpu.lastIndexOf(\"%\"))\n}\ncpuRate =  cpu.toFloat() / Runtime.getRuntime().availableProcessors()\n}\n}\n} catch (e: Exception) {\nLog.e(TAG, \"getCpuDataForO fail, error: %s\", e.toString())\n} finally {\nprocess?.destroy()\n}\nreturn cpuRate\n}\n</code></pre></p>"},{"location":"perf-opt/Android/command/top/#_9","title":"\u53c2\u8003\u94fe\u63a5","text":"<p>\u6bcf\u5929\u4e00\u4e2alinux\u547d\u4ee4\uff0844\uff09\uff1atop\u547d\u4ee4</p>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/","title":"\u4e3a\u5565Android\u5b50\u7ebf\u7a0b\u629b\u51fa\u5f02\u5e38\u4e3b\u7ebf\u7a0b\u4f1a\u5d29\u6e83","text":""},{"location":"perf-opt/Android/crash/KillApplicationHandler/#1-uncaughtexceptionhandler","title":"1. UncaughtExceptionHandler","text":"<p>UncaughtExceptionHandler\u662fThread\u5185\u90e8\u7684\u4e00\u4e2a\u63a5\u53e3\uff1a</p> <pre><code>public interface UncaughtExceptionHandler {\n/**\n         * Method invoked when the given thread terminates due to the given uncaught exception.\n         * \u65b9\u6cd5\u5728\u7ed9\u5b9a\u7ebf\u7a0b\u7531\u4e8e\u7ed9\u5b9a\u672a\u6355\u83b7\u5f02\u5e38\u800c\u7ec8\u6b62\u65f6\u8c03\u7528\u3002\n         * Any exception thrown by this method will be ignored by the Java Virtual Machine.\n         * \u6b64\u65b9\u6cd5\u5f15\u53d1\u7684\u4efb\u4f55\u5f02\u5e38\u90fd\u5c06\u88abJava\u865a\u62df\u673a\u5ffd\u7565\u3002 \n         */\nvoid uncaughtException(Thread t, Throwable e);\n}\n</code></pre>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/#11","title":"1.1 \u5b98\u65b9\u6ce8\u91ca","text":"<pre><code>Interface for handlers invoked when a Thread abruptly terminates due to an uncaught exception.\nWhen a thread is about to terminate due to an uncaught exception the Java Virtual Machine will query the thread for its UncaughtExceptionHandler using getUncaughtExceptionHandler and will invoke the handler's uncaughtException method,  passing the thread and the exception as arguments. If a thread has not had its UncaughtExceptionHandler explicitly set, then its ThreadGroup object acts as its UncaughtExceptionHandler. If the ThreadGroup object has no special requirements for dealing with the exception, it can forward the invocation to the default uncaught exception handler.\n\n\u5728\u7ebf\u7a0b\u7531\u4e8e\u672a\u6355\u83b7\u5f02\u5e38\u800c\u7a81\u7136\u7ec8\u6b62\u65f6\u8c03\u7528\u7684\u5904\u7406\u7a0b\u5e8f\u7684\u63a5\u53e3\u3002\n\u8c03\u7528\u65f6\u901a\u8fc7\u67e5\u8be2getUncaughtExceptionHandler \u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u8fd8\u6ca1\u6709\u663e\u5f0f\u8bbe\u7f6e\u5b83\u7684UncaughtExceptionHandler\uff0c\u90a3\u4e48\u5b83\u7684ThreadGroup\u5bf9\u8c61\u5c31\u5145\u5f53\u5b83\u7684UncaughtExceptionHandler\u3002\n\u5982\u679cThreadGroup\u5bf9\u8c61\u6ca1\u6709\u5904\u7406\u5f02\u5e38\u7684\u7279\u6b8a\u8981\u6c42\uff0c\u5b83\u53ef\u4ee5\u5c06\u8c03\u7528\u8f6c\u53d1\u7ed9\u9ed8\u8ba4\u7684\u672a\u6355\u83b7\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u3002\n</code></pre> <p>\u540e\u9762\u4e24\u53e5\u4e3b\u8981\u662f\u63cf\u8ff0\u4e86\u4f7f\u7528UncaughtExceptionHandler\u7684\u987a\u5e8f\u903b\u8f91\u3002 \u4e00\u822c\u6709\u4e09\u79cdUncaughtExceptionHandler\uff1a</p> UncaughtExceptionHandler\u79cd\u7c7b \u4f18\u5148\u7ea7 \u7ebf\u7a0b\u79c1\u6709\u7684UncaughtExceptionHandler \u6700\u9ad8 ThreadGroup\u7684UncaughtExceptionHandler \u5176\u6b21 \u9759\u6001\u9ed8\u8ba4\u7684UncaughtExceptionHandler \u6700\u540e <p>\u5982\u679c\u6700\u540e\u90fd\u6ca1\u6709UncaughtExceptionHandler\u5904\u7406\u8fd9\u79cd\u672a\u6355\u83b7\u7684\u5f02\u5e38\uff0c\u5c31\u9ed8\u8ba4\u5904\u7406,\u6253\u5370\u9519\u8bef\u5806\u6808\u5f02\u5e38\u3002</p>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/#2javaandroid","title":"2.Java\u548cAndroid\u7684\u4e0d\u540c\u5904\u7406","text":""},{"location":"perf-opt/Android/crash/KillApplicationHandler/#21-java","title":"2.1 Java\u6d4b\u8bd5","text":"<p>\u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u7684\u672a\u6355\u83b7\u5f02\u5e38\u5904\u7406\u5668\uff0c\u901a\u8fc7setUncaughtExceptionHandler\u3002\u7136\u540e\u518d\u7ebf\u7a0b\u4e2d\u629b\u51fa\u5f02\u5e38\uff0c\u6d4b\u8bd5\u7ed3\u679c</p> <pre><code>private static void testSetUncaughtExceptionHandler() {\nThread thread = new Thread(new Runnable() {\n@Override\npublic void run() {\nint y = new Random().nextInt(2); //\u8fd9\u91cc\u6709\u53ef\u80fd y = 0\nSystem.out.println(y);\nint x = 10 / y;  //\u629b\u51fa\u5f02\u5e38\nSystem.out.println(\"testChild end\");\n}\n});\nthread.setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {\n@Override\npublic void uncaughtException(Thread t, Throwable e) {\nSystem.out.println(\"uncaughtException:\" + Thread.currentThread() + \" \" + t + \" \" + e);\n}\n});\nthread.start();\ntry {\nThread.sleep(2 * 1000);\n} catch (InterruptedException e) {\ne.printStackTrace();\n}\nSystem.out.println(\"Main end \" + Thread.currentThread());\n}\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>Java getDefaultUncaughtExceptionHandler:null\n0\nuncaughtException:Thread[Thread-0,5,main] Thread[Thread-0,5,main] java.lang.ArithmeticException: / by zero\nMain end Thread[main,5,main]\n</code></pre> <p>\u5f53\u6211\u4eec\u4e0d\u8bbe\u7f6eUncaughtExceptionHandler\u7684\u65f6\u5019\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>Java getDefaultUncaughtExceptionHandler:null\n0\nException in thread \"Thread-0\" java.lang.ArithmeticException: / by zero\nat com.thread.UncaughtExceptionHandlerTest$1.run(UncaughtExceptionHandlerTest.java:22)\nat java.lang.Thread.run(Thread.java:748)\nMain end Thread[main,5,main]\n</code></pre>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/#22","title":"2.2 \u7ed3\u8bba","text":"<ol> <li> <p>\u9ed8\u8ba4\u6ca1\u6709UncaughtExceptionHandler\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u6253\u5370\u51fa\u5d29\u6e83\u5f02\u5e38\u8def\u5f84</p> </li> <li> <p>\u5b50\u7ebf\u7a0b\u5d29\u6e83\uff0cmain\u7ebf\u7a0b\u662f\u4e0d\u53d7\u5f71\u54cd\uff0c\u7ee7\u7eed\u6267\u884c\uff0c\u76f4\u5230\u4f11\u7720\u7ed3\u675f\u3002</p> </li> </ol>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/#23-android","title":"2.3 \u4e3a\u5565Android\u5b50\u7ebf\u7a0b\u5d29\u6e83\u540e\uff0c\u6574\u4e2a\u8fdb\u7a0b\u90fd\u8ddf\u7740\u5d29\u6e83","text":""},{"location":"perf-opt/Android/crash/KillApplicationHandler/#231-uncaughtexceptionhandler","title":"2.3.1 \u83b7\u53d6\u9ed8\u8ba4UncaughtExceptionHandler","text":"<ul> <li>java</li> </ul> <pre><code>public static void main(String[] args) {\nThread.UncaughtExceptionHandler uncaughtExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();\nSystem.out.println(\"Java getDefaultUncaughtExceptionHandler:\" + uncaughtExceptionHandler);\n}\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>Java getDefaultUncaughtExceptionHandler:null\n</code></pre> <ul> <li>Android</li> </ul> <pre><code>public void getDefaultUncaughtExceptionHandler(View view) {\nThread.UncaughtExceptionHandler uncaughtExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();\nLog.d(\"Test\", \"Android getDefaultUncaughtExceptionHandler:\" + uncaughtExceptionHandler);\n}\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c</p> <pre><code>Android getDefaultUncaughtExceptionHandler:com.android.internal.os.RuntimeInit$KillApplicationHandler@45c7407\n</code></pre> <p>Java\u6ca1\u6709\u9ed8\u8ba4UncaughtExceptionHandler \uff0cAndroid\u6709\u9ed8\u8ba4\u7684UncaughtExceptionHandler (RuntimeInit$KillApplicationHandler)</p>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/#232-runtimeinitkillapplicationhandler","title":"2.3.2 RuntimeInit$KillApplicationHandler","text":"<pre><code>public class RuntimeInit {\n...\n/**\n     * Logs a message when a thread encounters an uncaught exception. By\n     * default, {@link KillApplicationHandler} will terminate this process later,\n     * but apps can override that behavior.\n     */\nprivate static class LoggingHandler implements Thread.UncaughtExceptionHandler {\npublic volatile boolean mTriggered = false;\n@Override\npublic void uncaughtException(Thread t, Throwable e) {\n//...\u6253\u5370log\u4fe1\u606f...\n}\n}\n}\n/**\n     * Handle application death from an uncaught exception.  The framework\n     * catches these for the main threads, so this should only matter for\n     * threads created by applications. Before this method runs, the given\n     * instance of {@link LoggingHandler} should already have logged details\n     * (and if not it is run first).\n     */\nprivate static class KillApplicationHandler implements Thread.UncaughtExceptionHandler {\nprivate final LoggingHandler mLoggingHandler;\n/**\n         * Create a new KillApplicationHandler that follows the given LoggingHandler.\n         * If {@link #uncaughtException(Thread, Throwable) uncaughtException} is called\n         * on the created instance without {@code loggingHandler} having been triggered,\n         * {@link LoggingHandler#uncaughtException(Thread, Throwable)\n         * loggingHandler.uncaughtException} will be called first.\n         *\n         * @param loggingHandler the {@link LoggingHandler} expected to have run before\n         *     this instance's {@link #uncaughtException(Thread, Throwable) uncaughtException}\n         *     is being called.\n         */\npublic KillApplicationHandler(LoggingHandler loggingHandler) {\nthis.mLoggingHandler = Objects.requireNonNull(loggingHandler);\n}\n@Override\npublic void uncaughtException(Thread t, Throwable e) {\ntry {\nensureLogging(t, e); //\u6253\u5370log\n...\n} catch (Throwable t2) {\n...\n} finally {\n// Try everything to make sure this process goes away.\nProcess.killProcess(Process.myPid());  // \u6740\u6b7b\u5f53\u524d\u8fdb\u7a0b\nSystem.exit(10);\n}\n}\n......\n}\n}\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728KillApplicationHandler \u662f\u7684\u63a5\u53e3\u4e2d\uff0cuncaughtException\u65b9\u6cd5\u5728finally\u7684\u5730\u65b9\uff0cKill\u6389\u4e86\u6574\u4e2a\u8fdb\u7a0b\u3002\u8fd9\u4e5f\u5c31\u662f\u4e3a\u5565\u5b50\u7ebf\u7a0b\u5d29\u6e83\u6574\u4e2a\u8fdb\u7a0b\u4e5f\u5d29\u6e83\u7684\u539f\u56e0\u3002</p>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/#233-android","title":"2.3.3 \u5982\u4f55\u505a\u5230Android\u662f\u5b50\u7ebf\u7a0b\u5d29\u6e83\u540e\uff0c\u6574\u4e2a\u8fdb\u7a0b\u4e0d\u5d29\u6e83","text":"<p>\u5d29\u6e83\u5904\u7406\u6e90\u7801\uff1a</p> <pre><code>public final void dispatchUncaughtException(Throwable e) {\nThread.UncaughtExceptionHandler initialUeh =\nThread.getUncaughtExceptionPreHandler();\nif (initialUeh != null) {\ntry {\ninitialUeh.uncaughtException(this, e);\n} catch (RuntimeException | Error ignored) {\n// Throwables thrown by the initial handler are ignored\n}\n}\ngetUncaughtExceptionHandler().uncaughtException(this, e);\n}\n</code></pre> <p><pre><code>public UncaughtExceptionHandler getUncaughtExceptionHandler() {\nreturn uncaughtExceptionHandler != null ?\nuncaughtExceptionHandler : group; //group\u662f\u7ebf\u7a0b\u7684ThreadGroup\uff0c\u9ed8\u8ba4\u7ee7\u627f\u81eaparent\n}\n</code></pre> <code>ThreadGroup</code> \u5b9e\u73b0<code>UncaughtExceptionHandler</code>\uff0c\u5904\u7406\u5982\u4e0b</p> <pre><code>public void uncaughtException(Thread t, Throwable e) {\nif (parent != null) {\nparent.uncaughtException(t, e);\n} else {\nThread.UncaughtExceptionHandler ueh =\nThread.getDefaultUncaughtExceptionHandler();\nif (ueh != null) {\nueh.uncaughtException(t, e); //DefaultUncaughtExceptionHandler\u5904\u7406\n} else if (!(e instanceof ThreadDeath)) {\nSystem.err.print(\"Exception in thread \\\"\"//log\u8f93\u51fa\n+ t.getName() + \"\\\" \");\ne.printStackTrace(System.err);\n}\n}\n}\n</code></pre> <p>\u4ece\u6e90\u7801\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u8981\u60f3\u8fdb\u7a0b\u4e0d\u5d29\u6e83\uff0c\u6709\u4e09\u79cd\u529e\u6cd5\uff1a</p> <ol> <li>\u7ebf\u7a0b\u53ef\u4ee5\u8bbe\u7f6e\u7684\u79c1\u6709UncaughtExceptionHandler</li> <li>\u8bbe\u7f6e\u7ebf\u7a0bThreadGroup</li> <li>\u8bbe\u7f6eDefaultUncaughtExceptionHandler\uff08\u5d29\u6e83sdk\u4e00\u822c\u4f7f\u7528\u8fd9\u79cd\u505a\u6cd5\uff09</li> </ol>"},{"location":"perf-opt/Android/crash/KillApplicationHandler/#3","title":"3. \u603b\u7ed3","text":"<ol> <li>UncaughtExceptionHandler\u7684\u83b7\u53d6\u987a\u5e8f\uff08\u5f53\u524d\u7ebf\u7a0b-\u300bThreadGroup -\u300bDefaultUncaughtExceptionHandler\uff09</li> <li>\u9ed8\u8ba4\u6ca1\u6709UncaughtExceptionHandler\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u6253\u5370\u51fa\u5d29\u6e83\u5f02\u5e38\u8def\u5f84</li> <li>Java\u4e2d\u5b50\u7ebf\u7a0b\u5d29\u6e83\uff0cmain\u7ebf\u7a0b\u662f\u4e0d\u53d7\u5f71\u54cd\uff0c\u7ee7\u7eed\u6267\u884c\uff0c\u76f4\u5230\u4f11\u7720\u7ed3\u675f\u3002</li> <li>Android\u662f\u5b50\u7ebf\u7a0b\u5d29\u6e83\u540e\uff0c\u6574\u4e2a\u8fdb\u7a0b\u90fd\u5d29\u6e83</li> <li>Java\u6ca1\u6709\u9ed8\u8ba4UncaughtExceptionHandler \uff0cAndroid\u6709\u9ed8\u8ba4\u7684UncaughtExceptionHandler\uff08RuntimeInit$KillApplicationHandler\uff09</li> <li>Android\u662f\u5b50\u7ebf\u7a0b\u5d29\u6e83\u540e\uff0c\u6574\u4e2a\u8fdb\u7a0b\u90fd\u5d29\u6e83\uff0c\u5d29\u6e83\u539f\u56e0\u662f\uff1aKillApplicationHandler\u4e2dkill\u6389\u4e86\u6574\u4e2a\u8fdb\u7a0b</li> </ol>"},{"location":"perf-opt/Android/crash/crash_op/","title":"\u5d29\u6e83\u4f18\u5316","text":""},{"location":"perf-opt/Android/crash/crash_op/#1-java","title":"1. Java \u5d29\u6e83","text":"<p>Java \u5d29\u6e83\u5c31\u662f\u5728 Java \u4ee3\u7801\u4e2d\uff0c\u51fa\u73b0\u4e86\u672a\u6355\u83b7\u5f02\u5e38\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u5f02\u5e38\u9000\u51fa\u3002Java \u5d29\u6e83\u6355\u83b7\u76f8\u5bf9\u5bb9\u6613\uff0c\u76f4\u63a5\u5b9e\u73b0<code>Thread.UncaughtExceptionHandler</code>\u5373\u53ef\u5904\u7406\u6536\u96c6\u3002</p> <p>Thread.UncaughtExceptionHandler\uff1a\u5f53\u67d0\u4e00\u7ebf\u7a0b\u56e0\u672a\u6355\u83b7\u7684\u5f02\u5e38\u800c\u5373\u5c06\u7ec8\u6b62\u65f6\uff0cJava \u865a\u62df\u673a\u5c06\u4f7f\u7528 Thread.getUncaughtExceptionHandler() \u67e5\u8be2\u8be5\u7ebf\u7a0b\u4ee5\u83b7\u5f97\u5176 UncaughtExceptionHandler \u7684\u7ebf\u7a0b\uff0c\u5e76\u8c03\u7528\u5904\u7406\u7a0b\u5e8f\u7684 uncaughtException \u65b9\u6cd5\uff0c\u5c06\u7ebf\u7a0b\u548c\u5f02\u5e38\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\u5982\u679c\u67d0\u4e00\u7ebf\u7a0b\u6ca1\u6709\u660e\u786e\u8bbe\u7f6e\u5176 UncaughtExceptionHandler\uff0c\u5219\u5c06\u5b83\u7684 ThreadGroup \u5bf9\u8c61\u4f5c\u4e3a\u5176 UncaughtExceptionHandler\u3002\u5982\u679c ThreadGroup \u5bf9\u8c61\u5bf9\u5904\u7406\u5f02\u5e38\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u8981\u6c42\uff0c\u90a3\u4e48\u5b83\u53ef\u4ee5\u5c06\u8c03\u7528\u8f6c\u53d1\u7ed9 \u9ed8\u8ba4\u7684\u672a\u6355\u83b7\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u3002</p> <p>\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u6b64\u63a5\u53e3\uff0c\u5e76\u6ce8\u518c\u4e3a\u7a0b\u5e8f\u4e2d\u9ed8\u8ba4\u672a\u6355\u83b7\u5f02\u5e38\u5904\u7406\u3002\u8fd9\u6837\u5f53\u672a\u6355\u83b7\u5f02\u5e38\u53d1\u751f\u65f6\uff0c\u5c31\u53ef\u4ee5\u505a\u4e00\u4e9b\u4e2a\u6027\u5316\u7684\u5f02\u5e38\u5904\u7406\u64cd\u4f5c\u3002</p> <pre><code>public class CrashHandler implements UncaughtExceptionHandler {\npublic static String TAG = \"MyCrash\";\n// \u7cfb\u7edf\u9ed8\u8ba4\u7684UncaughtException\u5904\u7406\u7c7b\nprivate Thread.UncaughtExceptionHandler mDefaultHandler;\nprivate static CrashHandler instance = new CrashHandler();\nprivate Context mContext;\n/** \u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2aCrashHandler\u5b9e\u4f8b */\nprivate CrashHandler() {\n}\n/** \u83b7\u53d6CrashHandler\u5b9e\u4f8b ,\u5355\u4f8b\u6a21\u5f0f */\npublic static CrashHandler getInstance() {\nreturn instance;\n}\n/**\n     * \u521d\u59cb\u5316\n     * \n     * @param context\n     */\npublic void init(Context context) {\nmContext = context;\n// \u83b7\u53d6\u7cfb\u7edf\u9ed8\u8ba4\u7684UncaughtException\u5904\u7406\u5668\nmDefaultHandler = Thread.getDefaultUncaughtExceptionHandler();\n// \u8bbe\u7f6e\u8be5CrashHandler\u4e3a\u7a0b\u5e8f\u7684\u9ed8\u8ba4\u5904\u7406\u5668\nThread.setDefaultUncaughtExceptionHandler(this);\n}\n/**\n     * \u5f53UncaughtException\u53d1\u751f\u65f6\u4f1a\u8f6c\u5165\u8be5\u51fd\u6570\u6765\u5904\u7406\n     */\n@Override\npublic void uncaughtException(Thread thread, Throwable ex) {\nif (!handleException(ex) &amp;&amp; mDefaultHandler != null) {\n// \u5982\u679c\u7528\u6237\u6ca1\u6709\u5904\u7406\u5219\u8ba9\u7cfb\u7edf\u9ed8\u8ba4\u7684\u5f02\u5e38\u5904\u7406\u5668\u6765\u5904\u7406\nmDefaultHandler.uncaughtException(thread, ex);\n} else {\nSystemClock.sleep(3000);\n// \u9000\u51fa\u7a0b\u5e8f\nandroid.os.Process.killProcess(android.os.Process.myPid());\nSystem.exit(1);\n}\n}\n/**\n     * \u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406,\u6536\u96c6\u9519\u8bef\u4fe1\u606f \u53d1\u9001\u9519\u8bef\u62a5\u544a\u7b49\u64cd\u4f5c\u5747\u5728\u6b64\u5b8c\u6210.\n     * \n     * @param ex\n     * @return true:\u5982\u679c\u5904\u7406\u4e86\u8be5\u5f02\u5e38\u4fe1\u606f; \u5426\u5219\u8fd4\u56defalse.\n     */\nprivate boolean handleException(Throwable ex) {\nif (ex == null)\nreturn false;\ntry {\n// \u4f7f\u7528Toast\u6765\u663e\u793a\u5f02\u5e38\u4fe1\u606f\nnew Thread() {\n@Override\npublic void run() {\nLooper.prepare();\nToast.makeText(mContext, \"\u5f88\u62b1\u6b49,\u7a0b\u5e8f\u51fa\u73b0\u5f02\u5e38,\u5373\u5c06\u91cd\u542f.\",\nToast.LENGTH_LONG).show();\nLooper.loop();\n}\n}.start();\n// \u6536\u96c6\u8bbe\u5907\u53c2\u6570\u4fe1\u606f\ncollectDeviceInfo(mContext);\n// \u4fdd\u5b58\u65e5\u5fd7\u6587\u4ef6\nsaveCrashInfoFile(ex);\nSystemClock.sleep(3000);\n} catch (Exception e) {\ne.printStackTrace();\n}\nreturn true;\n}\n}\n</code></pre> <pre><code>public class MyAppcation extends Application{\n@Override\npublic void onCreate() {\nsuper.onCreate();\nCrashHandler.getInstance().init(this);\n}\n}\n</code></pre>"},{"location":"perf-opt/Android/crash/crash_op/#2-native","title":"2. Native \u5d29\u6e83","text":"<p>\u4e00\u822c\u90fd\u662f\u56e0\u4e3a\u5728 Native \u4ee3\u7801\u4e2d\u8bbf\u95ee\u975e\u6cd5\u5730\u5740\uff0c\u4e5f\u53ef\u80fd\u662f\u5730\u5740\u5bf9\u9f50\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u6216\u8005\u53d1\u751f\u4e86\u7a0b\u5e8f\u4e3b\u52a8 abort\uff0c\u8fd9\u4e9b\u90fd\u4f1a\u4ea7\u751f\u76f8\u5e94\u7684 signal \u4fe1\u53f7\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u5f02\u5e38\u9000\u51fa\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#21-native","title":"2.1 Native \u5d29\u6e83\u7684\u6355\u83b7\u6d41\u7a0b","text":"<p>Android \u5e73\u53f0 Native \u4ee3\u7801\u7684\u5d29\u6e83\u6355\u83b7\u673a\u5236\u53ca\u5b9e\u73b0</p> <ul> <li>\u7f16\u8bd1\u7aef\u3002\u7f16\u8bd1 C/C++ \u4ee3\u7801\u65f6\uff0c\u9700\u8981\u5c06\u5e26\u7b26\u53f7\u4fe1\u606f\u7684\u6587\u4ef6\u4fdd\u7559\u4e0b\u6765\u3002</li> <li>\u5ba2\u6237\u7aef\u3002\u6355\u83b7\u5230\u5d29\u6e83\u65f6\u5019\uff0c\u5c06\u6536\u96c6\u5230\u5c3d\u53ef\u80fd\u591a\u7684\u6709\u7528\u4fe1\u606f\u5199\u5165\u65e5\u5fd7\u6587\u4ef6\uff0c\u7136\u540e\u9009\u62e9\u5408\u9002\u7684\u65f6\u673a\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u3002</li> <li>\u670d\u52a1\u7aef\u3002\u8bfb\u53d6\u5ba2\u6237\u7aef\u4e0a\u62a5\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5bfb\u627e\u9002\u5408\u7684\u7b26\u53f7\u6587\u4ef6\uff0c\u751f\u6210\u53ef\u8bfb\u7684 C/C++ \u8c03\u7528\u6808\u3002</li> </ul> <p></p>"},{"location":"perf-opt/Android/crash/crash_op/#22-native","title":"2.2 Native \u5d29\u6e83\u6355\u83b7\u7684\u96be\u70b9","text":"<p>Chromium \u7684Breakpad\u662f\u76ee\u524d Native \u5d29\u6e83\u6355\u83b7\u4e2d\u6700\u6210\u719f\u7684\u65b9\u6848\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u4e09\u4e2a\u6d41\u7a0b\u4e2d\uff0c\u6700\u6838\u5fc3\u7684\u662f\u600e\u4e48\u6837\u4fdd\u8bc1\u5ba2\u6237\u7aef\u5728\u5404\u79cd\u6781\u7aef\u60c5\u51b5\u4e0b\u4f9d\u7136\u53ef\u4ee5\u751f\u6210\u5d29\u6e83\u65e5\u5fd7\u3002\u56e0\u4e3a\u5728\u5d29\u6e83\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u5904\u4e8e\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u72b6\u6001\uff0c\u5982\u679c\u5904\u7406\u4e0d\u5f53\uff0c\u975e\u5e38\u5bb9\u6613\u53d1\u751f\u4e8c\u6b21\u5d29\u6e83\u3002</p> <ul> <li>\u60c5\u51b5\u4e00\uff1a\u6587\u4ef6\u53e5\u67c4\u6cc4\u6f0f\uff0c\u5bfc\u81f4\u521b\u5efa\u65e5\u5fd7\u6587\u4ef6\u5931\u8d25\uff0c\u600e\u4e48\u529e\uff1f</li> </ul> <p>\u5e94\u5bf9\u65b9\u5f0f\uff1a\u6211\u4eec\u9700\u8981\u63d0\u524d\u7533\u8bf7\u6587\u4ef6\u53e5\u67c4 fd \u9884\u7559\uff0c\u9632\u6b62\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u3002</p> <ul> <li>\u60c5\u51b5\u4e8c\uff1a\u56e0\u4e3a\u6808\u6ea2\u51fa\u4e86\uff0c\u5bfc\u81f4\u65e5\u5fd7\u751f\u6210\u5931\u8d25\uff0c\u600e\u4e48\u529e\uff1f</li> </ul> <p>\u5e94\u5bf9\u65b9\u5f0f\uff1a\u4e3a\u4e86\u9632\u6b62\u6808\u6ea2\u51fa\u5bfc\u81f4\u8fdb\u7a0b\u6ca1\u6709\u7a7a\u95f4\u521b\u5efa\u8c03\u7528\u6808\u6267\u884c\u5904\u7406\u51fd\u6570\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u4f7f\u7528\u5e38\u89c1\u7684 <code>signalstack</code>\u3002\u5728\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u80fd\u8fd8\u9700\u8981\u76f4\u63a5\u66ff\u6362\u5f53\u524d\u6808\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f\u9700\u8981\u5728\u5806\u4e2d\u9884\u7559\u90e8\u5206\u7a7a\u95f4\u3002</p> <ul> <li>\u60c5\u51b5\u4e09\uff1a\u6574\u4e2a\u5806\u7684\u5185\u5b58\u90fd\u8017\u5c3d\u4e86\uff0c\u5bfc\u81f4\u65e5\u5fd7\u751f\u6210\u5931\u8d25\uff0c\u600e\u4e48\u529e\uff1f</li> </ul> <p>\u5e94\u5bf9\u65b9\u5f0f\uff1a\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u65e0\u6cd5\u5b89\u5168\u5730\u5206\u914d\u5185\u5b58\uff0c\u4e5f\u4e0d\u6562\u4f7f\u7528 <code>stl</code> \u6216\u8005<code>libc</code> \u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u5185\u90e8\u5b9e\u73b0\u4f1a\u5206\u914d\u5806\u5185\u5b58\u3002\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u7ee7\u7eed\u5206\u914d\u5185\u5b58\uff0c\u4f1a\u5bfc\u81f4\u51fa\u73b0\u5806\u7834\u574f\u6216\u8005\u4e8c\u6b21\u5d29\u6e83\u7684\u60c5\u51b5\u3002Breakpad \u505a\u7684\u6bd4\u8f83\u5f7b\u5e95\uff0c\u91cd\u65b0\u5c01\u88c5\u4e86Linux Syscall Support\uff0c\u6765\u907f\u514d\u76f4\u63a5\u8c03\u7528 <code>libc</code>\u3002</p> <ul> <li>\u60c5\u51b5\u56db\uff1a\u5806\u7834\u574f\u6216\u4e8c\u6b21\u5d29\u6e83\u5bfc\u81f4\u65e5\u5fd7\u751f\u6210\u5931\u8d25\uff0c\u600e\u4e48\u529e\uff1f</li> </ul> <p>\u5e94\u5bf9\u65b9\u5f0f\uff1aBreakpad \u4f1a\u4ece\u539f\u8fdb\u7a0b fork \u51fa\u5b50\u8fdb\u7a0b\u53bb\u6536\u96c6\u5d29\u6e83\u73b0\u573a\uff0c\u6b64\u5916\u6d89\u53ca\u4e0e Java \u76f8\u5173\u7684\uff0c\u4e00\u822c\u4e5f\u4f1a\u7528\u5b50\u8fdb\u7a0b\u53bb\u64cd\u4f5c\u3002\u8fd9\u6837\u5373\u4f7f\u51fa\u73b0\u4e8c\u6b21\u5d29\u6e83\uff0c\u53ea\u662f\u8fd9\u90e8\u5206\u7684\u4fe1\u606f\u4e22\u5931\uff0c\u6211\u4eec\u7684\u7236\u8fdb\u7a0b\u540e\u9762\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u83b7\u53d6\u5176\u4ed6\u7684\u4fe1\u606f\u3002\u5728\u4e00\u4e9b\u7279\u6b8a\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u8fd8\u53ef\u80fd\u9700\u8981\u4ece\u5b50\u8fdb\u7a0b fork \u51fa\u5b59\u8fdb\u7a0b\u3002</p> <p>\u5f53\u7136 Breakpad \u4e5f\u5b58\u5728\u7740\u4e00\u4e9b\u95ee\u9898\uff0c\u4f8b\u5982\u751f\u6210\u7684 <code>minidump</code>\u6587\u4ef6\u662f\u4e8c\u8fdb\u5236\u683c\u5f0f\u7684\uff0c\u5305\u542b\u4e86\u592a\u591a\u4e0d\u91cd\u8981\u7684\u4fe1\u606f\uff0c\u5bfc\u81f4\u6587\u4ef6\u5f88\u5bb9\u6613\u8fbe\u5230\u51e0 MB\u3002\u4f46\u662f minidump \u4e5f\u4e0d\u662f\u6beb\u65e0\u7528\u5904\uff0c\u5b83\u6709\u4e00\u4e9b\u6bd4\u8f83\u9ad8\u7ea7\u7684\u7279\u6027\uff0c\u6bd4\u5982\u4f7f\u7528 gdb \u8c03\u8bd5\u3001\u53ef\u4ee5\u770b\u5230\u4f20\u5165\u53c2\u6570\u7b49\u3002Chromium \u672a\u6765\u8ba1\u5212\u4f7f\u7528 Crashpad \u5168\u9762\u66ff\u4ee3 Breakpad\uff0c\u4f46\u76ee\u524d\u6765\u8bf4\u8fd8\u662f \u201ctoo early to mobile\u201d\u3002</p> <p>\u6211\u4eec\u6709\u65f6\u5019\u60f3\u9075\u5faa Android \u7684\u6587\u672c\u683c\u5f0f\uff0c\u5e76\u4e14\u6dfb\u52a0\u66f4\u591a\u6211\u4eec\u8ba4\u4e3a\u91cd\u8981\u7684\u4fe1\u606f\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u53bb\u6539\u9020 Breakpad \u7684\u5b9e\u73b0\u3002\u6bd4\u8f83\u5e38\u89c1\u7684\u4f8b\u5982\u589e\u52a0 Logcat \u4fe1\u606f\u3001Java \u8c03\u7528\u6808\u4fe1\u606f\u4ee5\u53ca\u5d29\u6e83\u65f6\u7684\u5176\u4ed6\u4e00\u4e9b\u6709\u7528\u4fe1\u606f\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#221-logcat","title":"2.2.1 \u83b7\u53d6logcat","text":"<p>\u65e5\u5fd7\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff0c<code>\u5e94\u7528\u5c42 --&gt; liblog.so --&gt; logd</code>\uff0c\u5e95\u5c42\u4f7f\u7528ring buffer\u6765\u5b58\u50a8\u6570\u636e\u3002 \u83b7\u53d6\u7684\u65b9\u5f0f\u6709\u4ee5\u4e0b\u4e09\u79cd\uff1a </p> <ol> <li> <p>\u901a\u8fc7logcat\u547d\u4ee4\u83b7\u53d6\u3002     \u4f18\u70b9\uff1a\u975e\u5e38\u7b80\u5355\uff0c\u517c\u5bb9\u6027\u597d\u3002     \u7f3a\u70b9\uff1a\u6574\u4e2a\u94fe\u8def\u6bd4\u8f83\u957f\uff0c\u53ef\u63a7\u6027\u5dee\uff0c\u5931\u8d25\u7387\u9ad8\uff0c\u7279\u522b\u662f\u5806\u7834\u574f\u6216\u8005\u5806\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u57fa\u672c\u4f1a\u5931\u8d25\u3002 </p> </li> <li> <p>hook liblog.so\u5b9e\u73b0\u3002\u901a\u8fc7hook liblog.so \u4e2d__android_log_buf_write \u65b9\u6cd5\uff0c\u5c06\u5185\u5bb9\u91cd\u5b9a\u5411\u5230\u81ea\u5df1\u7684buffer\u4e2d\u3002     \u4f18\u70b9\uff1a\u7b80\u5355\uff0c\u517c\u5bb9\u6027\u76f8\u5bf9\u8fd8\u597d\u3002    \u7f3a\u70b9\uff1a\u8981\u4e00\u76f4\u6253\u5f00\u3002   </p> </li> <li>\u81ea\u5b9a\u4e49\u83b7\u53d6\u4ee3\u7801\u3002\u901a\u8fc7\u79fb\u690d\u5e95\u5c42\u83b7\u53d6logcat\u7684\u5b9e\u73b0\uff0c\u901a\u8fc7socket\u76f4\u63a5\u8ddflogd\u4ea4\u4e92\u3002     \u4f18\u70b9\uff1a\u6bd4\u8f83\u7075\u6d3b\uff0c\u9884\u5148\u5206\u914d\u597d\u8d44\u6e90\uff0c\u6210\u529f\u7387\u4e5f\u6bd4\u8f83\u9ad8\u3002     \u7f3a\u70b9\uff1a\u5b9e\u73b0\u975e\u5e38\u590d\u6742 </li> </ol>"},{"location":"perf-opt/Android/crash/crash_op/#222-java","title":"2.2.2 \u83b7\u53d6Java \u5806\u6808","text":"<p>native\u5d29\u6e83\u65f6\uff0c\u901a\u8fc7unwind\u53ea\u80fd\u62ff\u5230Native\u5806\u6808\u3002\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u62ff\u5230\u5f53\u65f6\u5404\u4e2a\u7ebf\u7a0b\u7684Java\u5806\u6808  </p> <ol> <li> <p>Thread.getAllStackTraces()\u3002      \u4f18\u70b9\uff1a\u7b80\u5355\uff0c\u517c\u5bb9\u6027\u597d\u3002      \u7f3a\u70b9\uff1a</p> <ul> <li>\u6210\u529f\u7387\u4e0d\u9ad8\uff0c\u4f9d\u9760\u7cfb\u7edf\u63a5\u53e3\u5728\u6781\u7aef\u60c5\u51b5\u4e5f\u4f1a\u5931\u8d25\u3002        </li> <li>7.0\u4e4b\u540e\u8fd9\u4e2a\u63a5\u53e3\u662f\u6ca1\u6709\u4e3b\u7ebf\u7a0b\u5806\u6808\u3002       </li> <li>\u4f7f\u7528Java\u5c42\u7684\u63a5\u53e3\u9700\u8981\u6682\u505c\u7ebf\u7a0b  </li> </ul> </li> <li> <p>hook libart.so\u3002\u901a\u8fc7hook ThreadList\u548cThread\u7684\u51fd\u6570\uff0c\u83b7\u5f97\u8ddfANR\u4e00\u6837\u7684\u5806\u6808\u3002\u4e3a\u4e86\u7a33\u5b9a\u6027\uff0c\u6211\u4eec\u4f1a\u5728fork\u5b50\u8fdb\u7a0b\u6267\u884c\u3002    \u4f18\u70b9\uff1a\u4fe1\u606f\u5f88\u5168\uff0c\u57fa\u672c\u8ddfANR\u7684\u65e5\u5fd7\u4e00\u6837\uff0c\u6709native\u7ebf\u7a0b\u72b6\u6001\uff0c\u9501\u4fe1\u606f\u7b49\u7b49\u3002    \u7f3a\u70b9\uff1a\u9ed1\u79d1\u6280\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u5931\u8d25\u65f6\u53ef\u4ee5\u7528Thread.getAllStackTraces()\u515c\u5e95</p> </li> </ol>"},{"location":"perf-opt/Android/crash/crash_op/#3","title":"3. \u8861\u91cf\u6307\u6807","text":""},{"location":"perf-opt/Android/crash/crash_op/#31","title":"3.1 \u5982\u4f55\u5ba2\u89c2\u5730\u8861\u91cf\u5d29\u6e83","text":"<p>\u8981\u8861\u91cf\u4e00\u4e2a\u6307\u6807\uff0c\u9996\u5148\u8981\u7edf\u4e00\u8ba1\u7b97\u53e3\u5f84\u3002\u5982\u679c\u60f3\u8bc4\u4f30\u5d29\u6e83\u9020\u6210\u7684\u7528\u6237\u5f71\u54cd\u8303\u56f4\uff0c\u6211\u4eec\u4f1a\u5148\u53bb\u770b UV \u5d29\u6e83\u7387\u3002</p> <pre><code>UV \u5f02\u5e38\u7387 = \u53d1\u751f\u5f02\u5e38\u9000\u51fa\u6216\u5d29\u6e83\u7684 UV / \u767b\u5f55 UV\n</code></pre> <p>\u53ea\u8981\u7528\u6237\u51fa\u73b0\u8fc7\u4e00\u6b21\u5d29\u6e83\u5c31\u4f1a\u88ab\u8ba1\u7b97\u5230\uff0c\u6240\u4ee5 UV \u5d29\u6e83\u7387\u7684\u9ad8\u4f4e\u4f1a\u8ddf\u5e94\u7528\u7684\u4f7f\u7528\u65f6\u957f\u6709\u6bd4\u8f83\u5927\u7684\u5173\u7cfb\u3002\u6211\u4eec\u8fd8\u53ef\u4ee5\u53bb\u770b\u5e94\u7528 PV \u5d29\u6e83\u7387\u3001\u542f\u52a8\u5d29\u6e83\u7387\u3001\u91cd\u590d\u5d29\u6e83\u7387\u8fd9\u4e9b\u6307\u6807\uff0c\u8ba1\u7b97\u65b9\u6cd5\u90fd\u5927\u540c\u5c0f\u5f02\u3002</p> <p>\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u8981\u5355\u72ec\u7edf\u8ba1\u542f\u52a8\u5d29\u6e83\u7387\u5462\uff1f\u56e0\u4e3a\u542f\u52a8\u5d29\u6e83\u5bf9\u7528\u6237\u5e26\u6765\u7684\u4f24\u5bb3\u6700\u5927\uff0c\u5e94\u7528\u65e0\u6cd5\u542f\u52a8\u5f80\u5f80\u901a\u8fc7\u70ed\u4fee\u590d\u4e5f\u65e0\u6cd5\u62ef\u6551\u3002\u95ea\u5c4f\u5e7f\u544a\u3001\u8fd0\u8425\u6d3b\u52a8\uff0c\u5f88\u591a\u5e94\u7528\u542f\u52a8\u8fc7\u7a0b\u5f02\u5e38\u590d\u6742\uff0c\u53c8\u6d89\u53ca\u5404\u79cd\u8d44\u6e90\u3001\u914d\u7f6e\u4e0b\u53d1\uff0c\u6781\u5176\u5bb9\u6613\u51fa\u73b0\u95ee\u9898\u3002\u5fae\u4fe1\u8bfb\u4e66\u3001\u8611\u83c7\u8857\u3001\u6dd8\u5b9d\u3001\u5929\u732b\u8fd9\u4e9b\u201c\u91cd\u8fd0\u8425\u201d\u7684\u5e94\u7528\u90fd\u6709\u4f7f\u7528\u4e00\u79cd\u53eb\u4f5c\u201c\u5b89\u5168\u6a21\u5f0f\u201d\u7684\u6280\u672f\u6765\u4fdd\u969c\u5ba2\u6237\u7aef\u7684\u542f\u52a8\u6d41\u7a0b\uff0c\u5728\u76d1\u63a7\u5230\u5ba2\u6237\u7aef\u542f\u52a8\u5931\u8d25\u540e\uff0c\u7ed9\u7528\u6237\u81ea\u6551\u7684\u673a\u4f1a\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#32","title":"3.2 \u5982\u4f55\u5ba2\u89c2\u5730\u8861\u91cf\u7a33\u5b9a\u6027","text":"<p>\u5d29\u6e83\u7387\u662f\u4e0d\u662f\u5c31\u80fd\u5b8c\u5168\u7b49\u4ef7\u4e8e\u5e94\u7528\u7684\u7a33\u5b9a\u6027\u5462\uff1f\u7b54\u6848\u662f\u80af\u5b9a\u4e0d\u884c\u3002\u5904\u7406\u4e86\u5d29\u6e83\uff0c\u6211\u4eec\u8fd8\u4f1a\u7ecf\u5e38\u9047\u5230 ANR\uff08Application Not Responding\uff0c\u7a0b\u5e8f\u6ca1\u6709\u54cd\u5e94\uff09\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u901a\u5e38\u6709\u4e24\u79cd\u505a\u6cd5\u53bb\u53d1\u73b0\u5e94\u7528\u4e2d\u7684 ANR \u5f02\u5e38\u3002</p> <ol> <li>\u4f7f\u7528 FileObserver \u76d1\u542c /data/anr/traces.txt \u7684\u53d8\u5316\u3002\u975e\u5e38\u4e0d\u5e78\u7684\u662f\uff0c\u5f88\u591a\u9ad8\u7248\u672c\u7684 ROM\uff0c\u5df2\u7ecf\u6ca1\u6709\u8bfb\u53d6\u8fd9\u4e2a\u6587\u4ef6\u7684\u6743\u9650\u4e86\u3002\u8fd9\u4e2a\u65f6\u5019\u4f60\u53ef\u80fd\u53ea\u80fd\u601d\u8003\u5176\u4ed6\u8def\u5f84\uff0c\u6d77\u5916\u53ef\u4ee5\u4f7f\u7528 Google Play \u670d\u52a1\uff0c\u800c\u56fd\u5185\u5fae\u4fe1\u5229\u7528Hardcoder\u6846\u67b6\uff08HC \u6846\u67b6\u662f\u4e00\u5957\u72ec\u7acb\u4e8e\u5b89\u5353\u7cfb\u7edf\u5b9e\u73b0\u7684\u901a\u4fe1\u6846\u67b6\uff0c\u5b83\u8ba9 App \u548c\u5382\u5546 ROM \u80fd\u591f\u5b9e\u65f6\u201c\u5bf9\u8bdd\u201d\u4e86\uff0c\u76ee\u6807\u5c31\u662f\u5145\u5206\u8c03\u5ea6\u7cfb\u7edf\u8d44\u6e90\u6765\u63d0\u5347 App \u7684\u8fd0\u884c\u901f\u5ea6\u548c\u753b\u8d28\uff0c\u5207\u5b9e\u63d0\u9ad8\u5927\u5bb6\u7684\u624b\u673a\u4f7f\u7528\u4f53\u9a8c\uff09\u5411\u5382\u5546\u83b7\u53d6\u4e86\u66f4\u5927\u7684\u6743\u9650\u3002</li> <li>\u76d1\u63a7\u6d88\u606f\u961f\u5217\u7684\u8fd0\u884c\u65f6\u95f4\u3002\u8fd9\u4e2a\u65b9\u6848\u65e0\u6cd5\u51c6\u786e\u5730\u5224\u65ad\u662f\u5426\u771f\u6b63\u51fa\u73b0\u4e86 ANR \u5f02\u5e38\uff0c\u4e5f\u65e0\u6cd5\u5f97\u5230\u5b8c\u6574\u7684 ANR \u65e5\u5fd7\u3002\u5728\u6211\u770b\u6765\uff0c\u66f4\u5e94\u8be5\u653e\u5230\u5361\u987f\u7684\u6027\u80fd\u8303\u7574\u3002\uff08\u76ee\u524d\u5927\u90e8\u5206ANR\u76d1\u63a7\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff09</li> </ol> <p>ANR\u76d1\u63a7\u53ef\u4ee5\u53c2\u8003\uff1a\u8fd9\u7bc7\u6587\u7ae0</p>"},{"location":"perf-opt/Android/crash/crash_op/#33","title":"3.3 \u5f02\u5e38\u9000\u51fa","text":"<p>\u5728\u8ba8\u8bba\u4ec0\u4e48\u662f\u5f02\u5e38\u9000\u51fa\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u770b\u770b\u90fd\u6709\u54ea\u4e9b\u5e94\u7528\u9000\u51fa\u7684\u60c5\u5f62\u3002</p> <ul> <li>\u4e3b\u52a8\u81ea\u6740\u3002Process.killProcess()\u3001exit() \u7b49\u3002</li> <li>\u5d29\u6e83\u3002\u51fa\u73b0\u4e86 Java \u6216 Native \u5d29\u6e83\u3002</li> <li>\u7cfb\u7edf\u91cd\u542f\uff1b\u7cfb\u7edf\u51fa\u73b0\u5f02\u5e38\u3001\u65ad\u7535\u3001\u7528\u6237\u4e3b\u52a8\u91cd\u542f\u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6bd4\u8f83\u5e94\u7528\u5f00\u673a\u8fd0\u884c\u65f6\u95f4\u662f\u5426\u6bd4\u4e4b\u524d\u8bb0\u5f55\u7684\u503c\u66f4\u5c0f\u3002</li> <li>\u88ab\u7cfb\u7edf\u6740\u6b7b\u3002\u88ab low memory killer \u6740\u6389\u3001\u4ece\u7cfb\u7edf\u7684\u4efb\u52a1\u7ba1\u7406\u5668\u4e2d\u5212\u6389\u7b49\u3002</li> <li>ANR\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u5e94\u7528\u542f\u52a8\u7684\u65f6\u5019\u8bbe\u5b9a\u4e00\u4e2a\u6807\u5fd7\uff0c\u5728\u4e3b\u52a8\u81ea\u6740\u6216\u5d29\u6e83\u540e\u66f4\u65b0\u6807\u5fd7\uff0c\u8fd9\u6837\u4e0b\u6b21\u542f\u52a8\u65f6\u901a\u8fc7\u68c0\u6d4b\u8fd9\u4e2a\u6807\u5fd7\u5c31\u80fd\u786e\u8ba4\u8fd0\u884c\u671f\u95f4\u662f\u5426\u53d1\u751f\u8fc7\u5f02\u5e38\u9000\u51fa\u3002\u5bf9\u5e94\u4e0a\u9762\u7684\u4e94\u79cd\u9000\u51fa\u573a\u666f\uff0c\u6211\u4eec\u6392\u9664\u6389\u4e3b\u52a8\u81ea\u6740\u548c\u5d29\u6e83\uff08\u5d29\u6e83\u4f1a\u5355\u72ec\u7684\u7edf\u8ba1\uff09\u8fd9\u4e24\u79cd\u573a\u666f\uff0c\u5e0c\u671b\u53ef\u4ee5\u76d1\u63a7\u5230\u5269\u4e0b\u4e09\u79cd\u7684\u5f02\u5e38\u9000\u51fa\uff0c\u7406\u8bba\u4e0a\u8fd9\u4e2a\u5f02\u5e38\u6355\u83b7\u673a\u5236\u662f\u53ef\u4ee5\u8fbe\u5230 100% \u8986\u76d6\u7684\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e2a\u5f02\u5e38\u9000\u51fa\u7684\u68c0\u6d4b\uff0c\u53ef\u4ee5\u53cd\u6620\u5982 ANR\u3001low memory killer\u3001\u7cfb\u7edf\u5f3a\u6740\u3001\u6b7b\u673a\u3001\u65ad\u7535\u7b49\u5176\u4ed6\u65e0\u6cd5\u6b63\u5e38\u6355\u83b7\u5230\u7684\u95ee\u9898\u3002\u5f53\u7136\u5f02\u5e38\u7387\u4f1a\u5b58\u5728\u4e00\u4e9b\u8bef\u62a5\uff0c\u6bd4\u5982\u7528\u6237\u4ece\u7cfb\u7edf\u7684\u4efb\u52a1\u7ba1\u7406\u5668\u4e2d\u5212\u6389\u5e94\u7528\u3002\u5bf9\u4e8e\u7ebf\u4e0a\u7684\u5927\u6570\u636e\u6765\u8bf4\uff0c\u8fd8\u662f\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u53d1\u73b0\u4ee3\u7801\u4e2d\u7684\u4e00\u4e9b\u9690\u85cf\u95ee\u9898\u3002</p> <p>\u6240\u4ee5\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u65b0\u7684\u6307\u6807\u6765\u8861\u91cf\u5e94\u7528\u7684\u7a33\u5b9a\u6027\uff0c\u5373\u5f02\u5e38\u7387\u3002</p> <pre><code>UV \u5f02\u5e38\u7387 = \u53d1\u751f\u5f02\u5e38\u9000\u51fa\u6216\u5d29\u6e83\u7684 UV / \u767b\u5f55 UV\n</code></pre> <p>\u6839\u636e\u5e94\u7528\u7684\u524d\u540e\u53f0\u72b6\u6001\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5f02\u5e38\u9000\u51fa\u5206\u4e3a\u524d\u53f0\u5f02\u5e38\u9000\u51fa\u548c\u540e\u53f0\u5f02\u5e38\u9000\u51fa\u3002\u201c\u88ab\u7cfb\u7edf\u6740\u6b7b\u201d\u662f\u540e\u53f0\u5f02\u5e38\u9000\u51fa\u7684\u4e3b\u8981\u539f\u56e0\uff0c\u5f53\u7136\u6211\u4eec\u4f1a**\u66f4\u5173\u6ce8\u524d\u53f0\u7684\u5f02\u5e38\u9000\u51fa**\u7684\u60c5\u51b5\uff0c\u8fd9\u4f1a\u8ddf ANR\u3001OOM \u7b49\u5f02\u5e38\u60c5\u51b5\u6709\u66f4\u5927\u7684\u5173\u8054\u3002\u901a\u8fc7\u5f02\u5e38\u7387\u6211\u4eec\u53ef\u4ee5\u6bd4\u8f83\u5168\u9762\u7684\u8bc4\u4f30\u5e94\u7528\u7684\u7a33\u5b9a\u6027\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#331-gethistoricalprocessexitreasons","title":"3.3.1 getHistoricalProcessExitReasons","text":"<p>\u5728Android 11\u4e2d\uff0cActivityManager\u5f15\u5165\u4e00\u4e2a\u65b0\u7684api\uff1agetHistoricalProcessExitReasons\uff0c\u7528\u4e8e\u62a5\u544a\u8fd1\u671f\u4efb\u4f55\u8fdb\u7a0b\u7ec8\u6b62\u7684\u539f\u56e0\uff08\u5305\u542b\u4e86\u4e0a\u9762\u6240\u63d0\u5230\u7684\u6240\u6709\u5f02\u5e38\u9000\u51fa\u539f\u56e0\uff09\u3002\u5e94\u7528\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u6536\u96c6\u5d29\u6e83\u8bca\u65ad\u4fe1\u606f\uff0c\u4f8b\u5982\u8fdb\u7a0b\u7ec8\u6b62\u662f\u7531\u4e8e ANR\u3001\u5185\u5b58\u95ee\u9898\u8fd8\u662f\u5176\u4ed6\u539f\u56e0\u6240\u81f4\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u65b0\u7684 <code>setProcessStateSummary()</code> \u65b9\u6cd5\u5b58\u50a8\u81ea\u5b9a\u4e49\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u4fbf\u65e5\u540e\u8fdb\u884c\u5206\u6790\u3002</p> <p><code>getHistoricalProcessExitReasons()</code> \u65b9\u6cd5\u4f1a\u8fd4\u56de <code>ApplicationExitInfo</code> \u7c7b\u7684\u5b9e\u4f8b\uff0c\u8be5\u7c7b\u5305\u542b\u4e0e\u5e94\u7528\u8fdb\u7a0b\u7ec8\u6b62\u76f8\u5173\u7684\u4fe1\u606f\u3002\u901a\u8fc7\u5bf9\u6b64\u7c7b\u7684\u5b9e\u4f8b\u8c03\u7528 <code>getReason()</code>\uff0c\u60a8\u53ef\u4ee5\u786e\u5b9a\u5e94\u7528\u8fdb\u7a0b\u7ec8\u6b62\u7684\u539f\u56e0\u3002\u4f8b\u5982\uff0cREASON_CRASH \u7684\u8fd4\u56de\u503c\u8868\u793a\u5e94\u7528\u4e2d\u53d1\u751f\u4e86\u672a\u5904\u7406\u7684\u5f02\u5e38\u3002\u5982\u679c\u5e94\u7528\u9700\u8981\u786e\u4fdd\u9000\u51fa\u4e8b\u4ef6\u7684\u552f\u4e00\u6027\uff0c\u53ef\u4ee5\u4fdd\u7559\u7279\u5b9a\u4e8e\u5e94\u7528\u7684\u6807\u8bc6\u7b26\uff0c\u4f8b\u5982\u57fa\u4e8e<code>getTimestamp()</code> \u65b9\u6cd5\u7684\u65f6\u95f4\u6233\u7684\u54c8\u5e0c\u503c\u3002</p> <pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {\nActivityManager am = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);\nList&lt;ApplicationExitInfo&gt; applicationExitInfos = am.getHistoricalProcessExitReasons(null, 0, 0);\nif (applicationExitInfos == null || applicationExitInfos.size() == 0) {\nreturn;\n}\nlong lastExitTimestamp = getPreferences(0).getLong(PREV_DETECT_TIME_KEY, 0);\nList&lt;ApplicationExitInfo&gt; unprocessedExitInfos = new ArrayList&lt;&gt;();\nfor (ApplicationExitInfo exitInfo : applicationExitInfos) {\nif (exitInfo.getTimestamp() &gt; lastExitTimestamp) {\nunprocessedExitInfos.add(exitInfo);\n} else {\nbreak;\n}\n}\nif (unprocessedExitInfos.size() &gt; 0) {\ngetPreferences(0).edit().putLong(PREV_DETECT_TIME_KEY, unprocessedExitInfos.get(0).getTimestamp())\n.apply();\n}\nfor (ApplicationExitInfo exitInfo : unprocessedExitInfos) {\nLog.e(TAG, String.format(\"Exit reason: %d, description: %s\", exitInfo.getReason(),\nexitInfo.getDescription()));\nif (exitInfo.getReason() == ApplicationExitInfo.REASON_ANR) {\nUUID uuid = UUID.randomUUID();\nString fileName = \"anr_info_\" + uuid.toString() + \".trace\";\nFile outFile = new File(getFilesDir().getAbsolutePath() + \"/\" + fileName);\ntry (InputStream inputStream = exitInfo.getTraceInputStream()) {\ncopyStreamToFile(inputStream, outFile);\n} catch (IOException e) {\nLog.e(TAG, \"copyStreamToFile: \", e);\n}\n// upload the file to server\n}\n}\n}\n</code></pre>"},{"location":"perf-opt/Android/crash/crash_op/#4","title":"4. \u5d29\u6e83\u5206\u6790","text":""},{"location":"perf-opt/Android/crash/crash_op/#41","title":"4.1 \u5d29\u6e83\u73b0\u573a","text":"<p>\u5d29\u6e83\u73b0\u573a\u662f\u6211\u4eec\u7684\u201c\u7b2c\u4e00\u6848\u53d1\u73b0\u573a\u201d\uff0c\u5b83\u4fdd\u7559\u7740\u5f88\u591a\u6709\u4ef7\u503c\u7684\u7ebf\u7d22\u3002\u5728\u8fd9\u91cc\u6211\u4eec\u6316\u6398\u5230\u7684\u4fe1\u606f\u8d8a\u591a\uff0c\u4e0b\u4e00\u6b65\u5206\u6790\u7684\u65b9\u5411\u5c31\u8d8a\u6e05\u6670\uff0c\u800c\u4e0d\u662f\u53bb\u9760\u76f2\u76ee\u731c\u6d4b\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u662f\u6574\u4e2a\u5d29\u6e83\u8fc7\u7a0b\u7684\u201c\u65c1\u89c2\u8005\u201d\uff0c\u4e5f\u662f\u6211\u4eec\u6700\u91cd\u8981\u7684\u201c\u8bc1\u4eba\u201d\u3002\u4e00\u4e2a\u597d\u7684\u5d29\u6e83\u6355\u83b7\u5de5\u5177\u77e5\u9053\u5e94\u8be5\u91c7\u96c6\u54ea\u4e9b\u7cfb\u7edf\u4fe1\u606f\uff0c\u4e5f\u77e5\u9053\u5728\u4ec0\u4e48\u573a\u666f\u8981\u6df1\u5165\u6316\u6398\u54ea\u4e9b\u5185\u5bb9\uff0c\u4ece\u800c\u53ef\u4ee5\u66f4\u597d\u5730\u5e2e\u52a9\u6211\u4eec\u89e3\u51b3\u95ee\u9898\u3002</p> <p>\u90a3\u4e48\u5728\u5d29\u6e83\u73b0\u573a\u5e94\u8be5\u91c7\u96c6\u54ea\u4e9b\u4fe1\u606f\uff1a</p> <ol> <li> <p>\u5d29\u6e83\u4fe1\u606f    \u4ece\u5d29\u6e83\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5d29\u6e83\u6709\u521d\u6b65\u7684\u5224\u65ad\u3002</p> <ul> <li>\u8fdb\u7a0b\u540d\u3001\u7ebf\u7a0b\u540d\u3002\u5d29\u6e83\u7684\u8fdb\u7a0b\u662f\u524d\u53f0\u8fdb\u7a0b\u8fd8\u662f\u540e\u53f0\u8fdb\u7a0b\uff0c\u5d29\u6e83\u662f\u4e0d\u662f\u53d1\u751f\u5728 UI \u7ebf\u7a0b\u3002</li> <li>\u5d29\u6e83\u5806\u6808\u548c\u7c7b\u578b\u3002\u5d29\u6e83\u662f\u5c5e\u4e8e Java \u5d29\u6e83\u3001Native \u5d29\u6e83\uff0c\u8fd8\u662f ANR\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7c7b\u578b\u7684\u5d29\u6e83\u6211\u4eec\u5173\u6ce8\u7684\u70b9\u4e5f\u4e0d\u592a\u4e00\u6837\u3002\u7279\u522b\u9700\u8981\u770b\u5d29\u6e83\u5806\u6808\u7684\u6808\u9876\uff0c\u770b\u5177\u4f53\u5d29\u6e83\u5728\u7cfb\u7edf\u7684\u4ee3\u7801\uff0c\u8fd8\u662f\u6211\u4eec\u81ea\u5df1\u7684\u4ee3\u7801\u91cc\u9762\u3002</li> </ul> </li> <li> <p>\u7cfb\u7edf\u4fe1\u606f    \u7cfb\u7edf\u7684\u4fe1\u606f\u6709\u65f6\u5019\u4f1a\u5e26\u6709\u4e00\u4e9b\u5173\u952e\u7684\u7ebf\u7d22\uff0c\u5bf9\u6211\u4eec\u89e3\u51b3\u95ee\u9898\u6709\u975e\u5e38\u5927\u7684\u5e2e\u52a9\u3002</p> <ul> <li>Logcat\u3002\u8fd9\u91cc\u5305\u62ec\u5e94\u7528\u3001\u7cfb\u7edf\u7684\u8fd0\u884c\u65e5\u5fd7\u3002\u7531\u4e8e\u7cfb\u7edf\u6743\u9650\u95ee\u9898\uff0c\u83b7\u53d6\u5230\u7684 Logcat \u53ef\u80fd\u53ea\u5305\u542b\u4e0e\u5f53\u524d App \u76f8\u5173\u7684\u3002\u5176\u4e2d\u7cfb\u7edf\u7684 <code>event logcat</code> \u4f1a\u8bb0\u5f55 App \u8fd0\u884c\u7684\u4e00\u4e9b\u57fa\u672c\u60c5\u51b5\uff0c\u8bb0\u5f55\u5728\u6587\u4ef6 <code>/system/etc/event-log-tags</code> \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>adb logcat -b events</code> \u67e5\u770b\u3002</li> </ul> <pre><code>system logcat:\n10-25 17:13:47.788 21430 21430 D dalvikvm: Trying to load lib ... event logcat:\n10-25 17:13:47.788 21430 21430 I am_on_resume_called: \u751f\u547d\u5468\u671f\n10-25 17:13:47.788 21430 21430 I am_low_memory: \u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\n10-25 17:13:47.788 21430 21430 I am_destroy_activity: \u9500\u6bc1 Activty\n10-25 17:13:47.888 21430 21430 I am_anr: ANR \u4ee5\u53ca\u539f\u56e0\n10-25 17:13:47.888 21430 21430 I am_kill: APP \u88ab\u6740\u4ee5\u53ca\u539f\u56e0\n</code></pre> <ul> <li> <p>\u673a\u578b\u3001\u7cfb\u7edf\u3001\u5382\u5546\u3001CPU\u3001ABI\u3001Linux \u7248\u672c\u7b49\u3002\u6211\u4eec\u4f1a\u91c7\u96c6\u591a\u8fbe\u51e0\u5341\u4e2a\u7ef4\u5ea6\uff0c\u8fd9\u5bf9\u5bfb\u627e\u5171\u6027\u95ee\u9898\u4f1a\u5f88\u6709\u5e2e\u52a9\u3002</p> </li> <li> <p>\u8bbe\u5907\u72b6\u6001\uff1a\u662f\u5426 root\u3001\u662f\u5426\u662f\u6a21\u62df\u5668\u3002\u4e00\u4e9b\u95ee\u9898\u662f\u7531 Xposed \u6216\u591a\u5f00\u8f6f\u4ef6\u9020\u6210\uff0c\u5bf9\u8fd9\u90e8\u5206\u95ee\u9898\u6211\u4eec\u8981\u533a\u522b\u5bf9\u5f85\u3002</p> </li> </ul> </li> <li> <p>\u5185\u5b58\u4fe1\u606f   OOM\u3001ANR\u3001\u865a\u62df\u5185\u5b58\u8017\u5c3d\u7b49\uff0c\u5f88\u591a\u5d29\u6e83\u90fd\u8ddf\u5185\u5b58\u6709\u76f4\u63a5\u5173\u7cfb\u3002\u5982\u679c\u6211\u4eec\u628a\u7528\u6237\u7684\u624b\u673a\u5185\u5b58\u5206\u4e3a\u201c2GB \u4ee5\u4e0b\u201d\u548c\u201c2GB \u4ee5\u4e0a\u201d\u4e24\u4e2a\u6876\uff0c\u4f1a\u53d1\u73b0\u201c2GB \u4ee5\u4e0b\u201d\u7528\u6237\u7684\u5d29\u6e83\u7387\u662f\u201c2GB \u4ee5\u4e0a\u201d\u7528\u6237\u7684\u51e0\u500d\u3002</p> <ul> <li>\u7cfb\u7edf\u5269\u4f59\u5185\u5b58\u3002\u5173\u4e8e\u7cfb\u7edf\u5185\u5b58\u72b6\u6001\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u6587\u4ef6<code>/proc/meminfo</code>\u3002\u5f53\u7cfb\u7edf\u53ef\u7528\u5185\u5b58\u5f88\u5c0f\uff08\u4f4e\u4e8e MemTotal \u7684 10%\uff09\u65f6\uff0cOOM\u3001\u5927\u91cf GC\u3001\u7cfb\u7edf\u9891\u7e41\u81ea\u6740\u62c9\u8d77\u7b49\u95ee\u9898\u90fd\u975e\u5e38\u5bb9\u6613\u51fa\u73b0\u3002</li> <li>\u5e94\u7528\u4f7f\u7528\u5185\u5b58\u3002\u5305\u62ec Java \u5185\u5b58\u3001<code>RSS\uff08Resident Set Size\uff09</code>\u3001<code>PSS\uff08Proportional Set Size\uff09</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u5e94\u7528\u672c\u8eab\u5185\u5b58\u7684\u5360\u7528\u5927\u5c0f\u548c\u5206\u5e03\u3002PSS \u548c RSS \u901a\u8fc7 <code>/proc/self/smap</code> \u8ba1\u7b97\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5f97\u5230\u4f8b\u5982 apk\u3001dex\u3001so \u7b49\u66f4\u52a0\u8be6\u7ec6\u7684\u5206\u7c7b\u7edf\u8ba1\u3002</li> <li>\u865a\u62df\u5185\u5b58\u3002\u865a\u62df\u5185\u5b58\u53ef\u4ee5\u901a\u8fc7 <code>/proc/self/status</code> \u5f97\u5230\uff0c\u901a\u8fc7 <code>/proc/self/maps</code> \u6587\u4ef6\u53ef\u4ee5\u5f97\u5230\u5177\u4f53\u7684\u5206\u5e03\u60c5\u51b5\u3002\u6709\u65f6\u5019\u6211\u4eec\u4e00\u822c\u4e0d\u592a\u91cd\u89c6\u865a\u62df\u5185\u5b58\uff0c\u4f46\u662f\u5f88\u591a\u7c7b\u4f3c OOM\u3001tgkill \u7b49\u95ee\u9898\u90fd\u662f\u865a\u62df\u5185\u5b58\u4e0d\u8db3\u5bfc\u81f4\u7684\u3002 <pre><code>Name:     com.sample.name   // \u8fdb\u7a0b\u540d\nFDSize:   800               // \u5f53\u524d\u8fdb\u7a0b\u7533\u8bf7\u7684\u6587\u4ef6\u53e5\u67c4\u4e2a\u6570\nVmPeak:   3004628 kB        // \u5f53\u524d\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u5cf0\u503c\u5927\u5c0f\nVmSize:   2997032 kB        // \u5f53\u524d\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u5927\u5c0f\nThreads:  600               // \u5f53\u524d\u8fdb\u7a0b\u5305\u542b\u7684\u7ebf\u7a0b\u4e2a\u6570\n</code></pre>   \u4e00\u822c\u6765\u8bf4\uff0c\u5bf9\u4e8e 32 \u4f4d\u8fdb\u7a0b\uff0c\u5982\u679c\u662f 32 \u4f4d\u7684 CPU\uff0c\u865a\u62df\u5185\u5b58\u8fbe\u5230 3GB \u5c31\u53ef\u80fd\u4f1a\u5f15\u8d77\u5185\u5b58\u7533\u8bf7\u5931\u8d25\u7684\u95ee\u9898\u3002\u5982\u679c\u662f 64 \u4f4d\u7684 CPU\uff0c\u865a\u62df\u5185\u5b58\u4e00\u822c\u5728 3\uff5e4GB \u4e4b\u95f4\u3002\u5f53\u7136\u5982\u679c\u6211\u4eec\u652f\u6301 64 \u4f4d\u8fdb\u7a0b\uff0c\u865a\u62df\u5185\u5b58\u5c31\u4e0d\u4f1a\u6210\u4e3a\u95ee\u9898\u3002Google Play \u8981\u6c42 2019 \u5e74 8 \u6708\u4e00\u5b9a\u8981\u652f\u6301 64 \u4f4d\uff0c\u5728\u56fd\u5185\u867d\u7136\u652f\u6301 64 \u4f4d\u7684\u8bbe\u5907\u5df2\u7ecf\u5728 90% \u4ee5\u4e0a\u4e86\uff0c\u4f46\u662f\u5546\u5e97\u90fd\u4e0d\u652f\u6301\u533a\u5206 CPU \u67b6\u6784\u7c7b\u578b\u53d1\u5e03\uff0c\u666e\u53ca\u8d77\u6765\u9700\u8981\u66f4\u957f\u7684\u65f6\u95f4\u3002</li> </ul> </li> <li> <p>\u8d44\u6e90\u4fe1\u606f   \u6709\u7684\u65f6\u5019\u6211\u4eec\u4f1a\u53d1\u73b0\u5e94\u7528\u5806\u5185\u5b58\u548c\u8bbe\u5907\u5185\u5b58\u90fd\u975e\u5e38\u5145\u8db3\uff0c\u8fd8\u662f\u4f1a\u51fa\u73b0\u5185\u5b58\u5206\u914d\u5931\u8d25\u7684\u60c5\u51b5\uff0c\u8fd9\u8ddf\u8d44\u6e90\u6cc4\u6f0f\u53ef\u80fd\u6709\u6bd4\u8f83\u5927\u7684\u5173\u7cfb</p> <ul> <li> <p>\u6587\u4ef6\u53e5\u67c4 fd\u3002\u6587\u4ef6\u53e5\u67c4\u7684\u9650\u5236\u53ef\u4ee5\u901a\u8fc7 <code>/proc/self/limits</code> \u83b7\u5f97\uff0c\u4e00\u822c\u5355\u4e2a\u8fdb\u7a0b\u5141\u8bb8\u6253\u5f00\u7684\u6700\u5927\u6587\u4ef6\u53e5\u67c4\u4e2a\u6570\u4e3a 1024\uff08\u8f83\u65b0\u6b3e\u7684Android\u8fd9\u4e2a\u503c\u88ab\u6539\u4e3a32768\uff09\u3002\u4f46\u662f\u5982\u679c\u6587\u4ef6\u53e5\u67c4\u8d85\u8fc7 800 \u4e2a\u5c31\u6bd4\u8f83\u5371\u9669\uff0c\u9700\u8981\u5c06\u6240\u6709\u7684 fd \u4ee5\u53ca\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\u8f93\u51fa\u5230\u65e5\u5fd7\u4e2d\uff0c\u8fdb\u4e00\u6b65\u6392\u67e5\u662f\u5426\u51fa\u73b0\u4e86\u6709\u6587\u4ef6\u6216\u8005\u7ebf\u7a0b\u7684\u6cc4\u6f0f\u3002 <pre><code>opened files count 812:\n0 -&gt; /dev/null\n1 -&gt; /dev/log/main4 2 -&gt; /dev/binder\n3 -&gt; /data/data/com.crash.sample/files/test.config\n...\n</code></pre></p> </li> <li> <p>\u7ebf\u7a0b\u6570\u3002\u5f53\u524d\u7ebf\u7a0b\u6570\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7\u4e0a\u9762\u7684 status \u6587\u4ef6\u5f97\u5230\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u80fd\u5c31\u5360 2MB \u7684\u865a\u62df\u5185\u5b58\uff0c\u8fc7\u591a\u7684\u7ebf\u7a0b\u4f1a\u5bf9\u865a\u62df\u5185\u5b58\u548c\u6587\u4ef6\u53e5\u67c4\u5e26\u6765\u538b\u529b\u3002\u6839\u636e\u6211\u7684\u7ecf\u9a8c\u6765\u8bf4\uff0c\u5982\u679c\u7ebf\u7a0b\u6570\u8d85\u8fc7 400 \u4e2a\u5c31\u6bd4\u8f83\u5371\u9669\u3002\u9700\u8981\u5c06\u6240\u6709\u7684\u7ebf\u7a0b id \u4ee5\u53ca\u5bf9\u5e94\u7684\u7ebf\u7a0b\u540d\u8f93\u51fa\u5230\u65e5\u5fd7\u4e2d\uff0c\u8fdb\u4e00\u6b65\u6392\u67e5\u662f\u5426\u51fa\u73b0\u4e86\u7ebf\u7a0b\u76f8\u5173\u7684\u95ee\u9898\u3002  <pre><code>threads count 412:               1820 com.sample.crashsdk                         1844 ReferenceQueueD                                             1869 FinalizerDaemon   ...\n</code></pre></p> </li> <li> <p>JNI\u3002\u4f7f\u7528 JNI \u65f6\uff0c\u5982\u679c\u4e0d\u6ce8\u610f\u5f88\u5bb9\u6613\u51fa\u73b0\u5f15\u7528\u5931\u6548\u3001\u5f15\u7528\u7206\u8868\u7b49\u4e00\u4e9b\u5d29\u6e83\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>DumpReferenceTables</code> \u7edf\u8ba1 JNI \u7684\u5f15\u7528\u8868\uff0c\u8fdb\u4e00\u6b65\u5206\u6790\u662f\u5426\u51fa\u73b0\u4e86 JNI \u6cc4\u6f0f\u7b49\u95ee\u9898\u3002  <pre><code>Java_com_android_geektime_MainActivity_testInitLocalRef(JNIEnv *env, jobject thiz) {\n// \u6807\u8bb0\njstring pMark = env-&gt;NewStringUTF(\"I'm a mark\");\n// \u5f3a\u5236\u8fdb\u884c reference table dump\n// \u67e5\u627e\u4e86\u4e00\u6b21VMDebug\u7c7b\uff0c\u4f1a\u6dfb\u52a0\u5230local ref table\u4e2d\njclass vm_class = env-&gt;FindClass(\"dalvik/system/VMDebug\");\njmethodID dump_mid = env-&gt;GetStaticMethodID(vm_class, \"dumpReferenceTables\", \"()V\");\nenv-&gt;CallStaticVoidMethod(vm_class, dump_mid);\n}\n</code></pre></p> </li> </ul> </li> <li> <p>\u5e94\u7528\u4fe1\u606f</p> <ul> <li>\u5d29\u6e83\u573a\u666f\u3002\u5d29\u6e83\u53d1\u751f\u5728\u54ea\u4e2a Activity \u6216 Fragment\uff0c\u53d1\u751f\u5728\u54ea\u4e2a\u4e1a\u52a1\u4e2d\u3002</li> <li>\u5173\u952e\u64cd\u4f5c\u8def\u5f84\u3002\u4e0d\u540c\u4e8e\u5f00\u53d1\u8fc7\u7a0b\u8be6\u7ec6\u7684\u6253\u70b9\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55\u5173\u952e\u7684\u7528\u6237\u64cd\u4f5c\u8def\u5f84\uff0c\u8fd9\u5bf9\u6211\u4eec\u590d\u73b0\u5d29\u6e83\u4f1a\u6709\u6bd4\u8f83\u5927\u7684\u5e2e\u52a9\u3002</li> <li>\u5176\u4ed6\u81ea\u5b9a\u4e49\u4fe1\u606f\u3002\u4e0d\u540c\u7684\u5e94\u7528\u5173\u5fc3\u7684\u91cd\u70b9\u53ef\u80fd\u4e0d\u592a\u4e00\u6837\uff0c\u6bd4\u5982\u7f51\u6613\u4e91\u97f3\u4e50\u4f1a\u5173\u6ce8\u5f53\u524d\u64ad\u653e\u7684\u97f3\u4e50\uff0cQQ \u6d4f\u89c8\u5668\u4f1a\u5173\u6ce8\u5f53\u524d\u6253\u5f00\u7684\u7f51\u5740\u6216\u89c6\u9891\u3002\u6b64\u5916\u4f8b\u5982\u8fd0\u884c\u65f6\u95f4\u3001\u662f\u5426\u52a0\u8f7d\u4e86\u8865\u4e01\u3001\u662f\u5426\u662f\u5168\u65b0\u5b89\u88c5\u6216\u5347\u7ea7\u7b49\u4fe1\u606f\u4e5f\u975e\u5e38\u91cd\u8981\u3002</li> </ul> </li> </ol> <p>\u9664\u4e86\u4e0a\u9762\u8fd9\u4e9b\u901a\u7528\u7684\u4fe1\u606f\u5916\uff0c\u9488\u5bf9\u7279\u5b9a\u7684\u4e00\u4e9b\u5d29\u6e83\uff0c\u6211\u4eec\u53ef\u80fd\u8fd8\u9700\u8981\u83b7\u53d6\u7c7b\u4f3c\u78c1\u76d8\u7a7a\u95f4\u3001\u7535\u91cf\u3001\u7f51\u7edc\u4f7f\u7528\u7b49\u7279\u5b9a\u4fe1\u606f\u3002\u6240\u4ee5\u8bf4\u4e00\u4e2a\u597d\u7684\u5d29\u6e83\u6355\u83b7\u5de5\u5177\uff0c\u4f1a\u6839\u636e\u573a\u666f\u4e3a\u6211\u4eec\u91c7\u96c6\u8db3\u591f\u591a\u7684\u4fe1\u606f\uff0c\u8ba9\u6211\u4eec\u6709\u66f4\u591a\u7684\u7ebf\u7d22\u53bb\u5206\u6790\u548c\u5b9a\u4f4d\u95ee\u9898\u3002\u5f53\u7136\u6570\u636e\u7684\u91c7\u96c6\u9700\u8981\u6ce8\u610f\u7528\u6237\u9690\u79c1\uff0c\u505a\u5230\u8db3\u591f\u5f3a\u5ea6\u7684\u52a0\u5bc6\u548c\u8131\u654f\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#5","title":"5.\u5d29\u6e83\u5206\u6790","text":""},{"location":"perf-opt/Android/crash/crash_op/#51","title":"5.1 \u7b2c\u4e00\u6b65\uff1a\u786e\u5b9a\u91cd\u70b9","text":"<p>\u786e\u8ba4\u548c\u5206\u6790\u91cd\u70b9\uff0c\u5173\u952e\u5728\u4e8e\u5728\u65e5\u5fd7\u4e2d\u627e\u5230\u91cd\u8981\u7684\u4fe1\u606f\uff0c\u5bf9\u95ee\u9898\u6709\u4e00\u4e2a\u5927\u81f4\u5224\u65ad\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u5efa\u8bae\u5728\u786e\u5b9a\u91cd\u70b9\u8fd9\u4e00\u6b65\u53ef\u4ee5\u5173\u6ce8\u4ee5\u4e0b\u51e0\u70b9\u3002</p> <ol> <li>\u786e\u8ba4\u4e25\u91cd\u7a0b\u5ea6\u3002\u89e3\u51b3\u5d29\u6e83\u4e5f\u8981\u770b\u6027\u4ef7\u6bd4\uff0c\u6211\u4eec\u4f18\u5148\u89e3\u51b3 Top \u5d29\u6e83\u6216\u8005\u5bf9\u4e1a\u52a1\u6709\u91cd\u5927\u5f71\u54cd\uff0c\u4f8b\u5982\u542f\u52a8\u3001\u652f\u4ed8\u8fc7\u7a0b\u7684\u5d29\u6e83\u3002</li> <li>\u5d29\u6e83\u57fa\u672c\u4fe1\u606f\u3002\u786e\u5b9a\u5d29\u6e83\u7684\u7c7b\u578b\u4ee5\u53ca\u5f02\u5e38\u63cf\u8ff0\uff0c\u5bf9\u5d29\u6e83\u6709\u5927\u81f4\u7684\u5224\u65ad\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5927\u90e8\u5206\u7684\u7b80\u5355\u5d29\u6e83\u7ecf\u8fc7\u8fd9\u4e00\u6b65\u5df2\u7ecf\u53ef\u4ee5\u5f97\u5230\u7ed3\u8bba\u3002<ul> <li>Java \u5d29\u6e83\u3002Java \u5d29\u6e83\u7c7b\u578b\u6bd4\u8f83\u660e\u663e\uff0c\u6bd4\u5982 <code>NullPointerException</code> \u662f\u7a7a\u6307\u9488\uff0c<code>OutOfMemoryError</code> \u662f\u8d44\u6e90\u4e0d\u8db3\uff0c\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u53bb\u8fdb\u4e00\u6b65\u67e5\u770b\u65e5\u5fd7\u4e2d\u7684 \u201c\u5185\u5b58\u4fe1\u606f\u201d\u548c\u201c\u8d44\u6e90\u4fe1\u606f\u201d\u3002</li> <li>Native \u5d29\u6e83\u3002\u9700\u8981\u89c2\u5bdf <code>signal</code>\u3001<code>code</code>\u3001<code>fault addr</code> \u7b49\u5185\u5bb9\uff0c\u4ee5\u53ca\u5d29\u6e83\u65f6 Java \u7684\u5806\u6808\u3002\u5173\u4e8e\u5404 signal \u542b\u4e49\u7684\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u67e5\u770b\u5d29\u6e83\u4fe1\u53f7\u4ecb\u7ecd\u3002\u6bd4\u8f83\u5e38\u89c1\u7684\u662f\u6709 SIGSEGV \u548c SIGABRT\uff0c\u524d\u8005\u4e00\u822c\u662f\u7531\u4e8e\u7a7a\u6307\u9488\u3001\u975e\u6cd5\u6307\u9488\u9020\u6210\uff0c\u540e\u8005\u4e3b\u8981\u56e0\u4e3a ANR \u548c\u8c03\u7528 abort() \u9000\u51fa\u6240\u5bfc\u81f4\u3002</li> <li>ANR\u3002\u6211\u7684\u7ecf\u9a8c\u662f\uff0c\u5148\u770b\u770b\u4e3b\u7ebf\u7a0b\u7684\u5806\u6808\uff0c\u662f\u5426\u662f\u56e0\u4e3a\u9501\u7b49\u5f85\u5bfc\u81f4\u3002\u63a5\u7740\u770b\u770b ANR \u65e5\u5fd7\u4e2d iowait\u3001CPU\u3001GC\u3001system server \u7b49\u4fe1\u606f\uff0c\u8fdb\u4e00\u6b65\u786e\u5b9a\u662f I/O \u95ee\u9898\uff0c\u6216\u662f CPU \u7ade\u4e89\u95ee\u9898\uff0c\u8fd8\u662f\u7531\u4e8e\u5927\u91cf GC \u5bfc\u81f4\u5361\u6b7b\u3002</li> </ul> </li> <li>Logcat\u3002Logcat \u4e00\u822c\u4f1a\u5b58\u5728\u4e00\u4e9b\u6709\u4ef7\u503c\u7684\u7ebf\u7d22\uff0c\u65e5\u5fd7\u7ea7\u522b\u662f Warning\u3001Error \u7684\u9700\u8981\u7279\u522b\u6ce8\u610f\u3002\u4ece Logcat \u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5f53\u65f6\u7cfb\u7edf\u7684\u4e00\u4e9b\u884c\u4e3a\u8ddf\u624b\u673a\u7684\u72b6\u6001\uff0c\u4f8b\u5982\u51fa\u73b0 ANR \u65f6\uff0c\u4f1a\u6709\u201cam_anr\u201d\uff1bApp \u88ab\u6740\u65f6\uff0c\u4f1a\u6709\u201cam_kill\u201d\u3002\u4e0d\u540c\u7684\u7cfb\u7edf\u3001\u5382\u5546\u8f93\u51fa\u7684\u65e5\u5fd7\u6709\u6240\u5dee\u522b\uff0c\u5f53\u4ece\u4e00\u6761\u5d29\u6e83\u65e5\u5fd7\u4e2d\u65e0\u6cd5\u770b\u51fa\u95ee\u9898\u7684\u539f\u56e0\uff0c\u6216\u8005\u5f97\u4e0d\u5230\u6709\u7528\u4fe1\u606f\u65f6\uff0c\u4e0d\u8981\u653e\u5f03\uff0c\u5efa\u8bae\u67e5\u770b\u76f8\u540c\u5d29\u6e83\u70b9\u4e0b\u7684\u66f4\u591a\u5d29\u6e83\u65e5\u5fd7\u3002</li> <li>\u5404\u4e2a\u8d44\u6e90\u60c5\u51b5\u3002\u7ed3\u5408\u5d29\u6e83\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u6211\u4eec\u63a5\u7740\u770b\u770b\u662f\u4e0d\u662f\u8ddf \u201c\u5185\u5b58\u4fe1\u606f\u201d \u6709\u5173\uff0c\u662f\u4e0d\u662f\u8ddf\u201c\u8d44\u6e90\u4fe1\u606f\u201d\u6709\u5173\u3002\u6bd4\u5982\u662f\u7269\u7406\u5185\u5b58\u4e0d\u8db3\u3001\u865a\u62df\u5185\u5b58\u4e0d\u8db3\uff0c\u8fd8\u662f\u6587\u4ef6\u53e5\u67c4 fd \u6cc4\u6f0f\u4e86\u3002</li> </ol> <p>\u65e0\u8bba\u662f\u8d44\u6e90\u6587\u4ef6\u8fd8\u662f Logcat\uff0c\u5185\u5b58\u4e0e\u7ebf\u7a0b\u76f8\u5173\u7684\u4fe1\u606f\u90fd\u9700\u8981\u7279\u522b\u6ce8\u610f\uff0c\u5f88\u591a\u5d29\u6e83\u90fd\u662f\u7531\u4e8e\u5b83\u4eec\u4f7f\u7528\u4e0d\u5f53\u9020\u6210\u7684\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#52","title":"5.2 \u7b2c\u4e8c\u6b65\uff1a\u67e5\u627e\u5171\u6027","text":"<p>\u5982\u679c\u4f7f\u7528\u4e86\u4e0a\u9762\u7684\u65b9\u6cd5\u8fd8\u662f\u4e0d\u80fd\u6709\u6548\u5b9a\u4f4d\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u67e5\u627e\u8fd9\u7c7b\u5d29\u6e83\u6709\u6ca1\u6709\u4ec0\u4e48\u5171\u6027\u3002\u627e\u5230\u4e86\u5171\u6027\uff0c\u4e5f\u5c31\u53ef\u4ee5\u8fdb\u4e00\u6b65\u627e\u5230\u5dee\u5f02\uff0c\u79bb\u89e3\u51b3\u95ee\u9898\u4e5f\u5c31\u66f4\u8fdb\u4e00\u6b65\u3002</p> <p>\u673a\u578b\u3001\u7cfb\u7edf\u3001ROM\u3001\u5382\u5546\u3001ABI\uff0c\u8fd9\u4e9b\u91c7\u96c6\u5230\u7684\u7cfb\u7edf\u4fe1\u606f\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u7ef4\u5ea6\u805a\u5408\uff0c\u5171\u6027\u95ee\u9898\u4f8b\u5982\u662f\u4e0d\u662f\u56e0\u4e3a\u5b89\u88c5\u4e86 Xposed\uff0c\u662f\u4e0d\u662f\u53ea\u51fa\u73b0\u5728 x86 \u7684\u624b\u673a\uff0c\u662f\u4e0d\u662f\u53ea\u6709\u4e09\u661f\u8fd9\u6b3e\u673a\u578b\uff0c\u662f\u4e0d\u662f\u53ea\u5728 Android 5.0 \u7684\u7cfb\u7edf\u4e0a\u3002\u5e94\u7528\u4fe1\u606f\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u7ef4\u5ea6\u6765\u805a\u5408\uff0c\u6bd4\u5982\u6b63\u5728\u6253\u5f00\u7684\u94fe\u63a5\u3001\u6b63\u5728\u64ad\u653e\u7684\u89c6\u9891\u3001\u56fd\u5bb6\u3001\u5730\u533a\u7b49\u3002</p> <p>\u627e\u5230\u4e86\u5171\u6027\uff0c\u53ef\u4ee5\u5bf9\u4f60\u4e0b\u4e00\u6b65\u590d\u73b0\u95ee\u9898\u6709\u66f4\u660e\u786e\u7684\u6307\u5f15\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#53","title":"5.3 \u7b2c\u4e09\u6b65\uff1a\u5c1d\u8bd5\u590d\u73b0","text":"<p>\u5982\u679c\u6211\u4eec\u5df2\u7ecf\u5927\u6982\u77e5\u9053\u4e86\u5d29\u6e83\u7684\u539f\u56e0\uff0c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u786e\u8ba4\u66f4\u591a\u4fe1\u606f\uff0c\u5c31\u9700\u8981\u5c1d\u8bd5\u590d\u73b0\u5d29\u6e83\u3002\u5982\u679c\u6211\u4eec\u5bf9\u5d29\u6e83\u5b8c\u5168\u6ca1\u6709\u5934\u7eea\uff0c\u4e5f\u5e0c\u671b\u901a\u8fc7\u7528\u6237\u64cd\u4f5c\u8def\u5f84\u6765\u5c1d\u8bd5\u91cd\u73b0\uff0c\u7136\u540e\u518d\u53bb\u5206\u6790\u5d29\u6e83\u539f\u56e0\u3002</p> <p>\u201c\u53ea\u8981\u80fd\u672c\u5730\u590d\u73b0\uff0c\u6211\u5c31\u80fd\u89e3\u201d\uff0c\u76f8\u4fe1\u8fd9\u662f\u5f88\u591a\u5f00\u53d1\u8ddf\u6d4b\u8bd5\u8bf4\u8fc7\u7684\u8bdd\u3002\u6709\u8fd9\u6837\u7684\u5e95\u6c14\u4e3b\u8981\u662f\u56e0\u4e3a\u5728\u7a33\u5b9a\u7684\u590d\u73b0\u8def\u5f84\u4e0a\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u589e\u52a0\u65e5\u5fd7\u6216\u4f7f\u7528 Debugger\u3001GDB \u7b49\u5404\u79cd\u5404\u6837\u7684\u624b\u6bb5\u6216\u5de5\u5177\u505a\u8fdb\u4e00\u6b65\u5206\u6790\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#54","title":"5.4 \u7591\u96be\u95ee\u9898\uff1a\u7cfb\u7edf\u5d29\u6e83","text":"<p>\u7cfb\u7edf\u5d29\u6e83\u5e38\u5e38\u4ee4\u6211\u4eec\u611f\u5230\u975e\u5e38\u65e0\u52a9\uff0c\u5b83\u53ef\u80fd\u662f\u67d0\u4e2a Android \u7248\u672c\u7684 bug\uff0c\u4e5f\u53ef\u80fd\u662f\u67d0\u4e2a\u5382\u5546\u4fee\u6539 ROM \u5bfc\u81f4\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u5d29\u6e83\u5806\u6808\u53ef\u80fd\u5b8c\u5168\u6ca1\u6709\u6211\u4eec\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u5f88\u96be\u76f4\u63a5\u5b9a\u4f4d\u95ee\u9898\u3002\u9488\u5bf9\u8fd9\u79cd\u7591\u96be\u95ee\u9898\uff0c\u6211\u6765\u8c08\u8c08\u6211\u7684\u89e3\u51b3\u601d\u8def\u3002</p> <ol> <li> <p>\u67e5\u627e\u53ef\u80fd\u7684\u539f\u56e0\u3002\u901a\u8fc7\u4e0a\u9762\u7684\u5171\u6027\u5f52\u7c7b\uff0c\u6211\u4eec\u5148\u770b\u770b\u662f\u67d0\u4e2a\u7cfb\u7edf\u7248\u672c\u7684\u95ee\u9898\uff0c\u8fd8\u662f\u67d0\u4e2a\u5382\u5546\u7279\u5b9a ROM \u7684\u95ee\u9898\u3002\u867d\u7136\u5d29\u6e83\u65e5\u5fd7\u53ef\u80fd\u6ca1\u6709\u6211\u4eec\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u4f46\u901a\u8fc7\u64cd\u4f5c\u8def\u5f84\u548c\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u4e00\u4e9b\u6000\u7591\u7684\u70b9\u3002</p> </li> <li> <p>\u5c1d\u8bd5\u89c4\u907f\u3002\u67e5\u770b\u53ef\u7591\u7684\u4ee3\u7801\u8c03\u7528\uff0c\u662f\u5426\u4f7f\u7528\u4e86\u4e0d\u6070\u5f53\u7684 API\uff0c\u662f\u5426\u53ef\u4ee5\u66f4\u6362\u5176\u4ed6\u7684\u5b9e\u73b0\u65b9\u5f0f\u89c4\u907f\u3002</p> </li> <li> <p>Hook \u89e3\u51b3\u3002\u8fd9\u91cc\u5206\u4e3a <code>Java Hook</code> \u548c <code>Native Hook</code>\u3002\u4ee5\u6211\u6700\u8fd1\u89e3\u51b3\u7684\u4e00\u4e2a\u7cfb\u7edf\u5d29\u6e83\u4e3a\u4f8b\uff0c\u6211\u4eec\u53d1\u73b0\u7ebf\u4e0a\u51fa\u73b0\u4e00\u4e2a Toast \u76f8\u5173\u7684\u7cfb\u7edf\u5d29\u6e83\uff0c\u5b83\u53ea\u51fa\u73b0\u5728 Android 7.0 \u7684\u7cfb\u7edf\u4e2d\uff0c\u770b\u8d77\u6765\u662f\u5728 Toast \u663e\u793a\u7684\u65f6\u5019\u7a97\u53e3\u7684 token \u5df2\u7ecf\u65e0\u6548\u4e86\u3002\u8fd9\u6709\u53ef\u80fd\u51fa\u73b0\u5728 Toast \u9700\u8981\u663e\u793a\u65f6\uff0c\u7a97\u53e3\u5df2\u7ecf\u9500\u6bc1\u4e86\u3002</p> </li> </ol> <pre><code>android.view.WindowManager$BadTokenException: at android.view.ViewRootImpl.setView(ViewRootImpl.java)\nat android.view.WindowManagerGlobal.addView(WindowManagerGlobal.java)\nat android.view.WindowManagerImpl.addView(WindowManagerImpl.java4)\nat android.widget.Toast$TN.handleShow(Toast.java)\n</code></pre> <p>\u4e3a\u4ec0\u4e48 Android 8.0 \u7684\u7cfb\u7edf\u4e0d\u4f1a\u6709\u8fd9\u4e2a\u95ee\u9898\uff1f\u5728\u67e5\u770b Android 8.0 \u7684\u6e90\u7801\u540e\u6211\u4eec\u53d1\u73b0\u6709\u4ee5\u4e0b\u4fee\u6539\uff1a</p> <pre><code>try {\nmWM.addView(mView, mParams);\ntrySendAccessibilityEvent();\n} catch (WindowManager.BadTokenException e) {\n/* ignore */\n}\n</code></pre> <p>\u8003\u8651\u518d\u4e09\uff0c\u6211\u4eec\u51b3\u5b9a\u53c2\u8003 Android 8.0 \u7684\u505a\u6cd5\uff0c\u76f4\u63a5 catch \u4f4f\u8fd9\u4e2a\u5f02\u5e38\u3002\u8fd9\u91cc\u7684\u5173\u952e\u5728\u4e8e\u5bfb\u627e Hook \u70b9\uff0c\u8fd9\u4e2a\u6848\u4f8b\u7b97\u662f\u76f8\u5bf9\u6bd4\u8f83\u7b80\u5355\u7684\u3002Toast \u91cc\u9762\u6709\u4e00\u4e2a\u53d8\u91cf\u53eb mTN\uff0c\u5b83\u7684\u7c7b\u578b\u4e3a handler\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4ee3\u7406\u5b83\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6355\u83b7\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#6","title":"6.\u5d29\u6e83\u9632\u62a4","text":"<p>\u5f88\u591a\u65f6\u5019\u7531\u4e8e\u4e00\u4e9b\u5fae\u4e0d\u8db3\u9053\u7684bug\u5bfc\u81f4app\u5d29\u6e83\u5f88\u53ef\u60dc\uff0candroid\u9ed8\u8ba4\u7684\u5f02\u5e38\u6740\u8fdb\u7a0b\u673a\u5236\u7b80\u5355\u7c97\u66b4\uff0c\u4f46\u5f88\u591a\u65f6\u5019\u8ba9app\u5d29\u6e83\u5176\u5b9e\u4e5f\u5e76\u4e0d\u80fd\u89e3\u51b3\u95ee\u9898\u3002</p> <p>\u6709\u4e9bbug\u53ef\u80fd\u662f\u7cfb\u7edfbug\uff0c\u5bf9\u4e8e\u8fd9\u4e9b\u96be\u4ee5\u9884\u6599\u7684\u7cfb\u7edfbug\u6211\u4eec\u4e0d\u597d\u7ed5\u8fc7\uff0c\u8fd8\u6709\u4e00\u4e9bbug\u662f\u6211\u4eec\u81ea\u5df1\u7f16\u7801\u9020\u6210\u7684\uff0c\u5bf9\u4e8e\u6709\u4e9bbug\u6765\u8bf4\u76f4\u63a5\u5ffd\u7565\u6389\u7684\u8bdd\u53ef\u80fd\u53ea\u662f\u5bfc\u81f4\u90e8\u5206\u4e0d\u91cd\u8981\u7684\u529f\u80fd\u6ca1\u6cd5\u4f7f\u7528\u800c\u5df2\uff0c\u53c8\u6216\u8005\u5bf9\u7528\u6237\u6765\u8bf4\u5b8c\u5168\u6ca1\u6709\u5f71\u54cd\uff0c\u8fd9\u79cd\u60c5\u51b5\u603b\u6bd4\u6bcf\u6b21\u90fd\u5d29\u6e83\u8981\u597d\u5f88\u591a\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#61","title":"6.1 \u539f\u7406","text":"<p>android\u4e2d\u6700\u91cd\u8981\u7684\u5c31\u662fHandler\u673a\u5236\u4e86\uff0c\u7b80\u5355\u6765\u8bf4Handler\u673a\u5236\u5c31\u662f\u5728\u4e00\u4e2a\u6b7b\u5faa\u73af\u5185\u90e8\u4e0d\u65ad\u53d6\u8d70\u963b\u585e\u961f\u5217\u5934\u90e8\u7684Message\uff0c\u8fd9\u4e2a\u963b\u585e\u961f\u5217\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u662f\u552f\u4e00\u7684\uff0c\u5f53\u6ca1\u6709Message\u65f6\uff0c\u5faa\u73af\u5c31\u963b\u585e\uff0c\u5f53\u4e00\u65e6\u6709Message\u65f6\u5c31\u7acb\u9a6c\u88ab\u4e3b\u7ebf\u7a0b\u53d6\u8d70\u5e76\u6267\u884cMessage\u3002</p> <p>\u67e5\u770bandroid\u6e90\u7801\u53ef\u4ee5\u53d1\u73b0\u5728ActivityThread\u4e2dmain\u65b9\u6cd5\uff08main\u65b9\u6cd5\u7b7e\u540d <code>public static void main(String[] args){}</code>,\u8fd9\u4e2amain\u65b9\u6cd5\u662f\u9759\u6001\u7684\uff0c\u516c\u6709\u7684\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e94\u7528\u7684\u5165\u53e3\uff09\u6700\u540e\u6267\u884c\u4e86<code>Looper.loop();</code>\uff0c\u6b64\u65b9\u6cd5\u5185\u90e8\u662f\u4e2a\u6b7b\u5faa\u73af(for(;;)\u5faa\u73af)\uff0c\u6240\u4ee5\u4e00\u822c\u60c5\u51b5\u4e0b\u4e3b\u7ebf\u7a0b\u662f\u4e0d\u4f1a\u9000\u51fa\u7684\uff0c\u9664\u975e\u629b\u51fa\u5f02\u5e38\u3002<code>queue.next();</code>\u5c31\u662f\u4ece\u963b\u585e\u961f\u5217\u91cc\u53d6\u8d70\u5934\u90e8\u7684Message\uff0c\u5f53\u6ca1\u6709Message\u65f6\u4e3b\u7ebf\u7a0b\u5c31\u4f1a\u963b\u585e\u5728\u8fd9\u91cc\uff0c\u4e00\u6709Message\u5c31\u4f1a\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\u3002android\u7684view\u7ed8\u5236\uff0c\u4e8b\u4ef6\u5206\u53d1\uff0cactivity\u542f\u52a8\uff0cactivity\u7684\u751f\u547d\u5468\u671f\u56de\u8c03\u7b49\u7b49\u90fd\u662f\u4e00\u4e2a\u4e2a\u7684Message\uff0candroid\u4f1a\u628a\u8fd9\u4e9bMessage\u63d2\u5165\u5230\u4e3b\u7ebf\u7a0b\u4e2d\u552f\u4e00\u7684queue\u4e2d\uff0c\u6240\u6709\u7684\u6d88\u606f\u90fd\u6392\u961f\u7b49\u5f85\u4e3b\u7ebf\u7a0b\u7684\u6267\u884c\u3002</p> <p>ActivityThread\u7684main\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code> public static void main(String[] args) {\n...\nLooper.prepareMainLooper();//\u521b\u5efa\u4e3b\u7ebf\u7a0b\u552f\u4e00\u7684\u963b\u585e\u961f\u5217queue\n...\nActivityThread thread = new ActivityThread();\nthread.attach(false);//\u6267\u884c\u521d\u59cb\u5316\uff0c\u5f80queue\u4e2d\u6dfb\u52a0Message\u7b49\n...\nLooper.loop();//\u5f00\u542f\u6b7b\u5faa\u73af\uff0c\u6328\u4e2a\u6267\u884cMessage\nthrow new RuntimeException(\"Main thread loop unexpectedly exited\");\n}\n</code></pre> <p><code>Looper.loop()</code>\u5173\u952e\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>   for (;;) {\nMessage msg = queue.next(); // might block\n...\nmsg.target.dispatchMessage(msg);//\u6267\u884cMessage\n...\n}     </code></pre> <p>android\u6d88\u606f\u673a\u5236\u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public class ActivityThread {\npublic static void main(String[]args){\nQueue queue=new Queue();// \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u52a0\u9501\u7684\uff0c\u53ef\u4ee5\u963b\u585e\u7ebf\u7a0b\u7684ArrayList\nqueue.add(new Message(){\nvoid run(){\n...\nprint(\"android \u542f\u52a8\u4e86\uff0c\u4e0b\u4e00\u6b65\u8be5\u5f80queue\u4e2d\u63d2\u5165\u542f\u52a8\u4e3bActivity\u7684Message\u4e86\");\nMessage msg=getMessage4LaunchMainActivity();\nqueue.add(msg);\n}\n});\nfor(;;){//\u5f00\u59cb\u6b7b\u5faa\u73af\uff0cfor\u4e4b\u540e\u7684\u4ee3\u7801\u6c38\u8fdc\u4e5f\u5f97\u4e0d\u5230\u6267\u884c\nMessage  msg=queue.next();\nmsg.run();\n}\n}\n}\n</code></pre> <p>\u5d29\u6e83\u9632\u62a4</p> <pre><code>new Handler(Looper.getMainLooper()).post(new Runnable() {\n@Override\npublic void run() {\n//\u4e3b\u7ebf\u7a0b\u5f02\u5e38\u62e6\u622a\nwhile (true) {\ntry {\nLooper.loop();//\u4e3b\u7ebf\u7a0b\u7684\u5f02\u5e38\u4f1a\u4ece\u8fd9\u91cc\u629b\u51fa\n} catch (Throwable e) {\n}\n}\n}\n});\nsUncaughtExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();\n//\u6240\u6709\u7ebf\u7a0b\u5f02\u5e38\u62e6\u622a\uff0c\u7531\u4e8e\u4e3b\u7ebf\u7a0b\u7684\u5f02\u5e38\u90fd\u88ab\u6211\u4eeccatch\u4f4f\u4e86\uff0c\u6240\u4ee5\u4e0b\u9762\u7684\u4ee3\u7801\u62e6\u622a\u5230\u7684\u90fd\u662f\u5b50\u7ebf\u7a0b\u7684\u5f02\u5e38\nThread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {\n@Override\npublic void uncaughtException(Thread t, Throwable e) {\n}\n});\n</code></pre> <p>\u539f\u7406\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u901a\u8fc7Handler\u5f80\u4e3b\u7ebf\u7a0b\u7684queue\u4e2d\u6dfb\u52a0\u4e00\u4e2aRunnable\uff0c\u5f53\u4e3b\u7ebf\u7a0b\u6267\u884c\u5230\u8be5Runnable\u65f6\uff0c\u4f1a\u8fdb\u5165\u6211\u4eec\u7684while\u6b7b\u5faa\u73af\uff0c\u5982\u679cwhile\u5185\u90e8\u662f\u7a7a\u7684\u5c31\u4f1a\u5bfc\u81f4\u4ee3\u7801\u5361\u5728\u8fd9\u91cc\uff0c\u6700\u7ec8\u5bfc\u81f4ANR\uff0c\u4f46\u6211\u4eec\u5728while\u6b7b\u5faa\u73af\u4e2d\u53c8\u8c03\u7528\u4e86<code>Looper.loop()</code>\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u53c8\u5f00\u59cb\u4e0d\u65ad\u7684\u8bfb\u53d6queue\u4e2d\u7684Message\u5e76\u6267\u884c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u4ee5\u540e\u4e3b\u7ebf\u7a0b\u7684\u6240\u6709\u5f02\u5e38\u90fd\u4f1a\u4ece\u6211\u4eec\u624b\u52a8\u8c03\u7528\u7684<code>Looper.loop()</code>\u5904\u629b\u51fa\uff0c\u4e00\u65e6\u629b\u51fa\u5c31\u4f1a\u88abtry{}catch\u6355\u83b7\uff0c\u8fd9\u6837\u4e3b\u7ebf\u7a0b\u5c31\u4e0d\u4f1acrash\u4e86\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u4e2awhile\u7684\u8bdd\u90a3\u4e48\u4e3b\u7ebf\u7a0b\u4e0b\u6b21\u629b\u51fa\u5f02\u5e38\u65f6\u6211\u4eec\u5c31\u53c8\u6355\u83b7\u4e0d\u5230\u4e86\uff0c\u8fd9\u6837APP\u5c31\u53c8crash\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u901a\u8fc7while\u8ba9\u6bcf\u6b21crash\u53d1\u751f\u540e\u90fd\u518d\u6b21\u8fdb\u5165\u6d88\u606f\u5faa\u73af\uff0cwhile\u7684\u4f5c\u7528\u4ec5\u9650\u4e8e\u6bcf\u6b21\u4e3b\u7ebf\u7a0b\u629b\u51fa\u5f02\u5e38\u540e\u8feb\u4f7f\u4e3b\u7ebf\u7a0b\u518d\u6b21\u8fdb\u5165\u6d88\u606f\u5faa\u73af\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u4f2a\u4ee3\u7801\u6765\u8868\u793a\uff1a</p> <pre><code>public class ActivityThread {\npublic static void main(String[]args){\nQueue queue=new Queue();// \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u52a0\u9501\u7684\uff0c\u53ef\u4ee5\u963b\u585e\u7ebf\u7a0b\u7684ArrayList\n...\nfor(;;){//\u5f00\u59cb\u6b7b\u5faa\u73af\uff0cfor\u4e4b\u540e\u7684\u4ee3\u7801\u6c38\u8fdc\u4e5f\u5f97\u4e0d\u5230\u6267\u884c\nMessage  msg=queue.next();\n//\u5982\u679cmsg \u662f\u6211\u4eecpost\u7684Runnable\u5c31\u4f1a\u6267\u884c\u5982\u4e0b\u4ee3\u7801\n//\u6211\u4eecpost\u7684Runnable\u4e2d\u7684\u4ee3\u7801\nwhile (true) {\ntry {\nfor(;;){//\u6240\u6709\u4e3b\u7ebf\u7a0b\u7684\u5f02\u5e38\u90fd\u4f1a\u4ecemsg.run()\u4e2d\u629b\u51fa\uff0c\u6240\u4ee5\u6211\u4eec\u52a0\u4e00\u4e2atry{}catch\u6765\u6355\u83b7\u6240\u6709\u4e3b\u7ebf\u7a0b\u5f02\u5e38\uff0c\u6355\u83b7\u5230\u540e\u518d\u6b21\u5f3a\u8feb\u8fdb\u5165\u5faa\u73af\uff0c\u4e0d\u65ad\u8bfb\u53d6queue\u4e2d\u6d88\u606f\u5e76\u6267\u884c\nMessage  msg=queue.next();\nmsg.run();\n}\n} catch (Throwable e) {\n}\n//\u5426\u5219\u6267\u884c\u5176\u4ed6\u903b\u8f91  \n}\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u8981\u901a\u8fc7new Handler.post\u65b9\u5f0f\u800c\u4e0d\u662f\u76f4\u63a5\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u4efb\u610f\u4f4d\u7f6e\u6267\u884c <code>while (true) { try { Looper.loop(); } catch (Throwable e) {} }</code></p> <p>\u8fd9\u662f\u56e0\u4e3a\u8be5\u65b9\u6cd5\u662f\u4e2a\u6b7b\u5faa\u73af\uff0c\u82e5\u5728\u4e3b\u7ebf\u7a0b\u4e2d\uff0c\u6bd4\u5982\u5728Activity\u7684onCreate\u4e2d\u6267\u884c\u65f6\u4f1a\u5bfc\u81f4while\u540e\u9762\u7684\u4ee3\u7801\u5f97\u4e0d\u5230\u6267\u884c\uff0cactivity\u7684\u751f\u547d\u5468\u671f\u4e5f\u5c31\u4e0d\u80fd\u5b8c\u6574\u6267\u884c\uff0c\u901a\u8fc7Handler.post\u65b9\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u5f71\u54cd\u8be5\u6761\u6d88\u606f\u4e2d\u540e\u9762\u7684\u903b\u8f91\u3002</p>"},{"location":"perf-opt/Android/crash/crash_op/#_2","title":"\u53c2\u8003","text":"<p>Cockroach</p> <p>Android \u5f00\u53d1\u9ad8\u624b\u8bfe</p>"},{"location":"perf-opt/Android/crash/native-catch/","title":"Android \u5e73\u53f0 Native \u4ee3\u7801\u7684\u5d29\u6e83\u6355\u83b7\u673a\u5236\u53ca\u5b9e\u73b0","text":"<p>\u8f6c\u81eahttps://mp.weixin.qq.com/s/g-WzYF3wWAljok1XjPoo7w?</p>"},{"location":"perf-opt/Android/crash/native-catch/#_1","title":"\u4e00\u3001\u80cc\u666f","text":"<p>\u5728Android\u5e73\u53f0\uff0cnative crash\u4e00\u76f4\u662fcrash\u91cc\u7684\u5927\u5934\u3002native crash\u5177\u6709\u4e0a\u4e0b\u6587\u4e0d\u5168\u3001\u51fa\u9519\u4fe1\u606f\u6a21\u7cca\u3001\u96be\u4ee5\u6355\u6349\u7b49\u7279\u70b9\uff0c\u6bd4java crash\u66f4\u96be\u4fee\u590d\u3002\u6240\u4ee5\u4e00\u4e2a\u5408\u683c\u7684\u5f02\u5e38\u6355\u83b7\u7ec4\u4ef6\u4e5f\u8981\u80fd\u8fbe\u5230\u4ee5\u4e0b\u76ee\u7684\uff1a</p> <p>\u652f\u6301\u5728crash\u65f6\u8fdb\u884c\u66f4\u591a\u6269\u5c55\u64cd\u4f5c\uff0c\u5982\uff1a</p> <ul> <li>\u6253\u5370logcat\u548c\u5e94\u7528\u65e5\u5fd7</li> <li>\u4e0a\u62a5crash\u6b21\u6570</li> <li>\u5bf9\u4e0d\u540c\u7684crash\u505a\u4e0d\u540c\u7684\u6062\u590d\u63aa\u65bd</li> <li>\u53ef\u4ee5\u9488\u5bf9\u4e1a\u52a1\u4e0d\u65ad\u6539\u8fdb\u548c\u9002\u5e94</li> </ul>"},{"location":"perf-opt/Android/crash/native-catch/#_2","title":"\u4e8c\u3001\u73b0\u6709\u7684\u65b9\u6848","text":"<p>\u5176\u5b9e3\u4e2a\u65b9\u6848\u5728Android\u5e73\u53f0\u7684\u5b9e\u73b0\u539f\u7406\u90fd\u662f\u57fa\u672c\u4e00\u81f4\u7684\uff0c\u7efc\u5408\u8003\u8651\uff0c\u53ef\u4ee5\u57fa\u4e8ecoffeecatch\u6539\u8fdb\u3002</p>"},{"location":"perf-opt/Android/crash/native-catch/#_3","title":"\u4e09\u3001\u4fe1\u53f7\u673a\u5236","text":""},{"location":"perf-opt/Android/crash/native-catch/#1","title":"1.\u7a0b\u5e8f\u5954\u6e83","text":"<ul> <li>\u5728Unix-like\u7cfb\u7edf\u4e2d\uff0c\u6240\u6709\u7684\u5d29\u6e83\u90fd\u662f\u7f16\u7a0b\u9519\u8bef\u6216\u8005\u786c\u4ef6\u9519\u8bef\u76f8\u5173\u7684\uff0c\u7cfb\u7edf\u9047\u5230\u4e0d\u53ef\u6062\u590d\u7684\u9519\u8bef\u65f6\u4f1a\u89e6\u53d1\u5d29\u6e83\u673a\u5236\u8ba9\u7a0b\u5e8f\u9000\u51fa\uff0c\u5982\u9664\u96f6\u3001\u6bb5\u5730\u5740\u9519\u8bef\u7b49\u3002</li> <li>\u5f02\u5e38\u53d1\u751f\u65f6\uff0cCPU\u901a\u8fc7\u5f02\u5e38\u4e2d\u65ad\u7684\u65b9\u5f0f\uff0c\u89e6\u53d1\u5f02\u5e38\u5904\u7406\u6d41\u7a0b\u3002\u4e0d\u540c\u7684\u5904\u7406\u5668\uff0c\u6709\u4e0d\u540c\u7684\u5f02\u5e38\u4e2d\u65ad\u7c7b\u578b\u548c\u4e2d\u65ad\u5904\u7406\u65b9\u5f0f\u3002</li> <li>linux\u628a\u8fd9\u4e9b\u4e2d\u65ad\u5904\u7406\uff0c\u7edf\u4e00\u4e3a\u4fe1\u53f7\u91cf\uff0c\u53ef\u4ee5\u6ce8\u518c\u4fe1\u53f7\u91cf\u5411\u91cf\u8fdb\u884c\u5904\u7406\u3002</li> <li>\u4fe1\u53f7\u673a\u5236\u662f\u8fdb\u7a0b\u4e4b\u95f4\u76f8\u4e92\u4f20\u9012\u6d88\u606f\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c\u4fe1\u53f7\u5168\u79f0\u4e3a\u8f6f\u4e2d\u65ad\u4fe1\u53f7\u3002</li> </ul>"},{"location":"perf-opt/Android/crash/native-catch/#2","title":"2.\u4fe1\u53f7\u673a\u5236","text":"<p>\u51fd\u6570\u8fd0\u884c\u5728\u7528\u6237\u6001\uff0c\u5f53\u9047\u5230\u7cfb\u7edf\u8c03\u7528\u3001\u4e2d\u65ad\u6216\u662f\u5f02\u5e38\u7684\u60c5\u51b5\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u8fdb\u5165\u5185\u6838\u6001\u3002\u4fe1\u53f7\u6d89\u53ca\u5230\u4e86\u8fd9\u4e24\u79cd\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\u3002</p> <p></p>"},{"location":"perf-opt/Android/crash/native-catch/#1_1","title":"(1) \u4fe1\u53f7\u7684\u63a5\u6536","text":"<p>\u63a5\u6536\u4fe1\u53f7\u7684\u4efb\u52a1\u662f\u7531\u5185\u6838\u4ee3\u7406\u7684\uff0c\u5f53\u5185\u6838\u63a5\u6536\u5230\u4fe1\u53f7\u540e\uff0c\u4f1a\u5c06\u5176\u653e\u5230\u5bf9\u5e94\u8fdb\u7a0b\u7684\u4fe1\u53f7\u961f\u5217\u4e2d\uff0c\u540c\u65f6\u5411\u8fdb\u7a0b\u53d1\u9001\u4e00\u4e2a\u4e2d\u65ad\uff0c\u4f7f\u5176\u9677\u5165\u5185\u6838\u6001\u3002\u6ce8\u610f\uff0c\u6b64\u65f6\u4fe1\u53f7\u8fd8\u53ea\u662f\u5728\u961f\u5217\u4e2d\uff0c\u5bf9\u8fdb\u7a0b\u6765\u8bf4\u6682\u65f6\u662f\u4e0d\u77e5\u9053\u6709\u4fe1\u53f7\u5230\u6765\u7684\u3002</p>"},{"location":"perf-opt/Android/crash/native-catch/#2_1","title":"(2) \u4fe1\u53f7\u7684\u68c0\u6d4b","text":"<p>\u8fdb\u7a0b\u9677\u5165\u5185\u6838\u6001\u540e\uff0c\u6709\u4e24\u79cd\u573a\u666f\u4f1a\u5bf9\u4fe1\u53f7\u8fdb\u884c\u68c0\u6d4b\uff1a</p> <ul> <li>\u8fdb\u7a0b\u4ece\u5185\u6838\u6001\u8fd4\u56de\u5230\u7528\u6237\u6001\u524d\u8fdb\u884c\u4fe1\u53f7\u68c0\u6d4b</li> <li>\u8fdb\u7a0b\u5728\u5185\u6838\u6001\u4e2d\uff0c\u4ece\u7761\u7720\u72b6\u6001\u88ab\u5524\u9192\u7684\u65f6\u5019\u8fdb\u884c\u4fe1\u53f7\u68c0\u6d4b</li> </ul> <p>\u5f53\u53d1\u73b0\u6709\u65b0\u4fe1\u53f7\u65f6\uff0c\u4fbf\u4f1a\u8fdb\u5165\u4e0b\u4e00\u6b65\uff0c\u4fe1\u53f7\u7684\u5904\u7406\u3002</p>"},{"location":"perf-opt/Android/crash/native-catch/#3","title":"(3) \u4fe1\u53f7\u7684\u5904\u7406","text":"<p>\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u662f\u8fd0\u884c\u5728\u7528\u6237\u6001\u7684\uff0c\u8c03\u7528\u5904\u7406\u51fd\u6570\u524d\uff0c\u5185\u6838\u4f1a\u5c06\u5f53\u524d\u5185\u6838\u6808\u7684\u5185\u5bb9\u5907\u4efd\u62f7\u8d1d\u5230\u7528\u6237\u6808\u4e0a\uff0c\u5e76\u4e14\u4fee\u6539\u6307\u4ee4\u5bc4\u5b58\u5668\uff08eip\uff09\u5c06\u5176\u6307\u5411\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002</p> <p>\u63a5\u4e0b\u6765\u8fdb\u7a0b\u8fd4\u56de\u5230\u7528\u6237\u6001\u4e2d\uff0c\u6267\u884c\u76f8\u5e94\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002</p> <p>\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6267\u884c\u5b8c\u6210\u540e\uff0c\u8fd8\u9700\u8981\u8fd4\u56de\u5185\u6838\u6001\uff0c\u68c0\u67e5\u662f\u5426\u8fd8\u6709\u5176\u5b83\u4fe1\u53f7\u672a\u5904\u7406\u3002\u5982\u679c\u6240\u6709\u4fe1\u53f7\u90fd\u5904\u7406\u5b8c\u6210\uff0c\u5c31\u4f1a\u5c06\u5185\u6838\u6808\u6062\u590d\uff08\u4ece\u7528\u6237\u6808\u7684\u5907\u4efd\u62f7\u8d1d\u56de\u6765\uff09\uff0c\u540c\u65f6\u6062\u590d\u6307\u4ee4\u5bc4\u5b58\u5668\uff08eip\uff09\u5c06\u5176\u6307\u5411\u4e2d\u65ad\u524d\u7684\u8fd0\u884c\u4f4d\u7f6e\uff0c\u6700\u540e\u56de\u5230\u7528\u6237\u6001\u7ee7\u7eed\u6267\u884c\u8fdb\u7a0b\u3002</p> <p>\u81f3\u6b64\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u4fe1\u53f7\u5904\u7406\u6d41\u7a0b\u4fbf\u7ed3\u675f\u4e86\uff0c\u5982\u679c\u540c\u65f6\u6709\u591a\u4e2a\u4fe1\u53f7\u5230\u8fbe\uff0c\u4e0a\u9762\u7684\u5904\u7406\u6d41\u7a0b\u4f1a\u5728\u7b2c2\u6b65\u548c\u7b2c3\u6b65\u9aa4\u95f4\u91cd\u590d\u8fdb\u884c\u3002</p>"},{"location":"perf-opt/Android/crash/native-catch/#4","title":"(4) \u5e38\u89c1\u4fe1\u53f7\u91cf\u7c7b\u578b","text":""},{"location":"perf-opt/Android/crash/native-catch/#native-crash","title":"\u56db\u3001\u6355\u6349native crash","text":""},{"location":"perf-opt/Android/crash/native-catch/#1_2","title":"1.\u6ce8\u518c\u4fe1\u53f7\u5904\u7406\u51fd\u6570","text":"<p>\u7b2c\u4e00\u6b65\u5c31\u662f\u8981\u7528\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6355\u83b7\u5230native crash(SIGSEGV, SIGBUS\u7b49)\u3002\u5728posix\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528sigaction()\uff1a</p> <pre><code>#include &lt;signal.h&gt; \nint sigaction(int signum,const struct sigaction *act,struct sigaction *oldact));\n</code></pre> <ul> <li>signum\uff1a\u4ee3\u8868\u4fe1\u53f7\u7f16\u7801\uff0c\u53ef\u4ee5\u662f\u9664SIGKILL\u53caSIGSTOP\u5916\u7684\u4efb\u4f55\u4e00\u4e2a\u7279\u5b9a\u6709\u6548\u7684\u4fe1\u53f7\uff0c\u5982\u679c\u4e3a\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u5b9a\u4e49\u81ea\u5df1\u7684\u5904\u7406\u51fd\u6570\uff0c\u5c06\u5bfc\u81f4\u4fe1\u53f7\u5b89\u88c5\u9519\u8bef\u3002</li> <li>act\uff1a\u6307\u5411\u7ed3\u6784\u4f53sigaction\u7684\u4e00\u4e2a\u5b9e\u4f8b\u7684\u6307\u9488\uff0c\u8be5\u5b9e\u4f8b\u6307\u5b9a\u4e86\u5bf9\u7279\u5b9a\u4fe1\u53f7\u7684\u5904\u7406\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a\u7a7a\uff0c\u8fdb\u7a0b\u4f1a\u6267\u884c\u9ed8\u8ba4\u5904\u7406\u3002</li> <li>oldact\uff1a\u548c\u53c2\u6570act\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u4fdd\u5b58\u7684\u662f\u539f\u6765\u5bf9\u76f8\u5e94\u4fe1\u53f7\u7684\u5904\u7406\uff0c\u4e5f\u53ef\u8bbe\u7f6e\u4e3aNULL\u3002</li> </ul> <pre><code>struct sigaction sa_old;  \nmemset(&amp;sa, 0, sizeof(sa));  \nsigemptyset(&amp;sa.sa_mask);  \nsa.sa_sigaction = my_handler;  \nsa.sa_flags = SA_SIGINFO;\nif (sigaction(sig, &amp;sa, &amp;sa_old) == 0) {  \n  ...  \n}\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#2_2","title":"2.\u8bbe\u7f6e\u989d\u5916\u6808\u7a7a\u95f4","text":"<pre><code>#include &lt;signal.h&gt;\nint sigaltstack(const stack_t *ss, stack_t *oss);\n</code></pre> <ul> <li>SIGSEGV\u5f88\u6709\u53ef\u80fd\u662f\u6808\u6ea2\u51fa\u5f15\u8d77\u7684\uff0c\u5982\u679c\u5728\u9ed8\u8ba4\u7684\u6808\u4e0a\u8fd0\u884c\u5f88\u6709\u53ef\u80fd\u4f1a\u7834\u574f\u7a0b\u5e8f\u8fd0\u884c\u7684\u73b0\u573a\uff0c\u65e0\u6cd5\u83b7\u53d6\u5230\u6b63\u786e\u7684\u4e0a\u4e0b\u6587\u3002\u800c\u4e14\u5f53\u6808\u6ee1\u4e86\uff08\u592a\u591a\u6b21\u9012\u5f52\uff0c\u6808\u4e0a\u592a\u591a\u5bf9\u8c61\uff09\uff0c\u7cfb\u7edf\u4f1a\u5728\u540c\u4e00\u4e2a\u5df2\u7ecf\u6ee1\u4e86\u7684\u6808\u4e0a\u8c03\u7528SIGSEGV\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u53c8\u518d\u4e00\u6b21\u5f15\u8d77\u540c\u6837\u7684\u4fe1\u53f7\u3002</li> <li>\u6211\u4eec\u5e94\u8be5\u5f00\u8f9f\u4e00\u5757\u65b0\u7684\u7a7a\u95f4\u4f5c\u4e3a\u8fd0\u884c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7684\u6808\u3002\u53ef\u4ee5\u4f7f\u7528sigaltstack\u5728\u4efb\u610f\u7ebf\u7a0b\u6ce8\u518c\u4e00\u4e2a\u53ef\u9009\u7684\u6808\uff0c\u4fdd\u7559\u4e00\u4e0b\u5728\u7d27\u6025\u60c5\u51b5\u4e0b\u4f7f\u7528\u7684\u7a7a\u95f4\u3002\uff08\u7cfb\u7edf\u4f1a\u5728\u5371\u9669\u60c5\u51b5\u4e0b\u628a\u6808\u6307\u9488\u6307\u5411\u8fd9\u4e2a\u5730\u65b9\uff0c\u4f7f\u5f97\u53ef\u4ee5\u5728\u4e00\u4e2a\u65b0\u7684\u6808\u4e0a\u8fd0\u884c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff09</li> </ul> <pre><code>stack_t stack;  \nmemset(&amp;stack, 0, sizeof(stack));  \n/* Reserver the system default stack size. We don't need that much by the way. */  \nstack.ss_size = SIGSTKSZ;  \nstack.ss_sp = malloc(stack.ss_size);  \nstack.ss_flags = 0;  \n/* Install alternate stack size. Be sure the memory region is valid until you revert it. */  \nif (stack.ss_sp != NULL &amp;&amp; sigaltstack(&amp;stack, NULL) == 0) {  \n  ...  \n}\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#3signal","title":"3.\u517c\u5bb9\u5176\u4ed6signal\u5904\u7406","text":"<pre><code>static void my_handler(const int code, siginfo_t *const si, void *const sc) {\n...  \n  /* Call previous handler. */  \n  old_handler.sa_sigaction(code, si, sc);  \n}\n</code></pre> <ul> <li>\u67d0\u4e9b\u4fe1\u53f7\u53ef\u80fd\u5728\u4e4b\u524d\u5df2\u7ecf\u88ab\u5b89\u88c5\u8fc7\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u800csigaction\u4e00\u4e2a\u4fe1\u53f7\u91cf\u53ea\u80fd\u6ce8\u518c\u4e00\u4e2a\u5904\u7406\u51fd\u6570\uff0c\u8fd9\u610f\u5473\u7740\u6211\u4eec\u7684\u5904\u7406\u51fd\u6570\u4f1a\u8986\u76d6\u5176\u4ed6\u4eba\u7684\u5904\u7406\u4fe1\u53f7</li> <li>\u4fdd\u5b58\u65e7\u7684\u5904\u7406\u51fd\u6570\uff0c\u5728\u5904\u7406\u5b8c\u6211\u4eec\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u540e\uff0c\u5728\u91cd\u65b0\u8fd0\u884c\u8001\u7684\u5904\u7406\u51fd\u6570\u5c31\u80fd\u5b8c\u6210\u517c\u5bb9\u3002</li> </ul>"},{"location":"perf-opt/Android/crash/native-catch/#_4","title":"\u4e94\u3001\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"perf-opt/Android/crash/native-catch/#1_3","title":"1.\u9632\u6b62\u6b7b\u9501\u6216\u8005\u6b7b\u5faa\u73af","text":"<p>\u9996\u5148\u6211\u4eec\u8981\u4e86\u89e3async-signal-safe\u548c\u53ef\u91cd\u5165\u51fd\u6570\u6982\u5ff5\uff1a</p> <ul> <li>A signal handler function must be very careful, since processing elsewhere may be interrupted at some arbitrary point in the execution of the program.</li> <li>POSIX has the concept of \u201csafe function\u201d.  If a signal interrupts the execution of an unsafe function, and handler  either calls an unsafe function or handler terminates via a call to longjmp() or siglongjmp() and the program subsequently calls an unsafe function, then the behavior of the program is undefined.</li> </ul> <p>\u56de\u60f3\u4e0b\u5728\u201c\u4fe1\u53f7\u673a\u5236\u201d\u4e00\u8282\u4e2d\u7684\u56fe\u793a\uff0c\u8fdb\u7a0b\u6355\u6349\u5230\u4fe1\u53f7\u5e76\u5bf9\u5176\u8fdb\u884c\u5904\u7406\u65f6\uff0c\u8fdb\u7a0b\u6b63\u5728\u6267\u884c\u7684\u6b63\u5e38\u6307\u4ee4\u5e8f\u5217\u5c31\u88ab\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e34\u65f6\u4e2d\u65ad\uff0c\u5b83\u9996\u5148\u6267\u884c\u8be5\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\u7684\u6307\u4ee4\uff08\u7c7b\u4f3c\u53d1\u751f\u786c\u4ef6\u4e2d\u65ad\uff09\u3002\u4f46\u5728\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\uff0c\u4e0d\u80fd\u5224\u65ad\u6355\u6349\u5230\u4fe1\u53f7\u65f6\u8fdb\u7a0b\u6267\u884c\u5230\u4f55\u5904\u3002\u5982\u679c\u8fdb\u7a0b\u6b63\u5728\u6267\u884cmalloc\uff0c\u5728\u5176\u5806\u4e2d\u5206\u914d\u53e6\u5916\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u800c\u6b64\u65f6\u7531\u4e8e\u6355\u6349\u5230\u4fe1\u53f7\u800c\u63d2\u5165\u6267\u884c\u8be5\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\uff0c\u5176\u4e2d\u53c8\u8c03\u7528malloc\uff0c\u8fd9\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u8fd9\u53ef\u80fd\u4f1a\u5bf9\u8fdb\u7a0b\u9020\u6210\u7834\u574f\uff0c\u56e0\u4e3amalloc\u901a\u5e38\u4e3a\u5b83\u6240\u5206\u914d\u7684\u5b58\u50a8\u533a\u7ef4\u62a4\u4e00\u4e2a\u94fe\u8868\uff0c\u800c\u63d2\u5165\u6267\u884c\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u65f6\uff0c\u8fdb\u7a0b\u53ef\u80fd\u6b63\u5728\u66f4\u6539\u6b64\u94fe\u8868\u3002\uff08\u53c2\u8003\u300aUNIX\u73af\u5883\u9ad8\u7ea7\u7f16\u7a0b\u300b\uff09</p> <p>Single UNIX Specification\u8bf4\u660e\u4e86\u5728\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\u4fdd\u8bc1\u8c03\u7528\u5b89\u5168\u7684\u51fd\u6570\u3002\u8fd9\u4e9b\u51fd\u6570\u662f\u53ef\u91cd\u5165\u7684\u5e76\u88ab\u79f0\u4e3a\u662f\u5f02\u6b65\u4fe1\u53f7\u5b89\u5168\uff08async-signal-safe\uff09\u3002\u9664\u4e86\u53ef\u91cd\u5165\u4ee5\u5916\uff0c\u5728\u4fe1\u53f7\u5904\u7406\u64cd\u4f5c\u671f\u95f4\uff0c\u5b83\u4f1a\u963b\u585e\u4efb\u4f55\u4f1a\u5f15\u8d77\u4e0d\u4e00\u81f4\u7684\u4fe1\u53f7\u53d1\u9001\u3002\u4e0b\u9762\u662f\u8fd9\u4e9b\u5f02\u6b65\u4fe1\u53f7\u5b89\u5168\u51fd\u6570\uff1a</p> <p></p> <p>\u4f46\u5373\u4f7f\u6211\u4eec\u81ea\u5df1\u5728\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\u4e0d\u4f7f\u7528\u4e0d\u53ef\u91cd\u5165\u7684\u51fd\u6570\uff0c\u4e5f\u65e0\u6cd5\u4fdd\u8bc1\u4fdd\u5b58\u7684\u65e7\u7684\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\u4e0d\u4f1a\u6709\u975e\u5f02\u6b65\u4fe1\u53f7\u5b89\u5168\u7684\u51fd\u6570\u3002\u6240\u4ee5\u8981\u4f7f\u7528alarm\u4fdd\u8bc1\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e0d\u4f1a\u9677\u5165\u6b7b\u9501\u6216\u8005\u6b7b\u5faa\u73af\u7684\u72b6\u6001\u3002</p> <pre><code>static void signal_handler(const int code, siginfo_t *const si,\n                                    void *const sc) {\n\n    /* Ensure we do not deadlock. Default of ALRM is to die.\n    * (signal() and alarm() are signal-safe) */\n    signal(code, SIG_DFL);\n    signal(SIGALRM, SIG_DFL);\n\n    /* Ensure we do not deadlock. Default of ALRM is to die.\n      * (signal() and alarm() are signal-safe) */\n    (void) alarm(8);\n    ....\n}\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#2_3","title":"2.\u5728\u54ea\u91cc\u6253\u5370\u5806\u6808","text":""},{"location":"perf-opt/Android/crash/native-catch/#1_4","title":"(1) \u5b50\u8fdb\u7a0b","text":"<p>\u8003\u8651\u5230\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u4e2d\u7684\u8bf8\u591a\u9650\u5236\uff0c\u4e00\u822c\u4f1aclone\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u5728\u5176\u4e2d\u5b8c\u6210\u89e3\u6790\u5806\u6808\u7b49\u4efb\u52a1\u3002</p> <p>\u4e0b\u9762\u662fGoogle Breakpad\u7684\u6d41\u7a0b\u56fe\uff0c\u5728\u65b0\u7684\u8fdb\u7a0b\u4e2dDoDump\uff0c\u4f7f\u7528ptrace\u89e3\u6790crash\u8fdb\u7a0b\u7684\u5806\u6808\uff0c\u540c\u65f6\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u7b49\u5f85\u5b50\u8fdb\u7a0b\u5b8c\u6210\u4efb\u52a1\u540e\uff0c\u518d\u8c03\u7528\u65e7\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002\u7236\u5b50\u8fdb\u7a0b\u4f7f\u7528\u7ba1\u9053\u901a\u4fe1\u3002</p> <p></p>"},{"location":"perf-opt/Android/crash/native-catch/#2_4","title":"(2) \u5b50\u7ebf\u7a0b","text":"<p>\u5728\u6211\u7684\u5b9e\u9a8c\u4e2d\uff0c\u5728\u5b50\u8fdb\u7a0b\u6216\u8005\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\uff0c\u7ecf\u5e38\u65e0\u6cd5\u56de\u8c03\u7ed9java\u5c42\u3002\u4e8e\u662f\u6211\u9009\u62e9\u4e86\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u5c31\u5efa\u7acb\u4e86\u5b50\u7ebf\u7a0b\u5e76\u4e00\u76f4\u7b49\u5f85\uff0c\u7b49\u5230\u6355\u6349\u5230crash\u4fe1\u53f7\u65f6\uff0c\u5524\u9192\u8fd9\u6761\u7ebf\u7a0bdump\u51facrash\u5806\u6808\uff0c\u5e76\u628acrash\u5806\u6808\u56de\u8c03\u7ed9java\u3002</p> <pre><code>static void nativeInit(JNIEnv* env, jclass javaClass, jstring packageNameStr, jstring tombstoneFilePathStr, jobject obj) {\n    ...\n    initCondition();\n\n    pthread_t thd;\n    int ret = pthread_create(&amp;thd, NULL, DumpThreadEntry, NULL);    if(ret) {\n        qmlog(\"%s\", \"pthread_create error\");\n    }\n}\n\nvoid* DumpThreadEntry(void *argv) {\n    JNIEnv* env = NULL;\n     if((*g_jvm)-&gt;AttachCurrentThread(g_jvm, &amp;env, NULL) != JNI_OK)\n    {\n        LOGE(\"AttachCurrentThread() failed\");\n        estatus = 0;\n        return &amp;estatus;\n    }\n\n    while (true) {\n        //\u7b49\u5f85\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5524\u9192\n        waitForSignal();\n\n        //\u56de\u8c03native\u5f02\u5e38\u5806\u6808\u7ed9java\u5c42\n        throw_exception(env);\n\n        //\u544a\u8bc9\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5df2\u7ecf\u5904\u7406\u5b8c\u4e86\n        notifyThrowException();\n    }\n\n    if((*g_jvm)-&gt;DetachCurrentThread(g_jvm) != JNI_OK)\n    {\n        LOGE(\"DetachCurrentThread() failed\");\n        estatus = 0;\n        return &amp;estatus;\n    }\n\n    return &amp;estatus;\n}\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#native-crash_1","title":"\u516d\u3001\u6536\u96c6native crash\u539f\u56e0","text":"<p>\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7684\u5165\u53c2\u4e2d\u6709\u4e30\u5bcc\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u4e00\u4e00\u5206\u6790\u3002</p> <pre><code>/*\u4fe1\u53f7\u5904\u7406\u51fd\u6570*/\n\nvoid (*sa_sigaction)(const int code, siginfo_t *const si, void * const sc) \n\nsiginfo_t {\n   int      si_signo;     /* Signal number \u4fe1\u53f7\u91cf */\n   int      si_errno;     /* An errno value */\n   int      si_code;      /* Signal code \u9519\u8bef\u7801 */\n   }\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#1code","title":"1.code","text":"<p>\u53d1\u751fnative crash\u4e4b\u540e\uff0clogcat\u4e2d\u4f1a\u6253\u51fa\u5982\u4e0b\u4e00\u53e5\u4fe1\u606f\uff1a</p> <p>signal 11 (SIGSEGV), code 0 (SI_USER), fault addr 0x0</p> <p>\u6839\u636ecode\u53bb\u67e5\u8868\uff0c\u5176\u5b9e\u5c31\u53ef\u4ee5\u77e5\u9053\u53d1\u751fnative crash\u7684\u5927\u81f4\u539f\u56e0\uff1a</p> <p></p> <p>\u4ee3\u7801\u7684\u4e00\u90e8\u5206\u5982\u4e0b\uff0c\u5176\u5b9e\u5c31\u662f\u6839\u636e\u4e0d\u540c\u7684code\uff0c\u8f93\u51fa\u4e0d\u540c\u4fe1\u606f\uff0c\u8fd9\u4e9b\u90fd\u662f\u56fa\u5b9a\u7684\u3002</p> <pre><code>case SIGFPE:\n    switch(code) {\n    case FPE_INTDIV:\n      return \"Integer divide by zero\";\n    case FPE_INTOVF:\n      return \"Integer overflow\";\n    case FPE_FLTDIV:\n      return \"Floating-point divide by zero\";\n    case FPE_FLTOVF:\n      return \"Floating-point overflow\";\n    case FPE_FLTUND:\n      return \"Floating-point underflow\";\n    case FPE_FLTRES:\n      return \"Floating-point inexact result\";\n    case FPE_FLTINV:\n      return \"Invalid floating-point operation\";\n    case FPE_FLTSUB:\n      return \"Subscript out of range\";\n    default:\n      return \"Floating-point\";\n    }\n    break;\n  case SIGSEGV:\n    switch(code) {\n    case SEGV_MAPERR:\n      return \"Address not mapped to object\";\n    case SEGV_ACCERR:\n      return \"Invalid permissions for mapped object\";\n    default:\n      return \"Segmentation violation\";\n    }\n    break;\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#2pc","title":"2.pc\u503c","text":"<p>\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\u7684\u7b2c\u4e09\u4e2a\u5165\u53c2sc\u662fuc_mcontext\u7684\u7ed3\u6784\u4f53\uff0c\u662fcpu\u76f8\u5173\u7684\u4e0a\u4e0b\u6587\uff0c\u5305\u62ec\u5f53\u524d\u7ebf\u7a0b\u7684\u5bc4\u5b58\u5668\u4fe1\u606f\u548c\u5954\u6e83\u65f6\u7684pc\u503c\u3002\u80fd\u591f\u77e5\u9053\u5d29\u6e83\u65f6\u7684pc\uff0c\u5c31\u80fd\u77e5\u9053\u5d29\u6e83\u65f6\u6267\u884c\u7684\u662f\u90a3\u6761\u6307\u4ee4\u3002</p> <p>\u4e0d\u8fc7\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u662f\u5e73\u53f0\u76f8\u5173\uff0c\u4e0d\u540c\u5e73\u53f0\u3001\u4e0d\u540ccpu\u67b6\u6784\u4e2d\u7684\u5b9a\u4e49\u90fd\u4e0d\u4e00\u6837\uff1a</p> <ul> <li>x86-64\u67b6\u6784\uff1auc_mcontext.gregs[REG_RIP]</li> <li>arm\u67b6\u6784\uff1auc_mcontext.arm_pc</li> </ul>"},{"location":"perf-opt/Android/crash/native-catch/#3_1","title":"3.\u5171\u4eab\u5e93\u540d\u5b57\u548c\u76f8\u5bf9\u504f\u79fb\u5730\u5740","text":""},{"location":"perf-opt/Android/crash/native-catch/#1-dladdr","title":"(1) dladdr()","text":"<p>pc\u503c\u662f\u7a0b\u5e8f\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u7edd\u5bf9\u5730\u5740\uff0c\u6211\u4eec\u9700\u8981\u62ff\u5230\u5954\u6e83\u4ee3\u7801\u76f8\u5bf9\u4e8e\u5171\u4eab\u5e93\u7684\u76f8\u5bf9\u504f\u79fb\u5730\u5740\uff0c\u624d\u80fd\u4f7f\u7528addr2line\u5206\u6790\u51fa\u662f\u54ea\u4e00\u884c\u4ee3\u7801\u3002\u901a\u8fc7dladdr()\u53ef\u4ee5\u83b7\u5f97\u5171\u4eab\u5e93\u52a0\u8f7d\u5230\u5185\u5b58\u7684\u8d77\u59cb\u5730\u5740\uff0c\u548cpc\u503c\u76f8\u51cf\u5c31\u53ef\u4ee5\u83b7\u5f97\u76f8\u5bf9\u504f\u79fb\u5730\u5740\uff0c\u5e76\u4e14\u53ef\u4ee5\u83b7\u5f97\u5171\u4eab\u5e93\u7684\u540d\u5b57\u3002</p> <pre><code>Dl_info info;  \nif (dladdr(addr, &amp;info) != 0 &amp;&amp; info.dli_fname != NULL) {  \n  void * const nearest = info.dli_saddr;  \n  //\u76f8\u5bf9\u504f\u79fb\u5730\u5740\n  const uintptr_t addr_relative =  \n    ((uintptr_t) addr - (uintptr_t) info.dli_fbase);  \n  ...  \n}\n</code></pre> <p>\u4f5c\u4e3a\u6709\u8ffd\u6c42\u7684\u6211\u4eec\uff0c\u80af\u5b9a\u4e0d\u6ee1\u8db3\u4e8e\u4ec5\u4ec5\u901a\u8fc7\u4e00\u4e2a\u51fd\u6570\u5c31\u83b7\u5f97\u7b54\u6848\u3002\u6211\u4eec\u5c1d\u8bd5\u4e0b\u5982\u4f55\u624b\u5de5\u5206\u6790\u51fa\u76f8\u5bf9\u5730\u5740\u3002\u9996\u5148\u8981\u4e86\u89e3\u4e0b\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u3002</p>"},{"location":"perf-opt/Android/crash/native-catch/#2-linux","title":"(2) Linux\u4e0b\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u5e03\u5c40","text":"<p>\u4efb\u4f55\u4e00\u4e2a\u7a0b\u5e8f\u901a\u5e38\u90fd\u5305\u62ec\u4ee3\u7801\u6bb5\u548c\u6570\u636e\u6bb5\uff0c\u8fd9\u4e9b\u4ee3\u7801\u548c\u6570\u636e\u672c\u8eab\u90fd\u662f\u9759\u6001\u7684\u3002\u7a0b\u5e8f\u8981\u60f3\u8fd0\u884c\uff0c\u9996\u5148\u8981\u7531\u64cd\u4f5c\u7cfb\u7edf\u8d1f\u8d23\u4e3a\u5176\u521b\u5efa\u8fdb\u7a0b\uff0c\u5e76\u5728\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e3a\u5176\u4ee3\u7801\u6bb5\u548c\u6570\u636e\u6bb5\u5efa\u7acb\u6620\u5c04\u3002\u5149\u6709\u4ee3\u7801\u6bb5\u548c\u6570\u636e\u6bb5\u662f\u4e0d\u591f\u7684\uff0c\u8fdb\u7a0b\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8fd8\u8981\u6709\u5176\u52a8\u6001\u73af\u5883\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u5c31\u662f\u5806\u6808\u3002</p> <p>\u4e0a\u56fe\u4e2dRandom stack offset\u548cRandom mmap offset\u7b49\u968f\u673a\u503c\u610f\u5728\u9632\u6b62\u6076\u610f\u7a0b\u5e8f\u3002Linux\u901a\u8fc7\u5bf9\u6808\u3001\u5185\u5b58\u6620\u5c04\u6bb5\u3001\u5806\u7684\u8d77\u59cb\u5730\u5740\u52a0\u4e0a\u968f\u673a\u504f\u79fb\u91cf\u6765\u6253\u4e71\u5e03\u5c40\uff0c\u4ee5\u514d\u6076\u610f\u7a0b\u5e8f\u901a\u8fc7\u8ba1\u7b97\u8bbf\u95ee\u6808\u3001\u5e93\u51fd\u6570\u7b49\u5730\u5740\u3002</p> <p>\u6808(stack)\uff0c\u4f5c\u4e3a\u8fdb\u7a0b\u7684\u4e34\u65f6\u6570\u636e\u533a,\u589e\u957f\u65b9\u5411\u662f\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\u3002</p>"},{"location":"perf-opt/Android/crash/native-catch/#3-procselfmaps","title":"(3) /proc/self/maps\uff1a\u68c0\u67e5\u5404\u4e2a\u6a21\u5757\u52a0\u8f7d\u5728\u5185\u5b58\u7684\u5730\u5740\u8303\u56f4","text":"<p>\u5728Linux\u7cfb\u7edf\u4e2d\uff0c/proc/self/maps\u4fdd\u5b58\u4e86\u5404\u4e2a\u7a0b\u5e8f\u6bb5\u5728\u5185\u5b58\u4e2d\u7684\u52a0\u8f7d\u5730\u5740\u8303\u56f4\uff0cgrep\u51fa\u5171\u4eab\u5e93\u7684\u540d\u5b57\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5171\u4eab\u5e93\u7684\u52a0\u8f7d\u57fa\u503c\u662f\u591a\u5c11\u3002</p> <p></p> <p>\u5f97\u5230\u76f8\u5bf9\u504f\u79fb\u5730\u5740\u4e4b\u540e\uff0c\u4f7f\u7528readelf\u67e5\u770b\u5171\u4eab\u5e93\u7684\u7b26\u53f7\u8868\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u662f\u54ea\u4e2a\u51fd\u6570crash\u4e86\u3002</p> <p></p>"},{"location":"perf-opt/Android/crash/native-catch/#_5","title":"\u4e03\u3001\u83b7\u53d6\u5806\u6808","text":""},{"location":"perf-opt/Android/crash/native-catch/#1_5","title":"1.\u539f\u7406","text":"<p>\u5728\u524d\u4e00\u6b65\uff0c\u6211\u4eec\u83b7\u53d6\u4e86\u5954\u6e83\u65f6\u7684pc\u503c\u548c\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\uff0c\u901a\u8fc7SP\u548cFP\u6240\u9650\u5b9a\u7684stack frame\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u6bcd\u51fd\u6570\u7684SP\u548cFP\uff0c\u4ece\u800c\u5f97\u5230\u6bcd\u51fd\u6570\u7684stack frame\uff08PC\uff0cLR\uff0cSP\uff0cFP\u4f1a\u5728\u51fd\u6570\u8c03\u7528\u7684\u7b2c\u4e00\u65f6\u95f4\u538b\u6808\uff09\uff0c\u4ee5\u6b64\u8ffd\u6eaf\uff0c\u5373\u53ef\u5f97\u5230\u6240\u6709\u51fd\u6570\u7684\u8c03\u7528\u987a\u5e8f\u3002</p> <p></p>"},{"location":"perf-opt/Android/crash/native-catch/#2_5","title":"2.\u5b9e\u73b0","text":"<ul> <li>\u57284.1.1\u4ee5\u4e0a\uff0c5.0\u4ee5\u4e0b\uff1a\u4f7f\u7528\u5b89\u5353\u7cfb\u7edf\u81ea\u5e26\u7684libcorkscrew.so</li> <li>5.0\u4ee5\u4e0a\uff1a\u5b89\u5353\u7cfb\u7edf\u4e2d\u6ca1\u6709\u4e86libcorkscrew.so\uff0c\u4f7f\u7528\u81ea\u5df1\u7f16\u8bd1\u7684libunwind</li> </ul> <pre><code>#ifdef USE_UNWIND\n    /* Frame buffer initial position. */\n    t-&gt;frames_size = 0;\n\n    /* Skip us and the caller. */\n    t-&gt;frames_skip = 0;\n\n    /* \u4f7f\u7528libcorkscrew\u89e3\u5806\u6808 */\n#ifdef USE_CORKSCREW\n    t-&gt;frames_size = backtrace_signal(si, sc, t-&gt;frames, 0, BACKTRACE_FRAMES_MAX);\n#else\n    /* Unwind frames (equivalent to backtrace()) */\n    _Unwind_Backtrace(coffeecatch_unwind_callback, t);\n#endif\n\n/* \u5982\u679c\u65e0\u6cd5\u52a0\u8f7dlibcorkscrew\uff0c\u5219\u4f7f\u7528\u81ea\u5df1\u7f16\u8bd1\u7684libunwind\u89e3\u5806\u6808 */\n\n#ifdef USE_LIBUNWIND\n    if (t-&gt;frames_size == 0) {\n        size_t i;\n        t-&gt;frames_size = unwind_signal(si, sc, t-&gt;uframes, 0,BACKTRACE_FRAMES_MAX);\n        for(i = 0 ; i &lt; t-&gt;frames_size ; i++) {\n            t-&gt;frames[i].absolute_pc = (uintptr_t) t-&gt;uframes[i];\n            t-&gt;frames[i].stack_top = 0;\n            t-&gt;frames[i].stack_size = 0;\n            __android_log_print(ANDROID_LOG_DEBUG, TAG, \"absolute_pc:%x\", t-&gt;frames[i].absolute_pc);\n        }\n    }\n#endif\n</code></pre> <p>libunwind\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5f00\u6e90\u5e93\uff0c\u9ad8\u7248\u672c\u7684\u5b89\u5353\u6e90\u7801\u4e2d\u4e5f\u4f7f\u7528\u4e86libunwind\u4f5c\u4e3a\u89e3\u5806\u6808\u7684\u5de5\u5177\uff0c\u5e76\u9488\u5bf9\u5b89\u5353\u505a\u4e86\u4e00\u4e9b\u9002\u914d\u3002\u4e0b\u9762\u662f\u4f7f\u7528libunwind\u89e3\u5806\u6808\u7684\u4e3b\u5faa\u73af\uff0c\u6bcf\u6b21\u5faa\u73af\u89e3\u4e00\u5c42\u5806\u6808\u3002</p> <pre><code>static ALWAYS_INLINE int\nslow_backtrace (void **buffer, int size, unw_context_t *uc)\n{\n  unw_cursor_t cursor;\n  unw_word_t ip;\n  int n = 0;\n\n  if (unlikely (unw_init_local (&amp;cursor, uc) &lt; 0))\n    return 0;\n\n  while (unw_step (&amp;cursor) &gt; 0)\n    {\n      if (n &gt;= size)\n          return n;\n      if (unw_get_reg (&amp;cursor, UNW_REG_IP, &amp;ip) &lt; 0)\n          return n;\n      buffer[n++] = (void *) (uintptr_t) ip;\n    }\n  return n;\n}\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#_6","title":"\u516b\u3001\u83b7\u53d6\u51fd\u6570\u7b26\u53f7","text":""},{"location":"perf-opt/Android/crash/native-catch/#1-libcorkscrew","title":"(1) libcorkscrew","text":"<p>\u53ef\u4ee5\u901a\u8fc7libcorkscrew\u4e2d\u7684get_backtrace_symbols\u51fd\u6570\u83b7\u5f97\u51fd\u6570\u7b26\u53f7\u3002</p> <pre><code>/*\n* Describes the symbols associated with a backtrace frame.\n*/\ntypedef struct {\n    uintptr_t relative_pc;\n    uintptr_t relative_symbol_addr;\n    char* map_name;\n    char* symbol_name;    \n    char* demangled_name;\n} backtrace_symbol_t;\n\n/*\n* Gets the symbols for each frame of a backtrace.\n* The symbols array must be big enough to hold one symbol record per frame.\n* The symbols must later be freed using free_backtrace_symbols.\n*/\n\nvoid get_backtrace_symbols(const backtrace_frame_t* backtrace, size_t frames,\n        backtrace_symbol_t* backtrace_symbols);\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#2-dladdr","title":"(2) dladdr","text":"<p>\u66f4\u901a\u7528\u7684\u65b9\u6cd5\u662f\u901a\u8fc7dladdr\u83b7\u5f97\u51fd\u6570\u540d\u5b57\u3002</p> <pre><code>int dladdr(void *addr, Dl_info *info);\n\ntypedef struct {\n   const char *dli_fname;  /* Pathname of shared object that\n                              contains address */\n   void       *dli_fbase;  /* Base address at which shared\n                              object is loaded */\n   const char *dli_sname;  /* Name of symbol whose definition\n                              overlaps addr */\n   void       *dli_saddr;  /* Exact address of symbol named\n                              in dli_sname */\n} Dl_info;\n</code></pre> <p>\u4f20\u5165\u6bcf\u4e00\u5c42\u5806\u6808\u7684\u76f8\u5bf9\u504f\u79fb\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u4ecedli_fname\u4e2d\u83b7\u5f97\u51fd\u6570\u540d\u5b57\u3002</p>"},{"location":"perf-opt/Android/crash/native-catch/#java","title":"\u4e5d\u3001\u83b7\u5f97java\u5806\u6808","text":"<p>\u5982\u4f55\u83b7\u5f97native crash\u6240\u5bf9\u5e94\u7684java\u5c42\u5806\u6808\uff0c\u8fd9\u4e2a\u95ee\u9898\u66fe\u7ecf\u56f0\u6270\u4e86\u6211\u4e00\u6bb5\u65f6\u95f4\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u524d\u63d0\uff1a\u6211\u4eec\u8ba4\u4e3acrash\u7ebf\u7a0b\u5c31\u662f\u6355\u83b7\u5230\u4fe1\u53f7\u7684\u7ebf\u7a0b\uff0c\u867d\u7136\u8fd9\u5728SIGABRT\u4e0b\u4e0d\u4e00\u5b9a\u53ef\u9760\u3002\u6709\u4e86\u8fd9\u4e2a\u8ba4\u77e5\uff0c\u63a5\u4e0b\u6765\u5c31\u597d\u529e\u4e86\u3002\u5728\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\u83b7\u5f97\u5f53\u524d\u7ebf\u7a0b\u7684\u540d\u5b57\uff0c\u7136\u540e\u628acrash\u7ebf\u7a0b\u7684\u540d\u5b57\u4f20\u7ed9java\u5c42\uff0c\u5728java\u91ccdump\u51fa\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u5806\u6808\uff0c\u5c31\u662fcrash\u6240\u5bf9\u5e94\u7684java\u5c42\u5806\u6808\u4e86\u3002</p> <p>\u5728c\u4e2d\u83b7\u5f97\u7ebf\u7a0b\u540d\u5b57\uff1a</p> <pre><code>char* getThreadName(pid_t tid) {\n    if (tid &lt;= 1) {\n        return NULL;\n    }\n    char* path = (char *) calloc(1, 80);\n    char* line = (char *) calloc(1, THREAD_NAME_LENGTH);\n\n    snprintf(path, PATH_MAX, \"proc/%d/comm\", tid);\n    FILE* commFile = NULL;\n    if (commFile = fopen(path, \"r\")) {\n        fgets(line, THREAD_NAME_LENGTH, commFile);\n        fclose(commFile);\n    }\n    free(path);\n    if (line) {\n        int length = strlen(line);\n        if (line[length - 1] == '\\n') {\n            line[length - 1] = '\\0';\n        }\n    }\n    return line;\n}\n</code></pre> <p>\u7136\u540e\u4f20\u7ed9java\u5c42\uff1a</p> <pre><code>    /**\n     * \u6839\u636e\u7ebf\u7a0b\u540d\u83b7\u5f97\u7ebf\u7a0b\u5bf9\u8c61\uff0cnative\u5c42\u4f1a\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u4e0d\u80fd\u6df7\u6dc6\n     * @param threadName\n     * @return\n     */\n    @Keep\n    public static Thread getThreadByName(String threadName) {\n        if (TextUtils.isEmpty(threadName)) {\n            return null;\n        }\n\n        Set&lt;Thread&gt; threadSet = Thread.getAllStackTraces().keySet();\n        Thread[] threadArray = threadSet.toArray(new Thread[threadSet.size()]);\n\n        Thread theThread = null;\n        for(Thread thread : threadArray) {\n            if (thread.getName().equals(threadName)) {\n                theThread =  thread;\n            }\n        }\n\n        Log.d(TAG, \"threadName: \" + threadName + \", thread: \" + theThread);\n        return theThread;\n    }\n</code></pre>"},{"location":"perf-opt/Android/crash/native-catch/#_7","title":"\u5341\u3001 \u7ed3\u679c\u5c55\u793a","text":"<p>\u7ecf\u8fc7\u8bf8\u591a\u63a2\u7d22\uff0c\u7ec8\u4e8e\u5f97\u5230\u4e86\u5b8c\u7f8e\u7684\u5806\u6808\uff1a</p> <pre><code>java.lang.Error: signal 11 (Address not mapped to object) at address 0x0\n  at dalvik.system.NativeStart.run(Native Method)\nCaused by: java.lang.Error: signal 11 (Address not mapped to object) at address 0x0\n  at /data/app-lib/com.tencent.moai.crashcatcher.demo-1/libQMCrashGenerator.so.0xd8e(dangerousFunction:0x5:0)\n  at /data/app-lib/com.tencent.moai.crashcatcher.demo-1/libQMCrashGenerator.so.0xd95(wrapDangerousFunction:0x2:0)\n  at /data/app-lib/com.tencent.moai.crashcatcher.demo-1/libQMCrashGenerator.so.0xd9d(nativeInvalidAddressCrash:0x2:0)\n  at /system/lib/libdvm.so.0x1ee8c(dvmPlatformInvoke:0x70:0)\n  at /system/lib/libdvm.so.0x503b7(dvmCallJNIMethod(unsigned int const*, JValue*, Method const*, Thread*):0x1ee:0)\n  at /system/lib/libdvm.so.0x28268(Native Method)\n  at /system/lib/libdvm.so.0x2f738(dvmMterpStd(Thread*):0x44:0)\n  at /system/lib/libdvm.so.0x2cda8(dvmInterpret(Thread*, Method const*, JValue*):0xb8:0)\n  at /system/lib/libdvm.so.0x648e3(dvmInvokeMethod(Object*, Method const*, ArrayObject*, ArrayObject*, ClassObject*, bool):0x1aa:0)\n  at /system/lib/libdvm.so.0x6cff9(Native Method)\n  at /system/lib/libdvm.so.0x28268(Native Method)\n  at /system/lib/libdvm.so.0x2f738(dvmMterpStd(Thread*):0x44:0)\n  at /system/lib/libdvm.so.0x2cda8(dvmInterpret(Thread*, Method const*, JValue*):0xb8:0)\n  at /system/lib/libdvm.so.0x643d9(dvmCallMethodV(Thread*, Method const*, Object*, bool, JValue*, std::__va_list):0x14c:0)\n  at /system/lib/libdvm.so.0x4bca1(Native Method)\n  at /system/lib/libandroid_runtime.so.0x50ac3(Native Method)\n  at /system/lib/libandroid_runtime.so.0x518e7(android::AndroidRuntime::start(char const*, char const*):0x206:0)\n  at /system/bin/app_process.0xf33(Native Method)\n  at /system/lib/libc.so.0xf584(__libc_init:0x64:0)\n  at /system/bin/app_process.0x107c(Native Method)\nCaused by: java.lang.Error: java stack\n  at com.tencent.crashcatcher.CrashCatcher.nativeInvalidAddressCrash(Native Method)\n  at com.tencent.crashcatcher.CrashCatcher.invalidAddressCrash(CrashCatcher.java:33)\n  at com.tencent.moai.crashcatcher.demo.MainActivity$4.onClick(MainActivity.java:56)\n  at android.view.View.performClick(View.java:4488)\n  at android.view.View$PerformClick.run(View.java:18860)\n  at android.os.Handler.handleCallback(Handler.java:808)\n  at android.os.Handler.dispatchMessage(Handler.java:103)\n  at android.os.Looper.loop(Looper.java:222)\n  at android.app.ActivityThread.main(ActivityThread.java:5484)\n  at java.lang.reflect.Method.invokeNative(Native Method)\n  at java.lang.reflect.Method.invoke(Method.java:515)\n  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:860)\n  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:676)\n  at dalvik.system.NativeStart.main(Native Method)\n</code></pre> <p>\u5728native\u5c42\u6784\u9020\u4e86\u4e00\u4e2aError\u4f20\u7ed9java\uff0c\u6240\u4ee5\u5728java\u5c42\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u6839\u636e\u5806\u6808\u8fdb\u884c\u4e1a\u52a1\u4e0a\u7684\u5904\u7406\u3002</p> <pre><code>public interface CrashHandleListener {\n    @Keep\n    void onCrash(int id, Error e);\n}\n</code></pre> <p>\u53e6\u5916\u521d\u59cb\u5316\u65f6\u5c31\u5efa\u7acb\u7b49\u5f85\u56de\u8c03\u7ebf\u7a0b\u7684\u65b9\u5f0f\uff0c\u63d0\u4f9b\u4e86\u7a33\u5b9a\u7684\u7ed9java\u5c42\u7684\u56de\u8c03\u3002\u5728\u56de\u8c03\u4e2d\u6211\u4eec\u6253\u5370\u4e86app\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u5305\u62ecactivity\u7684\u5806\u6808\u3001app\u662f\u5426\u5728\u524d\u53f0\u7b49\uff0c\u4ee5\u53ca\u6253\u5370crash\u524d\u7684logcat\u65e5\u5fd7\u548c\u628a\u5e94\u7528\u65e5\u5fd7flush\u8fdb\u6587\u4ef6\u3002\u9488\u5bf9\u67d0\u4e9b\u5177\u4f53\u7684native crash\u8fd8\u505a\u4e86\u4e1a\u52a1\u4e0a\u7684\u5904\u7406\uff0c\u4f8b\u5982\u9047\u5230\u70ed\u8865\u4e01\u6846\u67b6\u76f8\u5173\u7684crash\u65f6\u5c31\u56de\u6eda\u8865\u4e01\u3002</p> <p>\u5728\u7528\u6237\u73af\u5883\u4e2d\u7684\u5f88\u591anative crash\u5355\u9760\u5806\u6808\u662f\u89e3\u51b3\u4e0d\u4e86\u7684\uff0clogcat\u662f\u975e\u5e38\u91cd\u8981\u7684\u8865\u5145\u3002\u597d\u51e0\u4f8bwebview crash\u90fd\u662f\u901a\u8fc7\u53d1\u751fcrash\u65f6\u7684logcat\u5b9a\u4f4d\u7684\u3002\u6bd4\u5982\u6211\u4eec\u66fe\u7ecf\u9047\u5230\u8fc7\u7684\u4e00\u4e2a\u7684webview crash\uff1a</p> <pre><code>#00 pc 00039874  /system/lib/libc.so (tgkill+12)\n#01 pc 00013b5d  /system/lib/libc.so (pthread_kill+52)\n#02 pc 0001477b  /system/lib/libc.so (raise+10)\n#03 pc 00010ff5  /system/lib/libc.so (__libc_android_abort+36)\n#04 pc 0000f554  /system/lib/libc.so (abort+4)\n#05 pc 00239885  /system/lib/libwebviewchromium.so\n#06 pc 00219da3  /system/lib/libwebviewchromium.so\n#07 pc 00206459  /system/lib/libwebviewchromium.so\n#08 pc 001fb6c7  /system/lib/libwebviewchromium.so\n#09 pc 001edc97  /system/lib/libwebviewchromium.so\n#10 pc 001ec5ad  /system/lib/libwebviewchromium.so\n#11 pc 001ec617  /system/lib/libwebviewchromium.so\n#12 pc 001ec5e5  /system/lib/libwebviewchromium.so\n#13 pc 001ec5bf  /system/lib/libwebviewchromium.so\n#14 pc 0022c941  /system/lib/libwebviewchromium.so\n#15 pc 0022c92b  /system/lib/libwebviewchromium.so\n#16 pc 0022e6a1  /system/lib/libwebviewchromium.so\n#17 pc 0022ebcd  /system/lib/libwebviewchromium.so\n#18 pc 0022ee1d  /system/lib/libwebviewchromium.so\n#19 pc 0022c511  /system/lib/libwebviewchromium.so\n#20 pc 00013347  /system/lib/libc.so (_ZL15__pthread_startPv+30)\n#21 pc 0001135f  /system/lib/libc.so (__start_thread+6)\n</code></pre> <p>\u5355\u51ed\u5806\u6808\u6839\u672c\u770b\u4e0d\u51fa\u6765\u662f\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46\u662f\u5728logcat\u4e2d\u5374\u770b\u5230\u8fd9\u6837\u4e00\u4e2awarning log\uff1a</p> <pre><code>05-21 15:09:28.423 W/System.err(16811): java.lang.NullPointerException: Attempt to get length of null array\n05-21 15:09:28.424 W/System.err(16811):     at java.io.ByteArrayInputStream.&lt;init&gt;(ByteArrayInputStream.java:60)\n05-21 15:09:28.424 W/System.err(16811):     at com.tencent.*.InlineImage.fetcher.HttpImageFetcher.fetchFromNetwork(HttpImageFetcher.java:86)\n05-21 15:09:28.424 W/System.err(16811):     at com.tencent.*.InlineImage.fetcher.BaseFetcher.fetch(BaseFetcher.java:24)\n05-21 15:09:28.424 W/System.err(16811):     at com.tencent.*.InlineImage.delaystream.DelayInputStream.read(DelayInputStream.java:36)\n05-21 15:09:28.424 W/System.err(16811):     at com.tencent.*.InlineImage.delaystream.DelayHttpInputStream.read(DelayHttpInputStream.java:12)\n05-21 15:09:28.424 W/System.err(16811):     at java.io.InputStream.read(InputStream.java:181)\n05-21 15:09:28.424 W/System.err(16811):     at org.chromium.android_webview.InputStreamUtil.read(InputStreamUtil.java:54)\n</code></pre> <p>\u67e5\u4ee3\u7801\u53d1\u73b0\u662f\u6211\u4eec\u5728WebViewClient\u7684shouldInterceptRequest\u63a5\u53e3\u4e2d\u7684\u4e1a\u52a1\u4ee3\u7801\u53d1\u751f\u4e86NullPointerException\uff0c \u4f20\u8fdb\u53bbWebView\u5185\u90e8\u53d8\u6210\u4e86natvie crash\uff0c\u95ee\u9898\u89e3\u51b3\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/","title":"native \u5d29\u6e83\u4fe1\u53f7\u4ecb\u7ecd","text":""},{"location":"perf-opt/Android/crash/native-crash-signal/#_1","title":"\u4e00\u3001\u6982\u5ff5\u8bf4\u660e","text":"<p>\u5728\u5e94\u7528\u5d29\u6e83\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c06\u4f1a\u83b7\u53d6\u5230\u4e24\u4e2a\u4fe1\u606f:</p> <p>\u2022 signal: \u4fe1\u53f7\u91cf\uff0c\u4e0b\u6587\u5c06\u4f1a\u8be6\u7ec6\u7684\u8bf4\u660e\u4e0d\u540c\u7684\u4fe1\u53f7\u91cf\u53ca\u5176\u542b\u4e49</p> <p>\u2022 code: \u9519\u8bef\u7801, \u9664\u4e86\u51e0\u4e2a\u6240\u6709\u4fe1\u53f7\u91cf(signal) \u516c\u5171\u7684\u9519\u8bef\u7801(code)\uff0c\u4e00\u822c\u4e0d\u540c\u4fe1\u53f7\u91cf(signal)\u6709\u7279\u5b9a\u7684\u9519\u8bef\u7801(code)\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u4fe1\u53f7\u91cf(signal)\u7684\u8865\u5145\u8bf4\u660e\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/#signal-code","title":"\u4e8c\u3001\u4fe1\u53f7\u91cf(signal) \u548c \u9519\u8bef\u7801(code)\u8bf4\u660e","text":""},{"location":"perf-opt/Android/crash/native-crash-signal/#1-sigill","title":"1. SIGILL","text":"<p>SIG\u662f\u4fe1\u53f7\u540d\u7684\u901a\u7528\u524d\u7f00\uff0cILL\u662f illegal instruction\uff08 \u975e\u6cd5\u6307\u4ee4 \uff09 \u7684\u7f29\u5199\u3002</p> <p>\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 4\u3002</p> <p>SIGILL \u662f\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u5c1d\u8bd5\u6267\u884c\u4e00\u4e2a\u975e\u6cd5\u6307\u4ee4\u65f6\u53d1\u9001\u7ed9\u5b83\u7684\u4fe1\u53f7\u3002</p> <p>\u5e38\u89c1\u539f\u56e0\u6709:</p> <ol> <li>CPU\u67b6\u6784\u4e0d\u5339\u914d</li> <li>.so \u6587\u4ef6\u88ab\u7834\u574f\uff0c\u6216\u8005\u4ee3\u7801\u6bb5\u88ab\u7834\u574f\u5bfc\u81f4\uff1b</li> <li>\u4e3b\u52a8\u5d29\u6e83\uff0c\u5982 _builtintrap() \u4e5f\u4f1a\u4f7f\u7528\u975e\u6cd5\u6307\u4ee4\u6765\u5b9e\u73b0\u3002</li> </ol> <p>si_addr \u4e3a\u51fa\u9519\u7684\u6307\u4ee4\u3002</p> <p>\u8be5\u4fe1\u53f7\u91cf\u4e2d\u5e38\u89c1\u7684\u9519\u8bef\u7801\u8bf4\u660e\uff1a</p> Code \u8bf4\u660e ILL_ILLOPC \u975e\u6cd5\u7684\u64cd\u4f5c\u7801(opcode) ILL_ILLOPN \u975e\u6cd5\u7684\u64cd\u4f5c\u6570(operand) ILL_ILLADR \u975e\u6cd5\u7684\u5bfb\u5740\u6a21\u5f0f ILL_ILLTRP \u975e\u6cd5\u7684trap ILL_PRVOPC \u7279\u6743\u64cd\u4f5c\u7801(Privileged opcode) ILL_PRVREG \u7279\u6743\u5bc4\u5b58\u5668(Privileged register) ILL_COPROC \u534f\u5904\u7406\u5668\u9519\u8bef ILL_BADSTK \u5185\u90e8\u5806\u6808\u9519\u8bef"},{"location":"perf-opt/Android/crash/native-crash-signal/#2-sigbus","title":"2. SIGBUS","text":"<p>SIG\u662f\u4fe1\u53f7\u540d\u7684\u901a\u7528\u524d\u7f00\uff0cBUS\u662fbus error (\u603b\u7ebf\u9519\u8bef ) \uff0c\u610f\u5473\u7740\u7cfb\u7edf\u68c0\u6d4b\u5230\u786c\u4ef6\u95ee\u9898\u540e\u53d1\u9001\u7ed9\u8fdb\u7a0b\u7684\u4fe1\u53f7\u3002</p> <p>\u5bf9\u5e94\u7684\u6570\u503c\u4e3a7\u3002</p> <p>\u901a\u5e38\u8be5\u4fe1\u53f7\u7684\u4ea7\u751f\u4e0d\u662f\u56e0\u4e3a\u786c\u4ef6\u6709\u7269\u7406\u4e0a\u7684\u635f\u574f\uff0c\u800c\u662f\u4ee3\u7801\u5b9e\u73b0\u6709 bug \u5bfc\u81f4 \uff0c\u5982\u5730\u5740\u4e0d\u5bf9\u9f50\uff0c\u6216\u8005\u4e0d\u5b58\u5728\u7684\u7269\u7406\u5730\u5740\u7b49\u3002</p> <p>si_addr \u4e3a\u6240\u8bbf\u95ee\u7684\u975e\u6cd5\u5730\u5740\u3002</p> <p>\u8be5\u4fe1\u53f7\u91cf\u4e2d\u5e38\u89c1\u7684\u9519\u8bef\u7801\u8bf4\u660e\uff1a</p> Code \u8bf4\u660e BUS_ADRALN \u8bbf\u95ee\u7684\u5730\u5740\u4e0d\u5bf9\u9f50\u300232\u4f4d\u5904\u7406\u5668\u4e00\u822c\u8981\u6c42\u6307\u9488\u662f4\u5b57\u8282\u5bf9\u9f50\u7684 BUS_ADRERR \u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u7269\u7406\u5730\u5740\u3002\u4e00\u822c\u662f\u7531\u4e8e mmap \u7684\u6587\u4ef6\u53d1\u751f truncated \u5bfc\u81f4\u3002\u5e38\u89c1\u4e8e\u6587\u4ef6\u8bbf\u95ee\u8fc7\u7a0b\u4e2d\uff0c\u88ab\u5220\u9664\u6216\u8005\u66ff\u6362\uff1b\u6216 mmap \u5230\u5185\u5b58\u540e\uff0c\u7ee7\u7eed\u5411\u6587\u4ef6\u5199\u5165\u4e14\u5bfc\u81f4\u6587\u4ef6 truncated\uff0c\u518d\u8bfb\u53d6\u65f6\u5c31\u4f1a\u51fa\u73b0\u8be5\u9519\u8bef\uff1b\u53e6\u5916\uff0c mmap \u4e14\u8bbf\u95ee\u8d85\u8fc7\u6587\u4ef6\u5b9e\u9645\u5927\u5c0f\u7684\u7a7a\u95f4\u65f6\uff0c\u4e5f\u53ef\u80fd\u4f1a\u51fa\u73b0\u8be5\u9519\u8bef BUS_OBJERR \u7279\u5b9a\u5bf9\u8c61\u7684\u786c\u4ef6\u9519\u8bef BUS_MCEERR_AR BUS_MCEERR_AR BUS_MCEERR_AQ BUS_MCEERR_AQ"},{"location":"perf-opt/Android/crash/native-crash-signal/#3-sigsegv","title":"3. SIGSEGV","text":"<p>SIG \u662f\u4fe1\u53f7\u540d\u7684\u901a\u7528\u524d\u7f00, SEGV \u662f segmentation violation \u7684\u7f29\u5199\u3002</p> <p>\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 11\u3002</p> <p>\u8be5\u4fe1\u53f7\u610f\u5473\u7740\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u4e86\u4e00\u4e2a\u65e0\u6548\u7684\u5185\u5b58\u5f15\u7528\uff0c\u6216\u53d1\u751f\u6bb5\u9519\u8bef\u3002</p> <p>si_addr \u4e3a\u6240\u8bbf\u95ee\u7684\u65e0\u6548\u5730\u5740\u3002</p> <p>\u8be5\u4fe1\u53f7\u91cf\u4e2d\u5e38\u89c1\u7684\u9519\u8bef\u7801\u8bf4\u660e\uff1a</p> Code \u8bf4\u660e SEGV_MAPERR \u5730\u5740\u4e0d\u5728 /proc/self/map \u6620\u5c04\u4e2d SEGV_ACCERR \u6ca1\u6709\u8bbf\u95ee\u6743\u9650"},{"location":"perf-opt/Android/crash/native-crash-signal/#4-sigfpe","title":"4. SIGFPE","text":"<p>SIG\u662f\u4fe1\u53f7\u540d\u7684\u901a\u7528\u524d\u7f00\u3002FPE\u662ffloating-point exception\uff08\u6d6e\u70b9\u5f02\u5e38\uff09\u7684\u9996\u5b57\u6bcd\u7f29\u5199\u62fc\u63a5\u800c\u6210\u3002</p> <p>\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 8\u3002</p> <p>\u8be5\u4fe1\u53f7\u4e00\u822c\u662f\u7b97\u672f\u8fd0\u7b97\u76f8\u5173\u95ee\u9898\u5bfc\u81f4\u7684\u3002</p> <p>si_addr \u4e3a\u5931\u8d25\u7684\u6307\u4ee4\u3002</p> <p>\u8be5\u4fe1\u53f7\u91cf\u4e2d\u5e38\u89c1\u7684\u9519\u8bef\u7801\u8bf4\u660e\uff1a</p> Code \u8bf4\u660e FPE_INTDIV \u6574\u6570\u9664\u4ee5 0 FPE_INTOVF \u6574\u6570\u6ea2\u51fa FPE_FLTDIV \u6d6e\u70b9\u6570\u9664\u4ee5 0 FPE_FLTOVF \u6d6e\u70b9\u6570\u5411\u4e0b\u6ea2\u51fa FPE_FLTRES \u6d6e\u70b9\u6570\u7ed3\u679c\u4e0d\u7cbe\u786e FPE_FLTINV \u65e0\u6548\u7684\u6d6e\u70b9\u8fd0\u7b97 FPE_FLTSUB \u4e0b\u6807\u8d85\u51fa\u8303\u56f4"},{"location":"perf-opt/Android/crash/native-crash-signal/#5-sigabrt","title":"5. SIGABRT","text":"<p>SIG\u662f\u4fe1\u53f7\u540d\u7684\u901a\u7528\u524d\u7f00\u3002ABRT\u662fabort program\u7684\u7f29\u5199\u3002</p> <p>\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 6\u3002</p> <p>\u8be5\u4fe1\u53f7\u610f\u5473\u7740\u5f02\u5e38\u9000\u51fa\uff1b\u901a\u5e38\u662f\u8c03\u7528 abort(), raise(), kill(), pthread_kill() \u6216\u8005\u88ab\u7cfb\u7edf\u8fdb\u7a0b\u6740\u6b7b\u65f6\u51fa\u73b0\u3002</p> <p>\u5f53\u9519\u8bef\u7801\u4e3a SI_USER \u65f6\u8868\u793a\u662f\u88ab\u5176\u5b83\u7a0b\u5e8f\u6740\u6b7b\uff0c\u4e00\u822c\u60c5\u51b5\u662f\u7531\u4e8eANR\u88ab system_server \u6740\u6b7b\uff1b</p> <p>\u5176\u4ed6\u9519\u8bef\u7801\u4e00\u822c\u662f\u4e1a\u52a1\u81ea\u5df1\u8c03\u7528 abort() \u7b49\u51fd\u6570\u9000\u51fa\uff0c\u6b64\u65f6\u9519\u8bef\u7801\u4e00\u822c\u8ba4\u4e3a\u65e0\u6548\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/#6-sigstkflt","title":"6. SIGSTKFLT","text":"<p>SIG\u662f\u4fe1\u53f7\u540d\u7684\u901a\u7528\u524d\u7f00\uff0cSTKFLT\u662fstack fault \u7684\u7f29\u5199\u3002</p> <p>\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 16\u3002</p> <p>\u6309\u7167\u5b98\u65b9\u6587\u6863\u8bf4\u660e\uff0c\u8be5\u4fe1\u53f7\u91cf\u610f\u5473\u7740\u534f\u5904\u7406\u5668\u6808\u6545\u969c\u3002</p> <p>\u6839\u636e\u7f51\u4e0a\u7684\u90e8\u5206\u95ee\u9898\u7ed3\u8bba\u8bf4\u660e\uff0c\u5728\u5185\u5b58\u8017\u5c3d\u65f6\uff0c\u4e00\u822c malloc \u8fd4\u56de NULL \u4e14\u8bbe\u7f6e errno \u4e3a ENOMEM\uff0c\u4f46\u6709\u4e9b\u7cfb\u7edf\u53ef\u80fd\u4f1a\u4f7f\u7528 SIGSTKFLT \u4fe1\u53f7\u4ee3\u66ff\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/#7-sigpipe","title":"7. SIGPIPE","text":"<p>\u8be5\u4fe1\u53f7\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 13\u3002</p> <p>\u8be5\u4fe1\u53f7\u610f\u5473\u7740\u7ba1\u9053\u9519\u8bef\uff0c\u901a\u5e38\u5728\u8fdb\u7a0b\u95f4\u901a\u4fe1\u4ea7\u751f\uff0c\u6bd4\u5982\u91c7\u7528FIFO(\u7ba1\u9053)\u901a\u4fe1\u7684\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u8bfb\u7ba1\u9053\u6ca1\u6253\u5f00\u6216\u8005\u610f\u5916\u7ec8\u6b62\u4ecd\u7ee7\u7eed\u5f80\u7ba1\u9053\u5199\uff0c\u5199\u8fdb\u7a0b\u5c31\u4f1a\u6536\u5230 SIGPIPE \u4fe1\u53f7\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/#8-sigusr2","title":"8. SIGUSR2","text":"<p>\u4e3a 12\u3002\u7528\u6237\u81ea\u5b9a\u4e49\u4fe1\u53f72\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/#9-sigterm","title":"9. SIGTERM","text":"<p>SIG\u662f\u4fe1\u53f7\u540d\u7684\u901a\u7528\u524d\u7f00\uff0cTERM \u662f Termination \u7684\u7f29\u5199\u3002\u8be5\u4fe1\u53f7\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 15\u3002</p> <p>\u4e0e SIGKILL (signal 9) \u7c7b\u4f3c\uff0c\u4e0d\u8fc7 SIGKILL \u4e0d\u53ef\u6355\u83b7\uff0c\u800c SIGTERM \u53ef\u88ab\u6355\u83b7\u3002\u4e00\u822c\u5e38\u89c1\u4e8e APP \u5904\u4e8e\u540e\u53f0\u65f6\uff0c\u88ab\u7cfb\u7edf vold \u8fdb\u7a0b\u4f7f\u7528 SIGTERM \u6740\u6b7b\uff0c\u8be5\u60c5\u5f62\u57fa\u672c\u6ca1\u6709\u610f\u4e49\uff0c\u53ef\u5ffd\u7565\u3002</p> <p>\u53e6\u5916\uff0cchromium \u591a\u8fdb\u7a0b\u67b6\u6784\u4e2d\uff0c\u7ecf\u5e38\u4e5f\u4f1a\u4f7f\u7528 SIGTERM \u6740\u6b7b\u51fa\u73b0\u4e86\u5f02\u5e38\u7684\u5b50\u8fdb\u7a0b\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/#10-sigsys","title":"10. SIGSYS","text":"<p>\u8be5\u4fe1\u53f7\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 31\uff0c\u901a\u5e38\u662f\u56e0\u4e3a\u65e0\u6548\u7684 linux \u5185\u6838\u7cfb\u7edf\u8c03\u7528\u800c\u4ea7\u751f\u3002</p> <p>\u5728 android O (android 8.0) \u4e2d\uff0c\u90e8\u5206\u4e0d\u5b89\u5168\u7684\u7cfb\u7edf\u8c03\u7528\u88ab\u79fb\u9664\uff0c\u82e5\u4ee3\u7801\u4e2d\u4ecd\u7136\u4f7f\u7528\u5b83\u4eec\uff0c\u5219\u4f1a\u51fa\u73b0 SIGSYS\u3002</p>"},{"location":"perf-opt/Android/crash/native-crash-signal/#11-sigtrap","title":"11. SIGTRAP","text":"<p>\u8be5\u4fe1\u53f7\u5bf9\u5e94\u7684\u6570\u503c\u4e3a 5\u3002gdb \u8c03\u8bd5\u8bbe\u7f6e\u65ad\u70b9\u7b49\u64cd\u4f5c\u4f7f\u7528\u7684\u4fe1\u53f7\u3002</p> Code \u8bf4\u660e TRAP_BRKPT TRAP_BRKPT TRAP_TRACE TRAP_TRACE TRAP_BRANCH TRAP_BRANCH TRAP_HWBKPT TRAP_HWBKPT <p>\u53c2\u8003\u6587\u732e\uff1a</p> <ol> <li>siginfo_t \u2014 data structure containing signal information</li> <li>linux\u7cfb\u7edf\u7f16\u7a0b\u4e4b\u4fe1\u53f7\uff08\u4e00\uff09\uff1a\u4e2d\u65ad\u4e0e\u4fe1\u53f7</li> <li>linux\u7cfb\u7edf\u7f16\u7a0b\u4e4b\u4fe1\u53f7\uff08\u516d\uff09\uff1a\u4fe1\u53f7\u53d1\u9001\u51fd\u6570sigqueue\u548c\u4fe1\u53f7\u5b89\u88c5\u51fd\u6570sigaction</li> <li>SIGSTKFLT</li> </ol>"},{"location":"perf-opt/Android/jank/cpu_use/","title":"Linux\u73af\u5883\u4e0b\u8fdb\u7a0b\u7684CPU\u5360\u7528\u7387","text":""},{"location":"perf-opt/Android/jank/cpu_use/#1linux-cpu","title":"1\u3001Linux \u73af\u5883\u4e0b\u67e5\u770b CPU \u4fe1\u606f","text":""},{"location":"perf-opt/Android/jank/cpu_use/#11-cpu","title":"1.1\u3001\u67e5\u770b CPU \u8be6\u7ec6\u4fe1\u606f","text":"<p>\u901a\u8fc7 <code>cat /proc/cpuinfo</code> \u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b CPU \u76f8\u5173\u7684\u4fe1\u606f\uff1a</p> <pre><code>[root@rh ~]$ cat /proc/cpuinfo\nprocessor : 0\nvendor_id : GenuineIntel\ncpu family : 6\nmodel : 44\nmodel name : Intel(R) Xeon(R) CPU           E5620  @ 2.40GHz\nstepping : 2\ncpu MHz : 1596.000\ncache size : 12288 KB\nphysical id : 0\nsiblings : 8\ncore id : 0\ncpu cores : 4\napicid : 0\ninitial apicid : 0\nfpu : yes\nfpu_exception : yes\ncpuid level : 11\nwp : yes\nflags : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt aes lahf_lm arat epb dts tpr_shadow vnmi flexpriority ept vpid\nbogomips : 4800.15\nclflush size : 64\ncache_alignment : 64\naddress sizes : 40 bits physical, 48 bits virtual\npower management:\n......\n</code></pre> <p>\u5728\u67e5\u770b\u5230\u7684\u76f8\u5173\u4fe1\u606f\u4e2d\uff0c\u901a\u5e38\u6709\u4e9b\u4fe1\u606f\u6bd4\u8f83\u8ba9\u4eba\u8ff7\u60d1\uff0c\u8fd9\u91cc\u5217\u51fa\u4e00\u4e9b\u89e3\u91ca\uff1a</p> <ul> <li>physical id: \u6307\u7684\u662f\u7269\u7406\u5c01\u88c5\u7684\u5904\u7406\u5668\u7684 id\u3002</li> <li>cpu cores: \u4f4d\u4e8e\u76f8\u540c\u7269\u7406\u5c01\u88c5\u7684\u5904\u7406\u5668\u4e2d\u7684\u5185\u6838\u6570\u91cf\u3002</li> <li>core id: \u6bcf\u4e2a\u5185\u6838\u7684 id\u3002</li> <li>siblings: \u4f4d\u4e8e\u76f8\u540c\u7269\u7406\u5c01\u88c5\u7684\u5904\u7406\u5668\u4e2d\u7684\u903b\u8f91\u5904\u7406\u5668\u7684\u6570\u91cf\u3002</li> <li>processor: \u903b\u8f91\u5904\u7406\u5668\u7684 id\u3002</li> </ul> <p>\u6211\u4eec\u901a\u5e38\u53ef\u4ee5\u7528\u4e0b\u9762\u8fd9\u4e9b\u547d\u4ee4\u83b7\u5f97\u8fd9\u4e9b\u53c2\u6570\u7684\u4fe1\u606f\uff1a</p> <pre><code>[root@rh ~]$ cat /proc/cpuinfo | grep \"physical id\" | sort|uniq\nphysical id     : 0\nphysical id     : 1\n[root@rh ~]$ cat /proc/cpuinfo | grep \"cpu cores\" | sort|uniq\ncpu cores     : 4\n[root@rh ~]# cat /proc/cpuinfo | grep \"core id\" | sort|uniq\ncore id          : 0\ncore id          : 1\ncore id          : 10\ncore id          : 9\n[root@rh ~]$ cat /proc/cpuinfo | grep \"siblings\" | sort|uniq\nsiblings     : 8\n[root@rh ~]$ cat /proc/cpuinfo | grep \"processor\" | sort|uniq\nprocessor     : 0\nprocessor     : 1\nprocessor     : 10\nprocessor     : 11\nprocessor     : 12\nprocessor     : 13\nprocessor     : 14\nprocessor     : 15\nprocessor     : 2\nprocessor     : 3\nprocessor     : 4\nprocessor     : 5\nprocessor     : 6\nprocessor     : 7\nprocessor     : 8\nprocessor     : 9\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u770b\u51fa\u8fd9\u53f0\u673a\u5668\uff1a</p> <ul> <li>1\uff09\u6709 2 \u4e2a\u7269\u7406\u5c01\u88c5\u7684\u5904\u7406\u5668\uff08physical id \u6709 2 \u4e2a\uff09\uff1b</li> <li>2\uff09\u6bcf\u4e2a\u7269\u7406\u5c01\u88c5\u7684\u5904\u7406\u5668\u6709 4 \u4e2a\u5185\u6838\uff08cpu cores \u4e3a 4\uff09\uff1b</li> <li>3\uff09\u6bcf\u4e2a\u7269\u7406\u5c01\u88c5\u7684\u5904\u7406\u5668\u6709 8 \u4e2a\u903b\u8f91\u5904\u7406\u5668\uff08siblings \u4e3a 8\uff09\uff0c\u53ef\u89c1\u53f0\u673a\u5668\u7684\u5904\u7406\u5668\u5f00\u542f\u4e86\u8d85\u7ebf\u7a0b\u6280\u672f\uff0c\u6bcf\u4e2a\u5185\u6838\uff08core\uff09\u88ab\u5212\u5206\u4e3a\u4e86 2 \u4e2a\u903b\u8f91\u5904\u7406\u5668\uff08processor\uff09\uff1b</li> <li>4\uff09\u603b\u5171\u6709 16 \u4e2a\u903b\u8f91\u5904\u7406\u5668\uff08processor \u6709 16 \u4e2a\uff09\uff1b</li> </ul> <p><code>\u8d85\u7ebf\u7a0b\u6280\u672f</code>\uff1a\u8d85\u7ebf\u7a0b\u6280\u672f\u5c31\u662f\u5229\u7528\u7279\u6b8a\u7684\u786c\u4ef6\u6307\u4ee4\uff0c\u628a\u4e24\u4e2a\u903b\u8f91\u5185\u6838\u6a21\u62df\u6210\u4e24\u4e2a\u7269\u7406\u82af\u7247\uff0c\u8ba9\u5355\u4e2a\u5904\u7406\u5668\u90fd\u80fd\u4f7f\u7528\u7ebf\u7a0b\u7ea7\u5e76\u884c\u8ba1\u7b97\uff0c\u8fdb\u800c\u517c\u5bb9\u591a\u7ebf\u7a0b\u64cd\u4f5c\u7cfb\u7edf\u548c\u8f6f\u4ef6\uff0c\u51cf\u5c11\u4e86CPU\u7684\u95f2\u7f6e\u65f6\u95f4\uff0c\u63d0\u9ad8\u7684CPU\u7684\u8fd0\u884c\u6548\u7387\u3002</p>"},{"location":"perf-opt/Android/jank/cpu_use/#12-cpu","title":"1.2\u3001\u67e5\u770b\u591a\u6838 CPU \u4fe1\u606f","text":"<p>\u53ef\u4ee5\u4f7f\u7528 <code>mpstat</code> \u547d\u4ee4\u6216 <code>sar</code> \u547d\u4ee4\u6765\u67e5\u770b\u3002 \u5177\u4f53\u4f7f\u7528\u53ef\u4ee5\u901a\u8fc7 <code>man mpstat/sar</code> \u6765\u67e5\u770b\u3002</p>"},{"location":"perf-opt/Android/jank/cpu_use/#2-linux-cpu","title":"2\u3001\u5728 Linux \u73af\u5883\u4e0b\u8ba1\u7b97\u8fdb\u7a0b\u7684 CPU \u5360\u7528","text":""},{"location":"perf-opt/Android/jank/cpu_use/#21-procstat-cpu","title":"2.1\u3001\u901a\u8fc7 /proc/stat \u6587\u4ef6\u67e5\u770b\u6240\u6709\u7684 CPU \u6d3b\u52a8\u4fe1\u606f","text":"<p>\u4e0b\u9762\u5b9e\u4f8b\u6570\u636e\u662f\u5185\u6838 2.6.24-24 \u7248\u672c\u4ee5\u4e0a\u7684\uff1a</p> <pre><code>[root@rh ~]$ cat /proc/stat\ncpu  223447 240 4504182 410802165 59753 412 586209 0 0\ncpu0 17625 11 193414 25755165 34590 72 16780 0 0\ncpu1 12412 9 139234 25860912 1139 27 15697 0 0\ncpu2 14953 0 558618 25310182 230 73 87851 0 0\ncpu3 4088 0 138057 25873479 3404 19 15862 0 0\ncpu4 13417 17 161123 25829756 10429 22 17155 0 0\ncpu5 23935 5 331837 25605479 369 20 26095 0 0\ncpu6 19320 0 319132 25619728 2060 18 30690 0 0\ncpu7 18430 0 324300 25616142 4170 20 33081 0 0\ncpu8 31940 0 661718 25231911 1474 15 67661 0 0\ncpu9 8079 87 152035 25829339 237 19 16308 0 0\ncpu10 4247 24 140052 25869331 168 18 15059 0 0\ncpu11 16305 4 401473 25567904 207 14 34674 0 0\ncpu12 8227 0 157815 25853353 319 10 14808 0 0\ncpu13 18894 46 479709 25354279 653 26 157885 0 0\ncpu14 7000 30 204760 25769743 159 16 21059 0 0\ncpu15 4567 1 140899 25855452 138 16 15536 0 0\nintr 1146734384 997 0 0 1 1 0 0 0 1 0 0 0 0 0 1302607 0 0 262087 0 712704 0 0 0 &lt;...\u7701\u7565\u82e5\u5e72\u6570\u636e...&gt;\nctxt 89793364\nbtime 1366591448\nprocesses 27283\nprocs_running 1\nprocs_blocked 0\nsoftirq 1262462448 0 63122856 50789329 1074176388 225020 0 461213 9535581 76130 64075931\n</code></pre> <p>\u7b2c\u4e00\u884c\u7684\u6570\u636e\u8868\u793a\u7684\u662f CPU \u603b\u7684\u4f7f\u7528\u60c5\u51b5\u3002\u6211\u4eec\u6765\u89e3\u91ca\u4e00\u4e0b\u8fd9\u884c\u6570\u636e\u5404\u6570\u503c\u7684\u542b\u4e49\uff1a</p> <ul> <li> <p>1\uff09\u8fd9\u4e9b\u6570\u503c\u7684\u5355\u4f4d\u90fd\u662f jiffies\uff0cjiffies \u662f\u5185\u6838\u4e2d\u7684\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u7528\u6765\u8bb0\u5f55\u7cfb\u7edf\u542f\u52a8\u4ee5\u6765\u4ea7\u751f\u7684\u8282\u62cd\u6570\uff0c\u5728 Linux \u4e2d\uff0c\u4e00\u4e2a\u8282\u62cd\u5927\u81f4\u53ef\u4ee5\u7406\u89e3\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b\u8c03\u5ea6\u7684\u6700\u5c0f\u65f6\u95f4\u7247\uff0c\u4e0d\u540c\u7684 Linux \u7cfb\u7edf\u5185\u6838\u8fd9\u4e2a\u503c\u53ef\u80fd\u4e0d\u540c\uff0c\u901a\u5e38\u5728 1ms \u5230 10ms \u4e4b\u95f4\u3002</p> </li> <li> <p>2\uff09cpu 223447 240 4504182 410802165 59753 412 586209 0 0</p> </li> </ul> <ul> <li><code>user</code>(223447) \u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u79ef\u5230\u5f53\u524d\u65f6\u523b\uff0c\u5904\u4e8e\u7528\u6237\u6001\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u4e0d\u5305\u542b nice \u503c\u4e3a\u8d1f\u7684\u8fdb\u7a0b\u3002</li> <li><code>nice</code>(240) \u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u79ef\u5230\u5f53\u524d\u65f6\u523b\uff0cnice \u503c\u4e3a\u8d1f\u7684\u8fdb\u7a0b\u6240\u5360\u7528\u7684 CPU \u65f6\u95f4\u3002</li> <li><code>system</code>(4504182) \u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u79ef\u5230\u5f53\u524d\u65f6\u523b\uff0c\u5904\u4e8e\u6838\u5fc3\u6001\u7684\u8fd0\u884c\u65f6\u95f4\u3002</li> <li><code>idle</code>(410802165) \u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u79ef\u5230\u5f53\u524d\u65f6\u523b\uff0c\u9664 IO \u7b49\u5f85\u65f6\u95f4\u4ee5\u5916\u7684\u5176\u4ed6\u7b49\u5f85\u65f6\u95f4\u3002</li> <li><code>iowait</code>(59753) \u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u79ef\u5230\u5f53\u524d\u65f6\u523b\uff0cIO \u7b49\u5f85\u65f6\u95f4\u3002(since 2.5.41)</li> <li><code>irq</code>(412) \u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u79ef\u5230\u5f53\u524d\u65f6\u523b\uff0c\u786c\u4e2d\u65ad\u65f6\u95f4\u3002(since 2.6.0-test4)</li> <li><code>softirq</code>(586209) \u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u79ef\u5230\u5f53\u524d\u65f6\u523b\uff0c\u8f6f\u4e2d\u65ad\u65f6\u95f4\u3002(since 2.6.0-test4)</li> <li><code>stealstolen</code>(0) Which is the time spent in other operating systems when running in a virtualized environment.(since 2.6.11)</li> <li><code>guest</code>(0) Which is the time spent running a virtual CPU for guest operating systems under the control of the Linux kernel.(since 2.6.24)</li> </ul> <p>\u4ece\u4ee5\u4e0a\u4fe1\u606f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u603b\u7684 CPU \u6d3b\u52a8\u65f6\u95f4\u4e3a\uff1a</p> <p>totalCPUTime = <code>user</code> + <code>nice</code> + <code>system</code> + <code>idle</code> + <code>iowait</code> + <code>irq</code> + <code>softirq</code> + <code>stealstolen</code> + <code>guest</code></p>"},{"location":"perf-opt/Android/jank/cpu_use/#22-procpidstat-cpu","title":"2.2\u3001\u901a\u8fc7 /proc/[PID]/stat \u6587\u4ef6\u67e5\u770b\u67d0\u4e00\u8fdb\u7a0b\u7684 CPU \u6d3b\u52a8\u4fe1\u606f","text":"<p>2.2.1\u3001\u5b58\u50a8\u8fdb\u7a0b\u4fe1\u606f\u7684\u6587\u4ef6\u76ee\u5f55</p> <p>Linux \u7cfb\u7edf\u8d2f\u5f7b\u201c\u4e00\u5207\u90fd\u662f\u6587\u4ef6\u201d\u7684\u601d\u60f3\uff0c\u6240\u6709\u7684\u8fdb\u7a0b\u7684\u8fd0\u884c\u72b6\u6001\u4e5f\u90fd\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u6587\u4ef6\u6765\u83b7\u53d6\u3002 <code>/proc</code> \u6587\u4ef6\u7cfb\u7edf\u662f\u4e00\u4e2a\u4f2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u53ea\u5b58\u5728\u5185\u5b58\u5f53\u4e2d\uff0c\u800c\u4e0d\u5360\u7528\u5916\u5b58\u7a7a\u95f4\u3002\u5b83\u4ee5\u6587\u4ef6\u7cfb\u7edf\u7684\u65b9\u5f0f\u4e3a\u5185\u6838\u4e0e\u8fdb\u7a0b\u63d0\u4f9b\u901a\u4fe1\u7684\u63a5\u53e3\u3002\u7528\u6237\u548c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7 <code>/proc</code> \u5f97\u5230\u7cfb\u7edf\u7684\u4fe1\u606f\uff0c\u5e76\u53ef\u4ee5\u6539\u53d8\u5185\u6838\u7684\u67d0\u4e9b\u53c2\u6570\u3002</p> <p>\u5728 <code>/proc/[PID]/</code> \u76ee\u5f55\u4e0b\u7684\u5404\u4e2a\u6587\u4ef6\u8bb0\u5f55\u7740 \u8fd9\u4e2a\u8fdb\u7a0b\u7684\u5404\u9879\u8fd0\u884c\u6307\u6807\u3002 \u662f\u8fdb\u7a0b\u53f7\u3002</p> <p>2.2.2\u3001\u67e5\u770b\u8fdb\u7a0b\u8fd0\u884c\u7684\u8be6\u7ec6\u4fe1\u606f</p> <p>\u901a\u8fc7\u67e5\u770b <code>/proc/[PID]/stat</code> \u6587\u4ef6\uff0c\u53ef\u4ee5\u8fdb\u7a0b\u8fd0\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5176\u4e2d\u5c31\u5305\u62ec CPU \u5360\u7528\u4fe1\u606f\u3002 \u6bd4\u5982\uff1a</p> <pre><code>[root@rh ~]$ cat /proc/1/stat\n1 (init) S 0 1 1 0 -1 4202752 3026 2635222 9 483 5 165 102346 3188016 20 0 1 0 1 19820544 384 18446744073709551615 1 1 0 0 0 0 0 4096 536962595 18446744073709551615 0 0 0 4 0 0 34 0 0\n</code></pre> <p><code>/proc/[PID]/stat</code> \u6587\u4ef6\u4fe1\u606f\u89e3\u91ca</p> <p>\u770b\u5230\u4e0a\u9762\u8fd9\u4e9b\u4fe1\u606f\uff0c\u80af\u5b9a\u4f1a\u5f88\u8ff7\u60d1\uff0c\u4e0d\u77e5\u9053\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u662f\u4ec0\u4e48\u610f\u601d\u3002</p> <p>1\uff09\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 man 5 proc \u547d\u4ee4\u67e5\u770b\u6587\u6863\uff0c\u627e\u5230 /proc/[pid]/stat \u8282\u70b9\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u5404\u5b57\u6bb5\u7684\u610f\u601d\u4e86\u3002\u5982\uff1a</p> <pre><code>/proc/[pid]/stat\nStatus information about the process.  This is used by ps(1).  It is defined in /usr/src/linux/fs/proc/array.c.\nThe fields, in order, with their proper scanf(3) format specifiers, are:\npid %d      The process ID.\ncomm %s     The  filename  of the executable, in parentheses.  This is visible whether or not the executable is swapped out.\nstate %c    One character from the string \"RSDZTW\" where R is running, S is sleeping in an interruptible  wait,  D  is waiting in uninterruptible disk sleep, Z is zombie, T is traced or stopped (on a signal), and W is paging.\nppid %d     The PID of the parent.\n......\n</code></pre> <p>2\uff09\u5177\u4f53\u89e3\u91ca\uff0c\u4e00\u4e2a\u793a\u4f8b\uff1a</p> <ul> <li><code>pid</code>=6873 \u8fdb\u7a0b(\u5305\u62ec\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff0c\u5373\u7ebf\u7a0b)\u53f7</li> <li><code>comm</code>=a.out \u5e94\u7528\u7a0b\u5e8f\u6216\u547d\u4ee4\u7684\u540d\u5b57\u3002</li> <li><code>task_state</code>=R \u4efb\u52a1\u7684\u72b6\u6001\uff0cR:runnign, S:sleeping (<code>TASK_INTERRUPTIBLE</code>), D:disk sleep (<code>TASK_UNINTERRUPTIBLE</code>), T: stopped, T:tracing stop, Z:zombie, X:dead\u3002</li> <li><code>ppid</code>=6723 \u7236\u8fdb\u7a0bID\u3002</li> <li><code>pgid</code>=6873 \u7ebf\u7a0b\u7ec4\u53f7\u3002</li> <li><code>sid</code>=6723 \u8be5\u4efb\u52a1\u6240\u5728\u7684\u4f1a\u8bdd\u7ec4 ID\u3002</li> <li><code>tty_nr</code>=34819(pts/3) \u8be5\u4efb\u52a1\u7684 tty \u7ec8\u7aef\u7684\u8bbe\u5907\u53f7\uff0cINT\uff0834817/256\uff09= \u4e3b\u8bbe\u5907\u53f7\uff0c\uff0834817-\u4e3b\u8bbe\u5907\u53f7\uff09= \u6b21\u8bbe\u5907\u53f7\u3002</li> <li><code>tty_pgrp</code>=6873 \u7ec8\u7aef\u7684\u8fdb\u7a0b\u7ec4\u53f7\uff0c\u5f53\u524d\u8fd0\u884c\u5728\u8be5\u4efb\u52a1\u6240\u5728\u7ec8\u7aef\u7684\u524d\u53f0\u4efb\u52a1(\u5305\u62ec shell \u5e94\u7528\u7a0b\u5e8f)\u7684 PID\u3002</li> <li><code>task-&gt;flags</code>=8388608 \u8fdb\u7a0b\u6807\u5fd7\u4f4d\uff0c\u67e5\u770b\u8be5\u4efb\u52a1\u7684\u7279\u6027\u3002</li> <li><code>min_flt</code>=77 \u8be5\u4efb\u52a1\u4e0d\u9700\u8981\u4ece\u786c\u76d8\u62f7\u6570\u636e\u800c\u53d1\u751f\u7684\u7f3a\u9875\uff08\u6b21\u7f3a\u9875\uff09\u7684\u6b21\u6570\u3002</li> <li><code>cmin_flt</code>=0 \u7d2f\u8ba1\u7684\u8be5\u4efb\u52a1\u7684\u6240\u6709\u7684 waited-for \u8fdb\u7a0b\u66fe\u7ecf\u53d1\u751f\u7684\u6b21\u7f3a\u9875\u7684\u6b21\u6570\u76ee\u3002</li> <li><code>maj_flt</code>=0 \u8be5\u4efb\u52a1\u9700\u8981\u4ece\u786c\u76d8\u62f7\u6570\u636e\u800c\u53d1\u751f\u7684\u7f3a\u9875\uff08\u4e3b\u7f3a\u9875\uff09\u7684\u6b21\u6570\u3002</li> <li><code>cmaj_flt</code>=0 \u7d2f\u8ba1\u7684\u8be5\u4efb\u52a1\u7684\u6240\u6709\u7684 waited-for \u8fdb\u7a0b\u66fe\u7ecf\u53d1\u751f\u7684\u4e3b\u7f3a\u9875\u7684\u6b21\u6570\u76ee\u3002</li> <li><code>utime</code>=1587 \u8be5\u4efb\u52a1\u5728\u7528\u6237\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>stime</code>=1 \u8be5\u4efb\u52a1\u5728\u6838\u5fc3\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>cutime</code>=0 \u7d2f\u8ba1\u7684\u8be5\u4efb\u52a1\u7684\u6240\u6709\u7684 waited-for \u8fdb\u7a0b\u66fe\u7ecf\u5728\u7528\u6237\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>cstime</code>=0 \u7d2f\u8ba1\u7684\u8be5\u4efb\u52a1\u7684\u6240\u6709\u7684 waited-for \u8fdb\u7a0b\u66fe\u7ecf\u5728\u6838\u5fc3\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>priority</code>=25 \u4efb\u52a1\u7684\u52a8\u6001\u4f18\u5148\u7ea7\u3002</li> <li><code>nice</code>=0 \u4efb\u52a1\u7684\u9759\u6001\u4f18\u5148\u7ea7\u3002</li> <li><code>num_threads</code>=3 \u8be5\u4efb\u52a1\u6240\u5728\u7684\u7ebf\u7a0b\u7ec4\u91cc\u7ebf\u7a0b\u7684\u4e2a\u6570\u3002</li> <li><code>it_real_value</code>=0 \u7531\u4e8e\u8ba1\u65f6\u95f4\u9694\u5bfc\u81f4\u7684\u4e0b\u4e00\u4e2a SIGALRM \u53d1\u9001\u8fdb\u7a0b\u7684\u65f6\u5ef6\uff0c\u4ee5 jiffy \u4e3a\u5355\u4f4d\u3002</li> <li><code>start_time</code>=5882654 \u8be5\u4efb\u52a1\u542f\u52a8\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>vsize</code>=1409024\uff08page\uff09 \u8be5\u4efb\u52a1\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5927\u5c0f\u3002</li> <li><code>rss</code>=56(page) \u8be5\u4efb\u52a1\u5f53\u524d\u9a7b\u7559\u7269\u7406\u5730\u5740\u7a7a\u95f4\u7684\u5927\u5c0f\uff1bNumber of pages the process has in real memory,minu 3 for administrative purpose. \u8fd9\u4e9b\u9875\u53ef\u80fd\u7528\u4e8e\u4ee3\u7801\uff0c\u6570\u636e\u548c\u6808\u3002</li> <li><code>rlim</code>=4294967295\uff08bytes\uff09 \u8be5\u4efb\u52a1\u80fd\u9a7b\u7559\u7269\u7406\u5730\u5740\u7a7a\u95f4\u7684\u6700\u5927\u503c\u3002</li> <li><code>start_code</code>=134512640 \u8be5\u4efb\u52a1\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u4ee3\u7801\u6bb5\u7684\u8d77\u59cb\u5730\u5740\u3002</li> <li><code>end_code</code>=134513720 \u8be5\u4efb\u52a1\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u4ee3\u7801\u6bb5\u7684\u7ed3\u675f\u5730\u5740\u3002</li> <li><code>start_stack</code>=3215579040 \u8be5\u4efb\u52a1\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u6808\u7684\u7ed3\u675f\u5730\u5740\u3002</li> <li><code>kstkesp</code>=0 esp(32 \u4f4d\u5806\u6808\u6307\u9488) \u7684\u5f53\u524d\u503c, \u4e0e\u5728\u8fdb\u7a0b\u7684\u5185\u6838\u5806\u6808\u9875\u5f97\u5230\u7684\u4e00\u81f4\u3002</li> <li><code>kstkeip</code>=2097798 \u6307\u5411\u5c06\u8981\u6267\u884c\u7684\u6307\u4ee4\u7684\u6307\u9488, EIP(32 \u4f4d\u6307\u4ee4\u6307\u9488)\u7684\u5f53\u524d\u503c\u3002</li> <li><code>pendingsig</code>=0 \u5f85\u5904\u7406\u4fe1\u53f7\u7684\u4f4d\u56fe\uff0c\u8bb0\u5f55\u53d1\u9001\u7ed9\u8fdb\u7a0b\u7684\u666e\u901a\u4fe1\u53f7\u3002</li> <li><code>block_sig</code>=0 \u963b\u585e\u4fe1\u53f7\u7684\u4f4d\u56fe\u3002</li> <li><code>sigign</code>=0 \u5ffd\u7565\u7684\u4fe1\u53f7\u7684\u4f4d\u56fe\u3002</li> <li><code>sigcatch</code>=082985 \u88ab\u4fd8\u83b7\u7684\u4fe1\u53f7\u7684\u4f4d\u56fe\u3002</li> <li><code>wchan</code>=0 \u5982\u679c\u8be5\u8fdb\u7a0b\u662f\u7761\u7720\u72b6\u6001\uff0c\u8be5\u503c\u7ed9\u51fa\u8c03\u5ea6\u7684\u8c03\u7528\u70b9\u3002</li> <li><code>nswap</code> \u88ab swapped \u7684\u9875\u6570\uff0c\u5f53\u524d\u6ca1\u7528\u3002</li> <li><code>cnswap</code> \u6240\u6709\u5b50\u8fdb\u7a0b\u88ab swapped \u7684\u9875\u6570\u7684\u548c\uff0c\u5f53\u524d\u6ca1\u7528\u3002</li> <li><code>exit_signal</code>=17 \u8be5\u8fdb\u7a0b\u7ed3\u675f\u65f6\uff0c\u5411\u7236\u8fdb\u7a0b\u6240\u53d1\u9001\u7684\u4fe1\u53f7\u3002</li> <li><code>task_cpu(task)</code>=0 \u8fd0\u884c\u5728\u54ea\u4e2a CPU \u4e0a\u3002</li> <li><code>task_rt_priority</code>=0 \u5b9e\u65f6\u8fdb\u7a0b\u7684\u76f8\u5bf9\u4f18\u5148\u7ea7\u522b\u3002</li> <li><code>task_policy</code>=0 \u8fdb\u7a0b\u7684\u8c03\u5ea6\u7b56\u7565\uff0c0=\u975e\u5b9e\u65f6\u8fdb\u7a0b\uff0c1=FIFO\u5b9e\u65f6\u8fdb\u7a0b\uff1b2=RR\u5b9e\u65f6\u8fdb\u7a0b</li> </ul> <p>2.2.3\u3001\u5173\u4e8e\u8fdb\u7a0b\u5360\u7528 CPU \u7684\u76f8\u5173\u4fe1\u606f</p> <p>\u5728\u4e0a\u8ff0\u7684\u65f6\u95f4\u4e2d\uff0c\u8fd9\u4e9b\u4fe1\u606f\u4f1a\u5728\u8ba1\u7b97 CPU \u5360\u7528\u7387\u65f6\u7528\u5230\uff1a</p> <ul> <li><code>pid</code> \u8fdb\u7a0b\u53f7\u3002</li> <li><code>utime</code> \u8be5\u4efb\u52a1\u5728\u7528\u6237\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>stime</code> \u8be5\u4efb\u52a1\u5728\u6838\u5fc3\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>cutime</code> \u7d2f\u8ba1\u7684\u8be5\u4efb\u52a1\u7684\u6240\u6709\u7684 waited-for \u8fdb\u7a0b\u66fe\u7ecf\u5728\u7528\u6237\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> <li><code>cstime</code> \u7d2f\u8ba1\u7684\u8be5\u4efb\u52a1\u7684\u6240\u6709\u7684 waited-for \u8fdb\u7a0b\u66fe\u7ecf\u5728\u6838\u5fc3\u6001\u8fd0\u884c\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a jiffies\u3002</li> </ul> <p>\u8be5\u8fdb\u7a0b\u7684 CPU \u5360\u7528\u65f6\u95f4\uff08\u8be5\u503c\u5305\u62ec\u5176\u6240\u6709\u7ebf\u7a0b\u7684 CPU \u65f6\u95f4\uff09\uff1a</p> <p>processCPUTime = utime + stime + cutime + cstime</p>"},{"location":"perf-opt/Android/jank/cpu_use/#23-procpidtasktidstat","title":"2.3\u3001\u901a\u8fc7 /proc/[PID]/task/[TID]/stat \u6587\u4ef6\u67e5\u770b\u67d0\u4e00\u8fdb\u7a0b\u4e0b\u7684\u67d0\u4e00\u7ebf\u7a0b\u7684\u6d3b\u52a8\u4fe1\u606f","text":"<p>\u8be5\u6587\u4ef6\u5305\u542b\u4e86\u67d0\u4e00\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff08lwp\uff0c\u5373\u901a\u5e38\u6240\u8bf4\u7684\u7ebf\u7a0b\uff09\u6240\u6709\u7684\u6d3b\u52a8\u4fe1\u606f\uff0c\u8be5\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u503c\u90fd\u662f\u4ece\u7cfb\u7edf\u542f\u52a8\u5f00\u59cb\u7d2f\u8ba1\u5230\u5f53\u524d\u65f6\u523b\u3002\u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u683c\u5f0f\u4ee5\u53ca\u5404\u5b57\u6bb5\u7684\u542b\u4e49\u4e0e <code>/proc/[PID]/stat</code> \u6587\u4ef6\u7c7b\u4f3c\u3002\u8be5\u6587\u4ef6\u4e2d\u7684 <code>tid</code> \u5b57\u6bb5\u8868\u793a\u7684\u662f\u8f7b\u91cf\u7ea7\u7ebf\u7a0b\u53f7\u3002</p> <p>\u8be5\u7ebf\u7a0b\u7684 CPU \u5360\u7528\u65f6\u95f4\uff1a</p> <p>threadCPUTime = utime + stime</p>"},{"location":"perf-opt/Android/jank/cpu_use/#24-cpu","title":"2.4\u3001\u5355\u6838\u60c5\u51b5\u4e0b CPU \u4f7f\u7528\u7387\u7684\u8ba1\u7b97","text":"<p>2.4.1\u3001\u57fa\u672c\u601d\u60f3</p> <p>\u9996\u5148\uff0c\u901a\u8fc7\u8bfb\u53d6 <code>/proc/stat</code> \u6587\u4ef6\u83b7\u53d6\u603b\u7684 CPU \u65f6\u95f4\uff0c\u8bfb\u53d6 <code>/proc/[PID]/stat</code> \u83b7\u53d6\u8fdb\u7a0b CPU \u65f6\u95f4\uff0c\u8bfb\u53d6 <code>/proc/[PID]/task/[TID]/stat</code> \u83b7\u53d6\u7ebf\u7a0b CPU \u65f6\u95f4\u3002\u7136\u540e\uff0c\u91c7\u6837\u4e24\u4e2a\u8db3\u591f\u77ed\u7684\u65f6\u95f4\u95f4\u9694\u7684 CPU \u5feb\u7167\u4e0e\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u5feb\u7167\u6765\u8ba1\u7b97\u5176 CPU \u4f7f\u7528\u7387\u3002</p> <p>2.4.2\u3001\u8ba1\u7b97\u603b\u7684 CPU \u4f7f\u7528\u7387 totalCPUUse</p> <p>1\uff09\u91c7\u6837\u4e24\u4e2a\u8db3\u591f\u77ed\u7684\u65f6\u95f4\u95f4\u9694\u7684 CPU \u5feb\u7167\uff0c\u5373\u8bfb\u53d6 <code>/proc/stat</code> \u6587\u4ef6\uff0c\u83b7\u53d6\u4e24\u4e2a\u65f6\u95f4\u70b9\u7684\u4e0b\u5217\u6570\u636e\uff1a</p> <ul> <li>CPUT1 (user1, nice1, system1, idle1, iowait1, irq1, softirq1, stealstolen1, guest1);</li> <li>CPUT2 (user2, nice2, system2, idle2, iowait2, irq2, softirq2, stealstolen2, guest2);</li> </ul> <p>2\uff09\u8ba1\u7b97\u603b\u7684 CPU \u65f6\u95f4 totalCPUTime\uff1a</p> <ul> <li>CPUTime1 = user1 + nice1 + system1 + idle1 + iowait1 + irq1 + softirq1 + stealstolen1 + guest1;</li> <li>CPUTime2 = user2 + nice2 + system2 + idle2 + iowait2 + irq2 + softirq2 + stealstolen2 + guest2;</li> </ul> <p>totalCPUTime = CPUTime2 \u2013 CPUTime1;</p> <p>3\uff09\u8ba1\u7b97 CPU \u7a7a\u95f2\u65f6\u95f4 idleCPUTime\uff1a</p> <p>idleCPUTime = idle2 \u2013 idle1;</p> <p>4\uff09\u8ba1\u7b97\u603b\u7684 CPU \u4f7f\u7528\u7387 totalCPUUse\uff1a</p> <p>totalCPUUse = (totalCPUTime \u2013 idleCPUTime) / totalCPUTime;</p> <p>2.4.3\u3001\u8ba1\u7b97\u67d0\u4e00\u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u7387 processCPUUse</p> <p>1\uff09\u91c7\u6837\u4e24\u4e2a\u8db3\u591f\u77ed\u7684\u65f6\u95f4\u95f4\u9694\u7684 CPU \u5feb\u7167\u548c\u5bf9\u5e94\u7684\u8fdb\u7a0b\u5feb\u7167\uff0c\u5373\u8bfb\u53d6 <code>/proc/stat</code> \u6587\u4ef6\uff0c\u83b7\u53d6\u4e24\u4e2a\u65f6\u95f4\u70b9\u7684\u4e0b\u5217\u6570\u636e\uff1a</p> <ul> <li>CPUT1 (user1, nice1, system1, idle1, iowait1, irq1, softirq1, stealstolen1, guest1);</li> <li>CPUT2 (user2, nice2, system2, idle2, iowait2, irq2, softirq2, stealstolen2, guest2);</li> </ul> <p>\u8bfb\u53d6 <code>/proc/[PID]/stat</code> \u6587\u4ef6\uff0c\u83b7\u53d6\u4e24\u4e2a\u65f6\u95f4\u70b9\u7684\u4e0b\u5217\u6570\u636e\uff1a</p> <ul> <li>ProcessT1 (utime1, stime1, cutime1, cstime1);</li> <li>ProcessT2 (utime2, stime2, cutime2, cstime2);</li> </ul> <p>2\uff09\u8ba1\u7b97\u603b\u7684 CPU \u65f6\u95f4 totalCPUTime \u548c\u8fdb\u7a0b\u65f6\u95f4 processTime\uff1a</p> <ul> <li>CPUTime1 = user1 + nice1 + system1 + idle1 + iowait1 + irq1 + softirq1 + stealstolen1 + guest1;</li> <li>CPUTime2 = user2 + nice2 + system2 + idle2 + iowait2 + irq2 + softirq2 + stealstolen2 + guest2;</li> </ul> <p>totalCPUTime = CPUTime2 \u2013 CPUTime1;</p> <ul> <li>processTime1 = utime1 + stime1 + cutime1 + cstime1;</li> <li>processTime2 = utime2 + stime2 + cutime1 + cstime2;</li> </ul> <p>processTime = processTime2 \u2013 processTime1;</p> <p>3\uff09\u8ba1\u7b97\u8be5\u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u7387 processCPUUse:</p> <p>processCPUUse = processTime / totalCPUTime;</p> <p>2.4.4\u3001\u8ba1\u7b97\u67d0\u4e00\u7ebf\u7a0b\u7684 CPU \u4f7f\u7528\u7387 threadCPUUse</p> <p>1\uff09\u91c7\u6837\u4e24\u4e2a\u8db3\u591f\u77ed\u7684\u65f6\u95f4\u95f4\u9694\u7684 CPU \u5feb\u7167\u548c\u5bf9\u5e94\u7684\u7ebf\u7a0b\u5feb\u7167\uff0c\u5373\u8bfb\u53d6 <code>/proc/stat</code> \u6587\u4ef6\uff0c\u83b7\u53d6\u4e24\u4e2a\u65f6\u95f4\u70b9\u7684\u4e0b\u5217\u6570\u636e\uff1a</p> <ul> <li>CPUT1 (user1, nice1, system1, idle1, iowait1, irq1, softirq1, stealstolen1, guest1);</li> <li>CPUT2 (user2, nice2, system2, idle2, iowait2, irq2, softirq2, stealstolen2, guest2);</li> </ul> <p>\u8bfb\u53d6 <code>/proc/[PID]/task/[TID]/stat</code> \u6587\u4ef6\uff0c\u83b7\u53d6\u4e24\u4e2a\u65f6\u95f4\u70b9\u7684\u4e0b\u5217\u6570\u636e\uff1a</p> <ul> <li>threadT1 (utime1, stime1);</li> <li>threadT2 (utime2, stime2);</li> </ul> <p>2\uff09\u8ba1\u7b97\u603b\u7684 CPU \u65f6\u95f4 totalCPUTime \u548c\u7ebf\u7a0b\u65f6\u95f4 threadTime\uff1a</p> <ul> <li>CPUTime1 = user1 + nice1 + system1 + idle1 + iowait1 + irq1 + softirq1 + stealstolen1 + guest1;</li> <li>CPUTime2 = user2 + nice2 + system2 + idle2 + iowait2 + irq2 + softirq2 + stealstolen2 + guest2;</li> </ul> <p>totalCPUTime = CPUTime2 \u2013 CPUTime1;</p> <ul> <li>threadTime1 = utime1 + stime1;</li> <li>threadTime2 = utime2 + stime2;</li> </ul> <p>threadTime = threadTime2 \u2013 threadTime1;</p> <p>3\uff09\u8ba1\u7b97\u8be5\u7ebf\u7a0b\u7684 CPU \u4f7f\u7528\u7387 threadCPUUse:</p> <p>threadCPUUse = threadTime / totalCPUTime;</p>"},{"location":"perf-opt/Android/jank/cpu_use/#25-cpu","title":"2.5\u3001\u591a\u6838\u60c5\u51b5\u4e0b CPU \u4f7f\u7528\u7387\u7684\u8ba1\u7b97","text":"<p>2.5.1\u3001\u57fa\u672c\u601d\u60f3</p> <p>\u9996\u5148\uff0c\u901a\u8fc7\u8bfb\u53d6 <code>/proc/stat</code> \u6587\u4ef6\u83b7\u53d6\u603b\u7684 CPU \u65f6\u95f4\uff0c\u8bfb\u53d6 <code>/proc/[PID]/stat</code> \u83b7\u53d6\u8fdb\u7a0b CPU \u65f6\u95f4\uff0c\u8bfb\u53d6 <code>/proc/[PID]/task/[TID]/stat</code> \u83b7\u53d6\u7ebf\u7a0b CPU \u65f6\u95f4\uff0c\u8bfb\u53d6 <code>/proc/cpuinfo</code> \u83b7\u53d6 CPU \u4e2a\u6570\u3002</p> <p>\u5728\u591a\u6838\u60c5\u51b5\u4e0b\u8ba1\u7b97\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u7684 CPU \u4f7f\u7528\u7387\uff0c\u7528\u4e0a\u9762\u7684\u65b9\u5f0f\u5f97\u5230\u7684\u901a\u5e38\u662f\u76f8\u5bf9\u4e8e CPU \u6240\u6709\u6838\u7684\u603b\u5171\u65f6\u95f4\u7684\u5360\u7528\u7387\uff0c\u800c\u6211\u4eec\u901a\u5e38\u4e60\u60ef\u5f97\u5230\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u5bf9\u67d0\u4e00\u4e2a\u5355\u6838\u7684\u5360\u7528\u7387\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6309\u4e0a\u9762\u7684\u65b9\u5f0f\u8ba1\u7b97\u5f97\u5230 CPU \u5360\u7528\u7387\uff0c\u7136\u540e\u628a\u7ed3\u679c\u4e58\u4e0a CPU \u7684\u6838\u6570\uff0c\u5373\u53ef\u5f97\u5230\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u76f8\u5bf9\u4e8e\u4e00\u4e2a\u5355\u6838\u7684\u5360\u7528\u7387\u3002</p> <p>2.5.2\u3001\u8ba1\u7b97\u603b\u7684 CPU \u4f7f\u7528\u7387</p> <p>\u540c 2.4.2\u3002</p> <p>2.5.3\u3001\u8ba1\u7b97\u67d0\u4e00\u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u7387 mProcessCPUUse</p> <p>1\uff09\u540c 2.4.3 \u8ba1\u7b97\u67d0\u4e00\u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u7387 processCPUUse\uff1b</p> <p>2\uff09\u8bfb\u53d6 /proc/cpuinfo \u6587\u4ef6\u83b7\u53d6\u903b\u8f91 CPU\uff08processor\uff09 \u7684\u4e2a\u6570\uff08\u53c2\u89c1 1.1\uff09\uff1a processorNum</p> <p>3\uff09\u591a\u6838\u60c5\u51b5\u4e0b\u8be5\u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u7387 mProcessCPUUse\uff1a</p> <p>mProcessCPUUse = processCPUUse * processorNum;</p> <p>2.5.4\u3001\u8ba1\u7b97\u67d0\u4e00\u7ebf\u7a0b\u7684 CPU \u4f7f\u7528\u7387 mThreadCPUUse</p> <p>1\uff09\u540c 2.4.4 \u8ba1\u7b97\u67d0\u4e00\u7ebf\u7a0b\u7684 CPU \u4f7f\u7528\u7387 threadCPUUse\uff1b</p> <p>2\uff09\u8bfb\u53d6 /proc/cpuinfo \u6587\u4ef6\u83b7\u53d6\u903b\u8f91 CPU\uff08processor\uff09 \u7684\u4e2a\u6570\uff08\u53c2\u89c1 1.1\uff09\uff1a processorNum</p> <p>3\uff09\u591a\u6838\u60c5\u51b5\u4e0b\u8be5\u7ebf\u7a0b\u7684 CPU \u4f7f\u7528\u7387 mThreadCPUUse\uff1a</p> <p>mThreadCPUUse = threadCPUUse * processorNum;</p>"},{"location":"perf-opt/Android/jank/cpu_use/#26","title":"2.6\u3001\u95ee\u9898","text":"<ul> <li>1\uff09\u4e0d\u540c\u5185\u6838\u7248\u672c /proc/stat \u6587\u4ef6\u683c\u5f0f\u4e0d\u4e00\u81f4\u3002/proc/stat \u6587\u4ef6\u4e2d\u7b2c\u4e00\u884c\u662f\u603b\u7684 CPU \u4f7f\u7528\u60c5\u51b5\u3002</li> </ul> <ul> <li>\u5404\u4e2a\u5185\u6838\u7248\u672c\u90fd\u6709\u7684 4 \u4e2a\u5b57\u6bb5\uff1auser, nice, system, idle\uff1b</li> <li>2.5.41 \u7248\u672c\u65b0\u589e\u5b57\u6bb5\uff1aiowait\uff1b</li> <li>2.6.0-test4 \u7248\u672c\u65b0\u589e\u5b57\u6bb5\uff1airq, softirq\uff1b</li> <li>2.6.11 \u7248\u672c\u65b0\u589e\u5b57\u6bb5\uff1astealstolen\uff1b</li> <li>2.6.24 \u7248\u672c\u65b0\u589e\u5b57\u6bb5\uff1aguest\uff1b</li> </ul> <ul> <li> <p>2\uff09/proc/[PID]/task \u76ee\u5f55\u662f Linux 2.6.0-test6 \u4e4b\u540e\u624d\u6709\u7684\u529f\u80fd\u3002</p> </li> <li> <p>3\uff09\u5173\u4e8e CPU \u4f7f\u7528\u7387\u4e3a\u8d1f\u7684\u60c5\u51b5\uff0c\u89e3\u51b3\u65b9\u6848\u662f\u5982\u679c\u51fa\u73b0\u8d1f\u503c\uff0c\u8fde\u7eed\u91c7\u6837\u8ba1\u7b97 CPU \u4f7f\u7528\u7387\u76f4\u5230\u4e3a\u975e\u8d1f\u3002</p> </li> <li> <p>4\uff09\u6709\u4e9b\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u8f83\u77ed\uff0c\u53ef\u80fd\u5728\u91c7\u6837\u671f\u95f4\u5c31\u5df2\u7ecf\u6b7b\u6389\u4e86\u3002</p> </li> </ul>"},{"location":"perf-opt/Android/jank/cpu_use/#27-cpu","title":"2.7\u3001\u4e00\u4e2a\u8ba1\u7b97\u603b\u7684 CPU \u5360\u7528\u7387\u7684\u5c0f\u7a0b\u5e8f","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\ntypedef struct procstat {\nchar processorName[20];\nunsigned int user;\nunsigned int nice;\nunsigned int system;\nunsigned int idle;\nunsigned int iowait;\nunsigned int irq;\nunsigned int softirq;\nunsigned int stealstolen;\nunsigned int guest;\n} Procstat;\nProcstat getCPUStatus() {\n// Get \"/proc/stat\" info.\nFILE* inputFile = NULL;\nchdir(\"/proc\");\ninputFile = fopen(\"stat\", \"r\");\nif (!inputFile) {\nperror(\"error: Can not open file.\\n\");\n}\nchar buff[1024];\nfgets(buff, sizeof(buff), inputFile); // Read 1 line.\nprintf(buff);     Procstat ps;\nsscanf(buff, \"%s %u %u %u %u %u %u %u %u %u\", ps.processorName, &amp;ps.user, &amp;ps.nice, &amp;ps.system, &amp;ps.idle, &amp;ps.iowait, &amp;ps.irq, &amp;ps.softirq, &amp;ps.stealstolen, &amp;ps.guest); // Scan from \"buff\".     \nprintf(\"user: %u\\n\", ps.user);\nfclose(inputFile);\nreturn ps;\n}\nfloat calculateCPUUse(Procstat ps1, Procstat ps2) {\nunsigned int totalCPUTime = (ps2.user + ps2.nice + ps2.system + ps2.idle + ps2.iowait + ps2.irq + ps2.softirq + ps2.stealstolen + ps2.guest) - (ps1.user + ps1.nice + ps1.system + ps1.idle + ps1.iowait + ps1.irq + ps1.softirq + ps1.stealstolen + ps1.guest);\nunsigned int idleCPUTime = ps2.idle - ps1.idle;\nfloat CPUUse = ((float) totalCPUTime - (float) idleCPUTime) / (float) totalCPUTime;\nprintf(\"totalCPUTime: %u\\nidleCPUTime: %u\\n\", totalCPUTime, idleCPUTime);\nreturn CPUUse;\n}\nint main(int argc, char* argv[]) {\nprintf(\"Test CPU\\n\");\n// Get processor num.\nint processorNum = sysconf(_SC_NPROCESSORS_CONF); // \"unistd.h\" is required.\nprintf(\"Processors: %d\\n\", processorNum);\n// Test\nProcstat ps1, ps2;\nint i = 0;\nfor (i = 0; i &lt;= 100000; i++) {\nsrand((unsigned) time(NULL));\nint m = rand() % 100000;\nint n = 1 + rand() % 100000;\nint k = m / n;\nif (i == 10) {\nps1 = getCPUStatus();\n}\nif (i == 10000) {\nps2 = getCPUStatus();     }\n}\nfloat CPUUse = calculateCPUUse(ps1, ps2);\nprintf(\"CPUUse: %f\\n\", CPUUse);\nreturn 0;\n}\n</code></pre>"},{"location":"perf-opt/Android/jank/cpu_use/#3linux","title":"3\u3001Linux \u73af\u5883\u67e5\u770b\u8fdb\u7a0b\u8fd0\u884c\u76f8\u5173\u4fe1\u606f","text":""},{"location":"perf-opt/Android/jank/cpu_use/#31-ps","title":"3.1\u3001\u4f7f\u7528 ps \u547d\u4ee4\u67e5\u770b\u8fdb\u7a0b\u4fe1\u606f","text":"<p>\u51e0\u4e2a\u5e38\u7528\u53c2\u6570\uff1a</p> <ul> <li><code>a</code>: \u4e0e\u7ec8\u7aef\u65e0\u5173\u7684\u6240\u6709\u8fdb\u7a0b\u3002</li> <li><code>u</code>: \u6709\u6548\u7528\u6237\uff08effective user\uff09\u7684\u76f8\u5173\u8fdb\u7a0b\u3002</li> <li><code>x</code>: \u901a\u5e38\u4e0e a \u53c2\u6570\u56e0\u4f7f\u7528\uff0c\u53ef\u5217\u51fa\u8f83\u5b8c\u6574\u7684\u4fe1\u606f\u3002</li> <li><code>-e</code>: \u9009\u62e9\u6240\u6709\u8fdb\u7a0b\u3002</li> <li><code>-L</code>: \u663e\u793a\u7ebf\u7a0b\uff0c\u4e00\u822c\u662f LWP \u6216 NLWP \u5217\u3002</li> <li><code>-o</code>: \u7528\u6237\u81ea\u5b9a\u4e49\u663e\u793a\u9009\u9879\u3002</li> </ul> <p>\u793a\u4f8b1\uff09\u5217\u51fa\u6240\u6709\u5f53\u524d\u6240\u6709\u6b63\u5728\u5185\u5b58\u4e2d\u7684\u8fdb\u7a0b</p> <pre><code>[root@rh ~]$ ps aux\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\nroot 1 0.0 0.0 19356 1536 ? Ss Apr22 0:01 /sbin/init\nroot 2 0.0 0.0 0 0 ? S Apr22 0:00 [kthreadd]\nroot 3 0.0 0.0 0 0 ? S Apr22 0:00 [migration/0]\nroot 4 0.0 0.0 0 0 ? S Apr22 0:00 [ksoftirqd/0]\nroot 5 0.0 0.0 0 0 ? S Apr22 0:00 [migration/0]\nroot 6 0.0 0.0 0 0 ? S Apr22 0:00 [watchdog/0]\nroot 7 0.0 0.0 0 0 ? S Apr22 0:00 [migration/1]\nroot 8 0.0 0.0 0 0 ? S Apr22 0:00 [migration/1]\n......\n</code></pre> <p>\u793a\u4f8b2\uff09\u5217\u51fa\u8fdb\u7a0b\u53f7\u4e3a 13560 \u8fd9\u4e2a\u8fdb\u7a0b\u7684\u6240\u6709\u7ebf\u7a0b\u53ca CPU \u5360\u7528\u7387</p> <pre><code>[root@rh ~]$ ps -eLo pid,lwp,pcpu | grep 1356013560 13560 49.5\n</code></pre>"},{"location":"perf-opt/Android/jank/cpu_use/#32-top","title":"3.2\u3001\u4f7f\u7528 top \u547d\u4ee4\u67e5\u770b\u8fdb\u7a0b\u4fe1\u606f","text":"<p>\u51e0\u4e2a\u5e38\u7528\u7684\u53c2\u6570\uff1a</p> <ul> <li><code>-d</code>: \u540e\u9762\u63a5\u79d2\u6570\uff0c\u5c31\u662f\u6574\u4e2a\u8fdb\u7a0b\u753b\u9762\u66f4\u65b0\u7684\u9891\u7387\u3002\u9ed8\u8ba4\u662f 5 \u79d2\u3002</li> <li><code>-b</code>: \u4ee5\u6279\u5904\u7406\u7684\u65b9\u5f0f\u6267\u884c top\uff0c\u8fd8\u6709\u66f4\u591a\u7684\u53c2\u6570\u53ef\u7528\u3002\u901a\u5e38\u4f1a\u642d\u914d\u6570\u636e\u6d41\u91cd\u5bfc\u5411\uff0c\u5c06\u6279\u5904\u7406\u7684\u7ed3\u679c\u8f93\u51fa\u4e3a\u6587\u4ef6\u3002</li> <li><code>-n</code>: \u4e0e -b \u642d\u914d\uff0c\u610f\u4e49\u662f\uff0c\u9700\u8981\u8fdb\u884c\u51e0\u6b21 top \u7684\u8f93\u51fa\u7ed3\u679c\u3002</li> <li><code>-p</code>: \u6307\u5b9a\u67d0\u4e2a PID \u6765\u8fdb\u884c\u89c2\u5bdf\u76d1\u6d4b\u3002</li> <li>\u5728 top \u6267\u884c\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4f7f\u7528\u7684\u6309\u952e\u547d\u4ee4\uff1a</li> <li><code>?</code>: \u663e\u793a\u5728 top \u4e2d\u53ef\u4ee5\u8f93\u5165\u7684\u6309\u952e\u547d\u4ee4\u3002</li> <li><code>P</code>: \u6309\u7167 CPU \u7684\u4f7f\u7528\u8d44\u6e90\u6392\u5e8f\u663e\u793a\u3002</li> <li><code>M</code>: \u6309\u5185\u5b58\uff08Memory\uff09\u7684\u4f7f\u7528\u8d44\u6e90\u6392\u5e8f\u663e\u793a\u3002</li> <li><code>N</code>: \u6309 PID \u6765\u6392\u5e8f\u3002</li> <li><code>T</code>: \u6309\u8be5\u8fdb\u7a0b\u4f7f\u7528\u7684 CPU \u65f6\u95f4\u79ef\u7d2f\uff08TIME+\uff09\u6392\u5e8f\u3002</li> <li><code>k</code>: \u7ed9\u67d0\u4e2a PID \u4e00\u4e2a\u4fe1\u53f7\uff08signal\uff09\u3002</li> <li><code>r</code>: \u7ed9\u67d0\u4e2a PID \u91cd\u65b0\u786e\u5b9a\u4e00\u4e2a\u503c\u3002</li> <li><code>1</code>: \u663e\u793a\u6240\u6709 CPU \u5360\u7528\u4fe1\u606f\u3002</li> </ul> <p>\u793a\u4f8b1\uff09\u5c06 top \u547d\u4ee4\u6267\u884c\u4e24\u6b21\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u8f93\u51fa\u5230 <code>/top_result.data</code>\u3002</p> <pre><code>[root@rh ~]$ top -b -n 2 &amp;gt; /top_result.data\n</code></pre> <p>\u793a\u4f8b2\uff09\u76d1\u6d4b\u8fdb\u7a0b 13620</p> <pre><code>[root@rh ~]$ top -d 2 -p 13620\ntop - 16:27:35 up 4 days, 7:43, 2 users, load average: 0.35, 0.47, 0.44\nTasks: 1 total, 1 running, 0 sleeping, 0 stopped, 0 zombie\nCpu(s): 0.1%us, 3.1%sy, 0.0%ni, 96.5%id, 0.0%wa, 0.0%hi, 0.3%si, 0.0%st\nMem: 16320632k total, 1790796k used, 14529836k free, 233168k buffers\nSwap: 8232952k total, 0k used, 8232952k free, 941540k cached\n\nPID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND\n13620 test1370 20 0 11060 944 760 R 53.4 0.0 0:04.78 netperf\n</code></pre>"},{"location":"perf-opt/Android/jank/cpu_use/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea http://www.samirchen.com/linux-cpu-performance/</p>"},{"location":"perf-opt/Android/jank/jank-opt/","title":"Android \u5361\u987f\u4f18\u5316\u603b\u7ed3","text":""},{"location":"perf-opt/Android/jank/jank-opt/#1","title":"1. \u5361\u987f\u5b9a\u4e49","text":"<p>\u7a33\u5b9a\u5e27\u7387\u8f93\u51fa\u7684\u753b\u9762\u51fa\u73b0\u4e00\u5e27\u6216\u8005\u591a\u5e27\u6ca1\u6709\u7ed8\u5236 \u3002</p> <p>\u6bd4\u5982\u4e0b\u56fe\u4e2d\uff0cApp \u4e3b\u7ebf\u7a0b\u6709\u5728\u6b63\u5e38\u7ed8\u5236\u7684\u65f6\u5019\uff08\u901a\u5e38\u662f\u505a\u52a8\u753b\u6216\u8005\u5217\u8868\u6ed1\u52a8\uff09\uff0c\u6709\u4e00\u5e27\u6ca1\u6709\u7ed8\u5236\uff0c\u90a3\u4e48\u6211\u4eec\u8ba4\u4e3a\u8fd9\u4e00\u5e27\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5361\u987f\uff08\u8fd9\u91cc\u8bf4\u7684\u662f\u6709\u53ef\u80fd\uff0c\u7531\u4e8e Triple Buffer \u7684\u5b58\u5728\uff0c\u8fd9\u91cc\u4e5f\u6709\u53ef\u80fd\u4e0d\u6389\u5e27\uff09</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-opt/#1-1","title":"1. 1 \u7cfb\u7edf\u4e0a\u5e27\u8fd0\u884c\u673a\u5236","text":"<p>\u4ee5\u7528\u6237\u624b\u6307\u4e0a\u4e0b\u6ed1\u52a8\u5e94\u7528\u754c\u9762\u7684\u64cd\u4f5c\u573a\u666f\u4e3a\u4f8b\uff0c\u6574\u4e2a\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <ol> <li>\u7528\u6237\u624b\u6307\u89e6\u6478\u5c4f\u5e55\u540e\uff0c\u5c4f\u5e55\u9a71\u52a8\u4ea7\u751f<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\uff1b\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684<code>EventHub</code>\u901a\u8fc7<code>epoll</code>\u673a\u5236\u76d1\u542c\u5230\u9a71\u52a8\u4ea7\u751f\u7684<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u4e0a\u62a5\uff0c\u7531<code>InputReader</code>\u8bfb\u53d6\u5230<code>Input</code>\u4e8b\u4ef6\u540e\uff0c\u5524\u9192<code>InputDispatcher</code>\u627e\u5230\u5f53\u524d\u89e6\u63a7\u7126\u70b9\u5e94\u7528\u7a97\u53e3\uff0c\u5e76\u901a\u8fc7\u4e8b\u5148\u5efa\u7acb\u7684<code>socket</code>\u901a\u9053\u53d1\u9001<code>Input</code>\u4e8b\u4ef6\u5230\u5bf9\u5e94\u7684\u5e94\u7528\u8fdb\u7a0b\uff1b</li> <li>\u5e94\u7528\u8fdb\u7a0b\u6536\u5230<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u540e<code>UI</code>\u7ebf\u7a0b\u88ab\u5524\u9192\u8fdb\u884c\u4e8b\u4ef6\u7684\u5206\u53d1\uff0c\u76f8\u5173<code>View</code>\u63a7\u4ef6\u4e2d\u6839\u636e\u591a\u4e2a<code>ACTION_MOVE</code>\u7c7b\u578b\u7684<code>Input</code>\u4e8b\u4ef6\u5224\u65ad\u4e3a\u7528\u6237\u624b\u6307\u6ed1\u52a8\u884c\u4e3a\u540e\uff0c\u901a\u8fc7<code>Choreographer</code>\u5411\u7cfb\u7edf\u6ce8\u518c\u7533\u8bf7<code>app</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\uff0c\u5e76\u7b49\u5f85<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\u89e6\u53d1\u7ed8\u5236\u64cd\u4f5c\uff1b</li> <li><code>app</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\uff0c\u5524\u9192\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u5e76\u5411\u5176\u6d88\u606f\u961f\u5217\u4e2d\u653e\u5165\u4e00\u4e2a\u5f85\u6267\u884c\u7684\u7ed8\u5236\u4efb\u52a1\uff0c\u5728<code>UI</code>\u7ebf\u7a0b\u4e2d\u5148\u540e\u904d\u5386\u6267\u884c<code>View</code>\u63a7\u4ef6\u6811\u7684\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\uff08\u786c\u4ef6\u52a0\u901f\u9ed8\u8ba4\u5f00\u542f\u7684\u72b6\u6001\u4e0b\u4f1a\u904d\u5386\u5e76\u8bb0\u5f55\u6bcf\u4e2a<code>View</code>\u7684<code>draw</code>\u64cd\u4f5c\u751f\u6210\u5bf9\u5e94\u7684\u7ed8\u5236\u547d\u4ee4\u6811\uff09\u64cd\u4f5c\uff1b</li> <li><code>View</code>\u63a7\u4ef6\u6811\u7684\u7ed8\u5236\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u5524\u9192\u5e94\u7528\u7684<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\u6267\u884c\u754c\u9762\u6e32\u67d3\u4efb\u52a1\uff1b\u6574\u4e2a\u6e32\u67d3\u4efb\u52a1\u4e2d\u4f1a\u5148\u540c\u6b65<code>UI</code>\u7ebf\u7a0b\u4e2d\u6784\u5efa\u597d\u7684\u7ed8\u5236\u547d\u4ee4\u6811\uff0c\u7136\u540e\u901a\u8fc7<code>dequeueBuffer</code>\u7533\u8bf7\u4e00\u5f20\u5904\u4e8e<code>free</code>\u72b6\u6001\u7684\u53ef\u7528<code>Buffer</code>\uff0c\u7136\u540e\u8c03\u7528<code>SkiaOpenGLPipeline</code>\u6e32\u67d3\u7ba1\u9053\u4e2d\u4f7f\u7528<code>GPU</code>\u8fdb\u884c\u6e32\u67d3\u64cd\u4f5c\uff0c\u6e32\u67d3\u5b8c\u6210\u540e<code>swapBuffer</code>\u89e6\u53d1<code>queueBuffer</code>\u52a8\u4f5c\u8fdb\u884c\u4e0a\u5e27\uff1b</li> <li>\u5e94\u7528\u6e32\u67d3\u7ebf\u7a0b\u6700\u540e\u7684<code>queueBuffer</code>\u4e0a\u5e27\u52a8\u4f5c\uff0c\u4f1a\u5524\u9192\u5bf9\u7aef<code>SurfaceFlinger</code>\u8fdb\u7a0b\u4e2d\u7684<code>Binder</code>\u5904\u7406\u7ebf\u7a0b\uff0c\u5176\u4e2d\u5c06\u5bf9\u5e94\u7528<code>BufferQuque</code>\u4e2d\u7684<code>Buffer</code>\u6807\u8bb0\u4e3a<code>Queued</code>\u72b6\u6001\uff0c\u7136\u540e\u6ce8\u518c\u7533\u8bf7<code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\uff1b</li> <li>\u5f85<code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\u4f1a\u5524\u9192<code>SurfaceFlinger</code>\u7684\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e00\u5e27\u7684\u5408\u6210\u4efb\u52a1\uff0c\u5176\u4e2d\u4f1a\u5148\u901a\u8fc7<code>handlePageFlip</code>\u64cd\u4f5c\u904d\u5386\u6240\u6709\u7684\u5e94\u7528<code>Layer</code>\u627e\u5230\u6709\u4e0a\u5e27\u64cd\u4f5c\u7684\u5904\u4e8e<code>Queued</code>\u72b6\u6001\u7684<code>Buffer</code>\u8fdb\u884c<code>AcquireBuffer</code>\u83b7\u53d6\u6807\u8bb0\u9501\u5b9a\uff0c\u7136\u540e\u6267\u884c<code>persent</code>\u52a8\u4f5c\u8c03\u7528\u5524\u9192<code>HWC service</code>\u8fdb\u7a0b\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6267\u884c\u5177\u4f53\u7684\u56fe\u5c42\u7684\u5408\u6210\u9001\u663e\u64cd\u4f5c\uff1b</li> <li><code>HWC service</code>\u4e2d\u6700\u7ec8\u4f1a\u6536\u5230<code>SurfaceFlinger</code>\u7684\u8bf7\u6c42\u540e\uff0c\u8fdb\u884c\u56fe\u5c42\u5408\u6210\u64cd\u4f5c\uff0c\u6700\u7ec8\u901a\u8fc7\u8c03\u7528<code>libDrm</code>\u5e93\u76f8\u5173\u63a5\u53e3<code>Commit</code>\u63d0\u4ea4<code>Buffer</code>\u6570\u636e\u5230Kernel\u5185\u6838\u4e2d\u7684\u5c4f\u5e55\u9a71\u52a8\uff0c\u5e76\u6700\u7ec8\u9001\u5230\u5c4f\u5e55\u786c\u4ef6\u4e0a\u663e\u793a\u3002</li> </ol> <p>\u4e0a\u8ff0\u8fc7\u7a0b\u7528\u4e00\u5f20\u56fe\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4ece\u4e09\u4e2a\u65b9\u9762\u5b9a\u4e49\u5361\u987f\uff1a</p> <ol> <li>\u4ece\u73b0\u8c61\u4e0a\u6765\u8bf4\uff0c\u5728 <code>App</code> \u8fde\u7eed\u7684\u52a8\u753b\u64ad\u653e\u6216\u8005\u624b\u6307\u6ed1\u52a8\u5217\u8868\u65f6\uff08\u5173\u952e\u662f\u8fde\u7eed\uff09\uff0c\u5982\u679c\u8fde\u7eed <code>2</code> \u5e27\u6216\u8005 <code>2</code> \u5e27\u4ee5\u4e0a\uff0c\u5e94\u7528\u7684\u753b\u9762\u90fd\u6ca1\u6709\u53d8\u5316\uff0c\u90a3\u4e48\u6211\u4eec\u8ba4\u4e3a\u8fd9\u91cc\u53d1\u751f\u4e86\u5361\u987f\uff1b</li> <li>\u4ece <code>SurfaceFlinger</code> \u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u5728 <code>App</code> \u8fde\u7eed\u7684\u52a8\u753b\u64ad\u653e\u6216\u8005\u624b\u6307\u6ed1\u52a8\u5217\u8868\u65f6\uff08\u5173\u952e\u662f\u8fde\u7eed\uff09\uff0c\u5982\u679c\u6709\u4e00\u4e2a <code>Vsync</code> \u5230\u6765\u7684\u65f6\u5019 \uff0c<code>App</code> \u6ca1\u6709\u53ef\u4ee5\u7528\u6765\u5408\u6210\u7684 <code>Buffer</code>\uff0c\u90a3\u4e48\u8fd9\u4e2a <code>Vsync</code> \u5468\u671f <code>SurfaceFlinger</code> \u5c31\u4e0d\u4f1a\u8d70\u5408\u6210\u7684\u903b\u8f91\uff08\u6216\u8005\u662f\u53bb\u5408\u6210\u5176\u4ed6\u7684 <code>Layer</code>\uff09\uff0c\u90a3\u4e48\u8fd9\u4e00\u5e27\u5c31\u4f1a\u663e\u793a <code>App</code> \u7684\u4e0a\u4e00\u5e27\u7684\u753b\u9762\uff0c\u6211\u4eec\u8ba4\u4e3a\u8fd9\u91cc\u53d1\u751f\u4e86\u5361\u987f\uff1b</li> <li>\u4ece <code>App</code> \u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5982\u679c\u6e32\u67d3\u7ebf\u7a0b\u5728\u4e00\u4e2a <code>Vsync</code> \u5468\u671f\u5185\u6ca1\u6709 <code>queueBuffer</code> \u5230 <code>SurfaceFlinger</code> \u4e2d <code>App</code> \u5bf9\u5e94\u7684 <code>BufferQueue</code> \u4e2d\uff0c\u90a3\u4e48\u6211\u4eec\u8ba4\u4e3a\u8fd9\u91cc\u53d1\u751f\u4e86\u5361\u987f\u3002</li> </ol> <p>\u200b   \u5173\u4e8e\u5361\u987f\u7684\u8be6\u7ec6\u539f\u7406\u5206\u6790\u53ef\u4ee5\u67e5\u770b\u539f\u7406\u7bc7 </p>"},{"location":"perf-opt/Android/jank/jank-opt/#12-anr","title":"1.2 \u5361\u987f\u4e0eANR\u7684\u5173\u7cfb","text":"<p>\u4ea7\u751f\u5361\u987f\u7684\u6839\u672c\u539f\u56e0\u662fUI\u7ebf\u7a0b\u4e0d\u80fd\u591f\u53ca\u65f6\u7684\u8fdb\u884c\u6e32\u67d3\uff0c\u5bfc\u81f4UI\u7684\u53cd\u9988\u4e0d\u80fd\u6309\u7167\u7528\u6237\u7684\u9884\u671f\uff0c\u8fde\u7eed\u3001\u4e00\u81f4\u7684\u5448\u73b0\u3002\u4ea7\u751f\u5361\u987f\u7684\u539f\u56e0\u591a\u79cd\u591a\u6837\uff0c\u5f88\u96be\u4e00\u4e00\u5217\u4e3e\uff0c\u800cANR\u662fGoogle\u4eba\u4e3a\u89c4\u5b9a\u7684\u6982\u5ff5\uff0c\u4ea7\u751fANR\u7684\u539f\u56e0\u6700\u591a\u4e5f\u53ea\u6709\u56db\u4e2a\u3002\u5206\u522b\u662f\uff1a</p> <ul> <li>Service Timeout:\u6bd4\u5982\u524d\u53f0\u670d\u52a1\u572820s\u5185\u672a\u6267\u884c\u5b8c\u6210\uff0c\u540e\u53f0\u670d\u52a1Timeout\u65f6\u95f4\u662f\u524d\u53f0\u670d\u52a1\u768410\u500d\uff0c200s\uff1b</li> <li>BroadcastQueue Timeout\uff1a\u6bd4\u5982\u524d\u53f0\u5e7f\u64ad\u572810s\u5185\u672a\u6267\u884c\u5b8c\u6210\uff0c\u540e\u53f060s</li> <li>ContentProvider Timeout\uff1a\u5185\u5bb9\u63d0\u4f9b\u8005,\u5728publish\u8fc7\u8d85\u65f610s;</li> <li>InputDispatching Timeout: \u8f93\u5165\u4e8b\u4ef6\u5206\u53d1\u8d85\u65f65s\uff0c\u5305\u62ec\u6309\u952e\u548c\u89e6\u6478\u4e8b\u4ef6\u3002</li> </ul> <p>\u800c\u5e02\u9762\u4e0a\u7684\u4e00\u4e9b\u5361\u987f\u76d1\u63a7\u5de5\u5177\uff0c\u7ecf\u5e38\u88ab\u62ff\u6765\u76d1\u63a7ANR\uff08\u5361\u987f\u9608\u503c\u8bbe\u7f6e\u4e3a5\u79d2\uff09\uff0c\u8fd9\u5176\u5b9e\u5f88\u4e0d\u4e25\u8c28\uff1a\u9996\u5148\uff0c5\u79d2\u53ea\u662f\u53d1\u751fANR\u7684\u5176\u4e2d\u4e00\u79cd\u539f\u56e0\uff08Touch\u4e8b\u4ef65\u79d2\u672a\u88ab\u53ca\u65f6\u6d88\u8d39\uff09\u7684\u9608\u503c\uff0c\u800c\u5176\u4ed6\u539f\u56e0\u53d1\u751fANR\u7684\u9608\u503c\u5e76\u4e0d\u662f5\u79d2\uff1b\u53e6\u5916\uff0c\u5c31\u7b97\u662f\u4e3b\u7ebf\u7a0b\u5361\u987f\u4e865\u79d2\uff0c\u5982\u679c\u7528\u6237\u6ca1\u6709\u8f93\u5165\u4efb\u4f55\u7684Touch\u4e8b\u4ef6\uff0c\u540c\u6837\u662f\u4e0d\u4f1a\u53d1\u751fANR\u7684\uff0c\u66f4\u4f55\u51b5\u8fd8\u6709\u540e\u53f0ANR\u7b49\u60c5\u51b5\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#2","title":"2. \u5361\u987f\u5206\u6790","text":"<p>\u9020\u6210\u5361\u987f\u7684\u539f\u56e0\u53ef\u80fd\u6709\u5343\u767e\u79cd\uff0c\u4e0d\u8fc7\u6700\u7ec8\u90fd\u4f1a\u53cd\u6620\u5230 CPU \u65f6\u95f4 \u4e0a\u3002\u6211\u4eec\u53ef\u4ee5\u628a CPU \u65f6\u95f4\u5206\u4e3a\u4e24\u79cd\uff1a\u7528\u6237\u65f6\u95f4\u548c\u7cfb\u7edf\u65f6\u95f4\u3002\u7528\u6237\u65f6\u95f4\u5c31\u662f\u6267\u884c\u7528\u6237\u6001\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u6240\u6d88\u8017\u7684\u65f6\u95f4\uff1b\u7cfb\u7edf\u65f6\u95f4\u5c31\u662f\u6267\u884c\u5185\u6838\u6001\u7cfb\u7edf\u8c03\u7528\u6240\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u5305\u62ec I/O\u3001\u9501\u3001\u4e2d\u65ad\u4ee5\u53ca\u5176\u4ed6\u7cfb\u7edf\u8c03\u7528\u7684\u65f6\u95f4\u3002</p> <p>\u8bc4\u4ef7\u4e00\u4e2a CPU \u7684\u6027\u80fd\uff0c\u9700\u8981\u770b<code>\u4e3b\u9891</code>\u3001<code>\u6838\u5fc3\u6570</code>\u3001<code>\u7f13\u5b58</code>\u7b49\u53c2\u6570\uff0c\u5177\u4f53\u8868\u73b0\u51fa\u6765\u7684\u662f\u8ba1\u7b97\u80fd\u529b\u548c\u6307\u4ee4\u6267\u884c\u80fd\u529b\uff0c\u4e5f\u5c31\u662f\u6bcf\u79d2\u6267\u884c\u7684\u6d6e\u70b9\u8ba1\u7b97\u6570\u548c\u6bcf\u79d2\u6267\u884c\u7684\u6307\u4ee4\u6570\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u6cd5\u83b7\u5f97\u8bbe\u5907\u7684 CPU \u4fe1\u606f\u3002</p> <pre><code>// \u83b7\u53d6 CPU \u6838\u5fc3\u6570\ncat /sys/devices/system/cpu/possible  // \u83b7\u53d6\u67d0\u4e2a CPU \u7684\u9891\u7387\ncat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_max_freq\n</code></pre>"},{"location":"perf-opt/Android/jank/jank-opt/#21-cpu","title":"2.1 CPU\u4f7f\u7528\u7387","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>/proc/sta</code>t\u5f97\u5230\u6574\u4e2a\u7cfb\u7edf\u7684 CPU \u4f7f\u7528\u60c5\u51b5\uff0c\u901a\u8fc7<code>/proc/[pid]/stat</code>\u53ef\u4ee5\u5f97\u5230\u67d0\u4e2a\u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u5173\u4e8e stat \u6587\u4ef6\u5404\u4e2a\u5c5e\u6027\u7684\u542b\u4e49\u548c CPU \u4f7f\u7528\u7387\u7684\u8ba1\u7b97\uff0c\u53ef\u4ee5\u9605\u8bfb  \u300aLinux \u73af\u5883\u4e0b\u8fdb\u7a0b\u7684 CPU \u5360\u7528\u7387\u300b\u548cLinux \u6587\u6863\u3002\u5176\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u5b57\u6bb5\u6709\uff1a</p> <pre><code>proc/self/stat:\n  utime:       \u7528\u6237\u65f6\u95f4\uff0c\u53cd\u5e94\u7528\u6237\u4ee3\u7801\u6267\u884c\u7684\u8017\u65f6  stime:       \u7cfb\u7edf\u65f6\u95f4\uff0c\u53cd\u5e94\u7cfb\u7edf\u8c03\u7528\u6267\u884c\u7684\u8017\u65f6\n  majorFaults\uff1a\u9700\u8981\u786c\u76d8\u62f7\u8d1d\u7684\u7f3a\u9875\u6b21\u6570\n  minorFaults\uff1a\u65e0\u9700\u786c\u76d8\u62f7\u8d1d\u7684\u7f3a\u9875\u6b21\u6570\n</code></pre> <p>\u5982\u679c CPU \u4f7f\u7528\u7387\u957f\u671f\u5927\u4e8e 60% \uff0c\u8868\u793a\u7cfb\u7edf\u5904\u4e8e\u7e41\u5fd9\u72b6\u6001\uff0c\u5c31\u9700\u8981\u8fdb\u4e00\u6b65\u5206\u6790\u7528\u6237\u65f6\u95f4\u548c\u7cfb\u7edf\u65f6\u95f4\u7684\u6bd4\u4f8b\u3002\u5bf9\u4e8e\u666e\u901a\u5e94\u7528\u7a0b\u5e8f\uff0c\u7cfb\u7edf\u65f6\u95f4\u4e0d\u4f1a\u957f\u671f\u9ad8\u4e8e 30%\uff0c\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u6211\u4eec\u5c31\u5e94\u8be5\u8fdb\u4e00\u6b65\u68c0\u67e5\u662f I/O \u8fc7\u591a\uff0c\u8fd8\u662f\u5176\u4ed6\u7684\u7cfb\u7edf\u8c03\u7528\u95ee\u9898\u3002</p> <p>Android \u662f\u7ad9\u5728 Linux \u5de8\u4eba\u7684\u80a9\u8180\u4e0a\uff0c\u867d\u7136\u505a\u4e86\u4e0d\u5c11\u4fee\u6539\u4e5f\u780d\u6389\u4e86\u4e00\u4e9b\u5de5\u5177\uff0c\u4f46\u8fd8\u662f\u4fdd\u7559\u4e86\u5f88\u591a\u6709\u7528\u7684\u5de5\u5177\u53ef\u4ee5\u534f\u52a9\u6211\u4eec\u66f4\u5bb9\u6613\u5730\u6392\u67e5\u95ee\u9898\uff0c\u8fd9\u91cc\u6211\u7ed9\u4f60\u4ecb\u7ecd\u51e0\u4e2a\u5e38\u7528\u7684\u547d\u4ee4\u3002\u4f8b\u5982\uff0c<code>top \u547d\u4ee4</code>\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u67e5\u770b\u54ea\u4e2a\u8fdb\u7a0b\u662f CPU \u7684\u6d88\u8017\u5927\u6237\uff1b<code>vmstat \u547d\u4ee4</code> \u53ef\u4ee5\u5b9e\u65f6\u52a8\u6001\u76d1\u89c6\u64cd\u4f5c\u7cfb\u7edf\u7684\u865a\u62df\u5185\u5b58\u548c CPU \u6d3b\u52a8\uff1b<code>strace \u547d\u4ee4</code> \u53ef\u4ee5\u8ddf\u8e2a\u67d0\u4e2a\u8fdb\u7a0b\u4e2d\u6240\u6709\u7684\u7cfb\u7edf\u8c03\u7528\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#22-cpu","title":"2.2 CPU \u9971\u548c\u5ea6","text":"<p>CPU \u9971\u548c\u5ea6\u53cd\u6620\u7684\u662f\u7ebf\u7a0b\u6392\u961f\u7b49\u5f85 CPU \u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f CPU \u7684 \u8d1f\u8f7d\u60c5\u51b5\u3002</p> <p>CPU \u9971\u548c\u5ea6\u9996\u5148\u4f1a\u8ddf\u5e94\u7528\u7684 \u7ebf\u7a0b\u6570 \u6709\u5173\uff0c\u5982\u679c\u542f\u52a8\u7684\u7ebf\u7a0b\u8fc7\u591a\uff0c\u5bb9\u6613\u5bfc\u81f4\u7cfb\u7edf\u4e0d\u65ad\u5730\u5207\u6362\u6267\u884c\u7684\u7ebf\u7a0b\uff0c\u628a\u5927\u91cf\u7684\u65f6\u95f4\u6d6a\u8d39\u5728\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6211\u4eec\u77e5\u9053\u6bcf\u4e00\u6b21 CPU \u4e0a\u4e0b\u6587\u5207\u6362\u90fd\u9700\u8981\u5237\u65b0\u5bc4\u5b58\u5668\u548c\u8ba1\u6570\u5668\uff0c\u81f3\u5c11\u9700\u8981\u51e0\u5341\u7eb3\u79d2\u7684\u65f6\u95f4\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528<code>vmstat\u547d\u4ee4</code>\u6216\u8005<code>/proc/[pid]/schedstat\u6587\u4ef6</code>\u6765\u67e5\u770b CPU \u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\uff0c\u8fd9\u91cc\u7279\u522b\u9700\u8981\u6ce8\u610f <code>nr_involuntary_switches</code> \u88ab\u52a8\u5207\u6362\u7684\u6b21\u6570\u3002</p> <pre><code>proc/self/sched:\n  nr_voluntary_switches\uff1a     \u4e3b\u52a8\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u65e0\u6cd5\u83b7\u53d6\u6240\u9700\u8d44\u6e90\u5bfc\u81f4\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6700\u666e\u904d\u7684\u662fIO\u3002    nr_involuntary_switches\uff1a   \u88ab\u52a8\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\uff0c\u7ebf\u7a0b\u88ab\u7cfb\u7edf\u5f3a\u5236\u8c03\u5ea6\u5bfc\u81f4\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4f8b\u5982\u5927\u91cf\u7ebf\u7a0b\u5728\u62a2\u5360CPU\u3002\n  se.statistics.iowait_count\uff1aIO \u7b49\u5f85\u7684\u6b21\u6570\n  se.statistics.iowait_sum\uff1a  IO \u7b49\u5f85\u7684\u65f6\u95f4\n</code></pre> <p>\u6b64\u5916\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>uptime</code> \u547d\u4ee4\u53ef\u4ee5\u68c0\u67e5 CPU \u5728 1 \u5206\u949f\u30015 \u5206\u949f\u548c 15 \u5206\u949f\u5185\u7684\u5e73\u5747\u8d1f\u8f7d\u3002\u6bd4\u5982\u4e00\u4e2a 4 \u6838\u7684 CPU\uff0c\u5982\u679c\u5f53\u524d\u5e73\u5747\u8d1f\u8f7d\u662f 8\uff0c\u8fd9\u610f\u5473\u7740\u6bcf\u4e2a CPU \u4e0a\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u8fd0\u884c\uff0c\u8fd8\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u7b49\u5f85\u3002\u4e00\u822c\u5e73\u5747\u8d1f\u8f7d\u5efa\u8bae\u63a7\u5236\u5728 0.7 \u00d7 \u6838\u6570 \u4ee5\u5185\u3002</p> <pre><code>00:02:39 up 7 days, 46 min,  0 users,  \nload average: 13.91, 14.70, 14.32\n</code></pre> <p>\u53e6\u5916\u4e00\u4e2a\u4f1a\u5f71\u54cd CPU \u9971\u548c\u5ea6\u7684\u662f \u7ebf\u7a0b\u4f18\u5148\u7ea7\uff0c\u7ebf\u7a0b\u4f18\u5148\u7ea7\u4f1a\u5f71\u54cd Android \u7cfb\u7edf\u7684\u8c03\u5ea6\u7b56\u7565\uff0c\u5b83\u4e3b\u8981\u7531 <code>nice</code> \u548c <code>cgroup</code> \u7c7b\u578b\u5171\u540c\u51b3\u5b9a\u3002nice \u503c\u8d8a\u4f4e\uff0c\u62a2\u5360 CPU \u65f6\u95f4\u7247\u7684\u80fd\u529b\u8d8a\u5f3a\u3002</p> <p>\u5f53 CPU \u7a7a\u95f2\u65f6\uff0c\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7\u5bf9\u6267\u884c\u6548\u7387\u7684\u5f71\u54cd\u5e76\u4e0d\u4f1a\u7279\u522b\u660e\u663e\uff0c\u4f46\u5728 CPU \u7e41\u5fd9\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u8c03\u5ea6\u4f1a\u5bf9\u6267\u884c\u6548\u7387\u6709\u975e\u5e38\u5927\u7684\u5f71\u54cd\u3002</p> <p>\u5173\u4e8e\u7ebf\u7a0b\u4f18\u5148\u7ea7\uff0c\u4f60\u9700\u8981\u6ce8\u610f \u662f\u5426\u5b58\u5728\u9ad8\u4f18\u5148\u7ea7\u7684\u7ebf\u7a0b\u7a7a\u7b49\u4f4e\u4f18\u5148\u7ea7\u7ebf\u7a0b\uff0c\u4f8b\u5982\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u67d0\u4e2a\u540e\u53f0\u7ebf\u7a0b\u7684\u9501\u3002\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u65e0\u8bba\u662f\u7528\u6237\u65f6\u95f4\u3001\u7cfb\u7edf\u65f6\u95f4\uff0c\u8fd8\u662f\u7b49\u5f85 CPU \u7684\u8c03\u5ea6\uff0c\u90fd\u662f\u7a0b\u5e8f\u8fd0\u884c\u82b1\u8d39\u7684\u65f6\u95f4\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#23","title":"2.3 \u6392\u67e5\u5de5\u5177","text":""},{"location":"perf-opt/Android/jank/jank-opt/#systrace","title":"systrace","text":"<p><code>systrace</code>\u662f Android 4.1 \u65b0\u589e\u7684\u6027\u80fd\u5206\u6790\u5de5\u5177\u3002\u901a\u5e38\u4f7f\u7528 <code>systrace</code> \u8ddf\u8e2a\u7cfb\u7edf\u7684 I/O \u64cd\u4f5c\u3001 CPU \u8d1f\u8f7d\u3001 Surface \u6e32\u67d3\u3001 GC \u7b49\u4e8b \u4ef6\u3002<code>systrace</code>\u5229\u7528\u4e86 Linux \u7684ftrace\u8c03\u8bd5\u5de5\u5177\uff0c\u76f8\u5f53\u4e8e\u5728\u7cfb\u7edf\u5404\u4e2a\u5173\u952e\u4f4d\u7f6e\u90fd\u6dfb\u52a0\u4e86\u4e00\u4e9b\u6027\u80fd\u63a2\u9488\uff0c\u4e5f\u5c31\u662f\u5728\u4ee3\u7801\u91cc\u52a0\u4e86\u4e00\u4e9b\u6027\u80fd\u76d1\u63a7\u7684\u57cb\u70b9\u3002</p> <p>Android \u5728 ftrace \u7684\u57fa\u7840\u4e0a\u5c01\u88c5\u4e86atrace\uff0c\u5e76\u589e\u52a0\u4e86\u66f4\u591a\u7279\u6709\u7684\u63a2\u9488\uff0c\u4f8b\u5982 <code>Graphics</code>\u3001<code>Activity Manager</code>\u3001<code>Dalvik VM</code>\u3001<code>System Server</code>\u7b49\u3002systrace \u5de5\u5177\u53ea\u80fd\u76d1\u63a7\u7279\u5b9a\u7cfb\u7edf\u8c03\u7528\u7684\u8017\u65f6\u60c5\u51b5\uff0c\u6240\u4ee5\u5b83\u662f\u5c5e\u4e8e <code>sample</code>\u7c7b\u578b\uff0c\u800c\u4e14\u6027\u80fd\u5f00\u9500\u975e\u5e38\u4f4e\u3002</p> <p>\u66f4\u591a\u4ecb\u7ecd\u89c1 systrace \u4f7f\u7528</p>"},{"location":"perf-opt/Android/jank/jank-opt/#perfetto","title":"Perfetto","text":"<p>\u5728Android 9.0\uff08API\u7ea7\u522b28\uff09\u6216\u66f4\u9ad8\u7248\u672c\u7684\u8bbe\u5907\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528 Perfetto \u5728\u8bbe\u5907\u4e0a\u8bb0\u5f55\u7cfb\u7edf\u8ddf\u8e2a\u3002Perfetto \u5de5\u5177\u662fAndroid\u4e0b\u4e00\u4ee3\u5168\u65b0\u7684\u7edf\u4e00\u7684 trace \u6536\u96c6\u548c\u5206\u6790\u6846\u67b6\uff0c\u53ef\u4ee5\u6293\u53d6\u5e73\u53f0\u548capp\u7684 trace \u4fe1\u606f\uff0c\u662f\u7528\u6765\u53d6\u4ee3 systrace \u7684\uff0c\u4f46 systrace \u7531\u4e8e\u5386\u53f2\u539f\u56e0\u4e5f\u8fd8\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u5e76\u4e14 Perfetto \u6293\u53d6\u7684 trace \u6587\u4ef6\u4e5f\u53ef\u4ee5\u540c\u6837\u8f6c\u6362\u6210 systrace \u89c6\u56fe\uff0c\u5982\u679c\u4e60\u60ef\u7528 systrace \u7684\uff0c\u53ef\u4ee5\u7528 Perfetto UI \u7684 Open with legacy UI \u8f6c\u6362\u6210 systrace \u89c6\u56fe\u6765\u770b</p> <p>\u66f4\u591a\u4ecb\u7ecd \u89c1 Perfetto\u5165\u95e8</p>"},{"location":"perf-opt/Android/jank/jank-opt/#cpu-profiler","title":"CPU profiler","text":"<p>CPU profiler\u96c6\u6210\u5728Android studio \u4e2d\uff0c\u66f4\u65b9\u4fbf\u5f00\u53d1\u8005\u4f7f\u7528\u3002\u53ef\u4ee5\u5728\u53ef\u89c6\u5316\u754c\u9762\u9009\u62e9\u4e0d\u540c\u914d\u7f6e\u6765\u8ddf\u8e2aCPU\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>Sample Java Methods  \u7684\u529f\u80fd\u7c7b\u4f3c\u4e8e Traceview \u7684 sample \u7c7b\u578b\u3002</li> <li>Trace Java Methods \u7684\u529f\u80fd\u7c7b\u4f3c\u4e8e  Traceview \u7684 instrument \u7c7b\u578b\u3002</li> <li>Trace System Calls \u7684\u529f\u80fd\u7c7b\u4f3c\u4e8e systrace\u3002</li> <li>SampleNative (API Level 26+) \u7684\u529f\u80fd\u7c7b\u4f3c\u4e8e Simpleperf\u3002</li> </ul>"},{"location":"perf-opt/Android/jank/jank-opt/#24","title":"2.4 \u5206\u6790\u7ed3\u679c\u5c55\u793a\u65b9\u5f0f","text":""},{"location":"perf-opt/Android/jank/jank-opt/#call-chart","title":"Call Chart","text":"<p>Call Chart \u662f Traceview \u548c systrace \u9ed8\u8ba4\u4f7f\u7528\u7684\u5c55\u793a\u65b9\u5f0f\u3002\u5b83\u6309\u7167\u5e94\u7528\u7a0b\u5e8f\u7684\u51fd\u6570\u6267\u884c\u987a\u5e8f\u6765\u5c55\u793a\uff0c\u9002\u5408\u7528\u4e8e\u5206\u6790\u6574\u4e2a\u6d41\u7a0b\u7684\u8c03\u7528\u3002\u4e3e\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff0cA \u51fd\u6570\u8c03\u7528 B \u51fd\u6570\uff0cB \u51fd\u6570\u8c03\u7528 C \u51fd\u6570\uff0c\u5faa\u73af\u4e09\u6b21\uff0c\u5c31\u5f97\u5230\u4e86\u4e0b\u9762\u7684 Call Chart\u3002</p> <p></p> <p>Call Chart \u5c31\u50cf\u7ed9\u5e94\u7528\u7a0b\u5e8f\u505a\u4e00\u4e2a\u5fc3\u7535\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728\u8fd9\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u5404\u4e2a\u7ebf\u7a0b\u7684\u5177\u4f53\u5de5\u4f5c\uff0c\u6bd4\u5982\u662f\u5426\u5b58\u5728\u7ebf\u7a0b\u95f4\u7684\u9501\u3001\u4e3b\u7ebf\u7a0b\u662f\u5426\u5b58\u5728\u957f\u65f6\u95f4\u7684 I/O \u64cd\u4f5c\u3001\u662f\u5426\u5b58\u5728\u7a7a\u95f2\u7b49\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#flame-chart","title":"Flame Chart","text":"<p>Flame Chart \u4e5f\u5c31\u662f\u5927\u540d\u9f0e\u9f0e\u7684\u706b\u7130\u56fe\u3002\u5b83\u8ddf Call Chart \u4e0d\u540c\u7684\u662f\uff0cFlame Chart \u4ee5\u4e00\u4e2a\u5168\u5c40\u7684\u89c6\u91ce\u6765\u770b\u5f85\u4e00\u6bb5\u65f6\u95f4\u7684\u8c03\u7528\u5206\u5e03\uff0c\u5b83\u5c31\u50cf\u7ed9\u5e94\u7528\u7a0b\u5e8f\u62cd X \u5149\u7247\uff0c\u53ef\u4ee5\u5f88\u81ea\u7136\u5730\u628a\u65f6\u95f4\u548c\u7a7a\u95f4\u4e24\u4e2a\u7ef4\u5ea6\u4e0a\u7684\u4fe1\u606f\u878d\u5408\u5728\u4e00\u5f20\u56fe\u4e0a\u3002\u4e0a\u9762\u51fd\u6570\u8c03\u7528\u7684\u4f8b\u5b50\uff0c\u6362\u6210\u706b\u7130\u56fe\u7684\u5c55\u793a\u7ed3\u679c\u5982\u4e0b\u3002  \u5f53\u6211\u4eec\u4e0d\u60f3\u77e5\u9053\u5e94\u7528\u7a0b\u5e8f\u7684\u6574\u4e2a\u8c03\u7528\u6d41\u7a0b\uff0c\u53ea\u60f3\u76f4\u89c2\u770b\u51fa\u54ea\u4e9b\u4ee3\u7801\u8def\u5f84\u82b1\u8d39\u7684 CPU \u65f6\u95f4\u8f83\u591a\u65f6\uff0c\u706b\u7130\u56fe\u5c31\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u9009\u62e9\u3002</p> <p>\u706b\u7130\u56fe\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5728\u5404\u79cd\u5404\u6837\u7684\u7ef4\u5ea6\uff0c\u4f8b\u5982\u5185\u5b58\u3001I/O \u7684\u5206\u6790\u3002\u6709\u4e9b\u5185\u5b58\u53ef\u80fd\u975e\u5e38\u7f13\u6162\u5730\u6cc4\u6f0f\uff0c\u901a\u8fc7\u4e00\u4e2a\u5185\u5b58\u7684\u706b\u7130\u56fe\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u54ea\u4e9b\u8def\u5f84\u7533\u8bf7\u7684\u5185\u5b58\u6700\u591a\uff0c\u6709\u4e86\u706b\u7130\u56fe\u6211\u4eec\u6839\u672c\u4e0d\u9700\u8981\u5206\u6790\u6e90\u4ee3\u7801\uff0c\u4e5f\u4e0d\u9700\u8981\u5206\u6790\u6574\u4e2a\u6d41\u7a0b\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#3","title":"3. \u4f18\u5316\u601d\u8def","text":"<p>\u9501\u7b49\u5f85</p> <ul> <li>\u901a\u8fc7\u4f18\u5316\u6d41\u7a0b\u5c3d\u91cf\u7684\u51cf\u5c11\u6d41\u7a0b\u4e2d\u4e0d\u5fc5\u8981\u7684\u6301\u9501\u6216\u51cf\u5c0f\u6301\u9501\u8303\u56f4</li> <li>\u5229\u7528\u4e00\u4e9b\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u7f13\u5b58\u65b9\u6848\u6216\u4f18\u5316CPU\u3001IO\u7b49\u8d44\u6e90\u7684\u8c03\u5ea6\u4e0e\u5206\u914d\uff0c\u51cf\u5c11\u7ebf\u7a0b\u7684\u6301\u9501\u7684\u65f6\u957f</li> </ul> <p>\u5e94\u7528UI\u7ebf\u7a0b\u8017\u65f6\u5f15\u8d77\u5361\u987f</p> <p>\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u8017\u65f6\u5f15\u8d77\u7684\u5361\u987f\u5f80\u5f80\u6d89\u53ca\u7684\u56e0\u7d20\u6bd4\u8f83\u591a\uff0c\u4e0b\u9762\u5217\u4e3e\u4e00\u4e9b\u5e38\u89c1\u539f\u56e0\uff1a</p> <ol> <li><code>UI</code>\u7ebf\u7a0b\u6d88\u606f\u961f\u5217\u4e2d\u5b58\u5728\u9664<code>doFrame</code>\u7ed8\u5236\u4efb\u52a1\u5916\u7684\u5176\u5b83\u8017\u65f6\u4efb\u52a1\uff0c\u5bfc\u81f4<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\uff0c\u65e0\u6cd5\u53ca\u65f6\u89e6\u53d1<code>UI</code>\u7ebf\u7a0b\u6267\u884c<code>doFrame</code>\u7ed8\u5236\u4e0a\u5e27\u4efb\u52a1\uff0c\u800c\u5bfc\u81f4\u6389\u5e27\u3002\u4f8b\u5982\u754c\u9762\u5e03\u5c40<code>XML</code>\u6587\u4ef6\u7684<code>inflate</code>\u89e3\u6790\uff0c\u5982\u679c\u754c\u9762\u5e03\u5c40\u6587\u4ef6\u6bd4\u8f83\u590d\u6742\uff0c\u5c31\u5230\u6709\u5927\u91cf\u7684<code>IO</code>\u4e0e\u53cd\u5c04\u7b49\u8017\u65f6\u64cd\u4f5c\u3002\u53c8\u6216\u8005<code>UI</code>\u7ebf\u7a0b\u4e2d\u6709<code>decodeBitmap</code>\u89e3\u6790\u5927\u56fe\u7247\u7684\u8017\u65f6\u64cd\u4f5c\u3002</li> <li><code>UI</code>\u5e27\u7684<code>doFrame</code>\u7ed8\u5236\u4efb\u52a1\u5904\u7406\u8017\u65f6\u8fc7\u957f\u5bfc\u81f4\u6389\u5e27\u3002\u6700\u5e38\u89c1\u7684\u95ee\u9898\u5c31\u662f\u5e94\u7528\u754c\u9762\u5e03\u5c40\u5b58\u5728\u8fc7\u5ea6\u7ed8\u5236\uff0c\u5bfc\u81f4<code>measure/layout/draw</code>\u4efb\u52a1\u7684\u8ba1\u7b97 \u590d\u6742\u5ea6\u6210\u500d\u4e0a\u5347\u3002\u518d\u6bd4\u5982\u5e94\u7528\u754c\u9762\u5e03\u5c40\u4e2d\u7684\u90e8\u5206<code>View</code>\u63a7\u4ef6\u5c42\u9762\u5982\u679c\u5173\u95ed\u4e86\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\uff0c\u5c31\u4f1a\u89e6\u53d1<code>View#buildDrawingCache</code>\u7684\u8017\u65f6\u64cd\u4f5c\uff0c\u4ece\u800c\u5bfc\u81f4\u6574\u4e2a<code>draw</code>\u52a8\u4f5c\u8017\u65f6\u8fc7\u957f\u800c\u5f15\u8d77\u6389\u5e27\u3002</li> <li><code>UI</code>\u7ebf\u7a0b\u5b58\u5728\u5927\u91cf\u7684\u963b\u585e\u7b49\u5f85\u5bfc\u81f4\u4e0a\u5e27\u8d85\u65f6\u3002<code>UI</code>\u7ebf\u7a0b\u9677\u5165\u963b\u585e\u7b49\u5f85\uff0c\u5e38\u89c1\u7684\u539f\u56e0\u5c31\u662f\u8de8\u8fdb\u7a0b\u7684<code>Binder</code>\u8c03\u7528\u963b\u585e\u548c\u8fdb\u7a0b\u5185\u7684\u540c\u6b65\u9501\u7ade\u4e89\u7b49\u5f85\u3002\u8fd8\u6709\u4e00\u7c7b\u60c5\u51b5\u5c31\u662f\u9891\u7e41\u7684<code>GC</code>\u5185\u5b58\u56de\u6536\u5f15\u8d77(\u4e00\u822c\u4e3a\u8fdb\u7a0b\u5185\u5b58\u6296\u52a8\u6216\u5185\u5b58\u6cc4\u9732\u5f15\u8d77)\u3002</li> </ol> <p>\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u8017\u65f6\u5f15\u8d77\u5361\u987f\u7684\u95ee\u9898\uff0c\u539f\u5219\u5c31\u662f\u5c3d\u91cf\u51cf\u8f7b<code>UI</code>\u7ebf\u7a0b\u7684\u8d1f\u62c5\u3002\u9488\u5bf9\u4e0d\u540c\u7684\u5f15\u8d77\u95ee\u9898\u539f\u56e0\uff0c\u5e38\u89c1\u7684\u4f18\u5316\u601d\u8def\u5927\u81f4\u5982\u4e0b\uff1a</p> <ol> <li>\u5f02\u6b65\u5904\u7406\uff1a\u5404\u79cd\u8017\u65f6\u64cd\u4f5c\u5c3d\u91cf\u653e\u5230\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5904\u7406\u3002\u6bd4\u5982\u4f7f\u7528<code>View</code>\u7684\u5f02\u6b65\u7ebf\u7a0b<code>inflate</code>\u65b9\u6848\uff1b<code>decodeBitmap</code>\u52a0\u8f7d\u56fe\u7247\u7684\u8017\u65f6\u64cd\u4f5c\u79fb\u5230\u5b50\u7ebf\u7a0b\u7edf\u4e00\u5904\u7406\u7b49\u3002</li> <li>\u903b\u8f91\u4f18\u5316\uff1a\u5fc5\u987b\u8981\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\u7684\u903b\u8f91\u5e94\u5c3d\u91cf\u4f18\u5316\uff0c\u51cf\u5c11\u8ba1\u7b97\u9891\u6b21\uff0c\u907f\u514d\u91cd\u590d\u8ba1\u7b97\u3002\u6bd4\u5982\u91c7\u7528\u7ea6\u675f\u5e03\u5c40\u89e3\u51b3\u5d4c\u5957\u8fc7\u591a\u7684\u95ee\u9898\uff0c\u907f\u514d\u8fc7\u5ea6\u7ed8\u5236\uff1b\u4f18\u5316\u5e94\u7528\u7684\u5185\u5b58\u5360\u7528\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u9732\u3001\u5185\u5b58\u6296\u52a8\u7b49\u95ee\u9898\uff0c\u4ece\u800c\u51cf\u5c11<code>GC</code>\u89e6\u53d1\u7684\u6b21\u6570\uff1b\u4f18\u5316\u5185\u90e8\u4ee3\u7801\u903b\u8f91\uff0c\u5c3d\u91cf\u51cf\u5c11\u4e3b\u7ebf\u7a0b\u9677\u5165\u540c\u6b65\u9501\u7ade\u4e89\u7b49\u5f85\u7684\u72b6\u6001\uff1b\u539f\u5219\u4e0a\u4e0d\u8981\u4e3b\u52a8\u53bb\u5173\u95ed\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\u3002</li> <li>\u6d41\u7a0b\u590d\u7528\uff1a\u80fd\u590d\u7528\u7684\u903b\u8f91\u5c3d\u91cf\u590d\u7528\uff0c\u4ee5\u907f\u514d\u591a\u6b21\u8c03\u7528\u4ea7\u751f\u7684\u6027\u80fd\u5f00\u9500\u3002\u6bd4\u5982<code>ListView</code>\u7684<code>Adapter</code>\u4e2d\u5b9e\u73b0<code>View</code>\u7684\u590d\u7528\uff0c\u51cf\u5c11<code>View</code>\u7684<code>inflate</code>\u6267\u884c\u6b21\u6570\u3002\u53e6\u5916<code>UI</code>\u7ebf\u7a0b\u4e2d<code>Binder</code>\u8bf7\u6c42\u6846\u67b6\u67e5\u8be2\u4e00\u4e9b\u7cfb\u7edf\u4fe1\u606f\uff0c\u80fd\u591f\u4e00\u6b21\u67e5\u5b8c\u5c31\u4e0d\u8981\u5206\u591a\u6b21\u6267\u884c\u3002\u4e14\u67e5\u8be2\u7ed3\u679c\u5e94\u5c3d\u91cf\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u5b9e\u73b0\u590d\u7528\uff0c\u907f\u514d\u591a\u6b21\u53cd\u590d\u7684\u67e5\u8be2\u9020\u6210\u4e3b\u7ebf\u7a0b\u9891\u7e41\u9677\u5165<code>Binder</code>\u963b\u585e\u7b49\u5f85\u3002</li> </ol> <p>\u78c1\u76d8I/O\u5f15\u8d77\u5361\u987f</p> <p>\u9009\u62e9\u5408\u9002\u7684\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c\u3002\u5bf9\u8bfb\u5199\u901f\u5ea6\u6709\u8f83\u9ad8\u7684\u8981\u6c42\uff0c\u5e76\u5141\u8bb8\u4f4e\u6982\u7387\u7684\u6570\u636e\u4e22\u5931\u95ee\u9898\uff0c\u5c31\u91c7\u7528\u7cfb\u7edf\u9ed8\u8ba4\u7684\u57fa\u4e8e<code>Page Cache</code>\u7684\u7f13\u5b58<code>I/O</code>\uff1b\u5bf9\u6587\u4ef6\u8bfb\u5199\u7684\u901f\u5ea6\u8981\u6c42\u4e0d\u9ad8\uff0c\u4f46\u662f\u9700\u8981\u4e25\u683c\u7684\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u5c31\u4f7f\u7528<code>Direct I/O</code>\uff1b\u5982\u679c\u9700\u8981\u5bf9\u540c\u4e00\u5757\u533a\u57df\u8fdb\u884c\u9891\u7e41\u8bfb\u5199\u7684\u60c5\u51b5\uff0c\u5bf9\u8bfb\u5199\u6027\u80fd\u8981\u6c42\u6781\u9ad8\uff0c\u53ef\u4ee5\u91c7\u7528<code>mmap</code> \u5185\u5b58\u6620\u5c04\u673a\u5236\u5b9e\u73b0\u8bfb\u5199\u6587\u4ef6\uff0c\u6bd4\u5982\u817e\u8baf\u5f00\u6e90\u7684\u7528\u4e8e\u6539\u5584\u539f\u751f<code>SharePreferences</code>\u673a\u5236\u6027\u80fd\u7684\u5b58\u50a8\u5de5\u5177<code>MMKV</code>\u5c31\u662f\u8fd9\u4e2a\u539f\u7406\u5b9e\u73b0\u7684\u3002</p> <p><code>I/O</code> \u65b9\u5f0f\u7684\u9009\u62e9\u3002\u4e00\u4e2a\u662f\u5bf9\u4e8e\u963b\u585e<code>I/O</code>\u64cd\u4f5c\u5c3d\u91cf\u653e\u5165\u5b50\u7ebf\u7a0b\u6267\u884c\uff0c\u4ee5\u514d\u963b\u585e<code>UI</code>\u7ebf\u7a0b\uff1b\u4e8c\u662f\u9002\u5f53\u91c7\u7528\u5f02\u6b65<code>I/O</code>\u51cf\u5c11\u8bfb\u53d6\u6587\u4ef6\u7684\u8017\u65f6\uff0c\u63d0\u5347<code>CPU</code>\u6574\u4f53\u5229\u7528\u7387\uff0c\u6bd4\u5982<code>Okio</code>\u5c31\u652f\u6301\u5f02\u6b65<code>I/O</code>\u64cd\u4f5c\u3002</p> <p>\u4f18\u5316\u6570\u636e\u7ed3\u6784\uff0c\u5efa\u7acb\u5185\u5b58\u7f13\u5b58\uff0c\u5c3d\u91cf\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684<code>I/O</code>\uff1b</p>"},{"location":"perf-opt/Android/jank/jank-opt/#4","title":"4. \u5361\u987f\u76d1\u63a7","text":""},{"location":"perf-opt/Android/jank/jank-opt/#41-watchdog","title":"4.1 WatchDog","text":"<p>\u8fd9\u79cd\u65b9\u6848\u7684 \u672c\u8d28\u662f\u5f00\u542f\u4e00\u4e2a\u5b50\u7ebf\u7a0b\u4e0d\u65ad\u8f6e\u8be2UI\u7ebf\u7a0b \uff0c\u8fd9\u662f\u6700\u5bb9\u6613\u7406\u89e3\uff0c\u6700\u7b80\u5355\u7c97\u66b4\u7684\u65b9\u6cd5\u3002\u8fd9\u79cd\u65b9\u6cd5\u751a\u81f3\u5177\u6709\u4e00\u5b9a\u7684\u666e\u9002\u6027\uff0ciOS\u6216\u8005\u5176\u4ed6\u7684\u5ba2\u6237\u7aef\u7cfb\u7edf\uff0c\u90fd\u53ef\u4ee5\u7528\u7c7b\u4f3c\u7684\u601d\u8def\u6765\u76d1\u63a7\u5361\u987f\u3002\u5177\u4f53\u7684\u539f\u7406\u548c\u5b9e\u73b0\u65b9\u6cd5\u5f88\u7b80\u5355\uff1a\u4e0d\u65ad\u5411UI\u7ebf\u7a0b\u53d1\u9001Message\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u68c0\u67e5\u4e00\u6b21\u521a\u521a\u53d1\u9001\u7684Message\u662f\u5426\u88ab\u5904\u7406\uff0c\u5982\u679c\u6ca1\u6709\u88ab\u5904\u7406\uff0c\u5219\u8bf4\u660e\u8fd9\u6bb5\u65f6\u95f4\u4e3b\u7ebf\u7a0b\u88ab\u5361\u4f4f\u4e86\u3002</p> <ul> <li> <p>\u4f18\u70b9\uff1a\u7b80\u5355\uff0c\u7a33\u5b9a\uff0c\u7ed3\u679c\u8bba\uff0c\u53ef\u4ee5\u76d1\u63a7\u5230\u5404\u79cd\u7c7b\u578b\u7684\u5361\u987f</p> </li> <li> <p>\u7f3a\u70b9\uff1a\u8f6e\u8be2\u4e0d\u4f18\u96c5\uff0c\u4e0d\u73af\u4fdd\uff0c\u6709\u4e0d\u786e\u5b9a\u6027\uff0c\u968f\u673a\u6f0f\u62a5</p> </li> </ul> <p>\u8f6e\u8be2\u7684\u65f6\u95f4\u95f4\u9694\u8d8a\u5c0f\uff0c\u5bf9\u6027\u80fd\u7684\u8d1f\u9762\u5f71\u54cd\u5c31\u8d8a\u5927\uff0c\u800c\u65f6\u95f4\u95f4\u9694\u9009\u62e9\u7684\u8d8a\u5927\uff0c\u6f0f\u62a5\u7684\u53ef\u80fd\u6027\u4e5f\u5c31\u8d8a\u5927\u3002\u56e0\u4e3a UI\u7ebf\u7a0b\u8981\u4e0d\u65ad\u5904\u7406\u6211\u4eec\u53d1\u9001\u7684Message\uff0c\u5fc5\u7136\u4f1a\u5f71\u54cd\u6027\u80fd\u548c\u529f\u8017 \u3002\u5e76\u4e14\u5bb9\u6613\u51fa\u73b0 \u968f\u673a\u6f0f\u62a5 : \u5047\u8bbe WatchDog\u9ed8\u8ba4\u7684\u8f6e\u8be2\u65f6\u95f4\u95f4\u9694\u4e3a5\u79d2\uff0c\u5f53\u4e3b\u7ebf\u7a0b\u5361\u987f\u4e862\u79d2\u4e4b\u540e\uff0cWatchDog\u7684\u90a3\u4e2a\u5b50\u7ebf\u7a0b\u624d\u5f00\u59cb\u5f80\u4e3b\u7ebf\u7a0b\u53d1\u9001\u6d88\u606f\uff0c\u5e76\u4e14\u4e3b\u7ebf\u7a0b\u57283\u79d2\u4e4b\u540e\u4e0d\u5361\u987f\u4e86\uff0c\u6b64\u65f6\u4e3b\u7ebf\u7a0b\u5df2\u7ecf\u5361\u987f\u4e865\u79d2\u4e86\uff0c\u5b50\u7ebf\u7a0b\u53d1\u9001\u7684\u90a3\u4e2a\u6d88\u606f\u4e5f\u968f\u4e4b\u5f97\u5230\u6267\u884c\uff0c\u5b83\u6ca1\u610f\u8bc6\u5230\u4e3b\u7ebf\u7a0b\u521a\u521a\u53d1\u751f\u4e86\u5361\u987f\u3002</p> <p>\u5982\u679c\u6211\u4eec\u4e0d\u65ad\u7f29\u5c0f\u8f6e\u8be2\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u7528\u66f4\u77ed\u7684\u8f6e\u8be2\u65f6\u95f4\uff0c\u8fde\u7eed\u51e0\u4e2a\u5468\u671f\u6d88\u606f\u90fd\u6ca1\u88ab\u5904\u7406\u624d\u89c6\u4e3a\u4e00\u6b21\u5361\u987f\u3002\u5219\u66f4\u5bb9\u6613\u76d1\u63a7\u5230\u5361\u987f\uff0c\u4f46\u5bf9\u6027\u80fd\u635f\u8017\u5927\u4e00\u4e9b\u3002\u5373\u4f7f\u662f\u7f29\u5c0f\u8f6e\u8be2\u65f6\u95f4\u95f4\u9694\uff0c\u4e5f\u4e0d\u4e00\u5b9a\u80fd\u76d1\u63a7\u5230\u3002\u53ea\u662f\u964d\u4f4e\u4e86\u6f0f\u62a5\u7684\u6982\u7387\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#42-looper-printer-choreographer","title":"4.2 Looper Printer &amp; Choreographer","text":"<p>\u66ff\u6362\u4e3b\u7ebf\u7a0bLooper\u7684Printer\uff0c\u4ece\u800c\u76d1\u63a7dispatchMessage\u7684\u6267\u884c\u65f6\u95f4\u3002</p> <p>\u5176\u539f\u7406\u4e5f\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u4ee5\u4e0b\u662fLooper\u7684\u90e8\u5206\u5173\u952e\u4ee3\u7801\uff0c</p> <pre><code>for (;;) {\nMessage msg = queue.next(); // might block\n// This must be in a local variable, in case a UI event sets the logger\nfinal Printer logging = me.mLogging;\nif (logging != null) {\nlogging.println(\"&gt;&gt;&gt;&gt;&gt; Dispatching to \" + msg.target + \" \" +\nmsg.callback + \": \" + msg.what);\n}\nmsg.target.dispatchMessage(msg);\nif (logging != null) {\nlogging.println(\"&lt;&lt;&lt;&lt;&lt; Finished to \" + msg.target + \" \" + msg.callback);\n}\n}\n</code></pre> <p>\u65e0\u8bba\u662f\u901a\u8fc7\u53cd\u5c04\u66ff\u6362Looper\u7684 mLogging \u8fd8\u662f\u901a\u8fc7 setMessageLogging \u8bbe\u7f6eprinter\uff0c\u6211\u4eec\u53ea\u9700\u8981\u66ff\u6362\u4e3b\u7ebf\u7a0bLooper\u7684printer\u5bf9\u8c61\uff0c\u901a\u8fc7\u8ba1\u7b97\u6267\u884cdispatchMessage\u65b9\u6cd5\u4e4b\u540e\u548c\u4e4b\u524d\u6253\u5370\u5b57\u7b26\u4e32\u7684\u65f6\u95f4\u7684\u5dee\u503c\uff0c\u5c31\u53ef\u4ee5\u62ff\u5230\u5230 dispatchMessage \u65b9\u6cd5\u6267\u884c\u7684\u65f6\u95f4\u3002\u800c \u5927\u90e8\u5206\u7684\u4e3b\u7ebf\u7a0b\u7684\u64cd\u4f5c\u6700\u7ec8\u90fd\u4f1a\u6267\u884c\u5230\u8fd9\u4e2a dispatchMessage \u65b9\u6cd5\u4e2d \u3002</p> <p>\u53e6\u5916\u5229\u7528\u7cfb\u7edf Choreographer \u6a21\u5757\uff0c\u5411\u8be5\u6a21\u5757\u6ce8\u518c\u4e00\u4e2a FrameCallback \u76d1\u542c\u5bf9\u8c61\uff0c\u5e76\u5728\u6bcf\u6b21 Vsync \u4e8b\u4ef6 doFrame \u901a\u77e5\u56de\u6765\u65f6\uff0c\u5faa\u73af\u6ce8\u518c\u8be5\u76d1\u542c\u5bf9\u8c61\uff0c\u95f4\u63a5\u7edf\u8ba1\u4e24\u6b21 Vsync \u4e8b\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\u3002\u8fd9\u6837\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7edf\u8ba1\u5230\u5e27\u7387\u4ee5\u53ca\u6bcf\u5e27\u7684\u8017\u65f6\u3002</p> <p>\u7ed3\u5408<code>Choreographer</code>\u548c<code>Looper Printer</code>\uff0c\u6211\u4eec\u4e0d\u4ec5\u53ef\u4ee5\u7edf\u8ba1\u5230\u51c6\u786e\u7684\u5e27\u7387\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u8ba1\u7b97\u51fa\u4e3b\u7ebf\u7a0b\u4e2d\u5404\u4e2a\u51fd\u6570\u6267\u884c\u8017\u65f6\uff0c\u8fd9\u91cc\u53ef\u4ee5\u53c2\u8003 matrix</p>"},{"location":"perf-opt/Android/jank/jank-opt/#421","title":"4.2.1 \u83b7\u53d6\u8017\u65f6\u5806\u6808","text":"<p>\u5f53\u8d85\u51fa\u9608\u503c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8be5\u6b21\u83b7\u53d6\u7684\u5806\u6808\u8fdb\u884c\u5206\u6790\u4e0a\u62a5\uff0c\u4ece\u800c\u6765\u6355\u6349\u5361\u987f\u4fe1\u606f\uff0c\u5426\u5219\u4e22\u5f03\u6b64\u6b21\u8bb0\u5f55\u7684\u5806\u6808\u4fe1\u606f\u3002\u4f46\u8fd9\u79cd\u65b9\u6cd5\u6700\u5927\u7684\u4e0d\u8db3\u5728\u4e8e\uff0c\u65e0\u6cd5\u83b7\u53d6\u5230\u5404\u4e2a\u51fd\u6570\u7684\u6267\u884c\u8017\u65f6\uff0c\u5bf9\u4e8e\u7a0d\u5fae\u590d\u6742\u4e00\u70b9\u7684\u5806\u6808\uff0c\u5f88\u96be\u627e\u51fa\u53ef\u80fd\u8017\u65f6\u7684\u51fd\u6570\uff0c\u4e5f\u5c31\u5f88\u96be\u627e\u5230\u5361\u987f\u7684\u539f\u56e0\u3002\u53e6\u5916\uff0c\u901a\u8fc7\u5176\u4ed6\u7ebf\u7a0b\u5faa\u73af\u83b7\u53d6\u4e3b\u7ebf\u7a0b\u7684\u5806\u6808\uff0c\u5982\u679c\u7a0d\u5fae\u5904\u7406\u4e0d\u53ca\u65f6\uff0c\u5f88\u5bb9\u6613\u5bfc\u81f4\u83b7\u53d6\u7684\u5806\u6808\u6709\u6240\u504f\u79fb\uff0c\u4e0d\u591f\u51c6\u786e\uff0c\u52a0\u4e0a\u6ca1\u6709\u8017\u65f6\u4fe1\u606f\uff0c\u5361\u987f\u4e5f\u5c31\u4e0d\u597d\u5b9a\u4f4d\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u5bfb\u6c42\u4e00\u79cd\u53ef\u4ee5\u5728\u7ebf\u4e0a\u51c6\u786e\u5730\u6355\u6349\u5361\u987f\u5806\u6808\uff0c\u53c8\u80fd\u8ba1\u7b97\u51fa\u5404\u4e2a\u51fd\u6570\u6267\u884c\u8017\u65f6\u7684\u65b9\u6848\u3002\u800c\u8981\u8ba1\u7b97\u51fd\u6570\u7684\u6267\u884c\u8017\u65f6\uff0c\u6700\u5173\u952e\u7684\u70b9\u5728\u4e8e\u5982\u4f55\u5bf9\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u51fd\u6570\u8fdb\u884c\u6253\u70b9\u76d1\u63a7\u3002</p> <p>\u53ef\u4ee5\u5229\u7528 Java \u5b57\u8282\u7801\u4fee\u6539\u5de5\u5177\uff08\u5982 <code>BCEL</code>\u3001<code>ASM</code>\u3001<code>Javassis</code>\u7b49\uff09\uff0c\u5728\u7f16\u8bd1\u671f\u95f4\u6536\u96c6\u6240\u6709\u751f\u6210\u7684 class \u6587\u4ef6\uff0c\u626b\u63cf\u6587\u4ef6\u5185\u7684\u65b9\u6cd5\u6307\u4ee4\u8fdb\u884c\u7edf\u4e00\u7684\u6253\u70b9\u63d2\u6869\uff0c\u540c\u6837\u4e5f\u53ef\u4ee5\u9ad8\u6548\u7684\u8bb0\u5f55\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u4fe1\u606f\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#_1","title":"\u5b9e\u73b0\u7ec6\u8282\uff1a","text":"<ul> <li> <p>\u4e3a\u4e86\u51cf\u5c11\u63d2\u6869\u91cf\u53ca\u6027\u80fd\u635f\u8017\uff0c\u901a\u8fc7\u904d\u5386 class \u65b9\u6cd5\u6307\u4ee4\u96c6\uff0c\u5224\u65ad\u626b\u63cf\u7684\u51fd\u6570\u662f\u5426\u53ea\u542b\u6709 PUT/READ FIELD \u7b49\u7b80\u5355\u7684\u6307\u4ee4\uff0c\u6765\u8fc7\u6ee4\u4e00\u4e9b\u9ed8\u8ba4\u6216\u533f\u540d\u6784\u9020\u51fd\u6570\uff0c\u4ee5\u53ca get/set \u7b49\u7b80\u5355\u4e0d\u8017\u65f6\u51fd\u6570\u3002</p> </li> <li> <p>\u4e3a\u4e86\u65b9\u4fbf\u53ca\u9ad8\u6548\u8bb0\u5f55\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\uff0c\u6211\u4eec\u4e3a\u6bcf\u4e2a\u63d2\u6869\u7684\u51fd\u6570\u5206\u914d\u4e00\u4e2a\u72ec\u7acb ID\uff0c\u5728\u63d2\u6869\u8fc7\u7a0b\u4e2d\uff0c\u8bb0\u5f55\u63d2\u6869\u7684\u51fd\u6570\u7b7e\u540d\u53ca\u5206\u914d\u7684 ID\uff0c\u5728\u63d2\u6869\u5b8c\u6210\u540e\u8f93\u51fa\u4e00\u4efd mapping\uff0c\u4f5c\u4e3a\u6570\u636e\u4e0a\u62a5\u540e\u7684\u89e3\u6790\u652f\u6301\u3002</p> </li> <li> <p>\u7f16\u8bd1\u671f\u5df2\u7ecf\u5bf9\u5168\u5c40\u7684\u51fd\u6570\u8fdb\u884c\u63d2\u6869\uff0c\u5728\u8fd0\u884c\u671f\u95f4\u6bcf\u4e2a\u51fd\u6570\u7684\u6267\u884c\u524d\u540e\u90fd\u4f1a\u8c03\u7528 MethodBeat.i/o \u7684\u65b9\u6cd5\uff0c\u5982\u679c\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u5219\u5728\u51fd\u6570\u7684\u6267\u884c\u524d\u540e\u83b7\u53d6\u5f53\u524d\u8ddd\u79bb MethodBeat \u6a21\u5757\u521d\u59cb\u5316\u7684\u65f6\u95f4 offset\uff08\u4e3a\u4e86\u538b\u7f29\u6570\u636e\uff0c\u5b58\u8fdb\u4e00\u4e2along\u7c7b\u578b\u53d8\u91cf\u4e2d\uff09\uff0c\u5e76\u5c06\u5f53\u524d\u6267\u884c\u7684\u662f MethodBeat i\u6216\u8005o\u3001mehtod id \u53ca\u65f6\u95f4 offset\uff0c\u5b58\u653e\u5230\u4e00\u4e2a long \u7c7b\u578b\u53d8\u91cf\u4e2d\uff0c\u8bb0\u5f55\u5230\u4e00\u4e2a\u9884\u5148\u521d\u59cb\u5316\u597d\u7684\u6570\u7ec4 long[] \u4e2d index \u7684\u4f4d\u7f6e\uff08\u9884\u5148\u5206\u914d\u8bb0\u5f55\u6570\u636e\u7684 buffer \u957f\u5ea6\u4e3a 100w\uff0c\u5185\u5b58\u5360\u7528\u7ea6 7.6M\uff09\u3002\u6570\u636e\u5b58\u50a8\u5982\u4e0b\u56fe\uff1a</p> </li> </ul> <p></p>"},{"location":"perf-opt/Android/jank/jank-opt/#422","title":"4.2.2  \u65e0\u6cd5\u88ab\u76d1\u63a7\u5230\u7684\u5361\u987f","text":"<p>\u4f7f\u7528<code>Looper Printer</code>\u8fd9\u79cd\u65b9\u5f0f\u76d1\u63a7\uff0c \u4e0d\u4f1a\u968f\u673a\u6f0f\u62a5\uff0c\u65e0\u9700\u8f6e\u8be2\uff0c\u4e00\u52b3\u6c38\u9038\uff0c\u4f46\u662f \u67d0\u4e9b\u7c7b\u578b\u7684\u5361\u987f\u65e0\u6cd5\u88ab\u76d1\u63a7\u5230\uff0c\u56e0\u4e3a\u6709\u4e9b\u60c5\u51b5\u7684\u5361\u987f\uff0c\u8fd9\u79cd\u65b9\u6848\u4ece\u539f\u7406\u4e0a\u5c31\u65e0\u6cd5\u76d1\u63a7\u5230\u3002\u770b\u5230\u4e0a\u9762\u7684 queue.next()\uff0c\u8fd9\u91cc\u7ed9\u4e86\u6ce8\u91ca\uff1amight block \uff0c\u76f4\u63a5\u8ddf\u4f60\u8bf4\u8fd9\u91cc\u662f\u53ef\u80fd\u4f1a\u5361\u4f4f\u7684\uff0cPrinter\u65e0\u6cd5\u76d1\u63a7\u5230next\u91cc\u9762\u53d1\u751f\u7684\u5361\u987f\uff0c \u8fd9\u65f6\u5019\u518d\u8ba1\u7b97 dispatchMessage \u65b9\u6cd5\u7684\u8017\u65f6\u663e\u7136\u5c31\u6ca1\u6709\u610f\u4e49\u4e86\u3002</p> <p>\u5982\u679c\u6392\u9664\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u7684\u60c5\u51b5\uff0c\u7a76\u7adf\u4f1a\u662f\u4ec0\u4e48\u539f\u56e0\u4f1a\u5361\u5728 MessageQueue \u7684 next \u65b9\u6cd5\u4e2d\u5462\uff1f\u4e0b\u56fe\u662f next \u65b9\u6cd5\u7b80\u5316\u8fc7\u540e\u7684\u6e90\u7801\uff0c</p> <pre><code>for (;;) {\nif (nextPollTimeoutMillis != 0) {\nBinder.flushPendingCommands();\n}\nnativePollOnce(ptr, nextPollTimeoutMillis);\n//......\n// Run the idle handlers.\n// We only ever reach this code block during the first iteration.\nfor (int i = 0; i &lt; pendingIdleHandlerCount; i++) {\nfinal IdleHandler idler = mPendingIdleHandlers[i];\nmPendingIdleHandlers[i] = null; // release the reference to the handler\nboolean keep = false;\ntry {\nkeep = idler.queueIdle();\n} catch (Throwable t) {\nLog.wtf(TAG, \"IdleHandler threw exception\", t);\n}\nif (!keep) {\nsynchronized (this) {\nmIdleHandlers.remove(idler);\n}\n}\n}\n//......\n}\n</code></pre> <ol> <li> <p>\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u4f1a\u963b\u585enext()\uff0c\u5177\u4f53\u662f\u963b\u585e\u5728nativePollOnce()\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u65e0\u9700\u76d1\u63a7</p> </li> <li> <p>IdleHandler\u7684queueIdle()\u56de\u8c03\u65b9\u6cd5\u4e5f\u65e0\u6cd5\u76d1\u63a7\u5230</p> </li> <li> <p>Touch\u4e8b\u4ef6\u5927\u90e8\u5206\u662f\u4ecenativePollOnce\u76f4\u63a5\u5230\u4e86InputEventReceiver\uff0c\u7136\u540e\u5230ViewRootImpl\u8fdb\u884c\u5206\u53d1</p> </li> <li> <p>\u8fd8\u6709\u4e00\u7c7b\u76f8\u5bf9\u5c11\u89c1\u7684\u95ee\u9898\u662fSyncBarrier\uff08\u540c\u6b65\u5c4f\u969c\uff09\u7684\u6cc4\u6f0f\u540c\u6837\u65e0\u6cd5\u88ab\u76d1\u63a7\u5230</p> </li> </ol> <p>\u7b2c\u4e00\u79cd\u60c5\u51b5\u6211\u4eec\u4e0d\u7528\u7ba1\uff0c\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u540e\u97623\u79cd\u60c5\u51b5\u4e0b\u5982\u4f55\u76d1\u63a7\u5361\u987f\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#43-idlehandler","title":"4.3 \u76d1\u63a7IdleHandler\u5361\u987f","text":"<p>IdleHandler \u7684 queueIdle() \u56de\u8c03\u65b9\u6cd5\u4f1a\u5728\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u7684\u65f6\u5019\u88ab\u8c03\u7528\u3002\u7136\u800c\u5b9e\u9645\u4e0a\uff0c\u5f88\u591a\u5f00\u53d1\u540c\u5b66\u90fd\u5148\u5165\u4e3a\u4e3b\u7684\u8ba4\u4e3a\u8fd9\u4e2a\u65f6\u5019\u53cd\u6b63\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\uff0c\u505a\u4e00\u4e9b\u8017\u65f6\u64cd\u4f5c\u4e5f\u6ca1\u6240\u8c13\u3002\u5176\u5b9e\u4e3b\u7ebf\u7a0bMessageQueue\u7684 queueIdle \u9ed8\u8ba4\u5f53\u7136\u4e5f\u662f\u6267\u884c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\uff0c\u6240\u4ee5\u8fd9\u91cc\u7684\u8017\u65f6\u64cd\u4f5c\u5176\u5b9e\u662f\u5f88\u5bb9\u6613\u5f15\u8d77\u5361\u987f\u548cANR\u7684\u3002</p> <p>IdleHandler\u4efb\u52a1\u6700\u7ec8\u4f1a\u88ab\u5b58\u50a8\u5230MessageQueue\u7684<code>mIdleHandlers</code> \uff08\u4e00\u4e2aArrayList\uff09\u4e2d\uff0c\u5728\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\uff0c\u4e5f\u5c31\u662fMessageQueue\u7684next\u65b9\u6cd5\u6682\u65f6\u6ca1\u6709message\u53ef\u4ee5\u53d6\u51fa\u6765\u7528\u65f6\uff0c\u4f1a\u4ece<code>mIdleHandlers</code> \u4e2d\u53d6\u51faIdleHandler\u4efb\u52a1\u8fdb\u884c\u6267\u884c\u3002\u90a3\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a<code>mIdleHandlers</code> \u66ff\u6362\u6210\u81ea\u5df1\u7684\uff0c\u91cd\u5199add\u65b9\u6cd5\uff0c\u6dfb\u52a0\u8fdb\u6765\u7684 <code>IdleHandler</code> \u7ed9\u5b83\u5305\u88c5\u4e00\u4e0b\uff0c\u5305\u88c5\u7684\u90a3\u4e2a\u7c7b\u5728\u6267\u884c <code>queueIdle</code> \u65f6\u8fdb\u884c\u8ba1\u65f6\uff0c\u8fd9\u6837\u6dfb\u52a0\u8fdb\u6765\u7684\u6bcf\u4e2a<code>IdleHandler</code>\u5728\u6267\u884c\u7684\u65f6\u5019\u6211\u4eec\u90fd\u80fd\u62ff\u5230\u5176 <code>queueIdle</code> \u7684\u6267\u884c\u65f6\u95f4 \u3002\u5982\u679c\u8d85\u65f6\u6211\u4eec\u5c31\u8fdb\u884c\u8bb0\u5f55\u6216\u8005\u4e0a\u62a5\u3002</p> <pre><code>private static void detectIdleHandler() {\ntry {\nMessageQueue mainQueue = Looper.getMainLooper().getQueue();\nField field = MessageQueue.class.getDeclaredField(\"mIdleHandlers\");\nfield.setAccessible(true);\nMyArrayList&lt;MessageQueue.IdleHandler&gt; myIdleHandlerArrayList = new MyArrayList&lt;&gt;();\nfield.set(mainQueue, myIdleHandlerArrayList);\n} catch (Throwable t) {\nt.printStackTrace();\n}\n}\nstatic class MyArrayList&lt;T&gt; extends ArrayList {\nMap&lt;MessageQueue.IdleHandler, MyIdleHandler&gt; map = new HashMap&lt;&gt;();\n@Override\npublic boolean add(Object o) {\nif (o instanceof MessageQueue.IdleHandler) {\nMyIdleHandler myIdleHandler = new MyIdleHandler((MessageQueue.IdleHandler) o);\nmap.put((MessageQueue.IdleHandler) o, myIdleHandler);\nreturn super.add(myIdleHandler);\n}\nreturn super.add(o);\n}\n@Override\npublic boolean remove(@Nullable Object o) {\nif (o instanceof MyIdleHandler) {\nMessageQueue.IdleHandler idleHandler = ((MyIdleHandler) o).idleHandler;\nmap.remove(idleHandler);\nreturn super.remove(o);\n} else {\nMyIdleHandler myIdleHandler = map.remove(o);\nif (myIdleHandler != null) {\nreturn super.remove(myIdleHandler);\n}\nreturn super.remove(o);\n}\n}\n}\n</code></pre>"},{"location":"perf-opt/Android/jank/jank-opt/#44-touchevent","title":"4.4 \u76d1\u63a7TouchEvent\u5361\u987f","text":"<p>\u4ece Input \u4e8b\u4ef6\u5206\u53d1\u673a\u5236\u53ef\u77e5\uff0c\u5927\u90e8\u5206Touch\u7684\u8c03\u7528\u6808\u5982\u4e0b\uff1a</p> <p>\u6709\u4e9btouch\u4e8b\u4ef6\u662f\u9700\u8981\u6279\u91cf\u5904\u7406(ViewRootImpl#ConsumeBatchedInputRunnable)\uff0c\u8fd9\u65f6\u4ea4\u7ed9Choreographer#CALLBACK_INPUT\u5904\u7406\uff0c \u8be6\u89c1 Batched consumption</p> <p></p> <p>\u4ece\u5806\u6808\u53ef\u89c1\uff0c <code>InputManagerService</code> \u901a\u8fc7 socket \u5c06 touch \u4e8b\u4ef6\u53d1\u5f80\u5e94\u7528\u8fdb\u7a0b\uff0c\u5e94\u7528\u8fdb\u7a0b\u6536\u5230\u540e\u4f1a\u5524\u9192\u4e3b\u7ebf\u7a0b\uff0c\u7136\u540e\u6267\u884c <code>InputEventReceiver#dispatchInputEvent()</code>\uff0c\u5e76\u4e0d\u4f1a\u7ee7\u7eed\u6267\u884c <code>MessageQueue#next</code>\u3002\u539f\u7406\u53c2\u89c1 https://juejin.cn/post/7032166333500686344</p> <p>InputReader\uff08\u8bfb\u53d6\u3001\u62e6\u622a\u3001\u8f6c\u6362\u8f93\u5165\u4e8b\u4ef6\uff09\u548cInputDispatcher\uff08\u5206\u53d1\u4e8b\u4ef6\uff09\u90fd\u662f\u8fd0\u884c\u5728<code>system_server</code>\u7cfb\u7edf\u8fdb\u7a0b\u4e2d\uff0c\u800c\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u81ea\u5df1\u7684\u5e94\u7528\u8fdb\u7a0b\u4e2d\uff0c\u8fd9\u91cc\u6d89\u53ca\u5230\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff0c\u8fd9\u91cc\u7684\u8de8\u8fdb\u7a0b\u901a\u4fe1\u7528\u7684\u975ebinder\u65b9\u5f0f\uff0c\u800c\u662f\u7528\u7684socket\u3002</p> <p></p> <p>InputDispatcher\u4f1a\u4e0e\u6211\u4eec\u7684\u5e94\u7528\u8fdb\u7a0b\u5efa\u7acb\u8fde\u63a5\uff0c\u5b83\u662fsocket\u7684\u670d\u52a1\u7aef\uff1b\u6211\u4eec\u5e94\u7528\u8fdb\u7a0b\u7684native\u5c42\u4f1a\u6709\u4e00\u4e2asocket\u7684\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u6d88\u606f\u540e\uff0c\u4f1a\u901a\u77e5\u6211\u4eec\u5e94\u7528\u8fdb\u7a0b\u91ccViewRootImpl\u521b\u5efa\u7684WindowInputEventReceiver\uff08\u7ee7\u627f\u81eaInputEventReceiver\uff09\u6765\u63a5\u6536\u8fd9\u4e2a\u8f93\u5165\u4e8b\u4ef6\u3002\u4e8b\u4ef6\u4f20\u9012\u4e5f\u5c31\u8d70\u901a\u4e86\uff0c\u540e\u9762\u5c31\u662f\u4e0a\u5c42\u7684View\u6811\u4e8b\u4ef6\u5206\u53d1\u4e86\u3002</p> <p>\u8fd9\u91cc\u4e3a\u5565\u7528socket\u800c\u4e0d\u7528binder</p> <p>Socket\u53ef\u4ee5\u5b9e\u73b0\u5f02\u6b65\u7684\u901a\u77e5\uff0c\u4e14\u53ea\u9700\u8981\u4e24\u4e2a\u7ebf\u7a0b\u53c2\u4e0e\uff08Pipe\u4e24\u7aef\u5404\u4e00\u4e2a\uff09\uff0c\u5047\u8bbe\u7cfb\u7edf\u6709N\u4e2a           \u5e94\u7528\u7a0b\u5e8f\uff0c\u8ddf\u8f93\u5165\u5904\u7406\u76f8\u5173\u7684\u7ebf\u7a0b\u6570\u76ee\u662fN+1\uff081\u662fInput Dispatcher\u7ebf\u7a0b\uff09\u3002\u7136\u800c\uff0c\u5982\u679c       \u7528Binder\u5b9e\u73b0\u7684\u8bdd\uff0c\u4e3a\u4e86\u5b9e\u73b0\u5f02\u6b65\u63a5\u6536\uff0c\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2aBinder\u7ebf\u7a0b\uff0c\u4e00     \u4e2a\u540e\u53f0\u5904\u7406\u7ebf\u7a0b\uff08\u4e0d\u80fd\u5728Binder\u7ebf\u7a0b\u91cc\u5904\u7406\u8f93\u5165\uff0c\u56e0\u4e3a\u8fd9\u6837\u592a\u8017\u65f6\uff0c\u5c06\u4f1a\u963b\u585e\u4f4f\u53d1\u5c04\u7aef\u7684\u8c03     \u7528\u7ebf\u7a0b\uff09\u3002\u5728\u53d1\u5c04\u7aef\uff0c\u540c\u6837\u9700\u8981\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u53d1\u9001\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u63a5\u6536\u7ebf\u7a0b\u6765\u63a5\u6536\u5e94\u7528\u7684\u5b8c\u6210\u901a     \u77e5\uff0c\u6240\u4ee5\uff0cN\u4e2a\u5e94\u7528\u7a0b\u5e8f\u9700\u89812\uff08N+1\uff09\u4e2a\u7ebf\u7a0b\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0cSocket\u8fd8\u662f\u9ad8\u6548\u591a\u4e86\u3002</p> <p>\u6709\u4e86\u4e0a\u9762\u7684\u77e5\u8bc6\u94fa\u57ab\uff0c\u73b0\u5728\u56de\u5230\u6211\u4eec\u7684\u4e3b\u95ee\u9898\u4e0a\u6765\uff0c\u5982\u4f55\u76d1\u63a7TouchEvent\u5361\u987f\u3002\u65e2\u7136\u5b83\u4eec\u662f\u7528socket\u6765\u8fdb\u884c\u901a\u4fe1\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7PLT Hook\uff0c\u53bbHook\u8fd9\u5bf9socket\u7684\u53d1\u9001\uff08send\uff09\u548c\u63a5\u6536(recv)\u65b9\u6cd5\uff0c\u4ece\u800c\u76d1\u63a7Touch\u4e8b\u4ef6\u3002\u5f53\u8c03\u7528\u5230\u4e86recvfrom\u65f6\uff08send\u548crecv\u6700\u7ec8\u4f1a\u8c03\u7528<code>sendto</code>\u548c<code>recvfrom</code>\uff0c\u8fd92\u4e2a\u51fd\u6570\u7684\u5177\u4f53\u5b9a\u4e49\u5728socket.h\u6e90\u7801\uff09\uff0c\u8bf4\u660e\u6211\u4eec\u7684\u5e94\u7528\u63a5\u6536\u5230\u4e86Touch\u4e8b\u4ef6\uff0c\u5f53\u8c03\u7528\u5230\u4e86sendto\u65f6\uff0c\u8bf4\u660e\u8fd9\u4e2aTouch\u4e8b\u4ef6\u5df2\u7ecf\u88ab\u6210\u529f\u6d88\u8d39\u6389\u4e86\uff0c\u5f53\u4e24\u8005\u7684\u65f6\u95f4\u76f8\u5dee\u8fc7\u5927\u65f6\u5373\u8bf4\u660e\u4ea7\u751f\u4e86\u4e00\u6b21Touch\u4e8b\u4ef6\u7684\u5361\u987f\u3002</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-opt/#44-syncbarrier","title":"4.4. \u76d1\u63a7SyncBarrier\u6cc4\u6f0f","text":"<p>\u5f53\u6211\u4eec\u6bcf\u6b21\u901a\u8fc7invalidate\u6765\u5237\u65b0UI\u65f6\uff0c\u6700\u7ec8\u90fd\u4f1a\u8c03\u7528\u5230 ViewRootImpl \u4e2d\u7684 scheduleTraversals \u65b9\u6cd5\uff0c\u4f1a\u5411\u4e3b\u7ebf\u7a0b\u7684Looper\u4e2dpost\u4e00\u4e2aSyncBarrier\uff0c\u5176\u76ee\u7684\u662f\u4e3a\u4e86\u5728\u5237\u65b0UI\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u7684\u540c\u6b65\u6d88\u606f\u90fd\u88ab\u8df3\u8fc7\uff0c\u6b64\u65f6\u6e32\u67d3UI\u7684\u5f02\u6b65\u6d88\u606f\u5c31\u53ef\u4ee5\u5f97\u5230\u4f18\u5148\u5904\u7406\u3002\u4f46\u662f\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u4e2a\u65b9\u6cd5\u662f \u7ebf\u7a0b\u4e0d\u5b89\u5168 \u7684\uff0c\u5982\u679c\u5728\u975e\u4e3b\u7ebf\u7a0b\u4e2d\u8c03\u7528\u5230\u4e86\u8fd9\u91cc\uff0c\u5c31\u6709\u53ef\u80fd\u4f1a\u540c\u65f6post\u591a\u4e2aSyncBarrier\uff0c\u4f46 \u53ea\u80fdremove\u6389\u6700\u540e\u4e00\u4e2a\uff0c\u4ece\u800c\u6709\u4e00\u4e2aSyncBarrier\u5c31\u6c38\u8fdc\u65e0\u6cd5\u88abremove\uff0c\u5c31\u5bfc\u81f4\u4e86\u4e3b\u7ebf\u7a0bLooper\u65e0\u6cd5\u5904\u7406\u540c\u6b65\u6d88\u606f\uff08Message\u9ed8\u8ba4\u5c31\u662f\u540c\u6b65\u6d88\u606f\uff09\uff0c\u5bfc\u81f4\u5361\u6b7b\u3002\u5f53\u7136\uff0c\u8fd9\u79cd\u60c5\u51b5\u8fd8\u662f\u6bd4\u8f83\u5c11\u89c1\u7684\u3002</p> <pre><code>void scheduleTraversals() {\nif (!mTraversalScheduled) {\nmTraversalScheduled = true;\nmTraversalBarrier = mHandler.getLooper().getQueue().postSyncBarrier();\nmChoreographer.postCallback(\nChoreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);\nnotifyRendererOfFramePending();\npokeDrawLockIfNeeded();\n}\n}\nvoid unscheduleTraversals() {\nif (mTraversalScheduled) {\nmTraversalScheduled = false;\nmHandler.getLooper().getQueue().removeSyncBarrier(mTraversalBarrier);\nmChoreographer.removeCallbacks(\nChoreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);\n}\n}\n</code></pre> <p>\u5173\u4e8eSyncBarrier\u5177\u4f53\u539f\u7406\u53c2\u89c1\u540c\u6b65\u5c4f\u969c</p> <p>\u6709\u4ec0\u4e48\u597d\u529e\u6cd5\u80fd\u76d1\u63a7\u5230\u8fd9\u79cd\u60c5\u51b5\u5417\uff08\u867d\u7136\u8fd9\u79cd\u60c5\u51b5\u6bd4\u8f83\u5c11\u89c1\uff09\uff1a</p> <ol> <li>\u5f00\u4e2a\u5b50\u7ebf\u7a0b\uff0c\u8f6e\u8be2\u68c0\u67e5\u4e3b\u7ebf\u7a0b\u7684MessageQueue\u91cc\u9762\u7684message\uff0c\u68c0\u67e5\u662f\u5426\u6709\u540c\u6b65\u5c4f\u969c\u6d88\u606f\u7684when\u5df2\u7ecf\u8fc7\u53bb\u4e86\u5f88\u4e45\u4e86\uff0c\u4f46\u8fd8\u6ca1\u5f97\u5230\u79fb\u9664</li> <li>\u6b64\u65f6\u53ef\u4ee5\u5408\u7406\u6000\u7591\u8be5\u540c\u6b65\u5c4f\u969c\u6d88\u606f\u53ef\u80fd\u5df2\u6cc4\u9732\uff0c\u4f46\u8fd8\u4e0d\u80fd\u786e\u5b9a\uff08\u6709\u53ef\u80fd\u662f\u4e3b\u7ebf\u7a0b\u5361\u987f\uff0c\u5bfc\u81f4\u6ca1\u6709\u53ca\u65f6\u79fb\u9664\uff09</li> <li>\u8fd9\u4e2a\u65f6\u5019\uff0c\u5f80\u4e3b\u7ebf\u7a0b\u53d1\u4e00\u4e2a\u540c\u6b65\u6d88\u606f\u548c\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\uff08\u53ef\u4ee5\u95f4\u9694\u5730\u591a\u53d1\u51e0\u6b21\uff0c\u589e\u52a0\u53ef\u4fe1\u5ea6\uff09\uff0c\u5982\u679c\u540c\u6b65\u6d88\u606f\u6ca1\u6709\u5f97\u5230\u6267\u884c\uff0c\u4f46\u5f02\u6b65\u6d88\u606f\u5f97\u5230\u6267\u884c\u4e86\uff0c\u8fd9\u8bf4\u660e\u4ec0\u4e48\uff1f\u8bf4\u660e\u4e3b\u7ebf\u7a0b\u6709\u5904\u7406\u6d88\u606f\u7684\u80fd\u529b\uff0c\u4e0d\u5361\u987f\uff0c\u4e14\u4e3b\u7ebf\u7a0b\u7684MessageQueue\u4e2d\u6709\u4e00\u4e2a\u540c\u6b65\u5c4f\u969c\u4e00\u76f4\u6ca1\u5f97\u5230\u79fb\u9664\uff0c\u6240\u4ee5\u540c\u6b65\u6d88\u606f\u624d\u6ca1\u5f97\u5230\u6267\u884c\uff0c\u800c\u5f02\u6b65\u6d88\u606f\u5f97\u5230\u6267\u884c\u4e86\u3002</li> <li>\u6b64\u65f6\uff0c\u53ef\u4ee5\u6fc0\u8fdb\u4e00\u70b9\uff0c\u6211\u4eec\u751a\u81f3\u53ef\u4ee5\u53cd\u5c04\u8c03\u7528 MessageQueue \u7684 removeSyncBarrier \u65b9\u6cd5\uff0c\u624b\u52a8\u628a\u8fd9\u4e2aSyncBarrier\u79fb\u9664\u6389\uff0c\u4ece\u800c\u4ece\u9519\u8bef\u72b6\u6001\u4e2d\u6062\u590d\u3002</li> </ol> <p>\u6838\u5fc3\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>MessageQueue mainQueue = Looper.getMainLooper().getQueue();\nField field = mainQueue.getClass().getDeclaredField(\"mMessages\");\nfield.setAccessible(true);\nMessage mMessage = (Message) field.get(mainQueue);  //\u901a\u8fc7\u53cd\u5c04\u5f97\u5230\u5f53\u524d\u6b63\u5728\u7b49\u5f85\u6267\u884c\u7684Message\nif (mMessage != null) {\ncurrentMessageToString = mMessage.toString();\nlong when = mMessage.getWhen() - SystemClock.uptimeMillis();\nif (when &lt; -3000 &amp;&amp; mMessage.getTarget() == null) { //target == null\u5219\u4e3async barrier\nint token = mMessage.arg1;\nstartCheckLeaking(token);\n}\n}\nprivate static void startCheckLeaking(int token) {\nint checkCount = 0;\nbarrierCount = 0;\nwhile (checkCount &lt; CHECK_STRICTLY_MAX_COUNT) {\ncheckCount++;\nint latestToken = getSyncBarrierToken();\nif (token != latestToken) {     //token\u53d8\u4e86\uff0c\u4e0d\u662f\u540c\u4e00\u4e2abarrier\uff0creturn\nbreak;\n}\nif (DetectSyncBarrierOnce()) {\n//\u53d1\u751f\u4e86sync barrier\u6cc4\u6f0f\nremoveSyncBarrier(token);   //\u624b\u52a8remove\u6cc4\u6f0f\u7684sync barrier\nbreak;\n}\ntry {\nThread.sleep(1000);\n} catch (InterruptedException e) {\ne.printStackTrace();\n}\n}\n}\nprivate static void removeSyncBarrier(int token) {\nMessageQueue mainQueue = Looper.getMainLooper().getQueue();\nMethod method = mainQueue.getClass().getDeclaredMethod(\"removeSyncBarrier\", int.class);\nmethod.setAccessible(true);\nmethod.invoke(mainQueue, token);\n}\nprivate static boolean DetectSyncBarrierOnce() {\nHandler mainHandler = new Handler(Looper.getMainLooper()) {\n@Override\npublic void handleMessage(Message msg) {\nsuper.handleMessage(msg);\nif (msg.arg1 == 0) {\nbarrierCount ++;    //\u6536\u5230\u4e86\u5f02\u6b65\u6d88\u606f\uff0ccount++\n} else if (msg.arg1 == 1) {\nbarrierCount = 0;   //\u6536\u5230\u4e86\u540c\u6b65\u6d88\u606f\uff0c\u8bf4\u660e\u540c\u6b65\u5c4f\u969c\u4e0d\u5728, count\u8bbe\u7f6e\u4e3a0\n}\n}\n};\nMessage asyncMessage = Message.obtain();\nasyncMessage.setAsynchronous(true);\nasyncMessage.setTarget(mainHandler);\nasyncMessage.arg1 = 0;\nMessage syncNormalMessage = Message.obtain(); syncNormalMessage.arg1 = 1;\nmainHandler.sendMessage(asyncMessage);      //\u53d1\u9001\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\nmainHandler.sendMessage(syncNormalMessage); //\u53d1\u9001\u4e00\u4e2a\u540c\u6b65\u6d88\u606f\nif(barrierCount &gt; 3){\nreturn true;\n}\nreturn false;\n}\n</code></pre> <p>\u574f\u6d88\u606f\u662f\uff0c\u8fd9\u79cd\u65b9\u6848\u53ea\u80fd\u76d1\u63a7\u5230\u95ee\u9898\u7684\u4ea7\u751f\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u89e3\u51b3\u95ee\u9898\uff0c\u4f46\u662f\u65e0\u6cd5\u6eaf\u6e90\u95ee\u9898\u7a76\u7adf\u662f\u54ea\u4e2aView\u5bfc\u81f4\u7684\u3002</p>"},{"location":"perf-opt/Android/jank/jank-opt/#5","title":"5. \u53c2\u8003","text":"<p>Android \u9ad8\u624b\u8bfe</p> <p>Systrace \u6d41\u7545\u6027\u5b9e\u6218</p> <p>Matrix TraceCanary -- \u521d\u604b\u00b7\u5361\u987f</p> <p>\u5fae\u4fe1Android\u5ba2\u6237\u7aef\u7684\u5361\u987f\u76d1\u63a7\u65b9\u6848</p>"},{"location":"perf-opt/Android/jank/jank-principle/","title":"Android\u5361\u987f\u6389\u5e27\u95ee\u9898\u5206\u6790\u4e4b\u539f\u7406\u7bc7","text":"<p>\u5f53\u7528\u6237\u62b1\u6028\u624b\u673a\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5b58\u5728\u5361\u987f\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4f1a\u4e25\u91cd\u5f71\u54cd\u7528\u6237\u5bf9\u624b\u673a\u54c1\u724c\u7684\u597d\u611f\u548c\u5e94\u7528<code>APP</code>\u7684\u4f53\u9a8c\uff0c\u4ece\u800c\u5bfc\u81f4\u7528\u6237\u5bf9\u624b\u673a\u54c1\u724c\u7684\u5fe0\u8bda\u5ea6\u964d\u4f4e\u6216\u5e94\u7528<code>APP</code>\u7684\u88c5\u673a\u7559\u5b58\u7387\u4e0b\u964d\u3002\u6240\u4ee5\u65e0\u8bba\u662f\u624b\u673a\u8bbe\u5907\u5382\u5546\u8fd8\u662f\u5e94\u7528<code>APP</code>\u5f00\u53d1\u8005\uff0c\u53c8\u6216\u662f<code>Android</code>\u7cfb\u7edf\u7684\u7ef4\u62a4\u8005<code>Google</code>\u90fd\u4f1a\u5bf9\u754c\u9762\u5361\u987f\u95ee\u9898\u975e\u5e38\u91cd\u89c6\uff0c\u4f1a\u5c06\u754c\u9762\u7684\u6d41\u7545\u5ea6\u4f5c\u4e3a\u6838\u5fc3\u6027\u80fd\u4f53\u9a8c\u6307\u6807\u8fdb\u884c\u6301\u7eed\u7684\u4f18\u5316\u3002\u8bf4\u5230\u6d41\u7545\u5ea6\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u8981\u89e3\u51b3\u7528\u6237\u64cd\u4f5c\u624b\u673a\u8fc7\u7a0b\u4e2d\u7684\u754c\u9762\u4e22\u5e27\u95ee\u9898\uff0c\u672c\u6765\u4e00\u79d2\u949f\u5c4f\u5e55\u4e0a\u9700\u8981\u66f4\u65b0<code>60</code>\u5e27\u753b\u9762\uff0c\u4f46\u662f\u7531\u4e8e\u79cd\u79cd\u539f\u56e0\uff0c\u8fd9\u671f\u95f4\u5c4f\u5e55\u4e0a\u53ea\u66f4\u65b0\u4e86<code>55</code>\u5e27\u753b\u9762\uff0c\u8fd9\u5c31\u662f\u51fa\u73b0\u4e22\u5e27\uff0c\u5728\u7528\u6237\u4e3b\u89c2\u8089\u773c\u770b\u6765\u5c31\u662f\u611f\u77e5\u5361\u987f\u3002\u90a3\u4e48\u5f53\u51fa\u73b0\u4e86\u4e22\u5e27\u5361\u987f\u7684\u95ee\u9898\u65f6\uff0c\u6211\u4eec\u8be5\u5982\u4f55\u7740\u624b\u53bb\u5206\u6790\u4e0e\u4f18\u5316\u89e3\u51b3\u5462\uff1f</p> <p>\u5728\u5206\u6790\u4efb\u4f55\u95ee\u9898\u4e4b\u524d\uff0c\u6211\u4eec\u90fd\u9700\u8981\u5148\u5f04\u6e05\u695a\u5176\u57fa\u672c\u539f\u7406\uff0c\u4e5f\u5c31\u662f\u8981\u638c\u63e1\u4e86\u8fd9\u4e2a\u201c\u9053\u201d\uff0c\u624d\u80fd\u771f\u6b63\u7740\u624b\u53bb\u5206\u6790\u95ee\u9898\uff0c\u5426\u8005\u53ea\u80fd\u662f\u5f04\u5f97\u4e00\u5934\u96fe\u6c34\uff0c\u4e5f\u6ca1\u6cd5\u771f\u6b63\u7684\u7406\u89e3\u548c\u89e3\u51b3\u95ee\u9898\u3002\u6240\u4ee5\u8981\u60f3\u5206\u6790\u5e76\u89e3\u51b3\u754c\u9762\u6389\u5e27\u5361\u987f\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u5148\u9700\u8981\u77e5\u9053\u5728<code>Android</code>\u7cfb\u7edf\u4e0a\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u5230\u5e95\u662f\u5982\u4f55\u5b8c\u6210\u4e00\u5e27\u753b\u9762\u7684\u4e0a\u5e27\u663e\u793a\u52a8\u4f5c\u7684\u3002\u7531\u4e8e\u5927\u90e8\u5206\u5e94\u7528\u754c\u9762\u7684\u4e0a\u5e27\u66f4\u65b0\u753b\u9762\u52a8\u4f5c\u90fd\u662f\u7531\u7528\u6237\u624b\u6307\u89e6\u6478\u5c4f\u5e55\u800c\u89e6\u53d1\uff0c\u6240\u4ee5\u672c\u6587\u4ee5\u624b\u6307\u4e0a\u4e0b\u6ed1\u52a8\u5e94\u7528\u754c\u9762\u7684\u64cd\u4f5c\u573a\u666f\u4e3a\u4f8b\uff0c\u7ed3\u5408<code>Systrace</code>\u5206\u6790\u4e00\u4e0b<code>Android</code>\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u539f\u7406\u3002</p>"},{"location":"perf-opt/Android/jank/jank-principle/#1-input","title":"1 Input\u4e8b\u4ef6\u5904\u7406\u673a\u5236","text":""},{"location":"perf-opt/Android/jank/jank-principle/#11","title":"1.1 \u7cfb\u7edf\u673a\u5236\u5206\u6790","text":"<p><code>Android</code> \u7cfb\u7edf\u662f\u7531\u4e8b\u4ef6\u9a71\u52a8\u7684\uff0c\u800c <code>Input</code> \u662f\u6700\u5e38\u89c1\u7684\u4e8b\u4ef6\u4e4b\u4e00\uff0c\u7528\u6237\u7684\u70b9\u51fb\u3001\u6ed1\u52a8\u3001\u957f\u6309\u7b49\u64cd\u4f5c\uff0c\u90fd\u5c5e\u4e8e <code>Input</code> \u4e8b\u4ef6\u9a71\u52a8\uff0c\u5176\u4e2d\u7684\u6838\u5fc3\u5c31\u662f <code>InputReader</code> \u548c <code>InputDispatcher</code>\u3002<code>InputReader</code> \u548c <code>InputDispatcher</code> \u662f\u8dd1\u5728 <code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684\u4e24\u4e2a <code>Native</code>\u5faa\u73af\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u8bfb\u53d6\u548c\u5206\u53d1 <code>Input</code> \u4e8b\u4ef6\u3002\u6574\u4e2a\u5904\u7406\u8fc7\u7a0b\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u89e6\u6478\u5c4f\u4f1a\u6309\u7167\u5c4f\u5e55\u786c\u4ef6\u7684\u89e6\u63a7\u91c7\u6837\u7387\u5468\u671f\uff0c\u6bcf\u9694\u51e0\u6beb\u79d2\u626b\u63cf\u4e00\u6b21\uff0c\u5982\u679c\u6709\u89e6\u63a7\u4e8b\u4ef6\u5c31\u4f1a\u4e0a\u62a5\u5230\u5bf9\u5e94\u7684\u8bbe\u5907\u9a71\u52a8\uff1b\u7cfb\u7edf\u5c01\u88c5\u4e86\u4e00\u4e2a\u53eb<code>EventHub</code>\u7684\u5bf9\u8c61\uff0c\u5b83\u5229\u7528<code>inotify</code>\u548c<code>epoll</code>\u673a\u5236\u76d1\u542c<code>/dev/input</code>\u76ee\u5f55\u4e0b\u7684<code>input</code>\u8bbe\u5907\u9a71\u52a8\u8282\u70b9\uff0c\u901a\u8fc7<code>EventHub</code>\u7684<code>getEvents</code>\u63a5\u53e3\u5c31\u53ef\u4ee5\u76d1\u542c\u5e76\u83b7\u53d6\u5230<code>Input</code>\u4e8b\u4ef6\uff1b</li> <li><code>InputReader</code>\u8d1f\u8d23\u4ece<code>EventHub</code>\u91cc\u9762\u628a<code>Input</code>\u4e8b\u4ef6\u8bfb\u53d6\u51fa\u6765\uff0c\u7136\u540e\u4ea4\u7ed9 <code>InputDispatcher</code> \u8fdb\u884c\u4e8b\u4ef6\u5206\u53d1\uff1b</li> <li><code>InputDispatcher</code>\u5728\u62ff\u5230 <code>InputReader</code>\u83b7\u53d6\u7684\u4e8b\u4ef6\u4e4b\u540e\uff0c\u5bf9\u4e8b\u4ef6\u8fdb\u884c\u5305\u88c5\u540e\uff0c\u5bfb\u627e\u5e76\u5206\u53d1\u5230\u76ee\u6807\u7a97\u53e3;</li> <li><code>InboundQueue</code>\u961f\u5217\uff08<code>\u201ciq\u201d</code>\uff09\u4e2d\u653e\u7740<code>InputDispatcher</code>\u4ece<code>InputReader</code>\u4e2d\u62ff\u5230\u7684<code>input</code>\u4e8b\u4ef6\uff1b</li> <li><code>OutboundQueue</code>\uff08<code>\u201coq\u201d</code>\uff09\u961f\u5217\u91cc\u9762\u653e\u7684\u662f\u5373\u5c06\u8981\u88ab\u6d3e\u53d1\u7ed9\u5404\u4e2a\u76ee\u6807\u7a97\u53e3<code>App</code>\u7684\u4e8b\u4ef6\uff1b</li> <li><code>WaitQueue</code>\u961f\u5217\u91cc\u9762\u8bb0\u5f55\u7684\u662f\u5df2\u7ecf\u6d3e\u53d1\u7ed9 <code>App</code>\uff08<code>\u201cwq\u201d</code>\uff09\uff0c\u4f46\u662f <code>App</code>\u8fd8\u5728\u5904\u7406\u6ca1\u6709\u8fd4\u56de\u5904\u7406\u6210\u529f\u7684\u4e8b\u4ef6\uff1b</li> <li><code>PendingInputEventQueue</code>\u961f\u5217\uff08\u201caq\u201d\uff09\u4e2d\u8bb0\u5f55\u7684\u662f\u5e94\u7528\u9700\u8981\u5904\u7406\u7684<code>Input</code>\u4e8b\u4ef6\uff0c\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230<code>input</code>\u4e8b\u4ef6\u5df2\u7ecf\u4f20\u9012\u5230\u4e86\u5e94\u7528\u8fdb\u7a0b\uff1b</li> <li><code>deliverInputEvent</code> \u6807\u8bc6 <code>App</code> <code>UI Thread</code> \u88ab <code>Input</code> \u4e8b\u4ef6\u5524\u9192\uff1b</li> <li><code>InputResponse</code> \u6807\u8bc6 <code>Input</code> \u4e8b\u4ef6\u533a\u57df\uff0c\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a <code>Input_Down</code> \u4e8b\u4ef6 + \u82e5\u5e72\u4e2a <code>Input_Move</code> \u4e8b\u4ef6 + \u4e00\u4e2a <code>Input_Up</code> \u4e8b\u4ef6\u7684\u5904\u7406\u9636\u6bb5\u90fd\u88ab\u7b97\u5230\u4e86\u8fd9\u91cc\uff1b</li> <li><code>App</code> \u54cd\u5e94\u5904\u7406<code>Input</code> \u4e8b\u4ef6\uff0c\u5185\u90e8\u4f1a\u5728\u5176\u754c\u9762<code>View</code>\u6811\u4e2d\u9010\u5c42\u5206\u53d1\u548c\u5904\u7406\u3002</li> </ol> <p>\u7528\u4e00\u5f20\u56fe\u63cf\u8ff0\u6574\u4e2a\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b\uff08\u5173\u4e8e\u8fd9\u90e8\u5206\u8be6\u7ec6\u7684<code>Android</code>\u7cfb\u7edf\u6e90\u7801\u5b9e\u73b0\u6d41\u7a0b\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0https://juejin.cn/post/6956500920108580878\uff09\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#12-systrace","title":"1.2 \u7ed3\u5408Systrace\u5206\u6790","text":"<p>\u4ece\u4e0a\u9762\u7684\u7cfb\u7edf\u673a\u5236\u7684\u5206\u6790\u53ef\u4ee5\u770b\u51fa\uff0c\u6574\u4e2a<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u7684\u5206\u53d1\u4e0e\u5904\u7406\u4e3b\u8981\u6d89\u53ca\u5230\u4e24\u4e2a\u8fdb\u7a0b\uff1a\u4e00\u4e2a\u662f<code>system_server</code>\u7cfb\u7edf\u8fdb\u7a0b\uff0c\u53e6\u4e00\u4e2a\u662f\u5f53\u524d\u7126\u70b9\u7a97\u53e3\u6240\u5c5e\u7684<code>Setting</code>\u5e94\u7528\u8fdb\u7a0b\u3002</p> <p>\u4e00\u3001<code>system_server</code>\u8fdb\u7a0b\u7684\u5904\u7406\u8fc7\u7a0b\uff1a</p> <ol> <li> <p>\u5f53\u7528\u6237\u624b\u6307\u5728<code>Setting</code>\u5e94\u7528\u754c\u9762\u6ed1\u52a8\u65f6\uff0c\u7cfb\u7edf<code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684<code>native</code>\u7ebf\u7a0b<code>InputReader</code>\u4f1a\u4ece<code>EventHub</code>\u4e2d\u8bfb\u53d6\u5176\u5229\u7528<code>linux</code>\u7684<code>epoll</code>\u673a\u5236\u76d1\u542c\u5230\u7684\u5c4f\u5e55\u9a71\u52a8\u4e0a\u62a5\u7684<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\uff0c\u7136\u540e\u5524\u9192\u53e6\u5916\u4e00\u6761native\u7ebf\u7a0b<code>InputDispatcher</code>\u8d1f\u8d23\u8fdb\u884c\u4e8b\u4ef6\u7684\u8fdb\u4e00\u6b65\u5206\u53d1\u5904\u7406\u3002</p> </li> <li> <p><code>InputDispatcher</code>\u88ab\u5524\u9192\u540e\u4f1a\u5148\u5c06\u4e8b\u4ef6\u653e\u5230<code>InboundQueue</code>\u961f\u5217\uff08\u4e5f\u5c31\u662f<code>Systrace</code>\u4e0a\u770b\u5230\u7684\u201c<code>iq\u201d</code>\u961f\u5217\uff09\u4e2d\uff0c\u7136\u540e\u627e\u5230\u5177\u4f53\u5904\u7406\u6b64<code>input</code>\u4e8b\u4ef6\u7684\u5e94\u7528\u76ee\u6807\u7a97\u53e3\uff0c\u5e76\u5c06<code>Input</code>\u4e8b\u4ef6\u653e\u5165\u5bf9\u5e94\u7684\u5e94\u7528\u76ee\u6807\u7a97\u53e3\u7684<code>OutboundQueue</code>\u961f\u5217\uff08\u4e5f\u5c31\u662f<code>Systrace</code>\u4e0a\u770b\u5230\u7684<code>\u201coq\u201d</code>\u961f\u5217\uff09\u4e2d\uff0c\u7b49\u5f85\u8fdb\u4e00\u6b65\u901a\u8fc7<code>SocketPair</code>\u53cc\u5de5\u4fe1\u9053\u53d1\u9001<code>input</code>\u4e8b\u4ef6\u5230\u5e94\u7528\u76ee\u6807\u7a97\u53e3\u4e2d\uff1b</p> </li> <li> <p>\u6700\u540e\u5f53\u4e8b\u4ef6\u53d1\u9001\u7ed9\u5177\u4f53\u7684\u5e94\u7528\u76ee\u6807\u7a97\u53e3\u540e\uff0c\u4f1a\u5c06\u4e8b\u4ef6\u79fb\u52a8\u5230<code>WaitQueue</code>\u961f\u5217\u4e2d\uff08\u4e5f\u5c31\u662f<code>Systrace</code>\u4e0a\u770b\u5230\u7684<code>\u201cwq\u201d</code>\u961f\u5217\uff09\u5e76\u4e00\u76f4\u7b49\u5f85\u6536\u5230\u5230\u76ee\u6807\u5e94\u7528\u5904\u7406<code>Input</code>\u4e8b\u4ef6\u5b8c\u6210\u540e\u7684\u53cd\u9988\u540e\u518d\u4ece\u961f\u5217\u4e2d\u79fb\u9664\uff0c\u5982\u679c5\u79d2\u5185\u6ca1\u6709\u6536\u5230\u76ee\u6807\u5e94\u7528\u7a97\u53e3\u5904\u7406\u5b8c\u6210\u6b64\u6b21<code>Input</code>\u4e8b\u4ef6\u7684\u53cd\u9988\uff0c\u5c31\u4f1a\u62a5\u8be5\u5e94\u7528ANR\u5f02\u5e38\u4e8b\u4ef6\u3002\u4ee5\u4e0a\u6574\u4e2a\u8fc7\u7a0b\u5728<code>Android</code>\u7cfb\u7edf<code>AOSP</code>\u6e90\u7801\u4e2d\u90fd\u52a0\u6709\u76f8\u5e94\u7684<code>Systrace tag</code>\uff0c\u5982\u4e0b<code>Systrace</code>\u622a\u56fe\u6240\u793a\uff1a</p> </li> </ol> <p></p> <p>\u4e8c\u3001\u5e94\u7528\u8fdb\u7a0b\u7684\u5904\u7406\u8fc7\u7a0b\uff1a\u5f53<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u901a\u8fc7<code>socket</code>\u4f20\u9012\u5230<code>Settings</code>\u5e94\u7528\u8fdb\u7a0b\u8fd9\u8fb9\u540e\uff0c\u4f1a\u5524\u9192\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u5728<code>ViewRootImpl#deliverInputEvent</code>\u7684\u6d41\u7a0b\u4e2d\u8fdb\u884c<code>Input</code>\u4e8b\u4ef6\u7684\u5177\u4f53\u5206\u53d1\u4e0e\u5904\u7406\u3002\u5177\u4f53\u7684\u5904\u7406\u6d41\u7a0b\uff1a</p> <ol> <li> <p>\u5148\u4ea4\u7ed9\u4e4b\u524d\u5728\u6dfb\u52a0\u5e94\u7528<code>PhoneWindow</code>\u7a97\u53e3\u65f6\u7684<code>ViewRootImpl#setView</code>\u6d41\u7a0b\u4e2d\u521b\u5efa\u7684\u591a\u4e2a\u4e0d\u540c\u7c7b\u578b\u7684<code>InputUsage</code>\u4e2d\u4f9d\u6b21\u8fdb\u884c\u5904\u7406\uff08\u6bd4\u5982\u5bf9\u8f93\u5165\u6cd5\u5904\u7406\u903b\u8f91\u7684\u5c01\u88c5<code>ImeInputUsage</code>\uff0c\u67d0\u4e9b<code>key</code>\u7c7b\u578b\u7684<code>Input</code>\u4e8b\u4ef6\u4f1a\u7531\u5b83\u5148\u4ea4\u7ed9\u8f93\u5165\u6cd5\u8fdb\u7a0b\u5904\u7406\u5b8c\u540e\u518d\u4ea4\u7ed9\u5e94\u7528\u7a97\u53e3\u7684<code>InputUsage</code>\u5904\u7406\uff09\uff0c\u6574\u4e2a\u5904\u7406\u6d41\u7a0b\u662f\u6309\u7167\u8d23\u4efb\u94fe\u7684\u8bbe\u8ba1\u6a21\u5f0f\u8fdb\u884c\uff1b</p> </li> <li> <p>\u6700\u540e\u4f1a\u4ea4\u7ed9\u8d1f\u8d23\u5e94\u7528\u7a97\u53e3<code>Input</code>\u4e8b\u4ef6\u5206\u53d1\u5904\u7406\u7684<code>ViewPostImeInputUsage</code>\u4e2d\u5177\u4f53\u5904\u7406\uff0c\u8fd9\u91cc\u9762\u4f1a\u4ece<code>View</code>\u5e03\u5c40\u6811\u7684\u6839\u8282\u70b9<code>DecorView</code>\u5f00\u59cb\u904d\u5386\u6574\u4e2a<code>View</code>\u6811\u4e0a\u7684\u6bcf\u4e00\u4e2a\u5b50<code>View</code>\u6216<code>ViewGroup</code>\u63a7\u4ef6\u6267\u884c\u4e8b\u4ef6\u7684\u5206\u53d1\u3001\u62e6\u622a\u3001\u5904\u7406\u7684\u903b\u8f91\uff1b</p> </li> <li> <p>\u6700\u540e\u89e6\u63a7\u4e8b\u4ef6\u5904\u7406\u5b8c\u6210\u540e\u4f1a\u8c03\u7528<code>finishInputEvent</code>\u7ed3\u675f\u5e94\u7528\u5bf9\u89e6\u63a7\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\uff0c\u8fd9\u91cc\u9762\u4f1a\u901a\u8fc7<code>JNI</code>\u8c03\u7528\u5230<code>native</code>\u5c42<code>InputConsumer</code>\u7684<code>sendFinishedSignal</code>\u51fd\u6570\u4e2d\u901a\u8fc7socket\u6d88\u606f\u901a\u77e5\u7cfb\u7edf\u6846\u67b6\u4e2d\u7684<code>InputDispatcher</code>\u8be5<code>Input</code>\u4e8b\u4ef6\u5904\u7406\u5b8c\u6210\uff0c\u89e6\u53d1\u4ece<code>\"wq\"</code>\u961f\u5217\u4e2d\u53ca\u65f6\u79fb\u9664\u5f85\u5904\u7406\u4e8b\u4ef6\u4ee5\u514d\u62a5<code>ANR</code>\u5f02\u5e38\u3002</p> </li> <li> <p>\u4e00\u6b21\u6ed1\u52a8\u8fc7\u7a0b\u7684\u89e6\u63a7\u4ea4\u4e92\u7684<code>InputResponse</code>\u533a\u57df\u4e2d\u4e00\u822c\u4f1a\u5305\u542b\u4e00\u4e2a<code>Input</code>\u7684<code>ACTION_DOWN</code>\u4e8b\u4ef6+\u591a\u4e2a<code>ACTION_MOVE</code>\u4e8b\u4ef6+\u4e00\u4e2a<code>ACTION_UP</code>\u4e8b\u4ef6\uff0c<code>Settings</code>\u5e94\u7528\u754c\u9762\u4e2d\u7684\u76f8\u5173<code>View</code>\u63a7\u4ef6\u5728\u6536\u5230\u591a\u4e2a<code>ACTION_MOVE</code>\u89e6\u63a7\u4e8b\u4ef6\u540e\uff0c\u7ecf\u8fc7\u5224\u65ad\u4e3a\u7528\u6237\u624b\u6307\u6ed1\u52a8\u884c\u4e3a\uff0c\u4e00\u822c\u4f1a\u8c03\u7528<code>View#invalidate</code>\u7b49\u76f8\u5173\u63a5\u53e3\u89e6\u53d1<code>UI</code>\u7ebf\u7a0b\u7684\u7ed8\u5236\u4e0a\u5e27\u66f4\u65b0\u753b\u9762\u7684\u64cd\u4f5c\uff0c\u5177\u4f53\u6d41\u7a0b\u540e\u6587\u4f1a\u7ee7\u7eed\u8be6\u7ec6\u5206\u6790\u3002\u4ee5\u4e0a\u8fc7\u7a0b\u5982\u4e0b<code>Systrace</code>\u622a\u56fe\u6240\u793a\uff1a</p> </li> </ol> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#2-ui","title":"2 \u5e94\u7528UI\u7ebf\u7a0b\u6d88\u606f\u5faa\u73af\u673a\u5236","text":"<p><code>App</code>\u5e94\u7528\u542f\u52a8\u65f6\uff0c\u5728<code>Fork</code>\u521b\u5efa\u8fdb\u7a0b\u540e\u4f1a\u901a\u8fc7\u53cd\u5c04\u521b\u5efa\u4ee3\u8868\u5e94\u7528\u4e3b\u7ebf\u7a0b\u7684<code>ActivityThread</code>\u5bf9\u8c61\u5e76\u6267\u884c\u5176<code>main</code>\u51fd\u6570\uff0c\u8fdb\u884c<code>UI</code>\u4e3b\u7ebf\u7a0b\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff1a</p> <pre><code>/*frameworks/base/core/java/android/app/ActivityThread.java*/\npublic static void main(String[] args) {\n...\n// 1.\u521b\u5efaLooper\u3001MessageQueue\nLooper.prepareMainLooper();\n...\n// 2.\u542f\u52a8loop\u6d88\u606f\u5faa\u73af\uff0c\u5f00\u59cb\u51c6\u5907\u63a5\u6536\u6d88\u606f\nLooper.loop();\n...\n}\n// 3.\u521b\u5efa\u4e3b\u7ebf\u7a0bHandler\u5bf9\u8c61\nfinal H mH = new H();\nclass H extends Handler {\n...\n}\n/*frameworks/base/core/java/android/os/Looper.java*/\npublic static void prepareMainLooper() {\n// \u51c6\u5907\u4e3b\u7ebf\u7a0b\u7684Looper\nprepare(false);\nsynchronized (Looper.class) {\nif (sMainLooper != null) {\nthrow new IllegalStateException(\"The main Looper has already been prepared.\");\n}\nsMainLooper = myLooper();\n}\n}\nprivate static void prepare(boolean quitAllowed) {\nif (sThreadLocal.get() != null) {\nthrow new RuntimeException(\"Only one Looper may be created per thread\");\n}\n// \u521b\u5efa\u4e3b\u7ebf\u7a0b\u7684Looper\u5bf9\u8c61\uff0c\u5e76\u901a\u8fc7ThreadLocal\u673a\u5236\u5b9e\u73b0\u4e0e\u4e3b\u7ebf\u7a0b\u7684\u4e00\u5bf9\u4e00\u7ed1\u5b9a\nsThreadLocal.set(new Looper(quitAllowed));\n}\nprivate Looper(boolean quitAllowed) {\n// \u521b\u5efaMessageQueue\u6d88\u606f\u961f\u5217\nmQueue = new MessageQueue(quitAllowed);\nmThread = Thread.currentThread();\n}\n</code></pre> <p>\u4e3b\u7ebf\u7a0b\u521d\u59cb\u5316\u5b8c\u6210\u540e\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u6709\u4e86\u5b8c\u6574\u7684 <code>Looper</code>\u3001<code>MessageQueue</code>\u3001<code>Handler</code>\uff0c\u6b64\u65f6 <code>ActivityThread</code> \u7684 <code>Handler</code> \u5c31\u53ef\u4ee5\u5f00\u59cb\u5904\u7406 <code>Message</code>\uff0c\u5305\u62ec <code>Application</code>\u3001<code>Activity</code>\u3001<code>ContentProvider</code>\u3001<code>Service</code>\u3001<code>Broadcast</code> \u7b49\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u51fd\u6570\uff0c\u90fd\u4f1a\u4ee5 <code>Message</code> \u7684\u5f62\u5f0f\uff0c\u5728\u4e3b\u7ebf\u7a0b\u6309\u7167\u987a\u5e8f\u5904\u7406\uff0c\u8fd9\u5c31\u662f <code>App</code> \u4e3b\u7ebf\u7a0b\u7684\u521d\u59cb\u5316\u548c\u8fd0\u884c\u539f\u7406\uff0c\u90e8\u5206\u5904\u7406\u7684 <code>Message</code> \u5982\u4e0b\uff1a</p> <pre><code>/*frameworks/base/core/java/android/app/ActivityThread.java*/\nclass H extends Handler {\npublic static final int BIND_APPLICATION        = 110;\n@UnsupportedAppUsage\npublic static final int RECEIVER                = 113;\n@UnsupportedAppUsage\npublic static final int CREATE_SERVICE          = 114;\n@UnsupportedAppUsage\npublic static final int BIND_SERVICE            = 121;\npublic void handleMessage(Message msg) {\nswitch (msg.what) {\ncase BIND_APPLICATION:\nTrace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"bindApplication\");\nAppBindData data = (AppBindData)msg.obj;\nhandleBindApplication(data);\nTrace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);\nbreak;\n...\n}\n}\n...\n}\n</code></pre> <p>\u4e3b\u7ebf\u7a0b\u521d\u59cb\u5316\u5b8c\u6210\u540e\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff08\u8fdb\u5165<code>epoll_wait</code>\u72b6\u6001\uff0c\u5e76\u91ca\u653e<code>CPU</code>\u8fd0\u884c\u8d44\u6e90\uff09\uff0c\u7b49\u5f85 <code>Message</code>\uff0c\u4e00\u65e6\u6709 <code>Message</code> \u53d1\u8fc7\u6765\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u5524\u9192\uff0c\u5904\u7406 <code>Message</code>\uff0c\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u5982\u679c\u6ca1\u6709\u5176\u4ed6\u7684 <code>Message</code> \u9700\u8981\u5904\u7406\uff0c\u90a3\u4e48\u4e3b\u7ebf\u7a0b\u5c31\u4f1a\u8fdb\u5165\u4f11\u7720\u963b\u585e\u72b6\u6001\u7ee7\u7eed\u7b49\u5f85\u3002\u53ef\u4ee5\u8bf4<code>Android</code>\u7cfb\u7edf\u7684\u8fd0\u884c\u662f\u53d7\u6d88\u606f\u673a\u5236\u9a71\u52a8\u7684\uff0c\u800c\u6574\u4e2a\u6d88\u606f\u673a\u5236\u662f\u7531\u4e0a\u9762\u6240\u8bf4\u7684\u56db\u4e2a\u5173\u952e\u89d2\u8272\u76f8\u4e92\u914d\u5408\u5b9e\u73b0\u7684\uff08<code>Handler</code>\u3001<code>Looper</code>\u3001<code>MessageQueue</code>\u3001<code>Message</code>\uff09\uff0c\u5176\u8fd0\u884c\u539f\u7406\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#3-android","title":"3 Android\u5c4f\u5e55\u5237\u65b0\u673a\u5236","text":""},{"location":"perf-opt/Android/jank/jank-principle/#31-vsync","title":"3.1 \u53cc\u7f13\u5b58+Vsync","text":"<p>\u5728\u4e00\u4e2a\u5178\u578b\u7684\u663e\u793a\u7cfb\u7edf\u4e2d\uff0c\u4e00\u822c\u5305\u62ec<code>CPU</code>\u3001<code>GPU</code>\u3001<code>Display</code>\u4e09\u4e2a\u90e8\u5206\uff1a<code>CPU</code>\u8d1f\u8d23\u8ba1\u7b97\u5e27\u6570\u636e\uff0c\u628a\u8ba1\u7b97\u597d\u7684\u6570\u636e\u4ea4\u7ed9<code>GPU</code>\uff0c<code>GPU</code>\u4f1a\u5bf9\u56fe\u5f62\u6570\u636e\u8fdb\u884c\u6e32\u67d3\uff0c\u6e32\u67d3\u597d\u540e\u653e\u5230<code>buffer</code>(\u56fe\u50cf\u7f13\u51b2\u533a)\u91cc\u5b58\u8d77\u6765\uff0c\u7136\u540e<code>Display</code>\uff08\u5c4f\u5e55\u6216\u663e\u793a\u5668\uff09\u8d1f\u8d23\u628a<code>Buffer</code>\u91cc\u7684\u6570\u636e\u5448\u73b0\u5230\u5c4f\u5e55\u4e0a\u3002\u5c4f\u5e55\u4e0a\u663e\u793a\u7684\u5185\u5bb9\uff0c\u662f\u4ece<code>Buffer</code>\u56fe\u50cf\u5e27\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6\u7684\uff0c\u5927\u81f4\u8bfb\u53d6\u8fc7\u7a0b\u4e3a\uff1a\u4ece<code>Buffer</code>\u7684\u8d77\u59cb\u5730\u5740\u5f00\u59cb\uff0c\u4ece\u4e0a\u5f80\u4e0b\uff0c\u4ece\u5de6\u5f80\u53f3\u626b\u63cf\u6574\u4e2a<code>Buffer</code>\uff0c\u5c06\u5185\u5bb9\u6620\u5c04\u5230\u663e\u793a\u5c4f\u4e0a\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5f53\u7136\uff0c\u5c4f\u5e55\u4e0a\u663e\u793a\u7684\u5185\u5bb9\u9700\u8981\u4e0d\u65ad\u7684\u66f4\u65b0\uff0c\u5982\u679c\u5728\u540c\u4e00\u4e2a<code>Buffer</code>\u8fdb\u884c\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\uff0c\u5c06\u4f1a\u5bfc\u81f4\u5c4f\u5e55\u663e\u793a\u591a\u5e27\u5185\u5bb9\u800c\u51fa\u73b0\u663e\u793a\u9519\u4e71\u3002\u6240\u4ee5\u786c\u4ef6\u5c42\u9664\u4e86\u63d0\u4f9b\u4e00\u4e2a<code>Buffer</code>\u7528\u4e8e\u5c4f\u5e55\u663e\u793a\uff0c\u8fd8\u4f1a\u63d0\u4f9b\u4e86\u4e00\u4e2a<code>Buffer</code>\u7528\u4e8e\u540e\u53f0\u7684<code>CPU/GPU</code>\u56fe\u5f62\u7ed8\u5236\u4e0e\u5408\u6210\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 \u53cc\u7f13\u51b2\uff1a\u8ba9\u7ed8\u5236\u548c\u663e\u793a\u5668\u62e5\u6709\u5404\u81ea\u7684<code>Buffer\uff1aCPU/GPU</code> \u59cb\u7ec8\u5c06\u5b8c\u6210\u7684\u4e00\u5e27\u56fe\u50cf\u6570\u636e\u5199\u5165\u5230 \u540e\u7f13\u5b58\u533a\uff08<code>Back Buffer</code>\uff09\uff0c\u800c\u663e\u793a\u5668\u4f7f\u7528\u524d\u7f13\u5b58\u533a\uff08 <code>Front Buffer</code>\uff09\uff0c\u5f53\u5c4f\u5e55\u5237\u65b0\u65f6\uff0c<code>Front Buffer</code> \u5e76\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u5f53<code>Back Buffer</code>\u51c6\u5907\u5c31\u7eea\u540e\uff0c\u5b83\u4eec\u624d\u8fdb\u884c\u4ea4\u6362\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7406\u60f3\u60c5\u51b5\u4e0b\u5047\u8bbe\u524d\u4e00\u5e27\u663e\u793a\u5b8c\u6210\uff0c\u540e\u4e00\u5e27\u6570\u636e\u5c31\u51c6\u5907\u597d\u4e86\uff0c\u5c4f\u5e55\u5f00\u59cb\u8bfb\u53d6\u4e0b\u4e00\u5e27\u5185\u5bb9\u8fdb\u884c\u663e\u793a\uff0c\u4e5f\u5c31\u662f\u5f00\u59cb\u8bfb\u53d6\u4e0a\u56fe\u4e2d\u7684\u540e\u7f13\u51b2\u533a\u7684\u5185\u5bb9\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0c\u524d\u540e\u7f13\u51b2\u533a\u8fdb\u884c\u4e00\u6b21\u89d2\u8272\u4ea4\u6362\uff0c\u4e4b\u524d\u7684\u540e\u7f13\u51b2\u533a\u53d8\u4e3a\u524d\u7f13\u51b2\u533a\uff0c\u8fdb\u884c\u56fe\u5f62\u7684\u663e\u793a\uff0c\u4e4b\u524d\u7684\u524d\u7f13\u51b2\u533a\u5219\u53d8\u4e3a\u540e\u7f13\u51b2\u533a\uff0c\u8fdb\u884c\u56fe\u5f62\u7684\u7ed8\u5236\u5408\u6210\u3002\u7136\u800c\uff0c\u7406\u60f3\u5f88\u4e30\u6ee1\uff0c\u73b0\u5b9e\u5f88\u9aa8\u611f\uff0c\u4e0a\u9762\u5047\u8bbe\u201c\u5f53\u524d\u4e00\u5e27\u663e\u793a\u5b8c\u6bd5\uff0c\u540e\u4e00\u5e27\u51c6\u5907\u597d\u4e86\u201d\u7684\u60c5\u51b5\uff0c\u5728\u73b0\u5b9e\u4e2d\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\u5e76\u975e\u540c\u65f6\u5b8c\u6210\u3002\u90a3\u4e48\uff0c\u5c4f\u5e55\u8bfb\u53d6\u7f13\u51b2\u533a\u7684\u901f\u5ea6\u548c\u7cfb\u7edf\u7ed8\u5236\u5408\u6210\u5e27\u7684\u901f\u5ea6\u4e4b\u95f4\u6709\u4ec0\u4e48\u5173\u7cfb\u5462\uff0c\u5e26\u7740\u8fd9\u4e2a\u7591\u60d1\u6211\u4eec\u770b\u770b\u4e0b\u9762\u4e24\u4e2a\u57fa\u672c\u6982\u5ff5\uff1a</p> <ol> <li>\u5c4f\u5e55\u5237\u65b0\u7387\uff08<code>Screen Refresh Rate</code>\uff09: \u5c4f\u5e55\u5237\u65b0\u7387\u662f\u4e00\u4e2a\u786c\u4ef6\u7684\u6982\u5ff5\uff0c\u5355\u4f4d\u662f<code>Hz</code>\uff08\u8d6b\u5179\uff09\uff0c\u662f\u8bf4\u5c4f\u5e55\u8fd9\u4e2a\u786c\u4ef6\u5237\u65b0\u753b\u9762\u7684\u9891\u7387\uff1a\u4e3e\u4f8b\u6765\u8bf4\uff0c<code>60Hz</code> \u5237\u65b0\u7387\u610f\u601d\u662f\uff1a\u8fd9\u4e2a\u5c4f\u5e55\u5728 1 \u79d2\u5185\uff0c\u4f1a\u5237\u65b0\u663e\u793a\u5185\u5bb960 \u6b21\uff1b\u90a3\u4e48\u5bf9\u5e94\u7684\uff0c<code>90Hz</code> \u662f\u8bf4\u5728 1 \u79d2\u5185\u5237\u65b0\u663e\u793a\u5185\u5bb9 90 \u6b21\u3002</li> <li>\u5e27\u7387\uff08<code>Frame Rate</code>\uff09: \u4e0e\u5c4f\u5e55\u5237\u65b0\u7387\u5bf9\u5e94\u7684\uff0c\u5e27\u7387\u662f\u4e00\u4e2a\u8f6f\u4ef6\u7684\u6982\u5ff5\uff0c\u5355\u4f4d\u662f<code>FPS</code>\uff08<code>Frame Per Second</code> \uff09\uff0c\u8868\u793a <code>CPU/GPU</code> \u5728\u4e00\u79d2\u5185\u7ed8\u5236\u5408\u6210\u4ea7\u751f\u7684\u5e27\u6570\uff0c\u610f\u601d\u662f\u6bcf\u79d2\u4ea7\u751f\u753b\u9762\u7684\u4e2a\u6570\uff0c<code>FPS</code> \u7684\u503c\u662f\u7531\u8f6f\u4ef6\u7cfb\u7edf\u51b3\u5b9a\u7684\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0c<code>60FPS</code> \u6307\u7684\u662f\u6bcf\u79d2\u4ea7\u751f 60 \u4e2a\u753b\u9762\uff1b<code>90FPS</code> \u6307\u7684\u662f\u6bcf\u79d2\u4ea7\u751f 90 \u4e2a\u753b\u9762\u3002</li> </ol> <p>\u6211\u4eec\u7528\u4ee5\u4e0b\u4e24\u4e2a\u5047\u8bbe\u6765\u5206\u6790\u4e24\u8005\u7684\u5173\u7cfb\uff1a</p> <ol> <li> <p>\u5c4f\u5e55\u5237\u65b0\u7387\u6bd4\u7cfb\u7edf\u5e27\u7387\u5feb\uff1a     \u6b64\u65f6\uff0c\u5728\u524d\u7f13\u51b2\u533a\u5185\u5bb9\u5168\u90e8\u6620\u5c04\u5230\u5c4f\u5e55\u4e0a\u4e4b\u540e\uff0c\u540e\u7f13\u51b2\u533a\u5c1a\u672a\u51c6\u5907\u597d\u4e0b\u4e00\u5e27\uff0c\u5c4f\u5e55\u5c06\u65e0\u6cd5\u8bfb\u53d6\u4e0b\u4e00\u5e27\uff0c\u6240\u4ee5\u53ea\u80fd\u7ee7\u7eed\u663e\u793a\u5f53\u524d\u4e00\u5e27\u7684\u56fe\u5f62\uff0c\u9020\u6210\u4e00\u5e27\u663e\u793a\u591a\u6b21\uff0c\u4e5f\u5c31\u662f \u5361\u987f\u3002</p> </li> <li> <p>\u7cfb\u7edf\u5e27\u7387\u6bd4\u5c4f\u5e55\u5237\u65b0\u7387\u5feb\uff1a     \u6b64\u65f6\uff0c\u5c4f\u5e55\u672a\u5b8c\u5168\u628a\u524d\u7f13\u51b2\u533a\u7684\u4e00\u5e27\u6620\u5c04\u5230\u5c4f\u5e55\uff0c\u800c\u7cfb\u7edf\u5df2\u7ecf\u5728\u540e\u7f13\u51b2\u533a\u51c6\u5907\u597d\u4e86\u4e0b\u4e00\u5e27\uff0c\u5e76\u8981\u6c42\u8bfb\u53d6\u4e0b\u4e00\u5e27\u5230\u5c4f\u5e55\uff0c\u5c06\u4f1a\u5bfc\u81f4\u5c4f\u5e55\u4e0a\u534a\u90e8\u5206\u662f\u4e0a\u4e00\u5e27\u7684\u56fe\u5f62\uff0c\u800c\u4e0b\u534a\u90e8\u5206\u662f\u4e0b\u4e00\u5e27\u7684\u56fe\u5f62\uff0c\u9020\u6210\u5c4f\u5e55\u4e0a\u663e\u793a\u591a\u5e27\uff0c\u4e5f\u5c31\u662f \u5c4f\u5e55\u6495\u88c2 \u73b0\u8c61\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a    </p> </li> </ol> <p>\u6240\u4ee5\u4e0a\u9762\u4e24\u79cd\u60c5\u51b5\uff0c\u90fd\u4f1a\u5bfc\u81f4\u95ee\u9898\uff0c\u6839\u672c\u539f\u56e0\u5c31\u662f\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u64cd\u4f5c\u901f\u7387\u4e0d\u4e00\u81f4\u3002\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\uff1a\u8ba9\u5c4f\u5e55\u63a7\u5236\u524d\u540e\u7f13\u51b2\u533a\u7684\u5207\u6362\u65f6\u673a\uff0c\u8ba9\u7cfb\u7edf\u5e27\u901f\u7387\u914d\u5408\u5c4f\u5e55\u5237\u65b0\u7387\u7684\u8282\u594f\u3002\u90a3\u4e48\u5c4f\u5e55\u662f\u5982\u4f55\u63a7\u5236\u8fd9\u4e2a\u8282\u594f\u7684\u5462\uff1f</p> <p>\u7b54\u6848\u5c31\u662f \u5782\u76f4\u540c\u6b65\uff08VSync\uff09\uff1a\u5f53\u5c4f\u5e55\u4ece\u7f13\u51b2\u533a\u626b\u63cf\u5b8c\u4e00\u5e27\u5230\u5c4f\u5e55\u4e0a\u4e4b\u540e\uff0c\u5f00\u59cb\u626b\u63cf\u4e0b\u4e00\u5e27\u4e4b\u524d\uff0c\u4e2d\u95f4\u4f1a\u6709\u4e00\u4e2a\u65f6\u95f4\u95f4\u9699\uff0c\u79f0\u4e3a<code>Vetrical Blanking Interval (VBI)</code>\uff0c\u8fd9\u4e2a\u65f6\u95f4\u70b9\u5176\u5b9e\u5c31\u662f\u8fdb\u884c\u524d\u540e\u7f13\u5b58\u533a\u4ea4\u6362\u7684\u6700\u4f73\u65f6\u673a\uff0c\u6b64\u65f6\u5c4f\u5e55\u5e76\u6ca1\u6709\u5728\u5237\u65b0\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u5c4f\u5e55\u6495\u88c2\u73b0\u8c61\u7684\u4ea7\u751f\uff0c\u6240\u4ee5\u5728\u6b64\u65f6\u53d1\u51fa\u7684\u4e00\u4e2a\u540c\u6b65<code>Vsync</code>\u4fe1\u53f7\uff0c\u8be5\u4fe1\u53f7\u7528\u6765\u5207\u6362\u524d\u7f13\u51b2\u533a\u548c\u540e\u7f13\u51b2\u533a(\u672c\u8d28\u5c31\u662f\u5185\u5b58\u5730\u5740\u7684\u4ea4\u6362\uff0c\u77ac\u95f4\u5373\u53ef\u5b8c\u6210)\uff0c\u5373\u53ef\u8fbe\u5230\u6700\u4f73\u6548\u679c\u3002</p> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u5206\u6790\u53ef\u4ee5\u770b\u51fa\uff1a\u5c4f\u5e55\u7684\u663e\u793a\u8282\u594f\u662f\u7531\u5c4f\u5e55\u5237\u65b0\u7387\u7684\u786c\u4ef6\u53c2\u6570\u51b3\u5b9a\u4e14\u56fa\u5b9a\u7684\uff0c\u8f6f\u4ef6\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u914d\u5408\u5c4f\u5e55\u7684\u663e\u793a\uff0c\u5728\u56fa\u5b9a\u7684\u65f6\u95f4\u5185\u51c6\u5907\u597d\u4e0b\u4e00\u5e27\uff0c\u4ee5\u4f9b\u5c4f\u5e55\u8fdb\u884c\u663e\u793a\uff0c\u4e24\u8005\u901a\u8fc7<code>VSync</code>\u4fe1\u53f7\u6765\u5b9e\u73b0\u540c\u6b65\uff08<code>VSync</code>\u8fd9\u4e2a\u6982\u5ff5\u5e76\u4e0d\u662f<code>Google</code>\u9996\u521b\u7684\uff0c\u5b83\u5728\u65e9\u5e74\u7684<code>PC</code>\u673a\u9886\u57df\u5c31\u5df2\u7ecf\u51fa\u73b0\u4e86\uff09\u3002</p>"},{"location":"perf-opt/Android/jank/jank-principle/#32-drawing-with-vsync","title":"3.2 Drawing with Vsync","text":"<p>\u5728<code>Android 4.1</code>\u4e4b\u524d\uff0c\u5c4f\u5e55\u5237\u65b0\u4e5f\u9075\u5faa\u4e0a\u9762\u4ecb\u7ecd\u7684 \u53cc\u7f13\u5b58+<code>VSync</code> \u673a\u5236\uff0c\u6574\u4e2a\u6d41\u7a0b\u4e0e\u67b6\u6784\u501f\u7528<code>2012</code>\u5e74<code>Google I/O</code>\u5927\u4f1a\u4e0a\u5c55\u793a\u7684\u4e00\u5f20\u56fe\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff1a  \u4e00\u3001\u7eb5\u8f74\u8868\u793a<code>Buffer</code>\u7684\u4f7f\u7528\u8005\uff0c\u7531\u5982\u4e0b\u4e09\u4e2a\u89d2\u8272\u6784\u6210\uff1a</p> <ol> <li><code>CPU</code> : \u4ee3\u8868\u5229\u7528<code>CPU</code>\u5bf9\u754c\u9762<code>View</code>\u7684<code>Measure</code>\u5c3a\u5bf8\u6d4b\u91cf\u3001<code>Layout</code>\u4f4d\u7f6e\u5e03\u5c40\u3001<code>Draw</code>\u7ed8\u5236\u5e76\u6700\u7ec8\u751f\u6210\u7eb9\u7406\u7684\u64cd\u4f5c\uff1b</li> <li><code>GPU</code>\uff1a\u4ee3\u8868\u4f7f\u7528<code>OpenGl</code>\u5e93\u6307\u4ee4\u64cd\u4f5c<code>GPU</code>\u786c\u4ef6\u5bf9<code>CPU</code>\u751f\u6210\u7684\u7eb9\u7406\u6570\u636e\u8fdb\u884c\u6e32\u67d3\u548c\u6805\u683c\u5316\u4ee5\u53ca\u5408\u6210\u7b49\u64cd\u4f5c\uff1b</li> <li><code>Display</code>\uff1a\u4ee3\u8868\u5e95\u5c42\u7684\u663e\u793a\u5c4f\u5e55\uff1b</li> </ol> <p>\u4e8c\u3001\u6a2a\u8f74\u8868\u793a\u65f6\u95f4\uff0c\u6bcf\u4e2a\u957f\u65b9\u5f62\u8868\u793a<code>Buffer</code>\u7684\u4f7f\u7528\uff0c\u957f\u65b9\u5f62\u7684\u5bbd\u5ea6\u4ee3\u8868\u4f7f\u7528\u65f6\u957f\uff0c<code>VSync</code>\u4ee3\u8868\u5782\u76f4\u540c\u6b65\u4fe1\u53f7\u3002</p> <p>\u6211\u4eec\u4ee5\u65f6\u95f4\u4e3a\u987a\u5e8f\u6765\u770b\u770b\u8fd9\u79cd\u8bbe\u8ba1\u5b58\u5728\u7684\u6f5c\u5728\u7f3a\u9677\uff1a</p> <ol> <li><code>Display</code>\u4e0a\u663e\u793a\u7b2c<code>0</code>\u5e27\u6570\u636e\uff0c\u6b64\u65f6<code>CPU</code>\u548c<code>GPU</code>\u6b63\u5728\u5904\u7406\u51c6\u5907\u7b2c<code>1</code>\u5e27\u7684\u753b\u9762\uff0c\u4e14\u5728<code>Display</code>\u663e\u793a\u4e0b\u4e00\u5e27\u524d\u5b8c\u6210\uff1b</li> <li>\u56e0\u4e3a<code>CPU</code>\u548c<code>GPU</code>\u7684\u5904\u7406\u53ca\u65f6\uff0c<code>Display</code>\u5728\u7b2c<code>0</code>\u5e27\u663e\u793a\u5b8c\u6210\u540e\uff0c\u4e5f\u5c31\u662f\u7b2c<code>1</code>\u4e2a<code>VSync</code>\u540e\uff0c\u7f13\u5b58\u8fdb\u884c\u4ea4\u6362\uff0c\u7136\u540e\u6b63\u5e38\u663e\u793a\u7b2c<code>1</code>\u5e27\uff1b</li> <li>\u63a5\u7740\u7b2c<code>2</code>\u5e27\u5f00\u59cb\u5904\u7406\uff0c\u4f46\u662f<code>CPU</code>\u5e76\u6ca1\u6709\u7acb\u523b\u5f00\u59cb\u51c6\u5907\u7b2c<code>2</code>\u5e27\u7684\u6570\u636e\uff0c\u800c\u662f\u76f4\u5230\u7b2c<code>2</code>\u4e2a<code>VSync</code>\u5feb\u6765\u524d\u624d\u5f00\u59cb\u5904\u7406\u7684\uff1b</li> <li>\u7b2c<code>2</code>\u4e2a<code>VSync</code>\u6765\u65f6\uff0c\u7531\u4e8e\u7b2c<code>2</code>\u5e27\u6570\u636e\u8fd8\u6ca1\u6709\u51c6\u5907\u5c31\u7eea\uff0c\u7f13\u5b58\u6ca1\u6709\u4ea4\u6362\uff0c\u5c4f\u5e55\u663e\u793a\u7684\u8fd8\u662f\u7b2c<code>1</code>\u5e27\u753b\u9762\uff0c\u5373\u4ea7\u751f\u4e86\u4e22\u5e27\u5361\u987f\u95ee\u9898\uff1b</li> <li>\u5f53\u7b2c<code>2</code>\u5e27\u6570\u636e\u51c6\u5907\u5b8c\u6210\u540e\uff0c\u5b83\u5e76\u4e0d\u80fd\u7acb\u9a6c\u88ab\u663e\u793a\uff0c\u800c\u662f\u8981\u7b49\u5230\u4e0b\u4e00\u4e2a<code>VSync</code> \u5e26\u6765\u540e\uff0c\u8fdb\u884c\u524d\u540e\u7f13\u5b58\u4ea4\u6362\u624d\u80fd\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u3002</li> </ol> <p>\u51fa\u73b0\u6b64\u6389\u5e27\u5361\u987f\u95ee\u9898\u7684\u6839\u672c\u539f\u56e0\u662f\uff1a\u4e0a\u5c42\u7684<code>CPU</code>\u548c<code>GPU</code>\u5e76\u4e0d\u77e5\u9053<code>Vsync</code>\u4fe1\u53f7\u7684\u5230\u6765\uff0c\u6240\u4ee5\u5728\u5e95\u5c42\u5c4f\u5e55\u7684<code>Vsync</code>\u4fe1\u53f7\u53d1\u51fa\u540e\u5e76\u6ca1\u6709\u53ca\u65f6\u6536\u5230\u5e76\u5f00\u59cb\u4e0b\u4e00\u5e27\u753b\u9762\u7684\u64cd\u4f5c\u5904\u7406\u3002\u6839\u636e\u524d\u9762\u7684\u5206\u6790\u6211\u4eec\u77e5\u9053\uff1a\u53cc\u7f13\u5b58\u7684\u4ea4\u6362\u662f\u5728<code>Vsyn</code>\u4fe1\u53f7\u5230\u6765\u65f6\u8fdb\u884c\uff0c\u4ea4\u6362\u540e\u5c4f\u5e55\u4f1a\u8bfb\u53d6<code>Front Buffer</code>\u5185\u7684\u65b0\u6570\u636e\u66f4\u65b0\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\uff0c\u800c\u6b64\u65f6\u7684<code>Back Buffer</code> \u5c31\u53ef\u4ee5\u4f9b<code>GPU</code>\u51c6\u5907\u4e0b\u4e00\u5e27\u6570\u636e\u4e86\u3002\u5982\u679c <code>Vsyn</code>\u5230\u6765\u65f6  <code>CPU/GPU</code>\u5c31\u5f00\u59cb\u64cd\u4f5c\u7684\u8bdd\uff0c\u662f\u6709\u5b8c\u6574\u7684<code>Vsync</code>\u5468\u671f\u65f6\u957f\u6765\u5904\u7406\u4e00\u5e27\u6570\u636e\uff0c\u4ee5\u907f\u514d\u5361\u987f\u7684\u51fa\u73b0\u3002\u90a3\u5982\u4f55\u8ba9 <code>CPU/GPU</code>\u7684\u5904\u7406\u5728 <code>Vsyn</code>\u4fe1\u53f7\u5230\u6765\u65f6\u5c31\u5f00\u59cb\u8fdb\u884c\u5462\uff1f</p> <p>\u4e3a\u4e86\u4f18\u5316\u7cfb\u7edf\u663e\u793a\u6027\u80fd\uff0c<code>Google</code>\u5728<code>Android 4.1</code>\u7cfb\u7edf\u4e2d\u5bf9<code>Android Display</code>\u7cfb\u7edf\u8fdb\u884c\u4e86\u91cd\u6784\uff0c\u5f15\u5165\u4e86<code>Project Butter</code>\uff08\u9ec4\u6cb9\u8ba1\u5212\uff09\uff0c\u5176\u4e2d\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u4fee\u6539\u5c31\u662f\u5b9e\u73b0\u4e86\uff1a\u5728\u7cfb\u7edf\u6536\u5230<code>VSync</code>\u4fe1\u53f7\u540e\uff0c\u4e0a\u5c42<code>CPU</code>\u548c<code>GPU</code>\u9a6c\u4e0a\u5f00\u59cb\u8fdb\u884c\u4e0b\u4e00\u5e27\u753b\u9762\u6570\u636e\u7684\u5904\u7406\uff0c\u5b8c\u6210\u540e\u53ca\u65f6\u5c06\u6570\u636e\u5199\u5165\u5230<code>Buffer</code>\u4e2d\uff0c<code>Google</code>\u79f0\u4e4b\u4e3a<code>Drawing with Vsync</code>\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#33-choreographer","title":"3.3 Choreographer","text":"<p>\u4e0a\u4e00\u8282\u4e2d\u8bb2\u5230\u7684\uff0c\u4e3a\u4e86\u4f18\u5316\u663e\u793a\u7cfb\u7edf\u6027\u80fd\uff0c<code>Google</code>\u5728<code>Android 4.1</code>\u7cfb\u7edf\u4e2d\u5bf9<code>Android Display</code>\u7cfb\u7edf\u8fdb\u884c\u4e86\u91cd\u6784\uff0c\u5f15\u5165\u4e86<code>Project Butter</code>\uff08\u9ec4\u6cb9\u8ba1\u5212\uff09\uff0c\u5176\u4e2d\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u4fee\u6539\u5c31\u662f\u5b9e\u73b0\u4e86\uff1a\u5728\u7cfb\u7edf\u6536\u5230<code>VSync</code>\u4fe1\u53f7\u540e\uff0c\u4e0a\u5c42<code>CPU</code>\u548c<code>GPU</code>\u9a6c\u4e0a\u5f00\u59cb\u8fdb\u884c\u4e0b\u4e00\u5e27\u753b\u9762\u6570\u636e\u7684\u5904\u7406\uff0c\u5b8c\u6210\u540e\u53ca\u65f6\u5c06\u6570\u636e\u5199\u5165\u5230<code>Buffer</code>\u4e2d\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u6548\u679c\uff0c\u63a7\u5236\u4e0a\u5c42<code>CPU</code>\u548c<code>GPU</code>\u5728\u6536\u5230<code>Vsync</code>\u4fe1\u53f7\u540e\u9a6c\u4e0a\u5f00\u59cb\u4e00\u5e27\u6570\u636e\u7684\u5904\u7406\uff0c\u8c37\u6b4c\u4e3a\u6b64\u4e13\u95e8\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u540d\u4e3a<code>Choreographer</code>\uff08\u4e2d\u6587\u7ffb\u8bd1\u4e3a\u201c\u7f16\u821e\u8005\u201d\uff09\u7684\u7c7b\uff0c\u6765\u63a7\u5236\u4e0a\u5c42\u7ed8\u5236\u7684\u8282\u594f\u3002</p> <p><code>Choreographer</code> \u7684\u5f15\u5165\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u914d\u5408\u7cfb\u7edf<code>Vsync</code>\u5782\u76f4\u540c\u6b65\u673a\u5236\uff0c\u7ed9\u4e0a\u5c42 App \u7684\u6e32\u67d3\u63d0\u4f9b\u4e00\u4e2a\u7a33\u5b9a\u7684 <code>Message</code> \u5904\u7406\u7684\u65f6\u673a\uff0c\u4e5f\u5c31\u662f <code>Vsync</code> \u5230\u6765\u7684\u65f6\u5019 \uff0c\u7cfb\u7edf\u901a\u8fc7\u5bf9 <code>Vsync</code> \u4fe1\u53f7\u5468\u671f\u7684\u8c03\u6574\uff0c\u6765\u63a7\u5236\u6bcf\u4e00\u5e27\u7ed8\u5236\u64cd\u4f5c\u7684\u65f6\u673a\u3002<code>Choreographer</code> \u626e\u6f14 Android \u6e32\u67d3\u94fe\u8def\u4e2d\u627f\u4e0a\u542f\u4e0b\u7684\u89d2\u8272\uff1a</p> <ol> <li>\u627f\u4e0a\uff1a\u8d1f\u8d23\u63a5\u6536\u548c\u5904\u7406 <code>App</code> \u7684\u5404\u79cd\u66f4\u65b0\u6d88\u606f\u548c\u56de\u8c03\uff0c\u7b49\u5230 <code>Vsync</code> \u5230\u6765\u7684\u65f6\u5019\u7edf\u4e00\u5904\u7406\u3002\u6bd4\u5982\u96c6\u4e2d\u5904\u7406 <code>Input</code>(\u4e3b\u8981\u662f <code>Input</code> \u4e8b\u4ef6\u7684\u5904\u7406) \u3001<code>Animation</code>(\u52a8\u753b\u76f8\u5173)\u3001<code>Traversal</code>(\u5305\u62ec <code>measure\u3001layout\u3001draw</code> \u7b49\u64cd\u4f5c) \uff0c\u5224\u65ad\u5361\u987f\u6389\u5e27\u60c5\u51b5\uff0c\u8bb0\u5f55 <code>CallBack</code> \u8017\u65f6\u7b49\uff1b</li> <li>\u542f\u4e0b\uff1a\u8d1f\u8d23\u8bf7\u6c42\u548c\u63a5\u6536 <code>Vsync</code> \u4fe1\u53f7\u3002\u63a5\u6536 <code>Vsync</code> \u4fe1\u53f7\u5230\u6765\u7684\u4e8b\u4ef6\u540e\u56de\u8c03(\u901a\u8fc7 <code>FrameDisplayEventReceiver</code>.<code>onVsync</code> )\uff0c\u5e76\u8bf7\u6c42 <code>Vsync</code>(<code>FrameDisplayEventReceiver</code>.<code>scheduleVsync</code>) \u3002</li> </ol> <p>\u4e00\u822c\u5e94\u7528<code>App</code>\u6709\u754c\u9762<code>UI</code>\u7684\u53d8\u5316\u65f6\uff0c\u6700\u7ec8\u90fd\u4f1a\u8c03\u7528\u8d70\u5230<code>ViewRootImpl#scheduleTraversals()</code>\u65b9\u6cd5\u4e2d\uff0c\u8be5\u65b9\u6cd5\u4e2d\u4f1a\u5f80<code>Choreographer</code>\u4e2d\u653e\u5165\u4e00\u4e2a<code>CALLBACK_TRAVERSAL</code>\u7c7b\u578b\u7684\u7ed8\u5236\u4efb\u52a1\uff0c\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>/*frameworks/base/core/java/android/view/ViewRootImpl.java*/\n@UnsupportedAppUsage\nvoid scheduleTraversals() {\nif (!mTraversalScheduled) {\n...\n// \u901a\u8fc7Choreographer\u5f80\u4e3b\u7ebf\u7a0b\u6d88\u606f\u961f\u5217\u6dfb\u52a0CALLBACK_TRAVERSAL\u7ed8\u5236\u7c7b\u578b\u7684\u5f85\u6267\u884c\u6d88\u606f\uff0c\u7528\u4e8e\u89e6\u53d1\u540e\u7eedUI\u7ebf\u7a0b\u771f\u6b63\u5b9e\u73b0\u7ed8\u5236\u52a8\u4f5c\nmChoreographer.postCallback(\nChoreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);\n...\n}\n}\n</code></pre> <p><code>Choreographer</code>\u5728\u6536\u5230\u7684\u7ed8\u5236\u4efb\u52a1\u540e\uff0c\u5176\u5185\u90e8\u7684\u5de5\u4f5c\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u4ee5\u4e0a\u6d41\u7a0b\u56fe\u53ef\u4ee5\u770b\u51fa\u4e0a\u5c42\u4e00\u822c<code>App</code>\u5e94\u7528<code>UI</code>\u4e2d<code>View</code>\u7684\u7ed8\u5236\u6d41\u7a0b\uff08\u5305\u542bSurfaceView\u7684\u6e38\u620f\u5e94\u7528\u7684\u7ed8\u5236\u6d41\u7a0b\u4f1a\u6709\u4e00\u4e9b\u5dee\u5f02\uff0c\u7bc7\u5e45\u6709\u9650\u6b64\u5904\u4e0d\u518d\u5c55\u5f00\u5206\u6790\uff09\uff1a</p> <ol> <li><code>View#invalidate</code>\u89e6\u53d1\u66f4\u65b0\u89c6\u56fe\u8bf7\u6c42\uff0c\u6b64\u52a8\u4f5c\u4f1a\u8c03\u7528<code>ViewRootImpl#scheduleTraversals</code>\u51fd\u6570\uff1b</li> <li><code>ViewRootImpl#scheduleTraversals</code>\u4e2d\u4f1a\u5411<code>Choreographer</code>\u4e2d<code>postCallback</code>\u653e\u5165\u4e00\u4e2a<code>CALLBACK_TRAVERSAL</code>\u7c7b\u578b\u7ed8\u5236\u5f85\u6267\u884c\u4efb\u52a1\uff1b</li> <li><code>Choreographer</code>\u901a\u8fc7<code>DisplayEventReceiver</code>\u5411\u7cfb\u7edf<code>SurfaceFlinger</code>\u6ce8\u518c\u4e0b\u4e00\u4e2a<code>VSync</code>\u4fe1\u53f7;</li> <li>\u5f53\u5e95\u5c42\u4ea7\u751f\u4e0b\u4e00\u4e2a<code>VSync</code>\u6d88\u606f\u65f6\uff0c\u5c06\u8be5\u4fe1\u53f7\u53d1\u9001\u7ed9<code>DisplayEventReceiver</code>\uff0c\u6700\u540e\u4f20\u9012\u7ed9<code>Choreographer</code>\uff1b</li> <li><code>Choreographer</code>\u6536\u5230<code>VSync</code>\u4fe1\u53f7\u4e4b\u540e\uff0c\u5411\u4e3b\u7ebf\u7a0b<code>MessageQueue</code>\u53d1\u9001\u4e86\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\uff1b</li> <li>\u6700\u540e\uff0c\u5f02\u6b65\u6d88\u606f\u7684\u6267\u884c\u8005\u662f\u8dd1\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u7684<code>ViewRootImpl#doTraversal</code>\uff0c\u4e5f\u5c31\u662f\u771f\u6b63\u5f00\u59cb\u7ed8\u5236\u4e00\u5e27\u7684\u64cd\u4f5c\uff08\u5305\u542b<code>measure\u3001layout\u3001draw</code>\u4e09\u4e2a\u8fc7\u7a0b\uff09\uff1b</li> </ol> <p>\u81f3\u6b64\uff0c\u5e95\u5c42\u7684<code>VSync</code>\u63a7\u5236\u4e0a\u5c42\u7ed8\u5236\u7684\u903b\u8f91\u5c31\u89e3\u91ca\u5b8c\u4e86\u3002</p>"},{"location":"perf-opt/Android/jank/jank-principle/#4-ui","title":"4 UI \u7ebf\u7a0b\u7ed8\u5236\u6d41\u7a0b","text":"<p>\u5728\u524d\u51e0\u8282\u4e2d\u5206\u6790\u4e86\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u7684\u6d88\u606f\u5faa\u73af\u673a\u5236\u548c<code>Android</code>\u5c4f\u5e55\u5237\u65b0\u673a\u5236\u4e4b\u540e\uff0c\u6211\u4eec\u63a5\u7740<code>1</code>\u5c0f\u8282\u4e2d\u5173\u4e8e<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u7684\u5904\u7406\u6d41\u7a0b\u7ee7\u7eed\u5f80\u4e0b\u5206\u6790\u3002\u5728<code>1</code>\u5c0f\u8282\u7684\u5206\u6790\u4e2d\u6211\u4eec\u4e86\u89e3\u5230\uff1a\u7528\u6237\u624b\u6307\u5728\u5e94\u7528\u754c\u9762\u4e0a\u4e0b\u6ed1\u52a8\u65f6\uff0c\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u4e2d\u4f1a\u6536\u5230<code>system_server</code>\u7cfb\u7edf\u8fdb\u7a0b\u53d1\u9001\u6765\u7684\u4e00\u7cfb\u5217<code>Input</code>\u4e8b\u4ef6\uff08\u5305\u542b\u4e00\u4e2a<code>ACTION_DOWN</code>\u3001\u591a\u4e2a<code>ACTION_MOVE</code>\u548c\u4e00\u4e2a<code>ACTION_UP</code>\u4e8b\u4ef6\uff09\uff0c\u5e94\u7528\u754c\u9762\u5e03\u5c40\u4e2d\u7684\u76f8\u5173<code>View</code>\u63a7\u4ef6\u5728\u6536\u5230\u591a\u4e2a<code>ACTION_MOVE</code>\u89e6\u63a7\u4e8b\u4ef6\u540e\uff0c\u5224\u65ad\u4e3a\u7528\u6237\u624b\u6307\u7684\u6ed1\u52a8\u884c\u4e3a\u540e\uff0c\u4e00\u822c\u4f1a\u8c03\u7528<code>View#invalidate</code>\u7b49\u63a5\u53e3\u89e6\u53d1<code>UI</code>\u7ebf\u7a0b\u7684\u7ed8\u5236\u4e0a\u5e27\u66f4\u65b0\u753b\u9762\u7684\u64cd\u4f5c\u3002</p> <p>\u5728\u5f00\u59cb\u5206\u6790\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b<code>Android</code>\u7cfb\u7edf\u7684<code>GUI</code>\u663e\u793a\u7cfb\u7edf\u5728<code>APP</code>\u5e94\u7528\u8fdb\u7a0b\u4fa7\u7684\u6838\u5fc3\u67b6\u6784\uff0c\u5176\u6574\u4f53\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ul> <li><code>Window</code>\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u901a\u8fc7\u63a7\u5236<code>DecorView</code>\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6807\u51c6\u7684UI\u65b9\u6848\uff0c\u6bd4\u5982<code>\u80cc\u666f\u3001\u6807\u9898\u3001\u865a\u62df\u6309\u952e\u7b49</code>\uff0c\u800c<code>PhoneWindow</code>\u662f<code>Window</code>\u7684\u552f\u4e00\u5b9e\u73b0\u7c7b\uff0c\u5728<code>Activity</code>\u521b\u5efa\u540e\u7684attach\u6d41\u7a0b\u4e2d\u521b\u5efa\uff0c\u5e94\u7528\u542f\u52a8\u663e\u793a\u7684\u5185\u5bb9\u88c5\u8f7d\u5230\u5176\u5185\u90e8\u7684<code>mDecor</code>\uff08<code>DecorView</code>\uff09\uff1b</li> <li><code>DecorView</code>\u662f\u6574\u4e2a\u754c\u9762\u5e03\u5c40View\u63a7\u4ef6\u6811\u7684\u6839\u8282\u70b9\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u904d\u5386\u8bbf\u95ee\u5230\u6574\u4e2a<code>View</code>\u63a7\u4ef6\u6811\u4e0a\u7684\u4efb\u610f\u8282\u70b9\uff1b</li> <li><code>WindowManager</code>\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u7ee7\u627f\u81ea<code>ViewManager</code>\u63a5\u53e3\uff0c\u63d0\u4f9b\u4e86<code>View</code>\u7684\u57fa\u672c\u64cd\u4f5c\u65b9\u6cd5\uff1b<code>WindowManagerImp</code>\u5b9e\u73b0\u4e86<code>WindowManager</code>\u63a5\u53e3\uff0c\u5185\u90e8\u901a\u8fc7<code>\u7ec4\u5408</code>\u65b9\u5f0f\u6301\u6709<code>WindowManagerGlobal</code>\uff0c\u7528\u6765\u64cd\u4f5c<code>View</code>\uff1b<code>WindowManagerGlobal</code>\u662f\u4e00\u4e2a\u5168\u5c40\u5355\u4f8b\uff0c\u5185\u90e8\u901a\u8fc7<code>ViewRootImpl</code>\u5c06<code>View</code>\u6dfb\u52a0\u81f3\u7a97\u53e3\u4e2d\uff1b</li> <li><code>ViewRootImpl</code>\u662f\u6240\u6709<code>View</code>\u7684<code>Parent</code>\uff0c\u7528\u6765\u603b\u4f53\u7ba1\u7406<code>View</code>\u7684\u7ed8\u5236\u4ee5\u53ca\u4e0e\u7cfb\u7edf<code>WMS</code>\u7a97\u53e3\u7ba1\u7406\u670d\u52a1\u7684<code>IPC</code>\u4ea4\u4e92\u4ece\u800c\u5b9e\u73b0\u7a97\u53e3\u7684\u5f00\u8f9f\uff1b<code>ViewRootImpl</code>\u662f\u5e94\u7528\u8fdb\u7a0b\u8fd0\u8f6c\u7684\u53d1\u52a8\u673a\uff0c\u53ef\u4ee5\u770b\u5230<code>ViewRootImpl</code>\u5185\u90e8\u5305\u542b<code>mView</code>\uff08\u5c31\u662f<code>DecorView</code>\uff09\u3001<code>mSurface</code>\u3001<code>Choregrapher</code>\uff1a<code>mView</code>\u4ee3\u8868\u6574\u4e2a\u63a7\u4ef6\u6811\uff0c<code>mSurfacce</code>\u4ee3\u8868\u753b\u5e03\uff0c\u5e94\u7528\u7684UI\u6e32\u67d3\u4f1a\u76f4\u63a5\u653e\u5230<code>mSurface</code>\u4e2d\uff0c<code>Choregorapher</code>\u4f7f\u5f97\u5e94\u7528\u8bf7\u6c42<code>vsync</code>\u4fe1\u53f7\uff0c\u63a5\u6536\u4fe1\u53f7\u540e\u5f00\u59cb\u7ed8\u5236\u6d41\u7a0b\u3002</li> </ul> <p>\u6211\u4eec\u4ece<code>ViewRootImpl</code>\u7684<code>invalidate</code>\u6d41\u7a0b\u7ee7\u7eed\u5f80\u4e0b\u5206\u6790\uff1a</p> <pre><code>/*frameworks/base/core/java/android/view/ViewRootImpl.java*/\n@UnsupportedAppUsage\nvoid invalidate() {\nmDirty.set(0,0,mWidth,mHeight);\nif (!mWillDrawSoon) {\n// \u8c03\u7528scheduleTraversals\u51fd\u6570\u89e6\u53d1\u7ed8\u5236\u64cd\u4f5c\nscheduleTraversals();\n}\n}\n@UnsupportedAppUsage\nvoid scheduleTraversals() {\nif (!mTraversalScheduled) {\n...\n// \u901a\u8fc7Choreographer\u5f80\u4e3b\u7ebf\u7a0b\u6d88\u606f\u961f\u5217\u6dfb\u52a0CALLBACK_TRAVERSAL\u7ed8\u5236\u7c7b\u578b\u7684\u5f85\u6267\u884c\u6d88\u606f\uff0c\u7528\u4e8e\u89e6\u53d1\u540e\u7eedUI\u7ebf\u7a0b\u771f\u6b63\u5b9e\u73b0\u7ed8\u5236\u52a8\u4f5c\nmChoreographer.postCallback(\nChoreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);\n...\n}\n}\n</code></pre> <p>\u4ece\u4ee5\u4e0a\u5206\u6790\u53ef\u4ee5\u770b\u51fa\uff0c\u5e94\u7528UI\u7ebf\u7a0b\u7684\u7ed8\u5236\u6700\u7ec8\u662f\u901a\u8fc7\u5f80<code>Choreographer</code>\u4e2d\u653e\u5165\u4e00\u4e2a<code>CALLBACK_TRAVERSAL</code>\u7c7b\u578b\u7684\u7ed8\u5236\u4efb\u52a1\u800c\u89e6\u53d1\uff0c\u4e0b\u9762\u7684\u6d41\u7a0b\u5c31\u548c<code>3.3.3</code>\u5c0f\u8282\u4e2d\u7684\u5206\u6790\u7684\u4e00\u81f4\uff0c<code>Choreographer</code>\u4f1a\u5148\u5411\u7cfb\u7edf\u7533\u8bf7<code>Vsync</code>\u4fe1\u53f7\uff0c\u5f85<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\uff0c\u5411\u5e94\u7528\u4e3b\u7ebf\u7a0b<code>MessageQueue</code>\u53d1\u9001\u4e00\u4e2a\u5f02\u6b65\u6d88\u606f\uff0c\u89e6\u53d1\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c<code>ViewRootImpl#doTraversal</code>\u7ed8\u5236\u4efb\u52a1\u52a8\u4f5c\u3002\u6211\u4eec\u63a5\u7740\u770b\u770b<code>ViewRootImpl</code>\u7684<code>doTraversal</code>\u51fd\u6570\u6267\u884c\u7ed8\u5236\u6d41\u7a0b\u7684\u7b80\u5316\u4ee3\u7801\u6d41\u7a0b\uff1a</p> <pre><code>/*frameworks/base/core/java/android/view/ViewRootImpl.java*/\nvoid doTraversal() {\nif (mTraversalScheduled) {\nmTraversalScheduled = false;\n// \u8c03\u7528removeSyncBarrier\u53ca\u65f6\u79fb\u9664\u4e3b\u7ebf\u7a0bMessageQueue\u4e2d\u7684Barrier\u540c\u6b65\u680f\u5220\uff0c\u4ee5\u907f\u514d\u4e3b\u7ebf\u7a0b\u53d1\u751f\u201c\u5047\u6b7b\u201d\nmHandler.getLooper().getQueue().removeSyncBarrier(mTraversalBarrier);\n...\n// \u6267\u884c\u5177\u4f53\u7684\u7ed8\u5236\u4efb\u52a1\nperformTraversals();\n...\n}\n}\nprivate void performTraversals() {\n...\n// 1.\u4eceDecorView\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u904d\u5386\u6574\u4e2aView\u63a7\u4ef6\u6811\uff0c\u5b8c\u6210\u6574\u4e2aView\u63a7\u4ef6\u6811\u7684measure\u6d4b\u91cf\u64cd\u4f5c\nwindowSizeMayChange |= measureHierarchy(...);\n...\nif (mFirst...) {\n// 2.\u7b2c\u4e00\u6b21\u6267\u884ctraversals\u7ed8\u5236\u4efb\u52a1\u65f6\uff0cBinder\u8c03\u7528\u8bbf\u95ee\u7cfb\u7edf\u7a97\u53e3\u7ba1\u7406\u670d\u52a1WMS\u7684relayoutWindow\u63a5\u53e3\uff0c\u5b9e\u73b0WMS\u8ba1\u7b97\u5e94\u7528\u7a97\u53e3\u5c3a\u5bf8\u5e76\u5411\u7cfb\u7edfsurfaceflinger\u6b63\u5f0f\u7533\u8bf7Surface\u201c\u753b\u5e03\u201d\u64cd\u4f5c\nrelayoutResult = relayoutWindow(params, viewVisibility, insetsPending);\n}\n...\n// 3.\u4eceDecorView\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u904d\u5386\u6574\u4e2aView\u63a7\u4ef6\u6811\uff0c\u5b8c\u6210\u6574\u4e2aView\u63a7\u4ef6\u6811\u7684layout\u6d4b\u91cf\u64cd\u4f5c\nperformLayout(lp, mWidth, mHeight);\n...\n// 4.\u4eceDecorView\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u904d\u5386\u6574\u4e2aView\u63a7\u4ef6\u6811\uff0c\u5b8c\u6210\u6574\u4e2aView\u63a7\u4ef6\u6811\u7684draw\u6d4b\u91cf\u64cd\u4f5c\nperformDraw();\n...\n}\nprivate void performMeasure(int childWidthMeasureSpec, int childHeightMeasureSpec) {\n...\n// \u539f\u751f\u6807\u8bc6View\u6811\u7684measure\u6d4b\u91cf\u8fc7\u7a0b\u7684trace tag\nTrace.traceBegin(Trace.TRACE_TAG_VIEW, \"measure\");\ntry {\n// \u4ecemView\u6307\u5411\u7684View\u63a7\u4ef6\u6811\u7684\u6839\u8282\u70b9DecorView\u51fa\u53d1\uff0c\u904d\u5386\u8bbf\u95ee\u6574\u4e2aView\u6811\uff0c\u5e76\u5b8c\u6210\u6574\u4e2a\u5e03\u5c40View\u6811\u7684\u6d4b\u91cf\u5de5\u4f5c\nmView.measure(childWidthMeasureSpec, childHeightMeasureSpec);\n} finally {\nTrace.traceEnd(Trace.TRACE_TAG_VIEW);\n}\n}\nprivate void performDraw() {\n...\nboolean canUseAsync = draw(fullRedrawNeeded);\n...\n}\nprivate boolean draw(boolean fullRedrawNeeded) {\n...\nif (mAttachInfo.mThreadedRenderer != null &amp;&amp; mAttachInfo.mThreadedRenderer.isEnabled()) {\n...\n// \u5982\u679c\u5f00\u542f\u5e76\u652f\u6301\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\uff0c\u5219\u8d70\u786c\u4ef6\u7ed8\u5236\u7684\u6d41\u7a0b\uff08\u4eceAndroid 4.+\u5f00\u59cb\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u90fd\u662f\u652f\u6301\u8ddf\u5f00\u542f\u4e86\u786c\u4ef6\u52a0\u901f\u7684\uff09\nmAttachInfo.mThreadedRenderer.draw(mView, mAttachInfo, this);\n} else {\n// \u5426\u5219\u8d70drawSoftware\u8f6f\u4ef6\u7ed8\u5236\u7684\u6d41\u7a0b\nif (!drawSoftware(surface, mAttachInfo, xOffset, yOffset,\nscalingRequired, dirty, surfaceInsets)) {\nreturn false;\n}\n}\n}\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u6d41\u7a0b\u53ef\u4ee5\u770b\u51fa\uff0c<code>ViewRootImpl</code>\u4e2d\u8d1f\u8d23\u7684\u6574\u4e2a\u5e94\u7528\u754c\u9762\u7ed8\u5236\u7684\u4e3b\u8981\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u4ece\u754c\u9762View\u63a7\u4ef6\u6811\u7684\u6839\u8282\u70b9<code>DecorView</code>\u51fa\u53d1\uff0c\u9012\u5f52\u904d\u5386\u6574\u4e2a<code>View</code>\u63a7\u4ef6\u6811\uff0c\u5b8c\u6210\u5bf9\u6574\u4e2a <code>View</code>\u63a7\u4ef6\u6811\u7684<code>measure</code>\u6d4b\u91cf\u64cd\u4f5c\uff0c\u7531\u4e8e\u7bc7\u5e45\u6240\u9650\uff0c\u672c\u6587\u5c31\u4e0d\u5c55\u5f00\u5206\u6790\u8fd9\u5757\u7684\u8be6\u7ec6\u6d41\u7a0b\uff1b</li> <li>\u754c\u9762\u7b2c\u4e00\u6b21\u6267\u884c\u7ed8\u5236\u4efb\u52a1\u65f6\uff0c\u4f1a\u901a\u8fc7<code>Binder</code> <code>IPC</code>\u8bbf\u95ee\u7cfb\u7edf\u7a97\u53e3\u7ba1\u7406\u670d\u52a1WMS\u7684relayout\u63a5\u53e3\uff0c\u5b9e\u73b0\u7a97\u53e3\u5c3a\u5bf8\u7684\u8ba1\u7b97\u5e76\u5411\u7cfb\u7edf\u7533\u8bf7\u7528\u4e8e\u672c\u5730\u7ed8\u5236\u6e32\u67d3\u7684<code>Surface</code>\u201c\u753b\u5e03\u201d\u7684\u64cd\u4f5c\uff08\u5177\u4f53\u7531<code>SurfaceFlinger</code>\u8d1f\u8d23\u521b\u5efa\u5e94\u7528\u754c\u9762\u5bf9\u5e94\u7684<code>Layer</code>\u5bf9\u8c61\uff0c\u5e76\u901a\u8fc7\u5185\u5b58\u5171\u4eab\u7684\u65b9\u5f0f\u901a\u8fc7<code>Binder</code>\u5c06\u5730\u5740\u5f15\u7528\u900f\u8fc7WMS\u56de\u4f20\u7ed9\u5e94\u7528\u8fdb\u7a0b\u8fd9\u8fb9\uff09\uff1b</li> <li>\u4ece\u754c\u9762View\u63a7\u4ef6\u6811\u7684\u6839\u8282\u70b9<code>DecorView</code>\u51fa\u53d1\uff0c\u9012\u5f52\u904d\u5386\u6574\u4e2a<code>View</code>\u63a7\u4ef6\u6811\uff0c\u5b8c\u6210\u5bf9\u6574\u4e2a <code>View</code>\u63a7\u4ef6\u6811\u7684<code>layout</code>\u5e03\u5c40\u64cd\u4f5c\uff1b</li> <li>\u4ece\u754c\u9762View\u63a7\u4ef6\u6811\u7684\u6839\u8282\u70b9<code>DecorView</code>\u51fa\u53d1\uff0c\u9012\u5f52\u904d\u5386\u6574\u4e2a<code>View</code>\u63a7\u4ef6\u6811\uff0c\u5b8c\u6210\u5bf9\u6574\u4e2a <code>View</code>\u63a7\u4ef6\u6811\u7684<code>draw</code>\u7ed8\u5236\u64cd\u4f5c\uff0c\u5982\u679c\u5f00\u542f\u5e76\u652f\u6301\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\uff08\u4eceAndroid 4.X\u5f00\u59cb\u8c37\u6b4c\u5df2\u7ecf\u9ed8\u8ba4\u5f00\u542f\u786c\u4ef6\u52a0\u901f\uff09\uff0c\u5219\u8d70<code>GPU</code>\u786c\u4ef6\u7ed8\u5236\u7684\u6d41\u7a0b\uff0c\u5426\u5219\u8d70<code>CPU</code>\u8f6f\u4ef6\u7ed8\u5236\u7684\u6d41\u7a0b\uff1b</li> </ol> <p>\u4ee5\u4e0a\u7ed8\u5236\u8fc7\u7a0b\u4ece<code>systrace</code>\u4e0a\u770b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#5-renderthread","title":"5 RenderThread \u7ebf\u7a0b\u6e32\u67d3\u6d41\u7a0b","text":"<p>\u622a\u6b62\u5230\u76ee\u524d\uff0c\u5728<code>ViewRootImpl</code>\u4e2d\u5b8c\u6210\u4e86\u5bf9\u754c\u9762\u7684<code>measure</code>\u3001<code>layout</code>\u548c<code>draw</code>\u7b49\u7ed8\u5236\u6d41\u7a0b\u540e\uff0c\u7528\u6237\u4f9d\u7136\u8fd8\u662f\u770b\u4e0d\u5230\u5c4f\u5e55\u4e0a\u663e\u793a\u7684\u5e94\u7528\u754c\u9762\u5185\u5bb9\uff0c\u56e0\u4e3a\u6574\u4e2a<code>Android</code>\u7cfb\u7edf\u7684\u663e\u793a\u6d41\u7a0b\u9664\u4e86\u524d\u9762\u8bb2\u5230\u7684UI\u7ebf\u7a0b\u7684\u7ed8\u5236\u5916\uff0c\u754c\u9762\u8fd8\u9700\u8981\u7ecf\u8fc7<code>RenderThread</code>\u7ebf\u7a0b\u7684\u6e32\u67d3\u5904\u7406\uff0c\u6e32\u67d3\u5b8c\u6210\u540e\uff0c\u8fd8\u9700\u8981\u901a\u8fc7<code>Binder</code>\u8c03\u7528\u201c\u4e0a\u5e27\u201d\u4ea4\u7ed9<code>surfaceflinger</code>\u8fdb\u7a0b\u4e2d\u8fdb\u884c\u5408\u6210\u540e\u9001\u663e\u624d\u80fd\u6700\u7ec8\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u3002\u672c\u5c0f\u8282\u4e2d\uff0c\u6211\u4eec\u5c06\u63a5\u4e0a\u4e00\u8282\u4e2d<code>ViewRootImpl</code>\u4e2d\u6700\u540edraw\u7684\u6d41\u7a0b\u7ee7\u7eed\u5f80\u4e0b\u5206\u6790\u5f00\u542f\u786c\u4ef6\u52a0\u901f\u60c5\u51b5\u4e0b\uff0c<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\u7684\u5de5\u4f5c\u6d41\u7a0b\u3002\u7531\u4e8e\u76ee\u524dAndroid 4.X\u4e4b\u540e\u7cfb\u7edf\u9ed8\u8ba4\u754c\u9762\u662f\u5f00\u542f\u786c\u4ef6\u52a0\u901f\u7684\uff0c\u6240\u4ee5\u672c\u6587\u6211\u4eec\u91cd\u70b9\u5206\u6790\u786c\u4ef6\u52a0\u901f\u6761\u4ef6\u4e0b\u7684\u754c\u9762\u6e32\u67d3\u6d41\u7a0b\uff0c\u6211\u4eec\u5148\u5206\u6790\u4e00\u4e0b\u7b80\u5316\u7684\u4ee3\u7801\u6d41\u7a0b\uff1a</p> <pre><code>/*frameworks/base/core/java/android/view/ViewRootImpl.java*/\nprivate boolean draw(boolean fullRedrawNeeded) {\n...\nif (mAttachInfo.mThreadedRenderer != null &amp;&amp; mAttachInfo.mThreadedRenderer.isEnabled()) {\n...\n// \u786c\u4ef6\u52a0\u901f\u6761\u4ef6\u4e0b\u7684\u754c\u9762\u6e32\u67d3\u6d41\u7a0b\nmAttachInfo.mThreadedRenderer.draw(mView, mAttachInfo, this);\n} else {\n...\n}\n}\n/*frameworks/base/core/java/android/view/ThreadedRenderer.java*/\nvoid draw(View view, AttachInfo attachInfo, DrawCallbacks callbacks) {\n...\n// 1.\u4eceDecorView\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u9012\u5f52\u904d\u5386View\u63a7\u4ef6\u6811\uff0c\u8bb0\u5f55\u6bcf\u4e2aView\u8282\u70b9\u7684\u7ed8\u5236\u64cd\u4f5c\u547d\u4ee4\uff0c\u5b8c\u6210\u7ed8\u5236\u64cd\u4f5c\u547d\u4ee4\u6811\u7684\u6784\u5efa\nupdateRootDisplayList(view, callbacks);\n...\n// 2.JNI\u8c03\u7528\u540c\u6b65Java\u5c42\u6784\u5efa\u7684\u7ed8\u5236\u547d\u4ee4\u6811\u5230Native\u5c42\u7684RenderThread\u6e32\u67d3\u7ebf\u7a0b\uff0c\u5e76\u5524\u9192\u6e32\u67d3\u7ebf\u7a0b\u5229\u7528OpenGL\u6267\u884c\u6e32\u67d3\u4efb\u52a1\uff1b\nint syncResult = syncAndDrawFrame(choreographer.mFrameInfo);\n...\n}\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u786c\u4ef6\u52a0\u901f\u7ed8\u5236\u4e3b\u8981\u5305\u62ec\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ol> <li>\u4ece<code>DecorView</code>\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u9012\u5f52\u904d\u5386<code>View</code>\u63a7\u4ef6\u6811\uff0c\u8bb0\u5f55\u6bcf\u4e2a<code>View</code>\u8282\u70b9\u7684<code>drawOp</code>\u7ed8\u5236\u64cd\u4f5c\u547d\u4ee4\uff0c\u5b8c\u6210\u7ed8\u5236\u64cd\u4f5c\u547d\u4ee4\u6811\u7684\u6784\u5efa\uff1b</li> <li><code>JNI</code>\u8c03\u7528\u540c\u6b65<code>Java</code>\u5c42\u6784\u5efa\u7684\u7ed8\u5236\u547d\u4ee4\u6811\u5230<code>Native</code>\u5c42\u7684<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\uff0c\u5e76\u5524\u9192\u6e32\u67d3\u7ebf\u7a0b\u5229\u7528<code>OpenGL</code>\u6267\u884c\u6e32\u67d3\u4efb\u52a1\uff1b</li> </ol>"},{"location":"perf-opt/Android/jank/jank-principle/#51","title":"5.1 \u6784\u5efa\u7ed8\u5236\u547d\u4ee4\u6811","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u770b\u7b2c\u4e00\u9636\u6bb5\u6784\u5efa\u7ed8\u5236\u547d\u4ee4\u6811\u7684\u4ee3\u7801\u7b80\u5316\u6d41\u7a0b\uff1a</p> <pre><code>/*frameworks/base/core/java/android/view/ThreadedRenderer.java*/\nprivate void updateRootDisplayList(View view, DrawCallbacks callbacks) {\n// \u539f\u751f\u6807\u8bb0\u6784\u5efaView\u7ed8\u5236\u64cd\u4f5c\u547d\u4ee4\u6811\u8fc7\u7a0b\u7684systrace tag\nTrace.traceBegin(Trace.TRACE_TAG_VIEW, \"Record View#draw()\");\n// \u9012\u5f52\u5b50View\u7684updateDisplayListIfDirty\u5b9e\u73b0\u6784\u5efaDisplayListOp\nupdateViewTreeDisplayList(view);\n...\nif (mRootNodeNeedsUpdate || !mRootNode.hasDisplayList()) {\n// \u83b7\u53d6\u6839View\u7684SkiaRecordingCanvas\nRecordingCanvas canvas = mRootNode.beginRecording(mSurfaceWidth, mSurfaceHeight);\ntry {\n...\n// \u5229\u7528canvas\u7f13\u5b58DisplayListOp\u7ed8\u5236\u547d\u4ee4\ncanvas.drawRenderNode(view.updateDisplayListIfDirty());\n...\n} finally {\n// \u5c06\u6240\u6709DisplayListOp\u7ed8\u5236\u547d\u4ee4\u586b\u5145\u5230RootRenderNode\u4e2d\nmRootNode.endRecording();\n}\n}\nTrace.traceEnd(Trace.TRACE_TAG_VIEW);\n}\nprivate void updateViewTreeDisplayList(View view) {\n...\n// \u4eceDecorView\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u5f00\u59cb\u9012\u5f52\u8c03\u7528\u6bcf\u4e2aView\u6811\u8282\u70b9\u7684updateDisplayListIfDirty\u51fd\u6570\nview.updateDisplayListIfDirty();\n...\n}\n/*frameworks/base/core/java/android/view/View.java*/\npublic RenderNode updateDisplayListIfDirty() {\n...\n// 1.\u5229\u7528`View`\u5bf9\u8c61\u6784\u9020\u65f6\u521b\u5efa\u7684`RenderNode`\u83b7\u53d6\u4e00\u4e2a`SkiaRecordingCanvas`\u201c\u753b\u5e03\u201d\uff1b\nfinal RecordingCanvas canvas = renderNode.beginRecording(width, height);\ntry {\n...\nif ((mPrivateFlags &amp; PFLAG_SKIP_DRAW) == PFLAG_SKIP_DRAW) {\n// \u5982\u679c\u4ec5\u4ec5\u662fViewGroup\uff0c\u5e76\u4e14\u81ea\u8eab\u4e0d\u7528\u7ed8\u5236\uff0c\u76f4\u63a5\u9012\u5f52\u5b50View\ndispatchDraw(canvas);\n...\n} else {\n// 2.\u5229\u7528SkiaRecordingCanvas\uff0c\u5728\u6bcf\u4e2a\u5b50View\u63a7\u4ef6\u7684onDraw\u7ed8\u5236\u51fd\u6570\u4e2d\u8c03\u7528drawLine\u3001drawRect\u7b49\u7ed8\u5236\u64cd\u4f5c\u65f6\uff0c\u521b\u5efa\u5bf9\u5e94\u7684DisplayListOp\u7ed8\u5236\u547d\u4ee4\uff0c\u5e76\u7f13\u5b58\u8bb0\u5f55\u5230\u5176\u5185\u90e8\u7684SkiaDisplayList\u6301\u6709\u7684DisplayListData\u4e2d\uff1b\ndraw(canvas);\n}\n} finally {\n// 3.\u5c06\u5305\u542b\u6709`DisplayListOp`\u7ed8\u5236\u547d\u4ee4\u7f13\u5b58\u7684`SkiaDisplayList`\u5bf9\u8c61\u8bbe\u7f6e\u586b\u5145\u5230`RenderNode`\u4e2d\uff1b\nrenderNode.endRecording();\n...\n}\n...\n}\npublic void draw(Canvas canvas) {\n...\n// draw the content(View\u81ea\u5df1\u5b9e\u73b0\u7684onDraw\u7ed8\u5236\uff0c\u7531\u5e94\u7528\u5f00\u53d1\u8005\u81ea\u5df1\u5b9e\u73b0)\nonDraw(canvas);\n...\n// draw the children\ndispatchDraw(canvas);\n...\n}\n/*frameworks/base/graphics/java/android/graphics/RenderNode.java*/\npublic void endRecording() {\n...\n// \u4eceSkiaRecordingCanvas\u4e2d\u83b7\u53d6SkiaDisplayList\u5bf9\u8c61\nlong displayList = canvas.finishRecording();\n// \u5c06SkiaDisplayList\u5bf9\u8c61\u586b\u5145\u5230RenderNode\u4e2d\nnSetDisplayList(mNativeRenderNode, displayList);\ncanvas.recycle();\n}\n</code></pre> <p>\u4ece\u4ee5\u4e0a\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u6784\u5efa\u7ed8\u5236\u547d\u4ee4\u6811\u7684\u8fc7\u7a0b\u662f\u4ece<code>View</code>\u63a7\u4ef6\u6811\u7684\u6839\u8282\u70b9<code>DecorView</code>\u89e6\u53d1\uff0c\u9012\u5f52\u8c03\u7528\u6bcf\u4e2a\u5b50<code>View</code>\u8282\u70b9\u7684<code>updateDisplayListIfDirty</code>\u51fd\u6570\uff0c\u6700\u7ec8\u5b8c\u6210\u7ed8\u5236\u6811\u7684\u521b\u5efa\uff0c\u7b80\u8ff0\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u5229\u7528<code>View</code>\u5bf9\u8c61\u6784\u9020\u65f6\u521b\u5efa\u7684<code>RenderNode</code>\u83b7\u53d6\u4e00\u4e2a<code>SkiaRecordingCanvas</code>\u201c\u753b\u5e03\u201d\uff1b</li> <li>\u5229\u7528<code>SkiaRecordingCanvas</code>\uff0c\u5728\u6bcf\u4e2a\u5b50<code>View</code>\u63a7\u4ef6\u7684<code>onDraw</code>\u7ed8\u5236\u51fd\u6570\u4e2d\u8c03\u7528<code>drawLine</code>\u3001<code>drawRect</code>\u7b49\u7ed8\u5236\u64cd\u4f5c\u65f6\uff0c\u521b\u5efa\u5bf9\u5e94\u7684<code>DisplayListOp</code>\u7ed8\u5236\u547d\u4ee4\uff0c\u5e76\u7f13\u5b58\u8bb0\u5f55\u5230\u5176\u5185\u90e8\u7684<code>SkiaDisplayList</code>\u6301\u6709\u7684<code>DisplayListData</code>\u4e2d\uff1b</li> <li>\u5c06\u5305\u542b\u6709<code>DisplayListOp</code>\u7ed8\u5236\u547d\u4ee4\u7f13\u5b58\u7684<code>SkiaDisplayList</code>\u5bf9\u8c61\u8bbe\u7f6e\u586b\u5145\u5230<code>RenderNode</code>\u4e2d\uff1b</li> <li>\u6700\u540e\u5c06\u6839<code>View</code>\u7684\u7f13\u5b58<code>DisplayListOp</code>\u8bbe\u7f6e\u5230<code>RootRenderNode</code>\u4e2d\uff0c\u5b8c\u6210\u6784\u5efa\u3002</li> </ol> <p>\u4ee5\u4e0a\u6574\u4e2a\u6784\u5efa\u7ed8\u5236\u547d\u4ee4\u6811\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7528\u5982\u4e0b\u6d41\u7a0b\u56fe\u8868\u793a\uff1a</p> <p></p> <p>\u786c\u4ef6\u52a0\u901f\u4e0b\u7684\u6574\u4e2a\u754c\u9762\u7684<code>View</code>\u6811\u7684\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6700\u540e\u4ece<code>Systrace</code>\u4e0a\u770b\u8fd9\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#52","title":"5.2 \u6267\u884c\u6e32\u67d3\u7ed8\u5236\u4efb\u52a1","text":"<p>\u7ecf\u8fc7\u4e0a\u4e00\u5c0f\u8282\u4e2d\u7684\u5206\u6790\uff0c\u5e94\u7528\u5728<code>UI</code>\u7ebf\u7a0b\u4e2d\u4ece\u6839\u8282\u70b9<code>DecorView</code>\u51fa\u53d1\uff0c\u9012\u5f52\u904d\u5386\u6bcf\u4e2a\u5b50<code>View</code>\u8282\u70b9\uff0c\u641c\u96c6\u5176<code>drawXXX</code>\u7ed8\u5236\u52a8\u4f5c\u5e76\u8f6c\u6362\u6210<code>DisplayListOp</code>\u547d\u4ee4\uff0c\u5c06\u5176\u8bb0\u5f55\u5230<code>DisplayListData</code>\u5e76\u586b\u5145\u5230<code>RenderNode</code>\u4e2d\uff0c\u6700\u7ec8\u5b8c\u6210\u6574\u4e2a<code>View</code>\u7ed8\u5236\u547d\u4ee4\u6811\u7684\u6784\u5efa\u3002\u4ece\u6b64UI\u7ebf\u7a0b\u7684\u7ed8\u5236\u4efb\u52a1\u5c31\u5b8c\u6210\u4e86\u3002\u4e0b\u4e00\u6b65<code>UI</code>\u7ebf\u7a0b\u5c06\u5524\u9192<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\uff0c\u89e6\u53d1\u5176\u5229\u7528<code>OpenGL</code>\u6267\u884c\u754c\u9762\u7684\u6e32\u67d3\u4efb\u52a1\uff0c\u672c\u5c0f\u8282\u4e2d\u6211\u4eec\u5c06\u91cd\u70b9\u5206\u6790\u8fd9\u4e2a\u6d41\u7a0b\u3002\u6211\u4eec\u8fd8\u662f\u5148\u770b\u770b\u8fd9\u5757\u4ee3\u7801\u7684\u7b80\u5316\u6d41\u7a0b\uff1a</p> <pre><code>/*frameworks/base/graphics/java/android/graphics/HardwareRenderer.java*/\npublic int syncAndDrawFrame(@NonNull FrameInfo frameInfo) {\n// JNI\u8c03\u7528native\u5c42\u7684\u76f8\u5173\u51fd\u6570\nreturn nSyncAndDrawFrame(mNativeProxy, frameInfo.frameInfo, frameInfo.frameInfo.length);\n}\n/*frameworks/base/libs/hwui/jni/android_graphics_HardwareRenderer.cpp*/\nstatic int android_view_ThreadedRenderer_syncAndDrawFrame(JNIEnv* env, jobject clazz,\njlong proxyPtr, jlongArray frameInfo, jint frameInfoSize) {\n...\nRenderProxy* proxy = reinterpret_cast&lt;RenderProxy*&gt;(proxyPtr);\nenv-&gt;GetLongArrayRegion(frameInfo, 0, frameInfoSize, proxy-&gt;frameInfo());\nreturn proxy-&gt;syncAndDrawFrame();\n}\n/*frameworks/base/libs/hwui/renderthread/RenderProxy.cpp*/\nint RenderProxy::syncAndDrawFrame() {\n// \u5524\u9192RenderThread\u6e32\u67d3\u7ebf\u7a0b\uff0c\u6267\u884cDrawFrame\u7ed8\u5236\u4efb\u52a1\nreturn mDrawFrameTask.drawFrame();\n}\n/*frameworks/base/libs/hwui/renderthread/DrawFrameTask.cpp*/\nint DrawFrameTask::drawFrame() {\n...\npostAndWait();\n...\n}\nvoid DrawFrameTask::postAndWait() {\nAutoMutex _lock(mLock);\n// \u5411RenderThread\u6e32\u67d3\u7ebf\u7a0b\u7684MessageQueue\u6d88\u606f\u961f\u5217\u653e\u5165\u4e00\u4e2a\u5f85\u6267\u884c\u4efb\u52a1\uff0c\u4ee5\u5c06\u5176\u5524\u9192\u6267\u884crun\u51fd\u6570\nmRenderThread-&gt;queue().post([this]() { run(); });\n// UI\u7ebf\u7a0b\u6682\u65f6\u8fdb\u5165wait\u7b49\u5f85\u72b6\u6001\nmSignal.wait(mLock);\n}\nvoid DrawFrameTask::run() {\n// \u539f\u751f\u6807\u8bc6\u4e00\u5e27\u6e32\u67d3\u7ed8\u5236\u4efb\u52a1\u7684systrace tag\nATRACE_NAME(\"DrawFrame\");\n...\n{\nTreeInfo info(TreeInfo::MODE_FULL, *mContext);\n//1.\u5c06UI\u7ebf\u7a0b\u6784\u5efa\u7684DisplayListOp\u7ed8\u5236\u547d\u4ee4\u6811\u540c\u6b65\u5230RenderThread\u6e32\u67d3\u7ebf\u7a0b\ncanUnblockUiThread = syncFrameState(info);\n...\n}\n...\n// \u540c\u6b65\u5b8c\u6210\u540e\u5219\u53ef\u4ee5\u5524\u9192UI\u7ebf\u7a0b\nif (canUnblockUiThread) {\nunblockUiThread();\n}\n...\nif (CC_LIKELY(canDrawThisFrame)) {\n// 2.\u6267\u884cdraw\u6e32\u67d3\u7ed8\u5236\u52a8\u4f5c\ncontext-&gt;draw();\n} else {\n...\n}\n...\n}\nbool DrawFrameTask::syncFrameState(TreeInfo&amp; info) {\nATRACE_CALL();\n...\n// \u8c03\u7528CanvasContext\u7684prepareTree\u51fd\u6570\u5b9e\u73b0\u7ed8\u5236\u547d\u4ee4\u6811\u540c\u6b65\u7684\u6d41\u7a0b\nmContext-&gt;prepareTree(info, mFrameInfo, mSyncQueued, mTargetNode);\n...\n}\n/*frameworks/base/libs/hwui/renderthread/CanvasContext.cpp*/\nvoid CanvasContext::prepareTree(TreeInfo&amp; info, int64_t* uiFrameInfo, int64_t syncQueued,\nRenderNode* target) {\n...\nfor (const sp&lt;RenderNode&gt;&amp; node : mRenderNodes) {\n...\n// \u9012\u5f52\u8c03\u7528\u5404\u4e2a\u5b50View\u5bf9\u5e94\u7684RenderNode\u6267\u884cprepareTree\u52a8\u4f5c\nnode-&gt;prepareTree(info);\n...\n}\n...\n}\n/*frameworks/base/libs/hwui/RenderNode.cpp*/\nvoid RenderNode::prepareTree(TreeInfo&amp; info) {\nATRACE_CALL();\n...\nprepareTreeImpl(observer, info, false);\n...\n}\nvoid RenderNode::prepareTreeImpl(TreeObserver&amp; observer, TreeInfo&amp; info, bool functorsNeedLayer) {\n...\nif (info.mode == TreeInfo::MODE_FULL) {\n// \u540c\u6b65\u7ed8\u5236\u547d\u4ee4\u6811\npushStagingDisplayListChanges(observer, info);\n}\nif (mDisplayList) {\n// \u904d\u5386\u8c03\u7528\u5404\u4e2a\u5b50View\u5bf9\u5e94\u7684RenderNode\u7684prepareTreeImpl\nbool isDirty = mDisplayList-&gt;prepareListAndChildren(\nobserver, info, childFunctorsNeedLayer,\n[](RenderNode* child, TreeObserver&amp; observer, TreeInfo&amp; info,\nbool functorsNeedLayer) {\nchild-&gt;prepareTreeImpl(observer, info, functorsNeedLayer);\n});\n...\n}\n...\n}\nvoid RenderNode::pushStagingDisplayListChanges(TreeObserver&amp; observer, TreeInfo&amp; info) {\n...\nsyncDisplayList(observer, &amp;info);\n...\n}\nvoid RenderNode::syncDisplayList(TreeObserver&amp; observer, TreeInfo* info) {\n...\n// \u5b8c\u6210\u8d4b\u503c\u540c\u6b65DisplayList\u5bf9\u8c61\nmDisplayList = mStagingDisplayList;\nmStagingDisplayList = nullptr;\n...\n}\nvoid CanvasContext::draw() {\n...\n// 1.\u8c03\u7528OpenGL\u5e93\u4f7f\u7528GPU\uff0c\u6309\u7167\u6784\u5efa\u597d\u7684\u7ed8\u5236\u547d\u4ee4\u5b8c\u6210\u754c\u9762\u7684\u6e32\u67d3\nbool drew = mRenderPipeline-&gt;draw(frame, windowDirty, dirty, mLightGeometry, &amp;mLayerUpdateQueue,\nmContentDrawBounds, mOpaque, mLightInfo, mRenderNodes,\n&amp;(profiler()));\n...\n// 2.\u5c06\u524d\u9762\u5df2\u7ecf\u7ed8\u5236\u6e32\u67d3\u597d\u7684\u56fe\u5f62\u7f13\u51b2\u533aBinder\u4e0a\u5e27\u7ed9SurfaceFlinger\u5408\u6210\u548c\u663e\u793a\nbool didSwap =\nmRenderPipeline-&gt;swapBuffers(frame, drew, windowDirty, mCurrentFrameInfo, &amp;requireSwap);\n...\n}\n</code></pre> <p>\u4ece\u4ee5\u4e0a\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff1a<code>UI</code>\u7ebf\u7a0b\u5229\u7528<code>RenderProxy</code>\u5411<code>RenderThread</code>\u7ebf\u7a0b\u53d1\u9001\u4e00\u4e2a<code>DrawFrameTask</code>\u4efb\u52a1\u8bf7\u6c42\uff0c<code>RenderThread</code>\u88ab\u5524\u9192\uff0c\u5f00\u59cb\u6e32\u67d3\uff0c\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li><code>syncFrameState</code>\u4e2d\u904d\u5386<code>View</code>\u6811\u4e0a\u6bcf\u4e00\u4e2a<code>RenderNode</code>\uff0c\u6267\u884c<code>prepareTreeImpl</code>\u51fd\u6570\uff0c\u5b9e\u73b0\u540c\u6b65\u7ed8\u5236\u547d\u4ee4\u6811\u7684\u64cd\u4f5c\uff1b</li> <li>\u8c03\u7528<code>OpenGL</code>\u5e93<code>API</code>\u4f7f\u7528<code>GPU</code>\u786c\u4ef6\uff0c\u6309\u7167\u6784\u5efa\u597d\u7684\u7ed8\u5236\u547d\u4ee4\u5b8c\u6210\u754c\u9762\u7684\u6e32\u67d3\uff08\u5177\u4f53\u8fc7\u7a0b\uff0c\u7531\u4e8e\u672c\u6587\u7bc7\u5e45\u6240\u9650\uff0c\u6682\u4e0d\u5c55\u5f00\u5206\u6790\uff09\uff1b</li> <li>\u5c06\u524d\u9762\u5df2\u7ecf\u7ed8\u5236\u6e32\u67d3\u597d\u7684\u56fe\u5f62\u7f13\u51b2\u533a<code>Binder</code>\u4e0a\u5e27\u7ed9<code>SurfaceFlinger</code>\u5408\u6210\u548c\u663e\u793a\uff1b</li> </ol> <p>\u6574\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u7528\u5982\u4e0b\u6d41\u7a0b\u56fe\u8868\u793a\uff1a</p> <p></p> <p>\u4ece<code>Systrace</code>\u4e0a\u8fd9\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#6-surfaceflinger","title":"6 SurfaceFlinger\u56fe\u5f62\u5408\u6210","text":"<p><code>SurfaceFlinger</code>\u5408\u6210\u663e\u793a\u90e8\u5206\u5c5e\u4e8e<code>Android</code>\u7cfb\u7edf<code>GUI</code>\u4e2d\u56fe\u5f62\u663e\u793a\u7684\u5185\u5bb9\uff0c\u7b80\u5355\u7684\u8bf4<code>SurfaceFlinger</code>\u4f5c\u4e3a\u7cfb\u7edf\u4e2d\u72ec\u7acb\u8fd0\u884c\u7684\u4e00\u4e2a<code>Native</code>\u8fdb\u7a0b\uff0c\u501f\u7528<code>Android</code>\u5b98\u7f51\u7684\u63cf\u8ff0\uff0c\u5176\u804c\u8d23\u5c31\u662f\u8d1f\u8d23\u63a5\u53d7\u6765\u81ea\u591a\u4e2a\u6765\u6e90\u7684\u6570\u636e\u7f13\u51b2\u533a\uff0c\u5bf9\u5b83\u4eec\u8fdb\u884c\u5408\u6210\uff0c\u7136\u540e\u53d1\u9001\u5230\u663e\u793a\u8bbe\u5907\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u5176\u5b9e<code>SurfaceFlinger</code>\u5728<code>Android</code>\u7cfb\u7edf\u7684\u6574\u4e2a\u56fe\u5f62\u663e\u793a\u7cfb\u7edf\u4e2d\u662f\u8d77\u5230\u4e00\u4e2a \u627f\u4e0a\u542f\u4e0b\u7684\u4f5c\u7528\uff1a</p> <ul> <li>\u5bf9\u4e0a\uff1a\u901a\u8fc7<code>Surface</code>\u4e0e\u4e0d\u540c\u7684\u5e94\u7528\u8fdb\u7a0b\u5efa\u7acb\u8054\u7cfb\uff0c\u63a5\u6536\u5b83\u4eec\u5199\u5165<code>Surface</code>\u4e2d\u7684\u7ed8\u5236\u7f13\u51b2\u6570\u636e\uff0c\u5bf9\u5b83\u4eec\u8fdb\u884c\u7edf\u4e00\u5408\u6210\u3002</li> <li>\u5bf9\u4e0b\uff1a\u901a\u8fc7\u5c4f\u5e55\u7684\u540e\u7f13\u5b58\u533a\u4e0e\u5c4f\u5e55\u5efa\u7acb\u8054\u7cfb\uff0c\u53d1\u9001\u5408\u6210\u597d\u7684\u6570\u636e\u5230\u5c4f\u5e55\u663e\u793a\u8bbe\u5907\u3002</li> </ul> <p>\u56fe\u5f62\u7684\u4f20\u9012\u662f\u901a\u8fc7<code>Buffer</code>\u4f5c\u4e3a\u8f7d\u4f53\uff0c<code>Surface</code>\u662f\u5bf9<code>Buffer</code>\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u4e5f\u5c31\u662f\u8bf4<code>Surface</code>\u5185\u90e8\u5177\u6709\u591a\u4e2a<code>Buffer</code>\u4f9b\u4e0a\u5c42\u4f7f\u7528\uff0c\u5982\u4f55\u7ba1\u7406\u8fd9\u4e9b<code>Buffer</code>\u5462\uff1f\u7b54\u6848\u5c31\u662f<code>BufferQueue</code> \uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b<code>BufferQueue</code>\u7684\u5de5\u4f5c\u539f\u7406\uff1a</p>"},{"location":"perf-opt/Android/jank/jank-principle/#61-bufferqueue","title":"6.1 BufferQueue\u673a\u5236","text":"<p>\u501f\u7528\u4e00\u5f20\u7ecf\u5178\u7684\u56fe\u6765\u63cf\u8ff0<code>BufferQueue</code>\u7684\u5de5\u4f5c\u539f\u7406\uff1a</p> <p></p> <p>BufferQueue\u72b6\u6001\u8f6c\u6362\u56fe.jpg</p> <p><code>BufferQueue</code>\u662f\u4e00\u4e2a\u5178\u578b\u7684 \u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b \u4e2d\u7684\u6570\u636e\u7ed3\u6784\u3002\u5728<code>Android</code>\u5e94\u7528\u7684\u6e32\u67d3\u6d41\u7a0b\u4e2d\uff0c\u5e94\u7528\u626e\u6f14\u7684\u5c31\u662f\u201c\u751f\u4ea7\u8005\u201d\u7684\u89d2\u8272\uff0c\u800c<code>SurfaceFlinger</code>\u626e\u6f14\u7684\u5219\u662f\u201c\u6d88\u8d39\u8005\u201d\u7684\u89d2\u8272\uff0c\u5176\u914d\u5408\u5de5\u4f5c\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u5e94\u7528\u8fdb\u7a0b\u4e2d\u5728\u5f00\u59cb\u754c\u9762\u7684\u7ed8\u5236\u6e32\u67d3\u4e4b\u524d\uff0c\u9700\u8981\u901a\u8fc7<code>Binder</code>\u8c03\u7528<code>dequeueBuffer</code>\u63a5\u53e3\u4ece<code>SurfaceFlinger</code>\u8fdb\u7a0b\u4e2d\u7ba1\u7406\u7684<code>BufferQueue</code> \u4e2d\u7533\u8bf7\u4e00\u5f20\u5904\u4e8e<code>free</code>\u72b6\u6001\u7684\u53ef\u7528<code>Buffer</code>\uff0c\u5982\u679c\u6b64\u65f6\u6ca1\u6709\u53ef\u7528<code>Buffer</code>\u5219\u963b\u585e\u7b49\u5f85\uff1b</li> <li>\u5e94\u7528\u8fdb\u7a0b\u4e2d\u62ff\u5230\u8fd9\u5f20\u53ef\u7528\u7684<code>Buffer</code>\u4e4b\u540e\uff0c\u9009\u62e9\u4f7f\u7528<code>CPU</code>\u8f6f\u4ef6\u7ed8\u5236\u6e32\u67d3\u6216<code>GPU</code>\u786c\u4ef6\u52a0\u901f\u7ed8\u5236\u6e32\u67d3\uff0c\u6e32\u67d3\u5b8c\u6210\u540e\u518d\u901a\u8fc7<code>Binder</code>\u8c03\u7528<code>queueBuffer</code>\u63a5\u53e3\u5c06\u7f13\u5b58\u6570\u636e\u8fd4\u56de\u7ed9\u5e94\u7528\u8fdb\u7a0b\u5bf9\u5e94\u7684<code>BufferQueue</code>\uff08\u5982\u679c\u662f <code>GPU</code> \u6e32\u67d3\u7684\u8bdd\uff0c\u8fd9\u91cc\u8fd8\u6709\u4e2a <code>GPU</code>\u5904\u7406\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u8fd9\u4e2a <code>Buffer</code> \u4e0d\u4f1a\u9a6c\u4e0a\u53ef\u7528\uff0c\u9700\u8981\u7b49 <code>GPU</code> \u6e32\u67d3\u5b8c\u6210\u7684<code>Fence</code>\u4fe1\u53f7\uff09\uff0c\u5e76\u7533\u8bf7<code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4ee5\u4fbf\u5524\u9192\u201c\u6d88\u8d39\u8005\u201d<code>SurfaceFlinger</code>\u8fdb\u884c\u6d88\u8d39\uff1b</li> <li><code>SurfaceFlinger</code> \u5728\u6536\u5230 <code>Vsync</code> \u4fe1\u53f7\u4e4b\u540e\uff0c\u5f00\u59cb\u51c6\u5907\u5408\u6210\uff0c\u4f7f\u7528 <code>acquireBuffer</code>\u83b7\u53d6\u5e94\u7528\u5bf9\u5e94\u7684 <code>BufferQueue</code> \u4e2d\u7684 <code>Buffer</code> \u5e76\u8fdb\u884c\u5408\u6210\u64cd\u4f5c\uff1b</li> <li>\u5408\u6210\u7ed3\u675f\u540e\uff0c<code>SurfaceFlinger</code> \u5c06\u901a\u8fc7\u8c03\u7528 <code>releaseBuffer</code>\u5c06 <code>Buffer</code> \u7f6e\u4e3a\u53ef\u7528\u7684<code>free</code>\u72b6\u6001\uff0c\u8fd4\u56de\u5230\u5e94\u7528\u5bf9\u5e94\u7684 <code>BufferQueue</code>\u4e2d\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-principle/#62-vsync","title":"6.2 Vsync\u540c\u6b65\u673a\u5236","text":"<p>\u5728\u4e4b\u524d<code>3.3</code>\u5c0f\u8282\u5173\u4e8e<code>Android</code>\u7cfb\u7edf\u5c4f\u5e55\u5237\u65b0\u673a\u5236\u4e2d\u6211\u4eec\u5206\u6790\u4e86<code>Vsync</code>\u673a\u5236\u7684\u6765\u9f99\u53bb\u8109\u3002\u5176\u5b9e<code>Android</code>\u7cfb\u7edf\u4e2d\u7684<code>Vsync</code>\u4fe1\u53f7\u7684\u4ea7\u751f\u4e0e\u7ba1\u7406\u90fd\u662f\u7531<code>SurfaceFlinger</code>\u6a21\u5757\u7edf\u4e00\u8d1f\u8d23\u7684\uff0c<code>Vysnc</code>\u4fe1\u53f7\u4e00\u822c\u5206\u4e3a\u4e24\u79cd\u7c7b\u578b\uff1a</p> <ol> <li><code>app</code>\u7c7b\u578b\u7684<code>Vsync</code>\uff1a<code>app</code>\u7c7b\u578b\u7684<code>Vysnc</code>\u4fe1\u53f7\u7531\u4e0a\u5c42\u5e94\u7528\u4e2d\u7684<code>Choreographer</code>\u6839\u636e\u7ed8\u5236\u9700\u6c42\u8fdb\u884c\u6ce8\u518c\u548c\u63a5\u6536\uff0c\u7528\u4e8e\u63a7\u5236\u5e94\u7528UI\u7ed8\u5236\u4e0a\u5e27\u7684\u751f\u4ea7\u8282\u594f\u3002\u6839\u636e<code>3.4</code>\u5c0f\u7ed3\u4e2d\u7684\u5206\u6790\uff1a\u5e94\u7528\u5728UI\u7ebf\u7a0b\u4e2d\u8c03\u7528<code>invalidate</code>\u5237\u65b0\u754c\u9762\u7ed8\u5236\u65f6\uff0c\u9700\u8981\u5148\u900f\u8fc7<code>Choreographer</code>\u5411\u7cfb\u7edf\u7533\u8bf7\u6ce8\u518c<code>app</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\uff0c\u5f85<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\uff0c\u624d\u80fd\u5f80\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\u653e\u5165\u5f85\u7ed8\u5236\u4efb\u52a1\u8fdb\u884c\u771f\u6b63<code>UI</code>\u7684\u7ed8\u5236\u52a8\u4f5c\uff1b</li> <li><code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>:<code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>\u662f\u7528\u4e8e\u63a7\u5236<code>SurfaceFlinger</code>\u7684\u5408\u6210\u6d88\u8d39\u8282\u594f\u3002\u5e94\u7528\u5b8c\u6210\u754c\u9762\u7684\u7ed8\u5236\u6e32\u67d3\u540e\uff0c\u901a\u8fc7<code>Binder</code>\u8c03\u7528<code>queueBuffer</code>\u63a5\u53e3\u5c06\u7f13\u5b58\u6570\u636e\u8fd4\u8fd8\u7ed9\u5e94\u7528\u5bf9\u5e94\u7684<code>BufferQueue</code>\u65f6\uff0c\u4f1a\u7533\u8bf7<code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>\uff0c\u5f85<code>SurfaceFlinger</code> \u5728\u5176UI\u7ebf\u7a0b\u4e2d\u6536\u5230 <code>Vsync</code> \u4fe1\u53f7\u4e4b\u540e\uff0c\u4fbf\u5f00\u59cb\u8fdb\u884c\u754c\u9762\u7684\u5408\u6210\u64cd\u4f5c\u3002</li> </ol> <p><code>Vsync</code>\u4fe1\u53f7\u7684\u751f\u6210\u662f\u53c2\u8003\u5c4f\u5e55\u786c\u4ef6\u7684\u5237\u65b0\u5468\u671f\u7684\uff0c\u5176\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-principle/#63","title":"6.3 \u5e27\u6570\u636e\u7684\u63d0\u4ea4\u6d88\u8d39\u8fc7\u7a0b","text":"<p>\u6211\u4eec\u63a5\u7740<code>3.5.2</code>\u5c0f\u8282\u4e2d\u7684\u5206\u6790\uff0c\u5e94\u7528\u8fdb\u7a0b\u7684<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\u5728\u6267\u884c\u5b8c\u4e00\u5e27\u753b\u9762\u7684\u6e32\u67d3\u64cd\u4f5c\u7684\u6700\u540e\uff0c\u4f1a\u901a\u8fc7<code>Binder</code>\u8c03\u7528<code>queueBuffer</code>\u63a5\u53e3\u5c06\u4e00\u5e27\u6570\u636e\u63d0\u4ea4\u7ed9<code>SurfaceFlinger</code>\u8fdb\u7a0b\u8fdb\u884c\u6d88\u8d39\u5408\u6210\u663e\u793a\u3002\u6211\u4eec\u7ed3\u5408\u76f8\u5173\u7b80\u5316\u7684\u6e90\u7801\u6d41\u7a0b\uff08\u8fd9\u91cc\u57fa\u4e8e<code>Android 11</code>\u6e90\u4ee3\u7801\u5206\u6790\uff09\u6765\u770b\u770b<code>SurfaceFlinger</code>\u4e2d\u662f\u5982\u4f55\u5904\u7406\u5e94\u7528\u7684\u8bf7\u6c42\u7684\u3002</p> <pre><code>/*frameworks/native/libs/gui/BufferQueueProducer.cpp*/\nstatus_t BufferQueueProducer::queueBuffer(int slot,\nconst QueueBufferInput &amp;input, QueueBufferOutput *output) {\nATRACE_CALL();\n......\nif (frameAvailableListener != nullptr) {\nframeAvailableListener-&gt;onFrameAvailable(item);\n}\n......\n}\n</code></pre> <p>\u4e0a\u9762\u7684<code>frameAvailableListener</code>\u662f<code>BufferQueueLayer</code>\uff1a</p> <pre><code>/*frameworks/native/services/surfaceflinger/BufferQueueLayer.cpp*/\nvoid BufferQueueLayer::onFrameAvailable(const BufferItem&amp; item) {\n......\nmFlinger-&gt;signalLayerUpdate();//\u8fd9\u91cc\u89e6\u53d1\u7533\u8bf7\u4e00\u4e0b\u4e2aVsync-sf\u4fe1\u53f7\n......\n}\n/*frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp*/\nvoid SurfaceFlinger::signalLayerUpdate() {\n......\nmEventQueue-&gt;invalidate();\n......\n}\n/*frameworks/native/services/surfaceflinger/Scheduler/MessageQueue.cpp*/\nvoid MessageQueue::invalidate() {\n......\nmEvents-&gt;requestNextVsync();// \u7533\u8bf7\u4e00\u4e0b\u4e2aVsync-sf\u4fe1\u53f7\n......\n}\n</code></pre> <p>\u4ee5\u4e0a\u8fc7\u7a0b\u4ece<code>Systrace</code>\u4e0a\u770b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p></p> <p>\u7531\u4e0a\u9762\u5206\u6790\u53ef\u77e5\uff0c\u53ea\u8981\u6709<code>layer</code>\u4e0a\u5e27\uff0c\u90a3\u4e48\u5c31\u4f1a\u7533\u8bf7\u4e0b\u4e00\u6b21\u7684<code>Vsync-sf</code>\u4fe1\u53f7\uff0c \u5f53<code>Vsync-sf</code>\u4fe1\u53f7\u6765\u65f6\u4f1a\u8c03\u7528<code>onMessageReceived</code>\u51fd\u6570\u6765\u5904\u7406\u5e27\u6570\u636e\uff1a</p> <pre><code>/*frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp*/\nvoid SurfaceFlinger::onMessageInvalidate(nsecs_t expectedVSyncTime) {\nATRACE_CALL();\n......\nrefreshNeeded |= handleMessageInvalidate();\n......\nsignalRefresh();//\u518d\u6b21\u5411\u6d88\u606f\u961f\u5217\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\uff0c\u6d88\u606f\u5230\u8fbe\u65f6\u4f1a\u8c03\u7528onMessageRefresh\n......\n}\nbool SurfaceFlinger::handleMessageInvalidate() {\nATRACE_CALL();\nbool refreshNeeded = handlePageFlip();\n......\n}\n</code></pre> <p>\u5728<code>handleMessageInvalidate</code>\u91cc\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u51fd\u6570\u662f<code>handlePageFlip</code>():</p> <pre><code>/*frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp*/\nbool SurfaceFlinger::handlePageFlip()\n{\nATRACE_CALL();\n......\nmDrawingState.traverse([&amp;](Layer* layer) {\nif (layer-&gt;hasReadyFrame()) {\nframeQueued = true;\nif (layer-&gt;shouldPresentNow(expectedPresentTime)) {\nmLayersWithQueuedFrames.push_back(layer);\n} .......\n} ......\n});\n......\nfor (auto&amp; layer : mLayersWithQueuedFrames) {\nif (layer-&gt;latchBuffer(visibleRegions, latchTime, expectedPresentTime)) {\nmLayersPendingRefresh.push_back(layer);\n}\n.......\n}\n......\n}\n</code></pre> <p>\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\u6765\uff0c<code>handlePageFlip</code>\u91cc\u4e00\u4e2a\u91cd\u8981\u7684\u5de5\u4f5c\u662f\u68c0\u67e5\u6240\u6709\u7684<code>Layer</code>\u662f\u5426\u6709\u65b0<code>Buffer</code>\u63d0\u4ea4\uff0c\u5982\u679c\u6709\u5219\u8c03\u7528\u5176<code>latchBuffer</code>\u6765\u5904\u7406\uff1a</p> <pre><code>/*frameworks/native/services/surfaceflinger/BufferLayer.cpp*/\nbool BufferLayer::latchBuffer(bool&amp; recomputeVisibleRegions, nsecs_t latchTime,\nnsecs_t expectedPresentTime) {\nATRACE_CALL();\n......\nstatus_t err = updateTexImage(recomputeVisibleRegions, latchTime, expectedPresentTime);\n......\n}\n/*frameworks/native/services/surfaceflinger/BufferQueuedLayer.cpp*/\nstatus_t BufferQueueLayer::updateTexImage(bool&amp; recomputeVisibleRegions, nsecs_t latchTime,\nnsecs_t expectedPresentTime) {\n......\nstatus_t updateResult = mConsumer-&gt;updateTexImage(&amp;r, expectedPresentTime, &amp;mAutoRefresh,\n&amp;queuedBuffer, maxFrameNumberToAcquire);\n......\n}\n/*frameworks/native/services/surfaceflinger/BufferLayerConsumer.cpp*/\nstatus_t BufferLayerConsumer::updateTexImage(BufferRejecter* rejecter, nsecs_t expectedPresentTime,\nbool* autoRefresh, bool* queuedBuffer,\nuint64_t maxFrameNumber) {\nATRACE_CALL();\n......\nstatus_t err = acquireBufferLocked(&amp;item, expectedPresentTime, maxFrameNumber);\n......\n}\nstatus_t ConsumerBase::acquireBufferLocked(BufferItem *item,\nnsecs_t presentWhen, uint64_t maxFrameNumber) {\n......\nstatus_t err = mConsumer-&gt;acquireBuffer(item, presentWhen, maxFrameNumber);\n......\n}\n</code></pre> <p>\u8fd9\u91cc\u8c03\u7528\u5230\u4e86<code>BufferLayerConsumer</code>\u7684\u57fa\u7c7b<code>ConsumerBase</code>\u91cc\uff1a</p> <pre><code>/*frameworks/native/libs/gui/ConsumerBase.cpp*/\nstatus_t ConsumerBase::acquireBufferLocked(BufferItem *item,\nnsecs_t presentWhen, uint64_t maxFrameNumber) {\n......\nstatus_t err = mConsumer-&gt;acquireBuffer(item, presentWhen, maxFrameNumber);\n......\n}\n</code></pre> <p>\u5230\u8fd9\u91cc<code>onMessageInvalidate</code>\u4e2d\u7684\u4e3b\u8981\u5de5\u4f5c\u7ed3\u675f\uff0c\u5728\u8fd9\u4e2a\u51fd\u6570\u7684\u5904\u7406\u4e2d\uff1a<code>SurfaceFlinger</code>\u4e3b\u8981\u662f\u68c0\u67e5\u6bcf\u4e2a<code>Layer</code>\u662f\u5426\u6709\u65b0\u63d0\u4ea4\u7684<code>Buffer</code>\uff0c \u5982\u679c\u6709\u5219\u8c03\u7528<code>latchBuffer</code>\u5c06\u6bcf\u4e2a<code>BufferQueue</code>\u4e2d\u7684<code>Slot</code> \u901a\u8fc7<code>acquireBuffer</code>\u62ff\u8d70\u3002\u6b64\u8fc7\u7a0b\u4ece<code>Systrace</code>\u4e0a\u770b\u5982\u4e0b\u56fe\u6709\u6240\u793a\uff1a</p> <p></p> <p>\u4e4b\u540e<code>acquireBuffer</code>\u62ff\u8d70\u7684<code>Buffer</code>(<code>Slot</code>\u5bf9\u5e94\u7684\u72b6\u6001\u662f<code>ACQUIRED</code>\u72b6\u6001)\u4f1a\u88ab\u4ea4\u7531<code>HWC``Service</code>\u5904\u7406\uff0c\u8fd9\u90e8\u5206\u662f\u5728<code>onMessageRefresh</code>\u4e2d\u5904\u7406\u7684\uff1a</p> <pre><code>/*frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp*/\nvoid SurfaceFlinger::onMessageRefresh() {\nATRACE_CALL();\n......\nmCompositionEngine-&gt;present(refreshArgs);\n......\n\uff5d\n/*frameworks/native/services/surfaceflinger/CompositionEngine/src/CompositionEngine.cpp*/\nvoid CompositionEngine::present(CompositionRefreshArgs&amp; args) {\nATRACE_CALL();\n......\nfor (const auto&amp; output : args.outputs) {\noutput-&gt;present(args);\n}\n......\n}\n/*frameworks/native/services/surfaceflinger/CompositionEngine/src/Output.cpp*/\nvoid Output::present(const compositionengine::CompositionRefreshArgs&amp; refreshArgs) {\nATRACE_CALL();\n......\nupdateAndWriteCompositionState(refreshArgs);//\u544a\u77e5HWC service\u6709\u54ea\u4e9blayer\u8981\u53c2\u4e0e\u5408\u6210\n......\nbeginFrame();\nprepareFrame();\n......\nfinishFrame(refreshArgs);\npostFramebuffer();//\u8fd9\u91cc\u4f1a\u8c03\u7528\u5230HWC service\u7684\u63a5\u53e3\u53bbpresent display\u5408\u6210\u753b\u9762\n}\nvoid Output::postFramebuffer() {\n......\nauto frame = presentAndGetFrameFences();\n......\n}\n/*frameworks/native/services/surfaceflinger/displayhardware/HWComposer.cpp*/\nstatus_t HWComposer::presentAndGetReleaseFences(DisplayId displayId) {\nATRACE_CALL();\n......\nauto error = hwcDisplay-&gt;present(&amp;displayData.lastPresentFence);//\u9001\u53bbHWC service\u5408\u6210\n......\nstd::unordered_map&lt;HWC2::Layer*, sp&lt;Fence&gt;&gt; releaseFences;\nerror = hwcDisplay-&gt;getReleaseFences(&amp;releaseFences);\nRETURN_IF_HWC_ERROR_FOR(\"getReleaseFences\", error, displayId, UNKNOWN_ERROR);\ndisplayData.releaseFences = std::move(releaseFences);//\u83b7\u53d6releaseFence, \u4ee5\u4fbf\u901a\u77e5\u5230\u5404\u4e2aSlot, buffer\u88abrelease\u540e\u4f1a\u901a\u8fc7dequeueBuffer\u7ed9\u5230\u5e94\u7528\uff0c\u5e94\u7528\u5728\u7ed8\u56fe\u524d\u4f1a\u7b49\u5f85releaseFence\n......\n}\n</code></pre> <p>\u4ee5\u4e0a\u8fc7\u7a0b\u4ece<code>systrace</code>\u4e0a\u770b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6700\u540e\u603b\u7ed3\u4e00\u4e0b\u5e94\u7528\u8c03\u7528<code>queueBuffer</code>\u5c06\u4e00\u5e27<code>Buffer</code>\u6570\u636e\u63d0\u5230<code>SurfaceFlinger</code>\u540e<code>SurfaceFlinger</code>\u7684\u4e3b\u8981\u5904\u7406\u6d41\u7a0b\uff0c\uff1a</p> <ol> <li>\u9996\u5148<code>Binder</code>\u7ebf\u7a0b\u4f1a\u901a\u8fc7<code>BufferQueue</code>\u673a\u5236\u628a\u5e94\u7528\u4e0a\u5e27\u7684<code>Slot</code>\u72b6\u6001\u6539\u4e3a<code>QUEUED</code>, \u7136\u540e\u628a\u8fd9\u4e2a<code>Slot</code>\u653e\u5165<code>mQueue</code>\u961f\u5217\uff0c \u7136\u540e\u901a\u8fc7<code>onFrameAvailable</code>\u56de\u8c03\u901a\u77e5\u5230<code>BufferQueueLayer</code>, \u5728\u5904\u7406\u51fd\u6570\u91cc\u4f1a\u8bf7\u6c42\u4e0b\u4e00\u6b21\u7684<code>Vsync-sf</code>\u4fe1\u53f7\uff1b</li> <li>\u5728<code>Vsync-sf</code>\u4fe1\u53f7\u5230\u6765\u540e\uff0c<code>SurfaceFlinger</code>\u4e3b\u7ebf\u7a0b\u8981\u6267\u884c\u4e24\u6b21<code>onMessageReceived</code>, \u7b2c\u4e00\u6b21\u8981\u68c0\u67e5\u6240\u6709\u7684<code>Layer</code>\u770b\u662f\u5426\u6709\u4e0a\u5e27\uff0c \u5982\u679c\u6709<code>Layer</code>\u4e0a\u5e27\u5c31\u8c03\u7528\u5b83\u7684<code>latchBuffer</code>\u628a\u5b83\u7684<code>Buffer</code> <code>acquireBuffer</code>\u53d6\u8d70\uff1b\u5e76\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\u5230\u4e3b\u6d88\u606f\u961f\u5217\uff0c\u8ba9\u4e3b\u7ebf\u7a0b\u518d\u6b21\u8d70\u8fdb<code>onMessageReceived</code>,\uff1b</li> <li>\u7b2c\u4e8c\u6b21\u8d70\u8fdb\u6765\u65f6\uff0c\u4e3b\u8981\u6267\u884c<code>present</code>\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e9b\u65b9\u6cd5\u91cc\u4f1a\u548c<code>HWC service</code>\u6c9f\u901a\uff0c\u8c03\u7528\u5b83\u7684\u8de8\u8fdb\u7a0b\u63a5\u53e3\u901a\u77e5\u5b83\u53bb\u505a\u56fe\u5c42\u7684\u5408\u6210\u540e\u9001\u663e\u793a\u5668\u663e\u793a\u3002</li> </ol> <p>\u540e\u7eed<code>HWC service</code>\u7684\u5408\u6210\u4ee5\u53ca\u5c4f\u5e55\u7684\u8be6\u7ec6\u663e\u793a\u539f\u7406\u7531\u4e8e\u7bc7\u5e45\u6709\u9650\u5c31\u4e0d\u5c55\u5f00\u8bf4\u660e\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u53c2\u8003\u7cfb\u5217\u6587\u7ae0https://www.jianshu.com/p/df46e4b39428\u3002</p>"},{"location":"perf-opt/Android/jank/jank-principle/#7","title":"7 \u6d41\u7a0b\u603b\u7ed3\u4e0e\u5361\u987f\u5b9a\u4e49","text":""},{"location":"perf-opt/Android/jank/jank-principle/#71","title":"7.1 \u5e94\u7528\u7ed8\u5236\u4e0a\u5e27\u6d41\u7a0b\u603b\u7ed3","text":"<p>\u5728\u672c\u8282\u4e2d\u6211\u4eec\u4ee5\u7528\u6237\u624b\u6307\u4e0a\u4e0b\u6ed1\u52a8\u5e94\u7528\u754c\u9762\u7684\u64cd\u4f5c\u573a\u666f\u4e3a\u4f8b\uff0c\u7ed3\u5408\u7cfb\u7edf\u6e90\u7801\u548c<code>Systrace</code>\u5de5\u5177\uff0c\u6309\u7167\u6267\u884c\u987a\u5e8f\u5206\u6790\u4e86<code>Android</code>\u5e94\u7528\u7ed8\u5236\u4e0a\u5e27\u663e\u793a\u7684\u7cfb\u7edf\u8fd0\u884c\u673a\u5236\u4e0e\u603b\u4f53\u6d41\u7a0b\uff0c\u6211\u4eec\u4ee5\u4e00\u5f20\u56fe\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <p></p> <p>\u6700\u540e\u603b\u7ed3\u6574\u4e2a\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <ol> <li>\u7528\u6237\u624b\u6307\u89e6\u6478\u5c4f\u5e55\u540e\uff0c\u5c4f\u5e55\u9a71\u52a8\u4ea7\u751f<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\uff1b\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684<code>EventHub</code>\u901a\u8fc7<code>epoll</code>\u673a\u5236\u76d1\u542c\u5230\u9a71\u52a8\u4ea7\u751f\u7684<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u4e0a\u62a5\uff0c\u7531<code>InputReader</code>\u8bfb\u53d6\u5230<code>Input</code>\u4e8b\u4ef6\u540e\uff0c\u5524\u9192<code>InputDispatcher</code>\u627e\u5230\u5f53\u524d\u89e6\u63a7\u7126\u70b9\u5e94\u7528\u7a97\u53e3\uff0c\u5e76\u901a\u8fc7\u4e8b\u5148\u5efa\u7acb\u7684<code>socket</code>\u901a\u9053\u53d1\u9001<code>Input</code>\u4e8b\u4ef6\u5230\u5bf9\u5e94\u7684\u5e94\u7528\u8fdb\u7a0b\uff1b</li> <li>\u5e94\u7528\u8fdb\u7a0b\u6536\u5230<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u540e<code>UI</code>\u7ebf\u7a0b\u88ab\u5524\u9192\u8fdb\u884c\u4e8b\u4ef6\u7684\u5206\u53d1\uff0c\u76f8\u5173<code>View</code>\u63a7\u4ef6\u4e2d\u6839\u636e\u591a\u4e2a<code>ACTION_MOVE</code>\u7c7b\u578b\u7684<code>Input</code>\u4e8b\u4ef6\u5224\u65ad\u4e3a\u7528\u6237\u624b\u6307\u6ed1\u52a8\u884c\u4e3a\u540e\uff0c\u901a\u8fc7<code>Choreographer</code>\u5411\u7cfb\u7edf\u6ce8\u518c\u7533\u8bf7<code>app</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\uff0c\u5e76\u7b49\u5f85<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\u89e6\u53d1\u7ed8\u5236\u64cd\u4f5c\uff1b</li> <li><code>app</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\uff0c\u5524\u9192\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u5e76\u5411\u5176\u6d88\u606f\u961f\u5217\u4e2d\u653e\u5165\u4e00\u4e2a\u5f85\u6267\u884c\u7684\u7ed8\u5236\u4efb\u52a1\uff0c\u5728<code>UI</code>\u7ebf\u7a0b\u4e2d\u5148\u540e\u904d\u5386\u6267\u884c<code>View</code>\u63a7\u4ef6\u6811\u7684\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\uff08\u786c\u4ef6\u52a0\u901f\u9ed8\u8ba4\u5f00\u542f\u7684\u72b6\u6001\u4e0b\u4f1a\u904d\u5386\u5e76\u8bb0\u5f55\u6bcf\u4e2a<code>View</code>\u7684<code>draw</code>\u64cd\u4f5c\u751f\u6210\u5bf9\u5e94\u7684\u7ed8\u5236\u547d\u4ee4\u6811\uff09\u64cd\u4f5c\uff1b</li> <li><code>View</code>\u63a7\u4ef6\u6811\u7684\u7ed8\u5236\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u5524\u9192\u5e94\u7528\u7684<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\u6267\u884c\u754c\u9762\u6e32\u67d3\u4efb\u52a1\uff1b\u6574\u4e2a\u6e32\u67d3\u4efb\u52a1\u4e2d\u4f1a\u5148\u540c\u6b65<code>UI</code>\u7ebf\u7a0b\u4e2d\u6784\u5efa\u597d\u7684\u7ed8\u5236\u547d\u4ee4\u6811\uff0c\u7136\u540e\u901a\u8fc7<code>dequeueBuffer</code>\u7533\u8bf7\u4e00\u5f20\u5904\u4e8e<code>free</code>\u72b6\u6001\u7684\u53ef\u7528<code>Buffer</code>\uff0c\u7136\u540e\u8c03\u7528<code>SkiaOpenGLPipeline</code>\u6e32\u67d3\u7ba1\u9053\u4e2d\u4f7f\u7528<code>GPU</code>\u8fdb\u884c\u6e32\u67d3\u64cd\u4f5c\uff0c\u6e32\u67d3\u5b8c\u6210\u540e<code>swapBuffer</code>\u89e6\u53d1<code>queueBuffer</code>\u52a8\u4f5c\u8fdb\u884c\u4e0a\u5e27\uff1b</li> <li>\u5e94\u7528\u6e32\u67d3\u7ebf\u7a0b\u6700\u540e\u7684<code>queueBuffer</code>\u4e0a\u5e27\u52a8\u4f5c\uff0c\u4f1a\u5524\u9192\u5bf9\u7aef<code>SurfaceFlinger</code>\u8fdb\u7a0b\u4e2d\u7684<code>Binder</code>\u5904\u7406\u7ebf\u7a0b\uff0c\u5176\u4e2d\u5c06\u5bf9\u5e94\u7528<code>BufferQuque</code>\u4e2d\u7684<code>Buffer</code>\u6807\u8bb0\u4e3a<code>Queued</code>\u72b6\u6001\uff0c\u7136\u540e\u6ce8\u518c\u7533\u8bf7<code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\uff1b</li> <li>\u5f85<code>sf</code>\u7c7b\u578b\u7684<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\u4f1a\u5524\u9192<code>SurfaceFlinger</code>\u7684\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e00\u5e27\u7684\u5408\u6210\u4efb\u52a1\uff0c\u5176\u4e2d\u4f1a\u5148\u901a\u8fc7<code>handlePageFlip</code>\u64cd\u4f5c\u904d\u5386\u6240\u6709\u7684\u5e94\u7528<code>Layer</code>\u627e\u5230\u6709\u4e0a\u5e27\u64cd\u4f5c\u7684\u5904\u4e8e<code>Queued</code>\u72b6\u6001\u7684<code>Buffer</code>\u8fdb\u884c<code>AcquireBuffer</code>\u83b7\u53d6\u6807\u8bb0\u9501\u5b9a\uff0c\u7136\u540e\u6267\u884c<code>persent</code>\u52a8\u4f5c\u8c03\u7528\u5524\u9192<code>HWC service</code>\u8fdb\u7a0b\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6267\u884c\u5177\u4f53\u7684\u56fe\u5c42\u7684\u5408\u6210\u9001\u663e\u64cd\u4f5c\uff1b</li> <li><code>HWC service</code>\u4e2d\u6700\u7ec8\u4f1a\u6536\u5230<code>SurfaceFlinger</code>\u7684\u8bf7\u6c42\u540e\uff0c\u8fdb\u884c\u56fe\u5c42\u5408\u6210\u64cd\u4f5c\uff0c\u6700\u7ec8\u901a\u8fc7\u8c03\u7528<code>libDrm</code>\u5e93\u76f8\u5173\u63a5\u53e3<code>Commit</code>\u63d0\u4ea4<code>Buffer</code>\u6570\u636e\u5230Kernel\u5185\u6838\u4e2d\u7684\u5c4f\u5e55\u9a71\u52a8\uff0c\u5e76\u6700\u7ec8\u9001\u5230\u5c4f\u5e55\u786c\u4ef6\u4e0a\u663e\u793a\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-principle/#72","title":"7.2 \u5361\u987f\u7684\u5b9a\u4e49","text":"<p>\u6839\u636e\u672c\u8282\u4e2d\u6211\u4eec\u5bf9<code>Android</code>\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u539f\u7406\u5206\u6790\uff0c\u6211\u4eec\u521d\u6b65\u53ef\u4ee5\u5224\u65ad\uff1a\u5982\u679c\u5728\u4e00\u4e2a<code>Vsync</code>\u5468\u671f\u5185\uff08<code>60HZ</code>\u7684\u5c4f\u5e55\u4e0a\u5c31\u662f<code>16.6ms</code>\uff09\uff0c\u6309\u7167\u6574\u4e2a\u4e0a\u5e27\u663e\u793a\u7684\u6267\u884c\u7684\u987a\u5e8f\u6765\u770b\uff0c\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u7684\u7ed8\u5236\u3001<code>RenderThread</code>\u7ebf\u7a0b\u7684\u6e32\u67d3\u3001<code>SurfaceFlinger/HWC</code>\u7684\u56fe\u5c42\u5408\u6210\u4ee5\u53ca\u6700\u7ec8\u5c4f\u5e55\u4e0a\u7684\u663e\u793a\u8fd9\u4e9b\u52a8\u4f5c\u6ca1\u6709\u5168\u90e8\u90fd\u6267\u884c\u5b8c\u6210\u7684\u8bdd\uff0c\u5c4f\u5e55\u4e0a\u5c31\u4f1a\u663e\u793a\u4e0a\u4e00\u5e27\u753b\u9762\u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u6389\u5e27\uff0c\u800c\u4eba\u7684\u8089\u773c\u5c31\u53ef\u80fd\u4f1a\u611f\u89c9\u5230\u753b\u9762\u5361\u987f\uff08\u7531\u4e8e <code>Triple Buffer</code> \u7684\u5b58\u5728\uff0c\u8fd9\u91cc\u4e5f\u6709\u53ef\u80fd\u4e0d\u6389\u5e27\uff09\u3002</p> <p>\u8fd9\u91cc\u501f\u7528\u9ad8\u7237\u7684\u4e00\u6bb5\u7ecf\u5178\u63cf\u8ff0\u4ece\u4e09\u4e2a\u65b9\u9762\u5b9a\u4e49\u5361\u987f\uff1a</p> <ol> <li>\u4ece\u73b0\u8c61\u4e0a\u6765\u8bf4\uff0c\u5728 <code>App</code> \u8fde\u7eed\u7684\u52a8\u753b\u64ad\u653e\u6216\u8005\u624b\u6307\u6ed1\u52a8\u5217\u8868\u65f6\uff08\u5173\u952e\u662f\u8fde\u7eed\uff09\uff0c\u5982\u679c\u8fde\u7eed <code>2</code> \u5e27\u6216\u8005 <code>2</code> \u5e27\u4ee5\u4e0a\uff0c\u5e94\u7528\u7684\u753b\u9762\u90fd\u6ca1\u6709\u53d8\u5316\uff0c\u90a3\u4e48\u6211\u4eec\u8ba4\u4e3a\u8fd9\u91cc\u53d1\u751f\u4e86\u5361\u987f\uff1b</li> <li>\u4ece <code>SurfaceFlinger</code> \u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u5728 <code>App</code> \u8fde\u7eed\u7684\u52a8\u753b\u64ad\u653e\u6216\u8005\u624b\u6307\u6ed1\u52a8\u5217\u8868\u65f6\uff08\u5173\u952e\u662f\u8fde\u7eed\uff09\uff0c\u5982\u679c\u6709\u4e00\u4e2a <code>Vsync</code> \u5230\u6765\u7684\u65f6\u5019 \uff0c<code>App</code> \u6ca1\u6709\u53ef\u4ee5\u7528\u6765\u5408\u6210\u7684 <code>Buffer</code>\uff0c\u90a3\u4e48\u8fd9\u4e2a <code>Vsync</code> \u5468\u671f <code>SurfaceFlinger</code> \u5c31\u4e0d\u4f1a\u8d70\u5408\u6210\u7684\u903b\u8f91\uff08\u6216\u8005\u662f\u53bb\u5408\u6210\u5176\u4ed6\u7684 <code>Layer</code>\uff09\uff0c\u90a3\u4e48\u8fd9\u4e00\u5e27\u5c31\u4f1a\u663e\u793a <code>App</code> \u7684\u4e0a\u4e00\u5e27\u7684\u753b\u9762\uff0c\u6211\u4eec\u8ba4\u4e3a\u8fd9\u91cc\u53d1\u751f\u4e86\u5361\u987f\uff1b</li> <li>\u4ece <code>App</code> \u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5982\u679c\u6e32\u67d3\u7ebf\u7a0b\u5728\u4e00\u4e2a <code>Vsync</code> \u5468\u671f\u5185\u6ca1\u6709 <code>queueBuffer</code> \u5230 <code>SurfaceFlinger</code> \u4e2d <code>App</code> \u5bf9\u5e94\u7684 <code>BufferQueue</code> \u4e2d\uff0c\u90a3\u4e48\u6211\u4eec\u8ba4\u4e3a\u8fd9\u91cc\u53d1\u751f\u4e86\u5361\u987f\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-principle/#8","title":"8 \u53c2\u8003","text":"<p>\u6458\u81ea https://www.jianshu.com/p/386bbb5fa29a</p>"},{"location":"perf-opt/Android/jank/jank-shizhan/","title":"Android\u5361\u987f\u6389\u5e27\u95ee\u9898\u5206\u6790\u4e4b\u5b9e\u6218\u7bc7","text":"<p>\u672c\u6587\u662f<code>Android</code>\u5361\u987f\u95ee\u9898\u5206\u6790\u4e09\u90e8\u66f2\u7684\u6700\u540e\u4e00\u7bc7\u3002\u5728\u524d\u9762\u4e24\u7bc7\u6587\u7ae0\u7684\u7406\u8bba\u548c\u5de5\u5177\u7684\u5206\u6790\u57fa\u7840\u4e0a\uff0c\u672c\u6587\u5c06\u7ed3\u5408\u5178\u578b\u5b9e\u6218\u6848\u4f8b\uff0c\u5206\u6790\u5e38\u89c1\u7684\u9020\u6210\u5361\u987f\u7b49\u6027\u80fd\u95ee\u9898\u7684\u539f\u56e0\u3002\u4ece\u7cfb\u7edf\u5de5\u7a0b\u5e08\u7684\u603b\u4f53\u89d2\u5ea6\u6765\u770b \uff0c\u9020\u6210\u5361\u987f\u7b49\u6027\u80fd\u95ee\u9898\u7684\u539f\u56e0\u603b\u4f53\u4e0a\u5927\u81f4\u5206\u4e3a\u4e09\u4e2a\u5927\u7c7b\uff1a\u4e00\u7c7b\u662f\u6d41\u7a0b\u6267\u884c\u5f02\u5e38\uff1b\u4e8c\u662f\u7cfb\u7edf\u8d1f\u8f7d\u5f02\u5e38\uff1b\u4e09\u662f\u7f16\u8bd1\u95ee\u9898\u5f15\u8d77\u3002</p>"},{"location":"perf-opt/Android/jank/jank-shizhan/#1","title":"1 \u6d41\u7a0b\u6267\u884c\u5f02\u5e38","text":"<p>\u5728\u524d\u6587<code>Android</code>\u5361\u987f\u6389\u5e27\u95ee\u9898\u5206\u6790\u4e4b\u539f\u7406\u7bc7\u7684\u5185\u5bb9\u4e2d\uff0c\u6211\u4eec\u4ee5\u6ed1\u52a8\u573a\u666f\u4e3a\u4f8b\u5b8c\u6574\u7684\u5206\u6790\u4e86<code>Android</code>\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u5168\u6d41\u7a0b\uff08\u9ed8\u8ba4\u5f00\u542f\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\u6761\u4ef6\u4e0b\uff09\u3002\u4e0b\u9762\u6211\u4eec\u7528\u4e00\u5f20\u56fe\u6765\u770b\u770b\u8fd9\u4e2a\u6d41\u7a0b\u4e0a\u53ef\u80fd\u5f15\u8d77\u5361\u987f\u3001\u53cd\u5e94\u5ef6\u8fdf\u7b49\u6027\u80fd\u95ee\u9898\u7684\u70b9\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u5728<code>Android</code>\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u5404\u4e2a\u6d41\u7a0b\u4e0a\u90fd\u53ef\u80fd\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u51fa\u73b0\u5361\u987f\u3001\u53cd\u5e94\u5ef6\u8fdf\u7b49\u6027\u80fd\u95ee\u9898\u3002\u4e0b\u9762\u6211\u4eec\u5206\u7c7b\u6765\u5206\u6790\u4e00\u4e0b\u5404\u4e2a\u6d41\u7a0b\u4e0a\u53ef\u80fd\u7684\u5f15\u8d77\u5361\u987f\u7b49\u6027\u80fd\u95ee\u9898\u7684\u70b9\u3002</p>"},{"location":"perf-opt/Android/jank/jank-shizhan/#11-system_server","title":"1.1 system_server\u5f15\u8d77\u5e94\u7528\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p>\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u5185\u90e8\u7684\u5404\u4e2a\u6838\u5fc3\u670d\u52a1<code>AMS</code>\u3001<code>WMS</code>\u3001<code>PKMS</code>\u7b49\uff0c\u90fd\u6709\u5404\u81ea\u7684\u5bf9\u8c61\u9501\u548c\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u5404\u4e2a\u670d\u52a1\u8fd0\u884c\u65f6\u76f8\u4e92\u4e4b\u95f4\u5b58\u5728\u4ea4\u4e92\uff0c\u53ef\u80fd\u51fa\u73b0\u67d0\u4e2a\u7ebf\u7a0b\u6301\u9501\u6267\u884c\u8017\u65f6\u64cd\u4f5c\u800c\u5176\u5b83\u7ebf\u7a0b\u9677\u5165\u957f\u65f6\u95f4\u9501\u7b49\u5f85\u7684\u60c5\u51b5\u3002\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5f53\u7cfb\u7edf\u6846\u67b6\u8d1f\u8f7d\u8fc7\u91cd\u6216\u6d41\u7a0b\u51fa\u73b0\u5f02\u5e38\u60c5\u51b5\u4e0b\uff0c\u5176\u5de5\u4f5c\u7ebf\u7a0b\u4e4b\u95f4\u76f8\u4e92\u7b49\u9501\u7684\u73b0\u8c61\u4f1a\u975e\u5e38\u4e25\u91cd\u3002\u5982\u679c\u6b64\u65f6\u5e94\u7528<code>App</code>\u7684<code>UI</code>\u7ebf\u7a0b\u4e2d\u6709<code>Binder</code>\u8bf7\u6c42\uff0c\u800c\u7cfb\u7edf\u6846\u67b6\u5185\u90e8\u5904\u7406\u8bf7\u6c42\u7684\u5b9e\u73b0\u53c8\u6070\u597d\u9700\u8981\u6301\u9501\uff0c\u5c31\u53ef\u80fd\u95f4\u63a5\u5bfc\u81f4\u5e94\u7528<code>App</code>\u7684<code>UI</code>\u7ebf\u7a0b\u963b\u585e\u5728<code>Binder</code>\u8bf7\u6c42\uff0c\u800c\u5f15\u8d77<code>App</code>\u5e94\u7528\u7684\u5361\u987f\u95ee\u9898\u3002</p> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u8bbe\u5907\u521a\u5f00\u673a\u65f6\uff0c\u684c\u9762\u5de6\u53f3\u6ed1\u52a8\u51fa\u73b0\u5361\u987f\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u4ee5\u4e0a\u95ee\u9898<code>Systrace</code>\u7684\u5206\u6790\u53ef\u4ee5\u770b\u51fa\uff0c\u51fa\u73b0\u684c\u9762\u6ed1\u52a8\u5361\u987f\u7684\u539f\u56e0\u662f\uff1a</p> <ol> <li>\u684c\u9762\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\uff08<code>tid:4927</code>\uff09\u4e2d\u901a\u8fc7<code>Binder</code>\u8bf7\u6c42\u8bbf\u95ee\u6846\u67b6<code>PKMS</code>\u670d\u52a1\u7684<code>getActivityInfo</code>\u63a5\u53e3\u67e5\u8be2<code>Activity</code>\u7684\u76f8\u5173\u4fe1\u606f\u65f6\u51fa\u73b0\u957f\u65f6\u95f4\u963b\u585e\uff1b</li> <li>\u800c\u6846\u67b6<code>PKMS</code>\u670d\u52a1\u4e2d\u5904\u7406\u6b64<code>Binder</code>\u8bf7\u6c42\u7684\u7ebf\u7a0b\uff08<code>tid:5271</code>\uff09\u903b\u8f91\u9700\u8981\u6301\u9501\u6267\u884c\uff0c\u800c\u5f53\u524d\u6b64\u9501\u5bf9\u8c61\u7684\u201c\u9501\u6c60\u201d\u4e2d\u81f3\u5c11\u5df2\u7ecf\u6709<code>7</code>\u4e2a\u7ebf\u7a0b\u90fd\u5df2\u7ecf\u5728\u7b49\u5f85\u8fd9\u628a\u9501\uff0c\u6240\u4ee5\u6b64\u7ebf\u7a0b\u8fdb\u5165\u9501\u5bf9\u8c61\u7684\u201c\u9501\u6c60\u201d\u4e2d\u963b\u585e\u7b49\u5f85\u9501\u91ca\uff1b</li> <li>\u800c\u6b64\u65f6\u6301\u6709\u8be5\u9501\u7684\u7ebf\u7a0b\u4e3a\u6846\u67b6\u7684<code>android.bg</code>\u5de5\u4f5c\u7ebf\u7a0b\uff08<code>tid:2608</code>\uff09\uff0c\u6b64\u7ebf\u7a0b\u4e2d\u6b63\u6301\u9501\u6267\u884c<code>IO</code>\u5199\u78c1\u76d8\u7b49\u8017\u65f6\u64cd\u4f5c\uff0c\u4e14\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7\u8f83\u4f4e\uff0c\u5728\u521a\u5f00\u673a\u9636\u6bb5\u7cfb\u7edf\u6574\u4f53\u8d1f\u8f7d\u6bd4\u8f83\u91cd\u7684\u573a\u666f\u4e0b\uff0c\u62a2\u4e0d\u5230<code>CPU</code>\u6267\u884c\u65f6\u95f4\u7247\u800c\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u72b6\u6001\uff0c\u5bfc\u81f4\u8fd0\u884c\u65f6\u95f4\u8f83\u957f\u3002</li> </ol> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9\u6b64\u7c7b<code>system_server</code>\u5185\u90e8\u7684\u5404\u79cd\u9501\u7b49\u5f85\u6216\u6d41\u7a0b\u5f02\u5e38\u5bfc\u81f4\u7684\u6027\u80fd\u95ee\u9898\u3002<code>Google</code>\u5728\u5386\u5e74\u7684<code>Android</code>\u7248\u672c\u4e0a\u4e5f\u5728\u4e0d\u65ad\u9488\u5bf9\u4f18\u5316\uff0c\u901a\u8fc7\u4f18\u5316\u6d41\u7a0b\u5c3d\u91cf\u7684\u51cf\u5c11\u6d41\u7a0b\u4e2d\u4e0d\u5fc5\u8981\u7684\u6301\u9501\u6216\u51cf\u5c0f\u6301\u9501\u8303\u56f4\u3002\u4f8b\u5982\u5728<code>Android P</code>\u4e0a\u63a8\u51fa\u7684<code>LockFreeAnimation</code>\u65e0\u9501\u7a97\u53e3\u52a8\u753b\uff0c\u5c31\u5b9e\u73b0\u4e86\u65e0\u9700\u6301\u6709<code>WMS</code>\u9501\u64ad\u653e\u7a97\u53e3\u52a8\u753b\uff0c\u4ece\u800c\u6781\u5927\u51cf\u5c11\u7a97\u53e3\u52a8\u753b\u5361\u987f\u7684\u6982\u7387\uff1b<code>Android 12</code>\u4e0a\u5728 <code>PackageManager</code> \u4e2d\uff0c\u5f15\u5165\u53ea\u8bfb\u5feb\u7167\u51cf\u5c11\u4e86 <code>92%</code> \u7684\u9501\u4e89\u7528\u3002\u53e6\u5916\u5404\u5927\u624b\u673a\u5382\u5546\u4e5f\u4f1a\u5728\u81ea\u5bb6\u7684<code>ROM</code>\u7cfb\u7edf\u4e0a\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\u5bf9\u6846\u67b6\u4f5c\u51fa\u6301\u7eed\u7684\u4f18\u5316\uff0c\u901a\u8fc7\u5206\u6790\u6301\u9501\u7b49\u5f85\u7684\u5173\u7cfb\uff0c\u627e\u5230\u95ee\u9898\u6e90\u5934\u7684\u5f53\u524d\u6301\u9501\u7ebf\u7a0b\uff0c\u5229\u7528\u4e00\u4e9b\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u7f13\u5b58\u65b9\u6848\u6216\u4f18\u5316<code>CPU</code>\u3001<code>IO</code>\u7b49\u8d44\u6e90\u7684\u8c03\u5ea6\u4e0e\u5206\u914d\uff0c\u51cf\u5c11\u7ebf\u7a0b\u7684\u6301\u9501\u7684\u65f6\u957f\uff0c\u4ece\u800c\u6539\u5584\u5176\u5b83\u7ebf\u7a0b\u9501\u7b49\u5f85\u7684\u65f6\u957f\u3002</p>"},{"location":"perf-opt/Android/jank/jank-shizhan/#12-input","title":"1.2 Input\u4e8b\u4ef6\u5904\u7406\u5f15\u8d77\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p>\u4ece\u524d\u9762<code>Android</code>\u5361\u987f\u6389\u5e27\u95ee\u9898\u5206\u6790\u4e4b\u539f\u7406\u7bc7\u6587\u7ae0\u4e2d\u7684\u5206\u6790\u6211\u4eec\u77e5\u9053\uff0c\u5c4f\u5e55\u9a71\u52a8\u4e0a\u62a5\u7684<code>Input</code>\u4e8b\u4ef6\u8981\u7ecf\u8fc7\u6846\u67b6\u7684<code>InputReader</code>\u548c<code>InputDispatcher</code>\u7ebf\u7a0b\u7684\u8bfb\u53d6\u4e0e\u5206\u53d1\uff0c\u7136\u540e\u901a\u8fc7<code>Socket</code>\u53d1\u9001\u5230\u5e94\u7528\u8fdb\u7a0b\u4e2d\uff0c\u518d\u7ecf\u8fc7\u754c\u9762<code>View</code>\u63a7\u4ef6\u6811\u7684\u5c42\u5c42\u5206\u53d1\u540e\u6d88\u8d39\u5904\u7406\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u4efb\u610f\u4e00\u4e2a\u6d41\u7a0b\u51fa\u73b0\u963b\u585e\u5c31\u80fd\u9020\u6210\u7528\u6237\u7684\u89e6\u63a7\u64cd\u4f5c\u5f97\u4e0d\u5230\u53ca\u65f6\u7684\u54cd\u5e94\uff0c\u51fa\u73b0\u7528\u6237\u611f\u77e5\u7684\u7cfb\u7edf\u53cd\u5e94\u5ef6\u8fdf\u6216\u5361\u987f\u73b0\u8c61\u3002</p> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u5fae\u535a\u5e94\u7528\u754c\u9762\u624b\u52bf\u6ed1\u52a8\u9000\u51fa\u65f6\uff0c\u754c\u9762\u5361\u4f4f\u51e0\u79d2\u949f\u624d\u6709\u53cd\u5e94\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u4ee5\u4e0a\u95ee\u9898<code>Systrace</code>\u7684\u5206\u6790\u53ef\u4ee5\u770b\u51fa\uff0c\u9000\u51fa\u5e94\u7528\u754c\u9762\u65f6\u51fa\u73b0\u5361\u4f4f\u51e0\u79d2\u7684\u539f\u56e0\uff1a</p> <ol> <li>\u9996\u5148\u770b<code>Systrace</code>\u4e0a<code>system_server</code>\u8fdb\u7a0b\u4e2d\u6807\u8bc6<code>Input</code>\u4e8b\u4ef6\u5206\u53d1\u7684<code>\"iq\"</code>\u548c<code>\u201coq</code>\u201d\u961f\u5217\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u6846\u67b6<code>InputDispatcher</code>\u5bf9\u4e8b\u4ef6\u7684\u5206\u53d1\u5904\u7406\u6ca1\u6709\u51fa\u73b0\u963b\u585e\u6216\u6f0f\u62a5\u7b49\u5f02\u5e38\u60c5\u51b5\uff1b</li> <li>\u4ece\u5fae\u535a\u5e94\u7528\u5bf9\u5e94\u7684<code>\u201cwq\u201d</code>\u961f\u5217\u53ef\u4ee5\u770b\u5230\uff0c\u5e94\u7528\u8fdb\u7a0b\u4e00\u76f4\u6709\u6ca1\u6709\u5b8c\u6210\u5904\u7406\u6d88\u8d39\u7684<code>Input</code>\u4e8b\u4ef6\uff0c\u8bf4\u660e\u95ee\u9898\u5728\u5fae\u535a\u5e94\u7528\u8fdb\u7a0b\u4fa7\uff1b</li> <li>\u770b<code>Systrace</code>\u4e0a\u5fae\u535a\u5e94\u7528\u4fa7\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u5f88\u957f\u4e00\u6bb5\u7684<code>deliverInputEvent</code>\u7684<code>tag</code>\uff08\u5927\u6982\u6301\u7eed<code>2.5</code>\u79d2\u5de6\u53f3\uff09\uff0c\u4e14<code>\u201caq\uff1aime\u201d</code>\u961f\u5217\u4e2d\u663e\u793a\u6709\u6301\u7eed\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u7684\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\u3002\u8bf4\u660e\u5e94\u8be5\u662f\u5728\u5e94\u7528\u8fdb\u7a0b<code>UI</code>\u7ebf\u7a0b\u4e2d\u5224\u65ad<code>Input</code>\u4e8b\u4ef6\u7c7b\u578b\u4e3a\u8fd4\u56de\u952e\u7684<code>Key</code>\u4e8b\u4ef6\uff0c\u6240\u4ee5\u5148\u4ea4\u7ed9\u8f93\u5165\u6cd5\u5e94\u7528\u8fdb\u884c\u5904\u7406\uff0c\u4f46\u662f\u8f93\u5165\u6cd5\u8fdb\u7a0b\u4e00\u76f4\u6ca1\u6709\u5b8c\u6210\u5904\u7406\uff0c\u5bfc\u81f4\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u6b64<code>Input</code>\u4e8b\u4ef6\uff0c\u8bf4\u660e\u95ee\u9898\u51fa\u73b0\u5728\u8f93\u5165\u6cd5\u5e94\u7528\u4fa7\uff1b</li> <li>\u7136\u540e\u6211\u4eec\u7528<code>ps</code>\u547d\u4ee4\u67e5\u770b\u5f53\u524d\u8f93\u5165\u6cd5\u8fdb\u7a0b\u4fe1\u606f\uff0c\u53d1\u73b0\u8f93\u5165\u6cd5\u8fdb\u7a0b\uff08<code>pid\uff1a5897</code>\uff09\u5f53\u524d\u7684\u72b6\u6001\u4e3a<code>\u201cD\u201d</code>\uff0c\u8bf4\u660e\u5904\u4e8e\u8fdb\u7a0b\u201c\u51bb\u7ed3\u201d\u7684\u4f11\u7720\u72b6\u6001\uff0c\u7ed3\u5408<code>Systrace</code>\u4e0a\u663e\u793a\u7684\u8f93\u5165\u6cd5\u8fdb\u7a0b\u7684\u4e3b\u7ebf\u7a0b\u4fe1\u606f\u663e\u793a\uff0c\u53d1\u73b0\u5176\u786e\u5b9e\u662f\u4e00\u76f4\u5904\u4e8e<code>Sleeping</code>\u72b6\u6001\u3002\u6240\u4ee5\u6b64\u95ee\u9898\u51fa\u73b0\u7684\u539f\u56e0\u5c31\u662f\u56e0\u4e3a\u8f93\u5165\u6cd5\u8fdb\u7a0b\u88ab\u5f02\u5e38\u201c\u51bb\u7ed3\u201d\u5bfc\u81f4\u7684\u3002\u548c\u8d1f\u8d23\u7ef4\u62a4\u8fdb\u7a0b\u201c\u51bb\u7ed3\u201d\u529f\u80fd\u7684\u540c\u4e8b\u6c9f\u901a\u5e76\u5206\u6790\u65e5\u5fd7\u540e\u53d1\u73b0\uff0c\u95ee\u9898\u7684\u539f\u56e0\u662f\u7528\u6237\u5b89\u88c5\u5e76\u8bbe\u7f6e\u4e86\u65b0\u7684\u8f93\u5165\u6cd5\u5e94\u7528\uff0c\u8fdb\u7a0b\u201c\u51bb\u7ed3\u201d\u6a21\u5757\u6ca1\u6709\u6210\u529f\u8bc6\u522b\uff0c\u5c06\u5176\u8ba4\u5b9a\u4e3a\u666e\u901a\u540e\u53f0\u8fdb\u7a0b\u6240\u4ee5\u8fdb\u884c\u4e86\u201c\u51bb\u7ed3\u201d\u4ece\u800c\u5bfc\u81f4\u4e86\u5f02\u5e38\u3002</li> </ol> <p>\u5230\u6b64\u8fd8\u5269\u4e00\u4e2a\u7591\u95ee\u5c31\u662f\u4e3a\u4ec0\u4e48\u8f93\u5165\u6cd5\u8fdb\u7a0b\u90fd\u88ab\u201c\u51bb\u7ed3\u201d\u800c\u4f11\u7720\u4e86\uff0c\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u5728\u7b49\u5f85<code>2.5</code>\u79d2\u540e\u8fd8\u662f\u80fd\u7ee7\u7eed\u5f80\u4e0b\u5904\u7406<code>Input</code>\u4e8b\u4ef6\uff0c\u5e76\u6210\u529f\u9000\u51fa\u5e94\u7528<code>Activity</code>\u754c\u9762\u5462\uff1f\u539f\u56e0\u5c31\u662f\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u8fdb\u5165\u7b49\u5f85\u8f93\u5165\u6cd5\u5904\u7406<code>Input</code>\u4e8b\u4ef6\u65f6\u4f1a\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\uff0c\u8fd9\u4e2a\u65f6\u957f\u5c31\u662f<code>2.5</code>\u79d2\uff0c\u5982\u679c\u8d85\u65f6\u540e\u8f93\u5165\u6cd5\u8fdb\u7a0b\u8fd8\u662f\u6ca1\u6709\u5904\u7406\u5b8c\uff0c\u5c31\u4f1a\u5f3a\u884c\u7ed3\u675f\u7b49\u5f85\u7684\u903b\u8f91\uff0c\u7531\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u7ee7\u7eed\u5f80\u4e0b\u5904\u7406<code>Input</code>\u4e8b\u4ef6\u3002\u76f8\u5173\u6e90\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/*frameworks/base/core/java/android/view/inputmethod/InputMethodManager.java*/\n...\n/**\n* Timeout in milliseconds for delivering a key to an IME.\n*/\nstatic final long INPUT_METHOD_NOT_RESPONDING_TIMEOUT = 2500;\n...\n// Must be called on the main looper\nint sendInputEventOnMainLooperLocked(PendingEvent p) {\nif (mCurChannel != null) {\n...\nif (mCurSender.sendInputEvent(seq, event)) {\n...\nMessage msg = mH.obtainMessage(MSG_TIMEOUT_INPUT_EVENT, seq, 0, p);\nmsg.setAsynchronous(true);\nmH.sendMessageDelayed(msg, INPUT_METHOD_NOT_RESPONDING_TIMEOUT);//1.\u5904\u7406Input\u4e8b\u4ef6\u65f6\u8bbe\u7f6e\u4e00\u4e2a2500ms\u7684\u8d85\u65f6\u68c0\u67e5\nreturn DISPATCH_IN_PROGRESS;\n}\n...\n}\nreturn DISPATCH_NOT_HANDLED;\n}\n...\ncase MSG_TIMEOUT_INPUT_EVENT: {\nfinishedInputEvent(msg.arg1, false, true);// 2.\u65f6\u95f4\u5230\u4e4b\u540e\u5982\u679c\u8f93\u5165\u6cd5\u8fd8\u662f\u6ca1\u6709\u5b8c\u6210Input\u4e8b\u4ef6\u5904\u7406\uff0c\u5219\u5f3a\u884c\u7ed3\u675f\u8f93\u5165\u6cd5\u5bf9\u4e8b\u4ef6\u7684\u5904\u7406\u903b\u8f91\nreturn;\n}\n...\n</code></pre> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u5bf9\u7528\u6237\u89e6\u63a7\u4e8b\u4ef6\u7684\u54cd\u5e94\u901f\u5ea6\u76f4\u63a5\u5173\u7cfb\u5230\u7528\u6237\u5bf9\u4ea4\u4e92\u8bbe\u5907\u6027\u80fd\u4f53\u9a8c\u7684\u611f\u77e5\uff0c\u6240\u4ee5\u4e00\u76f4\u4ee5\u6765\u90fd\u662f\u7cfb\u7edf\u6027\u80fd\u4f18\u5316\u5de5\u4f5c\u7684\u91cd\u4e2d\u4e4b\u91cd\u3002\u591a\u5e74\u6765\u8c37\u6b4c\uff0c\u5305\u62ec<code>SOC</code>\u5382\u5546\u90fd\u6709\u9488\u5bf9\u7cfb\u7edf<code>Input</code>\u4e8b\u4ef6\u7684\u5904\u7406\u6d41\u7a0b\u4f5c\u51fa\u4f18\u5316\uff0c\u4ee5\u63d0\u5347\u89e6\u63a7\u54cd\u5e94\u901f\u5ea6\u3002\u4f8b\u5982\u9ad8\u901a\u57fa\u7ebf\u4e0a\u5728<code>2018</code>\u5e74\u5de6\u53f3\u5c31\u6709\u4e00\u7b14\u63d0\u4ea4\uff0c\u4f18\u5316\u5e94\u7528\u8fdb\u7a0b\u4fa7\u7684<code>Input</code>\u4e8b\u4ef6\u5904\u7406\u6d41\u7a0b\uff0c\u5927\u6982\u601d\u8def\u5c31\u662f\u8bc6\u522b\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u4e2d\u6536\u5230\u7b2c\u4e00\u4e2a<code>ACTION_DOWN</code>\u7684<code>Touch</code>\u4e8b\u4ef6\u540e\uff0c\u8c03\u7528<code>sendMessageAtFrontOfQueue</code>\u63a5\u53e3\u5728\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\u7684\u6700\u524d\u9762\u63d2\u5165\u4e00\u5e27<code>doFrame</code>\u7ed8\u5236\u4efb\u52a1\uff0c\u8fd9\u6837\u754c\u9762\u4e0d\u7528\u7b49\u5f85\u4e0b\u4e00\u4e2a<code>Vsync</code>\u7684\u4fe1\u53f7\u7684\u5230\u6765\u5c31\u80fd\u76f4\u63a5\u4e0a\u5e27\u663e\u793a\uff0c\u4ece\u800c\u51cf\u5c11\u6574\u4e2a<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u7684\u54cd\u5e94\u5ef6\u8fdf\u3002\u4ece<code>Systrace</code>\u4e0a\u8868\u73b0\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u56fd\u5185\u5404\u5927\u624b\u673a\u5382\u5546\u4e5f\u6709\u5404\u81ea\u7684\u4f18\u5316\u65b9\u6848\u3002\u6bd4\u5982\u786c\u4ef6\u4e0a\u91c7\u7528\u89e6\u63a7\u91c7\u6837\u7387\u66f4\u9ad8\u7684\u5c4f\u5e55\uff0c\u5c4f\u5e55\u89e6\u63a7\u91c7\u6837\u7387\u8fbe\u5230<code>240HZ</code>\u751a\u81f3<code>480HZ</code>\u3002\u518d\u6bd4\u5982\u76d1\u63a7\u5230\u89e6\u63a7\u4e8b\u4ef6\u540e\u63d0\u5347<code>CPU</code>\u4e3b\u9891\uff0c\u63d0\u5347\u89e6\u63a7\u4e8b\u4ef6\u5904\u7406\u76f8\u5173\u7ebf\u7a0b\u548c\u6e32\u67d3\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7\u7b49\u65b9\u5f0f\uff0c\u4ece\u800c\u4f18\u5316\u4e8b\u4ef6\u89e6\u63a7\u54cd\u5e94\u901f\u5ea6\u3002\u800c\u5bf9\u4e8e\u5e94\u7528<code>APP</code>\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u9700\u8981\u505a\u7684\u5c31\u662f\u907f\u514d\u5728<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u7684\u5206\u53d1\u5904\u7406\u6d41\u7a0b\u4e2d\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff0c\u4ee5\u514d\u5f15\u8d77\u89e6\u63a7\u5ef6\u8fdf\u6216\u5361\u987f\u7b49\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/jank/jank-shizhan/#13-ui","title":"1.3 \u5e94\u7528UI\u7ebf\u7a0b\u8017\u65f6\u5f15\u8d77\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p>\u8fd9\u90e8\u5206\u903b\u8f91\u4e3b\u8981\u7531\u5e94\u7528<code>APP</code>\u5f00\u53d1\u8005\u63a7\u5236\u3002\u6839\u636e\u524d\u6587Android\u5361\u987f\u6389\u5e27\u95ee\u9898\u5206\u6790\u4e4b\u539f\u7406\u7bc7\u4e2d\u7684\u5206\u6790\u53ef\u77e5\uff0c<code>UI</code>\u7ebf\u7a0b\u8017\u65f6\u8fc7\u957f\u5fc5\u7136\u4f1a\u5bfc\u81f4<code>Vsync</code>\u5468\u671f\u5185\u5e94\u7528\u4e0a\u5e27\u51fa\u73b0\u8d85\u65f6\u3002\u7279\u522b\u662f\u5c4f\u5e55\u9ad8\u5237\u65f6\u4ee3\u7684\u5230\u6765\uff0c\u7559\u7ed9\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u5904\u7406\u4e0a\u5e27\u4efb\u52a1\u7684\u65f6\u957f\u8d8a\u6765\u8d8a\u77ed\u3002\u4f8b\u5982<code>120HZ</code>\u7684\u9ad8\u5237\u5c4f\u5e55\u914d\u4e0a\uff0c\u4e00\u4e2a<code>Vsync</code>\u4fe1\u53f7\u5468\u671f\u5df2\u7ecf\u7f29\u77ed\u5230<code>8ms</code>\u5de6\u53f3\u3002\u8fd9\u8981\u6c42\u5e94\u7528<code>APP</code>\u5f00\u53d1\u8005\u80fd\u5199\u51fa\u66f4\u52a0\u9ad8\u6027\u80fd\u8d28\u91cf\u7684\u4ee3\u7801\u3002\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u8017\u65f6\u5f15\u8d77\u7684\u5361\u987f\u5f80\u5f80\u6d89\u53ca\u7684\u56e0\u7d20\u6bd4\u8f83\u591a\uff0c\u4e0b\u9762\u5217\u4e3e\u4e00\u4e9b\u5e38\u89c1\u539f\u56e0\uff1a</p> <ol> <li><code>UI</code>\u7ebf\u7a0b\u6d88\u606f\u961f\u5217\u4e2d\u5b58\u5728\u9664<code>doFrame</code>\u7ed8\u5236\u4efb\u52a1\u5916\u7684\u5176\u5b83\u8017\u65f6\u4efb\u52a1\uff0c\u5bfc\u81f4<code>Vsync</code>\u4fe1\u53f7\u5230\u6765\u540e\uff0c\u65e0\u6cd5\u53ca\u65f6\u89e6\u53d1<code>UI</code>\u7ebf\u7a0b\u6267\u884c<code>doFrame</code>\u7ed8\u5236\u4e0a\u5e27\u4efb\u52a1\uff0c\u800c\u5bfc\u81f4\u6389\u5e27\u3002\u4f8b\u5982\u754c\u9762\u5e03\u5c40<code>XML</code>\u6587\u4ef6\u7684<code>inflate</code>\u89e3\u6790\uff0c\u5982\u679c\u754c\u9762\u5e03\u5c40\u6587\u4ef6\u6bd4\u8f83\u590d\u6742\uff0c\u5c31\u5230\u6709\u5927\u91cf\u7684<code>IO</code>\u4e0e\u53cd\u5c04\u7b49\u8017\u65f6\u64cd\u4f5c\u3002\u53c8\u6216\u8005<code>UI</code>\u7ebf\u7a0b\u4e2d\u6709<code>decodeBitmap</code>\u89e3\u6790\u5927\u56fe\u7247\u7684\u8017\u65f6\u64cd\u4f5c\u3002</li> <li><code>UI</code>\u5e27\u7684<code>doFrame</code>\u7ed8\u5236\u4efb\u52a1\u5904\u7406\u8017\u65f6\u8fc7\u957f\u5bfc\u81f4\u6389\u5e27\u3002\u6700\u5e38\u89c1\u7684\u95ee\u9898\u5c31\u662f\u5e94\u7528\u754c\u9762\u5e03\u5c40\u5b58\u5728\u8fc7\u5ea6\u7ed8\u5236\uff0c\u5bfc\u81f4<code>measure/layout/draw</code>\u4efb\u52a1\u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u6210\u500d\u4e0a\u5347\u3002\u518d\u6bd4\u5982\u5e94\u7528\u754c\u9762\u5e03\u5c40\u4e2d\u7684\u90e8\u5206<code>View</code>\u63a7\u4ef6\u5c42\u9762\u5982\u679c\u5173\u95ed\u4e86\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\uff0c\u5c31\u4f1a\u89e6\u53d1<code>View#buildDrawingCache</code>\u7684\u8017\u65f6\u64cd\u4f5c\uff0c\u4ece\u800c\u5bfc\u81f4\u6574\u4e2a<code>draw</code>\u52a8\u4f5c\u8017\u65f6\u8fc7\u957f\u800c\u5f15\u8d77\u6389\u5e27\u3002</li> <li><code>UI</code>\u7ebf\u7a0b\u5b58\u5728\u5927\u91cf\u7684\u963b\u585e\u7b49\u5f85\u5bfc\u81f4\u4e0a\u5e27\u8d85\u65f6\u3002<code>UI</code>\u7ebf\u7a0b\u9677\u5165\u963b\u585e\u7b49\u5f85\uff0c\u5e38\u89c1\u7684\u539f\u56e0\u5c31\u662f\u8de8\u8fdb\u7a0b\u7684<code>Binder</code>\u8c03\u7528\u963b\u585e\u548c\u8fdb\u7a0b\u5185\u7684\u540c\u6b65\u9501\u7ade\u4e89\u7b49\u5f85\u3002\u8fd8\u6709\u4e00\u7c7b\u60c5\u51b5\u5c31\u662f\u9891\u7e41\u7684<code>GC</code>\u5185\u5b58\u56de\u6536\u5f15\u8d77(\u4e00\u822c\u4e3a\u8fdb\u7a0b\u5185\u5b58\u6296\u52a8\u6216\u5185\u5b58\u6cc4\u9732\u5f15\u8d77)\u3002</li> </ol> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u4e09\u65b9\u5e94\u7528\u4e66\u65d7\u5c0f\u8bf4\u754c\u9762\u4e0a\u4e0b\u6ed1\u52a8\u4e25\u91cd\u6389\u5e27\u5361\u987f\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece<code>Systrace</code>\u4e0a\u53ef\u4ee5\u770b\u5230\uff0c\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u4e0a\u5e27\u7684<code>doFrame</code>\u6d41\u7a0b\u4e2d\u4e3b\u8981\u8017\u65f6\u70b9\u5728<code>buildDrawingCache</code>\u7684\u6d41\u7a0b\u4e0a\u3002\u4e0b\u9762\u6211\u4eec\u7ed3\u5408\u6e90\u7801\u6765\u770b\u770b\u4ec0\u4e48\u60c5\u51b5\u4e0b<code>draw</code>\u6d41\u7a0b\u4e2d\u4f1a\u51fa\u73b0<code>buildDrawingCache</code>\u7684\u52a8\u4f5c\uff1a</p> <pre><code>/*frameworks/base/core/java/android/view/View.java*/\n...\npublic RenderNode updateDisplayListIfDirty() {\n...\nif (layerType == LAYER_TYPE_SOFTWARE) { //\u5224\u65adView\u7684layerType\u4e3aLAYER_TYPE_SOFTWARE\uff0c\u4e5f\u5c31\u662f\u5173\u95ed\u4e86\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\uff0c\u6267\u884cbuildDrawingCache\nbuildDrawingCache(true);\n...\n}else{\n...\ndraw(canvas); //\u8d70\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\u7684\u6d41\u7a0b\n...\n}\n....\n}\n...\n</code></pre> <p>\u4ece\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\u5f53\u5224\u65ad\u67d0\u4e2a<code>View</code>\u7a7a\u95f4\u7684<code>layerType</code>\u4e3a<code>LAYER_TYPE_SOFTWARE</code>\uff0c\u4e5f\u5c31\u662f\u5173\u95ed\u4e86\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u4f1a\u89e6\u53d1\u8d70\u5230<code>buildDrawingCache</code>\u7684\u8017\u65f6\u903b\u8f91\u4e2d\u3002\u6240\u4ee5\u6b64\u95ee\u9898\u5c31\u662f\u7531\u4e8e\u4e66\u65d7\u5c0f\u8bf4\u5e94\u7528\u7684\u754c\u9762\u5e03\u5c40\u4e2d\u4e00\u4e2a\u540d\u4e3a<code>OriWebViewEx</code> \u7684<code>View</code>\u63a7\u4ef6\u5173\u95ed\u4e86\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\u5bfc\u81f4\u3002</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a<code>Twitter</code>\u5e94\u7528\u754c\u9762\u4e0a\u4e0b\u6ed1\u52a8\u4e25\u91cd\u6389\u5e27\u5361\u987f\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece<code>Systrace</code>\u4e0a\u53ef\u4ee5\u770b\u5230\uff0c\u4e09\u65b9\u5e94\u7528<code>Twitter</code>\u51fa\u73b0\u6389\u5e27\u7684\u4e3b\u8981\u539f\u56e0\u662f\uff1a\u5176<code>UI</code>\u7ebf\u7a0b\u4e2d\u5b58\u5728\u5927\u91cf\u8017\u65f6\u7684<code>inflate</code>\u89e3\u6790<code>xml</code>\u5e03\u5c40\u6587\u4ef6\u7684\u64cd\u4f5c\uff0c\u4e14\u51fa\u73b0\u95ee\u9898\u65f6<code>UI</code>\u7ebf\u7a0b\u5df2\u7ecf\u6301\u7eed<code>Running</code>\u5230<code>CPU 5</code>\u5927\u6838\u5fc3\u4e0a\u4f46\u662f\u8fd8\u662f\u51fa\u73b0\u4e25\u91cd\u7684\u4e0a\u5e27\u8d85\u65f6\u3002</p> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u8017\u65f6\u5f15\u8d77\u5361\u987f\u7684\u95ee\u9898\uff0c\u539f\u5219\u5c31\u662f\u5c3d\u91cf\u51cf\u8f7b<code>UI</code>\u7ebf\u7a0b\u7684\u8d1f\u62c5\u3002\u9488\u5bf9\u4e0d\u540c\u7684\u5f15\u8d77\u95ee\u9898\u539f\u56e0\uff0c\u5e38\u89c1\u7684\u4f18\u5316\u601d\u8def\u5927\u81f4\u5982\u4e0b\uff1a</p> <ol> <li>\u5f02\u6b65\u5904\u7406\uff1a\u5404\u79cd\u8017\u65f6\u64cd\u4f5c\u5c3d\u91cf\u653e\u5230\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5904\u7406\u3002\u6bd4\u5982\u4f7f\u7528<code>View</code>\u7684\u5f02\u6b65\u7ebf\u7a0b<code>inflate</code>\u65b9\u6848\uff1b<code>decodeBitmap</code>\u52a0\u8f7d\u56fe\u7247\u7684\u8017\u65f6\u64cd\u4f5c\u79fb\u5230\u5b50\u7ebf\u7a0b\u7edf\u4e00\u5904\u7406\u7b49\u3002</li> <li>\u903b\u8f91\u4f18\u5316\uff1a\u5fc5\u987b\u8981\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\u7684\u903b\u8f91\u5e94\u5c3d\u91cf\u4f18\u5316\uff0c\u51cf\u5c11\u8ba1\u7b97\u9891\u6b21\uff0c\u907f\u514d\u91cd\u590d\u8ba1\u7b97\u3002\u6bd4\u5982\u91c7\u7528\u7ea6\u675f\u5e03\u5c40\u89e3\u51b3\u5d4c\u5957\u8fc7\u591a\u7684\u95ee\u9898\uff0c\u907f\u514d\u8fc7\u5ea6\u7ed8\u5236\uff1b\u4f18\u5316\u5e94\u7528\u7684\u5185\u5b58\u5360\u7528\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u9732\u3001\u5185\u5b58\u6296\u52a8\u7b49\u95ee\u9898\uff0c\u4ece\u800c\u51cf\u5c11<code>GC</code>\u89e6\u53d1\u7684\u6b21\u6570\uff1b\u4f18\u5316\u5185\u90e8\u4ee3\u7801\u903b\u8f91\uff0c\u5c3d\u91cf\u51cf\u5c11\u4e3b\u7ebf\u7a0b\u9677\u5165\u540c\u6b65\u9501\u7ade\u4e89\u7b49\u5f85\u7684\u72b6\u6001\uff1b\u539f\u5219\u4e0a\u4e0d\u8981\u4e3b\u52a8\u53bb\u5173\u95ed\u786c\u4ef6\u7ed8\u5236\u52a0\u901f\u3002</li> <li>\u6d41\u7a0b\u590d\u7528\uff1a\u80fd\u590d\u7528\u7684\u903b\u8f91\u5c3d\u91cf\u590d\u7528\uff0c\u4ee5\u907f\u514d\u591a\u6b21\u8c03\u7528\u4ea7\u751f\u7684\u6027\u80fd\u5f00\u9500\u3002\u6bd4\u5982<code>ListView</code>\u7684<code>Adapter</code>\u4e2d\u5b9e\u73b0<code>View</code>\u7684\u590d\u7528\uff0c\u51cf\u5c11<code>View</code>\u7684<code>inflate</code>\u6267\u884c\u6b21\u6570\u3002\u53e6\u5916<code>UI</code>\u7ebf\u7a0b\u4e2d<code>Binder</code>\u8bf7\u6c42\u6846\u67b6\u67e5\u8be2\u4e00\u4e9b\u7cfb\u7edf\u4fe1\u606f\uff0c\u80fd\u591f\u4e00\u6b21\u67e5\u5b8c\u5c31\u4e0d\u8981\u5206\u591a\u6b21\u6267\u884c\u3002\u4e14\u67e5\u8be2\u7ed3\u679c\u5e94\u5c3d\u91cf\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u5b9e\u73b0\u590d\u7528\uff0c\u907f\u514d\u591a\u6b21\u53cd\u590d\u7684\u67e5\u8be2\u9020\u6210\u4e3b\u7ebf\u7a0b\u9891\u7e41\u9677\u5165<code>Binder</code>\u963b\u585e\u7b49\u5f85\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#14-surfaceflinger","title":"1.4 SurfaceFlinger\u8017\u65f6\u5f15\u8d77\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p>\u4ece\u524d\u6587\u7684\u5206\u6790\u53ef\u4ee5\u77e5\u9053\uff0c<code>SurfaceFlinger</code>\u5728<code>Android</code>\u7cfb\u7edf\u7684\u6574\u4e2a\u56fe\u5f62\u663e\u793a\u7cfb\u7edf\u4e2d\u662f\u8d77\u5230\u4e00\u4e2a\u627f\u4e0a\u3001\u542f\u4e0b\u7684\u4f5c\u7528\uff0c\u8d1f\u8d23\u6536\u96c6\u4e0d\u540c\u5e94\u7528\u8fdb\u7a0b<code>Surface</code>\u7684\u7ed8\u5236\u7f13\u5b58\u6570\u636e\u8fdb\u884c\u7684\u5408\u6210\uff0c\u7136\u540e\u53d1\u9001\u5230\u663e\u793a\u8bbe\u5907\u3002\u6240\u4ee5\uff0c\u5982\u679c<code>SurfaceFlinger</code>\u7684\u5904\u7406\u6d41\u7a0b\u4e0a\u51fa\u73b0\u8017\u65f6\u6216\u963b\u585e\uff0c\u5fc5\u7136\u4f1a\u5bfc\u81f4\u6574\u4e2a\u5e94\u7528\u7684\u4e0a\u5e27\u663e\u793a\u7684\u6d41\u7a0b\u51fa\u73b0\u8d85\u65f6\u800c\u6389\u5e27\u3002\u7279\u522b\u662f\u968f\u7740\u5c4f\u5e55\u9ad8\u5237\u65f6\u4ee3\u7684\u5230\u6765\uff0c<code>Vsync</code>\u5468\u671f\u4e0d\u65ad\u7f29\u77ed\uff0c\u7559\u7ed9<code>SurfaceFlinger</code>\u5904\u7406\u7684\u65f6\u95f4\u4e5f\u8d8a\u6765\u8d8a\u77ed\uff0c\u5bf9<code>SurfaceFlinger</code>\u7684\u6027\u80fd\u63d0\u51fa\u4e86\u66f4\u9ad8\u7684\u8981\u6c42\u3002\u8fd9\u4e5f\u662f\u8c37\u6b4c\u3001<code>SOC</code>\u5382\u5546\u5305\u62ec\u5404\u5927\u624b\u673a\u5382\u5546\u505a\u7cfb\u7edf\u6027\u80fd\u4f18\u5316\u7684\u91cd\u70b9\u3002</p> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u8bbe\u7f6e<code>120HZ</code>\u9ad8\u5237\u6a21\u5f0f\u4e0b\uff0c\u624b\u673a\u5f55\u5c4f\u3001\u6295\u5c4f\u573a\u666f\u4e0b\u51fa\u73b0\u5e27\u7387\u4e0b\u964d\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece<code>Systrace</code>\u4e0a\u53ef\u4ee5\u770b\u5230\uff0c\u5f00\u542f\u5f55\u5c4f\u6216\u6295\u5c4f\u540e\uff0c\u90e8\u5206<code>Layer</code>\u9700\u8981\u91c7\u7528\u6548\u7387\u66f4\u4f4e\u7684<code>GPU</code>\u5408\u6210\u65b9\u5f0f\uff08\u4e3b\u8981\u662f\u56e0\u4e3a\u9ad8\u901a\u5e73\u53f0<code>HWC</code>\u4e0d\u652f\u6301\u56de\u5199\uff09\uff0c<code>SurfaceFlinger</code>\u7684\u4e3b\u7ebf\u7a0b\u4e2d\u9700\u8981\u5b9e\u73b0<code>drawLayers</code>\u7684\u52a8\u4f5c\uff0c\u8fd8\u9700\u8981\u5c06\u56fe\u5c42\u6570\u636e\u5199\u5165\u5230<code>MediaCodec</code>\u7f13\u5b58\u4e2d\uff0c\u603b\u4f53\u8d1f\u8f7d\u8f83\u9ad8\uff0c\u5bfc\u81f4\u5728<code>8ms</code>\uff08<code>120HZ</code>\u9ad8\u5237\u6a21\u5f0f\u4e0b\uff09\u5185\u65e0\u6cd5\u5b8c\u6210\u4e00\u5e27\u6570\u636e\u7684\u5904\u7406\u800c\u51fa\u73b0\u5e27\u7387\u4e0b\u964d\u7684\u95ee\u9898\u3002</p> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9<code>SurfaceFlinger</code>\u5f15\u8d77\u7684\u6027\u80fd\u5361\u987f\u95ee\u9898\uff0c\u5e38\u89c1\u7684\u4f18\u5316\u601d\u8def\u6709\uff1a</p> <ol> <li>\u8c37\u6b4c\u901a\u8fc7<code>cpuset</code>\u7684\u914d\u7f6e\uff0c\u9ed8\u8ba4\u573a\u666f\u4e0b<code>SurfaceFlinger</code>\u53ea\u80fd\u4f7f\u7528<code>4</code>\u4e2a<code>CPU</code>\u5c0f\u6838\u5fc3\u8fd0\u884c\uff1b\u90e8\u5206\u5382\u5546\u4f1a\u5728\u6295\u5c4f\u6216\u5f55\u5c4f\u7b49\u8d1f\u8f7d\u6bd4\u8f83\u91cd\u7684\u573a\u666f\u4e0b\u653e\u5f00\u8fd9\u4e2a\u9650\u5236\uff0c\u8ba9<code>SurfaceFlinger</code>\u8fdb\u7a0b\u80fd\u8dd1\u5230<code>CPU</code>\u5927\u6838\u5fc3\u4e0a\u3002</li> <li>\u90e8\u5206\u5382\u5546\u5728\u5f00\u542f\u5f55\u5c4f\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u9501\u5b9a\u5c4f\u5e55\u5237\u65b0\u7387\u6700\u9ad8\u4e0d\u8d85\u8fc7<code>60HZ</code>\uff0c\u4ee5\u51cf\u8f7b<code>SurfaceFlinger</code>\u8fdb\u7a0b\u7684\u538b\u529b\u3002</li> <li><code>Android 12</code>\u4e0a\uff0c\u8c37\u6b4c\u5c31\u5c06\u5404\u4e2a\u5e94\u7528\u5bf9\u5e94\u7684<code>BufferQueue</code>\u7684\u7ba1\u7406\u5de5\u4f5c\u79fb\u52a8\u5230\u5e94\u7528\u8fdb\u7a0b\u4fa7\u5904\u7406\uff0c\u4ee5\u51cf\u8f7b<code>SurfaceFlinger</code>\u8fdb\u7a0b\u7684\u8d1f\u8f7d\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#2","title":"2 \u7cfb\u7edf\u8d1f\u8f7d\u5f02\u5e38","text":"<p><code>CPU</code>\u3001<code>GPU</code>\u3001\u5185\u5b58\u3001\u78c1\u76d8\u7b49\u90fd\u662f\u7cfb\u7edf\u5185\u5404\u4e2a\u8fdb\u7a0b\u4efb\u52a1\u7684\u8fd0\u884c\u6240\u5fc5\u9700\u7684 \u516c\u5171\u7cfb\u7edf\u8d44\u6e90\u3002\u8fd9\u5c31\u6d89\u53ca\u5230\u4e00\u4e2a\u590d\u6742\u7684\u8d44\u6e90\u8c03\u5ea6\u4e0e\u5206\u914d\u7684\u95ee\u9898\uff0c\u5b9e\u73b0\u5c06\u7cfb\u7edf\u8d44\u6e90\u4e0e\u5404\u4e2a\u4e0d\u540c\u8fdb\u7a0b\u7684\u9700\u6c42\u8fdb\u884c\u5408\u7406\u7684\u5339\u914d\uff0c\u4ee5\u4fdd\u8bc1\u8fdb\u7a0b\u4efb\u52a1\u80fd\u591f\u6d41\u7545\u7684\u8fd0\u884c\u3002\u8fd9\u5c31\u6d89\u53ca\u5230\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u8fd9\u4e9b\u7cfb\u7edf\u516c\u5171\u8d44\u6e90\u662f\u5426\u5145\u8db3\u3002\u6bd4\u5982\u5f53\u8fdb\u7a0b\u9700\u8981\u65f6\uff0c\u5f53\u524d<code>CPU</code>\u6838\u5fc3\u7684\u8fd0\u884c\u4e3b\u9891\u7b97\u529b\u662f\u5426\u8db3\u591f\u9ad8\uff0c\u7cfb\u7edf\u5269\u4f59\u5185\u5b58\u662f\u5426\u8db3\u591f\u5927\uff0c\u78c1\u76d8\u7684\u8bfb\u5199\u901f\u5ea6\u662f\u5426\u8db3\u591f\u5feb\u3002</li> <li>\u8fd9\u4e9b\u7cfb\u7edf\u8d44\u6e90\u7684\u5206\u914d\u662f\u5426\u5408\u7406\u3002\u6bd4\u5982\u5f53\u524d\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u524d\u53f0\u5e94\u7528\u8fdb\u7a0b\u76f8\u5bf9\u4e8e\u540e\u53f0\u8fdb\u7a0b\u662f\u5426\u80fd\u83b7\u5f97\u66f4\u591a\u7684<code>CPU</code>\u8c03\u5ea6\u8fd0\u884c\u65f6\u95f4\u7247\u548c<code>I/O</code>\u5e26\u5bbd\u7b49\u8d44\u6e90\uff0c\u4ee5\u4fdd\u8bc1\u754c\u9762\u7684\u6d41\u7545\u8fd0\u884c\u3002</li> </ol> <p>\u4ece\u8f6f\u4ef6\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u6bcf\u4e2a\u5e94\u7528\u4efb\u52a1\u8fdb\u7a0b\u90fd\u5e0c\u671b\u81ea\u5df1\u83b7\u5f97\u65e0\u9650\u7684<code>CPU</code>\u7b97\u529b\u3001\u65e0\u9650\u7684\u5185\u5b58\u8d44\u6e90\u5206\u914d\u7b49\u80fd\u529b\uff0c\u4ee5\u4fdd\u8bc1\u5176\u80fd\u591f\u6d41\u7545\u7684\u8fd0\u884c\u3002\u4f46\u662f\u4ece\u786c\u4ef6\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u5404\u79cd\u7cfb\u7edf\u7684\u516c\u5171\u8d44\u6e90\u914d\u7f6e\u90fd\u662f\u6709\u9650\u7684\uff0c\u4e0d\u53ef\u80fd\u65e0\u9650\u7684\u63d0\u4f9b\u7ed9\u6bcf\u4e2a\u4efb\u52a1\u8fdb\u7a0b\uff0c\u4e14\u5728\u79fb\u52a8\u8bbe\u5907\u4e0a\u8fd8\u8981\u8003\u91cf\u529f\u8017\u4e0e\u53d1\u70ed\u7684\u95ee\u9898\uff0c\u9700\u8981\u9650\u5236\u5404\u79cd\u7cfb\u7edf\u8d44\u6e90\u7684\u4f9b\u7ed9\u3002\u6240\u4ee5\u5982\u4f55\u534f\u8c03\u8fd9\u79cd\u4f9b\u9700\u5173\u7cfb\u4e4b\u95f4\u7684\u77db\u76fe\uff0c\u5c06\u5b9d\u8d35\u7684\u7cfb\u7edf\u8d44\u6e90\u5408\u7406\u7684\u5206\u914d\u7ed9\u5f53\u524d\u6700\u9700\u8981\u7684\u4efb\u52a1\u8fdb\u7a0b\uff0c\u4ee5\u6700\u5c0f\u7684\u8d44\u6e90\u5f00\u9500\u4fdd\u8bc1\u7cfb\u7edf\u7684\u6d41\u7545\u8fd0\u884c\uff0c\u5c31\u662f\u8003\u9a8c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u8ba1\u8005\u548c\u6027\u80fd\u4f18\u5316\u5de5\u7a0b\u5e08\u7684\u529f\u529b\u7684\u95ee\u9898\uff0c\u5f04\u4e0d\u597d\u5c31\u53ef\u80fd\u51fa\u73b0\u5e94\u7528\u4efb\u52a1\u8fdb\u7a0b\u7684\u8fd0\u884c\u53d7\u9650\u4e8e\u7cfb\u7edf\u8fd0\u884c\u8d44\u6e90\u7684\u5206\u914d\u800c\u51fa\u73b0\u5404\u79cd\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/jank/jank-shizhan/#21-cpu","title":"2.1 CPU\u8c03\u5ea6\u5f15\u8d77\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p><code>CPU</code>\u7b97\u529b\u8d44\u6e90\u7edd\u5bf9\u662f\u7cfb\u7edf\u5185\u6700\u91cd\u8981\u7684\u516c\u5171\u8d44\u6e90\u4e4b\u4e00\uff0c\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u6b63\u5e38\u8fd0\u884c\u90fd\u9700\u8981<code>CPU</code>\u7684\u8c03\u5ea6\u6267\u884c\u3002\u76ee\u524d\u7684\u4e3b\u6d41\u79fb\u52a8\u8bbe\u5907\u642d\u8f7d\u7684<code>CPU</code>\u57fa\u672c\u4e0a\u90fd\u662f\u91c7\u7528\u591a\u6838\u5fc3\u67b6\u6784\u8bbe\u8ba1\uff0c\u6309\u7167\u7b97\u529b\u7684\u5927\u5c0f\u8bbe\u7f6e\u6709\u591a\u9897<code>CPU</code>\u8fd0\u7b97\u6838\u5fc3\uff08\u4ee5\u9ad8\u901a\u6700\u65b0\u7684\u9a81\u9f99<code>8 gen 1</code>\u5904\u7406\u5668\u4e3a\u4f8b\uff0c\u5176\u62e5\u6709<code>8</code>\u9897<code>CPU</code>\u8fd0\u7b97\u6838\u5fc3\uff0c\u5305\u542b\u56db\u4e2a\u5c0f\u6838\u3001\u4e09\u4e2a\u4e2d\u6838\u548c\u4e00\u4e2a\u5927\u6838\uff0c\u7b97\u529b\u4f9d\u6b21\u9012\u589e\uff0c\u529f\u8017\u4e5f\u9010\u6e10\u589e\u5927\uff09\u3002</p> <p></p> <p>\u4e14<code>Linux</code>\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e2d\u4f1a\u6709\u76f8\u5e94\u7684<code>scheduler</code>\u548c<code>governor</code>\u8c03\u5ea6\u5668\uff0c\u6765\u7ba1\u7406\u6bcf\u9897<code>CPU</code>\u6838\u5fc3\u4e0a\u5f53\u524d\u8fd0\u884c\u7684\u4efb\u52a1\u7684\u6392\u7a0b\uff0c\u4ee5\u53ca\u6bcf\u9897<code>CPU</code>\u6838\u5fc3\u5f53\u524d\u8fd0\u884c\u7684\u4e3b\u9891\uff08\u6bcf\u9897<code>CPU</code>\u6838\u5fc3\u90fd\u6709\u4e00\u4e2a\u8fd0\u884c\u4e3b\u9891\u53c2\u6570\u53ef\u4ee5\u652f\u6301\u5728\u4e00\u5b9a\u7684\u8303\u56f4\u5185\u52a8\u6001\u8c03\u8282\uff0c\u4e3b\u9891\u8d8a\u9ad8\u7b97\u529b\u8d8a\u5f3a\uff0c\u76f8\u5e94\u7684\u529f\u8017\u4e5f\u5c31\u8d8a\u5927\uff09\u3001\u8282\u80fd\u72b6\u6001\u7b49\u53c2\u6570\uff0c\u4ee5\u8fbe\u5230\u6700\u4f73\u7684\u6027\u80fd\u4e0e\u529f\u8017\u7684\u5e73\u8861\u3002\u4f46\u662f\u5f88\u591a\u65f6\u5019\u7531\u4e8e<code>CPU</code>\u8fd0\u884c\u6838\u5fc3\u4e0a\u7684\u4efb\u52a1\u6392\u5e03\u4e0d\u5408\u7406\uff0c\u6216\u8fd0\u884c\u4e3b\u9891\u8fc7\u4f4e\u5bfc\u81f4\u7684\u7b97\u529b\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u6ee1\u8db3\u5e94\u7528\u8fdb\u7a0b\u7684\u9700\u6c42\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u5e94\u7528\u51fa\u73b0\u5361\u987f\u6389\u5e27\u7b49\u6027\u80fd\u95ee\u9898\u3002\u5e38\u89c1\u7684\u4e00\u4e9b\u539f\u56e0\u5982\u4e0b\uff1a</p> <ol> <li>\u540e\u53f0\u5e94\u7528\u8fdb\u7a0b\u4efb\u52a1\u6301\u7eed\u8fd0\u884c\u62a2\u5360<code>CPU</code>\u8fd0\u884c\u8d44\u6e90\uff0c\u6216\u8005\u5904\u4e8e\u529f\u8017\u7ba1\u63a7\u76f4\u63a5\u5173\u6838\uff0c\u5bfc\u81f4\u524d\u53f0\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u4efb\u52a1\u65e0\u6cd5\u53ca\u65f6\u7684\u83b7\u5f97<code>CPU</code>\u8fd0\u884c\u7b97\u529b\u6267\u884c\uff0c\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u72b6\u6001\uff0c\u800c\u51fa\u73b0\u4e0a\u5e27\u8d85\u65f6\u6389\u5e27\u95ee\u9898\uff1b</li> <li>\u67d0\u4e9b\u65f6\u5019\u51fa\u4e8e\u529f\u8017\u4e0e\u53d1\u70ed\u7684\u8003\u91cf\uff0c\u5c06<code>CPU</code>\u7684\u8fd0\u884c\u4e3b\u9891\u538b\u7684\u8fc7\u4f4e\uff0c\u5bfc\u81f4\u7b97\u529b\u4e0d\u8db3\u3002\u5e94\u7528\u7684\u4e0a\u5e27\u7ebf\u7a0b\u4e0a\u7684\u4efb\u52a1\u9700\u8981<code>Running</code>\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u800c\u51fa\u73b0\u4e0a\u5e27\u8d85\u65f6\u6389\u5e27\u3002</li> </ol> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u817e\u8baf\u89c6\u9891\u5e94\u7528\u4e2d\u89c2\u770b\u89c6\u9891\u65f6\uff0c\u64ad\u653e\u5f39\u5e55\u5361\u987f\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece<code>Systrace</code>\u4e0a\u53ef\u4ee5\u770b\u5230\uff1a\u817e\u8baf\u89c6\u9891\u64ad\u653e\u89c6\u9891\u65f6\u51fa\u73b0\u6389\u5e27\u5361\u987f\u7684\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u5176\u8d1f\u8d23\u5f39\u5e55\u4e0a\u5e27\u7684\u7ebf\u7a0b\u65e0\u6cd5\u83b7\u5f97<code>CPU</code>\u8fd0\u884c\u8d44\u6e90\uff0c\u800c\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u72b6\u6001\uff0c\u5bfc\u81f4\u4e0a\u5e27\u51fa\u73b0\u4e25\u91cd\u8d85\u65f6\u3002 \u8fdb\u4e00\u6b65\u5206\u6790\u539f\u56e0\u53d1\u73b0\u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a\u4e00\u4e2a\u5c31\u662f\u770b<code>CPU Trace</code>\u4fe1\u606f\u53d1\u73b0\u6b64\u65f6\u53ea\u6709<code>CPU 0-3</code>\u56db\u4e2a\u5c0f\u6838\u5fc3\u548c\u4e00\u4e2a<code>CPU 4</code>\u4e00\u4e2a\u4e2d\u6838\u5fc3\u5728\u8fd0\u884c\uff0c\u800c\u7b97\u529b\u66f4\u5f3a\u7684<code>CPU 5-7</code>\u90fd\u5904\u4e8e\u5173\u95ed\u72b6\u6001\uff0c\u5bfc\u81f4\u7cfb\u7edf\u603b\u4f53\u7b97\u529b\u53d7\u9650\uff1b\u53e6\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u524d\u53f0\u5e94\u7528\u817e\u8baf\u89c6\u9891\u8fdb\u7a0b\u5185\u7684\u6240\u6709\u7ebf\u7a0b\u8fd0\u884c\u4efb\u52a1\u90fd\u53ea\u5206\u914d\u5230<code>CPU 4</code>\u4e0a\u8fd0\u884c\uff0c\u5176\u5b83\u51e0\u4e2a\u5c0f\u6838\u5fc3\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u4e5f\u6ca1\u6709\u4f7f\u7528\uff0c\u5bfc\u81f4\u817e\u8baf\u89c6\u9891\u5e94\u7528\u7684\u8fd0\u884c\u4e25\u91cd\u53d7\u9650\u3002 \u6700\u7ec8\u7ecf\u8fc7\u5206\u6790\u627e\u5230\u95ee\u9898\u7684\u6839\u672c\u539f\u56e0\u5c31\u662f\uff1a\u4e00\u3001\u5173\u95ed\u7b97\u529b\u66f4\u5f3a\u7684<code>CPU 5-7</code>\u7684\u539f\u56e0\uff0c\u662f\u7cfb\u7edf\u7ec4\u4e3a\u4e86\u964d\u4f4e\u7528\u6237\u5168\u5c4f\u770b\u89c6\u9891\u573a\u666f\u4e0b\u7684\u529f\u8017\u800c\u6545\u610f\u4e3a\u4e4b\uff1b\u4e8c\u3001\u817e\u8baf\u89c6\u9891\u53ea\u80fd\u8fd0\u884c\u5728<code>CPU 4</code>\u4e0a\u7684\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u8be5\u9879\u76ee\u4f7f\u7528\u7684\u662f\u9ad8\u901a\u6700\u65b0\u7684<code>SM8450</code>\u5e73\u53f0\uff0c\u8be5\u5e73\u53f0\u91c7\u7528<code>ARM V9</code>\u67b6\u6784\u8bbe\u8ba1\uff0c<code>32</code>\u4f4d\u7684\u5e94\u7528\u53ea\u80fd\u4f7f\u7528<code>CPU4-6</code>\u4e09\u4e2a\u4e2d\u6838\u8fd0\u884c\uff0c\u800c\u5e94\u7528\u5546\u5e97\u63d0\u4f9b\u7684\u817e\u8baf\u89c6\u9891\u521a\u597d\u5c31\u662f<code>32</code>\u4f4d\u7684\u7248\u672c\u3002 \u81f3\u6b64\u95ee\u9898\u6c34\u843d\u77f3\u51fa\uff0c\u540e\u9762\u89e3\u51b3\u95ee\u9898\u601d\u8def\u5c31\u662f\uff1a\u4e00\u65b9\u9762\u63a8\u52a8\u5e94\u7528\u5546\u5e97\u4e0a\u67b6\u817e\u8baf\u89c6\u9891<code>64</code>\u4f4d\u7248\u672c\uff1b\u4e8c\u662f\u7cfb\u7edf\u7ec4\u90a3\u8fb9\u9700\u8981\u9488\u5bf9<code>32</code>\u4f4d\u7684\u5e94\u7528\u524d\u53f0\u5168\u5c4f\u770b\u89c6\u9891\u7684\u573a\u666f\u4e0b\u7684<code>CPU</code>\u914d\u7f6e\u505a\u51fa\u8c03\u6574\uff0c\u4e0d\u518d\u5168\u90e8\u5173\u95ed<code>CPU 5-7</code>\u4e09\u4e2a\u7b97\u529b\u8f83\u5f3a\u7684\u6838\u5fc3\u3002</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u684c\u9762\u754c\u9762\u5de6\u53f3\u6ed1\u52a8\u51fa\u73b0\u5361\u987f\u6389\u5e27\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece<code>Systrace</code>\u4e0a\u53ef\u4ee5\u770b\u5230\uff1a\u524d\u53f0\u5e94\u7528\u684c\u9762\u51fa\u73b0\u6389\u5e27\u7684\u539f\u56e0\u662f\u5176<code>UI</code>\u7ebf\u7a0b\u62a2\u4e0d\u5230<code>CPU</code>\u8fd0\u7b97\u8d44\u6e90\u800c\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u72b6\u6001\u3002\u800c\u6b64\u65f6\uff0c<code>CPU</code>\u4e0a\u5206\u5e03\u6709\u5927\u91cf\u540e\u53f0\u5e94\u7528\u7684\u4efb\u52a1\u6301\u7eed\u8fd0\u884c\u3002\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56fd\u5185\u90e8\u5206\u5e94\u7528\u5b58\u5728\u5f88\u591a\u8fdb\u7a0b\u4fdd\u6d3b\u673a\u5236\uff0c\u4f1a\u5728\u540e\u53f0\u6301\u7eed\u8fd0\u884c\uff0c\u5e76\u60f3\u65b9\u8bbe\u6cd5\u63d0\u5347\u5176\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u3002\u6240\u4ee5\u5728\u7cfb\u7edf\u5173\u95ed\u4e86\u76f8\u5173\u9488\u5bf9\u6027\u7684\u7ba1\u63a7\u540e\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</p> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9<code>CPU</code>\u8c03\u5ea6\u95ee\u9898\u5f15\u8d77\u7684\u6027\u80fd\u5361\u987f\u95ee\u9898\uff0c\u5e38\u89c1\u7684\u4f18\u5316\u601d\u8def\u6709\uff1a</p> <ol> <li>\u57fa\u4e8e<code>cgroup</code>\u7684\u8fdb\u7a0b\u8d44\u6e90\u9694\u79bb\u3002<code>Android</code>\u7cfb\u7edf\u4e0a\u7ee7\u627f\u4e86<code>linux</code>\u7684<code>cgroup</code>\u673a\u5236\uff0c\u4ee5\u63a7\u5236\u8fdb\u7a0b\u7684\u8d44\u6e90\u5360\u7528\uff0c\u8ba9\u91cd\u8981\u7684\u8fdb\u7a0b\u83b7\u5f97\u66f4\u591a\u7684\u7cfb\u7edf\u8d44\u6e90\u3002\u6d89\u53ca\u7684\u7cfb\u7edf\u8d44\u6e90\u5982\u4e0b\u56fe\u6240\u793a\uff1a  \u5176\u4e2d<code>cpuset</code>\uff08\u53ef\u4ee5\u5b9e\u73b0\u9650\u5236\u8fdb\u7a0b\u53ea\u80fd\u8fd0\u884c\u5728\u6307\u5b9a\u7684<code>CPU</code>\u6838\u5fc3\u4e0a\uff09\u3001<code>cpuctl</code>\uff08\u53ef\u4ee5\u5b9e\u73b0\u63a7\u5236\u524d\u540e\u53f0\u8fdb\u7a0b\u7684<code>CPU</code>\u7528\u91cf\uff09\u548c<code>freezer</code>\uff08\u53ef\u4ee5\u5b9e\u73b0\u63a7\u5236\u8fdb\u7a0b\u5904\u4e8e\u51bb\u7ed3\u4f11\u7720\u72b6\u6001\uff0c\u5b8c\u5168\u653e\u5f03<code>CPU</code>\u6267\u884c\u6743\uff09\u5c31\u662f\u5bf9\u8fdb\u7a0b<code>CPU</code>\u8d44\u6e90\u7684\u63a7\u5236\u3002\u540e\u9762\u7684<code>top-app</code>\u6807\u8bc6\u5f53\u524d\u8fdb\u7a0b\u6240\u5c5e\u7684\u8d44\u6e90\u5206\u7ec4\u3002<code>cgroup</code>\u673a\u5236\u4e2d\u4f1a\u5c06\u4e0d\u540c\u7684\u8fd0\u884c\u8fdb\u7a0b\u5206\u6210\u4e0d\u540c\u7684\u8d44\u6e90\u7ec4\uff0c\u6bd4\u5982\u524d\u53f0\u5e94\u7528\u5c5e\u4e8e<code>top-app</code>\u7ec4\uff0c\u540e\u53f0\u5e94\u7528\u5c5e\u4e8e<code>background</code>\u7ec4\u3002\u4e0d\u540c\u7684\u7ec4\u53ef\u4ee5\u652f\u6301\u914d\u7f6e\u4e0d\u540c\u7684\u8d44\u6e90\u4f7f\u7528\u6743\u9650\uff08\u6bd4\u5982\u901a\u8fc7<code>cpuset</code>\u7684\u914d\u7f6e\uff0c<code>background</code>\u7ec4\u4e2d\u7684\u8fdb\u7a0b\u88ab\u9650\u5236\u53ea\u80fd\u8fd0\u884c\u5728<code>cpu 0-3</code>\u4e09\u4e2a\u5c0f\u6838\u5fc3\u4e0a\uff0c\u800c\u5904\u4e8e<code>top-app</code>\u7ec4\u4e2d\u7684\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528\u6240\u6709\u7684<code>cpu</code>\u6838\u5fc3\u8d44\u6e90\uff09\u3002\u4ee5<code>cpuset</code>\u4e3a\u4f8b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a   \u901a\u8fc7\u8fd9\u79cd\u9650\u5236\u540e\u53f0\u4e0d\u91cd\u8981\u7684\u8fdb\u7a0b\u7684<code>CPU</code>\u8d44\u6e90\u5360\u7528\uff0c\u4ece\u800c\u8ba9\u524d\u53f0\u91cd\u8981\u7684\u5e94\u7528\u8fdb\u7a0b\u83b7\u5f97\u66f4\u591a\u7684<code>CPU</code>\u8d44\u6e90\uff08\u81f3\u4e8e\u8fdb\u7a0b\u7684\u524d\u540e\u53f0\u4f18\u5148\u7ea7\u5b9a\u4e49\uff0c\u4e3b\u8981\u662f\u7531\u6846\u67b6<code>AMS</code>\u670d\u52a1\u6765\u7ba1\u7406\u7ef4\u62a4\uff0c\u901a\u8fc7\u5199\u8fdb\u7a0b\u7684<code>oom_score_adj</code>\u503c\u6765\u6807\u8bc6\uff09\u3002\u56fd\u5185\u5404\u5927\u624b\u673a\u5382\u5546\u7684\u7cfb\u7edf\u6027\u80fd\u4f18\u5316\u7684\u7b56\u7565\u4e2d\uff0c\u6709\u5f88\u5927\u4e00\u90e8\u5206\u5de5\u4f5c\u90fd\u662f\u4f9d\u8d56\u4e8e<code>cgroup</code>\u673a\u5236\u6765\u5b9e\u73b0\u7684\uff0c\u901a\u8fc7\u5bf9\u7cfb\u7edf\u8d44\u6e90\u7cbe\u7ec6\u7684\u5b9a\u4e49\u5212\u5206\uff0c\u548c\u5e94\u7528\u8fdb\u7a0b\u4f18\u5148\u7ea7\u4e0e\u529f\u80fd\u573a\u666f\u7684\u7cbe\u51c6\u8bc6\u522b\uff0c\u6765\u5b9e\u73b0\u5bf9\u8d44\u6e90\u7684\u5408\u7406\u5206\u914d\uff0c\u8fbe\u5230\u6027\u80fd\u4e0e\u529f\u8017\u7684\u6700\u4f73\u5e73\u8861\u3002</li> <li> <p>\u57fa\u4e8e\u573a\u666f\u8bc6\u522b\u7684<code>CPU</code>\u8c03\u5ea6\u7b56\u7565\u914d\u7f6e\u3002\u4e3b\u8981\u5de5\u4f5c\u5305\u62ec\uff1a</p> <ul> <li>\u5bf9<code>CPU</code>\u57fa\u7840\u914d\u7f6e\u5f71\u54cd\u5404\u6838\u7684\u6027\u80fd\u8f93\u51fa\uff1a\u5305\u62ec<code>CPU Frequency</code>\u8fd0\u884c\u4e3b\u9891\u8c03\u8282\u3001\u6392\u7a0b\u5668\u5927\u6838\u5c0f\u6838\u5de5\u4f5c\u5206\u914d\u7b56\u7565<code>upmigrate/downmigrate/sched_boost</code>\u7684\u8c03\u8282\uff08\u6839\u636e<code>CPU</code>\u5404\u6838\u5fc3\u7684\u4efb\u52a1\u8d1f\u8f7d\uff0c\u5bf9\u7ebf\u7a0b\u4efb\u52a1\u8fdb\u884c\u5927\u5c0f\u6838\u5206\u5e03\u7684\u8fc1\u79fb\u8c03\u6574\uff09\uff0c\u4ee5\u4e0a\u90fd\u662f\u901a\u8fc7<code>Soc</code>\u5382\u5546\u63d0\u4f9b\u7684<code>Perf</code>\u670d\u52a1\u63a5\u53e3\u8bbe\u7f6e\u53c2\u6570\uff0c\u53bb\u5199\u76f8\u5173\u7684\u8bbe\u5907\u8282\u70b9\u5b9e\u73b0\uff0c\u4ee5\u9ad8\u901a\u5e73\u53f0\u4e3a\u4f8b\u76f8\u5173\u8282\u70b9\u5982\u4e0b\u56fe\u6240\u793a\uff1a    \u8fd8\u6709\u6e29\u63a7\u7b56\u7565\u7684\u914d\u7f6e\u8c03\u6574\uff08\u51fa\u4e8e\u529f\u8017\u4e0e\u53d1\u70ed\u7684\u8003\u91cf\uff0c\u79fb\u52a8\u8bbe\u5907\u4e0a\u6e29\u63a7\u673a\u5236<code>thermal-engine</code>\u670d\u52a1\uff0c\u4f1a\u6839\u636e\u904d\u5e03\u8bbe\u5907\u5185\u90e8\u7684\u5404\u4e2a\u6e29\u5ea6\u4f20\u611f\u5668\u8bfb\u53d6\u7684\u6e29\u5ea6\u503c\uff0c\u6309\u7167\u4e00\u5b9a\u7684\u6e29\u5ea6\u9608\u503c\u5bf9<code>CPU</code>\u8fd0\u884c\u4e3b\u9891\u8fdb\u884c\u9650\u5236\uff0c\u4ee5\u9632\u6b62\u8bbe\u5907\u8fc7\u70ed\uff09\uff1b</li> <li>\u5bf9\u573a\u666f\u7684\u5b9a\u4e49\u8bc6\u522b\u4e0e\u7b56\u7565\u914d\u7f6e\uff1a\u6bd4\u5982\u5b9a\u4e49\u5e94\u7528\u51b7\u542f\u52a8\u573a\u666f\uff0c\u5728\u6846\u67b6\u8fdb\u884c\u8bc6\u522b\uff0c\u5e76\u52a8\u6001\u5c06<code>CPU</code>\u4e3b\u9891\u8fdb\u884c\u62c9\u5347\u4e00\u6bb5\u65f6\u95f4\uff0c\u4ee5\u63d0\u5347\u5e94\u7528\u6253\u5f00\u901f\u5ea6\uff1b\u5b9a\u4e49\u89c6\u9891\u64ad\u653e\u7684\u573a\u666f\uff0c\u5728\u6846\u67b6\u8fdb\u884c\u8bc6\u522b\uff0c\u7136\u540e\u5bf9<code>CPU</code>\u4e3b\u9891\u8fdb\u884c\u9650\u9891\uff0c\u5728\u4fdd\u8bc1\u64ad\u653e\u6d41\u7545\u7684\u524d\u63d0\u4e0b\uff0c\u5c3d\u91cf\u964d\u4f4e\u529f\u8017\u548c\u53d1\u70ed\uff1b\u8fd9\u5757\u4e5f\u5c5e\u4e8e\u56fd\u5185\u5404\u5927\u624b\u673a\u5382\u5546\u7684\u7cfb\u7edf\u6027\u80fd\u4f18\u5316\u7684\u6838\u5fc3\u5de5\u4f5c\u3002\u5982\u4f55\u5b9e\u73b0\u7cbe\u786e\u7684\u573a\u666f\u5b9a\u4e49\u4e0e\u8bc6\u522b\uff0c\u7cbe\u51c6\u63a7\u5236<code>CPU</code>\u7684\u6027\u80fd\u8f93\u51fa\uff0c\u7528\u6700\u5c0f\u7684\u529f\u8017\uff0c\u4fdd\u8bc1\u5e94\u7528\u754c\u9762\u7684\u6d41\u7545\u8fd0\u884c\uff0c\u5c31\u662f\u5bf9\u5382\u5546\u529f\u529b\u7684\u8003\u9a8c\u3002</li> </ul> </li> <li> <p>\u5bf9\u4e09\u65b9\u5e94\u7528\u540e\u53f0\u76f8\u4e92\u5524\u9192\u548c\u8fdb\u7a0b\u4fdd\u6d3b\u673a\u5236\u7684\u9650\u5236\uff0c\u9632\u6b62\u5176\u5728\u540e\u53f0\u6301\u7eed\u8fd0\u884c\u62a2\u5360CPU\u7b97\u529b\u8d44\u6e90\u3002\u8fd9\u5757\u4e5f\u662f\u56fd\u5185\u5404\u5927\u624b\u673a\u5382\u5546\u7cfb\u7edf\u4f18\u5316\u7684\u91cd\u70b9\u5de5\u4f5c\u4e4b\u4e00\u3002</p> </li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#22-gpu","title":"2.2 GPU\u8c03\u5ea6\u5f15\u8d77\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p><code>GPU</code>\u7b97\u529b\u8d44\u6e90\u662f\u7ee7<code>CPU</code>\u7b97\u529b\u5916\uff0c\u7cfb\u7edf\u5185\u53e6\u4e00\u4e2a\u91cd\u8981\u7684\u516c\u5171\u8d44\u6e90\uff0c\u4ece\u524d\u6587<code>Android</code>\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u6d41\u7a0b\u5206\u6790\u53ef\u77e5\uff0c\u5e94\u7528\u5bf9\u6bcf\u4e00\u5e27\u753b\u9762\u7684\u6e32\u67d3\u5904\u7406\u90fd\u79bb\u4e0d\u5f00<code>GPU</code>\u7b97\u529b\u7684\u652f\u6491\u3002\u548c<code>CPU</code>\u7c7b\u4f3c\uff0c\u8bbe\u5907\u7684<code>GPU</code>\u4e5f\u6709\u81ea\u5df1\u7684\u8fd0\u884c\u4e3b\u9891\uff08\u8fd0\u884c\u4e3b\u9891\u8d8a\u9ad8\uff0c\u7b97\u529b\u8d8a\u5f3a\uff0c\u540c\u65f6\u53d1\u70ed\u4e5f\u5c31\u8d8a\u5927\uff09\uff0c\u4e14\u652f\u6301\u5728\u4e00\u5b9a\u7684\u8303\u56f4\u5185\u8c03\u8282\uff0c\u4ee5\u5b9e\u73b0\u529f\u8017\u548c\u6027\u80fd\u7684\u6700\u4f73\u5e73\u8861\u3002\u4ee5\u9ad8\u901a<code>SM8450</code>\u5e73\u53f0\u6240\u642d\u8f7d\u7684\u578b\u53f7\u4e3a<code>Adreno 730</code>\u7684<code>GPU</code>\u4e3a\u4f8b\uff0c\u5176\u53c2\u6570\u4fe1\u606f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c<code>GPU</code>\u652f\u6301\u5728\u4e00\u5b9a\u7684\u8303\u56f4\u5185\u52a8\u6001\u8c03\u8282\u8fd0\u884c\u4e3b\u9891\uff0c<code>Soc</code>\u5382\u5546\u548c\u56fd\u5185\u7684\u624b\u673a\u5382\u5546\u4f1a\u6839\u636e\u4efb\u52a1\u8d1f\u8f7d\u548c\u4f7f\u7528\u573a\u666f\uff0c\u52a8\u6001\u8c03\u8282<code>GPU</code>\u7684\u5de5\u4f5c\u9891\u7387\u4ee5\u5b9e\u73b0\u529f\u8017\u4e0e\u6027\u80fd\u7684\u6700\u4f73\u5e73\u8861\u3002\u4f46\u662f\u5982\u679c\u8c03\u8282\u4e0d\u5408\u7406\uff0c\u5c31\u53ef\u80fd\u5f15\u8d77\u6027\u80fd\u95ee\u9898\uff0c\u5e38\u89c1\u7684\u4e00\u4e9b\u539f\u56e0\u5982\u4e0b\uff1a</p> <ol> <li>\u90e8\u5206\u5927\u578b\u6e38\u620f\u5e94\u7528\uff08\u5982\u539f\u795e\uff09\u9700\u8981\u5927\u91cf\u7684<code>GPU</code>\u7b97\u529b\u8fdb\u884c\u6e38\u620f\u753b\u9762\u7684\u5b9e\u65f6\u6e32\u67d3\u5904\u7406\uff0c\u5982\u679c\u7cfb\u7edf\u7684<code>GPU</code>\u8fd0\u884c\u4e3b\u9891\u7b97\u529b\u6ca1\u6709\u53ca\u65f6\u7684\u8ddf\u4e0a\u6765\uff0c\u65e0\u6cd5\u6ee1\u8db3\u5e94\u7528\u5bf9<code>GPU</code>\u7b97\u529b\u7684\u9700\u6c42\u5c31\u4f1a\u5bfc\u81f4\u6e38\u620f\u5e94\u7528\u4e0a\u5e27\u65f6\u51fa\u73b0\u963b\u585e\u8d85\u65f6\u800c\u6389\u5e27\uff1b</li> <li>\u90e8\u5206\u5e94\u7528\u5728\u540e\u53f0\u5229\u7528<code>GPU</code>\u505a\u4e00\u4e9b\u56fe\u50cf\u5904\u7406\u7684\u5e76\u884c\u8ba1\u7b97\uff0c\u62a2\u5360\u4e86\u7cfb\u7edf\u7684<code>GPU</code>\u7b97\u529b\u8d44\u6e90\uff1b\u5c31\u53ef\u80fd\u5bfc\u81f4\u524d\u53f0\u5e94\u7528\u7ed8\u5236\u4e0a\u5e27\u65f6\uff0c\u7531\u4e8e<code>GPU</code>\u7b97\u529b\u4e0d\u8db3\uff0c\u4f7f\u5176\u6e32\u67d3\u7ebf\u7a0b\u9677\u5165\u957f\u65f6\u95f4\u963b\u585e\u7b49\u5f85<code>GPU</code>\u6e32\u67d3\u5b8c\u6210\u7684<code>Fence</code>\u4fe1\u53f7\u7684\u72b6\u6001\uff0c\u6700\u7ec8\u51fa\u73b0\u4e0a\u5e27\u8d85\u65f6\u5361\u987f\u7684\u95ee\u9898\u3002</li> </ol> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u4e09\u65b9\u5e94\u7528<code>UC</code>\u6d4f\u89c8\u5668\u754c\u9762\u6ed1\u52a8\u5361\u987f\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u7684<code>Systrace</code>\u53ef\u4ee5\u770b\u51fa\uff0c<code>UC</code>\u6d4f\u89c8\u5668\u51fa\u73b0\u4e0a\u5e27\u8d85\u65f6\u7684\u4e3b\u8981\u539f\u56e0\u662f\uff0c\u5176<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\u957f\u65f6\u95f4\u963b\u585e\u5728<code>queueBuffer</code>\u4e0a\u5e27\u7684\u6d41\u7a0b\u4e0a\uff0c\u800c<code>queueBuffer</code>\u963b\u585e\u5728<code>SurfaceFlinger</code>\u8fdb\u7a0b\u90a3\u8fb9\u7684<code>Binder</code>\u54cd\u5e94\uff0c\u800c<code>SurfaceFlinger</code>\u8fdb\u7a0b\u4e2d\u53c8\u9700\u8981\u7b49\u5f85<code>GPU</code>\u90a3\u8fb9\u5b8c\u6210\u753b\u9762\u6e32\u67d3\u5904\u7406\u7684<code>fence</code>\u4fe1\u53f7\u7684\uff08\u4ece\u5e94\u7528\u8fdb\u7a0b\u4fa7\u7684<code>waiting for GPU completion</code>\u7684<code>systrace tag</code>\u4e5f\u80fd\u770b\u51fa\uff09\u3002\u5982\u4e0b\u7b80\u5316\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>/*frameworks/native/libs/gui/BufferQueueProducer.cpp*/\nstatus_t BufferQueueProducer::queueBuffer(int slot,\nconst QueueBufferInput &amp;input, QueueBufferOutput *output) {\nATRACE_CALL();\n...\n// Wait without lock held\nif (connectedApi == NATIVE_WINDOW_API_EGL) {\n// Waiting here allows for two full buffers to be queued but not a\n// third. In the event that frames take varying time, this makes a\n// small trade-off in favor of latency rather than throughput.\nlastQueuedFence-&gt;waitForever(\"Throttling EGL Production\"); // \u7b49\u5f85GPU fence\u4fe1\u53f7\n}\nreturn NO_ERROR;\n}  </code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u95ee\u9898\u51fa\u5728\u7cfb\u7edf\u7684<code>GPU</code>\u7b97\u529b\u8d44\u6e90\u6bd4\u8f83\u7d27\u5f20\u3002\u540e\u6765\u5206\u6790\u5e94\u7528\u6389\u5e27\u7684\u540c\u4e00\u65f6\u95f4\u6bb5\u7cfb\u7edf\u7684\u5176\u5b83\u8fd0\u884c\u8fdb\u7a0b\u7684<code>systrace</code>\u8868\u73b0\uff0c\u53d1\u73b0\u7cfb\u7edf\u7684\u56fe\u5e93\u5e94\u7528\u6b63\u5728\u6267\u884c\u4e00\u4e9b<code>Bitmap</code>\u56fe\u50cf\u5904\u7406\u7684\u52a8\u4f5c\u3002\u518d\u7ed3\u5408\u65e5\u5fd7\u5206\u6790\u540e\u4e0e\u8d1f\u8d23\u56fe\u5e93\u7684\u540c\u4e8b\u6c9f\u901a\uff0c\u6700\u7ec8\u627e\u5230\u95ee\u9898\u7684\u6839\u672c\u539f\u56e0\u6240\u5728\uff1a\u56fe\u5e93\u5e94\u7528\u4e2d\u6709\u4e00\u4e2a\u4e8b\u7269\u5206\u7c7b\u76f8\u518c\u7684\u529f\u80fd\uff0c\u5f53\u65f6\u6b63\u5728\u540e\u53f0\u4f7f\u7528<code>GPU</code>\u8fdb\u884c\u7167\u7247\u56fe\u50cf\u7684\u7279\u5f81\u8bc6\u522b\u4e0e\u5904\u7406\u7684\u903b\u8f91\uff0c\u62a2\u5360\u4e86\u7cfb\u7edf<code>GPU</code>\u7b97\u529b\u8d44\u6e90\uff0c\u4ece\u800c\u5bfc\u81f4\u524d\u53f0<code>UC</code>\u6d4f\u89c8\u5668\u5e94\u7528\u7684\u6e32\u67d3\u7ebf\u7a0b\u963b\u585e\u5728\u7b49\u5f85<code>GPU</code>\u7684<code>fence</code>\u4fe1\u53f7\u7684\u6d41\u7a0b\u800c\u51fa\u73b0\u6389\u5e27\u3002</p> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9<code>GPU</code>\u8c03\u5ea6\u95ee\u9898\u5f15\u8d77\u7684\u6027\u80fd\u5361\u987f\u95ee\u9898\uff0c\u5e38\u89c1\u7684\u4f18\u5316\u601d\u8def\u6709\uff1a</p> <ol> <li>\u57fa\u4e8e\u573a\u666f\u7684<code>GPU</code>\u8c03\u5ea6\u7b56\u7565\u914d\u7f6e\u3002\u8fd9\u5757\u4e3b\u8981\u662f\u7ed3\u5408\u524d\u53f0\u5e94\u7528\u573a\u666f\u7684\u9700\u6c42\uff0c\u52a8\u6001\u8c03\u8282<code>GPU</code>\u7684\u8fd0\u884c\u4e3b\u9891\u7b49\u53c2\u6570\uff0c\u4ee5\u6700\u5c0f\u7684\u529f\u8017\u6ee1\u8db3\u5e94\u7528\u7684\u6027\u80fd\u9700\u6c42\u3002\u8fd9\u5757\u8003\u9a8c\u5404\u5927\u624b\u673a\u5382\u5546\u7684\u8c03\u6559\u6c34\u5e73\uff0c\u4e5f\u662f\u5382\u5546\u8fdb\u884c\u6e38\u620f\u4f18\u5316\u8c03\u6559\u7684\u91cd\u70b9\u5de5\u4f5c\u4e4b\u4e00\u3002</li> <li>\u540e\u53f0\u5e94\u7528\u8fdb\u7a0b\u62a2\u5360<code>GPU</code>\u7b97\u529b\u8d44\u6e90\u7684\u7ba1\u63a7\u3002\u4e3b\u8981\u662f\u9650\u5236\u540e\u53f0\u5e94\u7528\u7684\u8fd0\u884c\uff0c\u9632\u6b62\u5176\u51fa\u73b0\u62a2\u5360<code>GPU</code>\u7b97\u529b\u8d44\u6e90\u7684\u884c\u4e3a\uff0c\u4ee5\u4fdd\u8bc1\u524d\u53f0\u5e94\u7528\u7684\u6d41\u7545\u8fd0\u884c\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#23","title":"2.3 \u4f4e\u5185\u5b58\u5f15\u8d77\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p>\u5185\u5b58\u4e5f\u7edd\u5bf9\u7b97\u7684\u4e0a\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u7cfb\u7edf\u516c\u5171\u8d44\u6e90\uff0c\u7cfb\u7edf\u5185\u4efb\u4f55\u8fdb\u7a0b\u7684\u6b63\u5e38\u8fd0\u884c\u90fd\u9700\u8981\u6d88\u8017\u4e00\u5b9a\u7684\u5185\u5b58\u8d44\u6e90\u3002\u4e00\u822c\u6765\u8bb2\u8bbe\u5907\u7684<code>RAM</code>\u786c\u4ef6\u7269\u7406\u5185\u5b58\u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u4e14\u6709\u9650\u7684\uff08<code>4G\u30018G\u621612G</code>\u7b49\uff09\uff0c\u800c\u7cfb\u7edf\u5185\u8fd0\u884c\u7684\u6240\u6709\u8fdb\u7a0b\u90fd\u9700\u8981\u5171\u4eab\u8fd9\u4e9b\u6709\u9650\u5185\u5b58\u8d44\u6e90\u3002\u5982\u4f55\u7528\u6709\u9650\u7684\u5185\u5b58\u8d44\u6e90\u53bb\u6ee1\u8db3\u7cfb\u7edf\u5404\u4e2a\u5e94\u7528\u8fdb\u7a0b\u65e0\u9650\u7684\u9700\u6c42\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230\u4e00\u4e2a\u7cfb\u7edf\u5185\u5b58\u7ba1\u7406\u7684\u903b\u8f91\u3002\u8fd9\u662f\u4e00\u4e2a\u590d\u6742\u7684\u95ee\u9898\uff0c\u51e0\u4e4e\u8d2f\u7a7f\u4e86\u6574\u4e2a<code>Android</code>\u7cfb\u7edf\u7684\u5404\u4e2a\u5c42\u7ea7\u3002\u4ece<code>Linux</code>\u5185\u6838\u5230<code>Art</code>\u865a\u62df\u673a\uff0c\u518d\u5230<code>Framework</code>\u6846\u67b6\uff0c\u751a\u81f3\u5230<code>APP</code>\u5e94\u7528\uff0c\u90fd\u4f1a\u6709\u5404\u81ea\u7684\u5185\u5b58\u7ba1\u7406\u7684\u7b56\u7565\u3002\u5173\u4e8e<code>Android</code>\u7cfb\u7edf\u7684\u5185\u5b58\u7ba1\u7406\u7684\u8be6\u7ec6\u903b\u8f91\uff0c\u7531\u4e8e\u7bc7\u5e45\u6240\u9650\u672c\u6587\u5c31\u4e0d\u8be6\u7ec6\u5c55\u5f00\u3002\u6211\u4eec\u4ee5<code>systemui</code>\u5e94\u7528\u8fdb\u7a0b\u4e3a\u4f8b\uff0c\u6765\u770b\u770b\u4e00\u4e2a\u666e\u901a\u5e94\u7528\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528\u5206\u5e03\uff1a</p> <p></p> <p>\u5408\u7406\u7684\u5185\u5b58\u7684\u5206\u914d\u4e0e\u7ba1\u7406\u65e0\u8bba\u5bf9\u7cfb\u7edf\u548c\u5e94\u7528\u6765\u8bb2\u90fd\u81f3\u5173\u91cd\u8981\u3002\u56e0\u4e3a\u5185\u5b58\u95ee\u9898\u65e2\u80fd\u5f15\u53d1\u7a33\u5b9a\u6027\u95ee\u9898\uff0c\u4e5f\u80fd\u5f15\u53d1\u5361\u987f\u6027\u80fd\u95ee\u9898\u3002 \u4e0b\u9762\u6211\u4eec\u5206\u522b\u6765\u5206\u6790\u4e00\u4e0b\uff1a</p> <ol> <li> <p>\u5185\u5b58\u5f15\u8d77\u7684\u7a33\u5b9a\u6027\u95ee\u9898\uff1a</p> <ul> <li>\u56e0\u4e3a\u7cfb\u7edf\u603b\u7684\u5185\u5b58\u8d44\u6e90\u662f\u6709\u9650\u7684\uff0c\u4e3a\u4e86\u9632\u6b62\u5355\u4e2a\u5e94\u7528\u8fdb\u7a0b\u65e0\u9650\u5236\u7684\u5360\u7528\u5185\u5b58\u8d44\u6e90\uff0c<code>Android</code>\u7cfb\u7edf\u8bbe\u8ba1\u4e86\u5f88\u591a\u673a\u5236\u6765\u904f\u5236\u8fd9\u79cd\u60c5\u51b5\u7684\u4ea7\u751f\u3002\u6bd4\u5982\u5728\u865a\u62df\u673a\u5c42\u9762\uff0c\u8c37\u6b4c\u8bbe\u8ba1\u5bf9\u6bcf\u4e2a\u5e94\u7528\u8fdb\u7a0b\u5360\u7528\u7684<code>Dalvik Heap</code>\u7684\u5185\u5b58\u5927\u5c0f\u505a\u51fa\u4e86\u9650\u5236\uff0c\u8d85\u8fc7\u4e00\u5b9a\u7684\u9608\u503c\uff08\u8bb0\u5f55\u5728<code>dalvik.vm.heapgrowthlimit</code>\u7684<code>property</code>\u4e2d\uff0c\u4e00\u822c\u4e3a<code>256M</code>\uff09\uff0c\u5c31\u4f1a\u89e6\u53d1<code>OutOfMemeory</code>\u7684\u5f02\u5e38\uff0c\u5bfc\u81f4\u5e94\u7528\u8fdb\u7a0b\u5d29\u6e83\u3002\u6b64\u5916<code>Android</code>\u7cfb\u7edf\u8fd8\u5f15\u5165\u4e86<code>lmkd</code>\u4f4e\u5185\u5b58\u5b88\u62a4\u673a\u5236\uff0c\u5f53\u7cfb\u7edf\u603b\u7684\u53ef\u7528\u5185\u5b58\u4f4e\u4e8e\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u5c31\u4f1a\u6309\u7167\u8fdb\u7a0b\u4f18\u5148\u7ea7\uff0c\u5c06\u5360\u7528\u5185\u5b58\u6bd4\u8f83\u5927\u7684\u5e94\u7528\u8fdb\u7a0b\u6740\u6389\u3002</li> <li><code>32</code>\u4f4d\u7684\u5e94\u7528\u865a\u62df\u5185\u5b58\u7684\u5bfb\u5740\u7a7a\u95f4\u6700\u5927\u4e3a<code>4G</code>\uff0c\u5f53\u5e94\u7528\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u5360\u7528\u8d85\u8fc7<code>4G</code>\u65f6\uff0c\u5c31\u65e0\u6cd5\u7ee7\u7eed\u4e3a\u5176\u5206\u914d\u5185\u5b58\uff0c\u4ea7\u751f<code>OOM</code>\u7c7b\u578b\u7684\u62a5\u9519\uff0c\u51fa\u73b0\u5e94\u7528\u5d29\u6e83\u6216\u9ed1\u5c4f\u7b49\u95ee\u9898\u3002</li> <li>\u53e6\u5916Android\u7cfb\u7edf\u57fa\u4e8eLinux\u5185\u6838\uff0c\u4e5f\u7ee9\u627f\u4e86Linux\u7cfb\u7edf\u5bf9\u5e94\u7528\u8fdb\u7a0b\u7684\u76f8\u5173\u9650\u5236\u3002\u5982\u679c\u5e94\u7528\u8fdb\u7a0b\u4e2d\u5f00\u542f\u7684\u7ebf\u7a0b\u8fc7\u591a\uff08\u6bcf\u521b\u5efa\u4e00\u4e2a\u7a7a\u7ebf\u7a0b\u4e5f\u4f1a\u6709\u4e00\u5b9a\u7684\u5185\u5b58\u5f00\u9500\uff09\uff0c\u8d85\u8fc7/proc/sys/kernel/threads-max\u4e2d\u5b9a\u4e49\u7684\u4e0a\u9650\uff0c\u4e5f\u4f1a\u62a5\u51faOOM\u5f02\u5e38\u5bfc\u81f4\u5e94\u7528\u8fdb\u7a0b\u5d29\u6e83\uff1b\u518d\u6bd4\u5982\u5e94\u7528\u8fdb\u7a0b\u4e2d\u6253\u5f00\u7684\u6587\u4ef6\u53e5\u67c4\u8fc7\u591a\uff0c\u8d85\u8fc7/proc/pid/limits\u8282\u70b9\u4e2d\u7684\u5b9a\u4e49\u4e0a\u9650\uff0c\u4e5f\u4f1a\u62a5\u51faOOM\u5f02\u5e38\u5bfc\u81f4\u5e94\u7528\u8fdb\u7a0b\u5d29\u6e83\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ul> <p></p> </li> <li> <p>\u5185\u5b58\u5f15\u8d77\u7684\u6027\u80fd\u6027\u95ee\u9898\uff1a</p> <ul> <li>\u5f53\u5e94\u7528\u51fa\u73b0\u5185\u5b58\u6296\u52a8\u6216\u5185\u5b58\u6cc4\u9732\u7684\u95ee\u9898\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u865a\u62df\u673a\u7684<code>GC</code>\u9891\u7e41\u5de5\u4f5c\uff0c\u751a\u81f3\u89e6\u53d1<code>stop-the-world</code>\u4e8b\u4ef6\uff0c\u9020\u6210\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u51fa\u73b0\u6302\u8d77\u963b\u585e\uff0c\u6700\u7ec8\u5bfc\u81f4\u4e0a\u5e27\u51fa\u73b0\u8d85\u65f6\u800c\u6389\u5e27\u3002</li> <li>\u5f53\u540e\u53f0\u6d3b\u8dc3\u8fd0\u884c\u7684\u5e94\u7528\u8fdb\u7a0b\u8fc7\u591a\u65f6\uff0c\u4f1a\u9020\u6210\u7cfb\u7edf\u603b\u4f53\u7684\u5269\u4f59\u5185\u5b58\u504f\u4f4e\u3002\u6b64\u65f6\u4e3b\u8981\u6709\u4e24\u4e2a\u95ee\u9898\u53ef\u80fd\u4f1a\u9020\u6210\u5e94\u7528\u7684\u5361\u987f\uff1a<ul> <li>\u5f53\u5185\u5b58<code>zone</code>\u5904\u4e8e\u4f4e\u6c34\u4f4d\u65f6\uff0c\u5185\u6838\u4f1a\u9891\u7e41\u5524\u9192<code>kswapd</code>\u7684\u7ebf\u7a0b\u8d77\u6765\u6267\u884c\u5185\u5b58\u56de\u6536\u7684\u52a8\u4f5c\uff1b\u53e6\u5916\u5185\u6838<code>PSI</code>\u5185\u5b58\u538b\u529b\u4fe1\u53f7\u4e5f\u4f1a\u9891\u7e41\u5524\u9192<code>lmkd</code>\u8fdb\u7a0b\uff0c\u8fdb\u884c\u626b\u63cf\u548c\u6740\u8fdb\u7a0b\u3002\u8fd9\u4e9b\u52a8\u4f5c\u90fd\u4f1a\u5360\u7528<code>CPU</code>\u8fd0\u884c\u8d44\u6e90\uff0c\u5bfc\u81f4\u524d\u53f0\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u7531\u4e8e\u62a2\u4e0d\u5230\u8fd0\u884c<code>CPU</code>\u8d44\u6e90\u800c\u51fa\u73b0\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u7684\u95ee\u9898\uff1b</li> <li>\u5f53\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c<code>kswapd</code>\u7684\u7ebf\u7a0b\u88ab\u5524\u9192\u8fdb\u884c\u5185\u5b58\u56de\u6536\uff0c\u4f1a\u5c06<code>page cache</code>\u5185\u5b58\u9875\u4e2d\u5df2\u7ecf\u7f13\u5b58\u7684\u78c1\u76d8\u6587\u4ef6\u4fe1\u606f\u8fdb\u884c\u5927\u91cf\u91ca\u653e\uff0c\u5bfc\u81f4\u5e94\u7528\u8fdb\u7a0b\u4e2d\u7684\u4e00\u4e9b<code>IO</code>\u8bfb\u6587\u4ef6\u64cd\u4f5c\uff08\u6bd4\u5982 <code>view</code> \u8bfb\u6587\u4ef6\uff0c\u8bfb\u914d\u7f6e\u6587\u4ef6\u3001\u8bfb <code>odex</code> \u6587\u4ef6\u7b49\uff09\uff0c\u7531\u4e8e<code>page cache</code>\u65e0\u6cd5\u547d\u4e2d\uff0c\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u9677\u5165\u5185\u6838\u6001\u963b\u585e\u7b49\u5f85\uff0c\u4e00\u76f4\u7b49\u5230<code>readahead</code>\u673a\u5236\u4ece\u78c1\u76d8\u4e2d\u5c06\u6587\u4ef6\u5185\u5bb9\u5168\u90e8\u8bfb\u53d6\u51fa\u6765\u624d\u80fd\u91ca\u653e\u8fd4\u56de\u3002\u5f53\u5927\u91cf\u8fdb\u7a0b\u5728\u8fdb\u884c<code>IO</code>\u64cd\u4f5c\u65f6\uff0c\u53c8\u8fdb\u4e00\u6b65\u52a0\u91cd\u5e95\u5c42<code>IO</code>\u7684\u963b\u585e\u65f6\u957f\u3002\u6700\u7ec8\u5bfc\u81f4\u524d\u53f0\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u957f\u65f6\u95f4\u5904\u4e8e<code>Uninterruptible Sleep - Block I/O</code>\u7684\u72b6\u6001\u800c\u51fa\u73b0\u4e0a\u5e27\u8d85\u65f6\u5361\u987f\u95ee\u9898\u3002</li> </ul> </li> </ul> </li> </ol> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u5728\u4e09\u65b9\u5e94\u7528\u552f\u54c1\u4f1a\u7684\u9996\u9875\u754c\u9762\u4e0a\u4e0b\u6ed1\u52a8\u4e25\u91cd\u6389\u5e27\u5361\u987f\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece<code>Systrace</code>\u4e0a\u53ef\u4ee5\u770b\u5230\uff0c\u552f\u54c1\u4f1a\u5e94\u7528\u51fa\u73b0\u6389\u5e27\u5361\u987f\u7684\u4e3b\u8981\u539f\u56e0\u5982\u4e0b\uff1a</p> <ol> <li>\u7cfb\u7edf\u5185\u5b58\u7d27\u5f20\uff0c\u9891\u7e41\u5524\u9192<code>kswapd0</code>\u7ebf\u7a0b\u8fdb\u884c\u5185\u5b58\u56de\u6536\u64cd\u4f5c\uff0c\u5176\u6301\u7eed\u62a2\u5360<code>CPU 5</code>\u5927\u6838\u5fc3\u8fd0\u884c\uff0c\u5bfc\u81f4\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u548c<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\u9891\u7e41\u51fa\u73b0\u62a2\u4e0d\u5230<code>CPU</code>\u8d44\u6e90\u5f97\u4e0d\u5230\u6267\u884c\uff0c\u800c\u5904\u4e8e<code>Runnable</code>\u7684\u72b6\u6001\uff0c\u4ece\u800c\u5bfc\u81f4\u5e94\u7528\u4e0a\u5e27\u8d85\u65f6\u800c\u6389\u5e27\uff1b</li> <li>\u7cfb\u7edf\u5185\u5b58\u7d27\u5f20\u65f6\uff0c<code>page cache</code>\u78c1\u76d8\u6587\u4ef6\u7f13\u5b58\u88ab\u5185\u5b58\u56de\u6536\uff0c\u5bfc\u81f4\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u548c<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\u4e2d\u7684\u4e00\u4e9b<code>IO</code>\u8bfb\u6587\u4ef6\u64cd\u4f5c\u65e0\u6cd5\u547d\u4e2d<code>page cache</code>\u7f13\u5b58\u800c\u9891\u7e41\u9677\u5165\u5185\u6838<code>Uninterruptible Sleep - Block I/O</code>\u7684\u72b6\u6001\uff0c\u5bfc\u81f4\u5e94\u7528\u4e0a\u5e27\u8d85\u65f6\u800c\u6389\u5e27\u3002</li> </ol> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9\u5185\u5b58\u95ee\u9898\u5f15\u8d77\u7684\u6027\u80fd\u5361\u987f\u95ee\u9898\uff0c\u5e38\u89c1\u7684\u4f18\u5316\u601d\u8def\u6709\uff1a</p> <ol> <li> <p>\u5728\u5e94\u7528\u8fdb\u7a0b\u4fa7\uff1a\u4f5c\u4e3a\u5e94\u7528\u5f00\u53d1\u8005\uff1a</p> <ul> <li>\u9700\u8981\u89e3\u51b3\u5e94\u7528\u81ea\u8eab\u7684 \u5185\u5b58\u6cc4\u6f0f \u95ee\u9898\uff0c\u907f\u514d\u9891\u7e41\u7684\u5185\u5b58\u5206\u914d\u56de\u6536\u51fa\u73b0\u7684 \u5185\u5b58\u6296\u52a8 \u73b0\u8c61\uff1b</li> <li>\u5e76\u5c3d\u91cf \u4f18\u5316\u5e94\u7528\u7684\u5185\u5b58\u5360\u7528\uff0c\u5305\u62ec\u4f18\u5316\u56fe\u7247\u52a0\u8f7d\u5360\u7528\u3001\u91c7\u7528\u5185\u5b58\u66f4\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\uff08\u5982<code>ArrayMap</code>\uff09\u3001\u91c7\u7528\u5bf9\u8c61\u6c60\u548c\u56fe\u7247\u590d\u7528\u7b49\u5185\u5b58\u590d\u7528\u673a\u5236\u3001\u529f\u80fd\u6bd4\u8f83\u590d\u6742\u7684\u5e94\u7528\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u6848\u3001\u5c3d\u91cf\u4f18\u5316\u5e94\u7528<code>APK</code>\u5305\u4f53\u79ef\u5927\u5c0f\u3001\u76d1\u542c<code>onTrimMemory</code>\u4e8b\u4ef6\u5e76\u53ca\u65f6\u91ca\u653e\u5185\u5b58\u4e2d\u7684\u4e0d\u5fc5\u8981\u7f13\u5b58\u7b49\uff1b</li> <li>\u5c3d\u91cf\u4e0d\u8981\u505a\u4e00\u4e9b\u5e94\u7528\u8fdb\u7a0b\u4fdd\u6d3b\u7684\u673a\u5236\uff0c\u4ee5\u514d\u589e\u52a0\u7cfb\u7edf\u603b\u4f53\u7684\u5185\u5b58\u8d1f\u62c5\uff1b</li> <li>\u5c06\u5e94\u7528\u5347\u7ea7\u9002\u914d\u523064\u4f4d\u7248\u672c\uff0c\u4ee5\u514d\u9677\u5165\u865a\u62df\u5185\u5b58\u8017\u5c3d\u800c\u8fdb\u7a0b\u5d29\u6e83\u7684\u5c40\u9762\u3002    \u4f7f\u7528<code>Android Studio</code>\u81ea\u5e26\u7684<code>Profile</code>\u5206\u6790\u5de5\u5177\u8fdb\u884c\u5185\u5b58\u5206\u6790\u4e0e\u4f18\u5316\uff0c\u5177\u4f53\u7528\u6cd5\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1ahttps://www.jianshu.com/p/72b213fa6a26\u3002</li> </ul> </li> <li> <p>\u5728\u7cfb\u7edf\u603b\u4f53\u5c42\u9762\uff1a\u8fd9\u90e8\u5206\u5185\u5bb9\u4e3b\u8981\u5c5e\u4e8e\u8c37\u6b4c\u548c\u624b\u673a\u5382\u5546\u7684\u5de5\u4f5c\uff0c\u5e38\u89c1\u7684\u4e00\u4e9b\u9488\u5bf9\u6027\u4f18\u5316\u624b\u6bb5\u6709\uff1a</p> <ul> <li>\u8c03\u6574<code>lowmemorykiller</code>\u7684\u6740\u8fdb\u7a0b\u7684\u95e8\u9650\u503c\uff0c\u8ba9\u5176\u63d0\u524d\u4ecb\u5165\u6e05\u7406\u6389\u4e00\u4e9b\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u800c\u91ca\u653e\u5185\u5b58\uff0c\u4ee5\u514d\u7cfb\u7edf\u9677\u5165\u4f4e\u5185\u5b58\u72b6\u6001\uff1b</li> <li>\u9002\u5f53\u63d0\u9ad8 <code>extra_free_kbytes</code> \u503c\uff0c\u8ba9<code>kswapd</code>\u7ebf\u7a0b\u80fd\u63d0\u524d\u4ecb\u5165\u8fdb\u884c\u5185\u5b58\u56de\u6536\uff0c\u4ee5\u514d\u7cfb\u7edf\u9677\u5165\u4f4e\u5185\u5b58\u72b6\u6001\uff1b</li> <li>\u6846\u67b6\u4e2d\u8bbe\u8ba1\u540e\u53f0\u5e94\u7528\u67e5\u6740\u529f\u80fd\uff0c\u5b9a\u671f\u6e05\u7406\u540e\u53f0\u4f4e\u4f18\u5148\u7ea7\u5e94\u7528\u8fdb\u7a0b\uff0c\u5e76\u9650\u5236\u4e09\u65b9\u5e94\u7528\u7684\u540e\u53f0\u4fdd\u6d3b\u673a\u5236\uff0c\u4ece\u800c\u91ca\u653e\u5185\u5b58\uff0c\u4ee5\u514d\u7cfb\u7edf\u9677\u5165\u4f4e\u5185\u5b58\u72b6\u6001\uff1b</li> <li>\u901a\u8fc7<code>cpuset</code>\u914d\u7f6e\u9650\u5236<code>kswapd</code>\u4e0d\u8ba9\u5176\u4f7f\u7528\u90e8\u5206<code>CPU</code>\u5927\u6838\uff0c\u4ece\u800c\u8ba9\u51fa<code>CPU</code>\u8d44\u6e90\u7ed9\u524d\u53f0\u5e94\u7528\u7684<code>UI</code>\u548c\u6e32\u67d3\u7ebf\u7a0b\u4f7f\u7528\uff1b</li> <li>\u914d\u7f6e\u548c\u542f\u52a8<code>ZRAM</code>\u548c<code>app compaction</code>\u540e\u53f0\u5185\u5b58\u538b\u7f29\u673a\u5236\uff0c\u4ece\u800c\u51cf\u5c11\u5e94\u7528\u8fdb\u7a0b\u540e\u53f0\u7684\u5185\u5b58\u5360\u7528\uff0c\u817e\u51fa\u66f4\u591a\u7684\u7cfb\u7edf\u53ef\u7528\u5185\u5b58\uff1b</li> <li>\u4f18\u5316\u7cfb\u7edf\u7684\u78c1\u76d8<code>IO</code>\u6027\u80fd\uff0c\u91c7\u7528<code>UFS3.1</code>\u7b49\u6027\u80fd\u66f4\u5f3a\u7684\u5b58\u50a8\u5668\uff0c\u4ee5\u51cf\u8f7b\u7cfb\u7edf\u51fa\u73b0\u5185\u5b58\u4f4e\u7684\u60c5\u51b5\u65f6\uff0c\u51fa\u73b0<code>IO</code>\u963b\u585e\u7684\u65f6\u957f\u3002</li> </ul> </li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#24-io","title":"2.4 \u78c1\u76d8I/O\u5f15\u8d77\u5361\u987f","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p>\u78c1\u76d8\u662f\u73b0\u4ee3\u8ba1\u7b97\u673a\u7cfb\u7edf\u5b9e\u73b0\u6570\u636e\u6301\u4e45\u5316\u5b58\u50a8\u7684\u6838\u5fc3\u786c\u4ef6\u6a21\u5757\u3002\u4e5f\u662f\u7ee7<code>CPU</code>\u548c\u5185\u5b58\u5916\u7cfb\u7edf\u5185\u53e6\u4e00\u4e2a\u91cd\u8981\u7684\u516c\u5171\u8d44\u6e90\u3002<code>Android</code>\u7cfb\u7edf\u5185\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u4e00\u822c\u90fd\u4f1a\u4f34\u968f\u6709\u5927\u91cf\u7684\u78c1\u76d8<code>I/O</code>\u8bfb\u5199\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u8bfb\u5199\u6570\u636e\u5e93\u3001\u52a0\u8f7d<code>XML</code>\u5e03\u5c40\u6587\u4ef6\u3001\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u7b49\u3002\u4f46\u662f\u76f8\u5bf9\u4e8e<code>CPU</code>\u548c\u5185\u5b58\u76f8\u6bd4\uff0c\u78c1\u76d8\u7684\u8bfb\u5199\u8bbf\u95ee\u901f\u5ea6\u662f\u6bd4\u8f83\u6162\u7684\uff0c\u5f88\u5bb9\u6613\u6210\u4e3a<code>CPU</code>\u8fd0\u884c\u7684\u74f6\u9888\uff0c\u5bfc\u81f4\u7cfb\u7edf\u88ab\u62d6\u7d2f\u3002\u5f53\u5e94\u7528\u8fdb\u7a0b\u7684\u7ebf\u7a0b\u4e2d\u53d1\u751f\u76f4\u63a5<code>I/O</code>\u78c1\u76d8\u8bfb\u5199\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u8fdb\u5165<code>Uninterrupt Sleep-Block I/O</code>\u963b\u585e\u72b6\u6001\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728\u5f00\u59cb\u5206\u6790\u78c1\u76d8<code>I/O</code>\u8bfb\u5199\u7684\u74f6\u9888\u5f15\u8d77\u6027\u80fd\u95ee\u9898\u539f\u56e0\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u501f\u7528\u4e00\u5f20\u7b80\u5316\u56fe\u6765\u603b\u4f53\u770b\u770b<code>Linux</code>\u7cfb\u7edf\u7684<code>I/O</code>\u6808\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u6574\u4e2a<code>Linux</code> \u4e0b\u7684 <code>I/O</code>\u6808\u5927\u81f4\u6709\u4e09\u4e2a\u5c42\u6b21\uff1a</p> <ol> <li>\u6587\u4ef6\u7cfb\u7edf\u5c42\uff0c\u4ee5 <code>write</code> \u4e3a\u4f8b\uff0c\u5185\u6838\u62f7\u8d1d\u4e86 <code>write</code> \u53c2\u6570\u6307\u5b9a\u7684\u7528\u6237\u6001\u6570\u636e\u5230\u6587\u4ef6\u7cfb\u7edf <code>Cache</code> \u4e2d\uff0c\u5e76\u9002\u65f6\u5411\u4e0b\u5c42\u540c\u6b65\u3002</li> <li>\u5757\u5c42\uff0c\u7ba1\u7406\u5757\u8bbe\u5907\u7684 <code>I/O</code> \u961f\u5217\uff0c\u5bf9 <code>I/O</code> \u8bf7\u6c42\u8fdb\u884c\u5408\u5e76\u3001\u6392\u5e8f\u3002</li> <li>\u8bbe\u5907\u5c42\uff0c\u901a\u8fc7 <code>DMA</code> \u4e0e\u5185\u5b58\u76f4\u63a5\u4ea4\u4e92\uff0c\u5b8c\u6210\u6570\u636e\u548c\u5177\u4f53\u5b58\u50a8\u8bbe\u5907\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002</li> </ol> <p>\u53ef\u80fd\u5b58\u5728\u7684\u6027\u80fd\u74f6\u9888\u95ee\u9898\u5982\u4e0b\uff1a</p> <ol> <li>\u4e3a\u4e86\u4f18\u5316\u6587\u4ef6\u8bfb\u5199\u7684\u6027\u80fd\uff0c\u51cf\u5c11\u78c1\u76d8\u7684<code>I/O</code> \u64cd\u4f5c\uff0c<code>Linux</code>\u5185\u6838\u7cfb\u7edf\u63d0\u4f9b\u4e86\u9875\u7f13\u5b58\uff08<code>Page Cache</code>\uff09\u6280\u672f\uff0c\u4ee5\u9875\u4e3a\u5355\u4f4d\u5c06\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u5185\u5bb9\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4ece\u800c\u63d0\u4f9b\u4e86\u63a5\u8fd1\u4e8e\u5185\u5b58\u8bfb\u5199\u901f\u5ea6\u7684\u6587\u4ef6\u987a\u5e8f\u8bfb\u5199\u901f\u5ea6\uff0c\u4e5f\u5c31\u662f<code>Buffered I/O</code>\u3002\u4f46\u662f\u5f53\u7cfb\u7edf\u5269\u4f59\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u7cfb\u7edf\u4f1a\u56de\u6536<code>Page Cache</code>\u9875\u7f13\u5b58\u5185\u5b58\uff0c\u5bfc\u81f4\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c\u76f4\u63a5\u843d\u5230\u78c1\u76d8\u4e0a\uff0c\u4ece\u800c\u6781\u5927\u964d\u4f4e<code>I/O</code>\u6027\u80fd\u3002\u8fd9\u4e5f\u5c31\u524d\u4e00\u5c0f\u8282\u4e2d\u5206\u6790\u7684\u4f4e\u5185\u5b58\u5bfc\u81f4\u7684\u6027\u80fd\u5361\u987f\u95ee\u9898\u3002</li> <li>\u4e0a\u5c42\u6240\u6709\u7684<code>I/O</code> \u8bf7\u6c42\u90fd\u4f1a\u653e\u5165\u961f\u5217\u4e2d\u8fdb\u884c\u5408\u5e76\u6392\u961f\u5904\u7406\uff0c\u8fd9\u6837\u5c31\u53ef\u80fd\u5f15\u53d1\u4e0d\u540c\u5e94\u7528\u8fdb\u7a0b\u4e4b\u95f4\u7684\u8d44\u6e90\u62a2\u5360\u95ee\u9898\u3002\u6bd4\u5982\u540e\u53f0\u8fdb\u7a0b\u5b58\u5728\u5927\u91cf\u8bfb\u5199\u78c1\u76d8\u7684\u64cd\u4f5c\u8bf7\u6c42\uff0c\u5360\u7528\u7cfb\u7edf\u7684<code>I/O</code> \u8d44\u6e90\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u524d\u53f0\u5e94\u7528\u7684<code>I/O</code> \u8bf7\u6c42\u51fa\u73b0\u5728\u961f\u5217\u4e2d\u963b\u585e\u6392\u961f\u7b49\u5f85\u7684\u73b0\u8c61\uff0c\u6700\u7ec8\u5bfc\u81f4\u6389\u5e27\u5361\u987f\u95ee\u9898\u3002</li> <li>\u6587\u4ef6\u7cfb\u7edf\u7684\u6027\u80fd\u74f6\u9888\u3002\u6bd4\u5982\u9488\u5bf9<code>NAND</code>\u95ea\u5b58\u7279\u6027\u8bbe\u8ba1\u7684<code>f2fs</code>\u6587\u4ef6\u7cfb\u7edf\uff0c\u76f8\u6bd4\u4e8e<code>ext4</code>\u6587\u4ef6\u7cfb\u7edf\uff0c\u80fd\u591f\u63d0\u5347\u5c0f\u6587\u4ef6\u7684\u968f\u673a\u8bfb\u5199\u6027\u80fd\uff0c\u5e76\u80fd\u51cf\u5c11\u788e\u7247\u5316\u7684\u95ee\u9898\u3002\u518d\u6bd4\u5982<code>Android 11</code>\u4e0a\u5f15\u5165\u7684<code>Fuse</code>\u6587\u4ef6\u7cfb\u7edf\uff0c\u589e\u52a0<code>I/O</code>\u8bfb\u5199\u7684\u5f00\u9500\uff0c\u5bfc\u81f4<code>sdcard</code>\u8def\u5f84\u4e0b\u7684\u90e8\u5206\u8def\u5f84\u6587\u4ef6\u7684<code>I/O</code>\u8bfb\u5199\u6027\u80fd\u4e0b\u964d\u3002</li> <li>\u95ea\u5b58\u7684\u8bfb\u5199\u6027\u80fd\u74f6\u9888\u3002\u4e00\u4e2a\u5c31\u662f\u95ea\u5b58\u786c\u4ef6\u7684\u8bfb\u5199\u6027\u80fd\u5dee\u5f02\uff0c\u6bd4\u5982<code>UFS 3.0</code>\u76f8\u5bf9\u4e8e<code>UFS 2.1</code>\u6765\u8bb2\u987a\u5e8f\u8bfb\u53d6\u901f\u5ea6\u5feb<code>90%</code>\uff0c\u987a\u5e8f\u5199\u5165\u901f\u5ea6\u66f4\u662f\u63d0\u5347<code>160%</code>\uff1b\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u95ea\u5b58\u91cd\u590d\u5199\u5165\uff0c\u9700\u8981\u5148\u8fdb\u884c\u64e6\u9664\u64cd\u4f5c\uff0c\u8fd9\u6837\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u78c1\u76d8\u788e\u7247 \u53d8\u591a\uff0c\u5269\u4f59\u7a7a\u95f4\u5c11\uff0c\u4e00\u4e2a\u5185\u5b58\u9875\u7684\u5199\u5165\u4f1a\u5f15\u8d77\u6574\u4e2a\u78c1\u76d8\u5757\u7684\u8fc1\u79fb\uff0c\u9020\u6210\u8017\u65f6\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u65e9\u671f<code>Android</code>\u624b\u673a\u7ed9\u4eba\u5f62\u6210\u201c\u8d8a\u7528\u8d8a\u5361\u201d\u7684\u5370\u8c61\u7684\u539f\u56e0\u4e4b\u4e00\u3002</li> </ol> <p>\u4e8c\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9<code>I/O</code>\u78c1\u76d8\u6027\u80fd\u7684\u74f6\u9888\uff0c\u603b\u4f53\u4f18\u5316\u601d\u8def\u4ece\u4e24\u4e2a\u89d2\u5ea6\u6765\u770b\uff1a</p> <ol> <li> <p>\u4ece\u624b\u673a\u5382\u5546\u89d2\u5ea6\uff1a</p> <ul> <li>\u91c7\u7528\u66f4\u5927\u7684\u5185\u5b58\u786c\u4ef6\u914d\u7f6e\uff0c\u5e76\u4ece\u603b\u4f53\u4e0a\u4f18\u5316\u7cfb\u7edf\u7684\u5185\u5b58\u5360\u7528\u3002\u4ee5\u9632\u6b62\u51fa\u73b0\u7cfb\u7edf\u4f4e\u5185\u5b58\u72b6\u6001\u4e0b\uff0c<code>Page Cache</code>\u9875\u7f13\u5b58\u88ab\u56de\u6536\u540e\uff0c\u5e94\u7528\u76f4\u63a5\u5199\u78c1\u76d8\u800c\u5bfc\u81f4\u7684<code>I/O</code>\u963b\u585e\u5361\u987f\u95ee\u9898\uff1b</li> <li>\u542f\u7528<code>Linux</code>\u7684<code>cgroup</code>\u673a\u5236\u5bf9<code>I/O</code>\u8d44\u6e90\u7684\u8fdb\u7a0b\u9694\u79bb\u673a\u5236<code>blkio</code>\uff0c\u5c06\u8fdb\u7a0b\u6309\u7167\u4f18\u5148\u7ea7\u8fdb\u884c\u5206\u7ec4\uff08\u5206\u4e3a\u524d\u53f0\u8fdb\u7a0b\u3001\u540e\u53f0\u8fdb\u7a0b\u3001\u751a\u81f3\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u8fdb\u884c\u66f4\u8be6\u7ec6\u7684\u81ea\u5b9a\u4e49\u5212\u5206\uff09\uff0c\u4ee5\u5206\u914d\u4e0d\u540c\u7684<code>I/O</code>\u5e26\u5bbd\u8d44\u6e90\uff0c\u4ece\u800c\u89e3\u51b3\u540e\u53f0\u5e94\u7528\u8fdb\u7a0b\u62a2\u5360\u524d\u53f0\u5e94\u7528<code>I/O</code>\u8d44\u6e90\u9020\u6210\u7684\u5361\u987f\u7684\u95ee\u9898\uff1b</li> <li>\u91c7\u7528<code>f2fs</code>\u6587\u4ef6\u7cfb\u7edf\uff0c\u66ff\u6362<code>ext4</code>\u6587\u4ef6\u7cfb\u7edf\uff0c\u4ee5\u63d0\u5347\u6587\u4ef6\u7cfb\u7edf\u7684\u6027\u80fd\uff1b\u53ef\u4ee5\u9488\u5bf9\u90e8\u5206\u7cfb\u7edf\u6587\u4ef6\u7ba1\u7406\u7c7b\u7684\u5e94\u7528\u4e0d\u8d70\u9ed8\u8ba4\u7684<code>fuse</code>\u8def\u5f84\uff0c\u800c\u662f\u8d70<code>f2fs</code>\uff0c\u4ee5\u63d0\u5347\u5176\u8bfb\u5199\u6027\u80fd\u8868\u73b0\uff1b</li> <li>\u91c7\u7528\u8bfb\u5199\u6027\u80fd\u66f4\u5f3a\u7684\u95ea\u5b58\u5668\u4ef6\uff0c\u6bd4\u5982\u6700\u65b0\u7684<code>UFS 3.1</code>\uff1b</li> <li>\u542f\u7528<code>fstrim</code>\u78c1\u76d8\u788e\u7247\u6574\u7406\u529f\u80fd\uff0c\u5728\u606f\u5c4f\u3001\u5145\u7535\u7b49\u6761\u4ef6\u4e0b\u89e6\u53d1\u78c1\u76d8\u788e\u7247\u6574\u7406\u7684\u52a8\u4f5c\uff0c\u4ece\u800c\u51cf\u5c11\u78c1\u76d8\u788e\u7247\uff0c\u63d0\u5347\u78c1\u76d8\u8bfb\u5199\u6027\u80fd\uff1b\u7cfb\u7edf\u624b\u673a\u7ba1\u5bb6\u6a21\u5757\u53ef\u4ee5\u5f15\u5bfc\u7528\u6237\u5b9a\u671f\u8fdb\u884c\u5783\u573e\u6587\u4ef6\u7684\u6e05\u7406\uff0c\u4ee5\u4fdd\u8bc1\u78c1\u76d8\u6709\u5145\u8db3\u7684\u5269\u4f59\u7a7a\u95f4\uff1b</li> <li>\u57fa\u4e8emmap\u5185\u5b58\u6620\u5c04\u673a\u5236\uff0c\u5c06\u7cfb\u7edf\u8fd0\u884c\u5e38\u8bbf\u95ee\u7684\u6587\u4ef6Lock\u9501\u5b9a\u5230\u5185\u5b58\u7f13\u5b58\u4e2d\uff0c\u4ee5\u63d0\u5347\u6587\u4ef6\u8bfb\u5199\u7684\u6027\u80fd\uff0c\u51cf\u5c11\u771f\u6b63\u53d1\u751fI/O\u78c1\u76d8\u8bfb\u5199\u7684\u6982\u7387\uff0c\u51cf\u8f7b\u7cfb\u7edf\u7684I/O\u8d1f\u8f7d\u3002Android\u7cfb\u7edf\u6846\u67b6\u4e2d\u7684PinnerService\u670d\u52a1\u4e3b\u8981\u804c\u8d23\u5c31\u662f\u8fd9\u4e2a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a  </li> </ul> </li> <li> <p>\u4ece\u5e94\u7528\u5f00\u53d1\u8005\u89d2\u5ea6\uff1a</p> <ul> <li>\u9009\u62e9\u5408\u9002\u7684\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c\u3002\u5bf9\u8bfb\u5199\u901f\u5ea6\u6709\u8f83\u9ad8\u7684\u8981\u6c42\uff0c\u5e76\u5141\u8bb8\u4f4e\u6982\u7387\u7684\u6570\u636e\u4e22\u5931\u95ee\u9898\uff0c\u5c31\u91c7\u7528\u7cfb\u7edf\u9ed8\u8ba4\u7684\u57fa\u4e8e<code>Page Cache</code>\u7684\u7f13\u5b58<code>I/O</code>\uff1b\u5bf9\u6587\u4ef6\u8bfb\u5199\u7684\u901f\u5ea6\u8981\u6c42\u4e0d\u9ad8\uff0c\u4f46\u662f\u9700\u8981\u4e25\u683c\u7684\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u5c31\u4f7f\u7528<code>Direct I/O</code>\uff1b\u5982\u679c\u9700\u8981\u5bf9\u540c\u4e00\u5757\u533a\u57df\u8fdb\u884c\u9891\u7e41\u8bfb\u5199\u7684\u60c5\u51b5\uff0c\u5bf9\u8bfb\u5199\u6027\u80fd\u8981\u6c42\u6781\u9ad8\uff0c\u53ef\u4ee5\u91c7\u7528<code>mmap</code> \u5185\u5b58\u6620\u5c04\u673a\u5236\u5b9e\u73b0\u8bfb\u5199\u6587\u4ef6\uff0c\u6bd4\u5982\u817e\u8baf\u5f00\u6e90\u7684\u7528\u4e8e\u6539\u5584\u539f\u751f<code>SharePreferences</code>\u673a\u5236\u6027\u80fd\u7684\u5b58\u50a8\u5de5\u5177<code>MMKV</code>\u5c31\u662f\u8fd9\u4e2a\u539f\u7406\u5b9e\u73b0\u7684\u3002</li> <li><code>I/O</code> \u65b9\u5f0f\u7684\u9009\u62e9\u3002\u4e00\u4e2a\u662f\u5bf9\u4e8e\u963b\u585e<code>I/O</code>\u64cd\u4f5c\u5c3d\u91cf\u653e\u5165\u5b50\u7ebf\u7a0b\u6267\u884c\uff0c\u4ee5\u514d\u963b\u585e<code>UI</code>\u7ebf\u7a0b\uff1b\u4e8c\u662f\u9002\u5f53\u91c7\u7528\u5f02\u6b65<code>I/O</code>\u51cf\u5c11\u8bfb\u53d6\u6587\u4ef6\u7684\u8017\u65f6\uff0c\u63d0\u5347<code>CPU</code>\u6574\u4f53\u5229\u7528\u7387\uff0c\u6bd4\u5982<code>Okio</code>\u5c31\u652f\u6301\u5f02\u6b65<code>I/O</code>\u64cd\u4f5c\u3002</li> <li>\u4f18\u5316\u6570\u636e\u7ed3\u6784\uff0c\u5efa\u7acb\u5185\u5b58\u7f13\u5b58\uff0c\u5c3d\u91cf\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684<code>I/O</code>\uff1b</li> </ul> </li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#3","title":"3 \u7f16\u8bd1\u5f15\u8d77\u5361\u987f\u6027\u80fd\u95ee\u9898","text":"<p>\u7f16\u8bd1\u5f15\u8d77\u7684\u6027\u80fd\u95ee\u9898\u4e3b\u8981\u5206\u4e3a\u4e24\u7c7b\uff1a\u4e00\u7c7b\u662f\u4ee3\u7801\u7684\u89e3\u91ca\u6267\u884c\u8017\u65f6\uff0c\u8fd0\u884c\u65f6<code>VerifyClass</code>\u6267\u884c\u8017\u65f6\u7b49\u5f15\u53d1\u5361\u987f\uff1b\u4e8c\u7c7b\u662f\u7f16\u8bd1\u672c\u8eab\u5f15\u8d77\u7684\u5361\u987f\u95ee\u9898\uff0c\u6bd4\u5982<code>dex2oat</code>\u7f16\u8bd1\u62a2\u5360<code>CPU</code>\u7b97\u529b\u8d44\u6e90\uff0c\u8fdb\u7a0b\u4e2d\u7684<code>Jit</code>\u7f16\u8bd1\u7ebf\u7a0b\u62a2\u5360<code>CPU</code>\u7b97\u529b\u8d44\u6e90\u3002</p>"},{"location":"perf-opt/Android/jank/jank-shizhan/#31","title":"3.1 \u4ee3\u7801\u89e3\u91ca\u6267\u884c\u8017\u65f6","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p><code>Art</code>\u865a\u62df\u673a\u6709\u4e24\u79cd\u4ee3\u7801\u6267\u884c\u6a21\u5f0f\uff1a<code>quick code</code> \u6a21\u5f0f\u548c <code>Interpreter</code> \u6a21\u5f0f\u3002\u5bf9\u4e8e<code>dex</code>\u5b57\u8282\u7801\u6587\u4ef6\u91c7\u7528\u7684\u662f<code>Interpreter</code>\u89e3\u91ca\u6267\u884c\u7684\u6a21\u5f0f\uff0c\u6bcf\u6b21\u6267\u884c\u4ee3\u7801\uff0c\u865a\u62df\u673a\u9700\u8981\u5c06\u4ee3\u7801\u8f6c\u6362\u6210\u673a\u5668\u6307\u4ee4\u96c6\uff0c\u7136\u540e\u4ea4\u7ed9<code>CPU</code>\u53bb\u6267\u884c\uff0c\u6240\u4ee5\u6267\u884c\u6548\u7387\u6bd4\u8f83\u4f4e\uff08\u65e9\u671f<code>Android</code>\u7cfb\u7edf\u88ab\u8bdf\u75c5\u6027\u80fd\u5dee\u7684\u539f\u56e0\u4e4b\u4e00\uff09\u3002\u800c\u5bf9\u4e8e\u7ecf\u8fc7\u7f16\u8bd1\uff08<code>AOT</code>\u7684<code>dex2oat</code>\u7f16\u8bd1\u6216<code>JIT</code>\u8fd0\u884c\u65f6\u53ca\u65f6\u7f16\u8bd1\uff0c\u90fd\u9700\u8981\u6d88\u8017\u4e00\u5b9a\u7684\u78c1\u76d8\u7a7a\u95f4\u5b58\u50a8\u7f16\u8bd1\u51fa\u6765\u7684\u673a\u5668\u7801\u6587\u4ef6\uff09\u540e\u751f\u6210\u7684<code>ELF</code>\u683c\u5f0f\u673a\u5668\u7801\u6587\u4ef6\uff08\u5982<code>.oat</code>\u683c\u5f0f\u6587\u4ef6\u3001<code>.art</code>\u683c\u5f0f\u6587\u4ef6\uff09\uff0c\u91c7\u7528<code>quick code</code>\u6a21\u5f0f\uff0c\u76f4\u63a5\u6267\u884c<code>arm</code> \u6c47\u7f16\u6307\u4ee4\uff0c\u6267\u884c\u6548\u7387\u8f83\u9ad8\u3002\u4e3a\u4e86\u505a\u5230\u6027\u80fd\u3001\u78c1\u76d8\u7a7a\u95f4\u5360\u7528\u4ee5\u53ca\u5e94\u7528\u5b89\u88c5\u901f\u5ea6\u4e4b\u95f4\u7684\u6700\u4f73\u5e73\u8861\uff0c\u4ece<code>Android 7.0</code> \u5f00\u59cb\uff0c\u91c7\u7528<code>AOT</code>+<code>JIT</code>+\u89e3\u91ca\u6267\u884c\u7684\u6df7\u5408\u6a21\u5f0f\uff0c\u5176\u7279\u70b9\u5982\u4e0b\uff1a</p> <ol> <li>\u5e94\u7528\u5728\u5b89\u88c5\u7684\u65f6\u5019<code>dex</code>\u4e2d\u5927\u90e8\u5206\u51fd\u6570\u4ee3\u7801\u4e0d\u4f1a\u88ab\u7f16\u8bd1\u3002</li> <li><code>App</code>\u8fd0\u884c\u65f6\uff0c<code>dex</code>\u6587\u4ef6\u5148\u901a\u8fc7\u89e3\u6790\u5668\u88ab\u76f4\u63a5\u6267\u884c\uff0c\u70ed\u70b9\u51fd\u6570\u4f1a\u88ab\u8bc6\u522b\u5e76\u88ab<code>JIT</code>\u7f16\u8bd1\u540e\u5b58\u50a8\u5728 <code>jit code cache</code> \u4e2d\u5e76\u751f\u6210<code>profile</code>\u6587\u4ef6\u4ee5\u8bb0\u5f55\u70ed\u70b9\u51fd\u6570\u7684\u4fe1\u606f\u3002</li> <li>\u624b\u673a\u8fdb\u5165 <code>IDLE</code>\uff08\u7a7a\u95f2\uff09 \u6216\u8005 <code>Charging</code>\uff08\u5145\u7535\uff09 \u72b6\u6001\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u626b\u63cf <code>App</code> \u76ee\u5f55\u4e0b\u7684 <code>profile</code> \u6587\u4ef6\u5e76\u6267\u884c <code>AOT</code> \u8fc7\u7a0b\u8fdb\u884c\u7f16\u8bd1\u3002</li> </ol> <p>\u6240\u4ee5<code>ART</code>\u865a\u62df\u673a\u5728\u6267\u884c\u4e00\u4e2a\u51fd\u6570\u8fc7\u7a0b\u4e2d\u4f1a\u5728 <code>Interpreter</code> \u89e3\u91ca\u5668\u6a21\u5f0f\u548c<code>quick code</code>\u6a21\u5f0f\u5207\u6362\uff0c\u5177\u4f53\u5207\u6362\u89c4\u5219\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u6709\u4e9b\u65f6\u5019\u5e94\u7528\u90e8\u5206\u4ee3\u7801\u8fd8\u662f\u6309\u7167<code>Interpreter</code> \u6a21\u5f0f\u6267\u884c\uff0c\u8fd0\u884c\u6548\u7387\u8f83\u4f4e\uff0c\u4ece\u800c\u4ea7\u751f\u4e00\u4e9b\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u6dd8\u5b9d\u7b49\u4e09\u65b9\u5e94\u7528\u51b7\u542f\u52a8\u901f\u5ea6\u6162\u4e8e\u540c\u5e73\u53f0\u7ade\u54c1\u673a\u578b\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p></p> <p>\u4ece\u4e0e\u7ade\u54c1\u673a\u5668\u7684\u5bf9\u6bd4<code>Systrace</code>\u5206\u6790\u53ef\u4ee5\u770b\u5230\uff1a\u540c\u4e00\u4e2a\u5e94\u7528\uff0c\u4e14\u5728\u4e24\u53f0\u624b\u673a<code>CPU</code>\u578b\u53f7\u548c\u8fd0\u884c\u4e3b\u9891\u4e00\u81f4\u7684\u60c5\u51b5\u4e0b\uff0c\u7ade\u54c1\u673a\u5668\u4e0a\u5e94\u7528\u51b7\u542f\u52a8\u671f\u95f4\uff0c<code>UI</code>\u7ebf\u7a0b\u7684<code>Running</code>\u65f6\u957f\u66f4\u77ed\uff0c\u4e14<code>Jit</code>\u5de5\u4f5c\u7ebf\u7a0b\u4e0a\u7684\u70ed\u70b9\u4ee3\u7801\u7f16\u8bd1\u4efb\u52a1\u660e\u663e\u5c11\u5f88\u591a\u3002\u4ece\u800c\u53ef\u4ee5\u63a8\u65ad\u51fa\uff0c\u95ee\u9898\u539f\u56e0\u5728\u4e8e\u7ade\u54c1\u673a\u5668\u4e0a\u7684\u5e94\u7528\u4ee3\u7801\u5927\u90e8\u5206\u662f\u4ee5\u673a\u5668\u7801\u76f4\u63a5\u6267\u884c\uff0c\u800c\u6211\u4eec\u662f\u4ee5\u5b57\u8282\u7801\u89e3\u91ca\u6267\u884c\uff0c\u6240\u4ee5\u6548\u7387\u66f4\u4f4e\uff0c\u8fd0\u884c\u65f6\u95f4\u66f4\u957f\u3002\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u5dee\u5f02\u5462\uff1f\u540e\u6765\u5bf9\u6bd4\u65e5\u5fd7\u5206\u6790\u53d1\u73b0\uff0c\u539f\u56e0\u662f\u7ade\u54c1\u673a\u4e0a\u5e94\u7528\u7b2c\u4e00\u6b21\u5b89\u88c5\u6253\u5f00\u540e\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u7cfb\u7edf\u4f1a\u89e6\u53d1\u4e00\u6b21<code>speed-profile</code>\u6a21\u5f0f\u7684<code>dex2oat</code>\u7f16\u8bd1\uff0c\u4f1a\u6839\u636e\u5e94\u7528\u8fd0\u884c\u671f\u95f4<code>JIT</code>\u641c\u96c6\u5230\u7684\u70ed\u70b9\u51fd\u6570\u4fe1\u606f\u4fdd\u5b58\u540e\u751f\u6210\u7684<code>Profile</code>\u63cf\u8ff0\u6587\u4ef6\u8fdb\u884c\u7f16\u8bd1\uff0c\u4ece\u800c\u5c06\u5e94\u7528\u542f\u52a8\u671f\u95f4\u7684\u5927\u90e8\u5206\u4ee3\u7801\u51fd\u6570\u7f16\u8bd1\u6210\u4e86\u673a\u5668\u7801<code>.oat</code>\u6587\u4ef6\uff0c\u540e\u7eed\u518d\u542f\u52a8\u5e94\u7528\u65f6\u5373\u53ef\u76f4\u63a5\u4ee5<code>quick code</code> \u6a21\u5f0f\u6267\u884c\u673a\u5668\u7801\uff0c\u6240\u4ee5\u6267\u884c\u6548\u7387\u66f4\u9ad8\u3002</p> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9\u4ee3\u7801\u89e3\u91ca\u6267\u884c\u9020\u6210\u7684\u6027\u80fd\u95ee\u9898\uff0c\u5927\u81f4\u4f18\u5316\u601d\u8def\u662f\u5c3d\u91cf\u8ba9\u5e94\u7528\u4ee3\u7801\u4ee5\u673a\u5668\u7801\u5f62\u5f0f\u8fd0\u884c\uff0c\u90e8\u5206\u6709\u6548\u7684\u624b\u6bb5\u6709\uff1a</p> <ol> <li>\u90e8\u5206\u624b\u673a\u5382\u5546\uff0c\u5728\u624b\u673a\u9884\u7f6e\u7684\u5e94\u7528\u5546\u5e97\u4e2d\u4e0b\u8f7d\u7684\u4e09\u65b9\u5e94\u7528\uff0c\u9664\u4e86<code>APK</code>\u6587\u4ef6\u5916\uff0c\u8fd8\u4f1a\u5305\u542b\u4fdd\u5b58\u6709\u5e94\u7528\u70ed\u70b9\u51fd\u6570\u4fe1\u606f\u7684<code>Profile</code>\u63cf\u8ff0\u6587\u4ef6\uff0c\u8fd9\u6837\u5728\u5e94\u7528<code>dex2oat</code>\u5b89\u88c5\u65f6\uff0c\u9009\u62e9<code>speed-profile</code>\u6a21\u5f0f\uff0c\u5c31\u4f1a\u6839\u636e<code>Profile</code>\u63cf\u8ff0\u6587\u4ef6\uff0c\u5c06\u5e94\u7528\u7684\u5927\u90e8\u5206\u70ed\u70b9\u51fd\u6570\u76f4\u63a5\u7f16\u8bd1\u6210\u673a\u5668\u7801\uff0c\u4ece\u800c\u6781\u5927\u7684\u63d0\u5347\u5e94\u7528\u7684\u6027\u80fd\u8868\u73b0\u3002</li> <li>\u5728\u624b\u673a\u606f\u5c4f\u5145\u7535\uff0c\u8fdb\u5165<code>Idle</code>\u72b6\u6001\u540e\uff0c\u901a\u8fc7<code>JobScheduler</code>\u673a\u5236\uff0c\u542f\u52a8\u540e\u53f0\u670d\u52a1\uff0c\u626b\u63cf <code>App</code> \u76ee\u5f55\u4e0b\u7684 <code>profile</code> \u6587\u4ef6\u5e76\u6267\u884c <code>AOT</code> \u8fc7\u7a0b\u8fdb\u884c\u7f16\u8bd1\uff0c\u4ee5\u8fbe\u5230\u624b\u673a\u8d8a\u7528\u8d8a\u5feb\u7684\u6548\u679c\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#32","title":"3.2 \u7f16\u8bd1\u672c\u8eab\u8017\u65f6","text":"<p>\u4e00\u3001\u7406\u8bba\u5206\u6790</p> <p>\u5728<code>dex2oat</code>\u8fdb\u7a0b\u7f16\u8bd1\u5e94\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7cfb\u7edf\u4f1a\u542f\u52a8\u5f88\u591a\u7ebf\u7a0b\uff0c\u6d88\u8017\u5927\u91cf\u7684<code>CPU</code>\u7b97\u529b\u8d44\u6e90\u3002\u53ef\u80fd\u4f1a\u5bfc\u81f4\u524d\u53f0\u5e94\u7528\u7531\u4e8e\u62a2\u4e0d\u5230<code>CPU</code>\u7b97\u529b\u8d44\u6e90\uff0c\u5176<code>UI</code>\u7ebf\u7a0b\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u72b6\u6001\u800c\u5361\u987f\u3002\u53e6\u5916\u5e94\u7528\u8fdb\u7a0b\u5185\u90e8\uff0c<code>Jit</code>\u5de5\u4f5c\u7ebf\u7a0b\u52a8\u6001\u7f16\u8bd1\u65f6\u6301\u7eed\u8fd0\u884c\uff0c\u5982\u679c\u8d1f\u8f7d\u8f83\u91cd\uff0c\u6301\u7eed\u8dd1\u5230<code>CPU</code>\u5927\u6838\u4e0a\uff0c\u4e5f\u4f1a\u9020\u6210<code>CPU</code>\u7b97\u529b\u8d44\u6e90\u62a2\u5360\u3002</p> <p>\u4e8c\u3001\u5178\u578b\u6848\u4f8b\u5206\u6790</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u6296\u97f3\u5e94\u7528\u754c\u9762\u4e25\u91cd\u5361\u987f\u3002</p> <p>\u95ee\u9898\u5206\u6790\uff1a\u7ed3\u5408<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u539f\u56e0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff1a\u6296\u97f3\u5e94\u7528\u754c\u9762\u5361\u987f\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u5176<code>UI</code>\u7ebf\u7a0b\u62a2\u4e0d\u5230<code>CPU</code>\u7b97\u529b\u8d44\u6e90\u800c\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnbale</code>\u72b6\u6001\uff0c\u800c\u5bfc\u81f4\u8fd9\u4e2a\u95ee\u9898\u7684\u5f88\u5927\u4e00\u90e8\u5206\u539f\u56e0\u5c31\u662f\u6b64\u65f6\u540e\u53f0<code>dex2oat</code>\u8fdb\u7a0b\u521b\u5efa\u591a\u4e2a\u7ebf\u7a0b\u6301\u7eed\u6267\u884c\u5e94\u7528\u7f16\u8bd1\u52a8\u4f5c\u62a2\u5360<code>CPU</code>\u7b97\u529b\u8d44\u6e90\u3002</p> <p>\u4e09\u3001\u4f18\u5316\u601d\u8def</p> <p>\u9488\u5bf9\u7f16\u8bd1\u672c\u8eab\u8017\u65f6\u5f15\u8d77\u7684\u6027\u80fd\u95ee\u9898\uff0c\u90e8\u5206\u6709\u6548\u7684\u624b\u6bb5\u6709\uff1a</p> <ol> <li>\u901a\u8fc7<code>cpuset</code>\u914d\u7f6e\uff0c\u9650\u5236<code>dex2oat</code>\u8fdb\u7a0b\u548c<code>Jit</code>\u5de5\u4f5c\u7ebf\u7a0b\u5bf9<code>CPU</code>\u7684\u4f7f\u7528\uff0c\u4f7f\u5176\u4e0d\u62a2\u5360<code>CPU</code>\u5927\u6838\u5fc3\u7b97\u529b\u8d44\u6e90\uff0c\u5e76\u8bbe\u7f6e\u53c2\u6570\u9650\u5236\u5176\u521b\u5efa\u7684\u7ebf\u7a0b\u6570\u3002</li> <li><code>dex2oat</code>\u7f16\u8bd1\u5e94\u7528\u7684\u52a8\u4f5c\u5c3d\u91cf\u653e\u5728\u8bbe\u5907\u606f\u5c4f\uff0c\u8bbe\u5907\u5904\u4e8e<code>Idle</code>\u72b6\u6001\u4e0b\u8fdb\u884c\uff0c\u4ee5\u514d\u5f71\u54cd\u524d\u53f0\u7528\u6237\u7684\u64cd\u4f5c\uff1b</li> <li>\u9650\u5236\u4e09\u65b9\u5e94\u7528\u5728\u540e\u53f0\u89e6\u53d1\u6267\u884c<code>dex2oat</code>\u7f16\u8bd1\u52a8\u4f5c\uff08\u4ece<code>Android 10</code> \u5f00\u59cb\uff0c\u8c37\u6b4c\u5b98\u65b9\u901a\u8fc7<code>Selinux</code>\u6743\u9650\u7684\u7ba1\u63a7\uff0c\u7981\u6b62\u4e86\u4e09\u65b9\u5e94\u7528\u89e6\u53d1<code>dex2oat</code>\u7684\u6743\u9650\uff09\uff1b</li> </ol>"},{"location":"perf-opt/Android/jank/jank-shizhan/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://www.jianshu.com/p/f1a777551b70</p>"},{"location":"perf-opt/Android/jank/jank-tool/","title":"Android\u5361\u987f\u6389\u5e27\u95ee\u9898\u5206\u6790\u4e4b\u5de5\u5177\u7bc7","text":"<p>\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u6211\u4eec\u5b8c\u6574\u7684\u5206\u6790\u4e86<code>Android</code>\u7cfb\u7edf\u4e2d\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u7cfb\u7edf\u8fd0\u884c\u673a\u5236\u548c\u6d41\u7a0b\uff0c\u4e86\u89e3\u4e86\u5361\u987f\u95ee\u9898\u7684\u57fa\u672c\u5b9a\u4e49\uff0c\u4e5f\u5c31\u5177\u5907\u4e86\u5206\u6790\u5361\u987f\u6389\u5e27\u6027\u80fd\u95ee\u9898\u7684\u7406\u8bba\u77e5\u8bc6\u3002\u4f46\u662f\u4fd7\u8bdd\u8bf4\u201c\u5de5\u6b32\u5584\u5176\u4e8b\uff0c\u5fc5\u5148\u5229\u5176\u5668\u201d\uff0c\u5728\u5f00\u59cb\u7740\u624b\u5206\u6790\u5361\u987f\u95ee\u9898\u4e4b\u524d\uff0c\u6211\u4eec\u8fd8\u5fc5\u987b\u8981\u638c\u63e1\u4e00\u4e9b\u5206\u6790\u6027\u80fd\u95ee\u9898\u7684\u5de5\u5177\u4e0e\u624b\u6bb5\uff0c\u4e5f\u5c31\u662f\u638c\u63e1\u5206\u6790\u95ee\u9898\u6240\u4f7f\u7528\u7684\u201c\u5668\u201d\uff0c\u624d\u80fd\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u89c2\u6d4b\u7cfb\u7edf\u8fd0\u884c\u7684\u72b6\u6001\uff0c\u627e\u5230\u6027\u80fd\u95ee\u9898\u7684\u539f\u56e0\u3002<code>Systrace</code> \u662f\u8c37\u6b4c\u63d0\u4f9b\u7684\u6700\u5e38\u7528\u7684<code>Android</code> \u7cfb\u7edf\u7ea7\u6027\u80fd\u5206\u6790\u5de5\u5177\u3002\u5b83\u4ee5\u89c6\u89c9\u5316\u7684\u65b9\u5f0f\u5c06\u7cfb\u7edf\u5185\u6240\u6709\u7684 \u201c\u5de5\u4f5c\u7ebf\u7a0b\u201d\uff08\u5185\u6838+\u6846\u67b6+\u5e94\u7528\uff09\u4e0e \u7cfb\u7edf\u6a21\u5757\u72b6\u6001\uff08\u5982 <code>CPU</code> \u8c03\u5ea6\u3001<code>IO</code> \u6d3b\u52a8\u3001<code>Binder</code> \u8c03\u7528\u7b49\u4fe1\u606f\uff09\u6309 \u65f6\u95f4\u8f74 \u94fa\u5f00\u5c55\u793a\uff0c\u5e76\u652f\u6301\u5728 <code>Chrome</code> \u6d4f\u89c8\u5668\u4e2d\u663e\u793a\u51fa\u6765\u3002\u5728 <code>Perfetto</code> \u51fa\u73b0\u4e4b\u524d\uff0c\u5b83\u662f\u6700\u5b9e\u7528\u3001\u5206\u6790\u6700\u7cbe\u51c6\u3001\u6700\u4e13\u4e1a\u7684\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u662f\u5206\u6790<code>Android</code>\u6027\u80fd\u95ee\u9898\u7684\u9996\u9009\u3002\u672c\u6587\u6211\u4eec\u5c31\u6765\u8be6\u7ec6\u5206\u6790\u4e00\u4e0b\u8fd9\u4e2a<code>Systrace</code>\u5de5\u5177 \u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#1-systrace","title":"1 Systrace\u5185\u5bb9\u7ed3\u6784","text":"<p><code>Systrace</code> \u53ef\u4ee5\u6536\u96c6Android\u5173\u952e\u5b50\u7cfb\u7edf\uff08\u5982<code>CPU</code>\u8c03\u5ea6\u3001<code>SurfaceFlinger</code>\u6e32\u67d3\u7cfb\u7edf\u3001<code>System Server</code>\u7cfb\u7edf\u6846\u67b6\u3001<code>Input</code>\u7cfb\u7edf\u7b49\uff09\u7684\u8fd0\u884c\u4fe1\u606f\uff0c\u5e76\u4ee5\u56fe\u50cf\u7684\u5f62\u5f0f\u6309\u7167\u65f6\u95f4\u8f74\u94fa\u5f00\u5c55\u793a\u51fa\u6765\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u76f4\u89c2\u7684\u770b\u5230\u6574\u4e2a\u7cfb\u7edf\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u4ece\u800c\u5206\u6790\u51fa\u7cfb\u7edf\u7684\u6027\u80fd\u95ee\u9898\u74f6\u9888\u6240\u5728\u3002\u5176\u754c\u9762\u5c55\u793a\u7684\u4e3b\u8981\u4fe1\u606f\u533a\u57df\u5982\u4e0b\uff1a</p>"},{"location":"perf-opt/Android/jank/jank-tool/#11-cpu-trace","title":"1.1 CPU Trace\u4fe1\u606f\u533a\u57df","text":"<p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c<code>Systrace</code> \u4e2d <code>CPU Trace</code>\u4e00\u822c\u5728\u6700\u4e0a\u9762\u663e\u793a\uff0c\u5c55\u793a<code>Kernel</code>\u4e2d\u7684 <code>CPU Info</code> \u533a\u57df\u4fe1\u606f\uff0c\u4e00\u822c\u5305\u542b\u5982\u4e0b\u4fe1\u606f\uff1a</p> <ol> <li> <p><code>CPU</code>\u7684\u7ec4\u6210\u67b6\u6784\uff0c\u5305\u542b\u591a\u5c11\u9897<code>CPU</code>\u8fd0\u884c\u6838\u5fc3\uff0c\u4ee5\u53ca\u7f16\u53f7\u4fe1\u606f\u3002</p> </li> <li> <p>\u6bcf\u9897<code>CPU</code>\u6838\u5fc3\u7684\u5b9e\u65f6\u8fd0\u884c\u9891\u7387\u4fe1\u606f\uff1b</p> </li> <li> <p>\u6bcf\u9897<code>CPU</code>\u6838\u5fc3\u5f53\u524d\u652f\u6301\u7684\u8fd0\u884c\u9891\u7387\u7684\u6700\u9ad8\u4e0e\u6700\u4f4e\u7684\u95e8\u9650\u503c\uff1b</p> </li> <li> <p>\u6bcf\u9897<code>CPU</code>\u6838\u5fc3\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u662f\u5426\u8fdb\u5165\u8282\u80fd\u6216\u65ad\u7535\u5173\u95ed\u72b6\u6001\uff1b</p> </li> <li> <p>\u6bcf\u9897<code>CPU</code>\u6838\u5fc3\u4e0a\u8fd0\u884c\u7684\u7ebf\u7a0b\u4efb\u52a1\u4fe1\u606f\u4e0e\u7edf\u8ba1\uff0c\u6309\u65f6\u95f4\u8f74\u6392\u5f00\uff1b</p> </li> </ol> <p></p> <p></p> <p>\u603b\u7684\u6765\u8bf4\uff0c<code>Systrace</code> \u4e2d\u7684<code>CPU Trace</code> \u8fd9\u91cc\u4e00\u822c\u662f\u770b\u4efb\u52a1\u8c03\u5ea6\u4fe1\u606f\uff0c\u67e5\u770b\u662f\u5426\u662f<code>CPU</code>\u9891\u7387\u6216\u8005\u662f<code>CPU</code>\u8c03\u5ea6\u903b\u8f91\u5bfc\u81f4\u5f53\u524d\u4efb\u52a1\u51fa\u73b0\u6027\u80fd\u95ee\u9898\uff0c\u4e3e\u4f8b\u5982\u4e0b\uff1a</p> <ol> <li>\u67d0\u4e2a\u573a\u666f\u7684\u4efb\u52a1\u6267\u884c\u6bd4\u8f83\u6162\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u67e5\u770b\u662f\u4e0d\u662f\u8fd9\u4e2a\u4efb\u52a1\u88ab<code>CPU</code>\u8c03\u5ea6\u5668\u5b89\u6392\u5230\u4e86\u5c0f\u6838\u4e0a\u8fd0\u884c\uff1f</li> <li>\u67d0\u4e2a\u573a\u666f\u7684\u4efb\u52a1\u6267\u884c\u6bd4\u8f83\u6162\uff0c\u5f53\u524d\u6267\u884c\u8fd9\u4e2a\u4efb\u52a1\u7684 <code>CPU</code> \u8fd0\u884c\u9891\u7387\u662f\u4e0d\u662f\u4e0d\u591f\uff1f\u662f\u5426\u56e0\u4e3a\u95e8\u9650\u503c\u7684\u8bbe\u7f6e\u4e0d\u5408\u7406\u5bfc\u81f4<code>CPU</code>\u88ab\u9650\u9891\u4e86\uff1f</li> <li>\u6211\u7684\u4efb\u52a1\u5bf9\u6027\u80fd\u8981\u6c42\u6bd4\u8f83\u9ad8\uff0c\u6bd4\u5982\u6307\u7eb9\u89e3\u9501\uff0c\u80fd\u4e0d\u80fd\u628a\u6211\u8fd9\u4e2a\u4efb\u52a1\u6301\u7eed\u653e\u5230<code>CPU</code>\u8d85\u5927\u6838\u53bb\u8fd0\u884c\uff1f</li> <li>\u6211\u7684\u524d\u53f0\u5e94\u7528\u4efb\u52a1\u7ebf\u7a0b\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u72b6\u6001\u65e0\u6cd5\u6267\u884c\u800c\u5361\u987f\uff0c\u5f53\u524d\u5230\u5e95\u662f\u4ec0\u4e48\u4efb\u52a1\u5728\u62a2\u5360\u4e86<code>CPU</code>\u8d44\u6e90\u5728\u8fd0\u884c\uff1f</li> </ol>"},{"location":"perf-opt/Android/jank/jank-tool/#12","title":"1.2 \u6e32\u67d3\u663e\u793a\u7cfb\u7edf\u4fe1\u606f\u533a\u57df","text":"<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u6211\u4eec\u5b8c\u6574\u7684\u5206\u6790\u4e86<code>Android</code>\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u5168\u90e8\u6d41\u7a0b\uff0c\u5176\u4e2d\u5305\u542b\u4e86<code>Android</code>\u6e32\u67d3\u663e\u793a\u7cfb\u7edf\u7684\u6838\u5fc3\u903b\u8f91\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u5728<code>Systrace</code>\u4e0a\u4e5f\u6709\u5b8c\u6574\u7684\u5c55\u793a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684<code>Systrace</code>\u622a\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u5c4f\u5e55<code>Vsync</code>\u5468\u671f\u5185\uff08\u5c4f\u5e55\u5237\u65b0\u7387<code>60HZ</code>\u6761\u4ef6\u4e0b\u5c31\u662f<code>16.6ms</code>\uff09\uff0c\u5e94\u7528\u4e0a\u5e27\u6e32\u67d3\u663e\u793a\u7684\u5b8c\u6574\u6d41\u7a0b\u4fe1\u606f\uff1a</p> <ol> <li><code>Vsync app</code>\u4fe1\u53f7\u5230\u6765\u540e\u5524\u9192\u5e94\u7528<code>App</code>\u7684<code>UI</code>\u7ebf\u7a0b\uff0c\u5f00\u59cb\u6267\u884c\u4e00\u5e27\u753b\u9762\u7684<code>measure</code>\u3001<code>layout</code>\u3001<code>draw</code>\u7ed8\u5236\u7b49\u52a8\u4f5c\uff1b</li> <li>\u5728<code>HWUI</code>\u786c\u4ef6\u52a0\u901f\u9ed8\u8ba4\u5f00\u542f\u7684\u6761\u4ef6\u4e0b\uff0c\u5e94\u7528<code>App</code>\u7684<code>UI</code>\u7ebf\u7a0b\u5b8c\u6210<code>draw</code>\u7ed8\u5236\u52a8\u4f5c\u540e\u5c31\u4f1a\u5524\u9192\u5176<code>RenderThread</code>\u6e32\u67d3\u7ebf\u7a0b\uff0c\u89e6\u53d1\u5176\u4f7f\u7528<code>SkiaOpenGL</code>\u6e32\u67d3\u7ba1\u9053\u6267\u884c\u4e00\u5e27\u6570\u636e\u7684\u6e32\u67d3\u64cd\u4f5c\uff0c\u6e32\u67d3\u5b8c\u6210\u540e\u901a\u8fc7<code>Binder</code>\u8c03\u7528<code>queueBuffer</code>\u63a5\u53e3\u5c06<code>Buffer</code>\u753b\u9762\u7f13\u5b58\u6570\u636e\u63d0\u4ea4\u5230<code>SurfaceFlinger</code>\u8fdb\u7a0b\uff1b</li> <li><code>SurfaceFlinger</code>\u8fdb\u7a0b\u4e2d\u5728\u6536\u5230\u5e94\u7528<code>queueBuffer</code>\u4e0a\u5e27\u8bf7\u6c42\u540e\uff0c\u4f1a\u5148\u5c06\u5bf9\u5e94\u7684\u5e94\u7528<code>Layer</code>\u4e2d\u7684<code>BufferQueue</code>\u4e2d\u7684<code>Buffer</code>\u7f6e\u4e3a<code>Queued</code>\u72b6\u6001\uff0c\u6807\u8bc6\u5e94\u7528\u201c\u751f\u4ea7\u201d\u4e86\u4e00\u5e27<code>Buffer</code>\u753b\u9762\u6570\u636e\uff0c\u7136\u540e\u901a\u8fc7<code>requestNextVsync</code>\u6ce8\u518c\u4e0b\u4e00\u4e2a<code>Vsync sf</code>\u4fe1\u53f7\uff1b</li> <li><code>Vsync sf</code>\u4fe1\u53f7\u5230\u8fbe\u540e\uff0c\u4f1a\u53ca\u65f6\u5524\u9192<code>SurfaceFlinger</code>\u8fdb\u7a0b\u7684\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e00\u5e27\u7684\u5408\u6210\u4efb\u52a1\uff0c\u5176\u4e2d\u4f1a\u5148\u904d\u5386\u6240\u6709\u7684<code>Layer</code>\u56fe\u5c42\u7f13\u5b58\u533a\uff0c\u627e\u5230\u5904\u4e8e<code>Queued</code>\u72b6\u6001\u7684\u65b0\u63d0\u4ea4\u7684\u7f13\u5b58\u533a\uff0c\u5c06\u5176\u7f6e\u4e3a<code>Acquired</code>\u72b6\u6001\uff0c\u6807\u8bc6\u201c\u6d88\u8d39\u201d\u4e86\u4e00\u5e27<code>Buffer</code>\u753b\u9762\u6570\u636e\uff1b\u7136\u540e<code>Binder</code>\u5524\u9192<code>HWC service</code>\u8fdb\u7a0b\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6267\u884c\u5177\u4f53\u7684\u56fe\u5c42\u7684\u5408\u6210\u9001\u663e\u64cd\u4f5c\uff1b</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c<code>Systrace</code>\u4e2d\u7684\u6e32\u67d3\u663e\u793a\u7cfb\u7edf\u8fd9\u90e8\u5206\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u5224\u65ad\u754c\u9762\u662f\u5426\u6709\u6389\u5e27\u4ee5\u53ca\u6389\u5e27\u4ea7\u751f\u539f\u56e0\u7684\u5206\u6790\u65b9\u5411\uff0c\u4e3b\u8981\u5206\u6790\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-tool/#13-system-server","title":"1.3 System Server\u6846\u67b6\u8fdb\u7a0b\u4fe1\u606f\u533a\u57df","text":""},{"location":"perf-opt/Android/jank/jank-tool/#131-input","title":"1.3.1 Input","text":"<p><code>Input</code> \u662f <code>System Server</code> \u8fdb\u7a0b\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u4e3b\u8981\u662f\u7531 <code>InputReader</code> \u548c <code>InputDispatcher</code> \u8fd9\u4e24\u4e2a <code>Native</code> \u5b50\u7ebf\u7a0b\u7ec4\u6210\uff0c\u5173\u4e8e\u8fd9\u4e00\u90e8\u5206\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u5df2\u7ecf\u4ece\u539f\u7406\u673a\u5236\u5e76\u7ed3\u5408<code>Systrace</code>\u8be6\u7ec6\u5206\u6790\u8fc7\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u5c55\u5f00\u5206\u6790\u3002\u6211\u4eec\u56de\u987e\u4e00\u4e0b\u8fd9\u8fb9\u90e8\u5206\u5185\u5bb9\u5728<code>Systrace</code>\u4e0a\u7684\u8868\u73b0\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-tool/#132-activitymanagerservice","title":"1.3.2 ActivityManagerService","text":"<p><code>ActivityManagerService</code>\uff08\u4ee5\u4e0b\u7b80\u79f0<code>AMS</code>\uff09\u5c5e\u4e8e\u7cfb\u7edf\u6846\u67b6<code>System Server</code>\u4e2d\u8fd0\u884c\u7684\u6838\u5fc3\u670d\u52a1\u4e4b\u4e00\uff0c\u4e3b\u8981\u8d1f\u8d23\u5e94\u7528\u8fdb\u7a0b\u548c\u56db\u5927\u7ec4\u4ef6\u7684\u7ba1\u7406\u3002\u662f\u4e0e\u5e94\u7528<code>App</code>\u8fdb\u7a0b\u4e4b\u95f4\u4ea7\u751f<code>Binder</code>\u4ea4\u4e92\u6700\u591a\u7684\u7cfb\u7edf\u670d\u52a1\u4e4b\u4e00\u3002\u8c37\u6b4c\u539f\u751f\u7684<code>AOSP</code>\u4ee3\u7801\u4e2d\u5c31\u5728<code>AMS</code>\u670d\u52a1\u7ba1\u7406\u7684\u8fdb\u7a0b\u548c\u56db\u5927\u7ec4\u4ef6\u7684\u5404\u79cd\u573a\u666f\u4e0b\u6709\u5bf9\u5e94\u7684<code>Trace</code>\u70b9\u6765\u8bb0\u5f55\uff0c\u6bd4\u5982\u5927\u5bb6\u719f\u6089\u7684 <code>ActivityStart</code>\u3001<code>ActivityResume</code>\u3001<code>activityStop</code> \u7b49\uff0c\u4e0e<code>AMS</code>\u76f8\u5173\u7684<code>Trace</code>\u4e00\u822c\u4f1a\u7528<code>TRACE_TAG_ACTIVITY_MANAGER</code>\u8fd9\u4e2a<code>TAG</code>\uff0c\u5728 <code>Systrace</code> \u4e2d\u5bf9\u5e94\u7684\u540d\u5b57\u662f <code>ActivityManager</code> \u3002\u4ee5\u684c\u9762\u6253\u5f00\u5e94\u7528\u51b7\u542f\u52a8\u573a\u666f\u4e3a\u4f8b\uff0c<code>AMS</code>\u9700\u8981\u4e3a\u5e94\u7528\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u6b64\u8fc7\u7a0b\u5728<code>AOSP</code>\u4ee3\u7801\u4e2d\u5c31\u6709\u76f8\u5173\u7684<code>AMS</code>\u76f8\u5173\u7684<code>Trace</code>\u57cb\u70b9\u8bb0\u5f55\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5bf9\u5e94<code>Systrace</code>\u4e0a\u8868\u73b0\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-tool/#133-windowmanagerservice","title":"1.3.3 WindowManagerService","text":"<p><code>WindowManagerService</code>\uff08\u4ee5\u4e0b\u7b80\u79f0<code>WMS</code>\uff09 \u5c5e\u4e8e\u7cfb\u7edf\u6846\u67b6<code>System Server</code>\u4e2d\u8fd0\u884c\u7684\u6838\u5fc3\u670d\u52a1\u4e4b\u4e00\uff0c\u4e3b\u8981\u8d1f\u8d23\u5e94\u7528\u7a97\u53e3\u7ba1\u7406\u3001\u7a97\u53e3\u52a8\u753b\u7ba1\u7406\u3001<code>Surface</code>\u7ba1\u7406\u548c<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u7684\u7ba1\u7406\u3002\u4e5f\u662f\u4e0e\u5e94\u7528<code>App</code>\u8fdb\u7a0b\u4e4b\u95f4\u4ea7\u751f<code>Binder</code>\u4ea4\u4e92\u6700\u591a\u7684\u7cfb\u7edf\u670d\u52a1\u4e4b\u4e00\u3002\u8c37\u6b4c\u539f\u751f\u7684<code>AOSP</code>\u4ee3\u7801\u4e2d\u5c31\u5728<code>WMS</code>\u7a97\u53e3\u7ba1\u7406\u7b49\u6838\u5fc3\u6d41\u7a0b\u4e0a\u6709\u5bf9\u5e94\u7684<code>Trace Tag</code>\u57cb\u70b9\u6765\u8bb0\u5f55\u3002\u4e0e<code>WMS</code> \u76f8\u5173\u7684 <code>Trace</code> \u4e00\u822c\u4f1a\u7528 <code>TRACE_TAG_WINDOW_MANAGER</code> \u8fd9\u4e2a <code>TAG</code>\uff0c \u5728 <code>Systrace</code> \u4e2d\u5bf9\u5e94\u7684\u540d\u5b57\u662f <code>WindowManager</code> \u3002\u7ee7\u7eed\u4ee5\u4e0a\u9762\u7684\u684c\u9762\u6253\u5f00\u5e94\u7528\u51b7\u542f\u52a8\u573a\u666f\u4e3a\u4f8b\uff0c\u5e94\u7528\u542f\u52a8\u540e\u521b\u5efa\u7b2c\u4e00\u4e2a<code>Activity</code>\u754c\u9762\u540e\uff0c\u5728\u7ed8\u5236\u7b2c\u4e00\u5e27\u753b\u9762\u65f6\u9700\u8981\u901a\u8fc7<code>Binder</code>\u8bbf\u95ee\u6846\u67b6<code>WMS</code>\u670d\u52a1\u7684<code>relayoutWindow</code>\u63a5\u53e3\uff0c\u4ee5\u5b9e\u73b0\u8ba1\u7b97\u5e94\u7528\u7a97\u53e3\u7684\u5927\u5c0f\u548c\u7533\u8bf7\u4e00\u5f20\u53ef\u7528<code>Surface</code>\u753b\u5e03\u7b49\u903b\u8f91\uff0c\u5173\u4e8e\u8fd9\u5757\u8be6\u7ec6\u7684\u5206\u6790\u8bf7\u53c2\u8003\u7b14\u8005\u4e4b\u524d\u7684\u6587\u7ae0https://www.jianshu.com/p/37370c1d17fc\u3002\u4ece<code>Systrace</code>\u4e0a\u770b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-tool/#134-handlerthread","title":"1.3.4 HandlerThread\u6838\u5fc3\u5de5\u4f5c\u7ebf\u7a0b","text":"<p>\u4e0a\u9762\u63cf\u8ff0\u7684<code>AMS</code>\u3001<code>WMS</code>\u7b49\u7cfb\u7edf\u6846\u67b6\u6838\u5fc3\u7ba1\u7406\u670d\u52a1\uff0c\u5176\u5177\u4f53\u903b\u8f91\u6700\u7ec8\u90fd\u9700\u8981\u8fd0\u884c\u5728\u5177\u4f53\u7684\u7ebf\u7a0b\u4e2d\u3002\u4e3a\u6b64<code>system_server</code>\u8fdb\u7a0b\u4e2d\u8bbe\u8ba1\u4e86\u5f88\u591a\u7ee7\u627f\u4e8e<code>HandlerThread</code>\uff08\u81ea\u5e26<code>Looper</code>\u6d88\u606f\u5faa\u73af\u7684\u7ebf\u7a0b\uff09\u7684\u6838\u5fc3\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u6267\u884c\u4e0d\u540c\u5206\u7c7b\u4e1a\u52a1\u7684\u903b\u8f91\u3002\u6bd4\u5982\u6709\u4e13\u95e8\u8d1f\u8d23\u7cfb\u7edf<code>UI</code>\u5c55\u793a\u7684<code>UiThread</code>\u7ebf\u7a0b\uff08\u6e90\u7801\u5b9e\u73b0\u4f4d\u4e8e<code>framework/base/services/core/java/com/android/server/UiThread.java</code>\uff09\uff0c\u7ebf\u7a0b\u540d\u4e3a\u201c<code>android.ui</code>\u201d\uff0c\u5728<code>Systrace</code>\u4e0a\u7684\u663e\u793a\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6bd4\u5982\u8d1f\u8d23\u7a97\u53e3\u52a8\u753b\u5c55\u793a\u7684<code>AnimationThread</code>\uff0c\u7ebf\u7a0b\u540d\u4e3a\u201c<code>android.anim</code>\u201d\uff0c\u5728<code>Systrace</code>\u4e0a\u7684\u663e\u793a\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u8d1f\u8d23<code>IO</code>\u5904\u7406\u7684\u5de5\u4f5c\u7ebf\u7a0b<code>\u201candroid.io</code>\u201d\uff0c\u518d\u6bd4\u5982\u62e5\u6709\u6781\u9ad8\u4f18\u5148\u7ea7\uff0c\u8d1f\u8d23\u7cfb\u7edf\u754c\u9762\u5b9e\u65f6\u663e\u793a\u7684\u5de5\u4f5c\u7ebf\u7a0b<code>\u201candroid.display</code>\u201d\u7b49\uff0c\u7531\u4e8e\u7bc7\u5e45\u6240\u9650\uff0c\u5c31\u4e0d\u518d\u4e00\u4e00\u5c55\u5f00\u5206\u6790\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u7ed3\u5408\u6e90\u7801\u53bb\u9605\u8bfb\u3002\u968f\u7740\u5bf9\u7cfb\u7edf\u6e90\u7801\u903b\u8f91\u7684\u6df1\u5165\u4e86\u89e3\uff0c\u76f8\u4fe1\u5bf9\u8fd9\u4e9b\u6846\u67b6\u7684\u6838\u5fc3\u5de5\u4f5c\u7ebf\u7a0b\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u719f\u6089\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e9b\u81ea\u5e26\u6d88\u606f\u5faa\u73af\u7684\u6838\u5fc3\u5de5\u4f5c\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\u90fd\u662f\u7cfb\u7edf\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684\u6838\u5fc3\u903b\u8f91\uff0c\u6240\u4ee5\u8fd9\u4e9b\u5de5\u4f5c\u7ebf\u7a0b\u8fd0\u884c\u7684\u662f\u5426\u901a\u7545\u76f4\u63a5\u5173\u7cfb\u5230\u7cfb\u7edf\u7684\u201c\u5065\u5eb7\u7a0b\u5ea6\u201d\u3002\u901a\u8fc7\u4ece<code>Systrace</code>\u4e0a\u89c2\u5bdf\u8fd9\u4e9b\u5de5\u4f5c\u7ebf\u7a0b\u7684\u8fd0\u884c\u4efb\u52a1\u8d1f\u8f7d\u5c31\u53ef\u4ee5\u76f4\u63a5\u53cd\u6620\u51fa\u7cfb\u7edf\u6846\u67b6\u7684\u8d1f\u8f7d\u4e0e\u7e41\u5fd9\u7a0b\u5ea6\uff0c\u5982\u679c\u8fd9\u4e9b\u7ebf\u7a0b\u51fa\u73b0\u957f\u65f6\u95f4\u7684\u963b\u585e\uff0c\u8f7b\u5219\u5bfc\u81f4\u7cfb\u7edf\u53cd\u5e94\u53d8\u6162\u3001\u754c\u9762\u5361\u987f\u7b49\u95ee\u9898\uff0c\u91cd\u5219\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u51bb\u5c4f\u3002\u4e3a\u6b64<code>Android</code>\u7cfb\u7edf\u8bbe\u8ba1\u5728\u5f00\u673a\u65f6\u4f1a\u5c06\u4e00\u4e9b\u7cfb\u7edf\u6846\u67b6 \u6838\u5fc3\u5de5\u4f5c\u7ebf\u7a0b\u52a0\u5165\u5230<code>WatchDog</code>\u7684\u76d1\u63a7\u4e2d\uff0c\u901a\u8fc7\u5b9a\u671f\u5f80\u8fd9\u4e9b\u7ebf\u7a0b\u6d88\u606f\u5faa\u73af\u961f\u5217\u4e2d\u629b\u6d88\u606f\uff0c\u7136\u540e\u68c0\u67e5\u6d88\u606f\u662f\u5426\u5f97\u5230\u53ca\u65f6\u6267\u884c\u6765\u5224\u65ad\u5176\u662f\u5426\u6b63\u5e38\u987a\u7545\u8fd0\u884c\uff0c\u5982\u679c\u51fa\u73b0\u957f\u65f6\u95f4\u8d85\u65f6\u5f97\u4e0d\u5230\u6267\u884c\u5c31\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u91cd\u542f\u3002\u76f8\u5173\u7b80\u5316\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>/*frameworks/base/services/core/java/com/android/server/Watchdog.java*/\nprivate Watchdog() {\n...\n// The shared foreground thread is the main checker.  It is where we\n// will also dispatch monitor checks and do other work.\nmMonitorChecker = new HandlerChecker(FgThread.getHandler(),\n\"foreground thread\", DEFAULT_TIMEOUT);\nmHandlerCheckers.add(mMonitorChecker);\n// Add checker for main thread.  We only do a quick check since there\n// can be UI running on the thread.\nmHandlerCheckers.add(new HandlerChecker(new Handler(Looper.getMainLooper()),\n\"main thread\", DEFAULT_TIMEOUT));\n// Add checker for shared UI thread.\nmHandlerCheckers.add(new HandlerChecker(UiThread.getHandler(),\n\"ui thread\", DEFAULT_TIMEOUT));\n// And also check IO thread.\nmHandlerCheckers.add(new HandlerChecker(IoThread.getHandler(),\n\"i/o thread\", DEFAULT_TIMEOUT));\n// And the display thread.\nmHandlerCheckers.add(new HandlerChecker(DisplayThread.getHandler(),\n\"display thread\", DEFAULT_TIMEOUT));\n// And the animation thread.\nmHandlerCheckers.add(new HandlerChecker(AnimationThread.getHandler(),\n\"animation thread\", DEFAULT_TIMEOUT));\n// And the surface animation thread.\nmHandlerCheckers.add(new HandlerChecker(SurfaceAnimationThread.getHandler(),\n\"surface animation thread\", DEFAULT_TIMEOUT));\n// Initialize monitor for Binder threads. //\u68c0\u67e5\u7cfb\u7edfsystem_server\u8fdb\u7a0b\u7528\u4e8eBinder\u901a\u4fe1\u7684\u7ebf\u7a0b\u6570\u91cf\u662f\u5426\u5145\u8db3\naddMonitor(new BinderThreadMonitor());\n...\n}\n</code></pre>"},{"location":"perf-opt/Android/jank/jank-tool/#135-binder","title":"1.3.5 Binder\u4e0e\u9501\u7ade\u4e89\u673a\u5236","text":"<p>a.<code>Binder</code>\u662f<code>Android</code>\u7cfb\u7edf\u4e2d\u6700\u5e7f\u6cdb\u4f7f\u7528\u7684\u8de8\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\uff0c\u5e94\u7528\u8fdb\u7a0b\u4e0e\u7cfb\u7edf\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5927\u90e8\u5206\u8de8\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\u90fd\u662f\u901a\u8fc7<code>Binder</code>\u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u5c31\u50cf\u201c\u795e\u7ecf\u7f51\u7edc\u201d\u4e00\u6837\u904d\u5e03\u4e8e<code>Android</code>\u7cfb\u7edf\u7684\u6574\u4e2a\u8fd0\u884c\u4f53\u7cfb\u4e2d\u3002\u4f8b\u5982\u5e94\u7528\u901a\u8fc7<code>startActvity</code>\u542f\u52a8\u4e00\u4e2a\u65b0\u7684<code>Activity</code>\u9875\u9762\uff0c\u6216\u8005<code>sendBroadcast</code>\u53d1\u9001\u4e00\u6761\u5e7f\u64ad\uff0c\u90fd\u9700\u8981\u901a\u8fc7<code>Binder</code>\u53d1\u9001\u76f8\u5173\u7684\u8bf7\u6c42\u5230\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e2d\u5177\u4f53\u5904\u7406\u4e0e\u5b9e\u73b0\u3002\u6240\u4ee5\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e2d\u5f88\u591a\u65f6\u5019\u90fd\u5728\u5904\u7406\u5e94\u7528\u8fdb\u7a0b\u7684\u5404\u79cd<code>Binder</code>\u8bf7\u6c42\u4e0e\u54cd\u5e94\u7684\u903b\u8f91\u3002\u5173\u4e8e<code>Binder</code>\u7684\u8be6\u7ec6\u5b9e\u73b0\u539f\u7406\u4e0e\u67b6\u6784\u8bbe\u8ba1\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0https://juejin.cn/post/6955298955307515917\uff0c\u672c\u8282\u5185\u5bb9\u91cd\u70b9\u5728\u4e8e\u63cf\u8ff0\u5176\u5728<code>Systrace</code>\u4e0a\u7684\u8868\u73b0\uff0c\u5c31\u4e0d\u518d\u8be6\u7ec6\u5c55\u5f00\u5206\u6790\u3002\u5728\u6293\u53d6<code>Systrace</code>\u65f6\u6ce8\u610f\u9009\u62e9\u5f00\u542f<code>binder_lock</code>\u548c<code>binder_driver</code>\u4e24\u4e2a\u8ffd\u8e2a\u9009\u9879\uff0c\u5c31\u80fd\u5728<code>Systrace</code>\u4e0a\u770b\u5230\u5b8c\u6574\u7684<code>Binder</code>\u8c03\u7528\u4e8b\u4ef6\u4fe1\u606f\u6d41\u3002\u6211\u4eec\u8fd8\u662f\u4ee5\u4ece\u684c\u9762\u6253\u5f00\u5e94\u7528\u51b7\u542f\u52a8\u7684\u573a\u666f\u4e3a\u4f8b\uff0c\u684c\u9762\u5e94\u7528\u4e2d\u9700\u8981\u542f\u52a8\u4e09\u65b9\u5e94\u7528\u65f6\uff0c\u901a\u8fc7<code>Binder</code>\u8c03\u7528\u6846\u67b6<code>AMS</code>\u670d\u52a1\u4e2d\u7684<code>startActivity</code>\u63a5\u53e3\u6765\u5b9e\u73b0\uff0c\u76f8\u5173<code>Binder</code>\u8c03\u7528\u8fc7\u7a0b\u5728<code>Systrace</code>\u4e0a\u770b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>b.\u4ece\u4e0a\u9762\u7684\u5206\u6790\u53ef\u4ee5\u770b\u5230\uff0c\u5f88\u591a\u65f6\u5019\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e2d\u90fd\u5728\u963b\u585e\u5f0f\u7684\u5904\u7406\u5e94\u7528\u7684\u5404\u79cd<code>Binder</code>\u8de8\u8fdb\u7a0b\u8bbf\u95ee\u4e0e\u8bf7\u6c42\u3002\u4f46\u662f\u5f88\u591a\u65f6\u5019<code>system_server</code>\u8fdb\u7a0b\u5728\u5904\u7406\u5e94\u7528\u7684<code>Binder</code>\u8bf7\u6c42\u65f6\uff0c\u5185\u90e8\u90fd\u662f\u963b\u585e\u5728\u4e86\u5404\u79cd\u540c\u6b65\u9501\u7684\u7ade\u4e89\u4e0e\u7b49\u5f85\u7684\u6d41\u7a0b\u4e0a\uff08<code>AMS</code>\u548c<code>WMS</code>\u7b49\u6838\u5fc3\u670d\u52a1\u8fd0\u884c\u65f6\u5185\u90e8\u90fd\u62e5\u6709\u5404\u81ea\u7684\u76f8\u5173\u9501\u5bf9\u8c61\uff0c\u4e14\u5f80\u5f80\u5f88\u5bb9\u6613\u5b58\u5728\u76f8\u4e92\u6301\u6709\u9501\u548c\u9501\u7ade\u4e89\u7684\u903b\u8f91\uff09\uff0c\u95f4\u63a5\u5bfc\u81f4\u5bf9\u5e94\u7528\u7684<code>Binder reply</code>\u54cd\u5e94\u53d8\u6162\uff0c\u4ece\u800c\u6700\u7ec8\u5bfc\u81f4\u5e94\u7528\u51fa\u73b0\u5361\u987f\u6216\u53cd\u5e94\u6162\u7b49\u6027\u80fd\u95ee\u9898\u3002<code>system_server</code>\u8fdb\u7a0b\u5185\u90e8\u7684\u8fd9\u4e9b\u9501\u7ade\u4e89\u4e0e\u7b49\u5f85\u7684\u95ee\u9898\uff0c\u8f7b\u5219\u5bfc\u81f4\u5e94\u7528\u548c\u7cfb\u7edf\u7684\u5361\u987f\u4e0e\u53cd\u5e94\u6162\u7684\u95ee\u9898\uff0c\u91cd\u5219\u51fa\u73b0\u6b7b\u9501\u800c\u5bfc\u81f4\u7cfb\u7edf\u51bb\u5c4f\u3001\u91cd\u542f(<code>WatchDog</code>\u89e6\u53d1\uff09\u7b49\u4e25\u91cd\u95ee\u9898\u3002\u6240\u4ee5<code>system_server</code>\u8fdb\u7a0b\u5185\u90e8\u7684\u5de5\u4f5c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u9501\u7b49\u5f85\u95ee\u9898\u7684\u4f18\u5316\uff0c\u4e00\u76f4\u4ee5\u6765\u90fd\u662f\u8c37\u6b4c\u548c\u56fd\u5185\u5404\u5927\u624b\u673a\u5382\u5546\u4eec\u505a<code>Android</code>\u7cfb\u7edf\u6027\u80fd\u4f18\u5316\u7684\u91cd\u70b9\u5de5\u4f5c\u4e4b\u4e00\u3002\u5f53\u7136\u8981\u60f3\u5408\u7406\u4f18\u5316\u51cf\u5c11\u8fd9\u4e9b\u7ebf\u7a0b\u4e4b\u95f4\u7684\u9501\u7b49\u5f85\u73b0\u8c61\uff0c\u9700\u8981\u5728\u6df1\u5165\u5206\u6790\u4e86\u89e3\u7cfb\u7edf\u76f8\u5173\u6e90\u7801\u6d41\u7a0b\u7684\u57fa\u7840\u4e0a\u624d\u80fd\u4f5c\u51fa\u5408\u7406\u7684\u6539\u5584\u4e0e\u4f18\u5316\uff0c\u8fd9\u662f\u4e00\u4e2a\u8003\u9a8c\u76f8\u5173\u53c2\u4e0e\u7cfb\u7edf\u6027\u80fd\u4f18\u5316\u4eba\u5458\u6c34\u5e73\u7684\u95ee\u9898\uff0c\u4e5f\u9700\u8981\u65f6\u95f4\u4e0e\u7ecf\u9a8c\u7684\u6c89\u6dc0\u3002\u672c\u5c0f\u8282\u4e2d\u5148\u5e26\u5927\u5bb6\u6765\u4e86\u89e3\u4e00\u4e0b\u5982\u4f55\u4ece<code>Systrace</code>\u4e0a\u7684\u663e\u793a\u6765\u5165\u624b\u5206\u6790\u8fd9\u79cd\u9501\u7ade\u4e89\u7b49\u5f85\u7684\u95ee\u9898\uff1a \u9996\u5148\u6211\u4eec\u6765\u770b\u770b<code>Systrace</code>\u4e0a\u663e\u793a\u7684\u9501\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5176\u5b9e<code>Systrace</code>\u4e0a\u663e\u793a\u7684\u9501\u76f8\u5173\u7684\u4fe1\u606f\uff08\u8c37\u6b4c\u901a\u8fc7\u5728<code>art</code>\u865a\u62df\u673a\u7684<code>monitor</code>\u5bf9\u8c61\u9501\u5b9e\u73b0\u7684\u6e90\u7801\u6d41\u7a0b\u4e2d\u589e\u52a0\u76f8\u5173\u7684<code>Trace TAG</code>\u57cb\u70b9\u5b9e\u73b0\uff0c\u76f8\u5173\u6e90\u7801\u4f4d\u4e8e<code>art/runtime/monitor.cc</code>\u4e2d\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u53bb\u9605\u8bfb\u4e00\u4e0b\uff09\uff0c\u5df2\u7ecf\u57fa\u672c\u4e0a\u5305\u542b\u4e86\u6211\u4eec\u5206\u6790\u9501\u7ade\u4e89\u7b49\u5f85\u95ee\u9898\u6240\u9700\u8981\u7684\u5168\u90e8\u6709\u6548\u4fe1\u606f\u3002\u4e0a\u56fe\u4e2d\u5c55\u793a\u7684\u8fd9\u6bb5\u9501\u76f8\u5173\u4fe1\u606f\u7ffb\u8bd1\u4e00\u4e0b\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <ol> <li><code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684\u5f53\u524d\u7ebf\u7a0b\uff08<code>tgid</code>\u4e3a<code>4147</code>\uff09\u6b63\u5728\u6267\u884c\u7684\u51fd\u6570<code>android.content.res.CompatibilityInfo com.android.server.wm.ActivityTaskManagerService$LocalService.compatibilityInfoForPackage(android.content.pm.ApplicationInfo)(ActivityTaskManagerService.java:6227)</code>\u65f6\u9700\u8981\u7533\u8bf7\u6301\u6709\u67d0\u4e2a\u5bf9\u8c61\u9501\uff1b\u5f53\u524d\u7531\u4e8e\u6709\u5176\u5b83\u7ebf\u7a0b\u6b63\u5728\u6301\u6709\u6b64\u5bf9\u8c61\u9501\uff0c\u6240\u4ee5\u672c\u7ebf\u7a0b\u8fdb\u5165\u8be5\u5bf9\u8c61\u7684\u9501\u6c60\u4e2d\u963b\u585e\u7b49\u5f85\u7ebf\u7a0b\u91ca\u653e\u9501\uff0c\u4e14\u5bf9\u8c61\u7684\u9501\u6c60\u4e2d\u5df2\u7ecf\u6709\u4e24\u4e2a\u7ebf\u7a0b\u5df2\u7ecf\u5728\u7b49\u5f85\uff0c\u52a0\u4e0a\u672c\u7ebf\u7a0b\u5171\u8ba1\u6709\u4e09\u4e2a\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u8be5\u9501\u5bf9\u8c61\u7684\u91ca\u653e\uff08\u865a\u62df\u673a\u4e3a\u6bcf\u4e2a<code>java</code>\u5bf9\u8c61\u7ef4\u62a4\u4e86\u4e24\u4e2a\u201c\u961f\u5217\u6c60\u201d\uff0c\u4e00\u4e2a\u53eb<code>Entry Set</code>\uff08\u5165\u53e3\u96c6\uff09\uff0c\u53e6\u5916\u4e00\u4e2a\u53eb<code>Wait Set</code>\uff08\u7b49\u5f85\u96c6\uff09\uff1b\u5bf9\u4e8e\u4efb\u610f\u7684\u5bf9\u8c61<code>objectX</code>\uff0c<code>objectX</code>\u7684<code>Entry Set</code>\u7528\u4e8e\u5b58\u50a8\u7b49\u5f85\u83b7\u53d6<code>objectX</code>\u8fd9\u4e2a\u9501\u7684\u6240\u6709\u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f \u9501\u6c60\uff0c<code>objectX</code>\u7684<code>Wait Set</code>\u7528\u4e8e\u5b58\u50a8\u6267\u884c\u4e86<code>objectX.wait()/wait(long)</code>\u7684\u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f \u7b49\u5f85\u6c60\uff09\u3002 <pre><code>   /*frameworks/base/services/core/java/com/android/server/wm/ActivityTaskManagerService.java*/\n...\n@Override\npublic CompatibilityInfo compatibilityInfoForPackage(ApplicationInfo ai) {\nsynchronized (mGlobalLock) { // 4147\u7ebf\u7a0b\u4e2d\u5c31\u662f\u6b64\u5904\u7684\u6267\u884c\u9700\u8981\u7533\u8bf7\u6301\u6709AMS\u670d\u52a1\u5185\u90e8\u7684\u5bf9\u8c61\u9501mGlobalLock\nreturn compatibilityInfoForPackageLocked(ai);\n}\n}\n...\n</code></pre></li> <li>\u5f53\u524d\u5bf9\u8c61\u9501\u6b63\u5728\u88ab<code>system_server</code>\u8fdb\u7a0b\u4e2d\u540d\u4e3a<code>Binder:2323_1C</code>\u7684\u7ebf\u7a0b\u6240\uff08<code>tgid</code>\u4e3a<code>8289</code>\uff09\u6301\u6709\uff0c\u4e14\u8be5\u7ebf\u7a0b\u4e2d\u5f53\u524d\u6b63\u5728\u6301\u9501\u6267\u884c\u5982\u4e0b\u51fd\u6570\u8c03\u7528\uff1a <code>void com.android.server.wm.ActivityClientController.activityPaused(android.os.IBinder)(ActivityClientController.java:169)</code> \u3002 <pre><code>   /*frameworks/base/services/core/java/com/android/server/wm/ActivityClientController.java*/\n...\n@Override\npublic void activityPaused(IBinder token) {\nfinal long origId = Binder.clearCallingIdentity();\nsynchronized (mGlobalLock) {// 8289\u7ebf\u7a0b\u4e2d\u5f53\u524d\u6b63\u6301\u6709\u9501mGlobalLock\uff0c\u6267\u884cactivityPaused\u7684\u903b\u8f91\nTrace.traceBegin(TRACE_TAG_WINDOW_MANAGER, \"activityPaused\");\nfinal ActivityRecord r = ActivityRecord.forTokenLocked(token);\nif (r != null) {\nr.activityPaused(false);\n}\nTrace.traceEnd(TRACE_TAG_WINDOW_MANAGER);\n}\nBinder.restoreCallingIdentity(origId);\n}\n....\n</code></pre></li> </ol> <p>\u7136\u540e\u6211\u4eec\u518d\u4ece<code>Systarce</code>\u4e0a\u603b\u4f53\u6765\u770b\u770b\u8fd9\u4e2a<code>mGlobalLock</code>\u5bf9\u8c61\u9501\u7684\u7ade\u4e89\u7b49\u5f85\u72b6\u6001\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230 <code>mGlobalLock</code> \u8fd9\u4e2a\u5bf9\u8c61\u9501\u7684\u4e89\u593a\u60c5\u51b5\uff1a</p> <ol> <li><code>Binder:2323_1C</code>\u9996\u5148\u5f00\u59cb\u6267\u884c activityPaused\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u662f\u8981\u83b7\u53d6 <code>mGlobalLock</code> \u5bf9\u8c61\u9501\u7684\uff0c\u7531\u4e8e\u6b64\u65f6 <code>mGlobalLock</code> \u6ca1\u6709\u7ade\u4e89\uff0c\u6240\u4ee5 <code>activityPaused</code> \u83b7\u53d6\u5bf9\u8c61\u9501\u4e4b\u540e\u5f00\u59cb\u6267\u884c\uff1b</li> <li><code>android.display</code> \u7ebf\u7a0b\u5f00\u59cb\u6267\u884c handleMessage \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u662f\u8981\u83b7\u53d6 <code>mGlobalLock</code> \u5bf9\u8c61\u9501\u7684\uff0c\u4f46\u662f\u6b64\u65f6<code>Binder:2323_1C</code> \u7684 <code>activityPaused</code> \u6301\u6709 <code>mGlobalLock</code> \u5bf9\u8c61\u9501 \uff0c\u6240\u4ee5\u8fd9\u91cc <code>android.display</code> \u7684 <code>handleMessage</code>\u5f00\u59cb\u7b49\u5f85\uff0c\u8fdb\u5165 <code>sleep</code> \u72b6\u6001\uff1b</li> <li><code>Binder:2323_1</code> \u7ebf\u7a0b\u5f00\u59cb\u6267\u884c isControllerAMonkey \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u662f\u8981\u83b7\u53d6 <code>mGlobalLock</code> \u5bf9\u8c61\u9501\u7684\uff0c\u4f46\u662f\u6b64\u65f6<code>Binder:2323_1C</code> \u7684 <code>activityPaused</code> \u6301\u6709 <code>mGlobalLock</code> \u5bf9\u8c61\u9501 \uff0c\u6240\u4ee5\u8fd9\u91cc <code>`Binder:2323_1</code>\u7684 <code>isControllerAMonkey</code>\u5f00\u59cb\u7b49\u5f85\uff0c\u8fdb\u5165<code>sleep</code> \u72b6\u6001\uff1b</li> <li><code>GameModeWorkThr</code> \u7ebf\u7a0b\u5f00\u59cb\u6267\u884c compatibilityInfoForPackage \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u662f\u8981\u83b7\u53d6 <code>mGlobalLock</code> \u5bf9\u8c61\u9501\u7684\uff0c\u4f46\u662f\u6b64\u65f6<code>Binder:2323_1C</code> \u7684 <code>activityPaused</code> \u6301\u6709 <code>mGlobalLock</code> \u5bf9\u8c61\u9501 \uff0c\u6240\u4ee5\u8fd9\u91cc <code>`GameModeWorkThr</code>\u7684 <code>compatibilityInfoForPackage</code>\u5f00\u59cb\u7b49\u5f85\uff0c\u8fdb\u5165<code>sleep</code> \u72b6\u6001\u3002</li> </ol> <p>\u7ecf\u8fc7\u4e0a\u9762\u56db\u6b65\uff0c\u5c31\u5f62\u6210\u4e86 <code>Binder:2323_1C</code>\u7ebf\u7a0b\u5728\u8fd0\u884c\uff0c\u5176\u4ed6\u4e09\u4e2a\u4e89\u593a <code>mGlobalLock</code> \u5bf9\u8c61\u9501\u5931\u8d25\u7684\u7ebf\u7a0b\u5206\u522b\u8fdb\u5165 <code>sleep</code> \u72b6\u6001\uff0c\u7b49\u5f85 <code>Binder:2323_1C</code> \u6267\u884c\u7ed3\u675f\u540e\u91ca\u653e <code>mGlobalLock</code> \u5bf9\u8c61\u9501\u3002\u5f53<code>Binder:2323_1C</code>\u7ebf\u7a0b\u4e2d\u7684<code>activityPaused</code>\u903b\u8f91\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u91ca\u653e<code>mGlobalLock</code>\u9501\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u5c31\u4f1a\u4ece\u5176\u9501\u6c60\u4e2d\u4efb\u610f\u53d6\u51fa\u4e00\u4e2a\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u53bb\u5524\u9192\uff0c\u4f7f\u5f97\u7ebf\u7a0b\u80fd\u6210\u529f\u7533\u8bf7\u5230<code>mGlobalLock</code>\u9501\u5bf9\u8c61\u53bb\u6267\u884c\uff0c\u5e76\u5c06\u8be5\u7ebf\u7a0b\u4ece<code>mGlobalLock</code>\u9501\u6c60\u4e2d\u79fb\u9664\u3002\u540e\u7eed\u5173\u4e8e<code>mGlobalLock</code>\u9501\u91ca\u653e\u540e\uff0c\u5982\u4f55\u4ece<code>Systrace</code>\u4e0a\u5206\u6790\u89c2\u5bdf\u9501\u6c60\u4e2d\u7684\u7b49\u5f85\u7ebf\u7a0b\u4e4b\u95f4\u7684\u76f8\u4e92\u5524\u9192\u5173\u7cfb\u7684\u6d41\u7a0b\uff0c\u4f1a\u5728\u540e\u6587\u4e2d\u8be6\u7ec6\u8bb2\u89e3\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#14-app-trace","title":"1.4 \u5e94\u7528\u8fdb\u7a0bAPP Trace\u4fe1\u606f\u533a\u57df","text":"<p>\u5982\u679c\u8bf4\u524d\u9762\u8bb2\u89e3\u7684<code>Systrace</code>\u4e0a\u7684\u663e\u793a\u7684\u5185\u5bb9\u901a\u5e38<code>Android</code>\u7cfb\u7edf\u5f00\u53d1\u8005\u4eec\u5173\u6ce8\u7684\u4f1a\u591a\u4e00\u4e9b\uff0c\u90a3\u4e48\u672c\u8282\u4e2d\u6240\u63cf\u8ff0\u7684<code>Systrace</code>\u4e0a\u5e94\u7528\u8fdb\u7a0b<code>APP Trace</code>\u4fe1\u606f\u533a\u57df\u5219\u9700\u8981<code>APP</code>\u5e94\u7528\u5f00\u53d1\u8005\u683c\u5916\u7684\u5173\u6ce8\u3002\u5206\u6790<code>Systrace</code>\u4e0a\u8fd9\u5757\u533a\u57df\u7684\u663e\u793a\u5185\u5bb9\uff0c\u6211\u4eec\u4e00\u822c\u4e3b\u8981\u770b\u7684\u662f<code>UI Thread</code>\u548c<code>Render Thread</code>\u4e24\u4e2a\u7ebf\u7a0b\u7684\u663e\u793a\uff0c\u56e0\u4e3a\u4ece\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u5173\u4e8e<code>Android</code>\u5e94\u7528\u4e0a\u5e27\u663e\u793a\u7684\u539f\u7406\u7684\u5185\u5bb9\u4e2d\u7684\u5206\u6790\u6211\u4eec\u77e5\u9053\uff0c\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u662f\u5e94\u7528\u8fdb\u7a0b\u4e2d\u76f4\u63a5\u8d1f\u8d23\u754c\u9762\u4e0a\u5e27\u663e\u793a\u7684\u5de5\u4f5c\u7ebf\u7a0b\u3002\u5f53\u7136<code>Systrace</code>\u4e0a\u8fd8\u6709\u5f88\u591a\u5e94\u7528\u8fdb\u7a0b\u4e2d\u8fd8\u6709\u5f88\u591a\u5176\u5b83\u7ebf\u7a0b\u7684\u4fe1\u606f\uff0c\u5982\u4e0e<code>GC</code>\u76f8\u5173\u7684<code>HeapTaskDeamon</code>\u7ebf\u7a0b\u3001\u8d1f\u8d23\u52a8\u6001\u7f16\u8bd1\u673a\u5668\u7801\u7684<code>JIT</code>\u7ebf\u7a0b\u7b49\uff0c\u751a\u81f3\u5f88\u591a\u5e94\u7528\u5f00\u53d1\u8005\u81ea\u5df1\u521b\u5efa\u5e76\u5b9a\u4e49\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u5173\u4e8e\u8fd9\u4e9b\u7ebf\u7a0b\u7684\u5206\u6790\u5f00\u53d1\u8005\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u95ee\u9898\u548c\u4e1a\u52a1\u7684\u9700\u8981\u8fdb\u884c\uff0c\u672c\u6587\u5c31\u4e0d\u518d\u6d89\u53ca\u3002 \u6839\u636e\u524d\u6587\u7684\u5206\u6790\u53ef\u77e5\uff0c<code>UI Thread</code>\u548c<code>Render Thread</code>\u90fd\u662f\u81ea\u5e26<code>Looper</code>\u7684\u6d88\u606f\u5faa\u73af\u7ebf\u7a0b\uff0c\u7531\u7cfb\u7edf\u521b\u5efa\u5e94\u7528\u8fdb\u7a0b\u540e\u7edf\u4e00\u4e3a\u5e94\u7528\u521b\u5efa\u542f\u52a8\uff0c\u4e3b\u8981\u8d1f\u8d23\u5e94\u7528\u754c\u9762\u7684<code>UI</code>\u754c\u9762\u7684\u66f4\u65b0\u4e0a\u5e27\u663e\u793a\u548c\u5e94\u7528\u56db\u5927\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u7684\u5904\u7406\u3002<code>Systrace</code>\u4e0a\u7684\u8868\u73b0\u524d\u6587\u4e2d\uff08\u53c2\u8003\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u5df2\u7ecf\u8be6\u7ec6\u5206\u6790\u8fc7\uff09\u5df2\u7ecf\u5206\u6790\u8fc7\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5206\u6790<code>Systrace</code>\u7ebf\u7a0b\u4e0a\u6bcf\u4e00\u6bb5<code>Trace TAG</code>\u7684\u8be6\u7ec6\u8fd0\u884c\u60c5\u51b5\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u5206\u6790\u7ebf\u7a0b\u6bcf\u4e00\u6bb5<code>Trace TAG</code>\u6267\u884c\u8fc7\u7a0b\u7684\u7ebf\u7a0b\u6392\u7a0b\u4f7f\u7528\u72b6\u6001\u4e2d<code>Running</code>\u3001<code>Sleeping</code>\u3001<code>Runnable</code>\u4ee5\u53ca<code>Uninterruptible Sleep</code>\u5360\u7528\u6bd4\u4f8b\u548c\u65f6\u957f\u7b49\u4fe1\u606f\uff0c\u518d\u7ed3\u5408\u5bf9\u5e94\u7684<code>tag</code>\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff1a</p> <ol> <li>\u7ebf\u7a0b\u4efb\u52a1\u662f\u5426\u9891\u7e41\u4e2d\u65ad\u8fdb\u5165<code>sleeping</code>\u72b6\u6001\u5bfc\u81f4\u8fd0\u884c\u53d8\u6162\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u7136\u540e\u7ed3\u5408\u5177\u4f53\u7684<code>tag</code>\u4fe1\u606f\u89c2\u5bdf\u7ebf\u7a0b<code>sleeping</code>\u539f\u56e0\u662f<code>Binder</code>\u901a\u4fe1\u963b\u585e\uff1f\u6216\u8005\u662f\u7b49\u9501\u91ca\u653e\u963b\u585e\uff1f</li> <li>\u7ebf\u7a0b\u662f\u5426\u957f\u65f6\u95f4\u5904\u4e8e<code>Uninterruptible Sleep</code>\u963b\u585e\u72b6\u6001\u5bfc\u81f4\u8fd0\u884c\u53d8\u6162\uff1f\u7136\u540e\u7ed3\u5408<code>tag</code>\u4fe1\u606f\u89c2\u5bdf\u662f\u5426\u4e3a\u6267\u884c<code>I/O</code>\u64cd\u4f5c\u5bfc\u81f4\u88ab<code>Kernel</code>\u5185\u6838\u963b\u585e\uff1f</li> <li>\u7ebf\u7a0b\u662f\u5426\u957f\u65f6\u95f4\u5904\u4e8e<code>Runnable</code>\u72b6\u6001\u5f97\u4e0d\u5230\u6267\u884c\u800c\u5bfc\u81f4\u8fd0\u884c\u53d8\u6162\uff1f\u8fd9\u4e2a\u8981\u7ed3\u5408<code>CPU Trace</code>\u4fe1\u606f\u89c2\u5bdf\u5f53\u524d<code>CPU</code>\u4e0a\u4efb\u52a1\u7684\u5206\u5e03\uff0c\u662f\u5426\u6709<code>CPU</code>\u5173\u6838\u6216\u540e\u53f0\u5176\u5b83\u7ebf\u7a0b\u4efb\u52a1\u9891\u7e41\u62a2\u5360\u7684\u95ee\u9898\uff1f</li> <li>\u5982\u679c\u53ea\u662f\u7ebf\u7a0b<code>Running</code>\u65f6\u957f\u8fc7\u957f\u5bfc\u81f4\u8fd0\u884c\u53d8\u6162\uff0c\u6700\u7ec8\u51fa\u73b0\u4e0a\u5e27\u8d85\u65f6\u800c\u6389\u5e27\uff1f\u6211\u4eec\u5c31\u9700\u8981\u7ed3\u5408\u5177\u4f53<code>tag</code>\u4fe1\u606f\u67e5\u770b\u5230\u5e95\u5728\u6267\u884c\u4ec0\u4e48\u903b\u8f91\uff0c\u7136\u540e\u7ed3\u5408\u81ea\u8eab\u7684\u4ee3\u7801\u5b9e\u73b0\u770b\u662f\u5426\u53ef\u4ee5\u4f18\u5316\uff1f\u53c8\u6216\u8005\u662f\u770b\u770b\u5f53\u524d<code>JIT</code>\u7ebf\u7a0b\u4efb\u52a1\u662f\u5426\u7e41\u5fd9\uff0c\u4ee5\u5224\u65ad\u662f\u5426\u662f\u56e0\u4e3a\u5e94\u7528\u6ca1\u6709\u88ab\u53ca\u65f6\u7f16\u8bd1\u6210\u673a\u5668\u7801\u800c\u5bfc\u81f4\u8fd0\u884c\u65f6\u957f\u8fc7\u957f\uff1f</li> </ol> <p><code>Systrace</code>\u7684\u5206\u6790\u91cd\u7ecf\u9a8c\uff0c\u5728\u6df1\u5165\u7406\u89e3\u7cfb\u7edf\u8fd0\u884c\u7684\u57fa\u672c\u6d41\u7a0b\u548c\u539f\u7406\u7684\u57fa\u7840\u4e0a\uff0c\u65e0\u8bba\u662f\u7cfb\u7edf\u5f00\u53d1\u8005\u6216\u5e94\u7528\u5f00\u53d1\u8005\u90fd\u9700\u8981\u5728\u5e73\u65f6\u5de5\u4f5c\u4e2d\u4e0d\u65ad\u7ec3\u4e60\u4e0e\u79ef\u7d2f\uff0c\u624d\u80fd\u5728\u771f\u6b63\u9047\u5230\u95ee\u9898\u65f6\uff0c\u7528<code>Systrace</code>\u5de5\u5177\u53bb\u5206\u6790\u65f6\u505a\u5230\u6e38\u5203\u6709\u4f59\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#2-systrace","title":"2 Systrace\u5206\u6790\u6280\u5de7","text":"<p>\u4e0a\u4e00\u5c0f\u8282\u4e2d\u6211\u4eec\u8be6\u7ec6\u5206\u6790\u4ecb\u7ecd\u4e86<code>Systrace</code>\u4e0a\u663e\u793a\u7684\u5404\u4e3b\u8981\u4fe1\u606f\u533a\u57df\u5185\u5bb9\u7684\u9759\u6001\u6784\u6210\uff0c\u4f46\u662f\u6574\u4e2a\u7cfb\u7edf\u7684\u8fd0\u884c\u5f80\u5f80\u662f\u4e00\u4e2a\u52a8\u6001\u4e14\u76f8\u4e92\u5f71\u54cd\u7684\u8fc7\u7a0b\u3002\u5728\u5b9e\u9645\u4e0a\u624b\u4f7f\u7528<code>Systrace</code>\u5206\u6790\u6027\u80fd\u95ee\u9898\u4e4b\u524d\uff0c\u6211\u4eec\u8fd8\u6709\u4e00\u4e9b\u5b9e\u7528\u7684\u5206\u6790\u548c\u8c03\u8bd5\u7684\u6280\u5de7\u4e5f\u662f\u9700\u8981\u638c\u63e1\u7684\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#21","title":"2.1 \u7ebf\u7a0b\u8fd0\u884c\u6392\u7a0b\u72b6\u6001\u8f6c\u6362\u5206\u6790","text":"<p>\u6211\u4eec\u5148\u7528\u4e00\u5f20\u56fe\u6765\u603b\u4f53\u770b\u770b\u7ebf\u7a0b\u8fd0\u884c\u72b6\u6001\u7684\u53d8\u5316\u4ee5\u53ca\u5f15\u8d77\u53d8\u5316\u7684\u539f\u56e0\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff1a\u4e00\u4e2a\u7ebf\u7a0b\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u5230\u53d7\u5404\u79cd\u56e0\u7d20\u7684\u5f71\u54cd\u800c\u5728 <code>Running</code>\u3001<code>Sleeping</code>\u3001<code>Uninterruptible Sleep</code> \u548c <code>Runnable</code> \u56db\u4e2a\u72b6\u6001\u4e4b\u95f4\u4e0d\u65ad\u5207\u6362\u3002\u800c\u9664\u4e86<code>Running</code>\u72b6\u6001\u4e0b\u65f6\u7ebf\u7a0b\u5de5\u4f5c\u4efb\u52a1\u6709\u771f\u6b63\u8fd0\u884c\u5728<code>CPU</code>\u4e0a\u53bb\u6267\u884c\uff0c\u5176\u5b83\u51e0\u79cd\u72b6\u6001\u4e0b\u7ebf\u7a0b\u4efb\u52a1\u90fd\u65e0\u6cd5\u5f97\u5230\u6709\u6548\u7684\u6267\u884c\uff0c\u4ece\u800c\u53ef\u80fd\u4f1a\u5f15\u8d77\u4e00\u4e9b\u6027\u80fd\u76f8\u5173\u7684\u95ee\u9898\u3002\u6240\u4ee5\u6211\u4eec\u5f88\u591a\u65f6\u5019\u5728\u5206\u6790\u6027\u80fd\u95ee\u9898\uff0c\u90fd\u9700\u8981\u627e\u5230\u7ebf\u7a0b\u4efb\u52a1\u6ca1\u6709\u6301\u7eed\u5904\u4e8e<code>Running</code>\u72b6\u6001\u7684\u539f\u56e0\uff0c\u8fd8\u8981\u5224\u65ad\u5176\u5207\u6362\u5230\u5176\u5b83\u51e0\u79cd\u72b6\u6001\u7684\u539f\u56e0\u662f\u5426\u5408\u7406\u3002\u800c\u4ece<code>Systrace</code>\u4e0a\u6211\u4eec\u5c31\u53ef\u4ee5\u6e05\u6670\u7684\u89c2\u5bdf\u5230\u7ebf\u7a0b\u8fd0\u884c\u72b6\u6001\u7684\u53d8\u5316\u4ee5\u53ca\u5f15\u8d77\u72b6\u6001\u53d8\u5316\u7684\u539f\u56e0\u3002\u5404\u79cd\u7ebf\u7a0b\u8fd0\u884c\u72b6\u6001\u5207\u6362\u573a\u666f\u5982\u4e0b\u6240\u793a\uff1a</p>"},{"location":"perf-opt/Android/jank/jank-tool/#211-running-sleeping","title":"2.1.1 Running -&gt; Sleeping","text":"<p>\u5e38\u89c1\u4e8e\uff1a\u7ebf\u7a0b\u5de5\u4f5c\u7ed3\u675f\uff0c\u7ebf\u7a0b\u4f7f\u7528<code>Thread.sleep</code>\u5ef6\u65f6\uff0c\u7ebf\u7a0b\u88ab<code>Binder</code>\u670d\u52a1\u7aef\u963b\u585e\uff0c\u7ebf\u7a0b\u9677\u5165\u7b49\u9501\u963b\u585e\u72b6\u6001\u7b49\uff0c\u5177\u4f53\u539f\u56e0\u9700\u8981\u7ed3\u5408\u7ebf\u7a0b<code>Sleeping</code>\u7ed3\u675f\u540e\u7ebf\u7a0b\u88ab\u5524\u9192\u65f6\u7684\u4fe1\u606f\u5206\u6790\u5224\u65ad\u662f\u5426\u5408\u7406\uff0c\u540e\u6587\u4f1a\u8be6\u7ec6\u5206\u6790\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#212-sleeping-runnable","title":"2.1.2 Sleeping -&gt; Runnable","text":"<p>\u5904\u4e8e<code>Sleeping</code>\u72b6\u6001\u7684\u7ebf\u7a0b\u88ab\u5524\u9192\uff0c\u91cd\u65b0\u8fdb\u5165<code>Runnable</code>\u5f85\u6267\u884c\u72b6\u6001\uff0c<code>Systrace</code>\u4e0a\u4f1a\u663e\u793a\u51fa\u5524\u9192\u8be5\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u53f7\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#213-running-runnable-running","title":"2.1.3 Running-&gt;Runnable-&gt;Running","text":"<p>\u6b63\u5728\u6267\u884c\u7684\u7ebf\u7a0b\u4efb\u52a1\u88ab\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u7ebf\u7a0b\u4efb\u52a1\u4e34\u65f6\u62a2\u5360\uff0c<code>Systrace</code>\u4e0a\u53ef\u4ee5\u5b8c\u6574\u6e05\u6670\u7684\u770b\u5230\u53d1\u751f\u62a2\u5360\u7684\u539f\u56e0\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#214-running-uninterruptible-sleeping-runnable","title":"2.1.4 Running -&gt; Uninterruptible Sleeping -&gt; Runnable","text":"<p>\u6b63\u5728\u6267\u884c\u7684\u7ebf\u7a0b\u9677\u5165\u5185\u6838\u9501\u7b49\u5f85\u72b6\u6001\uff0c<code>Systrace</code>\u4e0a\u53ef\u4ee5\u770b\u5230\u88ab\u5185\u6838\u963b\u585e\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u901a\u8fc7<code>addr2line</code>\u5de5\u5177\u7ed3\u5408<code>symbol table</code>\u4fe1\u606f\u5c31\u53ef\u4ee5\u67e5\u5230\u4ea7\u751f\u95ee\u9898\u7684\u5185\u6838\u4ee3\u7801\u884c\u53f7\uff0c\u5e2e\u52a9\u8fdb\u4e00\u6b65\u5b9a\u4f4d\u95ee\u9898\u539f\u56e0\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#215-runnable-running","title":"2.1.5 Runnable -&gt; Running","text":"<p>\u4ece<code>Runnable</code> \u5230<code>Running</code>\u72b6\u6001\u7684\u5207\u6362\uff0c<code>Systrace</code>\u4e0a\u4f1a\u663e\u793a\u51fa\u5524\u9192\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u53f7\uff0c\u4ece\u800c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u6839\u636e\u8be5\u7ebf\u7d22\u5206\u6790\u7406\u6e05\u695a\u7ebf\u7a0b\u95f4\u7684\u76f8\u4e92\u7b49\u5f85\u5524\u9192\u5173\u7cfb\uff0c\u627e\u5230\u95ee\u9898\u7684\u6839\u672c\u539f\u56e0\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#22","title":"2.2 \u7ebf\u7a0b\u7b49\u5f85\u5524\u9192\u5173\u7cfb\u5206\u6790","text":"<p>\u6709\u4e86\u4e0a\u9762\u7684\u5206\u6790\u57fa\u7840\uff0c\u672c\u5c0f\u8282\u4e2d\u6211\u4eec\u8fd8\u662f\u4ee5\u684c\u9762\u6253\u5f00\u5e94\u7528\u51b7\u542f\u52a8\u7684\u573a\u666f\u4e3a\u4f8b\uff0c\u770b\u770b\u5982\u4f55\u901a\u8fc7<code>Systrace</code>\u6765\u5206\u6790\u89c2\u5bdf\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5524\u9192\u7b49\u5f85\u5173\u7cfb\uff0c\u4ece\u800c\u770b\u6e05\u5e94\u7528\u8fdb\u7a0b\u4e0e\u7cfb\u7edf\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e4b\u95f4\u662f\u5982\u4f55\u4ea4\u4e92\u7684\u3002\u53ea\u6709\u638c\u63e1\u4e86\u5982\u4f55\u7528<code>Systrace</code>\u5206\u6790\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5524\u9192\u7b49\u5f85\u5173\u7cfb\uff0c\u6211\u4eec\u624d\u80fd\u53bb\u8ffd\u8e2a\u5e76\u7406\u6e05\u7cfb\u7edf\u5185\u8dd1\u5728\u5404\u4e2a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u4e2d\u7684\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u4e4b\u95f4\u662f\u5982\u4f55\u76f8\u4e92\u4ea4\u4e92\u914d\u5408\u53bb\u5b8c\u6210\u4e00\u6b21\u7cfb\u7edf\u4e8b\u4ef6\u6d41\u7a0b\u7684\u5904\u7406\uff0c\u4e2a\u4eba\u7406\u89e3\u8fd9\u4e5f\u5c31\u662f\u4f7f\u7528<code>Systrace</code>\u5de5\u5177\u5206\u6790\u95ee\u9898\u7684\u7cbe\u9ad3\u6240\u5728\u3002</p> <p></p> <p>\u4ece\u684c\u9762\u5e94\u7528\u7684<code>UI</code>\u7ebf\u7a0b\u4ece<code>Sleeping</code>\u72b6\u6001\u5207\u6362\u5230<code>Runnable</code>\u72b6\u6001\u7684<code>Tag</code>\u4fe1\u606f\u4e2d\u53ef\u4ee5\u770b\u5230\u8be5\u7ebf\u7a0b\u662f\u88ab\u4e00\u4e2a<code>tid</code>\u4e3a<code>2796</code>\u7684\u7ebf\u7a0b\u6240\u5524\u9192\uff0c\u7136\u540e\u6211\u4eec\u5728<code>Systrace</code>\u754c\u9762\u53f3\u4e0a\u89d2\u7684\u641c\u7d22\u6846\u4e2d\u8f93\u5165 <code>2796</code>\u540e\uff0c\u641c\u7d22\u53d1\u73b0\u8be5\u7ebf\u7a0b\u7684\u8be6\u7ec6\u4fe1\u606f\u662f\u5c5e\u4e8e\u6846\u67b6<code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684\u540d\u4e3a<code>InputDispatcher</code>\u7684\u5de5\u4f5c\u7ebf\u7a0b\u3002\u7136\u540e\u6211\u4eec\u9009\u4e2d<code>UI</code>\u7ebf\u7a0b<code>Runnable</code>\u8fd9\u6bb5\u65f6\u95f4\u533a\u57df\uff0c\u5728<code>system_server</code>\u8fdb\u7a0b\u4fe1\u606f\u663e\u793a\u533a\u57df\u627e\u5230\u5176<code>2796</code>\u5b50\u7ebf\u7a0b\uff0c\u6839\u636e<code>Systrace</code> <code>TAG</code>\u53d1\u73b0\u5176\u4e2d\u6b63\u662f\u5728\u6267\u884c<code>InputDispatcher#dispatchMotionLocked</code> \u4e8b\u4ef6\u5206\u53d1\u7684\u903b\u8f91\u3002\u5230\u6b64\u6211\u4eec\u5c31\u7406\u6e05\u4e86\u8fd9\u6bb5Input\u89e6\u63a7\u4e8b\u4ef6\u7684\u4f20\u9012\u903b\u8f91\uff0c\u77e5\u9053<code>Input</code>\u89e6\u63a7\u4e8b\u4ef6\u662f\u7531<code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684\u540d\u4e3a<code>InputDispatcher</code>\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u5524\u9192\u76ee\u6807\u5e94\u7528\u7684\u4e3b\u7ebf\u7a0b\u8fdb\u884c\u5206\u53d1\u7684\uff0c\u8fd9\u4e5f\u548c\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u5173\u4e8eInput\u4e8b\u4ef6\u5904\u7406\u673a\u5236\u7684\u7406\u8bba\u5206\u6790\u662f\u76f8\u7b26\u7684\u3002</p> <p>\u7136\u540e\u684c\u9762\u5e94\u7528<code>UI</code>\u7ebf\u7a0b\u4e2d\u6839\u636e\u8fde\u7eed\u6536\u5230\u7684\u51e0\u6761\u7684<code>Input</code>\u4e8b\u4ef6\u5224\u65ad\u7528\u6237\u5728\u6267\u884c\u70b9\u51fb\u5e94\u7528\u56fe\u6807\u542f\u52a8\u5e94\u7528\u7684\u52a8\u4f5c\uff0c\u7136\u540e\u901a\u8fc7<code>Binder</code>\u8c03\u7528\u6846\u67b6\u7684<code>startActivity</code>\u63a5\u53e3\u5c1d\u8bd5\u53bb\u542f\u52a8\u5e94\u7528\uff0c\u4ece<code>Systrace</code>\u4e0a\u5206\u6790\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u7ebf\u7a0b<code>Runnable</code>\u72b6\u6001\u5207\u6362\u53ef\u4ee5\u770b\u5230\uff0c\u684c\u9762\u7684<code>UI</code>\u7ebf\u7a0b\uff08\u7ebf\u7a0b<code>tid</code>\u4e3a<code>4893</code>\uff09\u4e2d\u4f1a\u5148\u5524\u9192<code>system_server</code>\u8fdb\u7a0b\u4e2d\u7684\u8d1f\u8d23\u5904\u7406\u5e94\u7528<code>Binder</code>\u8bf7\u6c42\u7684<code>Binder:2323_1C</code>\uff08<code>tid</code>\u4e3a<code>8289</code>\uff09\u7ebf\u7a0b\uff0c\u7136\u540e\u8fdb\u5165<code>Sleeping</code>\u72b6\u6001\uff0c\u7136\u540e<code>Binder:2323_1C</code>\u7ebf\u7a0b\u4e2d\u6267\u884c\u5b8c<code>startActivity</code>\u5177\u4f53\u5185\u90e8\u903b\u8f91\u540e\uff0c\u4f1a\u5524\u9192\u684c\u9762\u7684<code>UI</code>\u7ebf\u7a0b\u3002\u8fd9\u5c31\u662f\u4e00\u6b21\u4ece<code>Systarce</code>\u4e0a\u770b\u5230\u7684\u5e94\u7528<code>Binder</code>\u963b\u585e\u8c03\u7528\u8bbf\u95ee\u6846\u67b6\u670d\u52a1\u63a5\u53e3\u7684\u7ebf\u7a0b\u76f8\u4e92\u7b49\u5f85\u5524\u9192\u7684\u8fc7\u7a0b\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#23-systrace-tag","title":"2.3 \u6dfb\u52a0\u81ea\u5b9a\u4e49Systrace tag","text":"<p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\u53ef\u4ee5\u770b\u5230\uff0c\u8c37\u6b4c\u539f\u751f\u5728<code>Android</code>\u7cfb\u7edf\u7684\u5f88\u591a\u7cfb\u7edf\u5173\u952e\u6d41\u7a0b\u4e0a\u90fd\u6dfb\u52a0\u4e86\u76f8\u5173\u7684<code>Systrace tag</code>\uff0c\u4ee5\u89c2\u5bdf\u8fd9\u4e9b\u6d41\u7a0b\u6267\u884c\u7684\u8017\u65f6\u60c5\u51b5\u3002\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u8986\u76d6\u7684\u8303\u56f4\u6bd5\u7adf\u662f\u6709\u9650\u7684\uff0c\u6709\u65f6\u5019\u5e76\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u5206\u6790\u9700\u6c42\u3002\u6bd4\u5982\u6211\u4eec\u5f00\u53d1\u8005\u60f3\u89c2\u5bdf\u81ea\u5df1\u7684\u4e00\u4e9b\u4ee3\u7801\u903b\u8f91\u6267\u884c\u7684\u8017\u65f6\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e9b<code>Systrace tag</code>\u53bb\u5ea6\u91cf\uff0c\u8fd9\u4e2a<code>Systrace</code>\u673a\u5236\u672c\u8eab\u662f\u652f\u6301\u7684\u3002\u5982\u4f55\u5728\u4ee3\u7801\u4e2d\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684<code>Systrace tag</code>\u4fe1\u606f\u5462\uff1f\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd\u573a\u666f\uff1a</p>"},{"location":"perf-opt/Android/jank/jank-tool/#231-appjavasystrace-tag","title":"2.3.1 \u5728APP\u5e94\u7528Java\u4ee3\u7801\u4e2d\u6dfb\u52a0Systrace tag","text":"<p>\u5728 <code>Android 4.3</code>\uff08<code>API</code> \u7ea7\u522b <code>18</code>\uff09\u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528 <code>android.os.Trace</code>\u7c7b\u6765\u5b9a\u4e49\u968f\u540e\u4f1a\u51fa\u73b0\u5728 <code>Perfetto</code> \u548c <code>Systrace</code> \u62a5\u544a\u4e2d\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u5982\u4ee5\u4e0b\u8c37\u6b4c\u5b98\u65b9\u4ee3\u7801\u6bb5\u6240\u793a\uff1a</p> <pre><code>    public class MyAdapter extends RecyclerView.Adapter&lt;MyViewHolder&gt; {\n@Override\npublic MyViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {\nTrace.beginSection(\"MyAdapter.onCreateViewHolder\");// 1.\u6807\u8bc6\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u5f00\u59cb\uff0ctitle\u5185\u5bb9\u53ef\u4ee5\u81ea\u5b9a\u4e49\nMyViewHolder myViewHolder;\ntry {\nmyViewHolder = MyViewHolder.newInstance(parent);\n} finally {\n// In try and catch statements, always call \"endSection()\" in a\n// \"finally\" block. That way, the method is invoked even when an\n// exception occurs.\nTrace.endSection(); // 2.\u6807\u8bc6\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u7ed3\u675f\n}\nreturn myViewHolder;\n}\n@Override\npublic void onBindViewHolder(MyViewHolder holder, int position) {\n// \u5d4c\u5957\u8c03\u7528\u4ee3\u7801\u793a\u4f8b\nTrace.beginSection(\"MyAdapter.onBindViewHolder\");\ntry {\ntry {\nTrace.beginSection(\"MyAdapter.queryDatabase\");\nRowItem rowItem = queryDatabase(position);\ndataset.add(rowItem);\n} finally {\nTrace.endSection();\n}\nholder.bind(dataset.get(position));\n} finally {\nTrace.endSection();\n}\n}\n}\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u5728\u4f7f\u7528<code>python</code>\u811a\u672c\u6293\u53d6<code>Systrace</code>\u65f6\u5fc5\u987b\u63d0\u4f9b <code>-a</code> \u9009\u9879\u624d\u80fd\u8ddf\u8e2a\u5e94\u7528\uff1b\u5982\u679c\u6ca1\u6709\u6b64\u9009\u9879\uff0c\u5e94\u7528\u7684\u65b9\u6cd5\u5c06\u4e0d\u4f1a\u663e\u793a\u5728 <code>Systrace</code> \u62a5\u544a\u4e2d\u3002\u5982\u4e0b\u547d\u4ee4\u793a\u4f8b\u6240\u793a\uff1a</li> </ul> <pre><code>  python systrace.py -a com.example.myapp -b 16384 \\\n-o my_systrace_report.html sched freq idle am wm gfx view binder_driver hal \\\ndalvik camera input res\n</code></pre> <p></p> <ul> <li><code>endSection()</code>\u5efa\u8bae\u5305\u88f9\u5728<code>finally</code>\u4ee3\u7801\u5757\u4e2d\uff0c\u4ee5\u4fdd\u8bc1\u4e2d\u95f4\u4ee3\u7801\u51fa\u73b0\u5f02\u5e38\u60c5\u51b5\u4e0b\u90fd\u80fd\u591f\u7ed3\u675f\u4e8b\u4ef6\uff1b\u53e6\u5916\u5982\u679c\u60a8\u591a\u6b21\u8c03\u7528 <code>beginSection()</code>\uff0c\u8c03\u7528 <code>endSection()</code> \u53ea\u4f1a\u7ed3\u675f\u6700\u540e\u8c03\u7528\u7684 <code>beginSection()</code> \u65b9\u6cd5\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u5d4c\u5957\u8c03\u7528\uff08\u5982\u4ee5\u4e0a\u5b98\u65b9\u4ee3\u7801\u6bb5\u4e2d\u6240\u793a\uff09\uff0c\u8bf7\u52a1\u5fc5\u5c06\u6bcf\u6b21\u5bf9 <code>beginSection()</code> \u7684\u8c03\u7528\u4e0e\u4e00\u6b21\u5bf9 <code>endSection()</code> \u7684\u8c03\u7528\u6b63\u786e\u5339\u914d\u3002\u5426\u5219\u6293\u53d6\u51fa\u6765\u7684<code>Systrace</code>\u4f1a\u51fa\u73b0<code>Did Not Finish</code>\u7684\u663e\u793a\u5f02\u5e38\uff0c\u5f71\u54cd\u7ed3\u679c\u5206\u6790\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ul> <p></p> <ul> <li>\u4e0d\u80fd\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u8c03\u7528 <code>beginSection()</code>\uff0c\u800c\u5728\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u7ed3\u675f\u5b83\uff1b\u60a8\u5fc5\u987b\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u8c03\u7528\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u3002\u5982\u679c\u5c31\u6709\u9700\u8981\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u5f00\u59cb\u548c\u7ed3\u675f\u4e00\u4e2a\u65b9\u6cd5\u7684\u8ffd\u8e2a\uff0c\u8bf7\u4f7f\u7528<code>Trace.beginAsyncSection()</code>\u548c<code>Trace.endAsyncSection()</code>\u3002</li> </ul>"},{"location":"perf-opt/Android/jank/jank-tool/#232-appnativesystrace-tag","title":"2.3.2 \u5728APP\u5e94\u7528Native\u4ee3\u7801\u4e2d\u6dfb\u52a0Systrace tag","text":"<p><code>Android 6.0</code>\uff08<code>API</code> \u7ea7\u522b <code>23</code>\uff09\u53ca\u66f4\u9ad8\u7248\u672c\u652f\u6301\u539f\u751f\u8ddf\u8e2a <code>API</code> <code>trace.h</code>\uff0c\u7528\u4e8e\u5c06\u8ddf\u8e2a\u4e8b\u4ef6\u5199\u5165\u7cfb\u7edf\u7f13\u51b2\u533a\uff0c\u4ee5\u4f9b\u60a8\u968f\u540e\u4f7f\u7528 <code>Perfetto</code> \u6216 <code>Systrace</code> \u8fdb\u884c\u5206\u6790\u3002\u6b64 <code>API</code> \u7684\u5e38\u89c1\u7528\u4f8b\u5305\u62ec\u89c2\u5bdf\u7279\u5b9a\u4ee3\u7801\u5757\u7684\u6267\u884c\u65f6\u95f4\u4ee5\u53ca\u786e\u5b9a\u5f15\u8d77\u4e0d\u826f\u7cfb\u7edf\u884c\u4e3a\u7684\u4ee3\u7801\u5757\u3002 \u5728\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u7684\u5f00\u5934\u548c\u7ed3\u5c3e\u5206\u522b\u8c03\u7528 <code>ATrace_beginSection()</code> \u548c <code>ATrace_endSection()</code>\uff0c\u770b\u770b\u8c37\u6b4c\u5b98\u65b9\u7ed9\u51fa\u7684\u7528\u6cd5\u793a\u4f8b\uff1a</p> <pre><code> #include &lt;android/trace.h&gt;\nchar *customEventName = new char[32];\nsprintf(customEventName, \"User tapped %s button\", buttonName);\nATrace_beginSection(customEventName);\n// Your app or game's response to the button being pressed.\nATrace_endSection();\n</code></pre> <p>\u6ce8\u610f\u4f7f\u7528<code>pthread_setname_np</code>\u51fd\u6570\u4e3a\u81ea\u5df1\u7684\u5de5\u4f5c\u7ebf\u7a0b\u547d\u540d\uff0c\u4ee5\u4fbf\u8ba9<code>Systrace</code>\u80fd\u8bc6\u522b\u5e76\u663e\u793a\u51fa\u6765\u3002\u8be6\u7ec6\u4f7f\u7528\u89c4\u5219\u8bf7\u53c2\u89c1<code>Android</code>\u5b98\u65b9\u6587\u6863\uff1ahttps://developer.android.google.cn/topic/performance/tracing/custom-events</p>"},{"location":"perf-opt/Android/jank/jank-tool/#233-frameworkjavasystrace-tag","title":"2.3.3 \u5728Framework\u7684Java\u4ee3\u7801\u4e2d\u6dfb\u52a0Systrace tag","text":"<p>\u5728<code>Framework</code>\u7684<code>Java</code>\u5c42\u4ee3\u7801\u91cc\u9762\u6dfb\u52a0<code>Systrace</code>\u8ddf\u8e2a\u65b9\u5f0f\uff1a</p> <pre><code> import android.os.Trace;\n...\nTrace.traceBegin(Trace.TRACE_TAG_VIEW, \u201cperformTraversals\u201d);// \u5b57\u7b26\u4e32\u53ef\u4ee5\u81ea\u5b9a\u4e49 \n// \u81ea\u5df1\u7684\u4ee3\u7801\u5b9e\u73b0\u903b\u8f91\nfinally {\nTrace.traceEnd(Trace.TRACE_TAG_VIEW);\n}\n</code></pre> <p><code>TRACE_TAG_VIEW</code>\u7684\u5b9a\u4e49\u89c1<code>android.os.Trace.java</code>\uff0c\u8fd9\u4e2a\u4e0e<code>Systrace</code>\u7684\u811a\u672c\u7684\u53c2\u6570\u662f\u5bf9\u5e94\u7684\uff0c\u6211\u4eec\u4f7f\u7528<code>python</code>\u811a\u672c\u6293<code>Systrace</code>\u65f6\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u662f\u5426\u6293\u53d6\u663e\u793a\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-tool/#234-frameworknativesystrace-tag","title":"2.3.4 \u5728Framework\u7684Native\u4ee3\u7801\u4e2d\u6dfb\u52a0Systrace tag","text":"<p>\u5728<code>Framework</code>\u7684<code>Native</code>\u5c42\u4ee3\u7801\u91cc\u9762\u6dfb\u52a0<code>Systrace</code>\u8ddf\u8e2a\u65b9\u5f0f\uff1a</p> <ul> <li>\u8ddf\u8e2a\u6574\u4e2a\u51fd\u6570\uff1a\u5728\u68c0\u6d4b\u8c03\u7528\u5806\u6808\u6216\u51fd\u6570\u8ba1\u65f6\u65f6\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u8ddf\u8e2a\u6574\u4e2a\u51fd\u6570\u975e\u5e38\u6709\u7528\u3002\u4f7f\u7528 <code>ATRACE_CALL()</code> \u6216<code>ATRACE_NAME()</code>\u5b8f\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u8bbe\u7f6e\u6b64\u7c7b\u8ddf\u8e2a\u3002\u76f8\u5173\u7528\u6cd5\u7b80\u5316\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</li> </ul> <pre><code>#define ATRACE_TAG ATRACE_TAG_ALWAYS // \u8868\u793a\u4e00\u76f4\u4f1a\u6253\u5f00\uff0c\u5982\u679c\u662fATRACE_TAG_GRAPHICS\uff0c\u5219\u9700\u8981\u5728\u4f7f\u7528\u811a\u672c\u6293systrace\u65f6\u53c2\u6570\u52a0\u4e0agfx\u624d\u80fd\u770b\u5230\n#include &lt;utils/Trace.h&gt;\nvoid myExpensiveFunction() {\nATRACE_CALL(); // or ATRACE_NAME(\u201cmyExpensiveFunction\u201d);\n// \u60f3\u8981\u8ddf\u8e2a\u7684\u4ee3\u7801\u903b\u8f91\n}\n</code></pre> <p>\u53e6\u5916\u6a21\u5757\u7684\u7f16\u8bd1\u63a7\u5236\u811a\u672c<code>.bp</code>\u6216<code>.mk</code>\u6587\u4ef6\u4e2d\u6ce8\u610f\u6dfb\u52a0\u5f15\u7528<code>libutils</code>\u5e93\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ul> <li>\u8ddf\u8e2a\u51fd\u6570\u4e2d\u7684\u90e8\u5206\u903b\u8f91\uff1a</li> </ul> <p>\u76f8\u5173\u7528\u6cd5\u7b80\u5316\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>#define ATRACE_TAG ATRACE_TAG_ALWAYS // \u8868\u793a\u4e00\u76f4\u4f1a\u6253\u5f00\uff0c\u5982\u679c\u662fATRACE_TAG_GRAPHICS\uff0c\u5219\u9700\u8981\u5728\u4f7f\u7528\u811a\u672c\u6293systrace\u65f6\u53c2\u6570\u52a0\u4e0agfx\u624d\u80fd\u770b\u5230\n#include &lt;cutils/trace.h&gt;\nvoid myExpensiveFunction() {\nATRACE_BEGIN(\u201cTEST\u201d); // \u5b57\u7b26\u4e32\u53ef\u4ee5\u81ea\u5b9a\u4e49\n// \u60f3\u8981\u8ddf\u8e2a\u7684\u4ee3\u7801\u903b\u8f91\nATRACE_END();\n}\n</code></pre> <p>\u53e6\u5916\u6a21\u5757\u7684\u7f16\u8bd1\u63a7\u5236\u811a\u672c<code>.bp</code>\u6216<code>.mk</code>\u6587\u4ef6\u4e2d\u6ce8\u610f\u6dfb\u52a0\u5f15\u7528<code>libcutils</code>\u5e93\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-tool/#3-systrace","title":"3 Systrace\u539f\u7406\u7b80\u4ecb","text":"<p>\u672c\u7740\u77e5\u5176\u7136\u3001\u77e5\u5176\u6240\u4ee5\u7136\u7684\u6001\u5ea6\uff0c\u672c\u5c0f\u8282\u4e2d\u6211\u4eec\u6765\u7b80\u5355\u5206\u6790\u4e00\u4e0b\u7cfb\u7edf<code>Systrace</code>\u673a\u5236\u7684\u539f\u7406\uff0c\u770b\u770b\u4e00\u4efd<code>Systrace</code>\u6587\u4ef6\u5230\u5e95\u662f\u600e\u4e48\u751f\u6210\u7684\uff1f\u6211\u4eec\u77e5\u9053<code>Android</code>\u7cfb\u7edf\u5e95\u5c42\u662f\u57fa\u4e8e<code>Linux</code>\u5185\u6838\u7684\uff0c\u6240\u4ee5<code>Systrace</code>\u673a\u5236\u7684\u5b9e\u73b0\u5176\u5b9e\u4e5f\u662f\u57fa\u4e8e<code>Linux</code>\u5185\u6838\u8c03\u8bd5\u5668<code>ftrace</code>\u7684\u3002 \u4e0b\u9762\u6211\u4eec\u4ece<code>ftrace</code>\u673a\u5236\u5f00\u59cb\u5165\u624b\u5206\u6790\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#31-linuxftrace","title":"3.1 Linux\u5185\u6838\u8c03\u8bd5\u5668\u4e4bftrace\u673a\u5236","text":"<p><code>ftrace</code>\uff0c\u5168\u79f0<code>function tracer</code>\uff0c\u7528\u4e8e\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u4e86\u89e3 <code>Linux</code> \u5185\u6838\u7684\u8fd0\u884c\u65f6\u884c\u4e3a\uff0c\u4ee5\u4fbf\u8fdb\u884c\u6545\u969c\u8c03\u8bd5\u6216\u6027\u80fd\u5206\u6790\u3002\u6700\u65e9 <code>ftrace</code> \u4ec5\u80fd\u591f\u8bb0\u5f55\u5185\u6838\u7684\u51fd\u6570\u8c03\u7528\u6d41\u7a0b\uff0c\u5982\u4eca <code>ftrace</code> \u5df2\u7ecf\u6210\u4e3a\u4e00\u4e2a <code>framework</code>\uff0c\u91c7\u7528 <code>plugin</code> \u7684\u65b9\u5f0f\u652f\u6301\u5f00\u53d1\u4eba\u5458\u6dfb\u52a0\u66f4\u591a\u79cd\u7c7b\u7684 <code>trace</code> \u529f\u80fd\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#311-androidftrace","title":"3.1.1 Android\u7cfb\u7edf\u4e0a\u662f\u5982\u4f55\u5f00\u542f\u5e76\u4f7f\u7528ftrace\u7684","text":"<ul> <li>\u5728\u7f16\u8bd1<code>linux</code>\u5185\u6838\u65f6\uff0c\u9700\u8981\u589e\u52a0\u5bf9<code>ftrace</code>\u652f\u6301\u7684\u76f8\u5173\u914d\u7f6e\u9009\u9879\u3002\u6211\u4eec\u62ff\u624b\u5934\u7684\u4e00\u53f0\u624b\u673a\uff0c<code>adb shell</code>\u8fdb\u53bb\u770b\u770b<code>proc/config.gz</code>\u4e0b\u5173\u4e8e<code>linux</code>\u5185\u6838\u7f16\u8bd1\u7684\u76f8\u5173\u914d\u7f6e\u9879\uff1a</li> </ul> <pre><code>/*proc/config.gz*/\n...\nCONFIG_FTRACE=y\nCONFIG_NOP_TRACER=y\nCONFIG_HAVE_FUNCTION_TRACER=y\nCONFIG_HAVE_FUNCTION_GRAPH_TRACER=y\n# CONFIG_FUNCTION_TRACER is not set // \u53d1\u8d27\u7248\u672c\u4e0a\u4e00\u822c\u9ed8\u8ba4\u5173\u95ed\uff0c\u4ee5\u514d\u5f71\u54cd\u6574\u673a\u6027\u80fd\n...\n</code></pre> <ul> <li>\u7cfb\u7edf\u5f00\u673a\u542f\u52a8\u65f6\u6302\u8f7d <code>tracefs</code> \u6587\u4ef6\u3002\u6211\u4eec\u6765\u770b\u770b<code>init.rc</code>\u6587\u4ef6\u4e2d\u7684\u76f8\u5173\u5b9a\u4e49\uff1a</li> </ul> <pre><code>/*system/core/rootdir/init.rc*/\non early-init\n...\n# Mount tracefs\nmount tracefs tracefs /sys/kernel/tracing //1.\u6302\u8f7dtracefs\u6587\u4ef6\u5230/sys/kernel/tracing\n...\non late-fs\n# Ensure that tracefs has the correct permissions.\n# This does not work correctly if it is called in post-fs.\nchmod 0755 /sys/kernel/tracing\nchmod 0755 /sys/kernel/debug/tracing // 2.\u4fee\u6539\u8282\u70b9\u8bfb\u5199\u6743\u9650\n...\n</code></pre> <p>\u66f4\u591a<code>tracing</code>\u5b50\u8282\u70b9\u7684\u521d\u59cb\u5316\u5728<code>atrace.rc</code>\u6587\u4ef6\u4e2d\u5b9a\u4e49\uff0c\u6211\u4eec\u6311\u91cd\u70b9\u6765\u770b\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/*frameworks/native/cmds/atrace/atrace.rc*/\n...\non late-init\n# Allow writing to the kernel trace log.\n    chmod 0222 /sys/kernel/debug/tracing/trace_marker // \u914d\u7f6etrace_marker\u8282\u70b9\u8bfb\u5199\u6743\u9650\n    chmod 0222 /sys/kernel/tracing/trace_marker \n...\n# Grant unix world read/write permissions to kernel tracepoints.\n# Access control to these files is now entirely in selinux policy.\n    chmod 0666 /sys/kernel/debug/tracing/trace_clock\n    chmod 0666 /sys/kernel/tracing/trace_clock\n    chmod 0666 /sys/kernel/debug/tracing/buffer_size_kb\n    chmod 0666 /sys/kernel/tracing/buffer_size_kb\n    chmod 0666 /sys/kernel/debug/tracing/options/overwrite\n    chmod 0666 /sys/kernel/tracing/options/overwrite\n    chmod 0666 /sys/kernel/debug/tracing/options/print-tgid\n    chmod 0666 /sys/kernel/tracing/options/print-tgid\n    chmod 0666 /sys/kernel/debug/tracing/options/record-tgid\n    chmod 0666 /sys/kernel/tracing/options/record-tgid\n    chmod 0666 /sys/kernel/debug/tracing/saved_cmdlines_size\n    chmod 0666 /sys/kernel/tracing/saved_cmdlines_size\n....\n# Tracing disabled by default\n    write /sys/kernel/debug/tracing/tracing_on 0 //\u5f00\u673a\u9ed8\u8ba4\u662f\u5173\u95edtracing\u7684\n    write /sys/kernel/tracing/tracing_on 0\n...\non property:persist.debug.atrace.boottrace=1 // \u901a\u8fc7property\u503c\u914d\u7f6e\uff0c\u52a8\u6001\u63a7\u5236\u542f\u52a8atrace\u670d\u52a1\uff0c\u5b9e\u73b0\u6293\u53d6\u5f00\u673a\u9636\u6bb5\u7684systrace\uff08\u53ef\u7528\u4e8e\u5206\u6790\u5f00\u673a\u65f6\u957f\u95ee\u9898\uff09\n    start boottrace\n# Run atrace with the categories written in a file\nservice boottrace /system/bin/atrace --async_start -f /data/misc/boottrace/categories\n    disabled\n    oneshot\n</code></pre> <ul> <li>\u7ecf\u8fc7\u4e0a\u9762\u4e24\u6b65\u540e\uff0c\u5728\u8bbe\u5907\u7684<code>/sys/kernel/debug/tracing</code> \u4e0b\u5c31\u6709\u5404\u79cd\u8ddf\u8e2a\u5668\uff08<code>tracer</code>\uff09\u548c\u4e8b\u4ef6\uff08<code>event</code>\uff09\uff0c\u76f8\u5173\u8282\u70b9\u7684\u529f\u80fd\u5206\u6790\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ul> <p></p> <ul> <li>\u6700\u540e\u6211\u4eec\u770b\u770b\u5982\u4f55\u7528<code>adb</code>\u547d\u4ee4\u5f00\u542f\u4f7f\u7528<code>ftrace</code>\u8ddf\u8e2a<code>kernel event</code>\u4e8b\u4ef6\uff0c\u76f8\u5173\u64cd\u4f5c\u547d\u4ee4\u5982\u4e0b\uff1a <pre><code>  \u4e00\u3001\u5207\u6362\u5230trace\u76ee\u5f55\uff1a\nadb shell\n#cd sys/kernel/debug/tracing/\n\u4e8c\u3001\u5173\u95edftrace:\n#echo 0 &gt;tracing_on\n\u4e09\u3001\u6e05\u7a7aftrace\u5185\u5bb9\uff1a\n#echo &gt;trace\n\u56db\u3001\u5f00\u542f\u9700\u8981ftrace\u8ffd\u8e2a\u7684kernel event\u4e8b\u4ef6\uff1a\n#echo 1 &gt;events/power/enable\n\u4e94\u3001\u5f00\u542fftrace:\n#echo 1 &gt;tracing_on  \u516d\u3001\u7528\u6237\u64cd\u4f5c\u624b\u673a\u8bbe\u5907\n\u4e03\u3001\u5173\u95edftrace\n#echo 0 &gt;tracing_on\n\u516b\u3001\u5bfc\u51fa\u64cd\u4f5c\u8fc7\u7a0b\u7684ftrace\n#cat trace\nftrace\u8ddf\u8e2a\u5230\u7684trace\u6587\u4ef6\u683c\u5f0f\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a  # tracer: nop\n#\n# entries-in-buffer/entries-written: 176698/383721   #P:8\n#\n#                                _-----=&gt; irqs-off\n#                               / _----=&gt; need-resched\n#                              | / _---=&gt; hardirq/softirq\n#                              || / _--=&gt; preempt-depth\n#                              ||| /     delay\n#           TASK-PID     CPU#  ||||   TIMESTAMP  FUNCTION\n#              | |         |   ||||      |         |\n&lt;idle&gt;-0       [007] d.h2   588.866977: sched_get_task_cpu_cycles: cpu=7 event=5 cycles=2448000000 exec_time=938 freq=2609808 legacy_freq=843600 max_freq=2841600 task=0 (swapper/7)\n&lt;idle&gt;-0       [007] ...1   588.866979: cpu_idle: state=4294967295 cpu_id=7\n&lt;idle&gt;-0       [007] d..1   588.866989: cpu_idle: state=1 cpu_id=7\n&lt;idle&gt;-0       [007] .N.1   592.944497: cpu_idle: state=4294967295 cpu_id=7\n...\n</code></pre></li> </ul>"},{"location":"perf-opt/Android/jank/jank-tool/#312-ftrace","title":"3.1.2 ftrace\u5de5\u5177\u5305\u542b\u7684\u529f\u80fd\u4ecb\u7ecd","text":"<ul> <li><code>function trace</code>\u529f\u80fd\u5b9e\u73b0\uff1a</li> </ul> <p><code>funtion trace</code>\u5c31\u662f\u53ef\u4ee5\u8ddf\u8e2a\u51fd\u6570\u8c03\u7528\u6d41\u7a0b\uff08\u76ee\u524d<code>Android</code>\u53d1\u8d27\u7248\u672c\u51fa\u4e8e\u6027\u80fd\u8003\u91cf\uff0c\u9ed8\u8ba4<code>available_tracers</code>\u90fd\u53ea\u652f\u6301<code>nop</code>\u8ffd\u8e2a\u5668\uff0c\u5982\u679c\u9700\u8981\u5f00\u542f<code>function</code>\u8ddf\u8e2a\u5668\uff0c\u9700\u8981\u4fee\u6539<code>kernel config</code>\u7f16\u8bd1\u914d\u7f6e\uff0c\u5f00\u542f<code>CONFIG_FUNCTION_TRACER</code>\u7b49\u914d\u7f6e\uff0c\u7136\u540e\u5355\u72ec\u7f16\u8bd1\u7248\u672c\u8fdb\u884c\u8c03\u8bd5\uff09\uff0c\u6bd4\u5982\u7c7b\u4f3c\u4e0b\u9762\u7684\u8ddf\u8e2a\u8f93\u51fa\uff1a</p> <pre><code># tracer: function\n#\n#                              _-----=&gt; irqs-off\n#                             / _----=&gt; need-resched\n#                            | / _---=&gt; hardirq/softirq\n#                            || / _--=&gt; preempt-depth\n#                            ||| /     delay\n#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION\n#              | |       |   ||||       |         |\nbash-29409 [002] .... 16158426.215771: mutex_unlock &lt;-tracing_set_tracer\n          &lt;idle&gt;-0     [039] d... 16158426.215771: call_cpuidle &lt;-do_idle\n          &lt;idle&gt;-0     [039] d... 16158426.215772: cpuidle_enter &lt;-call_cpuidle\n          &lt;idle&gt;-0     [039] d... 16158426.215773: cpuidle_enter_state &lt;-cpuidle_enter\n            bash-29409 [002] .... 16158426.215773: __fsnotify_parent &lt;-vfs_write\n          &lt;idle&gt;-0     [039] d... 16158426.215773: sched_idle_set_state &lt;-cpuidle_enter_state\n</code></pre> <p><code>funtion trace</code>\u7684\u5b9e\u73b0\u662f\u91c7\u7528 <code>gcc</code> \u7f16\u8bd1\u5668\u7684 <code>profile</code> \u7279\u6027\u5728\u6240\u6709\u5185\u6838\u51fd\u6570\u7684\u5f00\u59cb\u90e8\u5206\u52a0\u5165\u4e00\u6bb5 <code>stub</code> \u4ee3\u7801\uff0c<code>ftrace</code> \u91cd\u8f7d\u8fd9\u6bb5\u4ee3\u7801\u6765\u5b9e\u73b0 <code>trace</code> \u529f\u80fd\uff08\u672c\u8d28\u4e0a<code>funtion trace</code>\u5c31\u662f\u4e00\u79cd\u9759\u6001\u4ee3\u7801\u63d2\u6869\u7684\u601d\u60f3\u7684\u5e94\u7528\uff09\u3002</p> <p>\u6bd4\u5982\u7f16\u8bd1\u4e0b\u9762\u7684test.c\u6587\u4ef6\uff1a</p> <pre><code>//test.c\nvoid foo(void)\n{\nprintf(\"foo\");\n}\n</code></pre> <p><code>gcc</code> \u7684 <code>-pg</code> \u9009\u9879\u5c06\u5728\u6bcf\u4e2a\u51fd\u6570\u5165\u53e3\u5904\u52a0\u5165\u5bf9 <code>mcount</code> \u7684\u8c03\u7528\u4ee3\u7801\uff0c\u4e0b\u56fe\u4e2d\u5bf9\u6bd4\u5c55\u793a\u4e86\u6dfb\u52a0<code>-pg</code>\u548c\u4e0d\u6dfb\u52a0<code>-pg</code>\u7f16\u8bd1\u9009\u9879\u7684\u533a\u522b\uff1a</p> <p></p> <p>\u589e\u52a0 <code>pg</code> \u9009\u9879\u540e\uff0c<code>gcc</code> \u5728\u51fd\u6570 <code>foo</code> \u7684\u5165\u53e3\u5904\u52a0\u5165\u4e86\u5bf9 <code>mcount</code> \u7684\u8c03\u7528\uff1a<code>call _mcount</code> \u3002\u539f\u672c <code>mcount</code> \u7531<code>libc</code> \u5b9e\u73b0\uff0c\u4f46\u5185\u6838\u4e0d\u4f1a\u8fde\u63a5 <code>libc</code> \u5e93\uff0c\u56e0\u6b64 <code>ftrace</code> \u7f16\u5199\u4e86\u81ea\u5df1\u7684 <code>mcount stub</code> \u51fd\u6570\uff0c\u5e76\u501f\u6b64\u5b9e\u73b0 <code>trace</code>\u529f\u80fd\u3002</p> <ul> <li><code>trace event</code>\u529f\u80fd\u5b9e\u73b0\uff1a</li> </ul> <p>\u6211\u4eec\u4ee5<code>sched_switch</code>\u8fd9\u4e2a<code>event</code>\u4e3a\u4f8b\u8bf4\u660e\u4e00\u4e0b\uff0c\u5185\u6838\u6e90\u7801\u7684\u5b9e\u73b0\u5982\u4e0b\uff08\u672c\u8d28\u4e0a<code>trace event</code>\u57fa\u4e8e\u5185\u6838\u5173\u952e\u6d41\u7a0b\u4e0a\u7684\u57cb\u70b9\u5b9e\u73b0\uff0c\u76f8\u5173\u8ddf\u8e2a\u4fe1\u606f\u4f1a\u5148\u5199\u5230\u4e00\u5757\u5185\u5b58<code>buffer</code>\u7f13\u5b58\u4e2d\uff0c\u5728\u505c\u6b62<code>ftrace</code>\u8ddf\u8e2a\u65f6\u518d\u4ece<code>buffer</code>\u7f13\u5b58\u4e2d\u540c\u4e00\u8bfb\u53d6\u5199\u5165\u5230<code>trace</code>\u6587\u4ef6\u8282\u70b9\u4e2d\uff09\uff1a</p> <pre><code>/*kernel/msm-5.4/kernel/sched/core.c*/\nstatic void __sched notrace __schedule(bool preempt){\nstruct task_struct *prev, *next;\nunsigned long *switch_count;\n//......\n++*switch_count;\ntrace_sched_switch(preempt, prev, next);\nrq = context_switch(rq, prev, next, &amp;rf);\n//......\n}\n</code></pre> <p>\u6211\u4eec\u7528<code>Notepad++</code>\u4ee5\u6587\u672c\u7684\u5f62\u5f0f\u6253\u5f00\u4efb\u610f\u4e00\u4efd<code>Systarce.html</code>\u6587\u4ef6\uff0c\u5176\u4e2d\u5173\u4e8e<code>trace</code>\u5f00\u5934\u7684\u4e00\u90e8\u5206\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code># tracer: nop\n#\n# entries-in-buffer/entries-written: 1259321/1259321   #P:8\n#\n#                                _-----=&gt; irqs-off\n#                               / _----=&gt; need-resched\n#                              | / _---=&gt; hardirq/softirq\n#                              || / _--=&gt; preempt-depth\n#                              ||| /     delay\n#           TASK-PID     CPU#  ||||   TIMESTAMP  FUNCTION\n#              | |         |   ||||      |         |\n          &lt;idle&gt;-0       [000] dn.1    56.916920: ipi_entry: (Rescheduling interrupts)\n          &lt;idle&gt;-0       [000] dN.1    56.916925: ipi_exit: (Rescheduling interrupts)\n          &lt;idle&gt;-0       [000] dN.1    56.916926: irq_handler_exit: irq=1 ret=handled\n          &lt;idle&gt;-0       [000] d..2    56.916938: sched_switch: prev_comm=swapper/0 prev_pid=0 prev_prio=120 prev_state=R ==&gt; next_comm=rcu_preempt next_pid=13 next_prio=120\n     rcu_preempt-13      [000] d..4    56.916964: sched_wakeup: comm=rcuog/4 pid=41 prio=120 target_cpu=000\n           &lt;...&gt;-5114    [001] d..2    56.916968: sched_switch: prev_comm=systrace-worker prev_pid=5114 prev_prio=110 prev_state=S ==&gt; next_comm=codec_looper next_pid=7431 next_prio=120\n           ...\n</code></pre> <p>\u6211\u4eec\u4ee5<code>sched_switch()</code> \u51fd\u6570\u4e3a\u4f8b\uff0c\u770b\u4e00\u4e0b\u8fd9\u4e2a\u51fd\u6570\u7684\u8fd0\u884c\uff0c\u6700\u7ec8\u662f\u901a\u8fc7\u4ec0\u4e48\u6837\u7684\u65b9\u5f0f\u5199\u5165\u5230<code>trace</code>\u6587\u4ef6\u4e2d\u7684\uff0c\u8fd9\u4e00\u884c\u8f93\u51fa\u6211\u4eec\u5355\u72ec\u62ff\u51fa\u6765\u770b\u4e00\u4e0b\uff1a</p> <pre><code>&lt;...&gt;-5114    [001] d..2    56.916968: sched_switch: prev_comm=systrace-worker prev_pid=5114 prev_prio=110 prev_state=S ==&gt; next_comm=codec_looper next_pid=7431 next_prio=120\n</code></pre> <p>\u6253\u5f00\u8ddf\u8e2a<code>sched_switch</code>\u7684<code>trace event</code>:</p> <pre><code>#echo 1 &gt; /sys/kernel/tracing/events/sched/sched_switch/enable\n</code></pre> <p>\u5982\u679c\u9700\u8981\u8ddf\u8e2a\u6240\u6709\u5173\u4e8e\u8c03\u5ea6\u7684<code>trace event:</code></p> <pre><code>#echo 1 &gt; /sys/kernel/tracing/events/sched/enable\n</code></pre> <ul> <li><code>trace marker</code>\u529f\u80fd\uff1a</li> </ul> <p>\u5185\u6838\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8282\u70b9<code>/sys/kernel/debug/tracing/trace_marker</code> \uff0c\u6b64\u8282\u70b9\u5141\u8bb8\u7528\u6237\u5c42\u4e2d\u5199\u5165\u5b57\u7b26\u4e32\uff0c<code>ftrace</code> \u4f1a\u8bb0\u5f55\u8be5\u5199\u5165\u64cd\u4f5c\u65f6\u7684\u65f6\u95f4\u6233\uff0c\u5f53\u7528\u6237\u5728\u4e0a\u5c42\u8c03\u7528\u4e0d\u540c\u51fd\u6570\u65f6\uff0c\u5199\u5165\u4e0d\u540c\u7684\u8c03\u7528\u4fe1\u606f\uff0c\u6bd4\u5982\u51fd\u6570\u8fdb\u5165\u548c\u9000\u51fa\u5206\u522b\u5199\u5165\uff0c\u90a3\u4e48 <code>ftrace</code> \u5c31\u53ef\u4ee5\u8bb0\u5f55\u8ddf\u8e2a\u51fd\u6570\u7684\u8fd0\u884c\u65f6\u95f4\u3002\u6bd4\u5982<code>atrace</code>\u4e2d\u5728\u5f00\u59cb\u6293\u53d6<code>trace</code>\u4e4b\u524d\u4f1a\u5c06\u65f6\u95f4\u6233\u5199\u5165\u4e86<code>trace</code>\u6587\u4ef6\u4e2d\uff0c\u5c31\u662f\u5199\u7684\u8fd9\u4e2a<code>trace_marker</code>\u6587\u4ef6\u8282\u70b9\uff0c\u76f8\u5173\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>/*frameworks/native/cmds/atrace/atrace.cpp*/\nstatic void writeClockSyncMarker()\n{\nchar buffer[128];\nint len = 0;\nint fd = open((g_traceFolder + k_traceMarkerPath).c_str(), O_WRONLY);// sys/kernel/debug/tracing/trace_marker\nif (fd == -1) {\nfprintf(stderr, \"error opening %s: %s (%d)\\n\", k_traceMarkerPath,\nstrerror(errno), errno);\nreturn;\n}\nfloat now_in_seconds = systemTime(CLOCK_MONOTONIC) / 1000000000.0f;\nlen = snprintf(buffer, 128, \"trace_event_clock_sync: parent_ts=%f\\n\", now_in_seconds);\nif (write(fd, buffer, len) != len) {\nfprintf(stderr, \"error writing clock sync marker %s (%d)\\n\", strerror(errno), errno);\n}\nint64_t realtime_in_ms = systemTime(CLOCK_REALTIME) / 1000000;\nlen = snprintf(buffer, 128, \"trace_event_clock_sync: realtime_ts=%\" PRId64 \"\\n\", realtime_in_ms);\nif (write(fd, buffer, len) != len) { // \u65f6\u95f4\u6233\u5199\u5165trace_marker\u8282\u70b9\u4e2d\nfprintf(stderr, \"error writing clock sync marker %s (%d)\\n\", strerror(errno), errno);\n}\nclose(fd);\n}\n</code></pre> <p>\u6700\u7ec8\u5728<code>trace</code>\u6587\u4ef6\u4e2d\u7684\u8f93\u51fa\u6837\u5f0f\u4e3a\uff1a</p> <pre><code># TASK-PID TGID CPU# |||| TIMESTAMP FUNCTION\n# | | | | |||| | |\natrace-18345 (18345) [006] .... 678.571923: tracing_mark_write: trace_event_clock_sync: parent_ts=678.571960\n   atrace-18345 (18345) [006] .... 678.571926: tracing_mark_write: trace_event_clock_sync: realtime_ts=1596784581543\n</code></pre>"},{"location":"perf-opt/Android/jank/jank-tool/#313-ftrace","title":"3.1.3 \u5229\u7528ftrace\u5206\u6790\u7ebf\u7a0b\u5524\u9192\u5173\u7cfb","text":"<p>\u5728\u524d\u6587\u4e2d\u5173\u4e8e<code>Systrace</code>\u5206\u6790\u6280\u5de7\u4e2d\u6211\u4eec\u8bb2\u89e3\u4e86\u5982\u4f55\u4ece<code>Systrace</code>\u7684\u6d4f\u89c8\u5668\u56fe\u5f62\u663e\u793a\u4e0a\u5206\u6790\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5524\u9192\u7b49\u5f85\u5173\u7cfb\u3002\u5176\u5b9e<code>ftrace</code>\u6570\u636e\u662f\u5305\u542b\u5728<code>Systrace</code>\u7f51\u9875\u6e90\u7801\u4e2d\uff0c\u6240\u4ee5\u672c\u6587\u518d\u5206\u4eab\u4e00\u79cd\u5229\u7528<code>ftrace</code>\u5206\u6790\u7ebf\u7a0b\u5524\u9192\u5173\u7cfb\u7684\u65b9\u6cd5\uff1a</p> <p>\u6211\u4eec\u7528<code>Notepad++</code>\u5de5\u5177\u4ee5\u6587\u672c\u7684\u5f62\u5f0f\u6253\u5f00\u4efb\u610f\u4e00\u4efd\u6293\u53d6\u597d\u7684<code>Systrace html</code>\u6587\u4ef6\u6e90\u7801\uff0c\u5176\u4e2d\u5173\u4e8e\u7ebf\u7a0b\u4e4b\u95f4\u5524\u9192\u5173\u7cfb\u7684\u8ddf\u8e2a\u8bb0\u5f55\u4fe1\u606f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ul> <li>\u5bf9\u5e94<code>systrace</code>\u4e0e<code>ftrace</code>\u65f6\u95f4\uff1a</li> </ul> <p><code>ftrace</code>\u5305\u542b\u5728<code>systrace</code>\u7f51\u9875\u6e90\u4ee3\u7801\u4e2d\uff0c\u5728<code>systrace</code>\u4e2d\u65f6\u95f4\u8d77\u70b9<code>0</code>\u662f\u201d\u7b2c\u4e00\u884c<code>frace</code>\u7684\u65f6\u95f4\u6233\u201d\u3002\u4f8b\u5982<code>ftrace</code>\u7684\u7b2c\u4e00\u4e2a\u65f6\u95f4\u6233\u662f<code>2992.249462</code>, \u5728<code>systrace</code>\u4e2d\u65f6\u95f4\u6233<code>19,419.622</code>\u5bf9\u5e94\u7684<code>ftrace</code>\u65f6\u95f4\u6233\u4e3a<code>2992.249462 + 19.419622</code>\u3002</p> <ul> <li>\u4f8b\u5982\u8981\u627e\u5230\u5524\u9192\u7ebf\u7a0b\u53f7<code>1234</code>\u7684\u7ebf\u7a0b\uff1a</li> </ul> <p>\u7528<code>Notepad++</code>\u5de5\u5177\u6253\u5f00<code>systrace</code>\u7f51\u9875\u6e90\u4ee3\u7801, \u5229\u7528\u6b63\u89c4\u8868\u8fbe\u5f0f <code>\u201csched_wakeup.*pid=1234\u201d</code>\u641c\u7d22\uff0c\u7136\u540e\u6309\u65f6\u95f4\u6233\u5339\u914d\u4e00\u4e0b\u5c31\u80fd\u627e\u5230\u67d0\u6b21\u5177\u4f53\u7684\u5524\u9192\u5173\u7cfb\u3002</p> <ul> <li>\u627e\u5230\u88ab\u7ebf\u7a0b<code>1234</code>\u5524\u9192\u7684\u7ebf\u7a0b\uff1a</li> </ul> <p>\u7528<code>Notepad++</code>\u5de5\u5177\u6253\u5f00<code>systrace</code>\u7f51\u9875\u6e90\u4ee3\u7801, \u5229\u7528\u6b63\u89c4\u8868\u8fbe\u5f0f <code>1234.*sched_wakeup</code>\u641c\u7d22\uff0c\u7136\u540e\u6309\u65f6\u95f4\u6233\u5339\u914d\u4e00\u4e0b\u5c31\u80fd\u627e\u5230\u67d0\u6b21\u5177\u4f53\u7684\u5524\u9192\u5173\u7cfb\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#32-androidatrace","title":"3.2 Android\u7cfb\u7edfatrace\u8fd0\u884c\u539f\u7406","text":"<p><code>atrace</code>\u662f\u8c37\u6b4c\u8bbe\u8ba1\u7684\u4e00\u4e2a\u53ef\u4ee5\u5b9e\u73b0\u57fa\u4e8e<code>ftrace</code>\u6293\u53d6<code>Trace</code>\u6587\u4ef6\u7684<code>Native</code>\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u76f8\u5173\u4ee3\u7801\u4f4d\u4e8e<code>frameworks/native/cmds/atrace/*</code>\u76ee\u5f55\u4e0b\uff0c\u7531\u4e8e\u7bc7\u5e45\u6240\u9650\u672c\u6587\u5c31\u4e0d\u518d\u5c55\u5f00\u5206\u6790\u5176\u4ee3\u7801\u7ec6\u8282\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u53d6\u53ef\u4ee5\u81ea\u884c\u9605\u8bfb\u3002</p> <p>\u9996\u5148\u6211\u4eec\u6765\u770b\u770b<code>atrace</code>\u6293\u53d6\u7684\u6570\u636e\u6e90\u5305\u62ec\u54ea\u4e9b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5176\u4e2d\uff1a</p> <ol> <li>\u7528\u6237\u7a7a\u95f4\u7684\u6570\u636e\uff1a\u5305\u62ec\u4e86\u5e94\u7528\u5c42\u7684\u81ea\u5b9a\u4e49 <code>Trace</code>\u3001\u7cfb\u7edf\u5c42\u7684 <code>gfx</code> \u6e32\u67d3\u76f8\u5173 <code>Trace</code>\u3001\u7cfb\u7edf\u5c42\u6253\u7684\u9501\u76f8\u5173\u7684 <code>Trace</code> \u4fe1\u606f\u7b49\uff0c\u5176\u6700\u7ec8\u90fd\u662f\u901a\u8fc7\u8c03\u7528 <code>Android SDK</code> \u63d0\u4f9b\u7684<code>Trace.beginSection</code>\u6216\u8005 <code>ATRACE_BEGIN</code> \u8bb0\u5f55\u5230\u540c\u4e00\u4e2a\u6587\u4ef6\u70b9<code>/sys/kernel/debug/tracing/trace_marker</code> \u4e2d\u7684\u3002\u6b64\u8282\u70b9\u5141\u8bb8\u7528\u6237\u5c42\u5199\u5165\u5b57\u7b26\u4e32\uff0c<code>ftrace</code> \u4f1a\u8bb0\u5f55\u8be5\u5199\u5165\u64cd\u4f5c\u65f6\u7684\u65f6\u95f4\u6233\uff0c\u5f53\u7528\u6237\u5728\u4e0a\u5c42\u8c03\u7528\u4e0d\u540c\u51fd\u6570\u65f6\uff0c\u5199\u5165\u4e0d\u540c\u7684\u8c03\u7528\u4fe1\u606f\uff0c\u6bd4\u5982\u51fd\u6570\u8fdb\u5165\u548c\u9000\u51fa\u5206\u522b\u5199\u5165\uff0c\u90a3\u4e48 <code>ftrace</code> \u5c31\u53ef\u4ee5\u8bb0\u5f55\u8ddf\u8e2a\u51fd\u6570\u7684\u8fd0\u884c\u65f6\u95f4\uff08\u672c\u8d28\u662f\u57fa\u4e8e<code>ftrace</code>\u63d0\u4f9b\u7684<code>trace marker</code>\u529f\u80fd\u5b9e\u73b0\uff09\u3002<code>atrace</code> \u5728\u5904\u7406\u7528\u6237\u5c42\u7684\u591a\u79cd <code>trace</code> \u7c7b\u522b\u65f6\uff0c\u53ea\u662f\u6fc0\u6d3b\u4e0d\u540c\u7684 <code>TAG</code>\uff0c\u5982\u9009\u62e9\u4e86 <code>Graphics</code>\uff0c\u5219\u6fc0\u6d3b <code>ATRACE_TAG_GRAPHICS</code>\uff0c\u5c06\u6e32\u67d3\u4e8b\u4ef6\u8bb0\u5f55\u5230 <code>trace_marker</code>\u3002</li> <li>\u5185\u6838\u7a7a\u95f4\u7684\u6570\u636e\uff1a\u57fa\u4e8e<code>ftrace</code>\u7684<code>trace event</code>\u529f\u80fd\u5b9e\u73b0\uff0c\u5f53\u7528\u6237\u7528\u811a\u672c\u6293\u53d6<code>trace</code>\u65f6\u7ed9<code>atrace</code>\u4f20\u5165\u7684\u53c2\u6570\u4e2d\u5305\u62ec\u6709<code>sched</code>\u3001<code>mmc</code>\u3001<code>binder</code>\u7b49\u5185\u6838<code>event</code>\u76f8\u5173\u7684\u4e8b\u4ef6\u8ffd\u8e2a\u65f6\uff0c<code>atrace</code>\u8fdb\u7a0b\u4e2d\u5c31\u4f1a\u53bb\u5199<code>sys/kernel/debug/tracing/events/</code>\u76ee\u5f55\u4e0b\u5bf9\u5e94\u7684\u8282\u70b9\u53bb\u6fc0\u6d3b<code>ftrace</code>\u6293\u53d6\u5bf9\u5e94\u7684<code>kernel event</code>\u3002\u4f8b\u5982\u9009\u62e9\u4e86<code>sched</code>\u540e\uff0c<code>atrace</code>\u5c31\u4f1a\u5c06<code>sys/kernel/debug/tracing/events/sched/enable</code>\u8282\u70b9\u7684\u503c\u5199\u4e3a<code>\u201c1\u201d</code>\uff0c\u4ece\u800c\u6fc0\u6d3b<code>ftrace</code>\u8ddf\u8e2a\u5185\u6838<code>CPU</code>\u8c03\u5ea6\u76f8\u5173\u7684\u6240\u6709\u4e8b\u4ef6\u5199\u5165<code>trace</code>\u6587\u4ef6\u3002</li> <li>\u6700\u7ec8\uff0c\u4e0a\u8ff0\u4e24\u5927\u7c7b\u4e8b\u4ef6\u8bb0\u5f55\u90fd\u6c47\u96c6\u5230\u5185\u6838\u6001\u7684\u540c\u4e00\u7f13\u51b2\u4e2d\uff0c<code>PC</code> \u7aef\u4e0a <code>Systrace</code> \u5de5\u5177\u811a\u672c\u662f\u901a\u8fc7\u6307\u5b9a\u6293\u53d6 <code>trace</code> \u7684\u7c7b\u522b\u7b49\u53c2\u6570\uff0c\u7136\u540e\u89e6\u53d1\u624b\u673a\u7aef\u7684<code>/system/bin/atrace</code> \u5f00\u542f\u5bf9\u5e94\u6587\u4ef6\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u63a5\u7740 <code>atrace</code> \u4f1a\u8bfb\u53d6 <code>ftrace</code> \u7684\u7f13\u5b58\uff0c\u751f\u6210\u53ea\u5305\u542b <code>ftrace</code> \u4fe1\u606f\u7684 <code>atrace_raw</code> \u4fe1\u606f\uff0c\u6700\u7ec8\u901a\u8fc7\u811a\u672c\u8f6c\u6362\u6210\u53ef\u89c6\u5316 <code>HTML</code> \u6587\u4ef6\u3002</li> </ol> <p>\u501f\u7528\u4e00\u5f20\u56fe\u63cf\u8ff0<code>Android</code>\u7cfb\u7edf\u4e2d\u751f\u6210<code>Systrace</code>\u7684\u53ef\u89c6<code>html</code>\u6587\u4ef6\u7684\u6574\u4e2a\u5b9e\u73b0\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/jank/jank-tool/#4-systrace","title":"4 Systrace\u6293\u53d6\u65b9\u6cd5","text":"<p>\u5f00\u53d1\u4eba\u5458\u6700\u5e38\u7528\u65b9\u5f0f\u662f\u4f7f\u7528<code>Android</code>\u5b98\u65b9<code>sdk</code>\u4e2d\u63d0\u4f9b\u7684\u540d\u4e3a<code>systrace.py</code>\u7684<code>python</code>\u811a\u672c\u5de5\u5177\u6293\u53d6<code>Systrace</code>\u62a5\u544a\u3002</p>"},{"location":"perf-opt/Android/jank/jank-tool/#41","title":"4.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907","text":"<p>\u5982\u9700\u8fd0\u884c <code>Systrace</code>\u811a\u672c\uff0c\u8bf7\u5148\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u914d\u7f6e\u76f8\u5173\u8fd0\u884c\u73af\u5883\uff1a</p> <ol> <li>\u4ece <code>Android Studio</code> \u4e0b\u8f7d\u5e76\u5b89\u88c5\u6700\u65b0\u7684 Android SDK \u5de5\u5177\u3002</li> <li>\u5b89\u88c5 Python\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u5de5\u4f5c\u7ad9\u7684 <code>PATH</code> \u73af\u5883\u53d8\u91cf\u4e2d\u3002</li> <li>\u5c06 <code>android-sdk/platform-tools/</code> \u6dfb\u52a0\u5230 <code>PATH</code> \u73af\u5883\u53d8\u91cf\u3002\u6b64\u76ee\u5f55\u5305\u542b\u7531 <code>systrace</code> \u7a0b\u5e8f\u8c03\u7528\u7684 Android \u8c03\u8bd5\u6865\u4e8c\u8fdb\u5236\u6587\u4ef6 (<code>adb</code>)\u3002</li> <li>\u4f7f\u7528 USB \u8c03\u8bd5\u8fde\u63a5\u5c06\u642d\u8f7d <code>Android 4.3</code>\uff08<code>API</code> \u7ea7\u522b <code>18</code>\uff09\u6216\u66f4\u9ad8\u7248\u672c\u7684\u8bbe\u5907\u8fde\u63a5\u5230\u5f00\u53d1\u7cfb\u7edf\u3002</li> </ol>"},{"location":"perf-opt/Android/jank/jank-tool/#42","title":"4.2 \u547d\u4ee4\u8bed\u6cd5","text":"<p>\u5982\u9700\u4e3a\u5e94\u7528\u751f\u6210<code>Systrace</code>\u7684 <code>HTML</code> \u62a5\u544a\uff0c\u60a8\u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u8bed\u6cd5\u901a\u8fc7\u547d\u4ee4\u884c\u8fd0\u884c <code>systrace</code>\uff1a</p> <pre><code>systrace.py [options] [categories]\n</code></pre> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u4f1a\u8c03\u7528 <code>systrace</code> \u6765\u8bb0\u5f55\u8bbe\u5907\u6d3b\u52a8\uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u540d\u4e3a <code>mynewtrace.html</code> \u7684 <code>HTML</code> \u62a5\u544a\u3002\u6b64\u7c7b\u522b\u5217\u8868\u662f\u5927\u591a\u6570\u8bbe\u5907\u7684\u5408\u7406\u9ed8\u8ba4\u5217\u8868\u3002</p> <pre><code>systrace.py -o mynewtrace.html sched freq idle am wm gfx view binder_driver hal dalvik camera input res\n</code></pre> <p>\u5e38\u7528\u547d\u4ee4\u4e0e\u8bf4\u660e\u5982\u4e0b\uff1a</p> <p></p> <p>\u66f4\u591a\u8be6\u7ec6\u7684\u4ecb\u7ecd\u8bf7\u53c2\u89c1\u5b98\u65b9\u4f7f\u7528\u6587\u6863\uff1a</p> <p>https://developer.android.google.cn/topic/performance/tracing/command-line</p>"},{"location":"perf-opt/Android/jank/jank-tool/#_1","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://www.jianshu.com/p/cf531a3af828</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/","title":"Android\u542f\u52a8\u4f18\u5316","text":""},{"location":"perf-opt/Android/launch/Android-launch-opt/#1","title":"1. \u542f\u52a8\u4f18\u5316\u7684\u610f\u4e49","text":"<p>\u7528\u6237\u5982\u679c\u60f3\u6253\u5f00\u4e00\u4e2a\u5e94\u7528\uff0c\u5c31\u4e00\u5b9a\u8981\u7ecf\u8fc7\u201c\u542f\u52a8\u201d\u8fd9\u4e2a\u6b65\u9aa4\u3002\u542f\u52a8\u65f6\u95f4\u7684\u957f\u77ed\uff0c\u4e0d\u53ea\u662f\u7528\u6237\u4f53\u9a8c\u7684\u95ee\u9898\uff0c\u5bf9\u4e8e\u6dd8\u5b9d\u3001\u4eac\u4e1c\u8fd9\u4e9b\u5e94\u7528\u6765\u8bf4\uff0c\u4f1a\u76f4\u63a5\u5f71\u54cd\u7559\u5b58\u548c\u8f6c\u5316\u7b49\u6838\u5fc3\u6570\u636e\u3002\u542f\u52a8\u8fc7\u6162\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7528\u6237\u5728\u5e94\u7528\u5546\u5e97\u9488\u5bf9\u60a8\u7684\u5e94\u7528\u7ed9\u51fa\u5f88\u4f4e\u7684\u8bc4\u5206\uff0c\u751a\u81f3\u5b8c\u5168\u5f03\u7528\u60a8\u7684\u5e94\u7528\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#2","title":"2. \u542f\u52a8\u7c7b\u578b","text":""},{"location":"perf-opt/Android/launch/Android-launch-opt/#21","title":"2.1. \u51b7\u542f\u52a8","text":"<p>\u51b7\u542f\u52a8\u662f\u6307\u5e94\u7528\u4ece\u5934\u5f00\u59cb\u542f\u52a8\uff1a\u7cfb\u7edf\u8fdb\u7a0b\u5728\u51b7\u542f\u52a8\u540e\u624d\u521b\u5efa\u5e94\u7528\u8fdb\u7a0b\u3002\u53d1\u751f\u51b7\u542f\u52a8\u7684\u60c5\u51b5\u5305\u62ec\u5e94\u7528\u5728\u8bbe\u5907\u542f\u52a8\u540e\u6216\u7cfb\u7edf\u7ec8\u6b62\u5e94\u7528\u540e\u9996\u6b21\u542f\u52a8</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#22","title":"2.2. \u70ed\u542f\u52a8","text":"<p>\u70ed\u542f\u52a8\u6bd4\u51b7\u542f\u52a8\u7b80\u5355\u5f97\u591a\uff0c\u5f00\u9500\u4e5f\u66f4\u4f4e\u3002\u5728\u70ed\u542f\u52a8\u4e2d\uff0c\u7cfb\u7edf\u7684\u6240\u6709\u5de5\u4f5c\u5c31\u662f\u5c06\u60a8\u7684 <code>Activity</code> \u5e26\u5230\u524d\u53f0\u3002\u53ea\u8981\u5e94\u7528\u7684\u6240\u6709 <code>Activity</code> \u4ecd\u9a7b\u7559\u5728\u5185\u5b58\u4e2d\uff0c\u5e94\u7528\u5c31\u4e0d\u5fc5\u91cd\u590d\u6267\u884c\u5bf9\u8c61\u521d\u59cb\u5316\u3001\u5e03\u5c40\u89e3\u6790\u548c\u7ed8\u5236\u3002 \u4f46\u662f\uff0c\u5982\u679c\u4e00\u4e9b\u5185\u5b58\u4e3a\u54cd\u5e94\u5185\u5b58\u6574\u7406\u4e8b\u4ef6\uff08\u5982 <code>onTrimMemory()</code>\uff09\u800c\u88ab\u5b8c\u5168\u6e05\u9664\uff0c\u5219\u9700\u8981\u91cd\u65b0\u521b\u5efa\u76f8\u5e94\u7684\u5bf9\u8c61\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#23","title":"2.3. \u6e29\u542f\u52a8","text":"<p>\u6e29\u542f\u52a8\u5305\u542b\u4e86\u5728\u51b7\u542f\u52a8\u671f\u95f4\u53d1\u751f\u7684\u90e8\u5206\u64cd\u4f5c\uff1b\u540c\u65f6\uff0c\u5b83\u7684\u5f00\u9500\u8981\u6bd4\u70ed\u542f\u52a8\u9ad8\u3002\u6709\u8bb8\u591a\u6f5c\u5728\u72b6\u6001\u53ef\u89c6\u4e3a\u6e29\u542f\u52a8\u3002\u4f8b\u5982\uff1a</p> <ul> <li> <p>\u7528\u6237\u5728\u9000\u51fa\u5e94\u7528\u540e\u53c8\u91cd\u65b0\u542f\u52a8\u5e94\u7528\u3002\u8fdb\u7a0b\u53ef\u80fd\u8fd8\u7ee7\u7eed\u8fd0\u884c\uff0c\u4f46\u5e94\u7528\u5fc5\u987b\u901a\u8fc7\u8c03\u7528 <code>onCreate()</code> \u4ece\u5934\u5f00\u59cb\u91cd\u65b0\u521b\u5efa <code>Activity</code>\u3002</p> </li> <li> <p>\u7cfb\u7edf\u5c06\u60a8\u7684\u5e94\u7528\u4ece\u5185\u5b58\u4e2d\u9010\u51fa\uff0c\u7136\u540e\u7528\u6237\u53c8\u91cd\u65b0\u542f\u52a8\u5b83\u3002\u8fd9\u65f6\u5019\u8fdb\u7a0b\u548c <code>Activity</code>\u90fd\u9700\u8981\u91cd\u542f\uff0c\u4f46\u5982\u679c\u5e94\u7528\u9000\u51fa\u524d\u901a\u8fc7<code>onSaveInstanceState</code>\u4fdd\u7559\u4e86\u72b6\u6001\u6570\u636e\uff0c\u91cd\u65b0\u542f\u52a8\u4f20\u9012\u5230 <code>onCreate()</code> \u7684\u5df2\u4fdd\u5b58\u7684\u5b9e\u4f8b <code>state bundle</code> \u5bf9\u4e8e\u5b8c\u6210\u542f\u52a8\u4efb\u52a1\u4f1a\u6709\u4e00\u5b9a\u5e2e\u52a9\u3002</p> </li> </ul> <p>\u4e00\u822c\u6211\u4eec\u90fd\u662f\u5047\u5b9a\u51b7\u542f\u52a8\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u4f18\u5316\u3002\u8fd9\u6837\u505a\u4e5f\u53ef\u4ee5\u540c\u65f6\u63d0\u5347\u6e29\u542f\u52a8\u548c\u70ed\u542f\u52a8\u7684\u6027\u80fd\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#3","title":"3. \u5e94\u7528\u51b7\u542f\u52a8\u6d41\u7a0b","text":""},{"location":"perf-opt/Android/launch/Android-launch-opt/#31","title":"3.1. \u542f\u52a8\u6d41\u7a0b","text":"<p>\u7528\u6237\u70b9\u51fb\u56fe\u6807\u5f00\u59cb\uff0c\u5230\u4e3b\u754c\u9762\u7528\u6237\u53ef\u64cd\u4f5c\uff0c\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b </p> <ol> <li> <p>\u7b2c\u4e00\u9636\u6bb5\uff1a\u9884\u89c8\u7a97\u53e3 <code>SystemServer</code>\u8fdb\u7a0b\u4f1a\u521b\u5efa\u5e94\u7528\u7684\u8fdb\u7a0b\u548c\u7a97\u53e3</p> <ul> <li>\u7cfb\u7edf\u63a5\u7ba1\uff0c\u51e0\u4e4e\u6ca1\u6709\u4f18\u5316\u7684\u7a7a\u95f4</li> <li>\u8981\u662f<code>windowBackground</code>\u4e3b\u9898\u5c5e\u6027\u914d\u7f6e\u4e86\uff0c\u4f1a\u663e\u793a\u5bf9\u5e94\u7684\u9884\u89c8\uff0c\u5426\u5219\u663e\u793a\u7a7a\u767d\u542f\u52a8\u7a97\u53e3</li> </ul> </li> <li> <p>\u7b2c\u4e8c\u9636\u6bb5\uff1a\u9875\u9762\u663e\u793a   \u5e94\u7528\u8fdb\u7a0b\u88ab <code>SystemServer</code> \u521b\u5efa\u540e\uff0c\u8fdb\u884c\u4e00\u7cfb\u5217\u521d\u59cb\u5316\u5de5\u4f5c\u540e\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u770b\u5230\u4e3b\u754c\u9762   \u5177\u4f53\u4f1a\u5206\u6210\u4ee5\u4e0b\u51e0\u6b65\uff1a</p> <ol> <li>\u521b\u5efa\u5e94\u7528\u5bf9\u8c61\uff08Application#onCreate\uff09</li> <li>\u542f\u52a8\u4e3b\u7ebf\u7a0b</li> <li>\u521b\u5efa\u4e3b Activity</li> <li>\u89c6\u56fe\u521b\u5efa\u3001</li> <li>\u5e03\u5c40</li> <li>\u6267\u884c\u521d\u59cb\u7ed8\u5236   \u4e00\u65e6\u5e94\u7528\u8fdb\u7a0b\u5b8c\u6210\u7b2c\u4e00\u6b21\u7ed8\u5236\uff0c\u7cfb\u7edf\u8fdb\u7a0b\u5c31\u4f1a\u6362\u6389\u5f53\u524d\u663e\u793a\u7684\u540e\u53f0\u7a97\u53e3\uff0c\u66ff\u6362\u4e3a<code>\u4e3b Activity</code>\u3002\u6b64\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u5f00\u59cb\u4f7f\u7528\u5e94\u7528\u3002</li> </ol> </li> <li> <p>\u7b2c\u4e09\u9636\u6bb5\uff1a\u754c\u9762\u53ef\u64cd\u4f5c  \u5728\u542f\u52a8\u5b8c\u6210\u540e\uff0c\u8fd8\u9700\u8981\u7b49\u5f85\u4e3b\u9875\u6e32\u67d3\u5b8c\u6210\u5e76\u53ef\u4ee5\u987a\u7545\u4ea4\u4e92(\u5982 \u5300\u901f\u8fde\u7eed\u4e0a\u4e0b\u6ed1\u52a8\u5c4f\u5e55 )\uff0c\u8fd9\u6837\u624d\u7b97\u771f\u6b63\u542f\u52a8\u5b8c\u6210</p> </li> </ol>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#32","title":"3.2. \u6e90\u7801\u7b80\u6790","text":""},{"location":"perf-opt/Android/launch/Android-launch-opt/#321","title":"3.2.1 \u5173\u952e\u7c7b\u7b80\u4ecb","text":"<ul> <li>ActivityManagerService\uff1aAMS \u662f Android \u4e2d\u6700\u6838\u5fc3\u7684\u670d\u52a1\u4e4b\u4e00\uff0c\u4e3b\u8981\u8d1f\u8d23\u7cfb\u7edf\u4e2d\u56db\u5927\u7ec4\u4ef6\u7684\u542f\u52a8\u3001\u5207\u6362\u3001\u8c03\u5ea6\u53ca\u5e94\u7528\u8fdb\u7a0b\u7684\u7ba1\u7406\u548c\u8c03\u5ea6\u7b49\u5de5\u4f5c\uff0c\u5176\u804c\u8d23\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u8fdb\u7a0b\u7ba1\u7406\u548c\u8c03\u5ea6\u6a21\u5757\u76f8\u7c7b\u4f3c\uff0c\u5b83\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a Binder \u7684\u5b9e\u73b0\u7c7b\uff0c\u5e94\u7528\u8fdb\u7a0b\u80fd\u901a\u8fc7 Binder \u673a\u5236\u8c03\u7528\u7cfb\u7edf\u670d\u52a1\u3002</li> <li>ActivityThread\uff1a\u5e94\u7528\u7684\u5165\u53e3\u7c7b\uff0c\u7cfb\u7edf\u901a\u8fc7\u8c03\u7528main\u51fd\u6570\uff0c\u5f00\u542f\u6d88\u606f\u5faa\u73af\u961f\u5217\u3002ActivityThread \u6240\u5728\u7ebf\u7a0b\u88ab\u79f0\u4e3a\u5e94\u7528\u7684\u4e3b\u7ebf\u7a0b\uff08UI \u7ebf\u7a0b\uff09\u3002</li> <li>Instrumentation\uff1a\u5de5\u5177\u7c7b\uff0c\u5b83\u7528\u6765\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u548c\u7cfb\u7edf\u7684\u4ea4\u4e92\uff0c\u5305\u88c5\u4e86 ActivityManagerService \u7684\u8c03\u7528\uff0c\u4e00\u4e9b\u63d2\u4ef6\u5316\u65b9\u6848\u5c31\u662f\u901a\u8fc7 hook \u8be5\u7c7b\u5b9e\u73b0\u7684\u3002</li> <li>ActivityStarter\uff1aActivity \u542f\u52a8\u7684\u5de5\u5177\u7c7b\uff0c\u5904\u7406\u542f\u52a8 Activity \u7684\u5404\u79cd flag \u3002</li> <li>ActivityStackSupervisor\uff1a\u7ba1\u7406\u6240\u6709\u5e94\u7528\u7684 Activity \u7684\u6808\uff0c\u5176\u4e2d mFocusedStack \u5c31\u662f\u5f53\u524d\u5e94\u7528\u7684 Activity \u6808\u3002</li> </ul>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#322","title":"3.2.2 \u542f\u52a8\u6b65\u9aa4","text":"<ol> <li>\u5f53\u70b9\u51fb\u684c\u9762 App \u7684\u65f6\u5019\uff0c\u53d1\u8d77\u8fdb\u7a0b\u5c31\u662f <code>Launcher</code> \u6240\u5728\u7684\u8fdb\u7a0b\uff0c<code>startActivity()</code>\u51fd\u6570\u6700\u7ec8\u662f\u7531<code>Instrumentation</code>\u901a\u8fc7Android\u7684<code>Binder</code>\u8de8\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236 \u53d1\u9001\u6d88\u606f\u7ed9 <code>system_server</code>\u8fdb\u7a0b\uff1b <p>Activity.java <pre><code>  public void startActivityForResult(@RequiresPermission Intent intent, int requestCode,\n@Nullable Bundle options) {\nif (mParent == null) {\noptions = transferSpringboardActivityOptions(options);\nInstrumentation.ActivityResult ar =\nmInstrumentation.execStartActivity(\nthis, mMainThread.getApplicationThread(), mToken, this,\nintent, requestCode, options);\n\u00b7\u00b7\u00b7\n} else {\n\u00b7\u00b7\u00b7\n}\n}\n</code></pre> Instrumentation.java <pre><code>    public ActivityResult execStartActivity(\nContext who, IBinder contextThread, IBinder token, Activity target,\nIntent intent, int requestCode, Bundle options) {\n\u00b7\u00b7\u00b7\ntry {\nintent.migrateExtraStreamToClipData();\nintent.prepareToLeaveProcess(who);\nint result = ActivityManager.getService()\n.startActivity(whoThread, who.getBasePackageName(), intent,\nintent.resolveTypeIfNeeded(who.getContentResolver()),\ntoken, target != null ? target.mEmbeddedID : null,\nrequestCode, 0, null, options);\ncheckStartActivityResult(result, intent);\n} catch (RemoteException e) {\nthrow new RuntimeException(\"Failure from system\", e);\n}\nreturn null;\n}\n</code></pre></p> </li> <li> <p>\u5728 <code>system_server</code> \u4e2d\uff0c\u542f\u52a8\u8fdb\u7a0b\u7684\u64cd\u4f5c\u4f1a\u5148\u8c03\u7528 <code>ActivityManagerService#startProcessLocked()</code> \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u5185\u90e8\u8c03\u7528 <code>Process.start(android.app.ActivityThread)\uff1b</code>\u800c\u540e\u901a\u8fc7 <code>socket</code> \u901a\u4fe1\u544a\u77e5 <code>Zygote</code>\u8fdb\u7a0b <code>fork</code> \u5b50\u8fdb\u7a0b\uff0c\u5373 app \u8fdb\u7a0b\u3002\u8fdb\u7a0b\u521b\u5efa\u540e\u5c06 <code>ActivityThread</code> \u52a0\u8f7d\u8fdb\u53bb\uff0c\u6267\u884c <code>ActivityThread#main()</code>\u65b9\u6cd5\uff1b</p> <p>ActivityManagerService.java <pre><code> private final void startProcessLocked(ProcessRecord app, String hostingType,\nString hostingNameStr, String abiOverride, String entryPoint, String[] entryPointArgs) {\n\u00b7\u00b7\u00b7\nif (entryPoint == null) entryPoint = \"android.app.ActivityThread\";\nTrace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, \"Start proc: \" +\napp.processName);\ncheckTime(startTime, \"startProcess: asking zygote to start proc\");\nProcessStartResult startResult;\nif (hostingType.equals(\"webview_service\")) {\n\u00b7\u00b7\u00b7\n} else {\nstartResult = Process.start(entryPoint,\napp.processName, uid, uid, gids, debugFlags, mountExternal,\napp.info.targetSdkVersion, seInfo, requiredAbi, instructionSet,\napp.info.dataDir, invokeWith, entryPointArgs);\n}\n\u00b7\u00b7\u00b7\n}\n</code></pre></p> </li> <li> <p>\u5728 <code>app</code> \u8fdb\u7a0b\u4e2d\uff0c<code>main()</code> \u65b9\u6cd5\u4f1a\u5b9e\u4f8b\u5316 <code>ActivityThread</code>\uff0c\u540c\u65f6\u521b\u5efa <code>ApplicationThread</code>\uff0c<code>Looper</code>\uff0c<code>Hander</code> \u5bf9\u8c61\uff0c\u8c03\u7528 <code>ActivityThread#attach(false)</code> \u65b9\u6cd5\u8fdb\u884c Binder \u901a\u4fe1\uff0c\u65b9\u6cd5\u91cc\u9762\u8c03\u7528 <code>ActivityManagerService#attachApplication(mAppThread)</code> \u65b9\u6cd5\uff0c\u5c06 thread \u4fe1\u606f\u544a\u77e5 <code>ActivityManagerService</code> \uff0c \u63a5\u7740 <code>Looper</code> \u542f\u52a8\u5faa\u73af\uff1b</p> <p>ActivityThread.java <pre><code>public static void main(String[] args) {\n\u00b7\u00b7\u00b7\nLooper.prepareMainLooper();\nActivityThread thread = new ActivityThread();\nthread.attach(false);\nif (sMainThreadHandler == null) {\nsMainThreadHandler = thread.getHandler();\n}\n\u00b7\u00b7\u00b7\nLooper.loop();\n\u00b7\u00b7\u00b7\n}\nprivate void attach(boolean system) {\n\u00b7\u00b7\u00b7\nif (!system) {\n\u00b7\u00b7\u00b7\nfinal IActivityManager mgr = ActivityManager.getService();\ntry {\nmgr.attachApplication(mAppThread);\n} catch (RemoteException ex) {\nthrow ex.rethrowFromSystemServer();\n}\n\u00b7\u00b7\u00b7\n} else {\n\u00b7\u00b7\u00b7\n}\n\u00b7\u00b7\u00b7\n}\n</code></pre></p> </li> <li>\u5728<code>system_server</code>\u8fdb\u7a0b\u4e2d\uff0c<code>ActivityManagerService#attachApplication(mAppThread)</code>\u91cc\u4f9d\u6b21\u521d\u59cb\u5316\u4e86<code>Application</code>\u548c<code>Activity</code>\uff0c\u5206\u522b\u67092\u4e2a\u5173\u952e\u51fd\u6570\uff1a<ul> <li><code>thread#bindApplication()</code>\u65b9\u6cd5\u901a\u77e5\u4e3b\u7ebf\u7a0b<code>Handler</code> \u521b\u5efa <code>Application</code> \u5bf9\u8c61\u3001\u7ed1\u5b9a <code>Context</code> \u3001\u6267\u884c <code>Application#onCreate()</code>\u751f\u547d\u5468\u671f</li> <li><code>mStackSupervisor#attachApplicationLocked()</code>\u65b9\u6cd5\u4e2d\u8c03\u7528 <code>ActivityThread#ApplicationThread#scheduleLaunchActivity()</code>\u65b9\u6cd5\uff0c\u8fdb\u800c\u901a\u8fc7\u4e3b\u7ebf\u7a0b<code>Handler</code>\u6d88\u606f\u901a\u77e5\u521b\u5efa <code>Activity</code> \u5bf9\u8c61\uff0c\u7136\u540e\u518d\u8c03\u7528 <code>mInstrumentation#callActivityOnCreate()</code>\u6267\u884c <code>Activity#onCreate()</code> \u751f\u547d\u5468\u671f <p>ActivityManagerService.java</p> </li> </ul> </li> </ol> <pre><code>    private final boolean attachApplicationLocked(IApplicationThread thread,\nint pid) {\n\u00b7\u00b7\u00b7\ntry {\n\u00b7\u00b7\u00b7\nif (app.instr != null) {\nthread.bindApplication(processName, appInfo, providers,\napp.instr.mClass,\nprofilerInfo, app.instr.mArguments,\napp.instr.mWatcher,\napp.instr.mUiAutomationConnection, testMode,\nmBinderTransactionTrackingEnabled, enableTrackAllocation,\nisRestrictedBackupMode || !normalMode, app.persistent,\nnew Configuration(getGlobalConfiguration()), app.compat,\ngetCommonServicesLocked(app.isolated),\nmCoreSettingsObserver.getCoreSettingsLocked(),\nbuildSerial);\n} else {\nthread.bindApplication(processName, appInfo, providers, null, profilerInfo,\nnull, null, null, testMode,\nmBinderTransactionTrackingEnabled, enableTrackAllocation,\nisRestrictedBackupMode || !normalMode, app.persistent,\nnew Configuration(getGlobalConfiguration()), app.compat,\ngetCommonServicesLocked(app.isolated),\nmCoreSettingsObserver.getCoreSettingsLocked(),\nbuildSerial);\n}\n\u00b7\u00b7\u00b7\n} catch (Exception e) {\n\u00b7\u00b7\u00b7\n}\n\u00b7\u00b7\u00b7\n// See if the top visible activity is waiting to run in this process...\nif (normalMode) {\ntry {\nif (mStackSupervisor.attachApplicationLocked(app)) {\ndidSomething = true;\n}\n} catch (Exception e) {\n\u00b7\u00b7\u00b7\n}\n}\n\u00b7\u00b7\u00b7\n}\n</code></pre>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#4","title":"4. \u68c0\u6d4b\u5206\u6790","text":""},{"location":"perf-opt/Android/launch/Android-launch-opt/#41-logcat","title":"4.1. \u67e5\u770blogcat","text":"<p>\u5728 Android 4.4\u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c<code>logcat</code> \u5305\u542b\u4e00\u4e2a\u8f93\u51fa\u884c\uff0c\u5176\u4e2d\u5305\u542b\u540d\u4e3a <code>Displayed</code> \u7684\u503c\u3002\u6b64\u503c\u4ee3\u8868\u4ece\u542f\u52a8\u8fdb\u7a0b\u5230\u5728\u5c4f\u5e55\u4e0a\u5b8c\u6210\u5bf9\u5e94 <code>Activity</code> \u7684\u7ed8\u5236\u6240\u7528\u7684\u65f6\u95f4\u3002\u7ecf\u8fc7\u7684\u65f6\u95f4\u5305\u62ec\u4ee5\u4e0b\u4e8b\u4ef6\u5e8f\u5217\uff1a</p> <ol> <li>\u542f\u52a8\u8fdb\u7a0b</li> <li>\u521d\u59cb\u5316\u5bf9\u8c61</li> <li>\u521b\u5efa\u5e76\u521d\u59cb\u5316 Activity</li> <li>\u5e03\u5c40\u586b\u5145</li> <li>\u9996\u6b21\u7ed8\u5236\u5e94\u7528 <pre><code>ActivityManager: Displayed com.android.myexample/.StartupTiming: +3s534ms\n</code></pre> \u53e6\u5916\uff0c\u53ef\u4ee5\u624b\u52a8\u8c03\u7528<code>reportFullyDrawn()</code>\u65b9\u6cd5\u544a\u77e5\u7cfb\u7edf\u5e94\u7528\u771f\u6b63\u5b8c\u5168\u663e\u793a\uff0c\u8f93\u51fa\u5982\u4e0b <pre><code>system_process I/ActivityManager: Fully drawn {package}/.MainActivity: +1s54ms\n</code></pre></li> </ol>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#42-adb","title":"4.2 adb\u547d\u4ee4","text":"<pre><code>adb [-d|-e|-s &lt;serialNumber&gt;] shell am start -S -W\n    com.example.app/.MainActivity\n    -c android.intent.category.LAUNCHER\n    -a android.intent.action.MAIN\n</code></pre> <p>-c \u548c -a \u4e3a\u53ef\u9009\u53c2\u6570\uff0c\u53ef\u8ba9\u60a8\u4e3a intent \u6307\u5b9a  \u548c  \u8f93\u51fa\u5982\u4e0b <pre><code>Starting: Intent\n    Activity: com.example.app/.MainActivity\n    ThisTime: 2044\nTotalTime: 2044\nWaitTime: 2054\nComplete\n</code></pre> <ul> <li>ThisTime \u8868\u793a\u6700\u540e\u4e00\u4e2aActivity\u542f\u52a8\u8017\u65f6\u3002</li> <li>TotalTime \u8868\u793a\u6240\u6709Activity\u542f\u52a8\u8017\u65f6\u3002</li> <li>WaitTime \u8868\u793aAMS\u542f\u52a8Activity\u7684\u603b\u8017\u65f6\u3002</li> </ul> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u53ea\u9700\u67e5\u770b\u5f97\u5230\u7684<code>TotalTime</code>\uff0c\u5373\u5e94\u7528\u7684\u542f\u52a8\u65f6\u95f4\uff0c\u5176\u5305\u62ec <code>\u521b\u5efa\u8fdb\u7a0b + Application\u521d\u59cb\u5316 + Activity\u521d\u59cb\u5316\u5230\u754c\u9762\u663e\u793a</code> \u7684\u8fc7\u7a0b</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#43-cpu-profiler","title":"4.3 cpu profiler","text":"<p>\u6574\u4f53\u901a\u8fc7 JVM Agent \u5b9e\u73b0\uff0c\u5177\u6709\u5b8c\u5168\u65b9\u6cd5\u8c03\u7528\u6808\u8f93\u51fa\uff0c\u4e14\u652f\u6301 Java\u3001C/C++\u65b9\u6cd5\u7684\u8017\u65f6\u68c0\u6d4b\uff0c\u4e0a\u624b\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u5176\u5b58\u5728\u6027\u80fd\u635f\u8017\u8f83\u5927\u7684\u95ee\u9898\uff0c\u4e14\u4e00\u822c\u4ec5\u7528\u4e8e debug \u5305\uff0crelease \u5305\u9700\u8981\u989d\u5916\u6dfb\u52a0 debuggable \u7684\u914d\u7f6e\uff1b</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#44-nanoscope","title":"4.4 Nanoscope","text":"<p><pre><code>nanoscope start --package=com.example.app\n</code></pre> </p> <p>\u8c03\u8bd5\u65b9\u4fbf\uff0c\u6027\u80fd\u635f\u8017\u5c0f\uff0c\u5f97\u51fa\u7684\u7ed3\u679c\u771f\u5b9e\uff0c\u4e0d\u8fc7\u6682\u65f6\u53ea\u652f\u6301 Nexus 6P \u548c x86 \u6a21\u62df\u5668\uff0c\u65e0\u6cd5\u9488\u5bf9\u4e2d\u4f4e\u7aef\u673a\u505a\u6d4b\u8bd5</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#45-systraceperfetto","title":"4.5 Systrace/Perfetto","text":"<p>\u8c03\u8bd5\u65b9\u4fbf\uff0c\u6027\u80fd\u635f\u8017\u5c0f\uff0c\u5f97\u51fa\u7684\u7ed3\u679c\u771f\u5b9e\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8ffd\u8e2a\u5173\u952e\u7cfb\u7edf\u8c03\u7528\u7684\u8017\u65f6\u60c5\u51b5\uff0c\u5982\u4f8b\u5982 GC\u3001System Server\u3001CPU \u8c03\u5ea6\u7b49\uff1b\u53e6\u5916\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7801\u63d2\u6869\u652f\u6301\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u7684\u8017\u65f6\u5206\u6790</p> <p>\u67e5\u770b\u624b\u673a\u652f\u6301\u7684systrace \u7c7b\u578b</p> <p><pre><code>python systrace.py --list-categories\n</code></pre> \u6267\u884c\u547d\u4ee4 <pre><code>./systrace sched freq idle am wm gfx view binder_driver hal dalvik\n camera input res -a com.hiyo.yy -b 16384 -o trace.html\n</code></pre> </p> <p>\u901a\u8fc7\u63d2\u6869\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5e94\u7528\u4e3b\u7ebf\u7a0b\u548c\u5176\u4ed6\u7ebf\u7a0b\u7684\u51fd\u6570\u8c03\u7528\u6d41\u7a0b\u3002\u5b83\u7684\u5b9e\u73b0\u539f\u7406\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u5c06\u4e0b\u9762\u7684\u4e24\u4e2a\u51fd\u6570\u5206\u522b\u63d2\u5165\u5230\u6bcf\u4e2a\u65b9\u6cd5\u7684\u5165\u53e3\u548c\u51fa\u53e3\u3002 <pre><code>class Trace {\npublic static void i(String tag) {\nTrace.beginSection(name);\n}\npublic static void o() {\nTrace.endSection();\n}\n}\n</code></pre></p> <p>\u8fd9\u91cc\u8981\u8003\u8651\u4e00\u4e9b\u7ec6\u8282\uff0c\u5982\u964d\u4f4e\u63d2\u6869\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u3001\u54ea\u4e9b\u51fd\u6570\u9700\u8981\u88ab\u6392\u9664\u6389</p> <p>\u51fd\u6570\u63d2\u6869\u540e\u6548\u679c\uff1a <pre><code>class Test {\npublic void test() {\nTrace.i(\"Test.test()\");\n//\u539f\u6765\u7684\u5de5\u4f5c\nTrace.o()\uff1b\n}\n}\n</code></pre></p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#5","title":"5. \u4f18\u5316","text":""},{"location":"perf-opt/Android/launch/Android-launch-opt/#51","title":"5.1 \u95ea\u5c4f\u4f18\u5316","text":"<ol> <li> <p>\u89c6\u89c9\u4f18\u5316 \u8bbe\u7f6e\u9884\u89c8\u7a97\u53e3\uff08<code>windowBackground</code>\uff09\u548c\u9ed8\u8ba4\u95ea\u5c4f\u9875\u9762\u4e00\u81f4\uff0c\u7528\u6237\u89c6\u89c9\u4e0a\u542f\u52a8\u5feb\u4e86\u3002\u8fd9\u79cd\u5b8c\u5168\u201c\u8ddf\u624b\u201d\u7684\u611f\u89c9\u5728\u9ad8\u7aef\u673a\u4e0a\u4f53\u9a8c\u975e\u5e38\u597d\uff0c\u4f46\u5bf9\u4e8e\u4e2d\u4f4e\u7aef\u673a\uff0c\u4f1a\u628a\u603b\u7684\u7684\u95ea\u5c4f\u65f6\u95f4\u53d8\u5f97\u66f4\u957f\u3002</p> </li> <li> <p>\u5408\u5e76\u95ea\u5c4f\u548c\u4e3b\u9875\u9762\u7684 Activity  \u51cf\u5c11\u4e00\u4e2a Activity \u4f1a\u7ed9\u7ebf\u4e0a\u5e26\u6765 100 \u6beb\u79d2\u5de6\u53f3\u7684\u4f18\u5316\u3002\u4f46\u662f\u5982\u679c\u8fd9\u6837\u505a\u7684\u8bdd\uff0c\u7ba1\u7406\u65f6\u4f1a\u975e\u5e38\u590d\u6742\uff0c\u5728\u8fdb\u5165\u540e\u53f0\u518d\u901a\u8fc7\u6700\u8fd1\u4efb\u52a1\u680f\u542f\u52a8\u3001\u901a\u8fc7<code>Deep Link</code>\u542f\u52a8\u7b49\u542f\u52a8\u6d41\u7a0b\u4f1a\u6709\u4e0d\u5c11\u95ee\u9898\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u81ea\u5df1\u7ba1\u7406activity\u4efb\u52a1\u6808\u6765\u89e3\u51b3\u3002\u8b6c\u5982\u5bf9\u4e8e\u6211\u53f8\u9879\u76ee\uff0c\u6211\u901a\u8fc7<code>SingleTop+\u6808\u7ba1\u7406</code>\u5b9e\u73b0\u4e86\u7c7b\u4f3c<code>SingleTask</code>\u7684\u6548\u679c\u3002</p> </li> </ol> <p>\u4f8b\u5982\uff1a\u4e0b\u9762\u5c31\u662f\u6a21\u62df<code>SingleTask</code>\u7684 <code>cleanTop</code> \u64cd\u4f5c <pre><code>    protected void onCreate(Bundle savedInstanceState) {\nif (ActivityStackManager.getInstance().checkMainExist(this)) {\nsuper.onCreate(savedInstanceState);\n//\u5982\u679c\u4e3b\u9875\u9762\u5df2\u7ecf\u5b58\u5728\uff0c\u76f4\u63a5finish\u6389\u5f53\u524d\u9875\u9762\nfinish();\n//\u5e76\u4e14\u4e4b\u524d\u7684\u4e3b\u9875\u9762\u62c9\u5230\u524d\u53f0\nhandleForOriginActivity();\nreturn;\n}\n}\nprivate void handleForOriginActivity() {\nif (ActivityStackManager.getInstance().isAppForeground()) {\n//\u524d\u53f0\u76f4\u63a5\u6a21\u62dfnewIntent\u5373\u53ef\nmockSingleTaskLaunchMode();\n} else {\n//\u540e\u53f0\u65f6\u901a\u8fc7FLAG_ACTIVITY_REORDER_TO_FRONT\u91cd\u65b0\u62c9\u8d77\u5230\u524d\u53f0\nIntent originIntent = getIntent();\nif (originIntent == null || !originIntent.hasExtra(INTENT_EXTRA_FORCE_TO_FRONT)) {\nstartOriginActivityByReorderToFront(originIntent);\n}\n}\n}\nprivate void mockSingleTaskLaunchMode() {\nActivityStackManager.getInstance().finishActivitysTopofMain();\nMainActivity originMainActivity =\n(MainActivity) ActivityStackManager.getInstance().getMainActivity();\noriginMainActivity.onNewIntent(getIntent());\noriginMainActivity.onRestart();\noriginMainActivity.onStart();\noriginMainActivity.onResume();\n}\nprivate void startOriginActivityByReorderToFront(Intent originIntent) {\nIntent intent = new Intent();\nintent.setComponent(new ComponentName(this,\nMainActivity.class));\nif (originIntent != null) {\nBundle extras = originIntent.getExtras();\nif (extras == null) {\nextras = new Bundle();\n}\nextras.putBoolean(INTENT_EXTRA_FORCE_TO_FRONT, true);\nintent.putExtras(extras);\n}\nintent.addFlags(Intent.FLAG_ACTIVITY_NO_USER_ACTION);\nActivity firstMainActivity = ActivityStackManager.getInstance().getFirstMainActivity();\nif (firstMainActivity instanceof MainActivity) {\nfirstMainActivity.startActivity(intent);\n((MainActivity) firstMainActivity).onNewIntent(originIntent);\n}\n}\n</code></pre></p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#52","title":"5.2 \u4e1a\u52a1\u4f18\u5316","text":"<p>\u6211\u4eec\u9996\u5148\u9700\u8981\u68b3\u7406\u6e05\u695a\u5f53\u524d\u542f\u52a8\u8fc7\u7a0b\u6b63\u5728\u8fd0\u884c\u7684\u6bcf\u4e00\u4e2a\u6a21\u5757\uff0c\u54ea\u4e9b\u662f\u4e00\u5b9a\u9700\u8981\u7684\u3001\u54ea\u4e9b\u53ef\u4ee5\u780d\u6389\u3001\u54ea\u4e9b\u53ef\u4ee5\u61d2\u52a0\u8f7d\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u573a\u666f\u6765\u51b3\u5b9a\u4e0d\u540c\u7684\u542f\u52a8\u6a21\u5f0f\u3002\u5bf9\u4e8e\u4e2d\u4f4e\u7aef\u673a\u5668\uff0c\u6211\u4eec\u8981\u5b66\u4f1a\u964d\u7ea7\uff0c\u5b66\u4f1a\u63a8\u52a8\u4ea7\u54c1\u7ecf\u7406\u505a\u4e00\u4e9b\u529f\u80fd\u53d6\u820d\u3002\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u61d2\u52a0\u8f7d\u8981\u9632\u6b62\u96c6\u4e2d\u5316\uff0c\u5426\u5219\u5bb9\u6613\u51fa\u73b0\u9996\u9875\u663e\u793a\u540e\u7528\u6237\u65e0\u6cd5\u64cd\u4f5c\u7684\u60c5\u5f62\u3002</p> <p>\u4f18\u5316\u7b56\u7565\u5982\u4e0b</p> <ul> <li>\u5f02\u6b65\u5fc5\u8981\u4e14\u8017\u65f6\u4e1a\u52a1</li> <li>\u5ef6\u65f6\u52a0\u8f7d\u975e\u5fc5\u8981\u4f46\u8017\u65f6\u4e1a\u52a1</li> <li>\u5220\u9664\u975e\u5fc5\u8981\u9884\u52a0\u8f7d</li> <li>\u61d2\u52a0\u8f7d\u670d\u52a1\u6a21\u5757\uff0c\u4f8b\u5982\uff0c\u6211\u53d1\u73b0\u542f\u52a8\u8fc7\u7a0b\u5404\u79cd\u670d\u52a1\u6a21\u5757\u90fd\u662f\u76f4\u63a5\u521d\u59cb\u5316\u7684\uff0c\u4fee\u6539\u6210 \u670d\u52a1\u6ce8\u518c\u673a\u5236\uff0c\u7528\u65f6\u52a0\u8f7d\u3002</li> <li>\u4e3b\u7ebf\u7a0b\u5faa\u73af\u4e1a\u52a1\u9700\u8981\u7279\u522b\u6ce8\u610f\uff0c\u5f53\u5faa\u73af\u6570\u636e\u6e90\u662f\u52a8\u6001\u83b7\u53d6\u7684\uff0c\u7d2f\u8ba1\u6548\u679c\u53ef\u80fd\u4f1a\u5f88\u8017\u65f6\u3002 </li> </ul>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#53","title":"5.3 \u7ebf\u7a0b\u4f18\u5316","text":"<p>\u7ebf\u7a0b\u7684\u4f18\u5316\u4e3b\u8981\u5728\u4e8e \u51cf\u5c11 CPU \u8c03\u5ea6\u5e26\u6765\u7684\u6ce2\u52a8\uff0c\u8ba9\u5e94\u7528\u7684\u542f\u52a8\u65f6\u95f4\u66f4\u52a0\u7a33\u5b9a\u3002</p> <p>\u542f\u52a8\u8fc7\u7a0b\u4e2d\u5982\u679c\u6709\u592a\u591a\u7684\u7ebf\u7a0b\u4e00\u8d77\u542f\u52a8\uff0c\u4f1a\u5bfc\u81f4CPU\u65f6\u95f4\u7247\u62a2\u5360\u60c5\u51b5\u4e25\u91cd\uff0c\u5c24\u5176\u662f\u4f4e\u7aef\u673a\u3002\u8fd9\u6837\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0bSleep\u72b6\u6001\u53d8\u591a\uff0c\u4ece\u800c\u589e\u52a0\u542f\u52a8\u65f6\u95f4\u3002 </p> <p>\u7ebf\u7a0b\u5207\u6362\u7684\u6570\u636e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>sched</code> \u6587\u4ef6\u67e5\u770b(\u9700\u8981root\u6743\u9650) <pre><code>proc/[pid]/sched:\n  nr_voluntary_switches\uff1a     \u4e3b\u52a8\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u65e0\u6cd5\u83b7\u53d6\u6240\u9700\u8d44\u6e90\u5bfc\u81f4\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6700\u666e\u904d\u7684\u662fIO\u3002    nr_involuntary_switches\uff1a   \u88ab\u52a8\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\uff0c\u7ebf\u7a0b\u88ab\u7cfb\u7edf\u5f3a\u5236\u8c03\u5ea6\u5bfc\u81f4\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u4f8b\u5982\u5927\u91cf\u7ebf\u7a0b\u5728\u62a2\u5360CPU\u3002\n</code></pre> \u4f18\u5316\u7b56\u7565\u5982\u4e0b\uff1a</p> <ul> <li>\u4f7f\u7528\u7edf\u4e00\u7ebf\u7a0b\u6c60\u5e76\u4e14\u6839\u636e\u673a\u5668\u6027\u80fd\u63a7\u5236\u7ebf\u7a0b\u6570\u91cf</li> <li>\u5220\u9664\u975e\u5fc5\u8981\u7ebf\u7a0b\u64cd\u4f5c\uff0c\u8b6c\u5982\u6211\u4eec\u9879\u76ee<code>datamodel</code>\u7684<code>setter</code>\u65b9\u6cd5\u4f1a\u89e6\u53d1\u4f9d\u8d56\u7684<code>kvo</code>\u6a21\u5757\uff08\u7c7b\u4f3c<code>eventbus</code>\uff09\u7684\u7ebf\u7a0b\u64cd\u4f5c,\u542f\u52a8\u8fc7\u7a0b\u521b\u5efa<code>datamodel</code>\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u7684\u65b9\u5f0f\u4ee3\u66ff<code>setter</code>\u65b9\u5f0f\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u89e6\u53d1<code>kvo</code>\u6a21\u5757\u7684\u7ebf\u7a0b\u64cd\u4f5c\u3002</li> <li>\u5ef6\u65f6\u8fdb\u5165\u8c03\u5ea6\u961f\u5217\uff0c\u52a8\u8fc7\u7a0b\u4e0d\u9700\u8981\u7acb\u9a6c\u6267\u884c\u7684\u7ebf\u7a0b\u4efb\u52a1\u53ef\u4ee5\u5ef6\u8fdf\u6267\u884c</li> <li> <p>\u9501\u4f18\u5316</p> <ul> <li>\u5982\u679c\u4e3b\u7ebf\u7a0b\u548c\u522b\u7684\u7ebf\u7a0b\u7ade\u4e89\u9501\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u7b49\u5f85,\u9700\u8981\u6392\u67e5\u8fd9\u4e9b\u7b49\u5f85\u662f\u5426\u53ef\u4ee5\u4f18\u5316 \u901a\u8fc7<code>systrace</code> \u53ef\u4ee5\u770b\u5230\u9501\u7b49\u5f85\u7684\u4e8b\u4ef6 </li> <li>\u4f18\u5316\u4e0d\u5fc5\u8981\u7684\u9501\u6d88\u8017   \u901a\u8fc7<code>systrace</code> \u53ef\u4ee5\u770b\u5230\u9501\u672c\u8eab\u4e5f\u662f\u6709\u6027\u80fd\u8017\u635f\u7684   <ol> <li>\u80fd\u7528\u65e0\u9501\u6570\u636e\u7ed3\u6784\uff0c\u5c31\u4e0d\u8981\u7528\u9501\uff1b</li> <li>\u80fd\u9501\u533a\u5757\uff0c\u5c31\u4e0d\u8981\u9501\u6574\u4e2a\u65b9\u6cd5\u4f53\uff1b</li> <li>\u80fd\u7528\u5bf9\u8c61\u9501\uff0c\u5c31\u4e0d\u8981\u7528\u7c7b\u9501\u3002</li> </ol> </li> </ul> <p>JDK6\u540e,java\u5f00\u53d1\u56e2\u961f\u505a\u4e86\u5404\u79cd\u9501\u4f18\u5316\u3002\u6bd4\u5982\uff0c\u81ea\u65cb\u9501\uff0c\u81ea\u9002\u5e94\u81ea\u65cb\u9501\uff0c\u9501\u6d88\u9664\uff0c\u9501\u81a8\u80c0\uff0c\u8f7b\u91cf\u7ea7\u9501\uff0c\u504f\u5411\u9501\u7b49\u3002\u4f46\u662f\u65e5\u5e38\u5f00\u53d1\u4e2d\uff0c\u4f7f\u7528\u9501\u8fd8\u662f\u8981\u591a\u4e9b\u601d\u8003\u3002</p> </li> </ul> <p>\u4f18\u5316\u65b9\u6848\u5982\u4e0b\uff1a</p> <ol> <li>\u7f16\u8bd1\u671f\u6839\u636e\u5e03\u5c40XML\u52a8\u6001\u751f\u6210\u5e03\u5c40\u4ee3\u7801 \u7f16\u8bd1\u671f\u6839\u636e\u5e03\u5c40XML\u52a8\u6001\u751f\u6210\u5e03\u5c40\u4ee3\u7801\uff0c\u8fd9\u6837\u53ef\u4ee5\u8282\u7701\u6389\u5e03\u5c40<code>inflate</code>\u65f6\u95f4\uff0c\u5728\u4e2d\u4f4e\u7aef\u673a\u4e0a\u6709\u6bd4\u8f83\u53ef\u89c2\u7684\u6536\u76ca\u3002        \u7f16\u8bd1\u671f\u6839\u636e\u5e03\u5c40XML\u52a8\u6001\u751f\u6210\u5e03\u5c40\u4ee3\u7801\u53ef\u4ee5\u4f7f\u7528\u5f00\u6e90\u5e93X2C\u6765\u5b9e\u73b0\uff0c\u4e0d\u8fc7\u95ee\u9898\u6bd4\u8f83\u591a\uff0c\u9700\u8981\u81ea\u884c\u5b9a\u5236\u4fee\u6539</li> <li><code>SharedPreference</code> \u4f18\u5316    \u6211\u4eec\u5728\u542f\u52a8\u8fc7\u7a0b\u53ea\u9700\u8981\u8bfb\u53d6 <code>Setting.sp</code> \u7684\u51e0\u9879\u6570\u636e\uff0c\u4e0d\u8fc7 <code>SharedPreference</code> \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u8fd8\u662f\u8981\u5168\u90e8\u6570\u636e\u4e00\u8d77\u89e3\u6790\u3002\u5982\u679c\u5b83\u7684\u6570\u636e\u91cf\u8d85\u8fc7 1000 \u6761\uff0c\u542f\u52a8\u8fc7\u7a0b\u89e3\u6790\u65f6\u95f4\u53ef\u80fd\u5c31\u8d85\u8fc7 100 \u6beb\u79d2\u3002\u5982\u679c\u53ea\u89e3\u6790\u542f\u52a8\u8fc7\u7a0b\u7528\u5230\u7684\u6570\u636e\u9879\u5219\u4f1a\u5f88\u5927\u7a0b\u5ea6\u51cf\u5c11\u89e3\u6790\u65f6\u95f4\u3002\u6211\u4e48\u53ef\u4ee5\u4f7f\u7528\u5355\u72ec\u7684sp\u6587\u4ef6\u5b58\u50a8\u542f\u52a8\u8fc7\u7a0b\u4f7f\u7528\u7684\u6570\u636e\u9879</li> </ol>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#53-io","title":"5.3 IO\u4f18\u5316","text":"<p>\u5728\u8d1f\u8f7d\u8fc7\u9ad8\u7684\u65f6\u5019\uff0cI/O \u6027\u80fd\u4e0b\u964d\u5f97\u4f1a\u6bd4\u8f83\u5feb\u3002\u7279\u522b\u662f\u5bf9\u4e8e\u4f4e\u7aef\u673a\uff0c\u540c\u6837\u7684 I/O \u64cd\u4f5c\u8017\u65f6\u53ef\u80fd\u662f\u9ad8\u7aef\u673a\u5668\u7684\u51e0\u5341\u500d\u3002\u542f\u52a8\u8fc7\u7a0b\u4e0d\u5efa\u8bae\u51fa\u73b0\u7f51\u7edc I/O\uff0c\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u78c1\u76d8 I/O \u662f\u542f\u52a8\u4f18\u5316\u4e00\u5b9a\u8981\u62a0\u7684\u70b9\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#54","title":"5.4 \u7cfb\u7edf\u8c03\u7528\u4f18\u5316","text":"<ul> <li>\u5728\u542f\u52a8\u8fc7\u7a0b\uff0c\u6211\u4eec\u5c3d\u91cf\u4e0d\u8981\u505a\u7cfb\u7edf\u8c03\u7528\uff0c\u4f8b\u5982 <code>PackageManagerService</code> \u64cd\u4f5c\u3001<code>Binder</code> \u8c03\u7528\u7b49\u5f85\u3002</li> <li>\u5728\u542f\u52a8\u8fc7\u7a0b\u4e5f\u4e0d\u8981\u8fc7\u65e9\u5730\u62c9\u8d77\u5e94\u7528\u7684\u5176\u4ed6\u8fdb\u7a0b\uff0c<code>System Server</code> \u548c\u65b0\u7684\u8fdb\u7a0b\u90fd\u4f1a\u7ade\u4e89 CPU \u8d44\u6e90\u3002\u7279\u522b\u662f\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\u7684\u65f6\u5019\uff0c\u5f53\u6211\u4eec\u62c9\u8d77\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u53ef\u80fd\u4f1a\u6210\u4e3a\u201c\u538b\u6b7b\u9a86\u9a7c\u7684\u6700\u540e\u4e00\u6839\u7a3b\u8349\u201d\u3002\u5b83\u53ef\u80fd\u4f1a\u89e6\u53d1\u7cfb\u7edf\u7684 low memory killer \u673a\u5236\uff0c\u5bfc\u81f4\u7cfb\u7edf\u6740\u6b7b\u548c\u62c9\u8d77\uff08\u4fdd\u6d3b\uff09\u5927\u91cf\u7684\u8fdb\u7a0b\uff0c\u4ece\u800c\u5f71\u54cd\u524d\u53f0\u8fdb\u7a0b\u7684 CPU\u3002</li> </ul>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#55-gc","title":"5.5 GC \u4f18\u5316","text":"<p>\u5728\u542f\u52a8\u8fc7\u7a0b\uff0c\u8981\u5c3d\u91cf\u51cf\u5c11 GC \u7684\u6b21\u6570\uff0c\u907f\u514d\u9020\u6210\u4e3b\u7ebf\u7a0b\u957f\u65f6\u95f4\u7684\u5361\u987f\uff0c\u7279\u522b\u662f\u5bf9 Dalvik \u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 systrace \u5355\u72ec\u67e5\u770b\u6574\u4e2a\u542f\u52a8\u8fc7\u7a0b GC \u7684\u65f6\u95f4\u3002 <pre><code>python systrace.py dalvik -b 90960 -a com.sample.gc\n</code></pre> \u5bf9\u4e8e GC \u5404\u4e2a\u4e8b\u4ef6\u7684\u5177\u4f53\u542b\u4e49\uff0c\u53ef\u4ee5\u53c2\u8003\u67e5\u770bGC  \u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7cfb\u7edf\u63d0\u4f9b\u7684<code>Debug</code>API\u6765\u76d1\u63a7\u542f\u52a8\u8fc7\u7a0b\u603b <code>GC</code> \u7684\u8017\u65f6\u60c5\u51b5\uff0c\u7279\u522b\u662f<code>\u963b\u585e\u5f0f\u540c\u6b65 GC</code> \u7684\u603b\u6b21\u6570\u548c\u8017\u65f6\u3002</p> <p><pre><code>// GC\u4f7f\u7528\u7684\u603b\u8017\u65f6\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\nDebug.getRuntimeStat(\"art.gc.gc-time\");\n// \u963b\u585e\u5f0fGC\u7684\u603b\u8017\u65f6\nDebug.getRuntimeStat(\"art.gc.blocking-gc-time\");\n</code></pre> \u5982\u679c\u6211\u4eec\u53d1\u73b0\u4e3b\u7ebf\u7a0b\u51fa\u73b0\u6bd4\u8f83\u591a\u7684 <code>GC \u540c\u6b65\u7b49\u5f85</code>\uff0c\u90a3\u5c31\u9700\u8981\u901a\u8fc7 <code>Allocation</code> \u5de5\u5177\u505a\u8fdb\u4e00\u6b65\u7684\u5206\u6790\u3002\u542f\u52a8\u8fc7\u7a0b\u907f\u514d\u8fdb\u884c\u5927\u91cf\u7684\u5b57\u7b26\u4e32\u64cd\u4f5c\uff0c\u7279\u522b\u662f\u5e8f\u5217\u5316\u8ddf\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u3002\u4e00\u4e9b\u9891\u7e41\u521b\u5efa\u7684\u5bf9\u8c61\uff0c\u4f8b\u5982\u7f51\u7edc\u5e93\u548c\u56fe\u7247\u5e93\u4e2d\u7684 <code>Byte</code> \u6570\u7ec4\u3001<code>Buffer</code> \u53ef\u4ee5\u590d\u7528\u3002\u5982\u679c\u4e00\u4e9b\u6a21\u5757\u5b9e\u5728\u9700\u8981\u9891\u7e41\u521b\u5efa\u5bf9\u8c61\uff0c\u53ef\u4ee5\u8003\u8651\u79fb\u5230 <code>Native</code> \u5b9e\u73b0\u3002</p> <p>Java \u5bf9\u8c61\u7684\u9003\u9038\u4e5f\u5f88\u5bb9\u6613\u5f15\u8d77 GC \u95ee\u9898\uff0c\u6211\u4eec\u5728\u5199\u4ee3\u7801\u7684\u65f6\u5019\u6bd4\u8f83\u5bb9\u6613\u5ffd\u7565\u8fd9\u4e2a\u70b9\u3002\u6211\u4eec\u5e94\u8be5\u4fdd\u8bc1\u5bf9\u8c61\u751f\u547d\u5468\u671f\u5c3d\u91cf\u7684\u77ed\uff0c\u5728\u6808\u4e0a\u5c31\u8fdb\u884c\u9500\u6bc1\u3002(\u5982\u5c3d\u91cf\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf)</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#56","title":"5.6 \u6570\u636e\u91cd\u6392","text":"<p>Linux \u6587\u4ef6\u7cfb\u7edf\u4ece\u78c1\u76d8\u8bfb\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u4ee5 block \u4e3a\u5355\u4f4d\u53bb\u78c1\u76d8\u8bfb\u53d6\uff0c\u4e00\u822c block \u5927\u5c0f\u662f 4KB\u3002\u4e5f\u5c31\u662f\u8bf4\u4e00\u6b21\u78c1\u76d8\u8bfb\u5199\u5927\u5c0f\u81f3\u5c11\u662f 4KB\uff0c\u7136\u540e\u4f1a\u628a 4KB \u6570\u636e\u653e\u5230\u9875\u7f13\u5b58 Page Cache \u4e2d\u3002\u5982\u679c\u4e0b\u6b21\u8bfb\u53d6\u6587\u4ef6\u6570\u636e\u5df2\u7ecf\u5728\u9875\u7f13\u5b58\u4e2d\uff0c\u90a3\u5c31\u4e0d\u4f1a\u53d1\u751f\u771f\u5b9e\u7684\u78c1\u76d8 I/O\uff0c\u800c\u662f\u76f4\u63a5\u4ece\u9875\u7f13\u5b58\u4e2d\u8bfb\u53d6\uff0c\u5927\u5927\u63d0\u5347\u4e86\u8bfb\u7684\u901f\u5ea6 </p> <p>Dex \u6587\u4ef6\u7528\u7684\u5230\u7684\u7c7b\u548c\u5b89\u88c5\u5305 APK \u91cc\u9762\u5404\u79cd\u8d44\u6e90\u6587\u4ef6\u4e00\u822c\u90fd\u6bd4\u8f83\u5c0f\uff0c\u4f46\u662f\u8bfb\u53d6\u975e\u5e38\u9891\u7e41\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u7cfb\u7edf\u8fd9\u4e2a\u673a\u5236\u5c06\u5b83\u4eec\u6309\u7167\u8bfb\u53d6\u987a\u5e8f\u91cd\u65b0\u6392\u5217\uff0c\u51cf\u5c11\u771f\u5b9e\u7684\u78c1\u76d8 I/O \u6b21\u6570\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#561","title":"5.6.1 \u7c7b\u91cd\u6392","text":"<p>\u542f\u52a8\u8fc7\u7a0b\u7c7b\u52a0\u8f7d\u987a\u5e8f\u53ef\u4ee5\u901a\u8fc7\u590d\u5199 ClassLoader \u5f97\u5230\u3002 <pre><code>class GetClassLoader extends PathClassLoader {\npublic Class&lt;?&gt; findClass(String name) {\n// \u5c06 name \u8bb0\u5f55\u5230\u6587\u4ef6\nwriteToFile(name\uff0c\"coldstart_classes.txt\");\nreturn super.findClass(name);\n}\n}\n</code></pre> \u7136\u540e\u901a\u8fc7FaceBook\u5f00\u6e90\u7684ReDex \u7684Interdex\u8c03\u6574\u7c7b\u5728 Dex \u4e2d\u7684\u6392\u5217\u987a\u5e8f\uff0c\u6700\u540e\u53ef\u4ee5\u5229\u7528 010 Editor \u67e5\u770b\u4fee\u6539\u540e\u7684\u6548\u679c\u3002 </p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#562","title":"5.6.2 \u8d44\u6e90\u6587\u4ef6\u91cd\u6392","text":"<p>Facebook \u5728\u6bd4\u8f83\u65e9\u7684\u65f6\u5019\u5c31\u4f7f\u7528\u201c\u8d44\u6e90\u70ed\u56fe\u201d\u6765\u5b9e\u73b0\u8d44\u6e90\u6587\u4ef6\u7684\u91cd\u6392\uff0c\u652f\u4ed8\u5b9d\u5728\u300a\u901a\u8fc7\u5b89\u88c5\u5305\u91cd\u6392\u5e03\u4f18\u5316 Android \u7aef\u542f\u52a8\u6027\u80fd\u300b\u4e2d\u4e5f\u8be6\u7ec6\u8bb2\u8ff0\u4e86\u8d44\u6e90\u91cd\u6392\u7684\u539f\u7406\u548c\u843d\u5730\u65b9\u6cd5\u3002\u5728\u5b9e\u73b0\u4e0a\uff0c\u5b83\u4eec\u90fd\u662f\u901a\u8fc7\u4fee\u6539 Kernel \u6e90\u7801\uff0c\u5355\u72ec\u7f16\u8bd1\u4e86\u4e00\u4e2a\u7279\u6b8a\u7684 ROM\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u6709\u4e09\u4e2a\uff1a</p> <ul> <li>\u7edf\u8ba1\u3002\u7edf\u8ba1\u5e94\u7528\u542f\u52a8\u8fc7\u7a0b\u52a0\u8f7d\u4e86\u5b89\u88c5\u5305\u4e2d\u54ea\u4e9b\u8d44\u6e90\u6587\u4ef6\uff0c\u6bd4\u5982 assets\u3001drawable\u3001layout \u7b49\u3002\u8ddf\u7c7b\u91cd\u6392\u4e00\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u8d44\u6e90\u52a0\u8f7d\u7684\u987a\u5e8f\u5217\u8868\u3002</li> <li>\u5ea6\u91cf\u3002\u5728\u5b8c\u6210\u8d44\u6e90\u987a\u5e8f\u91cd\u6392\u540e\uff0c\u6211\u4eec\u9700\u8981\u786e\u5b9a\u662f\u5426\u771f\u6b63\u751f\u6548\u3002\u6bd4\u5982\u6709\u54ea\u4e9b\u8d44\u6e90\u6587\u4ef6\u52a0\u8f7d\u4e86\uff0c\u5b83\u662f\u53d1\u751f\u771f\u5b9e\u7684\u78c1\u76d8 I/O\uff0c\u8fd8\u662f\u547d\u4e2d\u4e86 Page Cache\u3002</li> <li>\u81ea\u52a8\u5316\u3002\u4efb\u4f55\u4ee3\u7801\u63d0\u4ea4\u90fd\u6709\u53ef\u80fd\u6539\u53d8\u542f\u52a8\u8fc7\u7a0b\u4e2d\u7c7b\u548c\u8d44\u6e90\u7684\u52a0\u8f7d\u987a\u5e8f\uff0c\u5982\u679c\u5b8c\u5168\u4f9d\u9760\u4eba\u5de5\u624b\u52a8\u5904\u7406\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u5f88\u96be\u6301\u7eed\u4e0b\u53bb\u3002\u901a\u8fc7\u5b9a\u5236 ROM \u7684\u4e00\u4e9b\u57cb\u70b9\u548c\u914d\u5408\u7684\u5de5\u5177\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u4eec\u653e\u5230\u81ea\u52a8\u5316\u6d41\u7a0b\u5f53\u4e2d\u3002 \u4e8b\u5b9e\u4e0a\u5982\u679c\u4ec5\u4ec5\u4e3a\u4e86\u7edf\u8ba1\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 Hook \u7684\u65b9\u5f0f\u3002\u4e0b\u9762\u662f\u5229\u7528 Frida \u5b9e\u73b0\u83b7\u5f97 Android \u8d44\u6e90\u52a0\u8f7d\u987a\u5e8f\u7684\u65b9\u6cd5\u3002 <pre><code>resourceImpl.loadXmlResourceParser.implementation=function(a,b,c,d){\nsend('file:'+a)\nreturn this.loadXmlResourceParser(a,b,c,d)\n}\nresourceImpl.loadDrawableForCookie.implementation=function(a,b,c,d,e){\nsend(\"file:\"+a)\nreturn this.loadDrawableForCookie(a,b,c,d,e)\n}\n</code></pre> \u8c03\u6574\u5b89\u88c5\u5305\u6587\u4ef6\u6392\u5217\u9700\u8981\u4fee\u6539 <code>7zip</code> \u6e90\u7801\u5b9e\u73b0\u652f\u6301\u4f20\u5165\u6587\u4ef6\u5217\u8868\u987a\u5e8f\uff0c\u540c\u6837\u6700\u540e\u53ef\u4ee5\u5229\u7528 <code>010 Editor</code> \u67e5\u770b\u4fee\u6539\u540e\u7684\u6548\u679c\u3002  \u8fd9\u4e24\u4e2a\u4f18\u5316\u53ef\u80fd\u4f1a\u5e26\u6765 100\uff5e200 \u6beb\u79d2\u7684\u63d0\u9ad8\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u542f\u52a8\u8fc7\u7a0b I/O \u7684\u65f6\u95f4\u6ce2\u52a8\u3002\u7279\u522b\u662f\u5bf9\u4e8e\u4e2d\u4f4e\u7aef\u673a\u5668\u6765\u8bf4\uff0c\u7ecf\u5e38\u53d1\u73b0\u542f\u52a8\u65f6\u95f4\u6ce2\u52a8\u975e\u5e38\u5927\uff0c\u8fd9\u4e2a\u6ce2\u52a8\u8ddf CPU \u8c03\u5ea6\u76f8\u5173\uff0c\u4f46\u66f4\u591a\u65f6\u5019\u662f\u8ddf I/O \u76f8\u5173\u3002</li> </ul>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#57","title":"5.7 \u53bb\u6389\u7c7b\u6821\u9a8c","text":"<p>\u5728\u52a0\u8f7d\u7c7b\u7684\u8fc7\u7a0b\u6709\u4e00\u4e2a <code>verify class</code> \u7684\u6b65\u9aa4\uff0c\u5b83\u9700\u8981\u6821\u9a8c\u65b9\u6cd5\u7684\u6bcf\u4e00\u4e2a\u6307\u4ee4\uff0c\u662f\u4e00\u4e2a\u6bd4\u8f83\u8017\u65f6\u7684\u64cd\u4f5c\u3002  \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Hook \u6765\u53bb\u6389 verify \u8fd9\u4e2a\u6b65\u9aa4\uff0c\u8fd9\u5bf9\u542f\u52a8\u901f\u5ea6\u6709\u51e0\u5341\u6beb\u79d2\u7684\u4f18\u5316\u3002\u4e0d\u8fc7\u5176\u5b9e\u6700\u5927\u7684\u4f18\u5316\u573a\u666f\u5728\u4e8e\u9996\u6b21\u548c\u8986\u76d6\u5b89\u88c5\u65f6\u3002\u4ee5 <code>Dalvik</code> \u5e73\u53f0\u4e3a\u4f8b\uff0c\u4e00\u4e2a 2MB \u7684 Dex \u6b63\u5e38\u9700\u8981 350 \u6beb\u79d2\uff0c\u5c06 <code>classVerifyMode</code> \u8bbe\u4e3a <code>VERIFY_MODE_NONE</code> \u540e\uff0c\u53ea\u9700\u8981 150 \u6beb\u79d2\uff0c\u8282\u7701\u8d85\u8fc7 50% \u7684\u65f6\u95f4\u3002</p> <p><pre><code>// Dalvik Globals.h\ngDvm.classVerifyMode = VERIFY_MODE_NONE;\n// Art runtime.cc\nverify_ = verifier::VerifyMode::kNone;\n</code></pre> \u4f46\u662f ART \u5e73\u53f0\u8981\u590d\u6742\u5f88\u591a\uff0cHook \u9700\u8981\u517c\u5bb9\u51e0\u4e2a\u7248\u672c\u3002\u800c\u4e14\u5728\u5b89\u88c5\u65f6\u5927\u90e8\u5206 Dex \u5df2\u7ecf\u4f18\u5316\u597d\u4e86\uff0c\u53bb\u6389 ART \u5e73\u53f0\u7684 verify \u53ea\u4f1a\u5bf9\u52a8\u6001\u52a0\u8f7d\u7684 Dex \u5e26\u6765\u4e00\u4e9b\u597d\u5904\u3002 \u8fd9\u4e2a\u9ed1\u79d1\u6280\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u9996\u6b21\u542f\u52a8\u7684\u901f\u5ea6\uff0c\u4ee3\u4ef7\u662f\u5bf9\u540e\u7eed\u8fd0\u884c\u4f1a\u4ea7\u751f\u8f7b\u5fae\u7684\u5f71\u54cd\u3002\u540c\u65f6\u4e5f\u8981\u8003\u8651\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u6682\u65f6\u4e0d\u5efa\u8bae\u5728 ART \u5e73\u53f0\u4f7f\u7528</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#6","title":"6. \u76d1\u63a7","text":"<p>\u7ec8\u4e8e\u5343\u8f9b\u4e07\u82e6\u7684\u4f18\u5316\u597d\u4e86\uff0c\u6211\u4eec\u8fd8\u8981\u627e\u4e00\u5957\u5408\u7406\u3001\u51c6\u786e\u7684\u65b9\u6cd5\u6765\u5ea6\u91cf\u4f18\u5316\u7684\u6210\u679c\u3002\u540c\u65f6\u8fd8\u8981\u5bf9\u5b83\u505a\u5168\u65b9\u4f4d\u7684\u76d1\u63a7\uff0c\u4ee5\u514d\u88ab\u4eba\u7834\u574f\u52b3\u52a8\u679c\u5b9e\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#61","title":"6.1 \u5b9e\u9a8c\u5ba4\u76d1\u63a7","text":"<p>\u5982\u679c\u60f3\u5ba2\u89c2\u5730\u53cd\u6620\u542f\u52a8\u7684\u8017\u65f6\uff0c\u89c6\u9891\u5f55\u5236\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u9009\u62e9\u3002\u7279\u522b\u662f\u6211\u4eec\u5f88\u96be\u62ff\u5230\u7ade\u54c1\u7684\u7ebf\u4e0a\u6570\u636e\uff0c\u6240\u4ee5\u5b9e\u9a8c\u5ba4\u76d1\u63a7\u4e5f\u975e\u5e38\u9002\u5408\u505a\u7ade\u54c1\u7684\u5bf9\u6bd4\u6d4b\u8bd5\u3002\u5b83\u7684\u96be\u70b9\u5728\u4e8e\u5982\u4f55\u8ba9\u5b9e\u9a8c\u7cfb\u7edf\u51c6\u786e\u5730\u627e\u5230\u542f\u52a8\u7ed3\u675f\u7684\u70b9\uff0c\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f\u3002</p> <ul> <li><code>80%</code> \u7ed8\u5236\u3002\u5f53\u9875\u9762\u7ed8\u5236\u8d85\u8fc7 80% \u7684\u65f6\u5019\u8ba4\u4e3a\u662f\u542f\u52a8\u5b8c\u6210\uff0c\u4e0d\u8fc7\u53ef\u80fd\u4f1a\u628a\u95ea\u5c4f\u5f53\u6210\u542f\u52a8\u7ed3\u675f\u7684\u70b9\uff0c\u4e0d\u4e00\u5b9a\u662f\u6211\u4eec\u6240\u671f\u671b\u7684\u3002</li> <li>\u56fe\u50cf\u8bc6\u522b\u3002\u624b\u52a8\u8f93\u5165\u4e00\u5f20\u542f\u52a8\u7ed3\u675f\u7684\u56fe\u7247\uff0c\u5f53\u5b9e\u9a8c\u7cfb\u7edf\u8ba4\u4e3a\u5f53\u524d\u622a\u5c4f\u9875\u9762\u6709 <code>80%</code>\u4ee5\u4e0a\u76f8\u4f3c\u5ea6\u65f6\uff0c\u5c31\u8ba4\u4e3a\u662f\u542f\u52a8\u7ed3\u675f\u3002\u8fd9\u79cd\u65b9\u6cd5\u66f4\u52a0\u7075\u6d3b\u53ef\u63a7\uff0c\u4f46\u662f\u5b9e\u73b0\u96be\u5ea6\u4f1a\u7a0d\u5fae\u9ad8\u4e00\u70b9\u3002 </li> </ul> <p>\u542f\u52a8\u7684\u5b9e\u9a8c\u5ba4\u76d1\u63a7\u53ef\u4ee5\u5b9a\u671f\u81ea\u52a8\u53bb\u8dd1\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u5e94\u8be5\u8986\u76d6\u9ad8\u3001\u4e2d\u3001\u4f4e\u7aef\u673a\u4e0d\u540c\u7684\u573a\u666f\u3002\u4f46\u662f\u4f7f\u7528\u5f55\u5c4f\u7684\u65b9\u5f0f\u4e5f\u6709\u4e00\u4e2a\u7f3a\u9677\uff0c\u5c31\u662f\u51fa\u73b0\u95ee\u9898\u65f6\u6211\u4eec\u9700\u8981\u4eba\u5de5\u4e8c\u6b21\u5b9a\u4f4d\u5177\u4f53\u662f\u4ec0\u4e48\u4ee3\u7801\u6240\u5bfc\u81f4\u7684\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#62","title":"6.2 \u7ebf\u4e0a\u76d1\u63a7","text":"<p>\u5b9e\u9a8c\u5ba4\u8986\u76d6\u7684\u573a\u666f\u548c\u673a\u578b\u8fd8\u662f\u6709\u9650\u7684\uff0c\u662f\u9a74\u662f\u9a6c\u6211\u4eec\u8fd8\u662f\u8981\u53d1\u5e03\u5230\u7ebf\u4e0a\u8fdb\u884c\u9a8c\u8bc1\u3002\u9488\u5bf9\u7ebf\u4e0a\uff0c\u542f\u52a8\u76d1\u63a7\u4f1a\u66f4\u52a0\u590d\u6742\u4e00\u4e9b\u3002Android Vitals\u53ef\u4ee5\u5bf9\u5e94\u7528\u51b7\u542f\u52a8\u3001\u6e29\u542f\u52a8\u65f6\u95f4\u505a\u76d1\u63a7\u3002 </p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6bcf\u4e2a\u5e94\u7528\u542f\u52a8\u7684\u6d41\u7a0b\u90fd\u975e\u5e38\u590d\u6742\uff0c\u4e0a\u9762\u7684\u56fe\u5e76\u4e0d\u80fd\u771f\u5b9e\u53cd\u6620\u6bcf\u4e2a\u5e94\u7528\u7684\u542f\u52a8\u8017\u65f6\u3002\u542f\u52a8\u8017\u65f6\u7684\u8ba1\u7b97\u9700\u8981\u8003\u8651\u975e\u5e38\u591a\u7684\u7ec6\u8282\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u542f\u52a8\u7ed3\u675f\u7684\u7edf\u8ba1\u65f6\u673a\u3002\u662f\u5426\u662f\u4f7f\u7528\u7528\u6237\u771f\u6b63\u53ef\u4ee5\u64cd\u4f5c\u7684\u65f6\u95f4\u4f5c\u4e3a\u542f\u52a8\u7ed3\u675f\u7684\u65f6\u95f4\u3002</li> <li>\u542f\u52a8\u65f6\u95f4\u6263\u9664\u7684\u903b\u8f91\u3002\u95ea\u5c4f\u3001\u5e7f\u544a\u548c\u65b0\u624b\u5f15\u5bfc\u8fd9\u4e9b\u65f6\u95f4\u90fd\u5e94\u8be5\u4ece\u542f\u52a8\u65f6\u95f4\u91cc\u6263\u9664\u3002</li> <li>\u542f\u52a8\u6392\u9664\u903b\u8f91\u3002Broadcast\u3001Server \u62c9\u8d77\uff0c\u542f\u52a8\u8fc7\u7a0b\u8fdb\u5165\u540e\u53f0\u8fd9\u4e9b\u90fd\u9700\u8981\u6392\u9664\u51fa\u7edf\u8ba1\u3002</li> </ul> <p>\u7ecf\u8fc7\u7cbe\u5bc6\u7684\u6263\u9664\u548c\u6392\u9664\u903b\u8f91\uff0c\u6211\u4eec\u6700\u7ec8\u53ef\u4ee5\u5f97\u5230\u7528\u6237\u7684\u7ebf\u4e0a\u542f\u52a8\u8017\u65f6\u3002\u51c6\u786e\u7684\u542f\u52a8\u8017\u65f6\u7edf\u8ba1\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u6709\u5f88\u591a\u4f18\u5316\u5728\u5b9e\u9a8c\u5ba4\u5b8c\u6210\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u5728\u7ebf\u4e0a\u7070\u5ea6\u9a8c\u8bc1\u6548\u679c\u3002\u8fd9\u4e2a\u524d\u63d0\u662f\u542f\u52a8\u7edf\u8ba1\u662f\u51c6\u786e\u7684\uff0c\u6574\u4e2a\u6548\u679c\u8bc4\u4f30\u662f\u771f\u5b9e\u7684\u3002 \u90a3\u6211\u4eec\u4e00\u822c\u4f7f\u7528\u4ec0\u4e48\u6307\u6807\u6765\u8861\u91cf\u542f\u52a8\u901f\u5ea6\u7684\u5feb\u6162\u5462\uff1f \u5f88\u591a\u5e94\u7528\u91c7\u7528\u5e73\u5747\u542f\u52a8\u65f6\u95f4\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u6307\u6807\u5176\u5b9e\u5e76\u4e0d\u592a\u597d\uff0c\u4e00\u4e9b\u4f53\u9a8c\u5f88\u5dee\u7684\u7528\u6237\u5f88\u6709\u53ef\u80fd\u662f\u88ab\u5e73\u5747\u4e86\u3002 \u6211\u66f4\u5efa\u8bae\u4f7f\u7528\u7c7b\u4f3c\u4e0b\u9762\u7684\u6307\u6807\uff1a</p> <ul> <li>\u5feb\u5f00\u6162\u5f00\u6bd4\u3002\u4f8b\u5982 2 \u79d2\u5feb\u5f00\u6bd4\u30015 \u79d2\u6162\u5f00\u6bd4\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u591a\u5c11\u6bd4\u4f8b\u7684\u7528\u6237\u4f53\u9a8c\u975e\u5e38\u597d\uff0c\u591a\u5c11\u6bd4\u4f8b\u7684\u7528\u6237\u6bd4\u8f83\u69fd\u7cd5\u3002</li> <li>90% \u7528\u6237\u7684\u542f\u52a8\u65f6\u95f4\u3002\u5982\u679c 90% \u7684\u7528\u6237\u542f\u52a8\u65f6\u95f4\u90fd\u5c0f\u4e8e 5 \u79d2\uff0c\u90a3\u4e48\u6211\u4eec 90% \u533a\u95f4\u542f\u52a8\u8017\u65f6\u5c31\u662f 5 \u79d2\u3002</li> </ul> <p>\u6b64\u5916\u6211\u4eec\u8fd8\u8981\u533a\u5206\u542f\u52a8\u7684\u7c7b\u578b\u3002\u8fd9\u91cc\u8981\u7edf\u8ba1\u9996\u6b21\u5b89\u88c5\u542f\u52a8\u3001\u8986\u76d6\u5b89\u88c5\u542f\u52a8\u3001\u51b7\u542f\u52a8\u548c\u6e29\u542f\u52a8\u8fd9\u4e9b\u7c7b\u578b\uff0c\u4e00\u822c\u6211\u4eec\u90fd\u4f7f\u7528\u666e\u901a\u7684 \u51b7\u542f\u52a8\u65f6\u95f4 \u4f5c\u4e3a\u6307\u6807\u3002\u53e6\u4e00\u65b9\u9762\u70ed\u542f\u52a8\u7684\u5360\u6bd4\u4e5f\u53ef\u4ee5\u53cd\u6620\u51fa\u6211\u4eec\u7a0b\u5e8f\u7684\u6d3b\u8dc3\u6216\u4fdd\u6d3b\u80fd\u529b\u3002</p> <p>\u9664\u4e86\u6307\u6807\u7684\u76d1\u63a7\uff0c\u542f\u52a8\u7684\u7ebf\u4e0a\u5806\u6808\u76d1\u63a7\u66f4\u52a0\u56f0\u96be\u3002Facebook \u4f1a\u5229\u7528 Profilo \u5de5\u5177\u5bf9\u542f\u52a8\u7684\u6574\u4e2a\u6d41\u7a0b\u8017\u65f6\u505a\u76d1\u63a7\uff0c\u5e76\u4e14\u5728\u540e\u53f0\u76f4\u63a5\u5bf9\u4e0d\u540c\u7684\u7248\u672c\u505a\u81ea\u52a8\u5316\u5bf9\u6bd4\uff0c\u76d1\u63a7\u65b0\u7248\u672c\u662f\u5426\u6709\u65b0\u589e\u8017\u65f6\u7684\u51fd\u6570\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#7","title":"7. \u603b\u7ed3","text":"<p>\u5728\u8fd9\u4e48\u591a\u7684\u4f18\u5316\u65b9\u6848\u4e2d\uff0c\u4e1a\u52a1\u4f18\u5316\u662f\u6700\u5feb\u51fa\u6210\u679c\u540c\u65f6\u4e5f\u662f\u98ce\u9669\u6700\u5c0f\u7684\u3002\u5f88\u591a\u4ea7\u54c1\u7ecf\u7406\u4e3a\u4e86\u63d0\u5347\u81ea\u5df1\u8d1f\u8d23\u7684\u6a21\u5757\u7684\u6570\u636e\uff0c\u603b\u4f1a\u903c\u8feb\u5f00\u53d1\u505a\u5404\u79cd\u5404\u6837\u7684\u9884\u52a0\u8f7d\u3002\u6bd4\u5982\u53ea\u6709 1% \u7528\u6237\u4f7f\u7528\u7684\u529f\u80fd\uff0c\u5374\u8ba9\u6240\u6709\u7528\u6237\u90fd\u505a\u9884\u52a0\u8f7d\u3002\u9762\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u8981\u72e0\u4e0b\u5fc3\u6765\uff0c\u53ea\u7559\u4e0b\u90a3\u4e9b\u771f\u6b63\u4e0d\u80fd\u5220\u9664\u7684\u4e1a\u52a1\uff0c\u6216\u8005\u901a\u8fc7\u573a\u666f\u5316\u76f4\u63a5\u627e\u5230\u90a3 1% \u7684\u7528\u6237\u3002\u8ddf\u4ea7\u54c1\u7ecf\u7406 PK \u53ef\u80fd\u4e0d\u662f\u90a3\u4e48\u5bb9\u6613\uff0c\u5173\u952e\u5728\u4e8e \u6570\u636e\u3002\u6211\u4eec\u9700\u8981\u8bc1\u660e\u542f\u52a8\u4f18\u5316\u5e26\u6765\u6574\u4f53\u7559\u5b58\u3001\u8f6c\u5316\u7684\u6b63\u5411\u4ef7\u503c\uff0c\u662f\u5927\u4e8e\u67d0\u4e2a\u4e1a\u52a1\u53d6\u6d88\u9884\u52a0\u8f7d\u5e26\u6765\u7684\u8d1f\u9762\u5f71\u54cd\u3002</p> <p>\u542f\u52a8\u4f18\u5316\u9700\u8981\u8010\u5f97\u4f4f\u5bc2\u5bde\uff0c\u628a\u6574\u4e2a\u6d41\u7a0b\u6478\u6e05\u6478\u900f\uff0c\u4e00\u70b9\u70b9\u628a\u65f6\u95f4\u62a0\u51fa\u6765\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u4f4e\u7aef\u673a\u548c\u7cfb\u7edf\u7e41\u5fd9\u7684\u573a\u666f\u3002\u5f53\u6211\u4eec\u8db3\u591f\u719f\u6089\u5e95\u5c42\u7684\u77e5\u8bc6\u65f6\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528\u7cfb\u7edf\u7684\u7279\u6027\u53bb\u505a\u66f4\u52a0\u6df1\u5c42\u6b21\u7684\u4f18\u5316\u3002</p> <p>\u5bf9\u4e8e\u542f\u52a8\u4f18\u5316\u8981\u8b66\u60d5 KPI \u5316\uff0c\u6211\u4eec\u8981\u89e3\u51b3\u7684\u4e0d\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u800c\u662f\u7528\u6237\u771f\u6b63\u7684\u4f53\u9a8c\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/launch/Android-launch-opt/#8","title":"8 \u53c2\u8003","text":"<p>Android \u9ad8\u624b\u8bfe</p> <p>Android app \u542f\u52a8\u6d41\u7a0b\u5206\u6790</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/","title":"Android\u53e5\u67c4\u6cc4\u6f0f\u5206\u6790","text":""},{"location":"perf-opt/Android/memory/Android_fd_leak/#1","title":"1. \u57fa\u672c\u6982\u5ff5","text":""},{"location":"perf-opt/Android/memory/Android_fd_leak/#11","title":"1.1 \u4ec0\u4e48\u662f\u53e5\u67c4","text":"<p>\u53e5\u67c4(<code>file descriptor</code>)\u5373\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5728 Linux \u4e2d\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u7cfb\u7edf\u5728\u8fd0\u884c\u65f6\u6709\u5927\u91cf\u7684\u6587\u4ef6\u64cd\u4f5c\uff0c\u5185\u6838\u4e3a\u4e86\u9ad8\u6548\u7ba1\u7406\u5df2\u88ab\u6253\u5f00\u7684\u6587\u4ef6\u4f1a\u521b\u5efa\u7d22\u5f15\uff0c\u7528\u6765\u6307\u5411\u88ab\u6253\u5f00\u7684\u6587\u4ef6\uff0c\u8fd9\u4e2a\u7d22\u5f15\u5373\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5176\u8868\u73b0\u5f62\u5f0f\u4e3a\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\u3002\u7531\u4e8eAndroid\u57fa \u4e8eLinux \u7cfb\u7edf\uff0c\u6240\u4ee5Android\u4e5f\u7ee7\u627f\u4e86\u6587\u4ef6\u63cf\u8ff0\u7b26\u7cfb\u7edf\u3002</p> <p>\u5728adb shell\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 <code>ls -la /proc/{pid}/fd</code> \u67e5\u770b\u5f53\u524d\u8fdb\u7a0b\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f7f\u7528\u4fe1\u606f\uff0c\u6267\u884c\u8be5\u64cd\u4f5c\u9700\u8981root\u540e\u7684\u624b\u673a</p> <pre><code>root@x86:/ # ls -la /proc/732/fd\nlrwx------ root     root              2021-10-24 23:53 0 -&gt; /dev/null\nlrwx------ root     root              2021-10-24 23:53 1 -&gt; /dev/null\nlr-x------ root     root              2021-10-24 23:53 10 -&gt; /dev/__properties__\nlrwx------ root     root              2021-10-24 23:53 11 -&gt; anon_inode:[eventpoll]\nlr-x------ root     root              2021-10-24 23:53 12 -&gt; /dev/urandom\nlr-x------ root     root              2021-10-24 23:53 13 -&gt; /system/priv-app/SystemUI/SystemUI.apk\nlrwx------ root     root              2021-10-24 23:53 14 -&gt; anon_inode:[eventfd]\nlrwx------ root     root              2021-10-24 23:53 15 -&gt; anon_inode:[eventpoll]\nlrwx------ root     root              2021-10-24 23:53 16 -&gt; anon_inode:[eventfd]\nlrwx------ root     root              2021-10-24 23:53 17 -&gt; socket:[12554]\nlrwx------ root     root              2021-10-24 23:53 18 -&gt; anon_inode:[eventpoll]\nlrwx------ root     root              2021-10-24 23:53 19 -&gt; anon_inode:[eventfd]\nlrwx------ root     root              2021-10-24 23:53 2 -&gt; /dev/null\nlrwx------ root     root              2021-10-24 23:53 20 -&gt; anon_inode:[eventpoll]\nlrwx------ root     root              2021-10-24 23:53 21 -&gt; anon_inode:[eventfd]\nlrwx------ root     root              2021-10-24 23:53 22 -&gt; anon_inode:[eventpoll]\nlrwx------ root     root              2021-10-24 23:53 23 -&gt; anon_inode:[eventfd]\nlrwx------ root     root              2021-10-24 23:53 24 -&gt; anon_inode:[eventpoll]\nlrwx------ root     root              2021-10-24 23:53 25 -&gt; /dev/nemuguest\nlrwx------ root     root              2021-10-24 23:53 26 -&gt; socket:[12668]\nlrwx------ root     root              2021-10-24 23:53 27 -&gt; /dev/vtunnel\nlrwx------ root     root              2021-10-24 23:53 28 -&gt; /dev/vtunnel\nlrwx------ root     root              2021-10-24 23:53 29 -&gt; socket:[12727]\nlrwx------ root     root              2021-10-24 23:53 3 -&gt; socket:[11857]\nlrwx------ root     root              2021-10-24 23:53 31 -&gt; socket:[15743]\nlrwx------ root     root              2021-10-24 23:53 32 -&gt; /dev/ashmem\nl-wx------ root     root              2021-10-24 23:53 4 -&gt; /sys/kernel/debug/tracing/trace_marker\n</code></pre> <p>\u4e0a\u56fe\u4e2d \u7bad\u5934\u524d\u7684\u6570\u5b57\u90e8\u5206\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u7bad\u5934\u6307\u5411\u7684\u90e8\u5206\u662f\u5bf9\u5e94\u7684\u6587\u4ef6\u4fe1\u606f\u3002</p> <p></p> <p>\u540c\u65f6\u901a\u8fc7<code>ls -al /proc/{pid}/fd | wc -l</code>\u6765\u67e5\u770b\u67e5\u770b\u8fdb\u7a0bFD\u6570\u91cf</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#12-fd-limit","title":"1.2  fd limit","text":"<p>\u53ef\u4ee5\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u662f\u6709\u4e0a\u9650\u7684\uff0c\u6240\u4ee5\u5206\u5230\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e5f\u662f\u6709\u9650\u7684\u3002\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 <code>cat /proc/sys/fs/file-max</code> \u67e5\u770b\u6240\u6709\u8fdb\u7a0b\u5141\u8bb8\u6253\u5f00\u7684\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\uff0c\u540c\u6837\uff0c\u6267\u884c\u8be5\u64cd\u4f5c\u4e5f\u9700\u8981root\u540e\u7684\u624b\u673a</p> <pre><code>root@x86:/ # cat /proc/sys/fs/file-max\n206453\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 <code>ulimit -n</code> \u67e5\u770b\u5355\u4e2a\u8fdb\u7a0b\u7684\u5141\u8bb8\u6253\u5f00\u7684\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u3002Linux\u9ed8\u8ba4\u8fdb\u7a0b\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u662f1024\u3002</p> <pre><code>root@x86:/ # ulimit -n\n1024\n</code></pre> <p>\u6ce8\u610f\uff1a\u8f83\u65b0\u6b3e\u7684Android\u8fd9\u4e2a\u503c\u88ab\u6539\u4e3a32768\u3002</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#13","title":"1.3 \u53e5\u67c4\u7b80\u5355\u5206\u7c7b","text":"<p>\u9488\u5bf9android\u5e94\u7528\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5148\u7b80\u5355\u505a\u4e00\u4e2a\u8bf4\u660e\uff0c\u5e73\u65f6\u67e5\u53e5\u67c4\u95ee\u9898\u4e00\u822c\u53ef\u4ee5\u901a\u8fc7\u5bf9\u6bd4\u54ea\u4e00\u7c7b\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u8fc7\u9ad8\uff0c\u6765\u7f29\u5c0f\u95ee\u9898\u8303\u56f4\u3002</p> \u7c7b\u522b\u6807\u8bc6 FD\u7c7b\u578b \u8bf4\u660e 1 /data/data/\u6216\u8005/data/app/ \u6253\u5f00\u6587\u4ef6\u76f8\u5173 2 socket \u4e0e\u7f51\u7edc\u8bf7\u6c42\u6216\u8fdb\u7a0b\u901a\u4fe1\u76f8\u5173 3 /dev/ashmem \u4e0e\u6570\u636e\u5e93\u64cd\u4f5c\u6216\u8005\u7ebf\u7a0b\u521b\u5efa\u76f8\u5173 4 anon_inode:[eventpoll/eventfd] \u4e0eHandlerThread\u6216\u5e26looper\u7ebf\u7a0b\u76f8\u5173 5 anon_inode:[timerfd] \u7cfb\u7edf\u6587\u4ef6\u63cf\u8ff0\u7b26\u7c7b\u578b\uff0c\u548c\u5e94\u7528\u5173\u7cfb\u4e0d\u5927 6 anon_inode:[dmabuf] InputChannel\u6cc4\u6f0f\u65f6\u589e\u52a0\u660e\u663e 7 pipe: \u4e0eHandlerThread\u5e26looper\u7ebf\u7a0b\u76f8\u5173 8 /sys/ \u4e00\u822c\u662f\u7cfb\u7edf\u64cd\u4f5c\u4f7f\u7528"},{"location":"perf-opt/Android/memory/Android_fd_leak/#2","title":"2. \u53e5\u67c4\u6cc4\u6f0f\u573a\u666f","text":""},{"location":"perf-opt/Android/memory/Android_fd_leak/#21-resource","title":"2.1 Resource\u76f8\u5173","text":""},{"location":"perf-opt/Android/memory/Android_fd_leak/#stream","title":"Stream","text":"<pre><code>for (index in 1..100) {\nvar out: FileOutputStream? = null\ntry {\nval fileName = \"temp_${index}\"\nval file = File(cacheDir, fileName)\nfile.createNewFile()\nout = FileOutputStream(file)\n} catch (e: Exception) {\ne.printStackTrace()\n} finally {\n//     out?.close()\n}\n}\n</code></pre> <p>\u8c03\u7528\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u4f1a\u51fa\u73b0\u5927\u91cf\u4e0a\u9762\u8868\u683c\u4e2d<code>1</code>\u7c7b\u522b\u7684FD\uff0c\u56e0\u4e3a\u5728\u4f7f\u7528\u5b8c FileOutputStream \u540e\u6ca1\u6709\u53ca\u65f6\u91ca\u653e\u3002\u6bcf\u6b21\u521b\u5efa file \u5bf9\u8c61\uff0c\u5373\u4f7f\u5b83\u90fd\u662f\u6253\u5f00\u540c\u4e00\u4e2a\u6587\u4ef6\uff0c\u7cfb\u7edf\u4f9d\u7136\u4f1a\u6bcf\u6b21\u90fd\u4e3a\u8fdb\u7a0b\u521b\u5efa\u4e0d\u540c\u7684FD\u6765\u6307\u5411\u8fd9\u4e2a\u6587\u4ef6\u6d41\u3002</p> <p>Android \u4e2d\u7ecf\u5e38\u4f1a\u4f7f\u7528\u5230 FileInputStream\uff0cFileOutputStream\uff0cFileReader\uff0cFileWriter \u7b49\u8f93\u5165\u8f93\u51fa\u6d41\uff0c\u5904\u7406\u4e0d\u597d\u4f1a\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u548cFD\u6cc4\u6f0f\u3002\u9700\u8981\u53ca\u65f6\u5173\u95ed\uff0c\u5e94\u5f53\u5728finally\u5757\u4e2d\u64cd\u4f5c\uff0c\u4fdd\u8bc1\u4e00\u5b9a\u80fdclose\u6389\u3002</p> <p>\u6587\u4ef6\u53e5\u67c4\uff0c\u521b\u5efa\u65b9\u5f0f\u4e3a\u5e95\u5c42\u6700\u7ec8\u8c03\u7528\u7cfb\u7edf\u51fd\u6570open\uff0c\u4f1a\u751f\u6210\u4e00\u4e2aint\u7684fd\u503c\u3002</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#cursor","title":"Cursor","text":"<pre><code>public void problemMethod() {  Cursor cursor = query(); // \u5047\u8bbe query() \u662f\u4e00\u4e2a\u67e5\u8be2\u6570\u636e\u5e93\u8fd4\u56de Cursor \u7ed3\u679c\u7684\u51fd\u6570   \nif (flag == false) {  // \u51fa\u73b0\u4e86\u63d0\u524d\u8fd4\u56de\nreturn;  }  cursor.close();  }\n</code></pre> <p>\u4e0e\u8f93\u5165\u8f93\u51fa\u6d41\u76f8\u4f3c\uff0c\u6570\u636e\u5e93\u67e5\u8be2\u7684 Cursor \u5982\u679c\u6ca1\u6709\u53ca\u65f6\u8fdb\u884c Close \u64cd\u4f5c\uff0c\u4e5f\u4f1a\u51fa\u73b0FD\u6cc4\u6f0f\u7684\u60c5\u51b5\u3002\u8fd9\u7c7b  FD\u6cc4\u6f0f\u4f1a\u5bfc\u81f4\u51fa\u73b0\u8868\u683c\u4e2d<code>3</code>\u7c7b\u522b\u7684FD\u3002</p> <p>\u5927\u6982\u539f\u7406\u662f\uff1a\u901a\u8fc7Uri\u67e5\u8be2\u6570\u636e\u5e93\u6240\u5f97\u5230\u7684\u6570\u636e\u96c6\uff0c\u4fdd\u5b58\u5728native\u5c42\u7684<code>CursorWindow</code>\u4e2d\u3002<code>CursorWindow</code>\u7684\u5b9e\u8d28\u662f\u5171\u4eab\u5185\u5b58\u7684\u62bd\u8c61\uff0c\u4ee5\u5b9e\u73b0\u8de8\u8fdb\u7a0b\u6570\u636e\u5171\u4eab\u3002\u5171\u4eab\u5185\u5b58\u6240\u91c7\u7528\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u6587\u4ef6\u6620\u5c04\u3002\u5728ContentProvider\u7aef\u900f\u8fc7SQLiteDatabase\u7684\u5c01\u88c5\u67e5\u8be2\u5230\u7684\u6570\u636e\u96c6\u4fdd\u5b58\u5728<code>CursorWindow</code>\u6240\u6307\u5411\u7684\u5171\u4eab\u5185\u5b58\u4e2d\u3002\u7136\u540e\u901a\u8fc7Binder\u628a\u8fd9\u7247\u5171\u4eab\u5185\u5b58\u4f20\u9012\u5230ContentResolver\u7aef\uff0c\u5373\u67e5\u8be2\u7aef\u3002\u8fd9\u6837\u5ba2\u6237\u5c31\u80fd\u591f\u901a\u8fc7Cursor\u6765\u8bbf\u95ee\u8fd9\u5757\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u6570\u636e\u96c6\u4e86\u3002\u5177\u4f53\u6e90\u7801\u5206\u6790\u67e5\u770bSQLite\u6cc4\u6f0f</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#22-handlerthread","title":"2.2 HandlerThread","text":"<pre><code>for (index in 1..100) {\nval thread = HandlerThread(\"background-refresh-thread\")\nthread.start()\nval handler = Handler(thread.looper)\n// destroy(handler, thread)\n}\nprivate fun destroy(handler: Handler, handlerThread: HandlerThread) {\nhandlerThread.quitSafely()\nhandler.removeCallbacksAndMessages(null)\n}\n</code></pre> <p>HandlerThread\u5728\u4e0d\u9700\u8981\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u9700\u8981\u8c03\u7528\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684<code>destroy</code>\u65b9\u6cd5\u6765\u91ca\u653e\u8d44\u6e90\u3002HandlerThread FD\u6cc4\u6f0f\u4f1a\u5bfc\u81f4\u51fa\u73b0\u8868\u683c\u4e2d<code>4</code>\u7c7b\u522b\u7684FD\u3002</p> <p>HandlerThread\u4f1a\u6cc4\u6f0f\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u539f\u56e0\u662f\u4f7f\u7528\u4e86Looper\uff0c\u6240\u4ee5\u5982\u679c\u666e\u901aThread\u4e2d\u4f7f\u7528\u4e86Looper\uff0c\u4e5f\u4f1a\u6709\u8fd9\u4e2a\u95ee\u9898\u3002Looper\u5bf9\u8c61\u521d\u59cb\u5316\u65f6Looper.prepare() \u9700\u8981fd\u8d44\u6e90\uff0c\u4f1a\u6d88\u8017\u4e00\u5bf9fd(<code>eventFd</code>\u548c<code>epollFd</code>)\uff0c\u8fd9\u4e24\u4e2afd\u662f\u7528\u6765\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7684\u3002</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#23-inputchannel","title":"2.3 InputChannel","text":"<pre><code>for (index in 1..10) {\nval alertDialog = AlertDialog.Builder(this)\n.setTitle(\"test leak\")\n.create()\nalertDialog.show()\n}\n</code></pre> <p>\u8fd0\u884c\u4e0a\u8ff0\u4ee3\u7801\uff0c\u4f1a\u53d1\u73b0\u591a\u4e8610\u4e2a\u8868\u683c\u4e2d<code>2</code>\u7c7b\u522b(\u4e5f\u5c31\u662fsocket)\u7684FD\u3002\u8fd9\u662f\u56e0\u4e3aDialog\u5185\u90e8\u4f1a\u8c03\u7528<code>WindowManager.addView</code>\uff0c<code>WindowManager.addView</code> \u7684\u6bcf\u6b21\u8c03\u7528\uff0c\u6700\u7ec8\u4f1a\u8c03\u7528WMS\u7684 <code>addWindow</code> \u65b9\u6cd5\uff0cWMS\u5728\u5176\u4e2d\u4f1a\u521b\u5efa <code>InputChannel</code> \u7528\u4e8e\u8fdb\u884c\u8de8\u8fdb\u7a0b\u901a\u4fe1\u3002\u672c\u8d28\u4e0a\u662f\u521d\u59cb\u5316\u4e86\u4e00\u5bf9<code>socket</code>\u6587\u4ef6\uff08\u4f1a\u5728\u670d\u52a1\u7aef\u8fdb\u7a0b\u548c\u5ba2\u6237\u7aef\u8fdb\u7a0b\u5404\u521b\u5efa\u4e00\u4e2a\uff09\u8fdb\u884c\u901a\u4fe1\uff0c\u5982\u679c\u4e0d\u8c03\u7528 removeView \u8fd9\u5bf9FD\u5c06\u5f97\u4e0d\u5230\u91ca\u653e\u3002</p> <p>\u5982\u679c\u662f\u8fd9\u79cdFD\u6cc4\u6f0f\uff0c\u4e00\u822c\u5f02\u5e38log\u4f1a\u51fa\u73b0<code>InputChannel</code>\u76f8\u5173\u5173\u952e\u8bcd\uff0c\u5982<code>Could not read input channel file descriptors from parcel</code>\uff0c\u5bf9\u4e8e\u6b64\u7c7b\u5f02\u5e38\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>adb shell dumpsys window</code>\u67e5\u770b\u4e00\u4e0b\u5f53\u524d\u7684window\u4fe1\u606f\uff0c\u5373\u53ef\u4ee5\u6bd4\u8f83\u660e\u786e\u7684\u770b\u51fa\u662f\u54ea\u4e2awindow\u6709\u5f02\u5e38\uff0c\u7136\u540e\u627e\u539f\u56e0\u89e3\u51b3\u3002</p> <p>\u5982\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u6267\u884cdumpsys window\u547d\u4ee4\u4e4b\u540e\uff0c\u4f1a\u53d1\u73b0</p> <pre><code>WINDOW MANAGER ANIMATOR STATE (dumpsys window animator)\nDisplayContentsAnimator #0:\nWindow #0: WindowStateAnimator{e5d6e54 com.android.systemui.ImageWallpaper}\nWindow #1: WindowStateAnimator{e5dc1fd com.mumu.launcher/com.mumu.launcher.Launcher}\nWindow #2: WindowStateAnimator{5b4def2 com.adison.andoridnotes/com.adison.notes.ApiDemos}\nWindow #3: WindowStateAnimator{b1cd943 com.adison.andoridnotes/com.adison.notes.ApiDemos}\nWindow #4: WindowStateAnimator{24d1bc0 com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #5: WindowStateAnimator{b36be52 com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #6: WindowStateAnimator{9b83523 com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #7: WindowStateAnimator{fb17a20 com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #8: WindowStateAnimator{686efd9 com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #9: WindowStateAnimator{f5e6d9e com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #10: WindowStateAnimator{6cf007f com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #11: WindowStateAnimator{984184c com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #12: WindowStateAnimator{36db095 com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #13: WindowStateAnimator{9bfc5aa com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #14: WindowStateAnimator{5d259b com.adison.andoridnotes/com.adison.notes.perf.FDLeak}\nWindow #15: WindowStateAnimator{fc980f9 KeyguardScrim}\nWindow #16: WindowStateAnimator{7adf83e StatusBar}\n</code></pre> <p>\u5f88\u660e\u663e\uff0ccom.adison.notes.perf.FDLeak\u6709\u5f02\u5e38addWindow\u64cd\u4f5c\u3002</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#24-java-thread-start","title":"2.4 Java Thread Start","text":"<p>Java\u5728\u8d77\u7ebf\u7a0b\u7684\u65f6\u5019\u4e5f\u4f1a\u9700\u8981\u5f00Fd\u8d44\u6e90\uff0c\u5982\u679c\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u64cd\u4f5c\u4e0d\u5f53\uff0c\u5f53\u8d77\u7684\u7ebf\u7a0b\u8fc7\u591a\u65f6\u4e5f\u4f1a\u5bfc\u81f4Fd\u6cc4\u6f0f\u95ee\u9898\uff0c\u5f53\u7136\u8fd9\u91cc\u4e5f\u662f\u4f1a\u7ecf\u5e38\u8eba\u67aa\u3002\u5177\u4f53\u53ef\u4ee5\u8fd9\u7bc7\u6587\u7ae0\uff1a\u4e0d\u53ef\u601d\u8bae\u7684OOM\u3002</p> <p>\u7ebf\u7a0bstart\u7684\u7b80\u5316\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5bf9\u4e8e1\u7684\u5730\u65b9\uff0cashmem_create_region \u4f1a\u521b\u5efa\u4e00\u5757ashmen\u533f\u540d\u5171\u4eab\u5185\u5b58,\u5e76\u8fd4\u56de\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5982\u679cFd\u8d44\u6e90\u4e0d\u8db3\u4e86\uff0c\u4f1a\u62a5\u51fa\u7c7b\u4f3c<code>java.lang.OutOfMemoryError: Could not allocate JNI Env</code>\u8c03\u7528\u6808\u9519\u8bef\uff0c\u8fd9\u65f6\u8fd9\u91cc\u6709\u53ef\u80fd\u53ea\u662f\u8eba\u67aa\uff0c\u53ef\u80fd\u662f\u5df2\u7ecf\u6709Fd\u6cc4\u6f0f\u4e86\u5bfc\u81f4\u518d\u8d77\u7ebf\u7a0b\u65f6\u8fd9\u91cc\u521b\u5efaJNIENV\u9700\u8981\u6253\u5f00Fd\u5931\u8d25\u3002</p> <p>\u5bf9\u4e8e2\u7684\u5730\u65b9\uff0c\u5982\u679c\u5185\u5b58\u8d44\u6e90\u4e0d\u8db3\u4e86\uff0c\u6216\u8005\u6ca1\u6709\u8fde\u7eed\u865a\u62df\u5730\u5740\u53ef\u7528\u4f1a\u629b\u51fa<code>java.lang.OutOfMemoryError: pthread_create (1040KB stack) failed: Try again</code>\u7c7b\u4f3c\u9519\u8bef\u8c03\u7528\u6808\uff0c\u8fd9\u4e2a\u65f6\u5019\u5e94\u8be5\u53bb\u8c03\u67e5\u4e3a\u4f55\u865a\u62df\u5730\u5740\u4e0d\u8db3\uff0c\u8fd9\u662f\u771f\u6b63OOM\u7684\u95ee\u9898\u4e86\u3002</p>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#3","title":"3. \u53e5\u67c4\u6cc4\u6f0f\u6392\u67e5","text":""},{"location":"perf-opt/Android/memory/Android_fd_leak/#31","title":"3.1 \u53e5\u67c4\u6cc4\u6f0f\u6982\u8ff0","text":"<p>\u53e5\u67c4\u6cc4\u9732\u662f\u6307\u7a0b\u5e8f\u4e2d\u5df2\u5206\u914d\u7684fd\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u672a\u91ca\u653e\u6216\u8005\u65e0\u6cd5\u91ca\u653e\uff0c\u9020\u6210fd\u53e5\u67c4\u5360\u7528\u8d8a\u6765\u8d8a\u591a\uff0c\u5f53\u8fbe\u5230\u8fdb\u7a0b\u4e0a\u9650\u540e\uff0c\u7a0b\u5e8f\u5c06\u53d1\u751f\u5d29\u6e83\uff0c\u800c\u9700\u8981fd\u8d44\u6e90\u7684\u573a\u666f\u5f88\u591a\uff0c\u5373\u5728fd\u8d44\u6e90\u4e0d\u8db3\u65f6\uff0c\u8fd9\u4e9b\u9700\u8981fd\u8d44\u6e90\u7684\u5f88\u591a\u573a\u666f\uff0c\u4ee3\u7801\u90fd\u6709\u53ef\u80fd\u51fa\u73b0\u5f02\u5e38\u4ece\u800c\u8fdb\u7a0bcrash\u6216\u529f\u80fd\u5f02\u5e38\uff0c\u56e0\u6b64\u8fd9\u4e9b\u573a\u666f\u53ef\u80fd\u53ea\u662f\u8eba\u67aa\u5bfc\u81f4\u8fdb\u7a0b\u5d29\u6e83\uff0c\u771f\u6b63\u7f6a\u9b41\u7978\u9996\u5e94\u8be5\u662f\u5927\u91cf\u5360\u7528fd\u8d44\u6e90\u7684\u5730\u65b9\u3002  \u56e0\u6b64\uff0cFd\u6cc4\u6f0f\u7684\u539f\u56e0\u4e00\u822c\u90fd\u6709\u5982\u4e0b\u7279\u70b9\uff1a</p> <ol> <li>\u540c\u4e00\u4e2a\u95ee\u9898\u53ef\u80fd\u51fa\u73b0\u4e0d\u540c\u5806\u6808</li> <li>\u6bd4\u8f83\u9690\u6666</li> </ol>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#32","title":"3.2 \u53e5\u67c4\u6cc4\u6f0f\u5806\u6808\u5e38\u89c1\u5173\u952e\u8bcd","text":"<p>\u5982\u679c\u4f60\u7684\u5e94\u7528\u5d29\u6e83\u5806\u6808\u6709\u4ee5\u4e0b\u5173\u952e\u8bcd\uff0c\u606d\u559c\u4f60\uff0c\u4f60\u7684\u5e94\u7528\u53ef\u80fd\u5b58\u5728\u6587\u4ef6\u63cf\u8ff0\u7b26\u6cc4\u6f0f\u3002</p> <ul> <li>Xxx  too many open files</li> <li>Could not allocate JNI Env</li> <li>Could not allocate dup blob fd</li> <li>Could not read input channel file descriptors from parcel</li> <li>InputChannel is not initialized</li> <li>Could not open input channel pair</li> <li>CursorWindow: Could not allocate CursorWindow </li> </ul>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#33","title":"3.3 \u53e5\u67c4\u6cc4\u6f0f\u5206\u6790","text":"<p>\u53e5\u67c4\u6cc4\u6f0f\u53ef\u4ee5\u901a\u8fc7\u591a\u65b9\u9762\u4fe1\u606f\u53bb\u5206\u6790\uff1a</p> <ol> <li> <p>logcat \u67e5\u770b\u5f02\u5e38\u6808\u60c5\u51b5\uff0c\u4ec0\u4e48\u4fe1\u606f\u5728\u9891\u7e41\u7684\u6253\u5370\uff0c\u6d89\u53ca\u5230fd open\u7684\u65e5\u5fd7\u9891\u7e41\u6253\u5370\u662f\u6700\u503c\u5f97\u6000\u7591\u7684\u5730\u65b9\u3002</p> </li> <li> <p>\u53e5\u67c4\u6cc4\u6f0f\u901a\u5e38\u4f1a\u5bfc\u81f4\u5361\u987f\uff0c\u5185\u5b58\u98d9\u5347\u7b49\u5f02\u5e38\u73b0\u8c61\uff0c\u53ef\u4ee5\u5728\u8fdb\u7a0b\u590d\u73b0\u672a\u6302\u7684\u65f6\u5019\u6293\u53d6\u60f3\u8981\u7684\u4fe1\u606f\uff1a</p> </li> <li> <p>\u67e5\u770bfd\u4fe1\u606f<code>adb shell ls -a -l /proc/{pid}/fd</code> \uff0c\u901a\u8fc7\u5bf9\u6bd4\u524d\u9762\u8868\u683c\u4e2d\u54ea\u4e00\u7c7b\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u8fc7\u9ad8\uff0c\u6765\u7f29\u5c0f\u95ee\u9898\u8303\u56f4\u3002</p> </li> <li>\u67e5\u770b\u8fdb\u7a0b\u7ebf\u7a0b\u4fe1\u606f\uff1a<code>ps -t {pid</code>}\uff0c\u8ddf\u7ebf\u7a0b\u76f8\u5173\u7684fd\u6cc4\u6f0f\u901a\u8fc7\u8fdb\u7a0b\u7684\u4fe1\u606f\u53ef\u4ee5\u5f88\u5feb\u5b9a\u4f4d\u51fa\u5f02\u5e38\u7ebf\u7a0b\u3002</li> <li>\u67e5\u770b\u662f\u5426\u6709\u5f02\u5e38window\uff1a<code>adb shell dumpsys window</code>\uff0c\u7528\u4e8e\u89e3\u51b3 InputChannel \u76f8\u5173\u7684\u6cc4\u6f0f\u95ee\u9898\u3002</li> <li> <p>\u6293\u53d6hprof\u5b9a\u4f4d\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5</p> </li> <li> <p>\u7ebf\u4e0a\u76d1\u63a7\uff1a\u5728\u5e94\u7528crash\u7684\u65f6\u5019\u6216\u8005\u5b9a\u65f6\u8f6e\u8be2\u5f53\u524d\u8fdb\u7a0b\u4f7f\u7528\u7684FD\u6570\u91cf\uff0c\u5728\u8fbe\u5230\u9608\u503c\u65f6\uff0c\u901a\u8fc7readlink\u7684\u65b9\u5f0f\u8bfb\u53d6/proc/self/fd\u7684\u4fe1\u606f\uff0c\u4ee5\u83b7\u53d6fd\u4fe1\u606f\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> </li> </ol> <pre><code>List&lt;String&gt; dumpInfo = new ArrayList&lt;&gt;();\nString fdDirPath = String.format(\"/proc/%d/fd/\", Process.myPid());\nFile[] fds = new File(fdDirPath).listFiles();\nif (fds == null) {\ndumpInfo.add(\"Unable to list \" + fdDirPath);\n} else {\nfor (File f : fds) {\nString fdSymLink = f.getAbsolutePath();\nString resolvedPath = \"\";\ntry {\nresolvedPath = Os.readlink(fdSymLink);\n} catch (ErrnoException ex) {\nresolvedPath = ex.getMessage();\n}\ndumpInfo.add(fdSymLink + \"\\t\" + resolvedPath);\n}\n}\n// Dump the fds &amp; paths to a temp file.\ntry {\nFile dumpFile = File.createTempFile(\"fd_\", \"\", dumpDir);\nPath out = Paths.get(dumpFile.getAbsolutePath());\nFiles.write(out, dumpInfo, StandardCharsets.UTF_8);\n} catch (IOException ex) {\nLog.w(TAG, \"Unable to write open descriptors to file: \" + ex);\n}\n</code></pre>"},{"location":"perf-opt/Android/memory/Android_fd_leak/#4","title":"4. \u53c2\u8003\u94fe\u63a5","text":"<p>\u6d45\u8c08\u53ca\u6848\u4f8b\u5206\u6790 FD \u6cc4\u6f0f</p> <p>Android Fd\u6cc4\u6f0f\u95ee\u9898\u5206\u6790</p> <p>\u4e00\u6587\u5e2e\u4f60\u641e\u61c2 Android \u6587\u4ef6\u63cf\u8ff0\u7b26</p>"},{"location":"perf-opt/Android/memory/Android_memory_manager/","title":"android \u5185\u5b58\u7ba1\u7406","text":""},{"location":"perf-opt/Android/memory/Android_memory_manager/#1","title":"1. \u5185\u5b58\u57fa\u7840\u77e5\u8bc6","text":""},{"location":"perf-opt/Android/memory/Android_memory_manager/#11-ram","title":"1.1 \u7269\u7406\u5185\u5b58(RAM)","text":"<p>RAM\u5373\u5927\u5bb6\u5e38\u8bf4\u7684\u8fd0\u884c\u5185\u5b58\uff0c\u7b80\u79f0\u8fd0\u5b58\uff0c\u662f\u4e00\u79cd\u5728\u624b\u673a\u4e2d\u7528\u6765\u6682\u65f6\u4fdd\u5b58\u6570\u636e\u7684\u5143\u4ef6\uff0c\u76f8\u5f53\u4e8e\u7535\u8111\u4e2d\u7684\u5185\u5b58\u6761\u3002\u7269\u7406\u5185\u5b58\u662fCPU\u7684\u5730\u5740\u7ebf\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u5bfb\u5740\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c\u52a0\u8f7d\u5230\u5185\u5b58\u5730\u5740\u5bc4\u5b58\u5668\u4e2d\u7684\u5185\u5b58\u53c8\u53eb\u201c\u786c\u4ef6\u5185\u5b58\u201d\uff0c\u662f\u5185\u5b58\u5355\u5143\u771f\u6b63\u7684\u5730\u5740(\u4e5f\u53eb\u7269\u7406\u5730\u5740)\u3002RAM\u4f5c\u4e3a\u8fdb\u7a0b\u8fd0\u884c\u4e0d\u53ef\u6216\u7f3a\u7684\u8d44\u6e90\uff0c\u5bf9\u7cfb\u7edf\u548c\u7a33\u5b9a\u6027\u6709\u7740\u51b3\u5b9a\u6027\u7684\u5f71\u54cd\u3002\u53e6\u5916\uff0cRAM\u7684\u4e00\u90e8\u5206\u88ab\u64cd\u4f5c\u7cfb\u7edf\u7559\u4f5c\u4ed6\u7528\uff0c\u6bd4\u5982\u663e\u5b58\u7b49\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#12","title":"1.2 \u865a\u62df\u5185\u5b58","text":"<p>\u662f\u4e00\u4e2a\u6982\u5ff5\uff0c\u5e76\u4e0d\u662f\u5b9e\u9645\u7684\u5185\u5b58\uff0c\u5728\u7269\u7406\u5185\u5b58\u4e4b\u4e0a\u589e\u52a0\u4e00\u4e2a\u4e2d\u95f4\u5c42\uff0c\u8ba9\u7a0b\u5e8f\u901a\u8fc7\u865a\u62df\u5730\u5740\u53bb\u95f4\u63a5\u7684\u8bbf\u95ee\u7269\u7406\u5185\u5b58\u5462\u3002\u901a\u8fc7\u865a\u62df\u5185\u5b58\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u597d\u50cf\u90fd\u53ef\u4ee5\u72ec\u5360\u5185\u5b58\u4e00\u6837\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u770b\u5230\u7684\u5185\u5b58\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u79f0\u4e3a\u865a\u62df\u5730\u5740\u7a7a\u95f4\u3002\u5bf9\u4e8e4G\u5185\u5b58\u7684Linux\u7cfb\u7edf\u6765\u8bf4\uff0c\u865a\u62df\u5185\u5b58\u4e5f\u4e3a4G\uff0c\u5176\u4e2d1G\u4e3a\u7cfb\u7edf\u7684\u5185\u5b58\uff0c\u5269\u4e0b\u76843G\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7684\u5185\u5b58\u3002 </p> <ul> <li>\u903b\u8f91\uff08\u865a\u62df\uff09\u5730\u5740     \u4e0a\u8ff0<code>0x00000000</code>\u5230<code>0xC0000000</code>\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u53ef\u7528\u7684\u903b\u8f91\uff08\u865a\u62df\uff09\u5730\u5740\u3002\u8fd9\u91cc\u5f15\u7528\u4e00\u4e2a\u6d45\u663e\u7684\u4f8b\u5b50\u2014\u2014\u6211\u4eec\u5728C\u8bed\u8a00\u6307\u9488\u7f16\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u8bfb\u53d6\u6307\u9488\u53d8\u91cf\u672c\u8eab\u7684\u503c(&amp;\u64cd\u4f5c)\uff0c\u8fd9\u91cc\u53d6\u5f97\u7684\u503c\u5c31\u662f\u903b\u8f91\u5730\u5740\u2014\u2014\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a(&amp;\u64cd\u4f5c)\u53d6\u5f97\u7684\u503c\u662fCPU\u63a7\u5236\u751f\u6210\u7684\u4e00\u4e2a\u903b\u8f91\u5730\u5740\uff0c\u5e76\u4e0d\u662f\u8fd9\u4e2a\u6307\u9488\u53d8\u91cf\u5728RAM\u4e2d\u7684\u771f\u6b63\u5730\u5740\u3002</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#121","title":"1.2.1 \u5206\u6bb5\u4e0e\u5206\u9875","text":"<ul> <li> <p>\u5206\u6bb5</p> <p>\u8fdb\u7a0b\u662f\u64cd\u4f5c\u7cfb\u7edf\u8d44\u6e90\u5206\u914d\u7684\u6700\u5c0f\u5355\u5143\u3002\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u5305\u542b\u4e94\u79cd\u6bb5\uff1a\u6570\u636e\u6bb5\u3001\u4ee3\u7801\u6bb5\u3001BSS\u3001\u5806\u3001\u6808\u3002</p> <ul> <li>\u6570\u636e\u6bb5\uff1a\u5b58\u653e\u7a0b\u5e8f\u4e2d\u7684\u9759\u6001\u53d8\u91cf\u548c\u5df2\u521d\u59cb\u5316\u4e14\u4e0d\u4e3a\u96f6\u7684\u5168\u5c40\u53d8\u91cf\u3002</li> <li>\u4ee3\u7801\u6bb5\uff1a\u5b58\u653e\u53ef\u6267\u884c\u6587\u4ef6\u7684\u64cd\u4f5c\u6307\u4ee4\uff0c\u4ee3\u7801\u6bb5\u662f\u53ea\u8bfb\u7684\uff0c\u4e0d\u53ef\u8fdb\u884c\u5199\u64cd\u4f5c\u3002\u8fd9\u90e8\u5206\u7684\u533a\u57df\u5728\u8fd0\u884c\u524d\u5df2\u77e5\u5176\u5927\u5c0f\u3002</li> <li>BSS\u6bb5( Block Started By Symbol)\uff1a\u5b58\u653e\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u5728\u53d8\u91cf\u4f7f\u7528\u524d\u7531\u8fd0\u884c\u65f6\u521d\u59cb\u5316\u4e3a\u96f6\u3002</li> <li>\u5806\uff1a\u5b58\u653e\u8fdb\u7a0b\u8fd0\u884c\u4e2d\u88ab\u52a8\u6001\u5206\u914d\u7684\u5185\u5b58\uff0c\u5176\u5927\u5c0f\u4e0d\u56fa\u5b9a\u3002</li> <li>\u6808\uff1a\u5b58\u653e\u7a0b\u5e8f\u4e2d\u7684\u4e34\u65f6\u7684\u5c40\u90e8\u53d8\u91cf\u548c\u51fd\u6570\u7684\u53c2\u6570\u503c\u3002</li> </ul> <p>\u90a3\u4e48\u5206\u6bb5\u7684\u6280\u672f\u53ef\u4ee5\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\u5462\uff1f</p> <p>\u5047\u8bbe\u7a0b\u5e8fA\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u662f<code>0x00000000~0x00000099</code>\uff0c\u6620\u5c04\u5230\u7684\u7269\u7406\u5730\u5740\u7a7a\u95f4\u662f<code>0x00000600~0x00000699</code>\uff0c\u7a0b\u5e8fB\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u662f<code>0x00000100~0x00000199</code>\uff0c\u6620\u5c04\u5230\u7684\u7269\u7406\u5730\u5740\u7a7a\u95f4\u662f<code>0x00000300~0x00000399</code>\u3002 \u5047\u8bbe\u4f60\u624b\u6b8b\uff0c\u5728\u7a0b\u5e8fA\u4e2d\u64cd\u4f5c\u4e86\u5730\u5740<code>0x00000150</code>\uff0c\u4f46\u662f\u6b64\u65f6\u7684\u5730\u5740<code>0x00000150</code>\u662f\u865a\u62df\u7684\uff0c\u800c\u865a\u62df\u5316\u7684\u64cd\u4f5c\u662f\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u638c\u63a7\u4e2d\u7684\uff0c\u6240\u4ee5\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6709\u80fd\u529b\u5224\u65ad\uff0c\u8fd9\u4e2a\u865a\u62df\u5730\u5740<code>0x00000150</code>\u662f\u6709\u95ee\u9898\u7684\uff0c\u7136\u540e\u963b\u6b62\u540e\u7eed\u7684\u64cd\u4f5c\u3002\u6240\u4ee5\uff0c\u8fd9\u91cc\u4f53\u73b0\u51fa\u4e86\u9694\u79bb\u6027\u3002\uff08\u53e6\u4e00\u79cd\u4f53\u73b0\u9694\u79bb\u6027\u7684\u65b9\u5f0f\u5c31\u662f\uff0c\u64cd\u4f5c\u540c\u4e00\u4e2a\u865a\u62df\u5730\u5740\uff0c\u5b9e\u9645\u4e0a\u53ef\u80fd\u64cd\u4f5c\u7684\u662f\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\uff09</p> <p>\u6240\u4ee5\u901a\u8fc7\u5206\u6bb5\u673a\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u597d\u7684\u63a7\u5236\u4e0d\u540c\u6bb5\u7684\u5c5e\u6027\uff0c\u8fd9\u6709\u5229\u4e8e\u5185\u5b58\u7684\u7ec4\u7ec7\u5b89\u6392\uff0c\u53ef\u4ee5\u5bf9\u4e0d\u540c\u7684\u5c5e\u6027\u4ee3\u7801\u3001\u6570\u636e\u8fdb\u884c\u66f4\u65b9\u4fbf\u7684\u7ba1\u7406\u3002\u5982\u679c\u662f\u6253\u4e71\u7684\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u90a3\u4e48\u8bfb\u5199\u5c5e\u6027\u5c31\u5f88\u96be\u63a7\u5236\u3002</p> </li> <li> <p>\u5206\u9875</p> <p>\u5206\u9875\u5176\u5b9e\u5c31\u662f\u628a\u6bb5\u7a7a\u95f4\u66f4\u7ec6\u5206\u4e86\u4e00\u4e0b\uff0c\u7c92\u5ea6\u66f4\u5c0f\u3002\u6b64\u65f6\u7269\u7406\u5185\u5b58\u88ab\u5212\u5206\u4e3a\u4e00\u5c0f\u5757\u4e00\u5c0f\u5757\uff0c\u6bcf\u5757\u88ab\u79f0\u4e3a\u5e27(Frame)\u3002\u5206\u914d\u5185\u5b58\u65f6\uff0c\u5e27\u662f\u5206\u914d\u65f6\u7684\u6700\u5c0f\u5355\u4f4d\u3002\u5e76\u5c06\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u4e5f\u5212\u5206\u4e3a\u5927\u5c0f\u76f8\u7b49\u7684\u5757\uff0c\u79f0\u4e3a<code>\u9875\u9762\uff08Page\uff09</code>\u3002</p> <p>\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u7684\u6620\u5c04\u901a\u8fc7<code>\u9875\u8868(page table)</code>\u6765\u5b9e\u73b0\u3002\u6bcf\u4e2a\u9875\u8868\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a<code>\u9875\u8868\u9879(PTE, page table entry)</code>\uff0c\u6bcf\u4e2a\u9875\u8868\u9879\u8d1f\u8d23\u628a\u865a\u62df\u9875\u6620\u5c04\u5230\u7269\u7406\u9875\u4e0a\u3002\u5728 \u7269\u7406\u5185\u5b58\u4e2d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u9875\u8868\u3002</p> <p>\u56e0\u4e3a\u6709\u4e00\u4e2a\u8868\u53ef\u4ee5\u67e5\u8be2\uff0c\u5c31\u4f1a\u9047\u5230\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u79cd\u662f\u547d\u4e2d(Page Hit)\uff0c\u53e6\u4e00\u79cd\u5219\u662f\u672a\u547d\u4e2d(Page Fault)\u3002\u547d\u4e2d\u7684\u65f6\u5019\uff0c\u5373\u8bbf\u95ee\u5230\u9875\u8868\u4e2d\u84dd\u8272\u6761\u76ee\u7684\u5730\u5740\u65f6\uff0c\u56e0\u4e3a\u5728 DRAM \u4e2d\u6709\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u3002\u4e0d\u547d\u4e2d\u7684\u65f6\u5019\uff0c\u5373\u8bbf\u95ee\u5230 page table \u4e2d\u7070\u8272\u6761\u76ee\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u5728 DRAM \u4e2d\u5e76\u6ca1\u6709\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u6240\u4ee5\u9700\u8981\u6267\u884c\u7f3a\u9875\u7f6e\u6362\u3002</p> </li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#122","title":"1.2.2 \u7f3a\u9875\u4e2d\u65ad","text":"<p>\u4e8b\u5b9e\u4e0a\uff0c\u5728\u6bcf\u4e2a\u8fdb\u7a0b\u521b\u5efa\u52a0\u8f7d\u65f6\uff0c\u5185\u6838\u53ea\u662f\u4e3a\u8fdb\u7a0b\u201c\u521b\u5efa\u201d\u4e86\u865a\u62df\u5185\u5b58\u7684\u5e03\u5c40\uff0c\u5177\u4f53\u5c31\u662f\u521d\u59cb\u5316\u8fdb\u7a0b\u63a7\u5236\u8868\u4e2d\u5185\u5b58\u76f8\u5173\u7684\u94fe\u8868\uff0c\u5b9e\u9645\u4e0a\u5e76\u4e0d\u7acb\u5373\u5c31\u628a\u865a\u62df\u5185\u5b58\u5bf9\u5e94\u4f4d\u7f6e\u7684\u7a0b\u5e8f\u6570\u636e\u548c\u4ee3\u7801\uff08\u6bd4\u5982.text .data\u6bb5\uff09\u62f7\u8d1d\u5230\u7269\u7406\u5185\u5b58\u4e2d\uff0c\u53ea\u662f\u5efa\u7acb\u597d\u865a\u62df\u5185\u5b58\u548c\u78c1\u76d8\u6587\u4ef6\u4e4b\u95f4\u7684\u6620\u5c04\u5c31\u597d\uff08\u53eb\u505a\u5b58\u50a8\u5668\u6620\u5c04\uff09\uff0c\u7b49\u5230\u8fd0\u884c\u5230\u5bf9\u5e94\u7684\u7a0b\u5e8f\u65f6\uff0c\u624d\u4f1a\u901a\u8fc7\u7f3a\u9875\u5f02\u5e38\uff0c\u6765\u62f7\u8d1d\u6570\u636e\u3002\u8fd8\u6709\u8fdb\u7a0b\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u8981\u52a8\u6001\u5206\u914d\u5185\u5b58\uff0c\u6bd4\u5982malloc\u65f6\uff0c\u4e5f\u53ea\u662f\u5206\u914d\u4e86\u865a\u62df\u5185\u5b58\uff0c\u5373\u4e3a\u8fd9\u5757\u865a\u62df\u5185\u5b58\u5bf9\u5e94\u7684\u9875\u8868\u9879\u505a\u76f8\u5e94\u8bbe\u7f6e\uff0c\u5f53\u8fdb\u7a0b\u771f\u6b63\u8bbf\u95ee\u5230\u6b64\u6570\u636e\u65f6\uff0c\u624d\u5f15\u53d1\u7f3a\u9875\u5f02\u5e38\u3002</p> <p>\u5728\u8bf7\u6c42\u5206\u9875\u7cfb\u7edf\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2\u9875\u8868\u4e2d\u7684\u72b6\u6001\u4f4d\u6765\u786e\u5b9a\u6240\u8981\u8bbf\u95ee\u7684\u9875\u9762\u662f\u5426\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u3002\u6bcf\u5f53\u6240\u8981\u8bbf\u95ee\u7684\u9875\u9762\u4e0d\u5728\u5185\u5b58\u65f6\uff0c\u4f1a\u4ea7\u751f\u4e00\u6b21\u7f3a\u9875\u4e2d\u65ad\uff0c\u6b64\u65f6\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636e\u9875\u8868\u4e2d\u7684\u5916\u5b58\u5730\u5740\u5728\u5916\u5b58\u4e2d\u627e\u5230\u6240\u7f3a\u7684\u4e00\u9875\uff0c\u5c06\u5176\u8c03\u5165\u5185\u5b58\u3002</p> <p>\u7f3a\u9875\u672c\u8eab\u662f\u4e00\u79cd\u4e2d\u65ad\uff0c\u4e0e\u4e00\u822c\u7684\u4e2d\u65ad\u4e00\u6837\uff0c\u9700\u8981\u7ecf\u8fc74\u4e2a\u5904\u7406\u6b65\u9aa4\uff1a</p> <ol> <li>\u4fdd\u62a4CPU\u73b0\u573a</li> <li>\u5206\u6790\u4e2d\u65ad\u539f\u56e0</li> <li>\u8f6c\u5165\u7f3a\u9875\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406</li> <li>\u6062\u590dCPU\u73b0\u573a\uff0c\u7ee7\u7eed\u6267\u884c</li> </ol> <p>\u4f46\u662f\u7f3a\u9875\u4e2d\u65ad\u662f\u7531\u4e8e\u6240\u8981\u8bbf\u95ee\u7684\u9875\u9762\u4e0d\u5b58\u5728\u4e8e\u5185\u5b58\u65f6\uff0c\u7531\u786c\u4ef6\u6240\u4ea7\u751f\u7684\u4e00\u79cd\u7279\u6b8a\u7684\u4e2d\u65ad\uff0c\u56e0\u6b64\uff0c\u4e0e\u4e00\u822c\u7684\u4e2d\u65ad\u5b58\u5728\u533a\u522b\uff1a</p> <ol> <li>\u5728\u6307\u4ee4\u6267\u884c\u671f\u95f4\u4ea7\u751f\u548c\u5904\u7406\u7f3a\u9875\u4e2d\u65ad\u4fe1\u53f7</li> <li>\u4e00\u6761\u6307\u4ee4\u5728\u6267\u884c\u671f\u95f4\uff0c\u53ef\u80fd\u4ea7\u751f\u591a\u6b21\u7f3a\u9875\u4e2d\u65ad</li> <li>\u7f3a\u9875\u4e2d\u65ad\u8fd4\u56de\u662f\uff0c\u6267\u884c\u4ea7\u751f\u4e2d\u65ad\u7684\u4e00\u6761\u6307\u4ee4\uff0c\u800c\u4e00\u822c\u7684\u4e2d\u65ad\u8fd4\u56de\u662f\uff0c\u6267\u884c\u4e0b\u4e00\u6761\u6307\u4ee4\u3002</li> </ol>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#123","title":"1.2.3 \u865a\u62df\u5185\u5b58\u597d\u5904","text":"<p>\u865a\u62df\u5185\u5b58\u7684\u597d\u5904\uff1a</p> <ol> <li>\u6269\u5927\u5730\u5740\u7a7a\u95f4\uff1b</li> <li>\u5185\u5b58\u4fdd\u62a4\uff1a\u6bcf\u4e2a\u8fdb\u7a0b\u8fd0\u884c\u5728\u5404\u81ea\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u7a7a\u95f4\uff0c\u4e92\u76f8\u4e0d\u80fd\u5e72\u6270\u5bf9\u65b9\u3002\u865a\u5b58\u8fd8\u5bf9\u7279\u5b9a\u7684\u5185\u5b58\u5730\u5740\u63d0\u4f9b\u5199\u4fdd\u62a4\uff0c\u53ef\u4ee5\u9632\u6b62\u4ee3\u7801\u6216\u6570\u636e\u88ab\u6076\u610f\u7be1\u6539\u3002</li> <li>\u516c\u5e73\u5185\u5b58\u5206\u914d\u3002\u91c7\u7528\u4e86\u865a\u5b58\u4e4b\u540e\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u76f8\u5f53\u4e8e\u6709\u540c\u6837\u5927\u5c0f\u7684\u865a\u5b58\u7a7a\u95f4\u3002</li> <li>\u5f53\u8fdb\u7a0b\u901a\u4fe1\u65f6\uff0c\u53ef\u91c7\u7528\u865a\u5b58\u5171\u4eab\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002</li> <li>\u5f53\u4e0d\u540c\u7684\u8fdb\u7a0b\u4f7f\u7528\u540c\u6837\u7684\u4ee3\u7801\u65f6\uff0c\u6bd4\u5982\u5e93\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\uff0c\u7269\u7406\u5185\u5b58\u4e2d\u53ef\u4ee5\u53ea\u5b58\u50a8\u4e00\u4efd\u8fd9\u6837\u7684\u4ee3\u7801\uff0c\u4e0d\u540c\u7684\u8fdb\u7a0b\u53ea\u9700\u8981\u628a\u81ea\u5df1\u7684\u865a\u62df\u5185\u5b58\u6620\u5c04\u8fc7\u53bb\u5c31\u53ef\u4ee5\u4e86\uff0c\u8282\u7701\u5185\u5b58</li> <li>\u865a\u62df\u5185\u5b58\u5f88\u9002\u5408\u5728\u591a\u9053\u7a0b\u5e8f\u8bbe\u8ba1\u7cfb\u7edf\u4e2d\u4f7f\u7528\uff0c\u8bb8\u591a\u7a0b\u5e8f\u7684\u7247\u6bb5\u540c\u65f6\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u5f53\u4e00\u4e2a\u7a0b\u5e8f\u7b49\u5f85\u5b83\u7684\u4e00\u90e8\u5206\u8bfb\u5165\u5185\u5b58\u65f6\uff0c\u53ef\u4ee5\u628aCPU\u4ea4\u7ed9\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4f7f\u7528\u3002\u5728\u5185\u5b58\u4e2d\u53ef\u4ee5\u4fdd\u7559\u591a\u4e2a\u8fdb\u7a0b\uff0c\u7cfb\u7edf\u5e76\u53d1\u5ea6\u63d0\u9ad8</li> <li>\u5728\u7a0b\u5e8f\u9700\u8981\u5206\u914d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5728\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5206\u914d\u8fde\u7eed\u7a7a\u95f4\uff0c\u800c\u4e0d\u9700\u8981\u5b9e\u9645\u7269\u7406\u5185\u5b58\u7684\u8fde\u7eed\u7a7a\u95f4\uff0c\u53ef\u4ee5\u5229\u7528\u788e\u7247</li> </ol> <p>\u865a\u62df\u5185\u5b58\u7684\u4ee3\u4ef7\uff1a</p> <ol> <li>\u865a\u5b58\u7684\u7ba1\u7406\u9700\u8981\u5efa\u7acb\u5f88\u591a\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u8981\u5360\u7528\u989d\u5916\u7684\u5185\u5b58</li> <li>\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u8f6c\u6362\uff0c\u589e\u52a0\u4e86\u6307\u4ee4\u7684\u6267\u884c\u65f6\u95f4\u3002</li> <li>\u9875\u9762\u7684\u6362\u5165\u6362\u51fa\u9700\u8981\u78c1\u76d8I/O\uff0c\u8fd9\u662f\u5f88\u8017\u65f6\u7684</li> <li>\u5982\u679c\u4e00\u9875\u4e2d\u53ea\u6709\u4e00\u90e8\u5206\u6570\u636e\uff0c\u4f1a\u6d6a\u8d39\u5185\u5b58\u3002</li> </ol>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#13-swap","title":"1.3 \u4ea4\u6362(Swap)\u7a7a\u95f4","text":"<p>\u5728\u7cfb\u7edf\u4e2d\u8fd0\u884c\u7684\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u9700\u8981\u4f7f\u7528\u5230\u5185\u5b58\uff0c\u4f46\u4e0d\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u9700\u8981\u6bcf\u65f6\u6bcf\u523b\u4f7f\u7528\u7cfb\u7edf\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u5f53\u7cfb\u7edf\u8fd0\u884c\u6240\u9700\u5185\u5b58\u8d85\u8fc7\u5b9e\u9645\u7684\u7269\u7406\u5185\u5b58\uff0c\u5185\u6838\u4f1a\u91ca\u653e\u67d0\u4e9b\u8fdb\u7a0b\u6240\u5360\u7528\u4f46\u672a\u4f7f\u7528\u7684\u90e8\u5206\u6216\u6240\u6709\u7269\u7406\u5185\u5b58\uff0c\u5c06\u8fd9\u90e8\u5206\u91ca\u653e\u7684\u6570\u636e\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u76f4\u5230\u8fdb\u7a0b\u4e0b\u4e00\u6b21\u8c03\u7528\uff0c\u5e76\u5c06\u91ca\u653e\u51fa\u7684\u5185\u5b58\u63d0\u4f9b\u7ed9\u6709\u9700\u8981\u7684\u8fdb\u7a0b\u4f7f\u7528\u3002</p> <p>\u5f15\u7528\u4e00\u4e2a\u5bb9\u6613\u7406\u89e3\u4f46\u4e0d\u662f\u5f88\u6070\u5f53\u7684\u6bd4\u55bb\uff1a\u4f60\u4e0d\u9700\u8981\u5f88\u957f\u7684\u8f68\u9053\u5c31\u53ef\u4ee5\u8ba9\u4e00\u5217\u706b\u8f66\u4ece\u4e0a\u6d77\u5f00\u5230\u5317\u4eac\u3002\u4f60\u53ea\u9700\u8981\u8db3\u591f\u957f\u7684\u94c1\u8f68\uff08\u6bd4\u5982\u8bf43\u516c\u91cc\uff09\u5c31\u53ef\u4ee5\u5b8c\u6210\u8fd9\u4e2a\u4efb\u52a1\u3002\u91c7\u53d6\u7684\u65b9\u6cd5\u662f\u628a\u540e\u9762\u7684\u94c1\u8f68\u7acb\u523b\u94fa\u5230\u706b\u8f66\u7684\u524d\u9762\uff0c\u53ea\u8981\u4f60\u7684\u64cd\u4f5c\u8db3\u591f\u5feb\u5e76\u80fd\u6ee1\u8db3\u8981\u6c42\uff0c\u5217\u8f66\u5c31\u80fd\u50cf\u5728\u4e00\u6761\u5b8c\u6574\u7684\u8f68\u9053\u4e0a\u8fd0\u884c\u3002</p> <p>swap\u548c\u865a\u62df\u5185\u5b58\u7ed3\u4f34\u800c\u6765\u7684\u3002\u5982\u679c\u7cfb\u7edf\u662f64\u4f4d\uff0c\u6700\u5927\u865a\u62df\u5185\u5b58\u53ef\u4ee5\u662f2\u768464\u6b21\u65b9\uff0c\u6ca1\u6709\u8ba1\u7b97\u673a\u4f1a\u6709\u8fd9\u4e48\u5927\u7684\u5185\u5b58\u3002\u5f53\u5185\u5b58\u4e0d\u591f\u7528\u7684\u65f6\u5019\u53ea\u80fd\u6620\u5c04\u5230\u78c1\u76d8\u3002linux\u4e13\u95e8\u5f00\u8f9f\u4e86\u4e00\u4e2aswap\u78c1\u76d8\u5206\u533a\uff0c\u5f53\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\u7684\u65f6\u5019(\u7a0b\u5e8f\u5e76\u4e0d\u77e5\u9053)\uff0c\u5c06\u5185\u5b58\u4e2d\u5f88\u4e45\u4e0d\u4f7f\u7528\u7684\u5185\u5b58\u533a\u57df\u4ea4\u6362\u5230swap\u533a\u3002\u4e5f\u5373\u662f\u8bf4\uff1a\u7528\u4f5c\u865a\u62df\u5185\u5b58\u7684\u78c1\u76d8\u7a7a\u95f4\u79f0\u4e3a\u4ea4\u6362\u7a7a\u95f4\uff08swap\u7a7a\u95f4\uff09\u3002</p> <p>Android \u6ca1\u6709\u4f7f\u7528\u78c1\u76d8\u4f5c\u4e3a\u4ea4\u6362\u7a7a\u95f4\uff0c\u800c\u662f\u4f7f\u7528<code>zRAM</code>\u6765\u5b9e\u73b0swap\uff0c<code>zram swap</code> \u4e3b\u8981\u539f\u7406\u5c31\u662f\u4ece\u5185\u5b58\u5206\u914d\u4e00\u5757\u533a\u57df\u51fa\u6765\u7528\u4f5c swap \u5206\u533a\uff0c\u6bcf\u6b21\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\u4e86\uff0c\u4e0d\u662f\u628a\u5e94\u7528\u7a0b\u5e8f\u6740\u6389\uff0c\u800c\u662f\u628a\u5e94\u7528\u7a0b\u5e8f\u6240\u5360\u7528\u7684\u5185\u5b58\u6570\u636e\u590d\u5236\u5230 swap \u5206\u533a\uff0c\u7b49\u5207\u6362\u56de\u6765\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u76f4\u63a5\u628a\u8fd9\u90e8\u5206\u6570\u636e\u6062\u590d\u5230\u5185\u5b58\u5f53\u4e2d\uff0c\u8282\u7701\u91cd\u65b0\u5f00\u542f\u6240\u9700\u7684\u65f6\u95f4\u3002\u800c\u88ab\u653e\u5230 swap \u5206\u533a\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u6240\u5360\u7528\u7684\u5185\u5b58\u90fd\u662f\u88ab\u538b\u7f29\u8fc7\u7684\uff0c\u6bd4\u5982\uff0c\u5fae\u4fe1\u5728\u666e\u901a\u5185\u5b58\u4e2d\u5360\u7528 50 MB \u7684\u7a7a\u95f4\uff0c\u5982\u679c\u538b\u7f29\u7387\u4e3a 0.4\uff0c\u5219\u653e\u5230 swap \u5206\u533a\u91cc\u9762\u7684\u6570\u636e\u53ea\u9700\u8981 20 MB \u7684\u7a7a\u95f4\uff0c\u8fd9\u6837 swap \u5206\u533a\u91cc\u9762\u5c31\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u540e\u53f0\u4e34\u65f6\u4e0d\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u53d8\u76f8\u6269\u5c55\u4e86\u5185\u5b58\u7684\u5927\u5c0f\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#14-jvm","title":"1.4 JVM","text":"<p>JVM\u662f<code>Java Virtual Machine\uff08Java \u865a\u62df\u673a\uff09</code>\u7684\u7f29\u5199\uff0cJVM\u662f\u4e00\u79cd\u7528\u4e8e\u8ba1\u7b97\u8bbe\u5907\u7684\u89c4\u8303\uff0c\u5b83\u662f\u4e00\u4e2a\u865a\u6784\u51fa\u6765\u7684\u8ba1\u7b97\u673a\uff0c\u662f\u901a\u8fc7\u5728\u5b9e\u9645\u7684\u8ba1\u7b97\u673a\u4e0a\u4eff\u771f\u6a21\u62df\u5404\u79cd\u8ba1\u7b97\u673a\u529f\u80fd\u6765\u5b9e\u73b0\u7684\u3002</p> <p>Java\u8bed\u8a00\u7684\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u7279\u70b9\u5c31\u662f\u5e73\u53f0\u65e0\u5173\u6027\u3002\u800c\u4f7f\u7528Java\u865a\u62df\u673a\u662f\u5b9e\u73b0\u8fd9\u4e00\u7279\u70b9\u7684\u5173\u952e\u3002\u4e00\u822c\u7684\u9ad8\u7ea7\u8bed\u8a00\u5982\u679c\u8981\u5728\u4e0d\u540c\u7684\u5e73\u53f0\u4e0a\u8fd0\u884c\uff0c\u81f3\u5c11\u9700\u8981\u7f16\u8bd1\u6210\u4e0d\u540c\u7684\u76ee\u6807\u4ee3\u7801\u3002\u800c\u5f15\u5165Java\u8bed\u8a00\u865a\u62df\u673a\u540e\uff0cJava\u8bed\u8a00\u5728\u4e0d\u540c\u5e73\u53f0\u4e0a\u8fd0\u884c\u65f6\u4e0d\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u3002Java\u8bed\u8a00\u4f7f\u7528Java\u865a\u62df\u673a\u5c4f\u853d\u4e86\u4e0e\u5177\u4f53\u5e73\u53f0\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u4f7f\u5f97Java\u8bed\u8a00\u7f16\u8bd1\u7a0b\u5e8f\u53ea\u9700\u751f\u6210\u5728Java\u865a\u62df\u673a\u4e0a\u8fd0\u884c\u7684\u76ee\u6807\u4ee3\u7801\uff08\u5b57\u8282\u7801\uff09\uff0c\u5c31\u53ef\u4ee5\u5728\u591a\u79cd\u5e73\u53f0\u4e0a\u4e0d\u52a0\u4fee\u6539\u5730\u8fd0\u884c\u3002Java\u865a\u62df\u673a\u5728\u6267\u884c\u5b57\u8282\u7801\u65f6\uff0c\u628a\u5b57\u8282\u7801\u89e3\u91ca\u6210\u5177\u4f53\u5e73\u53f0\u4e0a\u7684\u673a\u5668\u6307\u4ee4\u6267\u884c\u3002\u8fd9\u5c31\u662fJava\u7684\u80fd\u591f \u201c\u4e00\u6b21\u7f16\u8bd1\uff0c\u5230\u5904\u8fd0\u884c\u201d \u7684\u539f\u56e0\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#2-android","title":"2. Android \u5185\u5b58\u7ba1\u7406","text":""},{"location":"perf-opt/Android/memory/Android_memory_manager/#21-art-dalvik","title":"2.1 ART\u548c Dalvik \u865a\u62df\u673a","text":"<p>ART\u548c Dalvik\u662fAndroid\u5e73\u53f0\u7684\u865a\u62df\u673a\uff0c\u9075\u5faa Dex \u5b57\u8282\u7801\u89c4\u8303\uff0c\u5e76\u6ca1\u6709\u9075\u5faa JVM \u89c4\u8303\u6765\u5b9e\u73b0\uff0c\u56e0\u6b64 \u5e76\u4e0d\u662f Java \u865a\u62df\u673a\u3002 ART \u548c Dalvik \u53ef\u4ee5\u652f\u6301\u5df2\u8f6c\u6362\u4e3a .dex\uff08\u5373<code>Dalvik Executable</code>\uff09\u683c\u5f0f\u7684Java\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u3002\u57285.0\u7248\u672c\u4ee5\u540e\uff0cDalvik\u865a\u62df\u673a\u88ab\u5f7b\u5e95\u7684\u4e22\u5f03\uff0c\u5168\u90e8\u91c7\u7528ART\u3002</p> <p>ART \u548c Dalvik \u533a\u522b</p> <ul> <li>\u7f16\u8bd1\u6a21\u5f0f\u4e0d\u540c</li> <li>ART\u4f7f\u7528AOT\uff08Ahead-Of-Time\uff09\u7f16\u8bd1\u6a21\u5f0f\uff0c\u5e94\u7528\u5728\u7b2c\u4e00\u6b21\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u5b57\u8282\u7801\u5c31\u4f1a\u9884\u5148\u7f16\u8bd1\u6210\u673a\u5668\u7801\u5b58\u50a8\u5728\u672c\u5730\u3002\u5728App\u8fd0\u884c\u65f6\uff0cART\u6a21\u5f0f\u5c31\u8f83Dalvik\u6a21\u5f0f\u5c11\u4e86\u89e3\u91ca\u5b57\u8282\u7801\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5App\u7684\u8fd0\u884c\u6548\u7387\u4f1a\u6709\u6240\u63d0\u9ad8\uff0c\u5360\u7528\u5185\u5b58\u4e5f\u4f1a\u76f8\u5e94\u51cf\u5c11\u3002</li> <li>Dalvik \u4f7f\u7528JIT\uff08Just-In-Time\uff09\u7f16\u8bd1\u6a21\u5f0f\uff0c\u610f\u601d\u4e3a\u5373\u65f6\u7f16\u8bd1\uff0c\u6bcf\u6b21\u8fd0\u884capp\u65f6\u865a\u62df\u673a\u4f1a\u5c06dex\u6587\u4ef6\u89e3\u91ca\u7ffb\u8bd1\u6210\u673a\u5668\u7801\uff0c\u8fd9\u6837\u624d\u7b97\u662f\u672c\u5730\u53ef\u6267\u884c\u4ee3\u7801\uff0c\u4e4b\u540e\u88ab\u7cfb\u7edf\u8fd0\u884c\u3002</li> <li>ART\u5360\u7528\u7a7a\u95f4\u6bd4Dalvik\u5927\uff08\u539f\u751f\u4ee3\u7801\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u66f4\u5927\uff0c\u5b57\u8282\u7801\u53d8\u4e3a\u673a\u5668\u7801\u4e4b\u540e\uff0c\u53ef\u80fd\u4f1a\u589e\u52a010%-20%\uff09\uff0c\u8fd9\u4e5f\u662f\u8457\u540d\u7684\u201c\u7a7a\u95f4\u6362\u65f6\u95f4\"\u3002</li> <li>\u9884\u7f16\u8bd1\u4e5f\u53ef\u4ee5\u660e\u663e\u6539\u5584\u7535\u6c60\u7eed\u822a\uff0c\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u6bcf\u6b21\u8fd0\u884c\u65f6\u4e0d\u7528\u91cd\u590d\u7f16\u8bd1\u4e86\uff0c\u4ece\u800c\u51cf\u5c11\u4e86 CPU \u7684\u4f7f\u7528\u9891\u7387\uff0c\u964d\u4f4e\u4e86\u80fd\u8017\u3002</li> <li>Art\u5e94\u7528\u542f\u52a8\u66f4\u5feb\u3001\u8fd0\u884c\u66f4\u5feb\u3001\u4f53\u9a8c\u66f4\u6d41\u7545\u3001\u89e6\u611f\u53cd\u9988\u66f4\u53ca\u65f6\u3002</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#22","title":"2.2 \u5171\u4eab\u5185\u5b58","text":"<p>Android\u53ef\u4ee5\u8de8\u8fdb\u7a0b\u5171\u4eabRAM\u9875\u9762\uff08Pages\uff09\uff09\u3002\u5b83\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\uff1a</p> <ul> <li>\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u90fd\u662f\u4ece\u540d\u4e3aZygote\u7684\u73b0\u6709\u8fdb\u7a0b\u5206\u53c9\uff08fork\uff09\u51fa\u6765\u7684\u3002Zygote\u8fdb\u7a0b\u5728\u7cfb\u7edf\u5f15\u5bfc\u5e76\u52a0\u8f7dframework\u4ee3\u7801\u548c\u8d44\u6e90\uff08\u4f8b\u5982Activity Themes\uff09\u65f6\u542f\u52a8\u3002\u8981\u542f\u52a8\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u7cfb\u7edf\u4f1afork Zygote\u8fdb\u7a0b\uff0c\u7136\u540e\u5728\u65b0\u8fdb\u7a0b\u4e2d\u52a0\u8f7d\u5e76\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u4ee3\u7801\u3002\u8fd9\u79cd\u65b9\u6cd5\u5141\u8bb8\u5728\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u4e2d\u5171\u4eab\u5927\u591a\u6570\u7684\u4e3aframework\u4ee3\u7801\u548c\u8d44\u6e90\u5206\u914d\u7684RAM\u9875\u9762\u3002</li> <li>\u5927\u591a\u6570\u9759\u6001\u6570\u636e\u90fd\u88ab\u6620\u5c04\u5230\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u3002\u8be5\u6280\u672f\u5141\u8bb8\u5728\u8fdb\u7a0b\u4e4b\u95f4\u5171\u4eab\u6570\u636e\uff0c\u5e76\u4e14\u8fd8\u5141\u8bb8\u5728\u9700\u8981\u65f6\u5c06\u5176\u6362\u51fa\u3002\u8fd9\u4e9b\u9759\u6001\u6570\u636e\u5305\u62ec\uff1aDalvik\u4ee3\u7801\uff08\u901a\u8fc7\u5c06\u5176\u7f6e\u4e8e\u9884\u94fe\u63a5\u7684.odex\u6587\u4ef6\u4e2d\u8fdb\u884c\u76f4\u63a5\u7684memory-mapping\uff09\uff0capp\u8d44\u6e90\uff08\u901a\u8fc7\u5c06\u8d44\u6e90\u8868\u8bbe\u8ba1\u4e3a\u53ef\u4ee5mmap\u7684\u7ed3\u6784\u5e76\u901a\u8fc7\u5bf9\u9f50APK\u7684zip\u6761\u76ee\uff09 \u548c\u4f20\u7edf\u7684\u9879\u76ee\u5143\u7d20\uff0c\u5982.so\u6587\u4ef6\u4e2d\u7684\u672c\u5730\u4ee3\u7801\u3002</li> <li>\u5728\u8bb8\u591a\u5730\u65b9\uff0cAndroid\u4f7f\u7528\u663e\u5f0f\u5206\u914d\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\uff08\u901a\u8fc7ashmem\u6216gralloc\uff09\u5728\u8fdb\u7a0b\u95f4\u5171\u4eab\u76f8\u540c\u7684\u52a8\u6001RAM\u3002\u4f8b\u5982\uff0cWindow surface\u5728\u5e94\u7528\u7a0b\u5e8f\u548c\u5c4f\u5e55\u5408\u6210\u5668\u4e4b\u95f4\u4f7f\u7528\u5171\u4eab\u5185\u5b58\uff0c\u800c\u6e38\u6807(cursor)\u7f13\u51b2\u533a\u5728Content Provider\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u3002</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#23","title":"2.3 \u5185\u5b58\u9875\u9762","text":"<p>\u7cfb\u7edf\u4f1a\u5c06\u9875\u9762\u89c6\u4e3a<code>\u53ef\u7528</code>\u6216<code>\u5df2\u4f7f\u7528</code>\u3002\u53ef\u7528\u9875\u9762\u662f\u672a\u4f7f\u7528\u7684 RAM\u3002\u5df2\u4f7f\u7528\u7684\u9875\u9762\u662f\u7cfb\u7edf\u76ee\u524d\u6b63\u5728\u4f7f\u7528\u7684 RAM\uff0c\u5e76\u5206\u4e3a\u4ee5\u4e0b\u7c7b\u522b\uff1a</p> <ul> <li>\u7f13\u5b58\u9875\uff1a\u6709\u5b58\u50a8\u6587\u4ef6\uff08\u4f8b\u5982\u4ee3\u7801\u6216\u5185\u5b58\u6620\u5c04\u6587\u4ef6\uff09\u7684\u5185\u5b58\u3002\u7f13\u5b58\u5185\u5b58\u6709\u4e24\u79cd\u7c7b\u578b\uff1a<ul> <li>\u79c1\u6709\u9875\uff1a\u7531\u4e00\u4e2a\u8fdb\u7a0b\u62e5\u6709\u4e14\u672a\u5171\u4eab<ul> <li>\u5e72\u51c0\u9875\uff1a\u5b58\u50a8\u5668\u4e2d\u672a\u7ecf\u4fee\u6539\u7684\u6587\u4ef6\u526f\u672c\uff0c\u53ef\u7531 <code>kswapd</code> \u5220\u9664\u4ee5\u589e\u52a0\u53ef\u7528\u5185\u5b58</li> <li>\u810f\u9875\uff1a\u5b58\u50a8\u5668\u4e2d\u7ecf\u8fc7\u4fee\u6539\u7684\u6587\u4ef6\u526f\u672c\uff1b\u53ef\u7531 <code>kswapd</code> \u79fb\u52a8\u5230 zRAM \u6216\u5728 zRAM \u4e2d\u8fdb\u884c\u538b\u7f29\u4ee5\u589e\u52a0\u53ef\u7528\u5185\u5b58</li> </ul> </li> <li>\u5171\u4eab\u9875\uff1a\u7531\u591a\u4e2a\u8fdb\u7a0b\u4f7f\u7528<ul> <li>\u5e72\u51c0\u9875\uff1a\u5b58\u50a8\u5668\u4e2d\u672a\u7ecf\u4fee\u6539\u7684\u6587\u4ef6\u526f\u672c\uff0c\u53ef\u7531 <code>kswapd</code> \u5220\u9664\u4ee5\u589e\u52a0\u53ef\u7528\u5185\u5b58</li> <li>\u810f\u9875\uff1a\u5b58\u50a8\u5668\u4e2d\u7ecf\u8fc7\u4fee\u6539\u7684\u6587\u4ef6\u526f\u672c\uff1b\u5141\u8bb8\u901a\u8fc7 <code>kswapd</code> \u6216\u8005\u901a\u8fc7\u660e\u786e\u4f7f\u7528 <code>msync()</code> \u6216 <code>munmap()</code> \u5c06\u66f4\u6539\u5199\u56de\u5b58\u50a8\u5668\u4e2d\u7684\u6587\u4ef6\uff0c\u4ee5\u589e\u52a0\u53ef\u7528\u7a7a\u95f4</li> </ul> </li> </ul> </li> <li>\u533f\u540d\u9875\uff1a\u6ca1\u6709\u5b58\u50a8\u6587\u4ef6\u652f\u6301\u7684\u5185\u5b58\uff08\u4f8b\u5982\uff0c\u901a\u8fc7\u8bbe\u7f6e\u4e86<code>MAP_ANONYMOUS</code>\u6807\u8bb0\u7684<code>mmap()</code>\u8fdb\u884c\u5206\u914d\uff09<ul> <li>\u810f\u9875\uff1a\u53ef\u7531 <code>kswapd</code> \u79fb\u52a8\u5230 zRAM/\u5728 zRAM \u4e2d\u8fdb\u884c\u538b\u7f29\u4ee5\u589e\u52a0\u53ef\u7528\u5185\u5b58</li> </ul> </li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#24","title":"2.4 \u5185\u5b58\u4e0d\u8db3\u7ba1\u7406","text":"<p>\u9762\u5bf9\u4e0d\u540c\u7684\u5185\u5b58\u538b\u529b\uff0candroid \u4f1a\u6709\u4e0d\u540c\u7684\u5e94\u5bf9\u7b56\u7565\u3002\u4ece\u4f4e\u5230\u9ad8\u4f9d\u6b21\u662f <code>\u5783\u573e\u56de\u6536\uff08GC\uff09</code>\u3001<code>\u5185\u6838\u4ea4\u6362\u5b88\u62a4\u8fdb\u7a0b(kswapd)</code>\u91ca\u653e\u5185\u5b58\u3001<code>\u4f4e\u5185\u5b58\u7ec8\u6b62\u5b88\u62a4\u8fdb\u7a0b\u6740\u6b7b\u8fdb\u7a0b(low-memory killer)</code>\u91ca\u653e\u5185\u5b58\uff1b\u4ed6\u4eec\u7684\u4ee3\u4ef7\u4e5f\u662f\u9010\u6b65\u4e0a\u5347\u3002\u4e0b\u9762\u6211\u4eec\u4f9d\u4e2a\u6765\u4ecb\u7ecd\u4e00\u4e0b\u3002       </p>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#25-gc","title":"2.5 GC \u5783\u573e\u56de\u6536","text":"<p>\u65e0\u8bba\u662fART\u8fd8\u662fDalvik\u865a\u62df\u673a\uff0c\u90fd\u548c\u4f17\u591aJava\u865a\u62df\u673a\u4e00\u6837\uff0c\u5c5e\u4e8e\u4e00\u79cd\u6258\u7ba1\u5185\u5b58\u73af\u5883\uff08\u7a0b\u5e8f\u5458\u4e0d\u9700\u8981\u663e\u793a\u7684\u7ba1\u7406\u5185\u5b58\u7684\u5206\u914d\u4e0e\u56de\u6536\uff0c\u4ea4\u7531\u7cfb\u7edf\u81ea\u52a8\u7ba1\u7406\uff09\u3002\u6258\u7ba1\u5185\u5b58\u73af\u5883\u4f1a\u8ddf\u8e2a\u6bcf\u4e2a\u5185\u5b58\u5206\u914d\uff0c \u4e00\u65e6\u786e\u5b9a\u7a0b\u5e8f\u4e0d\u518d\u4f7f\u7528\u4e00\u5757\u5185\u5b58\uff0c\u5b83\u5c31\u4f1a\u5c06\u5176\u91ca\u653e\u56de\u5806\u4e2d\uff0c\u800c\u65e0\u9700\u7a0b\u5e8f\u5458\u7684\u4efb\u4f55\u5e72\u9884\u3002\u56de\u6536\u6258\u7ba1\u5185\u5b58\u73af\u5883\u4e2d\u672a\u4f7f\u7528\u5185\u5b58\u7684\u673a\u5236\u79f0\u4e3a\u5783\u573e\u56de\u6536\u3002</p> <p>\u8fa8\u522b\u4e00\u4e2a\u5bf9\u8c61\u662f\u5426\u662f\u5783\u573e\uff0c\u865a\u62df\u673a\u91c7\u7528\u7684\u662f\u53ef\u8fbe\u6027\u5206\u6790\u6cd5\u3002\u5373\u4ece\u4e00\u4e9b\u786e\u5b9a\u6d3b\u8dc3\u6709\u7528\u7684\u5bf9\u8c61\u51fa\u53d1\uff0c\u5411\u4e0b\u5206\u6790\u4ed6\u7684\u5f15\u7528\u94fe\uff1b\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u76f4\u63a5\u6216\u8005\u95f4\u63a5\u8fd9\u4e9b\u5bf9\u8c61\u6240\u5f15\u7528\uff0c\u90a3\u4e48\u4ed6\u5c31\u4e0d\u662f\u5783\u573e\uff0c\u5426\u5219\u5c31\u662f\u5783\u573e\u3002\u8fd9\u4e9b\u786e\u5b9a\u6d3b\u8dc3\u6709\u7528\u7684\u5bf9\u8c61\u79f0\u4e3a <code>GC Roots</code>\uff1a</p> <p>GC Root\u5bf9\u8c61</p> <ul> <li>\u865a\u62df\u673a\u6808\uff08\u6808\u5e27\u4e2d\u7684\u672c\u5730\u53d8\u91cf\u8868\uff09\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u672c\u5730\u65b9\u6cd5\u6808\u4e2d JNI\uff08\u5373\u4e00\u822c\u8bf4\u7684 Native \u65b9\u6cd5\uff09\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u65b9\u6cd5\u533a\u4e2d\u7c7b\u9759\u6001\u5c5e\u6027\u5f15\u7528\u7684\u5bf9\u8c61</li> <li>\u65b9\u6cd5\u533a\u4e2d\u5e38\u91cf\u5f15\u7528\u7684\u5bf9\u8c61</li> </ul> <p>GC \u4e5f\u5e76\u4e0d\u662f\u76f4\u63a5\u5bf9\u6574\u4e2a\u5806\u533a\u8fdb\u884c\u56de\u6536\uff0c\u800c\u662f\u5c06\u5806\u533a\u4e2d\u7684\u5bf9\u8c61\u5206\u6210\u4e24\u4e2a\u90e8\u5206\uff1a<code>\u65b0\u751f\u4ee3</code>\u3001<code>\u8001\u5e74\u4ee3</code>\u3002</p> <p>\u521a\u521b\u5efa\u7684\u5bf9\u8c61\u5927\u90fd\u4f1a\u88ab\u56de\u6536\uff0c\u800c\u5728\u591a\u6b21\u56de\u6536\u4e2d\u5b58\u6d3b\u7684\u5bf9\u8c61\u5219\u540e\u7eed\u4e5f\u5f88\u5c11\u88ab\u56de\u6536\u3002\u65b0\u751f\u4ee3\u4e2d\u5b58\u50a8\u7684\u5bf9\u8c61\u4e3b\u8981\u662f\u521a\u88ab\u521b\u5efa\u4e0d\u4e45\u7684\u5bf9\u8c61\uff0c\u800c\u8001\u5e74\u4ee3\u5219\u5b58\u50a8\u7740\u90a3\u4e9b\u5728\u591a\u6b21 GC \u4e2d\u5b58\u6d3b\u7684\u5bf9\u8c61\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u9488\u5bf9\u8fd9\u4e9b\u4e0d\u540c\u7279\u6027\u7684\u5bf9\u8c61\uff0c\u6267\u884c\u4e0d\u540c\u7684\u56de\u6536\u7b97\u6cd5\u6765\u63d0\u9ad8GC\u6027\u80fd\uff1a</p> <ul> <li>\u5bf9\u4e8e\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u9700\u8981\u66f4\u52a0\u9891\u7e41\u5730\u5bf9\u4ed6\u4eec\u8fdb\u884cGC\u6765\u91ca\u653e\u5185\u5b58\uff0c\u4e14\u6bcf\u6b21\u53ea\u9700\u8981\u8bb0\u5f55\u9700\u8981\u7559\u4e0b\u6765\u7684\u5bf9\u8c61\u5373\u53ef\uff0c\u800c\u4e0d\u5fc5\u8981\u53bb\u6807\u8bb0\u5176\u4ed6\u5927\u91cf\u9700\u8981\u88ab\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u63d0\u9ad8\u6027\u80fd\uff08<code>\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5</code>\uff09\u3002</li> <li>\u5bf9\u4e8e\u71ac\u8fc7\u5f88\u591a\u6b21GC\u7684\u5bf9\u8c61\uff0c\u5219\u53ef\u4ee5\u4ee5\u66f4\u4f4e\u7684\u9891\u7387\u5bf9\u4ed6\u95e8\u8fdb\u884cGC\uff0c\u4e14\u6bcf\u6b21\u53ea\u9700\u8981\u5173\u6ce8\u5c11\u91cf\u9700\u8981\u88ab\u56de\u6536\u7684\u5bf9\u8c61\u5373\u53ef\uff08<code>\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5</code>\uff09\u3002 <p>\u5173\u4e8e\u5783\u573e\u56de\u6536\u7b97\u6cd5\u89c1\u8be6\u7ec6\u8bf4\u660e</p> </li> </ul> <p>\u5c3d\u7ba1\u5783\u573e\u56de\u6536\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u4f46\u4ecd\u4f1a\u5f71\u54cd\u5e94\u7528\u7684\u6027\u80fd\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u60a8\u65e0\u6cd5\u4ece\u4ee3\u7801\u4e2d\u63a7\u5236\u4f55\u65f6\u53d1\u751f\u5783\u573e\u56de\u6536\u4e8b\u4ef6\u3002\u7cfb\u7edf\u6709\u4e00\u5957\u4e13\u95e8\u786e\u5b9a\u4f55\u65f6\u6267\u884c\u5783\u573e\u56de\u6536\u7684\u6807\u51c6\u3002\u5f53\u6761\u4ef6\u6ee1\u8db3\u65f6\uff0c\u7cfb\u7edf\u4f1a\u505c\u6b62\u6267\u884c\u8fdb\u7a0b\u5e76\u5f00\u59cb\u5783\u573e\u56de\u6536\u3002\u5982\u679c\u5728\u52a8\u753b\u6216\u97f3\u4e50\u64ad\u653e\u7b49\u5bc6\u96c6\u578b\u5904\u7406\u5faa\u73af\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5783\u573e\u56de\u6536\uff0c\u5219\u53ef\u80fd\u4f1a\u589e\u52a0\u5904\u7406\u65f6\u95f4\uff0c\u8fdb\u800c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u4e2d\u7684\u4ee3\u7801\u6267\u884c\u8d85\u51fa\u5efa\u8bae\u7684 16ms \u9608\u503c\uff0c\u65e0\u6cd5\u5b9e\u73b0\u9ad8\u6548\u3001\u6d41\u7545\u7684\u5e27\u6e32\u67d3\u3002</p> <p>\u6b64\u5916\uff0c\u60a8\u7684\u4ee3\u7801\u6d41\u6267\u884c\u7684\u5404\u79cd\u5de5\u4f5c\u53ef\u80fd\u8feb\u4f7f\u5783\u573e\u56de\u6536\u4e8b\u4ef6\u53d1\u751f\u5f97\u66f4\u9891\u7e41\u6216\u5bfc\u81f4\u5176\u6301\u7eed\u65f6\u95f4\u8d85\u8fc7\u6b63\u5e38\u8303\u56f4\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728 Alpha \u6df7\u5408\u52a8\u753b\u7684\u6bcf\u4e00\u5e27\u671f\u95f4\uff0c\u5728 for \u5faa\u73af\u7684\u6700\u5185\u5c42\u5206\u914d\u591a\u4e2a\u5bf9\u8c61\uff0c\u5219\u53ef\u80fd\u4f1a\u4f7f\u5185\u5b58\u5806\u53d7\u5230\u5927\u91cf\u5bf9\u8c61\u7684\u5f71\u54cd\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5783\u573e\u56de\u6536\u5668\u4f1a\u6267\u884c\u591a\u4e2a\u5783\u573e\u56de\u6536\u4e8b\u4ef6\uff08<code>\u5185\u5b58\u6296\u52a8</code>\uff09\uff0c\u5e76\u53ef\u80fd\u964d\u4f4e\u5e94\u7528\u7684\u6027\u80fd\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#26","title":"2.6 \u5185\u6838\u4ea4\u6362\u5b88\u62a4\u8fdb\u7a0b","text":"<p>\u5185\u6838\u4ea4\u6362\u5b88\u62a4\u8fdb\u7a0b (<code>kswapd</code>) \u662f Linux \u5185\u6838\u7684\u4e00\u90e8\u5206\uff0c\u7528\u4e8e\u5c06\u5df2\u4f7f\u7528\u5185\u5b58\u8f6c\u6362\u4e3a\u53ef\u7528\u5185\u5b58\u3002\u5f53\u8bbe\u5907\u4e0a\u7684\u53ef\u7528\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u8be5\u5b88\u62a4\u8fdb\u7a0b\u5c06\u53d8\u4e3a\u6d3b\u52a8\u72b6\u6001\u3002Linux \u5185\u6838\u8bbe\u6709\u53ef\u7528\u5185\u5b58\u4e0a\u4e0b\u9650\u9608\u503c\u3002\u5f53\u53ef\u7528\u5185\u5b58\u964d\u81f3\u4e0b\u9650\u9608\u503c\u4ee5\u4e0b\u65f6\uff0c<code>kswapd</code> \u5f00\u59cb\u56de\u6536\u5185\u5b58\u3002\u5f53\u53ef\u7528\u5185\u5b58\u8fbe\u5230\u4e0a\u9650\u9608\u503c\u65f6\uff0c<code>kswapd</code> \u505c\u6b62\u56de\u6536\u5185\u5b58\u3002</p> <p>\u5b83\u4e3b\u8981\u7684\u5de5\u4f5c\u65f6\u56de\u6536\u5e72\u51c0\u9875\u3001\u538b\u7f29\u9875\u7b49\u64cd\u4f5c\u6765\u91ca\u653e\u5185\u5b58\u3002</p> <ul> <li>\u5f53\u5185\u6838\u4ea4\u6362\u5b88\u62a4\u8fdb\u7a0b\u542f\u52a8\u65f6\uff0c\u4ed6\u4f1a\u628a\u5e72\u51c0\u9875\u56de\u6536\u4ee5\u91ca\u653e\u5185\u5b58\u3002\u5f53\u8fdb\u7a0b\u518d\u6b21\u8bbf\u95ee\u5e72\u51c0\u9875\u65f6\uff0c\u5219\u9700\u8981\u53bb\u786c\u76d8\u4e2d\u518d\u6b21\u8bfb\u53d6\u3002</li> <li>\u5bf9\u4e8e\u810f\u9875\uff0c\u5185\u6838\u4ea4\u6362\u5b88\u62a4\u8fdb\u7a0b\u4f1a\u628a\u4ed6\u4eec\u538b\u7f29\u540e\u653e\u5165 zRAM \u4e2d\u3002\u5f53\u8fdb\u7a0b\u8bbf\u95ee\u810f\u9875\u65f6\uff0c\u5219\u9700\u8981\u4ecezRAM\u4e2d\u89e3\u538b\u51fa\u6765\u3002</li> </ul> <p>\u901a\u8fc7\u4e0d\u65ad\u56de\u6536\u548c\u538b\u7f29\u5206\u9875\u7684\u65b9\u5f0f\u6765\u91ca\u653e\u5185\u5b58\uff0c\u4ee5\u6ee1\u8db3\u65b0\u7684\u5185\u5b58\u8bf7\u6c42\u3002\u4f7f\u7528\u6b64\u65b9\u5f0f\u91ca\u653e\u7684\u5185\u5b58\u4e5f\u65e0\u6cd5\u6ee1\u8db3\u65b0\u7684\u5185\u5b58\u8bf7\u6c42\u65f6\uff0candroid \u4f1a\u542f\u52a8\u4f4e\u5185\u5b58\u7ec8\u6b62\u5b88\u62a4\u8fdb\u7a0b\uff0c\u6765\u7ec8\u6b62\u4e00\u4e9b\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_manager/#27","title":"2.7 \u4f4e\u5185\u5b58\u7ec8\u6b62\u5b88\u62a4\u8fdb\u7a0b","text":"<p>\u5f88\u591a\u65f6\u5019\uff0c<code>kswapd</code> \u4e0d\u80fd\u4e3a\u7cfb\u7edf\u91ca\u653e\u8db3\u591f\u7684\u5185\u5b58\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u4f1a\u4f7f\u7528 <code>onTrimMemory()</code> \u901a\u77e5\u5e94\u7528\u5185\u5b58\u4e0d\u8db3\uff0c\u5e94\u8be5\u51cf\u5c11\u5176\u5206\u914d\u91cf\u3002\u5982\u679c\u8fd9\u8fd8\u4e0d\u591f\uff0c\u5185\u6838\u4f1a\u5f00\u59cb\u7ec8\u6b62\u8fdb\u7a0b\u4ee5\u91ca\u653e\u5185\u5b58\u3002\u5b83\u4f1a\u4f7f\u7528\u4f4e\u5185\u5b58\u7ec8\u6b62\u5b88\u62a4\u8fdb\u7a0b (LMK) \u6765\u6267\u884c\u6b64\u64cd\u4f5c\u3002</p> <p><code>LMK</code> \u4f7f\u7528\u4e00\u4e2a\u540d\u4e3a <code>oom_adj_score</code> \u7684<code>\u5185\u5b58\u4e0d\u8db3\u5206\u503c</code>\u6765\u786e\u5b9a\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\uff0c\u4ee5\u6b64\u51b3\u5b9a\u8981\u7ec8\u6b62\u7684\u8fdb\u7a0b\uff0c\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f\u5982\u4e0b\uff0c\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u8fdb\u7a0b\u4f1a\u4f18\u5148\u88ab\u7ec8\u6b62\uff1a </p> <p>\u4ece\u4e0a\u5230\u4e0b\u4f9d\u6b21\u662f\uff1a</p> <ul> <li>\u540e\u53f0\u5e94\u7528\uff1a\u4f7f\u7528\u8fc7\u7684 app \u4f1a\u88ab\u7f13\u5b58\u5728\u540e\u53f0\uff0c\u4e0b\u4e00\u6b21\u6253\u5f00\u53ef\u4ee5\u66f4\u52a0\u5feb\u901f\u5730\u8fdb\u884c\u5207\u6362\u3002\u5f53\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u6b64\u7c7b\u5e94\u7528\u4f1a\u6700\u5feb\u88ab\u6740\u6b7b\u3002</li> <li>\u4e0a\u4e00\u4e2a\u5e94\u7528\uff1a\u4f8b\u5982\u4ece\u5fae\u4fe1\u8df3\u8f6c\u5230\u6d4f\u89c8\u5668\uff0c\u6b64\u65f6\u5fae\u4fe1\u5c31\u662f\u4e0a\u4e00\u4e2a\u5e94\u7528\u3002</li> <li>\u4e3b\u5c4f\u5e55\u5e94\u7528\uff1a\u8fd9\u662f\u542f\u52a8\u5668\u5e94\u7528\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u684c\u9762\u3002\u5982\u679c\u8fd9\u4e2a\u8fdb\u7a0b\u88abkill\u4e86\uff0c\u90a3\u4e48\u8fd4\u56de\u684c\u9762\u65f6\u4f1a\u6682\u65f6\u9ed1\u5c4f\u3002</li> <li>\u670d\u52a1\uff1a\u540c\u6b65\u670d\u52a1\u3001\u4e0a\u4f20\u670d\u52a1\u7b49\u7b49</li> <li>\u53ef\u89c9\u5bdf\u7684\u5e94\u7528\uff1a\u4f8b\u5982\u6b63\u5728\u64ad\u653e\u7684\u97f3\u4e50\u8f6f\u4ef6\uff0c\u4ed6\u53ef\u4ee5\u88ab\u6211\u4eec\u611f\u77e5\u5230\uff0c\u4f46\u662f\u4e0d\u5728\u524d\u53f0\u3002</li> <li>\u524d\u53f0\u5e94\u7528\uff1a\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u5e94\u7528\uff0c\u5982\u679c\u8fd9\u4e2a\u5e94\u7528\u88abkill\u4e86\uff0c\u9700\u8981\u5411\u7528\u6237\u62a5\u5d29\u6e83\u5f02\u5e38\uff0c\u6b64\u65f6\u7684\u4f53\u9a8c\u662f\u6781\u5dee\u7684\u3002</li> <li>\u6301\u4e45\u6027\uff08\u670d\u52a1\uff09\uff1a\u8fd9\u4e9b\u662f\u8bbe\u5907\u7684\u6838\u5fc3\u670d\u52a1\uff0c\u4f8b\u5982\u7535\u8bdd\u548c WLAN\u3002</li> <li>\u7cfb\u7edf\uff1a\u7cfb\u7edf\u8fdb\u7a0b\u3002\u8fd9\u4e9b\u8fdb\u7a0b\u88ab\u7ec8\u6b62\u540e\uff0c\u624b\u673a\u53ef\u80fd\u5373\u5c06\u91cd\u65b0\u542f\u52a8\uff0c\u5c31\u50cf\u624b\u673a\u7a81\u7136\u5361\u6b7b\u91cd\u542f\u3002</li> <li>\u539f\u751f\uff1a\u7cfb\u7edf\u4f7f\u7528\u7684\u6781\u4f4e\u7ea7\u522b\u7684\u8fdb\u7a0b\uff0c\u4f8b\u5982\u6211\u4eec\u7684\u5185\u6838\u4ea4\u6362\u5b88\u62a4\u8fdb\u7a0b\u3002</li> </ul> <p>\u8fdb\u7a0b\u4f18\u5148\u7ea7</p> <p>Android\u4e2d\u603b\u5171\u67095\u4e2a\u8fdb\u7a0b\u4f18\u5148\u7ea7\uff08\u6309\u91cd\u8981\u6027\u964d\u5e8f\uff09\uff1a</p> <ul> <li> <p>Foreground Process\uff1a\u524d\u53f0\u8fdb\u7a0b\uff08\u6b63\u5e38\u4e0d\u4f1a\u88ab\u6740\u6b7b\uff09 \u7528\u6237\u5f53\u524d\u64cd\u4f5c\u6240\u5fc5\u9700\u7684\u8fdb\u7a0b\u3002\u6709\u5f88\u591a\u7ec4\u4ef6\u80fd\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u4f7f\u5f97\u5176\u6240\u5728\u8fdb\u7a0b\u88ab\u5224\u5b9a\u4e3a\u524d\u53f0\u8fdb\u7a0b\u3002\u5982\u4e00 \u4e2a\u8fdb\u7a0b\u6ee1\u8db3\u4ee5\u4e0b\u4efb\u4e00\u6761\u4ef6\uff0c\u5373\u89c6\u4e3a\u524d\u53f0\u8fdb\u7a0b\uff1a</p> <ul> <li>\u6258\u7ba1\u7528\u6237\u6b63\u5728\u4ea4\u4e92\u7684 Activity\uff08\u5df2\u8c03\u7528 Activity \u7684 onResume() \u65b9\u6cd5\uff09</li> <li>\u6258\u7ba1\u67d0\u4e2a Service\uff0c\u540e\u8005\u7ed1\u5b9a\u5230\u7528\u6237\u6b63\u5728\u4ea4\u4e92\u7684 Activity</li> <li>\u6258\u7ba1\u6b63\u6267\u884c\u4e00\u4e2a\u751f\u547d\u5468\u671f\u56de\u8c03\u7684 Service\uff08onCreate()\u3001onStart() \u6216 onDestroy()\uff09</li> <li>\u6258\u7ba1\u6b63\u6267\u884c\u5176 onReceive() \u65b9\u6cd5\u7684 BroadcastReceiver</li> </ul> </li> <li> <p>Visible Process\uff1a\u53ef\u89c1\u8fdb\u7a0b\uff08\u6b63\u5e38\u4e0d\u4f1a\u88ab\u6740\u6b7b) \u6ca1\u6709\u4efb\u4f55\u524d\u53f0\u7ec4\u4ef6\u3001\u4f46\u4ecd\u4f1a\u5f71\u54cd\u7528\u6237\u5728\u5c4f\u5e55\u4e0a\u6240\u89c1\u5185\u5bb9\u7684\u8fdb\u7a0b\u3002\u6740\u6b7b\u8fd9\u7c7b\u8fdb\u7a0b\u4e5f\u4f1a\u660e\u663e\u5f71\u54cd\u7528\u6237\u4f53 \u9a8c\u3002\u5982\u679c\u4e00\u4e2a\u8fdb\u7a0b\u6ee1\u8db3\u4ee5\u4e0b\u4efb\u4e00\u6761\u4ef6\uff0c\u5373\u89c6\u4e3a\u53ef\u89c1\u8fdb\u7a0b\uff1a</p> <ul> <li>\u6258\u7ba1\u4e0d\u5728\u524d\u53f0\u3001\u4f46\u4ecd\u5bf9\u7528\u6237\u53ef\u89c1\u7684 Activity\uff08<code>\u5df2\u8c03\u7528\u5176 onPause() \u65b9\u6cd5,\u4f46\u6ca1\u6709\u8c03\u7528onStop</code>\uff09\u3002\u4f8b\u5982\uff0c\u4e0a\u5c42Activity\u662fDialog\u98ce\u683c\u65f6\u6216\u8005\u4e0a\u5c42Activity\u662f\u900f\u660e\u65f6;</li> <li>\u6258\u7ba1\u901a\u8fc7 Service.startForeground() \u542f\u52a8\u7684\u524d\u53f0Service <p>Service.startForeground()\uff1a\u5b83\u8981\u6c42\u7cfb\u7edf\u5c06\u5b83\u89c6\u4e3a\u7528\u6237\u53ef\u5bdf\u89c9\u5230\u7684\u670d\u52a1\uff0c\u6216\u8005\u57fa\u672c\u4e0a\u5bf9\u7528\u6237\u662f\u53ef\u89c1\u7684\u3002</p> </li> <li>\u6258\u7ba1\u7cfb\u7edf\u7528\u4e8e\u67d0\u4e2a\u7528\u6237\u53ef\u5bdf\u89c9\u7684\u7279\u5b9a\u529f\u80fd\u7684Service\uff0c\u6bd4\u5982\u52a8\u6001\u58c1\u7eb8\u3001\u8f93\u5165\u6cd5\u670d\u52a1\u7b49\u7b49\u3002</li> </ul> </li> <li> <p>Service Process\uff1a\u670d\u52a1\u8fdb\u7a0b\uff08\u6b63\u5e38\u4e0d\u4f1a\u88ab\u6740\u6b7b\uff09</p> </li> </ul> <p>\u6b63\u5728\u8fd0\u884c\u5df2\u4f7f\u7528 startService() \u65b9\u6cd5\u542f\u52a8\u7684\u670d\u52a1\u4e14\u4e0d\u5c5e\u4e8e\u4e0a\u8ff0\u4e24\u4e2a\u66f4\u9ad8\u7c7b\u522b\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u3002\u5c3d\u7ba1\u670d\u52a1\u8fdb\u7a0b\u4e0e\u7528\u6237\u6240\u89c1\u5185\u5bb9\u6ca1\u6709\u76f4\u63a5\u5173\u8054\uff0c\u4f46\u662f\u5b83\u4eec\u901a\u5e38\u5728\u6267\u884c\u4e00\u4e9b\u7528\u6237\u5173\u5fc3\u7684\u64cd\u4f5c\uff08\u4f8b\u5982\uff0c\u540e\u53f0\u7f51\u7edc\u4e0a\u4f20\u6216\u4e0b\u8f7d\u6570\u636e\uff09\u3002\u56e0\u6b64\uff0c\u9664\u975e\u5185\u5b58\u4e0d\u8db3\u4ee5\u7ef4\u6301\u6240\u6709\u524d\u53f0\u8fdb\u7a0b\u548c\u53ef\u89c1\u8fdb\u7a0b\u540c\u65f6\u8fd0\u884c\uff0c\u5426\u5219\u7cfb\u7edf\u4f1a\u8ba9\u670d\u52a1\u8fdb\u7a0b\u4fdd\u6301\u8fd0\u884c\u72b6\u6001\u3002</p> <ul> <li>Background / Cached Process\uff1a\u540e\u53f0\u8fdb\u7a0b\uff08\u53ef\u80fd\u968f\u65f6\u88ab\u6740\u6b7b\uff09</li> </ul> <p>\u8fd9\u7c7b\u8fdb\u7a0b\u4e00\u822c\u4f1a\u6301\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u76ee\u524d\u5bf9\u7528\u6237\u4e0d\u53ef\u89c1\u7684 Activity \uff08\u5df2\u8c03\u7528 Activity \u7684 onStop() \u65b9\u6cd5\uff09\u3002\u5b83\u4eec\u4e0d\u662f\u5f53\u524d\u6240\u5fc5\u987b\u7684\uff0c\u56e0\u6b64\u5f53\u5176\u4ed6\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u9700\u8981\u5185\u5b58\u65f6\uff0c\u7cfb\u7edf\u53ef\u80fd \u968f\u65f6\u7ec8\u6b62 \u5b83\u4eec\u4ee5\u56de\u6536\u5185\u5b58\u3002\u4f46\u5982\u679c\u6b63\u786e\u5b9e\u73b0\u4e86Activity\u7684\u751f\u547d\u5468\u671f\uff0c\u5373\u4fbf\u7cfb\u7edf\u7ec8\u6b62\u4e86\u8fdb\u7a0b\uff0c\u5f53\u7528\u6237\u518d\u6b21\u8fd4\u56de\u5e94\u7528\u65f6\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\uff1a\u5173\u8054Activity\u5728\u65b0\u7684\u8fdb\u7a0b\u4e2d\u88ab\u91cd\u65b0\u521b\u5efa\u65f6\u53ef\u4ee5\u6062\u590d\u4e4b\u524d\u4fdd\u5b58\u7684\u72b6\u6001</p> <ul> <li>Empty Process\uff1a\u7a7a\u8fdb\u7a0b\uff08\u53ef\u4ee5\u968f\u65f6\u6740\u6b7b\uff09</li> </ul> <p>\u4e0d\u542b\u4efb\u4f55\u6d3b\u8dc3\u7ec4\u4ef6\u7684\u8fdb\u7a0b\u3002\u4fdd\u7559\u8fd9\u79cd\u8fdb\u7a0b\u7684\u7684\u552f\u4e00\u76ee\u7684\u662f\u7528\u4f5c\u7f13\u5b58\uff08\u4e3a\u4e86\u66f4\u52a0\u6709\u6548\u7684\u4f7f\u7528\u5185\u5b58\u800c\u4e0d\u662f\u5b8c\u5168\u91ca\u653e\u6389\uff09\uff0c\u4ee5\u7f29\u77ed\u4e0b\u6b21\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u65f6\u95f4\uff0c\u56e0\u4e3a\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\u4e5f\u662f\u9700\u8981\u4ee3\u4ef7\u7684\u3002\u53ea\u8981\u6709\u9700\u8981\uff0cAndroid\u4f1a\u968f\u65f6\u6740\u6b7b\u8fd9\u4e9b\u8fdb\u7a0b\u3002</p> <p>Home\u952e\u9000\u51fa\u548c\u8fd4\u56de\u952e\u9000\u51fa\u7684\u533a\u522b?</p> <p>Home\u952e\u9000\u51fa\uff0c\u7a0b\u5e8f\u4fdd\u7559\u72b6\u6001\u4e3a\u540e\u53f0\u8fdb\u7a0b\uff1b\u800c\u8fd4\u56de\u952e\u9000\u51fa\uff0c\u7a0b\u5e8f\u4fdd\u7559\u72b6\u6001\u4e3a\u7a7a\u8fdb\u7a0b\uff0c\u7a7a\u8fdb\u7a0b\u66f4\u5bb9\u6613\u88ab\u7cfb\u7edf\u56de\u6536\u3002Home\u952e\u5176\u5b9e\u4e3b\u8981\u7528\u4e8e\u8fdb\u7a0b\u95f4\u5207\u6362\uff0c\u8fd4\u56de\u952e\u5219\u662f\u771f\u6b63\u7684\u9000\u51fa\u7a0b\u5e8f\u3002</p> <p>\u6700\u540e\u518d\u6765\u56de\u987e\u4e00\u4e0b\uff1a </p> <ul> <li>\u57280-1\u9636\u6bb5\uff0c\u7cfb\u7edf\u7684\u5185\u5b58\u8d44\u6e90\u8db3\u591f\uff0c\u7a0b\u5e8f\u8bf7\u6c42\u5185\u5b58\u5206\u914d\uff0c\u7cfb\u7edf\u4f1a\u4e0d\u65ad\u5730\u4f7f\u7528\u7a7a\u95f2\u9875\u6765\u6ee1\u8db3\u5e94\u7528\u7684\u5185\u5b58\u8bf7\u6c42</li> <li>\u57281-2\u9636\u6bb5\uff0c\u7cfb\u7edf\u7684\u53ef\u5229\u7528\u5185\u5b58\u4e0b\u964d\u5230\u4e00\u4e2a\u9608\u503c\uff0c\u7a0b\u5e8f\u7ee7\u7eed\u8bf7\u6c42\u5185\u5b58\u5206\u914d\uff0c\u5185\u6838\u4ea4\u6362\u5b88\u62a4\u8fdb\u7a0b\u542f\u52a8\uff0c\u5f00\u59cb\u91ca\u653e\u7f13\u5b58\u6765\u6ee1\u8db3\u5185\u5b58\u8bf7\u6c42</li> <li>\u57282-3\u9636\u6bb5\uff0c\u7cfb\u7edf\u7684\u88ab\u5229\u7528\u5185\u5b58\u8fbe\u5230\u4e00\u4e2a\u9608\u503c\uff0c\u7cfb\u7edf\u5c06\u542f\u52a8\u4f4e\u5185\u5b58\u7ec8\u6b62\u5b88\u62a4\u8fdb\u7a0b\u6765\u6740\u6b7b\u8fdb\u7a0b\u91ca\u653e\u5185\u5b58</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_tools/","title":"Android \u5185\u5b58\u5206\u6790\u5de5\u5177(\u547d\u4ee4\u884c)","text":""},{"location":"perf-opt/Android/memory/Android_memory_tools/#1-dumpsys-meminfo","title":"1. dumpsys meminfo","text":"<p><code>dumpsys meminfo</code> \u662f Android \u4e2d\u6700\u5e38\u7528\u7684\u67e5\u770b\u5185\u5b58\u7684\u4e00\u4e2a\u547d\u4ee4, \u8bb0\u5f55\u5e94\u7528\u5185\u5b58\u5728\u4e0d\u540c\u7c7b\u578b\u7684 RAM \u5206\u914d\u4e4b\u95f4\u7684\u5212\u5206\u60c5\u51b5\uff1a</p> <pre><code>adb shell dumpsys meminfo package_name|pid [-d]\n`-d` \u6807\u8bb0\u4f1a\u8f93\u51fa\u66f4\u591a\u4e0e Dalvik \u548c ART \u5185\u5b58\u5360\u7528\u60c5\u51b5\u76f8\u5173\u7684\u4fe1\u606f\u3002\n\u8f93\u51fa\u4ee5KB\u4e3a\u5355\u4f4d\u3002\n</code></pre>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#11","title":"1.1 \u67e5\u770b\u6574\u4f53\u60c5\u51b5","text":"<pre><code>adb shell dumpsys meminfo\n</code></pre> <p>\u8f93\u5165\u5982\u4e0b\uff1a</p> <pre><code>Applications Memory Usage (in Kilobytes):\nUptime: 890323212 Realtime: 4220902678\nTotal PSS by process:\n    606,685K: com.ss.android.ugc.aweme (pid 21983 / activities)\n576,831K: system (pid 2141)\n489,218K: com.huawei.android.launcher (pid 5272 / activities)\n412,969K: com.android.systemui (pid 4303)\n378,407K: com.tencent.mm (pid 11384 / activities)\n316,658K: android.hardware.graphics.allocator@2.0-service (pid 748)\n280,486K: com.ss.android.lark (pid 16232 / activities)\n243,692K: com.ss.android.auto (pid 3409)\n196,695K: com.ss.android.ugc.aweme:miniappX (pid 22878)\n...\n        ...\n        ...\n\nTotal PSS by OOM adjustment:\n    991,733K: Native\n        316,658K: android.hardware.graphics.allocator@2.0-service (pid 748)\n81,071K: media.codec (pid 1075)\n44,014K: CameraDaemon (pid 1073)\n42,074K: surfaceflinger (pid 788)\n37,548K: zygote (pid 695)\n37,292K: com.android.calendar (pid 6449)\n37,047K: com.huawei.intelligent:intelligentService (pid 6375)\n34,675K: android.hardware.graphics.composer@2.2-service (pid 749)\n25,172K: zygote64 (pid 1047)\n576,831K: System\n        576,831K: system (pid 2141)\n788,253K: Persistent\n        412,969K: com.android.systemui (pid 4303)\n60,482K: com.huawei.HwOPServer (pid 5104)\n50,241K: com.android.phone (pid 5180)\n45,691K: com.huawei.systemserver (pid 4629)\n38,344K: com.huawei.hiview (pid 5159)\n37,893K: com.huawei.iaware (pid 4710)\n37,002K: com.huawei.nearby (pid 4872)\n29,056K: com.huawei.harmonyos.foundation (pid 5130)\n21,070K: com.huawei.securityserver (pid 5029)\n20,552K: com.android.nfc (pid 14751)\n17,482K: com.huawei.hiaction (pid 15913)\n17,471K: com.huawei.android.pushagent.PushService (pid 18531)\n15,409K: Persistent Service\n         15,409K: com.android.bluetooth (pid 22380)\n597,783K: Foreground\n        489,218K: com.huawei.android.launcher (pid 5272 / activities)\n108,565K: com.huawei.intelligent (pid 14886)\n523,458K: Visible\n        158,410K: com.huawei.hwid.core (pid 16290)\n46,251K: com.huawei.ohos.photos (pid 10932)\n45,385K: com.google.android.gms.persistent (pid 3757)\n41,585K: com.huawei.hwid.persistent (pid 20615)\n36,724K: com.huawei.android.hwouc (pid 25447)\n35,977K: com.huawei.recsys (pid 14892)\n33,336K: com.huawei.android.totemweather (pid 14347)\n31,143K: com.google.android.gms.persistent (pid 3727)\n28,301K: com.huawei.hiai.engineservice (pid 10680)\n27,966K: com.huawei.profile (pid 12498)\n21,669K: com.huawei.lbs (pid 25766)\n8,618K: com.android.se (pid 19437)\n8,093K: com.huawei.vassistant:interactor (pid 31087)\n89,465K: Perceptible\n         72,022K: com.google.android.inputmethod.latin (pid 29819)\n17,443K: com.huawei.vassistant:wakeup (pid 31110)\n281,443K: Perceptible Low\n        108,049K: com.huawei.hwid.core (pid 30441)\n96,076K: com.huawei.android.launcher (pid 19806 / activities)\n36,923K: com.google.android.gms (pid 4003)\n30,465K: com.huawei.hwid.persistent (pid 14251)\n9,930K: com.huawei.lbs (pid 4129)\n127,204K: A Services\n         46,686K: com.huawei.health:DaemonService (pid 18124)\n44,862K: com.huawei.wallet (pid 29714)\n35,656K: com.huawei.systemmanager:service (pid 23031)\n1,241,580K: Previous\n        606,685K: com.ss.android.ugc.aweme (pid 21983 / activities)\n196,695K: com.ss.android.ugc.aweme:miniappX (pid 22878)\n1,145,459K: B Services\n        378,407K: com.tencent.mm (pid 11384 / activities)\n90,070K: com.huawei.hwid.core (pid 477)\n80,241K: com.tencent.mm (pid 4289)\n74,925K: com.tencent.mobileqq:MSF (pid 3657)\n71,197K: com.tencent.mm:push (pid 12201)\n67,011K: com.tencent.mm:push (pid 2392)\n2,185,840K: Cached\n        280,486K: com.ss.android.lark (pid 16232 / activities)\n243,692K: com.ss.android.auto (pid 3409)\n161,188K: com.ss.android.lark:sandboxed_process1 (pid 17018)\n151,325K: com.tencent.mm:toolsmp (pid 13044)\n76,070K: com.tencent.mm:tools (pid 11367)\n74,482K: com.android.mms (pid 10051 / activities)\n71,043K: com.ss.android.lark:wschannel (pid 2494)\n64,189K: com.ss.android.auto:sandboxed_process1 (pid 4941)\n63,318K: com.tencent.mm:support (pid 30592)\n59,377K: com.tencent.mm:exdevice (pid 11322)\n58,457K: com.huawei.appmarket (pid 3972)\n58,029K: com.android.gallery3d (pid 3027)\n56,591K: com.huawei.hiai (pid 29576)\n55,151K: com.huawei.appmarket (pid 1448)\nTotal PSS by category:\n    861,742K: Native\n    747,786K: Dalvik\n        674,320K: .Heap\n         44,887K: .Zygote\n         18,755K: .LOS\n          9,824K: .NonMoving\n    492,577K: .art mmap\n        324,296K: .App art\n        168,281K: .Boot art\n    452,769K: .dex mmap\n        324,266K: .App vdex\n        119,845K: .App dex\n          8,658K: .Boot vdex\n    423,432K: EGL mtrack\n    357,649K: .so mmap\n    247,011K: .apk mmap\n    244,812K: GL mtrack\n    241,900K: Unknown\n    202,968K: Dalvik Other\n        167,209K: .LinearAlloc\n         19,303K: .GC\n         16,456K: .IndirectRef\n              0K: .JITCache\n              0K: .CompilerMetadata\n    105,374K: Other mmap\n     52,039K: .jar mmap\n     35,442K: .oat mmap\n      4,476K: Stack\n      3,415K: Other dev\n      2,477K: .ttf mmap\n        932K: Cursor\n        756K: Ashmem\n          0K: Gfx dev\n          0K: Other mtrack\n\nTotal RAM: 7,789,196K (status normal)\nFree RAM: 2,771,304K (2,185,840K cached pss +   476,624K cached kernel +   108,840K free)\nUsed RAM: 7,358,542K (6,378,618K used pss +   979,924K kernel)\nLost RAM:   409,255K\n     ZRAM: 1,336,996K physical used for 4,163,888K in swap (4,194,300K total swap)\nTuning: 384 (large 512), oom   322,560K, restore limit   107,520K (high-end-gfx)\n</code></pre>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#111-total-ram","title":"1.1.1 Total RAM","text":"<p>\u8fd9\u4e2a\u6570\u503c\u662f\u5f53\u524d\u7cfb\u7edf\u7684\u6240\u6709\u5185\u5b58\u5927\u5c0f\u3002\u5b83\u662f\u8bfb\u53d6<code>/proc/meminfo</code> \u8282\u70b9\u4e2d\u7684 MemTotal \u83b7\u53d6\u7684\u3002\u5b83\u4e00\u822c\u5e76\u4e0d\u7b49\u4e8e\u673a\u5668\u7684\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0c\u90a3\u662f\u56e0\u4e3a linux kernel \u90fd\u4f1a\u6709\u9884\u7559\u5185\u5b58\uff08reserved\uff09\u3002\u7269\u7406\u5185\u5b58 - kernel reserved = \u7cfb\u7edf\u5b9e\u9645\u5185\u5b58\u603b\u548c\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#112-free-ram","title":"1.1.2 Free RAM","text":"<p>\u8fd9\u4e2a\u6570\u503c\u662f\u5f53\u524d\u7cfb\u7edf\u53ef\u7528\u5185\u5b58\u5927\u5c0f\u3002\u5b83\u662f\u540e\u9762\u62ec\u53f7\u5185\u90a33\u9879\u4e4b\u548c\uff1a</p> <ul> <li>cached pss</li> </ul> <p>\u662f <code>Total PSS by OOM adjustment</code> \u91cc\u9762 Cached \u5206\u7c7b\u7684\u603b\u548c\u3002OOM score \u662f Android \u6839\u636e\u8fdb\u7a0b\u7684\u7c7b\u578b\u7ed9 lmk \u6253\u7684\u5206\u6570\uff0clmk \u4ece\u9ad8\u5206\u5f00\u59cb\u56de\u6536\u8fdb\u7a0b\u3002\u5176\u4e2d Cached \u7684\u662f OOM 900 \u4ee5\u4e0a\u7684\uff0c\u4e00\u822c\u90fd\u662f\u5207\u5230\u540e\u53f0\u7684\u8fdb\u7a0b\uff0c\u8868\u793a\u53ef\u4ee5\u968f\u65f6\u56de\u6536\u3002</p> <ul> <li>cached kernel</li> </ul> <p>\u662f /proc/meminfo \u4e2d\u4e0b\u9762\u51e0\u9879\u8ba1\u7b97\u51fa\u6765\u7684\uff1a Buffers + Cached + SReclaimable - Mapped\u3002</p> <ul> <li>Buffers: \u662f kernel \u4e2d\u5757\u8bbe\u5907\uff08block\uff09\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f\u3002</li> <li>Cached: \u8fd9\u90e8\u5206\u662f\u6587\u4ef6\u7f13\u5b58\uff0c\u4f8b\u5982\u8fdb\u7a0b\u52a0\u8f7d\u7684 so\uff0cjar\uff0cttf\uff0cdex \u7b49\u8d44\u6e90\u3002\u5b83\u4eec\u7684\u539f\u59cb\u6570\u636e\u90fd\u5728\u78c1\u76d8\u4e2d\uff0c\u5728\u5185\u5b58\u7d27\u7f3a\u7684\u65f6\u5019\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5c06\u5360\u7528\u7684\u5185\u5b58\u4ea4\u6362\u51fa\u6765\u4f7f\u7528\u3002</li> <li>SReclaimable: \u662f Slab \u4e2d\u7684\u53ef\u56de\u6536\u7684\u90e8\u5206\u3002Slab \u662f linux \u4e2d\u7684\u4e00\u79cd\u5185\u5b58\u5206\u914d\u673a\u5236\u3002\u4e00\u822c\u90fd\u662f kernel \u6a21\u5757\u4f7f\u7528\u7684\u3002\u5728 Android 7 \u7684\u65f6\u5019 dumpsys meminfo \u8fd8\u662f\u5c06\u6240\u6709\u7684 Slab \u8ba1\u7b97\u5230 Free RAM \u4e2d\u7684\uff0c\u5728 10 \u4e2d\u6539\u6210\u53ef\u4ee5\u56de\u6536\u7684\u90e8\u5206\u4e86</li> <li> <p>Mapped: \u662f Cached \u4e2d\u5df2\u7ecf\u88ab mapped \u7684\u90e8\u5206\u3002Cached \u4e2d\u6709\u4e00\u90e8\u5206\u662f\u88ab unmapped \u7684\uff0c\u4f46\u662f\u6ca1\u6709\u9a6c\u4e0a\u91ca\u653e\u3002\u53ef\u4ee5\u7406\u89e3 Mapped \u5c31\u662f\u8fdb\u7a0b\u4e2d\u7684\u4e00\u4e9b\u6587\u4ef6\u8d44\u6e90\u5df2\u7ecf\u88ab load \u8fdb\u5185\u5b58\u91cc\u9762\u7684\u3002</p> </li> <li> <p>free \u662f /proc/meminfo \u4e0b\u7684 MemFree</p> </li> </ul> <p>\u4ece\u4e0a\u9762\u7684\u7edf\u8ba1\u5185\u5bb9\u6765\u770b\uff0c\u548c\u4e00\u822c linux \u7406\u89e3\u7684 free RAM \u5e76\u4e0d\u4e00\u6837\uff0c\u4e00\u822c\u7684 linux \u8ba4\u4e3a Free RAM = free + Cached\u3002\u4e5f\u5c31\u662f\u8bf4 Cached \u5728\u5185\u5b58\u5145\u8db3\u7684\u60c5\u51b5\uff0c\u7f13\u5b58\u4e86\u8fdb\u7a0b\u8fd0\u884c\u6240\u9700\u8981\u7684\u8d44\u6e90\uff0c\u80fd\u52a0\u5feb\u8fdb\u7a0b\u7684\u8fd0\u884c\uff08\u5bf9\u4e8eapp\u542f\u52a8\u901f\u5ea6\u5c24\u4e3a\u660e\u663e\uff09\uff1b\u5f53\u5185\u5b58\u4e0d\u8db3\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u5feb\u901f\u7684\u4ea4\u6362\u51fa\u6765\u3002linux \u8ba4\u4e3a\u8fd9\u53ef\u4ee5\u7b97\u4f5c\u53ef\u7528\u5185\u5b58\uff0c\u6240\u4ee5 linux \u7684 Cached \u4e00\u822c\u90fd\u6bd4\u8f83\u5927\uff0c\u771f\u6b63\u7684 free \u5185\u5b58\u90fd\u5f88\u5c11\u3002\u800c dumpsys meminfo \u5219\u8ba4\u4e3a lmk \u53ef\u4ee5\u968f\u65f6\u56de\u6536\u7684 Pss \u662f\u53ef\u7528\u5185\u5b58\uff0c\u800c load \u8fdb\u5185\u5b58\u7684\u6587\u4ef6 Cached \u5219\u4e0d\u7b97\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#113-used-ram","title":"1.1.3 Used RAM","text":"<p>\u8fd9\u4e2a\u6570\u503c\u662f\u5f53\u524d\u7cfb\u7edf\u5df2\u7ecf\u4f7f\u7528\u5185\u5b58\u7684\u5927\u5c0f\u3002\u5b83\u4e5f\u662f\u540e\u9762\u62ec\u53f7\u5185\u90a32\u9879\u4e4b\u548c\uff1a</p> <ol> <li> <p>used pss: \u662f Total PSS by OOM adjustment \u9664\u4e86 Cached \u5206\u7c7b\u4e4b\u5916\u7684\u8fdb\u7a0b\u7684 Pss \u4e4b\u548c\u3002</p> </li> <li> <p>kernel: \u52062\u90e8\u5206\uff1a </p> </li> </ol> <p>\u7b2c\u4e00\u90e8\u5206\u662f /proc/meminfo \u4e2d\uff1a Shmem + SUnreclaim+ PageTables + KernelStack\uff1a</p> <ul> <li>Shmem: Shared memory \u5373 kernel \u4e2d\u7684\u5171\u4eab\u5185\u5b58\uff0ctmpfs \u4e5f\u4f1a\u88ab\u7edf\u8ba1\u4e3a Shmem\u3002</li> <li>SUnreclaim: Slab \u4e2d\u7684\u4e0d\u53ef\u56de\u6536\u90e8\u5206\u3002</li> <li>PageTables: kernel \u4e2d\u7528\u6765\u8f6c\u5316\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u7684\u300222</li> <li>KernelStack: \u6bcf\u4e2a\u7528\u6237\u7ebf\u7a0b\u90fd\u4f1a\u5728 kernel \u6709\u4e2a\u5185\u6838\u6808\uff08kernel stack\uff09\u3002kernel stack \u867d\u7136\u5c5e\u4e8e\u7528\u6237\u6001\u7ebf\u7a0b\uff0c\u4f46\u662f\u7528\u6237\u6001\u65e0\u6cd5\u8bbf\u95ee\uff0c\u53ea\u6709 syscall\u3001\u5f02\u5e38\u7b49\u8fdb\u5165\u5230\u5185\u6838\u6001\u624d\u4f1a\u8c03\u7528\u5230\u3002\u6240\u4ee5\u8fd9\u90e8\u5206\u5185\u5b58\u662f\u5185\u6838\u4ee3\u7801\u4f7f\u7528\u7684\u3002</li> </ul> <p>\u7b2c\u4e8c\u90e8\u5206\u662f <code>VM_ALLOC_USED</code>\uff0c\u5b83\u662f kernel \u4e2d\u7684\u6a21\u5757\u901a\u8fc7 vmalloc \u51fd\u6570\u7533\u8bf7\u7684\u5185\u5b58\uff0c\u901a\u8fc7\u7edf\u8ba1 /proc/vmallocinfo \u4e2d \u201cpages=\u201d \u6570\u503c\u4e4b\u548c\u5f97\u5230\uff08\u6ce8\u610f\u8fd9\u91cc\u7edf\u8ba1\u7684\u5355\u4f4d\u662f\u9875\u9762\uff0c\u4e00\u822cAndroid\u4e0a\u8dd1\u7684 linux \u4e00\u4e2a\u9875\u9762\u90fd\u662f 4Kb\uff09</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#114-zram","title":"1.1.4 ZRAM","text":"<p>zram \u662f linux \u7684\u4e00\u9879\u5185\u5b58\u538b\u7f29\u6280\u672f\uff0cAndroid \u91cc\u9762\u7528\u6765\u5f53 Swap \u7528\u3002\u5f53\u914d\u7f6e\u5f00\u542f\u4e86 Zram\uff0cAMS \u4f1a\u628a\u4e00\u4e9b\u4f18\u5148\u7ea7\u4f4e\u7ebf\u7a0b\u6807\u8bb0\u4e3a\u53ef\u4ee5\u653e\u5165 Swap \u5206\u533a\uff08\u4f8b\u5982\u8bf4\u4e00\u4e9b Cached \u8fdb\u7a0b\uff09\u3002\u8fd9\u4e2a Swap \u662f\u57fa\u4e8e\u5185\u5b58\u7684\uff08Zram \u652f\u6301\u5199\u56de\u78c1\u76d8\uff0c\u4f46\u662fAndroid\u6ca1\u652f\u6301\uff09\uff0c\u7ebf\u7a0b\u6570\u636e\u653e\u5165 Swap \u7684\u65f6\u5019\uff0c\u4f1a\u8fdb\u884c\u538b\u7f29\uff08\u53ef\u4ee5\u914d\u7f6e\u538b\u7f29\u7b97\u6cd5\uff09\uff0c\u7136\u540e\u628a\u4e4b\u524d\u5360\u7528\u7684\u5185\u5b58\u5c31\u53ef\u4ee5\u7ed9\u5176\u4ed6\u7ebf\u7a0b\u4f7f\u7528\u4e86\u3002\u5f53\u518d\u6b21\u4f7f\u7528\u8fd9\u4e2a\u7ebf\u7a0b\u6570\u636e\u7684\u65f6\u5019\uff0c\u518d\u4ece Swap \u89e3\u538b\u6362\u56de\u6b63\u5e38\u5185\u5b58\u3002\u8fd9\u6837\u80fd\u5728\u5c0f\u5185\u5b58\u8bbe\u5907\u4e0a\u6324\u51fa\u66f4\u591a\u7684\u5185\u5b58\u7a7a\u95f4\u7ed9\u524d\u53f0\u8fdb\u7a0b\u4f7f\u7528\u3002</p> <ul> <li>physical used for:\u662f\u8bfb\u53d6 /sys/block/zram0/mm_stat \u7edf\u8ba1\u7684\u3002mm_stat \u4e00\u5171\u67098\u4e2a\u6570\u503c\uff0c\u542b\u4e49\u53ef\u4ee5\u53c2\u770bkernel \u5b98\u65b9\u6587\u6863\u3002\u8fd9\u91cc\u8bfb\u53d6\u7684\u662f\u7b2c\u4e09\u4e2a\u6570\u503c\uff0c\u4e5f\u5c31\u662f mem_used_total\u3002\u8fd9\u91cc\u4ee3\u8868\u662f\u5b9e\u9645\u7269\u7406\u5185\u5b58\u4f7f\u7528\u7684\u5927\u5c0f\uff08\u7ecf\u8fc7\u538b\u7f29\u7b97\u6cd5\uff09\u3002</li> <li>in swap: \u662f /proc/meminfo \u91cc\u9762 SwapTotal - SwapFree\u3002\u4ee3\u8868 swap \u91cc\u5b58\u653e\u5b9e\u9645\u5185\u5b58\u7684\u5927\u5c0f\uff08\u89e3\u538b\u4e4b\u540e\u7684\uff09 \u3002</li> <li>total swap: \u662f /proc/meminfo \u91cc\u9762\u7684 SwapTotal\u3002\u53ef\u4ee5\u7531\u65b9\u6848\u914d\u7f6e</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#12","title":"1.2 \u67e5\u770b\u5e94\u7528\u5185\u5b58\u60c5\u51b5","text":"<pre><code>adb shell dumpsys meminfo pid\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>Applications Memory Usage (in Kilobytes):\nUptime: 891059163 Realtime: 4221638629\n** MEMINFO in pid 11384 [com.tencent.mm] **\n                   Pss  Private  Private  SwapPss     Heap     Heap     Heap\n                 Total    Dirty    Clean    Dirty     Size    Alloc     Free\n                ------   ------   ------   ------   ------   ------   ------\n  Native Heap    51333    51304        0   143586   265728   234533    31194\nDalvik Heap    71657    71652        0    12801    88052    63476    24576\nDalvik Other    19908    19908        0      944\nStack       56       56        0       24\nAshmem        4        4        0        0\nOther dev       56        0       56        0\n.so mmap     6214      808     1144     8905\n.jar mmap      672        0        0        0\n.apk mmap    20208       32      140      276\n.ttf mmap     2963        0     2540        0\n.dex mmap       83       12        0     4392\n.oat mmap      283        0        0        0\n.art mmap     9057     8848        0     6925\nOther mmap     6005     2736      748        0\nGL mtrack    16708    16708        0        0\nUnknown     5345     5344        0    20302\nTOTAL   408707   177412     4628   198155   353780   298009    55770\nApp Summary\n                       Pss(KB)\n------\n           Java Heap:    80500\nNative Heap:    51304\nCode:     4676\nStack:       56\nGraphics:    16708\nPrivate Other:    28796\nSystem:   226667\nTOTAL:   408707       TOTAL SWAP PSS:   198155\nObjects\n               Views:     1369         ViewRootImpl:        1\nAppContexts:        9           Activities:        1\nAssets:       16        AssetManagers:        0\nLocal Binders:      222        Proxy Binders:      137\nParcel memory:       45         Parcel count:      182\nDeath Recipients:       56      OpenSSL Sockets:        0\nWebViews:        0\nSQL\n         MEMORY_USED:      376\nPAGECACHE_OVERFLOW:       57          MALLOC_SIZE:      117\nDATABASES\n      pgsz     dbsz   Lookaside(b)          cache  Dbname\n         4      108            109       26/30/15  /data/user/0/com.tencent.mm/databases/google_app_measurement.db\n         4       28             35         2/18/3  /data/user/0/com.tencent.mm/databases/Scheduler.db\n\nAsset Allocations\n    : 7965K\n    : 7965K\n</code></pre> <p>Pss</p> <p>\u8fdb\u7a0b\u72ec\u5360\u7684 RAM \u9875\u4f1a\u76f4\u63a5\u8ba1\u5165\u5176 PSS \u503c\uff0c\u800c\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u7684 RAM \u9875\u5219\u4ec5\u4f1a\u6309\u76f8\u5e94\u6bd4\u4f8b\u8ba1\u5165 PSS \u503c</p> <p>android\u4e0b\u6240\u6709app\u7684\u8fdb\u7a0b\u5747\u662ffork\u81eaZygote\uff0c\u4eceZygote\u8fdb\u7a0b fork \u65f6\uff0c\u5b50\u8fdb\u7a0b\u5b8c\u5168\u62f7\u8d1d\u4e86Zygote\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4(\u5305\u62ec\u52a0\u8f7d\u7684so\u5360\u7528\u3001resource\u8d44\u6e90\u5360\u7528\u3001\u4e3b\u52a8\u7533\u8bf7\u7b49\u5185\u5b58\u7a7a\u95f4\u7b49)\u3002\u4f46\u5f53\u7ee7\u627f\u81eaZygote\u8fdb\u7a0b\u7684\u5185\u5b58\u88ab\u4fee\u6539\u65f6\uff0c\u7531\u4e8ecopy-on-write\uff0c\u4f1a\u7533\u8bf7\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u5c31\u4f1a\u5f62\u6210Private Dirty\u5185\u5b58\u3002\u5f53\u7ee7\u627f\u81eaZygote\u8fdb\u7a0b\u7684\u5185\u5b58\u6ca1\u88ab\u4fee\u6539\u65f6\uff0c\u662f\u4e0d\u7528\u5206\u914d\u989d\u5916\u7684\u5185\u5b58\u7a7a\u95f4\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#121","title":"1.2.1 \u6a2a\u5217\u9879\u53c2\u6570\uff1a","text":"<ul> <li>Pss Total: /proc/pid/smaps vma \u91cc\u9762 Pss \u4e4b\u548c</li> <li>Private Dirty: /proc/pid/smaps vma \u91cc\u9762 Private_Dirty \u4e4b\u548c\uff0c\u662fapp\u81ea\u5df1\u63d0\u4ea4\u7684\u5185\u5b58\u603b\u6570\uff0c\u5305\u542b\u4e86app\u81ea\u5df1\u4e3b\u52a8\u7533\u8bf7\u7684\u5185\u5b58\u3002</li> <li>Private Clean: /proc/pid/smaps vma \u91cc\u9762 Private_Clean \u4e4b\u548c\uff0c\u5b83\u5305\u62ec\u8be5\u8fdb\u7a0b\u72ec\u81ea\u4f7f\u7528\u7684so\u548cdex\u3002Clean\u5185\u5b58\u7684\u597d\u5904\u662f\u5728\u5185\u5b58\u7d27\u5f20\u65f6\uff0c\u53ef\u4ee5\u91ca\u653e\u7269\u7406\u5185\u5b58\u3002\u56e0\u4e3a\u662fclean\u7684\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u5199\u56de\u5230disk\uff0c\u53ea\u9700\u8981\u4e0b\u6b21\u8bfb\u53d6\u8be5\u5185\u5b58\uff08\u5bfc\u81f4\u7f3a\u9875\u9519\u8bef\uff09\u65f6\u518d\u4ecedisk\u8bfb\u5165\u3002</li> <li>SwapPss Dirty: /proc/pid/smaps vma \u91cc\u9762 SwapPss \u4e4b\u548c\uff08\u8fd9\u662f\u5f00\u4e86 Zram \u7684\uff0c\u5982\u679c\u6ca1\u5f00\u5c31\u662f Swap \u4e4b\u548c\uff0c\u540c\u65f6\u663e\u793a\u4f1a\u53d8\u4e3a Swap Dirty\uff09</li> <li>Heap Size: Native Heap \u662f mallinfo() \u91cc\u9762 usmblks \u7684\u503c\u3002mallinof() \u8fd9\u4e2a\u662f\u4e00\u4e2a glic \u51fd\u6570\uff0c\u7528\u6765\u83b7\u53d6\u5f53\u524d native heap \u7684\u4fe1\u606f\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u91cc\u9762\u7684\u5b57\u6bb5\u53ef\u4ee5 man mallinfo \u67e5\u770b\u3002usmblks \u662f heap \u80fd\u7533\u8bf7\u7684\u6700\u5927\u503c\u3002Dalvik Heap \u662f java \u7c7b Runtime \u91cc\u9762\u7684 totalMemory() \u51fd\u6570\u83b7\u53d6\u7684\uff0c\u662f\u5f53\u524d\u865a\u62df\u673a\u7684 heap \u5927\u5c0f\uff0c\u8fd9\u503c\u4f1a\u52a8\u6001\u8c03\u6574\uff0c\u521d\u59cb\u5927\u5c0f\u548c\u8c03\u6574\u7b56\u7565\u7531 dalvik.vm.heapgrowthlimit \u548c dalvik.vm.heapsize \u5c5e\u6027\u63a7\u5236\u3002</li> <li>Heap Alloc: Native Heap \u662f mallinfo() \u91cc\u9762 uordblks \u7684\u503c\uff0c\u8868\u793a\u5f53\u524d native heap \u5df2\u7ecf\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f\u3002Dalvik Heap \u662f Runtime \u91cc\u9762 totalMemory() - freeMemory() \u7684\u503c\u3002\u6b64\u503c\u5927\u4e8e <code>Pss Total</code> \u548c <code>Private Dirty</code>\uff0c\u8fd9\u662f\u56e0\u4e3a\u60a8\u7684\u8fdb\u7a0b\u662f\u4ece Zygote \u6d3e\u751f\u7684\uff0c\u4e14\u5305\u542b\u60a8\u7684\u8fdb\u7a0b\u4e0e\u6240\u6709\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\u7684\u5206\u914d\u3002</li> <li>Heap Free: Native Heap \u662f mallinfo() \u91cc\u9762 fordblks \u7684\u503c\uff0c\u8868\u793a\u5f53\u524d native heap \u7a7a\u95f2\u5185\u5b58\u7684\u5927\u5c0f\u3002Dalvik Heap \u662f Runtime \u91cc\u9762 freeMemory() \u7684\u503c\uff0c\u8868\u793a\u865a\u62df\u673a heap \u7a7a\u95f2\u5185\u5b58\u5927\u5c0f\u3002\u865a\u62df\u673a heap \u7684\u7a7a\u95f2\u5185\u5b58\u5c0f\u5230\u4e00\u5b9a\u7a0b\u5ea6\u4f1a\u6709\u4e00\u5b9a\u7a0b\u5ea6\u7684\u7b56\u7565\u6269\u5927 heap \u7684 total size\uff0c\u7b56\u7565\u7684\u9600\u503c\u7531\u4e0a\u9762\u8bf4\u7684\u5c5e\u6027\u63a7\u5236</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#122","title":"1.2.2 \u7ad6\u884c\u9879\u53c2\u6570","text":"<p>\u53ea\u6709 Pss Total\u3001Private Dirty\u3001Private Clean\u3001SwapPss Dirty \u533a\u5206\u7ad6\u76f4\u7684\u5206\u7c7b\uff08Heap Size\u3001Heap Alloc\u3001Heap Free \u53ea\u533a\u5206 Native Heap \u548c Dalvik Heap\uff09</p> <ul> <li>Natvie Heap: /proc/pid/smaps \u4e2d\uff1a \u6240\u6709 [heap]\u3001[anon:libc_malloc] \u7684 vma \u4e2d\u5404\u81ea\u5b57\u6bb5\u4e4b\u548c\u3002\u4f8b\u5982\u8bf4 Natvie Heap \u7684 Pss Total \u5c31\u662f\u6240\u6709\u7684 [heap]\u3001[anon:libc_malloc] \u7684 vma \u4e2d Pss \u4e4b\u548c\u3002\u4ece vma \u7684\u540d\u5b57\u6765\u770b\uff0c\u5e94\u8be5\u662f natvie malloc \u7533\u8bf7\u7684\u5185\u5b58\u3002</li> <li>Dalvik Heap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 [anon:dalvik-alloc space\u3001[anon:dalvik-main space\u3001[anon:dalvik-large object space\u3001[anon:dalvik-free list large object space\u3001[anon:dalvik-non moving space\u3001[anon:dalvik-zygote space \u5f00\u5934\u7684 vma \u4e2d\u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u4ece vma \u7684\u540d\u5b57\u6765\u770b\uff0c\u5e94\u8be5\u662f java \u865a\u62df\u673a\u7533\u8bf7\u7684\u5185\u5b58\u3002</li> <li>Dalvik Other: /proc/pid/smaps \u4e2d vma \u4e2d\u4e00\u4e9b\u4ee5 anon:dalvik \u5f00\u5934\u7684\u5b57\u6bb5\u4e4b\u548c\uff08\u5927\u90e8\u5206\u662f\u9664\u4e86\u4e0a\u9762 Dalvik Heap \u4e4b\u5916\u7684\uff09\uff0c\u6709\u70b9\u591a\u6211\u5c31\u4e0d\u4e00\u4e00\u5217\u7684\uff0c\u8be6\u7ec6\u7684\u53ef\u4ee5\u81ea\u5df1\u53bb android/framework/base/core/jni/android_os_Debug.cpp \u91cc\u9762\u7684 load_maps() \u51fd\u6570\u91cc\u9762\u770b\u3002\u8fd9\u91cc\u770b vma \u540d\u5b57\u50cf\u662f\u865a\u62df\u673a\u7684\u4e00\u4e9b\u5f15\u7528\u8ba1\u6570\u3001\u5b57\u8282\u7801\u7f13\u5b58\u4e4b\u7c7b\u7684\u3002</li> <li>Stack: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 [stack \u5f00\u5934\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u5e94\u8be5\u662f\u6808\u7533\u8bf7\u7684\u5185\u5b58\uff0c\u4e00\u822c\u4e5f\u4e0d\u662f\u5f88\u5927\uff0c\u51e0\u5341k\u8fd9\u6837\u3002</li> <li>Ashmem: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 /dev/ashmem \u5f00\u5934\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u5e94\u8be5\u662f\u8fdb\u7a0b\u95f4\u7684\u5171\u4eab\u5185\u5b58\u3002</li> <li>Other dev: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 /dev \u5f00\u5934\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u5e94\u8be5\u662f\u4e00\u4e9b\u8bbe\u5907\u9a71\u52a8\u6620\u5c04\u7684\u5185\u5b58\u3002</li> <li>.so mmap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 .so \u7ed3\u5c3e\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u662f load so \u6620\u5c04\u7684\u5185\u5b58\u3002</li> <li>.jar mmap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 .jar \u7ed3\u5c3e\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u662f load jar \u6620\u5c04\u7684\u5185\u5b58\u3002</li> <li>.apk mmap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 .apk \u7ed3\u5c3e\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u662f load apk \u6620\u5c04\u7684\u5185\u5b58\u3002</li> <li>.ttf mmap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 .ttf \u7ed3\u5c3e\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u662f load ttf \u6620\u5c04\u7684\u5185\u5b58\u3002</li> <li>.dex mmap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 .odex\u3001.dex\u3001.vdex\u3001\u7ed3\u5c3e\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u5e94\u8be5\u662f\u52a0\u8f7d\u865a\u62df\u673a\u5b57\u8282\u7801\u3001\u9884\u7f16\u8bd1\u7684\u5b57\u8282\u7801\u6620\u5c04\u7684\u5185\u5b58\u3002</li> <li>.oat mmap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 .oat \u7ed3\u5c3e\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u5e94\u8be5\u662f\u52a0\u8f7d\u865a\u62df\u673a\u9884\u7f16\u8bd1\u5b57\u8282\u7801\u6620\u5c04\u7684\u5185\u5b58\u3002\u597d\u50cf\u662f system \u7684 jar dex2oat \u51fa\u6765\u7684\u662f oat\uff0c\u5176\u4ed6\u7684\u662f odex\u3002</li> <li>.art mmap: /proc/pid/smaps \u4e2d\u6240\u6709\u4ee5 .art\u3001art] \u7ed3\u5c3e\u7684 vma \u5404\u5b57\u6bb5\u4e4b\u548c\u3002\u8fd9\u4e2a\u597d\u50cf\u662f odex \u7684\u4e00\u4e9b\u7d22\u5f15\uff0c\u53c8\u53eb\u542f\u52a8\u955c\u50cf\u3002\u4e5f\u662f\u865a\u62df\u673a\u9884\u7f16\u8bd1\u51fa\u6765\u7684\u5185\u5bb9\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\u9762\u6240\u5360\u7528\u7684\u3002</li> <li>Other mmap: \u9664\u4e86\u4e0a\u9762\u5206\u7c7b\uff0c vma \u4e2d\u6709\u540d\u5b57\u7684\u5404\u5b57\u6bb5\u4e4b\u548c\u3002</li> <li>Unknown: \u9664\u4e86\u4e0a\u9762\u5206\u7c7b\uff0c vma \u4e2d\u6ca1\u6709\u540d\u5b57\u7684\u5404\u5b57\u6bb5\u4e4b\u548c\u3002</li> <li>Total: \u5206\u522b\u7b49\u4e8e\u5404\u81ea\u5217\u4e0a\u7684\u9879\u76ee\u4e4b\u548c\uff0cPss Total \u8fd8\u9700\u8981\u989d\u5916\u52a0\u4e0a SwapPss Dirty \u8fd9\u4e00\u5217\u7684\u6c42\u548c\u3002</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#123-app-summary","title":"1.2.3 App Summary","text":"<ul> <li>Java Heap: Dalvik Heap \u7684 Private Dirty + .art mmap \u7684 (Private Dirty + Private Clean)\u3002Android \u8ba4\u4e3a\u8fd9\u4e9b\u4ee3\u8868\u8fdb\u7a0b\u7684\u865a\u62df\u673a\u5360\u7528\u7684\u5185\u5b58\u3002</li> <li>Native Heap: Native Heap \u4e2d\u7684 Private Dirty\u3002Android \u8ba4\u4e3a\u8fd9\u4e2a\u6570\u503c\u4ee3\u8868\u8fdb\u7a0b\u7684 native \u5360\u7528\u7684\u5185\u5b58\u3002</li> <li>Code: .so mmap\u3001.jar mmap\u3001.apk mmap\u3001ttf mmap\u3001.dex mmap\u3001oat mmap \u7684 (Private Dirty + Private Clean )\u3002Android \u8ba4\u4e3a\u8fd9\u4e9b\u662f\u4e00\u4e9b\u8d44\u6e90\u7c7b\uff08\u4f8b\u5982\u5b57\u8282\u7801\u6587\u4ef6\u3001\u56fe\u7247\u3001\u5b57\u4f53\u7b49\uff09\u5360\u7528\u7684\u5185\u5b58\u3002</li> <li>Stack: Stack \u4e2d Private Dirty \u7684\u503c\u3002</li> <li>Graphcis: \u8fd9\u4e2a\u662f GPU \u91cc\u9762 texture\u3001buffer \u5360\u7528\u7684\u5185\u5b58\uff0c\u9700\u8981 gpu \u9a71\u52a8\u652f\u6301\u624d\u884c\u30020 \u7684\u8bdd\u4ee3\u8868 gpu \u9a71\u52a8\u8fd8\u6ca1\u652f\u6301\u3002</li> <li>Private Other: TOTAL(Private Dirty + Private Clean) - Java Heap - Native Heap - Code - Stack - Graphcis</li> <li>System: TOTAL(Pss) - TOTAL(Private Dirty + Private Clean)</li> <li>TOTAL: TOTAL(Pss)</li> <li>TOTAL SWAP PSS: TOTAL(SwapPss Dirty)</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#124-objects","title":"1.2.4 OBjects","text":"<p>\u8fd9\u4e9b\u7edf\u8ba1\u7684\u662f\u8fdb\u7a0b\u91cc\u9762\u4e00\u4e9b Android Java \u5bf9\u8c61\u7684\u5f15\u7528\u4fe1\u606f\uff0c\u5bf9\u4e8e\u6392\u67e5 Java \u5185\u5b58\u6cc4\u6f0f\u6bd4\u8f83\u6709\u7528</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#125-sql","title":"1.2.5 SQL","text":"<p>\u5e94\u8be5\u662f sql \u7533\u8bf7\u7684\u5185\u5b58\uff0c\u6682\u65f6\u6ca1\u7814\u7a76\u8fc7\uff0c\u4e0d\u8fc7\u4e00\u822c\u8fd9\u90e8\u5206\u5360\u7528\u5185\u5b58\u90fd\u4e0d\u9ad8\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#2-procxxx","title":"2. /proc/xxx","text":""},{"location":"perf-opt/Android/memory/Android_memory_tools/#21-procpidmaps","title":"2.1 /proc/pid/maps","text":"<p>\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u4f1a\u6709\u8fd9\u4e2a\u6587\u4ef6\u8282\u70b9\uff0c\u8868\u793a\u8fdb\u7a0b\u7684\u5185\u5b58\u6620\u5c04\u4fe1\u606f\u3002\u4f8b\u5982\u8bf4\u6211\u4eec cat \u4e00\u4e0b systemui \u7684\uff1a</p> <pre><code>12c00000-12cc0000 rw-p 00000000 00:00 0          [anon:dalvik-main space (region space)]\n12cc0000-12e40000 ---p 00000000 00:00 0          [anon:dalvik-main space (region space)]\n12e40000-12f00000 rw-p 00000000 00:00 0          [anon:dalvik-main space (region space)]\n12f00000-12f80000 rw-p 00000000 00:00 0          [anon:dalvik-main space (region space)]\n12f80000-13280000 rw-p 00000000 00:00 0          [anon:dalvik-main space (region space)]\n13280000-14140000 ---p 00000000 00:00 0          [anon:dalvik-main space (region space)]\n14140000-22c00000 rw-p 00000000 00:00 0          [anon:dalvik-main space (region space)]\n6fef2000-700cb000 rw-p 00000000 fd:03 1476       /system/framework/arm/boot.art\n700cb000-70185000 rw-p 00000000 fd:03 1455       /system/framework/arm/boot-core-libart.art\n70185000-701ad000 rw-p 00000000 fd:03 1467       /system/framework/arm/boot-okhttp.art\n701ad000-701e2000 rw-p 00000000 fd:03 1452       /system/framework/arm/boot-bouncycastle.art\n701e2000-701ee000 rw-p 00000000 fd:03 1449       /system/framework/arm/boot-apache-xml.art\n701ee000-7087f000 rw-p 00000000 fd:03 1461       /system/framework/arm/boot-framework.art\n7087f000-708ab000 rw-p 00000000 fd:03 1458       /system/framework/arm/boot-ext.art\n708ab000-70966000 rw-p 00000000 fd:03 1470       /system/framework/arm/boot-telephony-common.art\n70966000-70970000 rw-p 00000000 fd:03 1473       /system/framework/arm/boot-voip-common.art\n70970000-70980000 rw-p 00000000 fd:03 1464       /system/framework/arm/boot-ims-common.art\n70980000-70983000 rw-p 00000000 fd:03 1446       /system/framework/arm/boot-android.test.base.art\n70983000-70a37000 r--p 00000000 fd:03 1477       /system/framework/arm/boot.oat\n70a37000-70c5a000 r-xp 000b4000 fd:03 1477       /system/framework/arm/boot.oat\n70c5a000-70c5b000 rw-p 00000000 00:00 0          [anon:.bss]\n70c5b000-70c5d000 r--s 00000000 fd:03 1491       /system/framework/boot.vdex\n</code></pre> <p>\u4e0a\u9762\u53ea\u662f\u622a\u56fe\u4e86\u524d\u9762\u4e00\u90e8\u5206\uff0c\u56e0\u4e3a\u662f\u6574\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u9875\u9762\uff0c\u6240\u4ee5\u6574\u4e2a\u6587\u4ef6\u4f1a\u6bd4\u8f83\u5927\uff08\u548c\u8fdb\u7a0b\u590d\u6742\u5ea6\u6709\u5173\uff0csystemui \u633a\u590d\u6742\u7684\uff09\u3002\u91cc\u9762\u6bcf\u4e00\u884c\u4ee3\u8868\u4e00\u4e2a vma\uff08virtual memory areas\uff1a\u865a\u62df\u5185\u5b58\u533a\u57df\uff09\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b vma \u6bcf\u4e00\u5217\u4ee3\u8868\u4ec0\u4e48\u542b\u4e49\uff1a</p> <ul> <li>12c00000-12cc0000: \u8fd9\u4e2a\u662f\u8be5\u865a\u62df\u5185\u5b58\u6bb5\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u5730\u5740\u3002\u901a\u8fc7\u5730\u5740 x page_size \u53ef\u4ee5\u8ba1\u7b97\u51fa\u8be5\u6bb5\u5185\u5b58\u7684\u5927\u5c0f\u3002</li> <li>rw-p: \u8be5\u6bb5\u5185\u5b58\u7684\u6743\u9650\u3002\u524d3\u4f4d\u5206\u522b\u662f\uff1a\u8bfb\u3001\u5199\u3001\u6267\u884c\uff0c\u6700\u540e\u4e00\u4f4d p \u4ee3\u8868\u79c1\u6709\uff0cs \u4ee3\u8868\u5171\u4eab\u3002</li> <li>00000000: \u8be5\u865a\u62df\u5185\u5b58\u6bb5\u8d77\u59cb\u5730\u5740\u5728\u5bf9\u5e94\u7684\u6620\u5c04\u6587\u4ef6\u4e2d\u4ee5\u9875\u4e3a\u5355\u4f4d\u7684\u504f\u79fb\u91cf\uff0c\u5bf9\u533f\u540d\u6620\u5c04\uff0c\u5b83\u7b49\u4e8e0\u6216\u8005vm_start/PAGE_SIZE\u3002</li> <li>00:00: \u6587\u4ef6\u7684\u4e3b\u8bbe\u5907\u53f7\u548c\u6b21\u8bbe\u5907\u53f7\u3002\u5bf9\u533f\u540d\u6620\u5c04\u6765\u8bf4\uff0c\u56e0\u4e3a\u6ca1\u6709\u6587\u4ef6\u5728\u78c1\u76d8\u4e0a\uff0c\u6240\u4ee5\u6ca1\u6709\u8bbe\u5907\u53f7\uff0c\u59cb\u7ec8\u4e3a00:00\u3002\u5bf9\u6709\u540d\u6620\u5c04\u6765\u8bf4\uff0c\u662f\u6620\u5c04\u7684\u6587\u4ef6\u6240\u5728\u8bbe\u5907\u7684\u8bbe\u5907\u53f7\u3002\u4e0a\u9762\u6709\u6620\u5c04\u53f7\u7684\u90fd\u662f\u4e00\u4e9b\u6587\u4ef6\u8d44\u6e90\u3002</li> <li>0: \u88ab\u6620\u5c04\u5230\u865a\u62df\u5185\u5b58\u7684\u6587\u4ef6\u7684\u7d22\u5f15\u8282\u70b9\u53f7\uff0c\u901a\u8fc7\u8be5\u8282\u70b9\u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\uff0c\u5bf9\u533f\u540d\u6620\u5c04\u6765\u8bf4\uff0c\u56e0\u4e3a\u6ca1\u6709\u6587\u4ef6\u5728\u78c1\u76d8\u4e0a\uff0c\u6240\u4ee5\u6ca1\u6709\u8282\u70b9\u53f7\uff0c\u59cb\u7ec8\u4e3a00:00\u3002</li> <li>[anon:dalvik-main space (region space)]: \u88ab\u6620\u5c04\u5230\u865a\u62df\u5185\u5b58\u7684\u6587\u4ef6\u540d\u79f0\u3002\u540e\u9762\u5e26(deleted)\u7684\u662f\u5185\u5b58\u6570\u636e\uff0c\u53ef\u4ee5\u88ab\u9500\u6bc1\u3002\u5bf9\u6709\u540d\u6765\u8bf4\uff0c\u662f\u6620\u5c04\u7684\u6587\u4ef6\u540d\u3002\u5bf9\u533f\u540d\u6620\u5c04\u6765\u8bf4\uff0c\u662f\u6b64\u6bb5\u865a\u62df\u5185\u5b58\u5728\u8fdb\u7a0b\u4e2d\u7684\u89d2\u8272\u3002dumpsys meminfo \u662f\u901a\u8fc7\u8fd9\u4e2a\u5b57\u6bb5\u6765\u8fdb\u884c\u5206\u7c7b\u7edf\u8ba1\u7684\u3002</li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#22-procpidsmaps","title":"2.2 /proc/pid/smaps","text":"<p>smaps \u662f map \u7684\u6269\u5c55\uff0c\u5b83\u663e\u793a\u7684\u4fe1\u606f\u66f4\u52a0\u8be6\u7ec6\uff0c\u8fd8\u662f\u62ff systemui \u7684\u6765\u4e3e\u4f8b\uff1a</p> <pre><code>12c00000-12dc0000 rw-p 00000000 00:00 0          [anon:dalvik-main space (region space)]\nName:           [anon:dalvik-main space (region space)]\nSize:               1792 kB\nKernelPageSize:        4 kB\nMMUPageSize:           4 kB\nRss:                 480 kB\nPss:                 480 kB\nShared_Clean:          0 kB\nShared_Dirty:          0 kB\nPrivate_Clean:         0 kB\nPrivate_Dirty:       480 kB\nReferenced:          480 kB\nAnonymous:           480 kB\nAnonHugePages:         0 kB\nShmemPmdMapped:        0 kB\nShared_Hugetlb:        0 kB\nPrivate_Hugetlb:       0 kB\nSwap:                  0 kB\nSwapPss:               0 kB\nLocked:                0 kB\nVmFlags: rd wr mr mw me ac 70c5b000-70c5d000 r--s 00000000 fd:03 1491       /system/framework/boot.vdex\nSize:                  8 kB\nKernelPageSize:        4 kB\nMMUPageSize:           4 kB\nRss:                   8 kB\nPss:                   2 kB\nShared_Clean:          8 kB\nShared_Dirty:          0 kB\nPrivate_Clean:         0 kB\nPrivate_Dirty:         0 kB\nReferenced:            8 kB\nAnonymous:             0 kB\nAnonHugePages:         0 kB\nShmemPmdMapped:        0 kB\nShared_Hugetlb:        0 kB\nPrivate_Hugetlb:       0 kB\nSwap:                  0 kB\nSwapPss:               0 kB\nLocked:                0 kB\nVmFlags: rd mr me ms\n</code></pre> <ul> <li>Size: vma \u7a7a\u95f4\u7684\u5927\u5c0f\u3002\u53ef\u4ee5\u7531\u5730\u5740\u8ba1\u7b97\u51fa\u6765\u3002\u7b49\u4e8e Vss\uff0c\u8fdb\u7a0b\u6709\u65f6\u5019 malloc \u4e86\u4e00\u5927\u5757\u5185\u5b58\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u771f\u6b63\u4f7f\u7528\u3002\u4f46\u662f\u8fd8\u662f\u4f1a\u8ba1\u7b97\u8fd9\u5757\u5185\u5b58\u7684\u5927\u5c0f</li> <li>KernelPageSize: kernel page size \u7684\u5927\u5c0f\uff0c\u4e00\u822c\u662f 4kb\u3002</li> <li>MMUPageSize: MMU page size \u5927\u5c0f\uff0c\u4e00\u822c\u7b49\u4e8e KernelPageSize\u3002</li> <li>Rss: \u8868\u793a\u8fdb\u7a0b\u5b9e\u9645\u5360\u7528\u5185\u5b58\u7684\u60c5\u51b5\uff08\u5305\u542b\u5171\u4eab\u8d44\u6e90\uff09</li> <li>Pss: \u8868\u793a\u8fdb\u7a0b\u5b9e\u9645\u5360\u7528\u5185\u5b58\u7684\u60c5\u51b5\uff08\u5171\u4eab\u8d44\u6e90\u6309\u6bd4\u4f8b\u5747\u5206\uff09</li> <li>hared/Private: \u8be5 vma \u662f\u79c1\u6709\u7684\u8fd8\u662f\u5171\u4eab\u7684\u3002\u5bf9\u7167\u524d\u9762\u7684\u6743\u9650\u6807\u5fd7\u4f4d\u7684\u6700\u540e\u4e00\u4f4d\uff0c\u786e\u5b9e p \u7684 Shared \u6709\u6570\u503c\uff0c\u5e76\u4e14\u4e0d\u7b49\u4e8e Pss\uff08\u88ab\u5747\u5206\u4e86\uff09\uff1b\u800c s \u7684\u5c31\u662f Private \u7684\u6709\u6570\u503c\uff0c\u5e76\u7b49\u4e8e Pss\uff08\u56e0\u4e3a\u662f\u79c1\u6709\u7684\uff09</li> <li>Dirty/Clean: \u5728\u9875\u9762\u88ab\u6dd8\u6c70\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u628a\u8be5\u810f\u9875\u9762\u56de\u5199\u5230\u4ea4\u6362\u5206\u533a\uff08\u6362\u51fa\uff0cswap out\uff09\u3002\u6709\u4e00\u4e2a\u6807\u5fd7\u4f4d\u7528\u4e8e\u8868\u793a\u9875\u9762\u662f\u5426dirty\u3002</li> <li>Referenced: \u5f53\u524d\u9875\u9762\u88ab\u6807\u8bb0\u4e3a\u5df2\u5f15\u7528\u6216\u8005\u5305\u542b\u533f\u540d\u6620\u5c04\u3002</li> <li>Anonymous: \u533f\u540d\u6620\u5c04\u7684\u7269\u7406\u5185\u5b58\uff0c\u8fd9\u90e8\u5206\u5185\u5b58\u4e0d\u6765\u81ea\u4e8e\u6587\u4ef6\u7684\u5185\u5b58\u5927\u5c0f\u3002</li> <li>AnonHugePages \u7edf\u8ba1\u7684\u662fTransparent HugePages (THP)</li> <li>Shared/Private_Hugetlb: \u7531hugetlbfs\u9875\u9762\u652f\u6301\u7684\u5185\u5b58\u4f7f\u7528\u91cf\uff0c\u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u8be5\u9875\u9762\u672a\u8ba1\u5165\u201c RSS\u201d\u6216\u201c PSS\u201d\u5b57\u6bb5\u4e2d\u3002 \u5e76\u4e14\u8fd9\u4e9b\u6ca1\u6709\u5305\u542b\u5728Shared/Private_Clean/Dirty \u5b57\u6bb5\u4e2d\u3002</li> <li>Swap: \u5f00\u542f Zram \u540e\uff0cSwap \u5230 Zram \u5206\u533a\u7684\u5927\u5c0f\u3002\u8fd9\u91cc\u662f\u5305\u542b\u4e86\u5171\u4eab\u8d44\u6e90\u90e8\u5206\u5185\u5b58\u7684\u3002</li> <li>SwapPss: Swap \u5171\u4eab\u90e8\u5206\u6309\u6bd4\u4f8b\u5747\u5206\u3002</li> <li>Locked: \u5e38\u9a7b\u7269\u7406\u5185\u5b58\u7684\u5927\u5c0f\uff0c\u8fd9\u4e9b\u9875\u4e0d\u4f1a\u88ab\u6362\u51fa\u3002</li> <li>VmFlags: \u8868\u793a\u4e0e\u7279\u5b9a\u865a\u62df\u5185\u5b58\u533a\u57df\u5173\u8054\u7684\u5185\u6838\u6807\u5fd7\u3002\u6807\u5fd7\u5982\u4e0b\uff1a</li> </ul> <pre><code>rd  - readable\nwr  - writeable\nex  - executable\nsh  - shared\nmr  - may read\nmw  - may write\nme  - may execute\nms  - may share\ngd  - stack segment growns down\npf  - pure PFN range\ndw  - disabled write to the mapped file\nlo  - pages are locked in memory\nio  - memory mapped I/O area\nsr  - sequential read advise provided\nrr  - random read advise provided\ndc  - do not copy area on fork\nde  - do not expand area on remapping\nac  - area is accountable\nnr  - swap space is not reserved for the area\nht  - area uses huge tlb pages\nar  - architecture specific flag\ndd  - do not include area into core dump\nsd  - soft-dirty flag\nmm  - mixed map area\nhg  - huge page advise flag\nnh  - no-huge page advise flag\nmg  - mergable advise flag\n</code></pre>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#23-procmeminfo","title":"2.3 /proc/meminfo","text":"<p>\u524d\u9762\u7684 dumpsys meminfo  total \u7edf\u8ba1\u7684\u90e8\u5206\u7684\u57fa\u7840\u5c31\u6765\u6e90\u4e8e\u8fd9\u4e2a\u8282\u70b9\u7684\u6570\u503c\uff1a</p> <pre><code>MemTotal:         486028 kB\nMemFree:           26124 kB\nMemAvailable:     181240 kB\nBuffers:             788 kB\nCached:           172652 kB\nSwapCached:         6428 kB\nActive:           145524 kB\nInactive:         159336 kB\nActive(anon):      61084 kB\nInactive(anon):    74240 kB\nActive(file):      84440 kB\nInactive(file):    85096 kB\nUnevictable:        2892 kB\nMlocked:            2892 kB\nHighTotal:             0 kB\nHighFree:              0 kB\nLowTotal:         486028 kB\nLowFree:           26124 kB\nSwapTotal:        364516 kB\nSwapFree:         295852 kB\nDirty:                20 kB\nWriteback:             0 kB\nAnonPages:        132388 kB\nMapped:           108676 kB\nShmem:              1644 kB\nSlab:              41300 kB\nSReclaimable:      13752 kB\nSUnreclaim:        27548 kB\nKernelStack:        5792 kB\nPageTables:        14332 kB\nNFS_Unstable:          0 kB\nBounce:                0 kB\nWritebackTmp:          0 kB\nCommitLimit:      607528 kB\nCommitted_AS:   11034652 kB\nVmallocTotal:     507904 kB\nVmallocUsed:           0 kB\nVmallocChunk:          0 kB\nCmaTotal:           8192 kB\nCmaFree:             248 kB\n</code></pre> <ul> <li> <p>MemTotal: \u603b\u5171\u7cfb\u7edf\u53ef\u7528\u7684\u7269\u7406\u5185\u5b58\u3002\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u5e76\u4e0d\u7b49\u4e8e\u5b9e\u9645\u8d34\u5728\u673a\u5668\u4e0a\u7684\u5185\u5b58\u5927\u5c0f\u3002\u662f\u56e0\u4e3a\u8fd8\u6709\u4e00\u90e8\u5206\u5185\u5b58\u8981\u4f5c\u4e3a linux kernel \u7684\u4fdd\u7559\u5185\u5b58\uff08reserved\uff09\u3002</p> </li> <li> <p>MemFree: \u8fd9\u4e2a\u5c31\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u6ca1\u6709\u88ab\u4f7f\u7528\u7684\u5185\u5b58\u4e86\u3002\u8fd9\u503c\u5728 linux \u7cfb\u7edf\u4e0a\u4f1a\u6bd4\u8f83\u4f4e\uff0c\u5176\u5b9e\u6709\u4e00\u90e8\u5206\u5185\u5b58\u662f\u5404\u4e2a\u8fdb\u7a0b\u6b63\u5728\u4f7f\u7528\u7684\uff0c\u8fd8\u6709\u4e00\u5927\u90e8\u5206\u662f Cached\u3002linux \u7684\u8bbe\u8ba1\u672c\u610f\u5c31\u662f\u5c3d\u91cf\u591a\u7684\u4f7f\u7528\u5185\u5b58\uff0c\u6765\u4fdd\u8bc1\u8fdb\u7a0b\u95f4\u5207\u6362\u7684\u5e73\u6ed1\u6027\uff08\u591a\u4efb\u52a1\uff09\u3002</p> </li> <li> <p>MemAvailable: \u8fd9\u4e2a\u503c\u4f1a\u6bd4 MemFree \u591a\u4e00\u4e9b\uff0ckernel \u6839\u636e\u4e00\u4e9b\u53ef\u4ee5\u56de\u6536\u7684\u5185\u5b58\uff08\u4f8b\u5982 cached\u3001buffer \u4e4b\u7c7b\u7684\uff09\u4f30\u7b97\u51fa\u4e00\u4e2a\u80fd\u7528\u7684\u3002</p> </li> <li> <p>Buffers: \u5757\u8bbe\u5907(block)\u7533\u8bf7\u7684\u5185\u5b58\u3002</p> </li> <li> <p>Cached/Mapped/AnonPages: \u8fdb\u7a0b\u7684\u5185\u5b58\u9875\u9762\u5206\u4e3a2\u79cd\uff1a file-backed pages\uff08\u4e0e\u6587\u4ef6\u5bf9\u5e94\u7684\u5185\u5b58\u9875\uff09\u548c anonymous pages\uff08\u533f\u540d\u9875\uff09\u3002file-backed pages \u662f\u6307\u4f8b\u5982\u8bf4\u8fdb\u7a0b\u7684\u4ee3\u7801\u6bb5\u3001so\u3001jar \u5e93\u4e4b\u7c7b\u7684\uff0c\u6620\u5c04\u7684\u90fd\u662f file-backed\uff0c\u800c\u8fdb\u7a0b\u7684\u5806\u3001\u6808\u662f\u4e0d\u4e0e\u6587\u4ef6\u76f8\u5bf9\u5e94\u7684\uff0c\u5c31\u5c5e\u4e8e\u533f\u540d\u9875\u3002file-backed pages \u5728\u5185\u5b58\u4e0d\u8db3\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u5199\u56de\u786c\u76d8\u7684\u6587\u4ef6\uff08\u53eb page-out\uff09\uff0c\u800c\u4e0d\u9700\u8981\u7528\u5230\u4ea4\u4e92\u533a\uff08swap\uff09\uff1b\u800c\u533f\u540d\u9875\u5728\u5185\u5b58\u4e0d\u8db3\u7684\u65f6\u5019\u5c31\u53ea\u80fd\u5199\u5230\u786c\u76d8\u7684\u4ea4\u6362\u533a\u91cc\uff08\u53eb swap-out\uff09\u3002</p> </li> <li> <p>AnonPages: \u662f\u524d\u9762\u63d0\u5230\u7684 anonymous pages\u3002\u5b83\u662f\u8fdb\u7a0b\u7684\u79c1\u6709\u5806\u6808\u3002</p> </li> <li>Mapped: \u662f\u524d\u9762\u63d0\u5230\u7684 file-backed pages\u3002</li> <li> <p>Cached: Cached \u662f Mapped \u7684\u8d85\u96c6\uff0c\u9664\u4e86\u5305\u542b Mapped \u4e4b\u5916\uff0cCached \u8fd8\u5305\u62ec\u4e86 unmapped \u7684\u9875\u9762\u3002\u8fdb\u7a0b\u4e2d\u7684 file-backed pages \u88ab unmapped \u540e\u4e0d\u4f1a\u9a6c\u4e0a\u56de\u6536\uff0c\u800c\u662f\u5f53\u505a\u7f13\u51b2\u8ba1\u7b97\u5728 Cached \u5f53\u4e2d\u3002\u4f46\u662f\u8fdb\u7a0b\u4e2d\u7684 anonymous pages \u4e00\u65e6\u8fdb\u7a0b\u9000\u51fa\uff0c\u5219\u4f1a\u9a6c\u4e0a\u56de\u6536\u3002</p> </li> <li> <p>SwapCached: \u8fd9\u4e2a\u597d\u50cf\u662f Swap \u5206\u533a\u7684 page cached\u3002SwapCached \u5e76\u6ca1\u6709\u5305\u542b\u5728 Cached \u91cc\u9762\u3002</p> </li> <li> <p>Active/Inactive/Active(anon)/Inactive(anon)/Active(file)/Inactive(file): linux kernel \u6709\u4e2a LRU \u7684\u9875\u9762\u56de\u6536\u7b97\u6cd5\u3002LRU list \u5305\u62ec\uff1aLRU_INACTIVE_ANON\uff08Inactive(anon)\uff09\u3001LRU_ACTIVE_ANON\uff08Active(anon)\uff09\u3001LRU_INACTIVE_FILE\uff08Inactive(file)\uff09\u3001 LRU_ACTIVE_FILE\uff08Active(anon)\uff09\u3001LRU_UNEVICTABLE\uff08Unevictable\uff09\u3002Active \u5c31\u662f\u5bf9\u5e94\u6b63\u5728\u4f7f\u7528\u7684\u5185\u5b58\u9875\u9762\uff0c\u4e00\u822c\u8fd9\u79cd\u662f\u65e0\u6cd5\u56de\u6536\u7684\u3002\u800c Inactive \u5219\u662f\u6700\u8fd1\u6ca1\u5728\u4f7f\u7528\u7684\u9875\u9762\uff0c\u4e00\u822c\u8fd9\u79cd\u662f\u53ef\u4ee5\u56de\u6536\uff08reclaimed\uff09\u7684\u3002\u800c Active(anon/file)\u5219\u5206\u522b\u4ee3\u8868\u4e86\u6b63\u5728\u4f7f\u7528\u7684 anonymous pages \u548c file-backed pages\u3002Inactive(anon/file) \u5219\u662f\u6700\u8fd1\u6ca1\u5728\u4f7f\u7528\u7684 anonymous pages \u548c file-backed pages\u3002\u4ece\u4e0a\u9762\u5b9a\u4e49\u6765\u770b\u4e00\u822c\uff1a Active(anon) + Inactive(anon) = AnonPages \uff0c\u4f46\u662f\u53d1\u73b0\u5e76\u4e0d\u76f8\u7b49\uff0c\u4e00\u4e2a\u4f1a\u53d7 Shmem \u72b6\u6001\u7684\u5f71\u54cd\uff0c\u4e00\u4e2a\u662f\u6709\u70b9\u5c0f\u504f\u5dee\u3002\u540c\u7406 Active(file) + Inactive(flie) \u4e0e\u4e0d\u5b8c\u5168\u7b49\u4e8e Cached\uff0c\u4e00\u4e2a\u4e5f\u662f\u53d7 Shmem \u72b6\u6001\u5f71\u54cd\uff0c\u4e00\u4e2a\u662f Activie(flie) + Inactivie(file) \u8fd8\u5305\u542b Buffers\u3002</p> </li> <li> <p>Unevictable: \u662f\u4e0d\u80fd\u88ab page-out/swap-out \u7684\u9875\u9762\u3002</p> </li> <li> <p>SwapTotal/SwapFree: \u914d\u7f6e\u4e86 Zram \u540e\uff0cswap \u5206\u533a\u7684\u603b\u5927\u5c0f\u548c\u7a7a\u95f2\u5927\u5c0f\u3002</p> </li> <li> <p>Shmem: \u5305\u62ec shared memory \u548c tmpfs\u3002android \u4e0a\u4e00\u822c\u4e5f\u4e0d\u5927\u3002</p> </li> <li> <p>Slab/SReclaimable/SUnreclaim: Slab \u662f linux kernel \u4e0a\u7684\u4e00\u79cd\u5185\u5b58\u5206\u914d\u7ba1\u7406\u673a\u5236\uff0c\u4e00\u822c\u662f\u5185\u6838\u6a21\u5757\u4f7f\u7528\u3002SReclaimable \u548c SUnreclaim \u4e00\u4e2a\u662f\u53ef\u4ee5\u56de\u6536\u7684\uff0c\u4e00\u4e2a\u662f\u4e0d\u80fd\u56de\u6536\u7684 Slab \u5185\u5b58\uff0c\u800c Slab \u5219\u8fd92\u4e2a\u52a0\u4e00\u8d77\u3002dumpsys meminfo \u628a SUnreclaim \u7b97\u6210\u662f kernel Used \u3002</p> </li> <li> <p>KernelStack: \u5185\u6838\u7684\u8c03\u7528\u5806\u6808\u3002\u5185\u6838\u6808\u662f\u5e38\u9a7b\u5185\u5b58\u7684\uff0c\u65e2\u4e0d\u5305\u62ec\u5728 LRU lists \u91cc\uff0c\u4e5f\u4e0d\u5305\u62ec\u5728\u8fdb\u7a0b\u7684 RSS/PSS \u5185\u5b58\u91cc\uff0c\u6240\u4ee5\u53ef\u4ee5\u8ba4\u4e3a\u5b83\u662f kernel \u6d88\u8017\u7684\u5185\u5b58\u3002dumpsys meminfo \u628a KernelStack \u4e5f\u8ba1\u7b97\u5728 Kernel Used \u91cc\u9762</p> </li> <li> <p>PageTables: <code>Page Table</code>\u7528\u4e8e\u5c06\u5185\u5b58\u7684\u865a\u62df\u5730\u5740\u7ffb\u8bd1\u6210\u7269\u7406\u5730\u5740\uff0c\u968f\u7740\u5185\u5b58\u5730\u5740\u5206\u914d\u5f97\u8d8a\u6765\u8d8a\u591a\uff0c<code>Page Table</code>\u4f1a\u589e\u5927\u3002\u8bf7\u628a<code>Page Table</code>\u4e0e<code>Page Frame\uff08\u9875\u5e27\uff09</code>\u533a\u5206\u5f00\uff0c\u7269\u7406\u5185\u5b58\u7684\u6700\u5c0f\u5355\u4f4d\u662f <code>page frame</code>\uff0c\u6bcf\u4e2a\u7269\u7406\u9875\u5bf9\u5e94\u4e00\u4e2a\u63cf\u8ff0\u7b26(struct page)\uff0c\u5728\u5185\u6838\u7684\u5f15\u5bfc\u9636\u6bb5\u5c31\u4f1a\u5206\u914d\u597d\u3001\u4fdd\u5b58\u5728 mem_map[] \u6570\u7ec4\u4e2d\uff0cmem_map[] \u6240\u5360\u7528\u7684\u5185\u5b58\u88ab\u7edf\u8ba1\u5728 dmesg \u663e\u793a\u7684 reserved \uff08kernel \u9884\u7559\u5185\u5b58\uff09\u4e2d\uff0c/proc/meminfo \u7684 MemTotal \u662f\u4e0d\u5305\u542b\u5b83\u4eec\u7684\u3002\u800cPage Table\u7684\u7528\u9014\u662f\u7ffb\u8bd1\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\uff0c\u5b83\u662f\u4f1a\u52a8\u6001\u53d8\u5316\u7684\uff0c\u8981\u4ece MemTotal \u4e2d\u6d88\u8017\u5185\u5b58\u3002dumpsys meminfo \u628a PageTables \u8ba1\u7b97\u5728 Kernel Used \u91cc\u9762\u3002</p> </li> <li> <p>VmallocUsed: kernel \u6a21\u5757\u4f7f\u7528 vmalloc \u7533\u8bf7\u7684\u5185\u5b58\u3002\u5b83\u4e5f\u662f\u7b97 kernel \u4f7f\u7528\u7684\u5185\u5b58\u7684\uff0cdumpsys meminfo \u628a VmallocUsed \u4e5f\u8ba1\u7b97\u5728 Kernel Used \u91cc\u9762\u3002\u7136\u800c\u5728 Android \u4e0a /proc/meminfo \u8fd9\u91cc\u7684 VmallocUsed \u7edf\u8ba1\u4e0d\u5230\u6570\u503c\u3002dumpsys meminfo \u662f\u901a\u8fc7 /proc/vmallocinfo \u7edf\u8ba1\u7684\u3002/proc/vmallocinfo \u91cc\u4e0d\u4ec5\u6709 vmalloc \u7684\uff0c\u8fd8\u6709 ioremap\uff08\u8fd9\u4e2a\u662fIO\u5730\u5740\u6620\u5c04\u7684\uff09\u3001vmap \u7684\uff0c\u8fd92\u4e2a\u662f\u4e0d\u5360\u5185\u5b58\u7684\u3002vmalloc \u7684\u6bcf\u4e00\u884c\u6709 \u201cpages=x\u201d \u7684\u9875\u9762\u6570\u91cf\u4fe1\u606f\uff0c\u6240\u4ee5\u76f4\u63a5\u8ba1\u7b97 pages \u7684\u603b\u6570\uff0c\u7136\u540e x page_size \u5c31\u80fd\u7edf\u8ba1\u5230 VmallocUsed \u4e86\uff08\u8fd9\u4e5f\u662f\u524d\u9762 dumpsys meminfo kernel used \u90a3\u91cc\u8bf4\u8ba1\u7b97 pages= \u7684\u7406\u7531\uff09\u3002</p> </li> <li> <p>CmaTotal/CmaFree: \u914d\u7f6e\u7684 cma \u603b\u5927\u5c0f\u548c free \u5927\u5c0f\u3002\u4e00\u822c\u6709 iommu \u7684\u65b9\u6848 cma \u90fd\u4f1a\u6bd4\u8f83\u5c0f\u3002</p> </li> </ul>"},{"location":"perf-opt/Android/memory/Android_memory_tools/#_1","title":"\u53c2\u8003\u8d44\u6599","text":"<p>Android \u5185\u5b58\u4f18\u5316\u65b9\u6cd5</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools_gc/","title":"Android \u5185\u5b58\u5206\u6790\u5de5\u5177(\u67e5\u770bGC)","text":""},{"location":"perf-opt/Android/memory/Android_memory_tools_gc/#1-logcatgc","title":"1. Logcat\u8bfb\u53d6GC\u6d88\u606f","text":"<p>\u53d1\u751f\u5783\u573e\u56de\u6536\u4e8b\u4ef6\u65f6\uff0c\u76f8\u5e94\u6d88\u606f\u4f1a\u8f93\u51fa\u5230 Logcat \u4e2d\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools_gc/#11-dalvik","title":"1.1. Dalvik \u65e5\u5fd7\u6d88\u606f","text":"<p>\u5728 Dalvik \u4e2d\uff0c\u6bcf\u4e2a GC \u6d88\u606f\u90fd\u4f1a\u5c06\u4ee5\u4e0b\u4fe1\u606f\u8f93\u51fa\u5230 logcat \u4e2d\uff1a</p> <pre><code>D/dalvikvm(PID): GC_Reason Amount_freed, Heap_stats, External_memory_stats, Pause_time\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>D/dalvikvm( 9050): GC_CONCURRENT freed 2049K, 65% free 3571K/9991K, external 4703K/5261K, paused 2ms+2ms\n</code></pre> <ul> <li> <p>GC_Reason(GC \u539f\u56e0)   \u4ec0\u4e48\u89e6\u53d1\u4e86 GC \u4ee5\u53ca\u662f\u54ea\u79cd\u56de\u6536\u3002\u53ef\u80fd\u7684\u539f\u56e0\u5305\u62ec\uff1a</p> <ul> <li><code>GC_CONCURRENT</code>\u5728\u5806\u5f00\u59cb\u5360\u7528\u5185\u5b58\u65f6\u91ca\u653e\u5185\u5b58\u7684\u5e76\u53d1 GC\u3002</li> <li><code>GC_FOR_MALLOC</code> \u5806\u5df2\u6ee1\u800c\u7cfb\u7edf\u4e0d\u5f97\u4e0d\u505c\u6b62\u5e94\u7528\u5e76\u56de\u6536\u5185\u5b58\u65f6\uff0c\u5e94\u7528\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u800c\u5f15\u8d77\u7684 GC\u3002</li> <li><code>GC_HPROF_DUMP_HEAP</code>\u5f53\u8bf7\u6c42\u521b\u5efa HPROF \u6587\u4ef6\u6765\u5206\u6790\u5806\u65f6\u53d1\u751f\u7684 GC\u3002</li> <li><code>GC_EXPLICIT</code>\u663e\u5f0f GC\uff0c\u4f8b\u5982\u8c03\u7528 <code>gc()</code> \u65f6\uff08\u5e94\u907f\u514d\u8c03\u7528\u5b83\uff0c\u800c\u5e94\u4fe1\u4efb GC \u4f1a\u6839\u636e\u9700\u8981\u8fd0\u884c\uff09\u3002</li> <li><code>GC_EXTERNAL_ALLOC</code>\u8fd9\u4ec5\u9002\u7528\u4e8e API \u7ea7\u522b 10 \u53ca\u66f4\u4f4e\u7ea7\u522b\uff08\u66f4\u65b0\u7684\u7248\u672c\u4f1a\u5728 Dalvik \u5806\u4e2d\u5206\u914d\u4efb\u4f55\u5185\u5b58\uff09\u3002\u5916\u90e8\u5206\u914d\u5185\u5b58\u7684 GC\uff08\u4f8b\u5982\u5b58\u50a8\u5728\u539f\u751f\u5185\u5b58\u6216 NIO \u5b57\u8282\u7f13\u51b2\u533a\u4e2d\u7684\u50cf\u7d20\u6570\u636e\uff09\u3002</li> </ul> </li> <li> <p>Amount_freed(\u91ca\u653e\u91cf)</p> </li> </ul> <p>\u4ece\u6b64\u6b21 GC \u4e2d\u56de\u6536\u7684\u5185\u5b58\u91cf\u3002</p> <ul> <li>Heap_stats(\u5806\u7edf\u8ba1\u6570\u636e)</li> </ul> <p>\u5806\u7684\u53ef\u7528\u7a7a\u95f4\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002</p> <ul> <li>External_memory_stats(\u5916\u90e8\u5185\u5b58\u7edf\u8ba1\u6570\u636e)</li> </ul> <p>API \u7ea7\u522b 10 \u53ca\u66f4\u4f4e\u7ea7\u522b\u7684\u5916\u90e8\u5206\u914d\u5185\u5b58\uff08\u5df2\u5206\u914d\u5185\u5b58\u91cf\uff09/\uff08\u53d1\u751f\u56de\u6536\u7684\u9650\u503c\uff09\u3002</p> <ul> <li>Pause_time(\u6682\u505c\u65f6\u95f4)</li> </ul> <p>\u5806\u8d8a\u5927\uff0c\u6682\u505c\u65f6\u95f4\u8d8a\u957f\u3002\u5e76\u53d1\u6682\u505c\u65f6\u95f4\u663e\u793a\u4e24\u4e2a\u6682\u505c\uff1a\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5f00\u59cb\u65f6\uff0c\u53e6\u4e00\u4e2a\u51fa\u73b0\u5728\u56de\u6536\u5feb\u8981\u5b8c\u6210\u65f6\u3002</p> <p>\u5728\u6b64\u7c7b\u65e5\u5fd7\u6d88\u606f\u79ef\u805a\u65f6\uff0c\u8bf7\u6ce8\u610f\u5806\u7edf\u8ba1\u6570\u636e\uff08\u4e0a\u9762\u793a\u4f8b\u4e2d\u7684 <code>3571K/9991K</code> \u503c\uff09\u7684\u589e\u5927\u60c5\u51b5\u3002\u5982\u679c\u6b64\u503c\u7ee7\u7eed\u589e\u5927\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u9732\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools_gc/#1-2-art","title":"1. 2. ART \u65e5\u5fd7\u6d88\u606f","text":"<p>\u4e0e Dalvik \u4e0d\u540c\uff0cART \u4e0d\u4f1a\u4e3a\u672a\u660e\u786e\u8bf7\u6c42\u7684 GC \u8bb0\u5f55\u6d88\u606f\u3002\u53ea\u6709\u5728\u7cfb\u7edf\u8ba4\u4e3a GC \u901f\u5ea6\u8f83\u6162\u65f6\u624d\u4f1a\u8f93\u51fa GC \u6d88\u606f\u3002\u66f4\u786e\u5207\u5730\u8bf4\uff0c\u4ec5\u5728 GC \u6682\u505c\u65f6\u95f4\u8d85\u8fc7 5 \u6beb\u79d2\u6216 GC \u6301\u7eed\u65f6\u95f4\u8d85\u8fc7 100 \u6beb\u79d2\u65f6\u3002\u5982\u679c\u5e94\u7528\u672a\u5904\u4e8e\u53ef\u5bdf\u89c9\u5230\u6682\u505c\u7684\u72b6\u6001\uff08\u4f8b\u5982\u5e94\u7528\u5728\u540e\u53f0\u8fd0\u884c\u65f6\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u65e0\u6cd5\u5bdf\u89c9 GC \u6682\u505c\uff09\uff0c\u5219\u5176\u6240\u6709 GC \u90fd\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u901f\u5ea6\u8f83\u6162\u3002\u7cfb\u7edf\u4e00\u76f4\u4f1a\u8bb0\u5f55\u663e\u5f0f GC\u3002</p> <p>ART \u4f1a\u5728\u5176\u5783\u573e\u56de\u6536\u65e5\u5fd7\u6d88\u606f\u4e2d\u5305\u542b\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <pre><code>I/art: GC_Reason GC_Name Objects_freed(Size_freed) AllocSpace Objects,\n    Large_objects_freed(Large_object_size_freed) Heap_stats LOS objects, Pause_time(s)\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>I/art : Explicit concurrent mark sweep GC freed 104710(7MB) AllocSpace objects,\n    21(416KB) LOS objects, 33% free, 25MB/38MB, paused 1.230ms total 67.216ms\n</code></pre> <ul> <li> <p>GC_Reason(GC \u539f\u56e0)     \u4ec0\u4e48\u89e6\u53d1\u4e86 GC \u4ee5\u53ca\u662f\u54ea\u79cd\u56de\u6536\u3002\u53ef\u80fd\u7684\u539f\u56e0\u5305\u62ec\uff1a</p> <ul> <li><code>Concurrent</code> \u4e0d\u4f1a\u6302\u8d77\u5e94\u7528\u7ebf\u7a0b\u7684\u5e76\u53d1 GC\u3002\u6b64 GC \u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u800c\u4e14\u4e0d\u4f1a\u963b\u6b62\u5206\u914d\u3002</li> <li><code>Alloc</code> \u5e94\u7528\u5728\u5806\u5df2\u6ee1\u65f6\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u800c\u5f15\u8d77\u7684 GC\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5783\u573e\u56de\u6536\u5728\u5206\u914d\u7ebf\u7a0b\u4e2d\u53d1\u751f\u3002</li> <li><code>Explicit</code> \u7531\u5e94\u7528\u660e\u786e\u8bf7\u6c42\u7684\u5783\u573e\u56de\u6536\uff0c\u4f8b\u5982\uff0c\u901a\u8fc7\u8c03\u7528 <code>gc()</code> \u6216 <code>gc()</code>\u3002\u4e0e Dalvik \u4e00\u6837\uff0c\u5728 ART \u4e2d\uff0c\u6700\u4f73\u505a\u6cd5\u662f\u4fe1\u4efb GC \u5e76\u907f\u514d\u8bf7\u6c42\u663e\u5f0f GC\uff08\u5982\u679c\u53ef\u80fd\uff09\u3002\u4e0d\u5efa\u8bae\u8bf7\u6c42\u663e\u5f0f GC\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u963b\u6b62\u5206\u914d\u7ebf\u7a0b\u5e76\u4e0d\u5fc5\u8981\u5730\u6d6a\u8d39 CPU \u5468\u671f\u3002\u6b64\u5916\uff0c\u5982\u679c\u663e\u5f0f GC \u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u88ab\u62a2\u5360\uff0c\u5219\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5361\u987f\uff08\u5e94\u7528\u51fa\u73b0\u5361\u987f\u3001\u6296\u52a8\u6216\u6682\u505c\uff09\u3002</li> <li><code>NativeAlloc</code> \u539f\u751f\u5206\u914d\uff08\u4f8b\u5982\u4f4d\u56fe\u6216 RenderScript \u5206\u914d\u5bf9\u8c61\uff09\u5bfc\u81f4\u51fa\u73b0\u539f\u751f\u5185\u5b58\u538b\u529b\uff0c\u8fdb\u800c\u5f15\u8d77\u7684\u56de\u6536\u3002</li> <li><code>CollectorTransition</code> \u7531\u5806\u8f6c\u6362\u5f15\u8d77\u7684\u56de\u6536\uff1b\u8fd9\u7531\u5728\u8fd0\u884c\u65f6\u53d8\u66f4 GC \u7b56\u7565\u5f15\u8d77\uff08\u4f8b\u5982\u5e94\u7528\u5728\u53ef\u5bdf\u89c9\u5230\u6682\u505c\u7684\u72b6\u6001\u4e4b\u95f4\u5207\u6362\u65f6\uff09\u3002\u56de\u6536\u5668\u8f6c\u6362\u5305\u62ec\u5c06\u6240\u6709\u5bf9\u8c61\u4ece\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u590d\u5236\u5230\u78b0\u649e\u6307\u9488\u7a7a\u95f4\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002\u56de\u6536\u5668\u8f6c\u6362\u4ec5\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u51fa\u73b0\uff1a\u5728 Android 8.0 \u4e4b\u524d\u7684\u4f4e\u5185\u5b58\u8bbe\u5907\u4e0a\uff0c\u5e94\u7528\u5c06\u8fdb\u7a0b\u72b6\u6001\u4ece\u53ef\u5bdf\u89c9\u5230\u6682\u505c\u7684\u72b6\u6001\uff08\u4f8b\u5982\u5e94\u7528\u5728\u524d\u53f0\u8fd0\u884c\u65f6\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u53ef\u4ee5\u5bdf\u89c9 GC \u6682\u505c\uff09\u66f4\u6539\u4e3a\u5bdf\u89c9\u4e0d\u5230\u6682\u505c\u7684\u72b6\u6001\uff08\u53cd\u4e4b\u4ea6\u7136\uff09\u3002</li> <li><code>HomogeneousSpaceCompact</code> \u540c\u6784\u7a7a\u95f4\u538b\u7f29\u662f\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u5230\u7a7a\u95f2\u5217\u8868\u7a7a\u95f4\u538b\u7f29\uff0c\u901a\u5e38\u5728\u5e94\u7528\u8fdb\u5165\u5230\u5bdf\u89c9\u4e0d\u5230\u6682\u505c\u7684\u8fdb\u7a0b\u72b6\u6001\u65f6\u53d1\u751f\u3002\u8fd9\u6837\u505a\u7684\u4e3b\u8981\u539f\u56e0\u662f\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u91cf\u5e76\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\u3002</li> <li><code>DisableMovingGc</code> \u8fd9\u4e0d\u662f\u771f\u6b63\u7684 GC \u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u7531\u4e8e\u5728\u53d1\u751f\u5e76\u53d1\u5806\u538b\u7f29\u65f6\u4f7f\u7528\u4e86 GetPrimitiveArrayCritical\uff0c\u56de\u6536\u906d\u5230\u963b\u6b62\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 GetPrimitiveArrayCritical\uff0c\u56e0\u4e3a\u5b83\u5728\u79fb\u52a8\u56de\u6536\u5668\u65b9\u9762\u5b58\u5728\u9650\u5236\u3002</li> <li><code>HeapTrim</code> \u8fd9\u4e0d\u662f GC \u539f\u56e0\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c\u5728\u5806\u4fee\u526a\u5b8c\u6210\u4e4b\u524d\uff0c\u56de\u6536\u4f1a\u4e00\u76f4\u53d7\u5230\u963b\u6b62\u3002</li> </ul> </li> <li> <p>GC_Name(GC \u540d\u79f0)   ART \u5177\u6709\u53ef\u4ee5\u8fd0\u884c\u7684\u591a\u79cd\u4e0d\u540c\u7684 GC\u3002</p> <ul> <li><code>Concurrent mark sweep (CMS)</code> \u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u91ca\u653e\u548c\u56de\u6536\u9664\u6620\u50cf\u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002</li> <li><code>Concurrent partial mark sweep</code> \u51e0\u4e4e\u6574\u4e2a\u5806\u56de\u6536\u5668\uff0c\u4f1a\u56de\u6536\u9664\u6620\u50cf\u7a7a\u95f4\u548c Zygote \u7a7a\u95f4\u4ee5\u5916\u7684\u6240\u6709\u5176\u4ed6\u7a7a\u95f4\u3002</li> <li><code>Concurrent sticky mark sweep</code> \u5206\u4ee3\u56de\u6536\u5668\uff0c\u53ea\u80fd\u91ca\u653e\u81ea\u4e0a\u6b21 GC \u540e\u5206\u914d\u7684\u5bf9\u8c61\u3002\u6b64\u5783\u573e\u56de\u6536\u6bd4\u5b8c\u6574\u6216\u90e8\u5206\u6807\u8bb0\u6e05\u9664\u8fd0\u884c\u5f97\u66f4\u9891\u7e41\uff0c\u56e0\u4e3a\u5b83\u66f4\u5feb\u901f\u4e14\u6682\u505c\u65f6\u95f4\u66f4\u77ed\u3002</li> <li><code>Marksweep + semispace</code> \u975e\u5e76\u53d1\u3001\u590d\u5236 GC\uff0c\u7528\u4e8e\u5806\u8f6c\u6362\u4ee5\u53ca\u540c\u6784\u7a7a\u95f4\u538b\u7f29\uff08\u5bf9\u5806\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09\u3002</li> </ul> </li> <li> <p>Objects_freed(\u91ca\u653e\u7684\u5bf9\u8c61)</p> </li> </ul> <p>\u6b64 GC \u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002</p> <ul> <li>Size_freed(\u91ca\u653e\u7684\u5927\u5c0f)</li> </ul> <p>\u6b64 GC \u4ece\u975e\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002</p> <ul> <li>Large objects freed(\u91ca\u653e\u7684\u5927\u578b\u5bf9\u8c61)</li> </ul> <p>\u6b64\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5bf9\u8c61\u6570\u91cf\u3002</p> <ul> <li>Large object size freed(\u91ca\u653e\u7684\u5927\u578b\u5bf9\u8c61\u5927\u5c0f)</li> </ul> <p>\u6b64\u5783\u573e\u56de\u6536\u4ece\u5927\u578b\u5bf9\u8c61\u7a7a\u95f4\u56de\u6536\u7684\u5b57\u8282\u6570\u91cf\u3002</p> <ul> <li>Heap stats(\u5806\u7edf\u8ba1\u6570\u636e)</li> </ul> <p>\u53ef\u7528\u7a7a\u95f4\u767e\u5206\u6bd4\u4e0e\uff08\u6d3b\u52a8\u5bf9\u8c61\u6570\u91cf\uff09/\uff08\u5806\u603b\u5927\u5c0f\uff09\u3002</p> <ul> <li>Pause times(\u6682\u505c\u65f6\u95f4)</li> </ul> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6682\u505c\u65f6\u95f4\u4e0e GC \u8fd0\u884c\u65f6\u4fee\u6539\u7684\u5bf9\u8c61\u5f15\u7528\u6570\u91cf\u6210\u6b63\u6bd4\u3002\u5f53\u524d\uff0cART CMS GC \u4ec5\u5728 GC \u5373\u5c06\u5b8c\u6210\u65f6\u6682\u505c\u4e00\u6b21\u3002 \u79fb\u52a8 GC \u7684\u6682\u505c\u65f6\u95f4\u8f83\u957f\uff0c\u4f1a\u5728 GC \u7684\u5927\u90e8\u5206\u65f6\u95f4\u6301\u7eed\u3002</p> <p>\u5982\u679c\u5728 logcat \u4e2d\u770b\u5230\u5927\u91cf GC\uff0c\u8bf7\u6ce8\u610f\u5806\u7edf\u8ba1\u6570\u636e\uff08\u4e0a\u9762\u793a\u4f8b\u4e2d\u7684 <code>25MB/38MB</code> \u503c\uff09\u7684\u589e\u5927\u60c5\u51b5\u3002\u5982\u679c\u6b64\u503c\u7ee7\u7eed\u589e\u5927\uff0c\u4e14\u59cb\u7ec8\u6ca1\u6709\u53d8\u5c0f\u7684\u8d8b\u52bf\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u3002\u6216\u8005\uff0c\u5982\u679c\u770b\u5230\u539f\u56e0\u4e3a\u201cAlloc\u201d\u7684 GC\uff0c\u5219\u5df2\u5feb\u8981\u8fbe\u5230\u5806\u5bb9\u91cf\u4e0a\u9650\uff0c\u5e76\u4e14\u5f88\u5feb\u4f1a\u51fa\u73b0 OOM \u5f02\u5e38\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools_gc/#2-debuggc","title":"2. \u901a\u8fc7<code>Debug</code>\u7c7b\u8bfb\u53d6GC\u6d88\u606f","text":"<p>\u5728\u5b9e\u9a8c\u5ba4\u6216\u8005\u5185\u90e8\u8bd5\u7528\u73af\u5883\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>Debug.startAllocCounting</code> \u6765\u76d1\u63a7 Java \u5185\u5b58\u5206\u914d\u548c GC \u7684\u60c5\u51b5\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u8fd9\u4e2a\u9009\u9879\u5bf9\u6027\u80fd\u6709\u4e00\u5b9a\u7684\u5f71\u54cd\uff0c\u867d\u7136\u76ee\u524d\u8fd8\u53ef\u4ee5\u4f7f\u7528\uff0c\u4f46\u5df2\u7ecf\u88ab Android \u6807\u8bb0\u4e3a deprecated\u3002</p> <p>\u901a\u8fc7\u76d1\u63a7\uff0c\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u5185\u5b58\u5206\u914d\u7684\u6b21\u6570\u548c\u5927\u5c0f\uff0c\u4ee5\u53ca GC \u53d1\u8d77\u6b21\u6570\u7b49\u4fe1\u606f\u3002</p> <pre><code>long allocCount = Debug.getGlobalAllocCount();\nlong allocSize = Debug.getGlobalAllocSize();\nlong gcCount = Debug.getGlobalGcInvocationCount();\n</code></pre> <p>\u4e0a\u9762\u7684\u8fd9\u4e9b\u4fe1\u606f\u4f3c\u4e4e\u4e0d\u592a\u5bb9\u6613\u5b9a\u4f4d\u95ee\u9898\uff0c\u5728 Android 6.0 \u4e4b\u540e\u7cfb\u7edf\u53ef\u4ee5\u62ff\u5230\u66f4\u52a0\u7cbe\u51c6\u7684 GC \u4fe1\u606f\u3002</p> <pre><code>// \u8fd0\u884c\u7684GC\u6b21\u6570\nDebug.getRuntimeStat(\"art.gc.gc-count\");\n// GC\u4f7f\u7528\u7684\u603b\u8017\u65f6\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\nDebug.getRuntimeStat(\"art.gc.gc-time\");\n// \u963b\u585e\u5f0fGC\u7684\u6b21\u6570\nDebug.getRuntimeStat(\"art.gc.blocking-gc-count\");\n// \u963b\u585e\u5f0fGC\u7684\u603b\u8017\u65f6\nDebug.getRuntimeStat(\"art.gc.blocking-gc-time\");\n</code></pre> <p>\u9700\u8981\u7279\u522b\u6ce8\u610f\u963b\u585e\u5f0f GC \u7684\u6b21\u6570\u548c\u8017\u65f6\uff0c\u56e0\u4e3a\u5b83\u4f1a\u6682\u505c\u5e94\u7528\u7ebf\u7a0b\uff0c\u53ef\u80fd\u5bfc\u81f4\u5e94\u7528\u53d1\u751f\u5361\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u66f4\u52a0\u7ec6\u7c92\u5ea6\u5730\u5206\u5e94\u7528\u573a\u666f\u7edf\u8ba1\u3002</p>"},{"location":"perf-opt/Android/memory/Android_memory_tools_gc/#_1","title":"\u53c2\u8003","text":"<p>android \u9ad8\u624b\u8bfe</p>"},{"location":"perf-opt/Android/memory/MAT-Advanced/","title":"MAT \u8fdb\u9636","text":""},{"location":"perf-opt/Android/memory/MAT-Advanced/#1","title":"1. \u5185\u5b58\u5feb\u7167\u5bf9\u6bd4","text":""},{"location":"perf-opt/Android/memory/MAT-Advanced/#11","title":"1.1 \u4f7f\u7528","text":"<p>\u9996\u5148\uff0c\u81f3\u5c11\u6253\u5f00\u4e24\u4e2ahprof\u6587\u4ef6\uff0c\u8fdb\u5165<code>Histogram</code>\u9875\u9762\uff0c\u7136\u540e\u9009\u62e9\u5176\u4e2d\u4e24\u4e2a\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u53d8\u5316\u7684\u7c7b\u5b9e\u4f8b\u60c5\u51b5</p> <p></p> <p></p>"},{"location":"perf-opt/Android/memory/MAT-Advanced/#12","title":"1.2 \u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u901a\u8fc7\u5bf9\u6bd4\u4e24\u4e2a\u5185\u5b58\u5feb\u7167\uff0c\u53ef\u4ee5\u67e5\u770b\u5185\u5b58\u589e\u957f\u539f\u56e0</li> <li>\u540c\u65f6\u4e5f\u53ef\u4ee5\u8f93\u5165\u8fc7\u6ee4\u6761\u4ef6\uff0c\u8fc7\u6ee4\u6000\u7591\u70b9\uff0c\u5feb\u901f\u5b9a\u4f4d</li> </ul>"},{"location":"perf-opt/Android/memory/MAT-Advanced/#2","title":"2. \u96c6\u5408\u72b6\u6001","text":""},{"location":"perf-opt/Android/memory/MAT-Advanced/#21","title":"2.1 \u96c6\u5408\u586b\u5145\u7387","text":"<p>\u4f7f\u7528\u573a\u666f\uff1a\u901a\u8fc7\u5bf9 ArrayList \u6216\u6570\u7ec4\u7b49\u96c6\u5408\u7c7b\u5bf9\u8c61\u6309\u586b\u5145\u7387\u805a\u7c7b\uff0c\u5b9a\u4f4d\u7a00\u758f\u6216\u7a7a\u96c6\u5408\u7c7b\u5bf9\u8c61\u9020\u6210\u7684\u5185\u5b58\u6d6a\u8d39</p>"},{"location":"perf-opt/Android/memory/MAT-Advanced/#22-hashmap-hashhash","title":"2.2 HashMap \u51b2\u7a81\u7387(\u5f53Hash\u96c6\u5408\u4e2d\u8fc7\u591a\u7684\u5bf9\u8c61\u8fd4\u56de\u76f8\u540cHash\u503c\u7684\u65f6\u5019\uff0c\u4f1a\u4e25\u91cd\u5f71\u54cd\u6027\u80fd)","text":"<p>\u4f7f\u7528\u573a\u666f\uff1a\u67e5\u627e\u5bfc\u81f4Hash\u96c6\u5408\u7684\u78b0\u649e\u7387\u8f83\u9ad8\u7684\u7f6a\u9b41\u7978\u9996\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Advanced/#3-oql","title":"3. \u901a\u8fc7OQL\u5206\u6790\u5185\u5b58","text":""},{"location":"perf-opt/Android/memory/MAT-Advanced/#31","title":"3.1 \u8bed\u6cd5","text":"<pre><code>SELECT * FROM [ INSTANCEOF ] &lt;class_name&gt; [ WHERE &lt;filter-expression&gt; ]\n</code></pre> <ul> <li> <p><code>Select</code>\u5b50\u53e5\u53ef\u4ee5\u4f7f\u7528\u201c*\u201d\uff0c\u67e5\u770b\u7ed3\u679c\u5bf9\u8c61\u7684\u5f15\u7528\u5b9e\u4f8b\uff08\u76f8\u5f53\u4e8e outgoing references\uff09\uff1b\u53ef\u4ee5\u6307\u5b9a\u5177\u4f53\u7684\u5185\u5bb9\uff0c\u5982 Select OBJECTS v.elementData from xx \u662f\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5b8c\u6574\u7684\u5bf9\u8c61\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f)\uff1b\u53ef\u4ee5\u4f7f\u7528 Distinct \u5173\u952e\u8bcd\u53bb\u91cd\u3002</p> </li> <li> <p><code>From</code> \u6307\u5b9a\u67e5\u8be2\u8303\u56f4\uff0c\u4e00\u822c\u6307\u5b9a\u7c7b\u540d\u3001\u6b63\u5219\u8868\u8fbe\u5f0f\u3001\u5bf9\u8c61\u5730\u5740\u3002</p> </li> <li> <p><code>Where</code> \u7528\u6765\u6307\u5b9a\u7b5b\u9009\u6761\u4ef6\u3002</p> </li> <li> <p>\u5168\u90e8\u8bed\u6cd5\u8be6\u89c1\uff1aOQL \u8bed\u6cd5</p> </li> <li> <p>INSTANCEOF \u5173\u952e\u5b57:\u67e5\u627e\u5c5e\u4e8e\u67d0\u7236\u7c7b\uff0c\u5b9e\u73b0\u67d0\u63a5\u53e3\u7684\u5bf9\u8c61\u3002\u8fd8\u6709\u4e00\u4e9b\u5bf9\u8c61\u5c5e\u6027\uff0c\u5982<code>@usedHeapSize</code> \u8868\u793a\u83b7\u53d6\u5360\u7528\u5185\u5b58\u503c\uff1b<code>@retainedHeapSize</code>\u8868\u793a\u83b7\u53d6\u5305\u542b\u5f15\u7528\u5bf9\u8c61\u5360\u7528\u603b\u5185\u5b58\u503c\uff0c<code>@GCRootInfo</code>\u8868\u793a\u8be5\u5bf9\u8c61\u7684\u5783\u573e\u56de\u6536\u6839\u8282\u70b9\uff0c\u5224\u65ad\u662f\u5426\u4ecd\u88ab\u5f15\u7528</p> </li> </ul> <p>\u4f8b\u5b50\uff1a\u67e5\u627e size\uff1d0 \u4e14\u672a\u4f7f\u7528\u8fc7\u7684 ArrayList\uff1a</p> <pre><code>select * from java.util.ArrayList where size=0 and modCount=0\n</code></pre>"},{"location":"perf-opt/Android/memory/MAT-Advanced/#32","title":"3.2 \u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u4e00\u822c\u6bd4\u8f83\u590d\u6742\u7684\u95ee\u9898\u4f1a\u4f7f\u7528 OQL\uff0c\u800c\u4e14\u8fd9\u7c7b\u95ee\u9898\u5f80\u5f80\u4e0e\u4e1a\u52a1\u903b\u8f91\u6709\u8f83\u5927\u5173\u7cfb\u3002\u6bd4\u5982\u5927\u91cf\u7684\u5c0f\u5bf9\u8c61\u6574\u4f53\u5360\u7528\u5185\u5b58\u9ad8\uff0c\u4f46\u9884\u671f\u5c0f\u5bf9\u8c61\u5e94\u8be5\u4e0d\u4f1a\u8fc7\u591a\uff08\u6bd4\u5982\u8fbe\u5230\u767e\u4e07\u4e2a\uff09\uff0c\u4e00\u4e2a\u4e00\u4e2a\u770b\u53c8\u4e0d\u73b0\u5b9e\uff0c\u53ef\u4ee5\u91c7\u7528 OQL \u67e5\u8be2\u5bfc\u51fa\u6570\u636e\u6392\u67e5\u3002</li> <li>\u53ef\u4ee5\u5feb\u901f\u67e5\u627e\u901a\u7528\u7684\u7ec4\u4ef6\u6216\u8005\u5176\u5b50\u7c7b\u7684\u5185\u5b58\u60c5\u51b5\uff0c\u5224\u65ad\u662f\u5426\u53d1\u73b0\u5185\u5b58\u6cc4\u6f0f\uff0c\u5982Activity\u3001Fragment</li> </ul> <p>\u4f8b\u5b50\uff1a\u67e5\u627e\u6240\u6709Activity</p> <pre><code>SELECT a AS Value, a.@usedHeapSize AS \"Shallow Size\", a.@retainedHeapSize AS \"Retained Size\" FROM INSTANCEOF androidx.appcompat.app.AppCompatActivity a\n</code></pre> <p></p>"},{"location":"perf-opt/Android/memory/MAT-Startup/","title":"MAT\u5165\u95e8","text":""},{"location":"perf-opt/Android/memory/MAT-Startup/#1-mat","title":"1. MAT \u7b80\u4ecb","text":"<p>MAT\uff08\u5168\u540d\uff1aMemory Analyzer Tool\uff09\uff0c\u662f\u4e00\u6b3e\u9ad8\u6027\u80fd\u3001\u5177\u5907\u4e30\u5bcc\u529f\u80fd\u7684Java\u5806\u5185\u5b58\u5206\u6790\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5b9a\u4f4d\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\u548c\u51cf\u5c11\u5185\u5b58\u6d88\u8017\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#11","title":"1.1 \u5b89\u88c5\u53ca\u4f7f\u7528","text":"<p>\u5728Android\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e00\u822c\u662f\u4e0b\u8f7d\u5176\u72ec\u7acb\u7248\u672c,\u76f4\u63a5\u4e0b\u8f7d\u5b89\u88c5\u8fd0\u884c\u5373\u53ef\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#111-hprof","title":"1.1.1 \u83b7\u53d6HPROF\u6587\u4ef6","text":"<p>HPROF\u6587\u4ef6\u5b58\u50a8\u7684\u662f\u7279\u5b9a\u65f6\u95f4\u70b9\uff0cjava\u8fdb\u7a0b\u7684\u5185\u5b58\u5feb\u7167\uff0c\u5728Android\u4e2d\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u83b7\u53d6</p> <ul> <li>adb\u547d\u4ee4</li> </ul> <pre><code>adb shell am dumpheap &lt;processname&gt; /data/local/tmp/xxx.hprof\n</code></pre> <ul> <li>\u4ee3\u7801\u65b9\u5f0f</li> </ul> <pre><code>try {\nval fileName = \"xxxxx/dump.hprof\"\nDebug.dumpHprofData(fileName)\n} catch (e: IOException) {\ne.printStackTrace()\n}\n</code></pre> <ul> <li>\u901a\u8fc7Android Profiler </li> </ul>"},{"location":"perf-opt/Android/memory/MAT-Startup/#112-hprof","title":"1.1.2 \u8f6c\u6362HPROF\u6587\u4ef6","text":"<p>\u7531\u4e8e<code>Android</code>\u7684<code>Dalvik</code>\u865a\u62df\u673a\u5bfc\u51fa\u7684\u5806\u8f6c\u50a8\u6587\u4ef6\u7684\u683c\u5f0f\u4e0e\u6807\u51c6\u7684<code>JVM</code>\u5bfc\u51fa\u7684\u5806\u8f6c\u50a8\u6587\u4ef6\u7684\u683c\u5f0f\u6807\u51c6\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u4f7f\u7528<code>MAT</code>\u6253\u5f00<code>Android</code>\u7684<code>Dalvik</code>\u865a\u62df\u673a\u5bfc\u51fa\u7684 \u5806\u8f6c\u50a8\u6587\u4ef6\u65f6\u5fc5\u987b\u5148\u8f6c\u6362\u6210<code>MAT</code>\u80fd\u8bc6\u522b\u7684\u6807\u51c6\u683c\u5f0f\u3002<code>Android</code>\u63d0\u4f9b\u4e86\u88c5\u6362\u5de5\u5177<code>hprof-conv</code></p> <pre><code>/android-sdk/platform-tools/hprof-conv &lt;FileName&gt; &lt;newFileName&gt;.hprof\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u4f7f\u7528<code>MAT</code>\u6253\u5f00<code>&lt;newFileName&gt;.hprof</code>\u6587\u4ef6\u4e86</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#2","title":"2. \u57fa\u672c\u6982\u5ff5","text":""},{"location":"perf-opt/Android/memory/MAT-Startup/#21-gc-roots","title":"2.1 GC Roots","text":"<p>\u6839\u641c\u7d22\u7b97\u6cd5\u662fJVM\u7528\u6765\u7684\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b\u7684\u7b97\u6cd5\uff0c\u6b64\u7b97\u6cd5\u57fa\u672c\u601d\u8def\u4e3a\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u201cGC Roots\u201d\u5bf9\u8c61\u4f5c\u4e3a\u8d77\u59cb\u70b9\uff0c\u4ece\u8fd9\u4e9b\u8282\u70b9\u5f80\u4e0b\u641c\u7d22\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u548cGC Roots\u4e0d\u53ef\u8fbe\u65f6\uff0c\u5219\u8be5\u5bf9\u8c61\u662f\u65e0\u7528\u7684\uff0c\u53ef\u88ab\u56de\u6536\u7684\u3002</p> <p>\u5728java\u4e2d\uff0c\u53ef\u4f5c\u4e3aGC Roots\u7684\u5bf9\u8c61\u6709\uff1a</p> <ul> <li>\u865a\u62df\u673a\u6808\uff08\u6808\u5e27\u4e2d\u7684\u672c\u5730\u53d8\u91cf\u8868\uff09\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61\uff1b</li> <li>\u65b9\u6cd5\u533a\u4e2d\u7684\u7c7b\u9759\u6001\u5c5e\u6027\u5f15\u7528\u7684\u5bf9\u8c61\uff1b</li> <li>\u65b9\u6cd5\u533a\u4e2d\u5e38\u91cf\u5f15\u7528\u7684\u5bf9\u8c61\uff1b</li> <li>\u672c\u5730\u65b9\u6cd5\u6808\u4e2dJNI\uff08\u5373\u4e00\u822c\u8bf4\u7684Native\u65b9\u6cd5\uff09\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61</li> </ul>"},{"location":"perf-opt/Android/memory/MAT-Startup/#22","title":"2.2 \u5f15\u7528\u7c7b\u578b","text":""},{"location":"perf-opt/Android/memory/MAT-Startup/#221-strong-references","title":"2.2.1 \u5f3a\u5f15\u7528\uff08Strong references\uff09","text":"<p>\u666e\u901a\u7684java\u5f15\u7528\uff0c\u6211\u4eec\u901a\u5e38new\u7684\u5bf9\u8c61\u5c31\u662f\uff1a <code>StringBuffer buffer = new StringBuffer();</code> \u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u901a\u8fc7\u4e00\u4e32\u5f3a\u5f15\u7528\u94fe\u53ef\u8fbe\uff0c\u90a3\u4e48\u5b83\u5c31\u4e0d\u4f1a\u88ab\u5783\u573e\u56de\u6536\u3002\u4f60\u80af\u5b9a\u4e0d\u5e0c\u671b\u81ea\u5df1\u6b63\u5728\u4f7f\u7528\u7684\u5f15\u7528\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u5427\u3002\u4f46\u5bf9\u4e8e\u96c6\u5408\u4e2d\u7684\u5bf9\u8c61\uff0c\u5e94\u5728\u4e0d\u4f7f\u7528\u7684\u65f6\u5019\u79fb\u9664\u6389\uff0c\u5426\u5219\u4f1a\u5360\u7528\u66f4\u591a\u7684\u5185\u5b58\uff0c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#222-soft-reference","title":"2.2.2 \u8f6f\u5f15\u7528\uff08Soft reference\uff09","text":"<p>\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u53ea\u5177\u6709\u8f6f\u5f15\u7528\uff0c\u5219\u5185\u5b58\u7a7a\u95f4\u5145\u8db3\u65f6\uff0c\u5783\u573e\u56de\u6536\u5668\u5c31\u4e0d\u4f1a\u56de\u6536\u5b83\uff1b\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u8db3\u4e86\uff0c\u5c31\u4f1a\u56de\u6536\u8fd9\u4e9b\u5bf9\u8c61\u7684\u5185\u5b58\u3002\u53ea\u8981\u5783\u573e\u56de\u6536\u5668\u6ca1\u6709\u56de\u6536\u5b83\uff0c\u8be5\u5bf9\u8c61\u5c31\u53ef\u4ee5\u88ab\u7a0b\u5e8f\u4f7f\u7528\u3002\u4e00\u822c\u8f6f\u5f15\u7528\u53ef\u7528\u6765\u5b9e\u73b0\u5185\u5b58\u654f\u611f\u7684\u9ad8\u901f\u7f13\u5b58\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#223-weakreference","title":"2.2.3 \u5f31\u5f15\u7528\uff08WeakReference\uff09","text":"<p><code>WeakReference</code>\u4e0d\u4f1a\u5f3a\u5236\u5bf9\u8c61\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u5b83\u62e5\u6709\u6bd4\u8f83\u77ed\u6682\u7684\u751f\u547d\u5468\u671f\uff0c\u5141\u8bb8\u4f60\u4f7f\u7528\u5783\u573e\u56de\u6536\u5668\u7684\u80fd\u529b\u53bb\u6743\u8861\u4e00\u4e2a\u5bf9\u8c61\u7684\u53ef\u8fbe\u6027\u3002\u5728\u5783\u573e\u56de\u6536\u5668\u626b\u63cf\u5b83\u6240\u7ba1\u8f96\u7684\u5185\u5b58\u533a\u57df\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u65e6gc\u53d1\u73b0\u5bf9\u8c61\u662f<code>weakReference</code>\u53ef\u8fbe\uff0c\u5c31\u4f1a\u628a\u5b83\u653e\u5230ReferenceQueue\u4e2d\uff0c\u7b49\u4e0b\u6b21gc\u65f6\u56de\u6536\u5b83\u3002 <code>WeakReference&lt;Widget&gt; weakWidget = new WeakReference&lt;Widget&gt;(widget);</code> \u7cfb\u7edf\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86WeakHashMap\uff0c\u548cHashMap\u7c7b\u4f3c\uff0c\u53ea\u662f\u5176key\u4f7f\u7528\u4e86weak reference\u3002\u5982\u679cWeakHashMap\u7684\u67d0\u4e2akey\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\uff0c\u90a3\u4e48entity\u4e5f\u4f1a\u81ea\u52a8\u88abremove\u3002</p> <p>\u7531\u4e8eWeakReference\u88abGC\u56de\u6536\u7684\u53ef\u80fd\u6027\u8f83\u5927\uff0c\u56e0\u6b64\uff0c\u5728\u4f7f\u7528\u5b83\u4e4b\u524d\uff0c\u4f60\u9700\u8981\u901a\u8fc7weakObj.get()\u53bb\u5224\u65ad\u76ee\u7684\u5bf9\u8c61\u5f15\u7528\u662f\u5426\u5df2\u7ecf\u88ab\u56de\u6536.</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#224-phantom-reference","title":"2.2.4 \u865a\u5f15\u7528\uff08Phantom reference\uff09","text":"<p>\u548csoft\uff0cweak Reference\u533a\u522b\u8f83\u5927\uff0c\u5b83\u7684get()\u65b9\u6cd5\u603b\u662f\u8fd4\u56denull\u3002\u8fd9\u610f\u5473\u7740\u4f60\u53ea\u80fd\u7528PhantomReference\u672c\u8eab\uff0c\u800c\u5f97\u4e0d\u5230\u5b83\u6307\u5411\u7684\u5bf9\u8c61\u3002\u5f53WeakReference\u6307\u5411\u7684\u5bf9\u8c61\u53d8\u5f97\u5f31\u53ef\u8fbe(weakly reachable\uff09\u65f6\u4f1a\u7acb\u5373\u88ab\u653e\u5230ReferenceQueue\u4e2d\uff0c\u8fd9\u5728finalization\u3001garbage collection\u4e4b\u524d\u53d1\u751f\u3002\u7406\u8bba\u4e0a\uff0c\u4f60\u53ef\u4ee5\u5728finalize()\u65b9\u6cd5\u4e2d\u4f7f\u5bf9\u8c61\u201c\u590d\u6d3b\u201d\uff08\u4f7f\u4e00\u4e2a\u5f3a\u5f15\u7528\u6307\u5411\u5b83\u5c31\u884c\u4e86\uff0cgc\u4e0d\u4f1a\u56de\u6536\u5b83\uff09\u3002\u4f46\u6ca1\u6cd5\u590d\u6d3bPhantomReference\u6307\u5411\u7684\u5bf9\u8c61\u3002\u800cPhantomReference\u662f\u5728garbage collection\u4e4b\u540e\u88ab\u653e\u5230ReferenceQueue\u4e2d\u7684\uff0c\u6ca1\u6cd5\u590d\u6d3b\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#3-mat","title":"3. MAT\u76f8\u5173\u6982\u5ff5","text":""},{"location":"perf-opt/Android/memory/MAT-Startup/#31-shallow-heap","title":"3.1 Shallow Heap","text":"<p>Shallow size\u5c31\u662f\u5bf9\u8c61\u672c\u8eab\u5360\u7528\u5806\u5185\u5b58\u7684\u5927\u5c0f\uff0c\u4e0d\u5305\u542b\u5176\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> <ul> <li>\u5e38\u89c4\u5bf9\u8c61\uff08\u975e\u6570\u7ec4\uff09\u7684Shallow size\u6709\u5176\u6210\u5458\u53d8\u91cf\u7684\u6570\u91cf\u548c\u7c7b\u578b\u51b3\u5b9a\u3002</li> <li>\u6570\u7ec4\u7684shallow size\u6709\u6570\u7ec4\u5143\u7d20\u7684\u7c7b\u578b\uff08\u5bf9\u8c61\u7c7b\u578b\u3001\u57fa\u672c\u7c7b\u578b\uff09\u548c\u6570\u7ec4\u957f\u5ea6\u51b3\u5b9a</li> </ul> <p>\u56e0\u4e3a\u4e0d\u50cfc++\u7684\u5bf9\u8c61\u672c\u8eab\u53ef\u4ee5\u5b58\u653e\u5927\u91cf\u5185\u5b58\uff0cjava\u7684\u5bf9\u8c61\u6210\u5458\u90fd\u662f\u4e9b\u5f15\u7528\u3002\u771f\u6b63\u7684\u5185\u5b58\u90fd\u5728\u5806\u4e0a\uff0c\u770b\u8d77\u6765\u662f\u4e00\u5806\u539f\u751f\u7684byte[], char[], int[]\uff0c\u6240\u4ee5\u6211\u4eec\u5982\u679c\u53ea\u770b\u5bf9\u8c61\u672c\u8eab\u7684\u5185\u5b58\uff0c\u90a3\u4e48\u6570\u91cf\u90fd\u5f88\u5c0f\u3002\u6240\u4ee5\u6211\u4eec\u770b\u5230Histogram\u56fe\u662f\u4ee5Shallow size\u8fdb\u884c\u6392\u5e8f\u7684\uff0c\u6392\u5728\u7b2c\u4e00\u4f4d\u7b2c\u4e8c\u4f4d\u7684\u662fbyte\uff0cchar \u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#32-retained-set","title":"3.2 Retained Set","text":"<p>\u4e00\u4e2a\u5bf9\u8c61\u7684 Retained Set\uff0c\u6307\u7684\u662f\u8be5\u5bf9\u8c61\u88ab GC \u56de\u6536\u540e\uff0c\u6240\u6709\u80fd\u88ab\u56de\u6536\u7684\u5bf9\u8c61\u96c6\u5408\uff08\u5982\u4e0b\u56fe\u6240\u793a\uff0cG\u7684 Retain Set \u53ea\u6709 G \u5e76\u4e0d\u5305\u542b H\uff0c\u539f\u56e0\u662f\u867d\u7136 H \u4e5f\u88ab G \u5f15\u7528\uff0c\u4f46\u7531\u4e8e H \u4e5f\u88ab F \u5f15\u7528 \uff0cG \u88ab\u5783\u573e\u56de\u6536\u65f6\u65e0\u6cd5\u91ca\u653e H\uff09\uff1b\u53e6\u5916\uff0c\u5f53\u8be5\u5bf9\u8c61\u65e0\u6cd5\u88ab GC \u56de\u6536\uff0c\u5219\u5176 Retained set \u4e5f\u5fc5\u7136\u65e0\u6cd5\u88ab GC \u56de\u6536\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#33-dominator-tree","title":"3.3 Dominator tree","text":"<p>\u5982\u679c\u6240\u6709\u6307\u5411\u5bf9\u8c61 Y \u7684\u8def\u5f84\u90fd\u7ecf\u8fc7\u5bf9\u8c61 X\uff0c\u5219 X \u652f\u914d\uff08dominate\uff09 Y\uff08\u5982\u4e0b\u56fe\u4e2d\uff0cC\u3001D \u5747\u652f\u914d F\uff0c\u4f46 G \u5e76\u4e0d\u652f\u914d H\uff09\u3002Dominator tree \u662f\u6839\u636e\u5bf9\u8c61\u5f15\u7528\u53ca\u652f\u914d\u5173\u7cfb\u751f\u6210\u7684\u6574\u4f53\u6811\u72b6\u56fe\uff0c\u652f\u914d\u6811\u6e05\u6670\u63cf\u8ff0\u4e86\u5bf9\u8c61\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u4e0b\u56fe\u5de6\u7684 Dominator tree \u5982\u4e0b\u56fe\u53f3\u4e0b\u65b9\u652f\u914d\u6811\u793a\u610f\u56fe\u6240\u793a\u3002\u652f\u914d\u5173\u7cfb\u8fd8\u6709\u5982\u4e0b\u5173\u7cfb\uff1a</p> <ul> <li>Dominator tree \u4e2d\u4efb\u4e00\u8282\u70b9\u7684\u5b50\u6811\u5c31\u662f\u88ab\u8be5\u8282\u70b9\u652f\u914d\u7684\u8282\u70b9\u96c6\u5408\uff0c\u4e5f\u5c31\u662f\u5176 Retain Set\u3002</li> <li>\u5982\u679c X \u76f4\u63a5\u652f\u914d Y\uff0c\u5219 X \u7684\u6240\u6709\u652f\u914d\u8282\u70b9\u5747\u652f\u914d Y\u3002</li> </ul> <p></p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#34-outgoing-references","title":"3.4 outgoing references","text":"<p>\u5bf9\u8c61\u5f15\u7528\u7684\u5916\u90e8\u5bf9\u8c61\uff08\u6ce8\u610f\u4e0d\u5305\u542b\u5bf9\u8c61\u7684\u57fa\u672c\u7c7b\u578b\u5c5e\u6027\u3002\u57fa\u672c\u5c5e\u6027\u5185\u5bb9\u53ef\u5728 inspector \u67e5\u770b\uff09</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#35-incoming-references","title":"3.5 incoming references","text":"<p>\u76f4\u63a5\u5f15\u7528\u4e86\u5f53\u524d\u5bf9\u8c61\u7684\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u7684 incoming references \u53ef\u80fd\u6709 0 \u5230\u591a\u4e2a\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#36-oqlobject-query-language","title":"3.6 OQL(Object Query Language)","text":"<p>OQL\u7684\u5168\u79f0\u662fObject Query Language\uff0c\u662f\u4e00\u95e8\u7528\u7c7bSQL\u8bed\u8a00\u67e5\u627e\u5185\u5b58\u955c\u50cf\u4e2d\u76ee\u6807\u5bf9\u8c61\u7684\u8bed\u8a00\uff0c\u662f\u4e00\u79cd\u9886\u57df\u4e13\u5c5e\u8bed\u8a00\uff08DSL\uff09\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#4-mat","title":"4. MAT \u89c6\u56fe","text":"<p>\u4f7f\u7528MAT\u6253\u5f00\u4e00\u4e2aheap dump\u6587\u4ef6\uff0c\u89e3\u6790\u5b8c\u6210\u540e\uff0c\u9ed8\u8ba4\u4f1a\u8fdb\u5165\u6b22\u8fce\u9875\uff0c\u6b22\u8fce\u9875\u91cc\u5305\u542b\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684\u5206\u6790\uff1a\u6700\u5927\u5185\u5b58\u5360\u7528\u5206\u6790\u3001\u5e38\u89c1\u7684\u5206\u6790\u52a8\u4f5c\u3001\u5e38\u7528\u7684\u5206\u6790\u62a5\u544a\u3001MAT\u4f7f\u7528\u6559\u7a0b\u7b49\u7b49\u3002</p> <p>\u6211\u4eec\u770b\u4e0b\u4e0b\u9762\u8fd9\u5f20\u56fe\uff0c\u53ef\u4ee5\u770b\u51faMAT\u7684\u4e3b\u8981\u7ed3\u6784\u548c\u529f\u80fd\uff1a</p> <p></p> <ol> <li>inspector\uff1a\u900f\u89c6\u56fe\uff0c\u7528\u4e8e\u5c55\u793a\u4e00\u4e2a\u5bf9\u8c61\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f8b\u5982\u5185\u5b58\u5730\u5740\u3001\u52a0\u8f7d\u5668\u540d\u79f0\u3001\u5305\u540d\u3001\u5bf9\u8c61\u540d\u79f0\u3001\u5bf9\u8c61\u6240\u5c5e\u7684\u7c7b\u7684\u7236\u7c7b\u3001\u5bf9\u8c61\u6240\u5c5e\u7684\u7c7b\u7684\u52a0\u8f7d\u5668\u5bf9\u8c61\u3001\u8be5\u5bf9\u8c61\u7684\u5806\u5185\u5b58\u5927\u5c0f\u548c\u4fdd\u7559\u5927\u5c0f\uff0cgc root\u4fe1\u606f\u3002</li> <li>inspector\u7a97\u53e3\u7684\u4e0b\u534a\u90e8\u5206\u662f\u5c55\u793a\u7c7b\u7684\u9759\u6001\u5c5e\u6027\u548c\u503c\u3001\u5bf9\u8c61\u7684\u5b9e\u4f8b\u5c5e\u6027\u548c\u503c\u3001\u5bf9\u8c61\u6240\u5c5e\u7684\u7c7b\u7684\u7ee7\u627f\u7ed3\u6784\u3002</li> <li>Heap Dump History\uff1a\u7528\u4e8e\u5217\u4e3e\u6700\u8fd1\u5206\u6790\u8fc7\u7684\u6587\u4ef6</li> <li>\u5e38\u7528\u529f\u80fd\u680f\uff0c\u4ece\u5de6\u5230\u53f3\u4f9d\u6b21\u662f\uff1a\u6982\u89c8\u3001Histogram\u3001Dominator Tree\u3001OQL\u67e5\u8be2\u3001\u7ebf\u7a0b\u89c6\u56fe\u3001\u62a5\u544a\u76f8\u5173\u3001\u8be6\u7ec6\u529f\u80fd\u3002\u5176\u4e2d\u6982\u89c8\u5c31\u662f\u5728\u521a\u89e3\u6790\u5b8c\u540e\u5c55\u793a\u7684\u8fd9\u4e2a\u9875\u9762\uff0c\u8be6\u7ec6\u529f\u80fd\u6309\u94ae\u5219\u662f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u66f4\u7ec6\u81f4\u7684\u5206\u6790\u80fd\u529b\u3002</li> <li>\u6982\u89c8\u4e2d\u7684\u997c\u56fe\uff1a\u8be5\u997c\u56fe\u7528\u4e8e\u5c55\u793aretained size\u6700\u5927\u7684\u5bf9\u8c61</li> <li>\u5e38\u7528\u7684\u5206\u6790\u52a8\u4f5c\uff1a\u7c7b\u76f4\u65b9\u56fe\u3001\u652f\u914d\u6811\u3001\u6309\u7167\u7c7b\u548c\u5305\u8def\u5f84\u83b7\u53d6\u6d88\u8017\u8d44\u6e90\u6700\u591a\u7684\u5bf9\u8c61\u3001\u91cd\u540d\u7c7b\u3002</li> <li>\u62a5\u544a\u76f8\u5173\uff1aLeak Suspects\u7528\u4e8e\u67e5\u627e\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\uff0c\u4ee5\u53ca\u7cfb\u7edf\u6982\u89c8</li> <li>Components Report\uff1a\u8fd9\u4e2a\u529f\u80fd\u662f\u4e00\u7ec4\u529f\u80fd\u7684\u96c6\u5408\uff0c\u7528\u4e8e\u5206\u6790\u67d0\u4e00\u7c7b\u6027\u7684\u7c7b\u7684\u5b9e\u4f8b\u7684\u95ee\u9898\uff0c\u4f8b\u5982\u5206\u6790<code>java.util.*</code>\u5f00\u5934\u7684\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u7684\u4e00\u4e9b\u4f7f\u7528\u60c5\u51b5\uff0c\u4f8b\u5982\uff1a\u91cd\u590d\u5b57\u7b26\u4e32\u3001\u7a7a\u96c6\u5408\u3001\u96c6\u5408\u7684\u4f7f\u7528\u7387\u3001\u8f6f\u5f15\u7528\u7684\u7edf\u8ba1\u3001finalizer\u7684\u7edf\u8ba1\u3001Map\u96c6\u5408\u7684\u78b0\u649e\u7387\u7b49\u7b49\u3002</li> </ol>"},{"location":"perf-opt/Android/memory/MAT-Startup/#41-histogram","title":"4.1 Histogram","text":"<p><code>Histogram</code>\u662f\u4ece\u7c7b\u7684\u89d2\u5ea6\u770b\u54ea\u4e9b\u7c7b\u53ca\u8be5\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u5360\u7528\u7740\u5185\u5b58\u60c5\u51b5\uff0c\u9ed8\u8ba4\u662f\u6309\u7167\u67d0\u4e2a\u7c7b\u7684shallow heap\u5927\u5c0f\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002</p> <p></p> <p>Retained Heap\u8fd9\u4e00\u5217\u7684\u503c\u662f\u7a7a\u7684\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u67d0\u4e2a\u7c7b\u7684\u6240\u6709\u5b9e\u4f8b\u8ba1\u7b97\u603b\u7684retained heap\u975e\u5e38\u6162\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u4f7f\u7528\u53f3\u952e\u83dc\u5355<code>Calculate Precise Retained Size</code>\u8ba1\u7b97\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#42-dominator-tree","title":"4.2 Dominator tree","text":"<p>Dominator tree\u5217\u51fa\u6700\u5927\u7684\u5bf9\u8c61\u4ee5\u53ca\u5176\u4f9d\u8d56\u5b58\u6d3b\u7684Object \uff08\u5927\u5c0f\u662f\u4ee5Retained Heap\u4e3a\u6807\u51c6\u6392\u5e8f\u7684\uff09\u3002</p> <p>Dominator tree\u53ef\u4ee5\u7528\u6765\u6392\u67e5\u662f\u54ea\u4e9b\u5bf9\u8c61\u5bfc\u81f4\u4e86\u5176\u4ed6\u5bf9\u8c61\u65e0\u6cd5\u88ab\u5783\u573e\u6536\u96c6\u5668\u56de\u6536\uff0c</p> <p></p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#43-path-to-gc-root","title":"4.3 Path to GC Root","text":"<p>\u5728Histogram\u6216\u8005Domiantor Tree\u7684\u67d0\u4e00\u4e2a\u6761\u76ee\u4e0a\uff0c\u53f3\u952e\u53ef\u4ee5\u67e5\u770b\u5176GC Root Path\uff1a</p> <p></p> <p>\u6211\u4eec\u4e00\u822c\u4f1a\u9009\u62e9<code>exclude all phantom/weak/soft etc.references</code>, \u610f\u601d\u662f\u67e5\u770b\u6392\u9664\u865a\u5f15\u7528/\u5f31\u5f15\u7528/\u8f6f\u5f15\u7528\u7b49\u7684\u5f15\u7528\u94fe\uff0c\u56e0\u4e3a\u88ab\u865a\u5f15\u7528/\u5f31\u5f15\u7528/\u8f6f\u5f15\u7528\u7684\u5bf9\u8c61\u53ef\u4ee5\u76f4\u63a5\u88abGC\u7ed9\u56de\u6536\uff0c\u6211\u4eec\u8981\u770b\u7684\u5c31\u662f\u67d0\u4e2a\u5bf9\u8c61\u5426\u8fd8\u5b58\u5728Strong \u5f15\u7528\u94fe\uff0c\u5982\u679c\u6709\uff0c\u5219\u8bf4\u660e\u5b58\u5728\u5185\u5b58\u6cc4\u6f0f\uff0c\u7136\u540e\u518d\u53bb\u6392\u67e5\u5177\u4f53\u5f15\u7528\u3002</p>"},{"location":"perf-opt/Android/memory/MAT-Startup/#5","title":"5.\u53c2\u8003","text":"<p>MAT \u4f7f\u7528\u5165\u95e8</p> <p>MAT \u5165\u95e8\u7bc7</p> <p>MAT\u8fdb\u9636\u4f7f\u7528</p>"},{"location":"perf-opt/Android/memory/Native-Hook/","title":"Native Hook","text":""},{"location":"perf-opt/Android/memory/Native-Hook/#1-hook","title":"1. \u4ec0\u4e48\u662fHOOK\uff1f","text":"<p>Hook \u76f4\u8bd1\u8fc7\u6765\u5c31\u662f\u201c\u94a9\u5b50\u201d\u7684\u610f\u601d\uff0c\u662f\u6307\u622a\u83b7\u8fdb\u7a0b\u5bf9\u67d0\u4e2a API \u51fd\u6570\u7684\u8c03\u7528\uff0c\u4f7f\u5f97 API \u7684\u6267\u884c\u6d41\u7a0b\u8f6c\u5411\u6211\u4eec\u5b9e\u73b0\u7684\u4ee3\u7801\u7247\u6bb5\uff0c\u4ece\u800c\u5b9e\u73b0\u6211\u4eec\u6240\u9700\u8981\u5f97\u529f\u80fd\uff0c\u8fd9\u91cc\u7684\u529f\u80fd\u53ef\u4ee5\u662f\u76d1\u63a7\u3001\u4fee\u590d\u7cfb\u7edf\u6f0f\u6d1e\uff0c\u4e5f\u53ef\u4ee5\u662f\u52ab\u6301\u6216\u8005\u5176\u4ed6\u6076\u610f\u884c\u4e3a\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#2-hook","title":"2. \u4e3a\u4ec0\u4e48\u8981HOOK\uff1f","text":"<p>Native Hook\u6280\u672f\u4e00\u76f4\u5728\u89e3\u51b3\u4e00\u4e9b\u7591\u96be\u95ee\u9898\u65f6\u7279\u522b\u6709\u6548\uff0c\u7531\u4e8e\u4e0d\u4ec5\u53ef\u4ee5\u4fee\u6539\u6211\u4eec\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u4fee\u6539\u7cfb\u7edf\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u7528\u5904\u975e\u5e38\u5e7f\u6cdb\uff0c\u5728\u6027\u80fd\u76d1\u63a7\u65b9\u9762\u53ef\u4ee5\u505a\u9501\u963b\u585e\uff0cIO \uff0cBinder call\uff0cfd\u6cc4\u6f0f\u7b49\u7684\u76d1\u63a7\uff0c\u5728\u7a33\u5b9a\u6027\u65b9\u9762\u53ef\u4ee5\u4fee\u590d\u7279\u6b8a\u673a\u578b\u6216\u8005\u7cfb\u7edf\u7684\u4e00\u4e9bnative bug\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#3-hook","title":"3. \u5982\u4f55HOOK\uff1f","text":"<p><code>Native Hook</code>\u6280\u672f\u53c8\u5206\u4e3a<code>GOT/PLT Hook</code>\uff0c<code>Inline Hook</code>\uff0c<code>Trap Hook</code> \u7b49\uff0c<code>GOT/PLT Hook</code>\u517c\u5bb9\u6027\u6bd4\u8f83\u597d\uff0c\u53ef\u4ee5\u8fbe\u5230\u4e0a\u7ebf\u6807\u51c6\uff0c\u4f46\u662f\u53ea\u80fdHook\u57fa\u4e8eGOT\u8868\u7684\u4e00\u4e9b\u51fd\u6570\uff0c<code>Inline Hook</code>\u80fdHook\u51e0\u4e4e\u6240\u6709\u51fd\u6570\uff0c\u4f46\u662f\u517c\u5bb9\u6027\u8f83\u5dee\uff0c\u4e0d\u80fd\u8fbe\u5230\u4e0a\u7ebf\u6807\u51c6\uff0c<code>Trap Hook</code>\u517c\u5bb9\u6027\u4e5f\u80fd\u8fbe\u5230\u4e0a\u7ebf\u6807\u51c6\u800c\u4e14Hook\u8303\u56f4\u6bd4Inline Hook\u8fd8\u5e7f\uff0c\u4f46\u662f\u7531\u4e8e\u5b83\u662f\u57fa\u4e8e\u4fe1\u53f7\u5904\u7406\u7684\uff0c\u6027\u80fd\u6bd4\u8f83\u5dee\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#31-gotplt-hook","title":"3.1 GOT/PLT Hook","text":"<p>GOT/PLT Hook \u4e3b\u8981\u662f\u7528\u4e8e\u66ff\u6362\u67d0\u4e2a SO \u7684\u5916\u90e8\u8c03\u7528\uff0c\u901a\u8fc7\u5c06\u5916\u90e8\u51fd\u6570\u8c03\u7528\u8df3\u8f6c\u6210\u6211\u4eec\u7684\u76ee\u6807\u51fd\u6570\u3002</p> <p>\u90a3 GOT/PLT Hook \u7684\u5b9e\u73b0\u539f\u7406\u7a76\u7adf\u662f\u4ec0\u4e48\u5462\uff1f\u4f60\u9700\u8981\u5148\u5bf9 SO \u5e93\u6587\u4ef6\u7684 ELF \u6587\u4ef6\u683c\u5f0f\u548c\u52a8\u6001\u94fe\u63a5\u8fc7\u7a0b\u6709\u6240\u4e86\u89e3\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#elf","title":"ELF \u683c\u5f0f","text":"<p>ELF\uff08Executableand Linking Format\uff09\u662f\u53ef\u6267\u884c\u548c\u94fe\u63a5\u683c\u5f0f\uff0c\u5b83\u662f\u4e00\u4e2a\u5f00\u653e\u6807\u51c6\uff0c\u5404\u79cd UNIX \u7cfb\u7edf\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5927\u591a\u91c7\u7528 ELF \u683c\u5f0f\u3002\u867d\u7136 ELF \u6587\u4ef6\u672c\u8eab\u5c31\u652f\u6301\u4e09\u79cd\u4e0d\u540c\u7684\u7c7b\u578b\uff08\u91cd\u5b9a\u4f4d\u3001\u6267\u884c\u3001\u5171\u4eab\uff09\uff0c\u4e0d\u540c\u7684\u89c6\u56fe\u4e0b\u683c\u5f0f\u7a0d\u5fae\u4e0d\u540c\uff0c\u4e0d\u8fc7\u5b83\u6709\u4e00\u4e2a\u7edf\u4e00\u7684\u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u6211\u4eec\u4e3b\u8981\u5173\u5fc3\u201c.plt\u201d\u548c\u201c.got\u201d\u8fd9\u4e24\u4e2a\u8282\u533a\uff1a</p> <ul> <li>.plt\u3002\u8be5\u8282\u4fdd\u5b58\u8fc7\u7a0b\u94fe\u63a5\u8868\uff08Procedure Linkage Table\uff09\u3002</li> <li>.got\u3002\u8be5\u8282\u4fdd\u5b58\u7740\u5168\u5c40\u7684\u504f\u79fb\u91cf\u8868\u3002</li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>readelf -S</code>\u6765\u67e5\u770b ELF \u6587\u4ef6\u7684\u5177\u4f53\u4fe1\u606f\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#_1","title":"\u94fe\u63a5\u8fc7\u7a0b","text":"<p>\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u6765\u770b\u770b\u52a8\u6001\u94fe\u63a5\u7684\u8fc7\u7a0b\uff0c\u5f53\u9700\u8981\u4f7f\u7528\u4e00\u4e2a Native \u5e93\uff08.so \u6587\u4ef6\uff09\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u8c03\u7528<code>dlopen(\"libname.so\")</code>\u6765\u52a0\u8f7d\u8fd9\u4e2a\u5e93\u3002</p> <p>\u5728\u6211\u4eec\u8c03\u7528\u4e86<code>dlopen(\"libname.so\")</code>\u4e4b\u540e\uff0c\u7cfb\u7edf\u9996\u5148\u4f1a\u68c0\u67e5\u7f13\u5b58\u4e2d\u5df2\u52a0\u8f7d\u7684 ELF \u6587\u4ef6\u5217\u8868\u3002\u5982\u679c\u672a\u52a0\u8f7d\u5219\u6267\u884c\u52a0\u8f7d\u8fc7\u7a0b\uff0c\u5982\u679c\u5df2\u52a0\u8f7d\u5219\u8ba1\u6570\u52a0\u4e00\uff0c\u5ffd\u7565\u8be5\u8c03\u7528\u3002\u7136\u540e\u7cfb\u7edf\u4f1a\u7528\u4ece <code>libname.so</code> \u7684<code>dynamic</code>\u8282\u533a\u4e2d\u8bfb\u53d6\u5176\u6240\u4f9d\u8d56\u7684\u5e93\uff0c\u6309\u7167\u76f8\u540c\u7684\u52a0\u8f7d\u903b\u8f91\uff0c\u628a\u672a\u5728\u7f13\u5b58\u4e2d\u7684\u5e93\u52a0\u5165\u52a0\u8f7d\u5217\u8868\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u6765\u67e5\u770b\u4e00\u4e2a\u5e93\u7684\u4f9d\u8d56\uff1a</p> <pre><code>readelf -d &lt;library&gt; | grep NEEDED\n</code></pre> <p>\u4e0b\u9762\u6211\u4eec\u5927\u6982\u4e86\u89e3\u4e00\u4e0b\u7cfb\u7edf\u662f\u5982\u4f55\u52a0\u8f7d\u7684 ELF \u6587\u4ef6\u7684\u3002</p> <ul> <li> <p>\u8bfb ELF \u7684\u7a0b\u5e8f\u5934\u90e8\u8868\uff0c\u628a\u6240\u6709 PT_LOAD \u7684\u8282\u533a mmap \u5230\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p>\u4ece\u201c.dynamic\u201d\u4e2d\u8bfb\u53d6\u5404\u4fe1\u606f\u9879\uff0c\u8ba1\u7b97\u5e76\u4fdd\u5b58\u6240\u6709\u8282\u533a\u7684\u865a\u62df\u5730\u5740\uff0c\u7136\u540e\u6267\u884c\u91cd\u5b9a\u4f4d\u64cd\u4f5c\u3002</p> </li> <li> <p>\u6700\u540e ELF \u52a0\u8f7d\u6210\u529f\uff0c\u5f15\u7528\u8ba1\u6570\u52a0\u4e00\u3002</p> </li> </ul> <p>\u4f46\u662f\u8fd9\u91cc\u6709\u4e00\u4e2a\u5173\u952e\u70b9\uff0c\u5728 ELF \u6587\u4ef6\u683c\u5f0f\u4e2d\u6211\u4eec\u53ea\u6709\u51fd\u6570\u7684\u7edd\u5bf9\u5730\u5740\u3002\u5982\u679c\u60f3\u5728\u7cfb\u7edf\u4e2d\u8fd0\u884c\uff0c\u8fd9\u91cc\u9700\u8981\u7ecf\u8fc7 \u91cd\u5b9a\u4f4d\u3002\u8fd9\u5176\u5b9e\u662f\u4e00\u4e2a\u6bd4\u8f83\u590d\u6742\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u4e0d\u540c\u673a\u5668\u7684 CPU \u67b6\u6784\u3001\u52a0\u8f7d\u987a\u5e8f\u4e0d\u540c\uff0c\u5bfc\u81f4\u6211\u4eec\u53ea\u80fd\u5728\u8fd0\u884c\u65f6\u8ba1\u7b97\u51fa\u8fd9\u4e2a\u503c\u3002\u4e0d\u8fc7\u8fd8\u597d\u52a8\u6001\u52a0\u8f7d\u5668\uff08<code>/system/bin/linker</code>\uff09\u4f1a\u5e2e\u52a9\u6211\u4eec\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u5982\u679c\u4f60\u7406\u89e3\u4e86\u52a8\u6001\u94fe\u63a5\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u518d\u56de\u5934\u6765\u601d\u8003\u4e00\u4e0b\u201c.got\u201d\u548c\u201c.plt\u201d\u5b83\u4eec\u7684\u5177\u4f53\u542b\u4e49\u3002</p> <ul> <li>The Global Offset Table (GOT)\u3002\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u5728\u6570\u636e\u6bb5\u7684\u5730\u5740\u8868\uff0c\u5047\u5b9a\u6211\u4eec\u6709\u4e00\u4e9b\u4ee3\u7801\u6bb5\u7684\u6307\u4ee4\u5f15\u7528\u4e00\u4e9b\u5730\u5740\u53d8\u91cf\uff0c\u7f16\u8bd1\u5668\u4f1a\u5f15\u7528 GOT \u8868\u6765\u66ff\u4ee3\u76f4\u63a5\u5f15\u7528\u7edd\u5bf9\u5730\u5740\uff0c\u56e0\u4e3a\u7edd\u5bf9\u5730\u5740\u5728\u7f16\u8bd1\u671f\u662f\u65e0\u6cd5\u77e5\u9053\u7684\uff0c\u53ea\u6709\u91cd\u5b9a\u4f4d\u540e\u624d\u4f1a\u5f97\u5230 \uff0cGOT \u81ea\u5df1\u672c\u8eab\u5c06\u4f1a\u5305\u542b\u51fd\u6570\u5f15\u7528\u7684\u7edd\u5bf9\u5730\u5740\u3002</li> <li>The Procedure Linkage Table (PLT)\u3002PLT \u4e0d\u540c\u4e8e GOT\uff0c\u5b83\u4f4d\u4e8e\u4ee3\u7801\u6bb5\uff0c\u52a8\u6001\u5e93\u7684\u6bcf\u4e00\u4e2a\u5916\u90e8\u51fd\u6570\u90fd\u4f1a\u5728 PLT \u4e2d\u6709\u4e00\u6761\u8bb0\u5f55\uff0c\u6bcf\u4e00\u6761 PLT \u8bb0\u5f55\u90fd\u662f\u4e00\u5c0f\u6bb5\u53ef\u6267\u884c\u4ee3\u7801\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u5916\u90e8\u4ee3\u7801\u90fd\u662f\u5728\u8c03\u7528 PLT \u8868\u91cc\u7684\u8bb0\u5f55\uff0c\u7136\u540e PLT \u7684\u76f8\u5e94\u8bb0\u5f55\u4f1a\u8d1f\u8d23\u8c03\u7528\u5b9e\u9645\u7684\u51fd\u6570\u3002\u6211\u4eec\u4e00\u822c\u628a\u8fd9\u79cd\u8bbe\u5b9a\u53eb\u4f5c\u201c\u8e66\u5e8a\u201d\uff08Trampoline\uff09\u3002</li> </ul> <p>PLT \u548c GOT \u8bb0\u5f55\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u5e76\u4e14 GOT \u8868\u7b2c\u4e00\u6b21\u89e3\u6790\u540e\u4f1a\u5305\u542b\u8c03\u7528\u51fd\u6570\u7684\u5b9e\u9645\u5730\u5740\u3002\u65e2\u7136\u8fd9\u6837\uff0c\u90a3 PLT \u7684\u610f\u4e49\u7a76\u7adf\u662f\u4ec0\u4e48\u5462\uff1fPLT \u4ece\u67d0\u79cd\u610f\u4e49\u4e0a\u8d4b\u4e88\u6211\u4eec\u4e00\u79cd\u61d2\u52a0\u8f7d\u7684\u80fd\u529b\u3002\u5f53\u52a8\u6001\u5e93\u9996\u6b21\u88ab\u52a0\u8f7d\u65f6\uff0c\u6240\u6709\u7684\u51fd\u6570\u5730\u5740\u5e76\u6ca1\u6709\u88ab\u89e3\u6790\u3002\u4e0b\u9762\u8ba9\u6211\u4eec\u7ed3\u5408\u56fe\u6765\u5177\u4f53\u5206\u6790\u4e00\u4e0b\u9996\u6b21\u51fd\u6570\u8c03\u7528\uff0c\u8bf7\u6ce8\u610f\u56fe\u4e2d\u9ed1\u8272\u7bad\u5934\u4e3a\u8df3\u8f6c\uff0c\u7d2b\u8272\u4e3a\u6307\u9488\u3002</p> <p></p> <ul> <li> <p>\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u8c03\u7528 func\uff0c\u7f16\u8bd1\u5668\u4f1a\u628a\u8fd9\u4e2a\u8f6c\u5316\u4e3a func@plt\uff0c\u5e76\u5728 PLT \u8868\u63d2\u5165\u4e00\u6761\u8bb0\u5f55</p> </li> <li> <p>PLT \u8868\u4e2d\u7b2c\u4e00\u6761\uff08\u6216\u8005\u8bf4\u7b2c 0 \u6761\uff09PLT[0]\u662f\u4e00\u6761\u7279\u6b8a\u8bb0\u5f55\uff0c\u5b83\u662f\u7528\u6765\u5e2e\u52a9\u6211\u4eec\u89e3\u6790\u5730\u5740\u7684\u3002\u901a\u5e38\u5728\u7c7b Linux \u7cfb\u7edf\uff0c\u8fd9\u4e2a\u7684\u5b9e\u73b0\u4f1a\u4f4d\u4e8e\u52a8\u6001\u52a0\u8f7d\u5668\uff0c\u5c31\u662f\u63d0\u5230\u7684 <code>/system/bin/linker</code></p> </li> <li> <p>\u5176\u4f59\u7684 PLT \u8bb0\u5f55\u90fd\u5747\u5305\u542b\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> </li> <li> <p>\u8df3\u8f6c GOT \u8868\u7684\u6307\u4ee4\uff08jmp *GOT[n]\uff09\u3002</p> </li> <li>\u4e3a\u4e0a\u9762\u63d0\u5230\u7684\u7b2c 0 \u6761\u89e3\u6790\u5730\u5740\u51fd\u6570\u51c6\u5907\u53c2\u6570\u3002</li> <li> <p>\u8c03\u7528 PLT[0]\uff0c\u8fd9\u91cc resovler \u7684\u5b9e\u9645\u5730\u5740\u662f\u5b58\u50a8\u5728 GOT[2] \u3002</p> </li> <li> <p>\u5728\u89e3\u6790\u524d GOT[n]\u4f1a\u76f4\u63a5\u6307\u5411 jmp *GOT[n]\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u3002\u5728\u89e3\u6790\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86 func \u7684\u5b9e\u9645\u5730\u5740\uff0c\u52a8\u6001\u52a0\u8f7d\u5668\u4f1a\u5c06\u8fd9\u4e2a\u5730\u5740\u586b\u5165 GOT[n]\uff0c\u7136\u540e\u8c03\u7528 func\u3002</p> </li> </ul> <p>\u5982\u679c\u5bf9\u4e0a\u9762\u7684\u8fd9\u4e2a\u8c03\u7528\u6d41\u7a0b\u8fd8\u6709\u7591\u95ee\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u300aGOT \u8868\u548c PLT \u8868\u300b\u8fd9\u7bc7\u6587\u7ae0\uff0c\u5b83\u91cc\u9762\u6709\u4e00\u5f20\u56fe\u975e\u5e38\u6e05\u6670\u3002</p> <p></p> <p>\u5f53\u7b2c\u4e00\u6b21\u8c03\u7528\u53d1\u751f\u540e\uff0c\u4e4b\u540e\u518d\u8c03\u7528\u51fd\u6570 func \u5c31\u9ad8\u6548\u7b80\u5355\u5f88\u591a\u3002\u9996\u5148\u8c03\u7528 PLT[n]\uff0c\u7136\u540e\u6267\u884c jmp *GOT[n]\u3002GOT[n]\u76f4\u63a5\u6307\u5411 func\uff0c\u8fd9\u6837\u5c31\u9ad8\u6548\u7684\u5b8c\u6210\u4e86\u51fd\u6570\u8c03\u7528\u3002</p> <p></p> <p>\u603b\u7ed3\u4e00\u4e0b\uff0c\u56e0\u4e3a\u5f88\u591a\u51fd\u6570\u53ef\u80fd\u5728\u7a0b\u5e8f\u6267\u884c\u5b8c\u65f6\u90fd\u4e0d\u4f1a\u88ab\u7528\u5230\uff0c\u6bd4\u5982\u9519\u8bef\u5904\u7406\u51fd\u6570\u6216\u4e00\u4e9b\u7528\u6237\u5f88\u5c11\u7528\u5230\u7684\u529f\u80fd\u6a21\u5757\u7b49\uff0c\u90a3\u4e48\u4e00\u5f00\u59cb\u628a\u6240\u6709\u51fd\u6570\u90fd\u94fe\u63a5\u597d\u5b9e\u9645\u5c31\u662f\u4e00\u79cd\u6d6a\u8d39\u3002\u4e3a\u4e86\u63d0\u5347\u52a8\u6001\u94fe\u63a5\u7684\u6027\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 PLT \u6765\u5b9e\u73b0\u5ef6\u8fdf\u7ed1\u5b9a\u7684\u529f\u80fd\u3002</p> <p>\u5bf9\u4e8e\u51fd\u6570\u8fd0\u884c\u7684\u5b9e\u9645\u5730\u5740\uff0c\u6211\u4eec\u4f9d\u7136\u9700\u8981\u901a\u8fc7 GOT \u8868\u5f97\u5230\uff0c\u6574\u4e2a\u7b80\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e86\u89e3PLT Hook\u7684\u539f\u7406\u540e\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5206\u6790\u51fa\u8fd9\u79cd\u6280\u672f\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u7531\u4e8e\u4fee\u6539\u7684\u662fGOT\u8868\u4e2d\u7684\u6570\u636e\uff0c\u56e0\u6b64\u4fee\u6539\u540e\uff0c\u6240\u6709\u5bf9\u8be5\u51fd\u6570\u8fdb\u884c\u8c03\u7528\u7684\u5730\u65b9\u5c31\u90fd\u4f1a\u88abHook\u5230\u3002\u8fd9\u4e2a\u6548\u679c\u7684\u5f71\u54cd\u8303\u56f4\u662f\u8be5PLT\u548cGOT\u6240\u5904\u7684\u6574\u4e2aso\u5e93\u3002\u56e0\u6b64\uff0c\u5f53\u76ee\u6807so\u5e93\u4e2d\u591a\u884c\u88ab\u6267\u884c\u4ee3\u7801\u90fd\u8c03\u7528\u4e86\u8be5PLT\u9879\u6240\u5bf9\u5e94\u7684\u51fd\u6570\uff0c\u90a3\u5b83\u4eec\u90fd\u4f1a\u53bb\u6267\u884cHook\u529f\u80fd\u3002</li> <li>PLT\u4e0eGOT\u8868\u4e2d\u4ec5\u4ec5\u5305\u542b\u672cELF\u9700\u8981\u8c03\u7528\u7684\u5171\u4eab\u5e93\u51fd\u6570\u9879\u76ee\uff0c\u56e0\u6b64\u4e0d\u5728PLT\u8868\u4e2d\u7684\u51fd\u6570\u65e0\u6cd5Hook\u5230\u3002</li> </ul> <p>\u90a3\u4e48\u8fd9\u4e9b\u7279\u70b9\u4f1a\u5bfc\u81f4\u4ec0\u4e48\u5462\uff1f</p> <ul> <li>\u53ef\u4ee5\u5927\u91cfHook\u90a3\u4e9b\u7cfb\u7edfAPI\uff0c\u4f46\u662f\u96be\u4ee5\u7cbe\u51c6Hook\u4f4f\u67d0\u6b21\u51fd\u6570\u8c03\u7528\u3002\u8fd9\u6bd4\u8f83\u9002\u7528\u4e8e\u5f00\u53d1\u8005\u5bf9\u4e8e\u81ea\u5bb6APP\u6027\u80fd\u76d1\u63a7\u7684\u9700\u6c42\u3002\u6bd4\u5982Hook\u4f4fmalloc\u4f7f\u5176\u8f93\u51fa\u53c2\u6570\uff0c\u8fd9\u6837\u5c31\u80fd\u5927\u91cf\u7edf\u8ba1\u8bc4\u4f30\u8be5APP\u5bf9\u4e8e\u5185\u5b58\u7684\u9700\u6c42\u3002\u4f46\u662f\u5bf9\u4e8e\u4e00\u4e9b\u5bf9Hook\u5bf9\u8c61\u6709\u4e00\u5b9a\u7cbe\u51c6\u5ea6\u8981\u6c42\u7684\u9700\u6c42\u6765\u8bf4\u5f88\u4e0d\u5229\uff0c\u6bd4\u5982\u8bf4\u662f\u5b89\u5168\u6d4b\u8bd5\u6216\u8005\u9006\u5411\u5206\u6790\u7684\u5de5\u4f5c\u9700\u6c42\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u4e2d\u5f80\u5f80\u9700\u8981\u5bf9\u4e8e\u76ee\u6807so\u4e2d\u7684\u67d0\u4e9b\u5173\u952e\u70b9\u6709\u51c6\u786e\u7684\u89c2\u5bdf\u3002</li> <li>\u5bf9\u4e8e\u4e00\u4e9bso\u5185\u90e8\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u65e0\u6cd5Hook\u5230\u3002\u56e0\u4e3a\u8fd9\u4e9b\u51fd\u6570\u4e0d\u5728PLT\u8868\u548cGOT\u8868\u91cc\u3002\u8fd9\u4e2a\u7f3a\u70b9\u5bf9\u4e8e\u4e0d\u5c11\u8f6f\u4ef6\u5206\u6790\u8005\u6765\u8bf4\u53ef\u80fd\u662f\u65e0\u6cd5\u5fcd\u53d7\u7684\u3002\u56e0\u4e3a\u8bb8\u591a\u5173\u952e\u6216\u6838\u5fc3\u7684\u4ee3\u7801\u903b\u8f91\u5f80\u5f80\u90fd\u662f\u81ea\u5b9a\u4e49\u7684\u3002\u4f8b\u5982NDK\u4e2d\u5b9e\u73b0\u7684\u4e00\u4e9b\u52a0\u5bc6\u5de5\u4f5c\uff0c\u5373\u4f7f\u4f7f\u7528\u4e86\u5171\u4eab\u5e93\u4e2d\u7684\u52a0\u5bc6\u51fd\u6570\uff0c\u4f46\u79d8\u94a5\u7684\u4fdd\u5b58\u7ba1\u7406\u7b49\u4f9d\u7136\u9700\u8981\u8fdb\u4e00\u6b65\u5206\u6790\uff0c\u800c\u8fd9\u4e9b\u5de5\u4f5c\u5bf9\u4e8e\u81ea\u5b9a\u4e49\u51fd\u6570\u751a\u81f3\u662f\u67d0\u884c\u6c47\u7f16\u4ee3\u7801\u7684\u76d1\u63a7\u80fd\u529b\u8981\u6c42\u662f\u8fdc\u8fdc\u8d85\u51faPLT Hook\u6240\u80fd\u63d0\u4f9b\u7684\u8303\u56f4\u3002</li> <li>\u5728\u56de\u8c03\u539f\u51fd\u6570\u65b9\u9762\uff0cPLT Hook\u5728hook\u76ee\u6807\u51fd\u6570\u65f6\uff0c\u5982\u679c\u9700\u8981\u56de\u8c03\u539f\u6765\u7684\u51fd\u6570\uff0c\u90a3\u5c31\u5728Hook\u540e\u7684\u529f\u80fd\u51fd\u6570\u4e2d\u76f4\u63a5\u8c03\u7528\u76ee\u6807\u51fd\u6570\u5373\u53ef\u3002\u53ef\u80fd\u6709\u70b9\u7ed5\uff0c\u8be6\u7ec6\u89e3\u91ca\u4e00\u4e0b\uff1a\u5047\u8bbe\u5bf9\u76ee\u6807\u51fd\u6570malloc()\u7684\u8c03\u7528\u57281.so\u4e2d\uff0c\u7528\u6237\u7528PLT Hook\u6280\u672f\u5f00\u53d1\u7684HookMalloc()\u529f\u80fd\u51fd\u6570\u57282.so\u4e2d\u3002\uff08\u56e0\u4e3a\u901a\u5e38\u60c5\u51b5\u4e0b\u76ee\u6807\u51fd\u6570\u4e0e\u7528\u6237\u7684\u81ea\u5b9a\u4e49Hook\u529f\u80fd\u51fd\u6570\u4e0d\u5728\u4e00\u4e2aELF\u6587\u4ef6\u91cc\uff09\u5f531.so\u4e2d\u8c03\u7528malloc()\u65f6\u4f1a\u53bb1.so\u7684PLT\u8868\u4e2d\u67e5\u8be2\uff0c\u7ed3\u679c\u662f\u6267\u884c\u6d41\u7a0b\u8fdb\u5165\u4e862.so\u4e2d\u7684HookMalloc()\u4e2d\u3002\u5982\u679c\u8fd9\u65f6\u5019HookMalloc\u4e2d\u5e0c\u671b\u8c03\u7528\u539f\u76ee\u6807\u51fd\u6570malloc()\uff0c\u90a3\u5c31\u76f4\u63a5\u8c03\u7528malloc()\u5c31\u597d\u4e86\u3002\u56e0\u4e3a\u8fd9\u91cc\u7684malloc\u4f1a\u53bb2.so\u4e2d\u7684PLT\u8868\u4e2d\u67e5\u8be2\uff0c\u4e0d\u53d71.so\u4e2d\u90a3\u4e2a\u88ab\u4fee\u6539\u8fc7\u7684PLT\u8868\u7684\u5f71\u54cd\u3002</li> </ul>"},{"location":"perf-opt/Android/memory/Native-Hook/#32-trap-hook","title":"3.2 Trap Hook","text":"<p>\u5bf9\u4e8e\u51fd\u6570\u5185\u90e8\u7684 Hook\uff0c\u4f60\u53ef\u4ee5\u5148\u4ece\u5934\u60f3\u4e00\u4e0b\uff0c\u4f1a\u53d1\u73b0\u8c03\u8bd5\u5668\u5c31\u5177\u5907\u4e00\u5207 Hook \u6846\u67b6\u5177\u6709\u7684\u80fd\u529b\uff0c\u53ef\u4ee5\u5728\u76ee\u6807\u51fd\u6570\u524d\u65ad\u4f4f\u7a0b\u5e8f\uff0c\u4fee\u6539\u5185\u5b58\u3001\u7a0b\u5e8f\u6bb5\uff0c\u7ee7\u7eed\u6267\u884c\u3002\u4e1a\u754c\u4e5f\u6709\u4e0d\u5c11\u4eba\u5c06 Trap Hook \u53eb\u4f5c\u65ad\u70b9 Hook\uff0c\u5b83\u7684\u539f\u7406\u5c31\u662f\u5728\u9700\u8981 Hook \u7684\u5730\u65b9\u60f3\u529e\u6cd5\u89e6\u53d1\u65ad\u70b9\uff0c\u5e76\u6355\u83b7\u5f02\u5e38\u3002\u4e00\u822c\u6211\u4eec\u4f1a\u5229\u7528 SIGTRAP \u6216\u8005 SIGKILL\uff08\u975e\u6cd5\u6307\u4ee4\u5f02\u5e38\uff09\u8fd9\u4e24\u79cd\u4fe1\u53f7\u3002\u4e0b\u9762\u4ee5 SIGTRAP \u4fe1\u53f7\u4e3a\u4f8b\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u6b65\u9aa4\u5982\u4e0b\u3002</p> <p></p> <ul> <li> <p>\u6ce8\u518c\u4fe1\u53f7\u63a5\u6536\u53e5\u67c4\uff08signal handler\uff09\uff0c\u4e0d\u540c\u7684\u4f53\u7cfb\u7ed3\u6784\u53ef\u80fd\u4f1a\u9009\u53d6\u4e0d\u540c\u7684\u4fe1\u53f7\uff0c\u6211\u4eec\u8fd9\u91cc\u7528 SIGTRAP\u3002</p> </li> <li> <p>\u5728\u6211\u4eec\u9700\u8981 Hook \u5f97\u90e8\u5206\u63d2\u5165 Trap \u6307\u4ee4\u3002</p> </li> <li> <p>\u7cfb\u7edf\u8c03\u7528 Trap \u6307\u4ee4\uff0c\u8fdb\u5165\u5185\u6838\u6a21\u5f0f\uff0c\u8c03\u7528\u6211\u4eec\u5df2\u7ecf\u5728\u5f00\u59cb\u6ce8\u518c\u597d\u7684\u4fe1\u53f7\u63a5\u6536\u53e5\u67c4\uff08signal handler\uff09\u3002</p> </li> <li> <p>\u6267\u884c\u6211\u4eec\u4fe1\u53f7\u63a5\u6536\u53e5\u67c4\uff08signal handler\uff09\uff0c\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c\u6240\u6709\u5728\u4fe1\u53f7\u63a5\u6536\u53e5\u67c4\uff08signal handler\uff09\u6267\u884c\u7684\u4ee3\u7801\u9700\u8981\u4fdd\u8bc1async-signal-safe\u3002\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u53ea\u628a\u4fe1\u53f7\u63a5\u6536\u53e5\u67c4\u5f53\u4f5c\u8e66\u5e8a\uff0c\u4f7f\u7528 logjmp \u8df3\u51fa\u8fd9\u4e2a\u9700\u8981 async-signal-safe\uff08\u6b63\u5982\u6211\u5728\u201c\u5d29\u6e83\u5206\u6790\u201d\u6240\u8bf4\u7684\uff0c\u90e8\u5206\u51fd\u6570\u5728 signal \u56de\u8c03\u4e2d\u4f7f\u7528\u5e76\u4e0d\u5b89\u5168\uff09\u7684\u73af\u5883\uff0c\u7136\u540e\u518d\u6267\u884c\u6211\u4eec Hook \u7684\u4ee3\u7801\u3002</p> </li> <li> <p>\u5728\u6267\u884c\u5b8c Hook \u7684\u51fd\u6570\u540e\uff0c\u6211\u4eec\u9700\u8981\u6062\u590d\u73b0\u573a\u3002\u8fd9\u91cc\u5982\u679c\u6211\u4eec\u60f3\u7ee7\u7eed\u8c03\u7528\u539f\u6765\u7684\u51fd\u6570 A\uff0c\u90a3\u76f4\u63a5\u56de\u5199\u51fd\u6570 A \u7684\u539f\u59cb\u6307\u4ee4\u5e76\u6062\u590d\u5bc4\u5b58\u5668\u72b6\u6001\u3002</p> </li> </ul> <p>Trap Hook \u517c\u5bb9\u6027\u975e\u5e38\u597d\uff0c\u5b83\u4e5f\u53ef\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5927\u89c4\u6a21\u4f7f\u7528\u3002\u4f46\u662f\u5b83\u6700\u5927\u7684\u95ee\u9898\u662f\u6548\u7387\u6bd4\u8f83\u4f4e\uff0c\u4e0d\u9002\u5408 Hook \u975e\u5e38\u9891\u7e41\u8c03\u7528\u7684\u51fd\u6570\u3002Facebook \u7684Profilo\u5c31\u662f\u901a\u8fc7\u5b9a\u671f\u53d1\u9001 SIGPROF \u4fe1\u53f7\u6765\u5b9e\u73b0\u5361\u987f\u76d1\u63a7\u7684\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#33-inline-hook","title":"3.3 Inline Hook","text":"<p>\u8ddf Trap Hook \u4e00\u6837\uff0cInline Hook \u4e5f\u662f\u51fd\u6570\u5185\u90e8\u8c03\u7528\u7684 Hook\u3002\u5b83\u76f4\u63a5\u5c06\u51fd\u6570\u5f00\u59cb\uff08Prologue\uff09\u5904\u7684\u6307\u4ee4\u66f4\u66ff\u4e3a\u8df3\u8f6c\u6307\u4ee4\uff0c\u4f7f\u5f97\u539f\u51fd\u6570\u76f4\u63a5\u8df3\u8f6c\u5230 Hook \u7684\u76ee\u6807\u51fd\u6570\u51fd\u6570\uff0c\u5e76\u4fdd\u7559\u539f\u51fd\u6570\u7684\u8c03\u7528\u63a5\u53e3\u4ee5\u5b8c\u6210\u540e\u7eed\u518d\u8c03\u7528\u56de\u6765\u7684\u76ee\u7684\u3002</p> <p>\u539f\u7406\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u8fd9\u5f20\u56fe\u662f\u4e00\u5f20arm\u4e0b\u6700\u57fa\u672c\u7684hook\u6d41\u7a0b\uff0c\u4ece\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\u4e3b\u8981\u6709\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u5728\u60f3\u8981Hook\u7684\u76ee\u6807\u4ee3\u7801\u5904\u5907\u4efd\u4e0b\u9762\u7684\u51e0\u6761\u6307\u4ee4\uff0c\u7136\u540e\u63d2\u5165\u8df3\u8f6c\u6307\u4ee4\uff0c\u628a\u7a0b\u5e8f\u6d41\u7a0b\u8f6c\u79fb\u5230\u4e00\u4e2astub\u6bb5\u4e0a\u53bb\u3002</li> <li>\u5728stub\u4ee3\u7801\u6bb5\u4e0a\u5148\u628a\u6240\u6709\u5bc4\u5b58\u5668\u7684\u72b6\u6001\u4fdd\u5b58\u597d\uff0c\u5e76\u8c03\u7528\u7528\u6237\u81ea\u5b9a\u4e49\u7684Hook\u529f\u80fd\u51fd\u6570\uff0c\u7136\u540e\u628a\u6240\u6709\u5bc4\u5b58\u5668\u7684\u72b6\u6001\u6062\u590d\u5e76\u8df3\u8f6c\u5230\u5907\u4efd\u4ee3\u7801\u5904\u3002</li> <li>\u5728\u5907\u4efd\u4ee3\u7801\u5904\u628a\u5f53\u521d\u5907\u4efd\u7684\u90a3\u51e0\u6761\u6307\u4ee4\u90fd\u6267\u884c\u4e00\u4e0b\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u5f53\u521d\u5907\u4efd\u4ee3\u7801\u4f4d\u7f6e\u7684\u4e0b\u9762\u63a5\u7740\u6267\u884c\u7a0b\u5e8f\u3002</li> </ul> <p>\u7531\u6b64\u53ef\u4ee5\u770b\u51fa\u4f7f\u7528Inline Hook\u6709\u5982\u4e0b\u7684Hook\u6548\u679c\u7279\u70b9\uff1a</p> <ul> <li>\u5b8c\u5168\u4e0d\u53d7\u51fd\u6570\u662f\u5426\u5728PLT\u8868\u4e2d\u7684\u9650\u5236\uff0c\u76f4\u63a5\u5728\u76ee\u6807so\u4e2d\u7684\u4efb\u610f\u4ee3\u7801\u4f4d\u7f6e\u90fd\u53ef\u8fdb\u884cHook\u3002\u8fd9\u4e2aHook\u7cbe\u51c6\u5ea6\u662f\u6c47\u7f16\u6307\u4ee4\u7ea7\u7684\u3002\u8fd9\u5bf9\u4e8e\u9006\u5411\u5206\u6790\u4eba\u5458\u548c\u5b89\u5168\u6d4b\u8bd5\u4eba\u5458\u6765\u8bf4\u662f\u4e2a\u975e\u5e38\u597d\u7684\u7279\u6027\uff01</li> <li>\u53ef\u4ee5\u4ecb\u5165\u4efb\u610f\u51fd\u6570\u7684\u64cd\u4f5c\u3002\u7531\u4e8e\u6c47\u7f16\u6307\u4ee4\u7ea7\u7684Hook\u7cbe\u5ea6\uff0c\u4ee5\u53ca\u4e0d\u53d7PLT\u8868\u7684\u9650\u5236\uff0cInline Hook\u6280\u672f\u53ef\u4ee5\u53bb\u51fd\u6570\u6267\u884c\u4e2d\u7684\u4efb\u610f\u4ee3\u7801\u884c\u95f4\u8fdb\u884cHook\u529f\u80fd\u64cd\u4f5c\uff0c\u4ece\u800c\u8bfb\u53d6\u6216\u4fee\u6539\u4efb\u610f\u5bc4\u5b58\u5668\uff0c\u4f7f\u5f97\u51fd\u6570\u7684\u64cd\u4f5c\u6d41\u7a0b\u5b8c\u5168\u53ef\u4ee5\u88ab\u63a7\u5236\u3002</li> <li>\u5bf9Hook\u529f\u80fd\u51fd\u6570\u7684\u9650\u5236\u8f83\u5c0f\u3002\u7531\u4e8e\u5728\u7b2c\u4e8c\u6b65\u8c03\u7528Hook\u529f\u80fd\u51fd\u6570\u524d\u5df2\u7ecf\u628a\u6240\u6709\u4e4b\u524d\u7684\u5bc4\u5b58\u5668\u72b6\u6001\u90fd\u8fdb\u884c\u4fdd\u5b58\u4e86\uff0c\u56e0\u6b64\u6b64\u65f6\u7684Hook\u529f\u80fd\u51fd\u6570\u51e0\u4e4e\u5c31\u662f\u4e2a\u72ec\u7acb\u7684\u51fd\u6570\uff0c\u5b83\u65e0\u9700\u53d7\u9650\u4e8e\u539f\u672c\u76ee\u6807\u51fd\u6570\u7684\u53c2\u6570\u5f62\u5f0f\uff0c\u5b8c\u5168\u90fd\u7531\u81ea\u5df1\u8bf4\u4e86\u7b97\u3002\u5e76\u4e14\u6267\u884c\u5b8c\u540e\u4e5f\u5b8c\u5168\u662f\u4e00\u4e2a\u6b63\u5e38\u7684\u51fd\u6570\u9000\u51fa\u5f62\u5f0f\u91ca\u653e\u6808\u7a7a\u95f4\u3002</li> <li>\u5bf9\u4e8ePLT Hook\u7684\u5f3a\u5236\u6279\u91cfHook\u7684\u7279\u6027\uff0cInline Hook\u8981\u7075\u6d3b\u8bb8\u591a\u3002\u5f53\u60f3\u8981\u8fdb\u884c\u6279\u91cfHook\u4e00\u4e9b\u7cfb\u7edfAPI\u65f6\u4e5f\u53ef\u4ee5\u76f4\u63a5\u53bb\u627e\u5185\u5b58\u91cc\u5bf9\u5e94\u7684\u5982libc.so\u8fd9\u4e9b\u5e93\uff0c\u5bf9\u5b83\u4eec\u4e2d\u7684API\u8fdb\u884cHook\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u6240\u6709\u5bf9\u8fd9\u4e2aAPI\u7684\u8c03\u7528\u4e5f\u5c31\u90fd\u88ab\u6279\u91cfHook\u4e86\u3002</li> </ul> <p>\u4e0e GOT/PLT Hook \u76f8\u6bd4\uff0cInline Hook \u53ef\u4ee5\u4e0d\u53d7 GOT/PLT \u8868\u7684\u9650\u5236\uff0c\u51e0\u4e4e\u53ef\u4ee5 Hook \u4efb\u4f55\u51fd\u6570\u3002\u4e0d\u8fc7\u5176\u5b9e\u73b0\u5341\u5206\u590d\u6742\uff0c\u6211\u81f3\u4eca\u6ca1\u6709\u89c1\u8fc7\u53ef\u4ee5\u7528\u5728\u751f\u4ea7\u73af\u5883\u7684\u5b9e\u73b0\u3002\u5e76\u4e14\u5728 ARM \u4f53\u7cfb\u7ed3\u6784\u4e0b\uff0c\u65e0\u6cd5\u5bf9\u53f6\u5b50\u51fd\u6570\u548c\u5f88\u77ed\u7684\u51fd\u6570\u8fdb\u884c Hook\u3002</p> <p>\u5982\u679c\u53ea\u5bf9\u4e8e\u7cfb\u7edf\u8c03\u7528\u6709\u53c2\u6570\u6216\u8005\u6027\u80fd\u4e0a\u7684\u76d1\u63a7\u9700\u6c42\uff0c\u90a3\u53ef\u4ee5\u8003\u8651\u91c7\u7528PLT Hook\u6280\u672f\u8def\u7ebf\u3002\u4e00\u822c\u9002\u5408APP\u7684\u5b98\u65b9\u5458\u5de5\u3002 \u800c\u5982\u679c\u662f\u5e0c\u671b\u5e94\u5bf9\u5404\u79cd\u5404\u6837APP\u81ea\u5df1\u72ec\u6709\u7684NDK\u51fd\u6570\u6216\u8005\u4ee3\u7801\u6bb5\u7684\u8bdd\uff0c\u76ee\u524d\u53ea\u80fd\u9009\u62e9Inline Hook\u3002\u9002\u5408APP\u9006\u5411\u4eba\u5458\uff0c\u8f6f\u4ef6\u5206\u6790\u4eba\u5458\uff0cCTF Android\u9006\u5411\u89e3\u9898\u7b49\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#34","title":"3.4 \u5404\u4e2a\u6d41\u6d3e\u7684\u4f18\u7f3a\u70b9\u6bd4\u8f83","text":"<ol> <li>GOT/PLT Hook \u662f\u4e00\u4e2a\u6bd4\u8f83\u4e2d\u5eb8\u7684\u65b9\u6848\uff0c\u6709\u8f83\u597d\u7684\u6027\u80fd\uff0c\u4e2d\u7b49\u7684\u5b9e\u73b0\u96be\u5ea6\uff0c\u4f46\u5176\u53ea\u80fd Hook \u52a8\u6001\u5e93\u4e4b\u95f4\u7684\u8c03\u7528\u7684\u51fd\u6570\uff0c\u5e76\u4e14\u65e0\u6cd5 Hook \u672a\u5bfc\u51fa\u7684\u79c1\u6709\u51fd\u6570\uff0c\u800c\u4e14\u53ea\u5b58\u5728\u5b89\u88c5\u4e0e\u5378\u8f7d 2 \u79cd\u72b6\u6001\uff0c\u4e00\u65e6\u5b89\u88c5\u5c31\u4f1a Hook \u6240\u6709\u51fd\u6570\u8c03\u7528\u3002</li> <li>Trap Hook \u6700\u4e3a\u7a33\u5b9a\uff0c\u4f46\u7531\u4e8e\u9700\u8981\u5207\u6362\u8fd0\u884c\u6a21\u5f0f\uff08R0/R3\uff09\uff0c\u4e14\u4f9d\u8d56\u5185\u6838\u7684\u4fe1\u53f7\u673a\u5236\uff0c\u5bfc\u81f4\u6027\u80fd\u5f88\u5dee\u3002</li> <li>Inline Hook \u662f\u4e00\u4e2a\u975e\u5e38\u6fc0\u8fdb\u7684\u65b9\u6848\uff0c\u6709\u5f88\u597d\u7684\u6027\u80fd\uff0c\u5e76\u4e14\u4e5f\u6ca1\u6709 PLT \u4f5c\u7528\u57df\u7684\u9650\u5236\uff0c\u53ef\u4ee5\u8bf4\u662f\u4e00\u4e2a\u975e\u5e38\u7075\u6d3b\u3001\u5b8c\u7f8e\u7684\u65b9\u6848\u3002\u4f46\u5176\u5b9e\u73b0\u96be\u5ea6\u6781\u9ad8\uff0c\u6211\u81f3\u4eca\u4e5f\u6ca1\u6709\u770b\u5230\u53ef\u4ee5\u90e8\u7f72\u5728\u751f\u4ea7\u73af\u5883\u7684 Inline Hook \u65b9\u6848\uff0c\u56e0\u4e3a\u6d89\u53ca\u6307\u4ee4\u4fee\u590d\uff0c\u9700\u8981\u7f16\u8bd1\u5668\u7684\u5404\u79cd\u4f18\u5316\u3002</li> </ol> \u7c92\u5ea6 \u5b9e\u73b0\u96be\u5ea6 \u6027\u80fd \u4f5c\u7528\u57df \u7a33\u5b9a\u6027 GOT/PLT Hook \u51fd\u6570 \u4e2d \u9ad8 \u4f4e\uff08GOT/PLT\u8868\uff09 \u9ad8 Trap Hook \u6307\u4ee4 \u4e2d \u4f4e \u9ad8 \u9ad8 Inline Hook \u6307\u4ee4 \u9ad8 \u9ad8 \u9ad8 \u4f4e(\u5b9e\u73b0\u96be\u5ea6\u8fc7\u5927) <p>\u53ef\u4ee5\u770b\u51fa\u4e09\u79cd\u65b9\u6848\u90fd\u662f\u5404\u6709\u4f18\u7f3a\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u9009\u62e9\u5408\u9002\u7684Hook\u65b9\u6848\uff0c\u53d1\u6325\u4ed6\u4eec\u7684\u957f\u5904\uff0c\u76ee\u524d\u6765\u8bf4\u57fa\u4e8e\u517c\u5bb9\u6027\u548c\u6027\u80fd\u4e24\u65b9\u9762\u8003\u8651\uff0cGOT/PLT Hook\u901a\u5e38\u662f\u6211\u4eec\u7ebf\u4e0a\u9879\u76ee\u7684\u6700\u4f18\u9009\u62e9\u3002</p> <p>\u4f46\u662f\u9700\u8981\u6ce8\u610f\uff0c\u65e0\u8bba\u662f\u54ea\u4e00\u79cd Hook \u90fd\u53ea\u80fd Hook \u5230\u5e94\u7528\u81ea\u8eab\u7684\u8fdb\u7a0b\uff0c\u6211\u4eec\u65e0\u6cd5\u66ff\u6362\u7cfb\u7edf\u6216\u5176\u4ed6\u5e94\u7528\u8fdb\u7a0b\u7684\u51fd\u6570\u6267\u884c\u3002</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#4-plt-hook","title":"4. PLT Hook \u5b9e\u8df5","text":"<p>GOT/PLT Hook \u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u5b9e\u73b0\u8d77\u6765\u4e5f\u662f\u6709\u4e00\u4e9b\u5751\u7684\uff0c\u9700\u8981\u8003\u8651\u517c\u5bb9\u6027\u7684\u60c5\u51b5\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u63a8\u8350\u4f7f\u7528\u4e1a\u754c\u7684\u6210\u719f\u65b9\u6848\u3002</p> <ul> <li> <p>\u7231\u5947\u827a\u5f00\u6e90\u7684\u7684xHook\uff0c\u5b83\u4f7f\u7528\u7684\u4e5f\u662f GOT Hook\u3002</p> </li> <li> <p>Facebook \u7684PLT Hook\u3002</p> </li> <li> <p>\u5b57\u8282\u5f00\u6e90\u7684bhook, \u548cxHook\u662f\u540c\u4e00\u4e2a\u4f5c\u8005\uff0c\u4f30\u8ba1\u662f\u8df3\u69fd\u5230\u4e86\u5b57\u8282</p> </li> </ul> <p>\u603b\u7ed3\u4e00\u4e0b xhook \u4e2d\u6267\u884c PLT hook \u7684\u6d41\u7a0b\uff1a</p> <ol> <li>\u8bfb maps\uff0c\u83b7\u53d6 ELF \u7684\u5185\u5b58\u9996\u5730\u5740\uff08start address\uff09\u3002</li> <li>\u9a8c\u8bc1 ELF \u5934\u4fe1\u606f\u3002</li> <li>\u4ece PHT \u4e2d\u627e\u5230\u7c7b\u578b\u4e3a <code>PT_LOAD</code> \u4e14 offset \u4e3a <code>0</code> \u7684 segment\u3002\u8ba1\u7b97 ELF \u57fa\u5730\u5740\u3002</li> <li>\u4ece PHT \u4e2d\u627e\u5230\u7c7b\u578b\u4e3a <code>PT_DYNAMIC</code> \u7684 segment\uff0c\u4ece\u4e2d\u83b7\u53d6\u5230 <code>.dynamic</code> section\uff0c\u4ece <code>.dynamic</code> section\u4e2d\u83b7\u53d6\u5176\u4ed6\u5404\u9879 section \u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\u3002</li> <li>\u5728 <code>.dynstr</code> section \u4e2d\u627e\u5230\u9700\u8981 hook \u7684 symbol \u5bf9\u5e94\u7684 index \u503c\u3002</li> <li>\u904d\u5386\u6240\u6709\u7684 <code>.relxxx</code> section\uff08\u91cd\u5b9a\u4f4d section\uff09\uff0c\u67e5\u627e symbol index \u548c symbol type \u90fd\u5339\u914d\u7684\u9879\uff0c\u5bf9\u4e8e\u8fd9\u9879\u91cd\u5b9a\u4f4d\u9879\uff0c\u6267\u884c hook \u64cd\u4f5c\u3002hook \u6d41\u7a0b\u5982\u4e0b\uff1a</li> <li>\u8bfb maps\uff0c\u786e\u8ba4\u5f53\u524d hook \u5730\u5740\u7684\u5185\u5b58\u8bbf\u95ee\u6743\u9650\u3002</li> <li>\u5982\u679c\u6743\u9650\u4e0d\u662f\u53ef\u8bfb\u4e5f\u53ef\u5199\uff0c\u5219\u7528 <code>mprotect</code> \u4fee\u6539\u8bbf\u95ee\u6743\u9650\u4e3a\u53ef\u8bfb\u4e5f\u53ef\u5199\u3002</li> <li>\u5982\u679c\u8c03\u7528\u65b9\u9700\u8981\uff0c\u5c31\u4fdd\u7559 hook \u5730\u5740\u5f53\u524d\u7684\u503c\uff0c\u7528\u4e8e\u8fd4\u56de\u3002</li> <li>\u5c06 hook \u5730\u5740\u7684\u503c\u66ff\u6362\u4e3a\u65b0\u7684\u503c\u3002\uff08\u6267\u884c hook\uff09</li> <li>\u5982\u679c\u4e4b\u524d\u7528 <code>mprotect</code> \u4fee\u6539\u8fc7\u5185\u5b58\u8bbf\u95ee\u6743\u9650\uff0c\u73b0\u5728\u8fd8\u539f\u5230\u4e4b\u524d\u7684\u6743\u9650\u3002</li> <li>\u6e05\u9664 hook \u5730\u5740\u6240\u5728\u5185\u5b58\u9875\u7684\u5904\u7406\u5668\u6307\u4ee4\u7f13\u5b58\u3002</li> </ol> <p>\u5982\u679c\u4e0d\u60f3\u6df1\u5165\u5b83\u5185\u90e8\u7684\u539f\u7406\uff0c\u6211\u4eec\u53ea\u9700\u8981\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u5f00\u6e90\u7684\u4f18\u79c0\u65b9\u6848\u5c31\u53ef\u4ee5\u4e86, \u5177\u4f53PLT Hook \u5b9e\u8df5\u53c2\u89c1Android Native Hook</p>"},{"location":"perf-opt/Android/memory/Native-Hook/#_2","title":"\u53c2\u8003","text":"<p>Native Hook \u6280\u672f\uff0c\u5929\u4f7f\u8fd8\u662f\u9b54\u9b3c\uff1f</p> <p>Android Native Hook</p>"},{"location":"perf-opt/Android/memory/android-memory-gov/","title":"Android \u5185\u5b58\u7efc\u5408\u6cbb\u7406","text":""},{"location":"perf-opt/Android/memory/android-memory-gov/#1","title":"1. \u5185\u5b58\u57fa\u7840\u76d1\u63a7","text":""},{"location":"perf-opt/Android/memory/android-memory-gov/#11","title":"1.1 \u7b80\u4ecb","text":"<p>\u5185\u5b58\u57fa\u7840\u76d1\u63a7\u4e3b\u8981\u8d1f\u8d23\u5bf9\u5ba2\u6237\u7aef\u7684\u6574\u4f53\u5185\u5b58\u72b6\u6001\u8fdb\u884c\u76d1\u63a7\uff0c\u501f\u52a9\u7ebf\u4e0a\u6d77\u91cf\u7528\u6237\u7684\u590d\u6742\u6848\u4f8b\u6765\u5e2e\u52a9\u6211\u4eec\u53d1\u73b0\u5728\u5f00\u53d1\u53ca\u6d4b\u8bd5\u9636\u6bb5\u96be\u4ee5\u53d1\u73b0\u7684\u95ee\u9898\uff0c\u540c\u65f6\u4e5f\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u5bf9\u5ba2\u6237\u7aef\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u8fdb\u884c\u5206\u6790\uff0c\u4ece\u800c\u5e2e\u52a9\u6211\u4eec\u4f18\u5316\u5ba2\u6237\u7aef\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u76d1\u63a7\u6a21\u5757\u4e3b\u8981\u5b9e\u73b0\u5bf9<code>\u865a\u62df\u5185\u5b58</code>\u3001<code>Java\u5806</code>\u3001<code>FD\u6570\u91cf</code>\u3001<code>\u7ebf\u7a0b\u6570\u91cf</code>\u3001<code>PSS</code>\u3001<code>Native Heap</code>\u7684\u76d1\u63a7\uff0c\u6839\u636e\u7cfb\u7edf\u9650\u5236\u6216\u8bbe\u7f6e\u56fa\u5b9a\u6570\u503c\uff0c\u5b9a\u671f\u67e5\u770b\u5176\u72b6\u6001\uff0c\u540c\u65f6\u6211\u4eec\u628a\u9875\u9762\u8df3\u8f6c\u65f6\u8bb0\u5f55\u7684\u5185\u5b58\u6570\u636e\u8bb0\u5f55\u5728\u94fe\u8def\u4e2d\u8fdb\u884c\u4e0a\u62a5\uff0c\u4ece\u800c\u7edf\u8ba1\u51fa\u5e94\u7528\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5404\u4e2a\u4e1a\u52a1\u573a\u666f\u7684\u5185\u5b58\u72b6\u6001\u3002</p>"},{"location":"perf-opt/Android/memory/android-memory-gov/#12","title":"1.2. \u6838\u5fc3\u6e90\u7801","text":"<pre><code>// FD\u6570\u91cf,\u8017\u65f6\u4e00\u822c\nfun getFds(): Int {\nlastFDCount = 0\nrunCatching {\nif (appFdFile == null) {\nappFdFile = File(\"/proc/self/fd\")\n}\nappFdFile?.listFiles { _, name -&gt; TextUtils.isDigitsOnly(name) }\n?.size ?: 0\n}.getOrDefault(0).also { lastFDCount = it }\nreturn lastFDCount\n}\n/**\n * Get Threads.\n * \u8017\u65f6\u4e00\u822c\n */\nfun getProcessStatus(): ProcessStatus {\nval processStatus = ProcessStatus()\nrunCatching {\nif (appStatusFile == null) {\nappStatusFile = File(\"/proc/self/status\")\n}\nappStatusFile?.useLines {\nit.forEach { line -&gt;\nwhen {\nline.startsWith(\"VmSize\") -&gt; processStatus.vssKbSize = VSS_REGEX.matchValue(line)\nline.startsWith(\"VmRSS\") -&gt; processStatus.rssKbSize = RSS_REGEX.matchValue(line)\nline.startsWith(\"Threads\") -&gt;\nprocessStatus.threadsCount = THREADS_REGEX.matchValue(line)\n}\n}\n}\n}\nlastProcessStatus = processStatus\nreturn processStatus\n}\n/**\n *  \u83b7\u53d6\u5185\u5b58\u4fe1\u606f \u6bd4\u8f83\u8017\u65f6\n */\nfun getProcessMemoryInfo(): ProcessMemInfo {\nval memInfo = ProcessMemInfo()\nrunCatching {\nval mi = Debug.MemoryInfo()\nDebug.getMemoryInfo(mi)\nif (Build.VERSION.SDK_INT &gt;= 23) {\nmemInfo.javaHeapInKb = mi.getMemoryStat(\"summary.java-heap\").toLong()\nmemInfo.nativeHeapInKb = mi.getMemoryStat(\"summary.native-heap\").toLong()\nmemInfo.code = mi.getMemoryStat(\"summary.code\").toLong()\nmemInfo.stack = mi.getMemoryStat(\"summary.stack\").toLong()\nmemInfo.graphics = mi.getMemoryStat(\"summary.graphics\").toLong()\nmemInfo.system = mi.getMemoryStat(\"summary.system\").toLong()\nmemInfo.totalPssInKb = mi.getMemoryStat(\"summary.total-pss\").toLong()\nmemInfo.totalSwap = mi.getMemoryStat(\"summary.total-swap\").toLong()\n} else {\nmemInfo.javaHeapInKb = mi.dalvikPrivateDirty.toLong()\nmemInfo.nativeHeapInKb = mi.nativePrivateDirty.toLong()\n//            val otherPrivateDirty = mi.otherPrivateDirty\nmemInfo.system = if (Build.VERSION.SDK_INT &gt;= 19) {\nmi.totalPss - mi.totalPrivateDirty - mi.totalPrivateClean\n} else {\nmi.totalPss - mi.totalPrivateDirty\n}.toLong()\nmemInfo.totalPssInKb = mi.totalPss.toLong()\n}\n}\nlastProcessMemInfo = memInfo\nreturn lastProcessMemInfo\n}\n</code></pre>"},{"location":"perf-opt/Android/memory/android-memory-gov/#2","title":"2. \u56fe\u7247\u68c0\u6d4b&amp;\u76d1\u63a7","text":""},{"location":"perf-opt/Android/memory/android-memory-gov/#21","title":"2.1. \u7b80\u4ecb","text":"<p>\u5047\u8bbe\u5c4f\u5e55\u5206\u8fa8\u7387 <code>1080x1920</code>\uff0c\u4e00\u5f20 Bitmap \u5360\u6ee1\u5c4f\u5e55\u65f6\u5185\u5b58\u5927\u5c0f\u662f<code>1080x1920x4</code>\uff0c\u5927\u7ea6 8MB\u3002\u6240\u4ee5\u4e00\u4e2a\u4e0d\u8d77\u773c\u7684 Bitmap \u5360\u7528\u7684\u5185\u5b58\u4e5f\u8fdc\u8fdc\u5927\u4e8e\u591a\u6570\u5bf9\u8c61\u3002\u53ef\u89c1\uff0c\u5982\u679c\u5e94\u7528\u5185\u6709\u8bb8\u591a\u4e0d\u5408\u7406\u7684\u56fe\u7247\uff0c\u5c31\u4f1a\u62c9\u9ad8\u5185\u5b58\u6c34\u4f4d\u3002\u5982\u4e0b\u56fe\uff0c \u76ee\u524d88%\u4ee5\u4e0a\u7684\u7528\u6237\u7684\u624b\u673a\u662f8.0\u53ca\u66f4\u9ad8\u7cfb\u7edf\u7248\u672c\uff0c\u5b83\u7684\u5185\u5b58\u7533\u8bf7\u662f\u5728Native\u5c42\u7684\u3002\u56e0\u6b64\uff0c\u56fe\u7247\u5185\u5b58\u7684\u5206\u6790\u91cd\u70b9\u653e\u57288.0\u4ee5\u53ca\u66f4\u9ad8\u7684\u7cfb\u7edf\u7248\u672c\u4e0a\u3002 </p> <p>\u4eceBitmap: \u4ece\u51fa\u751f\u5230\u6b7b\u4ea1 \u53ef\u4ee5\u77e5\u9053\uff0c </p> <p>\u65e0\u8bba\u54ea\u79cdBitmap\u521b\u5efa\u65b9\u5f0f\uff0c\u6700\u7ec8\u6b8a\u9014\u540c\u5f52\u3002\u90fd\u4f1a\u901a\u8fc7<code>Bitmap.cpp</code>\u4e2d\u7684<code>Bitmap::createBitmap</code>\u65b9\u6cd5\u521b\u5efaBitmap\u5bf9\u8c61\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ea\u9700\u8981hook\u8fd9\u4e2a<code>createBitmap</code>\u51fd\u6570\uff0c\u5c31\u80fd\u591f\u62ff\u5230\u6bcf\u6b21\u56fe\u7247\u521b\u5efa\u65f6\u7684bitmap\u7684Java\u5bf9\u8c61\u3002\u901a\u8fc7\u8be5\u5bf9\u8c61\uff0c\u53ef\u4ee5\u83b7\u5f97<code>\u56fe\u7247\u7684\u5c3a\u5bf8\u5927\u5c0f</code>\u3001<code>\u5185\u5b58\u5360\u7528\u5927\u5c0f</code>\uff0c<code>\u5806\u6808</code>\u7b49\u4fe1\u606f\uff0c\u5c06\u8fd9\u4e9b\u4fe1\u606f\u4e0a\u62a5\u5230\u6027\u80fd\u5e73\u53f0\u4e5f\u5c31\u8fbe\u5230\u4e86\u68c0\u6d4b\u4e0e\u76d1\u63a7\u56fe\u7247\u521b\u5efa\u7684\u76ee\u6807\u3002</p> <p>\u8fd9\u91cchook\u7684\u65b9\u6848\u91c7\u7528\u7231\u5947\u827a\u5f00\u6e90\u7684<code>plt-hook</code>\u5f00\u6e90\u65b9\u6848xHook\u6765\u5b8c\u6210\u3002\u5173\u4e8e<code>plt-hook</code>\u5177\u4f53\u539f\u7406\u89c1Native-Hook\u3002</p> <p>\u90a3\u600e\u4e48\u67e5\u627e\u5230\u8fd9\u4e2a\u51fd\u6570\u5462\uff1f</p> <p>\u9996\u5148\u9700\u8981\u901a\u8fc7 <code>adb pull system/lib/libandroid_runtime.so</code> \u62ff\u5230\u7cfb\u7edf\u7684so\u6587\u4ef6\uff0c\u7136\u540e\u901a\u8fc7<code>arm-linux-androideabi-nm -D libandroid_runtime.so | grep bitmap</code> \uff0c\u53ef\u4ee5\u67e5\u627e\u5230\u5bf9\u5e94\u7684\u51fd\u6570\u540d\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8981hook\u7684\u51fd\u6570\uff0c\u7cfb\u7edf\u7248\u672c\u4e0d\u540c\u53ef\u80fd\u4f1a\u6709\u5dee\u5f02\uff0c\u6ce8\u610f\u517c\u5bb9\u3002</p> <p></p>"},{"location":"perf-opt/Android/memory/android-memory-gov/#22","title":"2.2. \u5b9e\u73b0","text":"<p>\u6838\u5fc3\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>  jobject (*old_create_bitmap_fun)(JNIEnv *env, void *bitmap,\nint bitmapCreateFlags, jbyteArray ninePatchChunk,\njobject ninePatchInsets,\nint density);\nvoid Hooker::InitHook() {\nbool hooked = false;\nxhook_clear();\nint result = xhook_register(hook_lib,\nGetCreateBitmapSymbol(),\nreinterpret_cast&lt;void *&gt;(HookBitmapCreate),\nreinterpret_cast&lt;void **&gt;(&amp;old_create_bitmap_fun));\nresult != 0 ? hooked = false : hooked = true;\nif (hooked) {\nint result = xhook_refresh(0);\n}\n}\nconst char *Hooker::GetCreateBitmapSymbol() {\nif (android_api &gt;= __ANDROID_API_O__) {\nreturn \"_ZN7android6bitmap12createBitmapEP7_JNIEnvPNS_6BitmapEiP11_jbyteArrayP8_jobjecti\";\n} else if (android_api &gt;= __ANDROID_API_M__) {\nreturn \"_ZN11GraphicsJNI12createBitmapEP7_JNIEnvPN7android6BitmapEiP11_jbyteArrayP8_jobjecti\";\n} else if (android_api &gt;= __ANDROID_API_L__) {\nreturn \"_ZN11GraphicsJNI12createBitmapEP7_JNIEnvP8SkBitmapP11_jbyteArrayiS5_P8_jobjecti\";\n} else if (android_api &gt;= __ANDROID_API_K__) {\nreturn \"_ZN11GraphicsJNI12createBitmapEP7_JNIEnvP8SkBitmapP11_jbyteArrayiS5_P10_jintArrayi\";\n} else {\nbitmapProfiler::Log::error(TAG, \"SDK :%d not support\", android_api);\nreturn \"_ZN7android6bitmap12createBitmapEP7_JNIEnvPNS_6BitmapEiP11_jbyteArrayP8_jobjecti\";\n}\n}\njobject Hooker::HookBitmapCreate(JNIEnv *env, void *bitmap, int bitmapCreateFlags,\njbyteArray ninePatchChunk, jobject ninePatchInsets,\nint density) {\njobject obj = old_create_bitmap_fun(env, bitmap, bitmapCreateFlags,\nninePatchChunk, ninePatchInsets, density);\nif (hookEnabled()) {\n...\n// \u8fd9\u91cc\u628ahook\u5230\u7684bitmap\u4f20\u9012\u5230java\u5c42\u5904\u7406\n}\nreturn obj;\n}\n</code></pre> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u77e5\u7ecf\u8fc7app\u521b\u5efa\u7684\u6240\u6709Bitmap\u7684\u5185\u5b58\u5927\u5c0f\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u66f4\u8fdb\u4e00\u6b65\uff0c\u83b7\u53d6\u56fe\u7247\u6240\u5728view\u7684\u5bbd\u9ad8\uff0c\u6709\u65f6\u7531\u4e8e\u4e00\u4e9b\u9519\u8bef\u5904\u7406\uff0c\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u5f88\u5c0f\u7684view\u91cc\u9762\u627f\u8f7d\u4e86\u4e00\u4e2a\u5185\u5b58\u5bbd\u9ad8\u6bd4\u5b83\u672c\u8eab\u5bbd\u9ad8\u5927\u5f97\u591a\u7684\u56fe\u7247\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u89e3\u7801\u56fe\u7247\u65f6\u6309\u7167\u5185\u5b58\u5bbd\u9ad8\u6765\u89e3\u7801\u5c31\u5f88\u6d6a\u8d39\u4e86\uff1b</p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u83b7\u53d6\u56fe\u7247\u6587\u4ef6\u5927\u5c0f\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b57\u8282\u7801\u63d2\u6869\u6280\u672f\u6765\u5b9e\u73b0\u3002</p> <p>\u4ee5hook <code>Okhttp</code>\u548c<code>Glide</code>\u4e3a\u4f8b\uff0c\u6838\u5fc3\u6e90\u7801\u5982\u4e0b:</p> <p>ASM \u76f8\u5173\u4ee3\u7801 <pre><code>public class ImageProfilerClassVisitor extends BaseClassVisitor {\n...\n@Override\npublic MethodVisitor visitMethod(int access, String methodName, String desc, String signature, String[] exceptions) {\nMethodVisitor mv = cv.visitMethod(access, methodName, desc, signature, exceptions);\nif(mClassName.equals(\"com/bumptech/glide/request/SingleRequest\") &amp;&amp; (methodName.equals(\"&lt;init&gt;\") || methodName.equals( \"init\")) &amp;&amp; desc!=null){\nreturn mv == null ? null : new GlideMethodAdapter(mv,access,methodName,desc);\n}\nif(mClassName.equals(\"okhttp3/OkHttpClient$Builder\") &amp;&amp; methodName.equals(\"&lt;init&gt;\") &amp;&amp; desc.equals(\"()V\")){\nreturn mv == null ? null : new OkHttpMethodAdapter(mv,access,methodName,desc);\n}\nreturn mv;\n}\n}\npublic class OkHttpMethodAdapter extends AdviceAdapter {\n...\n@Override\nprotected void onMethodExit(int opcode) {\nsuper.onMethodExit(opcode);\n//\u6dfb\u52a0\u5e94\u7528\u62e6\u622a\u5668\nmv.visitVarInsn(ALOAD, 0);\nmv.visitFieldInsn(GETFIELD, \"okhttp3/OkHttpClient$Builder\", \"interceptors\", \"Ljava/util/List;\");\nmv.visitMethodInsn(INVOKESTATIC, \"[pageageName]/instrument/image/ImageTracer\", \"getInstance\", \"()L[pageageName]/instrument/image/ImageTracer;\", false);\nmv.visitMethodInsn(INVOKEVIRTUAL, \"[pageageName]/instrument/image/ImageTracer\", \"getOkHttpInterceptors\", \"()Ljava/util/List;\", false);\nmv.visitMethodInsn(INVOKEINTERFACE, \"java/util/List\", \"addAll\", \"(Ljava/util/Collection;)Z\", true);\nmv.visitInsn(POP);\n}\n}\npublic class GlideMethodAdapter extends AdviceAdapter {\n...\n@Override\nprotected void onMethodExit(int opcode) {\nsuper.onMethodExit(opcode);\nmv.visitVarInsn(ALOAD, 0);\nmv.visitMethodInsn(INVOKESTATIC, \"[pageageName]/instrument/image/aop/glide/GlideHook\", \"proxy\", \"(Ljava/lang/Object;)V\", false);\n}\n}\n</code></pre></p> <p>\u4ee3\u7406\u5b9e\u73b0</p> <pre><code>public class ImageInterceptor implements Interceptor {\n@Override\npublic Response intercept(Chain chain) throws IOException {\n//\u53d1\u51fa\u8bf7\u6c42\u65f6\u4e0d\u62e6\u622a\nRequest request = chain.request();\nResponse response = chain.proceed(request);\n//\u62e6\u622a\u54cd\u5e94\nString header = response.header(\"Content-Type\");\n//\u5982\u679c\u662f\u56fe\u7247\u7c7b\u578b\u5219\u62e6\u622a\ntry {\nif(isImage(header) &amp;&amp; ImageMonitorManager.INSTANCE.getInstalled()){\nprocess(response);\n}\n} catch (Throwable e) {\ne.printStackTrace();\n}\nreturn response;\n}\nprivate void process(Response response){\nString header = response.header(\"Content-Length\");\n...\n//\u83b7\u53d6\u56fe\u7247\u5927\u5c0f\nImageDataManager.INSTANCE.saveImageSizeInfo(response.request().url().toString(), Integer.parseInt(header));\n}\n...\n}\npublic class GlideHook  {\npublic static void proxy(Object singleRequest) {\ntry {\n...\nrequestListeners.add(new GlideImageListener());\n...\n}\n}\npublic class GlideImageListener&lt;R&gt; implements RequestListener&lt;R&gt; {\n@Override\npublic boolean onResourceReady(R resource, Object model, Target&lt;R&gt; target, DataSource dataSource, boolean isFirstResource) {\nif(target instanceof CustomViewTarget || target instanceof ViewTarget){\nView view;\nif (target instanceof ViewTarget){\nview = ((ViewTarget) target).getView();\n}else {\nview = ((CustomViewTarget) target).getView();\n}\ntarget.getSize(new SizeReadyCallback() {\n@Override\npublic void onSizeReady(int width, int height) {\nif (resource == null)return;\n// \u83b7\u53d6view\u7684\u5bbd\u9ad8\nImageDataManager.INSTANCE.saveImageInfo(resource,theadName,width,height,\"Glide\",callStack,view,model.toString());\n}\n});\n}\nreturn false;\n}\n}\n</code></pre> <p>\u5bf9\u4e8e\u901a\u8fc7\u56fe\u7247\u63a7\u4ef6\u65b9\u6cd5\u76f4\u63a5\u8bbe\u7f6e\u56fe\u7247\u7684\u60c5\u51b5\uff0c\u5982<code>setImageDrawable</code>\uff0c<code>setImageBitmap</code>\u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7hook\u63a7\u4ef6\u7684\u76f8\u5173\u65b9\u6cd5\u6765\u5b9e\u73b0\u3002\u8fd9\u91cc\u8981\u6c42\u9879\u76ee\u6700\u597d\u6709\u4e00\u5957\u81ea\u5df1\u7684\u63a7\u4ef6\u7cfb\u7edf\uff0c\u8fd9\u6837\u53ef\u4ee5\u65b9\u4fbf\u7edf\u4e00\u5904\u7406\u3002</p>"},{"location":"perf-opt/Android/memory/android-memory-gov/#23","title":"2.3. \u5c0f\u7ed3","text":"<p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u80fd\u5f97\u5230\u5e94\u7528\u521b\u5efa\u7684<code>Bitmap\u7684\u5185\u5b58\u5927\u5c0f</code>\uff0c<code>\u52a0\u8f7d\u7684view\u7684\u5927\u5c0f</code>\u3001<code>\u56fe\u7247\u6587\u4ef6\u5927\u5c0f</code>\u7b49\u4fe1\u606f\uff0c\u901a\u8fc7\u8fd9\u4e9b\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u56fe\u7247\u8fdb\u884c\u4f18\u5316\uff0c\u6bd4\u5982\uff1a</p> <ol> <li>\u662f\u5426\u5b58\u5728\u8fc7\u5927\u5185\u5b58\u7684\u56fe\u7247     \u5728\u6e05\u6670\u5ea6\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u9002\u5f53\u7684\u7f29\u5c0f\u539f\u59cb\u539f\u56fe, \u8b6c\u5982\u4e00\u4e9b\u78e8\u7802\u6a21\u7cca\u56fe\u7247</li> <li>\u662f\u5426\u5b58\u5728Bitmap\u7684\u5185\u5b58\u5bbd\u9ad8\u8fdc\u5927\u4e8eview\u5927\u5c0f\u7684\u60c5\u51b5     \u8b6c\u5982\uff0cGlide\u662f\u6839\u636e\u63a7\u4ef6\u5927\u5c0f\u6765\u4e3a transform \u81ea\u52a8\u8ba1\u7b97\u51fa\u5177\u4f53\u7684 width \u548c height\u3002\u5bf9\u4e8e\u5bbd\u9ad8\u4e3a wrap_content \u7684\u63a7\u4ef6\uff0c\u81ea\u52a8\u8ba1\u7b97\u51fa\u7684\u7ed3\u679c\u662f\u5f53\u524d\u5c4f\u5e55\u5927\u5c0f\uff0c\u6240\u4ee5\u4f7f\u7528Glide\u52a0\u8f7d\u7684\u65f6\u5019\uff0c\u63a7\u4ef6\u5e03\u5c40\u5c3d\u91cf\u8bbe\u7f6e\u5bbd\u9ad8\uff0c\u907f\u514d\u51fa\u73b0\u8fc7\u5927\u7684\u56fe\u7247</li> <li>\u662f\u5426\u5b58\u5728\u8fc7\u5927\u7684\u56fe\u7247\u6587\u4ef6    \u53ef\u4ee5\u76f4\u63a5\u4ece\u4e91\u7aef\u83b7\u53d6\u6307\u5b9a\u5bbd\u9ad8\u7684\u56fe\u7247 </li> <li>\u662f\u5426\u5b58\u5728\u91cd\u590dBitmap     \u53ef\u4ee5\u8003\u8651\u590d\u7528</li> <li>Bitmap\u662f\u5426\u5b58\u5728\u5185\u5b58\u6cc4\u6f0f\uff0c\u662f\u5426\u6b63\u5e38\u56de\u6536     \u8b6c\u5982 <code>bitmap\u62f7\u8d1d\u884c\u4e3a\uff0c\u901a\u8fc7\u6e90bitmap\u5bf9\u8c61\u83b7\u5f97\u53d8\u6362\u540e\u7684bitmap\u5bf9\u8c61\uff0c\u8fd9\u91cc\u9700\u8981\u8003\u8651\u6e90bitmap\u662f\u5426\u53ef\u4ee5\u7acb\u5373\u91ca\u653e\u3002</code></li> </ol> <p>\u6211\u4eec\u53ef\u4ee5\u505a\u6210\u4e00\u4e2a\u5de5\u5177\uff0c\u65b9\u4fbf\u67e5\u770b\u5b9a\u4f4d\u95ee\u9898\uff0c\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u540c\u65f6\uff0c\u4e0a\u62a5\u6027\u80fd\u76d1\u63a7\u5e73\u53f0\u6570\u636e\uff0c\u53ef\u4ee5\u505a\u7248\u672c\u6570\u636e\u5bf9\u6bd4\u4ee5\u53ca\u4e00\u952e\u63d0bug</p> <p>\u5173\u4e8e\u4e0a\u9762\u63d0\u5230\u8bbe\u7f6e\u4e3awrap_content\u5bfc\u81f4Glide\u52a0\u8f7d\u56fe\u7247\u5185\u5b58\u8fc7\u5927\u95ee\u9898\u6e90\u7801</p> <pre><code># ViewTarget.java\nvoid getSize(@NonNull SizeReadyCallback cb) {\nint currentWidth = this.getTargetWidth();\nint currentHeight = this.getTargetHeight();\n...\n}\nprivate int getTargetWidth() {\n...\nreturn this.getTargetDimen(this.view.getWidth(), layoutParamSize, horizontalPadding);\n}\nprivate int getTargetDimen(int viewSize, int paramSize, int paddingSize) {\nint adjustedParamSize = paramSize - paddingSize;\nif (adjustedParamSize &gt; 0) {\nreturn adjustedParamSize;\n} else if (this.waitForLayout &amp;&amp; this.view.isLayoutRequested()) {\nreturn 0;\n} else {\nint adjustedViewSize = viewSize - paddingSize;\nif (adjustedViewSize &gt; 0) {\nreturn adjustedViewSize;\n} else if (!this.view.isLayoutRequested() &amp;&amp; paramSize == -2) {\nif (Log.isLoggable(\"ViewTarget\", 4)) {\nLog.i(\"ViewTarget\", \"Glide treats LayoutParams.WRAP_CONTENT as a request for an image the size of this device's screen dimensions. If you want to load the original image and are ok with the corresponding memory cost and OOMs (depending on the input size), use override(Target.SIZE_ORIGINAL). Otherwise, use LayoutParams.MATCH_PARENT, set layout_width and layout_height to fixed dimension, or use .override() with fixed dimensions.\");\n}\n// \u5f53\u8bbe\u7f6eLayoutParams.WRAP_CONTENT\u4f1a\u8d70\u8fdb\u8fd9\u91cc\uff0c\u8fd9\u91cc\u4f1a\u8fd4\u56de\u5f53\u524d\u5c4f\u5e55\u7684\u5bbd\u9ad8\uff0c\u4e0a\u9762log\u4e5f\u6709\u660e\u786e\u63d0\u793a\nreturn getMaxDisplayLength(this.view.getContext());\n} else {\nreturn 0;\n}\n}\n}\n</code></pre>"},{"location":"perf-opt/Android/memory/android-memory-gov/#3","title":"3. \u5185\u5b58\u6cc4\u9732","text":""},{"location":"perf-opt/Android/memory/android-memory-gov/#31-java","title":"3.1. Java\u5185\u5b58\u6cc4\u9732","text":"<p>\u8fd9\u4e00\u90e8\u5206\u7684\u5b9e\u73b0\u4e3b\u8981\u91c7\u7528\u4e86\u5feb\u624bKOOM\u7684\u65b9\u6848\uff0c\u5229\u7528\u7cfb\u7edf<code>Copy On Write</code>\u7684\u7279\u6027\uff0cfork\u5b50\u8fdb\u7a0b\u540e\u8fdb\u884cdump\uff0c\u907f\u514d\u4e86\u8fdb\u7a0b\u7684\u51bb\u7ed3\uff0c\u540e\u7eed\u7684\u9875\u9762\u6cc4\u6f0f\u5206\u6790\u4e5f\u4f1a\u5728\u72ec\u7acb\u7684Service\u4e2d\u6267\u884c\uff0c\u5c3d\u91cf\u964d\u4f4e\u5bf9\u4e3b\u8fdb\u7a0b\u7684\u5f71\u54cd\u3002</p> <p>\u5bf9\u4e8e\u7ebf\u4e0b\u68c0\u67e5\uff0c\u4e0d\u9700\u8981\u8fc7\u4e8e\u8003\u8651\u6027\u80fd\u5f71\u54cd\uff0c\u6211\u4eec\u57fa\u4e8e\u201c\u5e94\u68c0\u5c3d\u68c0\u201d\u539f\u5219\uff0c\u4e3b\u52a8\u51fa\u51fb\uff0c\u53d1\u73b0\u4e00\u4f8b\u68c0\u67e5\u4e00\u4f8b\uff0c\u5c3d\u53ef\u4ee5\u8986\u76d6\u5404\u79cd\u573a\u666f\u548c\u60c5\u51b5\u3002</p> <p>\u57fa\u4e8e LeakCanary\u57fa\u672c\u539f\u7406\uff08\u5bf9\u8c61\u9500\u6bc1\u65f6\u52a0\u5165\u5f31\u5f15\u7528\u961f\u5217\uff0c\u7136\u540e\u68c0\u6d4b\u76ee\u6807\u662f\u5426\u88ab\u56de\u6536\uff09 \u4ee5\u53ca<code>KOOM</code>\u6211\u4eec\u5728\u7ebf\u4e0b\u8bbe\u8ba1\u4e86\u4e00\u5957\u81ea\u52a8\u5206\u6790\u4e0a\u62a5\u5185\u5b58\u6cc4\u9732\u7684\u5de5\u5177\uff0c\u4e3b\u8981\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u7ebf\u4e0a\u68c0\u67e5\uff0c\u9700\u8981\u4f18\u5148\u8003\u8651\u6027\u80fd\u5f71\u54cd\uff0c\u6211\u4eec\u57fa\u4e8e\u201c\u613f\u68c0\u5c3d\u68c0\u201d\u539f\u5219\uff0c\u7b49\u5f85\u91cd\u8981\u5371\u9669\u6761\u4ef6\u89e6\u53d1\u624d\u53bb\u68c0\u67e5\u548c\u955c\u50cf\u91c7\u96c6\uff0c\u5c3d\u91cf\u4e0d\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u4e3b\u8981\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"perf-opt/Android/memory/android-memory-gov/#_1","title":"\u539f\u7406","text":"<p>\u955c\u50cf\u91c7\u96c6</p> <p>\u955c\u50cf\u91c7\u96c6\u91c7\u7528\u865a\u62df\u673a<code>supend-&gt;fork\u865a\u62df\u673a\u8fdb\u7a0b-&gt;\u865a\u62df\u673aresume-&gt;dump\u5185\u5b58</code>\u955c\u50cf\u7684\u7b56\u7565\uff0c\u5c06\u4f20\u7edfDump\u51bb\u7ed3\u8fdb\u7a0b20s\u7684\u65f6\u95f4\u7f29\u51cf\u81f320ms\u4ee5\u5185\u3002</p> <p></p> <p><pre><code>  ...\n...\n// \u865a\u62df\u673asuspend\uff0c\u7136\u540efork\nint pid = suspendAndFork();\nif (pid == 0) {\n// Child process\n// \u5b50\u8fdb\u7a0bdump heap\nDebug.dumpHprofData(path);\nexitProcess();\n} else if (pid &gt; 0) {\n// Parent process\n// \u865a\u62df\u673aresume\uff0c\u5f53\u524d\u5b50\u7ebf\u7a0b\u7b49\u5f85\u5b50\u8fdb\u7a0b\u7ed3\u675f\ndumpRes = resumeAndWait(pid);\n}\n...\n...\n</code></pre> <pre><code>pid_t HprofDump::SuspendAndFork() {\n...\n...\nsuspend_vm_fnc_();\npid_t pid = fork();\nif (pid == 0) {\nprctl(PR_SET_NAME, \"forked-dump-process\");\n}\n...\n...\nreturn pid;\n}\nbool HprofDump::ResumeAndWait(pid_t pid) {\n...\n...\nresume_vm_fnc_();\nint status;\nfor (;;) {\nif (waitpid(pid, &amp;status, 0) != -1 || errno != EINTR) {\nif (!WIFEXITED(status)) {\nreturn false;\n}\nreturn true;\n}\nreturn false;\n}\n...\n...\n}\n</code></pre></p> <p>HPROF \u88c1\u526a</p> <p>\u4e3b\u8981\u662f\u53bb\u9664\u4e86\u65e0\u7528\u4fe1\u606f</p> <ul> <li> <p>\u8df3\u8fc7 header</p> </li> <li> <p>\u5206 tag \u88c1\u526a</p> </li> <li> <p>\u88c1\u526a\u65e0\u7528\u4fe1\u606f\uff1a<code>char[]; byte[]; timestamp; stack trace serial number; class serial number</code>;</p> </li> <li> <p>\u538b\u7f29\u6570\u636e\u4fe1\u606f</p> </li> </ul> <p>\u5b9e\u73b0\u65b9\u5f0f\uff1adump hprof\u7684\u8fc7\u7a0b\u4e2d\u5b9e\u65f6\u88c1\u526a, \u901a\u8fc7<code>hook write</code>\uff0c\u5728\u5199\u5165\u6587\u4ef6\u8fc7\u7a0b\u4e2d\u88c1\u526a</p> <p></p> <p>hprof\u89e3\u6790\u6027\u80fd\u4f18\u5316</p> <p>Shark\u662fLeakCanary 2.0\u63a8\u51fa\u7684\u5168\u65b0\u89e3\u6790\u7ec4\u4ef6\uff0c\u4e3b\u8981\u505a\u4e86\u4ee5\u4e0b\u51e0\u9879\u4f18\u5316\uff1a</p> <ul> <li> <p>\u7d22\u5f15\uff0cshark\u4f4e\u5185\u5b58\u5f00\u9500\u7684\u6700\u6839\u672c\u539f\u56e0\u5c31\u662f\u901a\u8fc7\u7d22\u5f15\u505a\u5230\u4e86\u5185\u5b58\u61d2\u52a0\u8f7d\uff0c\u904d\u5386hprof\u65f6\u5b58\u50a8\u5bf9\u8c61\u5728hprof\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e3a\u5176\u5efa\u7acb\u7d22\u5f15\u65b9\u4fbf\u6309\u9700\u89e3\u6790\u3002</p> </li> <li> <p>\u6570\u636e\u7ed3\u6784\u4e0a\u505a\u4e86\u6df1\u5ea6\u4f18\u5316\uff0c\u4e3b\u8981\u662f\u4f7f\u7528\u4e86\u66f4\u9ad8\u6548\u7684map\uff0c\u67092\u4e2a\uff1a\u7b2c\u4e00\u662f\u5bf9\u4e8ekey\u548cvalue\u90fd\u662f\u57fa\u7840\u7c7b\u578b\u6216\u5b57\u7b26\u4e32\u7684\u4f7f\u7528hppc\u505amap\uff0c\u7b2c\u4e8c\u662f\u5bf9\u4e8evalue\u4e0d\u662f\u57fa\u672c\u7c7b\u578b\u7684\uff0c\u4f7f\u7528SortedBytesMap\u5b58\u50a8\u5185\u5bb9\u3002</p> </li> </ul> <p>\u5177\u4f53\u7684\u7d22\u5f15\u6709\uff1a\u5b9e\u4f8b\u7d22\u5f15\u3001\u7c7b\u7d22\u5f15\u3001\u5b57\u7b26\u4e32\u7d22\u5f15\u3001\u7c7b\u540d\u7d22\u5f15\u3001\u6570\u7ec4\u7d22\u5f15\uff1a</p> <pre><code>/**\n * This class is not thread safe, should be used from a single thread.\n */\ninternal class HprofInMemoryIndex private constructor(\nprivate val positionSize: Int,\nprivate val hprofStringCache: LongObjectScatterMap&lt;String&gt;,\nprivate val classNames: LongLongScatterMap,\nprivate val classIndex: SortedBytesMap,\nprivate val instanceIndex: SortedBytesMap,\nprivate val objectArrayIndex: SortedBytesMap,\nprivate val primitiveArrayIndex: SortedBytesMap,\nprivate val gcRoots: List&lt;GcRoot&gt;,\nprivate val proguardMapping: ProguardMapping?,\nval primitiveWrapperTypes: Set&lt;Long&gt;\n) {\n/**\n * Code from com.carrotsearch.hppc.LongLongScatterMap copy pasted, inlined and converted to Kotlin.\n *\n * See https://github.com/carrotsearch/hppc .\n */\nclass LongLongScatterMap constructor(expectedElements: Int = 4) {\n/**\n * A read only map of `id` =&gt; `byte array` sorted by id, where `id` is a long if [longIdentifiers]\n * is true and an int otherwise. Each entry has a value byte array of size [bytesPerValue].\n *\n * Instances are created by [UnsortedByteEntries]\n *\n * [get] and [contains] perform a binary search to locate a specific entry by key.\n */\ninternal class SortedBytesMap(\nprivate val longIdentifiers: Boolean,\nprivate val bytesPerValue: Int,\nprivate val sortedEntries: ByteArray\n) {\n</code></pre> <p>\u6240\u8c13hppc\u662fHigh Performance Primitive Collection\u7684\u7f29\u5199\uff0cshark\u4f7f\u7528kotlin\u5c06\u5176\u91cd\u5199\u4e86\u3002hppc\u53ea\u652f\u6301\u57fa\u672c\u7c7b\u578b\uff0c\u6240\u4ee5\u6ca1\u6709\u4e86\u88c5\u3001\u62c6\u7bb1\u7684\u6027\u80fd\u635f\u8017\uff0c\u76f8\u5173\u96c6\u5408\u64cd\u4f5c\u4e5f\u505a\u4e86\u5927\u91cf\u4f18\u5316\u3002</p> <p>Koom\u5bf9\u5176\u4e3b\u8981\u505a\u4e86\u4ee5\u4e0b\u51e0\u70b9\u4f18\u5316\uff1a</p> <ul> <li> <p>GC root\u526a\u679d\uff0c\u7531\u4e8e\u6211\u4eec\u641c\u7d22Path to GC Root\u65f6\uff0c\u662f\u4eceGC Root\u81ea\u9876\u5411\u4e0bBFS\uff0c\u5982JavaFrame\u3001MonitorUsed\u7b49\u6b64\u7c7bGC Root\u53ef\u4ee5\u76f4\u63a5\u526a\u679d\u3002</p> </li> <li> <p>\u57fa\u672c\u7c7b\u578b\u3001\u57fa\u672c\u7c7b\u578b\u6570\u7ec4\u4e0d\u641c\u7d22\u3001\u4e0d\u89e3\u6790\u3002</p> </li> <li> <p>\u540c\u7c7b\u5bf9\u8c61\u8d85\u8fc7\u9608\u503c\u65f6\u4e0d\u518d\u641c\u7d22\u3002</p> </li> <li> <p>\u589e\u52a0\u9884\u5904\u7406\uff0c\u7f13\u5b58\u6bcf\u4e2a\u7c7b\u7684\u6240\u6709\u9012\u5f52super class\uff0c\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\u3002</p> </li> <li> <p>\u5c06object ID\u7684\u7c7b\u578b\u4ecelong\u4fee\u6539\u4e3aint\uff0cAndroid\u865a\u62df\u673a\u7684object ID\u5927\u5c0f\u53ea\u670932\u4f4d\uff0c\u76ee\u524dshark\u91cc\u4f7f\u7528\u7684\u90fd\u662flong\u6765\u5b58\u50a8\u7684\uff0cOOM\u65f6\u767e\u4e07\u7ea7\u5bf9\u8c61\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8282\u770110M\u5185\u5b58\u3002  </p> </li> </ul>"},{"location":"perf-opt/Android/memory/android-memory-gov/#32-native","title":"3.2. Native\u5185\u5b58\u6cc4\u9732","text":"<p>\u5b83\u7684\u6838\u5fc3\u539f\u7406\u5982\u4e0b</p> <ul> <li>hook malloc/free \u7b49\u5185\u5b58\u5206\u914d\u5668\u65b9\u6cd5\uff0c\u7528\u4e8e\u8bb0\u5f55 Native \u5185\u5b58\u5206\u914d\u5143\u6570\u636e\u300c\u5927\u5c0f\u3001\u5806\u6808\u3001\u5730\u5740\u7b49\u300d</li> <li>\u5468\u671f\u6027\u7684\u4f7f\u7528 <code>mark-and-sweep</code> \u5206\u6790\u6574\u4e2a\u8fdb\u7a0b Native Heap\uff0c\u83b7\u53d6\u4e0d\u53ef\u8fbe\u7684\u5185\u5b58\u5757\u4fe1\u606f\u300c\u5730\u5740\u3001\u5927\u5c0f\u300d</li> <li>\u5229\u7528\u4e0d\u53ef\u8fbe\u7684\u5185\u5b58\u5757\u7684\u5730\u5740\u3001\u5927\u5c0f\u7b49\u4ece\u6211\u4eec\u8bb0\u5f55\u7684\u5143\u6570\u636e\u4e2d\u83b7\u53d6\u5176\u5206\u914d\u5806\u6808\uff0c\u4ea7\u51fa\u6cc4\u6f0f\u6570\u636e\u300c\u4e0d\u53ef\u8fbe\u5185\u5b58\u5757\u5730\u5740\u3001\u5927\u5c0f\u3001\u5206\u914d\u5806\u6808\u7b49\u300d</li> </ul> <p>\u8fd9\u91cc\u5185\u90e8\u4e3b\u8981\u662f\u5229\u7528libmemunreachable\u6765\u5b9e\u73b0</p>"},{"location":"perf-opt/Android/memory/android-memory-gov/#4","title":"4. \u8d44\u6e90\u6536\u655b\u3001\u76d1\u63a7","text":""},{"location":"perf-opt/Android/memory/android-memory-gov/#41","title":"4.1. \u7ebf\u7a0b","text":"<p>\u7ebf\u7a0b\u662f\u6709\u9650\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u4f7f\u7528\u7ebf\u7a0b\u6c60\u6765\u590d\u7528\u7ebf\u7a0b\uff0c\u4f46\u4f7f\u7528\u4e86\u7ebf\u7a0b\u6c60\u5e76\u4e0d\u610f\u5473\u7740\u5c31\u80fd\u89e3\u51b3\u6240\u6709\u7684\u7ebf\u7a0b\u4f7f\u7528\u95ee\u9898\uff0c\u4e5f\u5e76\u4e0d\u662f\u6240\u6709\u7684\u4e1a\u52a1\u573a\u666f\u90fd\u80fd\u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\uff0c\u6bd4\u5982\u8981\u6c42 looper \u4e0a\u4e0b\u6587\u7684\u573a\u666f\uff08HandlerThread\uff09\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u7ebf\u7a0b\u7684\u903b\u8f91\u51fa\u4e86 bug \u5bfc\u81f4\u610f\u6599\u4e4b\u5916\u7684\u201c\u91ce\u7ebf\u7a0b\u201d\u51fa\u73b0\u5e76\u4e0d\u65ad\u5806\u79ef\uff0c\u7ebf\u7a0b\u6570\u91cf\u5c31\u6709\u53ef\u80fd\u5931\u63a7\uff0c\u5373\u7ebf\u7a0b\u6cc4\u6f0f\u4e86\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5bf9\u5e94\u4e86\u72ec\u7acb\u7684\u6808\u5185\u5b58\u3002\u5728 Android \u4e2d\uff0c\u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a Java \u7ebf\u7a0b\u9700\u8981\u5360\u7528\u5927\u7ea6 1M \u7684\u6808\u5185\u5b58\uff0c\u5982\u679c\u662f native \u7ebf\u7a0b\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 <code>pthread_attr_t</code> \u53c2\u6570\u4e3a\u521b\u5efa\u7684\u7ebf\u7a0b\u6307\u5b9a\u6808\u7684\u5927\u5c0f\u3002 \u4e0d\u52a0\u9650\u5236\u5730\u521b\u5efa\u7ebf\u7a0b\uff0c\u4f1a\u8ba9\u672c\u4e0d\u5145\u88d5\u7684 32 \u4f4d\u5730\u5740\u7a7a\u95f4\u96ea\u4e0a\u52a0\u971c\u3002</p> <p>\u7ebf\u7a0b\u6570\u91cf\u8fc7\u591a\u9664\u4e86\u53ef\u80fd\u5bfc\u81f4<code>pthread_create</code>\u95ee\u9898\uff0c</p> <p></p> <p>\u90a3\u662f\u4e0d\u662f\u5347\u7ea7\u5230 64 \u4f4d\u5305\uff0c\u5c31\u6ca1\u6709\u95ee\u9898\u4e86\u5462\uff1f\u7b54\u6848\u662f\u5426\u5b9a\u7684\u3002\u867d\u7136 64 \u4f4d\u5305\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5f88\u5927\uff0c\u4f46\u662f\u7ebf\u7a0b\u968f\u7740\u4ee3\u7801\u8fd0\u884c\u5165\u6808\uff0c\u6570\u636e\u9700\u8981\u5b9e\u9645\u5199\u5165\u7269\u7406\u5185\u5b58\uff0c\u5e94\u7528\u7684 <code>PSS</code> \u4e5f\u4f1a\u589e\u957f\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u7cfb\u7edf\u5bf9\u7ebf\u7a0b\u7684\u6570\u91cf\u4e5f\u662f\u6709\u9650\u5236\u7684\u3002</p> <p>\u7cfb\u7edf\u4ece\u4e09\u4e2a\u65b9\u9762\u9650\u5236\u4e86\u8fdb\u7a0b\u7684\u6570\u91cf\uff1a</p> <ul> <li> <p>\u914d\u7f6e\u6587\u4ef6 /proc/sys/kernel/threads-max \u6307\u5b9a\u4e86\u7cfb\u7edf\u8303\u56f4\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u91cf</p> </li> <li> <p>Linux resource limits \u7684 RLIMIT_NPROC \u53c2\u6570\u5bf9\u5e94\u4e86\u5f53\u524d\u7528\u6237 uid \u7684\u6700\u5927\u7ebf\u7a0b\u6570\u91cf\uff0cAndroid \u4e2d\u57fa\u672c\u4e0a\u4e00\u4e2a \u5e94\u7528\u5c31\u5bf9\u5e94\u4e86\u4e00\u4e2a uid\uff0c\u56e0\u6b64\u8fd9\u4e2a\u9608\u503c\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5e94\u7528\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u91cf</p> </li> <li> <p>\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0d\u8db3\u6216\u8005\u5185\u6838\u5206\u914d vma \u5931\u8d25\u7b49\u5185\u5b58\u539f\u56e0\uff0c\u5bfc\u81f4\u521b\u5efa\u7ebf\u7a0b\u65f6\u5206\u914d\u6808\u5185\u5b58\u65f6 mmap \u6216 mprotect \u8c03\u7528\u5931\u8d25</p> </li> </ul> <p>\u524d\u4e24\u8005\u53d6\u51b3\u4e8e\u5382\u5546\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u6211\u624b\u4e2d\u7684\u6d4b\u8bd5\u673a resource limits \u9608\u503c\u9ad8\u8fbe\u6570\u4e07\uff0c\u800c\u73b0\u7f51\u6709\u4e9b\u7528\u6237\u7684\u673a\u578b\u5219\u53ea\u6709 500\u3002</p> <p>\u4f46\u5bf9\u73b0\u5728\u5927\u591a\u6570\u624b\u673a\u800c\u8a00\uff0c\u7ebf\u7a0b\u6570\u91cf\u4e0d\u592a\u5bb9\u6613\u8fbe\u5230 <code>thread-max</code> \u6216\u8005 <code>resource limits</code> \u7684\u9608\u503c\uff0c\u901a\u5e38\u662f\u5728\u8fd8\u6ca1\u8fbe\u5230\u9650\u5236\u9608\u503c\uff0c\u5c31\u56e0\u4e3a\u4e0a\u8ff0\u7b2c\u4e09\u4e2a\u539f\u56e0\u800c\u521b\u5efa\u7ebf\u7a0b\u5931\u8d25\uff0c <code>pthread_create</code> \u5c06\u8fd4\u56de\u975e 0 \u503c <code>EAGAIN()</code>\u3002</p> <p></p>"},{"location":"perf-opt/Android/memory/android-memory-gov/#411","title":"4.1.1  \u7ebf\u7a0b\u6570\u91cf\u8fc7\u591a\u76d1\u63a7","text":"<p>\u901a\u8fc7 watchdog \u5468\u671f\u68c0\u67e5\u76d1\u63a7\u5e94\u7528\u7684\u7ebf\u7a0b\u6570\u91cf\u7684\u65b9\u5f0f\uff0c\u63d0\u524d\u66b4\u9732\u95ee\u9898\uff0c\u5f53\u6570\u91cf\u8d85\u8fc7\u8bbe\u5b9a\u9608\u503c\u540e\uff0c\u4e0a\u62a5\u7ebf\u7a0b\u4fe1\u606f\uff0c\u7528\u4e8e\u6392\u67e5\u7ebf\u7a0b\u6cc4\u6f0f\u95ee\u9898\u5e76\u5efa\u7acb\u76f8\u5173\u6307\u6807\u3002\u867d\u7136\u7b80\u5355\uff0c\u4f46\u662f\u597d\u7528\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6 <code>/proc/[pid]/status</code> \u4e2d\u7684 <code>Threads</code> \u5b57\u6bb5\u7684\u503c\u5f97\u5230(\u89c1\u524d\u9762\u7b2c\u4e00\u70b9\uff1a\u5185\u5b58\u57fa\u7840\u76d1\u63a7)\uff0c\u53e6\u5916\u5728 Linux \u4e2d\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5bf9\u5e94\u4e86\u4e00\u4e2a <code>/proc/[pid]/task/[tid]</code> \u76ee\u5f55\uff0c\u8be5\u76ee\u5f55\u4e0b\u7684 stat \u6587\u4ef6\u8bb0\u5f55\u4e86\u7ebf\u7a0b tid\u3001\u7ebf\u7a0b\u540d\u7b49\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u904d\u5386 <code>/proc/[pid]/task</code> \u76ee\u5f55\u5f97\u5230\u5f53\u524d\u8fdb\u7a0b\u6240\u6709\u7ebf\u7a0b\u7684\u4fe1\u606f\u3002</p> <p>\u904d\u5386 <code>/proc/[pid]/task/[tid]/stat</code> \u6587\u4ef6\u4f1a\u6709\u6bd4\u8f83\u591a\u7684 IO \u64cd\u4f5c\uff0c\u53ef\u4ee5\u7ed3\u5408\u5e94\u7528\u7684\u5b9e\u9645\u60c5\u51b5\u8bbe\u5b9a\u9608\u503c\uff0c\u8d85\u8fc7\u9608\u503c\u518d\u8fdb\u884c dump ,\u6700\u540e\u4e0a\u62a5\u670d\u52a1\u7aef\u805a\u7c7b\u5206\u6790\u3002</p> <pre><code>    private fun getThreadCount(): Int {\nreturn SystemInfo.procStatus.thread\n}\nprivate fun dumpThreadIfNeed() {\n// \u8d85\u8fc7\u9608\u503c\u518d\u8fdb\u884c dump\nif (mOverThresholdCount &gt; monitorConfig.maxOverThresholdCount) return\nval threadNames = runCatching { File(\"/proc/self/task\").listFiles() }\n.getOrElse {\nSwordLog.i(TAG, \"/proc/self/task child files is empty\")\nreturn@getOrElse emptyArray()\n}\n?.map {\nrunCatching { File(it, \"comm\").readText() }.getOrElse { \"failed to read $it/comm\" }\n}\n?.map {\nif (it.endsWith(\"\\n\")) it.substring(0, it.length - 1) else it\n}\n?: emptyList()\nSwordLog.i(TAG, \"threadNames = $threadNames\")\nOOMFileManager.createDumpFile(OOMFileManager.threadDumpDir)\n.run {\nrunCatching { writeText(threadNames.joinToString(separator = \",\")) }\n}\n}\n</code></pre> <p>\u5927\u90e8\u5206\u7ebf\u7a0b\u90fd\u662f<code>Thread-?</code>\u3001<code>pool-thread-?</code>\u8fd9\u7c7b\u6ca1\u6709\u7279\u5f81\u7684\u7ebf\u7a0b\uff0c\u4ec5\u901a\u8fc7\u4e0a\u62a5\u7684\u7ebf\u7a0b\u540d\u96be\u4ee5\u5b9a\u4f4d\u5230\u5177\u4f53\u7684\u4e1a\u52a1\u4ee3\u7801\u3002\u6b64\u5916\u6211\u4eec\u5728 native \u521b\u5efa\u7684\u7ebf\u7a0b\uff0c\u5982\u679c\u6ca1\u6709\u5bf9\u5b50\u7ebf\u7a0b\u8bbe\u7f6e\u540d\u5b57\uff0c\u5b50\u7ebf\u7a0b\u5c31\u4f1a\u7ee7\u627f\u7236\u7ebf\u7a0b\u7684\u540d\u5b57\u3002\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u521b\u5efa\u7ebf\u7a0b\u7684 <code>stacktrace</code>\uff0c\u90a3\u8fd9\u4e2a\u95ee\u9898\u5c31\u8fce\u5203\u800c\u89e3\u4e86\u3002\u65e0\u8bba\u662fjava \u7ebf\u7a0b\u8fd8\u662fnative\u7ebf\u7a0b\u90fd \u662f\u901a\u8fc7 <code>pthread_create</code> \u521b\u5efa\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7<code>native hook pthread_create</code> \u6765\u5b9e\u73b0\u3002</p>"},{"location":"perf-opt/Android/memory/android-memory-gov/#412","title":"4.1.2 \u7ebf\u7a0b\u6808\u5185\u5b58\u6cc4\u6f0f\u76d1\u63a7","text":"<p>\u4e0d\u4e86\u89e3 <code>pthread</code> \u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u611f\u5230\u56f0\u60d1\uff0c\u7ebf\u7a0b\u90fd\u9000\u51fa\u4e86\uff0c\u4e3a\u4ec0\u4e48\u6808\u5185\u5b58\u8fd8\u4f1a\u6cc4\u6f0f\u5462\uff1f\u6211\u4eec\u770b\u4e00\u4e0b Linux man page \u4e2d\u7684\u63cf\u8ff0\uff1a</p> <p>Either pthread_join(3) or pthread_detach() should be called foreach thread that an application creates, so that system resourcesfor the thread can be released.</p> <p><code>system resource</code>\uff0c\u5176\u5b9e\u4e3b\u8981\u5c31\u662f\u6307\u6808\u5185\u5b58\u3002\u53ea\u6709 detach \u72b6\u6001\u7684\u7ebf\u7a0b\uff0c\u624d\u4f1a\u5728\u7ebf\u7a0b\u6267\u884c\u5b8c\u9000\u51fa\u65f6\u81ea\u52a8\u91ca\u653e\u6808\u5185\u5b58\uff0c\u5426\u5219\u5c31\u9700\u8981\u7b49\u5f85\u8c03\u7528 join \u6765\u91ca\u653e\u5185\u5b58\uff0c\u800c\u4f7f\u7528\u9ed8\u8ba4\u53c2\u6570\u521b\u5efa\u7684 pthread \u90fd\u662f joinable \u72b6\u6001\u7684\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u521b\u5efa\u7ebf\u7a0b\u65f6\u5c31\u901a\u8fc7 <code>pthread_attr_t</code> \u53c2\u6570\u628a\u7ebf\u7a0b\u8bbe\u7f6e\u4e3a <code>PTHREAD_CREATE_DETACHED</code> \u72b6\u6001\uff0c\u90a3\u4e48\u521b\u5efa\u7684\u8fd9\u4e2a\u7ebf\u7a0b\u5c31\u4e0d\u9700\u8981\u518d\u663e\u5f0f\u8c03\u7528 <code>pthread_detach</code> \u6216 <code>pthread_join</code> \u4e86\uff0cAndroid \u7684 Java \u7ebf\u7a0b\u5728\u521b\u5efa\u7684\u65f6\u5019\u5c31\u8bbe\u7f6e\u4e86\u6b64\u72b6\u6001\u3002</p> <p>\u6240\u4ee5\u8fd9\u4e2a\u95ee\u9898\u53ea\u4f1a\u53d1\u751f\u5728\u901a\u8fc7native \u521b\u5efa\u7684\u7ebf\u7a0b\u3002</p> <pre><code>JNIEXPORT void JNICALL\nJava_com_duowan_sample_hook_JNIObj_threadTest(JNIEnv *env, jclass clazz) {\npthread_t pthreads[PTHREAD_COUNT];\nfor (int i = 0; i &lt; PTHREAD_COUNT; ++i) {\npthread_attr_t attr;\npthread_attr_init(&amp;attr);\n//        pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);\nint ret = pthread_create(&amp;pthreads[i], nullptr, thread_test, nullptr);\n//        pthread_detach(pthreads[i]);\npthread_getattr_np(pthreads[i], &amp;attr);\nint state = PTHREAD_CREATE_JOINABLE;\npthread_attr_getdetachstate(&amp;attr, &amp;state);\nLOGD(TAG, \"detach state = %d\", state);\nif (i % 500 == 0) {\nLOGD(TAG, \"sleep\");\nsleep(1);\n}\nif (ret != 0) {\nLOGD(TAG, \"pthread_create error[%d]: %d\", i, ret);\nbreak;\n}\n}\n...\n}\n</code></pre> <p>\u8fd9\u91cc\u65e2\u6ca1\u6709 detach \u4e5f\u6ca1\u6709 join\uff0c\u5f53\u7ebf\u7a0b\u6267\u884c\u5b8c\u5c31\u9000\u51fa\u4e86\uff0c\u4f46\u8fd9\u65f6\u67e5\u770b <code>/proc/[pid]/maps</code> \u5c31\u80fd\u53d1\u73b0\uff0c\u5185\u5b58\u4e2d\u5145\u65a5\u7740\u5927\u91cf\u7684\u6808\u5185\u5b58\u6ca1\u6709\u91ca\u653e\uff0c\u5e76\u4e14\u4e0e\u7ebf\u7a0b\u7684\u6570\u91cf\u4e0d\u5339\u914d\u3002</p> <p></p> <p>\u540c\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 hook <code>pthread_detach</code> \u548c <code>pthread_join</code> \u8fd9\u4e24\u4e2a API\uff0c\u5c31\u80fd\u7edf\u8ba1\u51fa\u662f\u54ea\u4e9b\u7ebf\u7a0b\u7684\u6808\u5185\u5b58\u6cc4\u6f0f\u4e86\u3002</p> <p>\u6574\u4f53native hook\u6838\u5fc3\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>    bool ThreadHooker::RegisterSo(const std::string &amp;lib, int source) {\nif (IsLibIgnored(lib)) {\nreturn false;\n}\nauto lib_ctr = lib.c_str();\nsword::Log::info(TAG, \"HookSo %d %s\", source, lib_ctr);\nxhook_register(lib_ctr, \"pthread_create\",\nreinterpret_cast&lt;void *&gt;(HookThreadCreate), nullptr);\nxhook_register(lib_ctr, \"pthread_detach\",\nreinterpret_cast&lt;void *&gt;(HookThreadDetach), nullptr);\nxhook_register(lib_ctr, \"pthread_join\",\nreinterpret_cast&lt;void *&gt;(HookThreadJoin), nullptr);\nxhook_register(lib_ctr, \"pthread_exit\",\nreinterpret_cast&lt;void *&gt;(HookThreadExit), nullptr);\nreturn true;\n}\nint ThreadHooker::HookThreadCreate(pthread_t *tidp, const pthread_attr_t *attr,\nvoid *(*start_rtn)(void *), void *arg) {\nif (hookEnabled() &amp;&amp; start_rtn != nullptr) {\nauto time = Util::CurrentTimeMs();\nsword::Log::info(TAG, \"HookThreadCreate\");\nauto *hook_arg = new StartRtnArg(arg, Util::CurrentTimeMs(), start_rtn);\nauto *thread_create_arg = hook_arg-&gt;thread_create_arg;\nvoid *thread = sword::CallStack::GetCurrentThread();\nif (thread != nullptr) {\n// \u83b7\u53d6java\u6808\uff0c\u901a\u8fc7 libart.so\u5f97\u5230 art::Thread::DumpJavaStack\u7684\u51fd\u6570\u6307\u9488\u5b9e\u73b0\nsword::CallStack::JavaStackTrace(thread,\nhook_arg-&gt;thread_create_arg-&gt;java_stack);\n}\n// \u83b7\u53d6native\u6808, \u57fa\u4e8eUnwind\u5b9e\u73b0\uff0c\u5177\u4f53\u53c2\u89c1https://blog.adison.top/perf-opt/Android/memory/native-backtrace/\nsword::CallStack::FastUnwind(thread_create_arg-&gt;pc,\nsword::Constant::kMaxCallStackDepth);\nthread_create_arg-&gt;stack_time = Util::CurrentTimeMs() - time;\nreturn pthread_create(tidp, attr,\nreinterpret_cast&lt;void *(*)(void *)&gt;(HookThreadStart),\nreinterpret_cast&lt;void *&gt;(hook_arg));\n}\nreturn pthread_create(tidp, attr, start_rtn, arg);\n}\nint ThreadHooker::HookThreadDetach(pthread_t t) {\nif (!hookEnabled()) return pthread_detach(t);\n...\n// \u8bb0\u5f55detach\u7684\u7ebf\u7a0b\nbool valid = threadMap.count(threadId) &gt; 0;\nsword::Log::info(TAG, \"DetachThread tid:%p\", threadId);\nif (valid) {\nthreadMap[threadId].thread_detached = true;\n} else {\nleakThreadMap.erase(threadId);\n}\nreturn pthread_detach(t);\n}\nint ThreadHooker::HookThreadJoin(pthread_t t, void **return_value) {\nif (!hookEnabled()) return pthread_join(t, return_value);\n...\n// \u8bb0\u5f55join\u7684\u7ebf\u7a0b\nbool valid = threadMap.count(threadId) &gt; 0;\nsword::Log::info(TAG, \"JoinThread tid:%p\", threadId);\nif (valid) {\nthreadMap[threadId].thread_detached = true;\n} else {\nleakThreadMap.erase(threadId);\n}\nreturn pthread_join(t, return_value);\n}\nvoid ThreadHooker::HookThreadExit(void *return_value) {\nif (!hookEnabled()) pthread_exit(return_value);\nbool valid = threadMap.count(threadId) &gt; 0;\nif (!valid) return;\nauto &amp;item = threadMap[threadId];\nsword::Log::info(TAG, \"ExitThread tid:%p name:%s\", threadId,\nitem.name.c_str());\nitem.exitTime = time;\nitem.name.assign(threadName);\nif (!item.thread_detached) {\n// \u6cc4\u9732\u4e86\nsword::Log::error(TAG,\n\"Exited thread Leak! Not joined or detached!\\n tid:%p\",\nthreadId);\nleakThreadMap[threadId] = item;\n}\nthreadMap.erase(threadId);\nsword::Log::info(TAG, \"ExitThread finish\");\npthread_exit(return_value);\n}\n</code></pre>"},{"location":"perf-opt/Android/memory/android-memory-gov/#42","title":"4.2. \u5176\u4ed6\u8d44\u6e90\u89e6\u52a8\u76d1\u63a7","text":"<ul> <li>\u6587\u4ef6\u53e5\u67c4\u6570\u91cf\u8fc7\u591a</li> </ul> <pre><code>    private fun getFdCount(): Int {\nreturn File(\"/proc/self/fd\").listFiles()?.size ?: 0\n}\nprivate fun dumpFdIfNeed() {\nSwordLog.i(TAG, \"over threshold dumpFdIfNeed\")\nif (mOverThresholdCount &gt; monitorConfig.maxOverThresholdCount) return\nif (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) return\nval fdNames = runCatching { File(\"/proc/self/fd\").listFiles() }\n.getOrElse {\nSwordLog.i(TAG, \"/proc/self/fd child files is empty\")\nreturn@getOrElse emptyArray()\n}\n?.map { file -&gt;\nrunCatching { Os.readlink(file.path) }.getOrElse { \"failed to read link ${file.path}\" }\n}\n?: emptyList()\nOOMFileManager.createDumpFile(OOMFileManager.fdDumpDir)\n.run {\nrunCatching { writeText(fdNames.sorted().joinToString(separator = \",\")) }\n}\n}\n</code></pre> <ul> <li>32\u4f4d\u7cfb\u7edf\u865a\u62df\u5185\u5b58\u8fc7\u5927</li> </ul> <p>\u865a\u62df\u5185\u5b58\u5360\u7528\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6<code>/proc/self/status</code>\u83b7\u53d6</p> <pre><code>    File(\"/proc/self/status\").forEachLineQuietly { line -&gt;\nif (procStatus.vssInKb != 0 &amp;&amp; procStatus.rssInKb != 0\n&amp;&amp; procStatus.thread != 0) return@forEachLineQuietly\nwhen {\nline.startsWith(\"VmSize\") -&gt; {\nprocStatus.vssInKb = VSS_REGEX.matchValue(line)\n}\nline.startsWith(\"VmRSS\") -&gt; {\nprocStatus.rssInKb = RSS_REGEX.matchValue(line)\n}\nline.startsWith(\"Threads\") -&gt; {\nprocStatus.thread = THREADS_REGEX.matchValue(line)\n}\n}\n}\nval info = SystemInfo.procStatus\nif (!SystemInfo.isSupport64Bit &amp;&amp; info.vssInKb &gt; monitorConfig.vssSizeThreshold) {\nSwordLog.e(\nTAG, \"oom vss  &lt; \" +\n\"${SizeUnit.KB.toMB(info.vssInKb)}M\")\n}\n</code></pre> <ul> <li>\u624b\u673a\u53ef\u7528\u5185\u5b58\u8fc7\u4f4e</li> </ul> <p>\u624b\u673a\u53ef\u7528\u5185\u5b58\u53ef\u901a\u8fc7\u8bfb\u53d6<code>/proc/meminfo</code>\u83b7\u53d6 <pre><code>    File(\"/proc/meminfo\").forEachLineQuietly { line -&gt;\nwhen {\nline.startsWith(\"MemTotal\") -&gt; {\nmemInfo.totalInKb = MEM_TOTAL_REGEX.matchValue(line)\n}\nline.startsWith(\"MemFree\") -&gt; {\nmemInfo.freeInKb = MEM_FREE_REGEX.matchValue(line)\n}\nline.startsWith(\"MemAvailable\") -&gt; {\nmemInfo.availableInKb = MEM_AVA_REGEX.matchValue(line)\n}\nline.startsWith(\"CmaTotal\") -&gt; {\nmemInfo.cmaTotal = MEM_CMA_REGEX.matchValue(line)\n}\nline.startsWith(\"ION_heap\") -&gt; {\nmemInfo.IONHeap = MEM_ION_REGEX.matchValue(line)\n}\n}\n}\nmemInfo.rate = 1.0f * memInfo.availableInKb / memInfo.totalInKb\n</code></pre></p> <ul> <li>\u5806\u5185\u5b58\u8fc7\u9ad8&amp;\u56fa\u5b9a\u95f4\u9694\u65f6\u95f4\u5185\u5206\u914d\u5185\u5b58\u8fc7\u591a\uff08used\u5dee\u503c\uff09</li> </ul> <p>java \u5806\u5185\u5b58\u901a\u8fc7 <code>Runtime.getRuntime()</code> \u83b7\u53d6</p> <pre><code>    // java\u865a\u62df\u673a\uff08\u8fd9\u4e2a\u8fdb\u7a0b\uff09\u80fd\u6784\u4ece\u64cd\u4f5c\u7cfb\u7edf\u90a3\u91cc\u6316\u5230\u7684\u6700\u5927\u7684\u5185\u5b58\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\njavaHeap.max = Runtime.getRuntime().maxMemory()\n// java\u865a\u62df\u673a\u73b0\u5728\u5df2\u7ecf\u4ece\u64cd\u4f5c\u7cfb\u7edf\u90a3\u91cc\u6316\u8fc7\u6765\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u4e5f\u5c31\u662fjava\u865a\u62df\u673a\u8fd9\u4e2a\u8fdb\u7a0b\u5f53\u65f6\u6240\u5360\u7528\u7684\u6240\u6709\u5185\u5b58\njavaHeap.total = Runtime.getRuntime().totalMemory()\n// JVM\u5df2\u7ecf\u6316\u5230\u4f46\u662f\u8fd8\u6ca1\u6709\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\njavaHeap.free = Runtime.getRuntime().freeMemory()\njavaHeap.used = javaHeap.total - javaHeap.free\n</code></pre>"},{"location":"perf-opt/Android/memory/android-memory-gov/#_2","title":"\u53c2\u8003","text":"<p>\u7ebf\u7a0b\uff1a\u201c\u4f60\u53ef\u80fd\u628a\u63e1\u4e0d\u4f4f\u201d</p> <p>KOOM\u539f\u7406</p>"},{"location":"perf-opt/Android/memory/native-backtrace/","title":"Android Native\u6808\u56de\u6eaf","text":""},{"location":"perf-opt/Android/memory/native-backtrace/#_1","title":"\u80cc\u666f","text":"<p>\u5728\u65e5\u5e38\u7f16\u7801\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230\u9700\u8981\u6808\u56de\u6eaf\u7684\u573a\u666f\uff0c\u6bd4\u5982\u5f02\u5e38\u4e0a\u62a5\uff0c\u52a8\u6001 Hook\uff08\u5224\u65ad\u6765\u81ea\u54ea\u4e2a\u51fd\u6570\uff09\u7b49\u7b49\u3002\u90a3\u4e48\u5728 Android \u4e2d\u600e\u4e48\u8fdb\u884c\u6808\u56de\u6eaf\u5462\uff0c\u6700\u8fd1\u7814\u7a76\u4e86\u4e00\u4e0b\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u7406\u8bba\u4e0a\u50cf\u6808\u56de\u6eaf\u8fd9\u79cd\u901a\u7528\u573a\u666f\uff0c\u5e94\u8be5\u6709\u7cfb\u7edf\u51fd\u6570\u53ef\u4ee5\u5b9e\u73b0\uff0c\u90a3\u4e48\u7cfb\u7edf\u51fd\u6570\u53c8\u6709\u4ec0\u4e48\u95ee\u9898\u5462\uff0c\u4e3a\u4ec0\u4e48\u6709\u8fd9\u7bc7\u8e29\u5751\u6587\uff0c\u63a5\u4e0b\u6765\u4e00\u4e00\u8bb2\u89e3\u3002</p>"},{"location":"perf-opt/Android/memory/native-backtrace/#_2","title":"\u6808\u56de\u6eaf\u7684\u7406\u8bba\u57fa\u7840","text":"<p>\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u51fd\u6570\u8c03\u7528\u5982\u4e0b\u3002</p> <pre><code>void func4(int a, int b, int c, int d, int e) {\n    __android_log_print(ANDROID_LOG_INFO, \"backtrace\", \"func\");\n}\n\nvoid func3(int a, int b, int c, int d, int e, int f, int g, int h) {\n    func4(1,2,3,4,5);\n}\n\nvoid func2(int a, int b, int c) {\n    func3(1,2,3,4,5,6,7,8);\n}\n\nvoid func1(int a) {\n    func2(1, 2, 3);\n}\n\nextern \"C\" JNIEXPORT jstring JNICALL\nJava_com_example_backtrackdemo_MainActivity_stringFromJNI(\n        JNIEnv* env,\n        jobject /* this */) {\n    func1(1);\n    std::string hello = \"Hello from C++\";\n    return env-&gt;NewStringUTF(hello.c_str());\n}\n</code></pre> <p>\u603b\u7ed3\u4e0b\u8c03\u7528\u987a\u5e8f\u5c31\u662f\u3002</p> <pre><code>Java_com_example_backtrackdemo_MainActivity_stringFromJNI -&gt; func1 -&gt; func2 -&gt; func3 -&gt; func4\n</code></pre> <p>\u6311\u4e00\u4e2a\u65b9\u6cd5\u7684\u6c47\u7f16\u4ee3\u7801\u6765\u770b\u3002</p> <p></p> <p>\u6bcf\u4e2a\u65b9\u6cd5\u7684\u5f00\u5934\u548c\u7ed3\u5c3e\u90fd\u6709\u8fd9\u68375\u6761\u6307\u4ee4\uff0c\u8fd9\u79cd\u6307\u4ee4\u53eb\u505a\u6808\u5e73\u8861\u64cd\u4f5c\u3002\u4f17\u6240\u5468\u77e5\uff0c\u6bcf\u4e2a\u65b9\u6cd5\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u4e00\u5757\u6808\u5e27\uff0c\u5728\u8fdb\u5165\u65b9\u6cd5\u4e4b\u540e\uff0c\u9996\u5148\u8981\u5f00\u8f9f\u51fa\u5c5e\u4e8e\u81ea\u5df1\u7684\u6808\u7a7a\u95f4\uff0c\u4e5f\u5c31\u662f\u3002</p> <pre><code>SUB SP,SP,#0x30\n</code></pre> <p>\u8fd9\u6837\u5c31\u7ed9\u81ea\u5df1\u5f00\u8f9f\u4e86 0x30 \u5927\u5c0f\u7684\u4e00\u5757\u6808\u7a7a\u95f4\u3002 \u200b \u7136\u540e\u4fdd\u5b58\u4e0a\u4e00\u4e2a\u51fd\u6570\u7684\u4fe1\u606f\uff0c\u4e3a\u4e86\u8be5\u65b9\u6cd5\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8df3\u8f6c\u56de\u4e0a\u4e2a\u51fd\u6570\u3002</p> <pre><code>STP X29, X30, [SP, #0x20+var_s0]\n</code></pre> <p>\u8fd9\u6837\u5c31\u628a X29 \u548c X30 \u5bc4\u5b58\u5668\u4fdd\u5b58\u5728\u4e86\u5f53\u524d\u7684\u6808\u9876\uff0c\u6309\u7167 Arm64 \u7684\u5bc4\u5b58\u5668\u7ea6\u5b9a\uff0cX30 \u5c31\u662f LR\uff0c\u4e5f\u5c31\u662f\u51fd\u6570\u8fd4\u56de\u65f6\u4e0b\u4e00\u6b65\u8981\u6267\u884c\u7684\u6307\u4ee4\u5730\u5740\u3002 \u200b \u7136\u540e\u628a\u5f53\u524d\u7684\u6808\u9876\u4fe1\u606f\u53c8\u7ed9\u4e86\u65b0\u7684 X29 \u5bc4\u5b58\u5668\uff0c\u6240\u4ee5 Arm64 \u7684\u5bc4\u5b58\u5668\u7ea6\u5b9a\u91cc\uff0cX29 \u5c31\u662f FP \u5bc4\u5b58\u5668\uff0c\u4fdd\u5b58\u7684\u662f\u6808\u5e95\u4fe1\u606f\u3002</p> <pre><code>ADD X29, SP, #0x20\n</code></pre> <p>\u8fd9\u5c31\u662f\u4e00\u4e2a\u65b9\u6cd5\u5f00\u59cb\u65f6\u505a\u7684\u4e8b\u60c5\u3002\u7136\u540e\u5728\u65b9\u6cd5\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u6062\u590d\u4e86\u4e0a\u4e2a\u65b9\u6cd5\u7684 X29 \u548c X30 \u5bc4\u5b58\u5668\u4fe1\u606f\u3002</p> <pre><code>LDP X29, X30, [SP, #0x20 + var_s0]\n</code></pre> <p>\u628a\u81ea\u5df1\u7684\u6808\u5e27\u4ece\u5806\u6808\u4e2d\u79fb\u9664\u3002</p> <pre><code>ADD SP, SP, #0x30\n</code></pre> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u51fd\u6570\u7684\u5806\u6808\u64cd\u4f5c\uff0c\u8fd9\u5757\u64cd\u4f5c\u90fd\u662f\u7f16\u8bd1\u5668\u81ea\u52a8\u5b9e\u73b0\u7684\uff0c\u81f3\u4e8e\u5206\u914d\u7ed9\u4e00\u4e2a\u51fd\u6570\u591a\u5927\u7684\u6808\u7a7a\u95f4\uff0c\u4e5f\u662f\u7f16\u8bd1\u5668\u6839\u636e\u51fd\u6570\u4e2d\u7528\u7684\u7684\u6808\u5927\u5c0f\u6765\u8ba1\u7b97\u7684\uff0c\u4f7f\u7528\u9ad8\u7ea7\u8bed\u8a00\u7f16\u7a0b\u65f6\u65e0\u9700\u611f\u77e5\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u7ec6\u5fc3\u7684\u4f60\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\u4e86 X29 \u4fdd\u5b58\u7684\u5f53\u524d\u51fd\u6570\u7684\u6808\u9876\u5730\u5740\uff0c\u7136\u540e\u5728\u4e0b\u4e2a\u51fd\u6570\u5f00\u59cb\u7684\u65f6\u5019\u53c8\u4f1a\u88ab\u5b58\u5230\u6808\u4e2d\u4fdd\u5b58\uff0c\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u5faa\u73af\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 X29 \u5bc4\u5b58\u5668\u4e0d\u65ad\u7684\u5411\u4e0a\u56de\u6eaf\uff0c\u8fd9\u5c31\u662f\u6808\u56de\u6eaf\u7684\u7406\u8bba\u57fa\u7840\uff0c\u7528\u56fe\u8868\u793a\u7684\u5bc4\u5b58\u5668\u7ed3\u6784\u50cf\u4e0b\u9762\u8fd9\u6837\u3002</p> <p></p> <p>\u5173\u4e8eFP\u3001SP\u3001LR\u5bc4\u5b58\u5668\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0</p>"},{"location":"perf-opt/Android/memory/native-backtrace/#eh_frame","title":"\u57fa\u4e8e.eh_frame\u7684\u6808\u56de\u6eaf","text":"<p>\u8fd9\u91cc\u4e0d\u9996\u5148\u8bb2\u57fa\u4e8e FP \u7684\u6808\u56de\u6eaf\u5b9e\u73b0\uff0c\u800c\u662f\u8bf4\u57fa\u4e8e .eh_frame\uff08\u4e5f\u53ebUnwind\uff09\u7684 Unwind_backtrace\u3002\u662f\u56e0\u4e3a Android \u7684 C \u5e93\u662f Google \u5bb6\u81ea\u5df1\u5f00\u53d1\u7684 bionic\uff0c\u5728 bionic \u4e2d\uff0cgoogle \u56e2\u961f\u63d0\u4f9b\u4e86\u5b98\u65b9\u7684 backtrace \u65b9\u6cd5\uff0cUnwind_backtrace\uff0chttps://github.com/gcc-mirror/gcc/blob/master/libgcc/unwind.inc\uff0c\u5c31\u662f\u8fd9\u4e2a\u65b9\u6848\u3002 \u200b \u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\u3002</p> <pre><code>// 1. \u5b9a\u4e49\u7ed3\u6784\u4f53\u5b58\u50a8unwind_backtrace\u8fd4\u56de\u7684\u4fe1\u606f\nstruct BacktraceState {\n    void **current;\n    void **end;\n};\n\n// 2. \u5b9a\u4e49callback\u65b9\u6cd5\uff0c\u4f9bunwind_backtrace\u56de\u8c03\nstatic _Unwind_Reason_Code unwindCallback(struct _Unwind_Context *context, void *arg) {\n    BacktraceState *state = static_cast&lt;BacktraceState *&gt;(arg);\n    uintptr_t pc;\n\n#ifdef HAVE_GETIPINFO\n    int ip_before_insn = 0;\n    pc = _Unwind_GetIPInfo (context, &amp;ip_before_insn);\n#else\n    pc = _Unwind_GetIP(context);\n#endif\n\n    if (pc) {\n        if (state-&gt;current == state-&gt;end) {\n            return _URC_END_OF_STACK;\n        } else {\n            *state-&gt;current++ = reinterpret_cast&lt;void *&gt;(pc);\n        }\n    }\n    return _URC_NO_REASON;\n}\n\n// 3. \u8c03\u7528_Unwind_Backtrace\nconst size_t max = 32;\nvoid *buffer[max] = {0};\nBacktraceState state = {buffer, buffer + max};\n_Unwind_Backtrace(unwindCallback, &amp;state);\n\n// 4. \u4f7f\u7528_Unwind_Backtrace\u8fd4\u56de\u7684\u4fe1\u606f\nsize_t count = state.current - buffer;\nfor (size_t idx = 0; idx &lt; count; ++idx) {\n    const void *addr = buffer[idx];\n    // ... do something like dladdr(addr, &amp;info)\n}\n</code></pre> <p>Unwind_backtrace \u548c\u666e\u901a\u7684\u57fa\u4e8e FP \u7684\u56de\u6eaf\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff0cUnwind_backtrace \u662f\u57fa\u4e8e .eh_frame \u6bb5\u89e3\u6790\u7684\uff0c\u63a5\u4e0b\u6765\u4f1a\u7b80\u5355\u7684\u8bf4\u4e0b .eh_frame \u6bb5\u7684\u76f8\u5173\u5185\u5bb9\u3002\u4f46\u662f\u5173\u4e8e .eh_frame \u6bb5\u7684\u8be6\u7ec6\u5386\u53f2\u8fd9\u7bc7\u6587\u7ae0\u8bb2\u7684\u6bd4\u8f83\u6e05\u695a\u3002</p> <p>\u7f16\u8bd1\u5668\u5728\u6784\u5efa\u7684\u65f6\u5019\u4f1a\u751f\u6210 .eh_frame \u6bb5\uff0c\u8fd9\u4e2a\u6bb5\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u5728\u901a\u7528\u5bc4\u5b58\u5668\u53d8\u5316\u65f6\u90fd\u8bb0\u5f55\u4e86\u4e0b\u6765\uff0c\u8bb0\u5f55\u6210\u4e00\u4e2a\u5bc4\u5b58\u5668\u53d8\u5316\u7d22\u5f15\u8868\uff0c\u8fd9\u6837\u4f60\u4e0d\u7ba1\u6267\u884c\u5230\u54ea\u6761\u6307\u4ee4\uff0c\u90fd\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u8868\u8fd8\u539f\u51fa\u5bc4\u5b58\u5668\u7684\u72b6\u6001\u3002\u8868\u683c\u662f\u4ee5\u975e\u53ef\u8bfb\u7684\u5b57\u8282\u7801\u5f62\u5f0f\u5b58\u50a8\u7684\uff0c\u4f46\u662f <code>readelf</code> \u5df2\u7ecf\u505a\u4e86\u89e3\u6790\u5de5\u4f5c\u3002\u5982\u679c\u4f60\u7528 <code>readelf</code> \u53bb\u89e3\u6790 so\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u6837\u7684\u4fe1\u606f\u3002</p> <p></p> <p>CFA \u662f\u6808\u57fa\u5730\u5740\uff0c\u540e\u9762\u662f\u51e0\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u7684\u6062\u590d\u65b9\u6cd5\uff0cra \u5c31\u662f\u4e0a\u4e00\u7ea7\u51fd\u6570\u7684\u5730\u5740\u3002</p> <p></p> <p>\u6709\u4e86\u8fd9\u4e2a\u8868\uff0c\u518d\u6839\u636e\u5f53\u524d\u7684 PC \u5bc4\u5b58\u5668\u7684\u503c\u5c31\u53ef\u4ee5\u6062\u590d\u6bcf\u4e00\u7ea7\u51fd\u6570\u7684\u8c03\u7528\u5730\u5740\u3002</p> <p>\u4ee5\u4e0a\u9762\u7684 demo \u4e3a\u4f8b\uff0c\u5728 func4 \u7684\u5730\u65b9\u6211\u4eec\u6253\u4e2a\u65ad\u70b9\uff0c\u770b\u4e0b PC \u5bc4\u5b58\u5668\u7684\u503c 0x7a34b95150\u3002</p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u8fd9\u4e2a PC \u5bc4\u5b58\u5668\u7684\u503c\u662f so \u52a0\u8f7d\u5230\u5185\u5b58\u540e\u5b9e\u9645\u7684\u5185\u5b58\u5730\u5740\uff0c\u9700\u8981\u51cf\u53bb\u52a0\u8f7d\u5230\u5185\u5b58\u5757\u7684\u8d77\u59cb\u5730\u5740\u624d\u662f\u5b9e\u9645\u5728 so \u4e2d\u7684\u4f4d\u7f6e\u3002\u8d77\u59cb\u5730\u5740\u600e\u4e48\u770b\u5f88\u7b80\u5355\u3002 \u200b \u5148\u67e5\u4e00\u4e0b\u8fd9\u4e2a app \u7684\u8fdb\u7a0b\u53f7\u3002</p> <pre><code>adb shell \"ps | grep com.example.backtrackdemo\"\nu0_a317      27476   841 5332892 104952 0                   0 t com.example.backtrackdemo\n</code></pre> <p>\u7136\u540e\u5728 maps \u91cc\u9762\u770b\u5185\u5b58\u7684\u5206\u5e03\u3002</p> <pre><code>main_boost_switch  map_files/         maps\nOnePlus8:/ # more /proc/27476/maps | grep \"native-lib.so\"\n7a34b86000-7a34bb7000 r-xp 00000000 fc:09 32864                          /data/app/com.example.backtrackdemo-JrcMGs7yb18P3a4WTWIZpA==/lib/arm64/libnative-lib.so\n7a34bb7000-7a34bbb000 r--p 00030000 fc:09 32864                          /data/app/com.example.backtrackdemo-JrcMGs7yb18P3a4WTWIZpA==/lib/arm64/libnative-lib.so\n7a34bbb000-7a34bbc000 rw-p 00034000 fc:09 32864                          /data/app/com.example.backtrackdemo-JrcMGs7yb18P3a4WTWIZpA==/lib/arm64/libnative-lib.so\n</code></pre> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\u7b2c\u4e00\u4e2a\u5730\u5740\u5c31\u662f\u8fd9\u4e2a so \u5728\u5185\u5b58\u4e2d\u7684 base \u5730\u5740\uff08\u8fd9\u91cc\u4e0d\u8003\u8651\u5f02\u5e38\u60c5\u51b5\uff0c\u5728\u4ee3\u7801\u4e2d\u8ba1\u7b97 base \u7f51\u4e0a\u4e5f\u53ef\u4ee5\u67e5\u5230\u5f88\u591a\u793a\u4f8b\u4ee3\u7801\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u77e5\u9053\u5b9e\u9645 PC \u5730\u5740\u662f 0x7a34b95150 - 0x7a34b86000 = 0xF150 \u200b \u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u5728 .eh_frame \u6bb5\u4e2d\u627e\u5230\u8bb0\u5f55\u8fd9\u4e2a PC \u7684\u5757\uff08\u4e5f\u53eb FDE\uff09\u3002</p> <pre><code>00000018 000000000000001c 0000001c FDE cie=00000000 pc=000000000000f11c..000000000000f16c\n   LOC           CFA      x29   ra\n000000000000f11c sp+0     u     u\n000000000000f128 x29+16   c-16  c-8\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5728 f128 \u4e4b\u540e\uff0cra \u7684\u503c\u662f c-8\uff0c\u4e5f\u5c31\u662f x29+16-8\uff0c\u8c03\u5f0f\u5668\u91cc\u6253\u4e00\u4e0b\u8fd9\u4e2a\u503c\u3002</p> <p></p> <p>7a34b951c4\u3002</p> <p></p> <p>\u6b63\u597d\u548c lldb \u6253\u5370\u7684\u6808\u56de\u6eaf\u4e2d\u4e0a\u4e00\u7ea7\u51fd\u6570\u7684\u5730\u5740\u5bf9\u5e94\u8d77\u6765\u4e86\u3002\u627e\u5230\u4e0a\u4e00\u7ea7 PC \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7ee7\u7eed\u56de\u6eaf\uff0c\u4e0a\u4e00\u7ea7 PC \u7684\u5b9e\u9645\u503c\u662f 0x7a34b951c4-0x7a34b86000=0xf1c4\uff0c\u90a3\u627e\u5230\u5bf9\u5e94\u7684 FDE\u3002</p> <pre><code>00000038 000000000000001c 0000003c FDE cie=00000000 pc=000000000000f16c..000000000000f1d0\n   LOC           CFA      x29   ra\n000000000000f16c sp+0     u     u\n000000000000f178 x29+16   c-16  c-8\n</code></pre> <p>ra = c-8 = x29+16-8\uff0c.eh_frame \u662f\u4e2a\u9759\u6001\u6bb5\uff0c\u8fd9\u91cc\u7684 x29 \u662f\u6307\u7684\u7684\u5f53\u524d\u6808\u5e27\u7684 x29 \u5bc4\u5b58\u5668\u7684\u503c\uff0c\u90a3\u8fd9\u4e2a\u503c\u600e\u4e48\u83b7\u53d6\u5462\uff0c\u5728\u7406\u8bba\u80cc\u666f\u4e2d\u63d0\u5230\uff0cx29 \u5bc4\u5b58\u5668\u5176\u5b9e\u5c31\u662f FP \u5bc4\u5b58\u5668\uff0cFP \u5bc4\u5b58\u5668\u662f\u4f9d\u6b21\u5b58\u50a8\u7684\uff0c\u6240\u4ee5\u5f53\u524dx29\u5bc4\u5b58\u5668\u7684\u503c\u5c31\u662f\u4e0a\u4e00\u7ea7\u51fd\u6570\u7684 x29 \u5bc4\u5b58\u5668\u7684\u5730\u5740\uff0c\u5b9e\u9645\u4e0a ra = c-8 = x29+16-8 = *x29+16-8\u3002</p> <p></p> <p>\u8fd9\u91cc\u56de\u6eaf\u5230\u4e0a\u4e00\u7ea7 PC \u5730\u5740 7a34b95218\uff0c\u4ee5\u6b64\u7c7b\u63a8\u5c31\u53ef\u4ee5\u56de\u6eaf\u5404\u7ea7\u8c03\u7528\u6808\u4e86\u3002 \u200b \u8bf4\u5230\u8fd9\u91cc\u4f60\u53ef\u80fd\u6709\u4e2a\u7591\u95ee\uff0c\u867d\u7136\u6211\u4eec\u6709\u4e2a .eh_frame \u5728\u8fd9\u91cc\uff0c\u4f46\u662f\u597d\u50cf\u4e5f\u8981\u901a\u8fc7 x29 \u5bc4\u5b58\u5668\u5411\u4e0a\u56de\u6eaf\uff0c\u5176\u5b9e\u4e0d\u7136\uff0c\u5f53\u7f16\u8bd1\u5668\u4fdd\u5b58 x29 \u7684\u503c\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 x29 \u8fdb\u884c\u56de\u6eaf\uff0c\u5f53\u5bc4\u5b58\u5668\u6ca1\u6709\u4fdd\u5b58 x29 \u503c\u7684\u65f6\u5019\uff0c\u4f1a\u8bb0\u5f55\u76f8\u5e94\u7684 SP \u5bc4\u5b58\u5668\u7684\u504f\u79fb\u3002\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u5728\u7f16\u8bd1\u9009\u9879\u4e2d\u589e\u52a0<code>-fomit-frame-pointer</code>\u3002</p> <pre><code>add_compile_options(-fomit-frame-pointer)\n</code></pre> <p>\u53ef\u4ee5\u4f18\u5316\u6389 FP \u5bc4\u5b58\u5668\uff0c\u8fd9\u4e2a\u65f6\u5019\u5728\u770b .eh_frame \u6bb5\u5c31\u662f\u4ee5 SP \u5bc4\u5b58\u5668\u4f5c\u4e3a\u504f\u79fb\u6807\u51c6\u4e86\u3002</p> <pre><code>00000018 0000000000000014 0000001c FDE cie=00000000 pc=000000000000f26c..000000000000f288\n   LOC           CFA\n000000000000f26c sp+0\n000000000000f270 sp+16\n\n00000030 0000000000000014 00000034 FDE cie=00000000 pc=000000000000f288..000000000000f43c\n   LOC           CFA      ra\n000000000000f288 sp+0     u\n000000000000f290 sp+128   c-16\n\n00000048 0000000000000014 0000004c FDE cie=00000000 pc=000000000000f43c..000000000000f510\n   LOC           CFA      ra\n000000000000f43c sp+0     u\n000000000000f444 sp+80    c-16\n\n00000060 0000000000000014 00000064 FDE cie=00000000 pc=000000000000f510..000000000000f570\n   LOC           CFA      ra\n000000000000f510 sp+0     u\n000000000000f518 sp+48    c-16\n</code></pre> <p>\u7528 Unwind \u8fd8\u6709\u4e00\u4e2a\u597d\u5904\u662f\uff0c\u5b83\u4e0d\u4ec5\u53ef\u4ee5\u505a\u6808\u56de\u6eaf\uff0c\u5b83\u53ef\u4ee5\u6062\u590d\u6240\u6709\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 Google \u7684 bionic \u987a\u4fbf\u7528\u5b83\u6765\u505a\u6808\u56de\u6eaf\u7684\u539f\u56e0\u3002 \u200b \u4f46\u662f\u901a\u8fc7 Unwind \u7684\u5b9e\u73b0\u539f\u7406\u6211\u4eec\u77e5\u9053\uff0c\u5b83\u4f9d\u8d56 .eh_frame \u6bb5\uff0c\u5728 so \u91cc\u65f6\uff0c\u4e00\u5207\u6b63\u5e38\uff0c\u4f46\u662f\u5f53\u8fd9\u4e2a\u65b9\u6cd5\u5728\u52a8\u6001\u4ee3\u7801\u4e2d\uff0c\u6bd4\u5982\u4e00\u4e2a\u865a\u62df\u673a\u7684\u5b57\u8282\u7801\u4e2d\uff0c\u5c31\u5931\u6548\u4e86\uff0c\u56e0\u4e3a\u52a8\u6001\u4ee3\u7801\u6839\u672c\u6ca1\u6709\u5c06\u81ea\u5df1\u7684\u4fe1\u606f\u7f16\u8bd1\u8fdb .eh_frame \u6bb5\u4e2d\uff0c\u8fd9\u65f6\u5019\u5c31\u8fd8\u9700\u8981\u7528\u8001\u672c\u884c\uff0c\u57fa\u4e8e FP \u5bc4\u5b58\u5668\u7684\u56de\u6eaf\u3002</p>"},{"location":"perf-opt/Android/memory/native-backtrace/#fp","title":"\u57fa\u4e8eFP\u9012\u5f52\u7684\u6808\u56de\u6eaf","text":"<p>\u8bf4\u8d77 FP \u7684\u9012\u5f52\u56de\u6eaf\u5176\u5b9e\u4e5f\u4e0d\u9ebb\u70e6\uff0c\u751a\u81f3\u6bd4 Unwind \u66f4\u7b80\u5355\u4e00\u4e9b\uff0c\u4f60\u53ea\u9700\u8981\u62ff\u5230 FP \u5bc4\u5b58\u5668\u7684\u503c\uff0c\u8fd9\u9700\u8981\u7528\u4e00\u70b9\u5185\u8054\u6c47\u7f16\u3002</p> <pre><code>void get_fp(unsigned long *fp) {\n#ifdef __aarch64__\n    __asm__ __volatile__ (\n    \"mov %0, x29 \\t\\n\"\n    :\"=r\"(*fp));\n#else\n    __asm__ __volatile__ (\n    \"mov %0, r7 \\t\\n\"\n    :\"=r\"(*fp));\n#endif\n}\n</code></pre> <p>\u7136\u540e\u4e00\u5c42\u5c42\u7684\u8fdb\u884c\u904d\u5386\u5c31\u884c\u4e86</p> <pre><code>size_t backtrace(FuncInfo * stack, size_t max)\n{\n    unsigned long fp = 0;\n    int depth = 0;\n    do {\n        if (stack == NULL) {\n            break;\n        }\n        get_fp(&amp;fp);\n        if (fp == 0) {\n            break;\n        }\n        for (depth = 0; (depth &lt; max) &amp;&amp; (0 != fp) &amp;&amp; (0 != *(unsigned long *)fp) &amp;&amp; (fp != *(unsigned long *)fp); ++depth) {\n            stack[depth].pc = (void *)(*(unsigned long *)(fp + sizeof(unsigned long)));\n            Dl_info info;\n\n            if (!dladdr(stack[depth].pc, &amp;info)) {\n                break;\n            }\n\n            if (!info.dli_fname) {\n                break;\n            }\n\n            if (info.dli_fname &amp;&amp; strstr(info.dli_fname, \"/data/app\") == NULL) {\n                break;\n            }\n\n            __android_log_print(ANDROID_LOG_INFO, \"backtrace\", \"pc %p\", stack[depth].pc);\n            __android_log_print(ANDROID_LOG_INFO, \"backtrace\", \"symbol %s\", info.dli_sname);\n\n            fp = *(unsigned long *)fp;\n        }\n    } while (false);\n    return depth;\n}\n</code></pre> <p></p> <p>\u8bf4\u5230\u8fd9\uff0c\u6211\u4eec\u518d\u6765\u6bd4\u8f83\u4e00\u4e0b\u57fa\u4e8e FP \u5bc4\u5b58\u5668\u7684\u56de\u6eaf\u548c\u57fa\u4e8e .eh_frame \u6bb5\u7684\u56de\u6eaf\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\u3002</p>"},{"location":"perf-opt/Android/memory/native-backtrace/#fp_1","title":"\u57fa\u4e8eFP\u5bc4\u5b58\u5668\u7684\u56de\u6eaf","text":"<ol> <li>\u6548\u7387\u9ad8</li> <li>\u4e0d\u80fd\u7a7f\u8fc7 JNI \u548c OAT</li> <li>\u5982\u679c\u7f16\u8bd1\u9009\u9879\u4e2d\u4f18\u5316\u6389\u4e86 FP \u5bc4\u5b58\u5668\uff0c\u5219\u4e0d\u80fd\u4f7f\u7528</li> </ol>"},{"location":"perf-opt/Android/memory/native-backtrace/#eh_frame_1","title":"\u57fa\u4e8e .eh_frame \u6bb5\u7684\u56de\u6eaf","text":"<ol> <li>\u89e3\u6790\u590d\u6742\u3001\u6548\u7387\u4f4e</li> <li>\u517c\u5bb9\u6027\u597d</li> <li>Android \u539f\u751f\u652f\u6301</li> <li>\u53ef\u4ee5\u6062\u590d\u6240\u6709\u901a\u7528\u5bc4\u5b58\u5668\u7684\u503c</li> </ol> <p>\u817e\u8baf\u6709\u4e2a\u5f00\u6e90\u9879\u76ee https://cloud.tencent.com/developer/article/1832287\uff0c\u4f18\u5316\u4e86\u7cfb\u7edf\u7684 Unwind_backtrace \u65b9\u6848\uff0c\u53ea\u6062\u590d PC \u5bc4\u5b58\u5668\u7684\u503c\uff0c\u5ffd\u7565\u5176\u4ed6\u5bc4\u5b58\u5668\u3002</p>"},{"location":"perf-opt/Android/memory/native-backtrace/#_3","title":"\u8e29\u5e73\u7684\u4e00\u4e9b\u5751","text":"<p>\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff0c\u662f\u56e0\u4e3a\u6211\u5728\u5751\u91cc\u6e38\u4e86\u4e00\u4f1a\u6cf3\uff0c\u9996\u5148\u7b2c\u4e00\u4e2a\u5751\u662f\u8fd9\u53e5\u4ee3\u7801\u3002</p> <pre><code>if (info.dli_fname &amp;&amp; strstr(info.dli_fname, \"/data/app\") == NULL) {\n    break;\n}\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u9650\u5236\u53ea\u5728 app \u81ea\u5df1\u7684 so \u4e2d\u904d\u5386\u7684\uff0c\u56e0\u4e3a android \u7684\u7cfb\u7edf\u5e93\u4e0d\u9075\u5faa FP \u7684\u89c4\u5219\uff0cFP \u5b58\u7684\u4e0d\u662f\u4e0a\u4e00\u7ea7\u6808\u5e95\u7684\u5730\u5740\uff0c\u8fd9\u4e2a\u901a\u8fc7\u6c47\u7f16\u53ef\u4ee5\u770b\u51fa\u6765\u3002 \u200b art_quick_generic_jni_trampoline \u5c06\u81ea\u5df1\u7684 x29 \u548c pc \u653e\u5728\u4e86 sp+0xd0 \u7684\u5730\u65b9\uff0c\u7136\u540e\u628a sp \u7ed9\u4e86 x29\u3002</p> <p></p> <p>\u6240\u4ee5\u5728 stringFromJNI \u51fd\u6570\u91cc\u9762\u62ff\u5230\u7684 x29 \u7684\u503c\u52a0\u4e0a 0xd0 \u624d\u662f\u5b58 pc \u7684\u5730\u65b9\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u8fd9\u91cc x29 \u5b58\u7684\u662f sp \u7684\u5730\u5740\uff0c\u6240\u4ee5\u5982\u679c\u60f3\u7a7f\u900f\u7cfb\u7edf\u51fd\u6570\uff0c\u8fd9\u91cc\u9700\u8981\u628a x29 \u7684\u503c\u52a0\u4e0a 0xd0\uff0c\u62ff\u5230\u7684\u503c\u624d\u662f pc\uff08x30\uff09\u7684\u5730\u5740\u3002 \u200b \u5f53\u7136\u4e86\uff0c\u6bcf\u4e00\u4e2a\u51fd\u6570\u6808\u5e27\u7684\u5927\u5c0f\u4e0d\u4e00\u6837\uff0c\u8fd9\u91cc\u9700\u8981\u52a0\u7684\u504f\u79fb\u4e5f\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u901a\u8fc7 FP \u56de\u6eaf\u904d\u5386\u5728\u8fd9\u91cc\u4f1a\u7279\u522b\u9ebb\u70e6\u3002</p> <p>\u5f53\u7136\u6211\u4eec\u4e00\u822c\u6ca1\u6709\u9700\u8981\u56de\u6eaf\u5230\u7cfb\u7edf\u51fd\u6570\u7684\u9700\u6c42\uff0c\u6240\u4ee5\u9047\u5230\u7cfb\u7edf\u51fd\u6570\u5c31\u76f4\u63a5\u8fd4\u56de\u4e86\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u5751\uff0c\u524d\u9762\u63d0\u8fc7\u73b0\u5728\u8fd9\u4e2a\u6808\u56de\u6eaf\u7684\u9700\u6c42\u662f\u5728\u52a8\u6001\u865a\u62df\u673a\u7684\u5b57\u8282\u7801\u91cc\uff0c\u6240\u4ee5\u4e0d\u51fa\u610f\u5916\uff0c\u52a8\u6001\u865a\u62df\u673a\u7684\u8c03\u7528\u94fe\u4e2d\u5e94\u8be5\u4e5f\u6709\u4e0d\u9075\u5faa FP \u56de\u6eaf\u6807\u51c6\u7684\u51fd\u6570\u5427\uff0c\u770b\u4e86\u4e00\u4e0b\uff0c\u4e0d\u51fa\u610f\u5916\u679c\u7136\u6709\u3002 </p> <p>\u8fd9\u4e2a\u5751\u600e\u4e48\u89e3\u51b3\u7684\u5176\u5b9e\u548c\u4e0a\u9762\u5bf9\u7cfb\u7edf\u5e93\u51fd\u6570\u7684\u5206\u6790\u7c7b\u4f3c\uff0c\u603b\u7ed3\u4e00\u4e0b\u5c31\u662f\u770b\u6c47\u7f16\u4ee3\u7801\uff0c\u8fd9\u4e2a\u51fd\u6570\u662f\u4e2a\u9759\u6001\u51fd\u6570\uff0c\u6808\u5e27\u56fa\u5b9a\u662f 0x70 \u5927\u5c0f\uff0c\u6240\u4ee5\u9047\u5230\u8fd9\u4e2a\u51fd\u6570\u7684\u65f6\u5019\uff0c\u5c31\u76f4\u63a5\u628a\u4e0a\u4e00\u7ea7\u7684 FP+0x70 \u8df3\u8fc7\uff0c\u53bb\u904d\u5386\u4e0b\u4e2a\u51fd\u6570\u3002\u56e0\u4e3a\u8fd9\u79cd\u975e\u6807\u51fd\u6570\u6bd4\u8f83\u5c11\uff0c\u6240\u4ee5\u8fd9\u4e2a workaround \u662f\u53ef\u884c\u7684\u3002</p>"},{"location":"perf-opt/Android/memory/native-backtrace/#references","title":"References","text":"<p>https://developer.aliyun.com/article/815064</p>"},{"location":"perf-opt/Android/net/log/","title":"\u7ebf\u4e0a\u7591\u96be\u95ee\u9898\u8be5\u5982\u4f55\u6392\u67e5\u548c\u8ddf\u8e2a\uff1f","text":"<p>\u201c95% \u4ee5\u4e0a\u7684\u5d29\u6e83\u90fd\u80fd\u89e3\u51b3\u6216\u8005\u89c4\u907f\uff0c\u5927\u90e8\u5206\u7684\u7cfb\u7edf\u5d29\u6e83\u4e5f\u662f\u5982\u6b64\u201d\uff0c\u8fd9\u662f\u6211\u5728\u4e13\u680f\u201c\u5d29\u6e83\u4f18\u5316\u201d\u4e2d\u66fe\u7ecf\u5938\u4e0b\u7684\u6d77\u53e3\u3002</p> <p>\u867d\u7136\u6536\u96c6\u4e86\u5c3d\u53ef\u80fd\u4e30\u5bcc\u7684\u5d29\u6e83\u73b0\u573a\uff0c\u4f46\u603b\u4f1a\u6709\u4e00\u4e9b\u60c5\u51b5\u662f\u4e8b\u5148\u6ca1\u6709\u9884\u6599\u5230\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u4ece\u5d29\u6e83\u65e5\u5fd7\u91cc\u627e\u5230\u539f\u56e0\u3002\u4e8b\u5b9e\u4e0a\u6211\u4eec\u9762\u4e34\u7684\u96be\u9898\u8fdc\u8fdc\u4e0d\u6b62\u5d29\u6e83\uff0c\u6bd4\u5982\u8bf4\u7528\u6237\u6295\u8bc9\u6587\u4ef6\u4e0b\u8f7d\u5230 99% \u4e4b\u540e\u65e0\u6cd5\u7ee7\u7eed\uff0c\u90a3\u5982\u4f55\u786e\u5b9a\u662f\u7528\u6237\u624b\u673a\u7f51\u7edc\u4e0d\u597d\uff0c\u662f\u540e\u53f0\u670d\u52a1\u5668\u51fa\u9519\uff0c\u8fd8\u662f\u5ba2\u6237\u7aef\u4ee3\u7801\u7684 Bug\uff1f</p> <p>\u6211\u4eec\u7684\u4e1a\u52a1\u903b\u8f91\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u5e94\u7528\u8fd0\u884c\u7684\u73af\u5883\u4e5f\u53d8\u5f97\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u56e0\u6b64\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\u603b\u4f1a\u9047\u5230\u5927\u5927\u5c0f\u5c0f\u7684\u7ebf\u4e0a\u7591\u96be\u95ee\u9898\u3002\u5bf9\u4e8e\u8fd9\u4e9b\u95ee\u9898\uff0c\u5982\u4f55\u5c06\u5b83\u4eec\u201c\u62bd\u4e1d\u5265\u8327\u201d\uff0c\u6709\u54ea\u4e9b\u6b66\u5668\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u5730\u6392\u67e5\u548c\u8ddf\u8e2a\u5462\uff1f</p>"},{"location":"perf-opt/Android/net/log/#_2","title":"\u7528\u6237\u65e5\u5fd7","text":"<p>\u5bf9\u4e8e\u7591\u96be\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u5206\u4e3a\u5d29\u6e83\u548c\u975e\u5d29\u6e83\u4e24\u7c7b\u3002\u4e00\u822c\u6709\u54ea\u4e9b\u4f20\u7edf\u7684\u6392\u67e5\u624b\u6bb5\u5462\uff1f</p> <p>\u672c\u5730\u5c1d\u8bd5\u590d\u73b0\u3002\u65e0\u8bba\u662f\u5d29\u6e83\u8fd8\u662f\u529f\u80fd\u6027\u7684\u95ee\u9898\uff0c\u53ea\u8981\u6709\u7a33\u5b9a\u7684\u590d\u73b0\u8def\u5f84\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u5728\u672c\u5730\u91c7\u7528\u5404\u79cd\u5404\u6837\u7684\u624b\u6bb5\u6216\u5de5\u5177\u8fdb\u884c\u53cd\u590d\u5206\u6790\u3002\u4f46\u662f\u771f\u6b63\u7684\u7591\u96be\u95ee\u9898\u5f80\u5f80\u90fd\u5f88\u96be\u590d\u73b0\uff0c\u5b83\u4eec\u53ef\u80fd\u8ddf\u7528\u6237\u673a\u578b\u3001\u672c\u5730\u5b58\u50a8\u6570\u636e\u7b49\u73af\u5883\u6709\u5173\u3002</p> <p>\u53d1\u4e34\u65f6\u5305\u6216\u8005\u7070\u5ea6\u5305\u3002\u5982\u679c\u53d1\u4e34\u65f6\u5305\u7ed9\u7528\u6237\uff0c\u6574\u4e2a\u8fc7\u7a0b\u7528\u6237\u914d\u5408\u7e41\u7410\uff0c\u800c\u4e14\u89e3\u51b3\u95ee\u9898\u7684\u65f6\u95f4\u4e5f\u4f1a\u5f88\u957f\u3002\u5f88\u591a\u65f6\u5019\u6211\u4eec\u6839\u672c\u65e0\u6cd5\u8054\u7cfb\u5230\u7528\u6237\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ea\u80fd\u901a\u8fc7\u53d1\u7ebf\u4e0a\u7070\u5ea6\u5305\u7684\u65b9\u5f0f\u3002\u4f46\u662f\u4e3a\u4e86\u4e00\u6b65\u6b65\u7f29\u5c0f\u95ee\u9898\u7684\u8303\u56f4\uff0c\u6211\u4eec\u53ef\u80fd\u53c8\u9700\u8981\u4e00\u6b21\u6b21\u5730\u7070\u5ea6\u3002</p> <p>\u6211\u4eec\u591a\u4e48\u5e0c\u671b\u80fd\u6709\u4e00\u4e9b\u201c\u6b66\u5668\u201d\uff0c\u5e2e\u52a9\u5de5\u7a0b\u5e08\u7528\u975e\u5e38\u4f4e\u7684\u6210\u672c\uff0c\u5728\u975e\u5e38\u77ed\u7684\u65f6\u95f4\u5185\uff0c\u5c3d\u53ef\u80fd\u5730\u6536\u96c6\u8db3\u591f\u4e30\u5bcc\u7684\u4fe1\u606f\uff0c\u66f4\u5feb\u901f\u5730\u6392\u67e5\u548c\u89e3\u51b3\u95ee\u9898\u3002</p> <p>1. Xlog</p> <p>\u5728\u65e5\u5e38\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u4f7f\u7528 Logcat \u65e5\u5fd7\u6765\u6392\u67e5\u5b9a\u4f4d\u4ee3\u7801\u4e2d\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u5bf9\u4e8e\u7ebf\u4e0a\u95ee\u9898\uff0c\u6211\u4eec\u4e5f\u5e0c\u671b\u53ef\u4ee5\u6709\u7528\u6237\u7684\u5b8c\u6574\u65e5\u5fd7\uff0c\u8fd9\u6837\u5373\u4f7f\u95ee\u9898\u4e0d\u80fd\u590d\u73b0\uff0c\u901a\u8fc7\u65e5\u5fd7\u4e5f\u53ef\u80fd\u5b9a\u4f4d\u5230\u5177\u4f53\u7684\u539f\u56e0\u3002\u6240\u8c13\u201c\u517b\u5175\u5343\u65e5\uff0c\u7528\u5175\u4e00\u65f6\u201d\uff0c\u5ba2\u6237\u7aef\u65e5\u5fd7\u53ea\u6709\u5f53\u51fa\u73b0\u95ee\u9898\u4e14\u4e0d\u5bb9\u6613\u590d\u73b0\u65f6\u624d\u4f1a\u4f53\u73b0\u51fa\u5b83\u7684\u91cd\u8981\u4f5c\u7528\u3002\u4f46\u662f\u4e3a\u4e86\u4fdd\u8bc1\u5173\u952e\u65f6\u523b\u6709\u65e5\u5fd7\u53ef\u7528\uff0c\u5c31\u9700\u8981\u4fdd\u8bc1\u7a0b\u5e8f\u6574\u4e2a\u751f\u547d\u5468\u671f\u5185\u90fd\u8981\u6253\u65e5\u5fd7\uff0c\u6240\u4ee5\u65e5\u5fd7\u65b9\u6848\u7684\u9009\u62e9\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u5728\u8fc7\u53bb\u56e0\u4e3a\u6027\u80fd\u548c\u53ef\u9760\u6027\u95ee\u9898\uff0c\u901a\u5e38\u6211\u4eec\u53ea\u9488\u5bf9\u67d0\u5c11\u90e8\u5206\u4eba\u52a8\u6001\u6253\u5f00\u65e5\u5fd7\u5f00\u5173\u3002\u90a3\u5982\u4f55\u5b9e\u73b0\u4e00\u5957\u9ad8\u6027\u80fd\u3001\u65e5\u5fd7\u4e0d\u4f1a\u4e22\u5931\u5e76\u4e14\u5b89\u5168\u7684\u65e5\u5fd7\u65b9\u6848\u5462\uff1f\u5fae\u4fe1\u5728 2014 \u5e74\u5c31\u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u9ad8\u6027\u80fd\u65e5\u5fd7\u6a21\u5757 Xlog\uff0c\u5e76\u4e14\u5728 2016 \u5e74\u4f5c\u4e3a Mars \u7684\u4e00\u90e8\u5206\u5f00\u6e90\u5230GitHub\u3002\u5173\u4e8e Xlog \u7684\u66f4\u591a\u5b9e\u73b0\u7ec6\u8282\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u6e90\u7801\u6216\u8005\u4f1a\u8bae\u5206\u4eab\u3002</p> <p>Xlog \u65b9\u6848\u7684\u51fa\u73b0\uff0c\u53ef\u4ee5\u8ba9\u5168\u91cf\u7528\u6237\u5168\u5929\u5019\u6253\u5f00\u65e5\u5fd7\uff0c\u4e5f\u4e0d\u9700\u8981\u62c5\u5fc3\u5bf9\u5e94\u7528\u6027\u80fd\u9020\u6210\u592a\u5927\u7684\u5f71\u54cd\u3002\u4f46\u662f Xlog \u53ea\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u65e5\u5fd7\u5de5\u5177\uff0c\u6700\u7ec8\u662f\u5426\u80fd\u89e3\u51b3\u6211\u4eec\u7684\u7ebf\u4e0a\u95ee\u9898\uff0c\u8fd8\u9700\u8981\u770b\u6211\u4eec\u5982\u4f55\u53bb\u4f7f\u7528\u5b83\u3002</p> <p>\u6240\u4ee5\u5fae\u4fe1\u5236\u5b9a\u4e86\u4e25\u683c\u7684\u65e5\u5fd7\u89c4\u8303\uff0c\u5b9a\u671f\u5bf9\u62c9\u53d6\u7684\u65e5\u5fd7\u4f5c\u89c4\u5219\u68c0\u67e5\uff0c\u4e00\u65e6\u53d1\u73b0\u6709\u8fdd\u53cd\u89c4\u5219\u7684\u60c5\u51b5\uff0c\u4f1a\u4f5c\u51fa\u4e00\u5b9a\u7684\u5904\u7f5a\u3002\u4e0b\u9762\u662f\u5176\u4e2d\u7684\u4e00\u4e9b\u65e5\u5fd7\u89c4\u8303\uff0c\u6211\u9009\u53d6\u4e00\u4e9b\u5206\u4eab\u7ed9\u4f60\u3002</p> <p></p> <p>\u65e5\u5fd7\u6253\u70b9\u6015\u6253\u592a\u591a\u4e5f\u6015\u592a\u5c11\uff0c\u62c5\u5fc3\u51fa\u73b0\u95ee\u9898\u6ca1\u6709\u8db3\u591f\u4e30\u5bcc\u7684\u4fe1\u606f\u53bb\u5b9a\u4f4d\u5206\u6790\u95ee\u9898\u3002\u5e94\u8be5\u6253\u591a\u5c11\u65e5\u5fd7\uff0c\u5982\u4f55\u53bb\u6253\u65e5\u5fd7\u5e76\u6ca1\u6709\u4e00\u4e2a\u975e\u5e38\u4e25\u683c\u7684\u51c6\u5219\uff0c\u8fd9\u9700\u8981\u6574\u4e2a\u56e2\u961f\u5728\u957f\u671f\u5b9e\u8df5\u4e2d\u6162\u6162\u53bb\u6478\u7d22\u3002\u5728\u6700\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u5927\u5bb6\u90fd\u4e0d\u91cd\u89c6\u4e5f\u4e0d\u613f\u610f\u53bb\u589e\u52a0\u5173\u952e\u4ee3\u7801\u7684\u65e5\u5fd7\uff0c\u4f46\u662f\u5f53\u6211\u4eec\u901a\u8fc7\u65e5\u5fd7\u5e73\u53f0\u89e3\u51b3\u4e86\u4e00\u4e9b\u7591\u96be\u95ee\u9898\u4ee5\u540e\uff0c\u56e2\u961f\u5185\u90e8\u7684\u6210\u529f\u6848\u4f8b\u8d8a\u6765\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u8fd9\u79cd\u4e60\u60ef\u4e5f\u5c31\u6162\u6162\u5efa\u7acb\u8d77\u6765\u4e86\u3002</p> <p>2. Logan</p> <p>\u5bf9\u4e8e\u79fb\u52a8\u5e94\u7528\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u6709\u5404\u79cd\u5404\u6837\u7684\u65e5\u5fd7\u7c7b\u578b\uff0c\u4f8b\u5982\u4ee3\u7801\u65e5\u5fd7\u3001\u5d29\u6e83\u65e5\u5fd7\u3001\u57cb\u70b9\u65e5\u5fd7\u3001\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u7b49\u3002\u7531\u4e8e\u4e0d\u540c\u7c7b\u578b\u7684\u65e5\u5fd7\u90fd\u6709\u81ea\u5df1\u7684\u7279\u70b9\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u65e5\u5fd7\u6bd4\u8f83\u5206\u6563\uff0c\u6bd4\u5982\u6211\u4eec\u8981\u67e5\u4e00\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u5728\u5404\u4e2a\u4e0d\u540c\u7684\u65e5\u5fd7\u5e73\u53f0\u67e5\u4e0d\u540c\u7684\u65e5\u5fd7\u3002\u7f8e\u56e2\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u63d0\u51fa\u4e86\u7edf\u4e00\u65e5\u5fd7\u5e73\u53f0\u7684\u601d\u8def\uff0c\u4e5f\u5728Github \u5f00\u6e90\u4e86\u81ea\u5df1\u7684\u79fb\u52a8\u7aef\u57fa\u7840\u65e5\u5fd7\u5e93 Logan\u3002</p> <p></p> <p>Logan \u6574\u5408\u4e86\u5404\u5f0f\u5404\u6837\u7684\u65e5\u5fd7\u5e73\u53f0\uff0c\u6253\u9020\u6210\u4e00\u4e2a\u7edf\u4e00\u7684\u65e5\u5fd7\u5e73\u53f0\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u5f00\u53d1\u4eba\u5458\u67e5\u627e\u95ee\u9898\u7684\u6548\u7387\u3002\u4e0d\u8fc7\u65e0\u8bba\u662f Logan \u8fd8\u662f Xlog\uff0c\u65e5\u5fd7\u4e00\u822c\u4f1a\u901a\u8fc7\u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f\u4e0a\u62a5\u3002</p> <p>Push \u62c9\u53d6\u3002\u901a\u8fc7\u63a8\u9001\u547d\u4ee4\uff0c\u53ea\u62c9\u53d6\u7279\u5b9a\u7528\u6237\u7684\u65e5\u5fd7\u3002</p> <p></p> <p>\u4e3b\u52a8\u4e0a\u62a5\u3002\u5728\u7528\u6237\u53cd\u9988\u95ee\u9898\u3001\u51fa\u73b0\u5d29\u6e83\u7b49\u4e00\u4e9b\u9884\u8bbe\u573a\u666f\uff0c\u4e3b\u52a8\u4e0a\u62a5\u65e5\u5fd7\u3002</p> <p></p> <p>\u5bf9\u4e8e\u7528\u6237\u65e5\u5fd7\uff0c\u6211\u4eec\u662f\u5426\u5df2\u7ecf\u505a\u5230\u5c3d\u5584\u5c3d\u7f8e\u4e86\uff1f\u624b\u52a8\u57cb\u70b9\u7684\u8986\u76d6\u8303\u56f4\u6709\u9650\uff0c\u5982\u679c\u5173\u952e\u4f4d\u7f6e\u6ca1\u6709\u9884\u5148\u57cb\u70b9\uff0c\u90a3\u53ef\u80fd\u5c31\u9700\u8981\u91cd\u65b0\u53d1\u5305\u3002\u6240\u4ee5\u7f8e\u56e2\u5728 Logan \u57fa\u7840\u4e0a\uff0c\u8fd8\u63a8\u51fa\u4e86Android \u52a8\u6001\u65e5\u5fd7\u7cfb\u7edf Holmes\u3002</p> <p></p> <p>Holmes \u7684\u5b9e\u73b0\u8ddf\u7f8e\u56e2\u7684 Robust \u70ed\u4fee\u590d\u601d\u8def\u5dee\u4e0d\u591a\uff0c\u9700\u8981\u5bf9\u6bcf\u4e2a\u65b9\u6cd5\u8fdb\u884c\u4e86\u63d2\u6869\u6765\u8bb0\u5f55\u65b9\u6cd5\u6267\u884c\u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u5728\u65b9\u6cd5\u7684\u5f00\u5934\u63d2\u5165\u4e00\u6bb5\u6869\u4ee3\u7801\uff0c\u5f53\u65b9\u6cd5\u8fd0\u884c\u7684\u65f6\u5019\u5c31\u4f1a\u8bb0\u5f55\u65b9\u6cd5\u7b7e\u540d\u3001\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u3001\u65f6\u95f4\u7b49\u5f62\u6210\u4e00\u6761\u5b8c\u6574\u7684\u6267\u884c\u4fe1\u606f\u3002\u4f46\u662f\u8fd9\u5957\u65b9\u6848\u6027\u80fd\u7684\u6280\u672f\u96be\u70b9\u6bd4\u8f83\u591a\uff0c\u4e00\u822c\u53ea\u4f1a\u52a8\u6001\u9488\u5bf9\u51fa\u73b0\u95ee\u9898\u7684\u7528\u6237\u5f00\u542f\u3002</p> <p>\u867d\u7136\u8fd9\u4e2a\u601d\u8def\u6709\u4e00\u5b9a\u7684\u542f\u53d1\u6027\uff0c\u4f46\u6211\u8ba4\u4e3a\u5176\u5b9e\u5e76\u4e0d\u592a\u5b9e\u7528\u3002\u4e00\u6765\uff0c\u5bf9\u6bcf\u4e2a\u65b9\u6cd5\u63d2\u6869\uff0c\u4f1a\u5bf9\u5b89\u88c5\u5305\u4f53\u79ef\u548c\u6027\u80fd\u9020\u6210\u5f88\u5927\u7684\u5f71\u54cd\uff0c\u5bfc\u81f4\u8fd9\u5957\u65b9\u6848\u8fc7\u4e8e\u7b28\u91cd\uff1b\u4e8c\u6765\uff0c\u5f88\u591a\u7591\u96be\u95ee\u9898\u90fd\u5177\u6709\u5076\u53d1\u6027\uff0c\u5f53\u7528\u6237\u51fa\u73b0\u95ee\u9898\u540e\uff0c\u518d\u53bb\u6253\u5f00\u7528\u6237\u65e5\u5fd7\uff0c\u53ef\u80fd\u4e5f\u4e0d\u80fd\u4fdd\u8bc1\u7528\u6237\u7684\u95ee\u9898\u53ef\u4ee5\u590d\u73b0\u3002</p>"},{"location":"perf-opt/Android/net/log/#_3","title":"\u52a8\u6001\u8c03\u8bd5","text":"<p>\u201c\u53ea\u8981\u4f60\u80fd\u5728\u672c\u5730\u590d\u73b0\uff0c\u6211\u5c31\u80fd\u89e3\u51b3\u201d\uff0c\u8fd9\u53ef\u80fd\u662f\u5f00\u53d1\u5bf9\u6d4b\u8bd5\u8bf4\u8fc7\u6700\u591a\u7684\u8bdd\u4e86\u3002\u5728\u672c\u5730\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u65e5\u5fd7\uff0c\u6216\u8005\u4f7f\u7528 Debugger\u3001GDB \u7b49\u8fd9\u6837\u7684\u8c03\u8bd5\u5de5\u5177\u53cd\u590d\u8fdb\u884c\u9a8c\u8bc1\u3002</p> <p>\u9488\u5bf9\u8fdc\u7a0b\u7528\u6237\uff0c\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u505a\u5230\u5177\u5907\u8ddf\u672c\u5730\u4e00\u6837\u7684\u52a8\u6001\u8c03\u8bd5\u80fd\u529b\uff0c\u60f3\u60f3\u90fd\u89c9\u5f97\u6fc0\u52a8\u4eba\u5fc3\u3002\u90a3\u6709\u6ca1\u6709\u65b9\u6848\u80fd\u5b9e\u73b0\u8fdc\u7a0b\u52a8\u6001\u8c03\u8bd5\u5462\uff1f</p> <p>1. \u8fdc\u7a0b\u8c03\u8bd5</p> <p>\u52a8\u6001\u8c03\u8bd5\uff0c\u53c8\u6216\u8005\u662f\u52a8\u6001\u8ddf\u8e2a\uff0c\u5b83\u4eec\u5c5e\u4e8e\u9ad8\u7ea7\u7684\u8c03\u8bd5\u6280\u672f\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5b83\u5e76\u4e0d\u662f\u4ec0\u4e48\u65b0\u9c9c\u7684\u8bdd\u9898\uff0c\u4f8b\u5982 Linux \u4e2d\u5927\u540d\u9f0e\u9f0e\u7684 DTrace \u548c SystemTap\u3001Java \u7684 BTrace\uff0c\u90fd\u662f\u975e\u5e38\u6210\u719f\u7684\u65b9\u6848\u3002\u6211\u63a8\u8350\u4f60\u4ed4\u7ec6\u9605\u8bfb\u300a\u52a8\u6001\u8c03\u8bd5\u6f2b\u8c08\u300b\u548c\u300aJava \u52a8\u6001\u8ffd\u8e2a\u6280\u672f\u63a2\u7a76\u300b\uff0c\u7279\u522b\u662f\u524d\u8005\uff0c\u8ba9\u6211\u6709\u975e\u5e38\u5927\u7684\u6536\u83b7\u3002</p> <p>\u5728 Android \u7aef\uff0c\u6211\u4eec\u80fd\u4e0d\u80fd\u5b9e\u73b0\u5bf9\u7528\u6237\u505a\u52a8\u6001\u8c03\u8bd5\u5462\uff1f\u5728\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u4e4b\u524d\uff0c\u8bf7\u5148\u6765\u601d\u8003\u4e00\u4e0b\u5e73\u65f6\u6211\u4eec\u901a\u8fc7 Android Studio \u8fdb\u884c\u8c03\u8bd5\u7684\u5e95\u5c42\u539f\u7406\u662f\u4ec0\u4e48\u3002</p> <p>\u5176\u5b9e\u6211\u4eec\u7684\u5b66\u4e60\u59d4\u5458\u9e4f\u98de\u4e4b\u524d\u5df2\u7ecf\u8bb2\u8fc7\u8fd9\u5757\u5185\u5bb9\u4e86\uff0c\u56de\u5230\u201cAndroid JVM TI \u673a\u5236\u8be6\u89e3\u201d\u4e2d\u8bf4\u5230\u7684 Debugger Architecture\u3002Java \u7684\u8c03\u8bd5\u6846\u67b6\u662f\u901a\u8fc7 JPDA\uff08Java Platform Debugger Architecture\uff0cJava \u5e73\u53f0\u8c03\u8bd5\u4f53\u7cfb\u7ed3\u6784\uff09\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u5957\u72ec\u7acb\u4e14\u5b8c\u6574\u7684\u8c03\u8bd5\u4f53\u7cfb\uff0c\u4e3b\u8981\u7531\u4ee5\u4e0b\u4e09\u90e8\u5206\u7ec4\u6210\uff1a</p> <p>JVM TI\uff1aJava \u865a\u62df\u673a\u5de5\u5177\u63a5\u53e3\uff08\u88ab\u8c03\u8bd5\u8005\uff09\u3002</p> <p>JDWP\uff1aJava \u8c03\u8bd5\u534f\u8bae\uff08\u901a\u9053\uff09\u3002</p> <p>JDI\uff1aJava \u8c03\u8bd5\u63a5\u53e3\uff08\u8c03\u8bd5\u8005\uff09\u3002</p> <p></p> <p>\u5982\u679c\u4f60\u60f3\u4e86\u89e3\u66f4\u591a\u5173\u4e8e Java \u8c03\u8bd5\u6846\u67b6\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u91cd\u65b0\u56de\u987e\u4e00\u4e0b\u201cAndroid JVM TI \u673a\u5236\u8be6\u89e3\u201d\u91cc\u7ed9\u51fa\u7684\u53c2\u8003\u94fe\u63a5\u3002</p> <p>\u5bf9\u4e8e Android \u6765\u8bf4\uff0c\u5b83\u7684\u8c03\u8bd5\u6846\u67b6\u4e5f\u662f\u5728 Java \u8c03\u8bd5\u6846\u67b6\u57fa\u7840\u4e0a\u8fdb\u884c\u7684\u6269\u5c55\uff0c\u4e3b\u8981\u5305\u62ec Android Studio\uff08JDI\uff09\u3001ddmlib\u3001adb server\u3001adb daemon\u3001Android \u5e94\u7528\u8fd9\u4e94\u4e2a\u7ec4\u6210\u90e8\u5206\u3002</p> <p></p> <p>\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u5bf9\u7528\u6237\u7684\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539\u5176\u4e2d\u7684\u4e24\u4e2a\u90e8\u5206\u3002</p> <p>JDWP\uff08\u4f20\u8f93\u901a\u9053\uff09\u3002\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528\u7cfb\u7edf adb \u7684\u65b9\u5f0f\uff0c\u800c\u662f\u5e0c\u671b\u5c06\u7528\u6237\u7684\u8c03\u8bd5\u4fe1\u606f\u7ecf\u8fc7\u7f51\u7edc\u901a\u9053\u53d1\u9001\u7ed9\u6211\u4eec\u3002</p> <p>JDI\uff08\u524d\u7aef\u5c55\u793a\uff09\u3002\u5bf9\u4e8e\u5ba2\u6237\u7aef\u8c03\u8bd5\u6570\u636e\u7684\u5c55\u793a\uff0c\u6211\u4eec\u4e0d\u592a\u5bb9\u6613\u76f4\u63a5\u590d\u7528 Android Studio\uff0c\u9700\u8981\u91cd\u65b0\u5b9e\u73b0\u81ea\u5df1\u7684\u6570\u636e\u5c55\u793a\u9875\u9762\u3002</p> <p>\u5173\u4e8e\u5177\u4f53\u5b9e\u73b0\u7684\u7ec6\u8282\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u7f8e\u56e2\u7684\u6587\u7ae0\u300aAndroid \u8fdc\u7a0b\u8c03\u8bd5\u7684\u63a2\u7d22\u4e0e\u5b9e\u73b0\u300b\uff0c\u6700\u7ec8\u6574\u4f53\u7684\u6d41\u7a0b\u5982\u4e0b\u3002</p> <p></p> <p>\u5f53\u7136\u4e0d\u540c\u4e8e\u672c\u5730 Debug \u5305\u7684\u8c03\u8bd5\uff0c\u5bf9\u4e8e\u7528\u6237\u8c03\u8bd5\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651\u5982\u4f55\u7a81\u7834 ProGuard \u548c Debugable \u7684\u5f71\u54cd\u3002\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u5957\u65b9\u6848\u6709\u975e\u5e38\u5927\u7684\u6280\u672f\u4ef7\u503c\uff0c\u53ef\u4ee5\u52a0\u6df1\u6211\u4eec\u5bf9 Java \u8c03\u8bd5\u6846\u67b6\u7684\u7406\u89e3\u3002\u4f46\u662f\u5b83\u5e76\u4e0d\u5b9e\u7528\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u7684\u573a\u666f\uff0c\u6211\u4eec\u5f88\u96be\u5728\u7528\u6237\u4e0d\u914d\u5408\u7684\u524d\u63d0\u4e0b\u505a\u597d\u8c03\u8bd5\u3002\u800c\u4e14\u8c03\u8bd5\u8fc7\u7a0b\u4e5f\u53ef\u80fd\u4f1a\u51fa\u73b0\u5404\u79cd\u5404\u6837\u7684\u60c5\u51b5\uff0c\u5e76\u4e0d\u5bb9\u6613\u63a7\u5236\u3002</p> <p>\u4e0d\u8fc7\u9000\u800c\u6c42\u5176\u6b21\uff0c\u901a\u8fc7\u8fd9\u4e2a\u601d\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u672c\u5730\u5b9e\u73b0\u201c\u65e0\u7ebf\u8c03\u8bd5\u201d\uff08\u65e0\u9700 adb\uff09\uff0c\u53c8\u6216\u8005\u662f\u5b9e\u73b0\u5bf9\u6df7\u6dc6\u5305\u7684\u8c03\u8bd5\u3002</p> <p>2. \u52a8\u6001\u90e8\u7f72</p> <p>\u5982\u679c\u8bf4\u8fdc\u7a0b\u8c03\u8bd5\u5e76\u4e0d\u5f88\u5b9e\u7528\uff0c\u90a3\u6709\u6ca1\u6709\u5176\u4ed6\u65b9\u6cd5\u8ba9\u7528\u6237\u611f\u77e5\u4e0d\u5230\u6211\u4eec\u5728\u8fdb\u884c\u8c03\u8bd5\u5462\uff1f</p> <p>\u7528\u6237\u65e0\u611f\u77e5\u3001\u4ee3\u7801\u66f4\u65b0\uff0c\u8fd9\u4e0d\u6b63\u662f\u52a8\u6001\u90e8\u7f72\u6240\u5177\u5907\u7684\u80fd\u529b\uff0c\u800c\u4e14\u52a8\u6001\u90e8\u7f72\u5929\u751f\u5c31\u975e\u5e38\u9002\u5408\u4f7f\u7528\u5728\u7591\u96be\u95ee\u9898\u7684\u6392\u67e5\u4e0a\u3002</p> <p>\u7cbe\u7ec6\u5316\u3002\u901a\u8fc7\u53d1\u5e03\u5e73\u53f0\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u9009\u62e9\u67d0\u4e9b\u95ee\u9898\u7528\u6237\u505a\u52a8\u6001\u66f4\u65b0\u3002\u4e5f\u53ef\u4ee5\u5708\u5b9a\u67d0\u4e00\u6279\u7528\u6237\uff0c\u4f8b\u5982\u67d0\u4e2a\u95ee\u9898\u53ea\u5728\u534e\u4e3a\u7684\u67d0\u6b3e\u673a\u578b\u51fa\u73b0\uff0c\u90a3\u6211\u53ef\u4ee5\u53ea\u9488\u5bf9\u534e\u4e3a\u7684\u8fd9\u6b3e\u673a\u578b\u4e0b\u53d1\u3002</p> <p>\u573a\u666f\u3002\u5bf9\u4e8e\u7591\u96be\u95ee\u9898\u7684\u6392\u67e5\uff0c\u6211\u4eec\u4e00\u822c\u53ea\u4f1a\u589e\u52a0\u65e5\u5fd7\u6216\u8005\u7b80\u5355\u4fee\u6539\u903b\u8f91\uff0c\u52a8\u6001\u90e8\u7f72\u5728\u8fd9\u4e2a\u573a\u666f\u662f\u5b8c\u5168\u53ef\u4ee5\u6ee1\u8db3\u7684\u3002</p> <p>\u53ef\u91cd\u590d\u3001\u53ef\u56de\u9000\u3002\u5bf9\u4e8e\u7591\u96be\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u53cd\u590d\u5c1d\u8bd5\u4e0d\u540c\u7684\u89e3\u51b3\u601d\u8def\uff0c\u52a8\u6001\u90e8\u7f72\u5b8c\u5168\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u9700\u6c42\u3002\u800c\u4e14\u5728\u95ee\u9898\u89e3\u51b3\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53ca\u65f6\u5c06\u65e0\u7528\u7684 Patch \u56de\u9000\u3002</p> <p></p> <p>\u6211\u8fd8\u8bb0\u5f97\u66fe\u7ecf\u4e3a\u4e86\u89e3\u51b3 libhw.so \u7684\u5d29\u6e83\u95ee\u9898\uff0c\u6211\u4eec\u5386\u7ecf\u4e00\u4e2a\u6708\uff0c\u4e00\u5171\u53d1\u5e03\u4e86 30 \u591a\u4e2a\u52a8\u6001\u90e8\u7f72\uff0c\u53cd\u590d\u5730\u589e\u52a0\u65e5\u5fd7\u3001\u589e\u52a0 Hook \u70b9\uff0c\u6700\u7ec8\u624d\u5f97\u4ee5\u89e3\u51b3\u3002</p> <p>3. \u8fdc\u7a0b\u63a7\u5236</p> <p>\u52a8\u6001\u90e8\u7f72\u5b58\u5728\u751f\u6548\u65f6\u95f4\u6bd4\u8f83\u6162\uff08\u51e0\u5206\u949f\u5230\u5341\u51e0\u5206\u949f\uff09\u3001\u65e0\u6cd5\u8986\u76d6 100% \u7528\u6237\uff08\u4fee\u6539 AndroidManifest \u6216\u8005\u7528\u6237\u624b\u673a\u6ca1\u6709\u5269\u4f59\u7a7a\u95f4\uff09\u7b49\u95ee\u9898\u3002\u5bf9\u4e8e\u4e00\u4e9b\u7279\u5b9a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u53d1\u9884\u8bbe\u89c4\u5219\u7684\u65b9\u5f0f\u6765\u5904\u7406\u3002</p> <p>\u7f51\u7edc\u8fdc\u7a0b\u8bca\u65ad\u662f\u4e00\u4e2a\u975e\u5e38\u7ecf\u5178\u7684\u4f8b\u5b50\uff0c\u5047\u5982\u6709\u4e2a\u7528\u6237\u53cd\u9988\u67d0\u4e2a\u7f51\u9875\u65e0\u6cd5\u6253\u5f00\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u672c\u5730\u6216\u8005\u8fdc\u7a0b\u4e0b\u53d1\u6307\u4ee4\u65b9\u5f0f\uff0c\u5bf9\u7528\u6237\u7684\u6574\u4e2a\u7f51\u7edc\u8bf7\u6c42\u8fc7\u7a0b\u505a\u5b8c\u6574\u7684\u68c0\u6d4b\uff0c\u770b\u770b\u662f\u4e0d\u662f\u7528\u6237\u7684\u7f51\u7edc\u95ee\u9898\uff0c\u662f\u4e0d\u662f DNS \u7684\u95ee\u9898\uff0c\u5728\u8bf7\u6c42\u7684\u54ea\u4e2a\u9636\u6bb5\u51fa\u9519\u4e86\uff0c\u9519\u8bef\u7801\u662f\u4ec0\u4e48\u7b49\u3002</p> <p></p> <p>Mars \u91cc\u9762\u4e5f\u6709\u4e00\u4e2a\u4e13\u95e8\u7684 SDT \u7f51\u7edc\u8bca\u65ad\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u987a\u4fbf\u56de\u987e\u4e00\u4e0b Mars \u6574\u4e2a\u77e5\u8bc6\u7ed3\u6784\u56fe\u3002</p> <p></p> <p>\u9664\u4e86\u7f51\u7edc\u7684\u8fdc\u7a0b\u8bca\u65ad\u4e4b\u5916\uff0c\u7f51\u7edc\u7591\u96be\u95ee\u9898\u7684\u6392\u67e5\u548c\u8ddf\u8e2a\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u8bdd\u9898\u3002\u5b83\u6d89\u53ca\u4e1a\u52a1\u8bf7\u6c42\u4ece\u57df\u540d\u89e3\u6790 / \u6d41\u91cf\u8c03\u5ea6\u5230\u4e1a\u52a1\u7edf\u4e00\u63a5\u5165\uff0c\u518d\u5230\u4e1a\u52a1\u8c03\u7528\u7684\u6574\u4e2a\u8bbf\u95ee\u94fe\u8def\uff0c\u5c5e\u4e8e\u5927\u7f51\u7edc\u5e73\u53f0\u7684\u4e00\u73af\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5ba2\u6237\u7aef\u751f\u6210\u7684 traceId\uff0c\u5c06\u7edf\u4e00\u6536\u96c6\u548c\u6574\u5408\u5ba2\u6237\u7aef\u65e5\u5fd7\u3001\u670d\u52a1\u7aef\u8c03\u7528\u65e5\u5fd7\u3001\u81ea\u5efa CDN \u7b49\u65e5\u5fd7\uff0c\u5efa\u7acb\u4ee5\u7528\u6237\u4e3a\u7ef4\u5ea6\u7684\u76d1\u63a7\u5e73\u53f0\uff0c\u63d0\u4f9b\u95ee\u9898\u5b9a\u4f4d\u529f\u80fd \u3002\u4f8b\u5982 Google \u7684 Dapper\u3001\u963f\u91cc\u7684 EagleEye\u3001\u5fae\u4fe1\u7684\u70b9\u51fb\u6d41\u5e73\u53f0\u3001QQ \u7684\u5168\u94fe\u8def\u76d1\u63a7\u5e73\u53f0\u7b49\uff0c\u90fd\u662f\u901a\u8fc7\u8fd9\u4e2a\u601d\u8def\u5b9e\u73b0\u7684\u3002</p> <p>\u7c7b\u4f3c\u7f51\u7edc\u8fdc\u7a0b\u8bca\u65ad\uff0c\u53c8\u6216\u8005\u662f\u5220\u9664\u67d0\u4e9b\u6587\u4ef6\u3001\u4e0a\u62a5\u67d0\u4e9b\u4fe1\u606f\uff0c\u8fd9\u4e9b\u9884\u8bbe\u89c4\u5219\u662f\u5efa\u7acb\u5728\u6211\u4eec\u5df2\u7ecf\u8e29\u8fc7\u67d0\u4e2a\u5751\uff0c\u6216\u8005\u66f4\u591a\u60c5\u51b5\u662f\u5df2\u7ecf\u65e0\u6570\u6b21\u8e29\u5230\u540c\u4e00\u4e2a\u5751\uff0c\u5e76\u4e14\u5fcd\u65e0\u53ef\u5fcd\uff0c\u624d\u4f1a\u642d\u5efa\u4e00\u5957\u76f8\u5e94\u7684\u8bca\u65ad\u89c4\u5219\u3002\u90a3\u6211\u4eec\u80fd\u4e0d\u80fd\u4e0d\u901a\u8fc7\u52a8\u6001\u90e8\u7f72\uff0c\u4e5f\u53ef\u4ee5\u7b80\u5355\u7684\u8c03\u7528\u67d0\u4e9b Java \u4ee3\u7801\u5462\uff1f</p> <p>\u8fd9\u4e2a\u65f6\u5019\u5c31\u4e0d\u5f97\u4e0d\u63d0\u5230\u975e\u5e38\u5f3a\u5927\u7684 Lua \u811a\u672c\u8bed\u8a00\uff0ciOS \u4e4b\u524d\u5927\u540d\u9f0e\u9f0e\u7684Wax \u70ed\u4fee\u590d\u3001\u817e\u8baf Unity3D \u7684\u70ed\u66f4\u65b0\u65b9\u6848\uff0c\u90fd\u662f\u4f7f\u7528 Lua \u6765\u5b9e\u73b0\u3002Lua \u7684 VM \u975e\u5e38\u5c0f\uff0c\u53ea\u6709 200KB \u4e0d\u5230\uff0c\u5145\u5206\u4fdd\u8bc1\u4e86\u65f6\u95f4\u548c\u5185\u5b58\u5f00\u9500\u7684\u53ef\u63a7\u3002\u6211\u4eec\u53ef\u4ee5\u5bf9\u76ee\u6807\u7528\u6237\u4e0b\u53d1\u6307\u4ee4\uff0c\u52a8\u6001\u5730\u6267\u884c\u4e00\u6bb5\u4ee3\u7801\u5e76\u5c06\u7ed3\u679c\u4e0a\u62a5\uff0c\u6216\u8005\u5728\u65b9\u6cd5\u8fd0\u884c\u7684\u65f6\u5019\u53bb\u83b7\u53d6\u67d0\u4e9b\u5bf9\u8c61\u3001\u53c2\u6570\u7684\u5feb\u7167\u4fe1\u606f\u3002</p> <p>\u4e0b\u9762\u662f Lua \u548c Android \u7684\u8c03\u7528\u4e8b\u4f8b\u3002</p> <pre><code>// lua\u811a\u672c\u51fd\u6570\nfunction setText(textView)\n\u200b    tv:setText(\"set by Lua.\"..s); //\u8fd9\u91cc\u7684s\u53d8\u91cf\u7531java\u6ce8\u5165\n\u200b    tv:setTextSize(30);\nend\n// android\u8c03\u7528\nlua.pushString( \"from java\" );   //\u538b\u5165\u6b32\u6ce8\u5165\u53d8\u91cf\u7684\u503c\nlua.setGlobal( \"s\" );            //\u538b\u5165\u53d8\u91cf\u540d\nlua.getGlobal( \"setText\" );      //\u83b7\u53d6Lua\u51fd\u6570\nlua.pushJavaObject( textView );  //\u538b\u5165\u53c2\u6570\nlua.pcall( 1, 0, 0 );            //\u6267\u884c\u51fd\u6570\n</code></pre> <p>\u5bf9\u4e8e Lua \u7684\u4f7f\u7528\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u5728 Android \u66f4\u52a0\u5bb9\u6613\u7684\u4f7f\u7528 Lua\uff0c\u4e5f\u6709\u4e0d\u5c11\u5f00\u6e90\u5e93\u5bf9 Lua \u505a\u4e86\u66f4\u597d\u7684\u5c01\u88c5\uff0c\u4f8b\u5982AndroLua\uff0c\u963f\u91cc\u4e5f\u6709\u4e00\u5957\u57fa\u4e8e Lua \u5b9e\u73b0\u7684\u52a8\u6001\u5316\u754c\u9762\u6846\u67b6LuaViewSDK\u3002</p> <p>\u7f8e\u56e2\u7684 Holmes \u4e5f\u5229\u7528 Lua \u589e\u52a0\u4e86 DB \u67e5\u8be2\u3001\u4e0a\u62a5\u666e\u901a\u6587\u672c\u3001ShardPreferences \u67e5\u8be2\u3001\u83b7\u53d6 Context \u5bf9\u8c61\u3001\u67e5\u8be2\u6743\u9650\u3001\u8ffd\u52a0\u57cb\u70b9\u5230\u672c\u5730\u3001\u4e0a\u4f20\u6587\u4ef6\u7b49\u7efc\u5408\u80fd\u529b\u3002\u6b63\u56e0\u4e3a Lua \u811a\u672c\u5982\u6b64\u5f3a\u5927\uff0c\u5f88\u591a\u5927\u5382 App \u4e5f\u90fd\u5728 Android \u4e2d\u96c6\u6210 Lua\u3002</p>"},{"location":"perf-opt/Android/net/log/#_4","title":"\u603b\u7ed3","text":"<p>\u5bf9\u4e8e\u7f8e\u56e2\u3001\u652f\u4ed8\u5b9d\u3001\u6dd8\u5b9d\u8fd9\u4e9b\u8d85\u7ea7\u5e94\u7528\u6765\u8bf4\uff0c\u4e0d\u540c\u7684\u5e73\u53f0\u3001\u4e0d\u540c\u7684\u4e1a\u52a1\u53ef\u80fd\u6709\u4e0a\u5343\u4eba\u540c\u65f6\u5728\u4e00\u4e2a\u5e94\u7528\u4e0a\u9762\u5f00\u53d1\u534f\u4f5c\u3002\u4e1a\u52a1\u91cf\u5927\u3001\u591a\u5730\u533a\u534f\u4f5c\u5f00\u53d1\u3001\u4e1a\u52a1\u7c7b\u578b\u591a\uff0c\u6bcf\u5f53\u51fa\u73b0\u95ee\u9898\u90fd\u4f1a\u611f\u5230\u8017\u65f6\u8017\u529b\uff0c\u5fc3\u529b\u4ea4\u7601\u3002</p> <p>\u6b63\u56e0\u4e3a\u53cd\u590d\u201c\u75db\u8fc7\u201d\uff0c\u624d\u4f1a\u6709\u4e86\u5fae\u4fe1\u7684\u7528\u6237\u65e5\u5fd7\u548c\u70b9\u51fb\u6d41\u5e73\u53f0\uff0c\u624d\u4f1a\u6709\u7f8e\u56e2\u7684 Logan \u548c Homles \u7edf\u4e00\u65e5\u5fd7\u7cfb\u7edf\u3002\u6240\u8c13\u56e2\u961f\u7684\u201c\u63d0\u8d28\u589e\u6548\u201d\uff0c\u5c31\u662f\u5bfb\u627e\u56e2\u961f\u4e2d\u8fd9\u4e9b\u75db\u70b9\uff0c\u601d\u8003\u5982\u4f55\u53bb\u6539\u8fdb\u3002\u65e0\u8bba\u662f\u6d41\u7a0b\u7684\u81ea\u52a8\u5316\uff0c\u8fd8\u662f\u5f00\u53d1\u65b0\u7684\u5de5\u5177\u3001\u65b0\u7684\u5e73\u53f0\uff0c\u90fd\u662f\u671d\u7740\u8fd9\u4e2a\u76ee\u6807\u524d\u8fdb\u3002</p>"},{"location":"perf-opt/Android/net/log/#_5","title":"\u53c2\u8003","text":"<p>\u6458\u81ea https://time.geekbang.org/column/article/85808</p>"},{"location":"perf-opt/Android/net/net_opt/","title":"\u7f51\u7edc\u4f18\u5316","text":""},{"location":"perf-opt/Android/net/net_opt/#1","title":"1. \u4f55\u4e3a\u7f51\u7edc\u4f18\u5316","text":"<p>\u4e00\u4e2a\u6570\u636e\u5305\u4ece\u624b\u673a\u51fa\u53d1\u8981\u7ecf\u8fc7\u65e0\u7ebf\u7f51\u7edc\u3001\u6838\u5fc3\u7f51\u7edc\u4ee5\u53ca\u5916\u90e8\u7f51\u7edc\uff08\u4e92\u8054\u7f51\uff09\uff0c\u624d\u80fd\u5230\u8fbe\u6211\u4eec\u7684\u670d\u52a1\u5668\u3002</p> <p></p> <p>\u90a3\u6574\u4e2a\u7f51\u7edc\u8bf7\u6c42\u7684\u901f\u5ea6\u4f1a\u8ddf\u54ea\u4e9b\u56e0\u7d20\u6709\u5173\u5462\uff1f</p> <p></p> <p>\u4ece\u4e0a\u9762\u8fd9\u5f20\u56fe\u4e0a\u770b\uff0c\u5ba2\u6237\u7aef\u7f51\u7edc\u5e93\u5b9e\u73b0\u3001\u670d\u52a1\u5668\u6027\u80fd\u4ee5\u53ca\u7f51\u7edc\u94fe\u8def\u7684\u8d28\u91cf\u90fd\u662f\u5f71\u54cd\u7f51\u7edc\u8bf7\u6c42\u901f\u5ea6\u7684\u56e0\u7d20\u3002</p> <p>\u5982\u679c\u8bf4\u901f\u5ea6\u662f\u5173\u952e\uff0c\u90a3\u5bf9\u7f51\u7edc\u4f20\u8f93\u901f\u5ea6\u6709\u51b3\u5b9a\u6027\u5f71\u54cd\u7684\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e24\u4e2a\u65b9\u9762\uff1a</p> <ul> <li>\u5ef6\u8fdf\uff1a\u6570\u636e\u4ece\u4fe1\u606f\u6e90\u53d1\u9001\u5230\u76ee\u7684\u5730\u6240\u9700\u7684\u65f6\u95f4\u3002</li> <li>\u5e26\u5bbd\uff1a\u903b\u8f91\u6216\u7269\u7406\u901a\u4fe1\u8def\u5f84\u6700\u5927\u7684\u541e\u5410\u91cf\u3002</li> </ul> <p>\u90a3\u5ef6\u8fdf\u548c\u5e26\u5bbd\u53c8\u8ddf\u4ec0\u4e48\u56e0\u7d20\u6709\u5173\u5462\uff1f\u8fd9\u91cc\u9762\u6d89\u53ca\u7684\u56e0\u7d20\u4e5f\u975e\u5e38\u591a\uff0c\u4f8b\u5982\u4fe1\u53f7\u7684\u5f3a\u5ea6\u3001\u9644\u8fd1\u6709\u6ca1\u6709\u57fa\u7ad9\u3001\u8ddd\u79bb\u6709\u591a\u8fdc\u7b49\uff1b\u8fd8\u8ddf\u4f7f\u7528\u7684\u7f51\u7edc\u5236\u5f0f\uff0c\u6b63\u5728\u4f7f\u7528 3G\u30014G \u8fd8\u662f 5G \u7f51\u7edc\u6709\u5173\uff0c\u5e76\u4e14\u7f51\u7edc\u7684\u62e5\u585e\u60c5\u51b5\u4e5f\u4f1a\u4ea7\u751f\u5f71\u54cd\uff0c\u6bd4\u5982\u662f\u4e0d\u662f\u5728\u51e0\u4e07\u4eba\u805a\u96c6\u7684\u5927\u578b\u6d3b\u52a8\u573a\u6240\u7b49\u3002</p> <p>\u4e0b\u9762\u662f\u4e0d\u540c\u7f51\u7edc\u5236\u5f0f\u7684\u5e26\u5bbd\u548c\u5ef6\u8fdf\u7684\u4e00\u822c\u53c2\u8003\u503c\u3002</p> <p></p> <p>\u5f53\u51fa\u73b0\u4e0a\u9762\u8bf4\u5230\u7684\u90a3\u4e9b\u56e0\u7d20\u65f6\uff0c\u7f51\u7edc\u8bbf\u95ee\u7684\u5e26\u5bbd\u8981\u5927\u6253\u6298\u6263\uff0c\u5ef6\u8fdf\u4f1a\u52a0\u500d\u653e\u5927\u3002\u800c\u9ad8\u5ef6\u8fdf\u3001\u4f4e\u5e26\u5bbd\u7684\u7f51\u7edc\u573a\u666f\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u201c\u5f31\u7f51\u7edc\u201d\uff0c\u5b83\u4e3b\u8981\u7279\u70b9\u6709\uff1a</p> <p></p> <p>\u53e6\u5916\u4e00\u4e2a\u65b9\u9762\uff0c\u4e0d\u540c\u7684\u5e94\u7528\u5bf9\u5ef6\u8fdf\u548c\u5e26\u5bbd\u7684\u4fa7\u91cd\u70b9\u53ef\u80fd\u4e0d\u592a\u4e00\u6837\u3002\u5bf9\u4e8e\u76f4\u64ad\u7c7b\u5e94\u7528\u6216\u8005\u201c\u738b\u8005\u8363\u8000\u201d\u6765\u8bf4\uff0c\u5ef6\u8fdf\u4f1a\u66f4\u91cd\u8981\u4e00\u4e9b\uff1b\u5bf9\u817e\u8baf\u89c6\u9891\u3001\u7231\u5947\u827a\u8fd9\u79cd\u70b9\u64ad\u7684\u5e94\u7528\u6765\u8bf4\uff0c\u5e26\u5bbd\u4f1a\u66f4\u52a0\u91cd\u8981\u4e00\u4e9b\u3002\u7f51\u7edc\u4f18\u5316\u9700\u8981\u7ed3\u5408\u81ea\u5df1\u5e94\u7528\u7684\u5b9e\u9645\u60c5\u51b5\u6765\u7efc\u5408\u8003\u8651\u3002</p> <p>\u6240\u8c13\u7684\u7f51\u7edc\u4f18\u5316\uff0c\u7a76\u7adf\u6307\u7684\u662f\u4ec0\u4e48\uff1f\u5728\u6211\u770b\u6765\uff0c\u6838\u5fc3\u5185\u5bb9\u6709\u4ee5\u4e0b\u4e09\u4e2a\uff1a</p> <ul> <li>\u901f\u5ea6\u3002\u5728\u7f51\u7edc\u6b63\u5e38\u6216\u8005\u826f\u597d\u7684\u65f6\u5019\uff0c\u600e\u6837\u66f4\u597d\u5730\u5229\u7528\u5e26\u5bbd\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u7f51\u7edc\u8bf7\u6c42\u901f\u5ea6\u3002</li> <li>\u5f31\u7f51\u7edc\u3002\u79fb\u52a8\u7aef\u7f51\u7edc\u590d\u6742\u591a\u53d8\uff0c\u5728\u51fa\u73b0\u7f51\u7edc\u8fde\u63a5\u4e0d\u7a33\u5b9a\u7684\u65f6\u5019\uff0c\u600e\u6837\u6700\u5927\u7a0b\u5ea6\u4fdd\u8bc1\u7f51\u7edc\u7684\u8fde\u901a\u6027\u3002</li> <li>\u5b89\u5168\u3002\u7f51\u7edc\u5b89\u5168\u4e0d\u5bb9\u5ffd\u89c6\uff0c\u600e\u6837\u6709\u6548\u9632\u6b62\u88ab\u7b2c\u4e09\u65b9\u52ab\u6301\u3001\u7a83\u542c\u751a\u81f3\u7be1\u6539\u3002</li> </ul> <p>\u90a3\u5bf9\u4e8e\u901f\u5ea6\u3001\u5f31\u7f51\u7edc\u4ee5\u53ca\u5b89\u5168\u7684\u4f18\u5316\uff0c\u53c8\u8be5\u4ece\u54ea\u4e9b\u65b9\u9762\u5165\u624b\u5462\uff1f\u9996\u5148\u4f60\u9700\u8981\u5148\u641e\u6e05\u695a\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002</p> <p></p> <p>\u4ece\u56fe\u4e0a\u770b\u5230\uff0c\u6574\u4e2a\u7f51\u7edc\u8bf7\u6c42\u4e3b\u8981\u5206\u4e3a\u51e0\u4e2a\u6b65\u9aa4\uff0c\u800c\u6574\u4e2a\u8bf7\u6c42\u7684\u8017\u65f6\u53ef\u4ee5\u7ec6\u5206\u5230\u6bcf\u4e00\u4e2a\u6b65\u9aa4\u91cc\u9762\u3002</p> <ul> <li>DNS \u89e3\u6790\u3002\u901a\u8fc7 DNS \u670d\u52a1\u5668\uff0c\u62ff\u5230\u5bf9\u5e94\u57df\u540d\u7684 IP \u5730\u5740\u3002\u5728\u8fd9\u4e2a\u6b65\u9aa4\uff0c\u6211\u4eec\u6bd4\u8f83\u5173\u6ce8 DNS \u89e3\u6790\u8017\u65f6\u60c5\u51b5\u3001\u8fd0\u8425\u5546 LocalDNS \u7684\u52ab\u6301\u3001DNS \u8c03\u5ea6\u8fd9\u4e9b\u95ee\u9898\u3002</li> <li>\u521b\u5efa\u8fde\u63a5\u3002\u8ddf\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u8fd9\u91cc\u5305\u62ec TCP \u4e09\u6b21\u63e1\u624b\u3001TLS \u5bc6\u94a5\u534f\u5546\u7b49\u5de5\u4f5c\u3002\u591a\u4e2a IP/ \u7aef\u53e3\u8be5\u5982\u4f55\u9009\u62e9\u3001\u662f\u5426\u8981\u4f7f\u7528 HTTPS\u3001\u80fd\u5426\u53ef\u4ee5\u51cf\u5c11\u751a\u81f3\u7701\u4e0b\u521b\u5efa\u8fde\u63a5\u7684\u65f6\u95f4\uff0c\u8fd9\u4e9b\u95ee\u9898\u90fd\u662f\u6211\u4eec\u4f18\u5316\u7684\u5173\u952e\u3002</li> <li>\u53d1\u9001 / \u63a5\u6536\u6570\u636e\u3002\u5728\u6210\u529f\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u8ddf\u670d\u52a1\u5668\u4ea4\u4e92\uff0c\u8fdb\u884c\u7ec4\u88c5\u6570\u636e\u3001\u53d1\u9001\u6570\u636e\u3001\u63a5\u6536\u6570\u636e\u3001\u89e3\u6790\u6570\u636e\u3002\u6211\u4eec\u5173\u6ce8\u7684\u662f\uff0c\u5982\u4f55\u6839\u636e\u7f51\u7edc\u72b6\u51b5\u5c06\u5e26\u5bbd\u5229\u7528\u597d\uff0c\u600e\u4e48\u6837\u5feb\u901f\u5730\u4fa6\u6d4b\u5230\u7f51\u7edc\u5ef6\u65f6\uff0c\u5728\u5f31\u7f51\u7edc\u4e0b\u5982\u4f55\u8c03\u6574\u5305\u5927\u5c0f\u7b49\u95ee\u9898\u3002</li> <li>\u5173\u95ed\u8fde\u63a5\u3002\u8fde\u63a5\u7684\u5173\u95ed\u770b\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u5176\u5b9e\u8fd9\u91cc\u7684\u6c34\u4e5f\u5f88\u6df1\u3002\u8fd9\u91cc\u4e3b\u8981\u5173\u6ce8\u4e3b\u52a8\u5173\u95ed\u548c\u88ab\u52a8\u5173\u95ed\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u822c\u6211\u4eec\u90fd\u5e0c\u671b\u5ba2\u6237\u7aef\u53ef\u4ee5\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u3002</li> </ul> <p>\u6240\u8c13\u7684\u7f51\u7edc\u4f18\u5316\uff0c\u5c31\u662f\u56f4\u7ed5\u901f\u5ea6\u3001\u5f31\u7f51\u7edc\u3001\u5b89\u5168\u8fd9\u4e09\u4e2a\u6838\u5fc3\u5185\u5bb9\uff0c\u51cf\u5c11\u6bcf\u4e00\u4e2a\u6b65\u9aa4\u7684\u8017\u65f6\uff0c\u6253\u9020\u5feb\u901f\u3001\u7a33\u5b9a\u4e14\u5b89\u5168\u7684\u9ad8\u8d28\u91cf\u7f51\u7edc\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#2","title":"2. \u7f51\u7edc\u5206\u6790\u5de5\u5177","text":""},{"location":"perf-opt/Android/net/net_opt/#21-gui","title":"2.1 GUI\u5de5\u5177","text":""},{"location":"perf-opt/Android/net/net_opt/#network-profiler","title":"Network Profiler","text":"<p>\u4f7f\u7528</p> <ol> <li>\u4f9d\u6b21\u70b9\u51fb View &gt; Tool Windows &gt; Profiler\uff08\u60a8\u4e5f\u53ef\u4ee5\u70b9\u51fb\u5de5\u5177\u680f\u4e2d\u7684  \u56fe\u6807 \uff09\u3002</li> <li>\u4ece Android Profiler \u5de5\u5177\u680f\u4e2d\u9009\u62e9\u8981\u5206\u6790\u7684\u8bbe\u5907\u548c\u5e94\u7528\u8fdb\u7a0b\u3002\u5982\u679c\u60a8\u5df2\u901a\u8fc7 USB \u8fde\u63a5\u8bbe\u5907\u4f46\u7cfb\u7edf\u672a\u5217\u51fa\u8be5\u8bbe\u5907\uff0c\u8bf7\u786e\u4fdd\u60a8\u5df2\u542f\u7528 USB \u8c03\u8bd5\u3002</li> <li>\u70b9\u51fb NETWORK \u65f6\u95f4\u8f74\u4e0a\u7684\u4efb\u610f\u4f4d\u7f6e\u4ee5\u6253\u5f00\u7f51\u7edc\u6027\u80fd\u5256\u6790\u5668\u3002</li> </ol> <p>\u7279\u70b9</p> <ol> <li>\u663e\u793a\u5b9e\u65f6\u7f51\u7edc\u6d3b\u52a8\uff1a\u53d1\u9001\u3001\u63a5\u6536\u6570\u636e\u53ca\u8fde\u63a5\u6570\u3002</li> <li>\u9700\u542f\u52a8\u9ad8\u7ea7\u5206\u6790\u3002</li> <li>\u4ec5\u652f\u6301 <code>HttpURLConnection</code> \u4e0e<code>OkHttp</code></li> </ol> <p>\u8bf4\u660e</p> <p>\u7a97\u53e3\u9876\u90e8\u663e\u793a\u4e8b\u4ef6\u65f6\u95f4\u8f74\u3002\u5728\u65f6\u95f4\u8f74 <code>(1)</code> \u4e0a\uff0c\u60a8\u53ef\u4ee5\u70b9\u51fb\u5e76\u62d6\u52a8\u4ee5\u9009\u62e9\u65f6\u95f4\u8f74\u7684\u4e00\u90e8\u5206\u6765\u68c0\u67e5\u7f51\u7edc\u6d41\u91cf\u3002</p> <p></p> <p>\u5728\u65f6\u95f4\u8f74\u4e0b\u65b9\u7684\u7a97\u683c <code>(2)</code> \u4e2d\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u4ee5\u4e0b\u67d0\u4e2a\u6807\u7b7e\u9875\uff0c\u4ee5\u8be6\u7ec6\u4e86\u89e3\u65f6\u95f4\u8f74\u4e0a\u9009\u5b9a\u65f6\u6bb5\u5185\u7684\u7f51\u7edc\u6d3b\u52a8\uff1a</p> <ul> <li><code>Connection View</code>\uff1a\u5217\u51fa\u4e86\u5728\u65f6\u95f4\u8f74\u4e0a\u9009\u5b9a\u65f6\u6bb5\u5185\u4ece\u60a8\u5e94\u7528\u7684\u6240\u6709 CPU \u7ebf\u7a0b\u53d1\u9001\u6216\u63a5\u6536\u7684\u6587\u4ef6\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u60a8\u53ef\u4ee5\u68c0\u67e5\u5927\u5c0f\u3001\u7c7b\u578b\u3001\u72b6\u6001\u548c\u4f20\u8f93\u65f6\u957f\u3002 \u60a8\u53ef\u4ee5\u901a\u8fc7\u70b9\u51fb\u4efb\u610f\u5217\u6807\u9898\u6765\u5bf9\u6b64\u5217\u8868\u6392\u5e8f\u3002\u60a8\u8fd8\u4f1a\u770b\u5230\u65f6\u95f4\u8f74\u4e0a\u9009\u5b9a\u65f6\u6bb5\u7684\u660e\u7ec6\u6570\u636e\uff0c\u4ece\u800c\u4e86\u89e3\u6bcf\u4e2a\u6587\u4ef6\u7684\u53d1\u9001\u6216\u63a5\u6536\u65f6\u95f4\u3002</li> <li><code>Thread View</code>\uff1a\u663e\u793a\u60a8\u5e94\u7528\u7684\u6bcf\u4e2a CPU \u7ebf\u7a0b\u7684\u7f51\u7edc\u6d3b\u52a8\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u60a8\u53ef\u4ee5\u5728\u6b64\u89c6\u56fe\u4e2d\u68c0\u67e5\u5404\u7f51\u7edc\u8bf7\u6c42\u7531\u5e94\u7528\u7684\u54ea\u4e9b\u7ebf\u7a0b\u8d1f\u8d23\u3002 </li> </ul> <p>\u4ece <code>Connection View</code> \u6216 <code>Thread View</code> \u4e2d\u70b9\u51fb\u8bf7\u6c42\u540d\u79f0\uff0c\u53ef\u68c0\u67e5\u6709\u5173\u5df2\u53d1\u9001\u6216\u5df2\u63a5\u6536\u6570\u636e\u7684\u8be6\u7ec6\u4fe1\u606f <code>(3)</code>\u3002\u70b9\u51fb\u5404\u4e2a\u6807\u7b7e\u9875\u53ef\u67e5\u770b\u54cd\u5e94\u6807\u5934\u548c\u6b63\u6587\u3001\u8bf7\u6c42\u6807\u5934\u548c\u6b63\u6587\u6216\u8c03\u7528\u5806\u6808\u3002</p> <p>\u5728 Response \u548c Request \u6807\u7b7e\u9875\u4e2d\uff0c\u70b9\u51fb View Parsed \u94fe\u63a5\u53ef\u663e\u793a\u683c\u5f0f\u5316\u6587\u672c\uff0c\u70b9\u51fb View Source \u94fe\u63a5\u53ef\u663e\u793a\u539f\u59cb\u6587\u672c\u3002</p> <p></p>"},{"location":"perf-opt/Android/net/net_opt/#charlesfiddler","title":"Charles/Fiddler","text":"<p>\u65e0\u8bba\u662f<code>Charles</code>\u8fd8\u662f<code>Fiddler</code>\uff0c\u90fd\u662f\u8bbe\u7f6e\u4ee3\u7406\u6293\u53d6http\u5305</p> <p>Mac\u4e0b\u4f7f\u7528\u7684\u6293\u5305&amp;Web\u8c03\u8bd5\u5de5\u5177\uff0c\u8be6\u7ec6\u4f7f\u7528\u89c1 Charles \u4f7f\u7528\u6559\u7a0b\u8be6\u89e3</p> <p>Window\u4e0b\u4f7f\u7528\u7684\u6293\u5305&amp;Web\u8c03\u8bd5\u5de5\u5177\uff0c\u8be6\u7ec6\u4f7f\u7528\u89c1Fiddler\u4f7f\u7528\u6559\u7a0b</p> <p>Charles\u548cFiddler\u90fd\u662f\u6536\u8d39\u8f6f\u4ef6\uff0c\u4f46\u662f\u53ef\u4ee5\u514d\u8d39\u8bd5\u7528, \u4e5f\u53ef\u4ee5\u4f7f\u7528\u5f00\u6e90\u7684mitmproxy\u4ee3\u66ff \u9002\u5408\u5206\u6790HTTP,HTTPS \u5176\u4e2dhttps\u6570\u636e \u53ef\u4ee5\u901a\u8fc7\u5b89\u88c5\u4e2d\u95f4\u4eba\u8bc1\u4e66\u6765\u89e3\u5bc6</p>"},{"location":"perf-opt/Android/net/net_opt/#wireshark","title":"Wireshark","text":"<p>\u9664\u4e86\u901a\u8fc7\u8bbe\u7f6e\u4ee3\u7406\u6293\u53d6http\u5305\u5916\uff0c\u8fd8\u6709\u53e6\u4e00\u79cd\u662f\u76f4\u63a5\u6293\u53d6\u7ecf\u8fc7\u7f51\u5361\u7684\u6240\u6709\u534f\u8bae\u5305\uff0c\u5176\u4e2d\u6700\u51fa\u540d\u5c31\u662f\u5927\u540d\u9f0e\u9f0e\u7684wireshark\u4ee5\u53calinux\u81ea\u5e26\u7684\u6293\u5305\u8f6f\u4ef6tcpdump\u3002tcpdump\u540e\u9762\u518d\u5c55\u5f00\u8bb2\u89e3\u3002\u8fd9\u91cc\u4e3b\u8981\u8bb2\u89e3wireshark\u7684\u4f7f\u7528\u3002</p> <p>\u7279\u70b9</p> <ol> <li>\u529f\u80fd\u5f3a\u5927\uff0c\u53ef\u4ee5\u6293\u53d6\u6240\u6709\u534f\u8bae\u7684\u5305, \u9002\u5408\u5206\u6790<code>TCP</code>,<code>UDP</code></li> <li>\u65e0\u6cd5\u5206\u6790https\u6570\u636e\u5305\uff0c\u7531\u4e8ewireshark\u662f\u5728\u94fe\u8def\u5c42\u83b7\u53d6\u7684\u6570\u636e\u5305\u4fe1\u606f\uff0c\u6240\u4ee5\u83b7\u53d6\u5230\u7684https\u5305\u662f\u52a0\u5bc6\u540e\u7684\u6570\u636e\uff0c\u56e0\u6b64\u65e0\u6cd5\u5206\u6790\u5305\u5185\u5bb9\u3002\u5f53\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9https\u6570\u636e\u5305\u8fdb\u884c\u89e3\u5bc6\uff0c \u4f46\u662f\u64cd\u4f5c\u5177\u6709\u4e00\u5b9a\u7684\u590d\u6742\u5ea6\uff0c\u53ef\u80fd\u8981\u6d88\u8017\u5f88\u591a\u65f6\u95f4\u3002</li> </ol> <p>\u8fc7\u6ee4\u8bed\u6cd5\u7b80\u5355\u4ecb\u7ecd</p> <p>wireshark\u7684\u8fc7\u6ee4\u8bed\u6cd5\u603b\u7ed3\u8d77\u6765\u5176\u5b9e\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4ee5\u534f\u8bae\u5f00\u5934\uff0c\u540e\u9762\u53ef\u4ee5\u8ddf\u7740\u534f\u8bae\u7684\u5c5e\u6027\uff0c\u7136\u540e\u52a0\u4e0a\u4e00\u4e9b\u5224\u65ad\u7b26\u53f7\uff0c\u6bd4\u5982contains\u3001==\u3001&gt;\u3001&lt;\u7b49\u7b49\u3002</p> <p>\u6bd4\u5982\u53ea\u60f3\u5c55\u793ahttp\u7684\u534f\u8bae\u5185\u5bb9\uff0c\u5219\u76f4\u63a5\u5728\u8fc7\u6ee4\u5668\u8f93\u5165\u6846\u4e2d\u8f93\u5165http\u5373\u53ef\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6bd4\u5982\u6211\u53ea\u60f3\u770bhttp\u534f\u8bae\u7684\u8bf7\u6c42\u5934\u4e2duri\u5305\u542b\u2019/api\u2019\u7684\u534f\u8bae\uff0c\u5c31\u53ef\u4ee5\u8fd9\u4e48\u5199\uff1a</p> <p></p> <p>\u5982\u679c\u60f3\u901a\u8fc7\u76ee\u6807ip\u6216\u8005\u6765\u6e90ip\u6765\u8fc7\u6ee4\u5305\uff0c\u5c31\u4e0d\u53ef\u4ee5\u4ee5http\u534f\u8bae\u4e3a\u524d\u7f00\u4e86\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u662fip\u534f\u8bae\u7684\u76f8\u5173\u5c5e\u6027\u3002\u901a\u8fc7\u76ee\u6807ip\u6765\u8fc7\u6ee4\u53ef\u4ee5\u8fd9\u4e48\u5199\uff1a</p> <p></p> <p>\u4e0a\u9762\u8868\u793a\u76ee\u6807\u673a\u5668\u7684ip\u662f61.135.217.100\u5e76\u4e14\u534f\u8bae\u662fhttp\u7684\u5305\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#22","title":"2.2 \u547d\u4ee4\u5de5\u5177","text":""},{"location":"perf-opt/Android/net/net_opt/#ping","title":"ping","text":"<p><code>ping</code>\u547d\u4ee4\u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u7f51\u7edc\u8fde\u901a\u6027</p> <p>\u6267\u884c <code>ping</code> \u6307\u4ee4\u4f1a\u4f7f\u7528 <code>ICMP</code> \u4f20\u8f93\u534f\u8bae\uff0c\u53d1\u51fa\u8981\u6c42\u56de\u5e94\u7684\u4fe1\u606f\uff0c\u82e5\u8fdc\u7aef\u4e3b\u673a\u7684\u7f51\u7edc\u529f\u80fd\u6ca1\u6709\u95ee\u9898\uff0c\u5c31\u4f1a\u56de\u5e94\u8be5\u4fe1\u606f\uff0c\u56e0\u800c\u5f97\u77e5\u8be5\u4e3b\u673a\u8fd0\u4f5c\u6b63\u5e38\u3002</p> <p>\u4ec0\u4e48\u662fICMP</p> <p>\u56e0\u7279\u7f51\u63a7\u5236\u62a5\u6587\u534f\u8bae<code>ICMP</code>\uff08<code>Internet Control Message Protocol</code>\uff09\u662f\u4e00\u4e2a\u5dee\u9519\u62a5\u544a\u673a\u5236\uff0c\u662f<code>TCP/IP</code>\u534f\u8bae\u7c07\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u5b50\u534f\u8bae\uff0c\u901a\u5e38\u88abIP\u5c42\u6216\u66f4\u9ad8\u5c42\u534f\u8bae\uff08TCP\u6216UDP\uff09\u4f7f\u7528\uff0c\u5c5e\u4e8e\u7f51\u7edc\u5c42\u534f\u8bae\uff0c\u4e3b\u8981\u7528\u4e8e\u5728IP\u4e3b\u673a\u548c\u8def\u7531\u5668\u4e4b\u95f4\u4f20\u9012\u63a7\u5236\u6d88\u606f\uff0c\u7528\u4e8e\u62a5\u544a\u4e3b\u673a\u662f\u5426\u53ef\u8fbe\u3001\u8def\u7531\u662f\u5426\u53ef\u7528\u7b49\u3002\u8fd9\u4e9b\u63a7\u5236\u6d88\u606f\u867d\u7136\u5e76\u4e0d\u4f20\u8f93\u7528\u6237\u6570\u636e\uff0c\u4f46\u662f\u5bf9\u4e8e\u6536\u96c6\u5404\u79cd\u7f51\u7edc\u4fe1\u606f\u3001\u8bca\u65ad\u548c\u6392\u9664\u5404\u79cd\u7f51\u7edc\u6545\u969c\u4ee5\u53ca\u7528\u6237\u6570\u636e\u7684\u4f20\u9012\u5177\u6709\u81f3\u5173\u91cd\u8981\u7684\u4f5c\u7528\u3002</p> <p>ping \u4f7f\u7528</p> <pre><code>ping -c 4 www.baidu.com\n</code></pre> <p><code>-c</code> \u53c2\u6570\u6307\u5b9a\u53d1\u9001\u7684\u6570\u636e\u5305\u6570\u91cf\uff0c<code>4</code> \u8868\u793a\u53d1\u9001 4 \u4e2a\u6570\u636e\u5305\u3002</p> <p>ping \u8f93\u51fa</p> <pre><code>PING www.a.shifen.com (163.177.151.110): 56 data bytes\n64 bytes from 163.177.151.110: icmp_seq=0 ttl=53 time=4.636 ms\n64 bytes from 163.177.151.110: icmp_seq=1 ttl=53 time=5.344 ms\n64 bytes from 163.177.151.110: icmp_seq=2 ttl=53 time=4.884 ms\n64 bytes from 163.177.151.110: icmp_seq=3 ttl=53 time=4.810 ms\n\n--- www.a.shifen.com ping statistics ---\n4 packets transmitted, 4 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 4.636/4.918/5.344/0.262 ms\n</code></pre> <ul> <li>bytes\u503c\uff1a\u6570\u636e\u5305\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u5b57\u8282\u3002</li> <li>time\u503c\uff1a\u54cd\u5e94\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u8d8a\u5c0f\uff0c\u8bf4\u660e\u4f60\u8fde\u63a5\u8fd9\u4e2a\u5730\u5740\u901f\u5ea6\u8d8a\u5feb\u3002</li> <li>ttl\u503c\uff1aTime To Live, \u751f\u5b58\u65f6\u95f4\uff0c\u6307\u793a\u4e86IP\u6570\u636e\u5305\u53ef\u4ee5\u7ecf\u8fc7\u6700\u5927\u7684\u8def\u7531\u5668\u6570\u91cf\uff0c\u5f53\u4e00\u4e2aip\u6570\u636e\u5305\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u8def\u7531\u5668\u65f6\uff0c\u8be5TTL\u7684\u503c\u5c31\u4f1a\u51cf1\uff0c\u5f53\u7ecf\u8fc7\u7684\u8def\u7531\u5668\u4e2a\u6570\u8d85\u8fc7TTL\u7684\u503c\u65f6\uff0c\u8be5IP\u6570\u636e\u5305\u5c31\u4f1a\u88ab\u8def\u7531\u5668\u629b\u5f03\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u6570\u636e\u5305\u5728\u7f51\u7edc\u4e2d\u65e0\u9650\u4f20\u8f93\u3002</li> </ul> <p>\u66f4\u591a\u5173\u4e8e <code>ping</code> \u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u53c2\u8003 ping\u547d\u4ee4</p>"},{"location":"perf-opt/Android/net/net_opt/#traceroute","title":"traceroute","text":"<p><code>traceroute</code>\u547d\u4ee4 \u7528\u4e8e\u8ffd\u8e2a\u6570\u636e\u5305\u5728\u7f51\u7edc\u4e0a\u7684\u4f20\u8f93\u65f6\u7684\u5168\u90e8\u8def\u5f84\uff0c\u5b83\u9ed8\u8ba4\u53d1\u9001\u7684\u6570\u636e\u5305\u5927\u5c0f\u662f40\u5b57\u8282\u3002</p> <p>\u901a\u8fc7traceroute\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4fe1\u606f\u4ece\u4f60\u7684\u8ba1\u7b97\u673a\u5230\u4e92\u8054\u7f51\u53e6\u4e00\u7aef\u7684\u4e3b\u673a\u662f\u8d70\u7684\u4ec0\u4e48\u8def\u5f84\u3002\u5f53\u7136\u6bcf\u6b21\u6570\u636e\u5305\u7531\u67d0\u4e00\u540c\u6837\u7684\u51fa\u53d1\u70b9\uff08source\uff09\u5230\u8fbe\u67d0\u4e00\u540c\u6837\u7684\u76ee\u7684\u5730(destination)\u8d70\u7684\u8def\u5f84\u53ef\u80fd\u4f1a\u4e0d\u4e00\u6837\uff0c\u4f46\u57fa\u672c\u4e0a\u6765\u8bf4\u5927\u90e8\u5206\u65f6\u5019\u6240\u8d70\u7684\u8def\u7531\u662f\u76f8\u540c\u7684\u3002</p> <p>traceroute\u901a\u8fc7\u53d1\u9001\u5c0f\u7684\u6570\u636e\u5305\u5230\u76ee\u7684\u8bbe\u5907\u76f4\u5230\u5176\u8fd4\u56de\uff0c\u6765\u6d4b\u91cf\u5176\u9700\u8981\u591a\u957f\u65f6\u95f4\u3002\u4e00\u6761\u8def\u5f84\u4e0a\u7684\u6bcf\u4e2a\u8bbe\u5907traceroute\u8981\u6d4b3\u6b21\u3002\u8f93\u51fa\u7ed3\u679c\u4e2d\u5305\u62ec\u6bcf\u6b21\u6d4b\u8bd5\u7684\u65f6\u95f4(ms)\u548c\u8bbe\u5907\u7684\u540d\u79f0\uff08\u5982\u6709\u7684\u8bdd\uff09\u53ca\u5176ip\u5730\u5740\u3002</p> <p>traceroute \u4f7f\u7528</p> <pre><code>traceroute www.58.com\ntraceroute to www.58.com (211.151.111.30), 30 hops max, 40 byte packets\n 1  unknown (192.168.2.1)  3.453 ms  3.801 ms  3.937 ms\n 2  221.6.45.33 (221.6.45.33)  7.768 ms  7.816 ms  7.840 ms\n 3  221.6.0.233 (221.6.0.233)  13.784 ms  13.827 ms 221.6.9.81 (221.6.9.81)  9.758 ms\n 4  221.6.2.169 (221.6.2.169)  11.777 ms 122.96.66.13 (122.96.66.13)  34.952 ms 221.6.2.53 (221.6.2.53)  41.372 ms\n 5  219.158.96.149 (219.158.96.149)  39.167 ms  39.210 ms  39.238 ms\n 6  123.126.0.194 (123.126.0.194)  37.270 ms 123.126.0.66 (123.126.0.66)  37.163 ms  37.441 ms\n 7  124.65.57.26 (124.65.57.26)  42.787 ms  42.799 ms  42.809 ms\n 8  61.148.146.210 (61.148.146.210)  30.176 ms 61.148.154.98 (61.148.154.98)  32.613 ms  32.675 ms\n 9  202.106.42.102 (202.106.42.102)  44.563 ms  44.600 ms  44.627 ms\n10  210.77.139.150 (210.77.139.150)  53.302 ms  53.233 ms  53.032 ms\n11  211.151.104.6 (211.151.104.6)  39.585 ms  39.502 ms  39.598 ms\n12  211.151.111.30 (211.151.111.30)  35.161 ms  35.938 ms  36.005 ms\n</code></pre> <p>\u8bb0\u5f55\u6309\u5e8f\u5217\u53f7\u4ece1\u5f00\u59cb\uff0c\u6bcf\u4e2a\u7eaa\u5f55\u5c31\u662f\u4e00\u8df3 \uff0c\u6bcf\u8df3\u8868\u793a\u4e00\u4e2a\u7f51\u5173\uff0c\u6211\u4eec\u770b\u5230\u6bcf\u884c\u6709\u4e09\u4e2a\u65f6\u95f4\uff0c\u5355\u4f4d\u662fms, \u662f\u63a2\u6d4b\u6570\u636e\u5305\u5411\u6bcf\u4e2a\u7f51\u5173\u53d1\u9001\u4e09\u4e2a\u6570\u636e\u5305\u540e\uff0c\u7f51\u5173\u54cd\u5e94\u540e\u8fd4\u56de\u7684\u65f6\u95f4\uff1b</p> <p>\u6709\u65f6\u6211\u4eectraceroute\u4e00\u53f0\u4e3b\u673a\u65f6\uff0c\u4f1a\u770b\u5230\u6709\u4e00\u4e9b\u884c\u662f\u4ee5\u661f\u53f7\u8868\u793a\u7684\u3002\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u53ef\u80fd\u662f\u9632\u706b\u5899\u5c01\u6389\u4e86ICMP\u7684\u8fd4\u56de\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u4e0d\u5230\u4ec0\u4e48\u76f8\u5173\u7684\u6570\u636e\u5305\u8fd4\u56de\u6570\u636e\u3002</p> <p>\u6709\u65f6\u6211\u4eec\u5728\u67d0\u4e00\u7f51\u5173\u5904\u5ef6\u65f6\u6bd4\u8f83\u957f\uff0c\u6709\u53ef\u80fd\u662f\u67d0\u53f0\u7f51\u5173\u6bd4\u8f83\u963b\u585e\uff0c\u4e5f\u53ef\u80fd\u662f\u7269\u7406\u8bbe\u5907\u672c\u8eab\u7684\u539f\u56e0\u3002\u5f53\u7136\u5982\u679c\u67d0\u53f0DNS\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u4e0d\u80fd\u89e3\u6790\u4e3b\u673a\u540d\u3001\u57df\u540d\u65f6\uff0c\u4e5f\u4f1a \u6709\u5ef6\u65f6\u957f\u7684\u73b0\u8c61\uff1b\u60a8\u53ef\u4ee5\u52a0-n\u53c2\u6570\u6765\u907f\u514dDNS\u89e3\u6790\uff0c\u4ee5IP\u683c\u5f0f\u8f93\u51fa\u6570\u636e\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#tcpdump","title":"tcpdump","text":"<p>tcpdump\u662flinux\u4e0a\u81ea\u5e26\u7684\u4e00\u4e2a\u6293\u5305\u8f6f\u4ef6(mac\u4e5f\u6709)\uff0c\u529f\u80fd\u5f3a\u5927\uff0c\u4e5f\u53ef\u4ee5\u6293\u53d6\u7ecf\u8fc7\u6307\u5b9a\u7f51\u5361\u7684\u6240\u6709\u534f\u8bae\u5305\u3002</p> <p>\u7531\u4e8e\u662f\u547d\u4ee4\u884c\u5de5\u5177\uff0ctcpdump\u6293\u53d6\u5230\u7684\u5305\u4e0d\u6613\u4e8e\u5206\u6790\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u5c06tcpdump\u6293\u5230\u7684\u5305\u8f93\u51fa\u5230\u67d0\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u5c06\u6587\u4ef6\u62f7\u8d1d\u4e0b\u6765\u7528wireshark\u5206\u6790\u3002</p> <p>tcpdump \u4f7f\u7528</p> <p>Android\u6ca1\u6709\u5185\u7f6e<code>tcpdump</code>\uff0c\u9700\u8981\u81ea\u5df1\u5b89\u88c5\uff0c\u540c\u65f6\u8981\u6c42\u624b\u673aroot\u6743\u9650\u3002</p> <ol> <li>\u4e0b\u8f7d tcpdump</li> <li>\u5c06 tcpdump \u653e\u5165\u624b\u673a\uff1a <code>adb push ~/tcpdump /data/local/tcpdump</code></li> <li>\u5c06 tcpdump \u7684\u6743\u9650\u53d8\u4e3a\u53ef\u6267\u884c\uff1a<code>chmod +x tcpdump</code></li> <li>\u5f00\u59cb\u6293\u5305\uff1a \u8b6c\u5982 <code>/data/local/tcpdump -vv -s 0 -w /mnt/sdcard/pcapture.pcap</code>\u3002\u5176\u4e2d <code>\"-s 0\"</code> \u8868\u793a\u6bcf\u4e2a\u5305\u90fd\u6293\u53d6\u5168\u90e8\u957f\u5ea6\uff0c\u800c\u4e0d\u662f\u90e8\u5206\u957f\u5ea6\uff1b<code>\"-w /mnt/sdcard/pcapture.pcap\"</code> \u8868\u793a\u6293\u53d6\u7684\u5305\u5199\u5165\u6307\u5b9a\u6587\u4ef6\uff1b<code>\"-vv\"</code> \u8868\u793a\u663e\u793a\u591a\u4e00\u4e9b\u4fe1\u606f\uff0c\u5982\u679c\u8981\u663e\u793a\u66f4\u591a\u4fe1\u606f\u53ef\u4ee5\u7528 <code>\"-vvv\"</code></li> <li>\u6309\u4e0b <code>\"contrl+c\"</code> \u7ed3\u675f\u6293\u5305\u3002</li> <li>\u5c06<code>\"/mnt/sdcard/pcapture.pcap\"</code>  \u62c9\u53d6\u5230\u7535\u8111\u4e0a\uff1a <code>adb pull /mnt/sdcard/pcapture.pcap &lt;\u6307\u5b9a\u76ee\u5f55&gt;</code></li> <li>\u901a\u8fc7 <code>Wireshark</code> \u6216\u8005 <code>charles</code>\u8fdb\u884c\u5206\u6790\u3002</li> </ol> <p>\u4e0a\u9762\u662f\u6b65\u9aa4\u6bd4\u8f83\u7e41\u7410\uff0c\u6bcf\u6b21\u90fd\u9700\u8981\u6293\u5305\u540e\u90fd\u9700\u8981\u62c9\u53d6\u5230\u7535\u8111\u4e0a\uff0c\u6709\u6ca1\u6709\u529e\u6cd5\u76f4\u63a5\u5728\u7535\u8111\u4e0a\u6293\u53bb\u624b\u673a\u7684\u5305\u5462\uff1f\u7b54\u6848\u662f\u6709\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>adb forward</code> \u547d\u4ee4\u5c06\u624b\u673a\u7684\u7aef\u53e3\u8f6c\u53d1\u5230\u7535\u8111\u4e0a\u3002\u57fa\u672c\u601d\u8def\u5982\u4e0b\u56fe</p> <p></p> <ol> <li>\u624b\u673a\u5f00\u59cb\u6293\u5305:\u5728 adb shell \u4e2d\u8fd0\u884c <code>/data/local/tcpdump -n -s 0 -w - | nc -l -p 12345</code></li> <li>\u5c06\u624b\u673a\u6293\u7684\u5305\u4f20\u9001\u5230\u7535\u8111\u7684 Wireshark \u4e2d: \u53e6\u5f00\u4e00\u4e2a\u7ec8\u7aef\u8fd0\u884c <code>adb forward tcp:12345 tcp:12345 &amp;&amp; nc 127.0.0.1 12345 | /Applications/Wireshark.app/Contents/MacOS/wireshark -k -S -i -</code></li> </ol> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u65f6\u6293\u53d6\u624b\u673a\u7684\u5305\u4e86\u3002</p> <p>\u66f4\u591a\u5173\u4e8e<code>tcpdump</code>\u7684\u4f7f\u7528\uff0c\u53ef\u4ee5\u53c2\u8003 tcpdump \u4f7f\u7528\u6307\u5357</p>"},{"location":"perf-opt/Android/net/net_opt/#3","title":"3. \u7f51\u7edc\u4f18\u5316","text":""},{"location":"perf-opt/Android/net/net_opt/#31","title":"3.1 \u9ad8\u8d28\u91cf\u7f51\u7edc\u5e93","text":"<p>\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u5f88\u5c11\u4f1a\u76f4\u63a5\u53bb\u64cd\u4f5c\u5e95\u5c42\u7684\u7f51\u7edc\u63a5\u53e3\uff0c\u4e00\u822c\u90fd\u4f1a\u4f7f\u7528\u7f51\u7edc\u5e93\u3002Square \u51fa\u54c1\u7684OkHttp\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684 Android \u7f51\u7edc\u5e93\uff0c\u5b83\u8fd8\u88ab Google \u52a0\u5165\u5230 Android \u7cfb\u7edf\u5185\u90e8\uff0c\u4e3a\u5e7f\u5927\u5f00\u53d1\u8005\u63d0\u4f9b\u7f51\u7edc\u670d\u52a1\u3002\u90a3\u7f51\u7edc\u5e93\u7a76\u7adf\u627f\u62c5\u7740\u4e00\u4e2a\u4ec0\u4e48\u6837\u7684\u89d2\u8272\u5462\uff1f\u5728\u6211\u770b\u6765\uff0c\u5b83\u5c4f\u853d\u4e86\u4e0b\u5c42\u590d\u6742\u7684\u7f51\u7edc\u63a5\u53e3\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u4f7f\u7528\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p>\u90a3\u7f51\u7edc\u5e93\u7a76\u7adf\u627f\u62c5\u7740\u4e00\u4e2a\u4ec0\u4e48\u6837\u7684\u89d2\u8272\u5462\uff1f\u5728\u6211\u770b\u6765\uff0c\u5b83\u5c4f\u853d\u4e86\u4e0b\u5c42\u590d\u6742\u7684\u7f51\u7edc\u63a5\u53e3\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u4f7f\u7528\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e00\u4e2a\u7f51\u7edc\u5e93\u7684\u6838\u5fc3\u4f5c\u7528\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u70b9\uff1a</p> <ul> <li>\u7edf\u4e00\u7f16\u7a0b\u63a5\u53e3\u3002\u65e0\u8bba\u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65\u8bf7\u6c42\uff0c\u63a5\u53e3\u90fd\u975e\u5e38\u7b80\u5355\u6613\u7528\u3002\u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u7edf\u4e00\u505a\u7b56\u7565\u7ba1\u7406\uff0c\u7edf\u4e00\u8fdb\u884c\u6d41\u89e3\u6790\uff08JSON\u3001XML\u3001Protocol Buffers\uff09\u7b49\u3002</li> <li>\u5168\u5c40\u7f51\u7edc\u63a7\u5236\u3002\u5728\u7f51\u7edc\u5e93\u5185\u90e8\u6211\u4eec\u53ef\u4ee5\u505a\u7edf\u4e00\u7684\u7f51\u7edc\u8c03\u5ea6\u3001\u6d41\u91cf\u76d1\u63a7\u4ee5\u53ca\u5bb9\u707e\u7ba1\u7406\u7b49\u5de5\u4f5c\u3002</li> <li>\u9ad8\u6027\u80fd\u3002\u65e2\u7136\u6211\u4eec\u628a\u6240\u6709\u7684\u7f51\u7edc\u8bf7\u6c42\u90fd\u4ea4\u7ed9\u4e86\u7f51\u7edc\u5e93\uff0c\u90a3\u7f51\u7edc\u5e93\u662f\u5426\u5b9e\u73b0\u9ad8\u6027\u80fd\u5c31\u81f3\u5173\u91cd\u8981\u3002\u65e2\u7136\u8981\u5b9e\u73b0\u9ad8\u6027\u80fd\uff0c\u90a3\u6211\u4f1a\u975e\u5e38\u5173\u6ce8\u901f\u5ea6\uff0cCPU\u3001\u5185\u5b58\u3001I/O \u7684\u4f7f\u7528\uff0c\u4ee5\u53ca\u5931\u8d25\u7387\u3001\u5d29\u6e83\u7387\u3001\u534f\u8bae\u7684\u517c\u5bb9\u6027\u7b49\u65b9\u9762\u3002</li> </ul> <p>\u4e0d\u540c\u7684\u7f51\u7edc\u5e93\u5b9e\u73b0\u5dee\u522b\u5f88\u5927\uff0c\u6bd4\u8f83\u5173\u952e\u6709\u8fd9\u51e0\u4e2a\u6a21\u5757\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u4e00\u8d77\u6765\u5bf9\u6bd4 OkHttp\u3001Chromium \u7684Cronet\u4ee5\u53ca\u5fae\u4fe1Mars\u8fd9\u4e09\u4e2a\u7f51\u7edc\u5e93\u7684\u5185\u90e8\u5b9e\u73b0\u3002</p> <p></p> <p>OkHttp</p> <p>OkHttp\u4e3b\u8981\u95ee\u9898\u662f\u5b83\u5e76\u4e0d\u652f\u6301\u8de8\u5e73\u53f0\uff0c\u5bf9\u4e8e\u5927\u578b\u5e94\u7528\u6765\u8bf4\u8de8\u5e73\u53f0\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u6211\u4eec\u4e0d\u5e0c\u671b\u6240\u6709\u7684\u4f18\u5316 Android \u548c iOS \u90fd\u8981\u5404\u81ea\u53bb\u5b9e\u73b0\u4e00\u5957\uff0c\u4e0d\u4ec5\u6d6a\u8d39\u4eba\u529b\u800c\u4e14\u8fd8\u5bb9\u6613\u51fa\u95ee\u9898\u3002</p> <p>Mars</p> <p>\u5bf9\u4e8e Mars \u6765\u8bf4\uff0c\u5b83\u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684 Socket \u5c42\u89e3\u51b3\u65b9\u6848\uff0c\u5e76\u4e0d\u652f\u6301\u5b8c\u6574\u7684 HTTP \u534f\u8bae\uff0c\u6240\u4ee5 Mars \u4ece\u4e25\u683c\u610f\u4e49\u4e0a\u6765\u8bb2\u5e76\u4e0d\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u7f51\u7edc\u5e93\u3002\u4f46\u662f\u5b83\u5728\u5f31\u7f51\u7edc\u548c\u8fde\u63a5\u4e0a\u505a\u4e86\u5927\u91cf\u7684\u4f18\u5316\uff0c\u5e76\u4e14\u652f\u6301\u957f\u8fde\u63a5\u3002\u5173\u4e8e Mars \u7684\u7f51\u7edc\u591a\u4f18\u5316\u7684\u66f4\u591a\u7ec6\u8282\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003Wiki\u3002</p> <p>Cronet</p> <p>Chromium \u7f51\u7edc\u5e93\u4f5c\u4e3a\u6807\u51c6\u7684\u7f51\u7edc\u5e93\uff0c\u57fa\u672c\u4e0a\u53ef\u4ee5\u8bf4\u662f\u627e\u4e0d\u5230\u592a\u5927\u7684\u7f3a\u70b9\u3002\u800c\u4e14\u6211\u4eec\u53ef\u4ee5\u4eab\u53d7 Google \u540e\u7eed\u7f51\u7edc\u4f18\u5316\u7684\u6210\u679c\uff0c\u7c7b\u4f3c TLS 1.3\u3001QUIC \u652f\u6301\u7b49\u3002\u4f46\u662f\u5b83\u9488\u5bf9\u5f31\u7f51\u7edc\u573a\u666f\u6ca1\u6709\u505a\u592a\u591a\u5b9a\u5236\u7684\u4f18\u5316\uff0c\u4e5f\u4e0d\u652f\u6301\u957f\u8fde\u63a5\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#_2","title":"\u5927\u7f51\u7edc\u5e73\u53f0","text":"<p>\u5bf9\u4e8e\u5927\u516c\u53f8\u6765\u8bf4\uff0c\u6211\u4eec\u4e0d\u80fd\u53ea\u5c40\u9650\u5728\u5ba2\u6237\u7aef\u7f51\u7edc\u5e93\u7684\u53cc\u7aef\u7edf\u4e00\u4e0a\u3002\u7f51\u7edc\u4f18\u5316\u4e0d\u4ec5\u4ec5\u662f\u5ba2\u6237\u7aef\u7684\u4e8b\u60c5\uff0c\u6240\u4ee5\u6211\u4eec\u6709\u4e86\u7edf\u4e00\u7684\u7f51\u7edc\u4e2d\u53f0\uff0c\u5b83\u8d1f\u8d23\u63d0\u4f9b\u524d\u540e\u53f0\u4e00\u6574\u5957\u7684\u7f51\u7edc\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u963f\u91cc\u7684ACCS\u3001\u8682\u8681\u7684mPaaS\u3001\u643a\u7a0b\u7684\u7f51\u7edc\u670d\u52a1\u90fd\u662f\u516c\u53f8\u7ea7\u7684\u7f51\u7edc\u4e2d\u53f0\u670d\u52a1\uff0c\u8fd9\u6837\u6240\u6709\u7684\u7f51\u7edc\u4f18\u5316\u53ef\u4ee5\u8ba9\u6574\u4e2a\u96c6\u56e2\u7684\u6240\u6709\u63a5\u5165\u5e94\u7528\u53d7\u76ca\u3002</p> <p>\u4e0b\u56fe\u662f mPaaS \u7684\u7f51\u7edc\u67b6\u6784\u56fe\uff0c\u6240\u6709\u7f51\u7edc\u8bf7\u6c42\u90fd\u4f1a\u5148\u7ecf\u8fc7\u7edf\u4e00\u7684\u63a5\u5165\u5c42\uff0c\u518d\u8f6c\u53d1\u5230\u4e1a\u52a1\u670d\u52a1\u5668\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5728\u4e1a\u52a1\u670d\u52a1\u5668\u65e0\u611f\u77e5\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u63a5\u5165\u5c42\u505a\u5404\u79cd\u5404\u6837\u7684\u7f51\u7edc\u4f18\u5316\u3002</p> <p></p>"},{"location":"perf-opt/Android/net/net_opt/#32-httpdns","title":"3.2 HTTPDNS","text":"<p>DNS \u7684\u89e3\u6790\u662f\u6211\u4eec\u7f51\u7edc\u8bf7\u6c42\u7684\u7b2c\u4e00\u9879\u5de5\u4f5c\uff0c\u9ed8\u8ba4\u6211\u4eec\u4f7f\u7528\u8fd0\u8425\u5546\u7684 LocalDNS \u670d\u52a1\u3002\u8fd9\u5757\u8017\u65f6\u5728 3G \u7f51\u7edc\u4e0b\u53ef\u80fd\u662f 200\uff5e300ms\uff0c4G \u7f51\u7edc\u4e5f\u9700\u8981 100ms\u3002</p> <p>\u89e3\u6790\u6162\u5e76\u4e0d\u662f\u9ed8\u8ba4 LocalDNS \u6700\u5927\u7684\u201c\u539f\u7f6a\u201d\uff0c\u5b83\u8fd8\u5b58\u5728\u4e00\u4e9b\u5176\u4ed6\u95ee\u9898\uff1a</p> <ul> <li>\u7a33\u5b9a\u6027\u3002UDP \u534f\u8bae\uff0c\u65e0\u72b6\u6001\uff0c\u5bb9\u6613\u57df\u540d\u52ab\u6301\uff08\u96be\u590d\u73b0\u3001\u96be\u5b9a\u4f4d\u3001\u96be\u89e3\u51b3\uff09\uff0c\u6bcf\u5929\u81f3\u5c11\u51e0\u767e\u4e07\u4e2a\u57df\u540d\u88ab\u52ab\u6301\uff0c\u4e00\u5e74\u81f3\u5c11\u5341\u6b21\u5927\u89c4\u6a21\u4e8b\u4ef6\u3002\u3001</li> <li>\u51c6\u786e\u6027\u3002LocalDNS \u8c03\u5ea6\u7ecf\u5e38\u51fa\u73b0\u4e0d\u51c6\u786e\uff0c\u6bd4\u5982\u5317\u4eac\u7684\u7528\u6237\u8c03\u5ea6\u5230\u5e7f\u4e1c IP\uff0c\u79fb\u52a8\u7684\u8fd0\u8425\u5546\u8c03\u5ea6\u5230\u7535\u4fe1\u7684 IP\uff0c\u8de8\u8fd0\u8425\u5546\u8c03\u5ea6\u4f1a\u5bfc\u81f4\u8bbf\u95ee\u6162\uff0c\u751a\u81f3\u8bbf\u95ee\u4e0d\u4e86\u3002</li> <li>\u53ca\u65f6\u6027\u3002\u8fd0\u8425\u5546\u53ef\u80fd\u4f1a\u4fee\u6539 DNS \u7684 TTL\uff0c\u5bfc\u81f4 DNS \u4fee\u6539\u751f\u6548\u5ef6\u8fdf\u3002\u4e0d\u540c\u8fd0\u8425\u5546\u7684\u670d\u52a1\u5b9e\u73b0\u4e0d\u4e00\u81f4\uff0c\u6211\u4eec\u4e5f\u5f88\u96be\u4fdd\u8bc1 DNS \u89e3\u6790\u7684\u8017\u65f6\u3002</li> </ul> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u5c31\u6709\u4e86 HTTPDNS\u3002\u7b80\u5355\u6765\u8bf4\u81ea\u5df1\u505a\u57df\u540d\u89e3\u6790\u7684\u5de5\u4f5c\uff0c\u901a\u8fc7 HTTP \u8bf7\u6c42\u540e\u53f0\u53bb\u62ff\u5230\u57df\u540d\u5bf9\u5e94\u7684 IP \u5730\u5740\uff0c\u76f4\u63a5\u89e3\u51b3\u4e0a\u8ff0\u6240\u6709\u95ee\u9898\u3002</p> <p>\u5bf9\u4e8e\u5927\u7f51\u7edc\u5e73\u53f0\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u6709\u7edf\u4e00\u7684 HTTPDNS \u670d\u52a1\uff0c\u5e76\u5c06\u5b83\u548c\u8fd0\u7ef4\u7cfb\u7edf\u6253\u901a\u3002\u5728\u4f20\u7edf\u7684 DNS \u57fa\u7840\u4e0a\uff0c\u8fd8\u4f1a\u589e\u52a0\u7cbe\u51c6\u7684\u6d41\u91cf\u8c03\u5ea6\u3001\u7f51\u7edc\u62e8\u6d4b / \u7070\u5ea6\u3001\u7f51\u7edc\u5bb9\u707e\u7b49\u529f\u80fd\u3002 </p> <p>\u7f51\u7edc\u62e8\u6d4b\u662f\u6307\u5728\u7f51\u7edc\u8bf7\u6c42\u524d\uff0c\u5148\u901a\u8fc7 HTTP \u8bf7\u6c42\u53bb\u62e8\u6d4b\u7f51\u7edc\u662f\u5426\u53ef\u7528\uff0c\u5982\u679c\u4e0d\u53ef\u7528\u5219\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\uff0c\u4e0d\u518d\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u3002\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25\u540e\u7684\u91cd\u8bd5\uff0c\u51cf\u5c11\u7f51\u7edc\u8bf7\u6c42\u7684\u8017\u65f6\u3002</p> <p>\u7f51\u7edc\u5bb9\u707e\u662f\u6307\u5728\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25\u540e\uff0c\u901a\u8fc7 HTTP \u8bf7\u6c42\u53bb\u62e8\u6d4b\u7f51\u7edc\u662f\u5426\u53ef\u7528\uff0c\u5982\u679c\u53ef\u7528\u5219\u91cd\u8bd5\u7f51\u7edc\u8bf7\u6c42\uff0c\u5982\u679c\u4e0d\u53ef\u7528\u5219\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25\u540e\u7684\u91cd\u8bd5\uff0c\u51cf\u5c11\u7f51\u7edc\u8bf7\u6c42\u7684\u8017\u65f6\u3002</p> <p>\u5173\u4e8e HTTPDNS \u7684\u66f4\u591a\u77e5\u8bc6\uff0c\u53ef\u4ee5\u53c2\u8003\u767e\u5ea6\u7684\u300aDNS \u4f18\u5316\u300b\u3002\u5bf9\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u9884\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c\u63d0\u524d\u62ff\u5230\u4e00\u6279\u57df\u540d\u7684 IP\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u9700\u8981\u6ce8\u610f IPv4 \u4e0e IPv6 \u534f\u8bae\u6808\u7684\u9009\u62e9\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#33","title":"3.3 \u8fde\u63a5\u590d\u7528","text":"<p>\u5728 DNS \u89e3\u6790\u4e4b\u540e\uff0c\u6211\u4eec\u6765\u5230\u4e86\u521b\u5efa\u8fde\u63a5\u8fd9\u4e2a\u73af\u8282\u3002\u521b\u5efa\u8fde\u63a5\u8981\u7ecf\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u3001TLS \u5bc6\u94a5\u534f\u5546\uff0c\u8fde\u63a5\u5efa\u7acb\u7684\u4ee3\u4ef7\u662f\u975e\u5e38\u5927\u7684\u3002\u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u7684\u4f18\u5316\u601d\u8def\u662f\u590d\u7528\u8fde\u63a5\uff0c\u8fd9\u6837\u4e0d\u7528\u6bcf\u6b21\u8bf7\u6c42\u90fd\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u6211\u4eec\u4f7f\u7528okhttp\u4e4b\u7c7b\u7684\u7f51\u7edc\u5e93\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fde\u63a5\u6c60\u6765\u590d\u7528\u8fde\u63a5\u3002\u7f51\u7edc\u5e93\u5e76\u4e0d\u4f1a\u7acb\u523b\u628a\u8fde\u63a5\u91ca\u653e\uff0c\u800c\u662f\u653e\u5230\u8fde\u63a5\u6c60\u4e2d\u3002\u8fd9\u65f6\u5982\u679c\u6709\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684\u57df\u540d\u548c\u7aef\u53e3\u662f\u4e00\u6837\u7684\uff0c\u5c31\u76f4\u63a5\u62ff\u51fa\u8fde\u63a5\u6c60\u4e2d\u7684\u8fde\u63a5\u8fdb\u884c\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\uff0c\u5c11\u4e86\u5efa\u7acb\u8fde\u63a5\u7684\u8017\u65f6\u3002</p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528HTTP \u534f\u8bae\u91cc\u7684 keep-alive\uff0c\u800c HTTP/2.0 \u7684\u591a\u8def\u590d\u7528\u5219\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7684\u63d0\u5347\u8fde\u63a5\u590d\u7528\u7387\u3002\u5b83\u590d\u7528\u7684\u8fd9\u6761\u8fde\u63a5\u652f\u6301\u540c\u65f6\u5904\u7406\u591a\u6761\u8bf7\u6c42\uff0c\u6240\u6709\u8bf7\u6c42\u90fd\u53ef\u4ee5\u5e76\u53d1\u5728\u8fd9\u6761\u8fde\u63a5\u4e0a\u8fdb\u884c\u3002</p> <p></p> <p>\u867d\u7136 H2 \u5341\u5206\u5f3a\u5927\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u8fd8\u6709\u4e24\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\u3002\u4e00\u4e2a\u662f\u540c\u4e00\u6761 H2 \u8fde\u63a5\u53ea\u652f\u6301\u540c\u4e00\u4e2a\u57df\u540d\uff0c\u4e00\u4e2a\u662f\u540e\u7aef\u652f\u6301 HTTP/2.0 \u9700\u8981\u989d\u5916\u7684\u6539\u9020\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u5728\u7edf\u4e00\u63a5\u5165\u5c42\u505a\u6539\u9020\uff0c\u63a5\u5165\u5c42\u5c06\u6570\u636e\u8f6c\u6362\u5230 HTTP/1.1 \u518d\u8f6c\u53d1\u5230\u5bf9\u5e94\u57df\u540d\u7684\u670d\u52a1\u5668\u3002</p> <p></p> <p>\u8fd9\u6837\u6240\u6709\u7684\u670d\u52a1\u90fd\u4e0d\u7528\u505a\u4efb\u4f55\u6539\u9020\u5c31\u53ef\u4ee5\u4eab\u53d7 HTTP/2.0 \u7684\u6240\u6709\u4f18\u5316\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f H2 \u7684\u591a\u8def\u590d\u7528\u5728\u672c\u8d28\u4e0a\u4f9d\u7136\u662f\u540c\u4e00\u6761 TCP \u8fde\u63a5\uff0c\u5982\u679c\u6240\u6709\u7684\u57df\u540d\u7684\u8bf7\u6c42\u90fd\u96c6\u4e2d\u5728\u67d0\u4e00\u6761\u8fde\u63a5\u4e2d\uff0c\u5728\u7f51\u7edc\u62e5\u585e\u7684\u65f6\u5019\u5bb9\u6613\u51fa\u73b0 TCP \u961f\u9996\u963b\u585e\u95ee\u9898\u3002</p> <p>\u5bf9\u4e8e\u5ba2\u6237\u7aef\u7f51\u7edc\u5e93\u6765\u8bf4\uff0c\u65e0\u8bba OkHttp \u8fd8\u662f Chromium \u7f51\u7edc\u5e93\u5bf9\u4e8e HTTP/2.0 \u7684\u8fde\u63a5\uff0c\u540c\u4e00\u4e2a\u57df\u540d\u53ea\u4f1a\u4fdd\u7559\u4e00\u6761\u8fde\u63a5\u3002\u5bf9\u4e8e\u4e00\u4e9b\u7b2c\u4e09\u65b9\u8bf7\u6c42\uff0c\u7279\u522b\u662f\u6587\u4ef6\u4e0b\u8f7d\u4ee5\u53ca\u89c6\u9891\u64ad\u653e\u8fd9\u4e9b\u573a\u666f\u53ef\u80fd\u4f1a\u9047\u5230\u5bf9\u65b9\u670d\u52a1\u5668\u5355\u8fde\u63a5\u9650\u901f\u7684\u95ee\u9898\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u7f51\u7edc\u5e93\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u7b80\u5355\u7684\u901a\u8fc7\u7981\u7528 HTTP/2.0 \u534f\u8bae\u89e3\u51b3\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#34","title":"3.4 \u538b\u7f29\u4e0e\u52a0\u5bc6","text":""},{"location":"perf-opt/Android/net/net_opt/#341","title":"3.4.1 \u538b\u7f29","text":"<p>\u600e\u4e48\u51cf\u5c11\u4f20\u8f93\u7684\u6570\u636e\u91cf\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u6570\u636e\u538b\u7f29\u3002\u9996\u5148\u5bf9\u4e8e HTTP \u8bf7\u6c42\u6765\u8bf4\uff0c\u6570\u636e\u4e3b\u8981\u5305\u62ec\u4e09\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>\u8bf7\u6c42 URL</li> <li>\u8bf7\u6c42 header</li> <li>\u8bf7\u6c42 body</li> </ul> <p>\u5bf9\u4e8e header \u6765\u8bf4\uff0c\u5982\u679c\u4f7f\u7528 HTTP/2.0 \u8fde\u63a5\u672c\u8eab\u7684\u5934\u90e8\u538b\u7f29\u6280\u672f\uff0c\u90a3\u4e48\u9700\u8981\u538b\u7f29\u7684\u4e3b\u8981\u662f\u8bf7\u6c42 URL \u548c\u8bf7\u6c42 body\u3002</p> <p>\u5bf9\u4e8e\u8bf7\u6c42 URL \u6765\u8bf4\uff0c\u4e00\u822c\u4f1a\u5e26\u5f88\u591a\u7684\u516c\u5171\u53c2\u6570\uff0c\u8fd9\u4e9b\u53c2\u6570\u5927\u90e8\u5206\u90fd\u662f\u4e0d\u53d8\u7684\u3002\u8fd9\u6837\u4e0d\u53d8\u7684\u53c2\u6570\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u4e0a\u4f20\u4e00\u6b21\u5373\u53ef\uff0c\u5176\u4ed6\u8bf7\u6c42\u6211\u4eec\u53ef\u4ee5\u5728\u63a5\u5165\u5c42\u4e2d\u8fdb\u884c\u53c2\u6570\u6269\u5c55\u3002</p> <p>\u5bf9\u4e8e\u8bf7\u6c42 body \u6765\u8bf4\uff0c\u4e00\u65b9\u9762\u662f\u6570\u636e\u901a\u4fe1\u534f\u8bae\u7684\u9009\u62e9\uff0c\u5728\u7f51\u7edc\u4f20\u8f93\u4e2d\u76ee\u524d\u6700\u6d41\u884c\u7684\u4e24\u79cd\u6570\u636e\u5e8f\u5217\u5316\u65b9\u5f0f\u662f <code>JSON</code> \u548c <code>Protocol Buffers</code>\u3002Protocol Buffers \u4f7f\u7528\u8d77\u6765\u66f4\u52a0\u590d\u6742\u4e00\u4e9b\uff0c\u4f46\u5728\u6570\u636e\u538b\u7f29\u7387\u3001\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u901f\u5ea6\u4e0a\u9762\u90fd\u6709\u5f88\u5927\u7684\u4f18\u52bf\u3002</p> <p>\u53e6\u5916\u4e00\u65b9\u9762\u662f\u538b\u7f29\u7b97\u6cd5\u7684\u9009\u62e9\uff0c\u901a\u7528\u7684\u538b\u7f29\u7b97\u6cd5\u4e3b\u8981\u662f\u5982 gzip\uff0cGoogle \u7684Brotli\u6216\u8005 Facebook \u7684Z-standard\u90fd\u662f\u538b\u7f29\u7387\u66f4\u9ad8\u7684\u7b97\u6cd5\u3002\u5176\u4e2d\u5982\u679c <code>Z-standard</code> \u901a\u8fc7\u4e1a\u52a1\u6570\u636e\u6837\u672c\u8bad\u7ec3\u51fa\u9002\u5408\u7684\u5b57\u5178\uff0c\u662f\u76ee\u524d\u538b\u7f29\u7387\u8868\u73b0\u6700\u597d\u7684\u7b97\u6cd5\u3002\u4f46\u662f\u5404\u4e2a\u4e1a\u52a1\u7ef4\u62a4\u5b57\u5178\u7684\u6210\u672c\u6bd4\u8f83\u5927</p> <p>\u5f53\u7136\u9488\u5bf9\u7279\u5b9a\u6570\u636e\u6211\u4eec\u8fd8\u6709\u5176\u4ed6\u7684\u538b\u7f29\u65b9\u6cd5\uff0c\u4f8b\u5982\u9488\u5bf9\u56fe\u7247\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>webp</code>\u3001<code>hevc</code>\u7b49\u538b\u7f29\u7387\u66f4\u9ad8\u7684\u683c\u5f0f</p>"},{"location":"perf-opt/Android/net/net_opt/#342","title":"3.4.2 \u52a0\u5bc6","text":"<p>\u6570\u636e\u5b89\u5168\u4e5f\u662f\u7f51\u7edc\u91cd\u4e2d\u4e4b\u91cd\u7684\u4e00\u4e2a\u73af\u8282\uff0c\u5728\u5927\u7f51\u7edc\u5e73\u53f0\u4e2d\u6211\u4eec\u90fd\u662f\u57fa\u4e8e HTTPS \u7684 HTTP/2 \u901a\u9053\uff0c\u5df2\u7ecf\u6709\u4e86 TLS \u52a0\u5bc6\u3002</p> <p>\u4f46\u662f HTTPS \u5e26\u6765\u7684\u4ee3\u4ef7\u4e5f\u662f\u4e0d\u5c0f\u7684\uff0c\u5b83\u9700\u8981 2-RTT \u7684\u534f\u5546\u6210\u672c\uff0c\u5728\u5f31\u7f51\u7edc\u4e0b\u65f6\u5ef6\u4e0d\u53ef\u63a5\u53d7\u3002\u540c\u65f6\u540e\u53f0\u670d\u52a1\u89e3\u5bc6\u7684\u6210\u672c\u4e5f\u5341\u5206\u9ad8\u6602\uff0c\u5728\u5927\u578b\u4f01\u4e1a\u4e2d\u9700\u8981\u5355\u72ec\u7684\u96c6\u7fa4\u6765\u505a\u8fd9\u4e2a\u4e8b\u60c5\u3002</p> <p>HTTPS \u7684\u4f18\u5316\u6709\u4e0b\u9762\u51e0\u4e2a\u601d\u8def\uff1a</p> <ul> <li>\u8fde\u63a5\u590d\u7528\u7387\u3002\u901a\u8fc7\u591a\u4e2a\u57df\u540d\u5171\u7528\u540c\u4e00\u4e2a HTTP/2 \u8fde\u63a5\u3001\u957f\u8fde\u63a5\u7b49\u65b9\u5f0f\u63d0\u5347\u8fde\u63a5\u590d\u7528\u7387\u3002</li> <li>\u51cf\u5c11\u63e1\u624b\u6b21\u6570\u3002TLS 1.3\u53ef\u4ee5\u5b9e\u73b0 0-RTT \u534f\u5546\uff0c\u4e8b\u5b9e\u4e0a\u5728 TLS 1.3 release \u4e4b\u524d\uff0c\u5fae\u4fe1\u7684mmtls\u3001Facebook \u7684fizz\u3001\u963f\u91cc\u7684 SlightSSL \u90fd\u5df2\u5728\u4f01\u4e1a\u5185\u90e8\u5927\u89c4\u6a21\u90e8\u7f72\u3002</li> <li>\u6027\u80fd\u63d0\u5347\u3002\u4f7f\u7528 ecc \u8bc1\u4e66\u4ee3\u66ff RSA\uff0c\u670d\u52a1\u7aef\u7b7e\u540d\u7684\u6027\u80fd\u53ef\u4ee5\u63d0\u5347 4\uff5e10 \u500d\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u6821\u9a8c\u6027\u80fd\u964d\u4f4e\u4e86\u7ea6 20 \u500d\uff0c\u4ece 10 \u5fae\u79d2\u7ea7\u964d\u4f4e\u5230 100 \u5fae\u79d2\u7ea7\u3002\u53e6\u5916\u4e00\u65b9\u9762\u53ef\u4ee5\u901a\u8fc7 Session Ticket \u4f1a\u8bdd\u590d\u7528\uff0c\u8282\u7701\u4e00\u4e2a RTT \u8017\u65f6\u3002</li> </ul> <p>\u4f7f\u7528 HTTPS \u4e4b\u540e\uff0c\u6574\u4e2a\u901a\u9053\u662f\u4e0d\u662f\u5c31\u4e00\u5b9a\u9ad8\u6795\u65e0\u5fe7\u5462\uff1f\u5982\u679c\u5ba2\u6237\u7aef\u8bbe\u7f6e\u4e86\u4ee3\u7406\uff0cTLS \u52a0\u5bc6\u7684\u6570\u636e\u53ef\u4ee5\u88ab\u89e3\u5f00\u5e76\u53ef\u80fd\u88ab\u5229\u7528 \u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5c06\u201c\u8bc1\u4e66\u9501\u5b9a\u201d\uff08Certificate Pinning\uff09\uff0c\u4e3a\u4e86\u8001\u7248\u672c\u517c\u5bb9\u548c\u8bc1\u4e66\u66ff\u6362\u7684\u7075\u6d3b\u6027\uff0c\u5efa\u8bae\u9501\u5b9a\u6839\u8bc1\u4e66\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5bf9\u4f20\u8f93\u5185\u5bb9\u505a\u4e8c\u6b21\u52a0\u5bc6\uff0c\u8fd9\u5757\u5728\u7edf\u4e00\u63a5\u5165\u5c42\u5b9e\u73b0\uff0c\u4e1a\u52a1\u670d\u52a1\u5668\u4e5f\u540c\u6837\u65e0\u9700\u5173\u5fc3\u8fd9\u4e2a\u6d41\u7a0b\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e8c\u6b21\u52a0\u5bc6\u4f1a\u589e\u52a0\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u7684\u5904\u7406\u8017\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5728\u5b89\u5168\u6027\u4e0e\u6027\u80fd\u4e4b\u95f4\u505a\u4e00\u4e2a\u53d6\u820d\u3002</p> <p></p>"},{"location":"perf-opt/Android/net/net_opt/#35","title":"3.5 \u5176\u4ed6\u4f18\u5316","text":"<p>\u5173\u4e8e\u7f51\u7edc\u4f18\u5316\u7684\u624b\u6bb5\u8fd8\u6709\u5f88\u591a\uff0c\u4e00\u4e9b\u65b9\u6848\u53ef\u80fd\u662f\u9700\u8981\u7528\u94b1\u5806\u51fa\u6765\u7684\uff0c\u6bd4\u5982<code>\u90e8\u7f72\u8de8\u56fd\u7684\u4e13\u7ebf</code>\u3001<code>\u52a0\u901f\u70b9</code>\uff0c<code>\u591a IDC \u5c31\u8fd1\u63a5\u5165</code>\u7b49\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u4f7f\u7528CDN \u670d\u52a1\u3001P2P \u6280\u672f\u4e5f\u662f\u6bd4\u8f83\u5e38\u7528\u7684\u624b\u6bb5\uff0c\u7279\u522b\u5728\u76f4\u64ad\u8fd9\u7c7b\u573a\u666f\u3002\u603b\u7684\u6765\u8bf4\uff0c\u7f51\u7edc\u4f18\u5316\u6211\u4eec\u9700\u8981\u7efc\u5408\u7528\u6237\u4f53\u9a8c\u3001\u5e26\u5bbd\u6210\u672c\u4ee5\u53ca\u786c\u4ef6\u6210\u672c\u7b49\u591a\u4e2a\u56e0\u7d20\u6765\u8003\u8651\u3002</p> <p>\u4e0b\u9762\u732e\u4e0a\u4e00\u5f20\u9ad8\u8d28\u91cf\u7f51\u7edc\u7684\u5168\u666f\u5927\u56fe\u3002</p> <p></p>"},{"location":"perf-opt/Android/net/net_opt/#36-quic-ipv6","title":"3.6 QUIC \u4e0e IPv6","text":""},{"location":"perf-opt/Android/net/net_opt/#361-quic","title":"3.6.1 QUIC","text":"<p>QUIC \u534f\u8bae\u7531 Google \u5728 2013 \u5e74\u5b9e\u73b0\uff0c\u5728 2018 \u5e74\u57fa\u4e8e QUIC \u534f\u8bae\u7684 HTTP \u66f4\u88ab\u786e\u8ba4\u4e3aHTTP/3\u3002\u5728\u8fde\u63a5\u590d\u7528\u4e2d\u524d\u9762\u8bf4\u8fc7 HTTP/2 + TCP \u4f1a\u5b58\u5728\u961f\u9996\u963b\u585e\u7684\u95ee\u9898\uff0c\u57fa\u4e8e UDP \u7684 QUIC \u624d\u662f\u7ec8\u6781\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4f60\u53ef\u4ee5\u628a QUIC \u7b80\u5355\u7406\u89e3\u4e3a HTTP/2.0 + TLS 1.3 + UDP\u3002</p> <p></p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u5b83\u8fd8\u6709\u7740\u5176\u4ed6\u7684\u5f88\u591a\u4f18\u52bf\uff1a</p> <ul> <li>\u7075\u6d3b\u63a7\u5236\u62e5\u585e\u534f\u8bae\u3002\u5982\u679c\u60f3\u5bf9 TCP \u5185\u90e8\u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u7b49\u6a21\u5757\u8fdb\u884c\u4f18\u5316\u548c\u5347\u7ea7\uff0c\u6574\u4f53\u5468\u671f\u662f\u76f8\u5bf9\u8f83\u957f\u7684\u3002\u5bf9\u4e8e UDP \u6765\u8bf4\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\uff0c\u968f\u65f6\u53ef\u6539\uff0c\u4f8b\u5982\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Google \u7684BBR \u7b97\u6cd5\u3002</li> <li>\u201c\u771f\u201d\u8fde\u63a5\u590d\u7528\u3002\u4e0d\u4ec5\u89e3\u51b3\u4e86\u961f\u9996\u963b\u585e\u7684\u95ee\u9898\uff0c\u5728\u5ba2\u6237\u7aef\u7f51\u7edc\u5207\u6362\u7684\u65f6\u5019\u4e5f\u4e0d\u9700\u8981\u91cd\u8fde\uff0c\u7528\u6237\u4f7f\u7528 App \u7684\u4f53\u9a8c\u4f1a\u66f4\u52a0\u6d41\u7545\u3002</li> </ul> <p>\u65e2\u7136 QUIC \u90a3\u4e48\u597d\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u5728\u751f\u4ea7\u73af\u5883\u6ca1\u6709\u5168\u90e8\u5207\u6362\u6210 QUIC \u5462\uff1f\u90a3\u662f\u56e0\u4e3a\u6709\u5f88\u591a\u5751\u8fd8\u6ca1\u6709\u8e29\u5b8c\uff0c\u76ee\u524d\u53d1\u73b0\u7684\u4e3b\u8981\u95ee\u9898\u8fd8\u6709\uff1a</p> <ul> <li>\u521b\u5efa\u8fde\u63a5\u6210\u529f\u7387\u3002\u4e3b\u8981\u662f UDP \u7684\u7a7f\u900f\u6027\u95ee\u9898\uff0cNAT \u5c40\u57df\u7f51\u8def\u7531\u3001\u4ea4\u6362\u673a\u3001\u9632\u706b\u5899\u7b49\u4f1a\u7981\u6b62 UDP 443 \u901a\u884c\uff0c\u76ee\u524d QUIC \u5728\u56fd\u5185\u5efa\u8fde\u7684\u6210\u529f\u7387\u5927\u7ea6\u5728 95% \u5de6\u53f3\u3002</li> <li>\u8fd0\u8425\u5546\u652f\u6301\u3002\u8fd0\u8425\u5546\u9488\u5bf9 UDP \u901a\u9053\u652f\u6301\u4e0d\u8db3\uff0c\u8868\u73b0\u4e5f\u4e0d\u7a33\u5b9a\u3002\u4f8b\u5982 QoS \u9650\u901f\u4e22\u5305\uff0c\u6709\u4e9b\u5c0f\u7684\u8fd0\u8425\u5546\u751a\u81f3\u8fd8\u76f4\u63a5\u4e0d\u652f\u6301 UDP \u5305\u3002</li> </ul> <p>\u5c3d\u7ba1\u6709\u8fd9\u6837\u90a3\u6837\u7684\u95ee\u9898\uff0c\u4f46\u662f QUIC \u4e00\u5b9a\u662f\u672a\u6765\u3002\u5f53\u7136\uff0c\u901a\u8fc7\u5927\u7f51\u7edc\u5e73\u53f0\u7684\u7edf\u4e00\u63a5\u5165\u5c42\uff0c\u6211\u4eec\u4e1a\u52a1\u57fa\u672c\u65e0\u9700\u505a\u4ec0\u4e48\u4fee\u6539\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#362-ipv6","title":"3.6.2 IPv6","text":"<p>IPv6 \u4e0d\u4ec5\u9488\u5bf9 IoT \u6280\u672f\uff0c\u5bf9\u4e07\u7269\u4e92\u8054\u7684\u65f6\u4ee3\u6709\u7740\u975e\u5e38\u5927\u7684\u610f\u4e49\u3002\u800c\u4e14\u5b83\u5bf9\u7f51\u7edc\u6027\u80fd\u4e5f\u6709\u6b63\u5411\u7684\u4f5c\u7528\uff0c\u5728\u5370\u5ea6\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u4f7f\u7528 IPv6 \u7f51\u7edc\u76f8\u6bd4 IPv4 \u8fde\u63a5\u8017\u65f6\u53ef\u4ee5\u964d\u4f4e 10%\uff5e20%\u3002\u63a8\u884c IPv6 \u540e\uff0c\u65e0\u7a77\u65e0\u5c3d\u7684 IP \u5730\u5740\u610f\u5473\u7740\u53ef\u4ee5\u544a\u522b\u5404\u79cd NAT\uff0cP2P\u3001QUIC \u7684\u8fde\u63a5\u4e5f\u4e0d\u518d\u662f\u95ee\u9898\u3002</p> <p>\u7531\u4e8eIPv4\u5730\u5740\u7a7a\u95f4\u7684\u9650\u5236\uff0c\u5f53\u524d\u7684Internet\u5fc5\u987b\u91c7\u7528\u6743\u5b9c\u4e4b\u8ba1\u89e3\u51b3\u65b9\u6848\u6765\u5e94\u5bf9\u5176\u8ba1\u5212\u5916\u7684\u6269\u5c55\uff1a\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff08NAT\uff09\u3002\u5b83\u4f7f\u591a\u4e2a\u7528\u6237\u548c\u8bbe\u5907\u53ef\u4ee5\u5171\u4eab\u76f8\u540c\u7684\u516c\u5171IP\u5730\u5740\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#4","title":"4. \u7f51\u7edc\u76d1\u63a7","text":"<p>\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u4ece\u624b\u673a\u5230\u540e\u53f0\u670d\u52a1\u5668\uff0c\u4f1a\u6d89\u53ca\u57fa\u7ad9\u3001\u5149\u7ea4\u3001\u8def\u7531\u5668\u8fd9\u4e9b\u786c\u4ef6\u8bbe\u65bd\uff0c\u4e5f\u4f1a\u8ddf\u8fd0\u8425\u5546\u548c\u670d\u52a1\u5668\u673a\u623f\u6709\u5173\u3002\u4e0d\u8bba\u662f\u57fa\u7ad9\u6545\u969c\u3001\u5149\u7ea4\u88ab\u6316\u65ad\u3001\u8fd0\u8425\u5546\u631f\u6301\uff0c\u8fd8\u662f\u6211\u4eec\u7684\u673a\u623f\u3001CDN \u670d\u52a1\u5546\u51fa\u73b0\u6545\u969c\uff0c\u90fd\u6709\u53ef\u80fd\u4f1a\u5f15\u8d77\u7528\u6237\u7f51\u7edc\u51fa\u73b0\u95ee\u9898\u3002\u4f60\u6709\u6ca1\u6709\u611f\u89c9\u7ebf\u4e0a\u7ecf\u5e38\u7a81\u53d1\u5404\u79cd\u5343\u5947\u767e\u602a\u7684\u7f51\u7edc\u95ee\u9898\uff0c\u5f88\u591a\u516c\u53f8\u7684\u8fd0\u7ef4\u4eba\u5458\u6bcf\u5929\u8fc7\u5f97\u80c6\u6218\u5fc3\u60ca\u3001\u75b2\u4e8e\u5954\u547d\u3002</p> <p>\u201c\u5584\u826f\u201d\u7684\u6545\u969c\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u83ab\u540d\u5176\u5999\u5c31\u597d\u4e86\uff0c\u201c\u987d\u56fa\u201d\u7684\u6545\u969c\u96be\u4ee5\u5b9a\u4f4d\u4e5f\u96be\u4ee5\u89e3\u51b3\u3002\u8fd9\u4e9b\u6545\u969c\u7a76\u7adf\u662f\u5982\u4f55\u4ea7\u751f\u7684\uff1f\u4e3a\u4ec0\u4e48\u7a81\u7136\u5c31\u6062\u590d\u4e86\uff1f\u5b83\u4eec\u5f71\u54cd\u4e86\u591a\u5c11\u7528\u6237\u3001\u54ea\u4e9b\u7528\u6237\uff1f\u60f3\u8981\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u79bb\u4e0d\u5f00\u9ad8\u8d28\u91cf\u7684\u7f51\u7edc\uff0c\u800c\u9ad8\u8d28\u91cf\u7684\u7f51\u7edc\u53c8\u79bb\u4e0d\u5f00\u5f3a\u5927\u7684\u76d1\u63a7\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#41","title":"4.1 \u5982\u4f55\u76d1\u63a7\u7f51\u7edc","text":""},{"location":"perf-opt/Android/net/net_opt/#411","title":"4.1.1 \u63d2\u6869","text":"<p>360 \u5f00\u6e90\u7684\u6027\u80fd\u76d1\u63a7\u5de5\u5177ArgusAPM\u5c31\u662f\u5229\u7528 Aspect \u5207\u6362\u63d2\u6869\uff0c\u5b9e\u73b0\u76d1\u63a7\u7cfb\u7edf\u548c OkHttp \u7f51\u7edc\u5e93\u7684\u8bf7\u6c42\u3002</p> <p>\u7cfb\u7edf\u7f51\u7edc\u5e93\u7684\u63d2\u6869\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003TraceNetTrafficMonitor\uff0c\u4e3b\u8981\u5229\u7528Aspect\u7684\u5207\u9762\u529f\u80fd\uff0c\u5173\u4e8e OkHttp \u7684\u62e6\u622a\u53ef\u4ee5\u53c2\u8003OkHttp3Aspect\uff0c\u5b83\u4f1a\u66f4\u52a0\u7b80\u5355\u4e00\u4e9b\uff0c\u56e0\u4e3a OkHttp \u672c\u8eab\u5c31\u6709\u4ee3\u7406\u673a\u5236\u3002</p> <pre><code>@Pointcut(\"call(public okhttp3.OkHttpClient build())\")\npublic void build() {\n}\n@Around(\"build()\")\npublic Object aroundBuild(ProceedingJoinPoint joinPoint) throws Throwable {\nObject target = joinPoint.getTarget();\nif (target instanceof OkHttpClient.Builder &amp;&amp;    Client.isTaskRunning(ApmTask.TASK_NET)) {\nOkHttpClient.Builder builder = (OkHttpClient.Builder) target;\nbuilder.addInterceptor(new NetWorkInterceptor());\n}\nreturn joinPoint.proceed();\n}\n</code></pre> <p>\u63d2\u6869\u7684\u65b9\u6cd5\u770b\u8d77\u6765\u5f88\u597d\uff0c\u4f46\u662f\u5e76\u4e0d\u5168\u9762\u3002\u5982\u679c\u4f7f\u7528\u7684\u4e0d\u662f\u7cfb\u7edf\u548c OkHttp \u7f51\u7edc\u5e93\uff0c\u53c8\u6216\u8005\u4f7f\u7528\u4e86 Native \u4ee3\u7801\u7684\u7f51\u7edc\u8bf7\u6c42\uff0c\u90fd\u65e0\u6cd5\u76d1\u63a7\u5230\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#412-native-hook","title":"4.1.2 Native Hook","text":"<p>\u7f51\u7edc\u76f8\u5173\u7684\u6211\u4eec\u4e00\u822c\u4f1a Hook \u4e0b\u9762\u51e0\u4e2a\u65b9\u6cd5 \uff1a</p> <ul> <li>\u8fde\u63a5\u76f8\u5173\uff1aconnect\u3002</li> <li>\u53d1\u9001\u6570\u636e\u76f8\u5173\uff1asend \u548c sendto\u3002</li> <li>\u63a5\u6536\u6570\u636e\u76f8\u5173\uff1arecv \u548c recvfrom\u3002</li> </ul> <p>Android \u5728\u4e0d\u540c\u7248\u672c Socket \u7684\u903b\u8f91\u4f1a\u6709\u90a3\u4e48\u4e00\u4e9b\u5dee\u5f02\uff0c\u4ee5 Android 7.0 \u4e3a\u4f8b\uff0cSocket \u5efa\u8fde\u7684\u5806\u6808\u5982\u4e0b\uff1a</p> <pre><code>java.net.PlainSocketImpl.socketConnect(Native Method)\njava.net.AbstractPlainSocketImpl.doConnect\njava.net.AbstractPlainSocketImpl.connectToAddress\njava.net.AbstractPlainSocketImpl.connect\njava.net.SocksSocketImpl.connect\njava.net.Socket.connect\ncom.android.okhttp.internal.Platform.connectSocket\ncom.android.okhttp.Connection.connectSocket\ncom.android.okhttp.Connection.connect\n</code></pre> <p>\u201csocketConnect\u201d\u65b9\u6cd5\u5bf9\u5e94\u7684 Native \u65b9\u6cd5\u5b9a\u4e49\u5728PlainSocketImpl.c\uff0c\u67e5\u770bmakefile\u53ef\u4ee5\u77e5\u9053\u5b83\u4eec\u4f1a\u7f16\u8bd1\u5728 libopenjdk.so \u4e2d\u3002\u4e0d\u8fc7\u5728 Android 8.0\uff0c\u6574\u4e2a\u8c03\u7528\u6d41\u7a0b\u53c8\u5b8c\u5168\u6539\u53d8\u4e86\u3002\u4e3a\u4e86\u517c\u5bb9\u6027\u8003\u8651\uff0c\u6211\u4eec\u76f4\u63a5 PLT Hook \u5185\u5b58\u7684\u6240\u6709 so\uff0c\u4f46\u662f\u9700\u8981\u6392\u9664\u6389 Socket \u51fd\u6570\u672c\u8eab\u6240\u5728\u7684 libc.so\u3002</p> <pre><code>hook_plt_method_all_lib(\"libc.so\", \"connect\", (hook_func) &amp;create_hook);\nhook_plt_method_all_lib(\"libc.so, \"send\", (hook_func) &amp;send_hook);\nhook_plt_method_all_lib(\"libc.so\", \"recvfrom\", (hook_func) &amp;recvfrom_hook);\n...\n</code></pre> <p>\u8fd9\u79cd\u505a\u6cd5\u4e0d\u597d\u7684\u5730\u65b9\u5728\u4e8e\u4f1a\u628a\u7cfb\u7edf\u7684 Local Socket \u4e5f\u540c\u65f6\u63a5\u7ba1\u4e86\uff0c\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u589e\u52a0\u8fc7\u6ee4\u6761\u4ef6\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#413","title":"4.1.3 \u7edf\u4e00\u7f51\u7edc\u5e93","text":"<p>\u5c3d\u7ba1\u62ff\u5230\u4e86\u6240\u6709\u7684\u7f51\u7edc\u8c03\u7528\uff0c\u60f3\u60f3\u4f1a\u6709\u54ea\u4e9b\u4f7f\u7528\u573a\u666f\u5462\uff1f\u6a21\u62df\u7f51\u7edc\u6570\u636e\u3001\u7edf\u8ba1\u5e94\u7528\u6d41\u91cf\uff0c\u6216\u8005\u662f\u5355\u72ec\u4ee3\u7406 WebView \u7684\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p></p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4e0d\u4f1a\u975e\u5e38\u5173\u5fc3\u7b2c\u4e09\u65b9\u7684\u7f51\u7edc\u8bf7\u6c42\u60c5\u51b5\uff0c\u800c\u5bf9\u4e8e\u6211\u4eec\u5e94\u7528\u81ea\u8eab\u7684\u7f51\u7edc\u8bf7\u6c42\uff0c\u6700\u597d\u7684\u76d1\u63a7\u65b9\u6cd5\u8fd8\u662f\u7edf\u4e00\u7f51\u7edc\u5e93\u3002</p> <p>\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63d2\u6869\u548c Hook \u8fd9\u4e24\u4e2a\u65b9\u6cd5\uff0c\u76d1\u63a7\u5e94\u7528\u4e2d\u6709\u54ea\u4e9b\u5730\u65b9\u4f7f\u7528\u4e86\u5176\u4ed6\u7684\u7f51\u7edc\u5e93\uff0c\u800c\u4e0d\u662f\u9ed8\u8ba4\u7684\u7edf\u4e00\u7f51\u7edc\u5e93\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#42","title":"4.2 \u5982\u4f55\u76d1\u63a7\u6d41\u91cf","text":"<p>\u5e94\u7528\u6d41\u91cf\u76d1\u63a7\u7684\u65b9\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u4e00\u822c\u901a\u8fc7 TrafficStats \u7c7b\u3002TrafficState \u662f Android API 8 \u52a0\u5165\u7684\u63a5\u53e3\uff0c\u7528\u4e8e\u83b7\u53d6\u6574\u4e2a\u624b\u673a\u6216\u8005\u67d0\u4e2a UID \u4ece\u5f00\u673a\u7b97\u8d77\u7684\u7f51\u7edc\u6d41\u91cf\u3002\u81f3\u4e8e\u5982\u4f55\u4f7f\u7528\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003 Facebook \u4e00\u4e2a\u5386\u53f2\u6bd4\u8f83\u4e45\u8fdc\u7684\u5f00\u6e90\u5e93network-connection-class\u3002</p> <pre><code>getMobileRxBytes()        //\u4ece\u5f00\u673a\u5f00\u59cbMobile\u7f51\u7edc\u63a5\u6536\u7684\u5b57\u8282\u603b\u6570\uff0c\u4e0d\u5305\u62ecWifi\ngetTotalRxBytes()         //\u4ece\u5f00\u673a\u5f00\u59cb\u6240\u6709\u7f51\u7edc\u63a5\u6536\u7684\u5b57\u8282\u603b\u6570\uff0c\u5305\u62ecWifi\ngetMobileTxBytes()        //\u4ece\u5f00\u673a\u5f00\u59cbMobile\u7f51\u7edc\u53d1\u9001\u7684\u5b57\u8282\u603b\u6570\uff0c\u4e0d\u5305\u62ecWifi\ngetTotalTxBytes()         //\u4ece\u5f00\u673a\u5f00\u59cb\u6240\u6709\u7f51\u7edc\u53d1\u9001\u7684\u5b57\u8282\u603b\u6570\uff0c\u5305\u62ecWifi\n</code></pre> <p>\u5b83\u7684\u5b9e\u73b0\u539f\u7406\u5176\u5b9e\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u5229\u7528 Linux \u5185\u6838\u7684\u7edf\u8ba1\u63a5\u53e3\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u662f\u4e0b\u9762\u4e24\u4e2a proc \u63a5\u53e3\u3002</p> <pre><code>// stats\u63a5\u53e3\u63d0\u4f9b\u5404\u4e2auid\u5728\u5404\u4e2a\u7f51\u7edc\u63a5\u53e3\uff08wlan0, ppp0\u7b49\uff09\u7684\u6d41\u91cf\u4fe1\u606f\n/proc/net/xt_qtaguid/stats\n// iface_stat_fmt\u63a5\u53e3\u63d0\u4f9b\u5404\u4e2a\u63a5\u53e3\u7684\u6c47\u603b\u6d41\u91cf\u4fe1\u606f\nproc/net/xt_qtaguid/iface_stat_fmt\n</code></pre> <p>TrafficStats \u7684\u5de5\u4f5c\u539f\u7406\u662f\u8bfb\u53d6 proc\uff0c\u5e76\u5c06\u76ee\u6807 UID \u4e0b\u9762\u6240\u6709\u7f51\u7edc\u63a5\u53e3\u7684\u6d41\u91cf\u76f8\u52a0\u3002\u4f46\u5982\u679c\u6211\u4eec\u4e0d\u4f7f\u7528 TrafficStats \u63a5\u53e3\uff0c\u800c\u662f\u81ea\u5df1\u89e3\u6790 proc \u6587\u4ef6\u5462\uff1f\u90a3\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e0d\u540c\u7f51\u7edc\u63a5\u53e3\u4e0b\u7684\u6d41\u91cf\uff0c\u4ece\u800c\u8ba1\u7b97\u51fa WiFi\u30012G/3G/4G\u3001VPN\u3001\u70ed\u70b9\u5171\u4eab\u3001WiFi P2P \u7b49\u4e0d\u540c\u7f51\u7edc\u72b6\u6001\u4e0b\u7684\u6d41\u91cf\u3002</p> <p>\u4e0d\u8fc7\u975e\u5e38\u9057\u61be\u7684\u662f\uff0cAndroid 7.0 \u4e4b\u540e\u7cfb\u7edf\u5df2\u7ecf\u4e0d\u8ba9\u6211\u4eec\u76f4\u63a5\u53bb\u8bfb\u53d6 stats \u6587\u4ef6\uff0c\u9632\u6b62\u5f00\u53d1\u8005\u53ef\u4ee5\u62ff\u5230\u5176\u4ed6\u5e94\u7528\u7684\u6d41\u91cf\u4fe1\u606f\uff0c\u56e0\u6b64\u53ea\u80fd\u901a\u8fc7 TrafficStats \u62ff\u5230\u81ea\u5df1\u5e94\u7528\u7684\u6d41\u91cf\u4fe1\u606f\u3002</p> <p>\u9664\u4e86\u6d41\u91cf\u4fe1\u606f\uff0c\u901a\u8fc7 /proc/net \u6211\u4eec\u8fd8\u53ef\u4ee5\u62ff\u5230\u5927\u91cf\u7f51\u7edc\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u7f51\u7edc\u4fe1\u53f7\u5f3a\u5ea6\u3001\u7535\u5e73\u5f3a\u5ea6\u7b49\u3002Android \u624b\u673a\u8ddf iPhone \u90fd\u6709\u4e00\u4e2a\u7f51\u7edc\u6d4b\u8bd5\u6a21\u5f0f\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e0b\u3002</p> <ul> <li>iPhone\uff1a\u6253\u5f00\u62e8\u53f7\u754c\u9762\uff0c\u8f93\u5165\u201c3001#12345#\u201d\uff0c\u7136\u540e\u6309\u62e8\u53f7\u952e\u3002</li> <li>Android \u624b\u673a\uff1a\u6253\u5f00\u62e8\u53f7\u754c\u9762\uff0c\u8f93\u5165\u201c##4636##\u201d\uff0c\u7136\u540e\u6309\u62e8\u53f7\u952e\uff08\u53ef\u8fdb\u5165\u5de5\u7a0b\u6d4b\u8bd5\u6a21\u5f0f\uff0c\u90e8\u5206\u7248\u672c\u53ef\u80fd\u4e0d\u652f\u6301\uff09\u3002 </li> </ul> <p>\u4e3a\u4ec0\u4e48\u7cfb\u7edf\u53ef\u4ee5\u5224\u65ad\u6b64\u65f6\u7684 WiFi\u201c\u5df2\u8fde\u63a5\uff0c\u4f46\u65e0\u6cd5\u8bbf\u95ee\u4e92\u8054\u7f51</p> <p>\u5bf9\u4e8e\u624b\u673a\u5382\u5546\u6765\u8bf4\uff0c\u5b83\u5728\u5e95\u5c42\u53ef\u4ee5\u62ff\u5230\u7684\u4fe1\u606f\u6709\u5f88\u591a\u3002</p> <ul> <li>\u7f51\u5361\u9a71\u52a8\u5c42\u4fe1\u606f\u3002\u5982\u5c04\u9891\u53c2\u6570\uff0c\u53ef\u4ee5\u7528\u6765\u5224\u65ad WiFi \u7684\u4fe1\u53f7\u5f3a\u5ea6\uff1b\u7f51\u5361\u6570\u636e\u5305\u961f\u5217\u957f\u5ea6\uff0c\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u7f51\u7edc\u662f\u5426\u62e5\u585e\u3002</li> <li>\u534f\u8bae\u6808\u4fe1\u606f\u3002\u4e3b\u8981\u662f\u83b7\u53d6\u6570\u636e\u5305\u53d1\u9001\u3001\u63a5\u6536\u3001\u65f6\u5ef6\u548c\u4e22\u5305\u7b49\u4fe1\u606f\u3002</li> </ul> <p>\u5982\u679c\u4e00\u4e2a WiFi \u53d1\u9001\u8fc7\u6570\u636e\u5305\uff0c\u4f46\u662f\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u7684 ACK \u56de\u5305\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u521d\u6b65\u5224\u65ad\u5f53\u524d\u7684 WiFi \u662f\u6709\u95ee\u9898\u7684\u3002\u8fd9\u6837\u7cfb\u7edf\u53ef\u4ee5\u77e5\u9053\u5f53\u524d WiFi \u5927\u6982\u7387\u662f\u6709\u95ee\u9898\u7684\uff0c\u5b83\u5e76\u4e0d\u5173\u5fc3\u662f\u4e0d\u662f\u56e0\u4e3a\u6211\u4eec\u540e\u53f0\u670d\u52a1\u5668\u51fa\u95ee\u9898\u5bfc\u81f4\u7684\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#43","title":"4.3 \u5927\u7f51\u7edc\u5e73\u53f0\u76d1\u63a7","text":"<p>\u524d\u9762\u8bb2\u4e86\u4e00\u4e9b\u5e94\u7528\u7f51\u7edc\u8bf7\u6c42\u548c\u6d41\u91cf\u7684\u76d1\u63a7\u65b9\u6cd5\uff0c\u4f46\u662f\u8fd8\u6ca1\u771f\u6b63\u56de\u7b54\u5e94\u8be5\u5982\u4f55\u53bb\u6253\u9020\u4e00\u5957\u5f3a\u5927\u7684\u7f51\u7edc\u76d1\u63a7\u4f53\u7cfb\u3002\u8ddf\u7f51\u7edc\u4f18\u5316\u4e00\u6837\uff0c\u7f51\u7edc\u76d1\u63a7\u4e0d\u662f\u5ba2\u6237\u7aef\u53ef\u4ee5\u5355\u72ec\u5b8c\u6210\u7684\uff0c\u5b83\u4e5f\u662f\u6574\u4e2a\u5927\u7f51\u7edc\u5e73\u53f0\u7684\u4e00\u4e2a\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002</p> <p>\u4e0d\u8fc7\u9996\u5148\u6211\u4eec\u9700\u8981\u5728\u5ba2\u89c2\u4e0a\u627f\u8ba4\u8fd9\u4ef6\u4e8b\u60c5\u505a\u8d77\u6765\u5e76\u4e0d\u5bb9\u6613\uff0c\u56e0\u4e3a\u7f51\u7edc\u95ee\u9898\u4f1a\u5b58\u5728\u4e0b\u9762\u8fd9\u4e9b\u7279\u70b9\uff1a</p> <ul> <li>\u5b9e\u65f6\u6027\u3002\u90e8\u5206\u7f51\u7edc\u95ee\u9898\u8fc7\u65f6\u4e0d\u5019\uff0c\u53ef\u80fd\u5f88\u5feb\u5c31\u4e22\u5931\u73b0\u573a\u3002</li> <li>\u590d\u6742\u6027\u3002\u53ef\u80fd\u8ddf\u56fd\u5bb6\u3001\u5730\u533a\u3001\u8fd0\u8425\u5546\u3001\u7248\u672c\u3001\u7cfb\u7edf\u3001\u673a\u578b\u3001CDN \u90fd\u6709\u5173\uff0c\u4e0d\u4ec5\u7ef4\u5ea6\u591a\uff0c\u6570\u636e\u91cf\u4e5f\u5de8\u5927\u3002</li> <li>\u94fe\u8def\u957f\u3002\u6574\u4e2a\u8bf7\u6c42\u94fe\u6761\u975e\u5e38\u957f\uff0c\u5ba2\u6237\u7aef\u6545\u969c\u3001\u7f51\u94fe\u969c\u7edc\u3001\u670d\u52a1\u6545\u969c\u90fd\u6709\u53ef\u80fd\u3002</li> </ul> <p>\u56e0\u6b64\u6240\u8c13\u7684\u7f51\u7edc\u76d1\u63a7\uff0c\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u53ef\u4ee5\u660e\u786e\u627e\u5230\u6545\u969c\u7684\u539f\u56e0\u3002\u800c\u6211\u4eec\u76ee\u6807\u662f\u5e0c\u671b\u5feb\u901f\u53d1\u73b0\u95ee\u9898\uff0c\u5c3d\u53ef\u80fd\u62ff\u5230\u66f4\u591a\u7684\u8f85\u52a9\u4fe1\u606f\uff0c\u534f\u52a9\u6211\u4eec\u66f4\u5bb9\u6613\u5730\u6392\u67e5\u95ee\u9898\u3002\u4e0b\u9762\u5206\u522b\u4ece\u5ba2\u6237\u7aef\u4e0e\u63a5\u5165\u5c42\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u4e00\u8d77\u6765\u770b\u770b\u54ea\u4e9b\u4fe1\u606f\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u5730\u53d1\u73b0\u95ee\u9898\u548c\u89e3\u51b3\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#431","title":"4.3.1 \u5ba2\u6237\u7aef\u76d1\u63a7","text":"<p>\u5ba2\u6237\u7aef\u7684\u76d1\u63a7\u4f7f\u7528\u7edf\u4e00\u7f51\u7edc\u5e93\u7684\u65b9\u5f0f\uff0c\u4f60\u53ef\u4ee5\u60f3\u60f3\u6211\u4eec\u9700\u8981\u5173\u5fc3\u54ea\u4e9b\u5185\u5bb9\uff1a</p> <ul> <li>\u65f6\u5ef6\u3002\u4e00\u822c\u6211\u4eec\u6bd4\u8f83\u5173\u5fc3\u6bcf\u6b21\u8bf7\u6c42\u7684 DNS \u65f6\u95f4\u3001\u5efa\u8fde\u65f6\u95f4\u3001\u9996\u5305\u65f6\u95f4\u3001\u603b\u65f6\u95f4\u7b49\uff0c\u4f1a\u6709\u7c7b\u4f3c 1 \u79d2\u5feb\u5f00\u7387\u30012 \u79d2\u5feb\u5f00\u7387\u8fd9\u4e9b\u6307\u6807\u3002</li> <li>\u7ef4\u5ea6\u3002\u7f51\u7edc\u7c7b\u578b\u3001\u56fd\u5bb6\u3001\u7701\u4efd\u3001\u57ce\u5e02\u3001\u8fd0\u8425\u5546\u3001\u7cfb\u7edf\u3001\u5ba2\u6237\u7aef\u7248\u672c\u3001\u673a\u578b\u3001\u8bf7\u6c42\u57df\u540d\u7b49\uff0c\u8fd9\u4e9b\u7ef4\u5ea6\u4e3b\u8981\u7528\u4e8e\u5206\u6790\u95ee\u9898\u3002</li> <li>\u9519\u8bef\u3002DNS \u5931\u8d25\u3001\u8fde\u63a5\u5931\u8d25\u3001\u8d85\u65f6\u3001\u8fd4\u56de\u9519\u8bef\u7801\u7b49\uff0c\u4f1a\u6709 DNS \u5931\u8d25\u7387\u3001\u8fde\u63a5\u5931\u8d25\u7387\u3001\u7f51\u7edc\u8bbf\u95ee\u7684\u5931\u8d25\u7387\u8fd9\u4e9b\u6307\u6807\u3002</li> </ul> <p>\u901a\u8fc7\u8fd9\u4e9b\u6570\u636e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6c47\u603b\u51fa\u5e94\u7528\u7684\u7f51\u7edc\u8bbf\u95ee\u5927\u56fe\u3002\u4f8b\u5982\u5728\u56fd\u5185\u65e0\u8bba\u6211\u4eec\u53bb\u5230\u54ea\u91cc\u90fd\u4f1a\u95ee\u6709\u6ca1\u6709 WiFi\uff0cWiFi \u7684\u5360\u6bd4\u4f1a\u8d85\u8fc7 50%\u3002\u8fd9\u5176\u5b9e\u8fdc\u8fdc\u6bd4\u6d77\u5916\u9ad8\uff0c\u5728\u5370\u5ea6 WiFi \u7684\u5360\u6bd4\u4ec5\u4ec5\u53ea\u6709 15% \u5de6\u53f3\u3002</p> <p></p> <p>\u540c\u6837\u7684\u6211\u4eec\u5206\u7248\u672c\u3001\u5206\u56fd\u5bb6\u3001\u5206\u8fd0\u8425\u5546\u3001\u5206\u57df\u540d\u7b49\u5404\u79cd\u5404\u6837\u7684\u7ef4\u5ea6\uff0c\u6765\u76d1\u63a7\u6211\u4eec\u7684\u65f6\u5ef6\u548c\u9519\u8bef\u8fd9\u4e9b\u8bbf\u95ee\u6307\u6807\u3002\u7531\u4e8e\u7ef4\u5ea6\u592a\u591a\uff0c\u6bcf\u4e2a\u7ef4\u5ea6\u7684\u53d6\u503c\u8303\u56f4\u4e5f\u5f88\u5e7f\uff0c\u5982\u679c\u662f\u5b9e\u65f6\u8ba1\u7b97\u6574\u4e2a\u6570\u636e\u91cf\u4f1a\u975e\u5e38\u975e\u5e38\u5927\u3002\u4e3a\u4e86\u8fd0\u7b97\u7b80\u5355\u6211\u4eec\u53ef\u4ee5\u629b\u5f03 UV\uff0c\u53ea\u8ba1\u7b97\u6bcf\u4e00\u5206\u949f\u90e8\u5206\u7ef4\u5ea6\u7684 PV\u3002</p>"},{"location":"perf-opt/Android/net/net_opt/#432","title":"4.3.2 \u63a5\u5165\u5c42\u76d1\u63a7","text":"<p>\u5ba2\u6237\u7aef\u76d1\u63a7\u7684\u6570\u636e\u4f1a\u6bd4\u63a5\u5165\u5c42\u66f4\u52a0\u4e30\u5bcc\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u90e8\u5206\u6570\u636e\u8fd8\u6ca1\u5230\u8fbe\u63a5\u5165\u5c42\u5c31\u5df2\u7ecf\u88ab\u6253\u56de\uff0c\u4f8b\u5982\u8fd0\u8425\u5546\u52ab\u6301\u7684\u60c5\u51b5\u3002</p> <p>\u4f46\u662f\u63a5\u5165\u5c42\u7684\u6570\u636e\u76d1\u63a7\u8fd8\u662f\u975e\u5e38\u6709\u5fc5\u8981\u7684\uff0c\u4e3b\u8981\u7684\u539f\u56e0\u662f\uff1a</p> <ul> <li>\u5b9e\u65f6\u6027\u3002\u5ba2\u6237\u7aef\u5982\u679c\u4f7f\u7528\u79d2\u7ea7\u7684\u5b9e\u65f6\u4e0a\u62a5\uff0c\u5bf9\u7528\u6237\u6027\u80fd\u5f71\u54cd\u4f1a\u6bd4\u8f83\u5927\u3002\u670d\u52a1\u7aef\u5c31\u4e0d\u4f1a\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u5f88\u5bb9\u6613\u53ef\u4ee5\u505a\u5230\u79d2\u7ea7\u7684\u76d1\u63a7\u3002</li> <li>\u53ef\u9760\u6027\u3002\u5982\u679c\u51fa\u73b0\u67d0\u4e9b\u7f51\u7edc\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u7684\u6570\u636e\u4e0a\u62a5\u901a\u9053\u53ef\u80fd\u4e5f\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u5ba2\u6237\u7aef\u7684\u6570\u636e\u4e0d\u5b8c\u5168\u53ef\u9760\u3002</li> </ul> <p>\u90a3\u63a5\u5165\u5c42\u5e94\u8be5\u5173\u5fc3\u54ea\u4e9b\u6570\u636e\u5462\uff1f\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u6bd4\u8f83\u5173\u5fc3 **\u670d\u52a1\u7684\u5165\u53e3\u548c\u51fa\u53e3\u6d41\u91cf\u3001\u670d\u52a1\u7aef\u7684\u5904\u7406\u65f6\u5ef6\u3001\u9519\u8bef\u7387**\u7b49\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u6839\u636e\u5ba2\u6237\u7aef\u3001\u56fd\u5bb6\u4ee5\u53ca\u8fd0\u8425\u5546\u7ef4\u5ea6\u5206\u6790\u7684\u793a\u4f8b\u3002\u5f53\u7136\u66f4\u591a\u7684\u65f6\u5019\u662f\u67d0\u4e00\u4e2a\u670d\u52a1\u51fa\u73b0\u95ee\u9898\uff0c\u8fd9\u4e2a\u65f6\u5019\u901a\u8fc7\u5206\u57df\u540d\u6216\u8005\u9519\u8bef\u7801\u5c31\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u627e\u5230\u539f\u56e0\u3002</p> <p></p>"},{"location":"perf-opt/Android/net/net_opt/#433","title":"4.3.3 \u76d1\u63a7\u62a5\u8b66","text":"<p>\u65e0\u8bba\u662f\u5ba2\u6237\u7aef\u8fd8\u662f\u63a5\u5165\u5c42\u7684\u76d1\u63a7\uff0c\u5b83\u4eec\u90fd\u662f\u5206\u5c42\u7684\u3002</p> <ul> <li>\u5b9e\u65f6\u76d1\u63a7\u3002\u79d2\u7ea7\u6216\u8005\u5206\u949f\u7ea7\u522b\u7684\u5b9e\u65f6\u76d1\u63a7\u7684\u4fe1\u606f\u4f1a\u76f8\u6bd4\u5c11\u4e00\u4e9b\uff0c\u4f8b\u5982\u53ea\u6709\u8bbf\u95ee\u91cf\uff08PV\uff09\u3001\u9519\u8bef\u7387\uff0c\u6ca1\u6709\u53bb\u62c6\u5206\u51e0\u767e\u4e2a\u4e0a\u5343\u4e2a\u7ef4\u5ea6\uff0c\u4e5f\u6ca1\u6709\u72ec\u7acb\u8bbf\u95ee\u7528\u6237\u6570\uff08UV\uff09\uff0c\u5b9e\u65f6\u76d1\u63a7\u7684\u76ee\u7684\u662f\u6700\u5feb\u901f\u5ea6\u53d1\u73b0\u95ee\u9898\u3002</li> <li>\u79bb\u7ebf\u76d1\u63a7\u3002\u5c0f\u65f6\u6216\u8005\u5929\u7ea7\u522b\u7684\u76d1\u63a7\u6211\u4eec\u53ef\u4ee5\u62d3\u5c55\u51fa\u5168\u90e8\u7684\u7ef4\u5ea6\u6765\u505a\u76d1\u63a7\uff0c\u5b83\u7684\u76ee\u7684\u662f\u5728\u76d1\u63a7\u7684\u540c\u65f6\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5708\u51fa\u95ee\u9898\u7684\u8303\u56f4\u3002</li> </ul> <p>\u90a3\u5728\u76d1\u63a7\u7684\u540c\u65f6\u5982\u4f55\u5b9e\u73b0\u51c6\u786e\u7684\u81ea\u52a8\u5316\u62a5\u8b66\u5462\uff1f\u8fd9\u540c\u6837\u4e5f\u662f\u4e1a\u754c\u7684\u4e00\u4e2a\u96be\u9898\uff0c\u5b83\u7684\u96be\u5ea6\u5728\u4e8e\u5982\u679c\u89c4\u5219\u8fc7\u4e8e\u82db\u523b\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u6f0f\u62a5\uff1b\u5982\u679c\u8fc7\u4e8e\u5bbd\u677e\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u592a\u591a\u7684\u8bef\u62a5\u3002</p> <p>\u4e1a\u754c\u4e00\u822c\u5b58\u5728\u4e24\u79cd\u62a5\u8b66\u7684\u7b97\u6cd5\uff0c</p> <ul> <li>\u4e00\u5957\u662f\u57fa\u4e8e\u89c4\u5219\uff0c\u4f8b\u5982\u5931\u8d25\u7387\u4e0e\u5386\u53f2\u6570\u636e\u76f8\u6bd4\u66b4\u6da8\u3001\u6d41\u91cf\u66b4\u8dcc\u7b49\u3002</li> <li>\u53e6\u4e00\u79cd\u662f\u57fa\u4e8e\u65f6\u95f4\u5e8f\u5217\u7b97\u6cd5\u6216\u8005\u795e\u7ecf\u7f51\u7edc\u7684\u667a\u80fd\u5316\u62a5\u8b66\uff0c\u4f7f\u7528\u8005\u4e0d\u9700\u8981\u5f55\u5165\u4efb\u4f55\u89c4\u5219\uff0c\u53ea\u9700\u6709\u8db3\u591f\u957f\u7684\u5386\u53f2\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u81ea\u52a8\u62a5\u8b66\u3002</li> </ul> <p>\u667a\u80fd\u5316\u62a5\u8b66\u76ee\u524d\u51c6\u786e\u6027\u4e5f\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff0c\u5728\u667a\u80fd\u5316\u57fa\u7840\u4e0a\u9762\u6dfb\u52a0\u5c11\u91cf\u89c4\u5219\u53ef\u80fd\u4f1a\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002</p> <p>\u5982\u679c\u6211\u4eec\u6536\u5230\u4e00\u4e2a\u7ebf\u4e0a\u7684\u7f51\u7edc\u62a5\u8b66\uff0c\u901a\u8fc7\u63a5\u5165\u5c42\u548c\u5ba2\u6237\u7aef\u7684\u76d1\u63a7\u62a5\u8868\uff0c\u4e5f\u4f1a\u6709\u4e86\u4e00\u4e2a\u5927\u81f4\u7684\u5224\u65ad\u3002\u90a3\u600e\u4e48\u6837\u624d\u80fd\u786e\u5b9a\u95ee\u9898\u7684\u6700\u7ec8\u539f\u56e0\uff1f\u6211\u4eec\u662f\u5426\u53ef\u4ee5\u62ff\u5230\u7528\u6237\u5b8c\u6574\u7684\u7f51\u7edc\u65e5\u5fd7\uff1f\u751a\u81f3\u8fdc\u7a0b\u5730\u8bca\u65ad\u7528\u6237\u7684\u7f51\u7edc\u60c5\u51b5\uff1f</p> <p>\u5173\u4e8e\u201c\u7f51\u7edc\u65e5\u5fd7\u548c\u8fdc\u7a0b\u8bca\u65ad\uff0c\u5982\u4f55\u5feb\u901f\u5b9a\u4f4d\u7f51\u7edc\u95ee\u9898\u201d\uff0c\u53ef\u4ee5\u53c2\u8003\u7ebf\u4e0a\u7591\u96be\u95ee\u9898\u8be5\u5982\u4f55\u6392\u67e5\u548c\u8ddf\u8e2a\uff1f</p>"},{"location":"perf-opt/Android/net/net_opt/#_3","title":"\u53c2\u8003","text":"<p>Android\u5f00\u53d1\u9ad8\u624b\u8bfe</p>"},{"location":"perf-opt/Android/net/okhttp/","title":"OKhttp \u6838\u5fc3\u89e3\u6790","text":""},{"location":"perf-opt/Android/net/okhttp/#1","title":"1. \u603b\u89c8","text":"<p>Okhttp\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684 Android \u7f51\u7edc\u5e93\uff0c\u5b83\u8fd8\u88ab Google \u52a0\u5165\u5230 Android \u7cfb\u7edf\u5185\u90e8\uff0c\u4e3a\u5e7f\u5927\u5f00\u53d1\u8005\u63d0\u4f9b\u7f51\u7edc\u670d\u52a1\u3002</p> <p>\u90a3\u7f51\u7edc\u5e93\u7a76\u7adf\u627f\u62c5\u7740\u4e00\u4e2a\u4ec0\u4e48\u6837\u7684\u89d2\u8272\u5462\uff1f\u5728\u6211\u770b\u6765\uff0c\u5b83\u5c4f\u853d\u4e86\u4e0b\u5c42\u590d\u6742\u7684\u7f51\u7edc\u63a5\u53e3\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u4f7f\u7528\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e00\u4e2a\u7f51\u7edc\u5e93\u7684\u6838\u5fc3\u4f5c\u7528\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u70b9\uff1a</p> <ul> <li>\u7edf\u4e00\u7f16\u7a0b\u63a5\u53e3\u3002\u65e0\u8bba\u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65\u8bf7\u6c42\uff0c\u63a5\u53e3\u90fd\u975e\u5e38\u7b80\u5355\u6613\u7528\u3002\u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u7edf\u4e00\u505a\u7b56\u7565\u7ba1\u7406\uff0c\u7edf\u4e00\u8fdb\u884c\u6d41\u89e3\u6790\uff08JSON\u3001XML\u3001Protocol Buffers\uff09\u7b49\u3002</li> <li>\u5168\u5c40\u7f51\u7edc\u63a7\u5236\u3002\u5728\u7f51\u7edc\u5e93\u5185\u90e8\u6211\u4eec\u53ef\u4ee5\u505a\u7edf\u4e00\u7684\u7f51\u7edc\u8c03\u5ea6\u3001\u6d41\u91cf\u76d1\u63a7\u4ee5\u53ca\u5bb9\u707e\u7ba1\u7406\u7b49\u5de5\u4f5c\u3002</li> <li>\u9ad8\u6027\u80fd\u3002\u65e2\u7136\u6211\u4eec\u628a\u6240\u6709\u7684\u7f51\u7edc\u8bf7\u6c42\u90fd\u4ea4\u7ed9\u4e86\u7f51\u7edc\u5e93\uff0c\u90a3\u7f51\u7edc\u5e93\u662f\u5426\u5b9e\u73b0\u9ad8\u6027\u80fd\u5c31\u81f3\u5173\u91cd\u8981\u3002\u65e2\u7136\u8981\u5b9e\u73b0\u9ad8\u6027\u80fd\uff0c\u90a3\u6211\u4f1a\u975e\u5e38\u5173\u6ce8\u901f\u5ea6\uff0cCPU\u3001\u5185\u5b58\u3001I/O \u7684\u4f7f\u7528\uff0c\u4ee5\u53ca\u5931\u8d25\u7387\u3001\u5d29\u6e83\u7387\u3001\u534f\u8bae\u7684\u517c\u5bb9\u6027\u7b49\u65b9\u9762\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u4e00\u8d77\u6765\u770b\u4e0bOkHttp\u7684\u5185\u90e8\u5b9e\u73b0\u3002</p>"},{"location":"perf-opt/Android/net/okhttp/#2-okhttp","title":"2 OKHttp\u8bf7\u6c42\u6574\u4f53\u6d41\u7a0b","text":"<p>\u9996\u5148\u6765\u770b\u4e00\u4e2a\u6700\u7b80\u5355\u7684Http\u8bf7\u6c42\u662f\u5982\u4f55\u53d1\u9001\u7684\u3002</p> <pre><code>   val okHttpClient = OkHttpClient()\nval request: Request = Request.Builder()\n.url(\"https://www.google.com/\")\n.build()\nokHttpClient.newCall(request).enqueue(object :Callback{\noverride fun onFailure(call: Call, e: IOException) {\n}\noverride fun onResponse(call: Call, response: Response) {\n}\n})\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u770b\u8d77\u6765\u6bd4\u8f83\u7b80\u5355,OkHttp\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\u6700\u5c11\u53ea\u9700\u8981\u63a5\u89e6<code>OkHttpClient</code>\u3001<code>Request</code>\u3001<code>Call</code>\u3001 <code>Response</code>\uff0c</p> <p>\u6574\u4e2a\u7f51\u7edc\u8bf7\u6c42\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <ol> <li>\u901a\u8fc7\u5efa\u9020\u8005\u6a21\u5f0f\u6784\u5efaOKHttpClient\u4e0e Request</li> <li>OKHttpClient\u901a\u8fc7newCall\u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42</li> <li>\u901a\u8fc7\u5206\u53d1\u5668\u7ef4\u62a4\u8bf7\u6c42\u961f\u5217\u4e0e\u7ebf\u7a0b\u6c60\uff0c\u5b8c\u6210\u8bf7\u6c42\u8c03\u914d</li> <li>\u901a\u8fc7\u4e94\u5927\u9ed8\u8ba4\u62e6\u622a\u5668\u5b8c\u6210\u8bf7\u6c42\u91cd\u8bd5\uff0c\u7f13\u5b58\u5904\u7406\uff0c\u5efa\u7acb\u8fde\u63a5\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c</li> <li>\u5f97\u5230\u7f51\u7edc\u8bf7\u6c42\u7ed3\u679c</li> </ol>"},{"location":"perf-opt/Android/net/okhttp/#3-okhttpdispatcher","title":"3. OKHttp\u5206\u53d1\u5668(Dispatcher)\u662f\u600e\u6837\u5de5\u4f5c\u7684?","text":"<p>\u5206\u53d1\u5668\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u7ef4\u62a4\u8bf7\u6c42\u961f\u5217\u4e0e\u7ebf\u7a0b\u6c60,\u6bd4\u5982\u6211\u4eec\u6709100\u4e2a\u5f02\u6b65\u8bf7\u6c42\uff0c\u80af\u5b9a\u4e0d\u80fd\u628a\u5b83\u4eec\u540c\u65f6\u8bf7\u6c42\uff0c\u800c\u662f\u5e94\u8be5\u628a\u5b83\u4eec\u6392\u961f\u5206\u4e2a\u7c7b\uff0c\u5206\u4e3a\u6b63\u5728\u8bf7\u6c42\u4e2d\u7684\u5217\u8868\u548c\u6b63\u5728\u7b49\u5f85\u7684\u5217\u8868\uff0c \u7b49\u8bf7\u6c42\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u4ece\u7b49\u5f85\u4e2d\u7684\u5217\u8868\u4e2d\u53d6\u51fa\u7b49\u5f85\u7684\u8bf7\u6c42\uff0c\u4ece\u800c\u5b8c\u6210\u6240\u6709\u7684\u8bf7\u6c42</p> <p>\u800c\u8fd9\u91cc\u540c\u6b65\u8bf7\u6c42\u5404\u5f02\u6b65\u8bf7\u6c42\u53c8\u7565\u6709\u4e0d\u540c</p> <p>\u540c\u6b65\u8bf7\u6c42</p> <pre><code>synchronized void executed(RealCall call) {\nrunningSyncCalls.add(call);\n}\n</code></pre> <p>\u56e0\u4e3a\u540c\u6b65\u8bf7\u6c42\u4e0d\u9700\u8981\u7ebf\u7a0b\u6c60\uff0c\u4e5f\u4e0d\u5b58\u5728\u4efb\u4f55\u9650\u5236\u3002\u6240\u4ee5\u5206\u53d1\u5668\u4ec5\u505a\u4e00\u4e0b\u8bb0\u5f55\u3002\u540e\u7eed\u6309\u7167\u52a0\u5165\u961f\u5217\u7684\u987a\u5e8f\u540c\u6b65\u8bf7\u6c42\u5373\u53ef</p> <p>\u5f02\u6b65\u8bf7\u6c42</p> <pre><code>synchronized void enqueue(AsyncCall call) {\n//\u8bf7\u6c42\u6570\u6700\u5927\u4e0d\u8d85\u8fc764,\u540c\u4e00Host\u8bf7\u6c42\u4e0d\u80fd\u8d85\u8fc75\u4e2a\nif (runningAsyncCalls.size() &lt; maxRequests &amp;&amp; runningCallsForHost(call) &lt; maxRequestsPerHost)     {\nrunningAsyncCalls.add(call);\nexecutorService().execute(call);\n} else {\nreadyAsyncCalls.add(call);\n}\n}\n</code></pre> <p>\u5f53\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\u672a\u8d85\u8fc7\u6700\u5927\u9650\u523664\uff0c\u540c\u65f6\u540c\u4e00Host\u7684\u8bf7\u6c42\u4e0d\u8d85\u8fc75\u4e2a\uff0c\u5219\u4f1a\u6dfb\u52a0\u5230\u6b63\u5728\u6267\u884c\u961f\u5217\uff0c\u540c\u65f6\u63d0\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\u3002\u5426\u5219\u5148\u52a0\u5165\u7b49\u5f85\u961f\u5217\u3002 \u6bcf\u4e2a\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u90fd\u4f1a\u8c03\u7528\u5206\u53d1\u5668\u7684finished\u65b9\u6cd5,\u8fd9\u91cc\u9762\u4f1a\u53d6\u51fa\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u4efb\u52a1\u7ee7\u7eed\u6267\u884c</p>"},{"location":"perf-opt/Android/net/okhttp/#4-okhttp","title":"4. OKHttp\u62e6\u622a\u5668\u662f\u600e\u6837\u5de5\u4f5c\u7684?","text":"<p>\u7ecf\u8fc7\u4e0a\u9762\u5206\u53d1\u5668\u7684\u4efb\u52a1\u5206\u53d1\uff0c\u4e0b\u9762\u5c31\u8981\u5229\u7528\u62e6\u622a\u5668\u5f00\u59cb\u4e00\u7cfb\u5217\u914d\u7f6e\u4e86</p> <pre><code># RealCall\noverride fun execute(): Response {\ntry {\nclient.dispatcher.executed(this)\nreturn getResponseWithInterceptorChain()\n} finally {\nclient.dispatcher.finished(this)\n}\n}\n</code></pre> <p>\u6211\u4eec\u518d\u6765\u770b\u4e0bRealCall\u7684execute\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u6700\u540e\u8fd4\u56de\u4e86getResponseWithInterceptorChain,\u8d23\u4efb\u94fe\u7684\u6784\u5efa\u4e0e\u5904\u7406\u5176\u5b9e\u5c31\u662f\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762</p> <p><pre><code>#RealCall\nfun getResponseWithInterceptorChain(): Response {\n//\u521b\u5efa\u62e6\u622a\u5668\u6570\u7ec4\nval interceptors = mutableListOf&lt;Interceptor&gt;()\n//\u6dfb\u52a0\u5e94\u7528\u62e6\u622a\u5668\ninterceptors += client.interceptors\n//\u6dfb\u52a0\u91cd\u8bd5\u548c\u91cd\u5b9a\u5411\u62e6\u622a\u5668\ninterceptors += RetryAndFollowUpInterceptor(client)\n//\u6dfb\u52a0\u6865\u63a5\u62e6\u622a\u5668\ninterceptors += BridgeInterceptor(client.cookieJar)\n//\u6dfb\u52a0\u7f13\u5b58\u62e6\u622a\u5668\ninterceptors += CacheInterceptor(client.cache)\n//\u6dfb\u52a0\u8fde\u63a5\u62e6\u622a\u5668\ninterceptors += ConnectInterceptor\nif (!forWebSocket) {\n//\u6dfb\u52a0\u7f51\u7edc\u62e6\u622a\u5668\ninterceptors += client.networkInterceptors\n}\n//\u6dfb\u52a0\u8bf7\u6c42\u62e6\u622a\u5668\ninterceptors += CallServerInterceptor(forWebSocket)\n//\u521b\u5efa\u8d23\u4efb\u94fe\nval chain = RealInterceptorChain(interceptors, transmitter, null, 0, originalRequest, this,\nclient.connectTimeoutMillis, client.readTimeoutMillis, client.writeTimeoutMillis)\n...\ntry {\n//\u542f\u52a8\u8d23\u4efb\u94fe\nval response = chain.proceed(originalRequest)\n...\nreturn response\n} catch (e: IOException) {\n...\n}\n}\n</code></pre> \u6211\u4eec\u5148\u4e0d\u5173\u5fc3\u6bcf\u4e2a\u62e6\u622a\u5668\u5177\u4f53\u505a\u4e86\u4ec0\u4e48\uff0c\u4e3b\u6d41\u7a0b\u6700\u7ec8\u8d70\u5230chain.proceed(originalRequest)\u3002\u6211\u4eec\u770b\u4e00\u4e0b\u8fd9\u4e2aprocceed\u65b9\u6cd5\uff1a</p> <pre><code>  # RealInterceptorChain\noverride fun proceed(request: Request): Response {\nreturn proceed(request, transmitter, exchange)\n}\n@Throws(IOException::class)\nfun proceed(request: Request, transmitter: Transmitter, exchange: Exchange?): Response {\nif (index &gt;= interceptors.size) throw AssertionError()\n// \u7edf\u8ba1\u5f53\u524d\u62e6\u622a\u5668\u8c03\u7528proceed\u65b9\u6cd5\u7684\u6b21\u6570\ncalls++\n// exchage\u662f\u5bf9\u8bf7\u6c42\u6d41\u7684\u5c01\u88c5\uff0c\u5728\u6267\u884cConnectInterceptor\u524d\u4e3a\u7a7a\uff0c\u8fde\u63a5\u548c\u6d41\u5df2\u7ecf\u5efa\u7acb\u4f46\u6b64\u65f6\u6b64\u8fde\u63a5\u4e0d\u518d\u652f\u6301\u5f53\u524durl\n// \u8bf4\u660e\u4e4b\u524d\u7684\u7f51\u7edc\u62e6\u622a\u5668\u5bf9url\u6216\u7aef\u53e3\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u8fd9\u662f\u4e0d\u5141\u8bb8\u7684!!\ncheck(this.exchange == null || this.exchange.connection()!!.supportsUrl(request.url)) {\n\"network interceptor ${interceptors[index - 1]} must retain the same host and port\"\n}\n// \u8fd9\u91cc\u662f\u5bf9\u62e6\u622a\u5668\u8c03\u7528proceed\u65b9\u6cd5\u7684\u9650\u5236\uff0c\u5728ConnectInterceptor\u53ca\u5176\u4e4b\u540e\u7684\u62e6\u622a\u5668\u6700\u591a\u53ea\u80fd\u8c03\u7528\u4e00\u6b21proceed!!\ncheck(this.exchange == null || calls &lt;= 1) {\n\"network interceptor ${interceptors[index - 1]} must call proceed() exactly once\"\n}\n// \u521b\u5efa\u4e0b\u4e00\u5c42\u8d23\u4efb\u94fe \u6ce8\u610findex + 1\nval next = RealInterceptorChain(interceptors, transmitter, exchange,\nindex + 1, request, call, connectTimeout, readTimeout, writeTimeout)\n//\u53d6\u51fa\u4e0b\u6807\u4e3aindex\u7684\u62e6\u622a\u5668\uff0c\u5e76\u8c03\u7528\u5176intercept\u65b9\u6cd5\uff0c\u5c06\u65b0\u5efa\u7684\u94fe\u4f20\u5165\u3002\nval interceptor = interceptors[index]\nval response = interceptor.intercept(next) // \u4fdd\u8bc1\u5728ConnectInterceptor\u53ca\u5176\u4e4b\u540e\u7684\u62e6\u622a\u5668\u81f3\u5c11\u8c03\u7528\u4e00\u6b21proceed!!\ncheck(exchange == null || index + 1 &gt;= interceptors.size || next.calls == 1) {\n\"network interceptor $interceptor must call proceed() exactly once\"\n}\nreturn response\n}\n</code></pre> <p>\u4ee3\u7801\u4e2d\u7684\u6ce8\u91ca\u5df2\u7ecf\u5199\u5f97\u6bd4\u8f83\u6e05\u695a\u4e86\uff0c\u603b\u7ed3\u8d77\u6765\u5c31\u662f\u521b\u5efa\u4e0b\u4e00\u7ea7\u8d23\u4efb\u94fe\uff0c\u7136\u540e\u53d6\u51fa\u5f53\u524d\u62e6\u622a\u5668\uff0c\u8c03\u7528\u5176intercept\u65b9\u6cd5\u5e76\u4f20\u5165\u521b\u5efa\u7684\u8d23\u4efb\u94fe\u3002\u4e3a\u4fdd\u8bc1\u8d23\u4efb\u94fe\u80fd\u4f9d\u6b21\u8fdb\u884c\u4e0b\u53bb\uff0c\u5fc5\u987b\u4fdd\u8bc1\u9664\u6700\u540e\u4e00\u4e2a\u62e6\u622a\u5668\uff08CallServerInterceptor\uff09\u5916\uff0c\u5176\u4ed6\u6240\u6709\u62e6\u622a\u5668intercept\u65b9\u6cd5\u5185\u90e8\u5fc5\u987b\u8c03\u7528\u4e00\u6b21chain.proceed()\u65b9\u6cd5\uff0c\u5982\u6b64\u4e00\u6765\u6574\u4e2a\u8d23\u4efb\u94fe\u5c31\u8fd0\u884c\u8d77\u6765\u4e86\u3002</p> <p>\u6bd4\u5982ConnectInterceptor\u6e90\u7801\u4e2d\uff1a</p> <pre><code># ConnectInterceptor \u8fd9\u91cc\u4f7f\u7528\u5355\u4f8b\nobject ConnectInterceptor : Interceptor {\n@Throws(IOException::class)\noverride fun intercept(chain: Interceptor.Chain): Response {\nval realChain = chain as RealInterceptorChain\nval request = realChain.request()\nval transmitter = realChain.transmitter()\nval doExtensiveHealthChecks = request.method != \"GET\"\n//\u521b\u5efa\u8fde\u63a5\u548c\u6d41\nval exchange = transmitter.newExchange(chain, doExtensiveHealthChecks)\n//\u6267\u884c\u4e0b\u4e00\u7ea7\u8d23\u4efb\u94fe\nreturn realChain.proceed(request, transmitter, exchange)\n}\n}\n</code></pre> <p>\u9664\u6b64\u4e4b\u5916\u5728\u8d23\u4efb\u94fe\u4e0d\u540c\u8282\u70b9\u5bf9\u4e8eproceed\u7684\u8c03\u7528\u6b21\u6570\u6709\u4e0d\u540c\u7684\u9650\u5236\uff0cConnectInterceptor\u62e6\u622a\u5668\u53ca\u5176\u4e4b\u540e\u7684\u62e6\u622a\u5668\u80fd\u4e14\u53ea\u80fd\u8c03\u7528\u4e00\u6b21\uff0c\u56e0\u4e3a\u7f51\u7edc\u63e1\u624b\u3001\u8fde\u63a5\u3001\u53d1\u9001\u8bf7\u6c42\u7684\u5de5\u4f5c\u53d1\u751f\u5728\u8fd9\u4e9b\u62e6\u622a\u5668\u5185\uff0c\u8868\u793a\u6b63\u5f0f\u53d1\u51fa\u4e86\u4e00\u6b21\u7f51\u7edc\u8bf7\u6c42\uff1b\u800c\u5728\u8fd9\u4e4b\u524d\u7684\u62e6\u622a\u5668\u53ef\u4ee5\u6267\u884c\u591a\u6b21proceed\uff0c\u6bd4\u5982\u9519\u8bef\u91cd\u8bd5\u3002 \u7ecf\u8fc7\u8d23\u4efb\u94fe\u4e00\u7ea7\u4e00\u7ea7\u7684\u9012\u63a8\u4e0b\u53bb\uff0c\u6700\u7ec8\u4f1a\u6267\u884c\u5230CallServerInterceptor\u7684intercept\u65b9\u6cd5\uff0c\u6b64\u65b9\u6cd5\u4f1a\u5c06\u7f51\u7edc\u54cd\u5e94\u7684\u7ed3\u679c\u5c01\u88c5\u6210\u4e00\u4e2aResponse\u5bf9\u8c61\u5e76return\u3002\u4e4b\u540e\u6cbf\u7740\u8d23\u4efb\u94fe\u4e00\u7ea7\u4e00\u7ea7\u7684\u56de\u6eaf\uff0c\u6700\u7ec8\u5c31\u56de\u5230getResponseWithInterceptorChain\u65b9\u6cd5\u7684\u8fd4\u56de\u3002</p> <p>\u5982\u4e0a\u6240\u793a\u8d23\u4efb\u94fe\u6dfb\u52a0\u7684\u987a\u5e8f\u53ca\u4f5c\u7528\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> \u62e6\u622a\u5668 \u4f5c\u7528 \u5e94\u7528\u62e6\u622a\u5668 \u62ff\u5230\u7684\u662f\u539f\u59cb\u8bf7\u6c42\uff0c\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e9b\u81ea\u5b9a\u4e49header\u3001\u901a\u7528\u53c2\u6570\u3001\u53c2\u6570\u52a0\u5bc6\u3001\u7f51\u5173\u63a5\u5165\u7b49\u7b49\u3002 RetryAndFollowUpInterceptor \u5904\u7406\u9519\u8bef\u91cd\u8bd5\u548c\u91cd\u5b9a\u5411 BridgeInterceptor \u5e94\u7528\u5c42\u548c\u7f51\u7edc\u5c42\u7684\u6865\u63a5\u62e6\u622a\u5668\uff0c\u4e3b\u8981\u5de5\u4f5c\u662f\u4e3a\u8bf7\u6c42\u6dfb\u52a0cookie\u3001\u6dfb\u52a0\u56fa\u5b9a\u7684header\uff0c\u6bd4\u5982Host\u3001Content-Length\u3001Content-Type\u3001User-Agent\u7b49\u7b49\uff0c\u7136\u540e\u4fdd\u5b58\u54cd\u5e94\u7ed3\u679c\u7684cookie\uff0c\u5982\u679c\u54cd\u5e94\u4f7f\u7528gzip\u538b\u7f29\u8fc7\uff0c\u5219\u8fd8\u9700\u8981\u8fdb\u884c\u89e3\u538b\u3002 CacheInterceptor \u7f13\u5b58\u62e6\u622a\u5668\uff0c\u5982\u679c\u547d\u4e2d\u7f13\u5b58\u5219\u4e0d\u4f1a\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u3002 ConnectInterceptor \u8fde\u63a5\u62e6\u622a\u5668\uff0c\u5185\u90e8\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u8fde\u63a5\u6c60\uff0c\u8d1f\u8d23\u8fde\u63a5\u590d\u7528\u3001\u521b\u5efa\u8fde\u63a5\uff08\u4e09\u6b21\u63e1\u624b\u7b49\u7b49\uff09\u3001\u91ca\u653e\u8fde\u63a5\u4ee5\u53ca\u521b\u5efa\u8fde\u63a5\u4e0a\u7684socket\u6d41\u3002 networkInterceptors\uff08\u7f51\u7edc\u62e6\u622a\u5668\uff09 \u7528\u6237\u81ea\u5b9a\u4e49\u62e6\u622a\u5668\uff0c\u901a\u5e38\u7528\u4e8e\u76d1\u63a7\u7f51\u7edc\u5c42\u7684\u6570\u636e\u4f20\u8f93\u3002 CallServerInterceptor \u8bf7\u6c42\u62e6\u622a\u5668\uff0c\u5728\u524d\u7f6e\u51c6\u5907\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u771f\u6b63\u53d1\u8d77\u4e86\u7f51\u7edc\u8bf7\u6c42\u3002 <p>\u6211\u4eec\u7684\u7f51\u7edc\u8bf7\u6c42\u5c31\u662f\u8fd9\u6837\u7ecf\u8fc7\u8d23\u4efb\u94fe\u4e00\u7ea7\u4e00\u7ea7\u7684\u9012\u63a8\u4e0b\u53bb\uff0c\u6700\u7ec8\u4f1a\u6267\u884c\u5230<code>CallServerInterceptor</code>\u7684<code>intercept</code>\u65b9\u6cd5\uff0c\u6b64\u65b9\u6cd5\u4f1a\u5c06\u7f51\u7edc\u54cd\u5e94\u7684\u7ed3\u679c\u5c01\u88c5\u6210\u4e00\u4e2a<code>Response</code>\u5bf9\u8c61\u5e76<code>return</code>\u3002\u4e4b\u540e\u6cbf\u7740\u8d23\u4efb\u94fe\u4e00\u7ea7\u4e00\u7ea7\u7684\u56de\u6eaf\uff0c\u6700\u7ec8\u5c31\u56de\u5230<code>getResponseWithInterceptorChain</code>\u65b9\u6cd5\u7684\u8fd4\u56de,\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>addInterceptor\u4e0eaddNetworkInterceptor\u7684\u533a\u522b</p> <p>\u4e8c\u8005\u901a\u5e38\u7684\u53eb\u6cd5\u4e3a\u5e94\u7528\u62e6\u622a\u5668\u548c\u7f51\u7edc\u62e6\u622a\u5668\uff0c\u4ece\u6574\u4e2a\u8d23\u4efb\u94fe\u8def\u6765\u770b\uff0c\u5e94\u7528\u62e6\u622a\u5668\u662f\u6700\u5148\u6267\u884c\u7684\u62e6\u622a\u5668\uff0c\u4e5f\u5c31\u662f\u7528\u6237\u81ea\u5df1\u8bbe\u7f6erequest\u5c5e\u6027\u540e\u7684\u539f\u59cb\u8bf7\u6c42\uff0c\u800c\u7f51\u7edc\u62e6\u622a\u5668\u4f4d\u4e8eConnectInterceptor\u548cCallServerInterceptor\u4e4b\u95f4\uff0c\u6b64\u65f6\u7f51\u7edc\u94fe\u8def\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u53ea\u7b49\u5f85\u53d1\u9001\u8bf7\u6c42\u6570\u636e\u3002</p> <ol> <li>\u9996\u5148\uff0c\u5e94\u7528\u62e6\u622a\u5668\u5728RetryAndFollowUpInterceptor\u548cCacheInterceptor\u4e4b\u524d\uff0c\u6240\u4ee5\u4e00\u65e6\u53d1\u751f\u9519\u8bef\u91cd\u8bd5\u6216\u8005\u7f51\u7edc\u91cd\u5b9a\u5411\uff0c\u7f51\u7edc\u62e6\u622a\u5668\u53ef\u80fd\u6267\u884c\u591a\u6b21\uff0c\u56e0\u4e3a\u76f8\u5f53\u4e8e\u8fdb\u884c\u4e86\u4e8c\u6b21\u8bf7\u6c42\uff0c\u4f46\u662f\u5e94\u7528\u62e6\u622a\u5668\u6c38\u8fdc\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u3002\u53e6\u5916\u5982\u679c\u5728CacheInterceptor\u4e2d\u547d\u4e2d\u4e86\u7f13\u5b58\u5c31\u4e0d\u9700\u8981\u8d70\u7f51\u7edc\u8bf7\u6c42\u4e86\uff0c\u56e0\u6b64\u4f1a\u5b58\u5728\u77ed\u8def\u7f51\u7edc\u62e6\u622a\u5668\u7684\u60c5\u51b5\u3002</li> <li>\u5176\u6b21\uff0c\u5982\u4e0a\u6587\u63d0\u5230\u9664\u4e86CallServerInterceptor\uff0c\u6bcf\u4e2a\u62e6\u622a\u5668\u90fd\u5e94\u8be5\u81f3\u5c11\u8c03\u7528\u4e00\u6b21realChain.proceed\u65b9\u6cd5\u3002\u5b9e\u9645\u4e0a\u5728\u5e94\u7528\u62e6\u622a\u5668\u8fd9\u5c42\u53ef\u4ee5\u591a\u6b21\u8c03\u7528proceed\u65b9\u6cd5\uff08\u672c\u5730\u5f02\u5e38\u91cd\u8bd5\uff09\u6216\u8005\u4e0d\u8c03\u7528proceed\u65b9\u6cd5\uff08\u4e2d\u65ad\uff09\uff0c\u4f46\u662f\u7f51\u7edc\u62e6\u622a\u5668\u8fd9\u5c42\u8fde\u63a5\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u53ef\u4e14\u4ec5\u53ef\u8c03\u7528\u4e00\u6b21proceed\u65b9\u6cd5\u3002</li> <li>\u6700\u540e\uff0c\u4ece\u4f7f\u7528\u573a\u666f\u770b\uff0c\u5e94\u7528\u62e6\u622a\u5668\u56e0\u4e3a\u53ea\u4f1a\u8c03\u7528\u4e00\u6b21\uff0c\u901a\u5e38\u7528\u4e8e\u7edf\u8ba1\u5ba2\u6237\u7aef\u7684\u7f51\u7edc\u8bf7\u6c42\u53d1\u8d77\u60c5\u51b5\uff1b\u800c\u7f51\u7edc\u62e6\u622a\u5668\u4e00\u6b21\u8c03\u7528\u4ee3\u8868\u4e86\u4e00\u5b9a\u4f1a\u53d1\u8d77\u4e00\u6b21\u7f51\u7edc\u901a\u4fe1\uff0c\u56e0\u6b64\u901a\u5e38\u53ef\u7528\u4e8e\u7edf\u8ba1\u7f51\u7edc\u94fe\u8def\u4e0a\u4f20\u8f93\u7684\u6570\u636e\u3002</li> </ol>"},{"location":"perf-opt/Android/net/okhttp/#5","title":"5. \u8fde\u63a5\u7ba1\u7406","text":""},{"location":"perf-opt/Android/net/okhttp/#51","title":"5.1 \u8fde\u63a5\u590d\u7528","text":"<p><code>ConnectInterceptor</code>\u7684\u4e3b\u8981\u5de5\u4f5c\u5c31\u662f\u8d1f\u8d23\u5efa\u7acb<code>TCP</code>\u8fde\u63a5\uff0c\u5efa\u7acb<code>TCP</code>\u8fde\u63a5\u9700\u8981\u7ecf\u5386\u4e09\u6b21\u63e1\u624b\u56db\u6b21\u6325\u624b\u7b49\u64cd\u4f5c\uff0c\u5982\u679c\u6bcf\u4e2a<code>HTTP</code>\u8bf7\u6c42\u90fd\u8981\u65b0\u5efa\u4e00\u4e2a<code>TCP</code>\u6d88\u8017\u8d44\u6e90\u6bd4\u8f83\u591a</p> <p>\u800c<code>Http1.1</code>\u5df2\u7ecf\u652f\u6301<code>keep-alive</code>,\u5373\u591a\u4e2a<code>Http</code>\u8bf7\u6c42\u590d\u7528\u4e00\u4e2a<code>TCP</code>\u8fde\u63a5\uff0c<code>OKHttp</code>\u4e5f\u505a\u4e86\u76f8\u5e94\u7684\u4f18\u5316\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e0b<code>OKHttp</code>\u662f\u600e\u4e48\u590d\u7528<code>TCP</code>\u8fde\u63a5\u7684</p> <p><code>ConnectInterceptor</code>\u4e2d\u67e5\u627e\u8fde\u63a5\u7684\u4ee3\u7801\u4f1a\u6700\u7ec8\u4f1a\u8c03\u7528\u5230<code>ExchangeFinder.findConnection</code>\u65b9\u6cd5\uff0c\u5177\u4f53\u5982\u4e0b</p> <pre><code># ExchangeFinder\n//\u4e3a\u627f\u8f7d\u65b0\u7684\u6570\u636e\u6d41 \u5bfb\u627e \u8fde\u63a5\u3002\u5bfb\u627e\u987a\u5e8f\u662f \u5df2\u5206\u914d\u7684\u8fde\u63a5\u3001\u8fde\u63a5\u6c60\u3001\u65b0\u5efa\u8fde\u63a5\nprivate RealConnection findConnection(int connectTimeout, int readTimeout, int writeTimeout,\nint pingIntervalMillis, boolean connectionRetryEnabled) throws IOException {\nsynchronized (connectionPool) {\n// 1.\u5c1d\u8bd5\u4f7f\u7528 \u5df2\u7ed9\u6570\u636e\u6d41\u5206\u914d\u7684\u8fde\u63a5.\uff08\u4f8b\u5982\u91cd\u5b9a\u5411\u8bf7\u6c42\u65f6\uff0c\u53ef\u4ee5\u590d\u7528\u4e0a\u6b21\u8bf7\u6c42\u7684\u8fde\u63a5\uff09\nreleasedConnection = transmitter.connection;\nresult = transmitter.connection;\nif (result == null) {\n// 2. \u6ca1\u6709\u5df2\u5206\u914d\u7684\u53ef\u7528\u8fde\u63a5\uff0c\u5c31\u5c1d\u8bd5\u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\u3002\uff08\u8fde\u63a5\u6c60\u7a0d\u540e\u8be6\u7ec6\u8bb2\u89e3\uff09\nif (connectionPool.transmitterAcquirePooledConnection(address, transmitter, null, false)) {\nresult = transmitter.connection;\n}\n}\n}\nsynchronized (connectionPool) {\nif (newRouteSelection) {\n//3. \u73b0\u5728\u6709\u4e86IP\u5730\u5740\uff0c\u518d\u6b21\u5c1d\u8bd5\u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\u3002\u53ef\u80fd\u4f1a\u56e0\u4e3a\u8fde\u63a5\u5408\u5e76\u800c\u5339\u914d\u3002\uff08\u8fd9\u91cc\u4f20\u5165\u4e86routes\uff0c\u4e0a\u9762\u7684\u4f20\u7684null\uff09\nroutes = routeSelection.getAll();\nif (connectionPool.transmitterAcquirePooledConnection(address, transmitter, routes, false)) {\nfoundPooledConnection = true;\nresult = transmitter.connection;\n}\n}\n// 4.\u7b2c\u4e8c\u6b21\u6ca1\u6210\u529f\uff0c\u5c31\u628a\u65b0\u5efa\u7684\u8fde\u63a5\uff0c\u8fdb\u884cTCP + TLS \u63e1\u624b\uff0c\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5. \u662f\u963b\u585e\u64cd\u4f5c\nresult.connect(connectTimeout, readTimeout, writeTimeout, pingIntervalMillis,\nconnectionRetryEnabled, call, eventListener);\nsynchronized (connectionPool) {\n// 5. \u6700\u540e\u4e00\u6b21\u5c1d\u8bd5\u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\uff0c\u6ce8\u610f\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u4e3atrue\uff0c\u5373\u8981\u6c42 \u591a\u8def\u590d\u7528\uff08http2.0\uff09\n//\u610f\u601d\u662f\uff0c\u5982\u679c\u672c\u6b21\u662fhttp2.0\uff0c\u90a3\u4e48\u4e3a\u4e86\u4fdd\u8bc1 \u591a\u8def\u590d\u7528\u6027\uff0c\uff08\u56e0\u4e3a\u4e0a\u9762\u7684\u63e1\u624b\u64cd\u4f5c\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\uff09\u4f1a\u518d\u6b21\u786e\u8ba4\u8fde\u63a5\u6c60\u4e2d\u6b64\u65f6\u662f\u5426\u5df2\u6709\u540c\u6837\u8fde\u63a5\nif (connectionPool.transmitterAcquirePooledConnection(address, transmitter, routes, true)) {\n// \u5982\u679c\u83b7\u53d6\u5230\uff0c\u5c31\u5173\u95ed\u6211\u4eec\u521b\u5efa\u91cc\u7684\u8fde\u63a5\uff0c\u8fd4\u56de\u83b7\u53d6\u7684\u8fde\u63a5\nresult = transmitter.connection;\n} else {\n//\u6700\u540e\u4e00\u6b21\u5c1d\u8bd5\u4e5f\u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u628a\u521a\u521a\u65b0\u5efa\u7684\u8fde\u63a5\u5b58\u5165\u8fde\u63a5\u6c60\nconnectionPool.put(result);\n}\n}\nreturn result;\n}\n</code></pre> <p>\u4e0a\u9762\u7cbe\u7b80\u4e86\u90e8\u5206\u4ee3\u7801\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u8fde\u63a5\u62e6\u622a\u5668\u4f7f\u7528\u4e865\u79cd\u65b9\u6cd5\u67e5\u627e\u8fde\u63a5</p> <ol> <li>\u9996\u5148\u4f1a\u5c1d\u8bd5\u4f7f\u7528 \u5df2\u7ed9\u8bf7\u6c42\u5206\u914d\u7684\u8fde\u63a5\u3002\uff08\u5df2\u5206\u914d\u8fde\u63a5\u7684\u60c5\u51b5\u4f8b\u5982\u91cd\u5b9a\u5411\u65f6\u7684\u518d\u6b21\u8bf7\u6c42\uff0c\u8bf4\u660e\u4e0a\u6b21\u5df2\u7ecf\u6709\u4e86\u8fde\u63a5\uff09</li> <li>\u82e5\u6ca1\u6709 \u5df2\u5206\u914d\u7684\u53ef\u7528\u8fde\u63a5\uff0c\u5c31\u5c1d\u8bd5\u4ece\u8fde\u63a5\u6c60\u4e2d \u5339\u914d\u83b7\u53d6\u3002\u56e0\u4e3a\u6b64\u65f6\u6ca1\u6709\u8def\u7531\u4fe1\u606f\uff0c\u6240\u4ee5\u5339\u914d\u6761\u4ef6\uff1a<code>address</code>\u4e00\u81f4\uff08<code>host</code>\u3001<code>port</code>\u3001\u4ee3\u7406\u7b49\u4e00\u81f4\uff09\uff0c\u4e14\u5339\u914d\u7684\u8fde\u63a5\u53ef\u4ee5\u63a5\u53d7\u65b0\u7684\u8bf7\u6c42\u3002</li> <li>\u82e5\u4ece\u8fde\u63a5\u6c60\u6ca1\u6709\u83b7\u53d6\u5230\uff0c\u5219\u4f20\u5165<code>routes</code>\u518d\u6b21\u5c1d\u8bd5\u83b7\u53d6\uff0c\u8fd9\u4e3b\u8981\u662f\u9488\u5bf9<code>Http2.0</code>\u7684\u4e00\u4e2a\u64cd\u4f5c,<code>Http2.0</code>\u53ef\u4ee5\u590d\u7528<code>square.com</code>\u4e0e<code>square.ca</code>\u7684\u8fde\u63a5</li> <li>\u82e5\u7b2c\u4e8c\u6b21\u4e5f\u6ca1\u6709\u83b7\u53d6\u5230\uff0c\u5c31\u521b\u5efa<code>RealConnection</code>\u5b9e\u4f8b\uff0c\u8fdb\u884c<code>TCP + TLS</code>\u63e1\u624b\uff0c\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\u3002</li> <li>\u6b64\u65f6\u4e3a\u4e86\u786e\u4fdd<code>Http2.0</code>\u8fde\u63a5\u7684\u591a\u8def\u590d\u7528\u6027\uff0c\u4f1a\u7b2c\u4e09\u6b21\u4ece\u8fde\u63a5\u6c60\u5339\u914d\u3002\u56e0\u4e3a\u65b0\u5efa\u7acb\u7684\u8fde\u63a5\u7684\u63e1\u624b\u8fc7\u7a0b\u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6240\u4ee5\u6b64\u65f6\u53ef\u80fd\u8fde\u63a5\u6c60\u65b0\u5b58\u5165\u4e86\u76f8\u540c\u7684\u8fde\u63a5\u3002</li> <li>\u7b2c\u4e09\u6b21\u82e5\u5339\u914d\u5230\uff0c\u5c31\u4f7f\u7528\u5df2\u6709\u8fde\u63a5\uff0c\u91ca\u653e\u521a\u521a\u65b0\u5efa\u7684\u8fde\u63a5\uff1b\u82e5\u672a\u5339\u914d\u5230\uff0c\u5219\u628a\u65b0\u8fde\u63a5\u5b58\u5165\u8fde\u63a5\u6c60\u5e76\u8fd4\u56de\u3002</li> </ol> <p>\u4ee5\u4e0a\u5c31\u662f\u8fde\u63a5\u62e6\u622a\u5668\u5c1d\u8bd5\u590d\u7528\u8fde\u63a5\u7684\u64cd\u4f5c\uff0c\u6d41\u7a0b\u56fe\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"perf-opt/Android/net/okhttp/#52","title":"5.2 \u7a7a\u95f2\u8fde\u63a5\u6e05\u9664","text":"<p>\u4e0a\u9762\u8bf4\u5230\u6211\u4eec\u4f1a\u5efa\u7acb\u4e00\u4e2aTCP\u8fde\u63a5\u6c60\uff0c\u4f46\u5982\u679c\u6ca1\u6709\u4efb\u52a1\u4e86\uff0c\u7a7a\u95f2\u7684\u8fde\u63a5\u4e5f\u5e94\u8be5\u53ca\u65f6\u6e05\u9664\uff0cOKHttp\u662f\u5982\u4f55\u505a\u5230\u7684\u5462?</p> <p><pre><code>  # RealConnectionPool\nprivate val cleanupQueue: TaskQueue = taskRunner.newQueue()\nprivate val cleanupTask = object : Task(\"$okHttpName ConnectionPool\") {\noverride fun runOnce(): Long = cleanup(System.nanoTime())\n}\nlong cleanup(long now) {\nint inUseConnectionCount = 0;//\u6b63\u5728\u4f7f\u7528\u7684\u8fde\u63a5\u6570\nint idleConnectionCount = 0;//\u7a7a\u95f2\u8fde\u63a5\u6570\nRealConnection longestIdleConnection = null;//\u7a7a\u95f2\u65f6\u95f4\u6700\u957f\u7684\u8fde\u63a5\nlong longestIdleDurationNs = Long.MIN_VALUE;//\u6700\u957f\u7684\u7a7a\u95f2\u65f6\u95f4\n//\u904d\u5386\u8fde\u63a5\uff1a\u627e\u5230\u5f85\u6e05\u7406\u7684\u8fde\u63a5, \u627e\u5230\u4e0b\u4e00\u6b21\u8981\u6e05\u7406\u7684\u65f6\u95f4\uff08\u8fd8\u672a\u5230\u6700\u5927\u7a7a\u95f2\u65f6\u95f4\uff09\nsynchronized (this) {\nfor (Iterator&lt;RealConnection&gt; i = connections.iterator(); i.hasNext(); ) {\nRealConnection connection = i.next();\n//\u82e5\u8fde\u63a5\u6b63\u5728\u4f7f\u7528\uff0ccontinue\uff0c\u6b63\u5728\u4f7f\u7528\u8fde\u63a5\u6570+1\nif (pruneAndGetAllocationCount(connection, now) &gt; 0) {\ninUseConnectionCount++;\ncontinue;\n}\n//\u7a7a\u95f2\u8fde\u63a5\u6570+1\nidleConnectionCount++;\n// \u8d4b\u503c\u6700\u957f\u7684\u7a7a\u95f2\u65f6\u95f4\u548c\u5bf9\u5e94\u8fde\u63a5\nlong idleDurationNs = now - connection.idleAtNanos;\nif (idleDurationNs &gt; longestIdleDurationNs) {\nlongestIdleDurationNs = idleDurationNs;\nlongestIdleConnection = connection;\n}\n}\n//\u82e5\u6700\u957f\u7684\u7a7a\u95f2\u65f6\u95f4\u5927\u4e8e5\u5206\u949f \u6216 \u7a7a\u95f2\u6570 \u5927\u4e8e5\uff0c\u5c31\u79fb\u9664\u5e76\u5173\u95ed\u8fd9\u4e2a\u8fde\u63a5\nif (longestIdleDurationNs &gt;= this.keepAliveDurationNs\n|| idleConnectionCount &gt; this.maxIdleConnections) {\nconnections.remove(longestIdleConnection);\n} else if (idleConnectionCount &gt; 0) {\n// else\uff0c\u5c31\u8fd4\u56de \u8fd8\u5269\u591a\u4e45\u5230\u8fbe5\u5206\u949f\uff0c\u7136\u540ewait\u8fd9\u4e2a\u65f6\u95f4\u518d\u6765\u6e05\u7406\nreturn keepAliveDurationNs - longestIdleDurationNs;\n} else if (inUseConnectionCount &gt; 0) {\n//\u8fde\u63a5\u6ca1\u6709\u7a7a\u95f2\u7684\uff0c\u5c315\u5206\u949f\u540e\u518d\u5c1d\u8bd5\u6e05\u7406.\nreturn keepAliveDurationNs;\n} else {\n// \u6ca1\u6709\u8fde\u63a5\uff0c\u4e0d\u6e05\u7406\ncleanupRunning = false;\nreturn -1;\n}\n}\n//\u5173\u95ed\u79fb\u9664\u7684\u8fde\u63a5\ncloseQuietly(longestIdleConnection.socket());\n//\u5173\u95ed\u79fb\u9664\u540e \u7acb\u523b \u8fdb\u884c\u4e0b\u4e00\u6b21\u7684 \u5c1d\u8bd5\u6e05\u7406\nreturn 0;\n}\n</code></pre> \u601d\u8def\u8fd8\u662f\u5f88\u6e05\u6670\u7684\uff1a</p> <ol> <li>\u5728\u5c06\u8fde\u63a5\u52a0\u5165\u8fde\u63a5\u6c60\u65f6\u5c31\u4f1a\u542f\u52a8\u5b9a\u65f6\u4efb\u52a1</li> <li>\u6709\u7a7a\u95f2\u8fde\u63a5\u7684\u8bdd\uff0c\u5982\u679c\u6700\u957f\u7684\u7a7a\u95f2\u65f6\u95f4\u5927\u4e8e5\u5206\u949f \u6216 \u7a7a\u95f2\u6570 \u5927\u4e8e5\uff0c\u5c31\u79fb\u9664\u5173\u95ed\u8fd9\u4e2a\u6700\u957f\u7a7a\u95f2\u8fde\u63a5\uff1b\u5982\u679c \u7a7a\u95f2\u6570 \u4e0d\u5927\u4e8e5 \u4e14 \u6700\u957f\u7684\u7a7a\u95f2\u65f6\u95f4\u4e0d\u5927\u4e8e5\u5206\u949f\uff0c\u5c31\u8fd4\u56de\u52305\u5206\u949f\u7684\u5269\u4f59\u65f6\u95f4\uff0c\u7136\u540e\u7b49\u5f85\u8fd9\u4e2a\u65f6\u95f4\u518d\u6765\u6e05\u7406\u3002</li> <li>\u6ca1\u6709\u7a7a\u95f2\u8fde\u63a5\u5c31\u7b495\u5206\u949f\u540e\u518d\u5c1d\u8bd5\u6e05\u7406\u3002</li> <li>\u6ca1\u6709\u8fde\u63a5\u4e0d\u6e05\u7406\u3002</li> </ol> <p>\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"perf-opt/Android/net/okhttp/#6-okhttp","title":"6 OKHttp\u6846\u67b6\u4e2d\u7528\u5230\u4e86\u54ea\u4e9b\u8bbe\u8ba1\u6a21\u5f0f?","text":"<ol> <li>\u6784\u5efa\u8005\u6a21\u5f0f\uff1a<code>OkHttpClient</code>\u4e0e<code>Request</code>\u7684\u6784\u5efa\u90fd\u7528\u5230\u4e86\u6784\u5efa\u8005\u6a21\u5f0f</li> <li>\u5916\u89c2\u6a21\u5f0f\uff1a <code>OkHttp</code>\u4f7f\u7528\u4e86\u5916\u89c2\u6a21\u5f0f,\u5c06\u6574\u4e2a\u7cfb\u7edf\u7684\u590d\u6742\u6027\u7ed9\u9690\u85cf\u8d77\u6765\uff0c\u5c06\u5b50\u7cfb\u7edf\u63a5\u53e3\u901a\u8fc7\u4e00\u4e2a\u5ba2\u6237\u7aef<code>OkHttpClient</code>\u7edf\u4e00\u66b4\u9732\u51fa\u6765\u3002</li> <li>\u8d23\u4efb\u94fe\u6a21\u5f0f: <code>OKHttp</code>\u7684\u6838\u5fc3\u5c31\u662f\u8d23\u4efb\u94fe\u6a21\u5f0f\uff0c\u901a\u8fc75\u4e2a\u9ed8\u8ba4\u62e6\u622a\u5668\u6784\u6210\u7684\u8d23\u4efb\u94fe\u5b8c\u6210\u8bf7\u6c42\u7684\u914d\u7f6e</li> <li>\u4eab\u5143\u6a21\u5f0f: \u4eab\u5143\u6a21\u5f0f\u7684\u6838\u5fc3\u5373\u6c60\u4e2d\u590d\u7528,<code>OKHttp</code>\u590d\u7528<code>TCP</code>\u8fde\u63a5\u65f6\u7528\u5230\u4e86\u8fde\u63a5\u6c60\uff0c\u540c\u65f6\u5728\u5f02\u6b65\u8bf7\u6c42\u4e2d\u4e5f\u7528\u5230\u4e86\u7ebf\u7a0b\u6c60</li> </ol>"},{"location":"perf-opt/Android/net/okhttp/#7-okhtty","title":"7 OKHtty\u4f18\u7f3a\u70b9","text":""},{"location":"perf-opt/Android/net/okhttp/#71","title":"7.1 \u4f18\u70b9?","text":"<ol> <li>\u4f7f\u7528\u7b80\u5355\uff0c\u5728\u8bbe\u8ba1\u65f6\u4f7f\u7528\u4e86\u5916\u89c2\u6a21\u5f0f\uff0c\u5c06\u6574\u4e2a\u7cfb\u7edf\u7684\u590d\u6742\u6027\u7ed9\u9690\u85cf\u8d77\u6765\uff0c\u5c06\u5b50\u7cfb\u7edf\u63a5\u53e3\u901a\u8fc7\u4e00\u4e2a\u5ba2\u6237\u7aef<code>OkHttpClient</code>\u7edf\u4e00\u66b4\u9732\u51fa\u6765\u3002</li> <li>\u6269\u5c55\u6027\u5f3a\uff0c\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49\u5e94\u7528\u62e6\u622a\u5668\u4e0e\u7f51\u7edc\u62e6\u622a\u5668\uff0c\u5b8c\u6210\u7528\u6237\u5404\u79cd\u81ea\u5b9a\u4e49\u7684\u9700\u6c42</li> <li>\u529f\u80fd\u5f3a\u5927\uff0c\u652f\u6301<code>Spdy</code>\u3001<code>Http1.X</code>\u3001<code>Http2</code>\u3001\u4ee5\u53ca<code>WebSocket</code>\u7b49\u591a\u79cd\u534f\u8bae</li> <li>\u901a\u8fc7\u8fde\u63a5\u6c60\u590d\u7528\u5e95\u5c42<code>TCP</code>(<code>Socket</code>)\uff0c\u51cf\u5c11\u8bf7\u6c42\u5ef6\u65f6</li> <li>\u65e0\u7f1d\u7684\u652f\u6301<code>GZIP</code>\u51cf\u5c11\u6570\u636e\u6d41\u91cf</li> <li>\u652f\u6301\u6570\u636e\u7f13\u5b58,\u51cf\u5c11\u91cd\u590d\u7684\u7f51\u7edc\u8bf7\u6c42</li> <li>\u652f\u6301\u8bf7\u6c42\u5931\u8d25\u81ea\u52a8\u91cd\u8bd5\u4e3b\u673a\u7684\u5176\u4ed6<code>ip</code>\uff0c\u81ea\u52a8\u91cd\u5b9a\u5411</li> </ol>"},{"location":"perf-opt/Android/net/okhttp/#72","title":"7.2 \u7f3a\u70b9?","text":"<p>\u4e0d\u652f\u6301\u8de8\u5e73\u53f0\uff0c\u5bf9\u4e8e\u5927\u578b\u5e94\u7528\u6765\u8bf4\u8de8\u5e73\u53f0\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u6211\u4eec\u4e0d\u5e0c\u671b\u6240\u6709\u7684\u4f18\u5316 Android \u548c iOS \u90fd\u8981\u5404\u81ea\u53bb\u5b9e\u73b0\u4e00\u5957\uff0c\u4e0d\u4ec5\u6d6a\u8d39\u4eba\u529b\u800c\u4e14\u8fd8\u5bb9\u6613\u51fa\u95ee\u9898\u3002</p>"},{"location":"perf-opt/Android/net/okhttp/#_1","title":"\u53c2\u8003","text":"<p>Android\u5f00\u53d1\u9ad8\u624b\u8bfe</p> <p>OkHttp \u539f\u7406 8 \u8fde\u95ee</p> <p>\u542c\u8bf4\u4f60\u719f\u6089OkHttp\u539f\u7406?</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/","title":"Android \u5305\u4f53\u79ef\u4f18\u5316","text":""},{"location":"perf-opt/Android/size/Android-apk-size-opt/#1","title":"1. \u4e3a\u4ec0\u4e48\u8981\u4f18\u5316\u5305\u4f53\u79ef","text":"<ul> <li>\u63d0\u9ad8\u5e94\u7528\u4e0b\u8f7d\u8f6c\u5316\u7387</li> </ul> <p>\u636e GooglePlay \u5e73\u53f0\u5bf9\u5916\u53d1\u5e03\u76f8\u5173\u7684\u5305\u5927\u5c0f\u5bf9\u8f6c\u5316\u7387\u5f71\u54cd\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u968f\u7740\u5305\u5927\u5c0f\u7684\u589e\u52a0\uff0c\u5b89\u88c5\u8f6c\u5316\u7387\u603b\u4f53\u5448\u4e0b\u964d\u7684\u8d8b\u52bf\u3002</p> <p></p> <ul> <li>\u51cf\u5c11\u5b89\u88c5\u65f6\u95f4</li> </ul> <p>\u6bd4\u5982\u6587\u4ef6\u62f7\u8d1d\u3001Library\u89e3\u538b\uff0c\u5e76\u4e14\uff0c\u5728\u7f16\u8bd1 ODEX \u7684\u65f6\u5019\uff0c\u7279\u522b\u662f\u5bf9\u4e8eAndroid 5.0 \u548c 6.0 \u7cfb\u7edf\u6765\u8bf4\uff0c\u8017\u8d39\u7684\u65f6\u95f4\u6bd4\u8f83\u4e45\uff0c\u800cAndroid 7.0 \u4e4b\u540e\u6709\u4e86\u6df7\u5408\u7f16\u8bd1\uff0c\u76f8\u5bf9\u6765\u8bf4\u8fd8\u53ef\u4ee5\u63a5\u53d7\u3002App \u53d8\u5927\u540e\uff0c\u5176\u7b7e\u540d\u6821\u9a8c\u7684\u65f6\u95f4\u4e5f\u4f1a\u53d8\u957f</p> <ul> <li>\u964d\u4f4e\u8fd0\u884c\u65f6\u5185\u5b58</li> </ul> <p>\u200b       Resource \u8d44\u6e90\u3001Library \u4ee5\u53ca Dex \u7c7b\u52a0\u8f7d\u90fd\u4f1a\u5360\u7528\u5e94\u7528\u7684\u4e00\u90e8\u5206\u5185\u5b58\u3002</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#2-apk","title":"2. APK \u5206\u6790","text":""},{"location":"perf-opt/Android/size/Android-apk-size-opt/#21-analyze-apkas","title":"2.1 Analyze APK\uff08AS\u81ea\u5e26\uff09","text":"<p>\u9002\u5408\u521d\u671f\u4f18\u5316\u5b9a\u6027\u5206\u6790</p> <ul> <li> <p>\u80fd\u591f\u76f4\u89c2\u5730\u67e5\u770b\u5230 APK \u7684\u7ec4\u6210\uff0c\u8b6c\u5982\u5927\u5c0f\u3001\u5360\u6bd4\u7b49\u7b49\u3002</p> </li> <li> <p>\u67e5\u770bdex\u6587\u4ef6\u7684\u7ec4\u6210\u3002</p> </li> <li> <p>\u5bf9\u4e0d\u4e00\u6837\u7684APK\u8fdb\u884c\u5bf9\u6bd4\u5206\u6790\u3002</p> </li> </ul>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#22-apk-checker","title":"2.2 \u5fae\u4fe1APK Checker","text":"<p>Apk\u5206\u6790\u68c0\u6d4b\u5de5\u5177,\u9002\u5408\u5206\u6790\u6392\u67e5\u95ee\u9898\u4ee5\u53ca\u7248\u672c\u8ffd\u8e2a</p> <ul> <li> <p>\u68c0\u6d4bapk\u662f\u5426\u5b58\u5728\u7279\u5b9a\u7684\u95ee\u9898</p> </li> <li> <p>\u8f93\u51fa\u8f83\u4e3a\u8be6\u7ec6\u7684\u68c0\u6d4b\u7ed3\u679c\u62a5\u544a</p> </li> </ul>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#23-android-classshark","title":"2.3 android-classshark","text":"<p>Apk\u5206\u6790\u5de5\u5177\uff0c\u9002\u5408\u4f18\u5316\u524d\u671f\u5b9a\u6027\u5206\u6790</p> <ul> <li> <p>\u53ef\u4ee5\u901a\u8fc7\u56fe\u5f62\u5316\u67e5\u770b\u6574\u4e2aapk\u7684\u7ec4\u6210\u67b6\u6784</p> </li> <li> <p>\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u5230\u5404\u4e2a\u5305\u4e0b\u7684\u65b9\u6cd5\u6570\u548c\u76f8\u5bf9\u5927\u5c0f</p> </li> <li> <p>\u53ef\u4ee5\u5206\u6790\u52a8\u6001\u5e93\u4f9d\u8d56\u548c<code>Dynamic Symbols</code></p> </li> </ul>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#24-jadx","title":"2.4 jadx","text":"<p>\u53cd\u7f16\u8bd1\u5de5\u5177\uff0c\u9002\u5408\u4f18\u5316\u540e\u9a8c\u8bc1\u4f18\u5316\u6548\u679c</p> <p>\u5982\u7f16\u8bd1\u671f\u95f4\u505a\u4e86\u5b57\u8282\u7801\u4fee\u6539</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#25-apktooldex2jarjd-gui","title":"2.5 \u8001\u4e09\u5957: ApkTool,dex2jar,JD-GUI\uff08\u4e0d\u63a8\u8350\uff09","text":"<p>\u53cd\u7f16\u8bd1\u5de5\u5177</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#3","title":"3. \u5305\u4f53\u79ef\u4f18\u5316","text":""},{"location":"perf-opt/Android/size/Android-apk-size-opt/#31-apk","title":"3.1 APK\u7ec4\u6210","text":"<p>APK \u683c\u5f0f\uff0c\u5176\u5b9e\u8d28\u5219\u662f\u4e00\u4e2a\u5305\u542b\u5e94\u7528\u6240\u6709\u6240\u9700\u8d44\u6e90\u7684 zip \u5305\uff0c\u5b83\u5305\u542b\u4e86\u5982\u4e0b\u6240\u793a\u7684\u51e0\u4e2a\u7ec4\u6210\u90e8\u5206\uff1a</p> <p></p> <p>\u6211\u4eec\u6839\u636e\u5176\u7ec4\u6210\u90e8\u5206\u5404\u81ea\u7684\u7279\u5b9a\u5165\u624b\u4f18\u5316\u3002</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#32-dex","title":"3.2 DEX\u4f18\u5316","text":""},{"location":"perf-opt/Android/size/Android-apk-size-opt/#321","title":"3.2.1 \u79fb\u9664\u6389\u6240\u6709\u65e0\u7528\u6216\u8005\u529f\u80fd\u91cd\u590d\u7684\u4ee3\u7801/\u4f9d\u8d56\u5e93","text":"<p>\u5728\u5feb\u901f\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u80fd\u4f1a\u4e0d\u5c0f\u5fc3\u5f15\u5165\u4e00\u4e9b\u6d4b\u8bd5\u4ee3\u7801\u6216\u8005\u6709\u4e00\u4e9b\u5e9f\u5f03\u4e1a\u52a1\u5df2\u7ecf\u5bf9\u7528\u6237\u4e0d\u53ef\u89c1\u4f46\u4ee3\u7801\u4ecd\u7136\u9057\u7559\u5728\u4ee3\u7801\u4ed3\u5e93\u4e2d\uff0c\u8fd9\u4e9b\u4ee3\u7801\u53ef\u80fd\u7531\u4e8e\u867d\u7136\u4e0d\u53ef\u7528\uff0c\u4f46\u7531\u4e8e\u548c\u5176\u4ed6\u4e1a\u52a1\u6709\u4f9d\u8d56\u6216\u5173\u8054\uff0c\u5bfc\u81f4<code>ProGuard</code> \u8fc7\u7a0b\u6211\u4eec\u65e0\u6cd5<code>shrink</code> \u6389\u3002</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#322-proguard","title":"3.2.2 ProGuard","text":"<p>\u201c\u5341\u4e2a ProGuard  \u914d\u7f6e\u4e5d\u4e2a\u5751\u201d\uff0c\u7279\u522b\u662f\u5404\u79cd\u7b2c\u4e09\u65b9 SDK\u3002\u6211\u4eec\u9700\u8981\u4ed4\u7ec6\u68c0\u67e5\u6700\u7ec8\u5408\u5e76\u7684 ProGuard \u914d\u7f6e\u6587\u4ef6\uff0c\u662f\u4e0d\u662f\u5b58\u5728 \u8fc7\u5ea6 keep  \u7684\u73b0\u8c61\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u6cd5\u8f93\u51fa ProGuard \u7684\u6700\u7ec8\u914d\u7f6e\uff0c\u5c24\u5176\u9700\u8981\u6ce8\u610f\u5404\u79cd\u7684<code>keep *</code>\uff0c\u5f88\u591a\u60c5\u51b5\u4e0b\u6211\u4eec\u53ea\u9700\u8981 keep  \u5176\u4e2d\u7684\u67d0\u4e2a\u5305\u3001\u67d0\u4e2a\u65b9\u6cd5\uff0c\u6216\u8005\u662f\u7c7b\u540d\u5c31\u53ef\u4ee5\u4e86\u3002</p> <pre><code>-printconfiguration  configuration.txt\n</code></pre>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#323-class","title":"3.2.3 \u4fee\u6539Class \u5b57\u8282\u7801","text":"<p>\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a</p> <ul> <li>\u5355\u7eaf\u53bb\u9664\u65e0\u7528\u7684\u4ee3\u7801\u6307\u4ee4\uff0c\u5305\u62ec \u53bb\u9664\u5197\u4f59\u8d4b\u503c\uff0c\u65e0\u526f\u4f5c\u7528\u4ee3\u7801\u5220\u9664 \u7b49</li> <li>\u9664\u4e86\u80fd\u51cf\u5c11\u4ee3\u7801\u6307\u4ee4\u6570\u91cf\u5916\uff0c\u540c\u65f6\u51cf\u5c11\u65b9\u6cd5\u548c\u5b57\u6bb5\u7684\u6570\u91cf\uff0c\u4ece\u800c\u6709\u6548\u51cf\u5c11 DEX \u7684\u6570\u91cf\u3002\u6211\u4eec\u77e5\u9053 DEX \u4e2d\u5f15\u7528\u65b9\u6cd5\u6570\u3001\u5f15\u7528\u5b57\u6bb5\u6570\u7b49\u4e0d\u80fd\u8d85\u8fc7 65535\uff0c\u8d85\u8fc7\u4e4b\u540e\u5c31\u9700\u8981\u65b0\u5f00\u4e00\u4e2a DEX \u6587\u4ef6\uff0c\u56e0\u6b64\u51cf\u5c11 DEX \u4e2d\u65b9\u6cd5\u6570\u3001\u5b57\u6bb5\u6570\u53ef\u4ee5\u51cf\u5c11 DEX \u6587\u4ef6\u6570\u91cf\uff0c\u50cf \u77ed\u65b9\u6cd5\u5185\u8054\u3001\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664\u3001R \u5e38\u91cf\u5185\u8054 \u5c31\u5c5e\u4e8e\u8fd9\u7c7b\u4f18\u5316\u3002</li> </ul> <p>\u8be6\u7ec6\u53c2\u89c1ByteX</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#324-debug","title":"3.2.4 \u53bb\u6389 Debug \u4fe1\u606f\u6216\u8005\u53bb\u6389\u884c\u53f7","text":"<p>\u67d0\u4e2a\u5e94\u7528\u901a\u8fc7\u76f8\u540c\u7684 ProGuard  \u89c4\u5219\u751f\u6210\u4e00\u4e2a Debug \u5305\u548c Release \u5305\uff0c\u5176\u4e2d Debug \u5305\u7684\u5927\u5c0f\u662f 4MB\uff0cRelease \u5305\u53ea\u6709 3.5MB\u3002\u65e2\u7136\u5b83\u4eec  ProGuard \u7684\u6df7\u6dc6\u4e0e\u4f18\u5316\u7684\u89c4\u5219\u662f\u4e00\u6837\u7684\uff0c\u90a3\u5b83\u4eec\u4e4b\u95f4\u7684\u5dee\u5f02\u5728\u54ea\u91cc\u5462\uff1f\u90a3\u5c31\u662f <code>DebugItem</code>\u3002</p> <p></p> <p>DebugItem \u91cc\u9762\u4e3b\u8981\u5305\u542b\u4e24\u79cd\u4fe1\u606f\uff1a</p> <ul> <li> <p>\u8c03\u8bd5\u7684\u4fe1\u606f\u3002\u51fd\u6570\u7684\u53c2\u6570\u53d8\u91cf\u548c\u6240\u6709\u7684\u5c40\u90e8\u53d8\u91cf\u3002</p> </li> <li> <p>\u6392\u67e5\u95ee\u9898\u7684\u4fe1\u606f\u3002\u6240\u6709\u7684\u6307\u4ee4\u96c6\u884c\u53f7\u548c\u6e90\u6587\u4ef6\u884c\u53f7\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> </li> </ul> <p>\u4e8b\u5b9e\u4e0a\uff0c\u5728 ProGuard \u914d\u7f6e\u4e2d\u4e00\u822c\u6211\u4eec\u4e5f\u4f1a\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u5f0f\u4fdd\u7559\u884c\u53f7\u4fe1\u606f\u3002</p> <pre><code>-keepattributes SourceFile, LineNumberTable\n</code></pre> <p>\u5bf9\u4e8e\u53bb\u9664 debuginfo  \u4ee5\u53ca\u884c\u53f7\u4fe1\u606f\u66f4\u8be6\u7ec6\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u4e00\u4e0b\u652f\u4ed8\u5b9d\u7684\u4e00\u7bc7\u6587\u7ae0 Android  \u5305\u5927\u5c0f\u6781\u81f4\u538b\u7f29\u300b\u3002\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u65e2\u4fdd\u7559\u884c\u53f7\uff0c\u4f46\u662f\u53c8\u53ef\u4ee5\u51cf\u5c11\u5927\u7ea6 5% \u7684 Dex \u4f53\u79ef\u3002\u4e8b\u5b9e\u4e0a\uff0c\u652f\u4ed8\u5b9d\u53c2\u8003\u7684\u662f Facebook  \u7684\u4e00\u4e2a\u5f00\u6e90\u7f16\u8bd1\u5de5\u5177ReDex\u3002</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#33","title":"3.3 \u8d44\u6e90\u4f18\u5316","text":""},{"location":"perf-opt/Android/size/Android-apk-size-opt/#331","title":"3.3.1 \u65e0\u7528\u8d44\u6e90\u5220\u9664","text":"<p>\u5e94\u7528\u901a\u8fc7\u957f\u65f6\u95f4\u7684\u8fed\u4ee3\uff0c\u603b\u4f1a\u6709\u4e00\u4e9b\u65e0\u7528\u7684\u8d44\u6e90\uff0c\u5c3d\u7ba1\u5b83\u4eec\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e0d\u4f1a\u88ab\u4f7f\u7528\uff0c\u4f46\u662f\u4f9d\u7136\u5360\u636e\u7740\u5b89\u88c5\u5305\u7684\u4f53\u79ef\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5220\u9664\u65e0\u7528\u8d44\u6e90</p> <ul> <li>lint</li> </ul> <p>\u4ece Eclipse \u65f6\u4ee3\u5f00\u59cb\uff0c\u6211\u4eec\u5c31\u5f00\u59cb\u4f7f\u7528Lint\u8fd9\u4e2a\u9759\u6001\u4ee3\u7801\u626b\u63cf\u5de5\u5177\uff0c\u5b83\u91cc\u9762\u5c31\u652f\u6301 <code>Unused Resources</code> \u626b\u63cf\u3002   \u6211\u4eec\u65e2\u53ef\u4ee5\u901a\u8fc7gradle\u811a\u672c\u65b9\u5f0f\u5f15\u5165   </p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u76f4\u63a5\u901a\u8fc7AS\u6267\u884c      \u7136\u540e\u6211\u4eec\u76f4\u63a5\u9009\u62e9<code>\u201cRemove All Unused Resources\u201d</code>\uff0c\u5c31\u53ef\u4ee5\u8f7b\u677e\u5220\u9664\u6240\u6709\u7684\u65e0\u7528\u8d44\u6e90\u4e86\u3002</p> <p>\u6ce8\u610f</p> <ul> <li>kotlin \u517c\u5bb9\u6027\u4e0d\u592a\u597d   </li> <li>lint\u626b\u63cf\u5de5\u5177\u65e0\u6cd5\u5224\u65ad\u51fa\u901a\u8fc7\u53cd\u5c04\u65b9\u5f0f(<code>android.content.res.Resources#getIdetifier</code>)\u6765\u83b7\u53d6\u7684\u8d44\u6e90\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u8bef\u5220\u9664</li> <li>\u53ea\u5728application module\u8fd0\u884c\uff0c\u5e76\u4e14\u8981\u518d\u6b21\u786e\u8ba4\u8d44\u6e90\u662f\u5426\u8bef\u5220</li> <li>\u5224\u65ad\u662f\u5426\u8bef\u5220\u53ef\u4ee5\u901a\u8fc7\u5168\u5c40\u641c\u7d22<code>getIdetifier</code>\u6216<code>.view.*</code>\uff0c\u7136\u540e\u7ed3\u679c\u548c\u5f85\u5220\u9664\u5217\u8868\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5220\u9664\u8d44\u6e90\u540e\u91cd\u65b0\u7f16\u8bd1\u8fd0\u884c\uff0c\u76f4\u5230\u9879\u76ee\u5b8c\u5168\u8fd0\u884c\u8d77\u6765</li> </ul> <ul> <li>shrinkResources<ul> <li>\u9ed8\u8ba4\u914d\u7f6e Lint \u4f5c\u4e3a\u4e00\u4e2a\u9759\u6001\u626b\u63cf\u5de5\u5177\uff0c\u5b83\u6700\u5927\u7684\u95ee\u9898\u5728\u4e8e\u6ca1\u6709\u8003\u8651\u5230 ProGuard \u7684\u4ee3\u7801\u88c1\u526a\u3002\u5728 ProGuard \u8fc7\u7a0b\u6211\u4eec\u4f1a shrink \u6389\u5927\u91cf\u7684\u65e0\u7528\u4ee3\u7801\uff0c\u4f46\u662f Lint \u5de5\u5177\u5e76\u4e0d\u80fd\u68c0\u67e5\u51fa\u8fd9\u4e9b\u65e0\u7528\u4ee3\u7801\u6240\u5f15\u7528\u7684\u65e0\u7528\u8d44\u6e90\u3002\u6240\u4ee5 Android \u589e\u52a0\u4e86<code>shrinkResources</code>\u8d44\u6e90\u538b\u7f29\u529f\u80fd\uff0c\u5b83\u9700\u8981\u914d\u5408 ProGurad \u7684<code>minifyEnabled</code>\u529f\u80fd\u540c\u65f6\u4f7f\u7528\u3002   <pre><code>android {\n...\n    buildTypes {\nrelease {\nshrinkResources true\nminifyEnabled true\n}\n}\n}\n</code></pre></li> <li>\u5f00\u542fshrinkResources\u4e25\u683c\u6a21\u5f0f \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>Resource shrink</code> \u662f <code>safe</code> \u6a21\u5f0f\u7684\uff0c\u5373\u5176\u4f1a\u5e2e\u52a9\u6211\u4eec\u8bc6\u522b\u7c7b\u4f3c    \u8fd9\u6837\u6a21\u5f0f\u7684\u4ee3\u7801\uff0c\u4ece\u800c\u4fdd\u8bc1\u6211\u4eec\u5728\u53cd\u5c04\u8c03\u7528\u8d44\u6e90\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u80fd\u591f\u5b89\u5168\u8fd4\u56de\u8d44\u6e90\u7684\u3002  \u4e25\u683c\u6a21\u5f0f\u5f00\u542f\u65b9\u6cd5\uff1a\u5728<code>res/raw/</code>\u76ee\u5f55\u65b0\u5efa keep.xml \uff0c\u914d\u7f6e\u5982\u4e0b   </li> </ul> </li> </ul> <p><code>safe</code> \u6a21\u5f0f\u662f\u901a\u8fc7\u5339\u914d\u5b57\u7b26\u4e32\u6765\u786e\u5b9a\u662f\u5426\u5220\u9664\u8d44\u6e90\uff0c\u4f8b\u5982\uff0c\u4ee5\u4e0a\u4ee3\u7801\u4f1a\u5c06\u6240\u6709\u5e26<code>img_</code> \u524d\u7f00\u7684\u8d44\u6e90\u6807\u8bb0\u4e3a\u5df2\u4f7f\u7528\u3002\u4f46\u662f\u8fd9\u4e5f\u9020\u6210\u4e86\u5728\u5b89\u5168\u6a21\u5f0f\u4e0b\uff0c\u4e0d\u5c0f\u5fc3\u88ab\u67d0\u4e2a\u5b57\u7b26\u4e32\u6240\u5339\u914d\u5230\u7684\u8d44\u6e90\uff0c\u5373\u4f7f\u6ca1\u6709\u88ab\u4f7f\u7528\u4e5f\u4f1a\u88ab\u4fdd\u7559\u4e0b\u6765\u3002</p> <p>\u6ce8\u610f</p> <ul> <li>\u5f00\u542f\u4e25\u683c\u6a21\u5f0f\u540e\uff0c\u5982\u679c\u8bef\u5220\uff0c\u9879\u76ee\u8fd0\u884c\u65f6\u4f1a\u62a5<code>Caused by: java.lang.ClassNotFoundException: android.view.x</code>\uff0c\u8981\u662f\u53d1\u73b0\u8fd9\u6837\u7684\u9519\u8bef\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u662f\u4e0d\u662f\u4e25\u683c\u6a21\u5f0f\u5bfc\u81f4</li> </ul>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#332","title":"3.3.2 \u56fe\u7247\u538b\u7f29","text":"<p>\u56fe\u7247\u662f\u5305\u4f53\u79ef\u7684\u5176\u4e2d\u4e00\u4e2a\u5927\u5934\uff0c\u53ef\u4ee5\u7528cwebp\u5c06\u56fe\u7247\u8f6c\u5316\u6210<code>webp</code>\u683c\u5f0f \uff0c\u5bf9\u4e8e\u4e0d\u80fd\u8f6c\u5316\u4e3a<code>webp</code>\u683c\u5f0f\u7684\u56fe\u7247\uff0c<code>png</code>\u56fe\u7247\u53ef\u4ee5\u4f7f\u7528pngquant\u538b\u7f29\uff0c<code>jpg</code>\u56fe\u7247\u53ef\u4ee5guetzli\u538b\u7f29\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7gradle\u63d2\u4ef6\u5c06\u8fd9\u4e00\u8fc7\u7a0b\u901a\u8fc7\u81ea\u52a8\u5316\u3002</p> <p>\u539f\u7406\u5927\u81f4\u5982\u4e0b\uff1a</p> <p>\u5728 apk \u6253\u5305\u8fc7\u7a0b\u4e2d\uff0c\u7ecf\u8fc7 <code>aapt(Android \u8d44\u6e90\u6253\u5305\u5de5\u5177)</code>\u5904\u7406\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u8d44\u6e90\u6587\u4ef6\uff0c\u5305\u62ecmanifest\u6587\u4ef6\u90fd\u4f1a\u88ab\u6253\u5305\u6210\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u540d\u5b57\u53eb\u505a <code>resources.ap_</code>\u3002</p> <p>\u4e86\u89e3\u8d44\u6e90\u6253\u5305\u539f\u7406\u540e\uff0c\u5173\u952e\u5c31\u662f\u627e\u5230hook\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5hook\u6253\u5305\u4efb\u52a1\uff0c\u4e5f\u5c31\u662f <code>packageXXX</code>\u4efb\u52a1\uff0c\u7136\u540e <code>\u89e3\u538b\u00a0xx.ap_\u6587\u4ef6 --&gt; \u5168\u5c40\u538b\u7f29\u8d44\u6e90 --&gt; \u91cd\u65b0\u538b\u7f29xx.ap_\u6587\u4ef6</code>\u3002\u5927\u81f4hook\u4ee3\u7801\u5982\u4e0b\uff1a   </p> <p>\u6ce8\u610f</p> <p>\u7f51\u4e0a\u76db\u4f20\u7684hook\u00a0<code>mergeResourceXXX</code>\u4efb\u52a1\u4e0d\u662f\u597d\u65f6\u673a\uff0c\u9700\u8981\u517c\u5bb9\u5e76\u884c\u7f16\u8bd1\uff0c\u53ef\u80fd\u7f16\u8bd1\u8fc7\u7a0b\u4f1a\u51fa\u73b0\u8d44\u6e90\u627e\u4e0d\u5230\u7684\u5f02\u5e38</p> <ul> <li>\u4f7f\u7528webp\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\uff0c\u5f53\u56fe\u7247\u6709\u6e10\u53d8\u548c\u5916\u53d1\u5149\u5e76\u4e14\u901a\u8fc7tinypng\u538b\u7f29\uff0c\u518d\u8f6cwebp\u683c\u5f0f\uff0c\u56fe\u7247\u5c31\u4f1a\u53d8\u5927\u3002\u539f\u56e0\u5982\u4e0b\uff1a<ul> <li>Type\u53d8\u66f4\uff1a\u539f\u56fe\u7684Type\u4e3aPalette\uff0c\u5904\u7406\u4e4b\u540e\u7684Type\u4e3aTrueColor\uff0c\u5373\u539f\u56fe\u4e3a\u7d22\u5f15\u7c7b\u578b\uff0c\u5904\u7406\u4e4b\u540e\u7684\u56fe\u7247\u4e3aRGB\u771f\u5f69\u8272\uff0c\u9700\u8981\u7f16\u7801\u7684\u50cf\u7d20\u70b9\u4e2a\u6570\u662f\u7d22\u5f15\u7c7b\u578b\u7684\u4e09\u500d\uff0c\u56e0\u6b64\u5bfc\u81f4\u56fe\u7247\u53d8\u5927</li> <li>Colors\u53d8\u591a\uff1a\u989c\u8272\u6570\u76ee\u7531256\u589e\u957f\u5230\u4e8667000\u591a\u4e2a\uff0c\u8bf4\u660e\u5904\u7406\u524d\u7684\u56fe\u7247\u7ec6\u8282\u4e0a\u91cd\u590d\u8f83\u591a\uff0c\u5bfc\u81f4\u4e86\u5904\u7406\u540e\u7684\u56fe\u7247\u6bd4\u539f\u56fe\u8fd8\u5927\u4e86\u5f88\u591a\u3002</li> <li>\u53c2\u8003</li> </ul> </li> </ul>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#333-arsc","title":"3.3.3 arsc\u538b\u7f29","text":"<p>\u8fd9\u5757\u4e3b\u8981\u4f7f\u7528AndResGuard\u5de5\u5177\u3002</p> <p>resources.arsc\u539f\u7406\u7b80\u8ff0  \u53ef\u4ee5\u628a\u5b83\u770b\u4f5c\u4e00\u5f20\u8d44\u6e90\u7d22\u5f15\u8868\uff0c\u5b83\u548c\u6211\u4eec\u7684R\u6587\u4ef6\u662f\u76f8\u5173\u8054\u7684\uff0c\u7b80\u5355\u6765\u8bf4R.java\u4e2d\u7684id\uff08<code>0xPPTTEEEE</code>\uff09\u5b58\u5728\u4e8e<code>resources.arsc</code>\u6587\u4ef6\u4e2d\u7684id\u6570\u7ec4\uff0c\u7136\u540eid\u6570\u7ec4\u6620\u5c04\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0c\u5373\u53ef\u627e\u5230id\u5bf9\u5e94\u7684\u503c\u3002\u5b83\u4f1a\u88ab\u6211\u4eecJava\u5c42\u7684<code>AssetManager</code>\u52a0\u8f7d\uff0c\u5982\u679c\u6709\u8fc7\u63d2\u4ef6\u5316\u5f00\u53d1\u7ecf\u9a8c\u7684\u540c\u5b66\u5e94\u8be5\u77e5\u9053\uff0c\u5b83\u662f\u901a\u8fc7<code>addAssetPath</code>\u8fd9\u4e2a\u65b9\u6cd5\u53bb\u52a0\u8f7d\u7684\u3002</p> <ul> <li> <p>\u8d44\u6e90\u6df7\u6dc6 \u65e2\u7136\u8d44\u6e90 id \u4e0e\u8d44\u6e90\u5168\u8def\u5f84\u7684\u6620\u5c04\u5173\u7cfb\u8bb0\u5f55\u5728 arsc \u6587\u4ef6\u4e2d\uff0capp \u901a\u8fc7\u8d44\u6e90 id \u518d\u901a\u8fc7 Resource \u83b7\u53d6\u5bf9\u5e94\u7684\u8d44\u6e90\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6620\u5c04\u5173\u7cfb\u4e2d\u7684\u8d44\u6e90\u8def\u5f84\u505a\u540d\u5b57\u6df7\u6dc6\u53ef\u4ee5\u8fbe\u5230\u51cf\u5c11\u5305\u4f53\u79ef\u7684\u6548\u679c\u3002\u4f8b\u5982\u5c06<code>res/drawable/welcome.png</code>\u6df7\u6dc6\u4e3a<code>r/s/a.png</code></p> </li> <li> <p>\u5408\u5e76\u91cd\u590d\u8d44\u6e90 \u5bf9 md5 \u76f8\u540c\u7684\u8d44\u6e90\u6587\u4ef6\u4fdd\u7559\u4e00\u4efd\uff0c\u5220\u9664\u5176\u4f59\u7684\u91cd\u590d\u7684\u6587\u4ef6\uff0c\u7136\u540e\u5728\u5199\u5165arsc\u6587\u4ef6\u65f6\u5c06\u5220\u9664\u7684\u8d44\u6e90\u6587\u4ef6\u5bf9\u5e94\u7684\u8d44\u6e90\u8def\u5f84\u6307\u5411\u552f\u4e00\u4fdd\u7559\u7684\u90a3\u4e00\u4efd\u8d44\u6e90\u6587\u4ef6\u3002</p> </li> <li> <p>\u5220\u9664\u65e0\u7528Name <code>resources.arsc</code>\u6587\u4ef6\u4e2d\u7684name\u5217\u5728\u7f16\u8bd1\u4e4b\u540e\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u662f\u7528\u4e0d\u4e0a\u7684\uff0c\u9664\u975e\u662f\u901a\u8fc7<code>getIdentifier</code>\u8c03\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u901a\u8fc7 <code>getIdentifier</code> \u8c03\u7528\u7684\u8d44\u6e90\uff0c\u914d\u7f6e\u6210\u767d\u540d\u5355\u3002\u904d\u5386 <code>name</code> \u9879\uff0c\u5982\u679c\u4e0d\u5728\u767d\u540d\u5355\uff0c\u90a3\u4e48\u628a<code>name</code>\u5217\u6df7\u6dc6\u6210\u76f8\u540c\u7684\u540d\u5b57\uff0c\u4f8b\u5982<code>a</code>\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11string\u5e38\u91cf\u6c60\u7684\u5927\u5c0f\uff0c</p> </li> </ul>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#334","title":"3.3.4 \u8d44\u6e90\u52a8\u6001\u4e0b\u8f7d","text":"<p>\u5c06\u4e00\u4e9b\u56fe\u7247\u8d44\u6e90\u653e\u5728\u670d\u52a1\u5668\uff0c\u7ed3\u5408\u56fe\u7247\u9884\u52a0\u8f7d\uff0c\u8fd9\u6837\u65e2\u80fd\u591f\u6ee1\u8db3\u4ea7\u54c1\u7684\u9700\u6c42\uff0c\u540c\u65f6\u4e5f\u80fd\u591f\u51cf\u5c11\u5305\u5927\u5c0f\u3002</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#34-so","title":"3.4 so\u4f18\u5316","text":""},{"location":"perf-opt/Android/size/Android-apk-size-opt/#341","title":"3.4.1 \u53ea\u5f15\u5165\u5355\u4e00\u67b6\u6784\u6587\u4ef6","text":"<p>\u76ee\u524d\uff0cAndroid \u4e00\u5171 \u652f\u63017\u79cd\u4e0d\u4e00\u6837\u7c7b\u578b\u7684 CPU \u67b6\u6784\uff0c\u597d\u6bd4\u5e38\u89c1\u7684\u00a0<code>armeabi\u3001armeabi-v7a\u3001X86</code>\u7b49\u7b49\u3002\u7406\u8bba\u4e0a\u6765\u8bb2\uff0c\u5bf9\u5e94\u67b6\u6784\u7684 CPU \u5b83\u7684\u6267\u884c\u6548\u7387\u662f\u6700\u9ad8\u7684\uff0c\u53ef\u662f\u8fd9\u6837\u4f1a\u81f4\u4f7f \u5728 lib \u76ee\u5f55\u4e0b\u4f1a\u591a\u5b58\u653e\u4e86\u5404\u4e2a\u5e73\u53f0\u67b6\u6784\u7684 So \u6587\u4ef6\uff0c\u56e0\u6b64 App \u7684\u4f53\u79ef\u4e5f\u5c31\u66f4\u5927\u4e86\u3002\u76ee\u524d\u624b\u673a\u5e02\u573a\u4e0a\uff0c<code>x86 / x86_64/armeabi/mips / mips6</code> \u7684\u67b6\u6784\u7684\u624b\u673a\u5360\u7528\u91cf\u6781\u4f4e\uff0c\u57fa\u672c\u53ef\u4ee5\u4e0d\u4e0d\u8003\u8651\u4e86\uff0c\u6211\u4eec\u5728\u00a0build.gradle\u00a0\u4e2d\u914d\u7f6e \u53bb\u8bbe\u7f6e App \u652f\u6301\u7684 So \u67b6\u6784\uff0c\u5176\u914d\u7f6e\u4ee3\u7801\u4ee5\u4e0b\u6240\u793a\uff1a <pre><code>defaultConfig {\nndk {\nabiFilters 'armeabi-v7a','arm64-v8a'\n}\n}\n</code></pre></p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#342-so","title":"3.4.2 \u88c1\u526aso","text":"<ul> <li>\u7cbe\u7b80\u52a8\u6001\u7b26\u53f7\u8868   \u6b63\u5e38\u60c5\u51b5\u4e0b\u7f16\u8bd1\u51fa\u7684\u5171\u4eab\u5e93\u5305\u542b\u4e86\u6240\u6709\u7684\u7b26\u53f7\u4fe1\u606f\u4e0e\u8c03\u8bd5\u4fe1\u606f\uff0c\u5bf9\u4e8e\u5f00\u53d1\u548c\u8c03\u8bd5\u4f1a\u975e\u5e38\u65b9\u4fbf\u3002\u4f46\u7cfb\u7edf\u771f\u6b63\u7528\u5230\u7684\u4ec5\u4ec5\u662f\u90e8\u5206\u52a8\u6001\u7b26\u53f7\u8868\uff0c\u52a8\u6001\u7b26\u53f7\u8868\u662f so \u4e0e\u5916\u90e8\u8fdb\u884c\u8fde\u63a5\u7684\u201c\u6865\u6881\u201d\uff0c\u5176\u4e2d\u7684\u5bfc\u51fa\u8868\u76f8\u5f53\u4e8e\u662f so \u5bf9\u5916\u66b4\u9732\u7684\u63a5\u53e3\u3002\u6211\u4eec\u9700\u8981\u786e\u5b9a\u52a8\u6001\u4f9d\u8d56\u7684 so \u4f9d\u8d56\u4e86\u54ea\u4e9b\u7b26\u53f7\uff0c\u4ec5\u4fdd\u7559\u8fd9\u4e9b\u88ab\u4f9d\u8d56\u7684\u7b26\u53f7\u5373\u53ef\u3002</li> <li>\u79fb\u9664\u65e0\u7528\u4ee3\u7801   \u5728\u5b9e\u9645\u7684\u9879\u76ee\u4e2d\uff0c\u6709\u4e00\u4e9b\u4ee3\u7801\u5728 Release \u7248\u4e2d\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u4f7f\u7528\u5230, \u4f8b\u5982\u5386\u53f2\u9057\u7559\u4ee3\u7801\u3001\u7528\u4e8e\u6d4b\u8bd5\u7684\u4ee3\u7801\u7b49, \u5220\u9664\u65e0\u7528\u4ee3\u7801\u7684\u6f5c\u5728\u6536\u76ca\u8f83\u5927\u3002</li> <li>\u4f18\u5316\u6307\u4ee4\u957f\u5ea6   \u5b9e\u73b0\u67d0\u4e2a\u529f\u80fd\u7684\u6307\u4ee4\u5e76\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u7f16\u8bd1\u5668\u6709\u53ef\u80fd\u80fd\u7528\u66f4\u5c11\u7684\u6307\u4ee4\u5b8c\u6210\u76f8\u540c\u7684\u529f\u80fd\uff0c\u4ece\u800c\u5b9e\u73b0\u4f18\u5316\u3002\u7531\u4e8e\u6307\u4ee4\u662f so \u7684\u4e3b\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u56e0\u6b64\u4f18\u5316\u8fd9\u4e00\u90e8\u5206\u7684\u6f5c\u5728\u6536\u76ca\u4e5f\u6bd4\u8f83\u5927\u3002</li> </ul>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#343-so","title":"3.4.3 \u63d0\u53d6\u591a so \u5171\u540c\u4f9d\u8d56\u5e93","text":"<p>\u5f53\u591a\u4e2a so \u4ee5\u9759\u6001\u65b9\u5f0f\u4f9d\u8d56\u4e86\u67d0\u4e2a\u76f8\u540c\u7684\u5e93\u65f6\uff0c\u53ef\u4ee5\u8003\u8651\u5c06\u6b64\u5e93\u63d0\u53d6\u6210\u4e00\u4e2a\u5355\u72ec\u7684 so\uff0c\u539f\u6765\u7684\u51e0\u4e2a so \u6539\u4e3a\u52a8\u6001\u4f9d\u8d56\u8be5 so\u3002\u4f8b\u5982 <code>liba.so</code> \u548c <code>libb.so</code> \u90fd\u9759\u6001\u4f9d\u8d56\u4e86 <code>libx.a</code>\uff0c\u53ef\u4ee5\u4f18\u5316\u4e3a <code>liba.so</code> \u548c <code>libb.so</code> \u5747\u52a8\u6001\u4f9d\u8d56 <code>libx.so</code>\u3002\u63d0\u53d6\u591a so \u5171\u540c\u4f9d\u8d56\u5e93\uff0c\u53ef\u4ee5\u5bf9\u4e0d\u540c so \u5185\u7684\u76f8\u540c\u4ee3\u7801\u8fdb\u884c\u5408\u5e76\uff0c\u4ece\u800c\u51cf\u5c0f\u603b\u7684 so \u4f53\u79ef\u3002</p> <p>\u8fd9\u91cc\u5178\u578b\u7684\u4f8b\u5b50\u662f <code>libc++</code> \u5e93\uff1a\u5982\u679c\u5b58\u5728\u591a\u4e2a so \u90fd\u9759\u6001\u4f9d\u8d56 libc++ \u5e93\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u4f18\u5316\u4e3a\u8fd9\u4e9b so \u90fd\u52a8\u6001\u4f9d\u8d56\u4e8e <code>libc++_shared.so</code>\u3002</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#4","title":"4. \u5305\u4f53\u79ef\u76d1\u63a7","text":"<ol> <li> <p>\u5927\u5c0f\u76d1\u63a7</p> <ul> <li>\u5b9e\u65f6\u544a\u8b66 \u5f53\u540c\u4e00\u6784\u5efa\u73af\u5883\u6784\u5efa\u51fa\u6765\u7684\u5305\u4e4b\u95f4\u5305\u4f53\u79ef\u589e\u957f\u8fbe\u5230\u9608\u503c\uff0c\u901a\u8fc7\u98de\u4e66/\u4f01\u4e1a\u5fae\u4fe1\u673a\u5668\u4eba\u5b9e\u65f6\u544a\u8b66\u3002</li> <li>\u5bf9\u6bd4\u5206\u6790\uff0c\u95ee\u9898\u68c0\u6d4b \u57fa\u4e8e\u5fae\u4fe1APK Checker\u8fdb\u884c\u5b9a\u5236\uff0c\u4e8c\u6b21\u5f00\u53d1\uff0c\u751f\u6210\u7f51\u9875\u62a5\u544a\uff0c\u5bf9\u6bd4\u524d\u540e\u6784\u5efasize\u53d8\u5316\uff0c\u540c\u65f6\u68c0\u6d4b\u5927\u6587\u4ef6\uff0c\u5927\u56fe\u7247\u7b49\u95ee\u9898 </li> </ul> </li> <li> <p>\u4f9d\u8d56\u76d1\u63a7     \u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5f15\u5165\u7684\u4f9d\u8d56\u5e93\u53ef\u80fd\u662f\u9700\u8981\u8bc4\u4f30\u7684\uff0c\u5982</p> <ul> <li>\u8d85\u5927\u7684\u5f00\u6e90\u5e93</li> <li>\u548c\u5df2\u6709\u5e93\u529f\u80fd\u91cd\u5408\u5ea6\u8f83\u9ad8</li> <li>\u53ea\u7528\u5230\u4f9d\u8d56\u5e93\u4e2d\u5f88\u5c0f\u4e00\u5757\u529f\u80fd</li> </ul> <p>\u6240\u4ee5\u4f9d\u8d56\u4e5f\u662f\u76d1\u63a7\u7684\u91cd\u70b9\uff0c\u4e00\u65b9\u9762\u6211\u4eec\u4e5f\u8ddf\u5927\u5c0f\u76d1\u63a7\u4e00\u6837\uff0c\u901a\u8fc7IM\u5de5\u5177\u5b9e\u65f6\u83b7\u77e5\u662f\u5426\u5f15\u5165\u4e86\u65b0\u7684\u4f9d\u8d56\u5e93\u548c\u5176\u5927\u5c0f\uff0c\u53e6\u5916\u6211\u4eec\u8fd8\u53ef\u4ee5\u628a\u5e94\u7528\u4f9d\u8d56\u5e93\u60c5\u51b5\u4e0a\u62a5APM\u540e\u53f0\uff0c\u5728APM\u9762\u677f\u5c55\u793a\u7248\u672c\u4f9d\u8d56\u60c5\u51b5\u4ee5\u53ca\u5efa\u7acb\u4f9d\u8d56\u6811</p> </li> <li> <p>\u7248\u672c\u76d1\u63a7 \u6211\u4eec\u9700\u8981\u8bb0\u5f55\u6bcf\u4e00\u4e2arelease\u7248\u672c\u7684\u5305\u4f53\u79ef\u4ee5\u53ca\u5305\u4f53\u62a5\u544a\uff0c\u901a\u8fc7APM\u9762\u677f\u8fdb\u884c\u56fe\u8868\u5c55\u793a\uff0c\u4ee5\u4fbf\u7248\u672c\u5bf9\u6bd4\u548c\u56de\u987e</p> </li> </ol>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#5","title":"5. \u8fd8\u6709","text":"<p>\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u9664\u4e86\u4ee5\u4e0a\u8fd9\u4e9b\u4f18\u5316\u65b9\u6848\uff0c\u8fd8\u6709\u4e00\u4e9b\u7531\u4e8e\u67d0\u4e9b\u9650\u5236\u6216\u8005\u6682\u65f6\u9a8c\u8bc1\u5931\u8d25\u7684\u65b9\u6848\u3002</p> <ul> <li>R8\u00a0\u5f00\u542f\u5b8c\u5168\u6a21\u5f0f R8\u662f\u66ff\u4ee3<code>ProGuard</code>\u7684Android \u6df7\u6dc6\u5de5\u5177\uff0c\u82e5\u662f\u5f53\u524d\u4f7f\u7528\u7684\u662f Android Studio 3.4 \u6216 Android Gradle \u63d2\u4ef6 3.4.0 \u53ca\u5176\u66f4\u9ad8\u7248\u672c\uff0cR8 \u4f1a\u505a\u4e3a\u9ed8\u8ba4\u7f16\u8bd1\u5668\u3002 \u901a\u8fc7\u4ee5\u4e0b\u914d\u7f6e\u53ef\u4ee5\u542f\u7528R8\u989d\u5916\u7684\u4f18\u5316\u529f\u80fd <pre><code>android.enableR8.fullMode=true\n</code></pre></li> </ul> <p>\u5b9e\u8df5\u95ee\u9898</p> <ul> <li>\u8fd9\u4e9b\u989d\u5916\u7684\u4f18\u5316\u529f\u80fd\u4f1a\u4f7f R8 \u7684\u884c\u4e3a\u4e0e ProGuard \u4e0d\u540c\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u9700\u8981\u6dfb\u52a0\u989d\u5916\u7684 ProGuard \u89c4\u5219\u3002\u76ee\u524d\u9879\u76ee\u53d1\u73b0\u67d0\u4e9b\u4f9d\u8d56\u5e93\u7684\u6df7\u6dc6\u6587\u4ef6\u548c\u5b83\u6709\u51b2\u7a81\uff0c\u4f1a\u5bfc\u81f4\u9519\u8bef\u3002</li> </ul> <ul> <li>\u4f7f\u7528ReDex Facebook\u5f00\u6e90\u7684\u5de5\u5177\u5305\uff0c\u4e13\u95e8\u7528\u4e8e Android \u5b57\u8282\u7801\u7684\u4f18\u5316\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5bf9dex\u8fdb\u884c\u6df7\u6dc6\u538b\u7f29 \uff0c\u4f53\u79ef\u53d8\u5f97\u66f4\u5c0f\uff0c\u8fd0\u884c\u901f\u5ea6\u53d8\u5f97\u66f4\u5feb\u3002</li> </ul> <p>\u5b9e\u8df5\u95ee\u9898</p> <ul> <li>redex\u6ca1\u6709\u63d0\u4f9b\u73b0\u6210\u7684\u7f16\u8bd1\u4ea7\u7269\uff0c\u9700\u8981\u4f7f\u7528\u8005\u2f83\u2f8f\u6e90\u7801\u7f16\u8bd1;\u7f16\u8bd1\u8fc7\u7a0b\u4f1a\u6709\u4e0d\u5c11\u5751\uff0c\u4f9d\u8d56\u7684\u7248\u672c\uff0c\u6743\u9650\u7b49; \u6574\u4e2a\u7f16\u8bd1\u8fc7\u7a0b\u9700\u8981\u82b1\u8d392\u4e2a\u5c0f\u65f6\u5de6\u53f3</li> <li>\u9ed8\u8ba4\u914d\u7f6e\u5bf9\u5305\u4f53\u79ef\u8d21\u732e\u4e0d\u5927\uff0c\u5b9e\u8df5\u6765\u8bf4\u4ec5\u4ec5\u51cf\u5c11\u4e86500K</li> <li>\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u65e0\u8bba\u662f\u9ed8\u8ba4\u914d\u7f6e\u8fd8\u662f\u81ea\u5b9a\u4e49\u914d\u7f6e\u90fd\u9047\u5230\u5404\u79cd\u9519\u8bef</li> <li>\u4f1a\u5bf9\u73b0\u6709\u6253\u5305\u6d41\u7a0b\u6709\u5f71\u54cd</li> <li>\u7efc\u5408\u6765\u8bf4\uff0c\u63a5\u5165\u6027\u4ef7\u6bd4\u6bd4\u8f83\u4f4e\uff0c\u4f46 redex\u7684\u786e\u662f\u5f88\u786c\u6838\u7684\u725b\u903c\u7684\u5e93\uff0c\u503c\u5f97\u6df1\u5165\u7814\u7a76</li> <li>\u6296\u97f3\u53c2\u8003\u5b9e\u8df5</li> </ul> <ul> <li>\u7edf\u4e00\u5e94\u7528\u98ce\u683c \u5982\u8bbe\u5b9a\u7edf\u4e00\u7684 \u5b57\u4f53\u3001\u5c3a\u5bf8\u3001\u989c\u8272\u548c\u6309\u94ae\u6309\u538b\u6548\u679c\u3001\u5206\u5272\u7ebf shape\u3001selector \u80cc\u666f \u7b49\u7b49\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u8d44\u6e90\u6570\u91cf\u3002</li> </ul> <p>\u5b9e\u8df5\u95ee\u9898</p> <p>\u9700\u8981UI\u8bbe\u8ba1\u56e2\u961f\u914d\u5408</p> <ul> <li>\u4f7f\u7528\u9488\u5bf9\u6027\u7684\u56fe\u7247\u683c\u5f0f \u4f7f\u7528\u77e2\u91cf\u56fe\u7247\u4ee5\u540e\uff0c\u5b83\u53ef\u4ee5\u6709\u6548\u7684\u51cf\u5c0f\u5e94\u7528\u4e2d\u56fe\u7247\u6240\u5360\u7528\u7684\u5927\u5c0f\uff0c\u77e2\u91cf\u56fe\u5f62\u5728 Android \u4e2d\u8868\u793a\u4e3a <code>VectorDrawable</code> \u5bf9\u8c61\u3002\u5b83\u4ec5\u4ec5\u9700100\u5b57\u8282\u7684\u6587\u4ef6\u4fbf\u53ef\u4ee5\u751f\u6210\u5c4f\u5e55\u5927\u5c0f\u7684\u6e05\u6670\u56fe\u50cf\uff0c\u53ef\u662f\uff0cAndroid \u7cfb\u7edf\u6e32\u67d3\u6bcf\u4e00\u4e2a <code>VectorDrawable</code> \u5bf9\u8c61\u987b\u8981\u5927\u91cf\u7684\u65f6\u95f4\uff0c\u800c\u8f83\u5927\u7684\u56fe\u50cf\u987b\u8981\u66f4\u957f\u7684\u65f6\u95f4\u3002 \u6240\u4ee5\uff0c\u5efa\u8bae \u53ea\u6709\u5728\u663e\u793a\u7eaf\u8272\u5c0f icon \u65f6\u624d\u8003\u8651\u4f7f\u7528\u77e2\u91cf\u56fe\u5f62\u3002 VD\uff08\u7eaf\u8272icon\uff09-&gt;WebP\uff08\u975e\u7eaf\u8272icon\uff09-&gt;Png\uff08\u66f4\u597d\u6548\u679c\uff09 -&gt;jpg\uff08\u82e5\u65e0alpha\u901a\u9053\uff09</li> </ul> <p>\u5b9e\u8df5\u95ee\u9898</p> <p>\u5df2\u7ecf\u505a\u4e86\u56fe\u7247\u81ea\u52a8\u538b\u7f29\uff0c\u8bc4\u4f30\u6536\u76ca\u4e0d\u5927</p> <ul> <li>So \u52a8\u6001\u4e0b\u8f7d \u5c06\u90e8\u5206 So \u6587\u4ef6\u4f7f\u7528\u52a8\u6001\u4e0b\u53d1\u7684\u5f62\u5f0f\u8fdb\u884c\u52a0\u8f7d \u53ef\u4ee5\u53c2\u8003\u817e\u8bafBugly\u7684\u5b9e\u8df5</li> </ul> <p>\u5b9e\u8df5\u95ee\u9898</p> <p>Google play\u4e0d\u5141\u8bb8\u52a8\u6001\u4e0b\u53d1\u4ee3\u7801\u548c\u8d44\u6e90</p>"},{"location":"perf-opt/Android/size/Android-apk-size-opt/#_1","title":"\u53c2\u8003","text":"<p>Android \u5f00\u53d1\u9ad8\u624b\u8bfe</p>"},{"location":"perf-opt/Android/size/Android-so-opt/","title":"Android\u5bf9so\u4f53\u79ef\u4f18\u5316\u7684\u63a2\u7d22\u4e0e\u5b9e\u8df5","text":""},{"location":"perf-opt/Android/size/Android-so-opt/#1","title":"1. \u80cc\u666f","text":"<p>\u5e94\u7528\u5b89\u88c5\u5305\u7684\u4f53\u79ef\u5f71\u54cd\u7740\u7528\u6237\u7684\u4e0b\u8f7d\u65f6\u957f\u3001\u5b89\u88c5\u65f6\u957f\u3001\u78c1\u76d8\u5360\u7528\u7a7a\u95f4\u7b49\u8bf8\u591a\u65b9\u9762\uff0c\u56e0\u6b64\u51cf\u5c0f\u5b89\u88c5\u5305\u7684\u4f53\u79ef\u5bf9\u4e8e\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u548c\u4e0b\u8f7d\u8f6c\u5316\u7387\u90fd\u5927\u6709\u76ca\u5904\u3002Android \u5e94\u7528\u5b89\u88c5\u5305\u5176\u5b9e\u662f\u4e00\u4e2a zip \u6587\u4ef6\uff0c\u4e3b\u8981\u7531 dex\u3001assets\u3001resource\u3001so \u7b49\u5404\u7c7b\u578b\u6587\u4ef6\u538b\u7f29\u800c\u6210\u3002\u76ee\u524d\u4e1a\u5185\u5e38\u89c1\u7684\u5305\u4f53\u79ef\u4f18\u5316\u65b9\u6848\u5927\u4f53\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b\uff1a</p> <ul> <li>\u9488\u5bf9 dex \u7684\u4f18\u5316\uff0c\u4f8b\u5982 Proguard\u3001dex \u7684 DebugItem \u5220\u9664\u3001\u5b57\u8282\u7801\u4f18\u5316\u7b49\uff1b</li> <li>\u9488\u5bf9 resource \u7684\u4f18\u5316\uff0c\u4f8b\u5982 AndResGuard\u3001webp \u4f18\u5316\u7b49\uff1b</li> <li>\u9488\u5bf9 assets \u7684\u4f18\u5316\uff0c\u4f8b\u5982\u538b\u7f29\u3001\u52a8\u6001\u4e0b\u53d1\u7b49\uff1b</li> <li>\u9488\u5bf9 so \u7684\u4f18\u5316\uff0c\u540c assets\uff0c\u53e6\u5916\u8fd8\u6709\u79fb\u9664\u8c03\u8bd5\u7b26\u53f7\u7b49\u3002</li> </ul> <p>\u968f\u7740\u52a8\u6001\u5316\u3001\u7aef\u667a\u80fd\u7b49\u6280\u672f\u7684\u5e7f\u6cdb\u5e94\u7528\uff0c\u5728\u91c7\u7528\u4e0a\u8ff0\u4f18\u5316\u624b\u6bb5\u540e\uff0c so \u5728\u5b89\u88c5\u5305\u4f53\u79ef\u4e2d\u7684\u6bd4\u91cd\u4f9d\u7136\u5f88\u9ad8\uff0c\u6211\u4eec\u5f00\u59cb\u601d\u7d22\u8fd9\u90e8\u5206\u4f53\u79ef\u662f\u5426\u80fd\u8fdb\u4e00\u6b65\u4f18\u5316\u3002</p> <p>\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u8c03\u7814\u3001\u5206\u6790\u548c\u9a8c\u8bc1\uff0c\u6211\u4eec\u9010\u6e10\u6478\u7d22\u51fa\u4e00\u5957\u53ef\u4ee5\u5c06\u5e94\u7528\u5b89\u88c5\u5305\u4e2d so \u4f53\u79ef\u8fdb\u4e00\u6b65\u51cf\u5c0f 30%\uff5e60% \u7684\u65b9\u6848\u3002\u8be5\u65b9\u6848\u5305\u542b\u4e00\u7cfb\u5217\u7eaf\u6280\u672f\u4f18\u5316\u624b\u6bb5\uff0c\u5bf9\u4e1a\u52a1\u4fb5\u5165\u6027\u4f4e\uff0c\u901a\u8fc7\u7b80\u5355\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u5feb\u901f\u90e8\u7f72\u751f\u6548\uff0c\u76ee\u524d\u7f8e\u56e2 App \u5df2\u5728\u7ebf\u4e0a\u90e8\u7f72\u4f7f\u7528\u3002\u4e3a\u8ba9\u5927\u5bb6\u80fd\u77e5\u5176\u7136\uff0c\u4e5f\u80fd\u77e5\u5176\u6240\u4ee5\u7136\uff0c\u672c\u6587\u5c06\u5148\u4ece so \u6587\u4ef6\u683c\u5f0f\u8bb2\u8d77\uff0c\u7ed3\u5408\u6587\u4ef6\u683c\u5f0f\u5206\u6790\u54ea\u4e9b\u5185\u5bb9\u53ef\u4ee5\u4f18\u5316\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#2-so","title":"2. so \u6587\u4ef6\u683c\u5f0f\u5206\u6790","text":"<p>so \u5373\u52a8\u6001\u5e93\uff0c\u672c\u8d28\u4e0a\u662f ELF\uff08Executable and Linkable Format\uff09\u6587\u4ef6\u3002\u53ef\u4ee5\u4ece\u4e24\u4e2a\u7ef4\u5ea6\u67e5\u770b so \u6587\u4ef6\u7684\u5185\u90e8\u7ed3\u6784\uff1a\u94fe\u63a5\u89c6\u56fe\uff08Linking View\uff09\u548c\u6267\u884c\u89c6\u56fe\uff08Execution View\uff09\u3002\u94fe\u63a5\u89c6\u56fe\u5c06 so \u4e3b\u4f53\u770b\u4f5c\u591a\u4e2a section \u7684\u7ec4\u5408\uff0c\u8be5\u89c6\u56fe\u4f53\u73b0\u7684\u662f so \u662f\u5982\u4f55\u7ec4\u88c5\u7684\uff0c\u662f\u7f16\u8bd1\u94fe\u63a5\u7684\u89c6\u89d2\u3002\u800c\u6267\u884c\u89c6\u56fe\u5c06 so \u4e3b\u4f53\u770b\u4f5c\u591a\u4e2a segment \u7684\u7ec4\u5408\uff0c\u8be5\u89c6\u56fe\u544a\u8bc9\u52a8\u6001\u94fe\u63a5\u5668\u5982\u4f55\u52a0\u8f7d\u548c\u6267\u884c\u8be5 so\uff0c\u662f\u8fd0\u884c\u65f6\u7684\u89c6\u89d2\u3002\u9274\u4e8e\u5bf9 so \u4f18\u5316\u66f4\u4fa7\u91cd\u4e8e\u7f16\u8bd1\u94fe\u63a5\u89d2\u5ea6\uff0c\u5e76\u4e14\u901a\u5e38\u4e00\u4e2a segment \u5305\u542b\u591a\u4e2a section\uff08\u5373\u94fe\u63a5\u89c6\u56fe\u5bf9 so \u7684\u5206\u89e3\u7c92\u5ea6\u66f4\u5c0f\uff09\uff0c\u56e0\u6b64\u6211\u4eec\u8fd9\u91cc\u53ea\u8ba8\u8bba so \u7684\u94fe\u63a5\u89c6\u56fe\u3002</p> <p>\u901a\u8fc7 <code>readelf -S</code> \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u4e00\u4e2a so \u6587\u4ef6\u7684\u6240\u6709 section \u5217\u8868\uff0c\u53c2\u8003 ELF \u6587\u4ef6\u683c\u5f0f\u8bf4\u660e\uff0c\u8fd9\u91cc\u7b80\u8981\u4ecb\u7ecd\u4e00\u4e0b\u672c\u6587\u6d89\u53ca\u7684 section\uff1a</p> <ul> <li><code>.text</code>\uff1a\u5b58\u653e\u7684\u662f\u7f16\u8bd1\u540e\u7684\u673a\u5668\u6307\u4ee4\uff0cC/C++\u4ee3\u7801\u7684\u5927\u90e8\u5206\u51fd\u6570\u7f16\u8bd1\u540e\u5c31\u5b58\u653e\u5728\u8fd9\u91cc\u3002\u8fd9\u91cc\u53ea\u6709\u673a\u5668\u6307\u4ee4\uff0c\u6ca1\u6709\u5b57\u7b26\u4e32\u7b49\u4fe1\u606f\u3002</li> <li><code>.data</code>\uff1a\u5b58\u653e\u7684\u662f\u521d\u59cb\u503c\u4e0d\u4e3a\u96f6\u7684\u4e00\u4e9b\u53ef\u8bfb\u5199\u53d8\u91cf\u3002</li> <li><code>.bss</code>\uff1a\u5b58\u653e\u7684\u662f\u521d\u59cb\u503c\u4e3a\u96f6\u6216\u672a\u521d\u59cb\u5316\u7684\u4e00\u4e9b\u53ef\u8bfb\u5199\u53d8\u91cf\u3002\u8be5 section \u4ec5\u6307\u793a\u8fd0\u884c\u65f6\u9700\u8981\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u4e0d\u4f1a\u5360\u7528 so \u6587\u4ef6\u7684\u4f53\u79ef\u3002</li> <li><code>.rodata</code>\uff1a\u5b58\u653e\u7684\u662f\u4e00\u4e9b\u53ea\u8bfb\u5e38\u91cf\u3002</li> <li><code>.dynsym</code>\uff1a\u52a8\u6001\u7b26\u53f7\u8868\uff0c\u7ed9\u51fa\u4e86\u8be5 so \u5bf9\u5916\u63d0\u4f9b\u7684\u7b26\u53f7\uff08\u5bfc\u51fa\u7b26\u53f7\uff09\u548c\u4f9d\u8d56\u5916\u90e8\u7684\u7b26\u53f7\uff08\u5bfc\u5165\u7b26\u53f7\uff09\u7684\u4fe1\u606f\u3002</li> <li><code>.dynstr</code>\uff1a\u5b57\u7b26\u4e32\u6c60\uff0c\u4e0d\u540c\u5b57\u7b26\u4e32\u4ee5 \u2018\\0\u2019 \u5206\u5272\uff0c\u4f9b <code>.dynsym</code> \u548c\u5176\u4ed6\u90e8\u5206\u4f7f\u7528\u3002</li> <li><code>.gnu.hash</code> \u548c<code>.hash</code>\uff1a\u4e24\u79cd\u7c7b\u578b\u7684\u54c8\u5e0c\u8868\uff0c\u7528\u4e8e\u5feb\u901f\u67e5\u627e <code>.dynsym</code> \u4e2d\u7684\u5bfc\u51fa\u7b26\u53f7\u6216\u5168\u90e8\u7b26\u53f7\u3002</li> <li><code>.gnu.version</code>\u3001<code>.gnu.version_d</code>\u3001<code>.gnu.version_r</code>\uff1a\u8fd9\u4e09\u4e2a section \u7528\u4e8e\u6307\u5b9a\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u6bcf\u4e2a\u7b26\u53f7\u7684\u7248\u672c\uff0c\u5176\u4e2d<code>.gnu.version</code> \u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5176\u5143\u7d20\u4e2a\u6570\u4e0e\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u7b26\u53f7\u7684\u4e2a\u6570\u76f8\u540c\uff0c\u5373\u6570\u7ec4\u6bcf\u4e2a\u5143\u7d20\u4e0e\u52a8\u6001\u7b26\u53f7\u8868\u7684\u6bcf\u4e2a\u7b26\u53f7\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb\u3002\u6570\u7ec4\u6bcf\u4e2a\u5143\u7d20\u7684\u7c7b\u578b\u4e3a <code>Elfxx_Half</code>\uff0c\u5176\u610f\u4e49\u662f\u7d22\u5f15\uff0c\u6307\u793a\u6bcf\u4e2a\u7b26\u53f7\u7684\u7248\u672c\u3002<code>.gnu.version_d</code> \u63cf\u8ff0\u4e86\u8be5 so \u5b9a\u4e49\u7684\u6240\u6709\u7b26\u53f7\u7684\u7248\u672c\uff0c\u4f9b<code>.gnu.version</code> \u7d22\u5f15\u3002<code>.gnu.version_r</code> \u63cf\u8ff0\u4e86\u8be5 so \u4f9d\u8d56\u7684\u6240\u6709\u7b26\u53f7\u7684\u7248\u672c\uff0c\u4e5f\u4f9b <code>.gnu.version</code> \u7d22\u5f15\u3002\u56e0\u4e3a\u4e0d\u540c\u7684\u7b26\u53f7\u53ef\u80fd\u5177\u6709\u76f8\u540c\u7684\u7248\u672c\uff0c\u6240\u4ee5\u91c7\u7528\u8fd9\u79cd\u7d22\u5f15\u7ed3\u6784\uff0c\u53ef\u4ee5\u51cf\u5c0f so \u6587\u4ef6\u7684\u5927\u5c0f\u3002</li> </ul> <p>\u5728\u8fdb\u884c\u4f18\u5316\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u8fd9\u4e9b section \u4ee5\u53ca\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u6709\u4e00\u4e2a\u6e05\u6670\u7684\u8ba4\u8bc6\uff0c\u4e0b\u56fe\u8f83\u76f4\u89c2\u5730\u5c55\u793a\u4e86 so \u4e2d\u5404\u4e2a section \u4e4b\u95f4\u7684\u5173\u7cfb\uff08\u8fd9\u91cc\u53ea\u7ed8\u5236\u4e86\u672c\u6587\u6d89\u53ca\u7684 section\uff09\uff1a</p> <p></p> <p>\u7ed3\u5408\u4e0a\u56fe\uff0c\u6211\u4eec\u4ece\u53e6\u4e00\u4e2a\u89d2\u5ea6\u6765\u7406\u89e3 so \u6587\u4ef6\u7684\u7ed3\u6784\uff1a\u60f3\u8c61\u4e00\u4e0b\uff0c\u6211\u4eec\u628a\u6240\u6709\u7684\u51fd\u6570\u5b9e\u73b0\u4f53\u90fd\u653e\u5230<code>.text</code> \u4e2d\uff0c<code>.text</code> \u4e2d\u7684\u6307\u4ee4\u4f1a\u53bb\u8bfb\u53d6 <code>.rodata</code> \u4e2d\u7684\u6570\u636e\uff0c\u8bfb\u53d6\u6216\u4fee\u6539 <code>.data</code> \u548c <code>.bss</code> \u4e2d\u7684\u6570\u636e\u3002\u770b\u4e0a\u53bb so \u4e2d\u6709\u8fd9\u4e9b\u5185\u5bb9\u4e5f\u8db3\u591f\u4e86\u3002\u4f46\u662f\u8fd9\u4e9b\u51fd\u6570\u600e\u6837\u6267\u884c\u5462\uff1f\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u628a\u8fd9\u4e9b\u51fd\u6570\u548c\u6570\u636e\u52a0\u8f7d\u8fdb\u5185\u5b58\u662f\u4e0d\u591f\u7684\uff0c\u8fd9\u4e9b\u51fd\u6570\u53ea\u6709\u771f\u6b63\u53bb\u6267\u884c\uff0c\u624d\u80fd\u53d1\u6325\u4f5c\u7528\u3002</p> <p>\u6211\u4eec\u77e5\u9053\u60f3\u8981\u6267\u884c\u4e00\u4e2a\u51fd\u6570\uff0c\u53ea\u8981\u8df3\u8f6c\u5230\u5b83\u7684\u5730\u5740\u5c31\u884c\u4e86\u3002\u90a3\u5916\u754c\u8c03\u7528\u8005\uff08\u8be5 so \u4e4b\u5916\u7684\u6a21\u5757\uff09\u600e\u6837\u77e5\u9053\u5b83\u60f3\u8981\u8c03\u7528\u51fd\u6570\u7684\u5730\u5740\u5462\uff1f\u8fd9\u91cc\u5c31\u6d89\u53ca\u4e00\u4e2a\u51fd\u6570 ID \u7684\u95ee\u9898\uff1a\u5916\u90e8\u8c03\u7528\u8005\u7ed9\u51fa\u9700\u8981\u8c03\u7528\u7684\u51fd\u6570\u7684 ID\uff0c\u800c\u52a8\u6001\u94fe\u63a5\u5668\uff08Linker\uff09\u6839\u636e\u8be5 ID \u67e5\u627e\u76ee\u6807\u51fd\u6570\u7684\u5730\u5740\u5e76\u544a\u77e5\u5916\u90e8\u8c03\u7528\u8005\u3002\u6240\u4ee5 so \u6587\u4ef6\u8fd8\u9700\u8981\u4e00\u4e2a\u7ed3\u6784\u53bb\u5b58\u50a8\u201cID-\u5730\u5740\u201d\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u8fd9\u4e2a\u7ed3\u6784\u5c31\u662f\u52a8\u6001\u7b26\u53f7\u8868\u7684\u6240\u6709\u5bfc\u51fa\u7b26\u53f7\u3002</p> <p>\u5177\u4f53\u5230\u52a8\u6001\u7b26\u53f7\u8868\u7684\u5b9e\u73b0\uff0cID \u7684\u7c7b\u578b\u662f\u201c\u5b57\u7b26\u4e32\u201d\uff0c\u53ef\u4ee5\u8bf4\u52a8\u6001\u7b26\u53f7\u8868\u7684\u6240\u6709\u5bfc\u51fa\u7b26\u53f7\u6784\u6210\u4e86\u4e00\u4e2a\u201c\u5b57\u7b26\u4e32-\u5730\u5740\u201c\u7684\u6620\u5c04\u8868\u3002\u8c03\u7528\u8005\u83b7\u53d6\u76ee\u6807\u51fd\u6570\u7684\u5730\u5740\u540e\uff0c\u51c6\u5907\u597d\u53c2\u6570\u8df3\u8f6c\u5230\u8be5\u5730\u5740\u5c31\u53ef\u4ee5\u6267\u884c\u8fd9\u4e2a\u51fd\u6570\u4e86\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5f53\u524d so \u53ef\u80fd\u4e5f\u9700\u8981\u8c03\u7528\u5176\u4ed6 so \u4e2d\u7684\u51fd\u6570\uff08\u4f8b\u5982 libc.so \u4e2d\u7684 read\u3001write \u7b49\uff09\uff0c\u52a8\u6001\u7b26\u53f7\u8868\u7684\u5bfc\u5165\u7b26\u53f7\u8bb0\u5f55\u4e86\u8fd9\u4e9b\u51fd\u6570\u7684\u4fe1\u606f\uff0c\u5728 so \u5185\u51fd\u6570\u6267\u884c\u4e4b\u524d\u52a8\u6001\u94fe\u63a5\u5668\u4f1a\u5c06\u76ee\u6807\u51fd\u6570\u7684\u5730\u5740\u586b\u5165\u5230\u76f8\u5e94\u4f4d\u7f6e\uff0c\u4f9b\u8be5 so \u4f7f\u7528\u3002\u6240\u4ee5\u52a8\u6001\u7b26\u53f7\u8868\u662f\u8fde\u63a5\u5f53\u524d so \u4e0e\u5916\u90e8\u73af\u5883\u7684\u201c\u6865\u6881\u201d\uff1a\u5bfc\u51fa\u7b26\u53f7\u4f9b\u5916\u90e8\u4f7f\u7528\uff0c\u5bfc\u5165\u7b26\u53f7\u58f0\u660e\u4e86\u8be5 so \u9700\u8981\u4f7f\u7528\u7684\u5916\u90e8\u7b26\u53f7\uff08\u6ce8\uff1a\u5b9e\u9645\u4e0a <code>.dynsym</code> \u4e2d\u7684\u7b26\u53f7\u8fd8\u53ef\u4ee5\u4ee3\u8868\u53d8\u91cf\u7b49\u5176\u4ed6\u7c7b\u578b\uff0c\u4e0e\u51fd\u6570\u7c7b\u578b\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\uff09\u3002</p> <p>\u7ed3\u5408 so \u6587\u4ef6\u7ed3\u6784\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5f00\u59cb\u5206\u6790 so \u4e2d\u6709\u54ea\u4e9b\u5185\u5bb9\u53ef\u4ee5\u4f18\u5316\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#3-so","title":"3. so \u53ef\u4f18\u5316\u5185\u5bb9\u5206\u6790","text":"<p>\u5728\u8ba8\u8bba so \u53ef\u4f18\u5316\u5185\u5bb9\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u4e86\u89e3\u4e00\u4e0b Android \u6784\u5efa\u5de5\u5177\uff08Android Gradle Plugin\uff0c\u4e0b\u6587\u7b80\u79f0 AGP\uff09\u5bf9 so \u4f53\u79ef\u505a\u7684 strip \u4f18\u5316\uff08\u79fb\u9664\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\uff09\u3002AGP \u7f16\u8bd1 so \u65f6\uff0c\u9996\u5148\u4ea7\u751f\u7684\u662f\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so\uff08\u4efb\u52a1\u540d\u4e3a externalNativeBuildRelease\uff09\uff0c\u4e4b\u540e\u5bf9\u521a\u4ea7\u751f\u7684\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u8fdb\u884c strip\uff0c\u5c31\u5f97\u5230\u4e86\u6700\u7ec8\u6253\u5305\u5230 apk \u6216 aar \u4e2d\u7684 so\uff08\u4efb\u52a1\u540d\u4e3a stripReleaseDebugSymbols\uff09\u3002</p> <p>strip \u4f18\u5316\u7684\u4f5c\u7528\u5c31\u662f\u5220\u9664\u8f93\u5165 so \u4e2d\u7684\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u3002\u8fd9\u91cc\u8bf4\u7684\u7b26\u53f7\u8868\u4e0e\u4e0a\u6587\u4e2d\u7684\u201c\u52a8\u6001\u7b26\u53f7\u8868\u201d\u4e0d\u540c\uff0c\u7b26\u53f7\u8868\u6240\u5728 section \u540d\u901a\u5e38\u4e3a .symtab\uff0c\u5b83\u901a\u5e38\u5305\u542b\u4e86\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u7684\u5168\u90e8\u7b26\u53f7\uff0c\u5e76\u4e14\u989d\u5916\u8fd8\u6709\u5f88\u591a\u7b26\u53f7\u3002\u8c03\u8bd5\u4fe1\u606f\u987e\u540d\u601d\u4e49\u5c31\u662f\u7528\u4e8e\u8c03\u8bd5\u8be5 so \u7684\u4fe1\u606f\uff0c\u4e3b\u8981\u662f\u5404\u79cd\u540d\u5b57\u4ee5 <code>.debug_</code> \u5f00\u5934\u7684 section\uff0c\u901a\u8fc7\u8fd9\u4e9b section \u53ef\u4ee5\u5efa\u7acb so \u6bcf\u6761\u6307\u4ee4\u4e0e\u6e90\u7801\u6587\u4ef6\u7684\u6620\u5c04\u5173\u7cfb\uff08\u4e5f\u5c31\u662f\u80fd\u591f\u5bf9 so \u4e2d\u6bcf\u6761\u6307\u4ee4\u627e\u5230\u5176\u5bf9\u5e94\u7684\u6e90\u7801\u6587\u4ef6\u540d\u3001\u6587\u4ef6\u884c\u53f7\u7b49\u4fe1\u606f\uff09\u3002 \u4e4b\u6240\u4ee5\u53eb strip \u4f18\u5316\uff0c\u662f\u56e0\u4e3a\u5176\u5b9e\u9645\u8c03\u7528\u7684\u662f NDK \u63d0\u4f9b\u7684\u7684 strip \u547d\u4ee4\uff08\u6240\u7528\u53c2\u6570\u4e3a\u2013strip-unneeded\uff09\u3002</p> <p>\u6ce8\uff1a\u4e3a\u4ec0\u4e48 AGP \u8981\u5148\u7f16\u8bd1\u51fa\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so\uff0c\u800c\u4e0d\u76f4\u63a5\u7f16\u8bd1\u51fa\u6700\u7ec8\u7684 so \u5462\uff08\u901a\u8fc7\u6dfb\u52a0 <code>-s</code> \u53c2\u6570\u662f\u53ef\u4ee5\u505a\u5230\u76f4\u63a5\u7f16\u8bd1\u51fa\u6ca1\u6709\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u7684\uff09\uff1f\u539f\u56e0\u5c31\u5728\u4e8e\u9700\u8981\u4f7f\u7528\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u5bf9\u5d29\u6e83\u8c03\u7528\u6808\u8fdb\u884c\u8fd8\u539f\u3002\u5220\u9664\u4e86\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u5b8c\u5168\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff0c\u4f46\u662f\u5f53\u5b83\u53d1\u751f\u5d29\u6e83\u65f6\uff0c\u53ea\u80fd\u4fdd\u8bc1\u83b7\u53d6\u5230\u5d29\u6e83\u8c03\u7528\u6808\u7684\u6bcf\u4e2a\u6808\u5e27\u7684\u76f8\u5e94\u6307\u4ee4\u5728 so \u4e2d\u7684\u4f4d\u7f6e\uff0c\u4e0d\u4e00\u5b9a\u80fd\u83b7\u53d6\u5230\u7b26\u53f7\u3002\u4f46\u662f\u6392\u67e5\u5d29\u6e83\u95ee\u9898\u65f6\uff0c\u6211\u4eec\u5e0c\u671b\u5f97\u77e5 so \u5d29\u6e83\u5728\u6e90\u7801\u7684\u54ea\u4e2a\u4f4d\u7f6e\u3002\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u53ef\u4ee5\u5c06\u5d29\u6e83\u8c03\u7528\u6808\u7684\u6bcf\u4e2a\u6808\u5e27\u8fd8\u539f\u6210\u5176\u5bf9\u5e94\u7684\u6e90\u7801\u6587\u4ef6\u540d\u3001\u6587\u4ef6\u884c\u53f7\u3001\u51fd\u6570\u540d\u7b49\uff0c\u5927\u5927\u65b9\u4fbf\u4e86\u5d29\u6e83\u95ee\u9898\u7684\u6392\u67e5\u3002\u6240\u4ee5\u8bf4\uff0c\u867d\u7136\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u4e0d\u4f1a\u6253\u5305\u5230\u6700\u7ec8\u7684 apk \u4e2d\uff0c\u4f46\u5b83\u5bf9\u6392\u67e5\u95ee\u9898\u6765\u8bf4\u975e\u5e38\u91cd\u8981\u3002</p> <p>AGP \u901a\u8fc7\u5f00\u542f strip \u4f18\u5316\uff0c\u53ef\u4ee5\u5927\u5e45\u7f29\u51cf so \u7684\u4f53\u79ef\uff0c\u751a\u81f3\u53ef\u4ee5\u8fbe\u5230\u5341\u500d\u4ee5\u4e0a\u3002\u4ee5\u4e00\u4e2a\u6d4b\u8bd5 so \u4e3a\u4f8b\uff0c\u5176\u6700\u7ec8 so \u5927\u5c0f\u4e3a14 KB\uff0c\u4f46\u662f\u5bf9\u5e94\u7684\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u5927\u5c0f\u4e3a 136 KB\u3002\u4e0d\u8fc7\u5728\u4f7f\u7528\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c AGP \u627e\u4e0d\u5230\u5bf9\u5e94\u7684 strip \u547d\u4ee4\uff0c\u5c31\u4f1a\u628a\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u76f4\u63a5\u6253\u5305\u5230 apk \u6216 aar \u4e2d\uff0c\u5e76\u4e0d\u4f1a\u6253\u5305\u5931\u8d25\u3002\u4f8b\u5982\u7f3a\u5c11 armeabi \u67b6\u6784\u5bf9\u5e94\u7684 strip \u547d\u4ee4\u65f6\u63d0\u793a\u4fe1\u606f\u5982\u4e0b\uff1a</p> <pre><code>Unable to strip library 'XXX.so' due to missing strip tool for ABI 'ARMEABI'. Packaging it as is.\n</code></pre> <p>\u9664\u4e86\u4e0a\u8ff0 Android \u6784\u5efa\u5de5\u5177\u9ed8\u8ba4\u4e3a so \u4f53\u79ef\u505a\u7684\u4f18\u5316\uff0c\u6211\u4eec\u8fd8\u80fd\u505a\u54ea\u4e9b\u4f18\u5316\u5462\uff1f\u9996\u5148\u660e\u786e\u6211\u4eec\u4f18\u5316\u7684\u539f\u5219\uff1a</p> <ul> <li>\u5bf9\u4e8e\u5fc5\u987b\u4fdd\u7559\u7684\u5185\u5bb9\u8003\u8651\u8fdb\u884c\u7f29\u51cf\uff0c\u51cf\u5c0f\u4f53\u79ef\u5360\u7528\uff1b</li> <li>\u5bf9\u4e8e\u65e0\u9700\u4fdd\u7559\u7684\u5185\u5bb9\u76f4\u63a5\u5220\u9664\u3002</li> </ul> <p>\u57fa\u4e8e\u4ee5\u4e0a\u539f\u5219\uff0c\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u4e09\u4e2a\u65b9\u9762\u5bf9 so \u7ee7\u7eed\u8fdb\u884c\u6df1\u5165\u4f18\u5316\uff1a</p> <ul> <li>\u7cbe\u7b80\u52a8\u6001\u7b26\u53f7\u8868\uff1a\u4e0a\u6587\u5df2\u7ecf\u63d0\u5230\uff0c\u52a8\u6001\u7b26\u53f7\u8868\u662f so \u4e0e\u5916\u90e8\u8fdb\u884c\u8fde\u63a5\u7684\u201c\u6865\u6881\u201d\uff0c\u5176\u4e2d\u7684\u5bfc\u51fa\u8868\u76f8\u5f53\u4e8e\u662f so \u5bf9\u5916\u66b4\u9732\u7684\u63a5\u53e3\u3002\u54ea\u4e9b\u63a5\u53e3\u662f\u5fc5\u987b\u5bf9\u5916\u66b4\u9732\u7684\u5462\uff1f\u5728 Android \u4e2d\uff0c\u5927\u90e8\u5206 so \u662f\u7528\u6765\u5b9e\u73b0 Java \u7684 native \u65b9\u6cd5\u7684\uff0c\u5bf9\u4e8e\u8fd9\u79cd so\uff0c\u53ea\u8981\u8ba9\u5e94\u7528\u8fd0\u884c\u65f6\u80fd\u591f\u83b7\u53d6\u5230 Java native \u65b9\u6cd5\u5bf9\u5e94\u7684\u51fd\u6570\u5730\u5740\u5373\u53ef\u3002\u8981\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u6807\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a\u4e00\u79cd\u662f\u4f7f\u7528 RegisterNatives \u52a8\u6001\u6ce8\u518c Java native \u65b9\u6cd5\uff0c\u4e00\u79cd\u662f\u6309\u7167 JNI \u89c4\u8303\u5b9a\u4e49 <code>java_***</code> \u6837\u5f0f\u7684\u51fd\u6570\u5e76\u5bfc\u51fa\u5176\u7b26\u53f7\u3002RegisterNatives \u65b9\u5f0f\u53ef\u4ee5\u63d0\u524d\u68c0\u6d4b\u5230\u65b9\u6cd5\u7b7e\u540d\u4e0d\u5339\u914d\u7684\u95ee\u9898\uff0c\u5e76\u4e14\u53ef\u4ee5\u51cf\u5c11\u5bfc\u51fa\u7b26\u53f7\u7684\u6570\u91cf\uff0c\u8fd9\u4e5f\u662f Google \u63a8\u8350\u7684\u505a\u6cd5\u3002\u6240\u4ee5\u5728\u6700\u4f18\u60c5\u51b5\u4e0b\u53ea\u9700\u5bfc\u51fa <code>JNI_OnLoad</code>\uff08\u5728\u5176\u4e2d\u4f7f\u7528 RegisterNatives \u5bf9 Java native \u65b9\u6cd5\u8fdb\u884c\u52a8\u6001\u6ce8\u518c\uff09\u548c <code>JNI_OnUnload</code>\uff08\u53ef\u4ee5\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff09\u8fd9\u4e24\u4e2a\u7b26\u53f7\u5373\u53ef\u3002\u5982\u679c\u4e0d\u5e0c\u671b\u6539\u5199\u9879\u76ee\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u518d\u5bfc\u51fa <code>java_***</code> \u6837\u5f0f\u7684\u7b26\u53f7\u3002\u9664\u4e86\u4e0a\u8ff0\u7c7b\u578b\u7684 so\uff0c\u5269\u4f59\u7684 so \u901a\u5e38\u662f\u88ab\u5e94\u7528\u7684\u5176\u4ed6 so \u52a8\u6001\u4f9d\u8d56\u7684\uff0c\u5bf9\u4e8e\u8fd9\u7c7b so\uff0c\u9700\u8981\u786e\u5b9a\u6240\u6709\u52a8\u6001\u4f9d\u8d56\u5b83\u7684 so \u4f9d\u8d56\u4e86\u5b83\u7684\u54ea\u4e9b\u7b26\u53f7\uff0c\u4ec5\u4fdd\u7559\u8fd9\u4e9b\u88ab\u4f9d\u8d56\u7684\u7b26\u53f7\u5373\u53ef\u3002\u53e6\u5916\uff0c\u8fd9\u91cc\u5e94\u533a\u5206\u7b26\u53f7\u8868\u9879\u4e0e\u5b9e\u73b0\u4f53\uff0c\u7b26\u53f7\u8868\u9879\u662f\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u76f8\u5e94\u7684 <code>Elfxx_Sym</code> \u9879\uff08\u89c1\u4e0a\u56fe\uff09\uff0c\u5b9e\u73b0\u4f53\u662f\u5176\u5728 <code>.text</code>\u3001<code>.data</code>\u3001 <code>.bss</code>\u3001<code>.rodata</code> \u7b49\u6216\u5176\u4ed6\u90e8\u5206\u7684\u5b9e\u4f53\u3002\u5220\u9664\u4e86\u7b26\u53f7\u8868\u9879\uff0c\u5b9e\u73b0\u4f53\u4e0d\u4e00\u5b9a\u8981\u88ab\u5220\u9664\u3002\u7ed3\u5408\u4e0a\u6587 so \u6587\u4ef6\u7ed3\u6784\u793a\u610f\u56fe\uff0c\u53ef\u4ee5\u9884\u4f30\u51fa\u5220\u9664\u4e00\u4e2a\u7b26\u53f7\u8868\u9879\u540e so \u51cf\u5c0f\u7684\u4f53\u79ef\u4e3a\uff1a\u7b26\u53f7\u540d\u5b57\u7b26\u4e32\u957f\u5ea6+ 1 + <code>Elfxx_Sym</code> + <code>Elfxx_Half</code> + <code>Elfxx_Word</code> \u3002</li> <li>\u79fb\u9664\u65e0\u7528\u4ee3\u7801\uff1a\u5728\u5b9e\u9645\u7684\u9879\u76ee\u4e2d\uff0c\u6709\u4e00\u4e9b\u4ee3\u7801\u5728 Release \u7248\u4e2d\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u4f7f\u7528\u5230\uff08\u4f8b\u5982\u5386\u53f2\u9057\u7559\u4ee3\u7801\u3001\u7528\u4e8e\u6d4b\u8bd5\u7684\u4ee3\u7801\u7b49\uff09\uff0c\u8fd9\u4e9b\u4ee3\u7801\u88ab\u79f0\u4e3a DeadCode\u3002\u800c\u6839\u636e\u4e0a\u6587\u5206\u6790\uff0c\u53ea\u6709\u52a8\u6001\u7b26\u53f7\u8868\u7684\u5bfc\u51fa\u7b26\u53f7\u76f4\u63a5\u6216\u95f4\u63a5\u5f15\u7528\u5230\u7684\u6240\u6709\u4ee3\u7801\u624d\u9700\u8981\u4fdd\u7559\uff0c\u5176\u4ed6\u5269\u4f59\u7684\u6240\u6709\u4ee3\u7801\u90fd\u662f DeadCode\uff0c\u90fd\u662f\u53ef\u4ee5\u5220\u9664\u7684\uff08\u6ce8\uff1a\u4e8b\u5b9e\u4e0a <code>.init_array</code> \u7b49\u7279\u6b8a section \u6d89\u53ca\u7684\u4ee3\u7801\u4e5f\u8981\u4fdd\u7559\uff09\u3002\u5220\u9664\u65e0\u7528\u4ee3\u7801\u7684\u6f5c\u5728\u6536\u76ca\u8f83\u5927\u3002</li> <li>\u4f18\u5316\u6307\u4ee4\u957f\u5ea6\uff1a\u5b9e\u73b0\u67d0\u4e2a\u529f\u80fd\u7684\u6307\u4ee4\u5e76\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u7f16\u8bd1\u5668\u6709\u53ef\u80fd\u80fd\u7528\u66f4\u5c11\u7684\u6307\u4ee4\u5b8c\u6210\u76f8\u540c\u7684\u529f\u80fd\uff0c\u4ece\u800c\u5b9e\u73b0\u4f18\u5316\u3002\u7531\u4e8e\u6307\u4ee4\u662f so \u7684\u4e3b\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u56e0\u6b64\u4f18\u5316\u8fd9\u4e00\u90e8\u5206\u7684\u6f5c\u5728\u6536\u76ca\u4e5f\u6bd4\u8f83\u5927\u3002</li> </ul> <p>so \u53ef\u4f18\u5316\u5185\u5bb9\u5982\u4e0b\u56fe\u6240\u793a\uff08\u53ef\u5220\u9664\u90e8\u5206\u7528\u7ea2\u8272\u80cc\u666f\u6807\u51fa\uff0c\u53ef\u4f18\u5316\u90e8\u5206\u662f <code>.text</code>\uff09\uff0c\u5176\u4e2d funC\u3001value2\u3001value3\u3001value6 \u7531\u4e8e\u5206\u522b\u88ab\u9700\u4fdd\u7559\u90e8\u5206\u4f7f\u7528\uff0c\u6240\u4ee5\u9700\u8981\u4fdd\u7559\u5176\u5b9e\u73b0\u4f53\uff0c\u53ea\u80fd\u5220\u9664\u5176\u7b26\u53f7\u8868\u9879\u3002funD\u3001value1\u3001value4\u3001value5 \u53ef\u5220\u9664\u7b26\u53f7\u8868\u9879\u53ca\u5176\u5b9e\u73b0\u4f53\uff08\u6ce8\uff1a\u56e0\u4e3a value4 \u7684\u5b9e\u73b0\u4f53\u5728 <code>.bss</code> \u4e2d\uff0c\u800c <code>.bss</code> \u5b9e\u9645\u4e0d\u5360\u7528 so \u7684\u4f53\u79ef\uff0c\u6240\u4ee5\u5220\u9664 value4 \u7684\u5b9e\u73b0\u4f53\u4e0d\u4f1a\u51cf\u5c0f so \u7684\u4f53\u79ef\uff09\u3002</p> <p></p> <p>\u5728\u786e\u5b9a\u4e86 so \u4e2d\u53ef\u4ee5\u4f18\u5316\u7684\u5185\u5bb9\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651\u4f18\u5316\u65f6\u673a\u7684\u95ee\u9898\uff1a\u662f\u76f4\u63a5\u4fee\u6539 so \u6587\u4ef6\uff0c\u8fd8\u662f\u63a7\u5236\u5176\u751f\u6210\u8fc7\u7a0b\uff1f\u8003\u8651\u5230\u76f4\u63a5\u4fee\u6539 so \u6587\u4ef6\u7684\u98ce\u9669\u4e0e\u96be\u5ea6\u8f83\u5927\uff0c\u63a7\u5236 so \u7684\u751f\u6210\u8fc7\u7a0b\u663e\u7136\u66f4\u7a33\u59a5\u3002\u4e3a\u4e86\u63a7\u5236 so \u7684\u751f\u6210\u8fc7\u7a0b\uff0c\u6211\u4eec\u5148\u7b80\u8981\u4ecb\u7ecd\u4e00\u4e0b so \u7684\u751f\u6210\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0cso \u7684\u751f\u6210\u8fc7\u7a0b\u53ef\u4ee5\u5206\u4e3a\u56db\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>\u9884\u5904\u7406\uff1a\u5c06 include \u5934\u6587\u4ef6\u5904\u6269\u5c55\u4e3a\u5b9e\u9645\u6587\u4ef6\u5185\u5bb9\u5e76\u8fdb\u884c\u5b8f\u5b9a\u4e49\u66ff\u6362\u3002</li> <li>\u7f16\u8bd1\uff1a\u5c06\u9884\u5904\u7406\u540e\u7684\u6587\u4ef6\u7f16\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\u3002</li> <li>\u6c47\u7f16\uff1a\u5c06\u6c47\u7f16\u4ee3\u7801\u6c47\u7f16\u6210\u76ee\u6807\u6587\u4ef6\uff0c\u76ee\u6807\u6587\u4ef6\u4e2d\u5305\u542b\u673a\u5668\u6307\u4ee4\uff08\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u662f\u673a\u5668\u6307\u4ee4\uff0c\u89c1\u4e0b\u6587 LTO \u4e00\u8282\uff09\u548c\u6570\u636e\u4ee5\u53ca\u5176\u4ed6\u5fc5\u8981\u4fe1\u606f\u3002</li> <li>\u94fe\u63a5\uff1a\u5c06\u8f93\u5165\u7684\u6240\u6709\u76ee\u6807\u6587\u4ef6\u4ee5\u53ca\u9759\u6001\u5e93\uff08.a \u6587\u4ef6\uff09\u94fe\u63a5\u6210 so \u6587\u4ef6\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u9884\u5904\u7406\u548c\u6c47\u7f16\u9636\u6bb5\u5bf9\u7279\u5b9a\u8f93\u5165\u4ea7\u751f\u7684\u8f93\u51fa\u57fa\u672c\u662f\u56fa\u5b9a\u7684\uff0c\u4f18\u5316\u7a7a\u95f4\u8f83\u5c0f\u3002\u6240\u4ee5\u6211\u4eec\u7684\u4f18\u5316\u65b9\u6848\u4e3b\u8981\u662f\u9488\u5bf9\u7f16\u8bd1\u548c\u94fe\u63a5\u9636\u6bb5\u8fdb\u884c\u4f18\u5316\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#4","title":"4. \u4f18\u5316\u65b9\u6848\u4ecb\u7ecd","text":"<p>\u6211\u4eec\u5bf9\u6240\u6709\u80fd\u63a7\u5236\u6700\u7ec8 so \u4f53\u79ef\u7684\u65b9\u6848\u90fd\u8fdb\u884c\u8c03\u7814\uff0c\u5e76\u9a8c\u8bc1\u4e86\u5176\u6548\u679c\uff0c\u6700\u540e\u603b\u7ed3\u51fa\u8f83\u4e3a\u901a\u7528\u7684\u53ef\u884c\u65b9\u6848\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#41","title":"4.1 \u7cbe\u7b80\u52a8\u6001\u7b26\u53f7\u8868","text":""},{"location":"perf-opt/Android/size/Android-so-opt/#visibility-attribute","title":"\u4f7f\u7528 visibility \u548c attribute \u63a7\u5236\u7b26\u53f7\u53ef\u89c1\u6027","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u7ed9\u7f16\u8bd1\u5668\u4f20\u9012 <code>-fvisibility=VALUE</code> \u63a7\u5236\u5168\u5c40\u7684\u7b26\u53f7\u53ef\u89c1\u6027\uff0cVALUE \u5e38\u53d6\u503c\u4e3a default \u548c hidden\uff1a</p> <ul> <li>default\uff1a\u9664\u975e\u5bf9\u53d8\u91cf\u6216\u51fd\u6570\u7279\u522b\u6307\u5b9a\u7b26\u53f7\u53ef\u89c1\u6027\uff0c\u6240\u6709\u7b26\u53f7\u90fd\u5728\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\uff0c\u8fd9\u4e5f\u662f\u4e0d\u4f7f\u7528 -fvisibility \u65f6\u7684\u9ed8\u8ba4\u503c\u3002</li> <li>hidden\uff1a\u9664\u975e\u5bf9\u53d8\u91cf\u6216\u51fd\u6570\u7279\u522b\u6307\u5b9a\u7b26\u53f7\u53ef\u89c1\u6027\uff0c\u6240\u6709\u7b26\u53f7\u5728\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u90fd\u4e0d\u53ef\u89c1\u3002</li> </ul> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>set(CMAKE_C_FLAGS \"${CMAKE_C_FLAGS} -fvisibility=hidden\")\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fvisibility=hidden\")\n</code></pre> <p>ndk-build \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>LOCAL_CFLAGS += -fvisibility=hidden\n</code></pre> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u9488\u5bf9\u5355\u4e2a\u53d8\u91cf\u6216\u51fd\u6570\uff0c\u53ef\u4ee5\u901a\u8fc7 attribute \u65b9\u5f0f\u6307\u5b9a\u5176\u7b26\u53f7\u53ef\u89c1\u6027\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>__attribute__((visibility(\"hidden\")))\nint hiddenInt=3;\n</code></pre> <p>\u5176\u5e38\u7528\u503c\u4e5f\u662f default \u548c hidden\uff0c\u4e0e visibility \u65b9\u5f0f\u610f\u4e49\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002</p> <p>attribute \u65b9\u5f0f\u6307\u5b9a\u7684\u7b26\u53f7\u53ef\u89c1\u6027\u7684\u4f18\u5148\u7ea7\uff0c\u9ad8\u4e8e visibility \u65b9\u5f0f\u6307\u5b9a\u7684\u53ef\u89c1\u6027\uff0c\u76f8\u5f53\u4e8e visibility \u662f\u5168\u5c40\u7b26\u53f7\u53ef\u89c1\u6027\u5f00\u5173\uff0cattribute \u65b9\u5f0f\u662f\u9488\u5bf9\u5355\u4e2a\u7b26\u53f7\u7684\u53ef\u89c1\u6027\u5f00\u5173\u3002\u8fd9\u4e24\u79cd\u65b9\u5f0f\u7ed3\u5408\u5c31\u80fd\u63a7\u5236\u6e90\u7801\u4e2d\u6bcf\u4e2a\u7b26\u53f7\u7684\u53ef\u89c1\u6027\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e0a\u9762\u8fd9\u4e24\u79cd\u65b9\u5f0f\uff0c\u53ea\u80fd\u63a7\u5236\u53d8\u91cf\u6216\u51fd\u6570\u662f\u5426\u5b58\u5728\u4e8e\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\uff08\u5373\u662f\u5426\u5220\u9664\u5176\u52a8\u6001\u7b26\u53f7\u8868\u9879\uff09\uff0c\u800c\u4e0d\u4f1a\u5220\u9664\u5176\u5b9e\u73b0\u4f53\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#static","title":"\u4f7f\u7528 static \u5173\u952e\u5b57\u63a7\u5236\u7b26\u53f7\u53ef\u89c1\u6027","text":"<p>\u5728C/C++\u8bed\u8a00\u4e2d\uff0cstatic \u5173\u952e\u5b57\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u6709\u4e0d\u540c\u610f\u4e49\uff0c\u5f53\u4f7f\u7528 static \u8868\u793a\u201c\u8be5\u51fd\u6570\u6216\u53d8\u91cf\u4ec5\u5728\u672c\u6587\u4ef6\u53ef\u89c1\u201d\u65f6\uff0c\u90a3\u4e48\u8fd9\u4e2a\u51fd\u6570\u6216\u53d8\u91cf\u5c31\u4e0d\u4f1a\u51fa\u73b0\u5728\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\uff0c\u4f46\u53ea\u4f1a\u5220\u9664\u5176\u52a8\u6001\u7b26\u53f7\u8868\u9879\uff0c\u800c\u4e0d\u4f1a\u5220\u9664\u5176\u5b9e\u73b0\u4f53\u3002static \u5173\u952e\u5b57\u76f8\u5f53\u4e8e\u662f\u589e\u5f3a\u7684 hidden\uff08\u56e0\u4e3a static \u58f0\u660e\u7684\u51fd\u6570\u6216\u53d8\u91cf\u7f16\u8bd1\u65f6\u53ea\u5bf9\u5f53\u524d\u6587\u4ef6\u53ef\u89c1\uff0c\u800c hidden \u58f0\u660e\u7684\u51fd\u6570\u6216\u53d8\u91cf\u53ea\u662f\u5728\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u4e0d\u5b58\u5728\uff0c\u5728\u7f16\u8bd1\u671f\u95f4\u5bf9\u5176\u4ed6\u6587\u4ef6\u8fd8\u662f\u53ef\u89c1\u7684\uff09\u3002\u5728\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u4f7f\u7528 static \u5173\u952e\u5b57\u58f0\u660e\u4e00\u4e2a\u51fd\u6570\u6216\u53d8\u91cf\u201c\u4ec5\u5728\u672c\u6587\u4ef6\u53ef\u89c1\u201d\u662f\u5f88\u597d\u7684\u4e60\u60ef\uff0c\u4f46\u662f\u4e0d\u5efa\u8bae\u4f7f\u7528 static \u5173\u952e\u5b57\u63a7\u5236\u7b26\u53f7\u53ef\u89c1\u6027\uff1a\u65e0\u6cd5\u4f7f\u7528 static \u5173\u952e\u5b57\u63a7\u5236\u4e00\u4e2a\u591a\u6587\u4ef6\u53ef\u89c1\u7684\u51fd\u6570\u6216\u53d8\u91cf\u7684\u7b26\u53f7\u53ef\u89c1\u6027\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#exclude-libs","title":"\u4f7f\u7528 exclude libs \u79fb\u9664\u9759\u6001\u5e93\u4e2d\u7684\u7b26\u53f7","text":"<p>\u4e0a\u8ff0 visibility \u65b9\u5f0f\u3001attribute \u65b9\u5f0f\u548c static \u5173\u952e\u5b57\uff0c\u90fd\u662f\u63a7\u5236\u9879\u76ee\u6e90\u7801\u4e2d\u7b26\u53f7\u7684\u53ef\u89c1\u6027\uff0c\u800c\u65e0\u6cd5\u63a7\u5236\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u4e2d\u7684\u7b26\u53f7\u5728\u6700\u7ec8 so \u4e2d\u662f\u5426\u5b58\u5728\u3002exclude libs \u5c31\u662f\u7528\u6765\u63a7\u5236\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u4e2d\u7684\u7b26\u53f7\u662f\u5426\u53ef\u89c1\uff0c\u5b83\u662f\u4f20\u9012\u7ed9\u94fe\u63a5\u5668\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u4f7f\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u7684\u7b26\u53f7\u5728\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u4e0d\u5b58\u5728\u3002\u540c\u6837\uff0c\u4e5f\u662f\u53ea\u80fd\u5220\u9664\u7b26\u53f7\u8868\u9879\uff0c\u5b9e\u73b0\u4f53\u4ecd\u7136\u4f1a\u5b58\u5728\u4e8e\u4ea7\u751f\u7684 so \u6587\u4ef6\u4e2d\u3002</p> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>set(CMAKE_SHARED_LINKER_FLAGS \"${CMAKE_SHARED_LINKER_FLAGS} -Wl,--exclude-libs,ALL\")#\u4f7f\u6240\u6709\u9759\u6001\u5e93\u4e2d\u7684\u7b26\u53f7\u90fd\u4e0d\u88ab\u5bfc\u51fa\nset(CMAKE_SHARED_LINKER_FLAGS \"${CMAKE_SHARED_LINKER_FLAGS} -Wl,--exclude-libs,libabc.a\")#\u4f7f libabc.a \u7684\u7b26\u53f7\u90fd\u4e0d\u88ab\u5bfc\u51fa\n</code></pre> <p>ndk-build \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>LOCAL_LDFLAGS += -Wl,--exclude-libs,ALL #\u4f7f\u6240\u6709\u9759\u6001\u5e93\u4e2d\u7684\u7b26\u53f7\u90fd\u4e0d\u88ab\u5bfc\u51fa\nLOCAL_LDFLAGS += -Wl,--exclude-libs,libabc.a #\u4f7f libabc.a \u7684\u7b26\u53f7\u90fd\u4e0d\u88ab\u5bfc\u51fa\n</code></pre>"},{"location":"perf-opt/Android/size/Android-so-opt/#version-script","title":"\u4f7f\u7528 version script \u63a7\u5236\u7b26\u53f7\u53ef\u89c1\u6027","text":"<p>version script \u662f\u4f20\u9012\u7ed9\u94fe\u63a5\u5668\u7684\u53c2\u6570\uff0c\u7528\u6765\u6307\u5b9a\u52a8\u6001\u5e93\u5bfc\u51fa\u54ea\u4e9b\u7b26\u53f7\u4ee5\u53ca\u7b26\u53f7\u7684\u7248\u672c\u3002\u8be5\u53c2\u6570\u4f1a\u5f71\u54cd\u5230\u4e0a\u9762\u201cso \u6587\u4ef6\u683c\u5f0f\u201d\u4e00\u8282\u4e2d <code>.gnu.version</code> \u548c <code>.gnu.version_d</code> \u7684\u5185\u5bb9\u3002\u6211\u4eec\u73b0\u5728\u53ea\u4f7f\u7528\u5b83\u7684\u6307\u5b9a\u6240\u6709\u5bfc\u51fa\u7b26\u53f7\u7684\u529f\u80fd\uff08\u5373\u7b26\u53f7\u7248\u672c\u540d\u4f7f\u7528\u7a7a\u5b57\u7b26\u4e32\uff09\u3002\u5f00\u542f version script \u9700\u8981\u5148\u7f16\u5199\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u7528\u6765\u6307\u5b9a\u52a8\u6001\u5e93\u5bfc\u51fa\u54ea\u4e9b\u7b26\u53f7\u3002\u793a\u4f8b\u5982\u4e0b\uff08\u53ea\u5bfc\u51fa usedFun \u8fd9\u4e00\u4e2a\u51fd\u6570\uff09\uff1a</p> <pre><code>{\n    global:usedFun;\n    local:*;\n};\n</code></pre> <p>\u7136\u540e\u5c06\u4e0a\u8ff0\u6587\u4ef6\u7684\u8def\u5f84\u4f20\u9012\u7ed9\u94fe\u63a5\u5668\u5373\u53ef\uff08\u5047\u5b9a\u4e0a\u8ff0\u6587\u4ef6\u540d\u4e3a <code>version_script.txt</code>\uff09\u3002</p> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>set(CMAKE_SHARED_LINKER_FLAGS \"${CMAKE_SHARED_LINKER_FLAGS} -Wl,--version-script=${CMAKE_CURRENT_SOURCE_DIR}/version_script.txt\") #version_script.txt \u4e0e\u5f53\u524d CMakeLists.txt \u540c\u76ee\u5f55\n</code></pre> <p>ndk-build \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>LOCAL_LDFLAGS += -Wl,--version-script=${LOCAL_PATH}/version_script.txt #version_script.txt \u4e0e\u5f53\u524d Android.mk \u540c\u76ee\u5f55\n</code></pre> <p>\u770b\u4e0a\u53bb\uff0cversion script \u662f\u660e\u786e\u5730\u6307\u5b9a\u9700\u8981\u4fdd\u7559\u7684\u7b26\u53f7\uff0c\u5982\u679c\u901a\u8fc7 visibility \u7ed3\u5408 attribute \u7684\u65b9\u5f0f\u63a7\u5236\u6bcf\u4e2a\u7b26\u53f7\u662f\u5426\u5bfc\u51fa\uff0c\u4e5f\u80fd\u8fbe\u5230 version script \u7684\u6548\u679c\uff0c\u4f46\u662f version script \u65b9\u5f0f\u6709\u4e00\u4e9b\u989d\u5916\u7684\u597d\u5904\uff1a</p> <ol> <li>version script \u65b9\u5f0f\u53ef\u4ee5\u63a7\u5236\u7f16\u8bd1\u8fdb so \u7684\u9759\u6001\u5e93\u7684\u7b26\u53f7\u662f\u5426\u5bfc\u51fa\uff0cvisibility \u548c attribute \u65b9\u5f0f\u90fd\u65e0\u6cd5\u505a\u5230\u8fd9\u4e00\u70b9\u3002</li> <li>visibility \u7ed3\u5408 attribute \u65b9\u5f0f\u9700\u8981\u5728\u6e90\u7801\u4e2d\u6807\u660e\u6bcf\u4e2a\u9700\u8981\u5bfc\u51fa\u7684\u7b26\u53f7\uff0c\u5bf9\u4e8e\u5bfc\u51fa\u7b26\u53f7\u8f83\u591a\u7684\u9879\u76ee\u6765\u8bf4\u662f\u5f88\u7e41\u6742\u7684\u3002version script \u628a\u9700\u8981\u5bfc\u51fa\u7684\u7b26\u53f7\u7edf\u4e00\u5730\u653e\u5230\u4e86\u4e00\u8d77\uff0c\u80fd\u591f\u76f4\u89c2\u65b9\u4fbf\u5730\u67e5\u770b\u548c\u4fee\u6539\uff0c\u5bf9\u5bfc\u51fa\u7b26\u53f7\u8f83\u591a\u7684\u9879\u76ee\u4e5f\u975e\u5e38\u53cb\u597d\u3002</li> <li>version script \u652f\u6301\u901a\u914d\u7b26\uff0c<code>*</code> \u4ee3\u88680\u4e2a\u6216\u8005\u591a\u4e2a\u5b57\u7b26\uff0c<code>?</code> \u4ee3\u8868\u5355\u4e2a\u5b57\u7b26\u3002\u6bd4\u5982 <code>my*;</code> \u5c31\u4ee3\u8868\u6240\u6709\u4ee5 my \u5f00\u5934\u7684\u7b26\u53f7\u3002\u6709\u4e86\u901a\u914d\u7b26\u7684\u652f\u6301\uff0c\u914d\u7f6e version script \u4f1a\u66f4\u52a0\u65b9\u4fbf\u3002</li> <li>\u8fd8\u6709\u975e\u5e38\u7279\u6b8a\u7684\u4e00\u70b9\uff0cversion script \u65b9\u5f0f\u53ef\u4ee5\u5220\u9664 <code>__bss_start</code> \u8fd9\u6837\u7684\u4e00\u4e9b\u7b26\u53f7\uff08\u8fd9\u662f\u94fe\u63a5\u5668\u9ed8\u8ba4\u52a0\u4e0a\u7684\u7b26\u53f7\uff09\u3002</li> </ol> <p>\u7efc\u4e0a\u6240\u8ff0\uff0cversion script \u65b9\u5f0f\u4f18\u4e8e visibility \u7ed3\u5408 attribute \u7684\u65b9\u5f0f\u3002\u540c\u65f6\uff0c\u4f7f\u7528\u4e86 version script \u65b9\u5f0f\uff0c\u5c31\u4e0d\u9700\u8981\u4f7f\u7528 exclude libs \u65b9\u5f0f\u63a7\u5236\u4f9d\u8d56\u7684\u9759\u6001\u5e93\u4e2d\u7684\u7b26\u53f7\u662f\u5426\u5bfc\u51fa\u4e86\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#42","title":"4.2 \u79fb\u9664\u65e0\u7528\u4ee3\u7801","text":""},{"location":"perf-opt/Android/size/Android-so-opt/#lto","title":"\u5f00\u542f LTO","text":"<p>LTO \u662f Link Time Optimization \u7684\u7f29\u5199\uff0c\u5373\u94fe\u63a5\u671f\u4f18\u5316\u3002LTO \u80fd\u591f\u5728\u94fe\u63a5\u76ee\u6807\u6587\u4ef6\u65f6\u68c0\u6d4b\u51fa DeadCode \u5e76\u5220\u9664\u5b83\u4eec\uff0c\u4ece\u800c\u51cf\u5c0f\u7f16\u8bd1\u4ea7\u7269\u7684\u4f53\u79ef\u3002DeadCode \u4e3e\u4f8b\uff1a\u67d0\u4e2a if \u6761\u4ef6\u6c38\u8fdc\u4e3a\u5047\uff0c\u90a3\u4e48 if \u4e3a\u771f\u4e0b\u7684\u4ee3\u7801\u5757\u5c31\u53ef\u4ee5\u79fb\u9664\u3002\u8fdb\u4e00\u6b65\u5730\uff0c\u88ab\u79fb\u9664\u4ee3\u7801\u5757\u6240\u8c03\u7528\u7684\u51fd\u6570\u4e5f\u53ef\u80fd\u56e0\u6b64\u800c\u53d8\u4e3a DeadCode\uff0c\u5b83\u4eec\u53c8\u53ef\u4ee5\u88ab\u79fb\u9664\u3002\u80fd\u591f\u5728\u94fe\u63a5\u671f\u505a\u4f18\u5316\u7684\u539f\u56e0\u662f\uff0c\u5728\u7f16\u8bd1\u671f\u5f88\u591a\u4fe1\u606f\u8fd8\u4e0d\u80fd\u786e\u5b9a\uff0c\u53ea\u6709\u5c40\u90e8\u4fe1\u606f\uff0c\u65e0\u6cd5\u6267\u884c\u4e00\u4e9b\u4f18\u5316\u3002\u4f46\u662f\u94fe\u63a5\u65f6\u5927\u90e8\u5206\u4fe1\u606f\u90fd\u786e\u5b9a\u4e86\uff0c\u76f8\u5f53\u4e8e\u83b7\u53d6\u4e86\u5168\u5c40\u4fe1\u606f\uff0c\u6240\u4ee5\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\u3002GCC \u548c Clang \u5747\u652f\u6301 LTO\u3002LTO \u65b9\u5f0f\u7f16\u8bd1\u7684\u76ee\u6807\u6587\u4ef6\u4e2d\u5b58\u50a8\u7684\u4e0d\u518d\u662f\u5177\u4f53\u673a\u5668\u7684\u6307\u4ee4\uff0c\u800c\u662f\u673a\u5668\u65e0\u5173\u7684\u4e2d\u95f4\u8868\u793a\uff08GCC \u91c7\u7528\u7684\u662f GIMPLE \u5b57\u8282\u7801\uff0cClang \u91c7\u7528\u7684\u662f LLVM IR \u6bd4\u7279\u7801\uff09\u3002</p> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>set(CMAKE_C_FLAGS \"${CMAKE_C_FLAGS} -flto\")\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -flto\")\nset(CMAKE_SHARED_LINKER_FLAGS \"${CMAKE_SHARED_LINKER_FLAGS} -O3 -flto\")\n</code></pre> <p>ndk-build \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>LOCAL_CFLAGS += -flto\nLOCAL_LDFLAGS += -O3 -flto\n</code></pre> <p>\u4f7f\u7528 LTO \u65f6\u9700\u8981\u6ce8\u610f\u51e0\u70b9\uff1a</p> <ol> <li>\u5982\u679c\u4f7f\u7528 Clang\uff0c\u7f16\u8bd1\u53c2\u6570\u548c\u94fe\u63a5\u53c2\u6570\u4e2d\u90fd\u8981\u5f00\u542f LTO\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u65e0\u6cd5\u8bc6\u522b\u6587\u4ef6\u683c\u5f0f\u7684\u95ee\u9898\uff08NDK22 \u4e4b\u524d\u5b58\u5728\u6b64\u95ee\u9898\uff09\u3002\u4f7f\u7528 GCC \u7684\u8bdd\uff0c\u53ea\u9700\u8981\u7f16\u8bd1\u53c2\u6570\u4e2d\u5f00\u542f LTO \u5373\u53ef\u3002</li> <li>\u5982\u679c\u9879\u76ee\u5de5\u7a0b\u4f9d\u8d56\u4e86\u9759\u6001\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528 LTO \u65b9\u5f0f\u91cd\u65b0\u7f16\u8bd1\u8be5\u9759\u6001\u5e93\uff0c\u90a3\u4e48\u7f16\u8bd1\u52a8\u6001\u5e93\u65f6\uff0c\u5c31\u80fd\u79fb\u9664\u9759\u6001\u5e93\u4e2d\u7684 DeadCode\uff0c\u4ece\u800c\u51cf\u5c0f\u6700\u7ec8 so \u7684\u4f53\u79ef\u3002</li> <li>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u5982\u679c\u4f7f\u7528 Clang\uff0c\u94fe\u63a5\u5668\u9700\u8981\u5f00\u542f\u975e 0 \u7ea7\u522b\u7684\u4f18\u5316\uff0cLTO \u624d\u80fd\u771f\u6b63\u751f\u6548\u3002\u7ecf\u8fc7\u5b9e\u9645\u6d4b\u8bd5\uff08NDK \u4e3a r16b\uff09\uff0cO1 \u4f18\u5316\u6548\u679c\u8f83\u5dee\uff0cO2\u3001O3 \u4f18\u5316\u6548\u679c\u6bd4\u8f83\u63a5\u8fd1\u3002</li> <li>\u7531\u4e8e\u9700\u8981\u8fdb\u884c\u66f4\u591a\u7684\u5206\u6790\u8ba1\u7b97\uff0c\u5f00\u542f LTO \u540e\uff0c\u94fe\u63a5\u8017\u65f6\u4f1a\u660e\u663e\u589e\u52a0\u3002</li> </ol>"},{"location":"perf-opt/Android/size/Android-so-opt/#gc-sections","title":"\u5f00\u542f GC sections","text":"<p>\u8fd9\u662f\u4f20\u9012\u7ed9\u94fe\u63a5\u5668\u7684\u53c2\u6570\uff0cGC \u5373 Garbage Collection\uff08\u5783\u573e\u56de\u6536\uff09\uff0c\u4e5f\u5c31\u662f\u5bf9\u65e0\u7528\u7684 section \u8fdb\u884c\u56de\u6536\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 section \u4e0d\u662f\u6307\u6700\u7ec8 so \u4e2d\u7684 section\uff0c\u800c\u662f\u4f5c\u4e3a\u94fe\u63a5\u5668\u7684\u8f93\u5165\u7684\u76ee\u6807\u6587\u4ef6\u4e2d\u7684 section\u3002</p> <p>\u7b80\u8981\u4ecb\u7ecd\u4e00\u4e0b\u76ee\u6807\u6587\u4ef6\uff0c\u76ee\u6807\u6587\u4ef6\uff08\u6269\u5c55\u540d .o \uff09\u4e5f\u662f ELF \u6587\u4ef6\uff0c\u6240\u4ee5\u4e5f\u662f\u7531 section \u7ec4\u6210\u7684\uff0c\u53ea\u4e0d\u8fc7\u5b83\u53ea\u5305\u542b\u4e86\u76f8\u5e94\u6e90\u6587\u4ef6\u7684\u5185\u5bb9\uff1a\u51fd\u6570\u4f1a\u653e\u5230 <code>.text</code> \u6837\u5f0f\u7684 section \u4e2d\uff0c\u4e00\u4e9b\u53ef\u8bfb\u5199\u53d8\u91cf\u4f1a\u653e\u5230 <code>.data</code> \u6837\u5f0f\u7684 section \u4e2d\uff0c\u7b49\u7b49\u3002\u94fe\u63a5\u5668\u4f1a\u628a\u6240\u6709\u8f93\u5165\u7684\u76ee\u6807\u6587\u4ef6\u7684\u540c\u7c7b\u578b\u7684 section \u8fdb\u884c\u5408\u5e76\uff0c\u7ec4\u88c5\u51fa\u6700\u7ec8\u7684 so \u6587\u4ef6\u3002</p> <p>GC sections \u53c2\u6570\u901a\u77e5\u94fe\u63a5\u5668\uff1a\u4ec5\u4fdd\u7559\u52a8\u6001\u7b26\u53f7\uff08\u53ca <code>.init_array</code> \u7b49\uff09\u76f4\u63a5\u6216\u8005\u95f4\u63a5\u5f15\u7528\u5230\u7684 section\uff0c\u79fb\u9664\u5176\u4ed6\u65e0\u7528 section\u3002\u8fd9\u6837\u5c31\u80fd\u51cf\u5c0f\u6700\u7ec8 so \u7684\u4f53\u79ef\u3002\u4f46\u5f00\u542f GC sections \u8fd8\u9700\u8981\u8003\u8651\u4e00\u4e2a\u95ee\u9898\uff1a\u7f16\u8bd1\u5668\u9ed8\u8ba4\u4f1a\u628a\u6240\u6709\u51fd\u6570\u653e\u5230\u540c\u4e00\u4e2a section \u4e2d\uff0c\u628a\u6240\u6709\u76f8\u540c\u7279\u70b9\u7684\u6570\u636e\u653e\u5230\u540c\u4e00\u4e2a section \u4e2d\uff0c\u5982\u679c\u540c\u4e00\u4e2a section \u4e2d\u65e2\u6709\u9700\u8981\u5220\u9664\u7684\u90e8\u5206\u53c8\u6709\u9700\u8981\u4fdd\u7559\u7684\u90e8\u5206\uff0c\u4f1a\u4f7f\u5f97\u6574\u4e2a section \u90fd\u8981\u4fdd\u7559\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u51cf\u5c0f\u76ee\u6807\u6587\u4ef6 section \u7684\u7c92\u5ea6\uff0c\u8fd9\u9700\u8981\u501f\u52a9\u53e6\u5916\u4e24\u4e2a\u7f16\u8bd1\u53c2\u6570 <code>-fdata-sections</code> \u548c <code>-ffunction-sections</code> \uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u901a\u77e5\u7f16\u8bd1\u5668\uff0c\u5c06\u6bcf\u4e2a\u53d8\u91cf\u548c\u51fd\u6570\u5206\u522b\u653e\u5230\u5404\u81ea\u72ec\u7acb\u7684 section \u4e2d\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0a\u8ff0\u95ee\u9898\u4e86\u3002\u5b9e\u9645\u4e0a Android \u7f16\u8bd1\u76ee\u6807\u6587\u4ef6\u65f6\u4f1a\u81ea\u52a8\u5e26\u4e0a <code>-fdata-sections</code> \u548c <code>-ffunction-sections</code> \u53c2\u6570\uff0c\u8fd9\u91cc\u4e00\u5e76\u5217\u51fa\u6765\uff0c\u662f\u4e3a\u4e86\u7a81\u51fa\u5b83\u4eec\u7684\u4f5c\u7528\u3002</p> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>set(CMAKE_C_FLAGS \"${CMAKE_C_FLAGS} -fdata-sections -ffunction-sections\")\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fdata-sections -ffunction-sections\")\nset(CMAKE_SHARED_LINKER_FLAGS \"${CMAKE_SHARED_LINKER_FLAGS} -Wl,--gc-sections\")\n</code></pre> <p>ndk-build \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>LOCAL_CFLAGS += -fdata-sections -ffunction-sections\nLOCAL_LDFLAGS += -Wl,--gc-sections\n</code></pre>"},{"location":"perf-opt/Android/size/Android-so-opt/#43","title":"4.3 \u4f18\u5316\u6307\u4ee4\u957f\u5ea6","text":""},{"location":"perf-opt/Android/size/Android-so-opt/#ozos","title":"\u4f7f\u7528 Oz/Os \u4f18\u5316\u7ea7\u522b","text":"<p>\u7f16\u8bd1\u5668\u6839\u636e\u8f93\u5165\u7684 -Ox \u53c2\u6570\u51b3\u5b9a\u7f16\u8bd1\u7684\u4f18\u5316\u7ea7\u522b\uff0c\u5176\u4e2d O0 \u8868\u793a\u4e0d\u5f00\u542f\u4f18\u5316\uff08\u8fd9\u79cd\u60c5\u51b5\u4e3b\u8981\u662f\u4e3a\u4e86\u4fbf\u4e8e\u8c03\u8bd5\u4ee5\u53ca\u66f4\u5feb\u7684\u7f16\u8bd1\u901f\u5ea6\uff09\uff0c\u4ece O1 \u5230 O3\uff0c\u4f18\u5316\u7a0b\u5ea6\u8d8a\u6765\u8d8a\u5f3a\u3002Clang \u548c GCC \u5747\u63d0\u4f9b\u4e86 Os \u7684\u4f18\u5316\u7ea7\u522b\uff0c\u5176\u4e0e O2 \u6bd4\u8f83\u63a5\u8fd1\uff0c\u4f46\u662f\u4f18\u5316\u4e86\u751f\u6210\u4ea7\u7269\u7684\u4f53\u79ef\u3002\u800c Clang \u8fd8\u63d0\u4f9b\u4e86 Oz \u4f18\u5316\u7ea7\u522b\uff0c\u5728 Os \u7684\u57fa\u7840\u4e0a\u80fd\u8fdb\u4e00\u6b65\u4f18\u5316\u4ea7\u7269\u4f53\u79ef\u3002</p> <p>\u7efc\u4e0a\uff0c\u7f16\u8bd1\u5668\u662f Clang\uff0c\u53ef\u4ee5\u5f00\u542f Oz \u4f18\u5316\u3002\u5982\u679c\u7f16\u8bd1\u5668\u662f GCC\uff0c\u5219\u53ea\u80fd\u5f00\u542f Os \u4f18\u5316\uff08\u6ce8\uff1aNDK \u4ece r13 \u5f00\u59cb\u9ed8\u8ba4\u7f16\u8bd1\u5668\u4ece GCC \u53d8\u4e3a Clang\uff0cr18 \u4e2d\u6b63\u5f0f\u79fb\u9664\u4e86 GCC\u3002GCC \u4e0d\u652f\u6301 Oz \u662f\u6307 Android \u6700\u540e\u4f7f\u7528\u7684 GCC4.9 \u7248\u672c\u4e0d\u652f\u6301 Oz \u53c2\u6570\uff09\u3002Oz/Os \u4f18\u5316\u76f8\u6bd4\u4e8e O3 \u4f18\u5316\uff0c\u4f18\u5316\u4e86\u4ea7\u7269\u4f53\u79ef\uff0c\u6027\u80fd\u4e0a\u53ef\u80fd\u6709\u4e00\u5b9a\u635f\u5931\uff0c\u56e0\u6b64\u5982\u679c\u9879\u76ee\u539f\u672c\u4f7f\u7528\u4e86 O3 \u4f18\u5316\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u6d4b\u8bd5\u7ed3\u679c\u4ee5\u53ca\u5bf9\u6027\u80fd\u7684\u8981\u6c42\uff0c\u51b3\u5b9a\u662f\u5426\u4f7f\u7528 Os/Oz \u4f18\u5316\u7ea7\u522b\uff0c\u5982\u679c\u9879\u76ee\u539f\u672c\u672a\u4f7f\u7528 O3 \u4f18\u5316\u7ea7\u522b\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528 Os/Oz \u4f18\u5316\u3002</p> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff08\u5982\u679c\u4f7f\u7528 GCC\uff0c\u5e94\u5c06 Oz \u6539\u4e3a Os\uff09\uff1a</p> <pre><code>set(CMAKE_C_FLAGS \"${CMAKE_C_FLAGS} -Oz\")\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Oz\")\n</code></pre> <p>ndk-build \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff08\u5982\u679c\u4f7f\u7528 GCC\uff0c\u5e94\u5c06 Oz \u6539\u4e3a Os\uff09\uff1a</p> <pre><code>LOCAL_CFLAGS += -Oz\n</code></pre>"},{"location":"perf-opt/Android/size/Android-so-opt/#44","title":"4.4 \u5176\u4ed6\u63aa\u65bd","text":""},{"location":"perf-opt/Android/size/Android-so-opt/#c","title":"\u7981\u7528 C++ \u7684\u5f02\u5e38\u673a\u5236","text":"<p>\u5982\u679c\u9879\u76ee\u4e2d\u6ca1\u6709\u4f7f\u7528 C++ \u7684\u5f02\u5e38\u673a\u5236\uff08\u4f8b\u5982 <code>try...catch</code> \u7b49\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7\u7981\u7528 C++ \u7684\u5f02\u5e38\u673a\u5236\uff0c\u6765\u51cf\u5c0f so \u7684\u4f53\u79ef\u3002</p> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fno-exceptions\")\n</code></pre> <p>ndk-build \u9ed8\u8ba4\u4f1a\u7981\u7528 C++ \u7684\u5f02\u5e38\u673a\u5236\uff0c\u56e0\u6b64\u65e0\u9700\u7279\u610f\u7981\u7528\uff08\u5982\u679c\u73b0\u6709\u9879\u76ee\u5f00\u542f\u4e86 C++ \u7684\u5f02\u5e38\u673a\u5236\uff0c\u8bf4\u660e\u786e\u6709\u9700\u8981\uff0c\u9700\u4ed4\u7ec6\u786e\u8ba4\u540e\u624d\u80fd\u7981\u7528\uff09\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#c-rtti","title":"\u7981\u7528 C++ \u7684 RTTI \u673a\u5236","text":"<p>\u5982\u679c\u9879\u76ee\u4e2d\u6ca1\u6709\u4f7f\u7528 C++ \u7684 RTTI \u673a\u5236\uff08\u4f8b\u5982 typeid \u548c dynamic_cast \u7b49\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7\u7981\u7528 C++ \u7684 RTTI \uff0c\u6765\u51cf\u5c0f so \u7684\u4f53\u79ef\u3002</p> <p>CMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fno-rtti\")\n</code></pre> <p>ndk-build \u9ed8\u8ba4\u4f1a\u7981\u7528 C++ \u7684 RTTI \u673a\u5236\uff0c\u56e0\u6b64\u65e0\u9700\u7279\u610f\u7981\u7528\uff08\u5982\u679c\u73b0\u6709\u9879\u76ee\u5f00\u542f\u4e86 C++ \u7684 RTTI \u673a\u5236\uff0c\u8bf4\u660e\u786e\u6709\u9700\u8981\uff0c\u9700\u4ed4\u7ec6\u786e\u8ba4\u540e\u624d\u80fd\u7981\u7528\uff09\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#so","title":"\u5408\u5e76 so","text":"<p>\u4ee5\u4e0a\u90fd\u662f\u9488\u5bf9\u5355\u4e2a so \u7684\u4f18\u5316\u65b9\u6848\uff0c\u5bf9\u5355\u4e2a so \u8fdb\u884c\u4f18\u5316\u540e\uff0c\u8fd8\u53ef\u4ee5\u8003\u8651\u5bf9 so \u8fdb\u884c\u5408\u5e76\uff0c\u80fd\u591f\u8fdb\u4e00\u6b65\u51cf\u5c0f so \u7684\u4f53\u79ef\u3002\u5177\u4f53\u6765\u8bb2\uff0c\u5f53\u5b89\u88c5\u5305\u5185\u67d0\u4e9b so \u4ec5\u88ab\u53e6\u5916\u4e00\u4e2a so \u52a8\u6001\u4f9d\u8d56\u65f6\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e9b so \u5408\u5e76\u4e3a\u4e00\u4e2a so\u3002\u4f8b\u5982 liba.so \u548c libb.so \u4ec5\u88ab libx.so \u52a8\u6001\u4f9d\u8d56\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e09\u4e2a so \u5408\u5e76\u4e3a\u4e00\u4e2a\u65b0\u7684 libx.so\u3002\u5408\u5e76 so \u6709\u4ee5\u4e0b\u597d\u5904\uff1a</p> <ol> <li>\u53ef\u4ee5\u5220\u9664\u90e8\u5206\u52a8\u6001\u7b26\u53f7\u8868\u9879\uff0c\u51cf\u5c0f so \u603b\u4f53\u79ef\u3002\u5177\u4f53\u6765\u8bb2\uff0c\u5c31\u662f\u53ef\u4ee5\u5220\u9664 liba.so \u548c libb.so \u7684\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u7684\u6240\u6709\u5bfc\u51fa\u7b26\u53f7\uff0c\u4ee5\u53ca libx.so \u7684\u52a8\u6001\u7b26\u53f7\u8868\u4e2d\u4ece liba.so \u548c libb.so \u4e2d\u5bfc\u5165\u7684\u7b26\u53f7\u3002</li> <li>\u53ef\u4ee5\u5220\u9664\u90e8\u5206 PLT \u8868\u9879\u548c GOT \u8868\u9879\uff0c\u51cf\u5c0f so \u603b\u4f53\u79ef\u3002\u5177\u4f53\u6765\u8bb2\uff0c\u5c31\u662f\u53ef\u4ee5\u5220\u9664 libx.so \u4e2d\u4e0e liba.so\u3001libb.so \u76f8\u5173\u7684 PLT \u8868\u9879\u548c GOT \u8868\u9879\u3002</li> <li>\u53ef\u4ee5\u51cf\u8f7b\u4f18\u5316\u7684\u5de5\u4f5c\u91cf\u3002\u5982\u679c\u6ca1\u6709\u5408\u5e76 so\uff0c\u5bf9 liba.so \u548c libb.so \u505a\u4f53\u79ef\u4f18\u5316\u65f6\u9700\u8981\u786e\u5b9a libx.so \u4f9d\u8d56\u4e86\u5b83\u4eec\u7684\u54ea\u4e9b\u7b26\u53f7\uff0c\u624d\u80fd\u5bf9\u5b83\u4eec\u8fdb\u884c\u4f18\u5316\uff0c\u505a\u4e86 so \u5408\u5e76\u540e\u5c31\u4e0d\u9700\u8981\u4e86\u3002\u94fe\u63a5\u5668\u4f1a\u81ea\u52a8\u5206\u6790\u5f15\u7528\u5173\u7cfb\uff0c\u4fdd\u7559\u4f7f\u7528\u5230\u7684\u6240\u6709\u7b26\u53f7\u7684\u5bf9\u5e94\u5185\u5bb9\u3002</li> <li>\u7531\u4e8e\u94fe\u63a5\u5668\u5bf9\u539f liba.so \u548c libb.so \u7684\u5bfc\u51fa\u7b26\u53f7\u62e5\u6709\u4e86\u66f4\u5168\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0cLTO \u4f18\u5316\u4e5f\u80fd\u53d6\u5f97\u66f4\u597d\u7684\u6548\u679c\u3002</li> </ol> <p>\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u9879\u76ee\u6e90\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u7f16\u8bd1\u5c42\u9762\u5b9e\u73b0 so \u7684\u5408\u5e76\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#so_1","title":"\u63d0\u53d6\u591a so \u5171\u540c\u4f9d\u8d56\u5e93","text":"<p>\u4e0a\u9762\u201c\u5408\u5e76 so\u201d\u662f\u51cf\u5c0f so \u603b\u4e2a\u6570\uff0c\u800c\u8fd9\u91cc\u662f\u589e\u52a0 so \u603b\u4e2a\u6570\u3002\u5f53\u591a\u4e2a so \u4ee5\u9759\u6001\u65b9\u5f0f\u4f9d\u8d56\u4e86\u67d0\u4e2a\u76f8\u540c\u7684\u5e93\u65f6\uff0c\u53ef\u4ee5\u8003\u8651\u5c06\u6b64\u5e93\u63d0\u53d6\u6210\u4e00\u4e2a\u5355\u72ec\u7684 so\uff0c\u539f\u6765\u7684\u51e0\u4e2a so \u6539\u4e3a\u52a8\u6001\u4f9d\u8d56\u8be5 so\u3002\u4f8b\u5982 liba.so \u548c libb.so \u90fd\u9759\u6001\u4f9d\u8d56\u4e86 libx.a\uff0c\u53ef\u4ee5\u4f18\u5316\u4e3a liba.so \u548c libb.so \u5747\u52a8\u6001\u4f9d\u8d56 libx.so\u3002\u63d0\u53d6\u591a so \u5171\u540c\u4f9d\u8d56\u5e93\uff0c\u53ef\u4ee5\u5bf9\u4e0d\u540c so \u5185\u7684\u76f8\u540c\u4ee3\u7801\u8fdb\u884c\u5408\u5e76\uff0c\u4ece\u800c\u51cf\u5c0f\u603b\u7684 so \u4f53\u79ef\u3002</p> <p>\u8fd9\u91cc\u5178\u578b\u7684\u4f8b\u5b50\u662f libc++ \u5e93\uff1a\u5982\u679c\u5b58\u5728\u591a\u4e2a so \u90fd\u9759\u6001\u4f9d\u8d56 libc++ \u5e93\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u4f18\u5316\u4e3a\u8fd9\u4e9b so \u90fd\u52a8\u6001\u4f9d\u8d56\u4e8e <code>libc++_shared.so</code>\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#45","title":"4.5 \u6574\u5408\u540e\u7684\u901a\u7528\u65b9\u6848","text":"<p>\u901a\u8fc7\u4e0a\u8ff0\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u6574\u5408\u51fa\u666e\u901a\u9879\u76ee\u5747\u53ef\u4f7f\u7528\u7684\u901a\u7528\u7684\u4f18\u5316\u65b9\u6848\uff0cCMake \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff08\u5982\u679c\u4f7f\u7528 GCC\uff0c\u5e94\u5c06 Oz \u6539\u4e3a Os\uff09\uff1a</p> <pre><code>set(CMAKE_C_FLAGS \"${CMAKE_C_FLAGS} -Oz -flto -fdata-sections -ffunction-sections\")\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Oz -flto -fdata-sections -ffunction-sections\")\nset(CMAKE_SHARED_LINKER_FLAGS \"${CMAKE_SHARED_LINKER_FLAGS} -O3 -flto  -Wl,--gc-sections -Wl,--version-script=${CMAKE_CURRENT_SOURCE_DIR}/version_script.txt\") #version_script.txt \u4e0e\u5f53\u524d CMakeLists.txt \u540c\u76ee\u5f55\n</code></pre> <p>ndk-build \u9879\u76ee\u7684\u914d\u7f6e\u65b9\u5f0f\uff08\u5982\u679c\u4f7f\u7528 GCC\uff0c\u5e94\u5c06 Oz \u6539\u4e3a Os\uff09\uff1a</p> <pre><code>LOCAL_CFLAGS += -Oz -flto -fdata-sections -ffunction-sections\nLOCAL_LDFLAGS += -O3 -flto -Wl,--gc-sections -Wl,--version-script=${LOCAL_PATH}/version_script.txt #version_script.txt \u4e0e\u5f53\u524d Android.mk \u540c\u76ee\u5f55\n</code></pre> <p>\u5176\u4e2d <code>version_script.txt</code> \u8f83\u4e3a\u901a\u7528\u7684\u914d\u7f6e\u5982\u4e0b\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6dfb\u52a0\u9700\u8981\u4fdd\u7559\u7684\u5bfc\u51fa\u7b26\u53f7\uff1a</p> <pre><code>{\n    global:JNI_OnLoad;JNI_OnUnload;Java_*;\n    local:*;\n};\n</code></pre> <p>\u8bf4\u660e\uff1aversion script \u65b9\u5f0f\u6307\u5b9a\u6240\u6709\u9700\u8981\u5bfc\u51fa\u7684\u7b26\u53f7\uff0c\u4e0d\u518d\u9700\u8981 visibility \u65b9\u5f0f\u3001attribute \u65b9\u5f0f\u3001static \u5173\u952e\u5b57\u548c exclude libs \u65b9\u5f0f\u63a7\u5236\u5bfc\u51fa\u7b26\u53f7\u3002\u662f\u5426\u7981\u7528 C++ \u7684\u5f02\u5e38\u673a\u5236\u548c RTTI \u673a\u5236\u3001\u5408\u5e76 so \u4ee5\u53ca\u63d0\u53d6\u591a so \u5171\u540c\u4f9d\u8d56\u5e93\u53d6\u51b3\u4e8e\u5177\u4f53\u9879\u76ee\uff0c\u4e0d\u5177\u6709\u901a\u7528\u6027\u3002</p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u603b\u7ed3\u51fa\u4e00\u5957\u53ef\u884c\u7684 so \u4f53\u79ef\u4f18\u5316\u65b9\u6848\u3002\u4f46\u5728\u5de5\u7a0b\u5b9e\u8df5\u4e2d\uff0c\u8fd8\u6709\u4e00\u4e9b\u95ee\u9898\u8981\u89e3\u51b3\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#5","title":"5. \u5de5\u7a0b\u5b9e\u8df5","text":""},{"location":"perf-opt/Android/size/Android-so-opt/#_1","title":"\u652f\u6301\u591a\u79cd\u6784\u5efa\u5de5\u5177","text":"<p>\u7f8e\u56e2\u6709\u4f17\u591a\u4e1a\u52a1\u4f7f\u7528\u4e86 so\uff0c\u6240\u4f7f\u7528\u7684\u6784\u5efa\u5de5\u5177\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0c\u9664\u4e86\u4e0a\u8ff0\u5e38\u89c1\u7684 CMake \u548c ndk-build\uff0c\u4e5f\u6709\u9879\u76ee\u5728\u4f7f\u7528 Make\u3001Automake\u3001Ninja\u3001GYP \u548c GN \u7b49\u5404\u79cd\u6784\u5efa\u5de5\u5177\u3002\u4e0d\u540c\u6784\u5efa\u5de5\u5177\u5e94\u7528 so \u4f18\u5316\u65b9\u6848\u7684\u65b9\u5f0f\u4e5f\u4e0d\u76f8\u540c\uff0c\u5c24\u5176\u5bf9\u5927\u578b\u5de5\u7a0b\u800c\u8a00\uff0c\u914d\u7f6e\u590d\u6742\u6027\u8f83\u9ad8\u3002</p> <p>\u57fa\u4e8e\u4ee5\u4e0a\u539f\u56e0\uff0c\u6bcf\u4e2a\u4e1a\u52a1\u81ea\u884c\u914d\u7f6e so \u4f18\u5316\u65b9\u6848\u4f1a\u6d88\u8017\u8f83\u591a\u7684\u4eba\u529b\u6210\u672c\uff0c\u5e76\u4e14\u6709\u914d\u7f6e\u65e0\u6548\u7684\u53ef\u80fd\u3002\u4e3a\u4e86\u964d\u4f4e\u914d\u7f6e\u6210\u672c\u3001\u52a0\u5feb\u4f18\u5316\u65b9\u6848\u7684\u63a8\u8fdb\u901f\u5ea6\u3001\u4fdd\u8bc1\u914d\u7f6e\u7684\u6709\u6548\u6027\u548c\u6b63\u786e\u6027\uff0c\u6211\u4eec\u5728\u6784\u5efa\u5e73\u53f0\u4e0a\u7edf\u4e00\u652f\u6301\u4e86 so \u7684\u4f18\u5316\uff08\u652f\u6301\u4f7f\u7528\u4efb\u610f\u6784\u5efa\u5de5\u5177\u7684\u9879\u76ee\uff09\u3002\u4e1a\u52a1\u53ea\u9700\u8fdb\u884c\u7b80\u5355\u7684\u914d\u7f6e\u5373\u53ef\u5f00\u542f so \u7684\u4f53\u79ef\u4f18\u5316\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#_2","title":"\u914d\u7f6e\u5bfc\u51fa\u7b26\u53f7\u7684\u6ce8\u610f\u4e8b\u9879","text":"<p>\u6ce8\u610f\u4e8b\u9879\u6709\u4ee5\u4e0b\u4e24\u70b9\uff1a</p> <ol> <li>\u5982\u679c\u4e00\u4e2a so \u7684\u67d0\u4e9b\u7b26\u53f7\uff0c\u88ab\u5176\u4ed6 so \u901a\u8fc7 dlsym \u65b9\u5f0f\u4f7f\u7528\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7b26\u53f7\u4e5f\u5e94\u8be5\u4fdd\u7559\u5728\u8be5 so \u7684\u5bfc\u51fa\u7b26\u53f7\u4e2d\uff08\u5426\u5219\u4f1a\u5bfc\u81f4\u8fd0\u884c\u65f6\u5f02\u5e38\uff09\u3002</li> <li>\u7f16\u5199 <code>version_script.txt</code> \u65f6\u9700\u8981\u6ce8\u610f C++ \u7b49\u8bed\u8a00\u5bf9\u7b26\u53f7\u7684\u4fee\u9970\uff0c\u4e0d\u80fd\u76f4\u63a5\u628a\u51fd\u6570\u540d\u586b\u5199\u8fdb\u53bb\u3002\u7b26\u53f7\u4fee\u9970\u5c31\u662f\u628a\u4e00\u4e2a\u51fd\u6570\u7684\u547d\u540d\u7a7a\u95f4\uff08\u5982\u679c\u6709\uff09\u3001\u7c7b\u540d\uff08\u5982\u679c\u6709\uff09\u3001\u53c2\u6570\u7c7b\u578b\u7b49\u90fd\u6dfb\u52a0\u5230\u6700\u7ec8\u7684\u7b26\u53f7\u4e2d\uff0c\u8fd9\u4e5f\u662f C++ \u8bed\u8a00\u5b9e\u73b0\u91cd\u8f7d\u7684\u57fa\u7840\u3002\u6709\u4e24\u79cd\u65b9\u5f0f\u53ef\u4ee5\u628a C++ \u7684\u51fd\u6570\u6dfb\u52a0\u5230\u5bfc\u51fa\u7b26\u53f7\u4e2d\uff1a\u7b2c\u4e00\u79cd\u662f\u67e5\u770b\u672a\u4f18\u5316 so \u7684\u5bfc\u51fa\u7b26\u53f7\u8868\uff0c\u627e\u5230\u76ee\u6807\u51fd\u6570\u88ab\u4fee\u9970\u540e\u7684\u7b26\u53f7\uff0c\u7136\u540e\u586b\u5199\u5230 <code>version_script.txt</code> \u4e2d\u3002\u4f8b\u5982\u6709\u4e00\u4e2a MyClass \u7c7b\uff1a</li> </ol> <pre><code>class MyClass{\nvoid start(int arg);\nvoid stop();\n};\n</code></pre> <p>\u8981\u786e\u5b9a start \u51fd\u6570\u771f\u6b63\u7684\u7b26\u53f7\u53ef\u4ee5\u5bf9\u672a\u4f18\u5316\u7684 libexample.so \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\u56e0\u4e3a C++ \u5bf9\u7b26\u53f7\u4fee\u9970\u540e\uff0c\u51fd\u6570\u540d\u662f\u7b26\u53f7\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7 grep \u52a0\u5feb\u67e5\u627e\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 start \u51fd\u6570\u771f\u6b63\u7684\u7b26\u53f7\u662f <code>_ZN7MyClass5startEi</code>\u3002\u5982\u679c\u60f3\u5bfc\u51fa\u8be5\u51fd\u6570\uff0c<code>version_script.txt</code> \u76f8\u5e94\u4f4d\u7f6e\u586b\u5165 <code>_ZN7MyClass5startEi</code> \u5373\u53ef\u3002</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u662f\u5728 <code>version_script.txt</code> \u4e2d\u4f7f\u7528 extern \u8bed\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>{\n    global:\n      extern \"C++\" {\n        MyClass::start*;\n        \"MyClass::stop()\";\n      };\n    local:*;\n};\n</code></pre> <p>\u4e0a\u8ff0\u914d\u7f6e\u53ef\u4ee5\u5bfc\u51fa MyClass \u7684 start \u548c stop \u51fd\u6570\u3002\u5176\u539f\u7406\u662f\uff0c\u94fe\u63a5\u65f6\u94fe\u63a5\u5668\u5bf9\u6bcf\u4e2a\u7b26\u53f7\u8fdb\u884c demangle\uff08\u89e3\u6784\uff0c\u5373\u628a\u4fee\u9970\u540e\u7684\u7b26\u53f7\u8fd8\u539f\u4e3a\u53ef\u8bfb\u7684\u8868\u793a\uff09\uff0c\u7136\u540e\u4e0e extern \u201cC++\u201d \u4e2d\u7684\u6761\u76ee\u8fdb\u884c\u5339\u914d\uff0c\u5982\u679c\u80fd\u4e0e\u4efb\u4e00\u6761\u76ee\u5339\u914d\u6210\u529f\u5c31\u4fdd\u7559\u8be5\u7b26\u53f7\u3002\u5339\u914d\u7684\u89c4\u5219\u662f\uff1a\u6709\u53cc\u5f15\u53f7\u7684\u6761\u76ee\u4e0d\u80fd\u4f7f\u7528\u901a\u914d\u7b26\uff0c\u9700\u8981\u5168\u5b57\u7b26\u4e32\u5b8c\u5168\u5339\u914d\u624d\u53ef\u4ee5\uff08\u4f8b\u5982 stop \u6761\u76ee\uff0c\u5982\u679c\u62ec\u53f7\u4e4b\u95f4\u591a\u4e00\u4e2a\u7a7a\u683c\u5c31\u4f1a\u5339\u914d\u5931\u8d25\uff09\u3002\u5bf9\u4e8e\u6ca1\u6709\u53cc\u5f15\u53f7\u7684\u6761\u76ee\u80fd\u591f\u4f7f\u7528\u901a\u914d\u7b26\uff08\u4f8b\u5982 start \u6761\u76ee\uff09\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#so_2","title":"\u67e5\u770b\u4f18\u5316\u540e so \u7684\u5bfc\u51fa\u7b26\u53f7","text":"<p>\u4e1a\u52a1\u5bf9 so \u8fdb\u884c\u4f18\u5316\u4e4b\u540e\uff0c\u9700\u8981\u67e5\u770b\u6700\u7ec8\u7684 so \u6587\u4ef6\u4e2d\u4fdd\u7559\u4e86\u54ea\u4e9b\u5bfc\u51fa\u7b26\u53f7\uff0c\u9a8c\u8bc1\u4f18\u5316\u6548\u679c\u662f\u5426\u7b26\u5408\u9884\u671f\u3002\u5728 Mac \u548c Linux \u4e0b\u5747\u53ef\u4f7f\u7528\u4e0b\u8ff0\u547d\u4ee4\u67e5\u770b so \u4fdd\u7559\u4e86\u54ea\u4e9b\u5bfc\u51fa\u7b26\u53f7\uff1a</p> <pre><code>nm -D --defined-only xxx.so\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u51fa\uff0clibexample.so \u7684\u5bfc\u51fa\u7b26\u53f7\u6709\u4e24\u4e2a\uff1a<code>JNI_OnLoad</code> \u548c <code>Java_com_example_MainActivity_stringFromJNI</code>\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#_3","title":"\u89e3\u6790\u5d29\u6e83\u5806\u6808","text":"<p>\u672c\u6587\u7684\u4f18\u5316\u65b9\u6848\u4f1a\u79fb\u9664\u975e\u5fc5\u8981\u5bfc\u51fa\u7684\u52a8\u6001\u7b26\u53f7\uff0c\u90a3 so \u5982\u679c\u53d1\u751f\u5d29\u6e83\u7684\u8bdd\u662f\u4e0d\u662f\u5c31\u65e0\u6cd5\u89e3\u6790\u5d29\u6e83\u5806\u6808\u4e86\u5462\uff1f\u7b54\u6848\u662f\u5b8c\u5168\u4e0d\u4f1a\u5f71\u54cd\u5d29\u6e83\u5806\u6808\u7684\u89e3\u6790\u7ed3\u679c\u3002</p> <p>\u201cso \u53ef\u4f18\u5316\u5185\u5bb9\u5206\u6790\u201d\u4e00\u8282\u5df2\u7ecf\u63d0\u8fc7\uff0c\u4f7f\u7528\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u89e3\u6790\u7ebf\u4e0a\u5d29\u6e83\uff0c\u662f\u5206\u6790 so \u5d29\u6e83\u7684\u6807\u51c6\u65b9\u5f0f\uff08\u8fd9\u4e5f\u662f Google \u89e3\u6790 so \u5d29\u6e83\u7684\u65b9\u5f0f\uff09\u3002\u672c\u6587\u7684\u4f18\u5316\u65b9\u6848\u5e76\u672a\u4fee\u6539\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u5bf9\u5d29\u6e83\u5806\u6808\u8fdb\u884c\u5b8c\u6574\u7684\u8fd8\u539f\uff0c\u89e3\u6790\u51fa\u5d29\u6e83\u5806\u6808\u6bcf\u4e2a\u6808\u5e27\u5bf9\u5e94\u7684\u6e90\u7801\u6587\u4ef6\u3001\u884c\u53f7\u548c\u51fd\u6570\u540d\u7b49\u4fe1\u606f\u3002\u4e1a\u52a1\u7f16\u8bd1\u51fa release \u7248\u7684 so \u540e\u5c06\u76f8\u5e94\u7684\u5e26\u8c03\u8bd5\u4fe1\u606f\u548c\u7b26\u53f7\u8868\u7684 so \u4e0a\u4f20\u5230 crash \u5e73\u53f0\u5373\u53ef\u3002</p>"},{"location":"perf-opt/Android/size/Android-so-opt/#6","title":"6. \u65b9\u6848\u6536\u76ca","text":"<p>\u4f18\u5316 so \u5bf9\u5b89\u88c5\u5305\u4f53\u79ef\u548c\u5b89\u88c5\u540e\u5360\u7528\u7684\u672c\u5730\u5b58\u50a8\u7a7a\u95f4\u6709\u76f4\u63a5\u6536\u76ca\uff0c\u6536\u76ca\u5927\u5c0f\u53d6\u51b3\u4e8e\u539f so \u5197\u4f59\u4ee3\u7801\u6570\u91cf\u548c\u5bfc\u51fa\u7b26\u53f7\u6570\u91cf\u7b49\u5177\u4f53\u60c5\u51b5\uff0c\u4e0b\u9762\u662f\u90e8\u5206 so \u4f18\u5316\u524d\u540e\u5360\u7528\u5b89\u88c5\u5305\u4f53\u79ef\u7684\u5bf9\u6bd4\uff1a</p> so \u4f18\u5316\u524d\u5927\u5c0f \u4f18\u5316\u540e\u5927\u5c0f \u4f18\u5316\u767e\u5206\u6bd4 A \u5e93 4.49 MB 3.28 MB 27.02% B \u5e93 995.82 KB 728.38 KB 26.86% C \u5e93 312.05 KB 153.81 KB 50.71% D \u5e93 505.57 KB 321.75 KB 36.36% E \u5e93 309.89 KB 157.08 KB 49.31% F \u5e93 88.59 KB 62.93 KB 28.97% <p>\u4e0b\u9762\u662f\u4e0a\u8ff0 so \u4f18\u5316\u524d\u540e\u5360\u7528\u672c\u5730\u5b58\u50a8\u7a7a\u95f4\u7684\u5bf9\u6bd4\uff1a</p> so \u4f18\u5316\u524d\u5927\u5c0f \u4f18\u5316\u540e\u5927\u5c0f \u4f18\u5316\u767e\u5206\u6bd4 A \u5e93 10.67 MB 7.04 MB 34.05% B \u5e93 2.35 MB 1.61 MB 31.46% C \u5e93 898.14 KB 386.31 KB 56.99% D \u5e93 1.30 MB 771.47 KB 41.88% E \u5e93 890.13 KB 398.30 KB 55.25% F \u5e93 230.30 KB 146.06 KB 36.58%"},{"location":"perf-opt/Android/size/Android-so-opt/#7","title":"7. \u603b\u7ed3\u4e0e\u540e\u7eed\u8ba1\u5212","text":"<p>\u5bf9 so \u4f53\u79ef\u8fdb\u884c\u4f18\u5316\u4e0d\u4ec5\u80fd\u591f\u51cf\u5c0f\u5b89\u88c5\u5305\u4f53\u79ef\uff0c\u800c\u4e14\u80fd\u83b7\u5f97\u4ee5\u4e0b\u6536\u76ca\uff1a</p> <ul> <li>\u5220\u9664\u4e86\u5927\u91cf\u7684\u975e\u5fc5\u8981\u5bfc\u51fa\u7b26\u53f7\u4ece\u800c\u63d0\u5347\u4e86 so \u7684\u5b89\u5168\u6027\u3002</li> <li>\u56e0\u4e3a <code>.data</code> <code>.bss</code> <code>.text</code> \u7b49\u8fd0\u884c\u65f6\u5360\u7528\u5185\u5b58\u7684 section \u51cf\u5c0f\u4e86\uff0c\u6240\u4ee5\u4e5f\u80fd\u51cf\u5c0f\u5e94\u7528\u8fd0\u884c\u65f6\u7684\u5185\u5b58\u5360\u7528\u3002</li> <li>\u5982\u679c\u4f18\u5316\u8fc7\u7a0b\u4e2d\u51cf\u5c11\u4e86 so \u5bf9\u5916\u4f9d\u8d56\u7684\u7b26\u53f7\uff0c\u8fd8\u53ef\u4ee5\u52a0\u5feb so \u7684\u52a0\u8f7d\u901f\u5ea6\u3002</li> </ul> <p>\u6211\u4eec\u5bf9\u540e\u7eed\u5de5\u4f5c\u505a\u4e86\u5982\u4e0b\u7684\u89c4\u5212\uff1a</p> <ul> <li>\u63d0\u5347\u7f16\u8bd1\u901f\u5ea6\u3002\u56e0\u4e3a\u4f7f\u7528 LTO\u3001gc sections \u7b49\u4f1a\u589e\u52a0\u7f16\u8bd1\u8017\u65f6\uff0c\u8ba1\u5212\u8c03\u7814 ThinLTO \u7b49\u65b9\u6848\u5bf9\u7f16\u8bd1\u901f\u5ea6\u8fdb\u884c\u4f18\u5316\u3002</li> <li>\u8be6\u7ec6\u5c55\u793a\u4fdd\u7559\u5404\u4e2a\u51fd\u6570/\u6570\u636e\u7684\u539f\u56e0\u3002</li> <li>\u8fdb\u4e00\u6b65\u5b8c\u5584\u5e73\u53f0\u4f18\u5316 so \u7684\u80fd\u529b\u3002</li> </ul>"},{"location":"perf-opt/Android/size/Android-so-opt/#8","title":"8. \u53c2\u8003\u8d44\u6599","text":"<p>\u6458\u81eahttps://tech.meituan.com/2022/06/02/meituans-technical-exploration-and-practice-of-android-so-volume-optimization.html</p>"},{"location":"perf-opt/Android/size/douyin/","title":"\u6296\u97f3 Android \u5305\u4f53\u79ef\u4f18\u5316\u63a2\u7d22\uff1a\u4ece Class \u5b57\u8282\u7801\u5165\u624b\u7cbe\u7b80 DEX \u4f53\u79ef","text":""},{"location":"perf-opt/Android/size/douyin/#_1","title":"\u524d\u8a00","text":"<p>\u4f17\u6240\u5468\u77e5\uff0c\u5e94\u7528\u5b89\u88c5\u5305\u7684\u4f53\u79ef\u4f1a\u5341\u5206\u5f71\u54cd\u7528\u6237\u7684\u5e94\u7528\u4e0b\u8f7d\u901f\u5ea6\u548c\u5b89\u88c5\u901f\u5ea6\u3002\u636e GooglePlay \u5e73\u53f0\u5bf9\u5916\u53d1\u5e03\u76f8\u5173\u7684\u5305\u5927\u5c0f\u5bf9\u8f6c\u5316\u7387\u5f71\u54cd\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u968f\u7740\u5305\u5927\u5c0f\u7684\u589e\u52a0\uff0c\u5b89\u88c5\u8f6c\u5316\u7387\u603b\u4f53\u5448\u4e0b\u964d\u7684\u8d8b\u52bf\u3002</p> <p></p> <p>\u56e0\u6b64\u5bf9\u4e8e\u6211\u4eec\u7684\u5e94\u7528\u6765\u8bf4\uff0c\u4e3a\u4e86\u63d0\u5347\u6211\u4eec\u7528\u6237\u4e0b\u8f7d\u7684\u8f6c\u5316\u7387\uff08\u5373\u4e0b\u8f7d\u5b89\u88c5\u6fc0\u6d3b\u7528\u6237\u4e0e\u6f5c\u5728\u7528\u6237\u7684\u6bd4\u4f8b\uff09\uff0c\u6211\u4eec\u5bf9\u5305\u4f53\u79ef\u5fc5\u987b\u7ed9\u4e88\u4e00\u5b9a\u7684\u4f18\u5316\u548c\u7ba1\u63a7\u3002</p> <p>\u6211\u4eec\u5e94\u7528\u5546\u5e97\u4e2d\u63d0\u4f9b\u7ed9\u7528\u6237\u4e0b\u8f7d\u7684\u5b89\u88c5\u5305\uff0c\u662f Android \u5b9a\u4e49\u7684 APK \u683c\u5f0f\uff0c\u5176\u5b9e\u8d28\u5219\u662f\u4e00\u4e2a\u5305\u542b\u5e94\u7528\u6240\u6709\u6240\u9700\u8d44\u6e90\u7684 zip \u5305\uff0c\u5b83\u5305\u542b\u4e86\u5982\u4e0b\u6240\u793a\u7684\u51e0\u4e2a\u7ec4\u6210\u90e8\u5206\uff1a</p> <p></p> <p>\u8fd9\u5176\u4e2d\u6700\u4e3b\u8981\u7684\u7ec4\u6210\u90e8\u5206\u4fbf\u662f DEX \u6587\u4ef6\uff0c\u5b83\u4eec\u90fd\u662f\u7531 Java/Kotlin \u4ee3\u7801\u7f16\u8bd1\u800c\u6210\u3002\u8fc7\u53bb\u7684\u4e24\u5e74\u4e2d\uff0c\u6296\u97f3\u7684 DEX \u7684\u4e2a\u6570\u4ece 8 \u4e2a\u6da8\u5230\u4e86 21 \u4e2a\uff0cDEX \u7684\u603b\u5927\u5c0f\u4ece 26M \u6da8\u5230\u4e86 48M\uff0c\u589e\u957f\u5341\u5206\u8fc5\u731b\u3002\u8bda\u7136\uff0c\u968f\u7740\u6296\u97f3\u7684\u5feb\u901f\u53d1\u5c55\uff0c\u4e1a\u52a1\u590d\u6742\u5ea6\u7684\u63d0\u9ad8\uff0c\u4ee3\u7801\u91cf\u7ea7\u4e00\u5b9a\u662f\u5728\u589e\u52a0\u7684\uff0c\u4f46\u5982\u4f55\u5728\u4e1a\u52a1\u65e0\u611f\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4ee3\u7801\u8fdb\u884c\u901a\u7528\u4f18\u5316\uff0c\u4e5f\u662f\u6211\u4eec\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4f18\u5316\u65b9\u5411\u3002</p> <p>\u5728\u4ecb\u7ecd\u5177\u4f53\u4f18\u5316\u624b\u6bb5\u4e4b\u524d\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u4e86\u89e3\u4e0b\u9488\u5bf9 DEX \u6574\u4f53\u4e0a\u7684\u4f18\u5316\u601d\u8def\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#dex","title":"DEX \u901a\u7528\u4f18\u5316\u601d\u8def","text":"<p>\u5728 AGP \u7684\u6784\u5efa\u8fc7\u7a0b\u4e2d\uff0cJava \u6216 Kotlin \u6e90\u4ee3\u7801\u5728\u7ecf\u8fc7\u7f16\u8bd1\u4e4b\u540e\u4f1a\u751f\u6210 Class \u5b57\u8282\u7801\u6587\u4ef6\uff0c\u5728\u8fd9\u4e2a\u9636\u6bb5 AGP \u63d0\u4f9b\u4e86 Transform \u6765\u505a\u5b57\u8282\u7801\u7684\u5904\u7406\uff0c\u6211\u4eec\u975e\u5e38\u719f\u6089\u7684 Proguard \u5c31\u662f\u5728\u8fd9\u4e2a\u9636\u6bb5\u5de5\u4f5c\u7684\uff0c\u4e4b\u540e Class \u6587\u4ef6\u7ecf\u7531 dexBuilder \u751f\u6210\u4e00\u5806\u8f83\u5c0f\u7684 DEX \u6587\u4ef6\uff0c\u518d\u7ecf\u7531 mergeDex \u5408\u5e76\u6210\u6700\u7ec8\u7684 DEX \u6587\u4ef6\uff0c\u7136\u540e\u6253\u5165 APK \u4e2d\u3002\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u9488\u5bf9 DEX \u6587\u4ef6\u7684\u4f18\u5316\u65f6\u673a\u53ef\u4ee5\u4ece\u5206\u522b\u4ece\u4e09\u4e2a\u9636\u6bb5\u5207\u5165\uff0c\u5206\u522b\u662f.kt \u6216.java \u6e90\u6587\u4ef6\u3001class \u6587\u4ef6\u3001DEX \u6587\u4ef6\uff1a</p> <ul> <li>\u5728\u6e90\u6587\u4ef6\u8fdb\u884c\u5904\u7406\u4e5f\u5c31\u662f\u624b\u52a8\u6539\u9020\u4ee3\u7801\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5bf9\u7a0b\u5e8f\u8bbe\u8ba1\u672c\u8eab\u6709\u4fb5\u5165\uff0c\u5e76\u4e14\u6709\u8f83\u5f3a\u7684\u5c40\u9650\u6027\uff1b</li> <li>\u5728 class \u5b57\u8282\u7801\u9636\u6bb5\u5bf9\u5f00\u53d1\u8005\u65e0\u611f\u77e5\uff0c\u800c\u4e14\u57fa\u672c\u4e0a\u80fd\u5b8c\u6210\u5927\u591a\u6570\u7684\u4f18\u5316\uff0c\u4f46\u5bf9\u4e8e\u50cf\u8de8 DEX \u5f15\u7528\u4f18\u5316\u8fd9\u6837\u6d89\u53ca DEX \u683c\u5f0f\u672c\u8eab\u7684\u4f18\u5316\u65e0\u6cd5\u5b8c\u6210\uff1b</li> <li>\u5728 DEX \u6587\u4ef6\u9636\u6bb5\u8fdb\u884c\u4f18\u5316\u662f\u6700\u7406\u60f3\u7684\uff0c\u5728\u8fd9\u4e2a\u9636\u6bb5\u6211\u4eec\u9664\u4e86\u80fd\u5bf9 DEX \u5b57\u8282\u7801\u672c\u8eab\u8fdb\u884c\u4f18\u5316\uff0c\u4e5f\u53ef\u5bf9 DEX \u6587\u4ef6\u683c\u5f0f\u8fdb\u884c\u64cd\u4f5c\u3002</li> </ul> <p>\u4f18\u5316\u7684\u624b\u6bb5\u603b\u4f53\u4e0a\u6765\u8bf4\u4e5f\u5c31\u662f\u5197\u4f59\u53bb\u9664\u3001\u5185\u5bb9\u7cbe\u7b80\u3001\u683c\u5f0f\u4f18\u5316\u7b49\u65b9\u5f0f\u3002</p> <p>\u7531\u4e8e\u65e9\u671f\u6296\u97f3 class \u5b57\u8282\u7801\u4fee\u6539\u5de5\u5177\u5efa\u8bbe\u6bd4\u8f83\u6210\u719f\uff0c\u6211\u4eec\u5f88\u591a\u5305\u4f53\u79ef\u7684\u4f18\u5316\u90fd\u662f\u901a\u8fc7\u4fee\u6539 class \u5b57\u8282\u7801\u5b8c\u6210\u7684\uff0c\u968f\u7740\u4f18\u5316\u7684\u6df1\u5165\uff0c\u540e\u671f\u4e5f\u6709\u5f88\u591a\u4f18\u5316\u662f\u5728 DEX \u6587\u4ef6\u9636\u6bb5\u5904\u7406\u7684\u3002\u5173\u4e8e DEX \u9636\u6bb5\u76f8\u5173\u7684\u4f18\u5316\u6211\u4eec\u540e\u7eed\u4f1a\u6709\u76f8\u5173\u6587\u7ae0\u4ecb\u7ecd\uff0c\u8fd9\u91cc\u4e3b\u8981\u4ecb\u7ecd Class \u5b57\u8282\u7801\u9636\u6bb5\u8fdb\u884c\u7684\u76f8\u5173\u4f18\u5316\uff0c\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a</p> <ul> <li>\u5355\u7eaf\u53bb\u9664\u65e0\u7528\u7684\u4ee3\u7801\u6307\u4ee4\uff0c\u5305\u62ec \u53bb\u9664\u5197\u4f59\u8d4b\u503c\uff0c\u65e0\u526f\u4f5c\u7528\u4ee3\u7801\u5220\u9664 \u7b49</li> <li>\u9664\u4e86\u80fd\u51cf\u5c11\u4ee3\u7801\u6307\u4ee4\u6570\u91cf\u5916\uff0c\u540c\u65f6\u51cf\u5c11\u65b9\u6cd5\u548c\u5b57\u6bb5\u7684\u6570\u91cf\uff0c\u4ece\u800c\u6709\u6548\u51cf\u5c11 DEX \u7684\u6570\u91cf\u3002\u6211\u4eec\u77e5\u9053 DEX \u4e2d\u5f15\u7528\u65b9\u6cd5\u6570\u3001\u5f15\u7528\u5b57\u6bb5\u6570\u7b49\u4e0d\u80fd\u8d85\u8fc7 65535\uff0c\u8d85\u8fc7\u4e4b\u540e\u5c31\u9700\u8981\u65b0\u5f00\u4e00\u4e2a DEX \u6587\u4ef6\uff0c\u56e0\u6b64\u51cf\u5c11 DEX \u4e2d\u65b9\u6cd5\u6570\u3001\u5b57\u6bb5\u6570\u53ef\u4ee5\u51cf\u5c11 DEX \u6587\u4ef6\u6570\u91cf\uff0c\u50cf \u77ed\u65b9\u6cd5\u5185\u8054\u3001\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664\u3001R \u5e38\u91cf\u5185\u8054 \u5c31\u5c5e\u4e8e\u8fd9\u7c7b\u4f18\u5316\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u4f1a\u9488\u5bf9\u6bcf\u4e00\u9879\u4f18\u5316\u7684\u80cc\u666f\u3001\u4f18\u5316\u601d\u8def\u548c\u6536\u76ca\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_2","title":"\u53bb\u9664\u5197\u4f59\u8d4b\u503c","text":"<p>\u5728\u6211\u4eec\u5e73\u65f6\u7684\u4ee3\u7801\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u5199\u51fa\u4ee5\u4e0b\u7684\u4ee3\u7801\uff1a</p> <pre><code>class MyClass {\nprivate boolean aBoolean = false;\nprivate static boolean aBooleanStatic = false;\nprivate void boo() {\nif (!aBoolean) {\nSystem.out.println(\"in aBoolean false!\");\n}\nif (!aBooleanStatic) {\nSystem.out.println(\"in aBooleanStatic false!\");\n}\n}\n}\n</code></pre> <p>\u6211\u4eec\u5e38\u5e38\u4e3a\u4e86\u4fdd\u8bc1\u4e00\u4e2a Class \u7684\u6210\u5458\u53d8\u91cf\u7684\u521d\u59cb\u6ee1\u8db3\u6211\u4eec\u671f\u671b\u7684\u503c\uff0c\u624b\u52a8\u5bf9\u5176\u8fdb\u884c\u4e00\u6b21\u8d4b\u503c\uff0c\u5982\u4e0a\u8ff0\u4ee3\u7801\u91cc\u7684 aBoolean \u548c aBooleanStatic\u3002\u8fd9\u662f\u4e00\u79cd\u903b\u8f91\u4e0a\u975e\u5e38\u5b89\u5168\u7684\u505a\u6cd5\uff0c\u4f46\u8fd9\u771f\u662f\u5fc5\u987b\u7684\u5417\uff1f</p> <p>\u5176\u5b9e Java \u5b98\u65b9\u5728\u865a\u62df\u673a\u89c4\u8303\uff08docs.oracle.com/javase/spec\u2026 \uff09 \u4e2d\u5b9a\u4e49\u4e86\uff0cClass\u5bf9\u8c61\u5728\u865a\u62df\u673a\u4e2d\u52a0\u8f7d\u65f6\uff0c\u6240\u6709\u7684\u9759\u6001\u5b57\u6bb5\uff08\u4e5f\u5c31\u662f\u9759\u6001\u6210\u5458\u53d8\u91cf\uff0c\u4e0b\u9762\u7edf\u79f0\u4e3aField\uff09\u90fd\u4f1a\u9996\u5148\u52a0\u8f7d\u4e00\u4e2a\u9ed8\u8ba4\u503c\u3002</p> <p>2.3. Primitive Types and Values</p> <p>...</p> <p>The integral types are:</p> <ul> <li><code>byte</code>, whose values are 8-bit signed two's-complement integers, and whose default value is zero</li> <li><code>short</code>... whose default value is zero</li> <li><code>int</code>... whose default value is zero</li> <li><code>long</code>... whose default value is zero</li> <li><code>char</code>... whose default value is the null code point (<code>'\\u0000'</code>)</li> </ul> <p>The floating-point types are:</p> <ul> <li><code>float</code>... whose default value is positive zero</li> <li><code>double</code>... whose default value is positive zero</li> </ul> <p>2.4. Reference Types and Values</p> <p>...The <code>null</code> reference initially has no run-time type, but may be cast to any type. The default value of a <code>reference</code> type is <code>null</code>.</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u5728 Java \u4e2d\u7684\u57fa\u672c\u7c7b\u578b\u548c\u5f15\u7528\u7c7b\u578b\u7684 Field \u90fd\u4f1a\u5728 Class \u88ab\u52a0\u8f7d\u7684\u540c\u65f6\u8d4b\u4e88\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff0c<code>byte</code>\u3001<code>short</code>\u3001<code>int</code>\u3001<code>long</code>\u3001<code>float</code>\u3001<code>double</code>\u7c7b\u578b\u90fd\u4f1a\u88ab\u8d4b\u4e3a 0\uff0c char \u7c7b\u578b\u4f1a\u88ab\u8d4b\u4e3a<code>'\\u0000'</code>\uff0c\u5f15\u7528\u7c7b\u578b\u4f1a\u88ab\u8d4b\u4e3a null\u3002</p> <p>\u6211\u4eec\u5c06\u5f00\u5934\u90a3\u6bb5\u4ee3\u7801\u901a\u8fc7\u547d\u4ee4\u884c<code>java -p -v</code>\u8f6c\u5316\u4e3a\u5b57\u8282\u7801\uff1a</p> <pre><code>public com.bytedance.android.dexoptimizer.MyClass();\nCode:\n0: aload_0\n1: invokespecial #1                  // Method java/lang/Object.\"&lt;init&gt;\":()V\n4: aload_0\n5: iconst_0\n6: putfield      #2                  // Field aBoolean:Z\n9: return\nstatic {};\nCode:\n0: iconst_0\n1: putstatic     #6                  // Field aBooleanStatic:Z\n4: return\nprivate void boo();\nCode:\n0: aload_0\n1: getfield      #2                  // Field aBoolean:Z\n4: ifne          15\n7: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;\n10: ldc           #5                  // String in aBoolean false!\n12: invokevirtual #6                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n15: aload_0\n16: getfield      #3                  // Field aBooleanStatic:Z\n19: ifne          30\n22: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;\n25: ldc           #7                  // String in aBooleanStatic false!\n27: invokevirtual #6                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n30: return\n</code></pre> <p>\u901a\u8fc7\u4e0a\u8ff0\u5b57\u8282\u7801\u53d1\u73b0\uff0c\u867d\u7136 JVM \u4f1a\u5728\u8fd0\u884c\u65f6\u5c06 aBoolean \u8d4b\u503c\u4e3a 0\uff0c\u4f46\u662f\u6211\u4eec\u5728\u5b57\u8282\u7801\u4e2d\u4ecd\u7136\u4f1a\u518d\u8d4b\u503c\u4e00\u6b21 0 \u7ed9\u5230 aBoolean\uff0caBooleanStatic \u540c\u7406\u3002</p> <pre><code>public com.bytedance.android.dexoptimizer.MyClass();\nCode:\n0: aload_0\n1: invokespecial #1                  // Method java/lang/Object.\"&lt;init&gt;\":()V\n4: aload_0\n5: iconst_0\n6: putfield      #2                  // Field aBoolean:Z\n9: return\n</code></pre> <p>\u4ee5\u4e0a\u6807\u7ea2\u90e8\u5206\u51fa\u73b0\u4e86\u91cd\u590d\u8d4b\u503c\uff0c\u53bb\u9664\u4e86\u4e0d\u5f71\u54cd\u8fd0\u884c\u65f6\u903b\u8f91\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u8003\u8651\u5728 Class \u5b57\u8282\u7801\u5904\u7406\u9636\u6bb5\uff0c\u5c06\u8fd9\u79cd\u5197\u4f59\u7684\u5b57\u8282\u7801\u79fb\u9664\u6765\u83b7\u53d6\u5305\u5927\u5c0f\u6536\u76ca\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_3","title":"\u4f18\u5316\u601d\u8def","text":"<p>\u7406\u89e3\u4e86\u95ee\u9898\u4ea7\u751f\u7684\u539f\u56e0\u540e\uff0c\u5c31\u5f88\u5bb9\u6613\u5f97\u5230\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6848\u3002\u9996\u5148\uff0c\u80fd\u591f\u88ab\u4f18\u5316\u7684 Field \u8d4b\u503c\uff0c\u9700\u8981\u6ee1\u8db3\u8fd9\u4e09\u4e2a\u6761\u4ef6\uff1a</p> <ol> <li>Field \u662f\u5c5e\u4e8e\u5176\u76f4\u63a5\u5b9a\u4e49\u7684 Class \u7684\uff0c\u800c\u975e\u5728\u7236\u7c7b\u5b9a\u4e49\u8fc7\u7684\uff1b</li> <li>Field \u8d4b\u503c\u662f\u5728 Class \u7684<code>clinit</code>\u3001<code>init</code>\u65b9\u6cd5\u4e2d\uff0c\u8fd9\u6837\u505a\u5f88\u5927\u7a0b\u5ea6\u662f\u4e3a\u4e86\u964d\u4f4e\u590d\u6742\u5ea6\uff08\u56e0\u4e3a\u53ea\u5728\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u4e2d\u8c03\u7528\u7684 private \u65b9\u6cd5\u4e5f\u662f\u80fd\u505a\u8fd9\u6837\u7684\u4f18\u5316\uff0c\u4f46\u5206\u6790\u8fd9\u6837\u7684\u65b9\u6cd5\u590d\u6742\u5ea6\u5f88\u9ad8\uff09\uff1b</li> <li>Field \u8d4b\u503c\u662f\u9ed8\u8ba4\u503c\uff0c\u5f53\u51fa\u73b0\u591a\u4e2a\u8d4b\u503c\u65f6\uff0c\u5728\u975e\u9ed8\u8ba4\u8d4b\u503c\u540e\u7684\u8d4b\u503c\u90fd\u65e0\u6cd5\u88ab\u4f18\u5316\u3002</li> </ol> <p>\u6211\u4eec\u7ed3\u5408\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u5177\u4f53\u8bf4\u660e\u4e00\u4e0b\u5404\u79cd\u60c5\u51b5\u662f\u5426\u53ef\u4ee5\u88ab\u4f18\u5316\uff1a</p> <pre><code>Class MyClass {\n// \u53ef\u4ee5\u4f18\u5316\uff0c\u76f4\u63a5\u5b9a\u4e49\u7684\uff0c\u4e14\u662f\u9ed8\u8ba4\u503c\nprivate boolean aBoolean = false;\n// \u4e0d\u53ef\u4f18\u5316\uff0c\u56e0\u4e3a\u8d4b\u503c\u4e3a\u975e\u9ed8\u8ba4\u503c\nprivate boolean bBoolean = true;\n// \u53ef\u4ee5\u4f18\u5316\uff0c\u76f4\u63a5\u5b9a\u4e49\u7684\uff0c\u4e14\u662f\u9ed8\u8ba4\u503c\nprivate static boolean aBooleanStatic = false;\nstatic {\n// \u53ef\u4ee5\u4f18\u5316\uff0c\u7b2c\u4e00\u5904\u51fa\u73b0\uff0c\u4e14\u662f\u9ed8\u8ba4\u503c\naBooleanStatic = false;\n// \u5176\u4ed6\u4ee3\u7801\n...\n// \u53ef\u4ee5\u4f18\u5316\uff0c\u524d\u9762\u6ca1\u6709\u975e\u9ed8\u8ba4\u503c\u8d4b\u503c\uff0c\u4e14\u662f\u9ed8\u8ba4\u503c\naBooleanStatic = false;\n// \u5176\u4ed6\u4ee3\u7801\n...\n// \u4e0d\u53ef\u4f18\u5316\uff0c\u56e0\u4e3a\u8d4b\u503c\u4e3a\u975e\u9ed8\u8ba4\u503c\naBooleanStatic = true;\n// \u5176\u4ed6\u4ee3\u7801\n...\n// \u4e0d\u53ef\u4f18\u5316\uff0c\u56e0\u4e3a\u4e4b\u524d\u51fa\u73b0\u4e86\u975e\u9ed8\u8ba4\u503c\u7684\u8d4b\u503c\naBooleanStatic = false;\n}\nprivate void boo() {\n// \u4e0d\u53ef\u4f18\u5316\uff0c\u56e0\u4e3a\u51fd\u6570\u4e3a\u975eclinit\u6216init\naBoolean = false;\n}\n}\n</code></pre> <p>\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u6211\u4eec\u7684\u4f18\u5316\u601d\u8def\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li> <p>\u904d\u5386 Class \u6240\u6709\u65b9\u6cd5\uff0c\u627e\u5230<code>&lt;clinit&gt;</code>\u548c<code>&lt;init&gt;</code>\u65b9\u6cd5\uff0c\u4ece\u4e0a\u5f80\u4e0b\u8fdb\u884c\u5b57\u8282\u7801\u6307\u4ee4\u904d\u5386</p> </li> <li> <p>\u904d\u5386\u8fd9\u4e24\u79cd\u65b9\u6cd5\u7684\u6240\u6709\u5b57\u8282\u7801\u6307\u4ee4\uff0c\u627e\u5230\u6240\u6709\u7684 putfield \u6307\u4ee4\uff0c\u5c06 putfield \u6307\u4ee4\u7684\u76ee\u6807 ClassName \u548c FieldName \u4f7f\u7528<code>-</code> \u8fde\u63a5\uff0c\u6784\u5efa\u4e00\u4e2a\u552f\u4e00\u7684 Key\uff0c\u5982\u679c</p> </li> <li>putfield \u76ee\u6807 Class \u4e0d\u662f\u5f53\u524d Class\uff0c\u8df3\u8fc7</li> <li>putfield \u524d\u7684 load \u6307\u4ee4\u4e0d\u4e3a<code>iconst_0</code>\uff0c<code>fconst_0</code>\uff0c<code>dconst_0</code>\uff0c<code>lconst_0</code>\uff0c<code>aconst_null</code>\uff0c\u5e76\u5c06\u8be5 putfield \u6240\u5173\u8054\u7684\u552f\u4e00\u7684 Key \u653e\u5165\u5df2\u7ecf\u904d\u5386\u8fc7\u7684 Key \u7684\u96c6\u5408\u4e2d</li> <li> <p>putfield \u524d\u7684 load \u6307\u4ee4\u4e3a<code>iconst_0</code>\uff0c<code>fconst_0</code>\uff0c<code>dconst_0</code>\uff0c<code>lconst_0</code>\uff0c<code>aconst_null</code>\uff0c\u4e14\u8be5 putfield \u6240\u5173\u8054\u7684\u552f\u4e00\u7684 Key \u6ca1\u6709\u5728\u904d\u5386\u8fc7\u7684 Key \u7684\u96c6\u5408\u51fa\u73b0\u8fc7\uff0c\u5219\u6807\u8bb0\u4e3a\u53ef\u6e05\u9664\u7684\u5b57\u8282\u7801\u6307\u4ee4</p> </li> <li> <p>\u904d\u5386\u5b8c\u6210\u540e\uff0c\u5220\u9664\u6240\u6709\u88ab\u6807\u8bb0\u4e3a\u53ef\u6e05\u9664\u7684\u5b57\u8282\u7801\u6307\u4ee4</p> </li> </ul> <p>\u6211\u4eec\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u4e0b\u6211\u4eec\u7684\u601d\u8def\uff1a</p> <pre><code>public com.bytedance.android.dexoptimizer.MyClass();  // 1. \u5224\u65ad\u662f&lt;init&gt;\u65b9\u6cd5\uff0c\u8fdb\u5165\u4f18\u5316\u903b\u8f91\nCode: // 2. \u4ece\u4e0a\u5f80\u4e0b\u8fdb\u884c\u4ee3\u7801\u904d\u5386\n0: aload_0\n1: invokespecial #Method java/lang/Object.\"&lt;init&gt;\":()V\n4: aload_0\n5: iconst_0\n6: putfield      #Field MyClass.aBoolean:Z. // 3.\u53d1\u73b0\u662f\u8be5Class\u7684\u57df\uff0c\u4e14\u8d4b\u503c\u4e3aiconst_0\uff0c\u6807\u8bb0\u5f80\u4e0a\u4e09\u4e2a\u6307\u4ee4\u53ef\u4ee5\u5220\u9664\n7: aload_0\n8: iconst_1\n9: putfield      #Field MyClass.aBoolean:Z  // 4.\u53d1\u73b0\u662f\u8be5Class\u7684\u57df\uff0c\u4e14\u8d4b\u503c\u4e0d\u4e3aiconst_0\uff0c\u5219\u5728\u904d\u5386\u8fc7\u7684Key\u7684\u96c6\u5408\u4e2d\u6dfb\u52a0MyClass-aBoolean\uff0c\u7ee7\u7eed\u5f80\u4e0b\n10: aload_0\n11: iconst_0\n12: putfield     #Field MyClass.aBoolean:Z  // 5.\u53d1\u73b0\u662f\u8be5Class\u7684\u57df\uff0c\u4f46\u5728\u904d\u5386\u8fc7\u7684Key\u7684\u96c6\u5408\u4e2d\u53d1\u73b0\u5b58\u5728MyClass-aBoolean\uff0c\u7ee7\u7eed\u5f80\u4e0b\n15: return\n</code></pre> <p>\u6700\u7ec8\u53d1\u73b0\u4e0a\u8ff0\u5b57\u8282\u7801\u4e2d\uff0c\u6807\u7ea2\u7684\u90e8\u5206\u53ef\u4ee5\u5220\u9664\uff0c\u5220\u9664\u5bf9\u5e94\u7684\u5b57\u8282\u7801\u6307\u4ee4\uff0c\u4f18\u5316\u5b8c\u6210\u3002</p> <p>\u4f7f\u7528\u6296\u97f3\u4e4b\u524d\u5f00\u6e90\u7684\u5b57\u8282\u7801\u5904\u7406\u6846\u67b6 ByteX\uff0c\u53ef\u4ee5\u6bd4\u8f83\u65b9\u4fbf\u5730\u83b7\u53d6 Field \u7684 Class\uff0c\u904d\u5386 Class \u7684\u6240\u6709\u65b9\u6cd5\uff0c\u4ee5\u53ca\u6240\u6709\u65b9\u6cd5\u7684\u5b57\u8282\u7801\u3002\u6211\u4eec\u4e5f\u5df2\u7ecf\u5c06\u6b64\u65b9\u6848\u8fdb\u884c\u4e86\u5f00\u6e90\uff0c\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u524d\u5f80\u67e5\u770b\u8be6\u7ec6\u4ee3\u7801:</p> <ul> <li>github.com/bytedance/B\u2026</li> </ul>"},{"location":"perf-opt/Android/size/douyin/#_4","title":"\u5220\u9664\u65e0\u526f\u4f5c\u7528\u4ee3\u7801","text":"<p>\u5197\u4f59\u8d4b\u503c\u662f\u5229\u7528\u4e86\u865a\u62df\u673a\u5728\u7c7b\u52a0\u8f7d\u65f6\u4e3a\u5b57\u6bb5\u9ed8\u8ba4\u8d4b\u503c\u7684\u7279\u6027\uff0c\u4ece\u800c\u5220\u9664\u591a\u4f59\u7684\u7684\u8d4b\u503c\u6307\u4ee4\uff0c\u800c\u6211\u4eec\u4ee3\u7801\u4e2d\u672c\u8eab\u4e5f\u6709\u4e00\u4e9b\u5bf9\u7ebf\u4e0a\u5305\u662f\u6ca1\u6709\u4f5c\u7528\u7684\uff0c\u6700\u5e38\u89c1\u7684\u5c31\u662f\u65e5\u5fd7\u6253\u5370\uff0c\u9664\u4e86\u5360\u7528\u5305\u4f53\u79ef\u4e4b\u5916\uff0c\u8fd8\u4f1a\u9020\u6210\u6027\u80fd\u95ee\u9898\u4ee5\u53ca\u5b89\u5168\u98ce\u9669\uff0c\u56e0\u6b64\u4e00\u822c\u90fd\u4f1a\u5c06\u5176\u79fb\u9664\u6389\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4ee5 Log.i \u8c03\u7528\u4e3a\u4f8b\u6765\u4ecb\u7ecd\u5982\u4f55\u5220\u9664\u4ee3\u7801\u4e2d\u7684\u65e0\u7528\u51fd\u6570\u8c03\u7528\u3002\u6bd4\u5982\u4e0b\u9762\u4ee3\u7801\u4e2d\u7684\u65e5\u5fd7\u6253\u5370\u8bed\u53e5\uff1a</p> <pre><code>public static void click() {\nclickSelf();\nLog.i(\"Logger\", \"click time:\" + System.currentTimeMillis());\n}\n</code></pre> <p>\u4e00\u5f00\u59cb\u6211\u4eec\u5c1d\u8bd5\u4e86 proguard \u7684 -assumenosideeffects\uff0c\u8fd9\u4e2a\u6307\u4ee4\u9700\u8981\u6211\u4eec\u5047\u5b9a\u8981\u5220\u9664\u7684\u65b9\u6cd5\u8c03\u7528\u6ca1\u6709\u4efb\u4f55\u7684\u526f\u4f5c\u7528\uff0c\u5e76\u4e14\u4ece\u7a0b\u5e8f\u5206\u6790\u7684\u89d2\u5ea6\u6765\u8bf4\u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e0d\u4f1a\u4fee\u6539\u5806\u4e0a\u67d0\u4e2a\u5bf9\u8c61\u6216\u8005\u6808\u4e0a\u65b9\u6cd5\u53c2\u6570\u7684\u503c\u3002\u4f7f\u7528\u5982\u4e0b\u914d\u7f6e\uff0cproguard \u5c31\u4f1a\u5728 optimize \u9636\u6bb5\u5e2e\u6211\u4eec\u5220\u9664 Log \u76f8\u5173\u7684\u65b9\u6cd5\u8c03\u7528\u3002</p> <pre><code>-assumenosideeffects class android.util.Log {\npublic static boolean isLoggable(java.lang.String, int);\npublic static int v(...);\npublic static int i(...);\npublic static int w(...);\npublic static int d(...);\npublic static int e(...);\n}\n</code></pre> <p>\u4f46\u662f\u8fd9\u79cd\u5220\u9664\u5e76\u4e0d\u5f7b\u5e95\uff0c\u5b83\u53ea\u4f1a\u5220\u9664\u65b9\u6cd5\u8c03\u7528\u6307\u4ee4\u672c\u8eab\uff0c\u6bd4\u5982\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u5220\u9664 Log.i \u65b9\u6cd5\u8c03\u7528\u4e4b\u540e\uff0c\u4f1a\u9057\u7559\u4e00\u4e2a StringBuilder \u5bf9\u8c61\u7684\u521b\u5efa\uff1a</p> <pre><code>public static void click() {\nclickSelf();\nnew StringBuilder(\"click time:\")).append(System.currentTimeMillis();\n}\n</code></pre> <p>\u8fd9\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\u6211\u4eec\u4eba\u4e3a\u5224\u65ad\u7684\u8bdd\u4e5f\u662f\u65e0\u7528\u7684\uff0c\u4f46\u662f\u4ec5\u4ece\u7b80\u5355\u7684\u9759\u6001\u7a0b\u5e8f\u6307\u4ee4\u5206\u6790\u7684\u89d2\u5ea6\u5e76\u4e0d\u80fd\u5224\u5b9a\u5176\u662f\u65e0\u7528\u7684\uff0c\u56e0\u6b64 proguard \u5e76\u6ca1\u6709\u5c06\u5176\u5220\u9664\u3002</p> <p>\u65e2\u7136 assumenosideeffects \u5220\u9664\u4e0d\u5e72\u51c0\uff0c\u6211\u4eec\u5c31\u81ea\u5df1\u6765\u5b9e\u73b0\u66f4\u52a0\u5f7b\u5e95\u7684\u4f18\u5316\u65b9\u6848\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_5","title":"\u4f18\u5316\u601d\u8def","text":"<pre><code> public static void click();\nCode:\n0: invokestatic  #6                  // Method clickSelf:()V\n3: ldc           #7                  // String Logger\n5: new           #8                  // class java/lang/StringBuilder\n8: dup\n9: invokespecial #9                  // Method java/lang/StringBuilder.\"&lt;init&gt;\":()V\n12: ldc           #10                 // String click time:\n14: invokevirtual #11                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;\n17: invokestatic  #12                 // Method java/lang/System.currentTimeMillis:()J\n20: invokevirtual #13                 // Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder;\n23: invokevirtual #14                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;\n26: invokestatic  #2                  // Method android/util/Log.i:(Ljava/lang/String;Ljava/lang/String;)I\n29: pop\n</code></pre> <p>\u5982\u4e0a\u53ef\u4ee5\u770b\u5230\u4e00\u884c<code>Log.i(\"Logger\", \"click time:\" + System.currentTimeMillis());</code>\u5728\u7f16\u8bd1\u5b8c\u6210\u4e4b\u540e\u4f1a\u751f\u6210\u591a\u6761\u6307\u4ee4\uff08\u4ece ldc \u5230 pop\uff09\uff0c\u9664\u4e86\u76ee\u6807\u65b9\u6cd5 Log.i \u8c03\u7528 invokestatic \u6307\u4ee4\u5916\uff0c\u8fd8\u6709\u5f88\u591a\u53c2\u6570\u521b\u5efa\u548c\u5165\u6808\u6307\u4ee4\u3002</p> <p>\u6211\u4eec\u8981\u5220\u9664\u76f8\u5173\u65b9\u6cd5\u7684\u8c03\u7528\u7684\u8bdd\uff0c\u4e3b\u8981\u662f\u5c31\u662f\u627e\u5230\u8fd9\u884c\u4ee3\u7801\u6240\u4ea7\u751f\u7684\u8d77\u59cb\u6307\u4ee4\u548c\u7ec8\u6b62\u6307\u4ee4\uff0c\u7136\u540e\u8d77\u59cb\u5230\u7ec8\u6b62\u4f4d\u7f6e\u4e4b\u95f4\u7684\u6307\u4ee4\u5c31\u662f\u6211\u4eec\u8981\u5220\u9664\u7684\u5168\u90e8\u6307\u4ee4\u3002</p> <p>1. \u67e5\u627e\u7ec8\u6b62\u6307\u4ee4\u4f4d\u7f6e</p> <p>\u7ec8\u6b62\u6307\u4ee4\u7684\u67e5\u627e\u76f8\u5bf9\u7b80\u5355\uff0c\u4e3b\u8981\u5c31\u662f\u627e\u5230\u8981\u5220\u9664\u7684\u76ee\u6807\u65b9\u6cd5\u8c03\u7528\u6307\u4ee4\uff0c\u518d\u6839\u636e\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u7c7b\u578b\u786e\u5b9a\u662f\u5426\u8981\u5305\u542b\u5176\u540e\u7684 pop \u6216 pop2 \u6307\u4ee4\u3002</p> <p>\u6bd4\u5982\u4e0a\u8ff0\u4ee3\u7801\u6211\u4eec\u901a\u8fc7\u904d\u5386\u5c31\u80fd\u627e\u5230\u76ee\u6807\u65b9\u6cd5\u8c03\u7528<code>invokestatic #2</code> \u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a Log.i \u7684\u8fd4\u56de\u503c\u7c7b\u578b\u662f int\uff0c\u7ec8\u6b62\u6307\u4ee4\u5c31\u662f\u4e0b\u4e00\u6761\u7684 pop\u3002</p> <p>\u6ce8\u610f pop \u6307\u4ee4\u7684\u4f5c\u7528\u662f\u4e3b\u52a8\u8ba9 int \u7c7b\u578b\u7684\u503c\u51fa\u6808\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u4f7f\u7528\u8be5\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff0c\u53ea\u6709\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u624d\u80fd\u5b89\u5168\u5220\u9664\u76ee\u6807\u65b9\u6cd5\uff0c\u5426\u5219\u4e0d\u80fd\u5220\u9664\u3002\u5f53\u7136\u5982\u679c\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u7c7b\u578b\u662f void\uff0c\u5c31\u4e0d\u4f1a\u6709 pop \u6307\u4ee4\u3002</p> <p>2. \u67e5\u627e\u8d77\u59cb\u6307\u4ee4\u4f4d\u7f6e</p> <p>\u8d77\u59cb\u6307\u4ee4\u7684\u67e5\u627e\u5219\u9700\u8981\u6211\u4eec\u5bf9\u4e8e java \u5b57\u7801\u6307\u4ee4\u8bbe\u8ba1\u6709\u57fa\u672c\u7684\u8ba4\u8bc6: java \u5b57\u8282\u7801\u6307\u4ee4\u662f\u57fa\u4e8e\u5806\u6808\u8bbe\u8ba1\u7684\uff0c\u6bcf\u4e00\u6761\u5b57\u8282\u7801\u6307\u4ee4\u4f1a\u5bf9\u5e94\u64cd\u4f5c\u6570\u6808\u7684\u82e5\u5e72\u53c2\u6570\u7684\u5165\u6808\u548c\u51fa\u6808\uff0c\u5e76\u4e14\u4e00\u4e2a\u5b8c\u6574\u72ec\u7acb\u4ee3\u7801/\u4ee3\u7801\u5757\u6267\u884c\u524d\u548c\u6267\u884c\u540e\u64cd\u4f5c\u6570\u6808\u5e94\u8be5\u662f\u4e00\u6837\u7684\u3002</p> <p>\u56e0\u6b64\u6211\u4eec\u627e\u5230\u7ec8\u6b62\u6307\u4ee4\u540e\uff0c\u5012\u5e8f\u904d\u5386\u6307\u4ee4\uff0c\u6839\u636e\u6307\u4ee4\u7684\u4f5c\u7528\u8fdb\u884c\u53cd\u5411\u7684\u5165\u6808\u548c\u51fa\u6808\u64cd\u4f5c\uff0c\u5f53\u6211\u4eec\u7684\u6808\u4e2d size \u51cf\u4e3a 0 \u65f6\uff0c\u5c31\u627e\u5230\u4e86\u8d77\u59cb\u6307\u4ee4\u7684\u4f4d\u7f6e\u3002\u6ce8\u610f\u5728\u5165\u6808\u65f6\u5019\u8981\u8bb0\u5f55\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u5e76\u5728\u51fa\u6808\u65f6\u5019\u505a\u7c7b\u578b\u5339\u914d\u6821\u9a8c\u3002\u5982\u4e0a\u9762\u7684\u793a\u4f8b\uff1a</p> <ul> <li>pop \u6307\u4ee4\u6548\u679c\u662f\u5355 slot \u53c2\u6570(\u50cf int\uff0cfloat)\u51fa\u6808 ,\u90a3\u6211\u4eec\u5c31\u5728\u6808\u5b58\u5165\u4e00\u4e2a slot \u7c7b\u578b\u7684\u53c2\u6570</li> <li>invokestatic \u8981\u770b\u65b9\u6cd5\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\uff0c\u6b63\u5e38\u6548\u679c\u662f\u5bf9\u5e94\u65b9\u6cd5\u7684\u53c2\u6570\u4ece\u53f3\u81f3\u5de6\u4f9d\u6b21\u51fa\u6808\uff0c\u65b9\u8fd4\u56de\u503c int \u5165\u6808\u3002\u6211\u4eec\u5c31\u6839\u636e\u65b9\u6cd5\u8fd4\u56de\u503c\u51fa\u6808\u4e00\u4e2a int \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u53d1\u73b0\u6808\u9876\u76ee\u524d\u662f slot\uff0c\u7c7b\u578b\u5339\u914d\u3002\u7136\u540e\u6309\u7167\u65b9\u6cd5\u53c2\u6570\u4ece\u5de6\u81f3\u53f3\u4f9d\u6b21\u5165\u6808\u4e24\u4e2a String \u7c7b\u578b\u7684\u53c2\u6570\u3002</li> <li>invokevirtual \u6307\u4ee4\u6b63\u5e38\u65b9\u6cd5\u8c03\u7528\u53c2\u6570\u4f9d\u6b21\u4ece\u53f3\u81f3\u5de6\u4f9d\u6b21\u51fa\u6808\uff0c\u7136\u540e this \u5bf9\u8c61\u51fa\u6808\uff0c\u6700\u540e\u65b9\u6cd5\u8fd4\u56de\u503c String \u5165\u6808\u3002\u6211\u4eec\u5f39\u51fa\u6808\u9876\u4e00\u4e2a\u53c2\u6570\uff0c\u53d1\u73b0\u5176\u548c String \u5339\u914d\uff0c\u7136\u540e\u4f9d\u6b21\u5165\u6808 this \u5bf9\u5e94\u7684\u7c7b\u578b StringBuilder\uff0c\u8fd9\u91cc\u8c03\u7528\u7684\u662f toString \u65b9\u6cd5\u6ca1\u6709\u53c2\u6570\u5c31\u4e0d\u7528\u518d\u5165\u6808\u3002</li> <li>\u4e2d\u95f4\u5176\u4ed6\u7684\u6307\u4ee4\u7c7b\u4f3c\uff0c\u76f4\u5230 ldc \u6307\u4ee4\uff0c\u672c\u8eab\u662f\u5411\u6808\u4e2d\u653e\u5165\u4e00\u4e2a int,float \u6216 String \u5e38\u91cf\uff0c\u6211\u4eec\u8fd9\u91cc\u5f39\u51fa\u4e00\u4e2a\u53c2\u6570\uff0c\u53d1\u73b0\u5176\u662f String \u5339\u914d\uff0c\u5e76\u4e14\u6b64\u65f6\u6808\u7684\u5927\u5c0f\u53d8\u4e3a 0\uff0c\u4e5f\u5c31\u627e\u5230\u4e86\u8d77\u59cb\u6307\u4ee4\u7684\u4f4d\u7f6e\u3002</li> </ul>"},{"location":"perf-opt/Android/size/douyin/#_6","title":"\u65b9\u6848\u7f3a\u9677","text":"<p>\u4e0d\u8fc7\u4e0a\u8ff0\u65b9\u6848\u5b58\u5728\u4e24\u4e2a\u7f3a\u9677\uff1a</p> <ol> <li>\u56e0\u4e3a\u5206\u6790\u53ea\u5728\u5355\u4e2a\u65b9\u6cd5\u5185\u5206\u6790\uff0c\u9488\u5bf9 Log \u65b9\u6cd5\u5c01\u88c5\u7684\u60c5\u51b5\uff0c\u5fc5\u987b\u9700\u8981\u914d\u7f6e\u5c01\u88c5\u65b9\u6cd5\u4f5c\u4e3a\u76ee\u6807\u65b9\u6cd5\uff0c\u624d\u80fd\u5220\u9664\u5b8c\u5168\u5220\u9664\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u65b9\u6cd5\u9700\u8981\u914d\u7f6e AccountLog.d \u624d\u80fd\u5220\u9664\u5176\u8c03\u7528\u5904\u7684 StringBuilder \u521b\u5efa\u3002</li> </ol> <pre><code>object AccountLog {\n@JvmStatic\nfun d(tag: String, msg: String) = Log.d(tag, msg)\n}\n</code></pre> <ol> <li>\u53ef\u80fd\u4f1a\u8bef\u5220\u9664\u4e00\u4e9b\u6709\u7528\u7684\u6307\u4ee4\uff0c\u56e0\u4e3a\u65e0\u6cd5\u8ba4\u4e3a Log.i \u7684\u4e24\u4e2a\u53c2\u6570\u7684\u6784\u5efa\u6307\u4ee4\u90fd\u662f\u6ca1\u6709\u7528\u7684\uff0c\u6211\u4eec\u53ea\u80fd\u786e\u5b9a StringBuilder \u7684\u521b\u5efa\u662f\u6ca1\u7528\u7684\uff0c\u4f46\u662f\u4e00\u4e9b\u5176\u4ed6\u7684\u65b9\u6cd5\u8c03\u7528\u53ef\u80fd\u4f1a\u6539\u53d8\u4e00\u4e9b\u5bf9\u8c61\u7684\u72b6\u6001\uff0c\u56e0\u6b64\u5b58\u5728\u4e00\u5b9a\u98ce\u9669\u3002</li> </ol>"},{"location":"perf-opt/Android/size/douyin/#proguard","title":"Proguard \u65b9\u6848","text":"<p>\u5728\u6211\u4eec\u4e0a\u8ff0\u65b9\u6848\u5728\u7ebf\u4e0a\u8fd0\u884c\u4e00\u5e74\u4e4b\u540e\uff0c\u5c1d\u8bd5\u9488\u5bf9\u4e0a\u8ff0\u5f0a\u7aef\u8fdb\u884c\u4f18\u5316\uff0c\u7136\u540e\u53d1\u73b0 proguard \u8fd8\u63d0\u4f9b\u4e86 assumenoexternalsideeffects \u6307\u4ee4\uff0c\u5b83\u53ef\u4ee5\u8ba9\u6211\u4eec\u6307\u5b9a\u6ca1\u6709\u4efb\u4f55\u5916\u90e8\u526f\u4f5c\u7528\u7684\u65b9\u6cd5\u3002</p> <p>\u6307\u5b9a\u4e86\u4ee5\u540e\uff0c\u5b83\u53ea\u4f1a\u4fee\u6539\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5b9e\u4f8b\u672c\u8eab\uff0c\u4f46\u4e0d\u4f1a\u4fee\u6539\u5176\u4ed6\u7684\u5bf9\u8c61\u3002\u901a\u8fc7\u5982\u4e0b\u7684\u914d\u7f6e\u53ef\u4ee5\u5220\u9664\u65e0\u7528\u7684 StringBuilder \u521b\u5efa\u3002</p> <pre><code>-assumenoexternalsideeffects class java.lang.StringBuilder {\npublic java.lang.StringBuilder();\npublic java.lang.StringBuilder(int);\npublic java.lang.StringBuilder(java.lang.String);\npublic java.lang.StringBuilder append(java.lang.Object);\npublic java.lang.StringBuilder append(java.lang.String);\npublic java.lang.StringBuilder append(java.lang.StringBuffer);\npublic java.lang.StringBuilder append(char[]);\npublic java.lang.StringBuilder append(char[], int, int);\npublic java.lang.StringBuilder append(boolean);\npublic java.lang.StringBuilder append(char);\npublic java.lang.StringBuilder append(int);\npublic java.lang.StringBuilder append(long);\npublic java.lang.StringBuilder append(float);\npublic java.lang.StringBuilder append(double);\npublic java.lang.String toString();\n}\n-assumenoexternalreturnvalues public final class java.lang.StringBuilder {\npublic java.lang.StringBuilder append(java.lang.Object);\npublic java.lang.StringBuilder append(java.lang.String);\npublic java.lang.StringBuilder append(java.lang.StringBuffer);\npublic java.lang.StringBuilder append(char[]);\npublic java.lang.StringBuilder append(char[], int, int);\npublic java.lang.StringBuilder append(boolean);\npublic java.lang.StringBuilder append(char);\npublic java.lang.StringBuilder append(int);\npublic java.lang.StringBuilder append(long);\npublic java.lang.StringBuilder append(float);\npublic java.lang.StringBuilder append(double);\n}\n</code></pre> <p>\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u914d\u7f6e\u53ea\u9002\u7528\u4e8e Log \u91cc\u53ea\u4f20\u5165 String \u7684\u60c5\u51b5\u3002\u5982\u679c\u662f<code>int Log.w (String tag, Throwable tr)</code>\u8fd9\u79cd\u60c5\u51b5\uff0c\u5c31\u65e0\u6cd5\u628a<code>Throwable</code>\u53c2\u6570\u4e5f\u4e00\u8d77\u53bb\u6389\u3002\u90a3\u8fd8\u662f\u5e94\u8be5\u91c7\u7528\u6211\u4eec\u81ea\u5df1\u5b9e\u73b0\u7684\u63d2\u4ef6\u624d\u80fd\u4f18\u5316\u5e72\u51c0\u3002</p> <p>\u6b64\u4f18\u5316\u5bf9\u6296\u97f3\u5305\u4f53\u79ef\u6536\u76ca\uff0c\u7ea6\u4e3a 520KB\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_7","title":"\u77ed\u65b9\u6cd5\u5185\u8054","text":"<p>\u4e0a\u9762\u4ecb\u7ecd\u7684\u4e24\u4e2a\u4f18\u5316\u662f\u4ece\u53bb\u9664\u65e0\u7528\u7684\u6307\u4ee4\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u5f00\u7bc7 DEX \u4f18\u5316\u601d\u8def\u4e2d\u6211\u4eec\u6709\u8bb2\u8fc7\uff0c\u51cf\u5c11\u5b9a\u4e49\u65b9\u6cd5\u6216\u8005\u5b57\u6bb5\u6570\u4ece\u800c\u51cf\u5c11 DEX \u6570\u91cf\u4e5f\u662f\u6211\u4eec\u5e38\u7528\u4f18\u5316\u601d\u8def\u4e4b\u4e00\uff0c\u77ed\u65b9\u6cd5\u5185\u8054\u5c31\u662f\u7cbe\u7b80\u4ee3\u7801\u6307\u4ee4\u7684\u60c5\u51b5\u4e0b\uff0c\u540c\u65f6\u51cf\u5c11\u5b9a\u4e49\u65b9\u6cd5\u6570\u3002</p> <p>\u5728\u548c\u6d77\u5916\u7ade\u54c1\u7684\u5bf9\u6bd4\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u5355\u4e2a DEX \u6587\u4ef6\u4e2d\u7684\u5b9a\u4e49\u65b9\u6cd5\u6570\u8fdc\u6bd4\u7ade\u54c1\u8981\u591a\uff0c\u8fdb\u4e00\u6b65\u5bf9 DEX \u8fdb\u884c\u5206\u6790\uff0c\u53d1\u73b0\u6296\u97f3\u7684 DEX \u4e2d\u6709\u5927\u91cf\u7684 access\uff0cgetter-setter \u65b9\u6cd5\uff0c\u800c\u7ade\u54c1\u4e2d\u51e0\u4e4e\u6ca1\u6709\u3002\u56e0\u6b64\u6211\u4eec\u6253\u7b97\u9488\u5bf9\u77ed\u65b9\u6cd5\u505a\u4e00\u4e9b\u5185\u8054\u4f18\u5316\uff0c\u51cf\u5c11\u5b9a\u4e49\u65b9\u6cd5\u6570\u3002</p> <p>\u5728\u4ecb\u7ecd\u4f18\u5316\u65b9\u6848\u524d\uff0c\u5148\u6765\u4e86\u89e3\u4e0b\u5185\u8054\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u5185\u8054\u4f5c\u4e3a\u6700\u5e38\u89c1\u7684\u4ee3\u7801\u4f18\u5316\u624b\u6bb5\uff0c\u88ab\u79f0\u4e3a\u4f18\u5316\u4e4b\u6bcd\u3002\u4e00\u4e9b\u8bed\u8a00\u50cf C++\u3001Kotlin \u63d0\u4f9b\u4e86 inline \u5173\u952e\u5b57\u7ed9\u7a0b\u5e8f\u5458\u505a\u51fd\u6570\u7684\u5185\u8054\uff0c\u800c Java \u8bed\u8a00\u672c\u8eab\u5e76\u6ca1\u6709\u7ed9\u7a0b\u5e8f\u5458\u63d0\u4f9b\u63a7\u5236\u6216\u5efa\u8bae inline \u7684\u673a\u4f1a\uff0c\u751a\u81f3 javac \u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u4e5f\u6ca1\u6709\u505a\u65b9\u6cd5\u5185\u8054\u3002\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u770b\u5185\u8054\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u5982\u4e0b\u4ee3\u7801\u4e2d callMethod \u8c03\u7528 print \u51fd\u6570\uff1a</p> <pre><code>public class InlineTest {\npublic static void callMethod(int a) {\nint result = a + 5;\nprint(result);\n}\npublic static void print(int result) {\nSystem.out.println(result);\n}\n}\n</code></pre> <p>\u5728\u5185\u8054\u4e4b\u540e inlineMethod \u7684\u5185\u5bb9\u76f4\u63a5\u88ab\u5c55\u5f00\u5230 callMethod \u4e2d, \u4ece\u5b57\u8282\u7801\u7684\u89d2\u5ea6\u770b\u53d8\u5316\u5982\u4e0b\uff1a</p> <p>\u5185\u8054\u524d\uff1a</p> <pre><code>public static void callMethod(int);\nCode:\n0: iload_0\n1: iconst_5\n2: iadd\n3: istore_1\n4: iload_1\n5: invokestatic  #2                  // Method print:(I)V\n8: return\n</code></pre> <p>\u5185\u8054\u540e\uff1a</p> <pre><code>public static void callMethod(int);\nCode:\n0: iload_0\n1: iconst_5\n2: iadd\n3: dup\n4: istore_0\n5: istore_0\n6: getstatic     #5                  // Field java/lang/System.out:Ljava/io/PrintStream;\n9: iload_0\n10: invokevirtual #6                  // Method java/io/PrintStream.println:(I)V\n13: return\n</code></pre> <p>\u4ece\u6267\u884c\u65f6\u95f4\u7684\u89d2\u5ea6\u770b\uff0c\u51cf\u5c11\u4e86\u4e00\u6b21\u51fd\u6570\u8c03\u7528\uff0c\u4ece\u800c\u63d0\u5347\u4e86\u6267\u884c\u6027\u80fd\u3002\u4ece\u7a7a\u95f4\u5360\u7528\u89d2\u5ea6\u770b\uff0c\u51cf\u5c11\u4e86\u4e00\u5904\u51fd\u6570\u58f0\u660e\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u4ee3\u7801\u4f53\u79ef\u3002</p> <p>\u90a3\u662f\u4e0d\u662f\u6240\u6709\u7684\u65b9\u6cd5\u90fd\u9002\u5408\u5185\u8054\u5462\uff1f</p> <p>\u663e\u7136\u4e0d\u662f\u7684\uff0c\u5bf9\u4e8e\u5355\u6b21\u8c03\u7528\u7684\u65b9\u6cd5\u8bf4\u5185\u8054\u80fd\u540c\u65f6\u53d6\u5f97\u65f6\u95f4\u548c\u7a7a\u95f4\u7684\u6536\u76ca\uff1b\u5bf9\u4e8e\u591a\u6b21\u8c03\u7528\u7684\u7684\u65b9\u6cd5\u5219\u9700\u8981\u8003\u8651\u65b9\u6cd5\u672c\u8eab\u7684\u957f\u77ed\uff0c\u6bd4\u5982\u4e0a\u9762\u7684 print \u65b9\u6cd5\u5c55\u5f00\u4e4b\u540e\u7684\u6307\u4ee4\u662f\u6bd4 invokestatic \u6307\u4ee4\u672c\u8eab\u8981\u957f\u5f88\u591a\u7684\uff0c\u4f46\u662f\u50cf access\u3001getter-setter \u65b9\u6cd5\u672c\u8eab\u6bd4\u8f83\u77ed\u5c31\u5f88\u9002\u5408\u5185\u8054\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#access","title":"access \u65b9\u6cd5\u5185\u8054","text":"<pre><code>public class Foo {\nprivate int mValue;\nprivate void doStuff(int value) {\nSystem.out.println(\"Value is \" + value);\n}\nprivate class Inner {\nvoid stuff() {\nFoo.this.doStuff(Foo.this.mValue);\n}\n}\n}\n</code></pre> <p>\u5982\u4e0a\u8ff0\u4ee3\u7801\uff0c\u5927\u5bb6\u90fd\u77e5\u9053 Java \u53ef\u4ee5\u5728\u5185\u90e8\u7c7b Foo$Inner \u4e2d\u76f4\u63a5\u8bbf\u95ee\u5916\u90e8\u7c7b Foo \u7684\u79c1\u6709\u6210\u5458\uff0c\u4f46\u662f JVM \u5e76\u6ca1\u6709\u4ec0\u4e48\u5185\u90e8\u7c7b\u5916\u90e8\u7c7b\u7684\u6982\u5ff5\uff0c\u8ba4\u4e3a\u4e00\u4e2a\u7c7b\u76f4\u63a5\u8bbf\u95ee\u53e6\u4e00\u4e2a\u7c7b\u7684\u79c1\u6709\u6210\u5458\u662f\u975e\u6cd5\u7684\u3002\u7f16\u8bd1\u5668\u4e3a\u4e86\u80fd\u5b9e\u73b0\u8fd9\u79cd\u8bed\u6cd5\u7cd6\uff0c\u4f1a\u5728\u7f16\u8bd1\u671f\u751f\u6210\u4ee5\u4e0b\u9759\u6001\u65b9\u6cd5:</p> <pre><code>static int Foo.access$100(Foo foo) {\nreturn foo.mValue;\n}\nstatic void Foo.access$200(Foo foo, int value) {\nfoo.doStuff(value);\n}\n</code></pre> <p>\u5185\u90e8\u7c7b\u5bf9\u8c61\u521b\u5efa\u65f6\u5019\u4f1a\u4f20\u5165\u5916\u90e8\u7c7b\u7684\u5f15\u7528\uff0c\u8fd9\u6837\u5f53\u5185\u90e8\u7c7b\u9700\u8981\u8bbf\u95ee\u5916\u90e8\u7c7b\u7684<code>mValue</code> \u6216\u8c03\u7528<code>doStuff()</code>\u65b9\u6cd5\u65f6\uff0c\u4f1a\u901a\u8fc7\u8c03\u7528\u8fd9\u4e9b\u9759\u6001\u65b9\u6cd5\u6765\u5b9e\u73b0\u3002\u8fd9\u91cc\u9700\u8981\u751f\u6210\u9759\u6001\u7684\u65b9\u6cd5\u7684\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u88ab\u8bbf\u95ee\u7684\u6210\u5458\u662f\u79c1\u6709\u7684\uff0c\u800c\u79c1\u6709\u8bbf\u95ee\u63a7\u5236\u66f4\u591a\u5730\u662f\u5728\u6e90\u7801\u5c42\u9762\u53bb\u7ea6\u675f\uff0c\u9632\u6b62\u7834\u574f\u7a0b\u5e8f\u7684\u8bbe\u8ba1\u3002\u5728\u5b57\u8282\u7801\u5c42\u9762\u53ea\u8981\u4e0d\u7834\u574f\u8bed\u6cd5\u903b\u8f91\uff0c\u56e0\u6b64\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u79c1\u6709\u6210\u5458\u6539\u6210 public \u7684\uff0c\u76f4\u63a5\u5220\u9664\u6389\u7f16\u8bd1\u5668\u751f\u6210\u7684\u6865\u63a5\u9759\u6001\u65b9\u6cd5\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_8","title":"\u4f18\u5316\u601d\u8def","text":"<p>\u5177\u4f53\u7684\u4f18\u5316\u5206\u4e3a\u5206\u4e3a\u4ee5\u4e0b\u51e0\u6b65\uff1a</p> <ol> <li>\u6536\u96c6\u5b57\u8282\u7801\u4e2d\u7684 access \u65b9\u6cd5\u3002</li> </ol> <pre><code>static int access$000(com.bytedance.android.demo.inline.Foo);\ndescriptor: (Lcom/bytedance/android/demo/inline/Foo;)I\nflags: ACC_STATIC, ACC_SYNTHETIC\nCode:\nstack=1, locals=1, args_size=1\n0: aload_0\n1: getfield      #2                  // Field mValue:I\n4: ireturn\nstatic void access$100(com.bytedance.android.demo.inline.Foo, int);\ndescriptor: (Lcom/bytedance/android/demo/inline/Foo;I)V\nflags: ACC_STATIC, ACC_SYNTHETIC\nCode:\nstack=2, locals=2, args_size=2\n0: aload_0\n1: iload_1\n2: invokespecial #1                  // Method doStuff:(I)V\n5: return\n</code></pre> <p>\u5982\u4e0a\u9762\u7684\u5b57\u8282\u7801\u6240\u793a\uff0c\u5b83\u7684\u7279\u5f81\u975e\u5e38\u660e\u663e\uff0c\u56e0\u4e3a\u662f\u7f16\u8bd1\u751f\u6210\u7684\u65b9\u6cd5\uff0c\u5b83\u6709 synthetic \u6807\u8bb0\uff0c\u5e76\u4e14\u662f\u9759\u6001\u65b9\u6cd5\uff0c\u65b9\u6cd5\u540d\u5b57\u4ee5\"access$\"\u5f00\u5934\uff0c\u901a\u8fc7\u8fd9\u4e9b\u7279\u5f81\u5728 ClassVisitor visitMethod \u65f6\u5c31\u5f88\u5bb9\u6613\u5339\u914d\u5230\u76f8\u5173\u65b9\u6cd5\u3002</p> <ol> <li>\u5206\u6790\u5e76\u8bb0\u5f55 access \u65b9\u6cd5\u8c03\u7528\u5904\u8981\u66ff\u6362\u7684\u76ee\u6807\u6307\u4ee4\u3002</li> </ol> <p>access \u6865\u63a5\u7684\u8bbf\u95ee\u53ea\u6709\u5b57\u6bb5\u548c\u65b9\u6cd5\u4e24\u79cd\uff0c\u76f8\u5bf9\u5e94\u7684\u6307\u4ee4\u662f\u65b9\u6cd5\u8bbf\u95ee\u6307\u4ee4(invokvirtual, invokspecial \u7b49\uff09\u548c\u5b57\u6bb5\u8bbf\u95ee\u6307\u4ee4(getfield, putfield \u7b49) \uff0c\u53ea\u9700\u904d\u5386\u65b9\u6cd5\u627e\u5230\u76f8\u5e94\u7684\u6307\u4ee4\uff0c\u540c\u65f6\u89e3\u6790\u51fa\u6307\u4ee4\u8bbf\u95ee\u7684\u5b57\u6bb5\u6216\u65b9\u6cd5\u4fe1\u606f\uff0c\u7136\u540e\u518d\u5c06\u5bf9\u5e94\u7684 private \u6210\u5458\u6539\u4e3a public\u3002\u6bd4\u5982 access$000 \u65b9\u6cd5\u4f1a\u627e\u5230\u5982\u4e0b\u6307\u4ee4\uff0c\u8bbf\u95ee\u7684\u5b57\u6bb5\u662f\u7c7b Foo \u7684 mValue\u3002</p> <pre><code>getfield      #2                  // Field mValue:I\n</code></pre> <ol> <li>\u66ff\u6362 access \u65b9\u6cd5\u8c03\u7528\u5904\u7684 invokestatic \u4e3a\u5bf9\u5e94\u7684\u76ee\u6807\u6307\u4ee4\uff0c\u5e76\u5220\u9664 access \u65b9\u6cd5\u7684\u5b9a\u4e49\u3002</li> </ol> <p>\u904d\u5386\u67e5\u627e\u6240\u6709\u5bf9 access \u65b9\u6cd5\u7684\u8c03\u7528\u70b9\uff0c\u5982\u4e0b\u9762\u7684 invokestatic \u6307\u4ee4\uff0c\u5176\u8c03\u7528\u65b9\u6cd5\u5728\u6211\u4eec\u7b2c\u4e00\u6b65\u6536\u96c6\u7684 access \u65b9\u6cd5\u4e2d\uff0c\u5c06\u5b83\u66ff\u6362\u4e3a getfield\uff0c\u7136\u540e\u4fbf\u53ef\u4ee5\u5220\u9664 Foo.access$000 \u65b9\u6cd5\u672c\u8eab\u3002</p> <pre><code>invokestatic  #3                  // Method com/bytedance/android/demo/inline/Foo.access$000:(Lcom/bytedance/android/demo/inline/Foo;)I\n</code></pre>"},{"location":"perf-opt/Android/size/douyin/#getter-setter","title":"getter-setter \u5185\u8054","text":"<p>\u5c01\u88c5\u662f\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b(OOP)\u7684\u57fa\u672c\u7279\u6027\u4e4b\u4e00\uff0c\u4f7f\u7528 getter \u548c setter \u65b9\u6cd5\u662f\u5728\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\u5e38\u89c1\u7684\u5c01\u88c5\u65b9\u6cd5\u4e4b\u4e00\u3002\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u5e38\u5e38\u4f1a\u4e3a\u4e00\u4e9b\u7c7b\u5199\u4e00\u4e9b getter-setter \u65b9\u6cd5\uff0c\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>public class People {\nprivate int age;\npublic int getAge() {\nreturn this.age;\n}\npublic void setAge(int age) {\nthis.age = age;\n}\n}\n</code></pre> <p>\u8fd9\u4e9b\u65b9\u6cd5\u5b8c\u5168\u5c31\u662f\u77ed\u65b9\u6cd5\u5185\u8054\u7684\u6700\u4f73 case\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_9","title":"\u4f18\u5316\u601d\u8def","text":"<p>getter-setter \u5185\u8054\u6574\u4f53\u5b9e\u73b0\u548c access \u65b9\u6cd5\u5927\u540c\u5c0f\u5f02\uff0c\u6574\u4f53\u4e5f\u5206\u4e3a\u6536\u96c6\u3001\u5206\u6790\u548c\u5220\u9664\u4e09\u6b65\u3002</p> <pre><code>public int getAge();\ndescriptor: ()I\nflags: ACC_PUBLIC\nCode:\nstack=1, locals=1, args_size=1\n0: aload_0\n1: getfield      #2                  // Field age:I\n4: ireturn\npublic void setAge(int);\ndescriptor: (I)V\nflags: ACC_PUBLIC\nCode:\nstack=2, locals=2, args_size=2\n0: aload_0\n1: iload_1\n2: putfield      #2                  // Field age:I\n5: return\n</code></pre> <ol> <li>\u6536\u96c6\u4ee3\u7801\u4e2d\u8981\u5185\u8054\u7684 getter-setter \u65b9\u6cd5\u4fe1\u606f\u3002\u53c2\u8003\u4e0a\u9762\u7684\u5b57\u8282\u7801\u6307\u4ee4\uff0c\u4e3b\u8981\u662f\u627e\u51fa\u53ea\u6709\u53c2\u6570\u5165\u6808(LOAD \u7c7b\u6307\u4ee4\uff09\u3001\u5b57\u6bb5\u8bbf\u95ee\uff08GETFIELD, PUTFIELD)\u3001RETURN \u6307\u4ee4 \u7684\u65b9\u6cd5\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\u8981\u8fc7\u6ee4\u88ab proguard \u89c4\u5219 keep \u7684\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u5220\u9664\u98ce\u9669\u5f88\u5927\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u6709\u63d2\u4ef6\u5185\u8c03\u7528\u6216\u8005\u53cd\u5c04\u8c03\u7528\u3002</li> <li>\u8bb0\u5f55\u6bcf\u4e2a\u65b9\u6cd5\u8bbf\u95ee\u5b57\u6bb5\u7684\u6307\u4ee4\u4ee5\u53ca\u76ee\u6807\u5b57\u6bb5\uff0c\u5982\u679c\u5b57\u6bb5\u8bbf\u95ee\u6743\u9650\u662f\u975e public \u7684\u8bdd\uff0c\u4fee\u6539\u6210 public \u7684\u3002</li> <li>\u9488\u5bf9\u8c03\u7528 getter-setter \u7684\u65b9\u6cd5\u7684\u5730\u65b9\uff0c\u76f4\u63a5\u66ff\u6362\u4e3a\u76f8\u5e94\u7684\u5b57\u6bb5\u8bbf\u95ee\u6307\u4ee4\uff0c\u5e76\u5220\u9664 getter-setter \u7684\u65b9\u6cd5\u7684\u5b9a\u4e49\u3002</li> </ol>"},{"location":"perf-opt/Android/size/douyin/#proguard_1","title":"\u4e3a\u4ec0\u4e48\u4e0d\u7528 Proguard","text":"<p>Proguard \u9664\u4e86\u6df7\u6dc6\u3001shrink \u65e0\u7528\u4ee3\u7801\u4e4b\u5916\uff0c\u4e5f\u4f1a\u5bf9\u4ee3\u7801\u8fdb\u884c\u8bf8\u591a\u7684\u4f18\u5316\uff0c\u5176\u4e2d\u5c31\u5305\u62ec\u77ed\u65b9\u6cd5\u5185\u8054\uff0c\u552f\u4e00\u65b9\u6cd5\u5185\u8054\u7b49\u3002\u90a3\u6211\u4eec\u7684 App \u4e3a\u4ec0\u4e48\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u5462\uff1f\u4e3b\u8981\u8fd8\u662f\u56e0\u4e3a\u4f7f\u7528\u4e86 robust \u70ed\u4fee\uff0cauto-patch \u5bf9\u5185\u8054\u5c42\u7ea7\u8fc7\u9ad8\u4ee5\u53ca\u50cf builder \u65b9\u6cd5\u8fd9\u79cd\u60c5\u51b5\u652f\u6301\u7684\u4e0d\u597d\uff0c\u4f1a\u5bfc\u81f4 Patch \u751f\u6210\u5931\u8d25\u3002\u4f46\u662f access \u65b9\u6cd5\u3001getter-setter \u65b9\u6cd5\u672c\u8eab\u5f88\u77ed\uff0c\u81f3\u591a\u4e5f\u5c31\u6709\u4e00\u5c42\u5185\u8054\u5c42\u7ea7\uff0c\u4e0d\u4f1a\u5f71\u54cd Patch \u7684\u751f\u6210\uff0cproguard \u53c8\u65e0\u6cd5\u914d\u7f6e\u54ea\u4e9b\u65b9\u6cd5\u5185\u8054\uff0c\u56e0\u6b64\u6211\u4eec\u6253\u7b97\u81ea\u5df1\u6765\u5b9e\u73b0\u3002</p> <p>\u6296\u97f3\u4e0a\u4e24\u4e2a\u77ed\u65b9\u6cd5\u5185\u8054\u51cf\u5c11\u5b9a\u4e49\u65b9\u6cd5\u6570 7 \u4e07+\uff0cDEX \u6587\u4ef6\u51cf\u5c11\u4e00\u4e2a\uff0c\u5305\u4f53\u79ef\u6536\u76ca\u8fbe\u5230\u4e86 1.7M\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_10","title":"\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664","text":"<p>\u4e0a\u9762\u77ed\u65b9\u6cd5\u5185\u8054\u662f\u5c06\u65b9\u6cd5\u5185\u5bb9\u5c55\u5f00\u5230\u8c03\u7528\u5904\u53bb\uff0c\u6211\u4eec\u4ee3\u7801\u4e2d\u7684\u4e00\u4e9b\u5e38\u91cf\u4e5f\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u5c06\u5e38\u91cf\u503c\u66ff\u6362\u4f7f\u7528\u5904\uff0c\u4ece\u800c\u51cf\u5c11\u5b57\u6bb5\u7684\u58f0\u660e\uff0c\u8fd9\u79cd\u4f18\u5316\u5c31\u662f\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664\u7684\u6700\u7b80\u5355\u8868\u73b0\u3002</p> <p>\u6211\u4eec\u77e5\u9053 javac \u4f1a\u505a\u4e00\u4e9b final \u7c7b\u578b\u53d8\u91cf\u7684\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664\u4f18\u5316\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>public class ConstJava {\npublic static final int INTEGER = 1024;\npublic static final String STRING = \"this is long  str\";\npublic static void constPropagation() {\nSystem.out.println(\"integer:\" + INTEGER);\nSystem.out.println(\"string:\" + STRING);\n}\n}\n</code></pre> <p>\u5728\u7f16\u8bd1\u4e4b\u540e constPropagation \u65b9\u6cd5\u5c31\u4f1a\u53d8\u6210\u5982\u4e0b\u5185\u5bb9\uff0c\u5e38\u91cf\u76f4\u63a5\u66ff\u6362\u6210\u4e86\u5b57\u9762\u503c\uff0c\u8fd9\u6837\u76f8\u5e94\u7684 final \u5b57\u6bb5\u5c31\u53d8\u6210\u4e86\u65e0\u7528\u5b57\u6bb5\uff0cproguard \u5c31\u53ef\u4ee5\u5c06\u5176 shrink \u6389\u3002</p> <pre><code>public static void constPropagation() {\nSystem.out.println(\"integer:1024\");\nSystem.out.println(\"string:this is long  str\");\n}\n</code></pre> <p>\u4f46\u662f\u6bd4\u5982\u4e0b\u9762\u7684\u4e00\u4e9b\u4e00\u4e9b kotlin \u4ee3\u7801\uff0c\u7f16\u8bd1\u4e4b\u540e\u5982\u4e0b, \u5e76\u672a\u8fdb\u884c\u4f20\u64ad\u4f18\u5316\u3002\u5f53\u7136\u8fd9\u91cc\u5982\u679c\u6dfb\u52a0 const \u5173\u952e\u5b57\u4fee\u6539\uff0c\u5bf9\u5e94\u5730\u4f1a\u8fdb\u884c\u4f18\u5316\u3002</p> <pre><code>class ConstKotlin {\ncompanion object {\nval INTEGER = 1024\nval STRING = \"this is long str\"\n}\nprivate val b = 6\nfun constPropagation(){\nprintln(\"a:$INTEGER\")\nprintln(\"s:$STRING\")\n}\n}\n</code></pre> <p>\u7f16\u8bd1\u540e\u4ee3\u7801\uff1a</p> <pre><code>private static final int INTEGER = 1024;\n@NotNull\nprivate static final String STRING = \"this is long str\";\npublic final void constPropagation() {\nString var1 = \"a:\" + INTEGER;\nSystem.out.println(var1);\nvar1 = \"s:\" + STRING;\nSystem.out.println(var1);\n}\n</code></pre> <p>\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u9488\u5bf9\u8fd9\u79cd case \u8fdb\u884c\u4f18\u5316\u3002</p> <p>\u53e6\u5916\u6211\u4eec\u4e0a\u9762\u8bf4\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664\u4f18\u5316\u4e4b\u540e\uff0c\u5bf9\u5e94\u7684\u5b57\u6bb5\u58f0\u660e\u5c31\u53ef\u4ee5\u88ab proguard \u5220\u9664\uff0c\u4f46\u662f\u9879\u76ee\u4e2d\u6709\u5f88\u591a keep \u8fc7\u5ea6\u7684\u60c5\u51b5\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u89c4\u5219\u4f1a\u5bfc\u81f4\u5e38\u91cf\u5b57\u6bb5\u58f0\u660e\u88ab\u4fdd\u7559\uff0c\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u53ef\u4ee5\u5c06\u5b57\u6bb5\u5220\u9664\u3002</p> <pre><code>-keep class com.bytedance.android.demo.ConstJava{*;}\n</code></pre>"},{"location":"perf-opt/Android/size/douyin/#_11","title":"\u4f18\u5316\u601d\u8def","text":"<ol> <li> <p>\u6536\u96c6 static final \u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u5e76\u8bb0\u5f55\u5176\u5b57\u9762\u503c\uff0c\u8fd9\u91cc\u9700\u8981\u6392\u9664\u4e00\u4e9b\u7279\u6b8a\u7684\u5b57\u6bb5\uff0c\u7136\u540e\u6700\u7ec8\u786e\u5b9a\u80fd\u5220\u9664\u7684\u5b57\u6bb5\u3002\u9700\u8981\u6392\u9664\u7684\u5b57\u6bb5\u4e3b\u8981\u6709\u4e0b\u9762\u4e24\u79cd\uff1a</p> </li> <li> <p>\u7528\u6765\u8868\u793a\u5e8f\u5217\u5316\u5bf9\u8c61\u7248\u672c\u7684 serialVersionUID \u5b57\u6bb5\uff1b</p> </li> <li> <p>\u6709\u53cd\u5c04\u4f7f\u7528\u5230\u7684\u5b57\u6bb5\uff0c\u4e00\u822c\u6765\u8bf4\u4e0d\u592a\u4f1a\u6709\u53cd\u5c04\u8bbf\u95ee final \u7c7b\u578b\u53d8\u91cf\u7684\u60c5\u51b5\uff0c\u4f46\u8fd9\u91cc\u8fd8\u662f\u4f1a\u5c1d\u8bd5\u5206\u6790\u4ee3\u7801\u4e2d\u5bf9\u5b57\u6bb5\u7684\u53cd\u5c04\u8c03\u7528\uff0c\u5982\u679c\u6709\u5bf9\u5e94\u7684\u8bbf\u95ee\u5219\u4fdd\u7559\u3002</p> </li> <li> <p>\u9488\u5bf9\u4ee3\u7801\u4e2d getstatic \u6307\u4ee4\u7684\u8bbf\u95ee\uff0c\u5206\u6790\u5176\u8bbf\u95ee\u7684\u5b57\u6bb5\uff0c\u5982\u679c\u5728\u7b2c\u4e00\u6b65\u6536\u96c6\u5230\u7684\u5b57\u6bb5\u4e2d\uff0c\u5c31\u628a\u5bf9\u5e94\u7684\u6307\u4ee4\u6539\u4e3a l \u5bf9\u5e94\u7684\u5e38\u91cf\u5165\u6808\u6307\u4ee4\uff0c\u5e76\u5220\u9664\u5bf9\u5e94\u7684\u5b57\u6bb5\u3002\u5982\u4e0b\u4e3a\u5bf9 INTEGER \u7684\u8bbf getstatic \u6307\u4ee4\uff0c\u5176\u5728\u7b2c\u4e00\u6b65\u6536\u96c6\u5230\u7684 final \u7c7b\u578b\u53d8\u91cf\u4e2d\uff0c\u5b57\u9762\u503c\u4e3a 1\u3002</p> </li> </ol> <pre><code>getstatic     #48                 // Field STRING:Ljava/lang/String;\n</code></pre> <p>\u4fee\u6539\u4e3a ldc \u6307\u4ee4\uff1a</p> <pre><code>ldc           #25                 // String s:this is long str\n</code></pre> <p>\u8fd9\u91cc\u4e9b\u540c\u5b66\u4f1a\u6709\u7591\u95ee\uff0c\u6bd4\u5982\u4e00\u4e2a\u5927\u7684\u5b57\u7b26\u4e32\u4f20\u64ad\u5230\u591a\u4e2a\u7c7b\u91cc\u9762\u4e0d\u662f\u53cd\u800c\u4f1a\u589e\u5927\u5305\u4f53\u79ef\u4e48\uff1f</p> <p>\u7684\u786e\u5b58\u5728\u8fd9\u79cd\u53ef\u80fd\uff0c\u4e0d\u8fc7\u7531\u4e8e\u4e00\u4e2a Dex \u4e2d\u6240\u6709\u7684\u7c7b\u5171\u7528\u4e00\u4e2a\u5e38\u91cf\u6c60\uff0c\u6240\u4ee5\u4f20\u64ad\u8fc7\u53bb\u5982\u679c\u4e24\u4e2a\u7c7b\u5728\u540c\u4e00\u4e2a Dex \u6587\u4ef6\u4e2d\u7684\u8bdd\u662f\u4e0d\u4f1a\u6709\u8d1f\u5411\u7684\uff0c\u53cd\u4e4b\u5219\u4f1a\u6709\u8d1f\u5411\u3002</p> <p>\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664\u4f18\u5316\u603b\u4f53\u5e26\u6765 400KB \u5de6\u53f3\u7684\u5305\u4f53\u6536\u76ca\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#rclass","title":"R.class \u5e38\u91cf\u5185\u8054","text":"<p>\u5e38\u91cf\u5b57\u6bb5\u6d88\u9664\u4f18\u5316\u7684\u662f\u5e38\u89c4\u7684 final static \u7c7b\u578b\uff0c\u4f46\u5728\u6211\u4eec\u7684\u4ee3\u7801\u4e2d\uff0c\u8fd8\u6709\u53e6\u4e00\u79cd\u7c7b\u578b\u7684\u5e38\u91cf\u4e5f\u53ef\u4ee5\u5185\u8054\u4f18\u5316\u3002</p> <p>\u5728\u6211\u4eec Android \u7684\u5f00\u53d1\u4e2d\uff0c\u5e38\u5e38\u4f1a\u7528\u5230 R \u8fd9\u4e2a\u7c7b\uff0c\u5b83\u662f\u6211\u4eec\u4f7f\u7528\u8d44\u6e90\u7684\u6700\u5e73\u5e38\u7684\u65b9\u5f0f\u3002\u4f46\u5b9e\u9645\u4e0a\uff0cR \u6587\u4ef6\u7684\u751f\u6210\u6709\u7740\u8bb8\u591a\u4e0d\u5408\u7406\u7684\u5730\u65b9\uff0c\u5bf9\u6211\u4eec\u7684\u6027\u80fd\u548c\u5305\u5927\u5c0f\u90fd\u9020\u6210\u4e86\u6781\u5927\u7684\u5f71\u54cd\u3002\u4f46\u662f\u8981\u7406\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u518d\u7406\u89e3\u4e00\u6b21 R \u6587\u4ef6\u662f\u4ec0\u4e48\u3002</p> <p>\u6211\u4eec\u5728\u5e73\u65f6\u7684\u4ee3\u7801\u5f00\u53d1\u4e2d\uff0c\u5e38\u5e38\u4f1a\u5199\u51fa\u4ee5\u4e0b\u5e73\u5e38\u7684\u4ee3\u7801\uff1a</p> <pre><code>public class MainActivity extends AppCompatActivity {\n@Override\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\nsuper.onCreate(savedInstanceState);\n// \u6b64\u5904\u6211\u4eec\u4f7f\u7528R\u4e2d\u7684id\u6765\u83b7\u53d6MainActivity\u7684layout\u8d44\u6e90\nsetContentView(R.layout.activity_main);\n}\n}\n</code></pre> <p>\u6211\u4eec\u5728\u8be5\u4f8b\u4e2d\u4f7f\u7528<code>R.layout.activity_main</code>\u6765\u83b7\u53d6\u4e86 MainActivity \u7684 layout \u8d44\u6e90\uff0c\u90a3\u6211\u4eec\u5c06\u5176\u8f6c\u5316\u4e3a\u5b57\u8282\u7801\u4f1a\u662f\u5982\u4f55\u5462\uff1f\u8fd9\u9700\u8981\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a</p> <ul> <li>\u5f53 MainActivity \u5728 application module \u4e0b\u65f6\uff0c\u5176\u5b57\u8282\u7801\u4e3a\uff1a</li> </ul> <pre><code>protected void onCreate(android.os.Bundle);\nCode:\n0: aload_0\n1: aload_1\n2: invokespecial #2                  // Method android/support/v7/app/AppCompatActivity.onCreate:(Landroid/os/Bundle;)V\n5: aload_0\n6: ldc           #4                  // int 2131296285\n8: invokevirtual #5                  // Method setContentView:(I)V\n11: return\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u4f7f\u7528<code>R.layout.activity_main</code>\u76f4\u63a5\u88ab\u66ff\u6362\u6210\u4e86\u5e38\u91cf\u3002</p> <ul> <li>\u7136\u800c\uff0c\u5f53 MainActivity \u5728 library module \u4e0b\u65f6\uff0c\u5176\u5b57\u8282\u7801\u4e3a\uff1a</li> </ul> <pre><code>protected void onCreate(android.os.Bundle);\nCode:\n0: aload_0\n1: aload_1\n2: invokespecial #2                  // Method android/support/v7/app/AppCompatActivity.onCreate:(Landroid/os/Bundle;)V\n5: aload_0\n6: getstatic     #3                  // Field com/bytedance/android/R$layout.activity_main:I\n9: invokevirtual #4                  // Method setContentView:(I)V\n12: return\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5176\u4ece\u4f7f\u7528 ldc \u6307\u4ee4\u5bfc\u5165\u5e38\u91cf\uff0c\u53d8\u6210\u4e86\u4f7f\u7528 getstatic \u6307\u4ee4\u8bbf\u95ee R$layout \u7684 activity_main \u57df\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_12","title":"\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u5dee\u522b","text":"<p>\u6211\u4eec\u77e5\u9053\uff0clibrary module \u5728\u63d0\u4f9b\u7ed9 application module \u7684\u65f6\u5019\u4e00\u822c\u662f\u901a\u8fc7 aar \u7684\u5f62\u5f0f\u63d0\u4f9b\u7684\uff0c\u56e0\u6b64\u4e3a\u4e86\u5728 library module \u6253\u5305\u65f6\uff0cjavac \u80fd\u591f\u7f16\u8bd1\u901a\u8fc7\uff0cAGP \u9ed8\u8ba4\u4f1a\u7ed9 library module \u63d0\u4f9b\u4e00\u4e2a\u4e34\u65f6\u7684 R.java \u6587\u4ef6(\u6700\u7ec8\u4e0d\u4f1a\u6253\u5165 library module \u7684\u5305\u4e2d)\uff0c\u5e76\u4e14\u4e3a\u4e86\u9632\u6b62\u88ab javac \u5185\u8054\uff0c\u4f1a\u5c06 R \u4e2d field \u7684\u4fee\u9970\u7b26\u9650\u5b9a\u4e3a<code>public static</code>\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97 R \u7684\u57df\u90fd\u4e0d\u4e3a\u5e38\u91cf\uff0c\u6700\u7ec8\u9003\u8fc7 javac \u5185\u8054\u4fdd\u7559\u5230\u4e86 application module \u7684\u7f16\u8bd1\u4e2d\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#library-module","title":"\u4e3a\u4ec0\u4e48 library module \u4e0d\u5185\u8054","text":"<p>\u5728 Android \u4e2d\uff0c\u6211\u4eec\u6bcf\u4e2a\u8d44\u6e90 id \u90fd\u662f\u552f\u4e00\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u6253\u5305\u7684\u65f6\u5019\u9700\u8981\u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d id \u7684\u8d44\u6e90\u3002\u5982\u679c\u6211\u4eec\u5728 library module \u5c31\u5df2\u7ecf\u6307\u5b9a\u4e86\u8d44\u6e90 id\uff0c\u90a3\u6211\u4eec\u5c31\u548c\u5bb9\u6613\u548c\u5176\u4ed6 library module \u51fa\u73b0\u8d44\u6e90 id \u7684\u51b2\u7a81\u3002\u56e0\u6b64 AGP \u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u6848\uff0c\u5728 library module \u7f16\u8bd1\u65f6\uff0c\u4f7f\u7528\u8d44\u6e90 id \u7684\u5730\u65b9\u4ecd\u7136\u91c7\u7528\u8bbf\u95ee\u57df\u7684\u65b9\u5f0f\uff0c\u5e76\u8bb0\u5f55\u4f7f\u7528\u7684\u8d44\u6e90\u5728 R.txt \u4e2d\u3002\u5728 application module \u7f16\u8bd1\u65f6\uff0c\u6536\u96c6\u6240\u6709 library module \u7684 R.txt\uff0c\u52a0\u4e0a application module R \u6587\u4ef6\u8f93\u5165\u7ed9 aapt\uff0caapt \u5728\u83b7\u5f97\u5168\u5c40\u7684\u8f93\u5165\u540e\uff0c\u6309\u5e8f\u7ed9\u6bcf\u4e2a\u8d44\u6e90\u751f\u6210\u552f\u4e00\u4e0d\u91cd\u590d\u7684\u8d44\u6e90 id\uff0c\u4ece\u800c\u907f\u514d\u8fd9\u79cd\u51b2\u7a81\u3002\u4f46\u6b64\u65f6\uff0clibrary module \u5df2\u7ecf\u7f16\u8bd1\u5b8c\u6210\uff0c\u56e0\u6b64\u53ea\u80fd\u751f\u6210 R.java \u6587\u4ef6\uff0c\u6765\u6ee1\u8db3 library module \u7684\u8fd0\u884c\u65f6\u8d44\u6e90\u83b7\u53d6\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#proguard_2","title":"\u4e3a\u4ec0\u4e48 ProGuard \u6ca1\u6709\u4f18\u5316","text":"<p>\u6211\u4eec\u5728\u4f7f\u7528 ProGuard \u7684\u65f6\u5019\uff0cGoogle \u5b98\u65b9\u5efa\u8bae\u6211\u4eec\u5e26\u4e0a\u4e00\u4e9b keep \u89c4\u5219\uff0c\u8fd9\u4e5f\u662f\u65b0\u5efa application \u9ed8\u8ba4\u4f1a\u751f\u6210\u7684\u6a21\u7248\u4ee3\u7801</p> <pre><code>buildTypes {\nrelease {\nproguardFiles getDefaultProguardFile('proguard-android-optimize.txt')\n}\n}\n</code></pre> <p>\u5b98\u65b9\u7ed9\u7684 keep \u89c4\u5219(android.googlesource.com/platform/sd\u2026 R class \u7684\u5b57\u6bb5\uff09\uff0c\u6240\u4ee5\u52a0\u4e86\u4e0b\u9762\u8fd9\u6761\u89c4\u5219\uff1a</p> <pre><code>-keepclassmembers class **.R$* {\npublic static &lt;fields&gt;;\n}\n</code></pre> <p>\u8be5 keep \u89c4\u5219\u7684\u4f5c\u7528\u662f\uff0c\u5c06\u6240\u6709 R \u4ee5\u53ca R \u5185\u90e8\u7c7b\u7684\u4ee5 public static \u4fee\u9970\u7684\u57df\u4fdd\u7559\uff0c\u4f7f\u5176\u4e0d\u88ab\u4f18\u5316\u3002\u56e0\u6b64\u5728\u6211\u4eec\u6700\u7ec8\u7684 APK \u4e2d\uff0cR.class \u4ecd\u7136\u5b58\u5728\uff0c\u8fd9\u9020\u6210\u4e86\u6211\u4eec\u5305\u4f53\u79ef\u7684\u81a8\u80c0\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u9020\u6210\u6211\u4eec\u5305\u4f53\u79ef\u81a8\u80c0\u7684\u539f\u56e0\u4e0d\u6b62 R \u7684\u57df\u7684\u5b9a\u4e49\u548c\u8d4b\u503c\uff0c\u5728 Android \u4e2d\uff0c\u4e00\u4e2a DEX \u53ef\u653e\u7f6e\u7684 field \u7684\u6570\u91cf\u4e0a\u9650\u56fa\u5b9a\u662f 65536\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u9650\u5236\u5219\u6211\u4eec\u9700\u8981\u5c06\u4e00\u4e2a DEX \u62c6\u5206\u4e3a\u4e24\u4e2a\u3002\u591a\u4e2a DEX \u4f1a\u5bfc\u81f4 DEX \u4e2d\u7684\u590d\u7528\u6570\u636e\u53d8\u5c11\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u5305\u4f53\u79ef\u7684\u81a8\u80c0\u3002\u56e0\u6b64\u6211\u4eec\u5bf9\u4e8e R \u7684\u4f18\u5316\uff0c\u5728 DEX \u5c42\u9762\u4e0a\u4e5f\u4f1a\u6709\u5f88\u5927\u7684\u6536\u76ca\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_13","title":"\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u4e86\u89e3\u95ee\u9898\u6839\u6e90\u540e\uff0c\u89e3\u51b3\u65b9\u6848\u4e5f\u5341\u5206\u7b80\u5355\u3002\u65e2\u7136 R.class \u4e2d\u5404\u4e2a\u57df\u7684\u503c\u786e\u8ba4\u540e\u5c31\u4e0d\u518d\u6539\u53d8\uff0c\u90a3\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5c06\u901a\u8fc7 R \u83b7\u53d6\u8d44\u6e90 id \u7684\u8c03\u7528\u5904\u5185\u8054\uff0c\u5e76\u5220\u9664\u5bf9\u5e94\u7684\u57df\uff0c\u6765\u83b7\u53d6\u6536\u76ca\u3002</p> <p>\u4f18\u5316\u601d\u8def\u5927\u6982\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u904d\u5386\u6240\u6709\u7684\u65b9\u6cd5\uff0c\u5b9a\u4f4d\u6240\u6709\u7684<code>getstatic</code>\u6307\u4ee4</p> </li> <li> <p>\u5982\u679c\u8be5<code>getstatic</code>\u6307\u4ee4\u7684\u76ee\u6807 Class name \u7684\u4e3a**.R \u6216\u8005**.R$* \u5f62\u5f0f\u7684 Class</p> </li> </ol> <p>a. \u5982\u679c <code>getstatic</code>\u6307\u4ee4\u7684\u76ee\u6807 Field \u4e3a<code>public static int</code>\u7c7b\u578b\uff0c\u5219\u4f7f\u7528 <code>ldc</code>\u6307\u4ee4\u5c06<code>getstatic</code>\u66ff\u6362\uff0c\u76f4\u63a5\u5c06 Field \u7684\u5b9e\u9645\u503c\u5bfc\u5165\uff1b</p> <p>b. \u5982\u679c<code>getstatic</code>\u6307\u4ee4\u7684\u76ee\u6807 Field \u4e3a<code>public static int[]</code>\u7c7b\u578b\uff0c\u5219\u4f7f\u7528<code>newarray</code>\u6307\u4ee4\u5c06<code>getstatic</code>\u66ff\u6362\uff0c\u5c06<code>&lt;clinit&gt;</code>\u4e2d Field \u7684\u6570\u7ec4\u8d4b\u503c\u5bfc\u5165\u3002</p> <ol> <li>\u904d\u5386\u5b8c\u6210\u540e\uff0c\u5224\u65ad R.class \u4e2d\u7684\u662f\u5426\u6240\u6709\u57df\u90fd\u88ab\u5220\u9664\uff0c\u5982\u679c\u5168\u90e8\u88ab\u5220\u9664\uff0c\u5219\u5c06\u8be5 R.class \u4e5f\u79fb\u9664\u3002</li> </ol> <p>\u6211\u4eec\u4f7f\u7528\u524d\u6587\u7684 case \u6765\u8bf4\u660e\u5982\u4e0b\uff1a</p> <pre><code>protected void onCreate(android.os.Bundle);\nCode:\n0: aload_0\n1: aload_1\n2: invokespecial #2                  // Method android/support/v7/app/AppCompatActivity.onCreate:(Landroid/os/Bundle;)V\n5: aload_0\n// \u5224\u65ad\u662fR.class\u7684Field\u8c03\u7528\uff0c\u4f7f\u7528ldc\u66ff\u6362\n6: getstatic     #3                  // Field com/bytedance/android/R$layout.activity_main:I\n6: ldc           #4                  // int 2131296285\n8: invokevirtual #5                  // Method setContentView:(I)V\n11: return\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u5e76\u4e0d\u662f\u6240\u6709 id \u90fd\u80fd\u5185\u8054\uff0c\u5982\u679c\u6211\u4eec\u8fd0\u884c\u65f6\u901a\u8fc7\u53cd\u5c04 R.class \u6765\u83b7\u53d6\u67d0\u4e9b\u6307\u5b9a\u540d\u5b57\u7684\u8d44\u6e90\u65f6\uff0c\u5982\u679c\u6211\u4eec\u5c06\u5176\u5185\u8054\u4e86\uff0c\u4f1a\u5bfc\u81f4\u8fd0\u884c\u65f6\u627e\u4e0d\u5230 id \u7684\u5f02\u5e38\u3002\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u65b9\u6848\u4e2d\u589e\u52a0\u4e00\u4e2a\u767d\u540d\u5355\u7684\u6982\u5ff5\uff0c\u5728\u767d\u540d\u5355\u4e2d\u7684\u57df\u5c06\u4e0d\u4f1a\u88ab\u5185\u8054\uff0c\u5bf9\u5e94\u7684\uff0c\u65b9\u6848\u4e2d\u7684\u6b65\u9aa4 2\uff0c\u9700\u8981\u4fee\u6539\u4e3a</p> <ol> <li>\u5982\u679c\u8be5<code>getstatic</code>\u6307\u4ee4\u7684\u76ee\u6807 Class name \u7684\u4e3a**.R \u6216\u8005**.R$* \u5f62\u5f0f\u7684 Class</li> </ol> <p>a.  \u5982\u679c<code>getstatic</code>\u6307\u4ee4\u7684\u76ee\u6807 Field \u5728\u767d\u540d\u5355\u4e2d\uff0c\u5219\u8df3\u8fc7\uff1b</p> <p>b.  \u5982\u679c<code>getstatic</code>\u6307\u4ee4\u7684\u76ee\u6807 Field \u4e3a<code>public static int</code>\u7c7b\u578b\uff0c\u5219\u4f7f\u7528<code>ldc</code>\u6307\u4ee4\u5c06<code>getstatic</code>\u66ff\u6362\uff0c\u76f4\u63a5\u5c06 Field \u7684\u5b9e\u9645\u503c\u5bfc\u5165\uff1b</p> <p>c.  \u5982\u679c<code>getstatic</code>\u6307\u4ee4\u7684\u76ee\u6807 Field \u4e3a<code>public static int[]</code>\u7c7b\u578b\uff0c\u5219\u4f7f\u7528<code>newarray</code>\u6307\u4ee4\u5c06<code>getstatic</code>\u66ff\u6362\uff0c\u5c06<code>&lt;clinit&gt;</code>\u4e2d Field \u7684\u6570\u7ec4\u8d4b\u503c\u5bfc\u5165\u3002</p> <p>\u6296\u97f3\u4e0a\u7ebf\u6b64\u4f18\u5316\u540e\u51cf\u5c11\u5305\u4f53\u79ef\u7ea6 30.5M\u3002\u6296\u97f3\u80fd\u4ea7\u751f\u8fd9\u4e48\u5927\u7684\u6536\u76ca\u662f\u56e0\u4e3a\u6296\u97f3\u7684 R \u5341\u5206\u5de8\u5927\uff0c\u5305\u542b\u7684 field \u975e\u5e38\u591a\uff0c\u540c\u65f6\u7531\u4e8e\u5355\u4e2a DEX \u80fd\u5b9a\u4e49\u7684 field \u6700\u591a\u4e3a 65536 \u4e2a\uff0c\u5982\u679c\u4e0d\u505a\u7cbe\u7b80\u5219\u4f1a\u5bfc\u81f4 DEX \u6570\u91cf\u7684\u5267\u589e\uff0c\u4ece\u800c\u51fa\u73b0 DEX \u603b\u4f53\u79ef\u66b4\u6da8\u7684\u60c5\u51b5\u3002</p>"},{"location":"perf-opt/Android/size/douyin/#_14","title":"\u53c2\u8003","text":"<p>\u8f6c\u81ea https://juejin.cn/post/7052614577216815134</p>"},{"location":"read/","title":"\u5f00\u5377\u6709\u76ca","text":""},{"location":"read/beautiful-algo/Complexity%20Analysis/","title":"\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5","text":""},{"location":"read/beautiful-algo/Complexity%20Analysis/#1","title":"1. \u6982\u8ff0","text":"<ul> <li>\u5e7f\u4e49</li> </ul> <p>\u6570\u636e\u7ed3\u6784\u5c31\u662f\u6307\u4e00\u7ec4\u6570\u636e\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u7b97\u6cd5\u5c31\u662f\u64cd\u4f5c\u6570\u636e\u7684\u4e00\u7ec4\u65b9\u6cd5\u3002</p> <ul> <li>\u72ed\u4e49</li> </ul> <p>\u6307\u67d0\u4e9b\u8457\u540d\u7684\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\uff0c\u6bd4\u5982\u961f\u5217\u3001\u6808\u3001\u5806\u3001\u4e8c\u5206\u67e5\u627e\u3001\u52a8\u6001\u89c4\u5212\u7b49</p> <p>\u6570\u636e\u7ed3\u6784\u662f\u4e3a\u7b97\u6cd5\u670d\u52a1\u7684\uff0c\u7b97\u6cd5\u8981\u4f5c\u7528\u5728\u7279\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u4e4b\u4e0a\u3002 \u56e0\u6b64\uff0c\u6211\u4eec\u65e0\u6cd5\u5b64\u7acb\u6570\u636e\u7ed3\u6784\u6765\u8bb2\u7b97\u6cd5\uff0c\u4e5f\u65e0\u6cd5\u5b64\u7acb\u7b97\u6cd5\u6765\u8bb2\u6570\u636e\u7ed3\u6784\u3002</p>"},{"location":"read/beautiful-algo/Complexity%20Analysis/#2","title":"2. \u590d\u6742\u5ea6\u5206\u6790","text":""},{"location":"read/beautiful-algo/Complexity%20Analysis/#21","title":"2.1 \u4e3a\u4ec0\u4e48\u9700\u8981\u590d\u6742\u5ea6\u5206\u6790\uff1f","text":"<p>\u4f60\u53ef\u80fd\u4f1a\u6709\u4e9b\u7591\u60d1\uff0c\u6211\u628a\u4ee3\u7801\u8dd1\u4e00\u904d\uff0c\u901a\u8fc7\u7edf\u8ba1\u3001\u76d1\u63a7\uff0c\u5c31\u80fd\u5f97\u5230\u7b97\u6cd5\u6267\u884c\u7684\u65f6\u95f4\u548c\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u3002\u4e3a\u4ec0\u4e48\u8fd8\u8981\u505a\u65f6\u95f4\u3001\u7a7a\u95f4\u590d\u6742\u5ea6\u5206\u6790\u5462\uff1f\u8fd9\u79cd\u5206\u6790\u65b9\u6cd5\u80fd\u6bd4\u6211\u5b9e\u5b9e\u5728\u5728\u8dd1\u4e00\u904d\u5f97\u5230\u7684\u6570\u636e\u66f4\u51c6\u786e\u5417\uff1f\u9996\u5148\uff0c\u6211\u53ef\u4ee5\u80af\u5b9a\u5730\u8bf4\uff0c\u4f60\u8fd9\u79cd\u8bc4\u4f30\u7b97\u6cd5\u6267\u884c\u6548\u7387\u7684\u65b9\u6cd5\u662f\u6b63\u786e\u7684\u3002\u5f88\u591a\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\u4e66\u7c4d\u8fd8\u7ed9\u8fd9\u79cd\u65b9\u6cd5\u8d77\u4e86\u4e00\u4e2a\u540d\u5b57\uff0c\u53eb \u4e8b\u540e\u7edf\u8ba1\u6cd5\u3002\u4f46\u662f\uff0c\u8fd9\u79cd\u7edf\u8ba1\u65b9\u6cd5\u6709\u975e\u5e38\u5927\u7684\u5c40\u9650\u6027\u3002</p> <ul> <li>\u6d4b\u8bd5\u7ed3\u679c\u975e\u5e38\u4f9d\u8d56\u6d4b\u8bd5\u73af\u5883</li> </ul> <p>\u6d4b\u8bd5\u73af\u5883\u4e2d\u786c\u4ef6\u7684\u4e0d\u540c\u4f1a\u5bf9\u6d4b\u8bd5\u7ed3\u679c\u6709\u5f88\u5927\u7684\u5f71\u54cd\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u62ff\u540c\u6837\u4e00\u6bb5\u4ee3\u7801\uff0c\u5206\u522b\u7528 Intel Core i9 \u5904\u7406\u5668\u548c Intel Core i3 \u5904\u7406\u5668\u6765\u8fd0\u884c\uff0c\u4e0d\u7528\u8bf4\uff0ci9 \u5904\u7406\u5668\u8981\u6bd4 i3 \u5904\u7406\u5668\u6267\u884c\u7684\u901f\u5ea6\u5feb\u5f88\u591a\u3002\u8fd8\u6709\uff0c\u6bd4\u5982\u539f\u672c\u5728\u8fd9\u53f0\u673a\u5668\u4e0a a \u4ee3\u7801\u6267\u884c\u7684\u901f\u5ea6\u6bd4 b \u4ee3\u7801\u8981\u5feb\uff0c\u7b49\u6211\u4eec\u6362\u5230\u53e6\u4e00\u53f0\u673a\u5668\u4e0a\u65f6\uff0c\u53ef\u80fd\u4f1a\u6709\u622a\u7136\u76f8\u53cd\u7684\u7ed3\u679c\u3002</p> <ul> <li>\u6d4b\u8bd5\u7ed3\u679c\u53d7\u6570\u636e\u89c4\u6a21\u7684\u5f71\u54cd\u5f88\u5927</li> </ul> <p>\u540e\u9762\u6211\u4eec\u4f1a\u8bb2\u6392\u5e8f\u7b97\u6cd5\uff0c\u6211\u4eec\u5148\u62ff\u5b83\u4e3e\u4e2a\u4f8b\u5b50\u3002\u5bf9\u540c\u4e00\u4e2a\u6392\u5e8f\u7b97\u6cd5\uff0c\u5f85\u6392\u5e8f\u6570\u636e\u7684\u6709\u5e8f\u5ea6\u4e0d\u4e00\u6837\uff0c\u6392\u5e8f\u7684\u6267\u884c\u65f6\u95f4\u5c31\u4f1a\u6709\u5f88\u5927\u7684\u5dee\u522b\u3002\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6570\u636e\u5df2\u7ecf\u662f\u6709\u5e8f\u7684\uff0c\u90a3\u6392\u5e8f\u7b97\u6cd5\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u6267\u884c\u65f6\u95f4\u5c31\u4f1a\u975e\u5e38\u77ed\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5982\u679c\u6d4b\u8bd5\u6570\u636e\u89c4\u6a21\u592a\u5c0f\uff0c\u6d4b\u8bd5\u7ed3\u679c\u53ef\u80fd\u65e0\u6cd5\u771f\u5b9e\u5730\u53cd\u6620\u7b97\u6cd5\u7684\u6027\u80fd\u3002\u6bd4\u5982\uff0c\u5bf9\u4e8e\u5c0f\u89c4\u6a21\u7684\u6570\u636e\u6392\u5e8f\uff0c\u63d2\u5165\u6392\u5e8f\u53ef\u80fd\u53cd\u5012\u4f1a\u6bd4\u5feb\u901f\u6392\u5e8f\u8981\u5feb\uff01</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u4e0d\u7528\u5177\u4f53\u7684\u6d4b\u8bd5\u6570\u636e\u6765\u6d4b\u8bd5\uff0c\u5c31\u53ef\u4ee5\u7c97\u7565\u5730\u4f30\u8ba1\u7b97\u6cd5\u7684\u6267\u884c\u6548\u7387\u7684\u65b9\u6cd5\u3002\u8fd9\u5c31\u662f\u6211\u4eec\u4eca\u5929\u8981\u8bb2\u7684\u65f6\u95f4\u3001\u7a7a\u95f4\u590d\u6742\u5ea6\u5206\u6790\u65b9\u6cd5\u3002</p>"},{"location":"read/beautiful-algo/Complexity%20Analysis/#22-o","title":"2.2 \u5927 O \u590d\u6742\u5ea6\u8868\u793a\u6cd5","text":"<p>\u7b97\u6cd5\u7684\u6267\u884c\u6548\u7387\uff0c\u7c97\u7565\u5730\u8bb2\uff0c\u5c31\u662f\u7b97\u6cd5\u4ee3\u7801\u6267\u884c\u7684\u65f6\u95f4\u3002\u4f46\u662f\uff0c\u5982\u4f55\u5728\u4e0d\u8fd0\u884c\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u7528\u201c\u8089\u773c\u201d\u5f97\u5230\u4e00\u6bb5\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4\u5462\uff1f</p> <p>\u8fd9\u91cc\u6709\u6bb5\u975e\u5e38\u7b80\u5355\u7684\u4ee3\u7801\uff0c\u6c42 1,2,3...n \u7684\u7d2f\u52a0\u548c\u3002\u73b0\u5728\uff0c\u6211\u5c31\u5e26\u4f60\u4e00\u5757\u6765\u4f30\u7b97\u4e00\u4e0b\u8fd9\u6bb5\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4\u3002</p> <pre><code> int cal(int n) {\nint sum = 0;\nint i = 1;\nfor (; i &lt;= n; ++i) {\nsum = sum + i;\n}\nreturn sum;\n}\n</code></pre> <p>\u4ece CPU \u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u6bb5\u4ee3\u7801\u7684\u6bcf\u4e00\u884c\u90fd\u6267\u884c\u7740\u7c7b\u4f3c\u7684\u64cd\u4f5c\uff1a \u8bfb\u6570\u636e-\u8fd0\u7b97-\u5199\u6570\u636e\u3002\u5c3d\u7ba1\u6bcf\u884c\u4ee3\u7801\u5bf9\u5e94\u7684 CPU \u6267\u884c\u7684\u4e2a\u6570\u3001\u6267\u884c\u7684\u65f6\u95f4\u90fd\u4e0d\u4e00\u6837\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u8fd9\u91cc\u53ea\u662f\u7c97\u7565\u4f30\u8ba1\uff0c\u6240\u4ee5\u53ef\u4ee5\u5047\u8bbe\u6bcf\u884c\u4ee3\u7801\u6267\u884c\u7684\u65f6\u95f4\u90fd\u4e00\u6837\uff0c\u4e3a unit_time\u3002\u5728\u8fd9\u4e2a\u5047\u8bbe\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u8fd9\u6bb5\u4ee3\u7801\u7684\u603b\u6267\u884c\u65f6\u95f4\u662f\u591a\u5c11\u5462\uff1f</p> <p>\u7b2c 2\u30013 \u884c\u4ee3\u7801\u5206\u522b\u9700\u8981 1 \u4e2a unit_time \u7684\u6267\u884c\u65f6\u95f4\uff0c\u7b2c 4\u30015 \u884c\u90fd\u8fd0\u884c\u4e86 n \u904d\uff0c\u6240\u4ee5\u9700\u8981 2n*unit_time \u7684\u6267\u884c\u65f6\u95f4\uff0c\u6240\u4ee5\u8fd9\u6bb5\u4ee3\u7801\u603b\u7684\u6267\u884c\u65f6\u95f4\u5c31\u662f (2n+2)*unit_time\u3002\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u6240\u6709\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4 T(n) \u4e0e\u6bcf\u884c\u4ee3\u7801\u7684\u6267\u884c\u6b21\u6570\u6210\u6b63\u6bd4\u3002</p> <p>\u6309\u7167\u8fd9\u4e2a\u5206\u6790\u601d\u8def\uff0c\u6211\u4eec\u518d\u6765\u770b\u8fd9\u6bb5\u4ee3\u7801\u3002</p> <pre><code> int cal(int n) {\nint sum = 0;\nint i = 1;\nint j = 1;\nfor (; i &lt;= n; ++i) {\nj = 1;\nfor (; j &lt;= n; ++j) {\nsum = sum +  i * j;\n}\n}\n}\n</code></pre> <p>\u6211\u4eec\u4f9d\u65e7\u5047\u8bbe\u6bcf\u4e2a\u8bed\u53e5\u7684\u6267\u884c\u65f6\u95f4\u662f unit_time\u3002\u90a3\u8fd9\u6bb5\u4ee3\u7801\u7684\u603b\u6267\u884c\u65f6\u95f4 T(n) \u662f\u591a\u5c11\u5462\uff1f\u7b2c 2\u30013\u30014 \u884c\u4ee3\u7801\uff0c\u6bcf\u884c\u90fd\u9700\u8981 1 \u4e2a unit_time \u7684\u6267\u884c\u65f6\u95f4\uff0c\u7b2c 5\u30016 \u884c\u4ee3\u7801\u5faa\u73af\u6267\u884c\u4e86 n \u904d\uff0c\u9700\u8981 2n * unit_time \u7684\u6267\u884c\u65f6\u95f4\uff0c\u7b2c 7\u30018 \u884c\u4ee3\u7801\u5faa\u73af\u6267\u884c\u4e86 n2\u904d\uff0c\u6240\u4ee5\u9700\u8981 2n2 * unit_time \u7684\u6267\u884c\u65f6\u95f4\u3002\u6240\u4ee5\uff0c\u6574\u6bb5\u4ee3\u7801\u603b\u7684\u6267\u884c\u65f6\u95f4 T(n) = (2n2+2n+3)unit_time\u3002\u5c3d\u7ba1\u6211\u4eec\u4e0d\u77e5\u9053 unit_time \u7684\u5177\u4f53\u503c\uff0c\u4f46\u662f\u901a\u8fc7\u8fd9\u4e24\u6bb5\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u7684\u63a8\u5bfc\u8fc7\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u89c4\u5f8b\uff0c\u90a3\u5c31\u662f\uff0c **\u6240\u6709\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4 T(n) \u4e0e\u6bcf\u884c\u4ee3\u7801\u7684\u6267\u884c\u6b21\u6570 f(n) \u6210\u6b63\u6bd4*\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u89c4\u5f8b\u603b\u7ed3\u6210\u4e00\u4e2a\u516c\u5f0f\u3002</p> <p></p> <p>\u5176\u4e2d\uff0cT(n) \u6211\u4eec\u5df2\u7ecf\u8bb2\u8fc7\u4e86\uff0c\u5b83\u8868\u793a\u4ee3\u7801\u6267\u884c\u7684\u65f6\u95f4\uff1bn \u8868\u793a\u6570\u636e\u89c4\u6a21\u7684\u5927\u5c0f\uff1bf(n) \u8868\u793a\u6bcf\u884c\u4ee3\u7801\u6267\u884c\u7684\u6b21\u6570\u603b\u548c\u3002\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a\u516c\u5f0f\uff0c\u6240\u4ee5\u7528 f(n) \u6765\u8868\u793a\u3002\u516c\u5f0f\u4e2d\u7684 O\uff0c\u8868\u793a\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4 T(n) \u4e0e f(n) \u8868\u8fbe\u5f0f\u6210\u6b63\u6bd4\u3002</p> <p>\u6240\u4ee5\uff0c\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u4e2d\u7684 T(n) = O(2n+2)\uff0c\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u4e2d\u7684 T(n) = O(2n2+2n+3)\u3002\u8fd9\u5c31\u662f \u5927 O \u65f6\u95f4\u590d\u6742\u5ea6\u8868\u793a**\u6cd5\u3002\u5927 O \u65f6\u95f4\u590d\u6742\u5ea6\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5177\u4f53\u8868\u793a\u4ee3\u7801\u771f\u6b63\u7684\u6267\u884c\u65f6\u95f4\uff0c\u800c\u662f\u8868\u793a **\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u968f\u6570\u636e\u89c4\u6a21\u589e\u957f\u7684\u53d8\u5316\u8d8b\u52bf\uff0c\u6240\u4ee5\uff0c\u4e5f\u53eb\u4f5c**\u6e10\u8fdb\u65f6\u95f4\u590d\u6742\u5ea6**\uff08asymptotic time complexity\uff09\uff0c\u7b80\u79f0 \u65f6\u95f4\u590d\u6742\u5ea6\u3002</p> <p>\u5f53 n \u5f88\u5927\u65f6\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u60f3\u8c61\u6210 10000\u3001100000\u3002\u800c\u516c\u5f0f\u4e2d\u7684\u4f4e\u9636\u3001\u5e38\u91cf\u3001\u7cfb\u6570\u4e09\u90e8\u5206\u5e76\u4e0d\u5de6\u53f3\u589e\u957f\u8d8b\u52bf\uff0c\u6240\u4ee5\u90fd\u53ef\u4ee5\u5ffd\u7565\u3002\u6211\u4eec\u53ea\u9700\u8981\u8bb0\u5f55\u4e00\u4e2a\u6700\u5927\u91cf\u7ea7\u5c31\u53ef\u4ee5\u4e86\uff0c\u5982\u679c\u7528\u5927 O \u8868\u793a\u6cd5\u8868\u793a\u521a\u8bb2\u7684\u90a3\u4e24\u6bb5\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u5c31\u53ef\u4ee5\u8bb0\u4e3a\uff1aT(n) = O(n)\uff1b T(n) = O(n2)\u3002</p>"},{"location":"read/beautiful-algo/Complexity%20Analysis/#23","title":"2.3 \u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790","text":"<ul> <li>\u53ea\u5173\u6ce8\u5faa\u73af\u6267\u884c\u6b21\u6570\u6700\u591a\u7684\u4e00\u6bb5\u4ee3\u7801</li> </ul> <p>\u5927 O \u8fd9\u79cd\u590d\u6742\u5ea6\u8868\u793a\u65b9\u6cd5\u53ea\u662f\u8868\u793a\u4e00\u79cd\u53d8\u5316\u8d8b\u52bf\u3002\u6211\u4eec\u901a\u5e38\u4f1a\u5ffd\u7565\u6389\u516c\u5f0f\u4e2d\u7684\u5e38\u91cf\u3001\u4f4e\u9636\u3001\u7cfb\u6570\uff0c\u53ea\u9700\u8981\u8bb0\u5f55\u4e00\u4e2a\u6700\u5927\u9636\u7684\u91cf\u7ea7\u5c31\u53ef\u4ee5\u4e86\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u5206\u6790\u4e00\u4e2a\u7b97\u6cd5\u3001\u4e00\u6bb5\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u65f6\u5019\uff0c\u4e5f\u53ea\u5173\u6ce8\u5faa\u73af\u6267\u884c\u6b21\u6570\u6700\u591a\u7684\u90a3\u4e00\u6bb5\u4ee3\u7801\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u6bb5\u6838\u5fc3\u4ee3\u7801\u6267\u884c\u6b21\u6570\u7684 n \u7684\u91cf\u7ea7\uff0c\u5c31\u662f\u6574\u6bb5\u8981\u5206\u6790\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002</p> <ul> <li>\u52a0\u6cd5\u6cd5\u5219\uff1a\u603b\u590d\u6742\u5ea6\u7b49\u4e8e\u91cf\u7ea7\u6700\u5927\u7684\u90a3\u6bb5\u4ee3\u7801\u7684\u590d\u6742\u5ea6</li> </ul> <p>\u5982\u679c T1(n)=O(f(n))\uff0cT2(n)=O(g(n))\uff1b\u90a3\u4e48 T(n)=T1(n)+T2(n)=max(O(f(n)), O(g(n))) =O(max(f(n), g(n))).</p> <ul> <li>\u4e58\u6cd5\u6cd5\u5219\uff1a\u5d4c\u5957\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u7b49\u4e8e\u5d4c\u5957\u5185\u5916\u4ee3\u7801\u590d\u6742\u5ea6\u7684\u4e58\u79ef</li> </ul> <p>\u5982\u679c T1(n)=O(f(n))\uff0cT2(n)=O(g(n))\uff1b\u90a3\u4e48 T(n)=T1(n)*T2(n)=O(f(n))*O(g(n))=O(f(n)*g(n)).</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5047\u8bbe T1(n) = O(n)\uff0cT2(n) = O(n2)\uff0c\u5219 T1(n) * T2(n) = O(n3)\u3002\u843d\u5b9e\u5230\u5177\u4f53\u7684\u4ee3\u7801\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e58\u6cd5\u6cd5\u5219\u770b\u6210\u662f\u5d4c\u5957\u5faa\u73af</p>"},{"location":"read/beautiful-algo/Complexity%20Analysis/#231","title":"2.3.1 \u51e0\u79cd\u5e38\u89c1\u65f6\u95f4\u590d\u6742\u5ea6","text":"<p>\u5bf9\u4e8e\u521a\u7f57\u5217\u7684\u590d\u6742\u5ea6\u91cf\u7ea7\uff0c\u6211\u4eec\u53ef\u4ee5\u7c97\u7565\u5730\u5206\u4e3a\u4e24\u7c7b\uff0c\u591a\u9879\u5f0f\u91cf\u7ea7\u548c\u975e\u591a\u9879\u5f0f\u91cf\u7ea7\u3002</p> <p>\u5176\u4e2d\uff0c\u975e\u591a\u9879\u5f0f\u91cf\u7ea7\u53ea\u6709\u4e24\u4e2a\uff1aO(2n) \u548c O(n!)\u3002\u6211\u4eec\u628a\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\u975e\u591a\u9879\u5f0f\u91cf\u7ea7\u7684\u7b97\u6cd5\u95ee\u9898\u53eb\u4f5c NP\uff08Non-Deterministic Polynomial\uff0c\u975e\u786e\u5b9a\u591a\u9879\u5f0f\uff09\u95ee\u9898\u3002\u5f53\u6570\u636e\u89c4\u6a21 n \u8d8a\u6765\u8d8a\u5927\u65f6\uff0c\u975e\u591a\u9879\u5f0f\u91cf\u7ea7\u7b97\u6cd5\u7684\u6267\u884c\u65f6\u95f4\u4f1a\u6025\u5267\u589e\u52a0\uff0c\u6c42\u89e3\u95ee\u9898\u7684\u6267\u884c\u65f6\u95f4\u4f1a\u65e0\u9650\u589e\u957f\u3002\u6240\u4ee5\uff0c\u975e\u591a\u9879\u5f0f\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u7b97\u6cd5\u5176\u5b9e\u662f\u975e\u5e38\u4f4e\u6548\u7684\u7b97\u6cd5\u3002</p> <p>\u53ea\u8981\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4\u4e0d\u968f n \u7684\u589e\u5927\u800c\u589e\u957f\uff0c\u8fd9\u6837\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6211\u4eec\u90fd\u8bb0\u4f5c O(1)\u3002\u6216\u8005\u8bf4\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u53ea\u8981\u7b97\u6cd5\u4e2d\u4e0d\u5b58\u5728\u5faa\u73af\u8bed\u53e5\u3001\u9012\u5f52\u8bed\u53e5\uff0c\u5373\u4f7f\u6709\u6210\u5343\u4e0a\u4e07\u884c\u7684\u4ee3\u7801\uff0c\u5176\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f\u039f(1)\u3002</p>"},{"location":"read/beautiful-algo/Complexity%20Analysis/#232","title":"2.3.2 \u7279\u6b8a\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790","text":"<ul> <li>\u6700\u597d\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6</li> </ul> <p>\u5728\u6700\u7406\u60f3\u7684\u60c5\u51b5\u4e0b\uff0c\u6267\u884c\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6</p> <ul> <li>\u6700\u574f\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6</li> </ul> <p>\u5728\u6700\u7cdf\u7cd5\u7684\u60c5\u51b5\u4e0b\uff0c\u6267\u884c\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6</p> <ul> <li>\u5e73\u5747\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6</li> </ul> <p>\u628a\u6bcf\u79cd\u60c5\u51b5\u53d1\u751f\u7684\u6982\u7387\u4e5f\u8003\u8651\u8fdb\u53bb\uff0c\u8fd9\u4e2a\u503c\u5c31\u662f\u6982\u7387\u8bba\u4e2d\u7684\u52a0\u6743\u5e73\u5747\u503c\uff0c\u4e5f\u53eb\u4f5c\u671f\u671b\u503c\uff0c\u6240\u4ee5\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u5168\u79f0\u5e94\u8be5\u53eb\u52a0\u6743\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\u6216\u8005\u671f\u671b\u65f6\u95f4\u590d\u6742\u5ea6\u3002</p> <ul> <li>\u5747\u644a\u65f6\u95f4\u590d\u6742\u5ea6</li> </ul> <p>\u5747\u644a\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u5bf9\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u4e00\u7ec4\u8fde\u7eed\u64cd\u4f5c\u4e2d\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u5f88\u4f4e\uff0c\u53ea\u6709\u4e2a\u522b\u60c5\u51b5\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u6bd4\u8f83\u9ad8\uff0c\u800c\u4e14\u8fd9\u4e9b\u64cd\u4f5c\u4e4b\u95f4\u5b58\u5728\u524d\u540e\u8fde\u8d2f\u7684\u65f6\u5e8f\u5173\u7cfb\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u8fd9\u4e00\u7ec4\u64cd\u4f5c\u653e\u5728\u4e00\u5757\u513f\u5206\u6790\uff0c\u770b\u662f\u5426\u80fd\u5c06\u8f83\u9ad8\u65f6\u95f4\u590d\u6742\u5ea6\u90a3\u6b21\u64cd\u4f5c\u7684\u8017\u65f6\uff0c\u5e73\u644a\u5230\u5176\u4ed6\u90a3\u4e9b\u65f6\u95f4\u590d\u6742\u5ea6\u6bd4\u8f83\u4f4e\u7684\u64cd\u4f5c\u4e0a\u3002\u800c\u4e14\uff0c\u5728\u80fd\u591f\u5e94\u7528\u5747\u644a\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\u7684\u573a\u5408\uff0c\u4e00\u822c\u5747\u644a\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u7b49\u4e8e\u6700\u597d\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u3002</p>"},{"location":"read/beautiful-algo/Complexity%20Analysis/#24","title":"2.4 \u7a7a\u95f4\u590d\u6742\u5ea6\u5206\u6790","text":"<p>\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u5168\u79f0\u662f \u6e10\u8fdb\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u8868\u793a\u7b97\u6cd5\u7684\u6267\u884c\u65f6\u95f4\u4e0e\u6570\u636e\u89c4\u6a21\u4e4b\u95f4\u7684\u589e\u957f\u5173\u7cfb\u3002\u7c7b\u6bd4\u4e00\u4e0b\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u5168\u79f0\u5c31\u662f \u6e10\u8fdb\u7a7a\u95f4\u590d\u6742\u5ea6\uff08asymptotic space complexity\uff09\uff0c\u8868\u793a \u7b97\u6cd5\u7684\u5b58\u50a8\u7a7a\u95f4\u4e0e\u6570\u636e\u89c4\u6a21\u4e4b\u95f4\u7684\u589e\u957f\u5173\u7cfb\u3002</p>"},{"location":"read/beautiful-algo/Red-Black-Tree/","title":"\u7ea2\u9ed1\u6811","text":""},{"location":"read/beautiful-algo/array/","title":"\u6570\u7ec4","text":""},{"location":"read/beautiful-algo/array/#1","title":"1.\u6570\u7ec4","text":"<p>\u6570\u7ec4\uff08Array\uff09\u662f\u4e00\u79cd \u7ebf\u6027\u8868 \u6570\u636e\u7ed3\u6784\u3002\u5b83\u7528\u4e00\u7ec4 \u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4 \uff0c\u6765\u5b58\u50a8\u4e00\u7ec4\u5177\u6709 \u76f8\u540c\u7c7b\u578b\u7684\u6570\u636e\u3002</p>"},{"location":"read/beautiful-algo/array/#11","title":"1.1.\u7ebf\u6027\u8868","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u7ebf\u6027\u8868\u5c31\u662f\u6570\u636e\u6392\u6210\u50cf\u4e00\u6761\u7ebf\u4e00\u6837\u7684\u7ed3\u6784\u3002\u6bcf\u4e2a\u7ebf\u6027\u8868\u4e0a\u7684\u6570\u636e\u6700\u591a\u53ea\u6709\u524d\u548c\u540e\u4e24\u4e2a\u65b9\u5411\u3002\u5176\u5b9e\u9664\u4e86\u6570\u7ec4\uff0c\u94fe\u8868\u3001\u961f\u5217\u3001\u6808\u7b49\u4e5f\u662f\u7ebf\u6027\u8868\u7ed3\u6784\u3002</p> <p></p> <p>\u800c\u4e0e\u5b83\u76f8\u5bf9\u7acb\u7684\u6982\u5ff5\u662f\u975e\u7ebf\u6027\u8868\uff0c\u6bd4\u5982\u4e8c\u53c9\u6811\u3001\u5806\u3001\u56fe\u7b49\u3002\u4e4b\u6240\u4ee5\u53eb\u975e\u7ebf\u6027\uff0c\u662f\u56e0\u4e3a\uff0c\u5728\u975e\u7ebf\u6027\u8868\u4e2d\uff0c\u6570\u636e\u4e4b\u95f4\u5e76\u4e0d\u662f\u7b80\u5355\u7684\u524d\u540e\u5173\u7cfb\u3002</p> <p></p>"},{"location":"read/beautiful-algo/array/#12","title":"1.2.\u5982\u4f55\u5b9e\u73b0\u968f\u673a\u8bbf\u95ee\uff1f","text":"<p>\u6b63\u662f\u56e0\u4e3a \u7ebf\u6027\u8868 \u548c \u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u548c\u76f8\u540c\u7c7b\u578b\u7684\u6570\u636e \u8fd9\u4e24\u4e2a\u9650\u5236\uff0c\u5b83\u624d\u6709\u4e86\u4e00\u4e2a\u582a\u79f0\u201c\u6740\u624b\u950f\u201d\u7684\u7279\u6027\uff1a\u201c\u968f\u673a\u8bbf\u95ee\u201d\u3002\u4f46\u6709\u5229\u5c31\u6709\u5f0a\uff0c\u8fd9\u4e24\u4e2a\u9650\u5236\u4e5f\u8ba9\u6570\u7ec4\u7684\u5f88\u591a\u64cd\u4f5c\u53d8\u5f97\u975e\u5e38\u4f4e\u6548\uff0c\u6bd4\u5982\u8981\u60f3\u5728\u6570\u7ec4\u4e2d\u5220\u9664\u3001\u63d2\u5165\u4e00\u4e2a\u6570\u636e\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8fde\u7eed\u6027\uff0c\u5c31\u9700\u8981\u505a\u5927\u91cf\u7684\u6570\u636e\u642c\u79fb\u5de5\u4f5c\u3002</p> <p>\u6211\u4eec\u62ff\u4e00\u4e2a\u957f\u5ea6\u4e3a 10 \u7684 int \u7c7b\u578b\u7684\u6570\u7ec4 int[] a = new int[10]\u6765\u4e3e\u4f8b\u3002\u5728\u6211\u753b\u7684\u8fd9\u4e2a\u56fe\u4e2d\uff0c\u8ba1\u7b97\u673a\u7ed9\u6570\u7ec4 a[10]\uff0c\u5206\u914d\u4e86\u4e00\u5757\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4 1000\uff5e1039\uff0c\u5176\u4e2d\uff0c\u5185\u5b58\u5757\u7684\u9996\u5730\u5740\u4e3a base_address = 1000\u3002</p> <p></p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u8ba1\u7b97\u673a\u4f1a\u7ed9\u6bcf\u4e2a\u5185\u5b58\u5355\u5143\u5206\u914d\u4e00\u4e2a\u5730\u5740\uff0c\u8ba1\u7b97\u673a\u901a\u8fc7\u5730\u5740\u6765\u8bbf\u95ee\u5185\u5b58\u4e2d\u7684\u6570\u636e\u3002\u5f53\u8ba1\u7b97\u673a\u9700\u8981\u968f\u673a\u8bbf\u95ee\u6570\u7ec4\u4e2d\u7684\u67d0\u4e2a\u5143\u7d20\u65f6\uff0c\u5b83\u4f1a\u9996\u5148\u901a\u8fc7\u4e0b\u9762\u7684\u5bfb\u5740\u516c\u5f0f\uff0c\u8ba1\u7b97\u51fa\u8be5\u5143\u7d20\u5b58\u50a8\u7684\u5185\u5b58\u5730\u5740\uff1a</p> <pre><code>a[i]_address = base_address + i * data_type_size\n</code></pre> <p>\u5176\u4e2d data_type_size \u8868\u793a\u6570\u7ec4\u4e2d\u6bcf\u4e2a\u5143\u7d20\u7684\u5927\u5c0f\u3002\u6211\u4eec\u4e3e\u7684\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0c\u6570\u7ec4\u4e2d\u5b58\u50a8\u7684\u662f int \u7c7b\u578b\u6570\u636e\uff0c\u6240\u4ee5 data_type_size \u5c31\u4e3a 4 \u4e2a\u5b57\u8282\u3002\u8fd9\u4e2a\u516c\u5f0f\u975e\u5e38\u7b80\u5355\uff0c\u6211\u5c31\u4e0d\u591a\u505a\u89e3\u91ca\u4e86\u3002</p> <p>\u8fd9\u91cc\u6211\u8981\u7279\u522b\u7ea0\u6b63\u4e00\u4e2a\u201c\u9519\u8bef\u201d\u3002\u6211\u5728\u9762\u8bd5\u7684\u65f6\u5019\uff0c\u5e38\u5e38\u4f1a\u95ee\u6570\u7ec4\u548c\u94fe\u8868\u7684\u533a\u522b\uff0c\u5f88\u591a\u4eba\u90fd\u56de\u7b54\u8bf4\uff0c\u201c\u94fe\u8868\u9002\u5408\u63d2\u5165\u3001\u5220\u9664\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 O(1)\uff1b\u6570\u7ec4\u9002\u5408\u67e5\u627e\uff0c\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u201d\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u8fd9\u79cd\u8868\u8ff0\u662f\u4e0d\u51c6\u786e\u7684\u3002\u6570\u7ec4\u662f\u9002\u5408\u67e5\u627e\u64cd\u4f5c\uff0c\u4f46\u662f\u67e5\u627e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5e76\u4e0d\u4e3a O(1)\u3002\u5373\u4fbf\u662f\u6392\u597d\u5e8f\u7684\u6570\u7ec4\uff0c\u4f60\u7528\u4e8c\u5206\u67e5\u627e\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f O(logn)\u3002\u6240\u4ee5\uff0c\u6b63\u786e\u7684\u8868\u8ff0\u5e94\u8be5\u662f\uff0c\u6570\u7ec4\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff0c\u6839\u636e\u4e0b\u6807\u968f\u673a\u8bbf\u95ee\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u3002</p>"},{"location":"read/beautiful-algo/array/#13","title":"1.3. \u4f4e\u6548\u7684\u201c\u63d2\u5165\u201d\u548c\u201c\u5220\u9664\u201d","text":"<p>\u6570\u7ec4\u4e3a\u4e86\u4fdd\u6301\u5185\u5b58\u6570\u636e\u7684\u8fde\u7eed\u6027\uff0c\u4f1a\u5bfc\u81f4\u63d2\u5165\u3001\u5220\u9664\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u6bd4\u8f83\u4f4e\u6548\u3002</p>"},{"location":"read/beautiful-algo/array/#131","title":"1.3.1. \u63d2\u5165\u64cd\u4f5c","text":"<p>\u5047\u8bbe\u6570\u7ec4\u7684\u957f\u5ea6\u4e3a n\uff0c\u73b0\u5728\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u5c06\u4e00\u4e2a\u6570\u636e\u63d2\u5165\u5230\u6570\u7ec4\u4e2d\u7684\u7b2c k \u4e2a\u4f4d\u7f6e\u3002\u4e3a\u4e86\u628a\u7b2c k \u4e2a\u4f4d\u7f6e\u817e\u51fa\u6765\uff0c\u7ed9\u65b0\u6765\u7684\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u5c06\u7b2c k\uff5en \u8fd9\u90e8\u5206\u7684\u5143\u7d20\u90fd\u987a\u5e8f\u5730\u5f80\u540e\u632a\u4e00\u4f4d\u3002</p> <p>\u90a3\u63d2\u5165\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u591a\u5c11\u5462\uff1f</p> <p>\u5982\u679c\u5728\u6570\u7ec4\u7684\u672b\u5c3e\u63d2\u5165\u5143\u7d20\uff0c\u90a3\u5c31\u4e0d\u9700\u8981\u79fb\u52a8\u6570\u636e\u4e86\uff0c\u8fd9\u65f6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a<code>O(1)</code>\u3002\u4f46\u5982\u679c\u5728\u6570\u7ec4\u7684\u5f00\u5934\u63d2\u5165\u5143\u7d20\uff0c\u90a3\u6240\u6709\u7684\u6570\u636e\u90fd\u9700\u8981\u4f9d\u6b21\u5f80\u540e\u79fb\u52a8\u4e00\u4f4d\uff0c\u6240\u4ee5\u6700\u574f\u65f6\u95f4\u590d\u6742\u5ea6\u662f<code>O(n)</code>\u3002 \u56e0\u4e3a\u6211\u4eec\u5728\u6bcf\u4e2a\u4f4d\u7f6e\u63d2\u5165\u5143\u7d20\u7684\u6982\u7387\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5e73\u5747\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a<code>(1+2+...n)/n=O(n)</code>\u3002</p> <p>\u5982\u679c\u6570\u7ec4\u4e2d\u7684\u6570\u636e\u662f\u6709\u5e8f\u7684\uff0c\u6211\u4eec\u5728\u67d0\u4e2a\u4f4d\u7f6e\u63d2\u5165\u4e00\u4e2a\u65b0\u7684\u5143\u7d20\u65f6\uff0c\u5c31\u5fc5\u987b\u6309\u7167\u521a\u624d\u7684\u65b9\u6cd5\u642c\u79fb k \u4e4b\u540e\u7684\u6570\u636e\u3002\u4f46\u662f\uff0c\u5982\u679c\u6570\u7ec4\u4e2d\u5b58\u50a8\u7684\u6570\u636e\u5e76\u6ca1\u6709\u4efb\u4f55\u89c4\u5f8b\uff0c\u6570\u7ec4\u53ea\u662f\u88ab\u5f53\u4f5c\u4e00\u4e2a\u5b58\u50a8\u6570\u636e\u7684\u96c6\u5408\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8981\u5c06\u67d0\u4e2a\u6570\u636e\u63d2\u5165\u5230\u7b2c k \u4e2a\u4f4d\u7f6e\uff0c\u4e3a\u4e86\u907f\u514d\u5927\u89c4\u6a21\u7684\u6570\u636e\u642c\u79fb\uff0c\u6211\u4eec\u8fd8\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u529e\u6cd5\u5c31\u662f\uff0c\u76f4\u63a5\u5c06\u7b2c k \u4f4d\u7684\u6570\u636e\u642c\u79fb\u5230\u6570\u7ec4\u5143\u7d20\u7684\u6700\u540e\uff0c\u628a\u65b0\u7684\u5143\u7d20\u76f4\u63a5\u653e\u5165\u7b2c k \u4e2a\u4f4d\u7f6e\u3002</p> <p>\u5229\u7528\u8fd9\u79cd\u5904\u7406\u6280\u5de7\uff0c\u5728\u7279\u5b9a\u573a\u666f\u4e0b\uff0c\u5728\u7b2c k \u4e2a\u4f4d\u7f6e\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u964d\u4e3a O(1)\u3002\u8fd9\u4e2a\u5904\u7406\u601d\u60f3\u5728\u5feb\u6392\u4e2d\u4e5f\u4f1a\u7528\u5230\u3002</p>"},{"location":"read/beautiful-algo/array/#132","title":"1.3.2. \u5220\u9664\u64cd\u4f5c","text":"<p>\u8ddf\u63d2\u5165\u6570\u636e\u7c7b\u4f3c\uff0c\u5982\u679c\u6211\u4eec\u8981\u5220\u9664\u7b2c k \u4e2a\u4f4d\u7f6e\u7684\u6570\u636e\uff0c\u4e3a\u4e86\u5185\u5b58\u7684\u8fde\u7eed\u6027\uff0c\u4e5f\u9700\u8981\u642c\u79fb\u6570\u636e\uff0c\u4e0d\u7136\u4e2d\u95f4\u5c31\u4f1a\u51fa\u73b0\u7a7a\u6d1e\uff0c\u5185\u5b58\u5c31\u4e0d\u8fde\u7eed\u4e86\u3002\u548c\u63d2\u5165\u7c7b\u4f3c\uff0c\u5982\u679c\u5220\u9664\u6570\u7ec4\u672b\u5c3e\u7684\u6570\u636e\uff0c\u5219\u6700\u597d\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a <code>O(1)</code>\uff1b\u5982\u679c\u5220\u9664\u5f00\u5934\u7684\u6570\u636e\uff0c\u5219\u6700\u574f\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a<code>O(n)</code>\uff1b\u5e73\u5747\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u4e3a <code>O(n)</code>\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5728\u67d0\u4e9b\u7279\u6b8a\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e76\u4e0d\u4e00\u5b9a\u975e\u5f97\u8ffd\u6c42\u6570\u7ec4\u4e2d\u6570\u636e\u7684\u8fde\u7eed\u6027\u3002\u5982\u679c\u6211\u4eec\u5c06\u591a\u6b21\u5220\u9664\u64cd\u4f5c\u96c6\u4e2d\u5728\u4e00\u8d77\u6267\u884c\uff0c\u5220\u9664\u7684\u6548\u7387\u662f\u4e0d\u662f\u4f1a\u63d0\u9ad8\u5f88\u591a\u5462\uff1f</p> <p>\u5047\u5982\u6570\u7ec4 a[10]\u4e2d\u5b58\u50a8\u4e86 8 \u4e2a\u5143\u7d20\uff1aa\uff0cb\uff0cc\uff0cd\uff0ce\uff0cf\uff0cg\uff0ch\u3002\u73b0\u5728\uff0c\u6211\u4eec\u8981\u4f9d\u6b21\u5220\u9664 a\uff0cb\uff0cc \u4e09\u4e2a\u5143\u7d20\u3002\u4e3a\u4e86\u907f\u514d d\uff0ce\uff0cf\uff0cg\uff0ch \u8fd9\u51e0\u4e2a\u6570\u636e\u4f1a\u88ab\u642c\u79fb\u4e09\u6b21\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u8bb0\u5f55\u4e0b\u5df2\u7ecf\u5220\u9664\u7684\u6570\u636e\u3002\u6bcf\u6b21\u7684\u5220\u9664\u64cd\u4f5c\u5e76\u4e0d\u662f\u771f\u6b63\u5730\u642c\u79fb\u6570\u636e\uff0c\u53ea\u662f\u8bb0\u5f55\u6570\u636e\u5df2\u7ecf\u88ab\u5220\u9664\u3002\u5f53\u6570\u7ec4\u6ca1\u6709\u66f4\u591a\u7a7a\u95f4\u5b58\u50a8\u6570\u636e\u65f6\uff0c\u6211\u4eec\u518d\u89e6\u53d1\u6267\u884c\u4e00\u6b21\u771f\u6b63\u7684\u5220\u9664\u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u5927\u5927\u51cf\u5c11\u4e86\u5220\u9664\u64cd\u4f5c\u5bfc\u81f4\u7684\u6570\u636e\u642c\u79fb\u3002</p> <p>JVM \u6807\u8bb0\u6e05\u9664\u5783\u573e\u56de\u6536\u7b97\u6cd5\u7684\u6838\u5fc3\u601d\u60f3\u4e5f\u662f\u8fd9\u6837\uff0c\u5f88\u591a\u65f6\u5019\u6211\u4eec\u5e76\u4e0d\u662f\u8981\u53bb\u6b7b\u8bb0\u786c\u80cc\u67d0\u4e2a\u6570\u636e\u7ed3\u6784\u6216\u8005\u7b97\u6cd5\uff0c\u800c\u662f\u8981\u5b66\u4e60\u5b83\u80cc\u540e\u7684\u601d\u60f3\u548c\u5904\u7406\u6280\u5de7\uff0c\u8fd9\u4e9b\u4e1c\u897f\u624d\u662f\u6700\u6709\u4ef7\u503c\u7684\u3002</p>"},{"location":"read/beautiful-algo/array/#2","title":"2. \u5bb9\u5668\u80fd\u5426\u5b8c\u5168\u66ff\u4ee3\u6570\u7ec4\uff1f","text":"<p>\u9488\u5bf9\u6570\u7ec4\u7c7b\u578b\uff0c\u5f88\u591a\u8bed\u8a00\u90fd\u63d0\u4f9b\u4e86\u5bb9\u5668\u7c7b\uff0c\u6bd4\u5982 Java \u4e2d\u7684 <code>ArrayList</code>\u3001C++ STL \u4e2d\u7684 <code>vector</code>\u3002\u5728\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u4ec0\u4e48\u65f6\u5019\u9002\u5408\u7528\u6570\u7ec4\uff0c\u4ec0\u4e48\u65f6\u5019\u9002\u5408\u7528\u5bb9\u5668\u5462\uff1f</p>"},{"location":"read/beautiful-algo/array/#21-arraylist","title":"2.1. ArrayList \u4f18\u52bf","text":"<ol> <li> <p>\u5c06\u5f88\u591a\u6570\u7ec4\u64cd\u4f5c\u7684\u7ec6\u8282\u5c01\u88c5\u8d77\u6765\u3002\u6bd4\u5982\u524d\u9762\u63d0\u5230\u7684\u6570\u7ec4\u63d2\u5165\u3001\u5220\u9664\u6570\u636e\u65f6\u9700\u8981\u642c\u79fb\u5176\u4ed6\u6570\u636e\u7b49\u3002</p> </li> <li> <p>\u652f\u6301\u52a8\u6001\u6269\u5bb9\u3002</p> </li> </ol> <p>\u56e0\u4e3a\u6269\u5bb9\u64cd\u4f5c\u6d89\u53ca\u5185\u5b58\u7533\u8bf7\u548c\u6570\u636e\u642c\u79fb\uff0c\u662f\u6bd4\u8f83\u8017\u65f6\u7684\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4e8b\u5148\u80fd\u786e\u5b9a\u9700\u8981\u5b58\u50a8\u7684\u6570\u636e\u5927\u5c0f\uff0c\u6700\u597d\u5728\u521b\u5efa ArrayList \u7684\u65f6\u5019\u4e8b\u5148\u6307\u5b9a\u6570\u636e\u5927\u5c0f\u3002</p>"},{"location":"read/beautiful-algo/array/#22","title":"2.2. \u6570\u7ec4\u4f7f\u7528\u573a\u666f","text":"<ol> <li><code>Java ArrayList</code> \u65e0\u6cd5\u5b58\u50a8\u57fa\u672c\u7c7b\u578b\uff0c\u6bd4\u5982<code>int</code>\u3001<code>long</code>\uff0c\u9700\u8981\u5c01\u88c5\u4e3a <code>Integer</code>\u3001<code>Long</code>\u7c7b\uff0c\u800c <code>Autoboxing</code>\u3001<code>Unboxing</code> \u5219\u6709\u4e00\u5b9a\u7684\u6027\u80fd\u6d88\u8017\uff0c\u6240\u4ee5\u5982\u679c\u7279\u522b\u5173\u6ce8\u6027\u80fd\uff0c\u6216\u8005\u5e0c\u671b\u4f7f\u7528\u57fa\u672c\u7c7b\u578b\uff0c\u5c31\u53ef\u4ee5\u9009\u7528\u6570\u7ec4\u3002</li> <li>\u5982\u679c\u6570\u636e\u5927\u5c0f\u4e8b\u5148\u5df2\u77e5\uff0c\u5e76\u4e14\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\u975e\u5e38\u7b80\u5355\uff0c\u7528\u4e0d\u5230 <code>ArrayList</code> \u63d0\u4f9b\u7684\u5927\u90e8\u5206\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6570\u7ec4\u3002</li> <li>\u5f53\u8981\u8868\u793a\u591a\u7ef4\u6570\u7ec4\u65f6\uff0c\u7528\u6570\u7ec4\u5f80\u5f80\u4f1a\u66f4\u52a0\u76f4\u89c2\u3002\u6bd4\u5982 <code>Object[][] array</code>\uff1b\u800c\u7528\u5bb9\u5668\u7684\u8bdd\u5219\u9700\u8981\u8fd9\u6837\u5b9a\u4e49\uff1a<code>ArrayList&lt;ArrayList&lt;object&gt;&gt; array</code></li> </ol>"},{"location":"read/beautiful-algo/array/#3-0-1","title":"3. \u95ee\u9898\uff1a \u4e3a\u4ec0\u4e48\u5927\u591a\u6570\u7f16\u7a0b\u8bed\u8a00\u4e2d\uff0c\u6570\u7ec4\u8981\u4ece 0 \u5f00\u59cb\u7f16\u53f7\uff0c\u800c\u4e0d\u662f\u4ece 1 \u5f00\u59cb\u5462\uff1f","text":"<ul> <li>\u51cf\u5c11CPU\u6307\u4ee4</li> </ul> <p>\u4ece\u6570\u7ec4\u5b58\u50a8\u7684\u5185\u5b58\u6a21\u578b\u4e0a\u6765\u770b\uff0c\u201c\u4e0b\u6807\u201d\u6700\u786e\u5207\u7684\u5b9a\u4e49\u5e94\u8be5\u662f\u201c\u504f\u79fb\uff08offset\uff09\u201d\u3002\u524d\u9762\u4e5f\u8bb2\u5230\uff0c\u5982\u679c\u7528 a \u6765\u8868\u793a\u6570\u7ec4\u7684\u9996\u5730\u5740\uff0ca[0]\u5c31\u662f\u504f\u79fb\u4e3a 0 \u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u9996\u5730\u5740\uff0ca[k]\u5c31\u8868\u793a\u504f\u79fb k \u4e2a type_size \u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u8ba1\u7b97 a[k]\u7684\u5185\u5b58\u5730\u5740\u53ea\u9700\u8981\u7528\u8fd9\u4e2a\u516c\u5f0f\uff1a</p> <pre><code>a[k]_address = base_address + k * type_size\n</code></pre> <p>\u4f46\u662f\uff0c\u5982\u679c\u6570\u7ec4\u4ece 1 \u5f00\u59cb\u8ba1\u6570\uff0c\u90a3\u6211\u4eec\u8ba1\u7b97\u6570\u7ec4\u5143\u7d20 a[k]\u7684\u5185\u5b58\u5730\u5740\u5c31\u4f1a\u53d8\u4e3a\uff1a</p> <pre><code>a[k]_address = base_address + (k-1)*type_size\n</code></pre> <p>\u5bf9\u6bd4\u4e24\u4e2a\u516c\u5f0f\uff0c\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff0c\u4ece 1 \u5f00\u59cb\u7f16\u53f7\uff0c\u6bcf\u6b21\u968f\u673a\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\u90fd\u591a\u4e86\u4e00\u6b21\u51cf\u6cd5\u8fd0\u7b97\uff0c\u5bf9\u4e8e CPU \u6765\u8bf4\uff0c\u5c31\u662f**\u591a\u4e86\u4e00\u6b21\u51cf\u6cd5\u6307\u4ee4**\u3002</p> <p>\u6570\u7ec4\u4f5c\u4e3a\u975e\u5e38\u57fa\u7840\u7684\u6570\u636e\u7ed3\u6784\uff0c\u901a\u8fc7\u4e0b\u6807\u968f\u673a\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\u53c8\u662f\u5176\u975e\u5e38\u57fa\u7840\u7684\u7f16\u7a0b\u64cd\u4f5c\uff0c\u6548\u7387\u7684\u4f18\u5316\u5c31\u8981\u5c3d\u53ef\u80fd\u505a\u5230\u6781\u81f4\u3002\u6240\u4ee5\u4e3a\u4e86\u51cf\u5c11\u4e00\u6b21\u51cf\u6cd5\u64cd\u4f5c\uff0c\u6570\u7ec4\u9009\u62e9\u4e86\u4ece 0 \u5f00\u59cb\u7f16\u53f7\uff0c\u800c\u4e0d\u662f\u4ece 1 \u5f00\u59cb\u3002  </p> <ul> <li>\u5386\u53f2\u539f\u56e0</li> </ul> <p>C \u8bed\u8a00\u8bbe\u8ba1\u8005\u7528 0 \u5f00\u59cb\u8ba1\u6570\u6570\u7ec4\u4e0b\u6807\uff0c\u4e4b\u540e\u7684 Java\u3001JavaScript \u7b49\u9ad8\u7ea7\u8bed\u8a00\u90fd\u6548\u4eff\u4e86 C \u8bed\u8a00\uff0c\u6216\u8005\u8bf4\uff0c\u4e3a\u4e86\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u51cf\u5c11 C \u8bed\u8a00\u7a0b\u5e8f\u5458\u5b66\u4e60 Java \u7684\u5b66\u4e60\u6210\u672c\uff0c\u56e0\u6b64\u7ee7\u7eed\u6cbf\u7528\u4e86\u4ece 0 \u5f00\u59cb\u8ba1\u6570\u7684\u4e60\u60ef\u3002\u5b9e\u9645\u4e0a\uff0c\u5f88\u591a\u8bed\u8a00\u4e2d\u6570\u7ec4\u4e5f\u5e76\u4e0d\u662f\u4ece 0 \u5f00\u59cb\u8ba1\u6570\u7684\uff0c\u6bd4\u5982 Matlab\u3002\u751a\u81f3\u8fd8\u6709\u4e00\u4e9b\u8bed\u8a00\u652f\u6301\u8d1f\u6570\u4e0b\u6807\uff0c\u6bd4\u5982 Python\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/","title":"\u6392\u5e8f\u57fa\u7840\u65b9\u6cd5","text":""},{"location":"read/beautiful-algo/basic_sort/#_2","title":"\u5982\u4f55\u5206\u6790\u4e00\u4e2a\u201c\u6392\u5e8f\u7b97\u6cd5\u201d\uff1f","text":""},{"location":"read/beautiful-algo/basic_sort/#_3","title":"\u6392\u5e8f\u7b97\u6cd5\u7684\u6267\u884c\u6548\u7387","text":"<ol> <li> <p>\u6700\u597d\u60c5\u51b5\u3001\u6700\u574f\u60c5\u51b5\u3001\u5e73\u5747\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6</p> </li> <li> <p>\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u7cfb\u6570\u3001\u5e38\u6570 \u3001\u4f4e\u9636</p> </li> </ol> <p>\u6211\u4eec\u77e5\u9053\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53cd\u6620\u7684\u662f\u6570\u636e\u89c4\u6a21 n \u5f88\u5927\u7684\u65f6\u5019\u7684\u4e00\u4e2a\u589e\u957f\u8d8b\u52bf\uff0c\u6240\u4ee5\u5b83\u8868\u793a\u7684\u65f6\u5019\u4f1a\u5ffd\u7565\u7cfb\u6570\u3001\u5e38\u6570\u3001\u4f4e\u9636\u3002\u4f46\u662f\u5b9e\u9645\u7684\u8f6f\u4ef6\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u6392\u5e8f\u7684\u53ef\u80fd\u662f 10 \u4e2a\u3001100 \u4e2a\u30011000 \u4e2a\u8fd9\u6837\u89c4\u6a21\u5f88\u5c0f\u7684\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u5728\u5bf9\u540c\u4e00\u9636\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u6392\u5e8f\u7b97\u6cd5\u6027\u80fd\u5bf9\u6bd4\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u8981\u628a\u7cfb\u6570\u3001\u5e38\u6570\u3001\u4f4e\u9636\u4e5f\u8003\u8651\u8fdb\u6765\u3002</p> <ol> <li>\u6bd4\u8f83\u6b21\u6570\u548c\u4ea4\u6362\uff08\u6216\u79fb\u52a8\uff09\u6b21\u6570</li> </ol> <p>\u200b       \u57fa\u4e8e\u6bd4\u8f83\u7684\u6392\u5e8f\u7b97\u6cd5\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u4f1a\u6d89\u53ca\u4e24\u79cd\u64cd\u4f5c\uff0c\u4e00\u79cd\u662f\u5143\u7d20\u6bd4\u8f83\u5927\u5c0f\uff0c\u53e6\u4e00\u79cd\u662f\u5143\u7d20\u4ea4\u6362\u6216\u79fb\u52a8\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u5728\u5206\u6790\u6392\u5e8f\u7b97\u6cd5\u7684\u6267\u884c\u6548\u7387\u7684\u65f6\u5019\uff0c\u5e94\u8be5\u628a\u6bd4\u8f83\u6b21\u6570\u548c\u4ea4\u6362\uff08\u6216\u79fb\u52a8\uff09\u6b21\u6570\u4e5f\u8003\u8651\u8fdb\u53bb\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/#_4","title":"\u6392\u5e8f\u7b97\u6cd5\u7684\u5185\u5b58\u6d88\u8017","text":"<p>\u539f\u5730\u6392\u5e8f\uff08Sorted in place \uff09: \u7279\u6307\u7a7a\u95f4\u590d\u6742\u5ea6\u662f O(1) \u7684\u6392\u5e8f\u7b97\u6cd5\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/#_5","title":"\u6392\u5e8f\u7b97\u6cd5\u7684\u7a33\u5b9a\u6027","text":"<p>\u7a33\u5b9a\u6027 : \u5982\u679c\u5f85\u6392\u5e8f\u7684\u5e8f\u5217\u4e2d\u5b58\u5728\u503c\u76f8\u7b49\u7684\u5143\u7d20\uff0c\u7ecf\u8fc7\u6392\u5e8f\u4e4b\u540e\uff0c\u76f8\u7b49\u5143\u7d20\u4e4b\u95f4\u539f\u6709\u7684\u5148\u540e\u987a\u5e8f\u4e0d\u53d8\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/#bubble-sort","title":"\u5192\u6ce1\u6392\u5e8f\uff08Bubble Sort\uff09","text":""},{"location":"read/beautiful-algo/basic_sort/#_6","title":"\u539f\u7406","text":"<p>\u5192\u6ce1\u6392\u5e8f\u53ea\u4f1a\u64cd\u4f5c\u76f8\u90bb\u7684\u4e24\u4e2a\u6570\u636e\u3002\u6bcf\u6b21\u5192\u6ce1\u64cd\u4f5c\u90fd\u4f1a\u5bf9\u76f8\u90bb\u7684\u4e24\u4e2a\u5143\u7d20\u8fdb\u884c\u6bd4\u8f83\uff0c\u770b\u662f\u5426\u6ee1\u8db3\u5927\u5c0f\u5173\u7cfb\u8981\u6c42\u3002\u5982\u679c\u4e0d\u6ee1\u8db3\u5c31\u8ba9\u5b83\u4fe9\u4e92\u6362\u3002\u4e00\u6b21\u5192\u6ce1\u4f1a\u8ba9\u81f3\u5c11\u4e00\u4e2a\u5143\u7d20\u79fb\u52a8\u5230\u5b83\u5e94\u8be5\u5728\u7684\u4f4d\u7f6e\uff0c\u91cd\u590d n \u6b21\uff0c\u5c31\u5b8c\u6210\u4e86 n \u4e2a\u6570\u636e\u7684\u6392\u5e8f\u5de5\u4f5c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u8981\u5bf9\u4e00\u7ec4\u6570\u636e 4\uff0c5\uff0c6\uff0c3\uff0c2\uff0c1\uff0c\u4ece\u5c0f\u5230\u5927\u8fdb\u884c\u6392\u5e8f\u3002\u7b2c\u4e00\u6b21\u5192\u6ce1\u64cd\u4f5c\u7684\u8be6\u7ec6\u8fc7\u7a0b\u5c31\u662f\u8fd9\u6837\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u7ecf\u8fc7\u4e00\u6b21\u5192\u6ce1\u64cd\u4f5c\u4e4b\u540e\uff0c6 \u8fd9\u4e2a\u5143\u7d20\u5df2\u7ecf\u5b58\u50a8\u5728\u6b63\u786e\u7684\u4f4d\u7f6e\u4e0a\u3002\u8981\u60f3\u5b8c\u6210\u6240\u6709\u6570\u636e\u7684\u6392\u5e8f\uff0c\u6211\u4eec\u53ea\u8981\u8fdb\u884c 6 \u6b21\u8fd9\u6837\u7684\u5192\u6ce1\u64cd\u4f5c\u5c31\u884c\u4e86\u3002</p> <p></p>"},{"location":"read/beautiful-algo/basic_sort/#_7","title":"\u52a8\u753b\u6f14\u793a","text":""},{"location":"read/beautiful-algo/basic_sort/#_8","title":"\u5b9e\u73b0","text":"<pre><code>// \u5192\u6ce1\u6392\u5e8f\uff0ca\u8868\u793a\u6570\u7ec4\uff0cn\u8868\u793a\u6570\u7ec4\u5927\u5c0f\npublic void bubbleSort(int[] a, int n) {\nif (n &lt;= 1) return;\nfor (int i = 0; i &lt; n; ++i) {\n// \u63d0\u524d\u9000\u51fa\u5192\u6ce1\u5faa\u73af\u7684\u6807\u5fd7\u4f4d\nboolean flag = false;\nfor (int j = 0; j &lt; n - i - 1; ++j) {\nif (a[j] &gt; a[j+1]) { // \u4ea4\u6362\nint tmp = a[j];\na[j] = a[j+1];\na[j+1] = tmp;\nflag = true;  // \u8868\u793a\u6709\u6570\u636e\u4ea4\u6362      \n}\n}\nif (!flag) break;  // \u6ca1\u6709\u6570\u636e\u4ea4\u6362\uff0c\u63d0\u524d\u9000\u51fa\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/basic_sort/#_9","title":"\u5206\u6790","text":"<ol> <li>\u5192\u6ce1\u6392\u5e8f\u662f\u539f\u5730\u6392\u5e8f\u7b97\u6cd5</li> </ol> <p>\u5192\u6ce1\u7684\u8fc7\u7a0b\u53ea\u6d89\u53ca\u76f8\u90bb\u6570\u636e\u7684\u4ea4\u6362\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u5e38\u91cf\u7ea7\u7684\u4e34\u65f6\u7a7a\u95f4\uff0c\u6240\u4ee5\u5b83\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff0c\u662f\u4e00\u4e2a\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\u3002</p> <ol> <li>\u5192\u6ce1\u6392\u5e8f\u662f\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5</li> </ol> <p>\u5728\u5192\u6ce1\u6392\u5e8f\u4e2d\uff0c\u53ea\u6709\u4ea4\u6362\u624d\u53ef\u4ee5\u6539\u53d8\u4e24\u4e2a\u5143\u7d20\u7684\u524d\u540e\u987a\u5e8f\u3002\u4e3a\u4e86\u4fdd\u8bc1\u5192\u6ce1\u6392\u5e8f\u7b97\u6cd5\u7684\u7a33\u5b9a\u6027\uff0c\u5f53\u6709\u76f8\u90bb\u7684\u4e24\u4e2a\u5143\u7d20\u5927\u5c0f\u76f8\u7b49\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e0d\u505a\u4ea4\u6362\uff0c\u76f8\u540c\u5927\u5c0f\u7684\u6570\u636e\u5728\u6392\u5e8f\u524d\u540e\u4e0d\u4f1a\u6539\u53d8\u987a\u5e8f\uff0c\u6240\u4ee5\u5192\u6ce1\u6392\u5e8f\u662f\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5\u3002</p> <ol> <li>\u5192\u6ce1\u6392\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662fO(n^2)</li> </ol> <p>\u6700\u597d\u60c5\u51b5\u4e0b\uff0c\u8981\u6392\u5e8f\u7684\u6570\u636e\u5df2\u7ecf\u662f\u6709\u5e8f\u7684\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u5192\u6ce1\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u7ed3\u675f\u4e86\uff0c\u6240\u4ee5\u6700\u597d\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002\u800c\u6700\u574f\u7684\u60c5\u51b5\u662f\uff0c\u8981\u6392\u5e8f\u7684\u6570\u636e\u521a\u597d\u662f\u5012\u5e8f\u6392\u5217\u7684\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c n \u6b21\u5192\u6ce1\u64cd\u4f5c\uff0c\u6240\u4ee5\u6700\u574f\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n^2)\u3002\u5e73\u5747\u60c5\u51b5\u4e0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n^2)</p> <p>\u200b   </p>"},{"location":"read/beautiful-algo/basic_sort/#insertion-sort","title":"\u63d2\u5165\u6392\u5e8f\uff08Insertion Sort\uff09","text":""},{"location":"read/beautiful-algo/basic_sort/#_10","title":"\u539f\u7406","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u5c06\u6570\u7ec4\u4e2d\u7684\u6570\u636e\u5206\u4e3a\u4e24\u4e2a\u533a\u95f4\uff0c\u5df2\u6392\u5e8f\u533a\u95f4\u548c\u672a\u6392\u5e8f\u533a\u95f4\u3002\u521d\u59cb\u5df2\u6392\u5e8f\u533a\u95f4\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\uff0c\u5c31\u662f\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u3002\u63d2\u5165\u7b97\u6cd5\u7684\u6838\u5fc3\u601d\u60f3\u662f\u53d6\u672a\u6392\u5e8f\u533a\u95f4\u4e2d\u7684\u5143\u7d20\uff0c\u5728\u5df2\u6392\u5e8f\u533a\u95f4\u4e2d\u627e\u5230\u5408\u9002\u7684\u63d2\u5165\u4f4d\u7f6e\u5c06\u5176\u63d2\u5165\uff0c\u5e76\u4fdd\u8bc1\u5df2\u6392\u5e8f\u533a\u95f4\u6570\u636e\u4e00\u76f4\u6709\u5e8f\u3002\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u76f4\u5230\u672a\u6392\u5e8f\u533a\u95f4\u4e2d\u5143\u7d20\u4e3a\u7a7a\uff0c\u7b97\u6cd5\u7ed3\u675f\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u8981\u6392\u5e8f\u7684\u6570\u636e\u662f 4\uff0c5\uff0c6\uff0c1\uff0c3\uff0c2\uff0c\u5176\u4e2d\u5de6\u4fa7\u4e3a\u5df2\u6392\u5e8f\u533a\u95f4\uff0c\u53f3\u4fa7\u662f\u672a\u6392\u5e8f\u533a\u95f4\u3002</p> <p></p> <p>\u63d2\u5165\u6392\u5e8f\u4e5f\u5305\u542b\u4e24\u79cd\u64cd\u4f5c\uff0c\u4e00\u79cd\u662f\u5143\u7d20\u7684\u6bd4\u8f83\uff0c\u4e00\u79cd\u662f\u5143\u7d20\u7684\u79fb\u52a8\u3002\u5f53\u6211\u4eec\u9700\u8981\u5c06\u4e00\u4e2a\u6570\u636e a \u63d2\u5165\u5230\u5df2\u6392\u5e8f\u533a\u95f4\u65f6\uff0c\u9700\u8981\u62ff a \u4e0e\u5df2\u6392\u5e8f\u533a\u95f4\u7684\u5143\u7d20\u4f9d\u6b21\u6bd4\u8f83\u5927\u5c0f\uff0c\u627e\u5230\u5408\u9002\u7684\u63d2\u5165\u4f4d\u7f6e\u3002\u627e\u5230\u63d2\u5165\u70b9\u4e4b\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5c06\u63d2\u5165\u70b9\u4e4b\u540e\u7684\u5143\u7d20\u987a\u5e8f\u5f80\u540e\u79fb\u52a8\u4e00\u4f4d\uff0c\u8fd9\u6837\u624d\u80fd\u817e\u51fa\u4f4d\u7f6e\u7ed9\u5143\u7d20 a \u63d2\u5165\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/#_11","title":"\u52a8\u753b\u6f14\u793a","text":""},{"location":"read/beautiful-algo/basic_sort/#_12","title":"\u5b9e\u73b0","text":"<pre><code>// \u63d2\u5165\u6392\u5e8f\uff0ca\u8868\u793a\u6570\u7ec4\uff0cn\u8868\u793a\u6570\u7ec4\u5927\u5c0f\npublic void insertionSort(int[] a, int n) {\nif (n &lt;= 1) return;\nfor (int i = 1; i &lt; n; ++i) {\nint value = a[i];\nint j = i - 1;\n// \u67e5\u627e\u63d2\u5165\u7684\u4f4d\u7f6e\nfor (; j &gt;= 0; --j) {\nif (a[j] &gt; value) {\na[j+1] = a[j];  // \u6570\u636e\u79fb\u52a8\n} else {\nbreak;\n}\n}\na[j+1] = value; // \u63d2\u5165\u6570\u636e\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/basic_sort/#_13","title":"\u5206\u6790","text":"<ol> <li>\u63d2\u5165\u6392\u5e8f\u662f\u539f\u5730\u6392\u5e8f\u7b97\u6cd5</li> </ol> <p>\u4ece\u5b9e\u73b0\u8fc7\u7a0b\u53ef\u4ee5\u5f88\u660e\u663e\u5730\u770b\u51fa\uff0c\u63d2\u5165\u6392\u5e8f\u7b97\u6cd5\u7684\u8fd0\u884c\u5e76\u4e0d\u9700\u8981\u989d\u5916\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u7a7a\u95f4\u590d\u6742\u5ea6\u662f O(1)\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u662f\u4e00\u4e2a\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\u3002</p> <ol> <li>\u63d2\u5165\u6392\u5e8f\u662f\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5</li> </ol> <p>\u5728\u63d2\u5165\u6392\u5e8f\u4e2d\uff0c\u5bf9\u4e8e\u503c\u76f8\u540c\u7684\u5143\u7d20\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5c06\u540e\u9762\u51fa\u73b0\u7684\u5143\u7d20\uff0c\u63d2\u5165\u5230\u524d\u9762\u51fa\u73b0\u5143\u7d20\u7684\u540e\u9762\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u6301\u539f\u6709\u7684\u524d\u540e\u987a\u5e8f\u4e0d\u53d8\uff0c\u6240\u4ee5\u63d2\u5165\u6392\u5e8f\u662f\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5\u3002</p> <ol> <li>\u63d2\u5165\u6392\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662fO(n^2)</li> </ol>"},{"location":"read/beautiful-algo/basic_sort/#selection-sort","title":"\u9009\u62e9\u6392\u5e8f\uff08Selection Sort\uff09","text":"<p>\u9009\u62e9\u6392\u5e8f\u7b97\u6cd5\u7684\u5b9e\u73b0\u601d\u8def\u6709\u70b9\u7c7b\u4f3c\u63d2\u5165\u6392\u5e8f\uff0c\u4e5f\u5206\u5df2\u6392\u5e8f\u533a\u95f4\u548c\u672a\u6392\u5e8f\u533a\u95f4\u3002\u4f46\u662f\u9009\u62e9\u6392\u5e8f\u6bcf\u6b21\u4f1a\u4ece\u672a\u6392\u5e8f\u533a\u95f4\u4e2d\u627e\u5230\u6700\u5c0f\u7684\u5143\u7d20\uff0c\u5c06\u5176\u653e\u5230\u5df2\u6392\u5e8f\u533a\u95f4\u7684\u672b\u5c3e\u3002</p> <p></p>"},{"location":"read/beautiful-algo/basic_sort/#_14","title":"\u52a8\u753b\u6f14\u793a","text":""},{"location":"read/beautiful-algo/basic_sort/#_15","title":"\u5206\u6790","text":"<p>\u9009\u62e9\u6392\u5e8f\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff0c\u662f\u4e00\u79cd\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\u3002\u9009\u62e9\u6392\u5e8f\u7684\u6700\u597d\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u3001\u6700\u574f\u60c5\u51b5\u548c\u5e73\u5747\u60c5\u51b5\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u4e3a O(n^2)\u3002</p> <p>\u9009\u62e9\u6392\u5e8f\u4e0d\u662f\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5</p> <p>\u4ece\u524d\u9762\u753b\u7684\u90a3\u5f20\u56fe\u4e2d\uff0c\u4f60\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u9009\u62e9\u6392\u5e8f\u6bcf\u6b21\u90fd\u8981\u627e\u5269\u4f59\u672a\u6392\u5e8f\u5143\u7d20\u4e2d\u7684\u6700\u5c0f\u503c\uff0c\u5e76\u548c\u524d\u9762\u7684\u5143\u7d20\u4ea4\u6362\u4f4d\u7f6e\uff0c\u8fd9\u6837\u7834\u574f\u4e86\u7a33\u5b9a\u6027\u3002</p> <p>\u6bd4\u5982 5\uff0c8\uff0c5\uff0c2\uff0c9 \u8fd9\u6837\u4e00\u7ec4\u6570\u636e\uff0c\u4f7f\u7528\u9009\u62e9\u6392\u5e8f\u7b97\u6cd5\u6765\u6392\u5e8f\u7684\u8bdd\uff0c\u7b2c\u4e00\u6b21\u627e\u5230\u6700\u5c0f\u5143\u7d20 2\uff0c\u4e0e\u7b2c\u4e00\u4e2a 5 \u4ea4\u6362\u4f4d\u7f6e\uff0c\u90a3\u7b2c\u4e00\u4e2a 5 \u548c\u4e2d\u95f4\u7684 5 \u987a\u5e8f\u5c31\u53d8\u4e86\uff0c\u6240\u4ee5\u5c31\u4e0d\u7a33\u5b9a\u4e86\u3002\u6b63\u662f\u56e0\u6b64\uff0c\u76f8\u5bf9\u4e8e\u5192\u6ce1\u6392\u5e8f\u548c\u63d2\u5165\u6392\u5e8f\uff0c\u9009\u62e9\u6392\u5e8f\u5c31\u7a0d\u5fae\u900a\u8272\u4e86\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/#merge-sort","title":"\u5f52\u5e76\u6392\u5e8f\uff08Merge Sort\uff09","text":""},{"location":"read/beautiful-algo/basic_sort/#_16","title":"\u539f\u7406","text":"<p>\u5f52\u5e76\u6392\u5e8f\u7684\u6838\u5fc3\u601d\u60f3\u8fd8\u662f\u86ee\u7b80\u5355\u7684\u3002\u5982\u679c\u8981\u6392\u5e8f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6211\u4eec\u5148\u628a\u6570\u7ec4\u4ece\u4e2d\u95f4\u5206\u6210\u524d\u540e\u4e24\u90e8\u5206\uff0c\u7136\u540e\u5bf9\u524d\u540e\u4e24\u90e8\u5206\u5206\u522b\u6392\u5e8f\uff0c\u518d\u5c06\u6392\u597d\u5e8f\u7684\u4e24\u90e8\u5206\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u8fd9\u6837\u6574\u4e2a\u6570\u7ec4\u5c31\u90fd\u6709\u5e8f\u4e86\u3002</p> <p></p> <p>\u5f52\u5e76\u6392\u5e8f\u4f7f\u7528\u7684\u5c31\u662f**\u5206\u6cbb\u601d\u60f3**\u3002\u5206\u6cbb\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u5206\u800c\u6cbb\u4e4b\uff0c\u5c06\u4e00\u4e2a\u5927\u95ee\u9898\u5206\u89e3\u6210\u5c0f\u7684\u5b50\u95ee\u9898\u6765\u89e3\u51b3\u3002\u5c0f\u7684\u5b50\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u5927\u95ee\u9898\u4e5f\u5c31\u89e3\u51b3\u4e86\u3002\u5206\u6cbb\u7b97\u6cd5\u4e00\u822c\u90fd\u662f\u7528\u9012\u5f52\u6765\u5b9e\u73b0\u7684\u3002\u5206\u6cbb\u662f\u4e00\u79cd\u89e3\u51b3\u95ee\u9898\u7684\u5904\u7406\u601d\u60f3\uff0c\u9012\u5f52\u662f\u4e00\u79cd\u7f16\u7a0b\u6280\u5de7\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/#_17","title":"\u52a8\u753b\u6f14\u793a","text":""},{"location":"read/beautiful-algo/basic_sort/#_18","title":"\u5b9e\u73b0","text":"<ol> <li>\u9996\u5148\uff0c \u5148\u5199\u51fa\u5f52\u5e76\u6392\u5e8f\u7684\u9012\u63a8\u516c\u5f0f</li> </ol> <pre><code>\u9012\u63a8\u516c\u5f0f\uff1a\nmerge_sort(p\u2026r) = merge(merge_sort(p\u2026q), merge_sort(q+1\u2026r))\n\u7ec8\u6b62\u6761\u4ef6\uff1a\np &gt;= r \u4e0d\u7528\u518d\u7ee7\u7eed\u5206\u89e3\n</code></pre> <p>merge_sort(p\u2026r) \u8868\u793a\uff0c\u7ed9\u4e0b\u6807\u4ece p \u5230 r \u4e4b\u95f4\u7684\u6570\u7ec4\u6392\u5e8f\u3002\u6211\u4eec\u5c06\u8fd9\u4e2a\u6392\u5e8f\u95ee\u9898\u8f6c\u5316\u4e3a\u4e86\u4e24\u4e2a\u5b50\u95ee\u9898\uff0cmerge_sort(p\u2026q) \u548c merge_sort(q+1\u2026r)\uff0c\u5176\u4e2d\u4e0b\u6807 q \u7b49\u4e8e p \u548c r \u7684\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f (p+r)/2\u3002\u5f53\u4e0b\u6807\u4ece p \u5230 q \u548c\u4ece q+1 \u5230 r \u8fd9\u4e24\u4e2a\u5b50\u6570\u7ec4\u90fd\u6392\u597d\u5e8f\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u5c06\u4e24\u4e2a\u6709\u5e8f\u7684\u5b50\u6570\u7ec4\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u8fd9\u6837\u4e0b\u6807\u4ece p \u5230 r \u4e4b\u95f4\u7684\u6570\u636e\u5c31\u4e5f\u6392\u597d\u5e8f\u4e86\u3002</p> <ol> <li>\u8f6c\u5316\u6210\u4f2a\u4ee3\u7801</li> </ol> <pre><code>// \u5f52\u5e76\u6392\u5e8f\u7b97\u6cd5, A\u662f\u6570\u7ec4\uff0cn\u8868\u793a\u6570\u7ec4\u5927\u5c0f\nmerge_sort(A, n) {\nmerge_sort_c(A, 0, n-1)\n}\n// \u9012\u5f52\u8c03\u7528\u51fd\u6570\nmerge_sort_c(A, p, r) {\n// \u9012\u5f52\u7ec8\u6b62\u6761\u4ef6\nif p &gt;= r  then return\n// \u53d6p\u5230r\u4e4b\u95f4\u7684\u4e2d\u95f4\u4f4d\u7f6eq\nq = (p+r) / 2\n// \u5206\u6cbb\u9012\u5f52\nmerge_sort_c(A, p, q)\nmerge_sort_c(A, q+1, r)\n// \u5c06A[p...q]\u548cA[q+1...r]\u5408\u5e76\u4e3aA[p...r]\nmerge(A[p...r], A[p...q], A[q+1...r])\n}\n</code></pre> <p>merge(A[p...r], A[p...q], A[q+1...r]) \u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u5c31\u662f\uff0c\u5c06\u5df2\u7ecf\u6709\u5e8f\u7684 A[p...q]\u548c A[q+1....r]\u5408\u5e76\u6210\u4e00\u4e2a\u6709\u5e8f\u7684\u6570\u7ec4\uff0c\u5e76\u4e14\u653e\u5165 A[p....r]</p> <pre><code>merge(A[p...r], A[p...q], A[q+1...r]) {\nvar i := p\uff0cj := q+1\uff0ck := 0 // \u521d\u59cb\u5316\u53d8\u91cfi, j, k\nvar tmp := new array[0...r-p] // \u7533\u8bf7\u4e00\u4e2a\u5927\u5c0f\u8ddfA[p...r]\u4e00\u6837\u7684\u4e34\u65f6\u6570\u7ec4\nwhile i&lt;=q AND j&lt;=r do {\nif A[i] &lt;= A[j] {\ntmp[k++] = A[i++] // i++\u7b49\u4e8ei:=i+1\n} else {\ntmp[k++] = A[j++]\n}\n}\n// \u5224\u65ad\u54ea\u4e2a\u5b50\u6570\u7ec4\u4e2d\u6709\u5269\u4f59\u7684\u6570\u636e\nvar start := i\uff0cend := q\nif j&lt;=r then start := j, end:=r\n// \u5c06\u5269\u4f59\u7684\u6570\u636e\u62f7\u8d1d\u5230\u4e34\u65f6\u6570\u7ec4tmp\nwhile start &lt;= end do {\ntmp[k++] = A[start++]\n}\n// \u5c06tmp\u4e2d\u7684\u6570\u7ec4\u62f7\u8d1d\u56deA[p...r]\nfor i:=0 to r-p do {\nA[p+i] = tmp[i]\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/basic_sort/#_19","title":"\u5206\u6790","text":"<ul> <li>\u5f52\u5e76\u6392\u5e8f\u662f\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5</li> </ul> <p>\u5f52\u5e76\u6392\u5e8f\u7a33\u4e0d\u7a33\u5b9a\u5173\u952e\u8981\u770b merge() \u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u4e24\u4e2a\u6709\u5e8f\u5b50\u6570\u7ec4\u5408\u5e76\u6210\u4e00\u4e2a\u6709\u5e8f\u6570\u7ec4\u7684\u90a3\u90e8\u5206\u4ee3\u7801\u3002\u5728\u5408\u5e76\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c A[p...q]\u548c A[q+1...r]\u4e4b\u95f4\u6709\u503c\u76f8\u540c\u7684\u5143\u7d20\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u50cf\u4f2a\u4ee3\u7801\u4e2d\u90a3\u6837\uff0c\u5148\u628a A[p...q]\u4e2d\u7684\u5143\u7d20\u653e\u5165 tmp \u6570\u7ec4\u3002\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u503c\u76f8\u540c\u7684\u5143\u7d20\uff0c\u5728\u5408\u5e76\u524d\u540e\u7684\u5148\u540e\u987a\u5e8f\u4e0d\u53d8\u3002\u6240\u4ee5\uff0c\u5f52\u5e76\u6392\u5e8f\u662f\u4e00\u4e2a\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5\u3002</p> <ul> <li>\u5f52\u5e76\u6392\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(nlogn)</li> </ul> <p>\u5f52\u5e76\u6392\u5e8f\u7684\u6267\u884c\u6548\u7387\u4e0e\u8981\u6392\u5e8f\u7684\u539f\u59cb\u6570\u7ec4\u7684\u6709\u5e8f\u7a0b\u5ea6\u65e0\u5173\uff0c\u6240\u4ee5\u5176\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u975e\u5e38\u7a33\u5b9a\u7684\uff0c\u4e0d\u7ba1\u662f\u6700\u597d\u60c5\u51b5\u3001\u6700\u574f\u60c5\u51b5\uff0c\u8fd8\u662f\u5e73\u5747\u60c5\u51b5\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(nlogn)\u3002</p> <ul> <li>\u5f52\u5e76\u6392\u5e8f\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u662fO(n)</li> </ul> <p>\u5c3d\u7ba1\u6bcf\u6b21\u5408\u5e76\u64cd\u4f5c\u90fd\u9700\u8981\u7533\u8bf7\u989d\u5916\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u4f46\u5728\u5408\u5e76\u5b8c\u6210\u4e4b\u540e\uff0c\u4e34\u65f6\u5f00\u8f9f\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u88ab\u91ca\u653e\u6389\u4e86\u3002\u5728\u4efb\u610f\u65f6\u523b\uff0cCPU \u53ea\u4f1a\u6709\u4e00\u4e2a\u51fd\u6570\u5728\u6267\u884c\uff0c\u4e5f\u5c31\u53ea\u4f1a\u6709\u4e00\u4e2a\u4e34\u65f6\u7684\u5185\u5b58\u7a7a\u95f4\u5728\u4f7f\u7528\u3002\u4e34\u65f6\u5185\u5b58\u7a7a\u95f4\u6700\u5927\u4e5f\u4e0d\u4f1a\u8d85\u8fc7 n \u4e2a\u6570\u636e\u7684\u5927\u5c0f\uff0c\u6240\u4ee5\u7a7a\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002</p>"},{"location":"read/beautiful-algo/basic_sort/#quicksort","title":"\u5feb\u901f\u6392\u5e8f\uff08Quicksort\uff09","text":""},{"location":"read/beautiful-algo/basic_sort/#_20","title":"\u539f\u7406","text":"<p>\u5feb\u6392\u7684\u601d\u60f3\u662f\u8fd9\u6837\u7684\uff1a\u5982\u679c\u8981\u6392\u5e8f\u6570\u7ec4\u4e2d\u4e0b\u6807\u4ece p \u5230 r \u4e4b\u95f4\u7684\u4e00\u7ec4\u6570\u636e\uff0c\u6211\u4eec\u9009\u62e9 p \u5230 r \u4e4b\u95f4\u7684\u4efb\u610f\u4e00\u4e2a\u6570\u636e\u4f5c\u4e3a pivot\uff08\u5206\u533a\u70b9\uff09\u3002</p> <p>\u6211\u4eec\u904d\u5386 p \u5230 r \u4e4b\u95f4\u7684\u6570\u636e\uff0c\u5c06\u5c0f\u4e8e pivot \u7684\u653e\u5230\u5de6\u8fb9\uff0c\u5c06\u5927\u4e8e pivot \u7684\u653e\u5230\u53f3\u8fb9\uff0c\u5c06 pivot \u653e\u5230\u4e2d\u95f4\u3002\u7ecf\u8fc7\u8fd9\u4e00\u6b65\u9aa4\u4e4b\u540e\uff0c\u6570\u7ec4 p \u5230 r \u4e4b\u95f4\u7684\u6570\u636e\u5c31\u88ab\u5206\u6210\u4e86\u4e09\u4e2a\u90e8\u5206\uff0c\u524d\u9762 p \u5230 q-1 \u4e4b\u95f4\u90fd\u662f\u5c0f\u4e8e pivot \u7684\uff0c\u4e2d\u95f4\u662f pivot\uff0c\u540e\u9762\u7684 q+1 \u5230 r \u4e4b\u95f4\u662f\u5927\u4e8e pivot \u7684\u3002</p> <p></p> <p>\u6839\u636e\u5206\u6cbb\u3001\u9012\u5f52\u7684\u5904\u7406\u601d\u60f3\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u9012\u5f52\u6392\u5e8f\u4e0b\u6807\u4ece p \u5230 q-1 \u4e4b\u95f4\u7684\u6570\u636e\u548c\u4e0b\u6807\u4ece q+1 \u5230 r \u4e4b\u95f4\u7684\u6570\u636e\uff0c\u76f4\u5230\u533a\u95f4\u7f29\u5c0f\u4e3a 1\uff0c\u5c31\u8bf4\u660e\u6240\u6709\u7684\u6570\u636e\u90fd\u6709\u5e8f\u4e86\u3002       </p>"},{"location":"read/beautiful-algo/basic_sort/#_21","title":"\u52a8\u753b\u6f14\u793a","text":""},{"location":"read/beautiful-algo/basic_sort/#_22","title":"\u5b9e\u73b0","text":"<ol> <li>\u9012\u63a8\u516c\u5f0f</li> </ol> <pre><code>\u9012\u63a8\u516c\u5f0f\uff1a\nquick_sort(p\u2026r) = quick_sort(p\u2026q-1) + quick_sort(q+1\u2026 r)\n\u7ec8\u6b62\u6761\u4ef6\uff1a\np &gt;= r\n</code></pre> <ol> <li>\u4f2a\u4ee3\u7801</li> </ol> <pre><code>// \u5feb\u901f\u6392\u5e8f\uff0cA\u662f\u6570\u7ec4\uff0cn\u8868\u793a\u6570\u7ec4\u7684\u5927\u5c0f\nquick_sort(A, n) {\nquick_sort_c(A, 0, n-1)\n}\n// \u5feb\u901f\u6392\u5e8f\u9012\u5f52\u51fd\u6570\uff0cp,r\u4e3a\u4e0b\u6807\nquick_sort_c(A, p, r) {\nif p &gt;= r then return\nq = partition(A, p, r) // \u83b7\u53d6\u5206\u533a\u70b9\nquick_sort_c(A, p, q-1)\nquick_sort_c(A, q+1, r)\n}\n</code></pre> <p>\u5f52\u5e76\u6392\u5e8f\u4e2d\u6709\u4e00\u4e2a merge() \u5408\u5e76\u51fd\u6570\uff0c\u6211\u4eec\u8fd9\u91cc\u6709\u4e00\u4e2a partition() \u5206\u533a\u51fd\u6570\u3002partition() \u5206\u533a\u51fd\u6570\u5b9e\u9645\u4e0a\u6211\u4eec\u524d\u9762\u5df2\u7ecf\u8bb2\u8fc7\u4e86\uff0c\u5c31\u662f\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a pivot\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u9009\u62e9 p \u5230 r \u533a\u95f4\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff09\uff0c\u7136\u540e\u5bf9 A[p...r]\u5206\u533a\uff0c\u51fd\u6570\u8fd4\u56de pivot \u7684\u4e0b\u6807\u3002</p> <pre><code>partition(A, p, r) {\npivot := A[r]\ni := p\nfor j := p to r-1 do {\nif A[j] &lt; pivot {\nswap A[i] with A[j]\ni := i+1\n}\n}\nswap A[i] with A[r]\nreturn i\n</code></pre> <p>\u539f\u5730\u5206\u533a\u51fd\u6570\u7684\u5b9e\u73b0\u601d\u8def\u975e\u5e38\u5de7\u5999\uff0c\u8fd9\u91cc\u7684\u5904\u7406\u6709\u70b9\u7c7b\u4f3c\u9009\u62e9\u6392\u5e8f\u3002\u6211\u4eec\u901a\u8fc7\u6e38\u6807 i \u628a A[p...r-1]\u5206\u6210\u4e24\u90e8\u5206\u3002A[p...i-1]\u7684\u5143\u7d20\u90fd\u662f\u5c0f\u4e8e pivot \u7684\uff0c\u6211\u4eec\u6682\u4e14\u53eb\u5b83\u201c\u5df2\u5904\u7406\u533a\u95f4\u201d\uff0cA[i...r-1]\u662f\u201c\u672a\u5904\u7406\u533a\u95f4\u201d\u3002\u6211\u4eec\u6bcf\u6b21\u90fd\u4ece\u672a\u5904\u7406\u7684\u533a\u95f4 A[i...r-1]\u4e2d\u53d6\u4e00\u4e2a\u5143\u7d20 A[j]\uff0c\u4e0e pivot \u5bf9\u6bd4\uff0c\u5982\u679c\u5c0f\u4e8e pivot\uff0c\u5219\u5c06\u5176\u52a0\u5165\u5230\u5df2\u5904\u7406\u533a\u95f4\u7684\u5c3e\u90e8\uff0c\u4e5f\u5c31\u662f A[i]\u7684\u4f4d\u7f6e\u3002</p> <p></p>"},{"location":"read/beautiful-algo/basic_sort/#_23","title":"\u5206\u6790","text":"<ul> <li>\u5feb\u901f\u6392\u5e8f\u4e0d\u662f\u4e00\u4e2a\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5\u3002</li> </ul> <p>\u56e0\u4e3a\u5206\u533a\u7684\u8fc7\u7a0b\u6d89\u53ca\u4ea4\u6362\u64cd\u4f5c\uff0c\u5982\u679c\u6570\u7ec4\u4e2d\u6709\u4e24\u4e2a\u76f8\u540c\u7684\u5143\u7d20\uff0c\u6bd4\u5982\u5e8f\u5217 6\uff0c8\uff0c7\uff0c6\uff0c3\uff0c5\uff0c9\uff0c4\uff0c\u5728\u7ecf\u8fc7\u7b2c\u4e00\u6b21\u5206\u533a\u64cd\u4f5c\u4e4b\u540e\uff0c\u4e24\u4e2a 6 \u7684\u76f8\u5bf9\u5148\u540e\u987a\u5e8f\u5c31\u4f1a\u6539\u53d8\u3002\u6240\u4ee5\uff0c\u5feb\u901f\u6392\u5e8f\u5e76\u4e0d\u662f\u4e00\u4e2a\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5\u3002</p> <ul> <li>\u5feb\u6392\u662f\u539f\u5730\u6392\u5e8f\u7b97\u6cd5</li> </ul> <p>\u5206\u533a\u51fd\u6570\u501f\u52a9\u4ea4\u6362\u601d\u60f3\uff0c\u53ea\u9700\u8981\u5c06 A[i]\u4e0e A[j]\u4ea4\u6362\uff0c\u5c31\u53ef\u4ee5\u5728 O(1) \u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5c06 A[j]\u653e\u5230\u4e0b\u6807\u4e3a i \u7684\u4f4d\u7f6e\u3002</p> <ul> <li>\u5feb\u901f\u6392\u5e8f\u65f6\u95f4\u590d\u6742\u5ea6\u662fO(nlogn)</li> </ul> <p>\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u53ef\u4ee5\u505a\u5230 O(nlogn)\uff0c\u53ea\u6709\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u9000\u5316\u5230 O(n2)</p>"},{"location":"read/beautiful-algo/basic_sort/#_24","title":"\u5feb\u6392\u548c\u5f52\u5e76\u7684\u533a\u522b","text":"<p>\u5feb\u6392\u548c\u5f52\u5e76\u7528\u7684\u90fd\u662f\u5206\u6cbb\u601d\u60f3\uff0c\u9012\u63a8\u516c\u5f0f\u548c\u9012\u5f52\u4ee3\u7801\u4e5f\u975e\u5e38\u76f8\u4f3c\uff0c\u90a3\u5b83\u4eec\u7684\u533a\u522b\u5728\u54ea\u91cc\u5462\uff1f</p> <ol> <li>\u5f52\u5e76\u6392\u5e8f\u7684\u5904\u7406\u8fc7\u7a0b\u662f\u7531\u4e0b\u5230\u4e0a\u7684\uff0c\u5148\u5904\u7406\u5b50\u95ee\u9898\uff0c\u7136\u540e\u518d\u5408\u5e76\u3002\u800c\u5feb\u6392\u6b63\u597d\u76f8\u53cd\uff0c\u5b83\u7684\u5904\u7406\u8fc7\u7a0b\u662f\u7531\u4e0a\u5230\u4e0b\u7684\uff0c\u5148\u5206\u533a\uff0c\u7136\u540e\u518d\u5904\u7406\u5b50\u95ee\u9898\u3002</li> <li>\u5f52\u5e76\u6392\u5e8f\u867d\u7136\u662f\u7a33\u5b9a\u7684\u3001\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(nlogn) \u7684\u6392\u5e8f\u7b97\u6cd5\uff0c\u4f46\u662f\u5b83\u662f\u975e\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\u3002\u5f52\u5e76\u4e4b\u6240\u4ee5\u662f\u975e\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\uff0c\u4e3b\u8981\u539f\u56e0\u662f\u5408\u5e76\u51fd\u6570\u65e0\u6cd5\u5728\u539f\u5730\u6267\u884c\u3002\u5feb\u901f\u6392\u5e8f\u901a\u8fc7\u8bbe\u8ba1\u5de7\u5999\u7684\u539f\u5730\u5206\u533a\u51fd\u6570\uff0c\u53ef\u4ee5\u5b9e\u73b0\u539f\u5730\u6392\u5e8f\uff0c\u89e3\u51b3\u4e86\u5f52\u5e76\u6392\u5e8f\u5360\u7528\u592a\u591a\u5185\u5b58\u7684\u95ee\u9898\u3002\u6b63\u56e0\u4e3a\u6b64\uff0c\u5f52\u5e76\u6392\u5e8f\u4e5f\u6ca1\u6709\u5feb\u6392\u5e94\u7528\u5e7f\u6cdb\u3002</li> </ol> <p>\u200b   </p>"},{"location":"read/beautiful-algo/binary-tree/","title":"\u4e8c\u53c9\u6811","text":""},{"location":"read/beautiful-algo/binary-tree/#tree","title":"\u6811\uff08Tree\uff09","text":"<p>\u6811\u662f\u4e00\u79cd\u975e\u7ebf\u6027\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u662f\u7531 n(n&gt;=0) \u4e2a\u6709\u9650\u8282\u70b9\u7ec4\u6210\u4e00\u4e2a\u5177\u6709\u5c42\u6b21\u5173\u7cfb\u7684\u96c6\u5408\u3002 </p> <p></p> <p>\u8fd9\u91cc\u9762\u6bcf\u4e2a\u5143\u7d20\u6211\u4eec\u53eb\u505a\u201c\u8282\u70b9\u201d\uff1b\u7528\u6765\u8fde\u63a5\u76f8\u90bb\u8282\u70b9\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u6211\u4eec\u53eb\u505a\u201c\u7236\u5b50\u5173\u7cfb\u201d\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u5e45\u56fe\uff0cA \u8282\u70b9\u5c31\u662f B \u8282\u70b9\u7684\u7236\u8282\u70b9\uff0cB \u8282\u70b9\u662f A \u8282\u70b9\u7684\u5b50\u8282\u70b9\u3002B\u3001C\u3001D \u8fd9\u4e09\u4e2a\u8282\u70b9\u7684\u7236\u8282\u70b9\u662f\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u5b83\u4eec\u4e4b\u95f4\u4e92\u79f0\u4e3a\u5144\u5f1f\u8282\u70b9\u3002\u6211\u4eec\u628a\u6ca1\u6709\u7236\u8282\u70b9\u7684\u8282\u70b9\u53eb\u505a\u6839\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u56fe\u4e2d\u7684\u8282\u70b9 E\u3002\u6211\u4eec\u628a\u6ca1\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9\u53eb\u505a\u53f6\u5b50\u8282\u70b9\u6216\u8005\u53f6\u8282\u70b9\uff0c\u6bd4\u5982\u56fe\u4e2d\u7684 G\u3001H\u3001I\u3001J\u3001K\u3001L \u90fd\u662f\u53f6\u5b50\u8282\u70b9\u3002</p> <p></p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5173\u4e8e\u201c\u6811\u201d\uff0c\u8fd8\u6709\u4e09\u4e2a\u6bd4\u8f83\u76f8\u4f3c\u7684\u6982\u5ff5\uff1a\u9ad8\u5ea6\uff08Height\uff09\u3001\u6df1\u5ea6\uff08Depth\uff09\u3001\u5c42\uff08Level\uff09\u3002\u5b83\u4eec\u7684\u5b9a\u4e49\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5982\u4e0b\u56fe</p> <p></p>"},{"location":"read/beautiful-algo/binary-tree/#binary-tree","title":"\u4e8c\u53c9\u6811\uff08Binary Tree\uff09","text":"<p>\u6811\u7ed3\u6784\u591a\u79cd\u591a\u6837\uff0c\u4e0d\u8fc7\u6211\u4eec\u6700\u5e38\u7528\u8fd8\u662f\u4e8c\u53c9\u6811\u3002</p> <p>\u4e8c\u53c9\u6811\u662f\u6bcf\u4e2a\u8282\u70b9\u6700\u591a\u6709\u4e24\u4e2a\u5b50\u6811\u7684\u6811\u7ed3\u6784\u3002\u901a\u5e38\u5b50\u6811\u88ab\u79f0\u4f5c\u201c\u5de6\u5b50\u6811\u201d\uff08left subtree\uff09\u548c\u201c\u53f3\u5b50\u6811\u201d\uff08right subtree\uff09\u3002</p> <p></p> <ul> <li>\u6ee1\u4e8c\u53c9\u6811\uff08Full Binary Tree\uff09</li> </ul> <p>\u5982\u679c\u4e00\u68f5\u4e8c\u53c9\u6811\u7684\u6240\u6709\u975e\u53f6\u5b50\u8282\u70b9\u90fd\u6709\u5de6\u53f3\u4e24\u4e2a\u5b50\u8282\u70b9\uff0c\u5e76\u4e14\u6240\u6709\u53f6\u5b50\u8282\u70b9\u90fd\u5728\u540c\u4e00\u5c42\u4e0a\uff0c\u90a3\u4e48\u8fd9\u68f5\u4e8c\u53c9\u6811\u5c31\u662f\u6ee1\u4e8c\u53c9\u6811\u3002\u5982\u4e0a\u9762\u7684\u7f16\u53f7 2</p> <ul> <li>\u5b8c\u5168\u4e8c\u53c9\u6811\uff08Complete Binary Tree\uff09</li> </ul> <p>\u5982\u679c\u4e00\u68f5\u4e8c\u53c9\u6811\u7684\u6240\u6709\u53f6\u5b50\u8282\u70b9\u90fd\u5728\u6700\u540e\u4e24\u5c42\u4e0a\uff0c\u5e76\u4e14\u6700\u540e\u4e00\u5c42\u7684\u53f6\u5b50\u8282\u70b9\u90fd\u96c6\u4e2d\u5728\u8be5\u5c42\u6700\u5de6\u8fb9\u7684\u82e5\u5e72\u4f4d\u7f6e\u7684\u4e8c\u53c9\u6811\uff0c\u90a3\u4e48\u8fd9\u68f5\u4e8c\u53c9\u6811\u5c31\u662f\u5b8c\u5168\u4e8c\u53c9\u6811\u3002\u5982\u4e0a\u9762\u7684\u7f16\u53f7 3</p>"},{"location":"read/beautiful-algo/binary-tree/#_2","title":"\u5982\u4f55\u8868\u793a\uff08\u6216\u8005\u5b58\u50a8\uff09\u4e00\u68f5\u4e8c\u53c9\u6811","text":"<p>\u60f3\u8981\u5b58\u50a8\u4e00\u68f5\u4e8c\u53c9\u6811\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u65b9\u6cd5\uff0c\u4e00\u79cd\u662f \u57fa\u4e8e\u6307\u9488\u6216\u8005\u5f15\u7528\u7684\u4e8c\u53c9\u94fe\u5f0f\u5b58\u50a8\u6cd5\uff0c\u4e00\u79cd\u662f \u57fa\u4e8e\u6570\u7ec4\u7684\u987a\u5e8f\u5b58\u50a8\u6cd5\u3002</p>"},{"location":"read/beautiful-algo/binary-tree/#_3","title":"\u94fe\u5f0f\u5b58\u50a8\u6cd5","text":"<p>\u94fe\u5f0f\u5b58\u50a8\u6cd5\u662f\u6211\u4eec\u6700\u5e38\u7528\u7684\u65b9\u6cd5\uff0c\u4e5f\u662f\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u3002\u6211\u4eec\u53ea\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u4e8c\u53c9\u6811\u7684\u8282\u70b9\u7c7b\uff0c\u7136\u540e\u7528\u6307\u9488\u6216\u8005\u5f15\u7528\u6765\u8fde\u63a5\u8fd9\u4e9b\u8282\u70b9\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p></p>"},{"location":"read/beautiful-algo/binary-tree/#_4","title":"\u57fa\u4e8e\u6570\u7ec4\u7684\u987a\u5e8f\u5b58\u50a8\u6cd5","text":"<p>\u987a\u5e8f\u5b58\u50a8\u6cd5\u662f\u4e00\u79cd\u6bd4\u8f83\u7279\u6b8a\u7684\u5b58\u50a8\u65b9\u6cd5\uff0c\u5b83**\u53ea\u9002\u7528\u4e8e\u5b8c\u5168\u4e8c\u53c9\u6811**\u3002\u6211\u4eec\u628a\u6839\u8282\u70b9\u5b58\u50a8\u5728\u4e0b\u6807 i = 1 \u7684\u4f4d\u7f6e\uff0c\u90a3\u5de6\u5b50\u8282\u70b9\u5b58\u50a8\u5728\u4e0b\u6807 2 * i = 2 \u7684\u4f4d\u7f6e\uff0c\u53f3\u5b50\u8282\u70b9\u5b58\u50a8\u5728 2 * i + 1 = 3 \u7684\u4f4d\u7f6e\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0cB \u8282\u70b9\u7684\u5de6\u5b50\u8282\u70b9\u5b58\u50a8\u5728 2 * i = 2 * 2 = 4 \u7684\u4f4d\u7f6e\uff0c\u53f3\u5b50\u8282\u70b9\u5b58\u50a8\u5728 2 * i + 1 = 2 * 2 + 1 = 5 \u7684\u4f4d\u7f6e\u3002</p> <p></p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u53ea\u8981\u77e5\u9053\u6839\u8282\u70b9\u5b58\u50a8\u7684\u4f4d\u7f6e\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8ba1\u7b97\u5b50\u8282\u70b9\uff0c\u6839\u8282\u70b9\u4f1a\u5b58\u50a8\u5728\u4e0b\u6807\u4e3a 1 \u7684\u4f4d\u7f6e\uff09\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e0b\u6807\u8ba1\u7b97\uff0c\u628a\u6574\u68f5\u6811\u90fd\u4e32\u8d77\u6765\u3002</p> <p>\u5982\u679c\u662f\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c\u4ec5\u4ec5\u201c\u6d6a\u8d39\u201d\u4e86\u4e00\u4e2a\u4e0b\u6807\u4e3a 0 \u7684\u5b58\u50a8\u4f4d\u7f6e\u3002\u5982\u679c\u662f\u975e\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c\u5176\u5b9e\u4f1a\u6d6a\u8d39\u6bd4\u8f83\u591a\u7684\u6570\u7ec4\u5b58\u50a8\u7a7a\u95f4\u3002 </p> <p></p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u67d0\u68f5\u4e8c\u53c9\u6811\u662f\u4e00\u68f5\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c\u90a3\u7528\u6570\u7ec4\u5b58\u50a8\u65e0\u7591\u662f\u6700\u8282\u7701\u5185\u5b58\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u56e0\u4e3a\u6570\u7ec4\u7684\u5b58\u50a8\u65b9\u5f0f\u5e76\u4e0d\u9700\u8981\u50cf\u94fe\u5f0f\u5b58\u50a8\u6cd5\u90a3\u6837\uff0c\u8981\u5b58\u50a8\u989d\u5916\u7684\u5de6\u53f3\u5b50\u8282\u70b9\u7684\u6307\u9488\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u5b8c\u5168\u4e8c\u53c9\u6811\u4f1a\u5355\u72ec\u62ce\u51fa\u6765\u7684\u539f\u56e0\uff0c\u4e5f\u662f\u4e3a\u4ec0\u4e48\u5b8c\u5168\u4e8c\u53c9\u6811\u8981\u6c42\u6700\u540e\u4e00\u5c42\u7684\u5b50\u8282\u70b9\u90fd\u9760\u5de6\u7684\u539f\u56e0\u3002</p>"},{"location":"read/beautiful-algo/binary-tree/#_5","title":"\u4e8c\u53c9\u6811\u7684\u904d\u5386","text":"<p>\u4e8c\u53c9\u6811\u7684\u904d\u5386\u662f\u6307\uff0c\u4ece\u6839\u8282\u70b9\u51fa\u53d1\uff0c\u6309\u7167\u67d0\u79cd\u6b21\u5e8f\u4f9d\u6b21\u8bbf\u95ee\u4e8c\u53c9\u6811\u4e2d\u6240\u6709\u8282\u70b9\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u8282\u70b9\u88ab\u8bbf\u95ee\u4e00\u6b21\u4e14\u4ec5\u88ab\u8bbf\u95ee\u4e00\u6b21\u3002\u4e8c\u53c9\u6811\u7684\u904d\u5386\u6709\u4e09\u79cd\u65b9\u5f0f\uff0c\u5206\u522b\u662f\u524d\u5e8f\u904d\u5386\u3001\u4e2d\u5e8f\u904d\u5386\u548c\u540e\u5e8f\u904d\u5386\u3002</p> <ul> <li> <p>\u524d\u5e8f\u904d\u5386\u662f\u6307\uff0c\u5bf9\u4e8e\u6811\u4e2d\u7684\u4efb\u610f\u8282\u70b9\u6765\u8bf4\uff0c\u5148\u6253\u5370\u8fd9\u4e2a\u8282\u70b9\uff0c\u7136\u540e\u518d\u6253\u5370\u5b83\u7684\u5de6\u5b50\u6811\uff0c\u6700\u540e\u6253\u5370\u5b83\u7684\u53f3\u5b50\u6811\u3002</p> </li> <li> <p>\u4e2d\u5e8f\u904d\u5386\u662f\u6307\uff0c\u5bf9\u4e8e\u6811\u4e2d\u7684\u4efb\u610f\u8282\u70b9\u6765\u8bf4\uff0c\u5148\u6253\u5370\u5b83\u7684\u5de6\u5b50\u6811\uff0c\u7136\u540e\u518d\u6253\u5370\u5b83\u672c\u8eab\uff0c\u6700\u540e\u6253\u5370\u5b83\u7684\u53f3\u5b50\u6811\u3002</p> </li> <li> <p>\u540e\u5e8f\u904d\u5386\u662f\u6307\uff0c\u5bf9\u4e8e\u6811\u4e2d\u7684\u4efb\u610f\u8282\u70b9\u6765\u8bf4\uff0c\u5148\u6253\u5370\u5b83\u7684\u5de6\u5b50\u6811\uff0c\u7136\u540e\u518d\u6253\u5370\u5b83\u7684\u53f3\u5b50\u6811\uff0c\u6700\u540e\u6253\u5370\u8fd9\u4e2a\u8282\u70b9\u672c\u8eab\u3002</p> </li> </ul> <p></p> <p>\u5b9e\u9645\u4e0a\uff0c\u4e8c\u53c9\u6811\u7684\u524d\u3001\u4e2d\u3001\u540e\u5e8f\u904d\u5386\u5c31\u662f\u4e00\u4e2a\u9012\u5f52\u7684\u8fc7\u7a0b\u3002 \u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>void preOrder(Node* root) {\nif (root == null) return;\nprint root // \u6b64\u5904\u4e3a\u4f2a\u4ee3\u7801\uff0c\u8868\u793a\u6253\u5370root\u8282\u70b9\npreOrder(root-&gt;left);\npreOrder(root-&gt;right);\n}\nvoid inOrder(Node* root) {\nif (root == null) return;\ninOrder(root-&gt;left);\nprint root // \u6b64\u5904\u4e3a\u4f2a\u4ee3\u7801\uff0c\u8868\u793a\u6253\u5370root\u8282\u70b9\ninOrder(root-&gt;right);\n}\nvoid postOrder(Node* root) {\nif (root == null) return;\npostOrder(root-&gt;left);\npostOrder(root-&gt;right);\nprint root // \u6b64\u5904\u4e3a\u4f2a\u4ee3\u7801\uff0c\u8868\u793a\u6253\u5370root\u8282\u70b9\n}\n</code></pre> <p>\u4ece\u524d\u9762\u753b\u7684\u524d\u3001\u4e2d\u3001\u540e\u5e8f\u904d\u5386\u7684\u987a\u5e8f\u56fe\uff0c\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u6bcf\u4e2a\u8282\u70b9\u6700\u591a\u4f1a\u88ab\u8bbf\u95ee\u4e24\u6b21\uff0c\u6240\u4ee5\u904d\u5386\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u8ddf\u8282\u70b9\u7684\u4e2a\u6570 n \u6210\u6b63\u6bd4\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e8c\u53c9\u6811\u904d\u5386\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002</p>"},{"location":"read/beautiful-algo/binary-tree/#binary-search-tree","title":"\u4e8c\u53c9\u67e5\u627e\u6811\uff08Binary Search Tree\uff09","text":"<p>\u4e8c\u53c9\u67e5\u627e\u6811\uff08Binary Search Tree\uff09\uff0c\u4e5f\u79f0\u4e8c\u53c9\u641c\u7d22\u6811\u3001\u6709\u5e8f\u4e8c\u53c9\u6811\uff08Ordered Binary Tree\uff09\u3001\u6392\u5e8f\u4e8c\u53c9\u6811\uff08Sorted Binary Tree\uff09\uff0c\u662f\u6307\u4e00\u68f5\u7a7a\u6811\u6216\u8005\u5177\u6709\u4e0b\u5217\u6027\u8d28\u7684\u4e8c\u53c9\u6811\uff1a</p> <ul> <li> <p>\u5de6\u5b50\u6811\u4e0a\u6240\u6709\u8282\u70b9\u7684\u503c\u5747\u5c0f\u4e8e\u5b83\u7684\u6839\u8282\u70b9\u7684\u503c\uff1b</p> </li> <li> <p>\u53f3\u5b50\u6811\u4e0a\u6240\u6709\u8282\u70b9\u7684\u503c\u5747\u5927\u4e8e\u5b83\u7684\u6839\u8282\u70b9\u7684\u503c\uff1b</p> </li> <li> <p>\u4ee5\u6b64\u7c7b\u63a8\uff1a\u5de6\u3001\u53f3\u5b50\u6811\u4e5f\u5206\u522b\u4e3a\u4e8c\u53c9\u67e5\u627e\u6811\u3002</p> </li> </ul> <p></p> <p>\u987e\u540d\u601d\u4e49\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u662f\u4e3a\u4e86\u5b9e\u73b0\u5feb\u901f\u67e5\u627e\u800c\u751f\u7684\u3002\u4e0d\u8fc7\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u652f\u6301\u5feb\u901f\u67e5\u627e\u4e00\u4e2a\u6570\u636e\uff0c\u8fd8\u652f\u6301\u5feb\u901f\u63d2\u5165\u3001\u5220\u9664\u4e00\u4e2a\u6570\u636e\u3002</p>"},{"location":"read/beautiful-algo/binary-tree/#_6","title":"\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u67e5\u627e\u64cd\u4f5c","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u770b\u5982\u4f55\u5728\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u67e5\u627e\u4e00\u4e2a\u8282\u70b9\u3002\u6211\u4eec\u5148\u53d6\u6839\u8282\u70b9\uff0c\u5982\u679c\u5b83\u7b49\u4e8e\u6211\u4eec\u8981\u67e5\u627e\u7684\u6570\u636e\uff0c\u90a3\u5c31\u8fd4\u56de\u3002\u5982\u679c\u8981\u67e5\u627e\u7684\u6570\u636e\u6bd4\u6839\u8282\u70b9\u7684\u503c\u5c0f\uff0c\u90a3\u5c31\u5728\u5de6\u5b50\u6811\u4e2d\u9012\u5f52\u67e5\u627e\uff1b\u5982\u679c\u8981\u67e5\u627e\u7684\u6570\u636e\u6bd4\u6839\u8282\u70b9\u7684\u503c\u5927\uff0c\u90a3\u5c31\u5728\u53f3\u5b50\u6811\u4e2d\u9012\u5f52\u67e5\u627e\u3002</p> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code> public static class Node { private int data; private Node left; private Node right;\npublic Node(int data) { this.data = data; }\n}\n//\u9012\u5f52\u5b9e\u73b0\nNode searchBST(Node root, int val) {\nif (root == null) return null;\nif (root.data == val) return root;\nelse if (val &lt; root.data) return searchBST(root.left, val);\nelse return searchBST(root.right, val);\n}\n//\u975e\u9012\u5f52\u5b9e\u73b0\nNode searchBST(Node root, int val) {\nwhile (root != null) {\nif (root.data == val) return root;\nelse if (val &lt; root.data) root = root.left;\nelse root = root.right;\n}\nreturn null;\n}\n</code></pre>"},{"location":"read/beautiful-algo/binary-tree/#_7","title":"\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u63d2\u5165\u64cd\u4f5c","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u627e\u5230\u4e00\u4e2a\u7a7a\u7684\u4f4d\u7f6e\uff0c\u5c06\u65b0\u7684\u8282\u70b9\u63d2\u5165\u8fdb\u53bb\u3002\u5982\u679c\u8981\u63d2\u5165\u7684\u6570\u636e\u6bd4\u6839\u8282\u70b9\u7684\u503c\u5c0f\uff0c\u90a3\u5c31\u5728\u5de6\u5b50\u6811\u4e2d\u9012\u5f52\u67e5\u627e\uff1b\u5982\u679c\u8981\u63d2\u5165\u7684\u6570\u636e\u6bd4\u6839\u8282\u70b9\u7684\u503c\u5927\uff0c\u90a3\u5c31\u5728\u53f3\u5b50\u6811\u4e2d\u9012\u5f52\u67e5\u627e\u3002</p> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>    // \u9012\u5f52\u5b9e\u73b0\nNode insertIntoBST(Node root, int val) {\nif (root == null) return new Node(val);\nif (val &lt; root.data) root.left = insertIntoBST(root.left, val);\nelse root.right = insertIntoBST(root.right, val);\nreturn root;\n}\n// \u975e\u9012\u5f52\u5b9e\u73b0\nNode insertIntoBST(Node root, int val) {\nif (root == null) return new Node(val);\nNode cur = root;\nwhile (cur != null) {\nif (val &lt; cur.data) {\nif (cur.left == null) {\ncur.left = new Node(val);\nbreak;\n} else {\ncur = cur.left;\n}\n} else {\nif (cur.right == null) {\ncur.right = new Node(val);\nbreak;\n} else {\ncur = cur.right;\n}\n}\n}\nreturn root;\n}\n</code></pre>"},{"location":"read/beautiful-algo/binary-tree/#_8","title":"\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u5220\u9664\u64cd\u4f5c","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u8981\u5220\u9664\u7684\u8282\u70b9\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u90a3\u5c31\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002\u5982\u679c\u627e\u5230\u4e86\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u4e09\u79cd\u60c5\u51b5\uff1a</p> <ul> <li> <p>\u8981\u5220\u9664\u7684\u8282\u70b9\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u76f4\u63a5\u5220\u9664\u5373\u53ef\uff1b</p> </li> <li> <p>\u8981\u5220\u9664\u7684\u8282\u70b9\u53ea\u6709\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u5c31\u8ba9\u5b83\u7684\u5b50\u8282\u70b9\u66ff\u4ee3\u5b83\u7684\u4f4d\u7f6e\uff1b</p> </li> <li> <p>\u8981\u5220\u9664\u7684\u8282\u70b9\u6709\u4e24\u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u5c31\u8ba9\u5b83\u7684\u53f3\u5b50\u6811\u4e2d\u7684\u6700\u5c0f\u8282\u70b9\u66ff\u4ee3\u5b83\u7684\u4f4d\u7f6e\u3002\u7136\u540e\u518d\u5220\u9664\u6389\u8fd9\u4e2a\u6700\u5c0f\u8282\u70b9\uff0c\u56e0\u4e3a\u6700\u5c0f\u8282\u70b9\u80af\u5b9a\u6ca1\u6709\u5de6\u5b50\u8282\u70b9\uff08\u5982\u679c\u6709\u5de6\u5b50\u7ed3\u70b9\uff0c\u90a3\u5c31\u4e0d\u662f\u6700\u5c0f\u8282\u70b9\u4e86\uff09</p> </li> </ul> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>public void delete(int data) {\nNode p = tree; // p\u6307\u5411\u8981\u5220\u9664\u7684\u8282\u70b9\uff0c\u521d\u59cb\u5316\u6307\u5411\u6839\u8282\u70b9\nNode pp = null; // pp\u8bb0\u5f55\u7684\u662fp\u7684\u7236\u8282\u70b9\nwhile (p != null &amp;&amp; p.data != data) {\npp = p;\nif (data &gt; p.data) p = p.right;\nelse p = p.left;\n}\nif (p == null) return; // \u6ca1\u6709\u627e\u5230\n// \u8981\u5220\u9664\u7684\u8282\u70b9\u6709\u4e24\u4e2a\u5b50\u8282\u70b9\nif (p.left != null &amp;&amp; p.right != null) { // \u67e5\u627e\u53f3\u5b50\u6811\u4e2d\u6700\u5c0f\u8282\u70b9\nNode minP = p.right;\nNode minPP = p; // minPP\u8868\u793aminP\u7684\u7236\u8282\u70b9\nwhile (minP.left != null) {\nminPP = minP;\nminP = minP.left;\n}\np.data = minP.data; // \u5c06minP\u7684\u6570\u636e\u66ff\u6362\u5230p\u4e2d\np = minP; // \u4e0b\u9762\u5c31\u53d8\u6210\u4e86\u5220\u9664minP\u4e86\npp = minPP;\n}\n// \u5220\u9664\u8282\u70b9\u662f\u53f6\u5b50\u8282\u70b9\u6216\u8005\u4ec5\u6709\u4e00\u4e2a\u5b50\u8282\u70b9\nNode child; // p\u7684\u5b50\u8282\u70b9\nif (p.left != null) child = p.left;\nelse if (p.right != null) child = p.right;\nelse child = null;\nif (pp == null) tree = child; // \u5220\u9664\u7684\u662f\u6839\u8282\u70b9\nelse if (pp.left == p) pp.left = child;\nelse pp.right = child;\n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0c\u5173\u4e8e\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u5220\u9664\u64cd\u4f5c\uff0c\u8fd8\u6709\u4e2a\u975e\u5e38\u7b80\u5355\u3001\u53d6\u5de7\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u5355\u7eaf\u5c06\u8981\u5220\u9664\u7684\u8282\u70b9\u6807\u8bb0\u4e3a\u201c\u5df2\u5220\u9664\u201d\uff0c\u4f46\u662f\u5e76\u4e0d\u771f\u6b63\u4ece\u6811\u4e2d\u5c06\u8fd9\u4e2a\u8282\u70b9\u53bb\u6389\u3002\u8fd9\u6837\u539f\u672c\u5220\u9664\u7684\u8282\u70b9\u8fd8\u9700\u8981\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u6bd4\u8f83\u6d6a\u8d39\u5185\u5b58\u7a7a\u95f4\uff0c\u4f46\u662f\u5220\u9664\u64cd\u4f5c\u5c31\u53d8\u5f97\u7b80\u5355\u4e86\u5f88\u591a\u3002\u800c\u4e14\uff0c\u8fd9\u79cd\u5904\u7406\u65b9\u6cd5\u4e5f\u5e76\u6ca1\u6709\u589e\u52a0\u63d2\u5165\u3001\u67e5\u627e\u64cd\u4f5c\u4ee3\u7801\u5b9e\u73b0\u7684\u96be\u5ea6\u3002</p>"},{"location":"read/beautiful-algo/binary-tree/#_9","title":"\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u5176\u4ed6\u64cd\u4f5c","text":"<ul> <li> <p>\u67e5\u627e\u6700\u5927\u503c\uff1a\u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u4e00\u76f4\u5411\u53f3\u8d70\uff0c\u76f4\u5230\u8d70\u5230\u6700\u53f3\u8fb9\u7684\u8282\u70b9\uff0c\u5c31\u662f\u6700\u5927\u503c\u3002</p> </li> <li> <p>\u67e5\u627e\u6700\u5c0f\u503c\uff1a\u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u4e00\u76f4\u5411\u5de6\u8d70\uff0c\u76f4\u5230\u8d70\u5230\u6700\u5de6\u8fb9\u7684\u8282\u70b9\uff0c\u5c31\u662f\u6700\u5c0f\u503c\u3002</p> </li> <li> <p>\u67e5\u627e\u524d\u9a71\u8282\u70b9\uff1a\u4e2d\u5e8f\u904d\u5386\u7684\u524d\u4e00\u4e2a\u8282\u70b9\u3002</p> </li> <li> <p>\u67e5\u627e\u540e\u7ee7\u8282\u70b9\uff1a\u4e2d\u5e8f\u904d\u5386\u7684\u540e\u4e00\u4e2a\u8282\u70b9\u3002</p> </li> </ul> <p>\u4e8c\u53c9\u67e5\u627e\u6811\u9664\u4e86\u652f\u6301\u4e0a\u9762\u51e0\u4e2a\u64cd\u4f5c\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u7279\u6027\uff0c\u5c31\u662f**\u4e2d\u5e8f\u904d\u5386\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u53ef\u4ee5\u8f93\u51fa\u6709\u5e8f\u7684\u6570\u636e\u5e8f\u5217\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\uff0c\u975e\u5e38\u9ad8\u6548\u3002\u56e0\u6b64\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u4e5f\u53eb\u4f5c\u4e8c\u53c9\u6392\u5e8f\u6811**\u3002</p>"},{"location":"read/beautiful-algo/binary-tree/#_10","title":"\u652f\u6301\u91cd\u590d\u6570\u636e\u7684\u4e8c\u53c9\u67e5\u627e\u6811","text":"<p>\u4e0a\u9762\u8bb2\u7684\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u90fd\u662f\u4e0d\u652f\u6301\u91cd\u590d\u6570\u636e\u7684\u3002\u5982\u679c\u8981\u652f\u6301\u91cd\u590d\u6570\u636e\uff0c\u8fd9\u91cc\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6cd5:</p> <ul> <li> <p>\u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f\uff0c\u5c06\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u6539\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u8fd9\u6837\u6bcf\u4e2a\u8282\u70b9\u5c31\u53ef\u4ee5\u5b58\u50a8\u591a\u4e2a\u6570\u636e\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u63d2\u5165\u3001\u67e5\u627e\u3001\u5220\u9664\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u53d8\u6210 O(n)\u3002</p> </li> <li> <p>\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u662f\uff0c\u5c06\u6bcf\u4e2a\u8282\u70b9\u4ecd\u7136\u53ea\u5b58\u50a8\u4e00\u4e2a\u6570\u636e\u3002\u5728\u67e5\u627e\u63d2\u5165\u4f4d\u7f6e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u78b0\u5230\u4e00\u4e2a\u8282\u70b9\u7684\u503c\uff0c\u4e0e\u8981\u63d2\u5165\u6570\u636e\u7684\u503c\u76f8\u540c\uff0c\u6211\u4eec\u5c31\u5c06\u8fd9\u4e2a\u8981\u63d2\u5165\u7684\u6570\u636e\u653e\u5230\u8fd9\u4e2a\u8282\u70b9\u7684\u53f3\u5b50\u6811\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u628a\u8fd9\u4e2a\u65b0\u63d2\u5165\u7684\u6570\u636e\u5f53\u4f5c\u5927\u4e8e\u8fd9\u4e2a\u8282\u70b9\u7684\u503c\u6765\u5904\u7406\u3002 \u5f53\u8981\u67e5\u627e\u6570\u636e\u7684\u65f6\u5019\uff0c\u9047\u5230\u503c\u76f8\u540c\u7684\u8282\u70b9\uff0c\u6211\u4eec\u5e76\u4e0d\u505c\u6b62\u67e5\u627e\u64cd\u4f5c\uff0c\u800c\u662f\u7ee7\u7eed\u5728\u53f3\u5b50\u6811\u4e2d\u67e5\u627e\uff0c\u76f4\u5230\u9047\u5230\u53f6\u5b50\u8282\u70b9\uff0c\u624d\u505c\u6b62\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u952e\u503c\u7b49\u4e8e\u8981\u67e5\u627e\u503c\u7684\u6240\u6709\u8282\u70b9\u90fd\u627e\u51fa\u6765\u3002\u5bf9\u4e8e\u5220\u9664\u64cd\u4f5c\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5148\u67e5\u627e\u5230\u6bcf\u4e2a\u8981\u5220\u9664\u7684\u8282\u70b9\uff0c\u7136\u540e\u518d\u6309\u524d\u9762\u8bb2\u7684\u5220\u9664\u64cd\u4f5c\u7684\u65b9\u6cd5\uff0c\u4f9d\u6b21\u5220\u9664\u3002</p> </li> </ul> <p>\u4e8c\u53c9\u67e5\u627e\u6811\u5728\u6bd4\u8f83\u5e73\u8861\u7684\u60c5\u51b5\u4e0b\uff0c\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u627e\u64cd\u4f5c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(logn)</p>"},{"location":"read/beautiful-algo/binary-tree/#_11","title":"\u6709\u4e86\u6563\u5217\u8868\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u7528\u4e8c\u53c9\u67e5\u627e\u6811\uff1f","text":"<p>\u6563\u5217\u8868\u7684\u67e5\u627e\u6548\u7387\u662f O(1)\uff0c\u6bd4\u4e8c\u53c9\u67e5\u627e\u6811\u7684 O(logn) \u8981\u9ad8\u5f97\u591a\u3002\u4e3a\u4ec0\u4e48\u8fd8\u8981\u7528\u4e8c\u53c9\u67e5\u627e\u6811\u5462\uff1f</p> <ul> <li> <p>\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\u662f\u65e0\u5e8f\u5b58\u50a8\u7684\uff0c\u5982\u679c\u8981\u8f93\u51fa\u6709\u5e8f\u7684\u6570\u636e\uff0c\u9700\u8981\u5148\u8fdb\u884c\u6392\u5e8f\u3002\u800c\u5bf9\u4e8e\u4e8c\u53c9\u67e5\u627e\u6811\u6765\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4e2d\u5e8f\u904d\u5386\uff0c\u5c31\u53ef\u4ee5\u5728 O(n) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\uff0c\u8f93\u51fa\u6709\u5e8f\u7684\u6570\u636e\u5e8f\u5217\u3002</p> </li> <li> <p>\u6563\u5217\u8868\u6269\u5bb9\u8017\u65f6\u5f88\u591a\uff0c\u800c\u4e14\u5f53\u9047\u5230\u6563\u5217\u51b2\u7a81\u65f6\uff0c\u6027\u80fd\u4e0d\u7a33\u5b9a\uff0c\u5c3d\u7ba1\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u6027\u80fd\u4e0d\u7a33\u5b9a\uff0c\u4f46\u662f\u5728\u5de5\u7a0b\u4e2d\uff0c\u6211\u4eec\u6700\u5e38\u7528\u7684\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u6027\u80fd\u975e\u5e38\u7a33\u5b9a\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u7a33\u5b9a\u5728 O(logn)\u3002</p> </li> <li> <p>\u7b3c\u7edf\u5730\u6765\u8bf4\uff0c\u5c3d\u7ba1\u6563\u5217\u8868\u7684\u67e5\u627e\u7b49\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u5e38\u91cf\u7ea7\u7684\uff0c\u4f46\u56e0\u4e3a\u54c8\u5e0c\u51b2\u7a81\u7684\u5b58\u5728\uff0c\u8fd9\u4e2a\u5e38\u91cf\u4e0d\u4e00\u5b9a\u6bd4 logn \u5c0f\uff0c\u6240\u4ee5\u5b9e\u9645\u7684\u67e5\u627e\u901f\u5ea6\u53ef\u80fd\u4e0d\u4e00\u5b9a\u6bd4 O(logn) \u5feb\u3002\u52a0\u4e0a\u54c8\u5e0c\u51fd\u6570\u7684\u8017\u65f6\uff0c\u4e5f\u4e0d\u4e00\u5b9a\u5c31\u6bd4\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u6548\u7387\u9ad8\u3002</p> </li> <li> <p>\u6563\u5217\u8868\u7684\u6784\u9020\u6bd4\u4e8c\u53c9\u67e5\u627e\u6811\u8981\u590d\u6742\uff0c\u9700\u8981\u8003\u8651\u7684\u4e1c\u897f\u5f88\u591a\u3002\u6bd4\u5982\u6563\u5217\u51fd\u6570\u7684\u8bbe\u8ba1\u3001\u51b2\u7a81\u89e3\u51b3\u529e\u6cd5\u3001\u6269\u5bb9\u3001\u7f29\u5bb9\u7b49\u3002\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u53ea\u9700\u8981\u8003\u8651\u5e73\u8861\u6027\u8fd9\u4e00\u4e2a\u95ee\u9898\uff0c\u800c\u4e14\u8fd9\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u6bd4\u8f83\u6210\u719f\u3001\u56fa\u5b9a\u3002</p> </li> <li> <p>\u4e3a\u4e86\u907f\u514d\u8fc7\u591a\u7684\u6563\u5217\u51b2\u7a81\uff0c\u6563\u5217\u8868\u88c5\u8f7d\u56e0\u5b50\u4e0d\u80fd\u592a\u5927\uff0c\u7279\u522b\u662f\u57fa\u4e8e\u5f00\u653e\u5bfb\u5740\u6cd5\u89e3\u51b3\u51b2\u7a81\u7684\u6563\u5217\u8868\uff0c\u4e0d\u7136\u4f1a\u6d6a\u8d39\u4e00\u5b9a\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> </li> </ul> <p>\u7efc\u5408\u8fd9\u51e0\u70b9\uff0c\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u5728\u67d0\u4e9b\u65b9\u9762\u8fd8\u662f\u4f18\u4e8e\u6563\u5217\u8868\u7684\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e24\u8005\u7684\u5b58\u5728\u5e76\u4e0d\u51b2\u7a81\u3002\u6211\u4eec\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u7ed3\u5408\u5177\u4f53\u7684\u9700\u6c42\u6765\u9009\u62e9\u4f7f\u7528\u54ea\u4e00\u4e2a\u3002</p>"},{"location":"read/beautiful-algo/bsearch/","title":"\u4e8c\u5206\u67e5\u627e","text":""},{"location":"read/beautiful-algo/bsearch/#_2","title":"\u5b9a\u4e49","text":"<p>\u4e8c\u5206\u67e5\u627e\u9488\u5bf9\u7684\u662f\u4e00\u4e2a \u6709\u5e8f \u7684\u6570\u636e\u96c6\u5408\uff0c\u67e5\u627e\u601d\u60f3\u6709\u70b9\u7c7b\u4f3c\u5206\u6cbb\u601d\u60f3\u3002\u6bcf\u6b21\u90fd\u901a\u8fc7\u8ddf\u533a\u95f4\u7684\u4e2d\u95f4\u5143\u7d20\u5bf9\u6bd4\uff0c\u5c06\u5f85\u67e5\u627e\u7684\u533a\u95f4\u7f29\u5c0f\u4e3a\u4e4b\u524d\u7684\u4e00\u534a\uff0c\u76f4\u5230\u627e\u5230\u8981\u67e5\u627e\u7684\u5143\u7d20\uff0c\u6216\u8005\u533a\u95f4\u88ab\u7f29\u5c0f\u4e3a 0\u3002</p> <p>\u4e8c\u5206\u67e5\u627e\u662f\u4e00\u79cd\u975e\u5e38\u9ad8\u6548\u7684\u67e5\u627e\u7b97\u6cd5\uff0c \u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(logn)\u3002</p>"},{"location":"read/beautiful-algo/bsearch/#_3","title":"\u7b80\u5355\u4e8c\u5206\u67e5\u627e\u5b9e\u73b0","text":""},{"location":"read/beautiful-algo/bsearch/#_4","title":"\u975e\u9012\u5f52\u5b9e\u73b0","text":"<pre><code>public int bsearch(int[] a, int n, int value) {\nint low = 0;\nint high = n - 1;\nwhile (low &lt;= high) {\nint mid = (low + high) / 2;\nif (a[mid] == value) {\nreturn mid;\n} else if (a[mid] &lt; value) {\nlow = mid + 1;\n} else {\nhigh = mid - 1;\n}\n}\nreturn -1;\n}\n</code></pre>"},{"location":"read/beautiful-algo/bsearch/#_5","title":"\u9012\u5f52\u5b9e\u73b0","text":"<pre><code>// \u4e8c\u5206\u67e5\u627e\u7684\u9012\u5f52\u5b9e\u73b0\npublic int bsearch(int[] a, int n, int val) {\nreturn bsearchInternally(a, 0, n - 1, val);\n}\nprivate int bsearchInternally(int[] a, int low, int high, int value) {\nif (low &gt; high) return -1;\nint mid =  low + ((high - low) &gt;&gt; 1);\nif (a[mid] == value) {\nreturn mid;\n} else if (a[mid] &lt; value) {\nreturn bsearchInternally(a, mid+1, high, value);\n} else {\nreturn bsearchInternally(a, low, mid-1, value);\n}\n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0cmid=(low+high)/2 \u8fd9\u79cd\u5199\u6cd5\u662f\u6709\u95ee\u9898\u7684\u3002\u56e0\u4e3a\u5982\u679c low \u548c high \u6bd4\u8f83\u5927\u7684\u8bdd\uff0c\u4e24\u8005\u4e4b\u548c\u5c31\u6709\u53ef\u80fd\u4f1a\u6ea2\u51fa\u3002\u6539\u8fdb\u7684\u65b9\u6cd5\u662f\u5c06 mid \u7684\u8ba1\u7b97\u65b9\u5f0f\u5199\u6210 low+(high-low)/2\u3002\u66f4\u8fdb\u4e00\u6b65\uff0c\u5982\u679c\u8981\u5c06\u6027\u80fd\u4f18\u5316\u5230\u6781\u81f4\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u91cc\u7684\u9664\u4ee5 2 \u64cd\u4f5c\u8f6c\u5316\u6210\u4f4d\u8fd0\u7b97 low+((high-low)&gt;&gt;1)\u3002\u56e0\u4e3a\u76f8\u6bd4\u9664\u6cd5\u8fd0\u7b97\u6765\u8bf4\uff0c\u8ba1\u7b97\u673a\u5904\u7406\u4f4d\u8fd0\u7b97\u8981\u5feb\u5f97\u591a\u3002</p>"},{"location":"read/beautiful-algo/bsearch/#_6","title":"\u4e8c\u5206\u67e5\u627e","text":""},{"location":"read/beautiful-algo/bsearch/#_7","title":"\u4e8c\u5206\u67e5\u627e\u5e94\u7528\u573a\u666f\u7684\u5c40\u9650\u6027","text":"<ul> <li>\u9996\u5148\uff0c\u4e8c\u5206\u67e5\u627e\u4f9d\u8d56\u7684\u662f\u987a\u5e8f\u8868\u7ed3\u6784\uff0c\u7b80\u5355\u70b9\u8bf4\u5c31\u662f\u6570\u7ec4\u3002</li> </ul> <p>\u4e3b\u8981\u539f\u56e0\u662f\u4e8c\u5206\u67e5\u627e\u7b97\u6cd5\u9700\u8981\u6309\u7167\u4e0b\u6807\u968f\u673a\u8bbf\u95ee\u5143\u7d20\u3002\u6211\u4eec\u5728\u6570\u7ec4\u548c\u94fe\u8868\u90a3\u4e24\u8282\u8bb2\u8fc7\uff0c\u6570\u7ec4\u6309\u7167\u4e0b\u6807\u968f\u673a\u8bbf\u95ee\u6570\u636e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\uff0c\u800c\u94fe\u8868\u968f\u673a\u8bbf\u95ee\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6570\u636e\u4f7f\u7528\u94fe\u8868\u5b58\u50a8\uff0c\u4e8c\u5206\u67e5\u627e\u7684\u65f6\u95f4\u590d\u6742\u5c31\u4f1a\u53d8\u5f97\u5f88\u9ad8\u3002</p> <ul> <li>\u5176\u6b21\uff0c\u4e8c\u5206\u67e5\u627e\u9488\u5bf9\u7684\u662f\u6709\u5e8f\u6570\u636e\u3002</li> </ul> <p>\u4e8c\u5206\u67e5\u627e\u5bf9\u8fd9\u4e00\u70b9\u7684\u8981\u6c42\u6bd4\u8f83\u82db\u523b\uff0c\u6570\u636e\u5fc5\u987b\u662f\u6709\u5e8f\u7684\u3002\u5982\u679c\u6570\u636e\u6ca1\u6709\u5e8f\uff0c\u6211\u4eec\u9700\u8981\u5148\u6392\u5e8f\u3002\u6240\u4ee5 \u4e8c\u5206\u67e5\u627e\u53ea\u80fd\u7528\u5728\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\u4e0d\u9891\u7e41\uff0c\u4e00\u6b21\u6392\u5e8f\u591a\u6b21\u67e5\u627e\u7684\u573a\u666f\u4e2d\u3002\u9488\u5bf9\u52a8\u6001\u53d8\u5316\u7684\u6570\u636e\u96c6\u5408\uff0c\u4e8c\u5206\u67e5\u627e\u5c06\u4e0d\u518d\u9002\u7528</p> <ul> <li>\u518d\u6b21\uff0c\u6570\u636e\u91cf\u592a\u5c0f\u4e0d\u9002\u5408\u4e8c\u5206\u67e5\u627e\u3002</li> </ul> <p>\u5982\u679c\u8981\u5904\u7406\u7684\u6570\u636e\u91cf\u5f88\u5c0f\uff0c\u5b8c\u5168\u6ca1\u6709\u5fc5\u8981\u7528\u4e8c\u5206\u67e5\u627e\uff0c\u987a\u5e8f\u904d\u5386\u5c31\u8db3\u591f\u4e86\u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5916\u3002 \u5982\u679c\u6570\u636e\u4e4b\u95f4\u7684\u6bd4\u8f83\u64cd\u4f5c\u975e\u5e38\u8017\u65f6\uff0c\u4e0d\u7ba1\u6570\u636e\u91cf\u5927\u5c0f\uff0c\u6211\u90fd\u63a8\u8350\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u3002 \u6bd4\u5982\uff0c\u6570\u7ec4\u4e2d\u5b58\u50a8\u7684\u90fd\u662f\u957f\u5ea6\u8d85\u8fc7 300 \u7684\u5b57\u7b26\u4e32\uff0c\u5982\u6b64\u957f\u7684\u4e24\u4e2a\u5b57\u7b26\u4e32\u4e4b\u95f4\u6bd4\u5bf9\u5927\u5c0f\uff0c\u5c31\u4f1a\u975e\u5e38\u8017\u65f6\u3002\u6211\u4eec\u9700\u8981\u5c3d\u53ef\u80fd\u5730\u51cf\u5c11\u6bd4\u8f83\u6b21\u6570\uff0c\u800c\u6bd4\u8f83\u6b21\u6570\u7684\u51cf\u5c11\u4f1a\u5927\u5927\u63d0\u9ad8\u6027\u80fd\uff0c\u8fd9\u4e2a\u65f6\u5019\u4e8c\u5206\u67e5\u627e\u5c31\u6bd4\u987a\u5e8f\u904d\u5386\u66f4\u6709\u4f18\u52bf\u3002</p> <ul> <li>\u6700\u540e\uff0c\u6570\u636e\u91cf\u592a\u5927\u4e5f\u4e0d\u9002\u5408\u4e8c\u5206\u67e5\u627e\u3002</li> </ul> <p>\u4e8c\u5206\u67e5\u627e\u7684\u5e95\u5c42\u9700\u8981\u4f9d\u8d56\u6570\u7ec4\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u800c\u6570\u7ec4\u4e3a\u4e86\u652f\u6301\u968f\u673a\u8bbf\u95ee\u7684\u7279\u6027\uff0c\u8981\u6c42\u5185\u5b58\u7a7a\u95f4\u8fde\u7eed\uff0c\u5bf9\u5185\u5b58\u7684\u8981\u6c42\u6bd4\u8f83\u82db\u523b\u3002</p>"},{"location":"read/beautiful-algo/bsearch/#_8","title":"\u4e8c\u5206\u67e5\u627e\u7684\u53d8\u5f62\u95ee\u9898","text":""},{"location":"read/beautiful-algo/bsearch/#_9","title":"\u53d8\u4f53\u4e00\uff1a\u67e5\u627e\u7b2c\u4e00\u4e2a\u503c\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"<p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u6837\u4e00\u4e2a\u6709\u5e8f\u6570\u7ec4\uff0c\u5176\u4e2d\uff0ca[5]\uff0ca[6]\uff0ca[7]\u7684\u503c\u90fd\u7b49\u4e8e 8\uff0c\u662f\u91cd\u590d\u7684\u6570\u636e\u3002\u6211\u4eec\u5e0c\u671b\u67e5\u627e\u7b2c\u4e00\u4e2a\u7b49\u4e8e 8 \u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4e0b\u6807\u662f 5 \u7684\u5143\u7d20\u3002</p> <p></p> <p>\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>public int bsearch(int[] a, int n, int value) {\nint low = 0;\nint high = n - 1;\nwhile (low &lt;= high) {\nint mid =  low + ((high - low) &gt;&gt; 1);\nif (a[mid] &gt; value) {\nhigh = mid - 1;\n} else if (a[mid] &lt; value) {\nlow = mid + 1;\n} else {\nif ((mid == 0) || (a[mid - 1] != value)) return mid;\nelse high = mid - 1;\n}\n}\nreturn -1;\n}\n</code></pre>"},{"location":"read/beautiful-algo/bsearch/#_10","title":"\u53d8\u4f53\u4e8c\uff1a\u67e5\u627e\u6700\u540e\u4e00\u4e2a\u503c\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"<p>\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>public int bsearch(int[] a, int n, int value) {\nint low = 0;\nint high = n - 1;\nwhile (low &lt;= high) {\nint mid =  low + ((high - low) &gt;&gt; 1);\nif (a[mid] &gt; value) {\nhigh = mid - 1;\n} else if (a[mid] &lt; value) {\nlow = mid + 1;\n} else {\nif ((mid == n - 1) || (a[mid + 1] != value)) return mid;\nelse low = mid + 1;\n}\n}\nreturn -1;\n}\n</code></pre>"},{"location":"read/beautiful-algo/bsearch/#_11","title":"\u53d8\u4f53\u4e09\uff1a\u67e5\u627e\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"<p>\u5728\u6709\u5e8f\u6570\u7ec4\u4e2d\uff0c\u67e5\u627e\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20\u3002\u6bd4\u5982\uff0c\u6570\u7ec4\u4e2d\u5b58\u50a8\u7684\u8fd9\u6837\u4e00\u4e2a\u5e8f\u5217\uff1a3\uff0c4\uff0c6\uff0c7\uff0c10\u3002\u5982\u679c\u67e5\u627e\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e 5 \u7684\u5143\u7d20\uff0c\u90a3\u5c31\u662f 6\u3002</p> <p>\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>public int bsearch(int[] a, int n, int value) {\nint low = 0;\nint high = n - 1;\nwhile (low &lt;= high) {\nint mid =  low + ((high - low) &gt;&gt; 1);\nif (a[mid] &gt;= value) {\nif ((mid == 0) || (a[mid - 1] &lt; value)) return mid;\nelse high = mid - 1;\n} else {\nlow = mid + 1;\n}\n}\nreturn -1;\n}\n</code></pre>"},{"location":"read/beautiful-algo/bsearch/#_12","title":"\u53d8\u4f53\u56db\uff1a\u67e5\u627e\u6700\u540e\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20","text":"<p>\u6bd4\u5982\uff0c\u6570\u7ec4\u4e2d\u5b58\u50a8\u4e86\u8fd9\u6837\u4e00\u7ec4\u6570\u636e\uff1a3\uff0c5\uff0c6\uff0c8\uff0c9\uff0c10\u3002\u6700\u540e\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e 7 \u7684\u5143\u7d20\u5c31\u662f 6\u3002</p> <p>\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>public int bsearch7(int[] a, int n, int value) {\nint low = 0;\nint high = n - 1;\nwhile (low &lt;= high) {\nint mid =  low + ((high - low) &gt;&gt; 1);\nif (a[mid] &gt; value) {\nhigh = mid - 1;\n} else {\nif ((mid == n - 1) || (a[mid + 1] &gt; value)) return mid;\nelse low = mid + 1;\n}\n}\nreturn -1;\n}\n</code></pre>"},{"location":"read/beautiful-algo/bsearch/#_13","title":"\u5c0f\u7ed3","text":"<p>\u51e1\u662f\u7528\u4e8c\u5206\u67e5\u627e\u80fd\u89e3\u51b3\u7684\uff0c\u7edd\u5927\u90e8\u5206\u6211\u4eec\u66f4\u503e\u5411\u4e8e\u7528\u6563\u5217\u8868\u6216\u8005\u4e8c\u53c9\u67e5\u627e\u6811\u3002\u5373\u4fbf\u662f\u4e8c\u5206\u67e5\u627e\u5728\u5185\u5b58\u4f7f\u7528\u4e0a\u66f4\u8282\u7701\uff0c\u4f46\u662f\u6bd5\u7adf\u5185\u5b58\u5982\u6b64\u7d27\u7f3a\u7684\u60c5\u51b5\u5e76\u4e0d\u591a\u3002</p> <p>\u4e8c\u5206\u67e5\u627e\u66f4\u9002\u5408\u7528\u5728 \u201c\u8fd1\u4f3c\u201d\u67e5\u627e\u95ee\u9898\uff0c\u5728\u8fd9\u7c7b\u95ee\u9898\u4e0a\uff0c\u4e8c\u5206\u67e5\u627e\u7684\u4f18\u52bf\u66f4\u52a0\u660e\u663e\u3002\u6bd4\u5982\u4e0a\u9762\u8bb2\u7684\u8fd9\u51e0\u79cd\u53d8\u4f53\u95ee\u9898\uff0c\u7528\u5176\u4ed6\u6570\u636e\u7ed3\u6784\uff0c\u6bd4\u5982\u6563\u5217\u8868\u3001\u4e8c\u53c9\u6811\uff0c\u5c31\u6bd4\u8f83\u96be\u5b9e\u73b0\u4e86\u3002</p>"},{"location":"read/beautiful-algo/digui-tree/","title":"\u9012\u5f52\u6811","text":""},{"location":"read/beautiful-algo/digui-tree/#_1","title":"\u9012\u5f52\u6811","text":""},{"location":"read/beautiful-algo/hashmap/","title":"\u6563\u5217\u8868","text":""},{"location":"read/beautiful-algo/hashmap/#1","title":"1. \u5b9a\u4e49","text":"<p>\u6563\u5217\u8868\uff08Hash table\uff0c\u4e5f\u53eb\u54c8\u5e0c\u8868\uff09\uff0c\u662f\u6839\u636e\u5173\u952e\u7801\u503c\uff08Key value\uff09\u800c\u76f4\u63a5\u8fdb\u884c\u8bbf\u95ee\u7684\u6570\u636e\u7ed3\u6784\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u901a\u8fc7\u628a\u5173\u952e\u7801\u503c\u6620\u5c04\u5230\u8868\u4e2d\u4e00\u4e2a\u4f4d\u7f6e\u6765\u8bbf\u95ee\u8bb0\u5f55\uff0c\u4ee5\u52a0\u5feb\u67e5\u627e\u7684\u901f\u5ea6\u3002\u8fd9\u4e2a\u6620\u5c04\u51fd\u6570\u53eb\u505a\u6563\u5217\u51fd\u6570\uff0c\u5b58\u653e\u8bb0\u5f55\u7684\u6570\u7ec4\u53eb\u505a\u6563\u5217\u8868\u3002</p> <p>\u6563\u5217\u8868\u7528\u7684\u5c31\u662f\u6570\u7ec4\u652f\u6301\u6309\u7167\u4e0b\u6807\u968f\u673a\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1) \u7684\u7279\u6027\u3002\u6211\u4eec\u901a\u8fc7\u6563\u5217\u51fd\u6570\u628a\u5143\u7d20\u7684\u952e\u503c\u6620\u5c04\u4e3a\u4e0b\u6807\uff0c\u7136\u540e\u5c06\u6570\u636e\u5b58\u50a8\u5728\u6570\u7ec4\u4e2d\u5bf9\u5e94\u4e0b\u6807\u7684\u4f4d\u7f6e\u3002\u5f53\u6211\u4eec\u6309\u7167\u952e\u503c\u67e5\u8be2\u5143\u7d20\u65f6\uff0c\u6211\u4eec\u7528\u540c\u6837\u7684\u6563\u5217\u51fd\u6570\uff0c\u5c06\u952e\u503c\u8f6c\u5316\u6570\u7ec4\u4e0b\u6807\uff0c\u4ece\u5bf9\u5e94\u7684\u6570\u7ec4\u4e0b\u6807\u7684\u4f4d\u7f6e\u53d6\u6570\u636e\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#2","title":"2. \u6563\u5217\u51fd\u6570","text":"<p>\u6563\u5217\u51fd\u6570\u662f\u6563\u5217\u8868\u7684\u6838\u5fc3\uff0c\u4e5f\u662f\u6563\u5217\u8868\u5b58\u50a8\u548c\u8bfb\u53d6\u6570\u636e\u7684\u57fa\u7840\u3002\u6563\u5217\u51fd\u6570\u7684\u4f5c\u7528\u662f\u7ed9\u5b9a\u4e00\u4e2a\u952e\u503c\uff0c\u7136\u540e\u8fd4\u56de\u503c\u5728\u8868\u4e2d\u7684\u5730\u5740\u3002</p> <p>\u6563\u5217\u51fd\u6570\u8bbe\u8ba1\u7684\u57fa\u672c\u8981\u6c42\uff1a</p> <ol> <li> <p>\u6563\u5217\u51fd\u6570\u8ba1\u7b97\u5f97\u5230\u7684\u6563\u5217\u503c\u662f\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\uff1b</p> </li> <li> <p>\u5982\u679c key1 = key2\uff0c\u90a3 hash(key1) == hash(key2)\uff1b</p> </li> <li> <p>\u5982\u679c key1 \u2260 key2\uff0c\u90a3 hash(key1) \u2260 hash(key2)\u3002</p> </li> </ol>"},{"location":"read/beautiful-algo/hashmap/#21","title":"2.1 \u5982\u4f55\u8bbe\u8ba1\u6563\u5217\u51fd\u6570\uff1f","text":"<ul> <li> <p>\u9996\u5148\uff0c\u6563\u5217\u51fd\u6570\u7684\u8bbe\u8ba1\u4e0d\u80fd\u592a\u590d\u6742 , \u8fc7\u4e8e\u590d\u6742\u7684\u6563\u5217\u51fd\u6570\uff0c\u52bf\u5fc5\u4f1a\u6d88\u8017\u5f88\u591a\u8ba1\u7b97\u65f6\u95f4\uff0c\u4e5f\u5c31\u95f4\u63a5\u5730\u5f71\u54cd\u5230\u6563\u5217\u8868\u7684\u6027\u80fd\u3002</p> </li> <li> <p>\u5176\u6b21\uff0c\u6563\u5217\u51fd\u6570\u751f\u6210\u7684\u503c\u8981\u5c3d\u53ef\u80fd\u968f\u673a\u5e76\u4e14\u5747\u5300\u5206\u5e03\uff0c\u8fd9\u6837\u624d\u80fd\u907f\u514d\u6216\u8005\u6700\u5c0f\u5316\u6563\u5217\u51b2\u7a81\uff0c\u800c\u4e14\u5373\u4fbf\u51fa\u73b0\u51b2\u7a81\uff0c\u6563\u5217\u5230\u6bcf\u4e2a\u69fd\u91cc\u7684\u6570\u636e\u4e5f\u4f1a\u6bd4\u8f83\u5e73\u5747\uff0c\u4e0d\u4f1a\u51fa\u73b0\u67d0\u4e2a\u69fd\u5185\u6570\u636e\u7279\u522b\u591a\u7684\u60c5\u51b5\u3002</p> </li> </ul> <p>\u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u7efc\u5408\u8003\u8651\u5404\u79cd\u56e0\u7d20\u3002\u8fd9\u4e9b\u56e0\u7d20\u6709\u5173\u952e\u5b57\u7684\u957f\u5ea6\u3001\u7279\u70b9\u3001\u5206\u5e03\u3001\u8fd8\u6709\u6563\u5217\u8868\u7684\u5927\u5c0f\u7b49\u3002</p> <p>\u6563\u5217\u51fd\u6570\u7684\u8bbe\u8ba1\u65b9\u6cd5\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u5982<code>\u76f4\u63a5\u5b9a\u5740\u6cd5</code>\u3001<code>\u6570\u5b57\u5206\u6790\u6cd5</code>\u3001<code>\u5e73\u65b9\u53d6\u4e2d\u6cd5</code>\u3001<code>\u6298\u53e0\u6cd5</code>\u3001<code>\u9664\u7559\u4f59\u6570\u6cd5</code>\u3001<code>\u968f\u673a\u6570\u6cd5</code>\u7b49\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#3","title":"3. \u6563\u5217\u51b2\u7a81","text":"<p>\u6563\u5217\u51fd\u6570\u7684\u8bbe\u8ba1\u8981\u5c3d\u53ef\u80fd\u5730\u907f\u514d\u51b2\u7a81\uff0c\u4e5f\u5c31\u662f\u4e0d\u540c\u7684\u952e\u503c\u7ecf\u8fc7\u6563\u5217\u51fd\u6570\u6620\u5c04\u5230\u6563\u5217\u8868\u7684\u540c\u4e00\u4e2a\u4f4d\u7f6e\u3002\u5982\u679c\u6563\u5217\u8868\u4e2d\u7684\u5b58\u50a8\u7a7a\u95f4\u6bd4\u8f83\u7d27\u5f20\uff0c\u90a3\u4e48\u51b2\u7a81\u5c31\u4f1a\u6bd4\u8f83\u4e25\u91cd\uff0c\u8fd9\u6837\u5c31\u4f1a\u5f71\u54cd\u6563\u5217\u8868\u7684\u6027\u80fd\u3002\u6240\u4ee5\uff0c\u6563\u5217\u51fd\u6570\u8bbe\u8ba1\u7684\u8d8a\u597d\uff0c\u51b2\u7a81\u5c31\u8d8a\u5c11\uff0c\u6563\u5217\u8868\u7684\u6027\u80fd\u5c31\u8d8a\u597d\u3002</p> <p>\u6563\u5217\u51b2\u7a81\u7684\u89e3\u51b3\u65b9\u6cd5\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u5982\u5f00\u653e\u5bfb\u5740\u6cd5\u3001\u94fe\u8868\u6cd5\u3001\u518d\u54c8\u5e0c\u6cd5\u7b49\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#31","title":"3.1 \u5f00\u653e\u5bfb\u5740\u6cd5","text":"<p>\u5f00\u653e\u5bfb\u5740\u6cd5\u7684\u57fa\u672c\u601d\u60f3\u662f\uff1a\u5982\u679c\u51fa\u73b0\u4e86\u6563\u5217\u51b2\u7a81\uff0c\u5c31\u91cd\u65b0\u63a2\u6d4b\u4e00\u4e2a\u7a7a\u95f2\u4f4d\u7f6e\uff0c\u5c06\u5176\u63d2\u5165\u3002\u63a2\u6d4b\u7684\u65b9\u6cd5\u6709\u7ebf\u6027\u63a2\u6d4b\u3001\u4e8c\u6b21\u63a2\u6d4b\u3001\u518d\u54c8\u5e0c\u6cd5\u7b49\u3002 </p>"},{"location":"read/beautiful-algo/hashmap/#311","title":"3.1.1 \u7ebf\u6027\u63a2\u6d4b","text":"<p>\u7ebf\u6027\u63a2\u6d4b\u7684\u57fa\u672c\u601d\u60f3\u662f\uff1a\u5f53\u6211\u4eec\u5f80\u6563\u5217\u8868\u4e2d\u63d2\u5165\u6570\u636e\u65f6\uff0c\u5982\u679c\u67d0\u4e2a\u6570\u636e\u7ecf\u8fc7\u6563\u5217\u51fd\u6570\u6563\u5217\u4e4b\u540e\uff0c\u5b58\u50a8\u4f4d\u7f6e\u5df2\u7ecf\u88ab\u5360\u7528\u4e86\uff0c\u6211\u4eec\u5c31\u4ece\u5f53\u524d\u4f4d\u7f6e\u5f00\u59cb\uff0c\u4f9d\u6b21\u5f80\u540e\u67e5\u627e\uff0c\u770b\u662f\u5426\u6709\u7a7a\u95f2\u4f4d\u7f6e\uff0c\u76f4\u5230\u627e\u5230\u4e3a\u6b62\u3002 </p> <p>\u7ebf\u6027\u63a2\u6d4b\u6cd5\u5176\u5b9e\u5b58\u5728\u5f88\u5927\u95ee\u9898\u3002\u5f53\u6563\u5217\u8868\u4e2d\u63d2\u5165\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\u65f6\uff0c\u6563\u5217\u51b2\u7a81\u53d1\u751f\u7684\u53ef\u80fd\u6027\u5c31\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u7a7a\u95f2\u4f4d\u7f6e\u4f1a\u8d8a\u6765\u8d8a\u5c11\uff0c\u7ebf\u6027\u63a2\u6d4b\u7684\u65f6\u95f4\u5c31\u4f1a\u8d8a\u6765\u8d8a\u4e45\u3002\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u63a2\u6d4b\u6574\u4e2a\u6563\u5217\u8868\uff0c\u6240\u4ee5\u6700\u574f\u60c5\u51b5\u4e0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n)\u3002\u540c\u7406\uff0c\u5728\u5220\u9664\u548c\u67e5\u627e\u65f6\uff0c\u4e5f\u6709\u53ef\u80fd\u4f1a\u7ebf\u6027\u63a2\u6d4b\u6574\u5f20\u6563\u5217\u8868\uff0c\u624d\u80fd\u627e\u5230\u8981\u67e5\u627e\u6216\u8005\u5220\u9664\u7684\u6570\u636e\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#312","title":"3.1.2 \u4e8c\u6b21\u63a2\u6d4b","text":"<p>\u4e8c\u6b21\u63a2\u6d4b\u7684\u57fa\u672c\u601d\u60f3\u662f\uff1a\u6240\u8c13\u4e8c\u6b21\u63a2\u6d4b\uff0c\u8ddf\u7ebf\u6027\u63a2\u6d4b\u5f88\u50cf\uff0c\u7ebf\u6027\u63a2\u6d4b\u6bcf\u6b21\u63a2\u6d4b\u7684\u6b65\u957f\u662f 1\uff0c\u90a3\u5b83\u63a2\u6d4b\u7684\u4e0b\u6807\u5e8f\u5217\u5c31\u662f hash(key)+0\uff0chash(key)+1\uff0chash(key)+2\u2026\u2026\u800c\u4e8c\u6b21\u63a2\u6d4b\u63a2\u6d4b\u7684\u6b65\u957f\u5c31\u53d8\u6210\u4e86\u539f\u6765\u7684\u201c\u4e8c\u6b21\u65b9\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u63a2\u6d4b\u7684\u4e0b\u6807\u5e8f\u5217\u5c31\u662f hash(key)+0\uff0chash(key)+12\uff0chash(key)+22\u2026\u2026</p> <p>\u4e8c\u6b21\u63a2\u6d4b\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\u8ddf\u7ebf\u6027\u63a2\u6d4b\u6cd5\u4e00\u6837\uff0c\u6700\u574f\u60c5\u51b5\u4e0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n)\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#313","title":"3.1.3 \u518d\u54c8\u5e0c\u6cd5/\u53cc\u91cd\u6563\u5217","text":"<p>\u518d\u54c8\u5e0c\u6cd5\u7684\u57fa\u672c\u601d\u60f3\u662f\uff1a\u6240\u8c13\u53cc\u91cd\u6563\u5217\uff0c\u610f\u601d\u5c31\u662f\u4e0d\u4ec5\u8981\u4f7f\u7528\u4e00\u4e2a\u6563\u5217\u51fd\u6570\u3002\u6211\u4eec\u4f7f\u7528\u4e00\u7ec4\u6563\u5217\u51fd\u6570 hash1(key)\uff0chash2(key)\uff0chash3(key)\u2026\u2026\u6211\u4eec\u5148\u7528\u7b2c\u4e00\u4e2a\u6563\u5217\u51fd\u6570\uff0c\u5982\u679c\u8ba1\u7b97\u5f97\u5230\u7684\u5b58\u50a8\u4f4d\u7f6e\u5df2\u7ecf\u88ab\u5360\u7528\uff0c\u518d\u7528\u7b2c\u4e8c\u4e2a\u6563\u5217\u51fd\u6570\uff0c\u4f9d\u6b21\u7c7b\u63a8\uff0c\u76f4\u5230\u627e\u5230\u7a7a\u95f2\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#32","title":"3.2 \u94fe\u8868\u6cd5","text":"<p>\u94fe\u8868\u6cd5\u7684\u57fa\u672c\u601d\u60f3\u662f\uff1a\u6211\u4eec\u628a\u6563\u5217\u8868\u7684\u6bcf\u4e2a\u69fd\u4f4d\u5f53\u6210\u4e00\u4e2a\u94fe\u8868\u7684\u5934\u7ed3\u70b9\uff0c\u5f53\u591a\u4e2a\u6570\u636e\u6563\u5217\u5230\u540c\u4e00\u4e2a\u69fd\u4f4d\u65f6\uff0c\u6211\u4eec\u628a\u5b83\u4eec\u6dfb\u52a0\u5230\u94fe\u8868\u4e2d\u3002</p> <p></p> <p>\u5f53\u63d2\u5165\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u6563\u5217\u51fd\u6570\u8ba1\u7b97\u51fa\u5bf9\u5e94\u7684\u6563\u5217\u69fd\u4f4d\uff0c\u5c06\u5176\u63d2\u5165\u5230\u5bf9\u5e94\u94fe\u8868\u4e2d\u5373\u53ef\uff0c\u6240\u4ee5\u63d2\u5165\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002\u5f53\u67e5\u627e\u3001\u5220\u9664\u4e00\u4e2a\u5143\u7d20\u65f6\uff0c\u6211\u4eec\u540c\u6837\u901a\u8fc7\u6563\u5217\u51fd\u6570\u8ba1\u7b97\u51fa\u5bf9\u5e94\u7684\u69fd\uff0c\u7136\u540e\u904d\u5386\u94fe\u8868\u67e5\u627e\u6216\u8005\u5220\u9664\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8ddf\u94fe\u8868\u7684\u957f\u5ea6 k \u6210\u6b63\u6bd4\uff0c\u4e5f\u5c31\u662f O(k)\u3002\u5bf9\u4e8e\u6563\u5217\u6bd4\u8f83\u5747\u5300\u7684\u6563\u5217\u51fd\u6570\u6765\u8bf4\uff0c\u7406\u8bba\u4e0a\u8bb2\uff0ck=n/m\uff0c\u5176\u4e2d n \u8868\u793a\u6563\u5217\u4e2d\u6570\u636e\u7684\u4e2a\u6570\uff0cm \u8868\u793a\u6563\u5217\u8868\u4e2d\u201c\u69fd\u201d\u7684\u4e2a\u6570\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#33","title":"3.3 \u5982\u4f55\u9009\u62e9\u51b2\u7a81\u89e3\u51b3\u65b9\u6cd5\uff1f","text":"<p><code>\u5f00\u653e\u5bfb\u5740\u6cd5</code>\u548c<code>\u94fe\u8868\u6cd5</code>\u8fd9\u4e24\u79cd\u51b2\u7a81\u89e3\u51b3\u529e\u6cd5\u5728\u5b9e\u9645\u7684\u8f6f\u4ef6\u5f00\u53d1\u4e2d\u90fd\u975e\u5e38\u5e38\u7528\u3002\u6bd4\u5982\uff0cJava \u4e2d LinkedHashMap \u5c31\u91c7\u7528\u4e86\u94fe\u8868\u6cd5\u89e3\u51b3\u51b2\u7a81\uff0cThreadLocalMap \u662f\u901a\u8fc7\u7ebf\u6027\u63a2\u6d4b\u7684\u5f00\u653e\u5bfb\u5740\u6cd5\u6765\u89e3\u51b3\u51b2\u7a81\u3002\u90a3\u4f60\u77e5\u9053\uff0c\u8fd9\u4e24\u79cd\u51b2\u7a81\u89e3\u51b3\u65b9\u6cd5\u5404\u6709\u4ec0\u4e48\u4f18\u52bf\u548c\u52a3\u52bf\uff0c\u53c8\u5404\u81ea\u9002\u7528\u54ea\u4e9b\u573a\u666f\u5417\uff1f</p>"},{"location":"read/beautiful-algo/hashmap/#331","title":"3.3.1 \u5f00\u653e\u5bfb\u5740\u6cd5\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9 \u5f00\u653e\u5bfb\u5740\u6cd5\u4e0d\u50cf\u94fe\u8868\u6cd5\uff0c\u9700\u8981\u62c9\u5f88\u591a\u94fe\u8868\u3002\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6570\u7ec4\u4e2d\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u5229\u7528 CPU \u7f13\u5b58\u52a0\u5feb\u67e5\u8be2\u901f\u5ea6\u3002\u800c\u4e14\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5b9e\u73b0\u7684\u6563\u5217\u8868\uff0c\u5e8f\u5217\u5316\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\u3002\u94fe\u8868\u6cd5\u5305\u542b\u6307\u9488\uff0c\u5e8f\u5217\u5316\u8d77\u6765\u5c31\u6ca1\u90a3\u4e48\u5bb9\u6613\u3002</p> <p>\u7f3a\u70b9 \u7528\u5f00\u653e\u5bfb\u5740\u6cd5\u89e3\u51b3\u51b2\u7a81\u7684\u6563\u5217\u8868\uff0c\u5220\u9664\u6570\u636e\u7684\u65f6\u5019\u6bd4\u8f83\u9ebb\u70e6\uff0c\u9700\u8981\u7279\u6b8a\u6807\u8bb0\u5df2\u7ecf\u5220\u9664\u6389\u7684\u6570\u636e\u3002\u800c\u4e14\uff0c\u5728\u5f00\u653e\u5bfb\u5740\u6cd5\u4e2d\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u4e00\u4e2a\u6570\u7ec4\u4e2d\uff0c\u6bd4\u8d77\u94fe\u8868\u6cd5\u6765\u8bf4\uff0c\u51b2\u7a81\u7684\u4ee3\u4ef7\u66f4\u9ad8\u3002\u6240\u4ee5\uff0c\u4f7f\u7528\u5f00\u653e\u5bfb\u5740\u6cd5\u89e3\u51b3\u51b2\u7a81\u7684\u6563\u5217\u8868\uff0c\u88c5\u8f7d\u56e0\u5b50\u7684\u4e0a\u9650\u4e0d\u80fd\u592a\u5927\u3002\u8fd9\u4e5f\u5bfc\u81f4\u8fd9\u79cd\u65b9\u6cd5\u6bd4\u94fe\u8868\u6cd5\u66f4\u6d6a\u8d39\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u5f53\u6570\u636e\u91cf\u6bd4\u8f83\u5c0f\u3001\u88c5\u8f7d\u56e0\u5b50\u5c0f\u7684\u65f6\u5019\uff0c\u9002\u5408\u91c7\u7528\u5f00\u653e\u5bfb\u5740\u6cd5\u3002\u8fd9\u4e5f\u662f Java \u4e2d\u7684ThreadLocalMap\u4f7f\u7528\u5f00\u653e\u5bfb\u5740\u6cd5\u89e3\u51b3\u6563\u5217\u51b2\u7a81\u7684\u539f\u56e0\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#332","title":"3.3.2 \u94fe\u8868\u6cd5\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9 1. \u94fe\u8868\u6cd5\u5bf9\u5185\u5b58\u7684\u5229\u7528\u7387\u6bd4\u5f00\u653e\u5bfb\u5740\u6cd5\u8981\u9ad8\u3002\u56e0\u4e3a\u94fe\u8868\u7ed3\u70b9\u53ef\u4ee5\u5728\u9700\u8981\u7684\u65f6\u5019\u518d\u521b\u5efa\uff0c\u5e76\u4e0d\u9700\u8981\u50cf\u5f00\u653e\u5bfb\u5740\u6cd5\u90a3\u6837\u4e8b\u5148\u7533\u8bf7\u597d 2. \u94fe\u8868\u6cd5\u6bd4\u8d77\u5f00\u653e\u5bfb\u5740\u6cd5\uff0c\u5bf9\u5927\u88c5\u8f7d\u56e0\u5b50\u7684\u5bb9\u5fcd\u5ea6\u66f4\u9ad8\u3002\u5f00\u653e\u5bfb\u5740\u6cd5\u53ea\u80fd\u9002\u7528\u88c5\u8f7d\u56e0\u5b50\u5c0f\u4e8e 1 \u7684\u60c5\u51b5\u3002\u63a5\u8fd1 1 \u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u6709\u5927\u91cf\u7684\u6563\u5217\u51b2\u7a81\uff0c\u5bfc\u81f4\u5927\u91cf\u7684\u63a2\u6d4b\u3001\u518d\u6563\u5217\u7b49\uff0c\u6027\u80fd\u4f1a\u4e0b\u964d\u5f88\u591a\u3002\u4f46\u662f\u5bf9\u4e8e\u94fe\u8868\u6cd5\u6765\u8bf4\uff0c\u53ea\u8981\u6563\u5217\u51fd\u6570\u7684\u503c\u968f\u673a\u5747\u5300\uff0c\u5373\u4fbf\u88c5\u8f7d\u56e0\u5b50\u53d8\u6210 10\uff0c\u4e5f\u5c31\u662f\u94fe\u8868\u7684\u957f\u5ea6\u53d8\u957f\u4e86\u800c\u5df2\uff0c\u867d\u7136\u67e5\u627e\u6548\u7387\u6709\u6240\u4e0b\u964d\uff0c\u4f46\u662f\u6bd4\u8d77\u987a\u5e8f\u67e5\u627e\u8fd8\u662f\u5feb\u5f88\u591a\u3002</p> <p>\u7f3a\u70b9 1. \u94fe\u8868\u56e0\u4e3a\u8981\u5b58\u50a8\u6307\u9488\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6bd4\u8f83\u5c0f\u7684\u5bf9\u8c61\u7684\u5b58\u50a8\uff0c\u662f\u6bd4\u8f83\u6d88\u8017\u5185\u5b58\u7684\uff0c\u8fd8\u6709\u53ef\u80fd\u4f1a\u8ba9\u5185\u5b58\u7684\u6d88\u8017\u7ffb\u500d\u3002 2. \u56e0\u4e3a\u94fe\u8868\u4e2d\u7684\u7ed3\u70b9\u662f\u96f6\u6563\u5206\u5e03\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u5bf9 CPU \u7f13\u5b58\u662f\u4e0d\u53cb\u597d\u7684\uff0c\u8fd9\u65b9\u9762\u5bf9\u4e8e\u6267\u884c\u6548\u7387\u4e5f\u6709\u4e00\u5b9a\u7684\u5f71\u54cd\u3002</p> <p>\u5f53\u7136\uff0c\u5982\u679c\u6211\u4eec\u5b58\u50a8\u7684\u662f\u5927\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u5b58\u50a8\u7684\u5bf9\u8c61\u7684\u5927\u5c0f\u8fdc\u8fdc\u5927\u4e8e\u4e00\u4e2a\u6307\u9488\u7684\u5927\u5c0f\uff084 \u4e2a\u5b57\u8282\u6216\u8005 8 \u4e2a\u5b57\u8282\uff09\uff0c\u90a3\u94fe\u8868\u4e2d\u6307\u9488\u7684\u5185\u5b58\u6d88\u8017\u5728\u5927\u5bf9\u8c61\u9762\u524d\u5c31\u53ef\u4ee5\u5ffd\u7565\u4e86\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u5bf9\u94fe\u8868\u6cd5\u7a0d\u52a0\u6539\u9020\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u66f4\u52a0\u9ad8\u6548\u7684\u6563\u5217\u8868\u3002\u90a3\u5c31\u662f\uff0c\u6211\u4eec\u5c06\u94fe\u8868\u6cd5\u4e2d\u7684\u94fe\u8868\u6539\u9020\u4e3a\u5176\u4ed6\u9ad8\u6548\u7684\u52a8\u6001\u6570\u636e\u7ed3\u6784\uff0c\u6bd4\u5982\u8df3\u8868\u3001\u7ea2\u9ed1\u6811\u3002\u8fd9\u6837\uff0c\u5373\u4fbf\u51fa\u73b0\u6563\u5217\u51b2\u7a81\uff0c\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u6563\u5217\u5230\u540c\u4e00\u4e2a\u6876\u5185\uff0c\u90a3\u6700\u7ec8\u9000\u5316\u6210\u7684\u6563\u5217\u8868\u7684\u67e5\u627e\u65f6\u95f4\u4e5f\u53ea\u4e0d\u8fc7\u662f O(logn)\u3002\u8fd9\u6837\u4e5f\u5c31\u6709\u6548\u907f\u514d\u4e86\u524d\u9762\u8bb2\u5230\u7684\u6563\u5217\u78b0\u649e\u653b\u51fb\u3002 </p> <p>\u57fa\u4e8e\u94fe\u8868\u7684\u6563\u5217\u51b2\u7a81\u5904\u7406\u65b9\u6cd5\u6bd4\u8f83\u9002\u5408\u5b58\u50a8\u5927\u5bf9\u8c61\u3001\u5927\u6570\u636e\u91cf\u7684\u6563\u5217\u8868\uff0c\u800c\u4e14\uff0c\u6bd4\u8d77\u5f00\u653e\u5bfb\u5740\u6cd5\uff0c\u5b83\u66f4\u52a0\u7075\u6d3b\uff0c\u652f\u6301\u66f4\u591a\u7684\u4f18\u5316\u7b56\u7565\uff0c\u6bd4\u5982\u7528\u7ea2\u9ed1\u6811\u4ee3\u66ff\u94fe\u8868\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#4","title":"4 \u88c5\u8f7d\u56e0\u5b50","text":"<p>\u4e0d\u7ba1\u91c7\u7528\u54ea\u79cd\u63a2\u6d4b\u65b9\u6cd5\uff0c\u5f53\u6563\u5217\u8868\u4e2d\u7a7a\u95f2\u4f4d\u7f6e\u4e0d\u591a\u7684\u65f6\u5019\uff0c\u6563\u5217\u51b2\u7a81\u7684\u6982\u7387\u5c31\u4f1a\u5927\u5927\u63d0\u9ad8\u3002\u4e3a\u4e86\u5c3d\u53ef\u80fd\u4fdd\u8bc1\u6563\u5217\u8868\u7684\u64cd\u4f5c\u6548\u7387\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u5c3d\u53ef\u80fd\u4fdd\u8bc1\u6563\u5217\u8868\u4e2d\u6709\u4e00\u5b9a\u6bd4\u4f8b\u7684\u7a7a\u95f2\u69fd\u4f4d\u3002\u6211\u4eec\u7528\u88c5\u8f7d\u56e0\u5b50\uff08load factor\uff09\u6765\u8868\u793a\u7a7a\u4f4d\u7684\u591a\u5c11\u3002</p> <p>\u88c5\u8f7d\u56e0\u5b50\u7684\u8ba1\u7b97\u516c\u5f0f\u662f\uff1a <pre><code>\u88c5\u8f7d\u56e0\u5b50 = \u586b\u5165\u8868\u4e2d\u7684\u5143\u7d20\u4e2a\u6570 / \u6563\u5217\u8868\u7684\u957f\u5ea6\n</code></pre></p> <p>\u88c5\u8f7d\u56e0\u5b50\u8d8a\u5927\uff0c\u8bf4\u660e\u7a7a\u95f2\u4f4d\u7f6e\u8d8a\u5c11\uff0c\u51b2\u7a81\u8d8a\u591a\uff0c\u6563\u5217\u8868\u7684\u6027\u80fd\u4f1a\u4e0b\u964d\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#41","title":"4.1 \u88c5\u8f7d\u56e0\u5b50\u8fc7\u5927\u4e86\u600e\u4e48\u529e\uff1f","text":"<p>\u88c5\u8f7d\u56e0\u5b50\u8d8a\u5927\uff0c\u8bf4\u660e\u6563\u5217\u8868\u4e2d\u7684\u5143\u7d20\u8d8a\u591a\uff0c\u7a7a\u95f2\u4f4d\u7f6e\u8d8a\u5c11\uff0c\u6563\u5217\u51b2\u7a81\u7684\u6982\u7387\u5c31\u8d8a\u5927\u3002\u4e0d\u4ec5\u63d2\u5165\u6570\u636e\u7684\u8fc7\u7a0b\u8981\u591a\u6b21\u5bfb\u5740\u6216\u8005\u62c9\u5f88\u957f\u7684\u94fe\uff0c\u67e5\u627e\u7684\u8fc7\u7a0b\u4e5f\u4f1a\u56e0\u6b64\u53d8\u5f97\u5f88\u6162\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53\u88c5\u8f7d\u56e0\u5b50\u8fc7\u5927\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6269\u5bb9\uff0c\u91cd\u65b0\u6563\u5217\u3002</p> <p>\u9488\u5bf9\u6570\u7ec4\u7684\u6269\u5bb9\uff0c\u6570\u636e\u642c\u79fb\u64cd\u4f5c\u6bd4\u8f83\u7b80\u5355\u3002\u4f46\u662f\uff0c\u9488\u5bf9\u6563\u5217\u8868\u7684\u6269\u5bb9\uff0c\u6570\u636e\u642c\u79fb\u64cd\u4f5c\u8981\u590d\u6742\u5f88\u591a\u3002\u56e0\u4e3a\u6563\u5217\u8868\u7684\u5927\u5c0f\u53d8\u4e86\uff0c\u6570\u636e\u7684\u5b58\u50a8\u4f4d\u7f6e\u4e5f\u53d8\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u901a\u8fc7\u6563\u5217\u51fd\u6570\u91cd\u65b0\u8ba1\u7b97\u6bcf\u4e2a\u6570\u636e\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002</p> <p>\u5bf9\u4e8e\u652f\u6301\u52a8\u6001\u6269\u5bb9\u7684\u6563\u5217\u8868\uff0c\u63d2\u5165\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u591a\u5c11\u5462\uff1f</p> <p>\u63d2\u5165\u4e00\u4e2a\u6570\u636e\uff0c\u6700\u597d\u60c5\u51b5\u4e0b\uff0c\u4e0d\u9700\u8981\u6269\u5bb9\uff0c\u6700\u597d\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002\u6700\u574f\u60c5\u51b5\u4e0b\uff0c\u6563\u5217\u8868\u88c5\u8f7d\u56e0\u5b50\u8fc7\u9ad8\uff0c\u542f\u52a8\u6269\u5bb9\uff0c\u6211\u4eec\u9700\u8981\u91cd\u65b0\u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\uff0c\u91cd\u65b0\u8ba1\u7b97\u54c8\u5e0c\u4f4d\u7f6e\uff0c\u5e76\u4e14\u642c\u79fb\u6570\u636e\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002\u7528\u644a\u8fd8\u5206\u6790\u6cd5\uff0c\u5747\u644a\u60c5\u51b5\u4e0b\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u63a5\u8fd1\u6700\u597d\u60c5\u51b5\uff0c\u5c31\u662f O(1)\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u52a8\u6001\u6563\u5217\u8868\uff0c\u968f\u7740\u6570\u636e\u7684\u5220\u9664\uff0c\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\u4f1a\u8d8a\u6765\u8d8a\u5c11\uff0c\u7a7a\u95f2\u7a7a\u95f4\u4f1a\u8d8a\u6765\u8d8a\u591a\u3002\u5982\u679c\u6211\u4eec\u5bf9\u7a7a\u95f4\u6d88\u8017\u975e\u5e38\u654f\u611f\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u88c5\u8f7d\u56e0\u5b50\u5c0f\u4e8e\u67d0\u4e2a\u503c\u4e4b\u540e\uff0c\u542f\u52a8\u52a8\u6001\u7f29\u5bb9\u3002\u5f53\u7136\uff0c\u5982\u679c\u6211\u4eec\u66f4\u52a0\u5728\u610f\u6267\u884c\u6548\u7387\uff0c\u80fd\u591f\u5bb9\u5fcd\u591a\u6d88\u8017\u4e00\u70b9\u5185\u5b58\u7a7a\u95f4\uff0c\u90a3\u5c31\u53ef\u4ee5\u4e0d\u7528\u8d39\u52b2\u6765\u7f29\u5bb9\u4e86\u3002</p> <p>\u5f53\u6563\u5217\u8868\u7684\u88c5\u8f7d\u56e0\u5b50\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u65f6\uff0c\u5c31\u9700\u8981\u8fdb\u884c\u6269\u5bb9\u3002\u88c5\u8f7d\u56e0\u5b50\u9608\u503c\u9700\u8981\u9009\u62e9\u5f97\u5f53\u3002\u5982\u679c\u592a\u5927\uff0c\u4f1a\u5bfc\u81f4\u51b2\u7a81\u8fc7\u591a\uff1b\u5982\u679c\u592a\u5c0f\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u6d6a\u8d39\u4e25\u91cd\u3002</p> <p>\u88c5\u8f7d\u56e0\u5b50\u9608\u503c\u7684\u8bbe\u7f6e\u8981\u6743\u8861\u65f6\u95f4\u3001\u7a7a\u95f4\u590d\u6742\u5ea6\u3002\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u7d27\u5f20\uff0c\u5bf9\u6267\u884c\u6548\u7387\u8981\u6c42\u5f88\u9ad8\uff0c\u53ef\u4ee5\u964d\u4f4e\u8d1f\u8f7d\u56e0\u5b50\u7684\u9608\u503c\uff1b\u76f8\u53cd\uff0c\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u7d27\u5f20\uff0c\u5bf9\u6267\u884c\u6548\u7387\u8981\u6c42\u53c8\u4e0d\u9ad8\uff0c\u53ef\u4ee5\u589e\u52a0\u8d1f\u8f7d\u56e0\u5b50\u7684\u503c\uff0c\u751a\u81f3\u53ef\u4ee5\u5927\u4e8e 1\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#42","title":"4.2 \u5982\u4f55\u907f\u514d\u4f4e\u6548\u7684\u6269\u5bb9\uff1f","text":"<p>\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u52a8\u6001\u6269\u5bb9\u7684\u6563\u5217\u8868\u63d2\u5165\u4e00\u4e2a\u6570\u636e\u90fd\u5f88\u5feb\uff0c\u4f46\u662f\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u5f53\u88c5\u8f7d\u56e0\u5b50\u5df2\u7ecf\u5230\u8fbe\u9608\u503c\uff0c\u9700\u8981\u5148\u8fdb\u884c\u6269\u5bb9\uff0c\u518d\u63d2\u5165\u6570\u636e\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u63d2\u5165\u6570\u636e\u5c31\u4f1a\u53d8\u5f97\u5f88\u6162\uff0c\u751a\u81f3\u4f1a\u65e0\u6cd5\u63a5\u53d7\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e00\u6b21\u6027\u6269\u5bb9\u8017\u65f6\u8fc7\u591a\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6269\u5bb9\u64cd\u4f5c\u7a7f\u63d2\u5728\u63d2\u5165\u64cd\u4f5c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5206\u6279\u5b8c\u6210\u3002</p> <p>\u5f53\u6709\u65b0\u6570\u636e\u8981\u63d2\u5165\u65f6\uff0c\u6211\u4eec\u5c06\u65b0\u6570\u636e\u63d2\u5165\u65b0\u6563\u5217\u8868\u4e2d\uff0c\u5e76\u4e14\u4ece\u8001\u7684\u6563\u5217\u8868\u4e2d\u62ff\u51fa\u4e00\u4e2a\u6570\u636e\u653e\u5165\u5230\u65b0\u6563\u5217\u8868\u3002\u6bcf\u6b21\u63d2\u5165\u4e00\u4e2a\u6570\u636e\u5230\u6563\u5217\u8868\uff0c\u6211\u4eec\u90fd\u91cd\u590d\u4e0a\u9762\u7684\u8fc7\u7a0b\u3002\u7ecf\u8fc7\u591a\u6b21\u63d2\u5165\u64cd\u4f5c\u4e4b\u540e\uff0c\u8001\u7684\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\u5c31\u4e00\u70b9\u4e00\u70b9\u5168\u90e8\u642c\u79fb\u5230\u65b0\u6563\u5217\u8868\u4e2d\u4e86\u3002\u8fd9\u6837\u6ca1\u6709\u4e86\u96c6\u4e2d\u7684\u4e00\u6b21\u6027\u6570\u636e\u642c\u79fb\uff0c\u63d2\u5165\u64cd\u4f5c\u5c31\u90fd\u53d8\u5f97\u5f88\u5feb\u4e86\u3002</p> <p>\u8fd9\u671f\u95f4\u7684\u67e5\u8be2\u64cd\u4f5c\u600e\u4e48\u6765\u505a\u5462\uff1f\u5bf9\u4e8e\u67e5\u8be2\u64cd\u4f5c\uff0c\u4e3a\u4e86\u517c\u5bb9\u4e86\u65b0\u3001\u8001\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\uff0c\u6211\u4eec\u5148\u4ece\u65b0\u6563\u5217\u8868\u4e2d\u67e5\u627e\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\uff0c\u518d\u53bb\u8001\u7684\u6563\u5217\u8868\u4e2d\u67e5\u627e\u3002</p> <p>\u901a\u8fc7\u8fd9\u6837\u5747\u644a\u7684\u65b9\u6cd5\uff0c\u5c06\u4e00\u6b21\u6027\u6269\u5bb9\u7684\u4ee3\u4ef7\uff0c\u5747\u644a\u5230\u591a\u6b21\u63d2\u5165\u64cd\u4f5c\u4e2d\uff0c\u5c31\u907f\u514d\u4e86\u4e00\u6b21\u6027\u6269\u5bb9\u8017\u65f6\u8fc7\u591a\u7684\u60c5\u51b5\u3002\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u63d2\u5165\u4e00\u4e2a\u6570\u636e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(1)\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#5","title":"5. \u5c0f\u7ed3","text":""},{"location":"read/beautiful-algo/hashmap/#51","title":"5.1 \u5de5\u4e1a\u7ea7\u7684\u6563\u5217\u8868\u5e94\u8be5\u5177\u6709\u54ea\u4e9b\u7279\u6027","text":"<ul> <li>\u652f\u6301\u5feb\u901f\u5730\u67e5\u8be2\u3001\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\uff1b</li> <li>\u5185\u5b58\u5360\u7528\u5408\u7406\uff0c\u4e0d\u80fd\u6d6a\u8d39\u8fc7\u591a\u7684\u5185\u5b58\u7a7a\u95f4\uff1b</li> <li>\u6027\u80fd\u7a33\u5b9a\uff0c\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u6563\u5217\u8868\u7684\u6027\u80fd\u4e5f\u4e0d\u4f1a\u9000\u5316\u5230\u65e0\u6cd5\u63a5\u53d7\u7684\u60c5\u51b5\u3002</li> </ul>"},{"location":"read/beautiful-algo/hashmap/#52","title":"5.2 \u5982\u4f55\u5b9e\u73b0\u8fd9\u6837\u4e00\u4e2a\u6563\u5217\u8868","text":"<ul> <li>\u8bbe\u8ba1\u4e00\u4e2a\u5408\u9002\u7684\u6563\u5217\u51fd\u6570\uff1b</li> <li>\u5b9a\u4e49\u88c5\u8f7d\u56e0\u5b50\u9608\u503c\uff0c\u5e76\u4e14\u8bbe\u8ba1\u52a8\u6001\u6269\u5bb9\u7b56\u7565\uff1b</li> <li>\u9009\u62e9\u5408\u9002\u7684\u6563\u5217\u51b2\u7a81\u89e3\u51b3\u65b9\u6cd5\u3002</li> </ul>"},{"location":"read/beautiful-algo/hashmap/#6","title":"6. \u6563\u5217\u8868\u548c\u94fe\u8868\u7ed3\u5408\u4f7f\u7528","text":"<p>\u6563\u5217\u8868\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u867d\u7136\u652f\u6301\u975e\u5e38\u9ad8\u6548\u7684\u6570\u636e\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u627e\u64cd\u4f5c\uff0c\u4f46\u662f\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\u90fd\u662f\u901a\u8fc7\u6563\u5217\u51fd\u6570\u6253\u4e71\u4e4b\u540e\u65e0\u89c4\u5f8b\u5b58\u50a8\u7684\u3002\u4e5f\u5c31\u8bf4\uff0c\u5b83\u65e0\u6cd5\u652f\u6301\u6309\u7167\u67d0\u79cd\u987a\u5e8f\u5feb\u901f\u5730\u904d\u5386\u6570\u636e\u3002\u5982\u679c\u5e0c\u671b\u6309\u7167\u987a\u5e8f\u904d\u5386\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\uff0c\u90a3\u6211\u4eec\u9700\u8981\u5c06\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u6570\u7ec4\u4e2d\uff0c\u7136\u540e\u6392\u5e8f\uff0c\u518d\u904d\u5386\u3002</p> <p>\u56e0\u4e3a\u6563\u5217\u8868\u662f\u52a8\u6001\u6570\u636e\u7ed3\u6784\uff0c\u4e0d\u505c\u5730\u6709\u6570\u636e\u7684\u63d2\u5165\u3001\u5220\u9664\uff0c\u6240\u4ee5\u6bcf\u5f53\u6211\u4eec\u5e0c\u671b\u6309\u987a\u5e8f\u904d\u5386\u6563\u5217\u8868\u4e2d\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u9700\u8981\u5148\u6392\u5e8f\uff0c\u90a3\u6548\u7387\u52bf\u5fc5\u4f1a\u5f88\u4f4e\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5c06\u6563\u5217\u8868\u548c\u94fe\u8868\uff08\u6216\u8005\u8df3\u8868\uff09\u7ed3\u5408\u5728\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"read/beautiful-algo/hashmap/#61","title":"6.1 \u5e94\u7528\u5b9e\u4f8b","text":"<ul> <li>LRU \u7f13\u5b58\u6dd8\u6c70\u7b97\u6cd5</li> <li>Redis \u6709\u5e8f\u96c6\u5408</li> <li>LinkedHashMap</li> </ul>"},{"location":"read/beautiful-algo/heap/","title":"\u5806","text":""},{"location":"read/beautiful-algo/heap/#_2","title":"\u5b9a\u4e49","text":"<p>\u5806\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6811\uff0c\u5b83\u6ee1\u8db3\u4e0b\u5217\u6027\u8d28\uff1a</p> <ol> <li>\u662f\u4e00\u68f5\u5b8c\u5168\u4e8c\u53c9\u6811</li> <li>\u6811\u4e2d\u4efb\u610f\u8282\u70b9\u7684\u503c\u603b\u662f\u4e0d\u5927\u4e8e\uff08\u6216\u4e0d\u5c0f\u4e8e\uff09\u5176\u5b50\u6811\u4e2d\u6bcf\u4e2a\u8282\u70b9\u7684\u503c</li> </ol> <p>\u5173\u4e8e\u7b2c\u4e8c\u70b9\uff0c \u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6362\u4e00\u79cd\u8bf4\u6cd5\uff0c\u5806\u4e2d\u6bcf\u4e2a\u8282\u70b9\u7684\u503c\u90fd\u5927\u4e8e\u7b49\u4e8e\uff08\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\uff09\u5176\u5de6\u53f3\u5b50\u8282\u70b9\u7684\u503c\u3002\u8fd9\u4e24\u79cd\u8868\u8ff0\u662f\u7b49\u4ef7\u7684\u3002</p> <p>\u5806\u5206\u4e3a\u5927\u9876\u5806\u548c\u5c0f\u9876\u5806\uff0c\u5927\u9876\u5806\u4e2d\u6bcf\u4e2a\u8282\u70b9\u7684\u503c\u90fd\u5927\u4e8e\u7b49\u4e8e\u5176\u5de6\u53f3\u5b50\u8282\u70b9\u7684\u503c\uff0c\u5c0f\u9876\u5806\u4e2d\u6bcf\u4e2a\u8282\u70b9\u7684\u503c\u90fd\u5c0f\u4e8e\u7b49\u4e8e\u5176\u5de6\u53f3\u5b50\u8282\u70b9\u7684\u503c\u3002</p>"},{"location":"read/beautiful-algo/heap/#_3","title":"\u5b9e\u73b0","text":"<p>\u524d\u9762\u8bb2\u8fc7\uff0c\u5b8c\u5168\u4e8c\u53c9\u6811\u6bd4\u8f83\u9002\u5408\u7528\u6570\u7ec4\u6765\u5b58\u50a8\u3002\u7528\u6570\u7ec4\u6765\u5b58\u50a8\u5b8c\u5168\u4e8c\u53c9\u6811\u662f\u975e\u5e38\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u7684\u3002</p> <p></p> <p>\u6570\u7ec4\u4e2d\u4e0b\u6807\u4e3a i \u7684\u8282\u70b9\u7684\u5de6\u5b50\u8282\u70b9\uff0c\u5c31\u662f\u4e0b\u6807\u4e3a <code>i\u22172</code> \u7684\u8282\u70b9\uff0c\u53f3\u5b50\u8282\u70b9\u5c31\u662f\u4e0b\u6807\u4e3a <code>i\u22172+1</code> \u7684\u8282\u70b9\uff0c\u7236\u8282\u70b9\u5c31\u662f\u4e0b\u6807\u4e3a <code>i/2</code>\u200b \u7684\u8282\u70b9\u3002</p> <p>\u5806\u5316\uff08heapify\uff09\u662f\u6307\u5c06\u4e00\u4e2a\u65e0\u5e8f\u7684\u5b8c\u5168\u4e8c\u53c9\u6811\u8c03\u6574\u6210\u5806\u7684\u8fc7\u7a0b\u3002\u5806\u5316\u5b9e\u9645\u4e0a\u6709\u4e24\u79cd\uff0c\u4ece\u4e0b\u5f80\u4e0a\u548c\u4ece\u4e0a\u5f80\u4e0b\u3002 \u5806\u5316\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u987a\u7740\u8282\u70b9\u6240\u5728\u7684\u8def\u5f84\uff0c\u5411\u4e0a\u6216\u8005\u5411\u4e0b\uff0c\u5bf9\u6bd4\uff0c\u7136\u540e\u4ea4\u6362\u3002</p>"},{"location":"read/beautiful-algo/heap/#_4","title":"\u5f80\u5806\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20","text":"<p>\u5f80\u5806\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5f80\u5b8c\u5168\u4e8c\u53c9\u6811\u4e2d\u63d2\u5165\u4e00\u4e2a\u8282\u70b9\uff0c\u7136\u540e\u4ece\u4e0b\u5f80\u4e0a\u5806\u5316\u3002</p> <pre><code>public class Heap {\nprivate int[] a; // \u6570\u7ec4\uff0c\u4ece\u4e0b\u68071\u5f00\u59cb\u5b58\u50a8\u6570\u636e\nprivate int n;  // \u5806\u53ef\u4ee5\u5b58\u50a8\u7684\u6700\u5927\u6570\u636e\u4e2a\u6570\nprivate int count; // \u5806\u4e2d\u5df2\u7ecf\u5b58\u50a8\u7684\u6570\u636e\u4e2a\u6570\npublic Heap(int capacity) {\na = new int[capacity + 1];\nn = capacity;\ncount = 0;\n}\npublic void insert(int data) {\nif (count &gt;= n) return; // \u5806\u6ee1\u4e86\n++count;\na[count] = data;\nint i = count;\nwhile (i/2 &gt; 0 &amp;&amp; a[i] &gt; a[i/2]) { // \u81ea\u4e0b\u5f80\u4e0a\u5806\u5316\nswap(a, i, i/2); // swap()\u51fd\u6570\u4f5c\u7528\uff1a\u4ea4\u6362\u4e0b\u6807\u4e3ai\u548ci/2\u7684\u4e24\u4e2a\u5143\u7d20\ni = i/2;\n}\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/heap/#_5","title":"\u5220\u9664\u5806\u9876\u5143\u7d20","text":"<p>\u5220\u9664\u5806\u9876\u5143\u7d20\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5220\u9664\u5b8c\u5168\u4e8c\u53c9\u6811\u7684\u6839\u8282\u70b9\uff0c\u7136\u540e\u5c06\u6700\u540e\u4e00\u4e2a\u8282\u70b9\u653e\u5230\u6839\u8282\u70b9\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u4ece\u4e0a\u5f80\u4e0b\u5806\u5316\u3002</p> <pre><code>public void removeMax() {\nif (count == 0) return -1; // \u5806\u4e2d\u6ca1\u6709\u6570\u636e\na[1] = a[count];\n--count;\nheapify(a, count, 1);\n}\nprivate void heapify(int[] a, int n, int i) { // \u81ea\u4e0a\u5f80\u4e0b\u5806\u5316\nwhile (true) {\nint maxPos = i;\nif (i*2 &lt;= n &amp;&amp; a[i] &lt; a[i*2]) maxPos = i*2;\nif (i*2+1 &lt;= n &amp;&amp; a[maxPos] &lt; a[i*2+1]) maxPos = i*2+1;\nif (maxPos == i) break;\nswap(a, i, maxPos);\ni = maxPos;\n}\n}\n</code></pre> <p>\u6211\u4eec\u77e5\u9053\uff0c\u4e00\u4e2a\u5305\u542b n \u4e2a\u8282\u70b9\u7684\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c\u6811\u7684\u9ad8\u5ea6\u4e0d\u4f1a\u8d85\u8fc7 log2\u200bn\u3002\u5806\u5316\u7684\u8fc7\u7a0b\u662f\u987a\u7740\u8282\u70b9\u6240\u5728\u8def\u5f84\u6bd4\u8f83\u4ea4\u6362\u7684\uff0c\u6240\u4ee5\u5806\u5316\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8ddf\u6811\u7684\u9ad8\u5ea6\u6210\u6b63\u6bd4\uff0c\u4e5f\u5c31\u662f O(logn)\u3002\u63d2\u5165\u6570\u636e\u548c\u5220\u9664\u5806\u9876\u5143\u7d20\u7684\u4e3b\u8981\u903b\u8f91\u5c31\u662f\u5806\u5316\uff0c\u6240\u4ee5\uff0c\u5f80\u5806\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\u548c\u5220\u9664\u5806\u9876\u5143\u7d20\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(logn)\u3002</p>"},{"location":"read/beautiful-algo/heap/#_6","title":"\u5806\u6392\u5e8f","text":"<p>\u5806\u6392\u5e8f\u662f\u5229\u7528\u5806\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u6240\u8bbe\u8ba1\u7684\u4e00\u79cd\u6392\u5e8f\u7b97\u6cd5\u3002\u8fd9\u79cd\u6392\u5e8f\u65b9\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u975e\u5e38\u7a33\u5b9a\uff0c\u662f O(nlogn)\uff0c\u5e76\u4e14\u5b83\u8fd8\u662f\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u3002\u5806\u6392\u5e8f\u4e0d\u662f\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5\u3002</p>"},{"location":"read/beautiful-algo/heap/#_7","title":"\u5b9e\u73b0","text":"<p>\u5806\u6392\u5e8f\u7684\u601d\u8def\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u5148\u5c06\u5f85\u6392\u5e8f\u7684\u6570\u7ec4\u6784\u5efa\u6210\u4e00\u4e2a\u5806\uff0c\u7136\u540e\u518d\u4f9d\u6b21\u5c06\u5806\u9876\u5143\u7d20\u548c\u5806\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4ea4\u6362\uff0c\u7136\u540e\u518d\u4ece\u4e0a\u5f80\u4e0b\u5806\u5316\uff0c\u76f4\u5230\u5806\u4e2d\u53ea\u5269\u4e0b\u4e00\u4e2a\u5143\u7d20\u4e3a\u6b62\u3002</p> <p>\u5927\u81f4\u5206\u89e3\u6210\u4e24\u4e2a\u5927\u7684\u6b65\u9aa4\uff0c\u5efa\u5806\u548c\u6392\u5e8f\u3002</p>"},{"location":"read/beautiful-algo/heap/#_8","title":"\u5efa\u5806","text":"<p>\u5efa\u5806\u7684\u8fc7\u7a0b\u5c31\u662f\u4ece\u4e0b\u5f80\u4e0a\u5806\u5316\uff0c\u4ece\u7b2c\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\u5f00\u59cb\uff0c\u4f9d\u6b21\u5411\u4e0a\u5806\u5316\u3002</p> <pre><code>private static void buildHeap(int[] a, int n) {\nfor (int i = n/2; i &gt;= 1; --i) {\nheapify(a, n, i);\n}\n}\nprivate static void heapify(int[] a, int n, int i) {\nwhile (true) {\nint maxPos = i;\nif (i*2 &lt;= n &amp;&amp; a[i] &lt; a[i*2]) maxPos = i*2;\nif (i*2+1 &lt;= n &amp;&amp; a[maxPos] &lt; a[i*2+1]) maxPos = i*2+1;\nif (maxPos == i) break;\nswap(a, i, maxPos);\ni = maxPos;\n}\n}\n</code></pre> <p>\u6211\u4eec\u5bf9\u4e0b\u6807\u4ece 2n\u200b \u5f00\u59cb\u5230 1 \u7684\u6570\u636e\u8fdb\u884c\u5806\u5316\uff0c\u4e0b\u6807\u662f 2n\u200b+1 \u5230 n \u7684\u8282\u70b9\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u5806\u5316\u3002\u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u5b8c\u5168\u4e8c\u53c9\u6811\u6765\u8bf4\uff0c\u4e0b\u6807\u4ece 2n\u200b+1 \u5230 n \u7684\u8282\u70b9\u90fd\u662f\u53f6\u5b50\u8282\u70b9\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4ece 2n\u200b \u5f00\u59cb\u5806\u5316\uff1f</p> <p>\u4f7f\u7528\u6570\u7ec4\u5b58\u50a8\u8868\u793a\u5b8c\u5168\u4e8c\u53c9\u6811\u65f6\uff0c\u4ece\u6570\u7ec4\u4e0b\u6807\u4e3a1\u5f00\u59cb\u5b58\u50a8\u6570\u636e\uff0c\u6570\u7ec4\u4e0b\u6807\u4e3ai\u7684\u8282\u70b9\uff0c\u5de6\u5b50\u8282\u70b9\u4e3a2i, \u53f3\u5b50\u8282\u70b9\u4e3a2i + 1.  \u8fd9\u4e2a\u7ed3\u8bba\u5f88\u91cd\u8981\uff08\u53ef\u4ee5\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e)\uff0c\u5c06\u6b64\u7ed3\u8bba\u8bb0\u4e3a\u300e\u539f\u74061\u300f\uff0c\u4ee5\u4e0b\u8bc1\u660e\u4f1a\u7528\u5230\u8fd9\u4e2a\u539f\u7406\u3002</p> <p>\u4e3a\u4ec0\u4e48\uff0c\u5bf9\u4e8e\u5b8c\u5168\u4e8c\u53c9\u6811\u6765\u8bf4\uff0c\u4e0b\u6807\u4ecen/2 + 1 \u5230 n\u7684\u8282\u70b9\u90fd\u662f\u53f6\u5b50\u8282\u70b9\uff1f \u4f7f\u7528\u53cd\u8bc1\u6cd5\u8bc1\u660e\u5373\u53ef\uff1a</p> <p>\u5982\u679c\u4e0b\u6807\u4e3an/2 + 1\u7684\u8282\u70b9\u4e0d\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u5373\u5b83\u5b58\u5728\u5b50\u8282\u70b9\uff0c\u6309\u7167\u300e\u539f\u74061\u300f\uff0c\u5b83\u7684\u5de6\u5b50\u8282\u70b9\u4e3a\uff1a2(n/2  + 1)  = n + 2\uff0c\u5927\u5bb6\u660e\u663e\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e2a\u6570\u5b57\u5df2\u7ecf\u5927\u4e8en + 1\uff0c\u8d85\u51fa\u4e86\u5b9e\u73b0\u5b8c\u5168\u4e8c\u53c9\u6811\u6240\u7528\u6570\u7ec4\u7684\u5927\u5c0f\uff08\u6570\u7ec4\u4e0b\u6807\u4ece1\u5f00\u59cb\u8bb0\u5f55\u6570\u636e\uff0c\u5bf9\u4e8en\u4e2a\u8282\u70b9\u6765\u8bf4\uff0c\u6570\u7ec4\u5927\u5c0f\u662fn + 1\uff09\uff0c\u5de6\u5b50\u8282\u70b9\u90fd\u5df2\u7ecf\u8d85\u51fa\u4e86\u6570\u7ec4\u5bb9\u91cf\uff0c\u66f4\u4f55\u51b5\u53f3\u5b50\u8282\u70b9\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5f88\u5bb9\u6613\u5f97\u51fa\uff1a\u4e0b\u6807\u5927\u4e8en/2 + 1\u7684\u8282\u70b9\u80af\u5b9a\u90fd\u662f\u4e5f\u53f6\u5b50\u8282\u70b9\u4e86\uff0c\u6545\u800c\u5f97\u51fa\u7ed3\u8bba\uff1a\u5bf9\u4e8e\u5b8c\u5168\u4e8c\u53c9\u6811\u6765\u8bf4\uff0c\u4e0b\u6807\u4ecen/2 + 1 \u5230 n\u7684\u8282\u70b9\u90fd\u662f\u53f6\u5b50\u8282\u70b9</p> <p>\u5efa\u5806\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f O(n)\u3002</p>"},{"location":"read/beautiful-algo/heap/#_9","title":"\u6392\u5e8f","text":"<p>\u6392\u5e8f\u7684\u8fc7\u7a0b\u5c31\u662f\u4e0d\u65ad\u5730\u5c06\u5806\u9876\u5143\u7d20\u548c\u5806\u5c3e\u5143\u7d20\u4ea4\u6362\uff0c\u7136\u540e\u5bf9\u5806\u9876\u5143\u7d20\u8fdb\u884c\u5806\u5316\uff0c\u76f4\u5230\u5806\u4e2d\u53ea\u5269\u4e0b\u4e00\u4e2a\u5143\u7d20\u3002</p> <pre><code>// n\u8868\u793a\u6570\u636e\u7684\u4e2a\u6570\uff0c\u6570\u7ec4a\u4e2d\u7684\u6570\u636e\u4ece\u4e0b\u68071\u5230n\u7684\u4f4d\u7f6e\u3002\npublic static void sort(int[] a, int n) {\nbuildHeap(a, n);\nint k = n;\nwhile (k &gt; 1) {\nswap(a, 1, k);\n--k;\nheapify(a, k, 1);\n}\n}\n</code></pre> <p>\u6574\u4e2a\u5806\u6392\u5e8f\u7684\u8fc7\u7a0b\uff0c\u90fd\u53ea\u9700\u8981\u6781\u4e2a\u522b\u4e34\u65f6\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u5806\u6392\u5e8f\u662f\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\u3002\u5806\u6392\u5e8f\u5305\u62ec\u5efa\u5806\u548c\u6392\u5e8f\u4e24\u4e2a\u64cd\u4f5c\uff0c\u5efa\u5806\u8fc7\u7a0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\uff0c\u6392\u5e8f\u8fc7\u7a0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(nlogn)\uff0c\u6240\u4ee5\uff0c\u5806\u6392\u5e8f\u6574\u4f53\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(nlogn)\u3002</p>"},{"location":"read/beautiful-algo/heap/#_10","title":"\u4e3a\u4ec0\u4e48\u5feb\u901f\u6392\u5e8f\u8981\u6bd4\u5806\u6392\u5e8f\u6027\u80fd\u597d","text":"<p>\u524d\u9762\u6211\u4eec\u5b66\u8fc7\u5feb\u901f\u6392\u5e8f\uff0c\u5e73\u5747\u60c5\u51b5\u4e0b\uff0c\u5b83\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(nlogn)\u3002\u5c3d\u7ba1\u8fd9\u4e24\u79cd\u6392\u5e8f\u7b97\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(nlogn)\uff0c\u751a\u81f3\u5806\u6392\u5e8f\u6bd4\u5feb\u901f\u6392\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8fd8\u8981\u7a33\u5b9a\uff0c\u4f46\u662f\uff0c\u5728\u5b9e\u9645\u7684\u8f6f\u4ef6\u5f00\u53d1\u4e2d\uff0c\u5feb\u901f\u6392\u5e8f\u7684\u6027\u80fd\u8981\u6bd4\u5806\u6392\u5e8f\u597d\u3002</p> <p>\u7b2c\u4e00\u70b9\uff0c\u5806\u6392\u5e8f\u6570\u636e\u8bbf\u95ee\u7684\u65b9\u5f0f\u6ca1\u6709\u5feb\u901f\u6392\u5e8f\u53cb\u597d\u3002 </p> <p>\u5bf9\u4e8e\u5feb\u901f\u6392\u5e8f\u6765\u8bf4\uff0c\u6570\u636e\u662f\u987a\u5e8f\u8bbf\u95ee\u7684\u3002\u800c\u5bf9\u4e8e\u5806\u6392\u5e8f\u6765\u8bf4\uff0c\u6570\u636e\u662f\u8df3\u7740\u8bbf\u95ee\u7684\u3002\u5728 CPU \u7f13\u5b58\u4e2d\uff0c\u987a\u5e8f\u8bbf\u95ee\u7684\u6570\u636e\u4f1a\u88ab\u7f13\u5b58\u8d77\u6765\uff0c\u800c\u968f\u673a\u8bbf\u95ee\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u7f13\u5b58\u3002\u6240\u4ee5\uff0c\u5bf9\u4e8e CPU \u7f13\u5b58\u6765\u8bf4\uff0c\u987a\u5e8f\u8bbf\u95ee\u7684\u6570\u636e\u8bbf\u95ee\u6548\u7387\u8981\u6bd4\u968f\u673a\u8bbf\u95ee\u7684\u6570\u636e\u8bbf\u95ee\u6548\u7387\u9ad8\u3002</p> <p>\u7b2c\u4e8c\u70b9\u5bf9\u4e8e\u540c\u6837\u7684\u6570\u636e\uff0c\u5728\u6392\u5e8f\u8fc7\u7a0b\u4e2d\uff0c\u5806\u6392\u5e8f\u7b97\u6cd5\u7684\u6570\u636e\u4ea4\u6362\u6b21\u6570\u8981\u591a\u4e8e\u5feb\u901f\u6392\u5e8f\u3002</p> <p>\u5bf9\u4e8e\u57fa\u4e8e\u6bd4\u8f83\u7684\u6392\u5e8f\u7b97\u6cd5\u6765\u8bf4\uff0c\u6574\u4e2a\u6392\u5e8f\u8fc7\u7a0b\u5c31\u662f\u7531\u4e24\u4e2a\u57fa\u672c\u7684\u64cd\u4f5c\u7ec4\u6210\u7684\uff0c\u6bd4\u8f83\u548c\u4ea4\u6362\uff08\u6216\u79fb\u52a8\uff09\u3002\u5feb\u901f\u6392\u5e8f\u6570\u636e\u4ea4\u6362\u7684\u6b21\u6570\u4e0d\u4f1a\u6bd4\u9006\u5e8f\u5ea6\u591a\u3002\u4f46\u662f\u5806\u6392\u5e8f\u7684\u7b2c\u4e00\u6b65\u662f\u5efa\u5806\uff0c\u5efa\u5806\u7684\u8fc7\u7a0b\u4f1a\u6253\u4e71\u6570\u636e\u539f\u6709\u7684\u76f8\u5bf9\u5148\u540e\u987a\u5e8f\uff0c\u5bfc\u81f4\u539f\u6570\u636e\u7684\u6709\u5e8f\u5ea6\u964d\u4f4e\u3002\u6bd4\u5982\uff0c\u5bf9\u4e8e\u4e00\u7ec4\u5df2\u7ecf\u6709\u5e8f\u7684\u6570\u636e\u6765\u8bf4\uff0c\u7ecf\u8fc7\u5efa\u5806\u4e4b\u540e\uff0c\u6570\u636e\u53cd\u800c\u53d8\u5f97\u66f4\u65e0\u5e8f\u4e86\u3002</p>"},{"location":"read/beautiful-algo/heap/#_11","title":"\u5e94\u7528","text":""},{"location":"read/beautiful-algo/heap/#_12","title":"\u4f18\u5148\u7ea7\u961f\u5217","text":"<p>\u5728\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\uff0c\u6570\u636e\u7684\u51fa\u961f\u987a\u5e8f\u4e0d\u662f\u5148\u8fdb\u5148\u51fa\uff0c\u800c\u662f\u6309\u7167\u4f18\u5148\u7ea7\u6765\uff0c\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\uff0c\u6700\u5148\u51fa\u961f\u3002 \u7528\u5806\u6765\u5b9e\u73b0\u662f\u6700\u76f4\u63a5\u3001\u6700\u9ad8\u6548\u7684\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u5806\u548c\u4f18\u5148\u7ea7\u961f\u5217\u975e\u5e38\u76f8\u4f3c\u3002\u4e00\u4e2a\u5806\u5c31\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a\u4f18\u5148\u7ea7\u961f\u5217\u3002\u5f88\u591a\u65f6\u5019\uff0c\u5b83\u4eec\u53ea\u662f\u6982\u5ff5\u4e0a\u7684\u533a\u5206\u800c\u5df2\u3002\u5f80\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u5c31\u76f8\u5f53\u4e8e\u5f80\u5806\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff1b\u4ece\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\u53d6\u51fa\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u5143\u7d20\uff0c\u5c31\u76f8\u5f53\u4e8e\u53d6\u51fa\u5806\u9876\u5143\u7d20\u3002</p> <p>\u5b83\u7684\u5e94\u7528\u573a\u666f\u975e\u5e38\u591a, \u6bd4\u5982\uff0c<code>\u8d6b\u592b\u66fc\u7f16\u7801</code>\u3001<code>\u56fe\u7684\u6700\u77ed\u8def\u5f84</code>\u3001<code>\u6700\u5c0f\u751f\u6210\u6811\u7b97\u6cd5</code>\u7b49\u7b49\u3002\u4e0d\u4ec5\u5982\u6b64\uff0c\u5f88\u591a\u8bed\u8a00\u4e2d\uff0c\u90fd\u63d0\u4f9b\u4e86\u4f18\u5148\u7ea7\u961f\u5217\u7684\u5b9e\u73b0\uff0c\u6bd4\u5982\uff0cJava \u7684 <code>PriorityQueue</code>\uff0cC++ \u7684 <code>priority_queue</code> \u7b49\u3002</p> <p>\u5177\u4f53\u4f8b\u5b50\uff1a\u5408\u5e76\u6709\u5e8f\u5c0f\u6587\u4ef6\u3001\u5b9a\u65f6\u4efb\u52a1\u7b49\u3002</p>"},{"location":"read/beautiful-algo/heap/#_13","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>public class PriorityQueue&lt;T extends Comparable&lt;T&gt;&gt; {\nprivate T[] items;\nprivate int N;\npublic PriorityQueue(int capacity) {\nitems = (T[]) new Comparable[capacity + 1];\nN = 0;\n}\npublic boolean isEmpty() {\nreturn N == 0;\n}\npublic int size() {\nreturn N;\n}\npublic void insert(T t) {\nitems[++N] = t;\nswim(N);\n}\npublic T delMax() {\nT max = items[1];\nexch(1, N--);\nsink(1);\nreturn max;\n}\nprivate void swim(int k) {\nwhile (k &gt; 1 &amp;&amp; less(k / 2, k)) {\nexch(k / 2, k);\nk = k / 2;\n}\n}\nprivate void sink(int k) {\nwhile (2 * k &lt;= N) {\nint j = 2 * k;\nif (j &lt; N &amp;&amp; less(j, j + 1)) j++;\nif (!less(k, j)) break;\nexch(k, j);\nk = j;\n}\n}\nprivate boolean less(int i, int j) {\nreturn items[i].compareTo(items[j]) &lt; 0;\n}\nprivate void exch(int i, int j) {\nT t = items[i];\nitems[i] = items[j];\nitems[j] = t;\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/heap/#top-k","title":"Top K \u95ee\u9898","text":"<p>\u6211\u628a\u8fd9\u79cd\u6c42 Top K \u7684\u95ee\u9898\u62bd\u8c61\u6210\u4e24\u7c7b\u3002\u4e00\u7c7b\u662f\u9488\u5bf9\u9759\u6001\u6570\u636e\u96c6\u5408\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u636e\u96c6\u5408\u4e8b\u5148\u786e\u5b9a\uff0c\u4e0d\u4f1a\u518d\u53d8\u3002\u53e6\u4e00\u7c7b\u662f\u9488\u5bf9\u52a8\u6001\u6570\u636e\u96c6\u5408\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u636e\u96c6\u5408\u4e8b\u5148\u5e76\u4e0d\u786e\u5b9a\uff0c\u6709\u6570\u636e\u52a8\u6001\u5730\u52a0\u5165\u5230\u96c6\u5408\u4e2d\u3002</p> <p>\u9488\u5bf9\u9759\u6001\u6570\u636e\uff0c\u5982\u4f55\u5728\u4e00\u4e2a\u5305\u542b n \u4e2a\u6570\u636e\u7684\u6570\u7ec4\u4e2d\uff0c\u67e5\u627e\u524d K \u5927\u6570\u636e\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5927\u5c0f\u4e3a K \u7684\u5c0f\u9876\u5806\uff0c\u987a\u5e8f\u904d\u5386\u6570\u7ec4\uff0c\u4ece\u6570\u7ec4\u4e2d\u53d6\u51fa\u6570\u636e\u4e0e\u5806\u9876\u5143\u7d20\u6bd4\u8f83\u3002\u5982\u679c\u6bd4\u5806\u9876\u5143\u7d20\u5927\uff0c\u6211\u4eec\u5c31\u628a\u5806\u9876\u5143\u7d20\u5220\u9664\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e2a\u5143\u7d20\u63d2\u5165\u5230\u5806\u4e2d\uff1b\u5982\u679c\u6bd4\u5806\u9876\u5143\u7d20\u5c0f\uff0c\u5219\u4e0d\u505a\u5904\u7406\uff0c\u7ee7\u7eed\u904d\u5386\u6570\u7ec4\u3002\u8fd9\u6837\u7b49\u6570\u7ec4\u4e2d\u7684\u6570\u636e\u90fd\u904d\u5386\u5b8c\u4e4b\u540e\uff0c\u5806\u4e2d\u7684\u6570\u636e\u5c31\u662f\u524d K \u5927\u6570\u636e\u4e86\u3002</p> <p>\u904d\u5386\u6570\u7ec4\u9700\u8981 O(n) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u4e00\u6b21\u5806\u5316\u64cd\u4f5c\u9700\u8981 O(logK) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u6240\u4ee5\u6700\u574f\u60c5\u51b5\u4e0b\uff0cn \u4e2a\u5143\u7d20\u90fd\u5165\u5806\u4e00\u6b21\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f O(nlogK)\u3002</p> <p>\u9488\u5bf9\u52a8\u6001\u6570\u636e\u6c42\u5f97 Top K \u5c31\u662f\u5b9e\u65f6 Top K\u3002\u600e\u4e48\u7406\u89e3\u5462\uff1f\u6211\u4e3e\u4e00\u4e2a\u4f8b\u5b50\u3002\u4e00\u4e2a\u6570\u636e\u96c6\u5408\u4e2d\u6709\u4e24\u4e2a\u64cd\u4f5c\uff0c\u4e00\u4e2a\u662f\u6dfb\u52a0\u6570\u636e\uff0c\u53e6\u4e00\u4e2a\u8be2\u95ee\u5f53\u524d\u7684\u524d K \u5927\u6570\u636e\u3002</p> <p>\u5982\u679c\u6bcf\u6b21\u8be2\u95ee\u524d K \u5927\u6570\u636e\uff0c\u6211\u4eec\u90fd\u57fa\u4e8e\u5f53\u524d\u7684\u6570\u636e\u91cd\u65b0\u8ba1\u7b97\u7684\u8bdd\uff0c\u90a3\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f O(nlogK)\uff0cn \u8868\u793a\u5f53\u524d\u7684\u6570\u636e\u7684\u5927\u5c0f\u3002\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u4e00\u76f4\u90fd\u7ef4\u62a4\u4e00\u4e2a K \u5927\u5c0f\u7684\u5c0f\u9876\u5806\uff0c\u5f53\u6709\u6570\u636e\u88ab\u6dfb\u52a0\u5230\u96c6\u5408\u4e2d\u65f6\uff0c\u6211\u4eec\u5c31\u62ff\u5b83\u4e0e\u5806\u9876\u7684\u5143\u7d20\u5bf9\u6bd4\u3002\u5982\u679c\u6bd4\u5806\u9876\u5143\u7d20\u5927\uff0c\u6211\u4eec\u5c31\u628a\u5806\u9876\u5143\u7d20\u5220\u9664\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e2a\u5143\u7d20\u63d2\u5165\u5230\u5806\u4e2d\uff1b\u5982\u679c\u6bd4\u5806\u9876\u5143\u7d20\u5c0f\uff0c\u5219\u4e0d\u505a\u5904\u7406\u3002\u8fd9\u6837\uff0c\u65e0\u8bba\u4efb\u4f55\u65f6\u5019\u9700\u8981\u67e5\u8be2\u5f53\u524d\u7684\u524d K \u5927\u6570\u636e\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u7acb\u523b\u8fd4\u56de\u7ed9\u4ed6\u3002</p>"},{"location":"read/beautiful-algo/heap/#_14","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>public class TopK {\npublic static void main(String[] args) {\nint[] arr = {1, 2, 3, 4, 5, 6, 7, 8, 9};\nint k = 3;\nint[] topK = topK(arr, k);\nfor (int i = 0; i &lt; topK.length; i++) {\nSystem.out.println(topK[i]);\n}\n}\nprivate static int[] topK(int[] arr, int k) {\nint[] topK = new int[k];\nfor (int i = 0; i &lt; k; i++) {\ntopK[i] = arr[i];\n}\nbuildHeap(topK);\nfor (int i = k; i &lt; arr.length; i++) {\nif (arr[i] &gt; topK[0]) {\ntopK[0] = arr[i];\nheapify(topK, 0, k);\n}\n}\nreturn topK;\n}\nprivate static void buildHeap(int[] arr) {\nfor (int i = arr.length / 2 - 1; i &gt;= 0; i--) {\nheapify(arr, i, arr.length);\n}\n}\nprivate static void heapify(int[] arr, int i, int length) {\nint left = 2 * i + 1;\nint right = 2 * i + 2;\nint min = i;\nif (left &lt; length &amp;&amp; arr[left] &lt; arr[min]) {\nmin = left;\n}\nif (right &lt; length &amp;&amp; arr[right] &lt; arr[min]) {\nmin = right;\n}\nif (min != i) {\nswap(arr, i, min);\nheapify(arr, min, length);\n}\n}\nprivate static void swap(int[] arr, int i, int j) {\nint temp = arr[i];\narr[i] = arr[j];\narr[j] = temp;\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/heap/#_15","title":"\u5229\u7528\u5806\u6c42\u4e2d\u4f4d\u6570","text":"<p>\u4e2d\u4f4d\u6570\u662f\u7edf\u8ba1\u5b66\u4e2d\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u5904\u5728\u4e2d\u95f4\u4f4d\u7f6e\u7684\u90a3\u4e2a\u6570\u3002\u5982\u679c\u6570\u636e\u7684\u4e2a\u6570\u662f\u5947\u6570\uff0c\u628a\u6570\u636e\u4ece\u5c0f\u5230\u5927\u6392\u5217\uff0c\u90a3\u7b2c 2n\u200b+1 \u4e2a\u6570\u636e\u5c31\u662f\u4e2d\u4f4d\u6570\uff08\u6ce8\u610f\uff1a\u5047\u8bbe\u6570\u636e\u662f\u4ece 0 \u5f00\u59cb\u7f16\u53f7\u7684\uff09\uff1b\u5982\u679c\u6570\u636e\u7684\u4e2a\u6570\u662f\u5076\u6570\u7684\u8bdd\uff0c\u90a3\u5904\u4e8e\u4e2d\u95f4\u4f4d\u7f6e\u7684\u6570\u636e\u6709\u4e24\u4e2a\uff0c\u7b2c 2n\u200b \u4e2a\u548c\u7b2c 2n\u200b+1 \u4e2a\u6570\u636e\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u968f\u610f\u53d6\u4e00\u4e2a\u4f5c\u4e3a\u4e2d\u4f4d\u6570\uff0c\u6bd4\u5982\u53d6\u4e24\u4e2a\u6570\u4e2d\u9760\u524d\u7684\u90a3\u4e2a\uff0c\u5c31\u662f\u7b2c 2n\u200b \u4e2a\u6570\u636e\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5806\u6c42\u4e2d\u4f4d\u6570\u3002\u6211\u4eec\u7ef4\u62a4\u4e24\u4e2a\u5806\uff0c\u4e00\u4e2a\u662f\u5927\u9876\u5806\uff0c\u4e00\u4e2a\u662f\u5c0f\u9876\u5806\u3002\u5927\u9876\u5806\u4e2d\u7684\u5143\u7d20\u90fd\u5c0f\u4e8e\u5c0f\u9876\u5806\u4e2d\u7684\u5143\u7d20\u3002\u6211\u4eec\u628a\u6570\u636e\u5206\u6210\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u653e\u5728\u5927\u9876\u5806\u4e2d\uff0c\u4e00\u90e8\u5206\u653e\u5728\u5c0f\u9876\u5806\u4e2d\u3002\u5982\u679c\u6570\u636e\u7684\u4e2a\u6570\u662f\u5947\u6570\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u628a\u6570\u636e\u653e\u5728\u5927\u9876\u5806\u4e2d\uff0c\u5426\u5219\u5c31\u653e\u5728\u5c0f\u9876\u5806\u4e2d\u3002\u8fd9\u6837\uff0c\u5927\u9876\u5806\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u5c31\u662f\u5c0f\u9876\u5806\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u6216\u8005\u6bd4\u5c0f\u9876\u5806\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u591a 1\u3002\u8fd9\u6837\uff0c\u5927\u9876\u5806\u4e2d\u7684\u5806\u9876\u5143\u7d20\u5c31\u662f\u4e2d\u4f4d\u6570\u3002</p> <p>\u63d2\u5165\u6570\u636e\u56e0\u4e3a\u9700\u8981\u6d89\u53ca\u5806\u5316\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u6210\u4e86 O(logn)\uff0c\u4f46\u662f\u6c42\u4e2d\u4f4d\u6570\u6211\u4eec\u53ea\u9700\u8981\u8fd4\u56de\u5927\u9876\u5806\u7684\u5806\u9876\u5143\u7d20\u5c31\u53ef\u4ee5\u4e86\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f O(1)\u3002</p>"},{"location":"read/beautiful-algo/heap/#_16","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>public class MedianFinder {\nprivate PriorityQueue&lt;Integer&gt; minHeap = new PriorityQueue&lt;&gt;();\nprivate PriorityQueue&lt;Integer&gt; maxHeap = new PriorityQueue&lt;&gt;(new Comparator&lt;Integer&gt;() {\n@Override\npublic int compare(Integer o1, Integer o2) {\nreturn o2 - o1;\n}\n});\npublic void addNum(int num) {\nif (minHeap.size() == maxHeap.size()) {\nmaxHeap.offer(num);\nminHeap.offer(maxHeap.poll());\n} else {\nminHeap.offer(num);\nmaxHeap.offer(minHeap.poll());\n}\n}\npublic double findMedian() {\nif (minHeap.size() == maxHeap.size()) {\nreturn (minHeap.peek() + maxHeap.peek()) / 2.0;\n} else {\nreturn minHeap.peek();\n}\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/linked-list/","title":"\u94fe\u8868","text":"<p>\u94fe\u8868\uff08Linked list\uff09\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u57fa\u7840\u6570\u636e\u7ed3\u6784\uff0c\u662f\u4e00\u79cd\u7ebf\u6027\u8868\uff0c\u4f46\u662f\u5e76\u4e0d\u4f1a\u6309\u7ebf\u6027\u7684\u987a\u5e8f\u5b58\u50a8\u6570\u636e\uff0c\u800c\u662f\u5728\u6bcf\u4e00\u4e2a\u8282\u70b9\u91cc\u5b58\u5230\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u6307\u9488(Pointer)\uff0c\u94fe\u8868\u901a\u8fc7\u201c\u6307\u9488\u201d\u5c06\u4e00\u7ec4\u96f6\u6563\u7684\u5185\u5b58\u5757\u4e32\u8054\u8d77\u6765\u4f7f\u7528\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#1","title":"1. \u5355\u94fe\u8868","text":"<p>\u5176\u4e2d\u6709\u4e24\u4e2a\u7ed3\u70b9\u662f\u6bd4\u8f83\u7279\u6b8a\u7684\uff0c\u5b83\u4eec\u5206\u522b\u662f\u7b2c\u4e00\u4e2a\u7ed3\u70b9\u548c\u6700\u540e\u4e00\u4e2a\u7ed3\u70b9\u3002\u6211\u4eec\u4e60\u60ef\u6027\u5730\u628a\u7b2c\u4e00\u4e2a\u7ed3\u70b9\u53eb\u4f5c \u5934\u7ed3\u70b9\uff0c\u628a\u6700\u540e\u4e00\u4e2a\u7ed3\u70b9\u53eb\u4f5c \u5c3e\u7ed3\u70b9\u3002\u5176\u4e2d\uff0c\u5934\u7ed3\u70b9\u7528\u6765\u8bb0\u5f55\u94fe\u8868\u7684\u57fa\u5730\u5740\u3002\u6709\u4e86\u5b83\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u904d\u5386\u5f97\u5230\u6574\u6761\u94fe\u8868\u3002\u800c\u5c3e\u7ed3\u70b9\u7279\u6b8a\u7684\u5730\u65b9\u662f\uff1a\u6307\u9488\u4e0d\u662f\u6307\u5411\u4e0b\u4e00\u4e2a\u7ed3\u70b9\uff0c\u800c\u662f\u6307\u5411\u4e00\u4e2a \u7a7a\u5730\u5740 NULL\uff0c\u8868\u793a\u8fd9\u662f\u94fe\u8868\u4e0a\u6700\u540e\u4e00\u4e2a\u7ed3\u70b9\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#11","title":"1.1 \u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u627e","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c\u5728\u8fdb\u884c\u6570\u7ec4\u7684\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\u65f6\uff0c\u4e3a\u4e86\u4fdd\u6301\u5185\u5b58\u6570\u636e\u7684\u8fde\u7eed\u6027\uff0c\u9700\u8981\u505a\u5927\u91cf\u7684\u6570\u636e\u642c\u79fb\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002\u800c\u5728\u94fe\u8868\u4e2d\u63d2\u5165\u6216\u8005\u5220\u9664\u4e00\u4e2a\u6570\u636e\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u4e3a\u4e86\u4fdd\u6301\u5185\u5b58\u7684\u8fde\u7eed\u6027\u800c\u642c\u79fb\u7ed3\u70b9\uff0c\u56e0\u4e3a\u94fe\u8868\u7684\u5b58\u50a8\u7a7a\u95f4\u672c\u8eab\u5c31\u4e0d\u662f\u8fde\u7eed\u7684\u3002\u6240\u4ee5\uff0c\u5728\u94fe\u8868\u4e2d\u63d2\u5165\u548c\u5220\u9664\u4e00\u4e2a\u6570\u636e\u662f\u975e\u5e38\u5feb\u901f\u7684\u3002\u9488\u5bf9\u94fe\u8868\u7684\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u76f8\u90bb\u7ed3\u70b9\u7684\u6307\u9488\u6539\u53d8\uff0c\u6240\u4ee5\u5bf9\u5e94\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002</p> <p></p> <p>\u4f46\u662f\uff0c\u6709\u5229\u5c31\u6709\u5f0a\u3002\u94fe\u8868\u8981\u60f3\u968f\u673a\u8bbf\u95ee\u7b2c k \u4e2a\u5143\u7d20\uff0c\u5c31\u6ca1\u6709\u6570\u7ec4\u90a3\u4e48\u9ad8\u6548\u4e86\u3002\u56e0\u4e3a\u94fe\u8868\u4e2d\u7684\u6570\u636e\u5e76\u975e\u8fde\u7eed\u5b58\u50a8\u7684\uff0c\u6240\u4ee5\u65e0\u6cd5\u50cf\u6570\u7ec4\u90a3\u6837\uff0c\u6839\u636e\u9996\u5730\u5740\u548c\u4e0b\u6807\uff0c\u901a\u8fc7\u5bfb\u5740\u516c\u5f0f\u5c31\u80fd\u76f4\u63a5\u8ba1\u7b97\u51fa\u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\uff0c\u800c\u662f\u9700\u8981\u6839\u636e\u6307\u9488\u4e00\u4e2a\u7ed3\u70b9\u4e00\u4e2a\u7ed3\u70b9\u5730\u4f9d\u6b21\u904d\u5386\uff0c\u76f4\u5230\u627e\u5230\u76f8\u5e94\u7684\u7ed3\u70b9\u3002\u6240\u4ee5\uff0c\u94fe\u8868\u968f\u673a\u8bbf\u95ee\u7684\u6027\u80fd\u6ca1\u6709\u6570\u7ec4\u597d\uff0c\u9700\u8981 O(n) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#2","title":"2. \u5faa\u73af\u94fe\u8868","text":"<p>\u5faa\u73af\u94fe\u8868\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u5355\u94fe\u8868\u3002\u5b9e\u9645\u4e0a\uff0c\u5faa\u73af\u94fe\u8868\u4e5f\u5f88\u7b80\u5355\u3002\u5b83\u8ddf\u5355\u94fe\u8868\u552f\u4e00\u7684\u533a\u522b\u5c31\u5728\u5c3e\u7ed3\u70b9\u3002\u6211\u4eec\u77e5\u9053\uff0c\u5355\u94fe\u8868\u7684\u5c3e\u7ed3\u70b9\u6307\u9488\u6307\u5411\u7a7a\u5730\u5740\uff0c\u8868\u793a\u8fd9\u5c31\u662f\u6700\u540e\u7684\u7ed3\u70b9\u4e86\u3002\u800c\u5faa\u73af\u94fe\u8868\u7684\u5c3e\u7ed3\u70b9\u6307\u9488\u662f\u6307\u5411\u94fe\u8868\u7684\u5934\u7ed3\u70b9\u3002</p> <p></p> <p>\u5faa\u73af\u94fe\u8868\u7684\u4f18\u70b9\u662f\u4ece\u94fe\u5c3e\u5230\u94fe\u5934\u6bd4\u8f83\u65b9\u4fbf\u3002\u5f53\u8981\u5904\u7406\u7684\u6570\u636e\u5177\u6709\u73af\u578b\u7ed3\u6784\u7279\u70b9\u65f6\uff0c\u5c31\u7279\u522b\u9002\u5408\u91c7\u7528\u5faa\u73af\u94fe\u8868\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#3","title":"3.\u53cc\u5411\u94fe\u8868","text":"<p>\u5355\u5411\u94fe\u8868\u53ea\u6709\u4e00\u4e2a\u65b9\u5411\uff0c\u7ed3\u70b9\u53ea\u6709\u4e00\u4e2a\u540e\u7ee7\u6307\u9488 next \u6307\u5411\u540e\u9762\u7684\u7ed3\u70b9\u3002\u800c\u53cc\u5411\u94fe\u8868\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u652f\u6301\u4e24\u4e2a\u65b9\u5411\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u4e0d\u6b62\u6709\u4e00\u4e2a\u540e\u7ee7\u6307\u9488 next \u6307\u5411\u540e\u9762\u7684\u7ed3\u70b9\uff0c\u8fd8\u6709\u4e00\u4e2a\u524d\u9a71\u6307\u9488 prev \u6307\u5411\u524d\u9762\u7684\u7ed3\u70b9\u3002</p> <p></p> <p>\u53cc\u5411\u94fe\u8868\u9700\u8981\u989d\u5916\u7684\u4e24\u4e2a\u7a7a\u95f4\u6765\u5b58\u50a8\u540e\u7ee7\u7ed3\u70b9\u548c\u524d\u9a71\u7ed3\u70b9\u7684\u5730\u5740\u3002\u6240\u4ee5\uff0c\u5982\u679c\u5b58\u50a8\u540c\u6837\u591a\u7684\u6570\u636e\uff0c\u53cc\u5411\u94fe\u8868\u8981\u6bd4\u5355\u94fe\u8868\u5360\u7528\u66f4\u591a\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u867d\u7136\u4e24\u4e2a\u6307\u9488\u6bd4\u8f83\u6d6a\u8d39\u5b58\u50a8\u7a7a\u95f4\uff0c\u4f46\u53ef\u4ee5\u652f\u6301\u53cc\u5411\u904d\u5386\uff0c\u8fd9\u6837\u4e5f\u5e26\u6765\u4e86\u53cc\u5411\u94fe\u8868\u64cd\u4f5c\u7684\u7075\u6d3b\u6027</p>"},{"location":"read/beautiful-algo/linked-list/#31","title":"3.1 \u4f18\u52bf","text":"<p>\u4ece\u7ed3\u6784\u4e0a\u6765\u770b\uff0c\u53cc\u5411\u94fe\u8868\u53ef\u4ee5\u652f\u6301 O(1) \u65f6\u95f4\u590d\u6742\u5ea6\u7684\u60c5\u51b5\u4e0b\u627e\u5230\u524d\u9a71\u7ed3\u70b9\uff0c\u6b63\u662f\u8fd9\u6837\u7684\u7279\u70b9\uff0c\u4e5f\u4f7f\u53cc\u5411\u94fe\u8868\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u7684\u63d2\u5165\u3001\u5220\u9664\u7b49\u64cd\u4f5c\u90fd\u8981\u6bd4\u5355\u94fe\u8868\u7b80\u5355\u3001\u9ad8\u6548\u3002</p> <ul> <li>\u5220\u9664\u7ed9\u5b9a\u6307\u9488\u6307\u5411\u7684\u7ed3\u70b9\u3002</li> </ul> <p>\u5220\u9664\u67d0\u4e2a\u7ed3\u70b9 q \u9700\u8981\u77e5\u9053\u5176\u524d\u9a71\u7ed3\u70b9\uff0c\u800c\u5355\u94fe\u8868\u5e76\u4e0d\u652f\u6301\u76f4\u63a5\u83b7\u53d6\u524d\u9a71\u7ed3\u70b9\uff0c\u6240\u4ee5\uff0c\u4e3a\u4e86\u627e\u5230\u524d\u9a71\u7ed3\u70b9\uff0c\u6211\u4eec\u8fd8\u662f\u8981\u4ece\u5934\u7ed3\u70b9\u5f00\u59cb\u904d\u5386\u94fe\u8868\uff0c\u76f4\u5230 p-&gt;next=q\uff0c\u8bf4\u660e p \u662f q \u7684\u524d\u9a71\u7ed3\u70b9\u3002\u4f46\u662f\u5bf9\u4e8e\u53cc\u5411\u94fe\u8868\u6765\u8bf4\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u6bd4\u8f83\u6709\u4f18\u52bf\u4e86\u3002\u56e0\u4e3a\u53cc\u5411\u94fe\u8868\u4e2d\u7684\u7ed3\u70b9\u5df2\u7ecf\u4fdd\u5b58\u4e86\u524d\u9a71\u7ed3\u70b9\u7684\u6307\u9488\uff0c\u4e0d\u9700\u8981\u50cf\u5355\u94fe\u8868\u90a3\u6837\u904d\u5386\u3002\u6240\u4ee5\uff0c\u5355\u94fe\u8868\u5220\u9664\u64cd\u4f5c\u9700\u8981 O(n) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u800c\u53cc\u5411\u94fe\u8868\u53ea\u9700\u8981\u5728 O(1) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5c31\u641e\u5b9a\u4e86\uff01</p> <p>\u540c\u7406\uff0c\u5982\u679c\u6211\u4eec\u5e0c\u671b\u5728\u94fe\u8868\u7684\u67d0\u4e2a\u6307\u5b9a\u7ed3\u70b9\u524d\u9762\u63d2\u5165\u4e00\u4e2a\u7ed3\u70b9\uff0c\u53cc\u5411\u94fe\u8868\u6bd4\u5355\u94fe\u8868\u6709\u5f88\u5927\u7684\u4f18\u52bf\u3002</p> <ul> <li>\u6709\u5e8f\u94fe\u8868\u6309\u503c\u67e5\u8be2</li> </ul> <p>\u5bf9\u4e8e\u53cc\u5411\u94fe\u8868\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55\u4e0a\u6b21\u67e5\u627e\u7684\u4f4d\u7f6e p\uff0c\u6bcf\u6b21\u67e5\u8be2\u65f6\uff0c\u6839\u636e\u8981\u67e5\u627e\u7684\u503c\u4e0e p \u7684\u5927\u5c0f\u5173\u7cfb\uff0c\u51b3\u5b9a\u662f\u5f80\u524d\u8fd8\u662f\u5f80\u540e\u67e5\u627e\uff0c\u6240\u4ee5\u5e73\u5747\u53ea\u9700\u8981\u67e5\u627e\u4e00\u534a\u7684\u6570\u636e\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#4-vs","title":"4 \u6570\u7ec4 VS \u94fe\u8868","text":"<ul> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u968f\u673a\u8bbf\u95ee\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6b63\u597d\u76f8\u53cd  </li> <li>\u6570\u7ec4\u7b80\u5355\u6613\u7528\uff0c\u5728\u5b9e\u73b0\u4e0a\u4f7f\u7528\u7684\u662f\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u53ef\u4ee5\u501f\u52a9 CPU \u7684\u7f13\u5b58\u673a\u5236\uff0c\u9884\u8bfb\u6570\u7ec4\u4e2d\u7684\u6570\u636e\uff0c\u6240\u4ee5\u8bbf\u95ee\u6548\u7387\u66f4\u9ad8</li> <li>\u94fe\u8868\u5728\u5185\u5b58\u4e2d\u5e76\u4e0d\u662f\u8fde\u7eed\u5b58\u50a8\uff0c\u6240\u4ee5\u5bf9 CPU \u7f13\u5b58\u4e0d\u53cb\u597d\uff0c\u6ca1\u529e\u6cd5\u6709\u6548\u9884\u8bfb\u3002</li> <li>\u6570\u7ec4\u7684\u7f3a\u70b9\u662f\u5927\u5c0f\u56fa\u5b9a\uff0c\u4e00\u7ecf\u58f0\u660e\u5c31\u8981\u5360\u7528\u6574\u5757\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4</li> <li>\u94fe\u8868\u672c\u8eab\u6ca1\u6709\u5927\u5c0f\u7684\u9650\u5236\uff0c\u5929\u7136\u5730\u652f\u6301\u52a8\u6001\u6269\u5bb9</li> </ul> <p>\u5982\u679c\u4f60\u7684\u4ee3\u7801\u5bf9\u5185\u5b58\u7684\u4f7f\u7528\u975e\u5e38\u82db\u523b\uff0c\u90a3\u6570\u7ec4\u5c31\u66f4\u9002\u5408\u4f60\u3002\u56e0\u4e3a\u94fe\u8868\u4e2d\u7684\u6bcf\u4e2a\u7ed3\u70b9\u90fd\u9700\u8981\u6d88\u8017\u989d\u5916\u7684\u5b58\u50a8\u7a7a\u95f4\u53bb\u5b58\u50a8\u4e00\u4efd\u6307\u5411\u4e0b\u4e00\u4e2a\u7ed3\u70b9\u7684\u6307\u9488\uff0c\u6240\u4ee5\u5185\u5b58\u6d88\u8017\u4f1a\u7ffb\u500d\u3002\u800c\u4e14\uff0c\u5bf9\u94fe\u8868\u8fdb\u884c\u9891\u7e41\u7684\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\uff0c\u8fd8\u4f1a\u5bfc\u81f4\u9891\u7e41\u7684\u5185\u5b58\u7533\u8bf7\u548c\u91ca\u653e\uff0c\u5bb9\u6613\u9020\u6210\u5185\u5b58\u788e\u7247\uff0c\u5982\u679c\u662f Java \u8bed\u8a00\uff0c\u5c31\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9891\u7e41\u7684 GC\uff08Garbage Collection\uff0c\u5783\u573e\u56de\u6536\uff09\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#5","title":"5. \u5982\u4f55\u8f7b\u677e\u5199\u51fa\u6b63\u786e\u7684\u94fe\u8868\u4ee3\u7801\uff1f","text":""},{"location":"read/beautiful-algo/linked-list/#_2","title":"\u6280\u5de7\u4e00\uff1a\u7406\u89e3\u6307\u9488\u6216\u5f15\u7528\u7684\u542b\u4e49","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c\u6709\u4e9b\u8bed\u8a00\u6709\u201c\u6307\u9488\u201d\u7684\u6982\u5ff5\uff0c\u6bd4\u5982 C \u8bed\u8a00\uff1b\u6709\u4e9b\u8bed\u8a00\u6ca1\u6709\u6307\u9488\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u201c\u5f15\u7528\u201d\uff0c\u6bd4\u5982 Java\u3001Python\u3002\u4e0d\u7ba1\u662f\u201c\u6307\u9488\u201d\u8fd8\u662f\u201c\u5f15\u7528\u201d\uff0c\u5b9e\u9645\u4e0a\uff0c\u5b83\u4eec\u7684\u610f\u601d\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u5b58\u50a8\u6240\u6307\u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\u3002</p> <p>\u5c06\u67d0\u4e2a\u53d8\u91cf\u8d4b\u503c\u7ed9\u6307\u9488\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5c06\u8fd9\u4e2a\u53d8\u91cf\u7684\u5730\u5740\u8d4b\u503c\u7ed9\u6307\u9488\uff0c\u6216\u8005\u53cd\u8fc7\u6765\u8bf4\uff0c\u6307\u9488\u4e2d\u5b58\u50a8\u4e86\u8fd9\u4e2a\u53d8\u91cf\u7684\u5185\u5b58\u5730\u5740\uff0c\u6307\u5411\u4e86\u8fd9\u4e2a\u53d8\u91cf\uff0c\u901a\u8fc7\u6307\u9488\u5c31\u80fd\u627e\u5230\u8fd9\u4e2a\u53d8\u91cf\u3002</p> <pre><code>p-&gt;next=p-&gt;next-&gt;next\n</code></pre> <p>\u4e0a\u9762\u8fd9\u884c\u4ee3\u7801\u8868\u793a\uff0cp \u7ed3\u70b9\u7684 next \u6307\u9488\u5b58\u50a8\u4e86 p \u7ed3\u70b9\u7684\u4e0b\u4e0b\u4e00\u4e2a\u7ed3\u70b9\u7684\u5185\u5b58\u5730\u5740\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#_3","title":"\u6280\u5de7\u4e8c\uff1a\u8b66\u60d5\u6307\u9488\u4e22\u5931\u548c\u5185\u5b58\u6cc4\u6f0f","text":"<p>\u5728\u7ed3\u70b9 p \u540e\u9762\u63d2\u5165\u4e00\u4e2a\u65b0\u7684\u7ed3\u70b9 x  \u9519\u8bef\u5199\u6cd5</p> <pre><code>p-&gt;next = x;  // \u5c06p\u7684next\u6307\u9488\u6307\u5411x\u7ed3\u70b9\uff1b\nx-&gt;next = p-&gt;next;  // \u5c06x\u7684\u7ed3\u70b9\u7684next\u6307\u9488\u6307\u5411\u539f\u6765\u7ed3\u70b9\uff1b\n</code></pre> <p><code>p-&gt;next</code> \u6307\u9488\u5728\u5b8c\u6210\u7b2c\u4e00\u6b65\u64cd\u4f5c\u4e4b\u540e\uff0c\u5df2\u7ecf\u4e0d\u518d\u6307\u5411\u539f\u6765\u7ed3\u70b9 \u4e86\uff0c\u800c\u662f\u6307\u5411\u7ed3\u70b9 x\u3002\u7b2c 2 \u884c\u4ee3\u7801\u76f8\u5f53\u4e8e\u5c06 x \u8d4b\u503c\u7ed9 <code>x-&gt;next</code>\uff0c\u81ea\u5df1\u6307\u5411\u81ea\u5df1\u3002\u56e0\u6b64\uff0c\u6574\u4e2a\u94fe\u8868\u4e5f\u5c31\u65ad\u6210\u4e86\u4e24\u534a\uff0c\u4ece\u539f\u6765\u7ed3\u70b9 \u5f80\u540e\u7684\u6240\u6709\u7ed3\u70b9\u90fd\u65e0\u6cd5\u8bbf\u95ee\u5230\u4e86\u3002\u5bf9\u4e8e\u6709\u4e9b\u8bed\u8a00\u6765\u8bf4\uff0c\u6bd4\u5982 C \u8bed\u8a00\uff0c\u5185\u5b58\u7ba1\u7406\u662f\u7531\u7a0b\u5e8f\u5458\u8d1f\u8d23\u7684\uff0c\u5982\u679c\u6ca1\u6709\u624b\u52a8\u91ca\u653e\u7ed3\u70b9\u5bf9\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5c31\u4f1a\u4ea7\u751f\u5185\u5b58\u6cc4\u9732\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u63d2\u5165\u7ed3\u70b9\u65f6\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\u64cd\u4f5c\u7684\u987a\u5e8f</p> <p>\u63d2\u5165\u7ed3\u70b9 x  \u6b63\u786e\u5199\u6cd5</p> <pre><code>x-&gt;next = p-&gt;next;  // \u5c06x\u7684\u7ed3\u70b9\u7684next\u6307\u9488\u6307\u5411\u539f\u6765\u7ed3\u70b9\uff1b\np-&gt;next = x;  // \u5c06p\u7684next\u6307\u9488\u6307\u5411x\u7ed3\u70b9\uff1b\n</code></pre> <p>\u540c\u7406\uff0c\u5220\u9664\u94fe\u8868\u7ed3\u70b9\u65f6\uff0c\u4e5f\u4e00\u5b9a\u8981\u8bb0\u5f97\u624b\u52a8\u91ca\u653e\u5185\u5b58\u7a7a\u95f4\uff0c\u5426\u5219\uff0c\u4e5f\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u7684\u95ee\u9898\u3002\u5f53\u7136\uff0c\u5bf9\u4e8e\u50cf Java \u8fd9\u79cd\u865a\u62df\u673a\u81ea\u52a8\u7ba1\u7406\u5185\u5b58\u7684\u7f16\u7a0b\u8bed\u8a00\u6765\u8bf4\uff0c\u5c31\u4e0d\u9700\u8981\u8003\u8651\u8fd9\u4e48\u591a\u4e86\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#_4","title":"\u6280\u5de7\u4e09\uff1a\u5229\u7528\u54e8\u5175\u7b80\u5316\u5b9e\u73b0\u96be\u5ea6","text":"<p>\u9488\u5bf9\u94fe\u8868\u7684\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\uff0c\u9700\u8981\u5bf9\u63d2\u5165\u7b2c\u4e00\u4e2a\u7ed3\u70b9\u548c\u5220\u9664\u6700\u540e\u4e00\u4e2a\u7ed3\u70b9\u7684\u60c5\u51b5\u8fdb\u884c\u7279\u6b8a\u5904\u7406\u3002</p> <pre><code>//\u63d2\u5165\nif (head == null) {\nhead = new_node;\n}\n//\u5220\u9664\nif (head-&gt;next == null) {\nhead = null;\n}\n</code></pre> <p>\u5982\u679c\u6211\u4eec\u5f15\u5165\u54e8\u5175\u7ed3\u70b9\uff0c\u5728\u4efb\u4f55\u65f6\u5019\uff0c\u4e0d\u7ba1\u94fe\u8868\u662f\u4e0d\u662f\u7a7a\uff0chead \u6307\u9488\u90fd\u4f1a\u4e00\u76f4\u6307\u5411\u8fd9\u4e2a\u54e8\u5175\u7ed3\u70b9\u3002\u6211\u4eec\u4e5f\u628a\u8fd9\u79cd\u6709\u54e8\u5175\u7ed3\u70b9\u7684\u94fe\u8868\u53eb\u5e26\u5934\u94fe\u8868\u3002\u76f8\u53cd\uff0c\u6ca1\u6709\u54e8\u5175\u7ed3\u70b9\u7684\u94fe\u8868\u5c31\u53eb\u4f5c\u4e0d\u5e26\u5934\u94fe\u8868\u3002\u56e0\u4e3a\u54e8\u5175\u7ed3\u70b9\u4e00\u76f4\u5b58\u5728\uff0c\u6240\u4ee5\u63d2\u5165\u7b2c\u4e00\u4e2a\u7ed3\u70b9\u548c\u63d2\u5165\u5176\u4ed6\u7ed3\u70b9\uff0c\u5220\u9664\u6700\u540e\u4e00\u4e2a\u7ed3\u70b9\u548c\u5220\u9664\u5176\u4ed6\u7ed3\u70b9\uff0c\u90fd\u53ef\u4ee5\u7edf\u4e00\u4e3a\u76f8\u540c\u7684\u4ee3\u7801\u5b9e\u73b0\u903b\u8f91\u4e86\u3002</p>"},{"location":"read/beautiful-algo/linked-list/#_5","title":"\u6280\u5de7\u56db\uff1a\u91cd\u70b9\u7559\u610f\u8fb9\u754c\u6761\u4ef6\u5904\u7406","text":"<p>\u7ecf\u5e38\u7528\u6765\u68c0\u67e5\u94fe\u8868\u4ee3\u7801\u662f\u5426\u6b63\u786e\u7684\u8fb9\u754c\u6761\u4ef6\u6709\u8fd9\u6837\u51e0\u4e2a\uff1a</p> <ul> <li>\u5982\u679c\u94fe\u8868\u4e3a\u7a7a\u65f6\uff0c\u4ee3\u7801\u662f\u5426\u80fd\u6b63\u5e38\u5de5\u4f5c\uff1f</li> <li>\u5982\u679c\u94fe\u8868\u53ea\u5305\u542b\u4e00\u4e2a\u7ed3\u70b9\u65f6\uff0c\u4ee3\u7801\u662f\u5426\u80fd\u6b63\u5e38\u5de5\u4f5c\uff1f</li> <li>\u5982\u679c\u94fe\u8868\u53ea\u5305\u542b\u4e24\u4e2a\u7ed3\u70b9\u65f6\uff0c\u4ee3\u7801\u662f\u5426\u80fd\u6b63\u5e38\u5de5\u4f5c\uff1f</li> <li>\u4ee3\u7801\u903b\u8f91\u5728\u5904\u7406\u5934\u7ed3\u70b9\u548c\u5c3e\u7ed3\u70b9\u7684\u65f6\u5019\uff0c\u662f\u5426\u80fd\u6b63\u5e38\u5de5\u4f5c\uff1f</li> </ul>"},{"location":"read/beautiful-algo/linked-list/#_6","title":"\u6280\u5de7\u4e94\uff1a\u4e3e\u4f8b\u753b\u56fe\uff0c\u8f85\u52a9\u601d\u8003","text":"<p>\u4f60\u53ef\u4ee5\u627e\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u628a\u5b83\u753b\u5728\u7eb8\u4e0a\uff0c\u91ca\u653e\u4e00\u4e9b\u8111\u5bb9\u91cf\uff0c\u7559\u66f4\u591a\u7684\u7ed9\u903b\u8f91\u601d\u8003\uff0c\u8fd9\u6837\u5c31\u4f1a\u611f\u89c9\u5230\u601d\u8def\u6e05\u6670\u5f88\u591a\u3002\u6bd4\u5982\u5f80\u5355\u94fe\u8868\u4e2d\u63d2\u5165\u4e00\u4e2a\u6570\u636e\u8fd9\u6837\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4e00\u822c\u90fd\u662f\u628a\u5404\u79cd\u60c5\u51b5\u90fd\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff0c\u753b\u51fa\u63d2\u5165\u524d\u548c\u63d2\u5165\u540e\u7684\u94fe\u8868\u53d8\u5316\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"read/beautiful-algo/linked-list/#_7","title":"\u6280\u5de7\u516d\uff1a\u591a\u5199\u591a\u7ec3\uff0c\u6ca1\u6709\u6377\u5f84","text":"<p>\u5e38\u7528\u7684\u94fe\u8868\u64cd\u4f5c</p> <ul> <li>\u5355\u94fe\u8868\u53cd\u8f6c</li> <li>\u94fe\u8868\u4e2d\u73af\u7684\u68c0\u6d4b</li> <li>\u4e24\u4e2a\u6709\u5e8f\u7684\u94fe\u8868\u5408\u5e76</li> <li>\u5220\u9664\u94fe\u8868\u5012\u6570\u7b2c n \u4e2a\u7ed3\u70b9</li> <li>\u6c42\u94fe\u8868\u7684\u4e2d\u95f4\u7ed3\u70b9</li> </ul>"},{"location":"read/beautiful-algo/queue/","title":"\u961f\u5217","text":""},{"location":"read/beautiful-algo/queue/#_2","title":"\u5b9a\u4e49","text":"<p><code>\u961f\u5217\uff08queue\uff09</code>\u662f\u4e00\u79cd\u5148\u8fdb\u5148\u51fa\u7684\u3001\u64cd\u4f5c\u53d7\u9650\u7684\u7ebf\u6027\u8868\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u6808\u53ea\u652f\u6301\u4e24\u4e2a\u57fa\u672c\u64cd\u4f5c\uff1a<code>\u5165\u6808 push()</code>\u548c<code>\u51fa\u6808 pop()</code>\u3002\u961f\u5217\u8ddf\u6808\u975e\u5e38\u76f8\u4f3c\uff0c\u652f\u6301\u7684\u64cd\u4f5c\u4e5f\u5f88\u6709\u9650\uff0c\u6700\u57fa\u672c\u7684\u64cd\u4f5c\u4e5f\u662f\u4e24\u4e2a\uff1a<code>\u5165\u961f enqueue()</code>\uff0c\u653e\u4e00\u4e2a\u6570\u636e\u5230\u961f\u5217\u5c3e\u90e8\uff1b<code>\u51fa\u961f dequeue()</code>\uff0c\u4ece\u961f\u5217\u5934\u90e8\u53d6\u4e00\u4e2a\u5143\u7d20\u3002</p>"},{"location":"read/beautiful-algo/queue/#_3","title":"\u5b9e\u73b0","text":"<p>\u961f\u5217\u7684\u5b9e\u73b0\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u5982\u7528\u6570\u7ec4\u5b9e\u73b0\uff0c\u7528\u94fe\u8868\u5b9e\u73b0\uff0c\u7528\u5faa\u73af\u6570\u7ec4\u5b9e\u73b0\u7b49\u7b49\u3002\u7528\u6570\u7ec4\u5b9e\u73b0\u7684\u961f\u5217\u53eb\u4f5c\u987a\u5e8f\u961f\u5217\uff0c\u7528\u94fe\u8868\u5b9e\u73b0\u7684\u961f\u5217\u53eb\u4f5c\u94fe\u5f0f\u961f\u5217\u3002</p>"},{"location":"read/beautiful-algo/queue/#_4","title":"\u987a\u5e8f\u961f\u5217","text":"<p>\u8fd9\u91cc\u6211\u4eec\u7528\u6570\u7ec4\u5b9e\u73b0\u4e00\u4e2a\u961f\u5217\u3002</p> <pre><code>public class ArrayQueue {\nprivate String[] items; // \u6570\u7ec4\nprivate int n = 0; // \u6570\u7ec4\u5927\u5c0f\nprivate int head = 0; // \u961f\u5934\u4e0b\u6807\nprivate int tail = 0; // \u961f\u5c3e\u4e0b\u6807\n// \u7533\u8bf7\u4e00\u4e2a\u5927\u5c0f\u4e3acapacity\u7684\u6570\u7ec4\npublic ArrayQueue(int capacity) {\nitems = new String[capacity];\nn = capacity;\n}\n// \u5165\u961f\u64cd\u4f5c\uff0c\u5c06item\u653e\u5165\u961f\u5c3e\npublic boolean enqueue(String item) {\n// \u5982\u679ctail == n \u8868\u793a\u961f\u5217\u5df2\u7ecf\u6ee1\u4e86\nif (tail == n) return false;\nitems[tail] = item;\n++tail;\nreturn true;\n}\n// \u51fa\u961f\u64cd\u4f5c\uff0c\u5c06\u961f\u5934\u5143\u7d20\u8fd4\u56de\npublic String dequeue() {\n// \u5982\u679chead == tail \u8868\u793a\u961f\u5217\u4e3a\u7a7a\nif (head == tail) return null;\nString ret = items[head];\n++head;\nreturn ret;\n}\n}\n</code></pre> <p>\u968f\u7740\u4e0d\u505c\u5730\u8fdb\u884c\u5165\u961f\u3001\u51fa\u961f\u64cd\u4f5c\uff0chead \u548c tail \u90fd\u4f1a\u6301\u7eed\u5f80\u540e\u79fb\u52a8\u3002\u5f53 tail \u79fb\u52a8\u5230\u6700\u53f3\u8fb9\uff0c\u5373\u4f7f\u6570\u7ec4\u4e2d\u8fd8\u6709\u7a7a\u95f2\u7a7a\u95f4\uff0c\u4e5f\u65e0\u6cd5\u7ee7\u7eed\u5f80\u961f\u5217\u4e2d\u6dfb\u52a0\u6570\u636e\u4e86,\u8fd9\u4e2a\u95ee\u9898\u8be5\u5982\u4f55\u89e3\u51b3\u5462\uff1f</p> <p>\u5982\u679c\u6ca1\u6709\u7a7a\u95f2\u7a7a\u95f4\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u5165\u961f\u65f6\uff0c\u518d\u96c6\u4e2d\u89e6\u53d1\u4e00\u6b21\u6570\u636e\u7684\u642c\u79fb\u64cd\u4f5c <pre><code>// \u5165\u961f\u64cd\u4f5c\uff0c\u5c06item\u653e\u5165\u961f\u5c3e\npublic boolean enqueue(String item) {\n// tail == n\u8868\u793a\u961f\u5217\u672b\u5c3e\u6ca1\u6709\u7a7a\u95f4\u4e86\nif (tail == n) {\n// tail ==n &amp;&amp; head==0\uff0c\u8868\u793a\u6574\u4e2a\u961f\u5217\u90fd\u5360\u6ee1\u4e86\nif (head == 0) return false;\n// \u6570\u636e\u642c\u79fb\nfor (int i = head; i &lt; tail; ++i) {\nitems[i-head] = items[i];\n}\n// \u642c\u79fb\u5b8c\u4e4b\u540e\u91cd\u65b0\u66f4\u65b0head\u548ctail\ntail -= head;\nhead = 0;\n}\nitems[tail] = item;\n++tail;\nreturn true;\n}\n</code></pre></p>"},{"location":"read/beautiful-algo/queue/#_5","title":"\u94fe\u5f0f\u961f\u5217","text":"<p>\u94fe\u5f0f\u961f\u5217\u7684\u5b9e\u73b0\u8ddf\u94fe\u8868\u5f88\u50cf\uff0c\u53ea\u4e0d\u8fc7\u5b83\u662f\u5355\u5411\u94fe\u8868\uff0c\u800c\u4e14\u53ea\u80fd\u4ece\u961f\u5c3e\u63d2\u5165\u5143\u7d20\uff0c\u4ece\u961f\u5934\u5220\u9664\u5143\u7d20\u3002</p> <pre><code>public class LinkedQueue {\n// \u961f\u5217\u7684\u961f\u5934\u548c\u961f\u5c3e\nprivate Node head = null;\nprivate Node tail = null;\n// \u5165\u961f\npublic void enqueue(String value) {\nif (tail == null) {\nNode newNode = new Node(value, null);\nhead = newNode;\ntail = newNode;\n} else {\ntail.next = new Node(value, null);\ntail = tail.next;\n}\n}\n// \u51fa\u961f\npublic String dequeue() {\nif (head == null) return null;\nString value = head.data;\nhead = head.next;\nif (head == null) {\ntail = null;\n}\nreturn value;\n}\n}\npublic class Node {\npublic String data;\npublic Node next;\npublic Node(String data, Node next) {\nthis.data = data;\nthis.next = next;\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/queue/#_6","title":"\u5faa\u73af\u961f\u5217","text":"<p>\u6211\u4eec\u521a\u624d\u7528\u6570\u7ec4\u6765\u5b9e\u73b0\u961f\u5217\u7684\u65f6\u5019\uff0c\u5728 tail==n \u65f6\uff0c\u4f1a\u6709\u6570\u636e\u642c\u79fb\u64cd\u4f5c\uff0c\u8fd9\u6837\u5165\u961f\u64cd\u4f5c\u6027\u80fd\u5c31\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u90a3\u6709\u6ca1\u6709\u529e\u6cd5\u80fd\u591f\u907f\u514d\u6570\u636e\u642c\u79fb\u5462\uff1f\u6211\u4eec\u6765\u770b\u770b\u5faa\u73af\u961f\u5217\u7684\u89e3\u51b3\u601d\u8def\u3002</p> <p>\u5faa\u73af\u961f\u5217\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u961f\u5217\uff0c\u5b83\u652f\u6301\u52a8\u6001\u6269\u5bb9\u3002\u5f53\u961f\u5217\u6ee1\u4e86\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5c06\u6570\u636e\u642c\u79fb\u5230\u6570\u7ec4\u7684\u5934\u90e8\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5f80\u961f\u5217\u4e2d\u6dfb\u52a0\u6570\u636e\u4e86\u3002</p> <pre><code>public class CircularQueue {\n// \u6570\u7ec4\uff1aitems\uff0c\u6570\u7ec4\u5927\u5c0f\uff1an\nprivate String[] items;\nprivate int n = 0;\n// head\u8868\u793a\u961f\u5934\u4e0b\u6807\uff0ctail\u8868\u793a\u961f\u5c3e\u4e0b\u6807\nprivate int head = 0;\nprivate int tail = 0;\n// \u7533\u8bf7\u4e00\u4e2a\u5927\u5c0f\u4e3acapacity\u7684\u6570\u7ec4\npublic CircularQueue(int capacity) {\nitems = new String[capacity];\nn = capacity;\n}\n// \u5165\u961f\npublic boolean enqueue(String item) {\n// \u961f\u5217\u6ee1\u4e86\u5f53\u961f\u6ee1\u65f6\uff0c(tail+1)%n=head\nif ((tail + 1) % n == head) return false;\nitems[tail] = item;\ntail = (tail + 1) % n;\nreturn true;\n}\n// \u51fa\u961f\npublic String dequeue() {\n// \u5982\u679chead == tail \u8868\u793a\u961f\u5217\u4e3a\u7a7a\nif (head == tail) return null;\nString ret = items[head];\nhead = (head + 1) % n;\nreturn ret;\n}\n}\n</code></pre> <p>\u5f53\u961f\u5217\u6ee1\u65f6\uff0ctail \u6307\u5411\u7684\u4f4d\u7f6e\u5b9e\u9645\u4e0a\u662f\u6ca1\u6709\u5b58\u50a8\u6570\u636e\u7684\u3002\u6240\u4ee5\uff0c\u5faa\u73af\u961f\u5217\u4f1a\u6d6a\u8d39\u4e00\u4e2a\u6570\u7ec4\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u5982\u4e0b\u56fe\uff1a </p>"},{"location":"read/beautiful-algo/queue/#_7","title":"\u5e94\u7528","text":"<p>\u961f\u5217\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u5f88\u57fa\u7840\uff0c\u5e73\u65f6\u7684\u4e1a\u52a1\u5f00\u53d1\u4e0d\u5927\u53ef\u80fd\u4ece\u96f6\u5b9e\u73b0\u4e00\u4e2a\u961f\u5217\uff0c\u751a\u81f3\u90fd\u4e0d\u4f1a\u76f4\u63a5\u7528\u5230\u3002\u800c\u4e00\u4e9b\u5177\u6709\u7279\u6b8a\u7279\u6027\u7684\u961f\u5217\u5e94\u7528\u5374\u6bd4\u8f83\u5e7f\u6cdb\uff0c\u6bd4\u5982<code>\u963b\u585e\u961f\u5217</code>\u548c<code>\u5e76\u53d1\u961f\u5217</code>\u3002</p>"},{"location":"read/beautiful-algo/queue/#_8","title":"\u963b\u585e\u961f\u5217","text":"<p><code>\u963b\u585e\u961f\u5217</code>\u5176\u5b9e\u5c31\u662f\u5728\u961f\u5217\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u963b\u585e\u64cd\u4f5c\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u5728\u961f\u5217\u4e3a\u7a7a\u7684\u65f6\u5019\uff0c\u4ece\u961f\u5934\u53d6\u6570\u636e\u4f1a\u88ab\u963b\u585e\u3002\u56e0\u4e3a\u6b64\u65f6\u8fd8\u6ca1\u6709\u6570\u636e\u53ef\u53d6\uff0c\u76f4\u5230\u961f\u5217\u4e2d\u6709\u4e86\u6570\u636e\u624d\u80fd\u8fd4\u56de\uff1b\u5982\u679c\u961f\u5217\u5df2\u7ecf\u6ee1\u4e86\uff0c\u90a3\u4e48\u63d2\u5165\u6570\u636e\u7684\u64cd\u4f5c\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u4e2d\u6709\u7a7a\u95f2\u4f4d\u7f6e\u540e\u518d\u63d2\u5165\u6570\u636e\uff0c\u7136\u540e\u518d\u8fd4\u56de\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u963b\u585e\u961f\u5217\uff0c\u8f7b\u677e\u5b9e\u73b0\u4e00\u4e2a<code>\u201c\u751f\u4ea7\u8005 - \u6d88\u8d39\u8005\u6a21\u578b\u201d</code>\uff01\u8fd9\u79cd\u57fa\u4e8e\u963b\u585e\u961f\u5217\u5b9e\u73b0\u7684<code>\u201c\u751f\u4ea7\u8005 - \u6d88\u8d39\u8005\u6a21\u578b\u201d</code>\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u534f\u8c03\u751f\u4ea7\u548c\u6d88\u8d39\u7684\u901f\u5ea6\u3002\u5f53\u201c\u751f\u4ea7\u8005\u201d\u751f\u4ea7\u6570\u636e\u7684\u901f\u5ea6\u8fc7\u5feb\uff0c\u201c\u6d88\u8d39\u8005\u201d\u6765\u4e0d\u53ca\u6d88\u8d39\u65f6\uff0c\u5b58\u50a8\u6570\u636e\u7684\u961f\u5217\u5f88\u5feb\u5c31\u4f1a\u6ee1\u4e86\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u751f\u4ea7\u8005\u5c31\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230\u201c\u6d88\u8d39\u8005\u201d\u6d88\u8d39\u4e86\u6570\u636e\uff0c\u201c\u751f\u4ea7\u8005\u201d\u624d\u4f1a\u88ab\u5524\u9192\u7ee7\u7eed\u201c\u751f\u4ea7\u201d\u3002</p>"},{"location":"read/beautiful-algo/queue/#_9","title":"\u5e76\u53d1\u961f\u5217","text":"<p>\u7ebf\u7a0b\u5b89\u5168\u7684\u961f\u5217\u6211\u4eec\u53eb\u4f5c<code>\u5e76\u53d1\u961f\u5217</code>\u3002\u6700\u7b80\u5355\u76f4\u63a5\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u76f4\u63a5\u5728 enqueue()\u3001dequeue() \u65b9\u6cd5\u4e0a\u52a0\u9501\uff0c\u4f46\u662f\u9501\u7c92\u5ea6\u5927\u5e76\u53d1\u5ea6\u4f1a\u6bd4\u8f83\u4f4e\uff0c\u540c\u4e00\u65f6\u523b\u4ec5\u5141\u8bb8\u4e00\u4e2a\u5b58\u6216\u8005\u53d6\u64cd\u4f5c\u3002\u5b9e\u9645\u4e0a\uff0c\u57fa\u4e8e\u6570\u7ec4\u7684\u5faa\u73af\u961f\u5217\uff0c\u5229\u7528 CAS \u539f\u5b50\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5b9e\u73b0\u975e\u5e38\u9ad8\u6548\u7684\u5e76\u53d1\u961f\u5217\u3002\u8fd9\u4e5f\u662f\u5faa\u73af\u961f\u5217\u6bd4\u94fe\u5f0f\u961f\u5217\u5e94\u7528\u66f4\u52a0\u5e7f\u6cdb\u7684\u539f\u56e0\u3002</p> <p>\u5bf9\u4e8e\u5927\u90e8\u5206\u8d44\u6e90\u6709\u9650\u7684\u573a\u666f\uff0c\u5f53\u6ca1\u6709\u7a7a\u95f2\u8d44\u6e90\u65f6\uff0c\u57fa\u672c\u4e0a\u90fd\u53ef\u4ee5\u901a\u8fc7\u201c\u961f\u5217\u201d\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u8bf7\u6c42\u6392\u961f\u3002\u6bd4\u5982\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u8fdb\u7a0b\u8c03\u5ea6\u3001\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u3001\u7ebf\u7a0b\u6c60\u3001\u6d88\u606f\u961f\u5217\u7b49\u7b49\uff0c\u90fd\u662f\u5178\u578b\u7684\u201c\u961f\u5217\u201d\u5e94\u7528\u573a\u666f\u3002</p>"},{"location":"read/beautiful-algo/recursion/","title":"\u9012\u5f52","text":""},{"location":"read/beautiful-algo/recursion/#_2","title":"\u5b9a\u4e49","text":"<p>\u5728\u6570\u5b66\u4e0e\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0c\u662f\u6307\u5728**\u51fd\u6570\u7684\u5b9a\u4e49\u4e2d\u4f7f\u7528\u51fd\u6570\u81ea\u8eab\u7684\u65b9\u6cd5**</p>"},{"location":"read/beautiful-algo/recursion/#_3","title":"\u9012\u5f52\u9700\u8981\u6ee1\u8db3\u7684\u4e09\u4e2a\u6761\u4ef6","text":"<ol> <li>\u4e00\u4e2a\u95ee\u9898\u7684\u89e3\u53ef\u4ee5\u5206\u89e3\u4e3a\u51e0\u4e2a\u5b50\u95ee\u9898\u7684\u89e3</li> <li>\u8fd9\u4e2a\u95ee\u9898\u4e0e\u5206\u89e3\u4e4b\u540e\u7684\u5b50\u95ee\u9898\uff0c\u9664\u4e86\u6570\u636e\u89c4\u6a21\u4e0d\u540c\uff0c\u6c42\u89e3\u601d\u8def\u5b8c\u5168\u4e00\u6837</li> <li>\u5b58\u5728\u9012\u5f52\u7ec8\u6b62\u6761\u4ef6</li> </ol>"},{"location":"read/beautiful-algo/recursion/#_4","title":"\u9012\u5f52\u7684\u5b9e\u73b0","text":"<p>\u5199\u9012\u5f52\u4ee3\u7801\u6700\u5173\u952e\u7684\u662f \u5199\u51fa\u9012\u63a8\u516c\u5f0f\uff0c\u627e\u5230\u7ec8\u6b62\u6761\u4ef6\uff0c\u53e6\u5916\u8fd8\u8981\u6ce8\u610f \u9632\u6b62\u5806\u6808\u6ea2\u51fa\u548c\u91cd\u590d\u8ba1\u7b97</p> <p>\u7f16\u5199\u9012\u5f52\u4ee3\u7801\u7684\u5173\u952e\u662f\uff0c\u53ea\u8981\u9047\u5230\u9012\u5f52\uff0c\u6211\u4eec\u5c31\u628a\u5b83\u62bd\u8c61\u6210\u4e00\u4e2a\u9012\u63a8\u516c\u5f0f\uff0c\u4e0d\u7528\u60f3\u4e00\u5c42\u5c42\u7684\u8c03\u7528\u5173\u7cfb\uff0c\u4e0d\u8981\u8bd5\u56fe\u7528\u4eba\u8111\u53bb\u5206\u89e3\u9012\u5f52\u7684\u6bcf\u4e2a\u6b65\u9aa4\u3002</p> <p>\u8ba1\u7b97\u673a\u64c5\u957f\u505a\u91cd\u590d\u7684\u4e8b\u60c5\uff0c\u6240\u4ee5\u9012\u5f52\u6b63\u5408\u5b83\u7684\u80c3\u53e3\u3002\u800c\u6211\u4eec\u4eba\u8111\u66f4\u559c\u6b22\u5e73\u94fa\u76f4\u53d9\u7684\u601d\u7ef4\u65b9\u5f0f\u3002\u5f53\u6211\u4eec\u770b\u5230\u9012\u5f52\u65f6\uff0c\u6211\u4eec\u603b\u60f3\u628a\u9012\u5f52\u5e73\u94fa\u5c55\u5f00\uff0c\u8111\u5b50\u91cc\u5c31\u4f1a\u5faa\u73af\uff0c\u4e00\u5c42\u4e00\u5c42\u5f80\u4e0b\u8c03\uff0c\u7136\u540e\u518d\u4e00\u5c42\u4e00\u5c42\u8fd4\u56de\uff0c\u8bd5\u56fe\u60f3\u641e\u6e05\u695a\u8ba1\u7b97\u673a\u6bcf\u4e00\u6b65\u90fd\u662f\u600e\u4e48\u6267\u884c\u7684\uff0c\u8fd9\u6837\u5c31\u5f88\u5bb9\u6613\u88ab\u7ed5\u8fdb\u53bb\u3002</p>"},{"location":"read/beautiful-algo/recursion/#_5","title":"\u5b9e\u4f8b","text":"<p>\u5047\u5982\u8fd9\u91cc\u6709 n \u4e2a\u53f0\u9636\uff0c\u6bcf\u6b21\u4f60\u53ef\u4ee5\u8de8 1 \u4e2a\u53f0\u9636\u6216\u8005 2 \u4e2a\u53f0\u9636\uff0c\u8bf7\u95ee\u8d70\u8fd9 n \u4e2a\u53f0\u9636\u6709\u591a\u5c11\u79cd\u8d70\u6cd5\uff1f\u5982\u679c\u6709 7 \u4e2a\u53f0\u9636\uff0c\u4f60\u53ef\u4ee5 2\uff0c2\uff0c2\uff0c1 \u8fd9\u6837\u5b50\u4e0a\u53bb\uff0c\u4e5f\u53ef\u4ee5 1\uff0c2\uff0c1\uff0c1\uff0c2 \u8fd9\u6837\u5b50\u4e0a\u53bb\uff0c\u603b\u4e4b\u8d70\u6cd5\u6709\u5f88\u591a\uff0c\u90a3\u5982\u4f55\u7528\u7f16\u7a0b\u6c42\u5f97\u603b\u5171\u6709\u591a\u5c11\u79cd\u8d70\u6cd5\u5462\uff1f</p> <p>1. \u9012\u63a8\u516c\u5f0f</p> <p>\u5b9e\u9645\u4e0a\uff0c\u53ef\u4ee5\u6839\u636e\u7b2c\u4e00\u6b65\u7684\u8d70\u6cd5\u628a\u6240\u6709\u8d70\u6cd5\u5206\u4e3a\u4e24\u7c7b\uff0c\u7b2c\u4e00\u7c7b\u662f\u7b2c\u4e00\u6b65\u8d70\u4e86 1 \u4e2a\u53f0\u9636\uff0c\u53e6\u4e00\u7c7b\u662f\u7b2c\u4e00\u6b65\u8d70\u4e86 2 \u4e2a\u53f0\u9636\u3002\u6240\u4ee5 n \u4e2a\u53f0\u9636\u7684\u8d70\u6cd5\u5c31\u7b49\u4e8e\u5148\u8d70 1 \u9636\u540e\uff0cn-1 \u4e2a\u53f0\u9636\u7684\u8d70\u6cd5 \u52a0\u4e0a\u5148\u8d70 2 \u9636\u540e\uff0cn-2 \u4e2a\u53f0\u9636\u7684\u8d70\u6cd5\u3002\u7528\u516c\u5f0f\u8868\u793a\u5c31\u662f\uff1a</p> <pre><code>f(n) = f(n-1) + f(n-2)\n</code></pre> <p>2. \u7ec8\u6b62\u6761\u4ef6</p> <p>\u5f53\u6709\u4e00\u4e2a\u53f0\u9636\u65f6\uff0c\u53ea\u6709\u4e00\u79cd\u8d70\u6cd5;\u5f53\u6709\u4e24\u4e2a\u53f0\u9636\u65f6\uff0c\u6709\u4e24\u79cd\u8d70\u6cd5\uff0c\u4e00\u6b65\u8d70\u5b8c\u6216\u8005\u5206\u4e24\u6b65\u6765\u8d70</p> <pre><code>f(1) = 1\nf(2) = 2\n</code></pre> <p>3.\u4ee3\u7801\u5b9e\u73b0</p> <pre><code>public class ClimbStairs {\npublic int climbStairs(int n) {\nif (n == 1) {\nreturn 1;\n}\nif (n == 2) {\nreturn 2;\n}\nreturn climbStairs(n - 1) + climbStairs(n - 2);\n}\n}\n</code></pre> <p>4. \u91cd\u590d\u8ba1\u7b97</p> <p>\u5982\u679c\u6211\u4eec\u628a\u6574\u4e2a\u9012\u5f52\u8fc7\u7a0b\u5206\u89e3\u4e00\u4e0b\u7684\u8bdd\uff0c\u90a3\u5c31\u662f\u8fd9\u6837\u7684\uff1a </p> <p>\u4ece\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u5230\uff0c\u60f3\u8981\u8ba1\u7b97 f(5)\uff0c\u9700\u8981\u5148\u8ba1\u7b97 f(4) \u548c f(3)\uff0c\u800c\u8ba1\u7b97 f(4) \u8fd8\u9700\u8981\u8ba1\u7b97 f(3)\uff0c\u56e0\u6b64\uff0cf(3) \u5c31\u88ab\u8ba1\u7b97\u4e86\u5f88\u591a\u6b21\uff0c\u8fd9\u5c31\u662f\u91cd\u590d\u8ba1\u7b97\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u8ba1\u7b97\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff08\u6bd4\u5982\u6563\u5217\u8868\uff09\u6765\u4fdd\u5b58\u5df2\u7ecf\u6c42\u89e3\u8fc7\u7684 f(k)\u3002\u5f53\u9012\u5f52\u8c03\u7528\u5230 f(k) \u65f6\uff0c\u5148\u770b\u4e0b\u662f\u5426\u5df2\u7ecf\u6c42\u89e3\u8fc7\u4e86\u3002\u5982\u679c\u662f\uff0c\u5219\u76f4\u63a5\u4ece\u6563\u5217\u8868\u4e2d\u53d6\u503c\u8fd4\u56de\uff0c\u4e0d\u9700\u8981\u91cd\u590d\u8ba1\u7b97\uff0c\u8fd9\u6837\u5c31\u80fd\u907f\u514d\u521a\u8bb2\u7684\u95ee\u9898\u4e86\u3002</p> <pre><code>public class ClimbStairs {\nprivate Map&lt;Integer, Integer&gt; cache = new HashMap&lt;&gt;();\npublic int climbStairs(int n) {\nif (n == 1) {\nreturn 1;\n}\nif (n == 2) {\nreturn 2;\n}\nif (cache.containsKey(n)) {\nreturn cache.get(n);\n}\nint result = climbStairs(n - 1) + climbStairs(n - 2);\ncache.put(n, result);\nreturn result;\n}\n}\n</code></pre> <p>5. \u9632\u6b62\u5806\u6808\u6ea2\u51fa</p> <p>\u5982\u679c n \u5f88\u5927\uff0c\u6bd4\u5982 10000\uff0c\u90a3\u4e48\u9012\u5f52\u8c03\u7528\u5c31\u4f1a\u6709 10000 \u5c42\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u5806\u6808\u6ea2\u51fa\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5728\u4ee3\u7801\u4e2d\u9650\u5236\u9012\u5f52\u8c03\u7528\u7684\u6700\u5927\u6df1\u5ea6\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <pre><code>public class ClimbStairs {\nprivate Map&lt;Integer, Integer&gt; cache = new HashMap&lt;&gt;();\n// \u5168\u5c40\u53d8\u91cf\uff0c\u8868\u793a\u9012\u5f52\u7684\u6df1\u5ea6\u3002\nint depth = 0;\npublic int climbStairs(int n) {\n++depth\uff1b\nif (depth &gt; 1000) {\n//\u4f2a\u4ee3\u7801\uff0c\u629b\u51fa\u5f02\u5e38\nthrow exception;    }\nif (n == 1) {\nreturn 1;\n}\nif (n == 2) {\nreturn 2;\n}\nif (cache.containsKey(n)) {\nreturn cache.get(n);\n}\nint result = climbStairs(n - 1) + climbStairs(n - 2);\ncache.put(n, result);\nreturn result;\n}\n}\n</code></pre> <p>\u53e6\u5916\uff0c \u6211\u4eec\u4e5f\u53ef\u4ee5\u628a\u9012\u5f52\u6539\u5199\u6210\u8fed\u4ee3\u5faa\u73af\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u6709\u5806\u6808\u6ea2\u51fa\u7684\u95ee\u9898\u4e86\u3002</p> <pre><code>public class ClimbStairs {\npublic int climbStairs(int n) {\nif (n == 1) {\nreturn 1;\n}\nint first = 1;\nint second = 2;\nfor (int i = 3; i &lt;= n; i++) {\nint third = first + second;\nfirst = second;\nsecond = third;\n}\nreturn second;\n}\n}\n</code></pre> <p>\u662f\u4e0d\u662f\u6240\u6709\u7684\u9012\u5f52\u4ee3\u7801\u90fd\u53ef\u4ee5\u6539\u4e3a\u8fd9\u79cd\u8fed\u4ee3\u5faa\u73af\u7684\u975e\u9012\u5f52\u5199\u6cd5\u5462\uff1f</p> <p>\u7b3c\u7edf\u5730\u8bb2\uff0c\u662f\u7684\u3002\u56e0\u4e3a\u9012\u5f52\u672c\u8eab\u5c31\u662f\u501f\u52a9\u6808\u6765\u5b9e\u73b0\u7684\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u4f7f\u7528\u7684\u6808\u662f\u7cfb\u7edf\u6216\u8005\u865a\u62df\u673a\u672c\u8eab\u63d0\u4f9b\u7684\uff0c\u6211\u4eec\u6ca1\u6709\u611f\u77e5\u7f62\u4e86\u3002\u5982\u679c\u6211\u4eec\u81ea\u5df1\u5728\u5185\u5b58\u5806\u4e0a\u5b9e\u73b0\u6808\uff0c\u624b\u52a8\u6a21\u62df\u5165\u6808\u3001\u51fa\u6808\u8fc7\u7a0b\uff0c\u8fd9\u6837\u4efb\u4f55\u9012\u5f52\u4ee3\u7801\u90fd\u53ef\u4ee5\u6539\u5199\u6210\u770b\u4e0a\u53bb\u4e0d\u662f\u9012\u5f52\u4ee3\u7801\u7684\u6837\u5b50\u3002</p> <p>\u4f46\u662f\u8fd9\u79cd\u601d\u8def\u5b9e\u9645\u4e0a\u662f\u5c06\u9012\u5f52\u6539\u4e3a\u4e86\u201c\u624b\u52a8\u201d\u9012\u5f52\uff0c\u672c\u8d28\u5e76\u6ca1\u6709\u53d8\uff0c\u800c\u4e14\u4e5f\u5e76\u6ca1\u6709\u89e3\u51b3\u524d\u9762\u8bb2\u5230\u7684\u67d0\u4e9b\u95ee\u9898\uff0c\u5f92\u589e\u4e86\u5b9e\u73b0\u7684\u590d\u6742\u5ea6\u3002</p>"},{"location":"read/beautiful-algo/recursion/#_6","title":"\u9898\u5916\u8bdd","text":"<p>\u6211\u4eec\u5e73\u65f6\u8c03\u8bd5\u4ee3\u7801\u559c\u6b22\u4f7f\u7528 IDE \u7684\u5355\u6b65\u8ddf\u8e2a\u529f\u80fd\uff0c\u50cf\u89c4\u6a21\u6bd4\u8f83\u5927\u3001\u9012\u5f52\u5c42\u6b21\u5f88\u6df1\u7684\u9012\u5f52\u4ee3\u7801\uff0c\u51e0\u4e4e\u65e0\u6cd5\u4f7f\u7528\u8fd9\u79cd\u8c03\u8bd5\u65b9\u5f0f\u3002\u5bf9\u4e8e\u9012\u5f52\u4ee3\u7801\uff0c\u6709\u4ec0\u4e48\u597d\u7684\u8c03\u8bd5\u65b9\u6cd5\u5462\uff1f</p> <ol> <li>\u6253\u5370\u65e5\u5fd7\u53d1\u73b0\uff0c\u9012\u5f52\u503c\u3002</li> <li>\u7ed3\u5408\u6761\u4ef6\u65ad\u70b9\u8fdb\u884c\u8c03\u8bd5\u3002</li> </ol>"},{"location":"read/beautiful-algo/skip-list/","title":"\u6392\u5e8f\u4f18\u5316","text":""},{"location":"read/beautiful-algo/sort-advance/","title":"\u9ad8\u7ea7\u6392\u5e8f","text":""},{"location":"read/beautiful-algo/sort-op/","title":"\u6392\u5e8f\u4f18\u5316","text":""},{"location":"read/beautiful-algo/stack/","title":"\u6808","text":""},{"location":"read/beautiful-algo/stack/#_2","title":"\u5b9a\u4e49","text":"<p>\u6808\u662f\u4e00\u79cd\u201c\u64cd\u4f5c\u53d7\u9650\u201d\u7684\u7ebf\u6027\u8868\uff0c\u53ea\u5141\u8bb8\u5728\u4e00\u7aef\u63d2\u5165\u548c\u5220\u9664\u6570\u636e\u3002\u540e\u8fdb\u8005\u5148\u51fa\uff0c\u5148\u8fdb\u8005\u540e\u51fa\uff0c\u662f\u5178\u578b\u7684\u201c\u6808\u201d\u7ed3\u6784\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u4ece\u529f\u80fd\u4e0a\u6765\u8bf4\uff0c\u6570\u7ec4\u6216\u94fe\u8868\u786e\u5b9e\u53ef\u4ee5\u66ff\u4ee3\u6808\uff0c\u4f46\u4f60\u8981\u77e5\u9053\uff0c\u7279\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u662f\u5bf9\u7279\u5b9a\u573a\u666f\u7684\u62bd\u8c61\uff0c\u800c\u4e14\uff0c\u6570\u7ec4\u6216\u94fe\u8868\u66b4\u9732\u4e86\u592a\u591a\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u64cd\u4f5c\u4e0a\u7684\u786e\u7075\u6d3b\u81ea\u7531\uff0c\u4f46\u4f7f\u7528\u65f6\u5c31\u6bd4\u8f83\u4e0d\u53ef\u63a7\uff0c\u81ea\u7136\u4e5f\u5c31\u66f4\u5bb9\u6613\u51fa\u9519\u3002</p>"},{"location":"read/beautiful-algo/stack/#_3","title":"\u6808\u7684\u5b9e\u73b0","text":"<p>\u6808\u65e2\u53ef\u4ee5\u7528\u6570\u7ec4\u6765\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u7528\u94fe\u8868\u6765\u5b9e\u73b0\u3002\u7528\u6570\u7ec4\u5b9e\u73b0\u7684\u6808\uff0c\u6211\u4eec\u53eb\u4f5c \u987a\u5e8f\u6808\uff0c\u7528\u94fe\u8868\u5b9e\u73b0\u7684\u6808\uff0c\u6211\u4eec\u53eb\u4f5c \u94fe\u5f0f\u6808\u3002</p> <p>\u57fa\u4e8e\u6570\u7ec4\u7684\u987a\u5e8f\u6808</p> <pre><code>// \u57fa\u4e8e\u6570\u7ec4\u5b9e\u73b0\u7684\u987a\u5e8f\u6808\npublic class ArrayStack {\nprivate String[] items;  // \u6570\u7ec4\nprivate int count;       // \u6808\u4e2d\u5143\u7d20\u4e2a\u6570\nprivate int n;           //\u6808\u7684\u5927\u5c0f\n// \u521d\u59cb\u5316\u6570\u7ec4\uff0c\u7533\u8bf7\u4e00\u4e2a\u5927\u5c0f\u4e3an\u7684\u6570\u7ec4\u7a7a\u95f4\npublic ArrayStack(int n) {\nthis.items = new String[n];\nthis.n = n;\nthis.count = 0;\n}\n// \u5165\u6808\u64cd\u4f5c\npublic boolean push(String item) {\n// \u6570\u7ec4\u7a7a\u95f4\u4e0d\u591f\u4e86\uff0c\u76f4\u63a5\u8fd4\u56defalse\uff0c\u5165\u6808\u5931\u8d25\u3002\nif (count == n) return false;\n// \u5c06item\u653e\u5230\u4e0b\u6807\u4e3acount\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e14count\u52a0\u4e00\nitems[count] = item;\n++count;\nreturn true;\n}\n// \u51fa\u6808\u64cd\u4f5c\npublic String pop() {\n// \u6808\u4e3a\u7a7a\uff0c\u5219\u76f4\u63a5\u8fd4\u56denull\nif (count == 0) return null;\n// \u8fd4\u56de\u4e0b\u6807\u4e3acount-1\u7684\u6570\u7ec4\u5143\u7d20\uff0c\u5e76\u4e14\u6808\u4e2d\u5143\u7d20\u4e2a\u6570count\u51cf\u4e00\nString tmp = items[count-1];\n--count;\nreturn tmp;\n}\n}\n</code></pre>"},{"location":"read/beautiful-algo/stack/#_4","title":"\u65f6\u95f4&amp;\u7a7a\u95f4\u590d\u6742\u5ea6","text":"<ul> <li>\u7a7a\u95f4\u590d\u6742\u5ea6</li> </ul> <p>\u5728\u5165\u6808\u548c\u51fa\u6808\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u9700\u8981\u4e00\u4e24\u4e2a\u4e34\u65f6\u53d8\u91cf\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u7a7a\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002</p> <ul> <li>\u65f6\u95f4\u590d\u6742\u5ea6</li> </ul> <p>\u4e0d\u7ba1\u662f\u987a\u5e8f\u6808\u8fd8\u662f\u94fe\u5f0f\u6808\uff0c\u5165\u6808\u3001\u51fa\u6808\u53ea\u6d89\u53ca\u6808\u9876\u4e2a\u522b\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(1)\u3002</p>"},{"location":"read/beautiful-algo/stack/#_5","title":"\u5e94\u7528","text":""},{"location":"read/beautiful-algo/stack/#_6","title":"\u51fd\u6570\u8c03\u7528\u6808","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u7ed9\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d\u4e86\u4e00\u5757\u72ec\u7acb\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u5757\u5185\u5b58\u88ab\u7ec4\u7ec7\u6210\u201c\u6808\u201d\u8fd9\u79cd\u7ed3\u6784, \u7528\u6765\u5b58\u50a8\u51fd\u6570\u8c03\u7528\u65f6\u7684\u4e34\u65f6\u53d8\u91cf\u3002\u6bcf\u8fdb\u5165\u4e00\u4e2a\u51fd\u6570\uff0c\u5c31\u4f1a\u5c06\u4e34\u65f6\u53d8\u91cf\u4f5c\u4e3a\u4e00\u4e2a\u6808\u5e27\u5165\u6808\uff0c\u5f53\u88ab\u8c03\u7528\u51fd\u6570\u6267\u884c\u5b8c\u6210\uff0c\u8fd4\u56de\u4e4b\u540e\uff0c\u5c06\u8fd9\u4e2a\u51fd\u6570\u5bf9\u5e94\u7684\u6808\u5e27\u51fa\u6808</p> <p>\u4e3a\u4ec0\u4e48\u51fd\u6570\u8c03\u7528\u8981\u7528\u201c\u6808\u201d\u6765\u4fdd\u5b58\u4e34\u65f6\u53d8\u91cf\u5462\uff1f\u7528\u5176\u4ed6\u6570\u636e\u7ed3\u6784\u4e0d\u884c\u5417\uff1f<p>\u5176\u5b9e\uff0c\u6211\u4eec\u4e0d\u4e00\u5b9a\u975e\u8981\u7528\u6808\u6765\u4fdd\u5b58\u4e34\u65f6\u53d8\u91cf\uff0c\u53ea\u4e0d\u8fc7\u5982\u679c\u8fd9\u4e2a\u51fd\u6570\u8c03\u7528\u7b26\u5408\u540e\u8fdb\u5148\u51fa\u7684\u7279\u6027\uff0c\u7528\u6808\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\uff0c\u662f\u6700\u987a\u7406\u6210\u7ae0\u7684\u9009\u62e9\u3002</p> <p>\u4ece\u8c03\u7528\u51fd\u6570\u8fdb\u5165\u88ab\u8c03\u7528\u51fd\u6570\uff0c\u5bf9\u4e8e\u6570\u636e\u6765\u8bf4\uff0c\u53d8\u5316\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u662f\u4f5c\u7528\u57df\u3002\u6240\u4ee5\u6839\u672c\u4e0a\uff0c\u53ea\u8981\u80fd\u4fdd\u8bc1\u6bcf\u8fdb\u5165\u4e00\u4e2a\u65b0\u7684\u51fd\u6570\uff0c\u90fd\u662f\u4e00\u4e2a\u65b0\u7684\u4f5c\u7528\u57df\u5c31\u53ef\u4ee5\u3002\u800c\u8981\u5b9e\u73b0\u8fd9\u4e2a\uff0c\u7528\u6808\u5c31\u975e\u5e38\u65b9\u4fbf\u3002\u5728\u8fdb\u5165\u88ab\u8c03\u7528\u51fd\u6570\u7684\u65f6\u5019\uff0c\u5206\u914d\u4e00\u6bb5\u6808\u7a7a\u95f4\u7ed9\u8fd9\u4e2a\u51fd\u6570\u7684\u53d8\u91cf\uff0c\u5728\u51fd\u6570\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u5c06\u6808\u9876\u590d\u4f4d\uff0c\u6b63\u597d\u56de\u5230\u8c03\u7528\u51fd\u6570\u7684\u4f5c\u7528\u57df\u5185\u3002</p> </p>"},{"location":"read/beautiful-algo/stack/#_7","title":"\u62ec\u53f7\u5339\u914d","text":"<p>\u6211\u4eec\u5047\u8bbe\u8868\u8fbe\u5f0f\u4e2d\u53ea\u5305\u542b\u4e09\u79cd\u62ec\u53f7\uff0c\u5706\u62ec\u53f7 ()\u3001\u65b9\u62ec\u53f7[]\u548c\u82b1\u62ec\u53f7{}\uff0c\u5e76\u4e14\u5b83\u4eec\u53ef\u4ee5\u4efb\u610f\u5d4c\u5957\u3002\u6bd4\u5982\uff0c{[] ()[{}]}\u6216[{()}([])]\u7b49\u90fd\u4e3a\u5408\u6cd5\u683c\u5f0f\uff0c\u800c{[}()]\u6216[({)]\u4e3a\u4e0d\u5408\u6cd5\u7684\u683c\u5f0f\u3002\u90a3\u6211\u73b0\u5728\u7ed9\u4f60\u4e00\u4e2a\u5305\u542b\u4e09\u79cd\u62ec\u53f7\u7684\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\uff0c\u5982\u4f55\u68c0\u67e5\u5b83\u662f\u5426\u5408\u6cd5\u5462\uff1f</p> <p>\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u7528\u6808\u6765\u89e3\u51b3\u3002\u6211\u4eec\u7528\u6808\u6765\u4fdd\u5b58\u672a\u5339\u914d\u7684\u5de6\u62ec\u53f7\uff0c\u4ece\u5de6\u5230\u53f3\u4f9d\u6b21\u626b\u63cf\u5b57\u7b26\u4e32\u3002\u5f53\u626b\u63cf\u5230\u5de6\u62ec\u53f7\u65f6\uff0c\u5219\u5c06\u5176\u538b\u5165\u6808\u4e2d\uff1b\u5f53\u626b\u63cf\u5230\u53f3\u62ec\u53f7\u65f6\uff0c\u4ece\u6808\u9876\u53d6\u51fa\u4e00\u4e2a\u5de6\u62ec\u53f7\u3002\u5982\u679c\u80fd\u591f\u5339\u914d\uff0c\u6bd4\u5982\u201c(\u201d\u8ddf\u201c)\u201d\u5339\u914d\uff0c\u201c[\u201d\u8ddf\u201c]\u201d\u5339\u914d\uff0c\u201c{\u201d\u8ddf\u201c}\u201d\u5339\u914d\uff0c\u5219\u7ee7\u7eed\u626b\u63cf\u5269\u4e0b\u7684\u5b57\u7b26\u4e32\u3002\u5982\u679c\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9047\u5230\u4e0d\u80fd\u914d\u5bf9\u7684\u53f3\u62ec\u53f7\uff0c\u6216\u8005\u6808\u4e2d\u6ca1\u6709\u6570\u636e\uff0c\u5219\u8bf4\u660e\u4e3a\u975e\u6cd5\u683c\u5f0f\u3002\u5f53\u6240\u6709\u7684\u62ec\u53f7\u90fd\u626b\u63cf\u5b8c\u6210\u4e4b\u540e\uff0c\u5982\u679c\u6808\u4e3a\u7a7a\uff0c\u5219\u8bf4\u660e\u5b57\u7b26\u4e32\u4e3a\u5408\u6cd5\u683c\u5f0f\uff1b\u5426\u5219\uff0c\u8bf4\u660e\u6709\u672a\u5339\u914d\u7684\u5de6\u62ec\u53f7\uff0c\u4e3a\u975e\u6cd5\u683c\u5f0f\u3002</p>"},{"location":"read/beautiful-algo/stack/#_8","title":"\u6d4f\u89c8\u5668\u7684\u524d\u8fdb\u3001\u540e\u9000\u529f\u80fd","text":"<p>\u6211\u4eec\u4f7f\u7528\u4e24\u4e2a\u6808\uff0cX \u548c Y\uff0c\u6211\u4eec\u628a\u9996\u6b21\u6d4f\u89c8\u7684\u9875\u9762\u4f9d\u6b21\u538b\u5165\u6808 X\uff0c\u5f53\u70b9\u51fb\u540e\u9000\u6309\u94ae\u65f6\uff0c\u518d\u4f9d\u6b21\u4ece\u6808 X \u4e2d\u51fa\u6808\uff0c\u5e76\u5c06\u51fa\u6808\u7684\u6570\u636e\u4f9d\u6b21\u653e\u5165\u6808 Y\u3002\u5f53\u6211\u4eec\u70b9\u51fb\u524d\u8fdb\u6309\u94ae\u65f6\uff0c\u6211\u4eec\u4f9d\u6b21\u4ece\u6808 Y \u4e2d\u53d6\u51fa\u6570\u636e\uff0c\u653e\u5165\u6808 X \u4e2d\u3002\u5f53\u6808 X \u4e2d\u6ca1\u6709\u6570\u636e\u65f6\uff0c\u90a3\u5c31\u8bf4\u660e\u6ca1\u6709\u9875\u9762\u53ef\u4ee5\u7ee7\u7eed\u540e\u9000\u6d4f\u89c8\u4e86\u3002\u5f53\u6808 Y \u4e2d\u6ca1\u6709\u6570\u636e\uff0c\u90a3\u5c31\u8bf4\u660e\u6ca1\u6709\u9875\u9762\u53ef\u4ee5\u70b9\u51fb\u524d\u8fdb\u6309\u94ae\u6d4f\u89c8\u4e86\u3002</p>"},{"location":"read/jvm/jvm/","title":"\u300a\u6df1\u5165\u7406\u89e3java\u865a\u62df\u673a\u300b\u9605\u8bfb\u7b14\u8bb0","text":""},{"location":"read/jvm/jvm/#1","title":"1.\u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df","text":"<p>Java\u865a\u62df\u673a\u5728\u6267\u884cJava\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u628a\u5b83\u6240\u7ba1\u7406\u7684\u5185\u5b58\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u4e0d\u540c\u7684\u6570\u636e\u533a\u57df\uff0c\u8fd9\u4e9b\u533a\u57df\u90fd\u6709\u5404\u81ea\u7684\u7528\u9014\uff0c\u4ee5\u53ca\u521b\u5efa\u548c\u9500\u6bc1\u7684\u65f6\u95f4\uff0c\u6709\u7684\u533a\u57df\u968f\u7740\u865a\u62df\u673a\u8fdb\u7a0b\u7684\u542f\u52a8\u800c\u5b58\u5728\uff0c\u6709\u4e9b\u533a\u57df\u5219\u4f9d\u8d56\u7528\u6237\u7ebf\u7a0b\u7684\u542f\u52a8\u548c\u7ed3\u675f\u800c\u5efa\u7acb\u548c\u9500\u6bc1\u3002\u6839\u636e\u300aJava\u865a\u62df\u673a\u89c4\u8303\uff08Java SE 7\u7248\uff09\u300b\u7684\u89c4\u5b9a\uff0cJava\u865a\u62df\u673a\u6240\u7ba1\u7406\u7684\u5185\u5b58\u5c06\u4f1a\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p>![\u8fd0\u884c\u65f6\u6570\u636e\u533a\u57df](./</p>"},{"location":"read/jvm/jvm/#11","title":"1.1. \u7a0b\u5e8f\u8ba1\u6570\u5668","text":"<p>\u7a0b\u5e8f\u8ba1\u6570\u5668\uff08Program Counter Register\uff09\u662f\u4e00\u5757\u8f83\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5b83\u53ef\u4ee5\u770b\u4f5c\u662f\u5f53\u524d\u7ebf\u7a0b\u6240\u6267\u884c\u7684\u5b57\u8282\u7801\u7684\u884c\u53f7\u6307\u793a\u5668\u3002</p> <p>\u6b64\u5185\u5b58\u533a\u57df\u662f\u552f\u4e00\u4e00\u4e2a\u5728Java\u865a\u62df\u673a\u89c4\u8303\u4e2d\u6ca1\u6709\u89c4\u5b9a\u4efb\u4f55OutOfMemoryError\u60c5\u51b5\u7684\u533a\u57df\u3002</p>"},{"location":"read/jvm/jvm/#12-java","title":"1.2. Java\u865a\u62df\u673a\u6808","text":"<p>\u4e0e\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e00\u6837\uff0cJava\u865a\u62df\u673a\u6808\uff08Java Virtual Machine Stacks\uff09\u4e5f\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u4e0e\u7ebf\u7a0b\u76f8\u540c\u3002\u865a\u62df\u673a\u6808\u63cf\u8ff0\u7684\u662fJava\u65b9\u6cd5\u6267\u884c\u7684\u5185\u5b58\u6a21\u578b\uff1a\u6bcf\u4e2a\u65b9\u6cd5\u5728\u6267\u884c\u7684\u540c\u65f6\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\uff08Stack Frame[1]\uff09\u7528\u4e8e\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u52a8\u6001\u94fe\u63a5\u3001\u65b9\u6cd5\u51fa\u53e3\u7b49\u4fe1\u606f\u3002\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u4ece\u8c03\u7528\u76f4\u81f3\u6267\u884c\u5b8c\u6210\u7684\u8fc7\u7a0b\uff0c\u5c31\u5bf9\u5e94\u7740\u4e00\u4e2a\u6808\u5e27\u5728\u865a\u62df\u673a\u6808\u4e2d\u5165\u6808\u5230\u51fa\u6808\u7684\u8fc7\u7a0b\u3002</p> <p>\u5728Java\u865a\u62df\u673a\u89c4\u8303\u4e2d\uff0c\u5bf9\u8fd9\u4e2a\u533a\u57df\u89c4\u5b9a\u4e86\u4e24\u79cd\u5f02\u5e38\u72b6\u51b5\uff1a\u5982\u679c\u7ebf\u7a0b\u8bf7\u6c42\u7684\u6808\u6df1\u5ea6\u5927\u4e8e\u865a\u62df\u673a\u6240\u5141\u8bb8\u7684\u6df1\u5ea6\uff0c\u5c06\u629b\u51faStackOverflowError\u5f02\u5e38\uff1b\u5982\u679c\u865a\u62df\u673a\u6808\u53ef\u4ee5\u52a8\u6001\u6269\u5c55\uff08\u5f53\u524d\u5927\u90e8\u5206\u7684Java\u865a\u62df\u673a\u90fd\u53ef\u52a8\u6001\u6269\u5c55\uff0c\u53ea\u4e0d\u8fc7Java\u865a\u62df\u673a\u89c4\u8303\u4e2d\u4e5f\u5141\u8bb8\u56fa\u5b9a\u957f\u5ea6\u7684\u865a\u62df\u673a\u6808\uff09\uff0c\u5982\u679c\u6269\u5c55\u65f6\u65e0\u6cd5\u7533\u8bf7\u5230\u8db3\u591f\u7684\u5185\u5b58\uff0c\u5c31\u4f1a\u629b\u51faOutOfMemoryError\u5f02\u5e38\u3002</p>"},{"location":"read/jvm/jvm/#13","title":"1.3.\u672c\u5730\u65b9\u6cd5\u6808","text":"<p>\u672c\u5730\u65b9\u6cd5\u6808\uff08Native Method Stack\uff09\u4e0e\u865a\u62df\u673a\u6808\u6240\u53d1\u6325\u7684\u4f5c\u7528\u662f\u975e\u5e38\u76f8\u4f3c\u7684\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\u4e0d\u8fc7\u662f\u865a\u62df\u673a\u6808\u4e3a\u865a\u62df\u673a\u6267\u884cJava\u65b9\u6cd5\uff08\u4e5f\u5c31\u662f\u5b57\u8282\u7801\uff09\u670d\u52a1\uff0c\u800c\u672c\u5730\u65b9\u6cd5\u6808\u5219\u4e3a\u865a\u62df\u673a\u4f7f\u7528\u5230\u7684Native\u65b9\u6cd5\u670d\u52a1\u3002</p> <p>\u4e0e\u865a\u62df\u673a\u6808\u4e00\u6837\uff0c\u672c\u5730\u65b9\u6cd5\u6808\u533a\u57df\u4e5f\u4f1a\u629b\u51faStackOverflowError\u548cOutOfMemoryError\u5f02\u5e38\u3002</p>"},{"location":"read/jvm/jvm/#14java","title":"1.4.Java\u5806","text":"<p>\u5bf9\u4e8e\u5927\u591a\u6570\u5e94\u7528\u6765\u8bf4\uff0cJava\u5806\uff08Java Heap\uff09\u662fJava\u865a\u62df\u673a\u6240\u7ba1\u7406\u7684\u5185\u5b58\u4e2d\u6700\u5927\u7684\u4e00\u5757\u3002Java\u5806\u662f\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u5728\u865a\u62df\u673a\u542f\u52a8\u65f6\u521b\u5efa\u3002\u6b64\u5185\u5b58\u533a\u57df\u7684\u552f\u4e00\u76ee\u7684\u5c31\u662f\u5b58\u653e\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u5bf9\u8c61\u5b9e\u4f8b\u90fd\u5728\u8fd9\u91cc\u5206\u914d\u5185\u5b58\u3002</p>"},{"location":"read/jvm/jvm/#15","title":"1.5.\u65b9\u6cd5\u533a","text":"<p>\u65b9\u6cd5\u533a\uff08Method Area\uff09\u4e0eJava\u5806\u4e00\u6837\uff0c\u662f\u5404\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5185\u5b58\u533a\u57df\uff0c\u5b83\u7528\u4e8e\u5b58\u50a8\u5df2\u88ab\u865a\u62df\u673a\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u3001\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7b49\u6570\u636e\u3002</p>"},{"location":"read/jvm/jvm/#16","title":"1.6.\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60","text":"<p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff08Runtime Constant Pool\uff09\u662f\u65b9\u6cd5\u533a\u7684\u4e00\u90e8\u5206\u3002Class\u6587\u4ef6\u4e2d\u9664\u4e86\u6709\u7c7b\u7684\u7248\u672c\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u63a5\u53e3\u7b49\u63cf\u8ff0\u4fe1\u606f\u5916\uff0c\u8fd8\u6709\u4e00\u9879\u4fe1\u606f\u662f\u5e38\u91cf\u6c60\uff08Constant Pool Table\uff09\uff0c\u7528\u4e8e\u5b58\u653e\u7f16\u8bd1\u671f\u751f\u6210\u7684\u5404\u79cd\u5b57\u9762\u91cf\u548c\u7b26\u53f7\u5f15\u7528\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u5c06\u5728\u7c7b\u52a0\u8f7d\u540e\u8fdb\u5165\u65b9\u6cd5\u533a\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\u5b58\u653e\u3002</p>"},{"location":"read/jvm/jvm/#2","title":"2. \u865a\u62df\u673a\u5bf9\u8c61\u63a2\u79d8","text":""},{"location":"read/jvm/jvm/#21","title":"2.1. \u5bf9\u8c61\u7684\u521b\u5efa","text":"<p>\u5bf9\u8c61\u6240\u9700\u5185\u5b58\u7684\u5927\u5c0f\u5728\u7c7b\u52a0\u8f7d\u5b8c\u6210\u540e\u4fbf\u53ef\u4ee5\u5b8c\u5168\u786e\u5b9a\u3002</p>"},{"location":"read/jvm/jvm/#22","title":"2.2. \u5bf9\u8c61\u7684\u8bbf\u95ee\u5b9a\u4f4d","text":"<p>\u76ee\u524d\u4e3b\u6d41\u7684\u8bbf\u95ee\u65b9\u5f0f\u6709\u4f7f\u7528\u53e5\u67c4\u548c\u76f4\u63a5\u6307\u9488\u4e24\u79cd\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u53e5\u67c4\u8bbf\u95ee\u7684\u8bdd\uff0c\u90a3\u4e48Java\u5806\u4e2d\u5c06\u4f1a\u5212\u5206\u51fa\u4e00\u5757\u5185\u5b58\u6765\u4f5c\u4e3a\u53e5\u67c4\u6c60\uff0creference\u4e2d\u5b58\u50a8\u7684\u5c31\u662f\u5bf9\u8c61\u7684\u53e5\u67c4\u5730\u5740\uff0c\u800c\u53e5\u67c4\u4e2d\u5305\u542b\u4e86\u5bf9\u8c61\u5b9e\u4f8b\u6570\u636e\u4e0e\u7c7b\u578b\u6570\u636e\u5404\u81ea\u7684\u5177\u4f53\u5730\u5740\u4fe1\u606f\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u5982\u679c\u4f7f\u7528\u76f4\u63a5\u6307\u9488\u8bbf\u95ee\uff0c\u90a3\u4e48Java\u5806\u5bf9\u8c61\u7684\u5e03\u5c40\u4e2d\u5c31\u5fc5\u987b\u8003\u8651\u5982\u4f55\u653e\u7f6e\u8bbf\u95ee\u7c7b\u578b\u6570\u636e\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u800creference\u4e2d\u5b58\u50a8\u7684\u76f4\u63a5\u5c31\u662f\u5bf9\u8c61\u5730\u5740\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u8fd9\u4e24\u79cd\u5bf9\u8c61\u8bbf\u95ee\u65b9\u5f0f\u5404\u6709\u4f18\u52bf\uff0c\u4f7f\u7528\u53e5\u67c4\u6765\u8bbf\u95ee\u7684\u6700\u5927\u597d\u5904\u5c31\u662freference\u4e2d\u5b58\u50a8\u7684\u662f\u7a33\u5b9a\u7684\u53e5\u67c4\u5730\u5740\uff0c\u5728\u5bf9\u8c61\u88ab\u79fb\u52a8\uff08\u5783\u573e\u6536\u96c6\u65f6\u79fb\u52a8\u5bf9\u8c61\u662f\u975e\u5e38\u666e\u904d\u7684\u884c\u4e3a\uff09\u65f6\u53ea\u4f1a\u6539\u53d8\u53e5\u67c4\u4e2d\u7684\u5b9e\u4f8b\u6570\u636e\u6307\u9488\uff0c\u800creference\u672c\u8eab\u4e0d\u9700\u8981\u4fee\u6539\u3002</p> <p>\u4f7f\u7528\u76f4\u63a5\u6307\u9488\u8bbf\u95ee\u65b9\u5f0f\u7684\u6700\u5927\u597d\u5904\u5c31\u662f\u901f\u5ea6\u66f4\u5feb\uff0c\u5b83\u8282\u7701\u4e86\u4e00\u6b21\u6307\u9488\u5b9a\u4f4d\u7684\u65f6\u95f4\u5f00\u9500\uff0c\u7531\u4e8e\u5bf9\u8c61\u7684\u8bbf\u95ee\u5728Java\u4e2d\u975e\u5e38\u9891\u7e41\uff0c\u56e0\u6b64\u8fd9\u7c7b\u5f00\u9500\u79ef\u5c11\u6210\u591a\u540e\u4e5f\u662f\u4e00\u9879\u975e\u5e38\u53ef\u89c2\u7684\u6267\u884c\u6210\u672c\u3002\u5c31\u865a\u62df\u673aSun HotSpot\u800c\u8a00\uff0c\u5b83\u662f\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u8fdb\u884c\u5bf9\u8c61\u8bbf\u95ee\u7684\u3002</p>"},{"location":"read/jvm/jvm/#3","title":"3. \u5783\u573e\u6536\u96c6\u5668\u4e0e\u5185\u5b58\u5206\u914d\u7b56\u7565","text":""},{"location":"read/jvm/jvm/#31","title":"3.1.\u5bf9\u8c61\u5df2\u6b7b\u5417","text":"<ul> <li>\u5f15\u7528\u8ba1\u6570\u7b97\u6cd5</li> </ul> <p>\u5f88\u591a\u6559\u79d1\u4e66\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b\u7684\u7b97\u6cd5\u662f\u8fd9\u6837\u7684\uff1a\u7ed9\u5bf9\u8c61\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5f15\u7528\u8ba1\u6570\u5668\uff0c\u6bcf\u5f53\u6709\u4e00\u4e2a\u5730\u65b9\u5f15\u7528\u5b83\u65f6\uff0c\u8ba1\u6570\u5668\u503c\u5c31\u52a01\uff1b\u5f53\u5f15\u7528\u5931\u6548\u65f6\uff0c\u8ba1\u6570\u5668\u503c\u5c31\u51cf1\uff1b\u4efb\u4f55\u65f6\u523b\u8ba1\u6570\u5668\u4e3a0\u7684\u5bf9\u8c61\u5c31\u662f\u4e0d\u53ef\u80fd\u518d\u88ab\u4f7f\u7528\u7684\u3002</p> <p>\u5b83\u5f88\u96be\u89e3\u51b3\u5bf9\u8c61\u4e4b\u95f4\u76f8\u4e92\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898\u3002</p> <ul> <li>\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5</li> </ul> <p>\u8fd9\u4e2a\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\u5c31\u662f\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u79f0\u4e3a\u201cGC Roots\u201d\u7684\u5bf9\u8c61\u4f5c\u4e3a\u8d77\u59cb\u70b9\uff0c\u4ece\u8fd9\u4e9b\u8282\u70b9\u5f00\u59cb\u5411\u4e0b\u641c\u7d22\uff0c\u641c\u7d22\u6240\u8d70\u8fc7\u7684\u8def\u5f84\u79f0\u4e3a\u5f15\u7528\u94fe\uff08Reference Chain\uff09\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u5230GC Roots\u6ca1\u6709\u4efb\u4f55\u5f15\u7528\u94fe\u76f8\u8fde\uff08\u7528\u56fe\u8bba\u7684\u8bdd\u6765\u8bf4\uff0c\u5c31\u662f\u4eceGC Roots\u5230\u8fd9\u4e2a\u5bf9\u8c61\u4e0d\u53ef\u8fbe\uff09\u65f6\uff0c\u5219\u8bc1\u660e\u6b64\u5bf9\u8c61\u662f\u4e0d\u53ef\u7528\u7684\u3002</p> <p>\u5728Java\u8bed\u8a00\u4e2d\uff0c\u53ef\u4f5c\u4e3aGC Roots\u7684\u5bf9\u8c61\u5305\u62ec\u4e0b\u9762\u51e0\u79cd\uff1a</p> <ul> <li> <p>\u865a\u62df\u673a\u6808\uff08\u6808\u5e27\u4e2d\u7684\u672c\u5730\u53d8\u91cf\u8868\uff09\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u65b9\u6cd5\u533a\u4e2d\u7c7b\u9759\u6001\u5c5e\u6027\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u65b9\u6cd5\u533a\u4e2d\u5e38\u91cf\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u672c\u5730\u65b9\u6cd5\u6808\u4e2dJNI\uff08\u5373\u4e00\u822c\u8bf4\u7684Native\u65b9\u6cd5\uff09\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> </li> </ul>"},{"location":"read/jvm/jvm/#32","title":"3.2. \u751f\u5b58\u8fd8\u662f\u6b7b\u4ea1","text":"<p>\u5373\u4f7f\u5728\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u4e2d\u4e0d\u53ef\u8fbe\u7684\u5bf9\u8c61\uff0c\u4e5f\u5e76\u975e\u662f\u201c\u975e\u6b7b\u4e0d\u53ef\u201d\u7684\uff0c\u8fd9\u65f6\u5019\u5b83\u4eec\u6682\u65f6\u5904\u4e8e\u201c\u7f13\u5211\u201d\u9636\u6bb5\uff0c\u8981\u771f\u6b63\u5ba3\u544a\u4e00\u4e2a\u5bf9\u8c61\u6b7b\u4ea1\uff0c\u81f3\u5c11\u8981\u7ecf\u5386\u4e24\u6b21\u6807\u8bb0\u8fc7\u7a0b\uff1a\u5982\u679c\u5bf9\u8c61\u5728\u8fdb\u884c\u53ef\u8fbe\u6027\u5206\u6790\u540e\u53d1\u73b0\u6ca1\u6709\u4e0eGC Roots\u76f8\u8fde\u63a5\u7684\u5f15\u7528\u94fe\uff0c\u90a3\u5b83\u5c06\u4f1a\u88ab\u7b2c\u4e00\u6b21\u6807\u8bb0\u5e76\u4e14\u8fdb\u884c\u4e00\u6b21\u7b5b\u9009\uff0c\u7b5b\u9009\u7684\u6761\u4ef6\u662f\u6b64\u5bf9\u8c61\u662f\u5426\u6709\u5fc5\u8981\u6267\u884cfinalize\uff08\uff09\u65b9\u6cd5\u3002\u5f53\u5bf9\u8c61\u6ca1\u6709\u8986\u76d6finalize\uff08\uff09\u65b9\u6cd5\uff0c\u6216\u8005finalize\uff08\uff09\u65b9\u6cd5\u5df2\u7ecf\u88ab\u865a\u62df\u673a\u8c03\u7528\u8fc7\uff0c\u865a\u62df\u673a\u5c06\u8fd9\u4e24\u79cd\u60c5\u51b5\u90fd\u89c6\u4e3a\u201c\u6ca1\u6709\u5fc5\u8981\u6267\u884c\u201d\u3002</p> <p>\u5982\u679c\u8fd9\u4e2a\u5bf9\u8c61\u88ab\u5224\u5b9a\u4e3a\u6709\u5fc5\u8981\u6267\u884cfinalize\uff08\uff09\u65b9\u6cd5\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5bf9\u8c61\u5c06\u4f1a\u653e\u7f6e\u5728\u4e00\u4e2a\u53eb\u505aF-Queue\u7684\u961f\u5217\u4e4b\u4e2d\uff0c\u5e76\u5728\u7a0d\u540e\u7531\u4e00\u4e2a\u7531\u865a\u62df\u673a\u81ea\u52a8\u5efa\u7acb\u7684\u3001\u4f4e\u4f18\u5148\u7ea7\u7684Finalizer\u7ebf\u7a0b\u53bb\u6267\u884c\u5b83\u3002\u8fd9\u91cc\u6240\u8c13\u7684\u201c\u6267\u884c\u201d\u662f\u6307\u865a\u62df\u673a\u4f1a\u89e6\u53d1\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u4f46\u5e76\u4e0d\u627f\u8bfa\u4f1a\u7b49\u5f85\u5b83\u8fd0\u884c\u7ed3\u675f\uff0c\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\uff0c\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u5728finalize\uff08\uff09\u65b9\u6cd5\u4e2d\u6267\u884c\u7f13\u6162\uff0c\u6216\u8005\u53d1\u751f\u4e86\u6b7b\u5faa\u73af\uff08\u66f4\u6781\u7aef\u7684\u60c5\u51b5\uff09\uff0c\u5c06\u5f88\u53ef\u80fd\u4f1a\u5bfc\u81f4F-Queue\u961f\u5217\u4e2d\u5176\u4ed6\u5bf9\u8c61\u6c38\u4e45\u5904\u4e8e\u7b49\u5f85\uff0c\u751a\u81f3\u5bfc\u81f4\u6574\u4e2a\u5185\u5b58\u56de\u6536\u7cfb\u7edf\u5d29\u6e83\u3002finalize\uff08\uff09\u65b9\u6cd5\u662f\u5bf9\u8c61\u9003\u8131\u6b7b\u4ea1\u547d\u8fd0\u7684\u6700\u540e\u4e00\u6b21\u673a\u4f1a\uff0c\u7a0d\u540eGC\u5c06\u5bf9F-Queue\u4e2d\u7684\u5bf9\u8c61\u8fdb\u884c\u7b2c\u4e8c\u6b21\u5c0f\u89c4\u6a21\u7684\u6807\u8bb0\uff0c\u5982\u679c\u5bf9\u8c61\u8981\u5728finalize\uff08\uff09\u4e2d\u6210\u529f\u62ef\u6551\u81ea\u5df1\u2014\u2014\u53ea\u8981\u91cd\u65b0\u4e0e\u5f15\u7528\u94fe\u4e0a\u7684\u4efb\u4f55\u4e00\u4e2a\u5bf9\u8c61\u5efa\u7acb\u5173\u8054\u5373\u53ef\uff0c\u8b6c\u5982\u628a\u81ea\u5df1\uff08this\u5173\u952e\u5b57\uff09\u8d4b\u503c\u7ed9\u67d0\u4e2a\u7c7b\u53d8\u91cf\u6216\u8005\u5bf9\u8c61\u7684\u6210\u5458\u53d8\u91cf\uff0c\u90a3\u5728\u7b2c\u4e8c\u6b21\u6807\u8bb0\u65f6\u5b83\u5c06\u88ab\u79fb\u9664\u51fa\u201c\u5373\u5c06\u56de\u6536\u201d\u7684\u96c6\u5408\uff1b\u5982\u679c\u5bf9\u8c61\u8fd9\u65f6\u5019\u8fd8\u6ca1\u6709\u9003\u8131\uff0c\u90a3\u57fa\u672c\u4e0a\u5b83\u5c31\u771f\u7684\u88ab\u56de\u6536\u4e86\u3002</p> <p>\u5efa\u8bae\u5927\u5bb6\u5c3d\u91cf\u907f\u514d\u4f7f\u7528\u5b83\uff0c\u56e0\u4e3a\u5b83\u4e0d\u662fC/C++\u4e2d\u7684\u6790\u6784\u51fd\u6570\uff0c\u800c\u662fJava\u521a\u8bde\u751f\u65f6\u4e3a\u4e86\u4f7fC/C++\u7a0b\u5e8f\u5458\u66f4\u5bb9\u6613\u63a5\u53d7\u5b83\u6240\u505a\u51fa\u7684\u4e00\u4e2a\u59a5\u534f\u3002\u5b83\u7684\u8fd0\u884c\u4ee3\u4ef7\u9ad8\u6602\uff0c\u4e0d\u786e\u5b9a\u6027\u5927\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u5404\u4e2a\u5bf9\u8c61\u7684\u8c03\u7528\u987a\u5e8f\u3002</p>"},{"location":"read/jvm/jvm/#33","title":"3.3.\u65e0\u7528\u7684\u7c7b","text":"<p>\u7c7b\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e0b\u97623\u4e2a\u6761\u4ef6\u624d\u80fd\u7b97\u662f\u201c\u65e0\u7528\u7684\u7c7b\u201d\uff1a</p> <ul> <li> <p>\u8be5\u7c7b\u6240\u6709\u7684\u5b9e\u4f8b\u90fd\u5df2\u7ecf\u88ab\u56de\u6536\uff0c\u4e5f\u5c31\u662fJava\u5806\u4e2d\u4e0d\u5b58\u5728\u8be5\u7c7b\u7684\u4efb\u4f55\u5b9e\u4f8b\u3002</p> </li> <li> <p>\u52a0\u8f7d\u8be5\u7c7b\u7684ClassLoader\u5df2\u7ecf\u88ab\u56de\u6536\u3002</p> </li> <li> <p>\u8be5\u7c7b\u5bf9\u5e94\u7684java.lang.Class\u5bf9\u8c61\u6ca1\u6709\u5728\u4efb\u4f55\u5730\u65b9\u88ab\u5f15\u7528\uff0c\u65e0\u6cd5\u5728\u4efb\u4f55\u5730\u65b9\u901a\u8fc7\u53cd\u5c04\u8bbf\u95ee\u8be5\u7c7b\u7684\u65b9\u6cd5\u3002</p> </li> </ul>"},{"location":"read/jvm/jvm/#34","title":"3.4.\u5783\u573e\u6536\u96c6\u7b97\u6cd5","text":"<p>\u5f53\u524d\u5546\u4e1a\u865a\u62df\u673a\u7684\u5783\u573e\u6536\u96c6\u90fd\u91c7\u7528\u201c\u5206\u4ee3\u6536\u96c6\u201d\uff08Generational Collection\uff09\u7b97\u6cd5\uff0c\u8fd9\u79cd\u7b97\u6cd5\u5e76\u6ca1\u6709\u4ec0\u4e48\u65b0\u7684\u601d\u60f3\uff0c\u53ea\u662f\u6839\u636e\u5bf9\u8c61\u5b58\u6d3b\u5468\u671f\u7684\u4e0d\u540c\u5c06\u5185\u5b58\u5212\u5206\u4e3a\u51e0\u5757\u3002\u4e00\u822c\u662f\u628aJava\u5806\u5206\u4e3a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6839\u636e\u5404\u4e2a\u5e74\u4ee3\u7684\u7279\u70b9\u91c7\u7528\u6700\u9002\u5f53\u7684\u6536\u96c6\u7b97\u6cd5\u3002\u5728\u65b0\u751f\u4ee3\u4e2d\uff0c\u6bcf\u6b21\u5783\u573e\u6536\u96c6\u65f6\u90fd\u53d1\u73b0\u6709\u5927\u6279\u5bf9\u8c61\u6b7b\u53bb\uff0c\u53ea\u6709\u5c11\u91cf\u5b58\u6d3b\uff0c\u90a3\u5c31\u9009\u7528\u590d\u5236\u7b97\u6cd5\uff0c\u53ea\u9700\u8981\u4ed8\u51fa\u5c11\u91cf\u5b58\u6d3b\u5bf9\u8c61\u7684\u590d\u5236\u6210\u672c\u5c31\u53ef\u4ee5\u5b8c\u6210\u6536\u96c6\u3002\u800c\u8001\u5e74\u4ee3\u4e2d\u56e0\u4e3a\u5bf9\u8c61\u5b58\u6d3b\u7387\u9ad8\u3001\u6ca1\u6709\u989d\u5916\u7a7a\u95f4\u5bf9\u5b83\u8fdb\u884c\u5206\u914d\u62c5\u4fdd\uff0c\u5c31\u5fc5\u987b\u4f7f\u7528\u201c\u6807\u8bb0\u2014\u6e05\u7406\u201d\u6216\u8005\u201c\u6807\u8bb0\u2014\u6574\u7406\u201d\u7b97\u6cd5\u6765\u8fdb\u884c\u56de\u6536\u3002</p>"},{"location":"read/jvm/jvm/#341-","title":"3.4.1.\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5","text":"<p>\u5982\u540c\u5b83\u7684\u540d\u5b57\u4e00\u6837\uff0c\u7b97\u6cd5\u5206\u4e3a\u201c\u6807\u8bb0\u201d\u548c\u201c\u6e05\u9664\u201d\u4e24\u4e2a\u9636\u6bb5\uff1a\u9996\u5148\u6807\u8bb0\u51fa\u6240\u6709\u9700\u8981\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u5728\u6807\u8bb0\u5b8c\u6210\u540e\u7edf\u4e00\u56de\u6536\u6240\u6709\u88ab\u6807\u8bb0\u7684\u5bf9\u8c61\u3002\u5b83\u7684\u4e3b\u8981\u4e0d\u8db3\u6709\u4e24\u4e2a\uff1a\u4e00\u4e2a\u662f\u6548\u7387\u95ee\u9898\uff0c\u6807\u8bb0\u548c\u6e05\u9664\u4e24\u4e2a\u8fc7\u7a0b\u7684\u6548\u7387\u90fd\u4e0d\u9ad8\uff1b\u53e6\u4e00\u4e2a\u662f\u7a7a\u95f4\u95ee\u9898\uff0c\u6807\u8bb0\u6e05\u9664\u4e4b\u540e\u4f1a\u4ea7\u751f\u5927\u91cf\u4e0d\u8fde\u7eed\u7684\u5185\u5b58\u788e\u7247\uff0c\u7a7a\u95f4\u788e\u7247\u592a\u591a\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ee5\u540e\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u9700\u8981\u5206\u914d\u8f83\u5927\u5bf9\u8c61\u65f6\uff0c\u65e0\u6cd5\u627e\u5230\u8db3\u591f\u7684\u8fde\u7eed\u5185\u5b58\u800c\u4e0d\u5f97\u4e0d\u63d0\u524d\u89e6\u53d1\u53e6\u4e00\u6b21\u5783\u573e\u6536\u96c6\u52a8\u4f5c\u3002\u6807\u8bb0\u2014\u6e05\u9664\u7b97\u6cd5\u7684\u6267\u884c\u8fc7\u7a0b\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"read/jvm/jvm/#342","title":"3.4.2.\u590d\u5236\u7b97\u6cd5","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u6548\u7387\u95ee\u9898\uff0c\u4e00\u79cd\u79f0\u4e3a\u201c\u590d\u5236\u201d\uff08Copying\uff09\u7684\u6536\u96c6\u7b97\u6cd5\u51fa\u73b0\u4e86\uff0c\u5b83\u5c06\u53ef\u7528\u5185\u5b58\u6309\u5bb9\u91cf\u5212\u5206\u4e3a\u5927\u5c0f\u76f8\u7b49\u7684\u4e24\u5757\uff0c\u6bcf\u6b21\u53ea\u4f7f\u7528\u5176\u4e2d\u7684\u4e00\u5757\u3002\u5f53\u8fd9\u4e00\u5757\u7684\u5185\u5b58\u7528\u5b8c\u4e86\uff0c\u5c31\u5c06\u8fd8\u5b58\u6d3b\u7740\u7684\u5bf9\u8c61\u590d\u5236\u5230\u53e6\u5916\u4e00\u5757\u4e0a\u9762\uff0c\u7136\u540e\u518d\u628a\u5df2\u4f7f\u7528\u8fc7\u7684\u5185\u5b58\u7a7a\u95f4\u4e00\u6b21\u6e05\u7406\u6389\u3002\u8fd9\u6837\u4f7f\u5f97\u6bcf\u6b21\u90fd\u662f\u5bf9\u6574\u4e2a\u534a\u533a\u8fdb\u884c\u5185\u5b58\u56de\u6536\uff0c\u5185\u5b58\u5206\u914d\u65f6\u4e5f\u5c31\u4e0d\u7528\u8003\u8651\u5185\u5b58\u788e\u7247\u7b49\u590d\u6742\u60c5\u51b5\uff0c\u53ea\u8981\u79fb\u52a8\u5806\u9876\u6307\u9488\uff0c\u6309\u987a\u5e8f\u5206\u914d\u5185\u5b58\u5373\u53ef\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u8fd0\u884c\u9ad8\u6548\u3002\u53ea\u662f\u8fd9\u79cd\u7b97\u6cd5\u7684\u4ee3\u4ef7\u662f\u5c06\u5185\u5b58\u7f29\u5c0f\u4e3a\u4e86\u539f\u6765\u7684\u4e00\u534a\uff0c\u672a\u514d\u592a\u9ad8\u4e86\u4e00\u70b9\u3002\u590d\u5236\u7b97\u6cd5\u7684\u6267\u884c\u8fc7\u7a0b\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u73b0\u5728\u7684\u5546\u4e1a\u865a\u62df\u673a\u90fd\u91c7\u7528\u8fd9\u79cd\u6536\u96c6\u7b97\u6cd5\u6765\u56de\u6536\u65b0\u751f\u4ee3\uff0cIBM\u516c\u53f8\u7684\u4e13\u95e8\u7814\u7a76\u8868\u660e\uff0c\u65b0\u751f\u4ee3\u4e2d\u7684\u5bf9\u8c6198%\u662f\u201c\u671d\u751f\u5915\u6b7b\u201d\u7684\uff0c\u6240\u4ee5\u5e76\u4e0d\u9700\u8981\u6309\u71671:1\u7684\u6bd4\u4f8b\u6765\u5212\u5206\u5185\u5b58\u7a7a\u95f4\uff0c\u800c\u662f\u5c06\u5185\u5b58\u5206\u4e3a\u4e00\u5757\u8f83\u5927\u7684Eden\u7a7a\u95f4\u548c\u4e24\u5757\u8f83\u5c0f\u7684Survivor\u7a7a\u95f4\uff0c\u6bcf\u6b21\u4f7f\u7528Eden\u548c\u5176\u4e2d\u4e00\u5757Survivor\u3002\u5f53\u56de\u6536\u65f6\uff0c\u5c06Eden\u548cSurvivor\u4e2d\u8fd8\u5b58\u6d3b\u7740\u7684\u5bf9\u8c61\u4e00\u6b21\u6027\u5730\u590d\u5236\u5230\u53e6\u5916\u4e00\u5757Survivor\u7a7a\u95f4\u4e0a\uff0c\u6700\u540e\u6e05\u7406\u6389Eden\u548c\u521a\u624d\u7528\u8fc7\u7684Survivor\u7a7a\u95f4\u3002HotSpot\u865a\u62df\u673a\u9ed8\u8ba4Eden\u548cSurvivor\u7684\u5927\u5c0f\u6bd4\u4f8b\u662f8:1\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u65b0\u751f\u4ee3\u4e2d\u53ef\u7528\u5185\u5b58\u7a7a\u95f4\u4e3a\u6574\u4e2a\u65b0\u751f\u4ee3\u5bb9\u91cf\u768490%\uff0880%+10%\uff09\uff0c\u53ea\u670910%\u7684\u5185\u5b58\u4f1a\u88ab\u201c\u6d6a\u8d39\u201d\u3002\u5f53\u7136\uff0c98%\u7684\u5bf9\u8c61\u53ef\u56de\u6536\u53ea\u662f\u4e00\u822c\u573a\u666f\u4e0b\u7684\u6570\u636e\uff0c\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u4fdd\u8bc1\u6bcf\u6b21\u56de\u6536\u90fd\u53ea\u6709\u4e0d\u591a\u4e8e10%\u7684\u5bf9\u8c61\u5b58\u6d3b\uff0c\u5f53Survivor\u7a7a\u95f4\u4e0d\u591f\u7528\u65f6\uff0c\u9700\u8981\u4f9d\u8d56\u5176\u4ed6\u5185\u5b58\uff08\u8fd9\u91cc\u6307\u8001\u5e74\u4ee3\uff09\u8fdb\u884c\u5206\u914d\u62c5\u4fdd\uff08Handle Promotion\uff09</p> <p>\u5206\u914d\u62c5\u4fdd:\u5982\u679c\u53e6\u5916\u4e00\u5757Survivor\u7a7a\u95f4\u6ca1\u6709\u8db3\u591f\u7a7a\u95f4\u5b58\u653e\u4e0a\u4e00\u6b21\u65b0\u751f\u4ee3\u6536\u96c6\u4e0b\u6765\u7684\u5b58\u6d3b\u5bf9\u8c61\u65f6\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u5c06\u76f4\u63a5\u901a\u8fc7\u5206\u914d\u62c5\u4fdd\u673a\u5236\u8fdb\u5165\u8001\u5e74\u4ee3\u3002</p>"},{"location":"read/jvm/jvm/#343-","title":"3.4.3.\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5","text":"<p>\u6807\u8bb0\u8fc7\u7a0b\u4ecd\u7136\u4e0e\u201c\u6807\u8bb0-\u6e05\u9664\u201d\u7b97\u6cd5\u4e00\u6837\uff0c\u4f46\u540e\u7eed\u6b65\u9aa4\u4e0d\u662f\u76f4\u63a5\u5bf9\u53ef\u56de\u6536\u5bf9\u8c61\u8fdb\u884c\u6e05\u7406\uff0c\u800c\u662f\u8ba9\u6240\u6709\u5b58\u6d3b\u7684\u5bf9\u8c61\u90fd\u5411\u4e00\u7aef\u79fb\u52a8\uff0c\u7136\u540e\u76f4\u63a5\u6e05\u7406\u6389\u7aef\u8fb9\u754c\u4ee5\u5916\u7684\u5185\u5b58\uff0c\u201c\u6807\u8bb0-\u6574\u7406\u201d\u7b97\u6cd5\u7684\u793a\u610f\u56fe\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"read/jvm/jvm/#35","title":"3.5.\u5185\u5b58\u5206\u914d\u89c4\u5219","text":""},{"location":"read/jvm/jvm/#351eden","title":"3.5.1.\u5bf9\u8c61\u4f18\u5148\u5728Eden\u5206\u914d","text":"<p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5bf9\u8c61\u5728\u65b0\u751f\u4ee3Eden\u533a\u4e2d\u5206\u914d\u3002\u5f53Eden\u533a\u6ca1\u6709\u8db3\u591f\u7a7a\u95f4\u8fdb\u884c\u5206\u914d\u65f6\uff0c\u865a\u62df\u673a\u5c06\u53d1\u8d77\u4e00\u6b21Minor GC\u3002</p> <ul> <li>\u65b0\u751f\u4ee3GC\uff08Minor GC\uff09</li> </ul> <p>\u6307\u53d1\u751f\u5728\u65b0\u751f\u4ee3\u7684\u5783\u573e\u6536\u96c6\u52a8\u4f5c\uff0c\u56e0\u4e3aJava\u5bf9\u8c61\u5927\u591a\u90fd\u5177\u5907\u671d\u751f\u5915\u706d\u7684\u7279\u6027\uff0c\u6240\u4ee5Minor GC\u975e\u5e38\u9891\u7e41\uff0c\u4e00\u822c\u56de\u6536\u901f\u5ea6\u4e5f\u6bd4\u8f83\u5feb\u3002</p> <ul> <li>\u8001\u5e74\u4ee3GC\uff08Major GC/Full GC\uff09</li> </ul> <p>\u6307\u53d1\u751f\u5728\u8001\u5e74\u4ee3\u7684GC\uff0c\u51fa\u73b0\u4e86Major GC\uff0c\u7ecf\u5e38\u4f1a\u4f34\u968f\u81f3\u5c11\u4e00\u6b21\u7684Minor GC\u3002Major GC\u7684\u901f\u5ea6\u4e00\u822c\u4f1a\u6bd4Minor GC\u616210\u500d\u4ee5\u4e0a\u3002 </p>"},{"location":"read/jvm/jvm/#352","title":"3.5.2.\u5927\u5bf9\u8c61\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3","text":"<p>\u6240\u8c13\u7684\u5927\u5bf9\u8c61\u662f\u6307\uff0c\u9700\u8981\u5927\u91cf\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7684Java\u5bf9\u8c61\uff0c\u6700\u5178\u578b\u7684\u5927\u5bf9\u8c61\u5c31\u662f\u90a3\u79cd\u5f88\u957f\u7684\u5b57\u7b26\u4e32\u4ee5\u53ca\u6570\u7ec4\u3002\u5927\u5bf9\u8c61\u5bf9\u865a\u62df\u673a\u7684\u5185\u5b58\u5206\u914d\u6765\u8bf4\u5c31\u662f\u4e00\u4e2a\u574f\u6d88\u606f\uff0c\u7ecf\u5e38\u51fa\u73b0\u5927\u5bf9\u8c61\u5bb9\u6613\u5bfc\u81f4\u5185\u5b58\u8fd8\u6709\u4e0d\u5c11\u7a7a\u95f4\u65f6\u5c31\u63d0\u524d\u89e6\u53d1\u5783\u573e\u6536\u96c6\u4ee5\u83b7\u53d6\u8db3\u591f\u7684\u8fde\u7eed\u7a7a\u95f4\u6765\u201c\u5b89\u7f6e\u201d\u5b83\u4eec\u3002</p>"},{"location":"read/jvm/jvm/#353","title":"3.5.3.\u957f\u671f\u5b58\u6d3b\u7684\u5bf9\u8c61\u5c06\u8fdb\u5165\u8001\u5e74\u4ee3","text":"<p>\u65e2\u7136\u865a\u62df\u673a\u91c7\u7528\u4e86\u5206\u4ee3\u6536\u96c6\u7684\u601d\u60f3\u6765\u7ba1\u7406\u5185\u5b58\uff0c\u90a3\u4e48\u5185\u5b58\u56de\u6536\u65f6\u5c31\u5fc5\u987b\u80fd\u8bc6\u522b\u54ea\u4e9b\u5bf9\u8c61\u5e94\u653e\u5728\u65b0\u751f\u4ee3\uff0c\u54ea\u4e9b\u5bf9\u8c61\u5e94\u653e\u5728\u8001\u5e74\u4ee3\u4e2d\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u70b9\uff0c\u865a\u62df\u673a\u7ed9\u6bcf\u4e2a\u5bf9\u8c61\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5bf9\u8c61\u5e74\u9f84\uff08Age\uff09\u8ba1\u6570\u5668\u3002\u5982\u679c\u5bf9\u8c61\u5728Eden\u51fa\u751f\u5e76\u7ecf\u8fc7\u7b2c\u4e00\u6b21Minor GC\u540e\u4ecd\u7136\u5b58\u6d3b\uff0c\u5e76\u4e14\u80fd\u88abSurvivor\u5bb9\u7eb3\u7684\u8bdd\uff0c\u5c06\u88ab\u79fb\u52a8\u5230Survivor\u7a7a\u95f4\u4e2d\uff0c\u5e76\u4e14\u5bf9\u8c61\u5e74\u9f84\u8bbe\u4e3a1\u3002\u5bf9\u8c61\u5728Survivor\u533a\u4e2d\u6bcf\u201c\u71ac\u8fc7\u201d\u4e00\u6b21Minor GC\uff0c\u5e74\u9f84\u5c31\u589e\u52a01\u5c81\uff0c\u5f53\u5b83\u7684\u5e74\u9f84\u589e\u52a0\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff08\u9ed8\u8ba4\u4e3a15\u5c81\uff09\uff0c\u5c31\u5c06\u4f1a\u88ab\u664b\u5347\u5230\u8001\u5e74\u4ee3\u4e2d\u3002</p>"},{"location":"read/jvm/jvm/#354","title":"3.5.4.\u52a8\u6001\u5bf9\u8c61\u5e74\u9f84\u5224\u5b9a","text":"<p>\u4e3a\u4e86\u80fd\u66f4\u597d\u5730\u9002\u5e94\u4e0d\u540c\u7a0b\u5e8f\u7684\u5185\u5b58\u72b6\u51b5\uff0c\u865a\u62df\u673a\u5e76\u4e0d\u662f\u6c38\u8fdc\u5730\u8981\u6c42\u5bf9\u8c61\u7684\u5e74\u9f84\u5fc5\u987b\u8fbe\u5230\u4e86MaxTenuringThreshold\u624d\u80fd\u664b\u5347\u8001\u5e74\u4ee3\uff0c\u5982\u679c\u5728Survivor\u7a7a\u95f4\u4e2d\u76f8\u540c\u5e74\u9f84\u6240\u6709\u5bf9\u8c61\u5927\u5c0f\u7684\u603b\u548c\u5927\u4e8eSurvivor\u7a7a\u95f4\u7684\u4e00\u534a\uff0c\u5e74\u9f84\u5927\u4e8e\u6216\u7b49\u4e8e\u8be5\u5e74\u9f84\u7684\u5bf9\u8c61\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3\uff0c\u65e0\u987b\u7b49\u5230MaxTenuringThreshold\u4e2d\u8981\u6c42\u7684\u5e74\u9f84\u3002</p>"},{"location":"read/jvm/jvm/#355","title":"3.5.5.\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd","text":"<p>\u5728\u53d1\u751fMinor GC\u4e4b\u524d\uff0c\u865a\u62df\u673a\u4f1a\u5148\u68c0\u67e5\u8001\u5e74\u4ee3\u6700\u5927\u53ef\u7528\u7684\u8fde\u7eed\u7a7a\u95f4\u662f\u5426\u5927\u4e8e\u65b0\u751f\u4ee3\u6240\u6709\u5bf9\u8c61\u603b\u7a7a\u95f4\uff0c\u5982\u679c\u8fd9\u4e2a\u6761\u4ef6\u6210\u7acb\uff0c\u90a3\u4e48Minor GC\u53ef\u4ee5\u786e\u4fdd\u662f\u5b89\u5168\u7684\u3002\u5982\u679c\u4e0d\u6210\u7acb\uff0c\u5219\u865a\u62df\u673a\u4f1a\u67e5\u770bHandlePromotionFailure\u8bbe\u7f6e\u503c\u662f\u5426\u5141\u8bb8\u62c5\u4fdd\u5931\u8d25\u3002\u5982\u679c\u5141\u8bb8\uff0c\u90a3\u4e48\u4f1a\u7ee7\u7eed\u68c0\u67e5\u8001\u5e74\u4ee3\u6700\u5927\u53ef\u7528\u7684\u8fde\u7eed\u7a7a\u95f4\u662f\u5426\u5927\u4e8e\u5386\u6b21\u664b\u5347\u5230\u8001\u5e74\u4ee3\u5bf9\u8c61\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5c06\u5c1d\u8bd5\u7740\u8fdb\u884c\u4e00\u6b21Minor GC\uff0c\u5c3d\u7ba1\u8fd9\u6b21Minor GC\u662f\u6709\u98ce\u9669\u7684\uff1b\u5982\u679c\u5c0f\u4e8e\uff0c\u6216\u8005HandlePromotionFailure\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u5192\u9669\uff0c\u90a3\u8fd9\u65f6\u4e5f\u8981\u6539\u4e3a\u8fdb\u884c\u4e00\u6b21Full GC\u3002</p>"},{"location":"read/jvm/jvm/#4","title":"4.\u865a\u62df\u673a\u7c7b\u52a0\u8f7d\u673a\u5236","text":"<p>\u865a\u62df\u673a\u628a\u63cf\u8ff0\u7c7b\u7684\u6570\u636e\u4eceClass\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u5e76\u5bf9\u6570\u636e\u8fdb\u884c\u6821\u9a8c\u3001\u8f6c\u6362\u89e3\u6790\u548c\u521d\u59cb\u5316\uff0c\u6700\u7ec8\u5f62\u6210\u53ef\u4ee5\u88ab\u865a\u62df\u673a\u76f4\u63a5\u4f7f\u7528\u7684Java\u7c7b\u578b\uff0c\u8fd9\u5c31\u662f\u865a\u62df\u673a\u7684\u7c7b\u52a0\u8f7d\u673a\u5236\u3002</p>"},{"location":"read/jvm/jvm/#41","title":"4.1.\u7c7b\u7684\u751f\u547d\u5468\u671f","text":"<p>\u7c7b\u4ece\u88ab\u52a0\u8f7d\u5230\u865a\u62df\u673a\u5185\u5b58\u4e2d\u5f00\u59cb\uff0c\u5230\u5378\u8f7d\u51fa\u5185\u5b58\u4e3a\u6b62\uff0c\u5b83\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u5305\u62ec\uff1a\u52a0\u8f7d\uff08Loading\uff09\u3001\u9a8c\u8bc1\uff08Verification\uff09\u3001\u51c6\u5907\uff08Preparation\uff09\u3001\u89e3\u6790\uff08Resolution\uff09\u3001\u521d\u59cb\u5316\uff08Initialization\uff09\u3001\u4f7f\u7528\uff08Using\uff09\u548c\u5378\u8f7d\uff08Unloading\uff097\u4e2a\u9636\u6bb5\u3002\u5176\u4e2d\u9a8c\u8bc1\u3001\u51c6\u5907\u3001\u89e3\u67903\u4e2a\u90e8\u5206\u7edf\u79f0\u4e3a\u8fde\u63a5\uff08Linking\uff09\uff0c\u8fd97\u4e2a\u9636\u6bb5\u7684\u53d1\u751f\u987a\u5e8f\u5982\u56fe\u6240\u793a\u3002 </p> <p></p>"},{"location":"read/jvm/jvm/#42","title":"4.2.\u7c7b\u52a0\u8f7d\u5668","text":"<p>\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u7c7b\uff0c\u90fd\u9700\u8981\u7531\u52a0\u8f7d\u5b83\u7684\u7c7b\u52a0\u8f7d\u5668\u548c\u8fd9\u4e2a\u7c7b\u672c\u8eab\u4e00\u540c\u786e\u7acb\u5176\u5728Java\u865a\u62df\u673a\u4e2d\u7684\u552f\u4e00\u6027\uff0c\u6bcf\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\uff0c\u90fd\u62e5\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u7c7b\u540d\u79f0\u7a7a\u95f4\u3002\u8fd9\u53e5\u8bdd\u53ef\u4ee5\u8868\u8fbe\u5f97\u66f4\u901a\u4fd7\u4e00\u4e9b\uff1a\u6bd4\u8f83\u4e24\u4e2a\u7c7b\u662f\u5426\u201c\u76f8\u7b49\u201d\uff0c\u53ea\u6709\u5728\u8fd9\u4e24\u4e2a\u7c7b\u662f\u7531\u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u524d\u63d0\u4e0b\u624d\u6709\u610f\u4e49\uff0c\u5426\u5219\uff0c\u5373\u4f7f\u8fd9\u4e24\u4e2a\u7c7b\u6765\u6e90\u4e8e\u540c\u4e00\u4e2aClass\u6587\u4ef6\uff0c\u88ab\u540c\u4e00\u4e2a\u865a\u62df\u673a\u52a0\u8f7d\uff0c\u53ea\u8981\u52a0\u8f7d\u5b83\u4eec\u7684\u7c7b\u52a0\u8f7d\u5668\u4e0d\u540c\uff0c\u90a3\u8fd9\u4e24\u4e2a\u7c7b\u5c31\u5fc5\u5b9a\u4e0d\u76f8\u7b49\u3002</p>"},{"location":"read/jvm/jvm/#421","title":"4.2.1.\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b","text":"<p>\u7edd\u5927\u90e8\u5206Java\u7a0b\u5e8f\u90fd\u4f1a\u4f7f\u7528\u5230\u4ee5\u4e0b3\u79cd\u7cfb\u7edf\u63d0\u4f9b\u7684\u7c7b\u52a0\u8f7d\u5668:</p> <ul> <li>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff08Bootstrap ClassLoader\uff09</li> </ul> <p>\u8fd9\u4e2a\u7c7b\u5c06\u5668\u8d1f\u8d23\u5c06\u5b58\u653e\u5728\uff1cJAVA_HOME\uff1e\\lib\u76ee\u5f55\u4e2d\u7684\uff0c\u6216\u8005\u88ab-Xbootclasspath\u53c2\u6570\u6240\u6307\u5b9a\u7684\u8def\u5f84\u4e2d\u7684\uff0c\u5e76\u4e14\u662f\u865a\u62df\u673a\u8bc6\u522b\u7684\uff08\u4ec5\u6309\u7167\u6587\u4ef6\u540d\u8bc6\u522b\uff0c\u5982rt.jar\uff0c\u540d\u5b57\u4e0d\u7b26\u5408\u7684\u7c7b\u5e93\u5373\u4f7f\u653e\u5728lib\u76ee\u5f55\u4e2d\u4e5f\u4e0d\u4f1a\u88ab\u52a0\u8f7d\uff09\u7c7b\u5e93\u52a0\u8f7d\u5230\u865a\u62df\u673a\u5185\u5b58\u4e2d\u3002\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u88abJava\u7a0b\u5e8f\u76f4\u63a5\u5f15\u7528\uff0c\u7528\u6237\u5728\u7f16\u5199\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u65f6\uff0c\u5982\u679c\u9700\u8981\u628a\u52a0\u8f7d\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u5f15\u5bfc\u7c7b\u52a0\u8f7d\u5668\uff0c\u90a3\u76f4\u63a5\u4f7f\u7528null\u4ee3\u66ff\u5373\u53ef\u3002</p> <ul> <li>\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\uff08Extension ClassLoader\uff09</li> </ul> <p>\u8fd9\u4e2a\u52a0\u8f7d\u5668\u7531sun.misc.Launcher $ExtClassLoader\u5b9e\u73b0\uff0c\u5b83\u8d1f\u8d23\u52a0\u8f7d\uff1cJAVA_HOME\uff1e\\lib\\ext\u76ee\u5f55\u4e2d\u7684\uff0c\u6216\u8005\u88abjava.ext.dirs\u7cfb\u7edf\u53d8\u91cf\u6240\u6307\u5b9a\u7684\u8def\u5f84\u4e2d\u7684\u6240\u6709\u7c7b\u5e93\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\u3002</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff08Application ClassLoader\uff09</li> </ul> <p>\u8fd9\u4e2a\u7c7b\u52a0\u8f7d\u5668\u7531sun.misc.Launcher $App-ClassLoader\u5b9e\u73b0\u3002\u7531\u4e8e\u8fd9\u4e2a\u7c7b\u52a0\u8f7d\u5668\u662fClassLoader\u4e2d\u7684getSystemClassLoader\uff08\uff09\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff0c\u6240\u4ee5\u4e00\u822c\u4e5f\u79f0\u5b83\u4e3a\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668\u3002\u5b83\u8d1f\u8d23\u52a0\u8f7d\u7528\u201c\u6237\u7c7b\u8def\u5f84\uff08ClassPath\uff09\u4e0a\u6240\u6307\u5b9a\u7684\u7c7b\u5e93\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u52a0\u8f7d\u5668\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u6ca1\u6709\u81ea\u5b9a\u4e49\u8fc7\u81ea\u5df1\u7684\u7c7b\u52a0\u8f7d\u5668\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u8fd9\u4e2a\u5c31\u662f\u7a0b\u5e8f\u4e2d\u9ed8\u8ba4\u7684\u7c7b\u52a0\u8f7d\u5668\u3002</p> <p>\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u90fd\u662f\u7531\u8fd93\u79cd\u7c7b\u52a0\u8f7d\u5668\u4e92\u76f8\u914d\u5408\u8fdb\u884c\u52a0\u8f7d\u7684\uff0c\u5982\u679c\u6709\u5fc5\u8981\uff0c\u8fd8\u53ef\u4ee5\u52a0\u5165\u81ea\u5df1\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668\u3002\u8fd9\u4e9b\u7c7b\u52a0\u8f7d\u5668\u4e4b\u95f4\u7684\u5173\u7cfb\u4e00\u822c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u5c55\u793a\u7684\u7c7b\u52a0\u8f7d\u5668\u4e4b\u95f4\u7684\u8fd9\u79cd\u5c42\u6b21\u5173\u7cfb\uff0c\u79f0\u4e3a\u7c7b\u52a0\u8f7d\u5668\u7684\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\uff08Parents Delegation Model\uff09\u3002\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u8981\u6c42\u9664\u4e86\u9876\u5c42\u7684\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u5916\uff0c\u5176\u4f59\u7684\u7c7b\u52a0\u8f7d\u5668\u90fd\u5e94\u5f53\u6709\u81ea\u5df1\u7684\u7236\u7c7b\u52a0\u8f7d\u5668\u3002\u8fd9\u91cc\u7c7b\u52a0\u8f7d\u5668\u4e4b\u95f4\u7684\u7236\u5b50\u5173\u7cfb\u4e00\u822c\u4e0d\u4f1a\u4ee5\u7ee7\u627f\uff08Inheritance\uff09\u7684\u5173\u7cfb\u6765\u5b9e\u73b0\uff0c\u800c\u662f\u90fd\u4f7f\u7528\u7ec4\u5408\uff08Composition\uff09\u5173\u7cfb\u6765\u590d\u7528\u7236\u52a0\u8f7d\u5668\u7684\u4ee3\u7801\u3002</p> <p>\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u7684\u5de5\u4f5c\u8fc7\u7a0b\u662f\uff1a\u5982\u679c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u6536\u5230\u4e86\u7c7b\u52a0\u8f7d\u7684\u8bf7\u6c42\uff0c\u5b83\u9996\u5148\u4e0d\u4f1a\u81ea\u5df1\u53bb\u5c1d\u8bd5\u52a0\u8f7d\u8fd9\u4e2a\u7c7b\uff0c\u800c\u662f\u628a\u8fd9\u4e2a\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\u53bb\u5b8c\u6210\uff0c\u6bcf\u4e00\u4e2a\u5c42\u6b21\u7684\u7c7b\u52a0\u8f7d\u5668\u90fd\u662f\u5982\u6b64\uff0c\u56e0\u6b64\u6240\u6709\u7684\u52a0\u8f7d\u8bf7\u6c42\u6700\u7ec8\u90fd\u5e94\u8be5\u4f20\u9001\u5230\u9876\u5c42\u7684\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u4e2d\uff0c\u53ea\u6709\u5f53\u7236\u52a0\u8f7d\u5668\u53cd\u9988\u81ea\u5df1\u65e0\u6cd5\u5b8c\u6210\u8fd9\u4e2a\u52a0\u8f7d\u8bf7\u6c42\uff08\u5b83\u7684\u641c\u7d22\u8303\u56f4\u4e2d\u6ca1\u6709\u627e\u5230\u6240\u9700\u7684\u7c7b\uff09\u65f6\uff0c\u5b50\u52a0\u8f7d\u5668\u624d\u4f1a\u5c1d\u8bd5\u81ea\u5df1\u53bb\u52a0\u8f7d\u3002</p>"},{"location":"read/jvm/jvm/#5java","title":"5.Java\u5185\u5b58\u6a21\u578b\u4e0e\u7ebf\u7a0b","text":""},{"location":"read/jvm/jvm/#51","title":"5.1.\u4e3b\u5185\u5b58\u4e0e\u5de5\u4f5c\u5185\u5b58","text":"<p>Java\u5185\u5b58\u6a21\u578b\u89c4\u5b9a\u4e86\u6240\u6709\u7684\u53d8\u91cf\u90fd\u5b58\u50a8\u5728\u4e3b\u5185\u5b58\uff08Main Memory\uff09\u4e2d\uff08\u865a\u62df\u673a\u5185\u5b58\u7684\u4e00\u90e8\u5206\uff09\u3002\u6bcf\u6761\u7ebf\u7a0b\u8fd8\u6709\u81ea\u5df1\u7684\u5de5\u4f5c\u5185\u5b58\uff08Working Memory\uff09\uff0c\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5185\u5b58\u4e2d\u4fdd\u5b58\u4e86\u88ab\u8be5\u7ebf\u7a0b\u4f7f\u7528\u5230\u7684\u53d8\u91cf\u7684\u4e3b\u5185\u5b58\u526f\u672c\u62f7\u8d1d\uff0c\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u7684\u6240\u6709\u64cd\u4f5c\uff08\u8bfb\u53d6\u3001\u8d4b\u503c\u7b49\uff09\u90fd\u5fc5\u987b\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u8fdb\u884c\uff0c\u800c\u4e0d\u80fd\u76f4\u63a5\u8bfb\u5199\u4e3b\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\u3002\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e4b\u95f4\u4e5f\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5bf9\u65b9\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u7ebf\u7a0b\u95f4\u53d8\u91cf\u503c\u7684\u4f20\u9012\u5747\u9700\u8981\u901a\u8fc7\u4e3b\u5185\u5b58\u6765\u5b8c\u6210\uff0c\u7ebf\u7a0b\u3001\u4e3b\u5185\u5b58\u3001\u5de5\u4f5c\u5185\u5b58\u4e09\u8005\u7684\u4ea4\u4e92\u5173\u7cfb\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"read/jvm/jvm/#52","title":"5.2.\u5185\u5b58\u95f4\u4ea4\u4e92\u64cd\u4f5c","text":"<p>\u5173\u4e8e\u4e3b\u5185\u5b58\u4e0e\u5de5\u4f5c\u5185\u5b58\u4e4b\u95f4\u5177\u4f53\u7684\u4ea4\u4e92\u534f\u8bae\uff0c\u5373\u4e00\u4e2a\u53d8\u91cf\u5982\u4f55\u4ece\u4e3b\u5185\u5b58\u62f7\u8d1d\u5230\u5de5\u4f5c\u5185\u5b58\u3001\u5982\u4f55\u4ece\u5de5\u4f5c\u5185\u5b58\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u4e4b\u7c7b\u7684\u5b9e\u73b0\u7ec6\u8282\uff0cJava\u5185\u5b58\u6a21\u578b\u4e2d\u5b9a\u4e49\u4e86\u4ee5\u4e0b8\u79cd\u64cd\u4f5c\u6765\u5b8c\u6210\uff0c\u865a\u62df\u673a\u5b9e\u73b0\u65f6\u5fc5\u987b\u4fdd\u8bc1\u4e0b\u9762\u63d0\u53ca\u7684\u6bcf\u4e00\u79cd\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u7684\u3001\u4e0d\u53ef\u518d\u5206\u7684\u3002</p> <ul> <li>lock\uff08\u9501\u5b9a\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u53d8\u91cf\u6807\u8bc6\u4e3a\u4e00\u6761\u7ebf\u7a0b\u72ec\u5360\u7684\u72b6\u6001\u3002</p> <ul> <li>unlock\uff08\u89e3\u9501\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u5904\u4e8e\u9501\u5b9a\u72b6\u6001\u7684\u53d8\u91cf\u91ca\u653e\u51fa\u6765\uff0c\u91ca\u653e\u540e\u7684\u53d8\u91cf\u624d\u53ef\u4ee5\u88ab\u5176\u4ed6\u7ebf\u7a0b\u9501\u5b9a\u3002</p> <ul> <li>read\uff08\u8bfb\u53d6\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4ece\u4e3b\u5185\u5b58\u4f20\u8f93\u5230\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5185\u5b58\u4e2d\uff0c\u4ee5\u4fbf\u968f\u540e\u7684load\u52a8\u4f5c\u4f7f\u7528\u3002</p> <ul> <li>load\uff08\u8f7d\u5165\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628aread\u64cd\u4f5c\u4ece\u4e3b\u5185\u5b58\u4e2d\u5f97\u5230\u7684\u53d8\u91cf\u503c\u653e\u5165\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\u526f\u672c\u4e2d\u3002</p> <ul> <li>use\uff08\u4f7f\u7528\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u5de5\u4f5c\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9012\u7ed9\u6267\u884c\u5f15\u64ce\uff0c\u6bcf\u5f53\u865a\u62df\u673a\u9047\u5230\u4e00\u4e2a\u9700\u8981\u4f7f\u7528\u5230\u53d8\u91cf\u7684\u503c\u7684\u5b57\u8282\u7801\u6307\u4ee4\u65f6\u5c06\u4f1a\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\u3002</p> <ul> <li>assign\uff08\u8d4b\u503c\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u4e00\u4e2a\u4ece\u6267\u884c\u5f15\u64ce\u63a5\u6536\u5230\u7684\u503c\u8d4b\u7ed9\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u6bcf\u5f53\u865a\u62df\u673a\u9047\u5230\u4e00\u4e2a\u7ed9\u53d8\u91cf\u8d4b\u503c\u7684\u5b57\u8282\u7801\u6307\u4ee4\u65f6\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\u3002</p> <ul> <li>store\uff08\u5b58\u50a8\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628a\u5de5\u4f5c\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9001\u5230\u4e3b\u5185\u5b58\u4e2d\uff0c\u4ee5\u4fbf\u968f\u540e\u7684write\u64cd\u4f5c\u4f7f\u7528\u3002</p> <ul> <li>write\uff08\u5199\u5165\uff09</li> </ul> <p>\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u5b83\u628astore\u64cd\u4f5c\u4ece\u5de5\u4f5c\u5185\u5b58\u4e2d\u5f97\u5230\u7684\u53d8\u91cf\u7684\u503c\u653e\u5165\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\u4e2d\u3002</p> <p>Java\u5185\u5b58\u6a21\u578b\u8fd8\u89c4\u5b9a\u4e86\u5728\u6267\u884c\u4e0a\u8ff08\u79cd\u57fa\u672c\u64cd\u4f5c\u65f6\u5fc5\u987b\u6ee1\u8db3\u5982\u4e0b\u89c4\u5219\uff1a</p> <ul> <li>\u4e0d\u5141\u8bb8read\u548cload\u3001store\u548cwrite\u64cd\u4f5c\u4e4b\u4e00\u5355\u72ec\u51fa\u73b0\uff0c\u5373\u4e0d\u5141\u8bb8\u4e00\u4e2a\u53d8\u91cf\u4ece\u4e3b\u5185\u5b58\u8bfb\u53d6\u4e86\u4f46\u5de5\u4f5c\u5185\u5b58\u4e0d\u63a5\u53d7\uff0c\u6216\u8005\u4ece\u5de5\u4f5c\u5185\u5b58\u53d1\u8d77\u56de\u5199\u4e86\u4f46\u4e3b\u5185\u5b58\u4e0d\u63a5\u53d7\u7684\u60c5\u51b5\u51fa\u73b0\u3002</li> <li>\u4e0d\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u4e22\u5f03\u5b83\u7684\u6700\u8fd1\u7684assign\u64cd\u4f5c\uff0c\u5373\u53d8\u91cf\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u6539\u53d8\u4e86\u4e4b\u540e\u5fc5\u987b\u628a\u8be5\u53d8\u5316\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u3002</li> <li>\u4e0d\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u65e0\u539f\u56e0\u5730\uff08\u6ca1\u6709\u53d1\u751f\u8fc7\u4efb\u4f55assign\u64cd\u4f5c\uff09\u628a\u6570\u636e\u4ece\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5185\u5b58\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u4e2d</li> <li>\u4e00\u4e2a\u65b0\u7684\u53d8\u91cf\u53ea\u80fd\u5728\u4e3b\u5185\u5b58\u4e2d\u201c\u8bde\u751f\u201d\uff0c\u4e0d\u5141\u8bb8\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u76f4\u63a5\u4f7f\u7528\u4e00\u4e2a\u672a\u88ab\u521d\u59cb\u5316\uff08load\u6216assign\uff09\u7684\u53d8\u91cf\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u5bf9\u4e00\u4e2a\u53d8\u91cf\u5b9e\u65bduse\u3001store\u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u6267\u884c\u8fc7\u4e86assign\u548cload\u64cd\u4f5c\u3002</li> <li>\u4e00\u4e2a\u53d8\u91cf\u5728\u540c\u4e00\u4e2a\u65f6\u523b\u53ea\u5141\u8bb8\u4e00\u6761\u7ebf\u7a0b\u5bf9\u5176\u8fdb\u884clock\u64cd\u4f5c\uff0c\u4f46lock\u64cd\u4f5c\u53ef\u4ee5\u88ab\u540c\u4e00\u6761\u7ebf\u7a0b\u91cd\u590d\u6267\u884c\u591a\u6b21\uff0c\u591a\u6b21\u6267\u884clock\u540e\uff0c\u53ea\u6709\u6267\u884c\u76f8\u540c\u6b21\u6570\u7684unlock\u64cd\u4f5c\uff0c\u53d8\u91cf\u624d\u4f1a\u88ab\u89e3\u9501\u3002</li> <li>\u5982\u679c\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884clock\u64cd\u4f5c\uff0c\u90a3\u5c06\u4f1a\u6e05\u7a7a\u5de5\u4f5c\u5185\u5b58\u4e2d\u6b64\u53d8\u91cf\u7684\u503c\uff0c\u5728\u6267\u884c\u5f15\u64ce\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\u524d\uff0c\u9700\u8981\u91cd\u65b0\u6267\u884cload\u6216assign\u64cd\u4f5c\u521d\u59cb\u5316\u53d8\u91cf\u7684\u503c\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u53d8\u91cf\u4e8b\u5148\u6ca1\u6709\u88ablock\u64cd\u4f5c\u9501\u5b9a\uff0c\u90a3\u5c31\u4e0d\u5141\u8bb8\u5bf9\u5b83\u6267\u884cunlock\u64cd\u4f5c\uff0c\u4e5f\u4e0d\u5141\u8bb8\u53bbunlock\u4e00\u4e2a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u9501\u5b9a\u4f4f\u7684\u53d8\u91cf\u3002</li> <li>\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884cunlock\u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u628a\u6b64\u53d8\u91cf\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u4e2d\uff08\u6267\u884cstore\u3001write\u64cd\u4f5c\uff09\u3002</li> </ul>"},{"location":"read/jvm/jvm/#53volatile","title":"5.3.\u5bf9\u4e8evolatile\u578b\u53d8\u91cf\u7684\u7279\u6b8a\u89c4\u5219","text":"<p>\u5173\u952e\u5b57volatile\u53ef\u4ee5\u8bf4\u662fJava\u865a\u62df\u673a\u63d0\u4f9b\u7684\u6700\u8f7b\u91cf\u7ea7\u7684\u540c\u6b65\u673a\u5236\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u5bb9\u6613\u5b8c\u5168\u88ab\u6b63\u786e\u3001\u5b8c\u6574\u5730\u7406\u89e3\uff0c\u4ee5\u81f3\u4e8e\u8bb8\u591a\u7a0b\u5e8f\u5458\u90fd\u4e60\u60ef\u4e0d\u53bb\u4f7f\u7528\u5b83\uff0c\u9047\u5230\u9700\u8981\u5904\u7406\u591a\u7ebf\u7a0b\u6570\u636e\u7ade\u4e89\u95ee\u9898\u7684\u65f6\u5019\u4e00\u5f8b\u4f7f\u7528synchronized\u6765\u8fdb\u884c\u540c\u6b65\u3002</p> <p>\u5f53\u4e00\u4e2a\u53d8\u91cf\u5b9a\u4e49\u4e3avolatile\u4e4b\u540e\uff0c\u5b83\u5c06\u5177\u5907\u4e24\u79cd\u7279\u6027:</p> <ul> <li>\u4fdd\u8bc1\u6b64\u53d8\u91cf\u5bf9\u6240\u6709\u7ebf\u7a0b\u7684\u53ef\u89c1\u6027</li> </ul> <p>\u8fd9\u91cc\u7684\u201c\u53ef\u89c1\u6027\u201d\u662f\u6307\u5f53\u4e00\u6761\u7ebf\u7a0b\u4fee\u6539\u4e86\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u65b0\u503c\u5bf9\u4e8e\u5176\u4ed6\u7ebf\u7a0b\u6765\u8bf4\u662f\u53ef\u4ee5\u7acb\u5373\u5f97\u77e5\u7684\u3002\u800c\u666e\u901a\u53d8\u91cf\u4e0d\u80fd\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u666e\u901a\u53d8\u91cf\u7684\u503c\u5728\u7ebf\u7a0b\u95f4\u4f20\u9012\u5747\u9700\u8981\u901a\u8fc7\u4e3b\u5185\u5b58\u6765\u5b8c\u6210\u3002</p> <p>\u7531\u4e8evolatile\u53d8\u91cf\u53ea\u80fd\u4fdd\u8bc1\u53ef\u89c1\u6027\uff0c\u5728\u4e0d\u7b26\u5408\u4ee5\u4e0b\u4e24\u6761\u89c4\u5219\u7684\u8fd0\u7b97\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u4ecd\u7136\u8981\u901a\u8fc7\u52a0\u9501\uff08\u4f7f\u7528synchronized\u6216java.util.concurrent\u4e2d\u7684\u539f\u5b50\u7c7b\uff09\u6765\u4fdd\u8bc1\u539f\u5b50\u6027\u3002</p> <ul> <li>\u8fd0\u7b97\u7ed3\u679c\u5e76\u4e0d\u4f9d\u8d56\u53d8\u91cf\u7684\u5f53\u524d\u503c\uff0c\u6216\u8005\u80fd\u591f\u786e\u4fdd\u53ea\u6709\u5355\u4e00\u7684\u7ebf\u7a0b\u4fee\u6539\u53d8\u91cf\u7684\u503c\u3002</li> <li> <p>\u53d8\u91cf\u4e0d\u9700\u8981\u4e0e\u5176\u4ed6\u7684\u72b6\u6001\u53d8\u91cf\u5171\u540c\u53c2\u4e0e\u4e0d\u53d8\u7ea6\u675f\u3002</p> </li> <li> <p>\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u4f18\u5316</p> </li> </ul> <p>\u666e\u901a\u7684\u53d8\u91cf\u4ec5\u4ec5\u4f1a\u4fdd\u8bc1\u5728\u8be5\u65b9\u6cd5\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d\u6240\u6709\u4f9d\u8d56\u8d4b\u503c\u7ed3\u679c\u7684\u5730\u65b9\u90fd\u80fd\u83b7\u53d6\u5230\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u800c\u4e0d\u80fd\u4fdd\u8bc1\u53d8\u91cf\u8d4b\u503c\u64cd\u4f5c\u7684\u987a\u5e8f\u4e0e\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u7684\u6267\u884c\u987a\u5e8f\u4e00\u81f4\u3002\u56e0\u4e3a\u5728\u4e00\u4e2a\u7ebf\u7a0b\u7684\u65b9\u6cd5\u6267\u884c\u8fc7\u7a0b\u4e2d\u65e0\u6cd5\u611f\u77e5\u5230\u8fd9\u70b9\uff0c\u8fd9\u4e5f\u5c31\u662fJava\u5185\u5b58\u6a21\u578b\u4e2d\u63cf\u8ff0\u7684\u6240\u8c13\u7684\u201c\u7ebf\u7a0b\u5185\u8868\u73b0\u4e3a\u4e32\u884c\u7684\u8bed\u4e49\u3002</p>"},{"location":"read/jvm/jvm/#54","title":"5.4.\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u4e0e\u6709\u5e8f\u6027","text":"<p>Java\u5185\u5b58\u6a21\u578b\u662f\u56f4\u7ed5\u7740\u5728\u5e76\u53d1\u8fc7\u7a0b\u4e2d\u5982\u4f55\u5904\u7406\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\u8fd93\u4e2a\u7279\u5f81\u6765\u5efa\u7acb\u7684\uff0c\u6211\u4eec\u9010\u4e2a\u6765\u770b\u4e00\u4e0b\u54ea\u4e9b\u64cd\u4f5c\u5b9e\u73b0\u4e86\u8fd93\u4e2a\u7279\u6027\u3002</p> <ul> <li>\u539f\u5b50\u6027\uff08Atomicity</li> </ul> <p>\u7531Java\u5185\u5b58\u6a21\u578b\u6765\u76f4\u63a5\u4fdd\u8bc1\u7684\u539f\u5b50\u6027\u53d8\u91cf\u64cd\u4f5c\u5305\u62ecread\u3001load\u3001assign\u3001use\u3001store\u548cwrite\uff0c\u6211\u4eec\u5927\u81f4\u53ef\u4ee5\u8ba4\u4e3a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u8bbf\u95ee\u8bfb\u5199\u662f\u5177\u5907\u539f\u5b50\u6027\u7684\u3002\u5982\u679c\u5e94\u7528\u573a\u666f\u9700\u8981\u4e00\u4e2a\u66f4\u5927\u8303\u56f4\u7684\u539f\u5b50\u6027\u4fdd\u8bc1\uff08\u7ecf\u5e38\u4f1a\u9047\u5230\uff09\uff0cJava\u5185\u5b58\u6a21\u578b\u8fd8\u63d0\u4f9b\u4e86lock\u548cunlock\u64cd\u4f5c\u6765\u6ee1\u8db3\u8fd9\u79cd\u9700\u6c42\uff0c\u5c3d\u7ba1\u865a\u62df\u673a\u672a\u628alock\u548cunlock\u64cd\u4f5c\u76f4\u63a5\u5f00\u653e\u7ed9\u7528\u6237\u4f7f\u7528\uff0c\u4f46\u662f\u5374\u63d0\u4f9b\u4e86\u66f4\u9ad8\u5c42\u6b21\u7684\u5b57\u8282\u7801\u6307\u4ee4monitorenter\u548cmonitorexit\u6765\u9690\u5f0f\u5730\u4f7f\u7528\u8fd9\u4e24\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e24\u4e2a\u5b57\u8282\u7801\u6307\u4ee4\u53cd\u6620\u5230Java\u4ee3\u7801\u4e2d\u5c31\u662f\u540c\u6b65\u5757\u2014\u2014synchronized\u5173\u952e\u5b57\uff0c\u56e0\u6b64\u5728synchronized\u5757\u4e4b\u95f4\u7684\u64cd\u4f5c\u4e5f\u5177\u5907\u539f\u5b50\u6027\u3002</p> <ul> <li>\u53ef\u89c1\u6027\uff08Visibility\uff09</li> </ul> <p>\u53ef\u89c1\u6027\u662f\u6307\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u53d8\u91cf\u7684\u503c\uff0c\u5176\u4ed6\u7ebf\u7a0b\u80fd\u591f\u7acb\u5373\u5f97\u77e5\u8fd9\u4e2a\u4fee\u6539\u3002\u4e0a\u6587\u5728\u8bb2\u89e3volatile\u53d8\u91cf\u7684\u65f6\u5019\u6211\u4eec\u5df2\u8be6\u7ec6\u8ba8\u8bba\u8fc7\u8fd9\u4e00\u70b9\u3002Java\u5185\u5b58\u6a21\u578b\u662f\u901a\u8fc7\u5728\u53d8\u91cf\u4fee\u6539\u540e\u5c06\u65b0\u503c\u540c\u6b65\u56de\u4e3b\u5185\u5b58\uff0c\u5728\u53d8\u91cf\u8bfb\u53d6\u524d\u4ece\u4e3b\u5185\u5b58\u5237\u65b0\u53d8\u91cf\u503c\u8fd9\u79cd\u4f9d\u8d56\u4e3b\u5185\u5b58\u4f5c\u4e3a\u4f20\u9012\u5a92\u4ecb\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u53ef\u89c1\u6027\u7684\uff0c\u65e0\u8bba\u662f\u666e\u901a\u53d8\u91cf\u8fd8\u662fvolatile\u53d8\u91cf\u90fd\u662f\u5982\u6b64\uff0c\u666e\u901a\u53d8\u91cf\u4e0evolatile\u53d8\u91cf\u7684\u533a\u522b\u662f\uff0cvolatile\u7684\u7279\u6b8a\u89c4\u5219\u4fdd\u8bc1\u4e86\u65b0\u503c\u80fd\u7acb\u5373\u540c\u6b65\u5230\u4e3b\u5185\u5b58\uff0c\u4ee5\u53ca\u6bcf\u6b21\u4f7f\u7528\u524d\u7acb\u5373\u4ece\u4e3b\u5185\u5b58\u5237\u65b0\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u8bf4volatile\u4fdd\u8bc1\u4e86\u591a\u7ebf\u7a0b\u64cd\u4f5c\u65f6\u53d8\u91cf\u7684\u53ef\u89c1\u6027\uff0c\u800c\u666e\u901a\u53d8\u91cf\u5219\u4e0d\u80fd\u4fdd\u8bc1\u8fd9\u4e00\u70b9\u3002</p> <p>\u9664\u4e86volatile\u4e4b\u5916\uff0cJava\u8fd8\u6709\u4e24\u4e2a\u5173\u952e\u5b57\u80fd\u5b9e\u73b0\u53ef\u89c1\u6027\uff0c\u5373synchronized\u548cfinal\u3002\u540c\u6b65\u5757\u7684\u53ef\u89c1\u6027\u662f\u7531\u201c\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884cunlock\u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u628a\u6b64\u53d8\u91cf\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u4e2d\uff08\u6267\u884cstore\u3001write\u64cd\u4f5c\uff09\u201d\u8fd9\u6761\u89c4\u5219\u83b7\u5f97\u7684\uff0c\u800cfinal\u5173\u952e\u5b57\u7684\u53ef\u89c1\u6027\u662f\u6307\uff1a\u88abfinal\u4fee\u9970\u7684\u5b57\u6bb5\u5728\u6784\u9020\u5668\u4e2d\u4e00\u65e6\u521d\u59cb\u5316\u5b8c\u6210\uff0c\u5e76\u4e14\u6784\u9020\u5668\u6ca1\u6709\u628a\u201cthis\u201d\u7684\u5f15\u7528\u4f20\u9012\u51fa\u53bb\uff08this\u5f15\u7528\u9003\u9038\u662f\u4e00\u4ef6\u5f88\u5371\u9669\u7684\u4e8b\u60c5\uff0c\u5176\u4ed6\u7ebf\u7a0b\u6709\u53ef\u80fd\u901a\u8fc7\u8fd9\u4e2a\u5f15\u7528\u8bbf\u95ee\u5230\u201c\u521d\u59cb\u5316\u4e86\u4e00\u534a\u201d\u7684\u5bf9\u8c61\uff09\uff0c\u90a3\u5728\u5176\u4ed6\u7ebf\u7a0b\u4e2d\u5c31\u80fd\u770b\u89c1final\u5b57\u6bb5\u7684\u503c\u3002</p> <ul> <li>\u6709\u5e8f\u6027\uff08Ordering\uff09</li> </ul> <p>Java\u5185\u5b58\u6a21\u578b\u7684\u6709\u5e8f\u6027\u5728\u524d\u9762\u8bb2\u89e3volatile\u65f6\u4e5f\u8be6\u7ec6\u5730\u8ba8\u8bba\u8fc7\u4e86\uff0cJava\u7a0b\u5e8f\u4e2d\u5929\u7136\u7684\u6709\u5e8f\u6027\u53ef\u4ee5\u603b\u7ed3\u4e3a\u4e00\u53e5\u8bdd\uff1a\u5982\u679c\u5728\u672c\u7ebf\u7a0b\u5185\u89c2\u5bdf\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u6709\u5e8f\u7684\uff1b\u5982\u679c\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u89c2\u5bdf\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u65e0\u5e8f\u7684\u3002\u524d\u534a\u53e5\u662f\u6307\u201c\u7ebf\u7a0b\u5185\u8868\u73b0\u4e3a\u4e32\u884c\u7684\u8bed\u4e49\u201d\uff08Within-Thread As-If-Serial Semantics\uff09\uff0c\u540e\u534a\u53e5\u662f\u6307\u201c\u6307\u4ee4\u91cd\u6392\u5e8f\u201d\u73b0\u8c61\u548c\u201c\u5de5\u4f5c\u5185\u5b58\u4e0e\u4e3b\u5185\u5b58\u540c\u6b65\u5ef6\u8fdf\u201d\u73b0\u8c61\u3002</p> <p>Java\u8bed\u8a00\u63d0\u4f9b\u4e86volatile\u548csynchronized\u4e24\u4e2a\u5173\u952e\u5b57\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u4e4b\u95f4\u64cd\u4f5c\u7684\u6709\u5e8f\u6027\uff0cvolatile\u5173\u952e\u5b57\u672c\u8eab\u5c31\u5305\u542b\u4e86\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\u7684\u8bed\u4e49\uff0c\u800csynchronized\u5219\u662f\u7531\u201c\u4e00\u4e2a\u53d8\u91cf\u5728\u540c\u4e00\u4e2a\u65f6\u523b\u53ea\u5141\u8bb8\u4e00\u6761\u7ebf\u7a0b\u5bf9\u5176\u8fdb\u884clock\u64cd\u4f5c\u201d\u8fd9\u6761\u89c4\u5219\u83b7\u5f97\u7684\uff0c\u8fd9\u6761\u89c4\u5219\u51b3\u5b9a\u4e86\u6301\u6709\u540c\u4e00\u4e2a\u9501\u7684\u4e24\u4e2a\u540c\u6b65\u5757\u53ea\u80fd\u4e32\u884c\u5730\u8fdb\u5165\u3002</p> <p>synchronized\u6ce8\u610f\uff1a\u9996\u5148\uff0csynchronized\u540c\u6b65\u5757\u5bf9\u540c\u4e00\u6761\u7ebf\u7a0b\u6765\u8bf4\u662f\u53ef\u91cd\u5165\u7684\uff0c\u4e0d\u4f1a\u51fa\u73b0\u81ea\u5df1\u628a\u81ea\u5df1\u9501\u6b7b\u7684\u95ee\u9898\u3002\u5176\u6b21\uff0c\u540c\u6b65\u5757\u5728\u5df2\u8fdb\u5165\u7684\u7ebf\u7a0b\u6267\u884c\u5b8c\u4e4b\u524d\uff0c\u4f1a\u963b\u585e\u540e\u9762\u5176\u4ed6\u7ebf\u7a0b\u7684\u8fdb\u5165\u3002\u7b2c12\u7ae0\u8bb2\u8fc7\uff0cJava\u7684\u7ebf\u7a0b\u662f\u6620\u5c04\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u539f\u751f\u7ebf\u7a0b\u4e4b\u4e0a\u7684\uff0c\u5982\u679c\u8981\u963b\u585e\u6216\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u90fd\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u6765\u5e2e\u5fd9\u5b8c\u6210\uff0c\u8fd9\u5c31\u9700\u8981\u4ece\u7528\u6237\u6001\u8f6c\u6362\u5230\u6838\u5fc3\u6001\u4e2d\uff0c\u56e0\u6b64\u72b6\u6001\u8f6c\u6362\u9700\u8981\u8017\u8d39\u5f88\u591a\u7684\u5904\u7406\u5668\u65f6\u95f4\u3002\u5bf9\u4e8e\u4ee3\u7801\u7b80\u5355\u7684\u540c\u6b65\u5757\uff08\u5982\u88absynchronized\u4fee\u9970\u7684getter\uff08\uff09\u6216setter\uff08\uff09\u65b9\u6cd5\uff09\uff0c\u72b6\u6001\u8f6c\u6362\u6d88\u8017\u7684\u65f6\u95f4\u6709\u53ef\u80fd\u6bd4\u7528\u6237\u4ee3\u7801\u6267\u884c\u7684\u65f6\u95f4\u8fd8\u8981\u957f\u3002\u6240\u4ee5synchronized\u662fJava\u8bed\u8a00\u4e2d\u4e00\u4e2a\u91cd\u91cf\u7ea7\uff08Heavyweight\uff09\u7684\u64cd\u4f5c\uff0c\u6709\u7ecf\u9a8c\u7684\u7a0b\u5e8f\u5458\u90fd\u4f1a\u5728\u786e\u5b9e\u5fc5\u8981\u7684\u60c5\u51b5\u4e0b\u624d\u4f7f\u7528\u8fd9\u79cd\u64cd\u4f5c\u3002\u800c\u865a\u62df\u673a\u672c\u8eab\u4e5f\u4f1a\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\uff0c\u8b6c\u5982\u5728\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\u963b\u585e\u7ebf\u7a0b\u4e4b\u524d\u52a0\u5165\u4e00\u6bb5\u81ea\u65cb\u7b49\u5f85\u8fc7\u7a0b\uff0c\u907f\u514d\u9891\u7e41\u5730\u5207\u5165\u5230\u6838\u5fc3\u6001\u4e4b\u4e2d\u3002</p>"},{"location":"read/jvm/jvm/#55","title":"5.5.\u5148\u884c\u53d1\u751f\u539f\u5219","text":"<p>\u5982\u679cJava\u5185\u5b58\u6a21\u578b\u4e2d\u6240\u6709\u7684\u6709\u5e8f\u6027\u90fd\u4ec5\u4ec5\u9760volatile\u548csynchronized\u6765\u5b8c\u6210\uff0c\u90a3\u4e48\u6709\u4e00\u4e9b\u64cd\u4f5c\u5c06\u4f1a\u53d8\u5f97\u5f88\u70e6\u7410\uff0c\u4f46\u662f\u6211\u4eec\u5728\u7f16\u5199Java\u5e76\u53d1\u4ee3\u7801\u7684\u65f6\u5019\u5e76\u6ca1\u6709\u611f\u89c9\u5230\u8fd9\u4e00\u70b9\uff0c\u8fd9\u662f\u56e0\u4e3aJava\u8bed\u8a00\u4e2d\u6709\u4e00\u4e2a\u201c\u5148\u884c\u53d1\u751f\u201d\uff08happens-before\uff09\u7684\u539f\u5219\u3002\u8fd9\u4e2a\u539f\u5219\u975e\u5e38\u91cd\u8981\uff0c\u5b83\u662f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\u7ade\u4e89\u3001\u7ebf\u7a0b\u662f\u5426\u5b89\u5168\u7684\u4e3b\u8981\u4f9d\u636e\uff0c\u4f9d\u9760\u8fd9\u4e2a\u539f\u5219\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u51e0\u6761\u89c4\u5219\u4e00\u63fd\u5b50\u5730\u89e3\u51b3\u5e76\u53d1\u73af\u5883\u4e0b\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\u662f\u5426\u53ef\u80fd\u5b58\u5728\u51b2\u7a81\u7684\u6240\u6709\u95ee\u9898\u3002</p> <p>\u5148\u884c\u53d1\u751f\u662fJava\u5185\u5b58\u6a21\u578b\u4e2d\u5b9a\u4e49\u7684\u4e24\u9879\u64cd\u4f5c\u4e4b\u95f4\u7684\u504f\u5e8f\u5173\u7cfb\uff0c\u5982\u679c\u8bf4\u64cd\u4f5cA\u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cB\uff0c\u5176\u5b9e\u5c31\u662f\u8bf4\u5728\u53d1\u751f\u64cd\u4f5cB\u4e4b\u524d\uff0c\u64cd\u4f5cA\u4ea7\u751f\u7684\u5f71\u54cd\u80fd\u88ab\u64cd\u4f5cB\u89c2\u5bdf\u5230\uff0c\u201c\u5f71\u54cd\u201d\u5305\u62ec\u4fee\u6539\u4e86\u5185\u5b58\u4e2d\u5171\u4eab\u53d8\u91cf\u7684\u503c\u3001\u53d1\u9001\u4e86\u6d88\u606f\u3001\u8c03\u7528\u4e86\u65b9\u6cd5\u7b49\u3002</p> <p>\u201c\u5929\u7136\u7684\u201d\u5148\u884c\u53d1\u751f\u5173\u7cfb:</p> <ul> <li>\u7a0b\u5e8f\u6b21\u5e8f\u89c4\u5219\uff08Program Order Rule\uff09</li> </ul> <p>\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5185\uff0c\u6309\u7167\u7a0b\u5e8f\u4ee3\u7801\u987a\u5e8f\uff0c\u4e66\u5199\u5728\u524d\u9762\u7684\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u4e66\u5199\u5728\u540e\u9762\u7684\u64cd\u4f5c\u3002\u51c6\u786e\u5730\u8bf4\uff0c\u5e94\u8be5\u662f\u63a7\u5236\u6d41\u987a\u5e8f\u800c\u4e0d\u662f\u7a0b\u5e8f\u4ee3\u7801\u987a\u5e8f\uff0c\u56e0\u4e3a\u8981\u8003\u8651\u5206\u652f\u3001\u5faa\u73af\u7b49\u7ed3\u6784\u3002</p> <ul> <li>\u7ba1\u7a0b\u9501\u5b9a\u89c4\u5219\uff08Monitor Lock Rule\uff09</li> </ul> <p>\u4e00\u4e2aunlock\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\u5bf9\u540c\u4e00\u4e2a\u9501\u7684lock\u64cd\u4f5c\u3002\u8fd9\u91cc\u5fc5\u987b\u5f3a\u8c03\u7684\u662f\u540c\u4e00\u4e2a\u9501\uff0c\u800c\u201c\u540e\u9762\u201d\u662f\u6307\u65f6\u95f4\u4e0a\u7684\u5148\u540e\u987a\u5e8f\u3002</p> <ul> <li>volatile\u53d8\u91cf\u89c4\u5219\uff08Volatile Variable Rule\uff09</li> </ul> <p>\u5bf9\u4e00\u4e2avolatile\u53d8\u91cf\u7684\u5199\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\u5bf9\u8fd9\u4e2a\u53d8\u91cf\u7684\u8bfb\u64cd\u4f5c\uff0c\u8fd9\u91cc\u7684\u201c\u540e\u9762\u201d\u540c\u6837\u662f\u6307\u65f6\u95f4\u4e0a\u7684\u5148\u540e\u987a\u5e8f\u3002</p> <ul> <li>\u7ebf\u7a0b\u542f\u52a8\u89c4\u5219\uff08Thread Start Rule\uff09</li> </ul> <p>Thread\u5bf9\u8c61\u7684start\uff08\uff09\u65b9\u6cd5\u5148\u884c\u53d1\u751f\u4e8e\u6b64\u7ebf\u7a0b\u7684\u6bcf\u4e00\u4e2a\u52a8\u4f5c\u3002</p> <ul> <li>\u7ebf\u7a0b\u7ec8\u6b62\u89c4\u5219\uff08Thread Termination Rule\uff09</li> </ul> <p>\u7ebf\u7a0b\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u5148\u884c\u53d1\u751f\u4e8e\u5bf9\u6b64\u7ebf\u7a0b\u7684\u7ec8\u6b62\u68c0\u6d4b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Thread.join\uff08\uff09\u65b9\u6cd5\u7ed3\u675f\u3001Thread.isAlive\uff08\uff09\u7684\u8fd4\u56de\u503c\u7b49\u624b\u6bb5\u68c0\u6d4b\u5230\u7ebf\u7a0b\u5df2\u7ecf\u7ec8\u6b62\u6267\u884c\u3002</p> <ul> <li>\u7ebf\u7a0b\u4e2d\u65ad\u89c4\u5219\uff08Thread Interruption Rule\uff09</li> </ul> <p>\u5bf9\u7ebf\u7a0binterrupt\uff08\uff09\u65b9\u6cd5\u7684\u8c03\u7528\u5148\u884c\u53d1\u751f\u4e8e\u88ab\u4e2d\u65ad\u7ebf\u7a0b\u7684\u4ee3\u7801\u68c0\u6d4b\u5230\u4e2d\u65ad\u4e8b\u4ef6\u7684\u53d1\u751f\uff0c\u53ef\u4ee5\u901a\u8fc7Thread.interrupted\uff08\uff09\u65b9\u6cd5\u68c0\u6d4b\u5230\u662f\u5426\u6709\u4e2d\u65ad\u53d1\u751f\u3002</p> <ul> <li>\u5bf9\u8c61\u7ec8\u7ed3\u89c4\u5219\uff08Finalizer Rule\uff09</li> </ul> <p>\u4e00\u4e2a\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u5b8c\u6210\uff08\u6784\u9020\u51fd\u6570\u6267\u884c\u7ed3\u675f\uff09\u5148\u884c\u53d1\u751f\u4e8e\u5b83\u7684finalize\uff08\uff09\u65b9\u6cd5\u7684\u5f00\u59cb\u3002</p> <ul> <li>\u4f20\u9012\u6027\uff08Transitivity)</li> </ul> <p>\u5982\u679c\u64cd\u4f5cA\u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cB\uff0c\u64cd\u4f5cB\u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cC\uff0c\u90a3\u5c31\u53ef\u4ee5\u5f97\u51fa\u64cd\u4f5cA\u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5cC\u7684\u7ed3\u8bba\u3002</p> <p>\u65f6\u95f4\u5148\u540e\u987a\u5e8f\u4e0e\u5148\u884c\u53d1\u751f\u539f\u5219\u4e4b\u95f4\u57fa\u672c\u6ca1\u6709\u592a\u5927\u7684\u5173\u7cfb\uff0c\u6240\u4ee5\u6211\u4eec\u8861\u91cf\u5e76\u53d1\u5b89\u5168\u95ee\u9898\u7684\u65f6\u5019\u4e0d\u8981\u53d7\u5230\u65f6\u95f4\u987a\u5e8f\u7684\u5e72\u6270\uff0c\u4e00\u5207\u5fc5\u987b\u4ee5\u5148\u884c\u53d1\u751f\u539f\u5219\u4e3a\u51c6\u3002</p>"},{"location":"tools/","title":"\u5f00\u53d1\u5de5\u5177","text":""},{"location":"tools/git/git_submodule/","title":"Git submodule \u5b50\u6a21\u5757\u7684\u7ba1\u7406\u548c\u4f7f\u7528","text":""},{"location":"tools/git/git_submodule/#1","title":"1. \u4f7f\u7528\u524d\u63d0","text":"<p>\u7ecf\u5e38\u78b0\u5230\u8fd9\u79cd\u60c5\u51b5\uff1a\u5f53\u4f60\u5728\u4e00\u4e2aGit \u9879\u76ee\u4e0a\u5de5\u4f5c\u65f6\uff0c\u4f60\u9700\u8981\u5728\u5176\u4e2d\u4f7f\u7528\u53e6\u5916\u4e00\u4e2aGit \u9879\u76ee\u3002\u4e5f\u8bb8\u5b83\u662f\u4e00\u4e2a\u7b2c\u4e09\u65b9\u5f00\u53d1\u7684Git \u5e93\u6216\u8005\u662f\u4f60\u72ec\u7acb\u5f00\u53d1\u548c\u5e76\u5728\u591a\u4e2a\u7236\u9879\u76ee\u4e2d\u4f7f\u7528\u7684\u3002\u8fd9\u4e2a\u60c5\u51b5\u4e0b\u4e00\u4e2a\u5e38\u89c1\u7684\u95ee\u9898\u4ea7\u751f\u4e86\uff1a\u4f60\u60f3\u5c06\u4e24\u4e2a\u9879\u76ee\u5355\u72ec\u5904\u7406\u4f46\u662f\u53c8\u9700\u8981\u5728\u5176\u4e2d\u4e00\u4e2a\u4e2d\u4f7f\u7528\u53e6\u5916\u4e00\u4e2a\u3002</p> <p>\u5728Git \u4e2d\u4f60\u53ef\u4ee5\u7528\u5b50\u6a21\u5757submodule\u6765\u7ba1\u7406\u8fd9\u4e9b\u9879\u76ee\uff0csubmodule\u5141\u8bb8\u4f60\u5c06\u4e00\u4e2aGit \u4ed3\u5e93\u5f53\u4f5c\u53e6\u5916\u4e00\u4e2aGit \u4ed3\u5e93\u7684\u5b50\u76ee\u5f55\u3002\u8fd9\u5141\u8bb8\u4f60\u514b\u9686\u53e6\u5916\u4e00\u4e2a\u4ed3\u5e93\u5230\u4f60\u7684\u9879\u76ee\u4e2d\u5e76\u4e14\u4fdd\u6301\u4f60\u7684\u63d0\u4ea4\u76f8\u5bf9\u72ec\u7acb</p>"},{"location":"tools/git/git_submodule/#2","title":"2. \u6dfb\u52a0\u5b50\u6a21\u5757","text":"<p>\u6b64\u6587\u4e2d\u7edf\u4e00\u5c06\u8fdc\u7a0b\u9879\u76ee<code>https://github.com/maonx/vimwiki-assets.git</code>\u514b\u9686\u5230\u672c\u5730<code>assets</code>\u6587\u4ef6\u5939\u3002 <pre><code>$ git submodule add https://github.com/maonx/vimwiki-assets.git assets\n</code></pre> \u6dfb\u52a0\u5b50\u6a21\u5757\u540e\u8fd0\u884c<code>git status</code>, \u53ef\u4ee5\u770b\u5230\u76ee\u5f55\u6709\u589e\u52a01\u4e2a\u6587\u4ef6<code>.gitmodules</code>, \u8fd9\u4e2a\u6587\u4ef6\u7528\u6765\u4fdd\u5b58\u5b50\u6a21\u5757\u7684\u4fe1\u606f\u3002 <pre><code>$ git status\nOn branch master\n\nInitial commit\n\nChanges to be committed:\n  (use \"git rm --cached &lt;file&gt;...\" to unstage)\nnew file:   .gitmodules\n    new file:   assets\n</code></pre></p>"},{"location":"tools/git/git_submodule/#3","title":"3. \u67e5\u770b\u5b50\u6a21\u5757","text":"<pre><code>$ git submodule\n e33f854d3f51f5ebd771a68da05ad0371a3c0570 assets (heads/master)\n</code></pre>"},{"location":"tools/git/git_submodule/#4","title":"4. \u66f4\u65b0\u5b50\u6a21\u5757","text":"<ul> <li>\u66f4\u65b0\u9879\u76ee\u5185\u5b50\u6a21\u5757\u5230\u6700\u65b0\u7248\u672c <pre><code>$ git submodule update\n</code></pre></li> <li>\u66f4\u65b0\u5b50\u6a21\u5757\u4e3a\u8fdc\u7a0b\u9879\u76ee\u7684\u6700\u65b0\u7248\u672c <pre><code>$ git submodule update --remote\n</code></pre></li> </ul>"},{"location":"tools/git/git_submodule/#5","title":"5. \u514b\u9686\u5305\u542b\u5b50\u6a21\u5757\u7684\u9879\u76ee","text":"<p>\u514b\u9686\u5305\u542b\u5b50\u6a21\u5757\u7684\u9879\u76ee\u6709\u4e8c\u79cd\u65b9\u6cd5\uff1a\u4e00\u79cd\u662f\u5148\u514b\u9686\u7236\u9879\u76ee\uff0c\u518d\u66f4\u65b0\u5b50\u6a21\u5757\uff1b\u53e6\u4e00\u79cd\u662f\u76f4\u63a5\u9012\u5f52\u514b\u9686\u6574\u4e2a\u9879\u76ee\u3002</p>"},{"location":"tools/git/git_submodule/#51","title":"5.1 \u514b\u9686\u7236\u9879\u76ee\uff0c\u518d\u66f4\u65b0\u5b50\u6a21\u5757","text":"<ol> <li>\u514b\u9686\u7236\u9879\u76ee <pre><code>$ git clone https://github.com/maonx/vimwiki-assets.git assets\n</code></pre></li> <li> <p>\u67e5\u770b\u5b50\u6a21\u5757 <pre><code>$ git submodule\n -e33f854d3f51f5ebd771a68da05ad0371a3c0570 assets\n</code></pre> \u5b50\u6a21\u5757\u524d\u9762\u6709\u4e00\u4e2a-\uff0c\u8bf4\u660e\u5b50\u6a21\u5757\u6587\u4ef6\u8fd8\u672a\u68c0\u5165\uff08\u7a7a\u6587\u4ef6\u5939\uff09\u3002</p> </li> <li> <p>\u521d\u59cb\u5316\u5b50\u6a21\u5757 <pre><code>$ git submodule init\nSubmodule 'assets' (https://github.com/maonx/vimwiki-assets.git) registered for path 'assets'\n</code></pre></p> <p>\u521d\u59cb\u5316\u6a21\u5757\u53ea\u9700\u5728\u514b\u9686\u7236\u9879\u76ee\u540e\u8fd0\u884c\u4e00\u6b21\u3002</p> </li> <li> <p>\u66f4\u65b0\u5b50\u6a21\u5757 <pre><code>$ git submodule update\nCloning into 'assets'...\nremote: Counting objects: 151, done.\nremote: Compressing objects: 100% (80/80), done.\nremote: Total 151 (delta 18), reused 0 (delta 0), pack-reused 70\nReceiving objects: 100% (151/151), 1.34 MiB | 569.00 KiB/s, done.\nResolving deltas: 100% (36/36), done.\nChecking connectivity... done.\nSubmodule path 'assets': checked out 'e33f854d3f51f5ebd771a68da05ad0371a3c0570'\n</code></pre></p> </li> </ol>"},{"location":"tools/git/git_submodule/#52","title":"5.2 \u9012\u5f52\u514b\u9686\u6574\u4e2a\u9879\u76ee","text":"<p><pre><code>git clone https://github.com/maonx/vimwiki-assets.git assets --recursive </code></pre> \u9012\u5f52\u514b\u9686\u6574\u4e2a\u9879\u76ee\uff0c\u5b50\u6a21\u5757\u5df2\u7ecf\u540c\u65f6\u66f4\u65b0\u4e86\uff0c\u4e00\u6b65\u5230\u4f4d\u3002</p>"},{"location":"tools/git/git_submodule/#6","title":"6. \u4fee\u6539\u5b50\u6a21\u5757","text":"<p>\u5728\u5b50\u6a21\u5757\u4e2d\u4fee\u6539\u6587\u4ef6\u540e\uff0c\u76f4\u63a5\u63d0\u4ea4\u5230\u8fdc\u7a0b\u9879\u76ee\u5206\u652f\u3002 <pre><code>$ git add .\n$ git ci -m \"commit\"\n$ git push origin HEAD:master\n</code></pre></p>"},{"location":"tools/git/git_submodule/#7","title":"7.\u5220\u9664\u5b50\u6a21\u5757","text":"<p>\u5220\u9664\u5b50\u6a21\u5757\u6bd4\u8f83\u9ebb\u70e6\uff0c\u9700\u8981\u624b\u52a8\u5220\u9664\u76f8\u5173\u7684\u6587\u4ef6\uff0c\u5426\u5219\u5728\u6dfb\u52a0\u5b50\u6a21\u5757\u65f6\u6709\u53ef\u80fd\u51fa\u73b0\u9519\u8bef</p> <p>\u540c\u6837\u4ee5\u5220\u9664assets\u6587\u4ef6\u5939\u4e3a\u4f8b</p> <ol> <li>\u5220\u9664\u5b50\u6a21\u5757\u6587\u4ef6\u5939 <pre><code>$ git rm --cached assets\n$ rm -rf assets\n</code></pre></li> <li>\u5220\u9664.gitmodules\u6587\u4ef6\u4e2d\u76f8\u5173\u5b50\u6a21\u5757\u4fe1\u606f <pre><code>[submodule \"assets\"]\npath = assets\n  url = https://github.com/maonx/vimwiki-assets.git\n</code></pre></li> <li>\u5220\u9664.git/config\u4e2d\u7684\u76f8\u5173\u5b50\u6a21\u5757\u4fe1\u606f <pre><code>[submodule \"assets\"]\nurl = https://github.com/maonx/vimwiki-assets.git\n</code></pre></li> <li>\u5220\u9664.git\u6587\u4ef6\u5939\u4e2d\u7684\u76f8\u5173\u5b50\u6a21\u5757\u6587\u4ef6 <pre><code>$ rm -rf .git/modules/assets\n</code></pre></li> </ol>"},{"location":"tools/git/git_submodule/#8","title":"8.\u53c2\u8003","text":"<p>\u8f6c\u81eahttps://www.jianshu.com/p/9000cd49822c</p>"},{"location":"tools/perfetto/perfetto_overview/","title":"Perfetto \u7b80\u4ecb","text":""},{"location":"tools/perfetto/perfetto_overview/#perfetto_1","title":"\u4ec0\u4e48\u662f Perfetto","text":"<p>Perfetto \u662f Android 10 \u4e2d\u5f15\u5165\u7684\u5e73\u53f0\u7ea7\u8ddf\u8e2a\u5de5\u5177\u3002\u8fd9\u662f\u9002\u7528\u4e8e Android\u3001Linux \u548c Chrome \u7684\u6210\u719f\u5f00\u6e90\u8ddf\u8e2a\u9879\u76ee\u3002\u4e0e Systrace \u4e0d\u540c\uff0c\u5b83\u63d0\u4f9b\u6570\u636e\u6e90\u8d85\u96c6\uff0c\u53ef\u8ba9\u60a8\u4ee5\u534f\u8bae\u7f13\u51b2\u533a\u4e8c\u8fdb\u5236\u6d41\u5f62\u5f0f\u8bb0\u5f55\u4efb\u610f\u957f\u5ea6\u7684\u8ddf\u8e2a\u8bb0\u5f55\u3002\u60a8\u53ef\u4ee5\u5728 Perfetto \u754c\u9762\u4e2d\u6253\u5f00\u8fd9\u4e9b\u8ddf\u8e2a\u8bb0\u5f55\u3002</p> <p>Systrace \u662f\u5e73\u53f0\u63d0\u4f9b\u7684\u65e7\u7248\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u8bb0\u5f55\u77ed\u65f6\u95f4\u5185\u7684\u8bbe\u5907\u6d3b\u52a8\uff0c\u5e76\u4fdd\u5b58\u5728\u538b\u7f29\u7684\u6587\u672c\u6587\u4ef6\u4e2d\u3002\u8be5\u5de5\u5177\u4f1a\u751f\u6210\u4e00\u4efd\u62a5\u544a\uff0c\u5176\u4e2d\u6c47\u603b\u4e86 Android \u5185\u6838\u4e2d\u7684\u6570\u636e\uff0c\u4f8b\u5982 CPU \u8c03\u5ea6\u7a0b\u5e8f\u3001\u78c1\u76d8\u6d3b\u52a8\u548c\u5e94\u7528\u7ebf\u7a0b\u3002Systrace \u9002\u7528\u4e8e Android 4.3\uff08API \u7ea7\u522b 18\uff09\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u6240\u6709\u5e73\u53f0\u7248\u672c\uff0c\u4f46\u5efa\u8bae\u5c06 Perfetto \u7528\u4e8e\u8fd0\u884c Android 10 \u53ca\u66f4\u9ad8\u7248\u672c\u7684\u8bbe\u5907\u3002</p> <p>\u4e0b\u9762\u662fPerfetto \u8ddf\u8e2a\u8bb0\u5f55\u89c6\u56fe\u793a\u4f8b\uff0c\u5176\u4e2d\u663e\u793a\u4e86\u4e0e\u67d0\u4e2a\u5e94\u7528\u4e4b\u95f4\u5927\u7ea6 20 \u79d2\u7684\u4ea4\u4e92\u60c5\u51b5</p> <p></p> <p>\u4e0b\u9762 \u662fSystrace HTML \u62a5\u544a\u793a\u4f8b\uff0c\u5176\u4e2d\u663e\u793a\u4e86\u4e0e\u67d0\u4e2a\u5e94\u7528\u4e4b\u95f4 5 \u79d2\u7684\u4ea4\u4e92\u60c5\u51b5</p> <p></p> <p>\u8fd9\u4e24\u4efd\u62a5\u544a\u90fd\u63d0\u4f9b\u4e86 Android \u8bbe\u5907\u5728\u7ed9\u5b9a\u65f6\u95f4\u6bb5\u5185\u7684\u7cfb\u7edf\u8fdb\u7a0b\u7684\u603b\u4f53\u60c5\u51b5\u3002\u8be5\u62a5\u544a\u8fd8\u68c0\u67e5\u4e86\u6355\u83b7\u5230\u7684\u8ddf\u8e2a\u4fe1\u606f\uff0c\u4ee5\u7a81\u51fa\u663e\u793a\u53d1\u73b0\u7684\u95ee\u9898\uff08\u4f8b\u5982\u754c\u9762\u5361\u987f\u6216\u8017\u7535\u91cf\u9ad8\uff09\u3002</p> <p>Perfetto \u548c Systrace \u53ef\u4ea4\u4e92\u4f7f\u7528\uff1a</p> <p>\u5728 Perfetto \u754c\u9762\u4e2d\u6253\u5f00 Perfetto \u6587\u4ef6\u548c Systrace \u6587\u4ef6\u3002\u5728 Perfetto \u754c\u9762\u4e2d\u4f7f\u7528\u65e7\u7248 Systrace \u67e5\u770b\u5668\u6253\u5f00 Systrace \u6587\u4ef6\uff08\u4f7f\u7528 Open with legacy UI \u94fe\u63a5\uff09\u3002 \u4f7f\u7528 <code>traceconv</code> \u5de5\u5177\u5c06 Perfetto \u8ddf\u8e2a\u8bb0\u5f55\u8f6c\u6362\u4e3a\u65e7\u7248 Systrace \u6587\u672c\u683c\u5f0f\u3002</p>"},{"location":"tools/perfetto/perfetto_overview/#perfetto_2","title":"Perfetto \u7684\u4f18\u52bf","text":"<p>Perfetto \u63d0\u4f9b\u4e86 Systrace \u7684\u6240\u6709\u529f\u80fd\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u4e0e Systrace \u4e0d\u540c\uff0cPerfetto \u53ef\u4ee5\u8bb0\u5f55\u4efb\u610f\u957f\u5ea6\u7684\u8ddf\u8e2a\u8bb0\u5f55\u3002\u60a8\u53ef\u4ee5\u5728\u8bbe\u5907\u4e0a\u8fd0\u884c\u8ddf\u8e2a\u8bb0\u5f55\uff0c\u76f4\u5230\u60a8\u8ba4\u4e3a\u5df2\u6536\u96c6\u5230\u8db3\u591f\u7684\u6570\u636e\u4e3a\u6b62\u3002</li> <li>Perfetto \u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u6570\u636e\u6e90\uff0c\u5305\u62ec GPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u7535\u6c60\u548c\u66f4\u591a\u3002</li> <li>Perfetto \u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u8ddf\u8e2a\u8bb0\u5f55\u683c\u5f0f\uff0c\u5305\u62ec JSON\u3001HTML \u548c Protocol Buffer\u3002</li> <li>Perfetto \u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u8ddf\u8e2a\u8bb0\u5f55\u5206\u6790\u5de5\u5177\uff0c\u5305\u62ec \u547d\u4ee4\u884c\u5de5\u5177\u3001 Perfetto UI\u3001   \u901a\u8fc7\u8bbe\u5907\u76f4\u63a5\u6355\u6349\u8bb0\u5f55\u3002</li> </ul>"},{"location":"tools/perfetto/perfetto_overview/#perfetto_3","title":"Perfetto \u7684\u9650\u5236","text":"<ul> <li>Perfetto \u4e0d\u652f\u6301 Android 4.3\uff08API \u7ea7\u522b 18\uff09\u53ca\u66f4\u4f4e\u7248\u672c\u7684\u8bbe\u5907\u3002</li> </ul>"},{"location":"tools/perfetto/perfetto_overview/#perfetto_4","title":"\u4f7f\u7528 Perfetto","text":""},{"location":"tools/perfetto/perfetto_overview/#perfetto-ui","title":"Perfetto UI","text":"<p>Perfetto UI \u662f\u4e00\u4e2a Web \u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u5728\u6d4f\u89c8\u5668\u4e2d\u4f7f\u7528\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Perfetto UI \u67e5\u770b Perfetto \u8ddf\u8e2a\u8bb0\u5f55\uff0c\u4ee5\u53ca\u4f7f\u7528 Perfetto UI \u751f\u6210\u8ddf\u8e2a\u8bb0\u5f55\u3002</p> <p>\u9700\u8981\u5148\u505c\u6b62adb server(\u6267\u884c<code>adb kill-server</code>) \u5173\u6389Android Studio\u6216\u8005\u5176\u4ed6\u4f7f\u7528adb\u7684\u7a0b\u5e8f</p>"},{"location":"tools/vim/vim-common/","title":"Vim\u5e38\u7528\u547d\u4ee4","text":""},{"location":"tools/vim/vim-common/#_1","title":"\u4ee5\u4e0b\u547d\u4ee4\u8bf7\u5728\u666e\u901a\u6a21\u5f0f\u6267\u884c","text":"<p>1.\u79fb\u52a8\u5149\u6807</p> <ul> <li>j\uff1a\u5411\u4e0b</li> <li>20j\uff1a \u5411\u4e0b\u79fb\u52a8 20 \u884c</li> <li>k\uff1a\u5411\u4e0a</li> <li>h\uff1a\u5411\u5de6</li> <li>l\uff1a\u5411\u53f3</li> <li>0\uff1a\u5230\u884c\u9996</li> <li>^\uff1a\u5230\u884c\u9996\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u5982\u679c\u524d\u9762\u6709\u7a7a\u683c\u7684\u8bdd</li> <li>$\uff1a\u5230\u884c\u5c3e</li> <li>gg\uff1a\u5feb\u901f\u5230\u6587\u4ef6\u5934</li> <li>G\uff1a\u5feb\u901f\u5230\u6587\u4ef6\u5c3e</li> <li>50G\uff1a\u8df3\u8f6c\u5230\u7b2c 50 \u884c</li> </ul> <p>\u8bf7\u4e0d\u8981\u5728\u63d2\u5165\u6a21\u5f0f\u8fdb\u884c\u5149\u6807\u79fb\u52a8\uff0c\u6548\u7387\u5f88\u4f4e\u4e0b\u3002</p> <p>2.\u590d\u5236</p> <ul> <li>yy\uff1a\u590d\u5236\u4e00\u884c</li> <li>8yy\uff1a\u5411\u4e0b\u590d\u52368\u884c</li> <li>yw\uff1a\u590d\u5236\u5149\u6807\u5f00\u59cb\u7684\u4e00\u4e2a\u5355\u8bcd</li> <li>y$\uff1a\u590d\u5236\u5149\u6807\u5230\u884c\u5c3e</li> <li>yfA\uff1a\u590d\u5236\u5149\u6807\u5230\u7b2c\u4e00\u4e2a\u5927\u5199A\u4e2d\u95f4\u7684\u5185\u5bb9</li> <li>y2fA\uff1a\u590d\u5236\u5149\u6807\u5230\u7b2c\u4e8c\u4e2a\u5927\u5199A\u4e2d\u95f4\u7684\u5185\u5bb9</li> </ul> <p>3.\u526a\u5207</p> <ul> <li>x\uff1a\u5411\u540e\u526a\u5207\u4e00\u4e2a\u4e00\u4e2a\u5b57\u7b26\uff0c\u5982\u679c\u662f\u5728\u884c\u5c3e\uff0c\u5219\u4e3a\u5411\u524d\u526a\u5207</li> <li>4x\uff1a\u526a\u52074\u4e2a</li> <li>xp\uff1a\u975e\u884c\u5c3e\u4ea4\u6362\u4e24\u4e2a\u5b57\u7b26\uff0c\u5982\u4ecebs\u53d8\u6210sb</li> </ul> <p>4.\u5220\u9664</p> <ul> <li>dd\uff1a\u5220\u9664\u4e00\u884c</li> <li>100dd\uff1a\u5220\u9664100\u884c</li> <li>dw\uff1a\u5220\u9664\u4e00\u4e2a\u5355\u8bcd</li> <li>df\"\uff1a\u5220\u9664\u5230\u51fa\u73b0\u7684\u7b2c\u4e00\u4e2a\u53cc\u5f15\u53f7</li> <li>d^\uff1a\u5220\u9664\u81f3\u884c\u9996</li> </ul> <p>\u5220\u9664\u7684\u5185\u5bb9\u4f1a\u653e\u5230\u526a\u8d34\u677f\uff0c\u6309p\u5373\u53ef\u7c98\u8d34\u5230\u5176\u4ed6\u5730\u65b9\u3002</p> <p>5.\u7c98\u8d34</p> <ul> <li>p\uff1a\u7c98\u8d34\u590d\u5236\u6216\u526a\u5207\u7684\u5185\u5bb9</li> <li>5p\uff1a\u5c06\u590d\u5236\u6216\u526a\u5207\u7684\u5185\u5bb9\u7c98\u8d345\u6b21</li> </ul> <p>6.\u66ff\u6362\u548c\u64a4\u9500</p> <ul> <li>r+&lt;\u5f85\u66ff\u6362\u5b57\u6bcd&gt;\uff1a\u5c06\u6e38\u6807\u6240\u5728\u5b57\u6bcd\u66ff\u6362\u4e3a\u6307\u5b9a\u5b57\u6bcd</li> <li>R\uff1a\u8fde\u7eed\u66ff\u6362\uff0c\u76f4\u5230\u6309\u4e0bEsc</li> <li>cc\uff1a\u66ff\u6362\u6574\u884c\uff0c\u5373\u5220\u9664\u6e38\u6807\u6240\u5728\u884c\uff0c\u5e76\u8fdb\u5165\u63d2\u5165\u6a21\u5f0f</li> <li>cw\uff1a\u66ff\u6362\u4e00\u4e2a\u5355\u8bcd\uff0c\u5373\u5220\u9664\u4e00\u4e2a\u5355\u8bcd\uff0c\u5e76\u8fdb\u5165\u63d2\u5165\u6a21\u5f0f</li> <li>u{n}\uff1a\u64a4\u9500\u4e00\u6b21\u6216n\u6b21\u64cd\u4f5c</li> <li>U(\u5927\u5199)\uff1a\u64a4\u9500\u5f53\u524d\u884c\u7684\u6240\u6709\u4fee\u6539</li> <li>Ctrl+r\uff1aredo\uff0c\u5373\u64a4\u9500undo\u7684\u64cd\u4f5c</li> </ul> <p>7.\u9000\u51fa\u7f16\u8f91\u5668</p> <ul> <li>wq\uff1a\u4fdd\u5b58\u5f53\u524d\u6587\u4ef6\u5e76\u9000\u51fa</li> <li>wqa\uff1a\u4fdd\u5b58\u6240\u6709\u6587\u4ef6\u5e76\u9000\u51fa</li> <li>q!\uff1a \u4e0d\u4fdd\u5b58\uff0c\u5f3a\u5236\u9000\u51fa</li> <li>qa!\uff1a \u6709\u591a\u4e2a\u6587\u4ef6\u88ab\u6253\u5f00\uff0c\u540c\u65f6\u9000\u51fa</li> </ul>"},{"location":"tools/vim/vim-common/#_2","title":"\u4ee5\u4e0b\u547d\u4ee4\u8bf7\u5728\u547d\u4ee4\u6a21\u5f0f\u4e0b\u6267\u884c","text":"<p>\u5728\u666e\u901a\u6a21\u5f0f\u4e0b\uff0c\u8f93\u5165<code>:</code>\u5373\u53ef\u8fdb\u5165\u3002</p> <p>1. \u8c03\u6574\u6587\u672c</p> <ul> <li>%s/$/sth/ \uff1a\u5728\u884c\u5c3e\u8ffd\u52a0sth</li> <li>%s/^M//g \uff1a\u66ff\u6362\u6389dos\u6362\u884c\u7b26\uff0c^M\u4f7f\u7528ctrl+v + Enter\u5373\u53ef\u8f93\u5165</li> <li>:g/^\\s$/d* \uff1a\u5220\u9664\u7a7a\u884c\u4ee5\u53ca\u53ea\u6709\u7a7a\u683c\u7684\u884c</li> <li>%s/#.*//g \uff1a\u5220\u9664#\u4e4b\u540e\u7684\u5b57\u7b26</li> </ul> <p>\u6ca1\u9519\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f\u6b63\u5219\u3002</p> <ul> <li>ce\uff1a\u4f7f\u672c\u884c\u6587\u672c\u5185\u5bb9\u5c45\u4e2d</li> <li>ri\uff1a\u4f7f\u672c\u884c\u6587\u672c\u5185\u5bb9\u9760\u53f3</li> <li>le\uff1a\u4f7f\u672c\u884c\u6587\u672c\u5185\u5bb9\u9760\u5de6</li> </ul> <p>2. \u67e5\u627e\u5b57\u7b26\u4e32</p> <p>\u5728\u666e\u901a\u6a21\u5f0f\u4e0b\uff0c\u6309\u4e0b/\u76f4\u63a5\u8fdb\u5165\u67e5\u627e\uff0c\u8f93\u5165\u76f8\u5e94\u7684\u5b57\u7b26\u4e32\u6309\u786e\u5b9a\u5373\u53ef</p> <ul> <li>n\uff1a\u67e5\u627e\u4e0b\u4e00\u4e2a\u5339\u914d</li> <li>N\uff1a\u67e5\u627e\u4e0a\u4e00\u4e2a\u5339\u914d</li> <li>2n\uff1a\u67e5\u627e\u4e0b\u9762\u7b2c\u4e8c\u4e2a\u5339\u914d</li> </ul>"},{"location":"tools/vim/vim-common/#_3","title":"\u5e38\u7528\u7ec4\u5408\u547d\u4ee4","text":"<ul> <li>yyp: \u590d\u5236\u4e00\u884c\u5230\u4e0b\u4e00\u884c</li> </ul>"}]}