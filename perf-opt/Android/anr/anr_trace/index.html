
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="网站描述">
      
      
        <meta name="author" content="Adison">
      
      
        <link rel="canonical" href="https://adisonhuang.github.io/perf-opt/Android/anr/anr_trace/">
      
      
        <link rel="prev" href="../anr_monitor/">
      
      
        <link rel="next" href="../sp/">
      
      <link rel="icon" href="../../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.16">
    
    
      
        <title>ANR 分析 - Adison's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style>


    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-112420326-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="white">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#anr" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="Adison&#39;s Blog" class="md-header__button md-logo" aria-label="Adison's Blog" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Adison's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ANR 分析
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="white"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../front-end/" class="md-tabs__link">
        大前端
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../" class="md-tabs__link md-tabs__link--active">
        Android性能优化
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../native/" class="md-tabs__link">
        Native
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../design/" class="md-tabs__link">
        设计&架构
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../interview/" class="md-tabs__link">
        面试
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../basic/" class="md-tabs__link">
        计算机基础
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../tools/" class="md-tabs__link">
        开发工具
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../back-end/" class="md-tabs__link">
        后端&运维
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../game/" class="md-tabs__link">
        游戏开发
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../read/" class="md-tabs__link">
        读书笔记
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Adison&#39;s Blog" class="md-nav__button md-logo" aria-label="Adison's Blog" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    Adison's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          大前端
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          大前端
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/" class="md-nav__link">
        大前端
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
          Android
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Android
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_1" id="__nav_1_2_1_label" tabindex="0">
          必知必会
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2_1">
          <span class="md-nav__icon md-icon"></span>
          必知必会
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/daily/Android_animation/" class="md-nav__link">
        Android 动画原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/system/handler/" class="md-nav__link">
        Android消息机制-Handler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/daily/binder/" class="md-nav__link">
        解析Binder框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/daily/dialog_token/" class="md-nav__link">
        Dialog 对应的 Context 必须是 Activity吗？
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/daily/apk_analyze/" class="md-nav__link">
        APK文件分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/system/bootloader/" class="md-nav__link">
        Android 开机流程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/system/android-transform/" class="md-nav__link">
        Android Transform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/system/asm-basic/" class="md-nav__link">
        ASM 简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/system/ASM-Core-Api/" class="md-nav__link">
        ASM Core Api 详解
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_2" id="__nav_1_2_2_label" tabindex="0">
          Kotlin
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2_2">
          <span class="md-nav__icon md-icon"></span>
          Kotlin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/koltin/Kotlin_nline%2C%20noinline%2C%20crossinline/" class="md-nav__link">
        Kotlin中inline, noinline, crossinline的区别
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/koltin/Kotlin-takeIf-or-takeUnless/" class="md-nav__link">
        使用Kotlin takeIf（或takeUnless）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/koltin/Mastering%20Kotlin%20standard%20functions/" class="md-nav__link">
        掌握Kotlin标准函数：run, with, let, also and apply
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_3" id="__nav_1_2_3_label" tabindex="0">
          并发
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2_3">
          <span class="md-nav__icon md-icon"></span>
          并发
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/concurrency/thread-lifecycle/" class="md-nav__link">
        线程的生命周期，真的没那么简单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/concurrency/process%20and%20thread/" class="md-nav__link">
        进程与线程的一个简单解释
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/concurrency/basic/" class="md-nav__link">
        并发基础总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/concurrency/thread-pool/" class="md-nav__link">
        线程池总结
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_4" id="__nav_1_2_4_label" tabindex="0">
          JVM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2_4">
          <span class="md-nav__icon md-icon"></span>
          JVM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/jvm/memory-area/" class="md-nav__link">
        Java 内存区域详解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/jvm/jvm-garbage-collection/" class="md-nav__link">
        JVM 垃圾回收详解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/daily/Android_classloader/" class="md-nav__link">
        Android ClassLoader机制
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_5" id="__nav_1_2_5_label" tabindex="0">
          杂记
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2_5">
          <span class="md-nav__icon md-icon"></span>
          杂记
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/android/daily/flask_android_8/" class="md-nav__link">
        Mac10.14编译Android 8.1源码及刷入nexus 6p
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
      
      
      
        <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
          Flutter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Flutter
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/flutter/tools/fvm/" class="md-nav__link">
        使用fvm管理多个版本flutter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../front-end/flutter/learn/Dart/" class="md-nav__link">
        Dart 简介
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Android性能优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Android性能优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        性能优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          内存优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          内存优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/Android_memory_manager/" class="md-nav__link">
        Android内存管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/Android_memory_tools/" class="md-nav__link">
        Android 内存分析工具(命令行)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/Android_memory_tools_gc/" class="md-nav__link">
        Android 内存分析工具(查看GC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/MAT-Startup/" class="md-nav__link">
        Android 内存分析工具(MAT入门)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/MAT-Advanced/" class="md-nav__link">
        Android 内存分析工具(MAT进阶)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/Android_fd_leak/" class="md-nav__link">
        Android句柄泄漏分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/native-backtrace/" class="md-nav__link">
        Android Native 栈回溯
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/android-memory-gov/" class="md-nav__link">
        Android内存综合治理
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          崩溃优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          崩溃优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crash/crash_op/" class="md-nav__link">
        Android 崩溃优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crash/native-catch/" class="md-nav__link">
        Android 平台 Native 代码的崩溃捕获机制及实现
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crash/native-crash-signal/" class="md-nav__link">
        native 崩溃信号介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crash/KillApplicationHandler/" class="md-nav__link">
        为啥Android子线程抛出异常主线程会崩溃
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          启动优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          启动优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../launch/Android-launch-opt/" class="md-nav__link">
        Android启动优化
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
          包体积优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          包体积优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../size/Android-apk-size-opt/" class="md-nav__link">
        Android 包体积优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../size/douyin/" class="md-nav__link">
        从 Class 字节码入手精简 DEX 体积
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../size/Android-so-opt/" class="md-nav__link">
        Android对so体积优化的探索与实践
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
          卡顿优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          卡顿优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jank/jank-principle/" class="md-nav__link">
        Android卡顿掉帧问题分析之原理篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jank/jank-tool/" class="md-nav__link">
        Android卡顿掉帧问题分析之工具篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jank/jank-shizhan/" class="md-nav__link">
        Android卡顿掉帧问题分析之实战篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jank/jank-opt/" class="md-nav__link">
        Android卡顿优总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jank/cpu_use/" class="md-nav__link">
        Linux环境下进程的CPU占用率
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
          ANR优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          ANR优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../anr/" class="md-nav__link">
        ANR 原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../anr_monitor/" class="md-nav__link">
        ANR 监控
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ANR 分析
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ANR 分析
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anr_1" class="md-nav__link">
    前置知识：ANR原理概述
  </a>
  
    <nav class="md-nav" aria-label="前置知识：ANR原理概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anr_2" class="md-nav__link">
    ANR弹窗
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anr_3" class="md-nav__link">
    超时一定会出现ANR弹框吗？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-anr" class="md-nav__link">
    1. 导致ANR的原因
  </a>
  
    <nav class="md-nav" aria-label="1. 导致ANR的原因">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-anr" class="md-nav__link">
    1.1 应用层导致ANR（耗时操作）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-anr" class="md-nav__link">
    1.2 系统导致ANR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-anr" class="md-nav__link">
    2. ANR分析
  </a>
  
    <nav class="md-nav" aria-label="2. ANR分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-cpu" class="md-nav__link">
    2.1 CPU 负载
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 内存信息
  </a>
  
    <nav class="md-nav" aria-label="2.2 内存信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-trace" class="md-nav__link">
    2.2.1 trace文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-logcat" class="md-nav__link">
    2.2.2 Logcat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-eventlog" class="md-nav__link">
    2.2.3 eventlog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    2.3 堆栈消息
  </a>
  
    <nav class="md-nav" aria-label="2.3 堆栈消息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    2.3.1. 参数解读
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-anr" class="md-nav__link">
    2.4 ANR 分析思路
  </a>
  
    <nav class="md-nav" aria-label="2.4 ANR 分析思路">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anr_4" class="md-nav__link">
    ANR分析思路
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    疑难参数解释
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-anr" class="md-nav__link">
    3. ANR 案例分析
  </a>
  
    <nav class="md-nav" aria-label="3. ANR 案例分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 主线程耗时
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 主线程无卡顿，处于正常状态堆栈
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 主线程被锁阻塞
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-cpu" class="md-nav__link">
    3.4  CPU被抢占
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-anr" class="md-nav__link">
    3.5 内存紧张导致ANR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-binderanr" class="md-nav__link">
    3.6 系统服务超时(Binder阻塞等待)导致ANR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-binder" class="md-nav__link">
    3.7 Binder线程池耗尽
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    3.8 无效堆栈
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    参考
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sp/" class="md-nav__link">
        告别 SharedPreference 等待
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
      
      
      
        <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
          图片优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          图片优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bitmap/image/" class="md-nav__link">
        图片文件技术原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bitmap/imge-format/" class="md-nav__link">
        了解各种图形格式的编码方式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bitmap/bitmap-from-birth-to-death/" class="md-nav__link">
        Bitmap从出生到死亡
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bitmap/bitmap-memory/" class="md-nav__link">
        Bitmap 内存占用分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bitmap/glide/" class="md-nav__link">
        Glide 核心知识
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
      
      
      
        <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
          网络优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          网络优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../net/net_opt/" class="md-nav__link">
        移动网络优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../net/okhttp/" class="md-nav__link">
        OKhttp 核心解析
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
      
      
      
        <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
          基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../memory/Native-Hook/" class="md-nav__link">
        native-hook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../command/dumpsys/" class="md-nav__link">
        dumpsys
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../command/top/" class="md-nav__link">
        top命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../net/log/" class="md-nav__link">
        线上疑难问题该如何排查和跟踪？
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Native
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Native
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/" class="md-nav__link">
        C&C++
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          C/C++
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          C/C++
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/Cbasic/" class="md-nav__link">
        C基础知识
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/C%2B%2Bbasic/" class="md-nav__link">
        C++基础知识
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/compilation-principle/" class="md-nav__link">
        编译原理基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/pointer%281%29/" class="md-nav__link">
        深度长文教你彻底掌握C++/C指针(一):基石
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/pointer%282%29/" class="md-nav__link">
        深度长文教你彻底掌握C++/C指针(二):指针和数组与字符串
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/Cplus_auto/" class="md-nav__link">
        C++ auto类型推导完全攻略
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/Cplus_decltype/" class="md-nav__link">
        C++ decltype类型推导完全攻略
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/Cplus_nullptr/" class="md-nav__link">
        C++11 nullptr：初始化空指针
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/Cplus_shared_ptr/" class="md-nav__link">
        C++11 shared_ptr智能指针
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          JNI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          JNI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/JNI/JNI-op/" class="md-nav__link">
        JNI优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/JNI/Android-JNI/" class="md-nav__link">
        JNI使用总结
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          疑难问题
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          疑难问题
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../native/basic/__emutls_get_address/" class="md-nav__link">
        dlopen时找不到__emutls_get_address符号
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          设计&架构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          设计&架构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/" class="md-nav__link">
        设计 & 架构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/framework%20design/" class="md-nav__link">
        架构设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/Design%20Principles/" class="md-nav__link">
        六大设计原则
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/design-patterns/" class="md-nav__link">
        设计模式概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
          设计模式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          设计模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_5_1" id="__nav_4_5_1_label" tabindex="0">
          创建型模式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5_1">
          <span class="md-nav__icon md-icon"></span>
          创建型模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/index_creational/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/singleton/" class="md-nav__link">
        单例
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/factory/" class="md-nav__link">
        工厂模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/prototype/" class="md-nav__link">
        原型模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/builder/" class="md-nav__link">
        建造者模式
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_5_2" id="__nav_4_5_2_label" tabindex="0">
          结构型模式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5_2">
          <span class="md-nav__icon md-icon"></span>
          结构型模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/index_structural/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/adapter/" class="md-nav__link">
        适配器模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/proxy/" class="md-nav__link">
        代理模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/facade/" class="md-nav__link">
        外观模式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/wrapper/" class="md-nav__link">
        装饰模式
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_5_3" id="__nav_4_5_3_label" tabindex="0">
          行为模式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5_3">
          <span class="md-nav__icon md-icon"></span>
          行为模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/index_behavioral/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/strategy/" class="md-nav__link">
        策略模式
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/design-patterns/summary/" class="md-nav__link">
        总结
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
      
      
      
        <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
          其他
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          其他
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/other/fail-fast%26fail-safe/" class="md-nav__link">
        fail-fast&fail-safe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design/other/singleton_extra/" class="md-nav__link">
        各种单例写法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          面试
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          面试
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/" class="md-nav__link">
        Android面试题题目
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          Android
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Android
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/android_components/" class="md-nav__link">
        Android 四大组件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/android_screen/" class="md-nav__link">
        Android 屏幕适配
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/android_communication/" class="md-nav__link">
        Android 通信相关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/android_view/" class="md-nav__link">
        Android 视图相关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/android_event/" class="md-nav__link">
        Android 事件相关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/android_sys/" class="md-nav__link">
        Android 系统原理
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/java_basic/" class="md-nav__link">
        Java 基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/java_collection/" class="md-nav__link">
        Java 容器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/java_thread/" class="md-nav__link">
        Java 多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../interview/java_jvm/" class="md-nav__link">
        Java JVM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          计算机基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          计算机基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/" class="md-nav__link">
        计算机基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          操作系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          操作系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/system/shell/" class="md-nav__link">
        shell核心语法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          网络
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          网络
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/net/net/" class="md-nav__link">
        基础知识
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/net/5g/" class="md-nav__link">
        讲清楚5G
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          数据结构与算法
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          数据结构与算法
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_1" id="__nav_6_4_1_label" tabindex="0">
          数组
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_1">
          <span class="md-nav__icon md-icon"></span>
          数组
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/array_algo_1/" class="md-nav__link">
        实现一个支持动态扩容的数组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/array_algo_2/" class="md-nav__link">
        实现一个大小固定的有序数组，支持动态增删改操作
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/array_algo_3/" class="md-nav__link">
        合并两个有序数组
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_2" id="__nav_6_4_2_label" tabindex="0">
          链表
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_2">
          <span class="md-nav__icon md-icon"></span>
          链表
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/linklist_1/" class="md-nav__link">
        实现单链表、循环链表、双向链表，支持增删操作
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/linklist_lru/" class="md-nav__link">
        实现LRU缓存
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/linklist_2/" class="md-nav__link">
        常见链表操作
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_3" id="__nav_6_4_3_label" tabindex="0">
          栈
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_3">
          <span class="md-nav__icon md-icon"></span>
          栈
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/stack_1/" class="md-nav__link">
        顺序栈、链式栈
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/stack_2/" class="md-nav__link">
        常见栈操作
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_4" id="__nav_6_4_4_label" tabindex="0">
          队列
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_4">
          <span class="md-nav__icon md-icon"></span>
          队列
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/queue/" class="md-nav__link">
        常见队列实现
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_5" id="__nav_6_4_5_label" tabindex="0">
          递归
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_5">
          <span class="md-nav__icon md-icon"></span>
          递归
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/recursive/" class="md-nav__link">
        常见递归算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_6" id="__nav_6_4_6_label" tabindex="0">
          排序与二分查找
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_6">
          <span class="md-nav__icon md-icon"></span>
          排序与二分查找
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/sort/" class="md-nav__link">
        常见排序算法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/bsearch/" class="md-nav__link">
        二分查找算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_7" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_7" id="__nav_6_4_7_label" tabindex="0">
          散列表
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_7">
          <span class="md-nav__icon md-icon"></span>
          散列表
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/hashTable/" class="md-nav__link">
        常见散列表实现
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_8" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_8" id="__nav_6_4_8_label" tabindex="0">
          二叉树
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_8">
          <span class="md-nav__icon md-icon"></span>
          二叉树
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/tree/" class="md-nav__link">
        二叉查找树
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_9" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_9" id="__nav_6_4_9_label" tabindex="0">
          堆
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_9">
          <span class="md-nav__icon md-icon"></span>
          堆
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/heap/" class="md-nav__link">
        小顶堆、大顶堆、优先级队列
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../basic/algo/heap_1/" class="md-nav__link">
        常见堆算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          开发工具
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          开发工具
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tools/" class="md-nav__link">
        开发工具
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          GIT
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          GIT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tools/git/git_submodule/" class="md-nav__link">
        Git submodule 子模块的管理和使用
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
      
      
      
        <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
          VIM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          VIM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tools/vim/vim-common/" class="md-nav__link">
        Vim常用命令
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          后端&运维
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          后端&运维
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../back-end/" class="md-nav__link">
        后端&运维
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
      
      
      
        <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../back-end/python/python_func_time/" class="md-nav__link">
        python函数执行时间分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../back-end/python/centos_flask/" class="md-nav__link">
        CentOS部署flask项目
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../back-end/python/pycharm_remote_debug/" class="md-nav__link">
        Pycharm远程调试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../back-end/python/PyCharm_root_debug/" class="md-nav__link">
        以Root权限运行/调试 PyCharm
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          游戏开发
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          游戏开发
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../game/" class="md-nav__link">
        游戏开发
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../game/perf/tools/" class="md-nav__link">
        Unity3D性能优化——工具篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../game/perf/cpu/" class="md-nav__link">
        Unity3D性能优化——CPU篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../game/perf/render/" class="md-nav__link">
        Unity3D性能优化——渲染篇
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          读书笔记
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          读书笔记
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/" class="md-nav__link">
        开卷有益
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/jvm/jvm/" class="md-nav__link">
        《深入理解java虚拟机》阅读笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_3" >
      
      
      
        <label class="md-nav__link" for="__nav_10_3" id="__nav_10_3_label" tabindex="0">
          《数据结构与算法之美》笔记
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_3">
          <span class="md-nav__icon md-icon"></span>
          《数据结构与算法之美》笔记
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/Complexity%20Analysis/" class="md-nav__link">
        复杂度分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/array/" class="md-nav__link">
        数组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/linked-list/" class="md-nav__link">
        链表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/stack/" class="md-nav__link">
        栈
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/queue/" class="md-nav__link">
        队列
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/recursion/" class="md-nav__link">
        递归
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/basic_sort/" class="md-nav__link">
        基础排序算法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/sort-advance/" class="md-nav__link">
        高级排序算法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/sort-op/" class="md-nav__link">
        排序优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/bsearch/" class="md-nav__link">
        二分查找
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/skip-list/" class="md-nav__link">
        跳表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/hashmap/" class="md-nav__link">
        散列表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/hashalgo.md" class="md-nav__link">
        哈希算法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/binary-tree/" class="md-nav__link">
        二叉树
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/Red-Black-Tree/" class="md-nav__link">
        红黑树
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/digui-tree/" class="md-nav__link">
        递归树
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../read/beautiful-algo/heap/" class="md-nav__link">
        堆
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anr_1" class="md-nav__link">
    前置知识：ANR原理概述
  </a>
  
    <nav class="md-nav" aria-label="前置知识：ANR原理概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anr_2" class="md-nav__link">
    ANR弹窗
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anr_3" class="md-nav__link">
    超时一定会出现ANR弹框吗？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-anr" class="md-nav__link">
    1. 导致ANR的原因
  </a>
  
    <nav class="md-nav" aria-label="1. 导致ANR的原因">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-anr" class="md-nav__link">
    1.1 应用层导致ANR（耗时操作）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-anr" class="md-nav__link">
    1.2 系统导致ANR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-anr" class="md-nav__link">
    2. ANR分析
  </a>
  
    <nav class="md-nav" aria-label="2. ANR分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-cpu" class="md-nav__link">
    2.1 CPU 负载
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 内存信息
  </a>
  
    <nav class="md-nav" aria-label="2.2 内存信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-trace" class="md-nav__link">
    2.2.1 trace文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-logcat" class="md-nav__link">
    2.2.2 Logcat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-eventlog" class="md-nav__link">
    2.2.3 eventlog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    2.3 堆栈消息
  </a>
  
    <nav class="md-nav" aria-label="2.3 堆栈消息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    2.3.1. 参数解读
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-anr" class="md-nav__link">
    2.4 ANR 分析思路
  </a>
  
    <nav class="md-nav" aria-label="2.4 ANR 分析思路">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anr_4" class="md-nav__link">
    ANR分析思路
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    疑难参数解释
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-anr" class="md-nav__link">
    3. ANR 案例分析
  </a>
  
    <nav class="md-nav" aria-label="3. ANR 案例分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 主线程耗时
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 主线程无卡顿，处于正常状态堆栈
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 主线程被锁阻塞
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-cpu" class="md-nav__link">
    3.4  CPU被抢占
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-anr" class="md-nav__link">
    3.5 内存紧张导致ANR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-binderanr" class="md-nav__link">
    3.6 系统服务超时(Binder阻塞等待)导致ANR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-binder" class="md-nav__link">
    3.7 Binder线程池耗尽
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    3.8 无效堆栈
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    参考
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="anr">ANR 分析<a class="headerlink" href="#anr" title="Permanent link">&para;</a></h1>
<h2 id="anr_1">前置知识：ANR原理概述<a class="headerlink" href="#anr_1" title="Permanent link">&para;</a></h2>
<h3 id="anr_2">ANR弹窗<a class="headerlink" href="#anr_2" title="Permanent link">&para;</a></h3>
<p><strong>弹出ANR对话框的message标识</strong></p>
<blockquote>
<p>ActivityManagerService.java#SHOW_NOT_RESPONDING_UI_MSG</p>
</blockquote>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleMessage</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">what</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">       </span><span class="p">...</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">SHOW_NOT_RESPONDING_UI_MSG</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">            </span><span class="n">mAppErrors</span><span class="p">.</span><span class="na">handleShowAnrUi</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">            </span><span class="n">ensureBootCompleted</span><span class="p">();</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="p">...</span>
</code></pre></div>
其调用<code>AppErrors</code>的<code>handleShowAnrUi</code>方法，这个方法里面它会创建一个<code>AppNotRespondingDialog</code>(系统的自定义Dialog)，最终会以<code>TYPE_SYSTEM_ERROR</code>的方式弹出。
<strong>所以，弹出ANR对话框的条件就是AMS中的UiHandler收到了what为SHOW_NOT_RESPONDING_UI_MSG的消息</strong></p>
<p><strong>这个消息是在哪里发出</strong></p>
<blockquote>
<p>ProcessErrorStateRecord#appNotResponding</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">appNotResponding</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">mService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">            </span><span class="p">...</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isSilentAnr</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">mApp</span><span class="p">.</span><span class="na">isDebugging</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">                </span><span class="n">mApp</span><span class="p">.</span><span class="na">killLocked</span><span class="p">(</span><span class="s">&quot;bg anr&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ApplicationExitInfo</span><span class="p">.</span><span class="na">REASON_ANR</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">                </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">            </span><span class="p">...</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mService</span><span class="p">.</span><span class="na">mUiHandler</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">                </span><span class="c1">// Bring up the infamous App Not Responding dialog</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">                </span><span class="n">Message</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">.</span><span class="na">obtain</span><span class="p">();</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">                </span><span class="n">msg</span><span class="p">.</span><span class="na">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActivityManagerService</span><span class="p">.</span><span class="na">SHOW_NOT_RESPONDING_UI_MSG</span><span class="p">;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">                </span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AppNotRespondingDialog</span><span class="p">.</span><span class="na">Data</span><span class="p">(</span><span class="n">mApp</span><span class="p">,</span><span class="w"> </span><span class="n">aInfo</span><span class="p">,</span><span class="w"> </span><span class="n">aboveSystem</span><span class="p">);</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">                </span><span class="n">mService</span><span class="p">.</span><span class="na">mUiHandler</span><span class="p">.</span><span class="na">sendMessageDelayed</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">anrDialogDelayMs</span><span class="p">);</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="p">}</span>
</code></pre></div>
<p>可以看到，在这个方法里会给AMS(那个mService就是AMS的实例)的UiHandler发送请求弹出ANR对话框，那到底在哪些地方调用这个方法的呢？
一共有5处，分别是：</p>
<ul>
<li>ActiveServices#serviceTimeout方法<ul>
<li>后台服务超时</li>
</ul>
</li>
<li>ActiveServices#serviceForegroundTimeout；<ul>
<li>前台服务超时</li>
</ul>
</li>
<li>ActivityManagerService#appNotRespondingViaProvider；<ul>
<li>通过Provider发出的无响应</li>
</ul>
</li>
<li>BroadcastQueue#broadcastTimeoutLocked<ul>
<li>有序广播超时    </li>
</ul>
</li>
<li>ActivityManagerService#inputDispatchingTimedOut；<ul>
<li>input事件分派的时候超时(处理事件时被阻塞)所发出的，input事件，这里分两种，一种是KeyEvent(按键)，另一种是MotionEvent(触摸)。</li>
</ul>
</li>
</ul>
<h3 id="anr_3">超时一定会出现ANR弹框吗？<a class="headerlink" href="#anr_3" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>SilentAnr</code>不会弹窗</strong>，
所谓“沉默的ANR”，其实就是后台ANR，后台ANR跟前台ANR会有不同的表现：<strong>前台ANR会弹无响应的Dialog，后台ANR会直接杀死进程</strong>。前后台ANR的判断的原则是：<strong>如果发生ANR的进程对用户来说是有感知的，就会被认为是前台ANR，否则是后台ANR</strong>。另外，如果在开发者选项中勾选了“显示后台ANR”，那么全部ANR都会被认为是前台ANR。
    <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>//<span class="w"> </span>A<span class="w"> </span>package<span class="w"> </span>is<span class="w"> </span>considered<span class="w"> </span>interesting<span class="w"> </span><span class="k">if</span><span class="w"> </span>any<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>is<span class="w"> </span><span class="nb">true</span><span class="w"> </span>:
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>//
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>//<span class="w"> </span>-<span class="w"> </span>It<span class="s1">&#39;s displaying an activity.</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="s1">// - It&#39;</span>s<span class="w"> </span>the<span class="w"> </span>SystemUI.
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>//<span class="w"> </span>-<span class="w"> </span>It<span class="w"> </span>has<span class="w"> </span>an<span class="w"> </span>overlay<span class="w"> </span>or<span class="w"> </span>a<span class="w"> </span>top<span class="w"> </span>UI<span class="w"> </span>visible.
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>//
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>//<span class="w"> </span>NOTE:<span class="w"> </span>The<span class="w"> </span>check<span class="w"> </span>whether<span class="w"> </span>a<span class="w"> </span>given<span class="w"> </span>ProcessRecord<span class="w"> </span>belongs<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>systemui
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>//<span class="w"> </span>process<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>bit<span class="w"> </span>of<span class="w"> </span>a<span class="w"> </span>kludge,<span class="w"> </span>but<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>pattern<span class="w"> </span>seems<span class="w"> </span>repeated<span class="w"> </span>at
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>//<span class="w"> </span>several<span class="w"> </span>places<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>system<span class="w"> </span>server.
</code></pre></div></li>
<li><strong>input事件分派超时处于debug或者来自子进程(这个情况下会直接kill掉子进程)不会弹窗</strong><blockquote>
<p>ActivityManagerService.java#inputDispatchingTimedOut</p>
</blockquote>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">inputDispatchingTimedOut</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">                </span><span class="c1">//1.处于debug</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="na">isDebugging</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">                </span><span class="c1">//2. 来自子进程</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="na">getActiveInstrumentation</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">                    </span><span class="n">Bundle</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Bundle</span><span class="p">();</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;shortMsg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;keyDispatchingTimedOut&quot;</span><span class="p">);</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">                    </span><span class="n">info</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;longMsg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">annotation</span><span class="p">);</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">                    </span><span class="n">finishInstrumentationLocked</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">.</span><span class="na">RESULT_CANCELED</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">);</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">            </span><span class="n">mAnrHelper</span><span class="p">.</span><span class="na">appNotResponding</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span><span class="w"> </span><span class="n">activityShortComponentName</span><span class="p">,</span><span class="w"> </span><span class="n">aInfo</span><span class="p">,</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">                    </span><span class="n">parentShortComponentName</span><span class="p">,</span><span class="w"> </span><span class="n">parentProcess</span><span class="p">,</span><span class="w"> </span><span class="n">aboveSystem</span><span class="p">,</span><span class="w"> </span><span class="n">annotation</span><span class="p">);</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<blockquote>
<p>ActivityManagerService.java#attachApplicationLocked</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">attachApplicationLocked</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">ProfilerInfo</span><span class="w"> </span><span class="n">profilerInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mAppProfiler</span><span class="p">.</span><span class="na">setupProfilerInfoLocked</span><span class="p">(</span><span class="n">thread</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">instr</span><span class="p">);</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<blockquote>
<p>AppProfiler.java#setupProfilerInfoLocked</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">    </span><span class="n">ProfilerInfo</span><span class="w"> </span><span class="nf">setupProfilerInfoLocked</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">            </span><span class="p">...</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">         </span><span class="c1">// 检查是否是子进程   </span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">        </span><span class="c1">// Check if this is a secondary process that should be incorporated into some</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="c1">// currently active instrumentation.  (Note we do this AFTER all of the profiling</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="c1">// stuff above because profiling can currently happen only in the primary</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">        </span><span class="c1">// instrumentation process.)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mService</span><span class="p">.</span><span class="na">mActiveInstrumentation</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">instr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">             </span><span class="n">app</span><span class="p">.</span><span class="na">setActiveInstrumentation</span><span class="p">(</span><span class="n">aInstr</span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">             </span><span class="p">...</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">         </span><span class="p">}</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">         </span><span class="p">...</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<h2 id="1-anr">1. 导致ANR的原因<a class="headerlink" href="#1-anr" title="Permanent link">&para;</a></h2>
<p>很多开发者认为，那就是耗时操作导致ANR，全部是app应用层的问题。实际上，线上环境大部分ANR由系统原因导致。</p>
<h3 id="11-anr">1.1 应用层导致ANR（耗时操作）<a class="headerlink" href="#11-anr" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>主线程耗时</strong>：如死循环、主线程IO、处理大数据</p>
</li>
<li>
<p><strong>锁出错</strong>：主线程等待子线程的锁</p>
</li>
<li>
<p><strong>内存紧张</strong>：系统分配给一个应用的内存是有上限的，长期处于内存紧张，会导致频繁内存交换，进而导致应用的一些操作超时</p>
</li>
</ul>
<h3 id="12-anr">1.2 系统导致ANR<a class="headerlink" href="#12-anr" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>CPU被抢占</strong>：一般来说，前台在玩游戏，可能会导致你的后台广播被抢占CPU</p>
</li>
<li>
<p><strong>系统服务无法及时响应</strong>：比如获取系统联系人等，系统的服务都是Binder机制，服务能力也是有限的，有可能系统服务长时间不响应导致ANR</p>
</li>
<li>
<p><strong>其他应用占用的大量内存</strong></p>
</li>
</ul>
<h2 id="2-anr">2. ANR分析<a class="headerlink" href="#2-anr" title="Permanent link">&para;</a></h2>
<h3 id="21-cpu">2.1 CPU 负载<a class="headerlink" href="#21-cpu" title="Permanent link">&para;</a></h3>
<p>发生ANR时， 在<code>Logcat</code>中搜索<code>ANR in</code>关键词</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Load:<span class="w"> </span><span class="m">2</span>.62<span class="w"> </span>/<span class="w"> </span><span class="m">2</span>.55<span class="w"> </span>/<span class="w"> </span><span class="m">2</span>.25
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>CPU<span class="w"> </span>usage<span class="w"> </span>from<span class="w"> </span>0ms<span class="w"> </span>to<span class="w"> </span>1987ms<span class="w"> </span>later<span class="w"> </span><span class="o">(</span><span class="m">2020</span>-03-10<span class="w"> </span><span class="m">08</span>:31:55.169<span class="w"> </span>to<span class="w"> </span><span class="m">2020</span>-03-10<span class="w"> </span><span class="m">08</span>:32:17.156<span class="o">)</span>:
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="m">41</span>%<span class="w"> </span><span class="m">2080</span>/system_server:<span class="w"> </span><span class="m">28</span>%<span class="w"> </span>user<span class="w"> </span>+<span class="w"> </span><span class="m">12</span>%<span class="w"> </span>kernel<span class="w"> </span>/<span class="w"> </span>faults:<span class="w"> </span><span class="m">76445</span><span class="w"> </span>minor<span class="w"> </span><span class="m">180</span><span class="w"> </span>major
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="m">26</span>%<span class="w"> </span><span class="m">9378</span>/com.xiaomi.store:<span class="w"> </span><span class="m">20</span>%<span class="w"> </span>user<span class="w"> </span>+<span class="w"> </span><span class="m">6</span>.8%<span class="w"> </span>kernel<span class="w"> </span>/<span class="w"> </span>faults:<span class="w"> </span><span class="m">68408</span><span class="w"> </span>minor<span class="w"> </span><span class="m">68</span><span class="w"> </span>major
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>........省略N行.....
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="m">66</span>%<span class="w"> </span>TOTAL:<span class="w"> </span><span class="m">20</span>%<span class="w"> </span>user<span class="w"> </span>+<span class="w"> </span><span class="m">15</span>%<span class="w"> </span>kernel<span class="w"> </span>+<span class="w"> </span><span class="m">28</span>%<span class="w"> </span>iowait<span class="w"> </span>+<span class="w"> </span><span class="m">0</span>.7%<span class="w"> </span>irq<span class="w"> </span>+<span class="w"> </span><span class="m">0</span>.7%<span class="w"> </span>softirq
</code></pre></div>
<ul>
<li>第一行：1、5、15 分钟内正在使用和等待使用CPU 的活动进程的平均数</li>
<li>第二行：表明负载信息抓取在ANR发生之后的0~1987ms。同时也指明了ANR的时间点：2020-03-10 08:31:55.169</li>
<li>中间部分：各个进程占用的CPU的详细情况</li>
<li>最后一行：各个进程合计占用的CPU信息。</li>
</ul>
<p><strong>名词解释：</strong></p>
<ul>
<li>
<p>user:用户态</p>
</li>
<li>
<p>kernel:内核态</p>
</li>
<li>
<p>faults:内存缺页，minor——轻微的，major——重度，需要从磁盘拿数据</p>
</li>
<li>
<p>iowait:IO使用（等待）占比</p>
</li>
<li>
<p>irq:硬中断，softirq:软中断</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">中断</p>
<p>中断机制：CPU在执行指令时，收到某个中断信号转而去执行预先设定好的代码，然后再返回到原指令流中继续执行，这就是中断机制。</p>
<p>中断分为硬中断和软中断，硬中断是由外部设备发出的中断，如键盘、鼠标、网卡、硬盘等，软中断是由CPU内部产生的中断，如系统调用、异常等。</p>
<p>缺页中断： malloc()和mmap()等内存分配函数，在分配时只是建立了进程虚拟地址空间，并没有分配虚拟内存对应的物理内存。当进程访问这些没有建立映射关系的虚拟内存时，处理器自动触发一个缺页中断，此时CPU会暂停当前进程的执行，去执行缺页中断的处理程序，处理完后再返回到原进程中继续执行。</p>
<p>minor&amp;major： minor是指内存页不在内存中，但是在swap分区中，major是指内存页不在内存中，也不在swap分区中，需要从磁盘中读取。</p>
</div>
<p><strong>注意：</strong></p>
<ul>
<li>iowait占比很高，意味着有很大可能，是io耗时导致ANR，具体进一步查看有没有进程<code>faults major</code>比较多。</li>
<li>单进程CPU的负载并不是以100%为上限，而是有几个核，就有百分之几百，如4核上限为400%。</li>
</ul>
<blockquote>
<p>CPU 负载高现象也会体现在log日志中，搜索<code>slow_operation</code>, 如果存在，可能CPU负载过高，系统进程的调度也会受到影响。</p>
</blockquote>
<h3 id="22">2.2 内存信息<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<h4 id="221-trace">2.2.1 trace文件<a class="headerlink" href="#221-trace" title="Permanent link">&para;</a></h4>
<p>发生ANR的时候，系统会产生一份anr日志文件（手机的<code>data/anr/trace</code> 或者<code>data/system/dropbox</code>目录下，文件名称可能各厂商不一样，业内大多称呼为trace文件。</p>
<p>要是从上面得不到trace文件，也可以通过<code>adb bugreport</code>尝试获取。trace文件中有应用内存信息，如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">-----</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="mi">8034</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">02</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">04</span><span class="w"> </span><span class="o">-----</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">Cmd</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">adison</span><span class="p">.</span><span class="na">notes</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">....</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1">//省略N行</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">....</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c1">//已分配堆内存大小8762KB,其中3570KB已用，总分配89339个对象</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="nl">Heap</span><span class="p">:</span><span class="w"> </span><span class="mi">59</span><span class="o">%</span><span class="w"> </span><span class="n">free</span><span class="p">,</span><span class="w"> </span><span class="mi">3570</span><span class="n">KB</span><span class="o">/</span><span class="mi">8762</span><span class="n">KB</span><span class="p">;</span><span class="w"> </span><span class="mi">89339</span><span class="w"> </span><span class="n">objects</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="p">....</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="c1">//省略N行</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="p">....</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="c1">// 进程创建到现在一共创建了多少对象</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="n">Total</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">allocations</span><span class="w"> </span><span class="mi">127155</span><span class="w"> </span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="c1">//进程创建到现在一共申请了多少内存</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">Total</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">allocated</span><span class="w"> </span><span class="mi">6162</span><span class="n">KB</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="c1">//进程创建到现在一共释放了多少内存</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">Total</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">freed</span><span class="w"> </span><span class="mi">2591</span><span class="n">KB</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="c1">//不扩展堆的情况下可用的内存</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="n">Free</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="mi">5191</span><span class="n">KB</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="c1">//GC前的可用内存</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="n">Free</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">GC</span><span class="w"> </span><span class="mi">5191</span><span class="n">KB</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="c1">//OOM之前的可用内存</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="n">Free</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">OOME</span><span class="w"> </span><span class="mi">252</span><span class="n">MB</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="c1">//当前总内存（已用+可用）</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="n">Total</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="mi">8762</span><span class="n">KB</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="c1">//进程最多能申请的内存</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="n">Max</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="mi">256</span><span class="n">MB</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="p">....</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="c1">//省略N行</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="p">....</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="n">suspend</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">histogram</span><span class="p">:</span><span class="w">  </span><span class="n">Sum</span><span class="p">:</span><span class="w"> </span><span class="mi">275</span><span class="n">us</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="w"> </span><span class="n">C</span><span class="p">.</span><span class="na">I</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="n">us</span><span class="o">-</span><span class="mf">92.160</span><span class="n">us</span><span class="w"> </span><span class="n">Avg</span><span class="p">:</span><span class="w"> </span><span class="mf">17.187</span><span class="n">us</span><span class="w"> </span><span class="n">Max</span><span class="p">:</span><span class="w"> </span><span class="mi">94</span><span class="n">us</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="c1">//当前进程共15个线程</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="n">DALVIK</span><span class="w"> </span><span class="nf">THREADS</span><span class="w"> </span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">Runnable</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x723b3830</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0xe3540e10</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">8034</span><span class="w"> </span><span class="n">nice</span><span class="o">=-</span><span class="mi">10</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0xed7bd474</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">27494067641</span><span class="w"> </span><span class="mi">658836178</span><span class="w"> </span><span class="mi">2642</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">2723</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">25</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">7</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0xff1e5000</span><span class="o">-</span><span class="mh">0xff1e7000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">8192</span><span class="n">KB</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mutator lock&quot;</span><span class="p">(</span><span class="n">shared</span><span class="w"> </span><span class="n">held</span><span class="p">)</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">adison</span><span class="p">.</span><span class="na">notes</span><span class="p">.</span><span class="na">anr</span><span class="p">.</span><span class="na">ANRTest</span><span class="p">.</span><span class="na">makeMainThreadAnr</span><span class="p">(</span><span class="n">ANRTest</span><span class="p">.</span><span class="na">kt</span><span class="p">:</span><span class="mi">21</span><span class="p">)</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">reflect</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">androidx</span><span class="p">.</span><span class="na">appcompat</span><span class="p">.</span><span class="na">app</span><span class="p">.</span><span class="na">AppCompatViewInflater$DeclaredOnClickListener</span><span class="p">.</span><span class="na">onClick</span><span class="p">(</span><span class="n">AppCompatViewInflater</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">409</span><span class="p">)</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">performClick</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">8160</span><span class="p">)</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">widget</span><span class="p">.</span><span class="na">TextView</span><span class="p">.</span><span class="na">performClick</span><span class="p">(</span><span class="n">TextView</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">16222</span><span class="p">)</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">google</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">material</span><span class="p">.</span><span class="na">button</span><span class="p">.</span><span class="na">MaterialButton</span><span class="p">.</span><span class="na">performClick</span><span class="p">(</span><span class="n">MaterialButton</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1119</span><span class="p">)</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">performClickInternal</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">8137</span><span class="p">)</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">access$3700</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">888</span><span class="p">)</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View$PerformClick</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">30236</span><span class="p">)</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">handleCallback</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">938</span><span class="p">)</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">dispatchMessage</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">99</span><span class="p">)</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">(</span><span class="n">Looper</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">246</span><span class="p">)</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">app</span><span class="p">.</span><span class="na">ActivityThread</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">8512</span><span class="p">)</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">reflect</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">RuntimeInit$MethodAndArgsCaller</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">RuntimeInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">602</span><span class="p">)</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1130</span><span class="p">)</span>
</code></pre></div>
<p>从含义可以得出结论：<strong>Free memory until OOME</strong> 的值很小的时候，已经处于内存紧张状态。应用可能是占用了过多内存</p>
<h4 id="222-logcat">2.2.2 Logcat<a class="headerlink" href="#222-logcat" title="Permanent link">&para;</a></h4>
<p>我们知道通常内存紧张的时候，kswapd线程会活跃起来进行回收内存。查看CPU 负载时要是 <strong>kswapd的CPU占据排进top3的话，这个问题受系统低内存影响比较大</strong>。</p>
<p><a class="glightbox" href="../assets/ebafe2d9-15ab-42b5-b6d8-b9eb466895a2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../assets/ebafe2d9-15ab-42b5-b6d8-b9eb466895a2.png" /></a></p>
<p>另外这个时候，搜索<code>lowmemorykiller</code>关键词，如果存在则查看发生时间和ANR时间是否大致对应，相差无几的话, 可以看到问题时间区域会有较多的查杀进程行为，我们通常会关注下"lowmemorykiller"这一行杀的进程adj值，adj值越低，说明当前系统内存越吃紧。</p>
<h4 id="223-eventlog">2.2.3 eventlog<a class="headerlink" href="#223-eventlog" title="Permanent link">&para;</a></h4>
<p>另外，除了trace文件中有内存信息，普通的<code>eventlog</code>日志中，也有内存信息</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="m">04</span>-02<span class="w"> </span><span class="m">22</span>:00:08.195<span class="w">  </span><span class="m">1531</span><span class="w">  </span><span class="m">1544</span><span class="w"> </span>I<span class="w"> </span>am_meminfo:<span class="w"> </span><span class="o">[</span><span class="m">350937088</span>,41086976,492830720,427937792,291887104<span class="o">]</span>
</code></pre></div>
<p>以上四个值分别指的是：</p>
<ul>
<li>Cached</li>
<li>Free,</li>
<li>Zram,</li>
<li>Kernel,Native</li>
</ul>
<p>Cached+Free的内存代表着当前整个手机的可用内存，如果值很小，意味着处于内存紧张状态。一般低内存的判定阈值为：4G 内存手机以下阀值：350MB，以上阀值则为：450MB</p>
<blockquote>
<p>如果ANR时间点前后，日志里有打印onTrimMemory，也可以作为内存紧张的一个参考判断</p>
</blockquote>
<p>在开发调试中可以通过如下命令查看EventLog信息：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>adb<span class="w"> </span>logcat<span class="w"> </span>-b<span class="w"> </span>events
</code></pre></div>
<div class="admonition notes">
<p class="admonition-title">EventLog</p>
<p>在平时开发和处理bug的过程中经常会和EventLog打交到，通过EventLog来分析Activity、   Process、CPU、Window等相关信息。</p>
<p>在开发调试中可以通过如下命令查看EventLog信息：
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>adb<span class="w"> </span>logcat<span class="w"> </span>-b<span class="w"> </span>events
</code></pre></div></p>
<p>那么会输出大量类似这样的信息：
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="m">06</span>-01<span class="w"> </span><span class="m">13</span>:44:55.518<span class="w">  </span><span class="m">7361</span><span class="w">  </span><span class="m">8289</span><span class="w"> </span>I<span class="w"> </span>am_create_service:<span class="w">                 </span><span class="o">[</span><span class="m">0</span>,111484394,.StatService,10094,7769<span class="o">]</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="m">06</span>-01<span class="w"> </span><span class="m">13</span>:44:55.540<span class="w">  </span><span class="m">7361</span><span class="w">  </span><span class="m">8343</span><span class="w"> </span>I<span class="w"> </span>am_proc_bound:<span class="w">             </span><span class="o">[</span><span class="m">0</span>,3976,com.android.providers.calendar<span class="o">]</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="m">06</span>-01<span class="w"> </span><span class="m">13</span>:44:55.599<span class="w">  </span><span class="m">7361</span><span class="w">  </span><span class="m">8033</span><span class="w"> </span>I<span class="w"> </span>am_create_service:<span class="w">     </span><span class="o">[</span><span class="m">0</span>,61349752,.UpdateService,10034,1351<span class="o">]</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="m">06</span>-01<span class="w"> </span><span class="m">13</span>:44:55.625<span class="w">  </span><span class="m">7361</span><span class="w">  </span><span class="m">7774</span><span class="w"> </span>I<span class="w"> </span>am_destroy_service:<span class="w"> </span><span class="o">[</span><span class="m">0</span>,61349752,1351<span class="o">]</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>...
</code></pre></div></p>
<p>从EventLog中我们可以获取到不少有用的信息，下面列举下部分字段含义：</p>
<ul>
<li>am_low_memory：位于AMS.killAllBackgroundProcesses或者AMS.appDiedLocked，记录当前Lru进程队列长度。</li>
<li>am_pss：位于AMS.recordPssSampleLocked(</li>
<li>am_meminfo：位于AMS.dumpApplicationMemoryUsage</li>
<li>am_proc_start:位于AMS.startProcessLocked，启动进程</li>
<li>am_proc_bound:位于AMS.attachApplicationLocked</li>
<li>am_kill: 位于ProcessRecord.kill，杀掉进程</li>
<li><strong>am_anr</strong>: 位于AMS.appNotResponding ，可以根据时间戳，找到anr文件夹下对应的trace文件</li>
<li>am_crash:位于AMS.handleApplicationCrashInner</li>
<li>am_wtf:位于AMS.handleApplicationWtf</li>
<li>am_activity_launch_time：位于ActivityRecord.reportLaunchTimeLocked()，后面两个参数分别是thisTime和 totalTime.</li>
<li>am_activity_fully_drawn_time:位于ActivityRecord.reportFullyDrawnLocked, 后面两个参数分别是thisTime和 totalTime</li>
</ul>
<p>详细参见<a href="http://gityuan.com/2016/05/15/event-log/">Android EventLog含义</a></p>
</div>
<h3 id="23">2.3 堆栈消息<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<p>堆栈信息是最重要的一个信息，展示了ANR发生的进程当前所有线程的状态。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">suspend</span><span class="w"> </span>all<span class="w"> </span>histogram:<span class="w">  </span>Sum:<span class="w"> </span><span class="m">2</span>.834s<span class="w"> </span><span class="m">99</span>%<span class="w"> </span>C.I.<span class="w"> </span><span class="m">5</span>.738us-7145.919us<span class="w"> </span>Avg:<span class="w"> </span><span class="m">607</span>.155us<span class="w"> </span>Max:<span class="w"> </span>41543us
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>DALVIK<span class="w"> </span>THREADS<span class="w"> </span><span class="o">(</span><span class="m">248</span><span class="o">)</span>:
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="s2">&quot;Signal Catcher&quot;</span><span class="w"> </span>daemon<span class="w"> </span><span class="nv">prio</span><span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="nv">tid</span><span class="o">=</span><span class="m">4</span><span class="w"> </span>Runnable
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">group</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="w"> </span><span class="nv">sCount</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">dsCount</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">flags</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">obj</span><span class="o">=</span>0x18c84570<span class="w"> </span><span class="nv">self</span><span class="o">=</span>0x7252417800
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">sysTid</span><span class="o">=</span><span class="m">7772</span><span class="w"> </span><span class="nv">nice</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">cgrp</span><span class="o">=</span>default<span class="w"> </span><span class="nv">sched</span><span class="o">=</span><span class="m">0</span>/0<span class="w"> </span><span class="nv">handle</span><span class="o">=</span>0x725354ad50
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">state</span><span class="o">=</span>R<span class="w"> </span><span class="nv">schedstat</span><span class="o">=(</span><span class="w"> </span><span class="m">16273959</span><span class="w"> </span><span class="m">1085938</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nv">utm</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">stm</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">core</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="nv">HZ</span><span class="o">=</span><span class="m">100</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">stack</span><span class="o">=</span>0x7253454000-0x7253456000<span class="w"> </span><span class="nv">stackSize</span><span class="o">=</span>991KB
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>held<span class="w"> </span><span class="nv">mutexes</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mutator lock&quot;</span><span class="o">(</span>shared<span class="w"> </span>held<span class="o">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#00 pc 000000000042f8e8  /apex/com.android.runtime/lib64/libart.so (art::DumpNativeStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, int, BacktraceMap*, char const*, art::ArtMethod*, void*, bool)+140)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#01 pc 0000000000523590  /apex/com.android.runtime/lib64/libart.so (art::Thread::DumpStack(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool, BacktraceMap*, bool) const+508)</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#02 pc 000000000053e75c  /apex/com.android.runtime/lib64/libart.so (art::DumpCheckpoint::Run(art::Thread*)+844)</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#03 pc 000000000053735c  /apex/com.android.runtime/lib64/libart.so (art::ThreadList::RunCheckpoint(art::Closure*, art::Closure*)+504)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#04 pc 0000000000536744  /apex/com.android.runtime/lib64/libart.so (art::ThreadList::Dump(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;, bool)+1048)</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#05 pc 0000000000536228  /apex/com.android.runtime/lib64/libart.so (art::ThreadList::DumpForSigQuit(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;)+884)</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#06 pc 00000000004ee4d8  /apex/com.android.runtime/lib64/libart.so (art::Runtime::DumpForSigQuit(std::__1::basic_ostream&lt;char, std::__1::char_traits&lt;char&gt;&gt;&amp;)+196)</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#07 pc 000000000050250c  /apex/com.android.runtime/lib64/libart.so (art::SignalCatcher::HandleSigQuit()+1356)</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#08 pc 0000000000501558  /apex/com.android.runtime/lib64/libart.so (art::SignalCatcher::Run(void*)+268)</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#09 pc 00000000000cf7c0  /apex/com.android.runtime/lib64/bionic/libc.so (__pthread_start(void*)+36)</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">  </span>native:<span class="w"> </span><span class="c1">#10 pc 00000000000721a8  /apex/com.android.runtime/lib64/bionic/libc.so (__start_thread+64)</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">  </span><span class="o">(</span>no<span class="w"> </span>managed<span class="w"> </span>stack<span class="w"> </span>frames<span class="o">)</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="s2">&quot;main&quot;</span><span class="w"> </span><span class="nv">prio</span><span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="nv">tid</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>Sleeping
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">group</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="w"> </span><span class="nv">sCount</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">dsCount</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">flags</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">obj</span><span class="o">=</span>0x73907540<span class="w"> </span><span class="nv">self</span><span class="o">=</span>0x725f010800
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">sysTid</span><span class="o">=</span><span class="m">7761</span><span class="w"> </span><span class="nv">nice</span><span class="o">=</span>-10<span class="w"> </span><span class="nv">cgrp</span><span class="o">=</span>default<span class="w"> </span><span class="nv">sched</span><span class="o">=</span><span class="m">1073741825</span>/2<span class="w"> </span><span class="nv">handle</span><span class="o">=</span>0x72e60080d0
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">state</span><span class="o">=</span>S<span class="w"> </span><span class="nv">schedstat</span><span class="o">=(</span><span class="w"> </span><span class="m">281909898</span><span class="w"> </span><span class="m">5919799</span><span class="w"> </span><span class="m">311</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nv">utm</span><span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="nv">stm</span><span class="o">=</span><span class="m">7</span><span class="w"> </span><span class="nv">core</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="nv">HZ</span><span class="o">=</span><span class="m">100</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">stack</span><span class="o">=</span>0x7fca180000-0x7fca182000<span class="w"> </span><span class="nv">stackSize</span><span class="o">=</span>8192KB
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>held<span class="w"> </span><span class="nv">mutexes</span><span class="o">=</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="w">  </span>at<span class="w"> </span>java.lang.Thread.sleep<span class="o">(</span>Native<span class="w"> </span>method<span class="o">)</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="w">  </span>-<span class="w"> </span>sleeping<span class="w"> </span>on<span class="w"> </span>&lt;0x00f895d9&gt;<span class="w"> </span><span class="o">(</span>a<span class="w"> </span>java.lang.Object<span class="o">)</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="w">  </span>at<span class="w"> </span>java.lang.Thread.sleep<span class="o">(</span>Thread.java:443<span class="o">)</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="w">  </span>-<span class="w"> </span>locked<span class="w"> </span>&lt;0x00f895d9&gt;<span class="w"> </span><span class="o">(</span>a<span class="w"> </span>java.lang.Object<span class="o">)</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="w">  </span>at<span class="w"> </span>java.lang.Thread.sleep<span class="o">(</span>Thread.java:359<span class="o">)</span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="w">  </span>at<span class="w"> </span>android.os.SystemClock.sleep<span class="o">(</span>SystemClock.java:131<span class="o">)</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="w">  </span>at<span class="w"> </span>com.xfhy.watchsignaldemo.MainActivity.makeAnr<span class="o">(</span>MainActivity.kt:35<span class="o">)</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="w">  </span>at<span class="w"> </span>java.lang.reflect.Method.invoke<span class="o">(</span>Native<span class="w"> </span>method<span class="o">)</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="w">  </span>at<span class="w"> </span>androidx.appcompat.app.AppCompatViewInflater<span class="nv">$DeclaredOnClickListener</span>.onClick<span class="o">(</span>AppCompatViewInflater.java:441<span class="o">)</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="w">  </span>at<span class="w"> </span>android.view.View.performClick<span class="o">(</span>View.java:7317<span class="o">)</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="w">  </span>at<span class="w"> </span>com.google.android.material.button.MaterialButton.performClick<span class="o">(</span>MaterialButton.java:1219<span class="o">)</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="w">  </span>at<span class="w"> </span>android.view.View.performClickInternal<span class="o">(</span>View.java:7291<span class="o">)</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="w">  </span>at<span class="w"> </span>android.view.View.access<span class="nv">$3600</span><span class="o">(</span>View.java:838<span class="o">)</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="w">  </span>at<span class="w"> </span>android.view.View<span class="nv">$PerformClick</span>.run<span class="o">(</span>View.java:28247<span class="o">)</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="w">  </span>at<span class="w"> </span>android.os.Handler.handleCallback<span class="o">(</span>Handler.java:900<span class="o">)</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="w">  </span>at<span class="w"> </span>android.os.Handler.dispatchMessage<span class="o">(</span>Handler.java:103<span class="o">)</span>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a><span class="w">  </span>at<span class="w"> </span>android.os.Looper.loop<span class="o">(</span>Looper.java:219<span class="o">)</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a><span class="w">  </span>at<span class="w"> </span>android.app.ActivityThread.main<span class="o">(</span>ActivityThread.java:8668<span class="o">)</span>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a><span class="w">  </span>at<span class="w"> </span>java.lang.reflect.Method.invoke<span class="o">(</span>Native<span class="w"> </span>method<span class="o">)</span>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a><span class="w">  </span>at<span class="w"> </span>com.android.internal.os.RuntimeInit<span class="nv">$MethodAndArgsCaller</span>.run<span class="o">(</span>RuntimeInit.java:513<span class="o">)</span>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a><span class="w">  </span>at<span class="w"> </span>com.android.internal.os.ZygoteInit.main<span class="o">(</span>ZygoteInit.java:1109<span class="o">)</span>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a><span class="w">  </span>...<span class="w"> </span>//此处省略剩余的N个线程
</code></pre></div>
<h4 id="231">2.3.1. 参数解读<a class="headerlink" href="#231" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="s">&quot;Signal Catcher&quot;</span><span class="w"> </span><span class="n">daemon</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">4</span><span class="w"> </span><span class="n">Runnable</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;system&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x18c84570</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x7252417800</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">7772</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0x725354ad50</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">16273959</span><span class="w"> </span><span class="mi">1085938</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">4</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0x7253454000</span><span class="o">-</span><span class="mh">0x7253456000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">991</span><span class="n">KB</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mutator lock&quot;</span><span class="p">(</span><span class="n">shared</span><span class="w"> </span><span class="n">held</span><span class="p">)</span>
</code></pre></div>
<p><strong>第1行：</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="s2">&quot;Signal Catcher&quot;</span><span class="w"> </span>daemon<span class="w"> </span><span class="nv">prio</span><span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="nv">tid</span><span class="o">=</span><span class="m">4</span><span class="w"> </span>Runnable
</code></pre></div>
<ul>
<li>
<p>"Signal Catcher" daemon ： 线程名，有daemon表示守护线程</p>
</li>
<li>
<p>prio：线程优先级</p>
</li>
<li>
<p>tid：线程内部id</p>
</li>
<li>
<p><strong>线程状态：Runnable</strong></p>
</li>
</ul>
<p>下图为线程状态对应关系表。</p>
<p><a class="glightbox" href="../assets/v2-58305ddc02bb70b177a775186fd21261_720w.webp" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../assets/v2-58305ddc02bb70b177a775186fd21261_720w.webp" /></a></p>
<blockquote>
<p>一般来说：main线程处于 BLOCK、WAITING、TIMEWAITING状态，那基本上是函数阻塞导致ANR；</p>
<p>如果main线程无异常，则应该排查CPU负载和内存环境。</p>
</blockquote>
<p><strong>第2行：</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">|</span><span class="w"> </span><span class="nv">group</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="w"> </span><span class="nv">sCount</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">dsCount</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">flags</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">obj</span><span class="o">=</span>0x18c84570<span class="w"> </span><span class="nv">self</span><span class="o">=</span>0x7252417800
</code></pre></div>
<ul>
<li>group：线程所属的线程组</li>
<li>sCount：线程挂起次数</li>
<li>dsCount：用于调试的线程挂起次数</li>
<li>obj：当前线程关联的Java线程对象</li>
<li>self：当前线程地址</li>
</ul>
<p><strong>第3行：</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">|</span><span class="w"> </span><span class="nv">sysTid</span><span class="o">=</span><span class="m">7772</span><span class="w"> </span><span class="nv">nice</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">cgrp</span><span class="o">=</span>default<span class="w"> </span><span class="nv">sched</span><span class="o">=</span><span class="m">0</span>/0<span class="w"> </span><span class="nv">handle</span><span class="o">=</span>0x725354ad50
</code></pre></div>
<ul>
<li>sysTid：线程真正意义上的tid</li>
<li>nice：调度优先级，nice的取值范围为-20到19。通常来说nice的值越大，进程的优先级就越低，获得CPU调用的机会越少，nice值越小，进程的优先级则越高，获得CPU调用的机会越多。</li>
<li>cgrp：进程所属的进程调度组</li>
<li>sched：调度策略</li>
<li>handle：函数处理地址</li>
</ul>
<p><strong>第4行：</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="p">|</span><span class="w"> </span><span class="nv">state</span><span class="o">=</span>R<span class="w"> </span><span class="nv">schedstat</span><span class="o">=(</span><span class="w"> </span><span class="m">16273959</span><span class="w"> </span><span class="m">1085938</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nv">utm</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">stm</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">core</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="nv">HZ</span><span class="o">=</span><span class="m">100</span>
</code></pre></div>
<ul>
<li>state：线程状态</li>
<li>schedstat：CPU调度时间统计（schedstat括号中的3个数字依次是Running、Runable、Switch，Running时间：CPU运行的时间，单位ns，Runable时间：RQ队列的等待时间，单位ns，Switch次数：CPU调度切换次数）</li>
<li>utm/stm：用户态/内核态的CPU时间，线程的cpu耗时是两者相加(utm+stm)，utm,stm 单位换算成时间单位为 1 比 10ms。</li>
<li>core：数字表示的跑在哪个核上，core=4表示打印这段日志时该线程跑在CPU4上</li>
<li>HZ：时钟频率</li>
</ul>
<p><strong>第5行：</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">|</span><span class="w"> </span><span class="nv">stack</span><span class="o">=</span>0x7253454000-0x7253456000<span class="w"> </span><span class="nv">stackSize</span><span class="o">=</span>991KB
</code></pre></div>
<ul>
<li>stack：线程栈的地址区间</li>
<li>stackSize：栈的大小</li>
</ul>
<p><strong>第6行：</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">|</span><span class="w"> </span>held<span class="w"> </span><span class="nv">mutexes</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mutator lock&quot;</span><span class="o">(</span>shared<span class="w"> </span>held<span class="o">)</span>
</code></pre></div>
<ul>
<li>mutex：所持有mutex类型，有独占锁exclusive和共享锁shared两类</li>
</ul>
<h3 id="24-anr">2.4 ANR 分析思路<a class="headerlink" href="#24-anr" title="Permanent link">&para;</a></h3>
<h4 id="anr_4">ANR分析思路<a class="headerlink" href="#anr_4" title="Permanent link">&para;</a></h4>
<ol>
<li>查看对应Trace日志<ol>
<li>业务堆栈耗时（线程处于runnable但堆栈对应调用很耗时）</li>
<li>主线程等待锁或者发生死锁（线程状态处于block/wait）</li>
<li>如果确定是上述问题，那恭喜你，解决方案很简单，<strong>处理耗时调用或者处理锁等待/死锁</strong> 问题即可</li>
</ol>
</li>
<li>
<p>但如果发现Trace堆栈完全处于空闲状态（nativePollOnce）或者没有命中耗时堆栈，那么很不幸，就需要扩大参考面；</p>
<ol>
<li>
<p><strong>分析cpuinfo 信息</strong>：</p>
<ol>
<li><strong>系统负载(Load)</strong> ：</li>
</ol>
<p><a class="glightbox" href="../assets/16871684175942.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../assets/16871684175942.jpg" /></a></p>
<p>分别代表 ANR 发生前 1 分钟，前 5 分钟，前 15 分钟各个时间段系统 CPU 负载，具体数值代表单位时间等待系统调度的任务数(可以理解为线程)。如果这个数值过高，则表示当前系统中面临 CPU 或 IO 竞争，此时，普通进程或线程调度将会受到影响。</p>
<ol>
<li><strong>进程 CPU 使用率</strong>：</li>
</ol>
<p><a class="glightbox" href="../assets/16871684613046.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../assets/16871684613046.jpg" /></a></p>
<p>可以清晰的看到哪类进程CPU偏高，如果存在明显偏高的进程，那么ANR和此进程抢占CPU有一定关系。当然，如发现<code>Kswapd</code>，<code>emmc</code>或者<code>mmcqd</code>进程也在top中，则说明遇到系统内存压力或文件IO开销。</p>
<ol>
<li><strong>系统 CPU 分布</strong>：</li>
</ol>
<p><a class="glightbox" href="../assets/16871684899925.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../assets/16871684899925.jpg" /></a></p>
<p>反映一段时间内，系统整体 CPU 使用率，以及 user，kernel，iowait 方向的 CPU 占比，如果发生大量文件读写或内存紧张的场景，则 iowait 占比较高</p>
<ol>
<li><strong>对比各线程 CPU 占比，以及线程内部 user 和 kernel 占比</strong></li>
</ol>
<p><a class="glightbox" href="../assets/16872493238994.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../assets/16872493238994.jpg" /></a></p>
<p>在 Trace 日志的线程信息里也可以清晰的看到每个线程的 utm，stm 耗时</p>
<p><a class="glightbox" href="../assets/16872493741804.jpg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../assets/16872493741804.jpg" /></a></p>
</li>
<li>
<p><strong>分析syslog信息</strong>：</p>
<ol>
<li><strong>分析线程和句柄</strong>
先看线程数和句柄数是否有异常，如果有异常，再看下是否有明显大量重复线程和句柄</li>
<li><strong>分析meminfo信息</strong>
系统是否是低内存机器/处于低可用内存状态</li>
<li><strong>分析logcat日志（system、event、main）</strong>
搜索关键字<code>onTrimMemory</code>、<code>am_low_memory或者lowmemorykiller</code>, <code>slow_operation</code>，<code>Kwork</code>，判断当前系统是否存在资源(CPU，Mem，IO)紧张的情况，另外也可以搜索<code>binder_sample</code>查看主线程的binder调用耗时， <code>binder starved</code>查看binder通信是否处于饥饿状态,,<code>dvm_lock_sample</code>查看同步锁竞争记录</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="_1">疑难参数解释<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>dvm_lock_sample</strong>：在同步锁发生content的时候，虚拟机会将这个竞争记录在eventlog中, 实现可以参考<code>art/runtime/monitor_android.cc#LogContentionEvent</code>函数<ul>
<li>log格式: <code>dvm_lock_sample (process|3),(main|1|5),(thread|3),(time|1|3),(file|3),(line|1|5),(ownerfile|3),(ownerline|1|5),(sample_percent|1|6)</code></li>
<li>log解释： <code>所属进程，是否为主线程，线程名，获取锁所用的时间，获取锁代码所在的源文件，行号，锁被占有的代码所在的源文件（如果与file相同，用"-"表示），行号，等待百分比</code></li>
<li>示例
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nl">dvm_lock_sample</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">com</span><span class="p">.</span><span class="na">yy</span><span class="p">.</span><span class="na">hiyo</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">main</span><span class="p">,</span><span class="mi">516</span><span class="p">,,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">net</span><span class="p">.</span><span class="na">ihago</span><span class="p">.</span><span class="na">base</span><span class="p">.</span><span class="na">srv</span><span class="p">.</span><span class="na">splash</span><span class="p">.</span><span class="na">UserSplashConfig</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">yy</span><span class="p">.</span><span class="na">hiyo</span><span class="p">.</span><span class="na">module</span><span class="p">.</span><span class="na">splash</span><span class="p">.</span><span class="na">SplashManager</span><span class="p">.</span><span class="na">getWillLoadSplashData</span><span class="p">(),</span><span class="o">-</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="kt">void</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">yy</span><span class="p">.</span><span class="na">hiyo</span><span class="p">.</span><span class="na">module</span><span class="p">.</span><span class="na">splash</span><span class="p">.</span><span class="na">SplashManager</span><span class="p">.</span><span class="na">readLocalData</span><span class="p">(),</span><span class="mi">100</span><span class="o">]</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">含义</span><span class="err">：</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">yy</span><span class="p">.</span><span class="na">hiyo进程</span><span class="err">，</span><span class="n">主线程执行到SplashManager</span><span class="p">.</span><span class="na">getWillLoadSplashData</span><span class="p">()</span><span class="n">时</span><span class="err">，</span><span class="n">等待相同文件里面的SplashManager</span><span class="p">.</span><span class="na">readLocalData</span><span class="p">()</span><span class="n">持有的锁</span><span class="err">，</span><span class="n">阻塞了516ms</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>binder_sample</strong> ：监控每个进程的主线程的binde调用的耗时情况,实现可以参考<code>frameworks/base/core/jni/android_util_Binder.cpp#conditionally_log_binder_call</code>函数</p>
<ul>
<li>log 格式： <code>binder_sample (descriptor|3),(method_num|1|5),(time|1|3),(blocking_package|3),(sample_percent|1|6)</code></li>
<li>log 解释：</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>意义</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>descriptor</code></td>
<td>接口描述符，表示被卡住的binder调用对应的interface接口</td>
<td>任何一个binder都实现一个接口，IPC调用用的API，任何一个接口都有一个描述符，即一个字符串</td>
</tr>
<tr>
<td><code>method_num</code></td>
<td>调用方法的序列号</td>
<td></td>
</tr>
<tr>
<td><code>time</code></td>
<td>该方法调用耗用的时间</td>
<td></td>
</tr>
<tr>
<td><code>blocking_package</code></td>
<td>从哪个进程发起的调用</td>
<td></td>
</tr>
<tr>
<td><code>sample_percent</code></td>
<td>被卡住的百分比</td>
<td>暂时不关注</td>
</tr>
</tbody>
</table>
<ul>
<li>示例：
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">I</span><span class="o">/</span><span class="n">binder_sample</span><span class="p">(</span><span class="w">  </span><span class="mi">520</span><span class="p">):</span><span class="o">[</span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">telephony</span><span class="p">.</span><span class="na">ITelephonyRegistry</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">12518</span><span class="p">,</span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">phone</span><span class="p">,</span><span class="mi">100</span><span class="o">]</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">含义</span><span class="err">：</span><span class="n">从com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">phone主线程发起了一个ITelephonyRegistry接口的第7个方法的binder调用</span><span class="err">，</span><span class="n">耗时12s</span><span class="err">。</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>binder starved</strong>：当system_server等进程的线程池使用完, 无空闲线程时, 则binder通信都处于饥饿状态, 则饥饿状态超过一定阈值则输出信息;</p>
<ul>
<li>示例
  <div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="mi">1232</span><span class="w"> </span><span class="mi">1232</span><span class="w"> </span><span class="s">&quot;binder thread pool (16 threads) starved for 100 ms&quot;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">含义</span><span class="err">：</span><span class="n">system_server进程的</span><span class="w"> </span><span class="n">线程池已满的持续长达100ms</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>kswapd</strong>   </p>
</li>
</ul>
<p>是 linux 中用于页面回收的内核线程，主要用来维护可用内存与文件缓存的平衡，以追求性能最大化，当该线程 CPU 占用过高，说明系统可用内存紧张，或者内存碎片化严重，需要进行 file cache 回写或者内存交换(交换到磁盘)，线程 CPU 过高则系统整体性能将会明显下降，进而影响所有应用调度。</p>
<ul>
<li><strong>mmcqd</strong> </li>
</ul>
<p>内核线程，主要作用是把上层的 IO 请求进行统一管理和转发到 Driver 层，当该线程 CPU 占用过高，说明系统存在大量文件读写，当然如果内存紧张也会触发文件回写和内存交换到磁盘，所以 kswapd 和 mmcqd 经常是同步出现的。</p>
<h2 id="3-anr">3. ANR 案例分析<a class="headerlink" href="#3-anr" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 主线程耗时<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">Runnable</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x72deb848</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x7748c10800</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">8968</span><span class="w"> </span><span class="n">nice</span><span class="o">=-</span><span class="mi">10</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0x77cfa75ed0</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">24783612979</span><span class="w"> </span><span class="mi">48520902</span><span class="w"> </span><span class="mi">756</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">2473</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0x7fce68b000</span><span class="o">-</span><span class="mh">0x7fce68d000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">8192</span><span class="n">KB</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mutator lock&quot;</span><span class="p">(</span><span class="n">shared</span><span class="w"> </span><span class="n">held</span><span class="p">)</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">test</span><span class="p">.</span><span class="na">MainActivity$onCreate$2</span><span class="p">.</span><span class="na">onClick</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">kt</span><span class="p">:</span><span class="mi">20</span><span class="p">)</span><span class="err">——</span><span class="n">关键行</span><span class="err">！！！</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">performClick</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">7187</span><span class="p">)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">performClickInternal</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">7164</span><span class="p">)</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">access$3500</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">813</span><span class="p">)</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View$PerformClick</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">27640</span><span class="p">)</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">handleCallback</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">883</span><span class="p">)</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">dispatchMessage</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">(</span><span class="n">Looper</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">230</span><span class="p">)</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">app</span><span class="p">.</span><span class="na">ActivityThread</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">7725</span><span class="p">)</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">reflect</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">RuntimeInit$MethodAndArgsCaller</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">RuntimeInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">526</span><span class="p">)</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1034</span><span class="p">)</span>
</code></pre></div>
<p>上述日志表明，主线程正处于执行状态，看堆栈信息可知不是处于空闲状态，发生ANR可能是因为一处click监听函数里执行了耗时操作。</p>
<h3 id="32">3.2 主线程无卡顿，处于正常状态堆栈<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">Native</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x74b38080</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x7ad9014c00</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">23081</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0x7b5fdc5548</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">284838633</span><span class="w"> </span><span class="mi">166738594</span><span class="w"> </span><span class="mi">505</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">21</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">7</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0x7fc95da000</span><span class="o">-</span><span class="mh">0x7fc95dc000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">8</span><span class="n">MB</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">  </span><span class="n">kernel</span><span class="p">:</span><span class="w"> </span><span class="n">__switch_to</span><span class="o">+</span><span class="mh">0xb0</span><span class="o">/</span><span class="mh">0xbc</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">  </span><span class="n">kernel</span><span class="p">:</span><span class="w"> </span><span class="n">SyS_epoll_wait</span><span class="o">+</span><span class="mh">0x288</span><span class="o">/</span><span class="mh">0x364</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">  </span><span class="n">kernel</span><span class="p">:</span><span class="w"> </span><span class="n">SyS_epoll_pwait</span><span class="o">+</span><span class="mh">0xb0</span><span class="o">/</span><span class="mh">0x124</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">  </span><span class="n">kernel</span><span class="p">:</span><span class="w"> </span><span class="n">cpu_switch_to</span><span class="o">+</span><span class="mh">0x38c</span><span class="o">/</span><span class="mh">0x2258</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">00</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">000000000007</span><span class="n">cd8c</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">__epoll_pwait</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">01</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">0000000000014</span><span class="n">d48</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libutils</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">Looper</span><span class="p">::</span><span class="n">pollInner</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">+</span><span class="mi">148</span><span class="p">)</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">02</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">0000000000014</span><span class="n">c18</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libutils</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">Looper</span><span class="p">::</span><span class="n">pollOnce</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">+</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">03</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">00000000001275</span><span class="n">f4</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libandroid_runtime</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">android_os_MessageQueue_nativePollOnce</span><span class="p">(</span><span class="n">_JNIEnv</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">_jobject</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="o">+</span><span class="mi">44</span><span class="p">)</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">MessageQueue</span><span class="p">.</span><span class="na">nativePollOnce</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">MessageQueue</span><span class="p">.</span><span class="na">next</span><span class="p">(</span><span class="n">MessageQueue</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">330</span><span class="p">)</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">(</span><span class="n">Looper</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">169</span><span class="p">)</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">app</span><span class="p">.</span><span class="na">ActivityThread</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">7073</span><span class="p">)</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">reflect</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">RuntimeInit$MethodAndArgsCaller</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">RuntimeInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">536</span><span class="p">)</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">876</span><span class="p">)</span>
</code></pre></div>
<p>比如这个主线程堆栈，看起来很正常，主线程是空闲的，因为它正处于nativePollOnce，正在等待新消息。处于这个状态，那还发生了ANR，可能有2个原因：</p>
<ol>
<li>dump堆栈时机太晚了，ANR已经发生过了，才去dump堆栈，此时主线程已经恢复正常了</li>
<li>CPU抢占或者内存紧张等其他因素引起</li>
</ol>
<p>遇到这种情况，要先去分析CPU、内存的使用情况。其次可以关注抓取日志的时间和ANR发生的时间是否相隔太久，时间太久这个堆栈就没有分析的意义了。</p>
<h3 id="33">3.3 主线程被锁阻塞<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">Blocked</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x72deb848</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x7748c10800</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">22838</span><span class="w"> </span><span class="n">nice</span><span class="o">=-</span><span class="mi">10</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0x77cfa75ed0</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">390366023</span><span class="w"> </span><span class="mi">28399376</span><span class="w"> </span><span class="mi">279</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">34</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0x7fce68b000</span><span class="o">-</span><span class="mh">0x7fce68d000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">8192</span><span class="n">KB</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">test</span><span class="p">.</span><span class="na">MainActivity$onCreate$1</span><span class="p">.</span><span class="na">onClick</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">kt</span><span class="p">:</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x01aed1da</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">——————</span><span class="n">关键行</span><span class="err">！！！</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">performClick</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">7187</span><span class="p">)</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">performClickInternal</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">7164</span><span class="p">)</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View</span><span class="p">.</span><span class="na">access$3500</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">813</span><span class="p">)</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">View$PerformClick</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">27640</span><span class="p">)</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">handleCallback</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">883</span><span class="p">)</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">dispatchMessage</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">(</span><span class="n">Looper</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">230</span><span class="p">)</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">app</span><span class="p">.</span><span class="na">ActivityThread</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">7725</span><span class="p">)</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">reflect</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">RuntimeInit$MethodAndArgsCaller</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">RuntimeInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">526</span><span class="p">)</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1034</span><span class="p">)</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">  </span><span class="p">........</span><span class="na">省略N行</span><span class="p">.....</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">  </span><span class="s">&quot;WQW TEST&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">TimeWating</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">flags</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x12c44230</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x772f0ec000</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">22938</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0x77391fbd50</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">274896</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0x77390f9000</span><span class="o">-</span><span class="mh">0x77390fb000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">1039</span><span class="n">KB</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">sleeping</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x043831a6</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">440</span><span class="p">)</span>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">locked</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x043831a6</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">356</span><span class="p">)</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">example</span><span class="p">.</span><span class="na">test</span><span class="p">.</span><span class="na">MainActivity$onCreate$2$thread$1</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">kt</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">locked</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x01aed1da</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span><span class="err">————————————————————</span><span class="n">关键行</span><span class="err">！！！</span>
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Thread</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">919</span><span class="p">)</span>
</code></pre></div>
<p>这是一个典型的主线程被锁阻塞的例子；</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">waiting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x01aed1da</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="mi">3</span>
</code></pre></div>
<p>其中等待的锁是<code>&lt;0x01aed1da&gt;</code>，这个锁的持有者是线程 3。进一步搜索 “tid=3” 找到线程3， 发现它正在TimeWating。</p>
<p>那么ANR的原因找到了：线程3持有了一把锁，并且自身长时间不释放，主线程等待这把锁发生超时。在线上环境中，常见因锁而ANR的场景是 <strong>SharePreference写入</strong>。</p>
<h3 id="34-cpu">3.4  CPU被抢占<a class="headerlink" href="#34-cpu" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">CPU</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">10625</span><span class="n">ms</span><span class="w"> </span><span class="nf">later</span><span class="w"> </span><span class="p">(</span><span class="mi">2020</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">09</span><span class="w"> </span><span class="mi">14</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mf">31.633</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">09</span><span class="w"> </span><span class="mi">14</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mf">42.257</span><span class="p">):</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="mi">543</span><span class="o">%</span><span class="w"> </span><span class="mi">2045</span><span class="o">/</span><span class="n">com</span><span class="p">.</span><span class="na">alibaba</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">rimet</span><span class="p">:</span><span class="w"> </span><span class="mi">54</span><span class="o">%</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">89</span><span class="o">%</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">faults</span><span class="p">:</span><span class="w"> </span><span class="mi">4608</span><span class="w"> </span><span class="n">minor</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">major</span><span class="w"> </span><span class="err">————</span><span class="n">关键行</span><span class="err">！！！</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="mi">99</span><span class="o">%</span><span class="w"> </span><span class="mi">674</span><span class="o">/</span><span class="n">android</span><span class="p">.</span><span class="na">hardware</span><span class="p">.</span><span class="na">camera</span><span class="p">.</span><span class="na">provider</span><span class="err">@</span><span class="mf">2.4</span><span class="o">-</span><span class="n">service</span><span class="p">:</span><span class="w"> </span><span class="mi">81</span><span class="o">%</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">18</span><span class="o">%</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">faults</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="w"> </span><span class="n">minor</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="mi">24</span><span class="o">%</span><span class="w"> </span><span class="mi">32589</span><span class="o">/</span><span class="n">com</span><span class="p">.</span><span class="na">wang</span><span class="p">.</span><span class="na">test</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="o">%</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.4</span><span class="o">%</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">faults</span><span class="p">:</span><span class="w"> </span><span class="mi">7432</span><span class="w"> </span><span class="n">minor</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">major</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="p">........</span><span class="na">省略N行</span><span class="p">.....</span>
</code></pre></div>
<p>如上日志，第二行是钉钉的进程，占据CPU高达543%，抢占了大部分CPU资源，因而导致发生ANR。</p>
<h3 id="35-anr">3.5 内存紧张导致ANR<a class="headerlink" href="#35-anr" title="Permanent link">&para;</a></h3>
<p>如果有一份日志，CPU和堆栈都很正常，仍旧发生ANR，考虑是内存紧张。</p>
<p>从CPU第一行信息可以发现，ANR的时间点是<code>2020-10-31 22:38:58.468—CPU usage from 0ms to 21752ms later (2020-10-31 22:38:58.468 to 2020-10-31 22:39:20.220)</code></p>
<p>接着去系统日志里搜索<code>am_meminfo</code>、onTrimMemory或者<code>GC</code>信息， <code>am_meminfo</code>要是没有搜索到可以从<code>Eventlog</code>中搜。以<code>onTrimMemory</code>为例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="m">10</span>-31<span class="w"> </span><span class="m">22</span>:37:19.749<span class="w"> </span><span class="m">20733</span><span class="w"> </span><span class="m">20733</span><span class="w"> </span>E<span class="w"> </span>Runtime<span class="w"> </span>:<span class="w"> </span>onTrimMemory<span class="w"> </span>level:80,pid:com.xxx.xxx:Launcher0
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="m">10</span>-31<span class="w"> </span><span class="m">22</span>:37:33.458<span class="w"> </span><span class="m">20733</span><span class="w"> </span><span class="m">20733</span><span class="w"> </span>E<span class="w"> </span>Runtime<span class="w"> </span>:<span class="w"> </span>onTrimMemory<span class="w"> </span>level:80,pid:com.xxx.xxx:Launcher0
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="m">10</span>-31<span class="w"> </span><span class="m">22</span>:38:00.153<span class="w"> </span><span class="m">20733</span><span class="w"> </span><span class="m">20733</span><span class="w"> </span>E<span class="w"> </span>Runtime<span class="w"> </span>:<span class="w"> </span>onTrimMemory<span class="w"> </span>level:80,pid:com.xxx.xxx:Launcher0
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="m">10</span>-31<span class="w"> </span><span class="m">22</span>:38:58.731<span class="w"> </span><span class="m">20733</span><span class="w"> </span><span class="m">20733</span><span class="w"> </span>E<span class="w"> </span>Runtime<span class="w"> </span>:<span class="w"> </span>onTrimMemory<span class="w"> </span>level:80,pid:com.xxx.xxx:Launcher0
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="m">10</span>-31<span class="w"> </span><span class="m">22</span>:39:02.816<span class="w"> </span><span class="m">20733</span><span class="w"> </span><span class="m">20733</span><span class="w"> </span>E<span class="w"> </span>Runtime<span class="w"> </span>:<span class="w"> </span>onTrimMemory<span class="w"> </span>level:80,pid:com.xxx.xxx:Launcher
</code></pre></div>
<p>可以看出，在发生ANR的时间点前后，内存都处于紧张状态，level等级是80，查看Android API 文档；</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="cm">/**</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="cm">    * Level for {@link #onTrimMemory(int)}: the process is nearing the end</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="cm">    * of the background LRU list, and if more memory isn&#39;t found soon it will</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="cm">    * be killed.</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="cm">    */</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">   </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TRIM_MEMORY_COMPLETE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</code></pre></div>
<p>可知80这个等级是很严重的，应用马上就要被杀死，被杀死的这个应用从名字可以看出来是桌面，连桌面都快要被杀死，那普通应用能好到哪里去呢？</p>
<p>一般来说，发生内存紧张，会导致多个应用发生ANR，<strong>所以在日志中如果发现有多个应用一起ANR了，可以初步判定，此ANR与你的应用无关。</strong></p>
<h3 id="36-binderanr">3.6 系统服务超时(Binder阻塞等待)导致ANR<a class="headerlink" href="#36-binderanr" title="Permanent link">&para;</a></h3>
<p>系统服务超时一般会包含 <strong>BinderProxy.transactNative</strong> 关键字，请看如下日志：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">Native</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x73ee6470</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0xb4d76500</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">22831</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0xb6f4bc00</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">22</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">22</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0xbe283000</span><span class="o">-</span><span class="mh">0xbe285000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">8</span><span class="n">MB</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">00</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">000410</span><span class="n">ac</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">__ioctl</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">01</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">000477</span><span class="n">e5</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">ioctl</span><span class="o">+</span><span class="mi">14</span><span class="p">)</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">02</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">0001</span><span class="n">e7c5</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libbinder</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">IPCThreadState</span><span class="p">::</span><span class="n">talkWithDriver</span><span class="p">(</span><span class="n">bool</span><span class="p">)</span><span class="o">+</span><span class="mi">132</span><span class="p">)</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">03</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">0001</span><span class="n">ee17</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libbinder</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">IPCThreadState</span><span class="p">::</span><span class="n">waitForResponse</span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">Parcel</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="mi">38</span><span class="p">)</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">04</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">0001</span><span class="n">efcd</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libbinder</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">IPCThreadState</span><span class="p">::</span><span class="n">transact</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">android</span><span class="p">::</span><span class="n">Parcel</span><span class="w"> </span><span class="kd">const</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">android</span><span class="p">::</span><span class="n">Parcel</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="o">+</span><span class="mi">124</span><span class="p">)</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">05</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">0001</span><span class="mf">9f</span><span class="n">b7</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libbinder</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">BpBinder</span><span class="p">::</span><span class="n">transact</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">android</span><span class="p">::</span><span class="n">Parcel</span><span class="w"> </span><span class="kd">const</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">android</span><span class="p">::</span><span class="n">Parcel</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="o">+</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">06</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">000</span><span class="mi">86</span><span class="n">de9</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libandroid_runtime</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">  </span><span class="kd">native</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="mo">07</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="mo">00</span><span class="n">d94629</span><span class="w">  </span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dalvik</span><span class="o">-</span><span class="n">cache</span><span class="o">/</span><span class="n">arm</span><span class="o">/</span><span class="n">system</span><span class="nd">@framework@boot.oat</span><span class="w"> </span><span class="p">(</span><span class="n">Java_android_os_BinderProxy_transactNative__ILandroid_os_Parcel_2Landroid_os_Parcel_2I</span><span class="o">+</span><span class="mi">140</span><span class="p">)</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">BinderProxy</span><span class="p">.</span><span class="na">transactNative</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">BinderProxy</span><span class="p">.</span><span class="na">transact</span><span class="p">(</span><span class="n">Binder</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">503</span><span class="p">)</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">INetworkPolicyManager$Stub$Proxy</span><span class="p">.</span><span class="na">getNetworkPolicies</span><span class="p">(</span><span class="n">INetworkPolicyManager</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">410</span><span class="p">)</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">NetworkPolicyManager</span><span class="p">.</span><span class="na">getNetworkPolicies</span><span class="p">(</span><span class="n">NetworkPolicyManager</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">174</span><span class="p">)</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">settings</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">NetworkPolicyEditor</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">NetworkPolicyEditor</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">57</span><span class="p">)</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w">    </span><span class="p">........</span><span class="na">省略N行</span><span class="p">.....</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit$MethodAndArgsCaller</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">762</span><span class="p">)</span>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">652</span><span class="p">)</span>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="w"> </span><span class="p">........</span><span class="na">省略N行</span><span class="p">.....</span><span class="w">   </span>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="w">  </span><span class="s">&quot;Binder_4&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">56</span><span class="w"> </span><span class="n">Blocked</span>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x1321a0a0</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0xad31e200</span>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">2491</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0x9fd00930</span>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">46441</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">46582</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0x9fc04000</span><span class="o">-</span><span class="mh">0x9fc06000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">1014</span><span class="n">KB</span>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">NetworkPolicyManagerService</span><span class="p">.</span><span class="na">getNetworkPolicies</span><span class="p">(</span><span class="n">NetworkPolicyManagerService</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1696</span><span class="p">)</span>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x07439315</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="mi">35</span>
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">INetworkPolicyManager$Stub</span><span class="p">.</span><span class="na">onTransact</span><span class="p">(</span><span class="n">INetworkPolicyManager</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">145</span><span class="p">)</span>
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Binder</span><span class="p">.</span><span class="na">execTransact</span><span class="p">(</span><span class="n">Binder</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">453</span>
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a>
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="w">  </span><span class="p">........</span><span class="na">省略N行</span><span class="p">.....</span><span class="w">   </span>
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="w">  </span><span class="s">&quot;NetworkPolicy&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">35</span><span class="w"> </span><span class="n">TimedWaiting</span>
<a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x12d98940</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x9f91f700</span>
<a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">2415</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="k">default</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mh">0xa0f33930</span>
<a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">7681</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">7783</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">HZ</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">stack</span><span class="o">=</span><span class="mh">0xa0e31000</span><span class="o">-</span><span class="mh">0xa0e33000</span><span class="w"> </span><span class="n">stackSize</span><span class="o">=</span><span class="mi">1038</span><span class="n">KB</span>
<a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">mutexes</span><span class="o">=</span>
<a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">.</span><span class="na">wait</span><span class="o">!</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x02580c1b</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span>
<a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Thread</span><span class="p">.</span><span class="na">parkFor$</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1220</span><span class="p">)</span>
<a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">locked</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x02580c1b</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span>
<a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">sun</span><span class="p">.</span><span class="na">misc</span><span class="p">.</span><span class="na">Unsafe</span><span class="p">.</span><span class="na">park</span><span class="p">(</span><span class="n">Unsafe</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">299</span><span class="p">)</span>
<a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">LockSupport</span><span class="p">.</span><span class="na">parkNanos</span><span class="p">(</span><span class="n">LockSupport</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">198</span><span class="p">)</span>
<a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">AbstractQueuedSynchronizer$ConditionObject</span><span class="p">.</span><span class="na">awaitNanos</span><span class="p">(</span><span class="n">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">2053</span><span class="p">)</span>
<a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">ArrayBlockingQueue</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">ArrayBlockingQueue</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">372</span><span class="p">)</span>
<a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">NativeDaemonConnector$ResponseQueue</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">NativeDaemonConnector</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">634</span><span class="p">)</span>
<a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">NativeDaemonConnector</span><span class="p">.</span><span class="na">executeForList</span><span class="p">(</span><span class="n">NativeDaemonConnector</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">426</span><span class="p">)</span>
<a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">NativeDaemonConnector</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">NativeDaemonConnector</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">345</span><span class="p">)</span>
<a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">NativeDaemonConnector</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">NativeDaemonConnector</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">340</span><span class="p">)</span>
<a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">NetworkManagementService</span><span class="p">.</span><span class="na">setInterfaceQuota</span><span class="p">(</span><span class="n">NetworkManagementService</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1712</span><span class="p">)</span>
<a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">locked</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x0b0f91b8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span>
<a id="__codelineno-30-57" name="__codelineno-30-57" href="#__codelineno-30-57"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">NetworkPolicyManagerService</span><span class="p">.</span><span class="na">setInterfaceQuota</span><span class="p">(</span><span class="n">NetworkPolicyManagerService</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">2421</span><span class="p">)</span>
<a id="__codelineno-30-58" name="__codelineno-30-58" href="#__codelineno-30-58"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">NetworkPolicyManagerService</span><span class="p">.</span><span class="na">updateNetworkRulesLocked</span><span class="p">(</span><span class="n">NetworkPolicyManagerService</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1232</span><span class="p">)</span>
<a id="__codelineno-30-59" name="__codelineno-30-59" href="#__codelineno-30-59"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">NetworkPolicyManagerService$14</span><span class="p">.</span><span class="na">onReceive</span><span class="p">(</span><span class="n">NetworkPolicyManagerService</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1060</span><span class="p">)</span>
<a id="__codelineno-30-60" name="__codelineno-30-60" href="#__codelineno-30-60"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">locked</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x07439315</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">)</span>
<a id="__codelineno-30-61" name="__codelineno-30-61" href="#__codelineno-30-61"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">app</span><span class="p">.</span><span class="na">LoadedApk$ReceiverDispatcher$Args</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">LoadedApk</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">881</span><span class="p">)</span>
<a id="__codelineno-30-62" name="__codelineno-30-62" href="#__codelineno-30-62"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">handleCallback</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">739</span><span class="p">)</span>
<a id="__codelineno-30-63" name="__codelineno-30-63" href="#__codelineno-30-63"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Handler</span><span class="p">.</span><span class="na">dispatchMessage</span><span class="p">(</span><span class="n">Handler</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">95</span><span class="p">)</span>
<a id="__codelineno-30-64" name="__codelineno-30-64" href="#__codelineno-30-64"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">(</span><span class="n">Looper</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">148</span><span class="p">)</span>
<a id="__codelineno-30-65" name="__codelineno-30-65" href="#__codelineno-30-65"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">HandlerThread</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">HandlerThread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">61</span><span class="p">)</span>
</code></pre></div>
<p>我们分析下上面堆栈：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="w">  </span>at<span class="w"> </span>android.os.BinderProxy.transactNative<span class="o">(</span>Native<span class="w"> </span>method<span class="o">)</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span>at<span class="w"> </span>android.os.BinderProxy.transact<span class="o">(</span>Binder.java:503<span class="o">)</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span>at<span class="w"> </span>android.net.INetworkPolicyManager<span class="nv">$Stub$Proxy</span>.getNetworkPolicies<span class="o">(</span>INetworkPolicyManager.java:410<span class="o">)</span>
</code></pre></div>
<p>主线程被Binder对端block，而对端是在systemserver中的NetworkPolicyManager。</p>
<p>接下来继续去查NetworkPolicyManager为何会被block。
  通常情况下，可以搜索getNetworkPolicies，一般的对端的函数并不会修改函数名：</p>
<p>可以看到我们的对端<code>Binder_4</code> 被Tid=35的人拿住了一把锁<code>（0x07439315）</code>，那么继续看tid=35是谁，有两种方法：
1. 搜索tid=35
2. 搜索0x07439315，找到  <code>- locked &lt;0x07439315&gt; (a java.lang.Object)</code></p>
<p>可以看到，<code>NetworkPolicy（tid=35</code>）在通过NativeDaemonConnector和netd通信（setInterfaceQuota）</p>
<p>我们结合log来看下是否有有用信息，按照之前的经验，netd在执行完cmd的时候，会打印出<code>slow operation</code>。
  在发生ANR的前后，查找netd相关的打印：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="w">  </span><span class="m">06</span>-19<span class="w"> </span><span class="m">15</span>:29:00.997<span class="w">  </span><span class="m">1235</span><span class="w">  </span><span class="m">1270</span><span class="w"> </span>I<span class="w"> </span>am_anr<span class="w">  </span>:<span class="w"> </span><span class="o">[</span><span class="m">0</span>,22831,com.android.settings,818429509,Input<span class="w"> </span>dispatching<span class="w"> </span>timed<span class="w"> </span>out<span class="w"> </span><span class="o">(</span>Waiting<span class="w"> </span>because<span class="w"> </span>no<span class="w"> </span>window<span class="w"> </span>has<span class="w"> </span>focus<span class="w"> </span>but<span class="w"> </span>there<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>focused<span class="w"> </span>application<span class="w"> </span>that<span class="w"> </span>may<span class="w"> </span>eventually<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>window<span class="w"> </span>when<span class="w"> </span>it<span class="w"> </span>finishes<span class="w"> </span>starting<span class="w"> </span>up.<span class="o">)]</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span><span class="m">06</span>-19<span class="w"> </span><span class="m">15</span>:29:05.683<span class="w">  </span><span class="m">1235</span><span class="w">  </span><span class="m">2415</span><span class="w"> </span>E<span class="w"> </span>NetdConnector:<span class="w"> </span>NDC<span class="w"> </span>Command<span class="w"> </span><span class="o">{</span><span class="m">55445</span><span class="w"> </span>bandwidth<span class="w"> </span>setiquota<span class="w"> </span>seth_w0<span class="w"> </span><span class="m">9223372036854775807</span><span class="o">}</span><span class="w"> </span>took<span class="w"> </span>too<span class="w"> </span>long<span class="w"> </span><span class="o">(</span>4755ms
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="m">06</span>-19<span class="w"> </span><span class="m">15</span>:29:05.723<span class="w">  </span><span class="m">1235</span><span class="w">  </span><span class="m">2491</span><span class="w"> </span>I<span class="w"> </span>dvm_lock_sample:<span class="w"> </span><span class="o">[</span>system_server,1,Binder_4,4919,NetworkPolicyManagerService.java,1696,-,1056,100<span class="o">]</span>
</code></pre></div>
<p>从eventslog中还可以发现，settings出现了两次连续的ANR，而上下文中都有类似上面的<code>dvm_lock_sample NetworkPolicyManagerService</code>相关的告警。<br />
  因此虽然15:28的这次ANR并没有打出有用的栈，但是我们还是可以猜测出这两次ANR的原因都是netd的cmd耗时太久导致的（在主线程的调用路径上存在必然的block）
  那么，在netd可能无法修改的情况下，我们应该如何去resolve这个问题呢。</p>
<p><strong>将可能存在block的操作放到非UI线程中去做。</strong></p>
<blockquote>
<p>NETD是Android一个专门管理网络链接, 路由/带宽/防火墙策略以及iptables的系统Daemon进程</p>
<p>Eventlog中的dvm_lock_sample ：在同步锁发生content的时候，虚拟机会将这个竞争记录在eventlog中：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="w"> </span>dvm_lock_sample:<span class="w"> </span><span class="o">[</span>system_server,1,Binder_7,<span class="w"> </span><span class="m">22</span>,<span class="w"> </span>ActivityManagerService.java,15921,-,9628,4<span class="o">]</span>
</code></pre></div>
<ul>
<li>system_server: 进程名  </li>
<li>Binder_7:被block线程</li>
<li>22:block时间（ms）</li>
<li>ActivityManagerService.java,15921: 被block的行号</li>
<li>9628: 持有者行号                                                   </li>
</ul>
<p>如果主线程是被binder对端、被同步锁block，那么eventlog中就很有可能会有dvm_lock_sample的打印。</p>
</blockquote>
<h3 id="37-binder">3.7 Binder线程池耗尽<a class="headerlink" href="#37-binder" title="Permanent link">&para;</a></h3>
<p>我们知道应用最多支持16个binder 线程，SystemServer支持最多32个binder 线程。</p>
<p>我们实际项目上，不时会遇到对端Binder 线程池耗尽导致不能响应的案例。</p>
<p><strong>什么情况下会出现Binder 池耗尽的情况呢？</strong></p>
<p>举个例子，进程A短时间内发送很多Binder 请求给进程B，这种情况下就有可能会导致在短时间内，接收端进程B的Binder 线程池中的16个Binder线程，都用来响应进程A的Binder请求。</p>
<p>也就是我们常说的Binder线程池耗尽的情况，此时进程B无法处理进程A发过来的新的Binder请求。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">NATIVE</span><span class="w"> </span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x4155acc0</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x414943f0</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">3287</span><span class="w"> </span><span class="n">nice</span><span class="o">=-</span><span class="mi">1</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="n">apps</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mi">1074065748</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">1241</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">340</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">  </span><span class="err">#</span><span class="mo">00</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">00021764</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">epoll_wait</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">  </span><span class="err">#</span><span class="mo">01</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">000105</span><span class="n">e3</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libutils</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">Looper</span><span class="p">::</span><span class="n">pollInner</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">+</span><span class="mi">94</span><span class="p">)</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">  </span><span class="err">#</span><span class="mo">02</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">00010</span><span class="mi">811</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libutils</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">Looper</span><span class="p">::</span><span class="n">pollOnce</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">+</span><span class="mi">92</span><span class="p">)</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">  </span><span class="err">#</span><span class="mo">03</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0006</span><span class="n">b345</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libandroid_runtime</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">NativeMessageQueue</span><span class="p">::</span><span class="n">pollOnce</span><span class="p">(</span><span class="n">_JNIEnv</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="o">+</span><span class="mi">22</span><span class="p">)</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">  </span><span class="err">#</span><span class="mo">04</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0001</span><span class="n">e70c</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmPlatformInvoke</span><span class="o">+</span><span class="mi">112</span><span class="p">)</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">  </span><span class="err">#</span><span class="mo">05</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0004</span><span class="n">dc43</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmCallJNIMethod</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">JValue</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Thread</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="mi">398</span><span class="p">)</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">  </span><span class="err">#</span><span class="mo">06</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0002777</span><span class="mi">8</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">  </span><span class="err">#</span><span class="mo">07</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0002</span><span class="n">e410</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmMterpStd</span><span class="p">(</span><span class="n">Thread</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">)</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">  </span><span class="err">#</span><span class="mi">08</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0002</span><span class="n">bac8</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmInterpret</span><span class="p">(</span><span class="n">Thread</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">JValue</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="mi">156</span><span class="p">)</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">  </span><span class="err">#</span><span class="mi">09</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0006025</span><span class="mi">9</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmInvokeMethod</span><span class="p">(</span><span class="n">Object</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayObject</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayObject</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ClassObject</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">bool</span><span class="p">)</span><span class="o">+</span><span class="mi">392</span><span class="p">)</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">  </span><span class="err">#</span><span class="mi">10</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0006</span><span class="mi">83</span><span class="n">eb</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">  </span><span class="err">#</span><span class="mi">11</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0002777</span><span class="mi">8</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">  </span><span class="err">#</span><span class="mi">12</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0002</span><span class="n">e410</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmMterpStd</span><span class="p">(</span><span class="n">Thread</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="mi">76</span><span class="p">)</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">  </span><span class="err">#</span><span class="mi">13</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0002</span><span class="n">bac8</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmInterpret</span><span class="p">(</span><span class="n">Thread</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">JValue</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="mi">156</span><span class="p">)</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">  </span><span class="err">#</span><span class="mi">14</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0005</span><span class="n">ff77</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">dvmCallMethodV</span><span class="p">(</span><span class="n">Thread</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">bool</span><span class="p">,</span><span class="w"> </span><span class="n">JValue</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">__va_list</span><span class="p">)</span><span class="o">+</span><span class="mi">338</span><span class="p">)</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">  </span><span class="err">#</span><span class="mi">15</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0004</span><span class="mi">982</span><span class="n">b</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libdvm</span><span class="p">.</span><span class="na">so</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">  </span><span class="err">#</span><span class="mi">16</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0004</span><span class="n">de13</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libandroid_runtime</span><span class="p">.</span><span class="na">so</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">  </span><span class="err">#</span><span class="mi">17</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0004</span><span class="n">ecdd</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libandroid_runtime</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">android</span><span class="p">::</span><span class="n">AndroidRuntime</span><span class="p">::</span><span class="n">start</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="kd">const</span><span class="o">*</span><span class="p">)</span><span class="o">+</span><span class="mi">532</span><span class="p">)</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">  </span><span class="err">#</span><span class="mi">18</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">00001423</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">app_process</span>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">  </span><span class="err">#</span><span class="mi">19</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">0000</span><span class="n">e403</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="na">so</span><span class="w"> </span><span class="p">(</span><span class="n">__libc_init</span><span class="o">+</span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">  </span><span class="err">#</span><span class="mi">20</span><span class="w">  </span><span class="n">pc</span><span class="w"> </span><span class="mo">00000</span><span class="n">f34</span><span class="w">  </span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">app_process</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">MessageQueue</span><span class="p">.</span><span class="na">nativePollOnce</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">MessageQueue</span><span class="p">.</span><span class="na">next</span><span class="p">(</span><span class="n">MessageQueue</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">138</span><span class="p">)</span>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">(</span><span class="n">Looper</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">app</span><span class="p">.</span><span class="na">ActivityThread</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">5294</span><span class="p">)</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">reflect</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">invokeNative</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">reflect</span><span class="p">.</span><span class="na">Method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">Method</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">515</span><span class="p">)</span>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit$MethodAndArgsCaller</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">932</span><span class="p">)</span>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">android</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">ZygoteInit</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">ZygoteInit</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">748</span><span class="p">)</span>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">dalvik</span><span class="p">.</span><span class="na">system</span><span class="p">.</span><span class="na">NativeStart</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a>
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="s">&quot;Binder_D&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">21</span><span class="w"> </span><span class="n">WAIT</span>
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x41d6f468</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x555f4898</span>
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">3344</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="n">apps</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mi">1442108096</span>
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">3</span>
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
<a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x41d6f4c0</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">VMThread</span><span class="p">)</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">21</span><span class="w"> </span><span class="p">(</span><span class="n">Binder_D</span><span class="p">)</span>
<a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Thread</span><span class="p">.</span><span class="na">parkFor</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1205</span><span class="p">)</span>
<a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">sun</span><span class="p">.</span><span class="na">misc</span><span class="p">.</span><span class="na">Unsafe</span><span class="p">.</span><span class="na">park</span><span class="p">(</span><span class="n">Unsafe</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">325</span><span class="p">)</span>
<a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">LockSupport</span><span class="p">.</span><span class="na">park</span><span class="p">(</span><span class="n">LockSupport</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">157</span><span class="p">)</span>
<a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">parkAndCheckInterrupt</span><span class="p">(</span><span class="n">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">813</span><span class="p">)</span>
<a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">acquireQueued</span><span class="p">(</span><span class="n">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">846</span><span class="p">)</span>
<a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">acquire</span><span class="p">(</span><span class="n">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1175</span><span class="p">)</span>
<a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">ReentrantLock$NonfairSync</span><span class="p">.</span><span class="na">lock</span><span class="p">(</span><span class="n">ReentrantLock</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">180</span><span class="p">)</span>
<a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">ReentrantLock</span><span class="p">.</span><span class="na">lock</span><span class="p">(</span><span class="n">ReentrantLock</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">SurfaceView$MyWindow</span><span class="p">.</span><span class="na">resized</span><span class="p">(</span><span class="n">SurfaceView</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">655</span><span class="p">)</span>
<a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">IWindow$Stub</span><span class="p">.</span><span class="na">onTransact</span><span class="p">(</span><span class="n">IWindow</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">108</span><span class="p">)</span>
<a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Binder</span><span class="p">.</span><span class="na">execTransact</span><span class="p">(</span><span class="n">Binder</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">427</span><span class="p">)</span>
<a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">dalvik</span><span class="p">.</span><span class="na">system</span><span class="p">.</span><span class="na">NativeStart</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
<a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a>
<a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a><span class="s">&quot;Binder_F&quot;</span><span class="w"> </span><span class="n">prio</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">23</span><span class="w"> </span><span class="n">WAIT</span>
<a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="n">sCount</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">dsCount</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="mh">0x41d4e600</span><span class="w"> </span><span class="n">self</span><span class="o">=</span><span class="mh">0x55cb63f8</span>
<a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sysTid</span><span class="o">=</span><span class="mi">3351</span><span class="w"> </span><span class="n">nice</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">sched</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">cgrp</span><span class="o">=</span><span class="n">apps</span><span class="w"> </span><span class="n">handle</span><span class="o">=</span><span class="mi">1435714912</span>
<a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="n">schedstat</span><span class="o">=</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">utm</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">stm</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">core</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Object</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
<a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">&lt;</span><span class="mh">0x41d4e658</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">VMThread</span><span class="p">)</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">tid</span><span class="o">=</span><span class="mi">23</span><span class="w"> </span><span class="p">(</span><span class="n">Binder_F</span><span class="p">)</span>
<a id="__codelineno-34-62" name="__codelineno-34-62" href="#__codelineno-34-62"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Thread</span><span class="p">.</span><span class="na">parkFor</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1205</span><span class="p">)</span>
<a id="__codelineno-34-63" name="__codelineno-34-63" href="#__codelineno-34-63"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">sun</span><span class="p">.</span><span class="na">misc</span><span class="p">.</span><span class="na">Unsafe</span><span class="p">.</span><span class="na">park</span><span class="p">(</span><span class="n">Unsafe</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">325</span><span class="p">)</span>
<a id="__codelineno-34-64" name="__codelineno-34-64" href="#__codelineno-34-64"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">LockSupport</span><span class="p">.</span><span class="na">park</span><span class="p">(</span><span class="n">LockSupport</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">157</span><span class="p">)</span>
<a id="__codelineno-34-65" name="__codelineno-34-65" href="#__codelineno-34-65"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">parkAndCheckInterrupt</span><span class="p">(</span><span class="n">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">813</span><span class="p">)</span>
<a id="__codelineno-34-66" name="__codelineno-34-66" href="#__codelineno-34-66"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">acquireQueued</span><span class="p">(</span><span class="n">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">846</span><span class="p">)</span>
<a id="__codelineno-34-67" name="__codelineno-34-67" href="#__codelineno-34-67"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">acquire</span><span class="p">(</span><span class="n">AbstractQueuedSynchronizer</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">1175</span><span class="p">)</span>
<a id="__codelineno-34-68" name="__codelineno-34-68" href="#__codelineno-34-68"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">ReentrantLock$NonfairSync</span><span class="p">.</span><span class="na">lock</span><span class="p">(</span><span class="n">ReentrantLock</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">180</span><span class="p">)</span>
<a id="__codelineno-34-69" name="__codelineno-34-69" href="#__codelineno-34-69"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">concurrent</span><span class="p">.</span><span class="na">locks</span><span class="p">.</span><span class="na">ReentrantLock</span><span class="p">.</span><span class="na">lock</span><span class="p">(</span><span class="n">ReentrantLock</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-34-70" name="__codelineno-34-70" href="#__codelineno-34-70"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">SurfaceView$MyWindow</span><span class="p">.</span><span class="na">resized</span><span class="p">(</span><span class="n">SurfaceView</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">655</span><span class="p">)</span>
<a id="__codelineno-34-71" name="__codelineno-34-71" href="#__codelineno-34-71"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">view</span><span class="p">.</span><span class="na">IWindow$Stub</span><span class="p">.</span><span class="na">onTransact</span><span class="p">(</span><span class="n">IWindow</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">108</span><span class="p">)</span>
<a id="__codelineno-34-72" name="__codelineno-34-72" href="#__codelineno-34-72"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">android</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">Binder</span><span class="p">.</span><span class="na">execTransact</span><span class="p">(</span><span class="n">Binder</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">427</span><span class="p">)</span>
<a id="__codelineno-34-73" name="__codelineno-34-73" href="#__codelineno-34-73"></a><span class="w">  </span><span class="n">at</span><span class="w"> </span><span class="n">dalvik</span><span class="p">.</span><span class="na">system</span><span class="p">.</span><span class="na">NativeStart</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Native</span><span class="w"> </span><span class="n">Method</span><span class="p">)</span>
</code></pre></div>
<p>从上面堆栈查看主线程的栈，发现主线程在IDLE状态。然后发现第二个线程是Binder10 且在block状态，通常情况下，一个不是非常繁忙的需要对外提供服务的app是不需要16个binder线程的。 </p>
<p>于是接着查看是否其他binder也存在异常，结果发现所有的binder线程均处于同样的调用栈。</p>
<p>在这种Binder满的情况下，systemserver和app之间的通信是被block的，我们可以推断出
ANR的直接原因就是此处不合常理的Binder被占满。
首先通过代码可以看到，surfaceView中这行对应的代码为如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nd">@Override</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resized</span><span class="p">(</span><span class="n">Rect</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="n">Rect</span><span class="w"> </span><span class="n">overscanInsets</span><span class="p">,</span><span class="w"> </span><span class="n">Rect</span><span class="w"> </span><span class="n">contentInsets</span><span class="p">,</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">                    </span><span class="n">Rect</span><span class="w"> </span><span class="n">visibleInsets</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">reportDraw</span><span class="p">,</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="n">newConfig</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">  </span><span class="n">SurfaceView</span><span class="w"> </span><span class="n">surfaceView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSurfaceView</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">surfaceView</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span><span class="w"> </span><span class="n">Log</span><span class="p">.</span><span class="na">v</span><span class="p">(</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">      </span><span class="s">&quot;SurfaceView&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceView</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; got resized: w=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">width</span><span class="p">()</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; h=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">height</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, cur w=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mCurWidth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; h=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mCurHeight</span><span class="p">);</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="n">Lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reportDraw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">        </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mUpdateWindowNeeded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">        </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mReportDrawNeeded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">        </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mHandler</span><span class="p">.</span><span class="na">sendEmptyMessage</span><span class="p">(</span><span class="n">UPDATE_WINDOW_MSG</span><span class="p">);</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mWinFrame</span><span class="p">.</span><span class="na">width</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">width</span><span class="p">()</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">                 </span><span class="o">||</span><span class="w"> </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mWinFrame</span><span class="p">.</span><span class="na">height</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">height</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">        </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mUpdateWindowNeeded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="w">        </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mHandler</span><span class="p">.</span><span class="na">sendEmptyMessage</span><span class="p">(</span><span class="n">UPDATE_WINDOW_MSG</span><span class="p">);</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="w">      </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">mSurfaceLock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="p">}</span>
</code></pre></div>
<p>我们可以在所有会lock和unlock的地方都加上log，再复现一次来得到真相。于是乎发现是在SingleTouchPointTest pass的时候忘记unlockCanvs导致。</p>
<h3 id="38">3.8 无效堆栈<a class="headerlink" href="#38" title="Permanent link">&para;</a></h3>
<p>在我们的实际项目上，经常会遇到这样的情况，日志提供的是完整的，可堆栈看起来却不像"作案"堆栈，即出现的堆栈并不像是真正的凶手。</p>
<p>常见的一种情况: <strong>堆栈落在nativePollOnce上。</strong></p>
<p>这种情况通常说明当前主线程的消息队列是空闲的，此时在等待处理下一个msg，打印日志时真正的block消息已经走完了。</p>
<p>我们以下面这个计算器的anr为例</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>01-29 06:24:46.618452  1210  5962 I AnrManager: ANR in com.journeyui.calculator (com.journeyui.calculator/.Calculator), time=260439862
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>01-29 06:24:46.618452  1210  5962 I AnrManager: Reason: Input dispatching timed out (ActivityRecord{51e27ca u0 com.journeyui.calculator/.Calculator t1837} does not have a focused window)
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>01-29 06:24:46.618452  1210  5962 I AnrManager: Load: 31.7 / 33.43 / 30.98
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>01-29 06:24:46.618452  1210  5962 I AnrManager: Android time :[2022-01-29 06:24:46.60] [260451.594]
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>01-29 06:24:46.618452  1210  5962 I AnrManager: CPU usage from 167270ms to 0ms ago (2022-01-29 06:21:47.589 to 2022-01-29 06:24:34.860) with 99% awake:
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   226% 1210/system_server: 173% user + 52% kernel / faults: 1026822 minor 8 major
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   125% 459/logd: 16% user + 109% kernel / faults: 408 minor
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   29% 21567/com.journeyui.globalsearch: 18% user + 10% kernel / faults: 45071 minor 25 major
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   26% 639/surfaceflinger: 18% user + 8.6% kernel / faults: 4704 minor
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   26% 20889/com.yulong.android.gamecenter: 16% user + 9.3% kernel / faults: 21143 minor
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   24% 29706/com.sohu.inputmethod.sogou:home: 16% user + 8.6% kernel / faults: 21832 minor
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   24% 545/com.android.messaging: 15% user + 9% kernel / faults: 26023 minor 2 major
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>//...
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>01-29 06:24:46.618452  1210  5962 I AnrManager:   1.7% 3589/com.journeyui.calculator: 1% user + 0.6% kernel / faults: 3365 minor 5 major
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>//...
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>01-29 06:24:46.618480  1210  5962 I AnrManager: 75% TOTAL: 42% user + 33% kernel + 0% iowait + 0% softirq
</code></pre></div>
<p>首先看下是否受系统环境影响</p>
<p>从上面的日志片段可以看出，整机负载较高达到了75%，但是前台进程com.journeyui.calculator占用并不高只有1.7%。</p>
<p>top中没有kswapd身影，排除低内存的影响，所以这个问题在一定程度上受整机高负载的影响。</p>
<blockquote>
<p>ANR发生时SystemServer占据稍高可能是正常的，因为Dump Trace时需要获取系统整体及各进程 CPU 使用情况，短时间内会造成SystemServer升高。</p>
</blockquote>
<p>接着event日志中搜索"am_anr"关键字</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>01-29 06:24:34.907471 1210 5962 I am_anr : [0,3589,com.journeyui.calculator,684244549,
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>Input dispatching timed out (ActivityRecord{51e27ca u0 com.journeyui.calculator/
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>.Calculator t1837} does not have a focused window)]
</code></pre></div>
<p>根据时间戳找到对应的anr文件</p>
<p><a class="glightbox" href="../assets/640%20%283%29.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="图片" src="../assets/640%20%283%29.png" /></a></p>
<p>此时我们注意到堆栈落在了nativePollOnce上，前面说过落在nativePollOnce上，说明应用此时已经处于idle状态了。</p>
<p>对于这种情况，说明耗时消息已埋没在历史消息中，历史消息的耗时可能存在下面的几种情况</p>
<ol>
<li>
<p>应用主线程历史调度中存在严重耗时的消息</p>
</li>
<li>
<p>应用主线程历史调度中存在多个耗时的消息</p>
</li>
<li>
<p>应用主线程历史调度中存在大量消息比如高频发送消息</p>
</li>
<li>
<p>应用主线程本身并不耗时，而是受到系统环境因素影响(IO/低内存/高负载等)</p>
</li>
</ol>
<p>那么历史调度中的耗时消息我们应该如何得知呢？</p>
<p>通常手机厂商会做日志增强，常见的思路如下:</p>
<ol>
<li>对于主线程的binder transaction 耗时情况， 超出设定阈值则输出调用信息。</li>
<li>当线程等锁时间超出设定阈值，则输出当前的持锁状态。</li>
<li>主线程的生命周期回调方法执行时间超出设定阈值，则输出相应信息。</li>
<li>对于非异步Binder调用耗时超出设定阈值的时候，输出Binder信息。</li>
</ol>
<p>对于一些头部应用厂商如字节跳动有自研的Raster消息监控平台，和手机厂商做的日志增强目的是一样的，都是为了尽可能多的收集线索。</p>
<p>除了落在nativePollOnce的情况，还有一种情况则更加隐蔽，容易将我们带偏分析的方向。那就是堆栈打印出来的确实是应用自身的堆栈。</p>
<p>但是根据堆栈找到对应代码后发现这段代码不可能会出现耗时，说明这段堆栈可能只是充当了"替罪羊"的角色，而真正的"凶手"早已藏身在了历史消息中。</p>
<h2 id="_2">参考<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p><a href="https://zhuanlan.zhihu.com/p/378902923">干货：ANR日志分析全面解析</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/22272957">ANR问题分析指北</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzAxMTg2MjA2OA==&amp;mid=2649878760&amp;idx=1&amp;sn=7c0f9e85a56b305fe48a423f937d1e9e&amp;chksm=83bff9b3b4c870a57f1b076b42c7b761d854312dc80f094d209edee263ac7eb91176a7b07176&amp;scene=90&amp;subscene=93&amp;sessionid=1660099661&amp;clicktime=1660099662&amp;enterid=1660099662&amp;ascene=56&amp;fasttmpl_type=0&amp;fasttmpl_fullversion=6278901-zh_CN-zip&amp;fasttmpl_flag=0&amp;realreporttime=1660099662259&amp;devicetype=android-29&amp;version=2800193b&amp;nettype=3gnet&amp;abtest_cookie=AAACAA%3D%3D&amp;lang=zh_CN&amp;session_us=gh_28bf22ba9ab4&amp;exportkey=AUOz5hFRsMH%2Fe%2BYf089egPM%3D&amp;pass_ticket=okF3V9XADlQbSEaY458xUdoLzLucuBjRn1Jqsoeamu6gVuvLNeDRioZVO3zc0zyz&amp;wx_header=3">一文带你不再惧怕ANR </a></p>


  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2026 Adison
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/adisonhuang" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/adisonhyh" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:adison5321@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.tabs.link", "navigation.sections", "navigation.tabs", "navigation.top", "search.share", "search.suggest", "search.highlight", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.a51614de.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>